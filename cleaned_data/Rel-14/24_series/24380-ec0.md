# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the media plane control protocols and
interactions with the media needed to support Mission Critical Push To Talk
(MCPTT).
The present document specifies protocol for using pre-established session to
setup calls, floor control and managing MBMS subchannels over MBMS bearers on-
network and off-network protocols for floor control.
Mission critical communication services are services that require preferential
handling compared to normal telecommunication services, e.g. in support of
police or fire brigade. Floor control provides a mechanism for managing the
right to transmit at a point in time during an MCPTT call.
The MCPTT service and its associated media plane control protocols can be used
for public safety applications and also for general commercial applications
(e.g., utility companies and railways).
The present document is applicable to User Equipment (UE) supporting the floor
participant functionality, setting up calls using pre-established SIP sessions
and using MBMS bearers for group communication and to floor control servers
supporting these functions in the MCPTT system.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control
Protocol specification\".
[3] IETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".
[4] 3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object
(MO)\".
[5] 3GPP TS 23.379: \"Functional architecture and information flows to support
mission critical communication services; Stage 2\".
[6] 3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE);
MB2 Reference Point; Stage 3\".
[7] IETF RFC 5761: \"Multiplexing RTP Data and Control Packets on a Single
Port\".
[8] IETF RFC 3711: \"The Secure Real-time Protocol (SRTP)\".
[9] 3GPP TS 25.446: \"MBMS synchronization protocol (SYNC)\".
[10] 3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol
User Plane (GTPv1-U)\".
[11] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core
Network protocols; Stage 3\".
[12] 3GPP TS 24.481: \"Mission Critical Services (MCS) group management
Protocol specification\".
[13] 3GPP TS 24.484: \"Mission Critical Services (MCS) configuration
management protocol specification\".
[14] Void.
[15] IETF RFC 3830: \"MIKEY: Multimedia Internet KEYing\".
[16] IETF RFC 3711: \"The Secure Real-time Transport Protocol (SRTP)\".
[17] IETF RFC 6509: \"MIKEY-SAKKE: Sakai-Kashar Key Encryption in Multimedia
Internet KEYing (MIKEY)\".
[18] 3GPP TS 33.180: \"Security of the mission critical service\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term or definition defined in
the present document takes precedence over the definition of the same term or
definition, if any, in 3GPP TR 21.905 [1].
**Active floor request queue:** The floor request queue used by the floor
control server to queue received Floor Request messages.
**Candidate arbitrator:** The queued floor participant in off-network to whom
the floor was granted. Once the candidate arbitrator responds to the floor
grant, it becomes the current arbitrator.
**Controlling MCPTT function:** The MCPTT server performing a controlling
role.
**Conversation:** A number of media bursts exchanged between participants in a
group call session.
**Current arbitrator:** The floor participant in off-network currently
arbitrating the floor.
**Effective priority:** The priority decision determined by the floor control
server based on multiple input parameters like floor priority, participant
type, type of call etc. of the current floor request and of the current
participant to which floor is granted if any and the local policy.
**MBMS bearer:** The service provided by the EPS to deliver the same IP
datagrams to multiple receivers in a designated location.
**MBMS subchannel:** A logical channel which uses resources of an activated
and announced MBMS bearer identified by the TMGI of the MBMS bearer and
additional parameters, like UDP port, associated to a group or the MBMS
subchannel used to e.g. inform when a conversation in a group call is started
or ended.
NOTE: In this release of the specifications the UDP port is the only parameter
used for enabling the differentiation of media and media plane control packets
belonging to different groups over the same MBMS bearer by a receiving MCPTT
client.
**Media burst:** A flow of media from an MCPTT client that has the permission
to send media.
**Media plane control protocols:** Protocols in the media plane used for floor
control, pre-established session call control and MBMS subchannel control.
**Participating MCPTT function:** The MCPTT server performing a participating
role.
**Passive floor request queue:** The floor request queue used by the non-
controlling MCPTT function to store received Floor Request messages for
monitoring purposes.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.379 [5] apply:
**Ambient listening call**
**Floor control**
**Floor participant**
**Floor control server**
**Group call**
**MCPTT call**
**MCPTT server performing a controlling role**
**MCPTT server performing a participating role**
**MCPTT user**
**Mission critical push to talk**
**Private call**
**SIP core**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.379 [2] apply:
**Non-controlling MCPTT function of an MCPTT group**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 33.180 [18] apply:
**Client Server Key (CSK)**
**Client Server Key Identifier (CSK-ID)**
**Group Master Key (GMK)**
**Group Master Key Identifier (GMK-ID)**
**Multicast Key for Floor Control (MKFC)**
**Identifier of Multicast Key for Floor Control (MKFC-ID)**
**Multicast Signalling Key (MuSiK)**
**Multicast Signalling Key Identifier (MuSiK-ID)**
**Private Call Key (PCK)**
**Private Call Key Identifier (PCK-ID)**
**Signalling Protection Key (SPK)**
**Signalling Protection Key Identifier (SPK-ID)**
**MBMS SubChannel Control Key (MSCCK)**
**MBMS SubChannel Control Key Identifier (MSCCK-ID)**
For the purposes of the present document, the following terms and definitions
given in IETF RFC 3711 [16] apply:
**SRTP master key (SRTP-MK)**
**SRTP master key identifier (SRTP-MKI)**
**SRTP master salt (SRTP-MS)**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AS Application Server
D2D Device to Device
DL Downlink
GCS AS Group Communication Service Application Server
GMK Group Management Key
GMS Group Management Server
GUK-ID Group User Key Identifier
IP Internet Protocol
MBMS Multimedia Broadcast and Multicast Service
MCMC Mission Critical MBMS subchannel Control Protocol
MCPTT Mission Critical Push To Talk
MKI Master Key Identifier
PCK Private Call Key
PCK-ID Private Call Identifier
PTT Push-To-Talk
RFC Request For Comment
RTCP RTP Control Protocol
RTP Real-time Transport Protocol
SRTCP Secure RTCP
SRTP Secure RTP
SSRC Synchronization SouRCe
TEK Traffic-Encrypting Key
TMGI Temporary Mobile Group Identity
UE User Equipment
# 4 General
## 4.1 Overview
### 4.1.1 Floor Control
#### 4.1.1.1 General
In a PTT group call after the call is setup, at a given time only a single
group member is allowed to talk and all other affiliated group members listen
to this talker. The control action for obtaining this mode of operation is
known as floor control. The direct actors of floor control are the floor
participants and the floor control server. A floor participant does the floor
control related actions in the MCPTT client. The floor control server is the
decision maker of the floor control. In on-network the floor control server is
in the MCPTT server with the controlling role. In off-network no specific
floor control server exists. The current talker plays the role of floor
control server.
Floor control actions in on-network are described in subclause 4.1.1.2. The
differences for off-network floor control are described in subclause 4.1.1.3.
NOTE: End-user actions as operation of the PTT button illustrates
functionality but no end-user actions are mandated by the present document.
#### 4.1.1.2 On-network floor control
At any point in time a group member can request permission to talk.
When all group members are silent, a group member can press the PTT button,
meaning the request for permission to talk. The floor participant entity of
this user reflects this request to the floor control server by sending a Floor
Request message. If the floor control server decides to permit, it informs
this permission for this request by sending a Floor Granted message to the
requesting group member. The floor control server informs the initiation of
the talk to the other group members by sending a Floor Taken message. Once the
group member receives the permission, a permission indication (permission
tone) is generated by the client to inform the user that they can talk. The
media packets (encoded voice) are sent to the controlling MCPTT server and
from there they are distributed to all listeners of this group. The release of
the PTT button indicates the user's intention to end talking. Once the PTT
button is released, the floor participant sends a Floor Release message to the
floor control server indicating that this user has finished talking. This
cycle, starting from the Floor Granted message and ending with Floor Release
message, is known as \'talk burst\' or \'media burst\'.
In the beginning of a call the initial talk permission request can be implied
by the SIP message which initiates the call as specified in 3GPP TS 24.379 [2]
without any specific Floor Request message. For ambient listening, the implied
talk permission request can be applied to the user on the originating side or
to the user on the terminating side.
A group member can also request permission to talk by sending a Floor Request
message during a talk burst. The floor control server can resolve this request
in several ways.
1\. If this request has higher priority than the ongoing talk burst, the floor
control server revokes the current talk burst by sending a Floor Revoke
message to the current talker. The current talker is interrupted and the
current media burst is ended by the current floor participant by sending a
Floor Release message. Then the floor control server sends a Floor Granted
message to the revoking user and send Floor Taken message to other group
members. Then a new media burst starts.
2\. If this request does not have higher priority and floor request queueing
is not used the floor control server rejects this request by sending a Floor
Deny message to the requester. Then a reject indication (reject tone) is
generated for the user. The ongoing talk burst continues.
3\. If request queueing is used the floor control server sends Floor Queue
Position Info message indicating that there is no permission but the request
is queued for potential permission when the current talk burst ends. Then a
\"queued\" indication is generated for the user. The ongoing talk burst
continues.
In the case of an ambient listening call, the user initially granted the floor
retains the floor for the duration of the call.
During a talk burst, a queued user can ask its position in the queue by
sending a Floor Queue Position Request message. Then the floor control server
provides the information by sending Floor Queue Position Info message. A
queued user can also remove itself from the queue by sending a Floor Release
message. This kind of message exchange during a talk burst does not affect the
ongoing talk burst.
If request queueing is used, by the end of a talk burst, the floor control
server gives the talk permission to the first pending request in the queue.
For this, it sends the same messages as in the beginning of a talk burst;
Floor Granted message to the permitted user and Floor Taken message to other
group members. The permitted user is expected to press the PTT button after
the permission tone within a well-defined short period of time. If PTT button
is pressed the media burst continues normally until it is released. If not,
the MCPTT client loses the talk permission.
If queueing is used the ordering in the queue is affected by the priority of
the users in the queue.
A floor request with pre-emptive priority can be granted without revoking the
current speaker. In this case media from both the overridden current talker
and the overriding MCPTT user is distributed to selected participants at the
same time. The list of participants that receive the overriding, overridden,
or both transmissions is based on configuration.
Pre-emptive priority without revoking the current talker is not applicable if
the group is configured for audio cut-in floor control.
During silence (when no talk burst is ongoing), the floor control server can
send Floor Idle message to all floor participants from time to time. The floor
control server sends Floor Idle message in the beginning of silence.
Some of the floor control messages can be repeated as specified in state
machines specified in clause 6.
The call can be released after a long silence period.
#### 4.1.1.3 Off-network floor control
This subclause describes the special features for off-network floor control
with respect to the on-network floor control.
In off-network no specific floor control server exists. All floor control
messages are sent to all group members.
When a floor control server gives talk permission it sends a Floor Granted
message. The information element which expresses the group member, to which
this talk permission is given, implies to the other group members that the
floor is taken. No other Floor Taken message is sent.
After silence, a floor participant asks for talk permission by sending a Floor
Request message. After a well-defined waiting period, if no response is
received, this floor participant sends a Floor Taken message indicating itself
in the information element which expresses the group member to which this talk
permission is given and continues the talk burst.
In off-network, the Floor Idle message is not used.
Some of the floor control messages can be repeated as specified in the state
machines specified in clause 7.
Audio cut-in floor control is not applicable for off-network.
#### 4.1.1.4 Determine on-network effective priority
The floor control server can determine how to handle a received Floor Request
message using a number of input parameters. Examples of input parameters that
the floor control server can use are:
1\. the floor priority, using the value of the Floor Priority field in the
Floor Request message;
2\. the \ element as specified in 3GPP TS 24.481 [12];
3\. the \ element as specified in 3GPP TS
24.484 [13];
4\. the participant type, using the \ element specified in
3GPP TS 24.481 [12] or, in case a non-controlling MCPTT function is attached
to a group call, the \ value in the Track Info field in the
Floor Request message;
5\. the type of call indicated in the Floor Indicator field;
6\. the effective priority of the floor participant with the permission to
send media, and the current type of the call (e.g. normal, imminent-peril,
emergency, broadcast); and
7\. any other information in the group document specified in 3GPP TS 24.481
[12] or information stored in the controlling MCPTT function outside the scope
of the present document.
Using a local policy and the above input parameters the floor control server
can determine that a floor request is:
1\. pre-emptive such that the current talker is overridden;
2\. pre-emptive such that the current talker is revoked;
3\. not pre-emptive and put in the floor request queue, if queueing was
negotiated; or
4\. not-pre-emptive and rejected, if queueing was not negotiated.
#### 4.1.1.5 Determine off-network effective priority
The floor control participant can determine how to handle a received Floor
Request message using the following input parameters:
1\. the floor priority, using the value of the Floor Priority field in the
Floor Request message;
2\. the value of the
\"/\/\/Common/MCPTTGroupMemberList/\/UserPriority\" leaf node of the
sender of the Floor Request message, present in group configuration as
specified in 3GPP TS 24.483 [4];
3\. the value of the \"/\/OffNetwork/NumLevelHierarchy\" leaf node present
in service configuration as specified in 3GPP TS 24.483 [4];
4\. the type of call indicated in the Floor Indicator field; and
5\. the effective priority of the floor participant with the permission to
send media, and the current type of the call (e.g. normal, imminent-peril,
emergency).
Using the policy as described in subclause 7.2.1.2, and the above input
parameters the floor control participant can determine that a floor request
is:
1\. pre-emptive such that the current talker is revoked;
2\. not pre-emptive and put in the floor request queue, if the value of
\"/\/\/OffNetwork/QueueUsage\" leaf node present in the group
configuration as specified in 3GPP TS 24.483 [4] is set to \"true\"; or
3\. not-pre-emptive and rejected, if the value of
\"/\/\/OffNetwork/QueueUsage\" leaf node present in the group
configuration as specified in 3GPP TS 24.483 [4] is set to \"false\".
### 4.1.2 Pre-established session call control
#### 4.1.2.1 General
An MCPTT client can pre-establish a session with the participating MCPTT
function for potential use when a call is setup. The establishment, the
modification and the release of a pre-established session are specified in
3GPP TS 24.379 [2].
NOTE: The establishment of a pre-established session, for potential use when a
call is setup, depends on the policy chosen by the MCPTT service provider.
A pre-established session can be used when initiating a pre-arranged group
call, a chat group call or a private call. Similarly, a pre-established
session can be released for reuse after the termination of a pre-arranged
group call, chat group call and private call.
The media plane control messages related to call setup over a pre-established
session are sent over the channel used for media plane control. The media
plane control messages related to the release of a call which was setup over a
pre-established session, without terminating the pre-established session, are
sent over the channel used for media plane control. The unicast channel for
media plane control is over the MCPTT-4 reference point.
#### 4.1.2.2 Call setup over pre-established session
For a pre-arranged group call, when the originator initiates the call setup
indicating the use of a pre-established session using SIP messages as
specified in 3GPP TS 24.379 [2], the participating MCPTT function (which
serves the originating MCPTT client) sends to the originating MCPTT client a
Connect message after the controlling MCPTT function accepts the initiation of
this call. After the reception of this Connect message the originating MCPTT
client sends an Acknowledgment message indicating that the connection is
accepted or indicating that the connection is not accepted. If the connection
is accepted by the originating MCPTT client, the floor control for this call
continues as specified in clause 6.
For a pre-arranged group call if the controlling MCPTT function as triggered
by an originating group member initiates a call as specified in 3GPP TS 24.379
[2], the participating MCPTT function which serves the terminating MCPTT
client sends a Connect message to all affiliated MCPTT clients of this group.
After the reception of the Connect message the terminating MCPTT client sends
an Acknowledgment message indicating that the connection is accepted or
indicating that the connection is not accepted. If the connection is accepted
by the terminating MCPTT client, the floor control for this call continues as
specified in clause 6.
NOTE: If a terminating client does not have an available pre-established
session, the call setup proceeds as in on-demand call setup as specified in
3GPP TS 24.379 [2].
For a chat group call, a group member can use a pre-established session when
joining the chat group using SIP messages as specified in 3GPP TS 24.379 [2].
For a group member that has already joined the chat group call, the floor
control between the MCPTT client (floor participant) and the MCPTT server
(floor control server) continues as specified in clause 6.
For a private call the procedures for the originator are the same as for the
originator initiating a call for a pre-arranged call setup over a pre-
established session, with the difference that the recipient of the call is a
private user and not a pre-arranged group.
For a private call if the controlling MCPTT function as triggered by the
originator initiates a call as specified in 3GPP TS 24.379 [2], the
participating MCPTT function (which serves the terminating MCPTT client) sends
a Connect message to the terminating MCPTT client served by the participating
MCPTT function if this MCPTT client has an available pre-established session
and the commencement mode is automatic. If the commencement mode is manual the
terminating MCPTT client is invited using SIP procedures as specified in 3GPP
TS 24.379 [2].
#### 4.1.2.3 Release of a call which uses a pre-established session
When a call is released by the controlling MCPTT function (as specified in
3GPP TS 24.379 [2]), the participating MCPTT function sends a Disconnect
message to all MCPTT clients which used a pre-established session for this
call. Then the call is released (see also 3GPP TS 24.379 [2]) and the pre-
established session can be used for another call.
When an MCPTT client leaves a call (as specified in 3GPP TS 24.379 [2]) which
was setup over a pre-established session without releasing the pre-established
session, this pre-established session can be used for another call.
A call setup over a pre-established session can also be released by using the
specifications in 3GPP TS 24.379 [2] (without the use of Disconnect message).
As a result the pre-established session, which has been used for this call, is
also released.
### 4.1.3 MBMS subchannel control
#### 4.1.3.1 General
The participating MCPTT function can use an MBMS bearer for the DL
transmission of the media and the media control plane.
The participating MCPTT function decides to activate an MBMS bearer. After the
activation of the MBMS bearer, as specified in 3GPP TS 29.468 [6], the TMGI of
this MBMS bearer is announced to the MCPTT clients in the MBMS service area of
this MBMS bearer. This announcement enables the MCPTT client to listen
(decode/demodulate) this MBMS bearer. The activation of an MBMS bearer and the
announcement of the TMGI create a pool of MBMS subchannel resources without
any association to a group or other purposes.
The criteria for a participating MCPTT function to decide to activate and use
an MBMS bearer is implementation dependent.
An MBMS bearer can be used for the DL transmission for more than one group.
For this, additional parameters like destination UDP port are used for
enabling the differentiation of messages and packets belonging to different
groups over the same MBMS bearer by a receiving MCPTT client.
When a TMGI is announced a general purpose MBMS subchannel is created by
defining an association between the identity of the general purpose MBMS
subchannel (e.g. \'general purpose\') and the TMGI (of the activated and
announced MBMS bearer) together with the parameters (e.g. UDP port)
differentiating this general purpose MBMS subchannel in this MBMS bearer. The
parameters of this general purpose MBMS subchannel can be communicated to the
MCPTT clients in the MBMS service area of this MBMS bearer using unicast over-
the air transmission or can be pre-defined and stored in the MCPTT user
profile that is downloaded to the MCPTT UE.
#### 4.1.3.2 Start of a conversation
When a conversation is started (by an originating MCPTT client of a group) the
participating MCPTT function can allocate an MBMS subchannel for this group by
defining an association between this group (e.g. \'group id\') and the TMGI
(of the activated and announced MBMS bearer) with the parameters
differentiating this MBMS subchannel in this MBMS bearer. The parameters of
this MBMS subchannel are sent using the general purpose MBMS subchannel using
the Map Group To Bearer message. The Map Group To Bearer message is repeated
as long as the conversation is ongoing for improving the reception probability
and to allow MCPTT clients arriving late to listen to the MBMS subchannel.
The same MBMS subchannel can be used for media and media control plane of an
MCPTT group, subjected to the restrictions stated in IETF RFC 5761 [7].
#### 4.1.3.3 During a conversation
If an MBMS subchannel exists, the participating MCPTT function forwards the
media plane control messages, received from the controlling MCPTT function via
MBMS subchannel for media plane control. Only floor control messages which are
transmitted to more than one affiliated group member are forwarded to the MBMS
bearer (e.g. the Floor Taken and Floor Idle messages). The floor control
messages can be repeated a configurable number of times for improving the
reception probability. The participating MCPTT function forwards the media
packets, received from the controlling MCPTT function, via the MBMS subchannel
for media.
Amongst all affiliated group members under this participating MCPTT function,
the participating MCPTT function is informed or is enabled to deduce the group
members which do not or cannot receive the MBMS subchannels. The participating
MCPTT function forwards the media packets and the media plane control
messages, received from the controlling MCPTT function, to the group members
which do not or cannot receive the MBMS subchannels, using unicast bearers
allocated for media and media plane control respectively.
#### 4.1.3.4 Ending the conversation
The participating MCPTT function can de-allocate an MBMS subchannel after a
configurable period of silence in the conversation by removing the association
to this group by sending the Unmap Group To Bearer message over this MBMS
subchannel. The de-allocation of the MBMS subchannel frees the parameters used
for differentiating this MBMS subchannel in this MBMS bearer. Therefore, the
resources of a de-allocated MBMS subchannel can be reallocated for a
conversation of another group.
NOTE: The participating MCPTT function will activate MBMS bearers with general
QoS characteristics suitable for MCPTT service and will map MBMS subchannels
for media or media plane control only to MBMS bearers that can provide the QoS
required by media or media plane control.
## 4.2 Internal structure of media plane control entities
### 4.2.1 Controlling MCPTT function
According to 3GPP TS 23.379 [5] the controlling MCPTT function is divided into
a floor control server and a media distribution function. In the present
document the internal structure of the MCPTT server is illustrated in figure
4.2-1.
NOTE: The real internal structure of the MCPTT server is implementation
specific but a possible internal structure is shown to illustrate the
procedures.
Figure 4.2.1-1: Internal structure of floor control in the controlling MCPTT
function
All entities in the controlling MCPTT function are assumed to have a direct
communication interface to the application and signalling plane. The interface
to the application and signaling plane carries information about SIP session
initialisation and SIP session release, SDP content, etc.
The reference point MCPTT-3 is described in 3GPP TS 23.379 [5].
The floor control interface towards the MCPTT client receives and transmits
the floor control messages from and to the MCPTT client via the participating
MCPTT function or non-controlling MCPTT function. The procedures are
controlled by a state machine described in subclause 6.3.5. One state machine
is needed for each MCPTT client participating in an MCPTT call. A non-
controlling MCPTT function is seen by the floor control interface towards the
MCPTT client as an MCPTT client.
The floor control arbitration logic is performing the floor control. The floor
control arbitration logic is controlled by a state machine described in
subclause 6.3.4. One state machine is needed per MCPTT call.
The floor request queue is accessible both by the floor control interface
towards the MCPTT client for all MCPTT clients in the call and the floor
control arbitration logic.
The network media interface is receiving and sending media from and to the
associated MCPTT client via the participating MCPTT function or non-
controlling MCPTT function. The network media interface is out of scope of the
present document. One network media interface is needed for each MCPTT client
participating in an MCPTT call. A non-controlling MCPTT function is seen by
the network media interface as an MCPTT client.
The media distributor is controlled by the floor control arbitration logic.
The media distributor is out of scope of the present document. One media
distributor is needed per MCPTT call.
The internal interfaces are assumed to transport the following types of
information.
1\. The interface between the network media interface and the floor control
interface towards the MCPTT client:
a. Indication that the network media interface has started to receive media
packets from the associated MCPTT client or that media packets are no longer
received from the associated MCPTT client.
NOTE: It is an implementation option whether an indication e.g. is sent for
every received RTP media packet or only when the first packet is received and
then when no more RTP packets are received.
2\. The interface between the floor control interface towards the MCPTT client
and the floor control arbitration logic:
a. Floor control messages to and from the associated MCPTT client, requests to
create or delete the state machine instance for the associated MCPTT client.
The floor control messages to the floor control arbitration logic are limited
to floor control messages that will change the state of the floor.
3\. The interface between the network media interface and the media
distributor:
a. Media to and from associated MCPTT clients. This interface is out of scope
of the present document.
4\. The interface between the floor control arbitration logic and the media
distributor:
a. Requests to start or stop distributing media to participants in the MCPTT
call. Indication that the media distributor has started to receive media
packets from the network media interface associated with the MCPTT client with
the permission to send media or that media packets are no longer received from
the network media interface from the associated MCPTT client.
5\. The interface between the floor control interface towards the MCPTT client
and the floor request queue:
a. Requests to store received Floor Request messages in the queue or requests
to remove Floor Request messages from the queue and the queue content for
building the Floor Queue Position Info message.
6\. The interface between the floor control arbitration logic and the floor
request queue:
a. Requests to store received Floor Request messages in the queue or requests
to remove Floor Request messages from the queue. Indications that the queue is
modified.
### 4.2.2 MCPTT client
According to 3GPP TS 23.379 [5] the MCPTT client is divided into a floor
participant and a media mixer function. In the present document the internal
structure of the MCPTT client is illustrated in figure 4.2.2-1.
NOTE: The real internal structure of the MCPTT client is implementation
specific but a possible internal structure is shown to illustrate the logic
and the procedures.
Figure 4.2.2-1: Internal structure of the MCPTT client
All entities in the MCPTT client have a direct communication interface to the
application and signalling plane. The interface to the application and
signaling plane carries information about SIP session initialisation and SIP
session release, SDP content, etc.
The reference points MCPTT-4, MCPTT-6, MCPTT-7 and MCPTT-8 are described in
3GPP TS 23.379 [5].
The floor participant receives and sends floor control and pre-established
session control message over the unicast bearer.
The media mixer receives and sends RTP media packets over the unicast bearer.
The media mixer indicates to the floor participant when RTP media packets are
received and when RTP media packets are no longer received. The floor
participant instructs the media mixer on how to handle media received from the
user or received from the network either over the unicast bearer or over the
MBMS bearer.
The MBMS interface receives RTP media packets over the MBMS bearer. The RTP
media packets are forwarded to the media mixer.
The MBMS interface receives floor control messages and MBMS subchannel control
messages over the MBMS bearer. The MBMS interface forward received floor
control messages to the floor participants.
The floor participant receives indication from the MCPTT client when the MCPTT
user has pressed or released the PTT button. The MCPTT client can also provide
notification towards the MCPTT user. Voice received from the MCPTT user is, on
instruction from the floor participant, encoded by the media mixer and sent as
RTP media packets over the unicast bearer.
### 4.2.3 Participating MCPTT function
#### 4.2.3.1 General
The participating MCPTT function performs the participating role of an MCPTT
server as defined in 3GPP TS 23.379 [5]. The participating MCPTT function uses
media plane control (non-SIP) messages when taking part in the floor control
procedures as specified in clause 6, call over pre-established session as
specified in clause 9 and the use of MBMS Bearer procedures as specified in
clause 10. In the sequel the term \'controlling MCPTT function\' is used for
the entity which performs the controlling role of an MCPTT server.
The following subclauses describe the assumed internal structure of a
participating MCPTT function and the role of the participating function in the
floor control procedures, the call over pre-established session procedures and
the use of MBMS Bearer procedures.
#### 4.2.3.2 Internal structure of the participating MCPTT function
In the present document the internal structure of the participating MCPTT
function is illustrated in figure 4.2.3.2-1.
NOTE: The real internal structure of the participating MCPTT function is
implementation specific but a possible internal structure is shown to
illustrate the logic and the procedures.
Figure 4.2.3.2-1: Internal structure of the MCPTT client
All entities in the participating MCPTT function have a direct communication
interface to the application and signalling plane. The interface to the
application and signalling plane carries information about SIP session
initialisation and SIP session release, SDP content, etc.
The reference points MCPTT-3, MCPTT-4, MCPTT-7, MCPTT-8 and MCPTT-9 are
described in 3GPP TS 23.379 [5].
The media and floor control message distribution receives media control
messages and RTP media packets to and from the MCPTT client and the
controlling MCPTT function and the non-controlling MCPTT function. Media plane
control messages and RTP packets are forwarded as received when unicast
bearers are used. If MBMS bearers are used for floor control messages, MBMS
subchannel control messages and RTP media packets are sent to the MBMS bearer
management.
The MBMS bearer management receives floor control message and RTP media
packets from the media and floor control message distribution when floor
control messages and RTP media packets are sent over an MBMS bearer. MBMS
bearer management also generates MBMS subchannel control message. Floor
control message, RTP media packets and MBMS subchannel control messages are
sent to the GCS AS for distribution over an MBMS bearer. The GCS AS is outside
the scope of the present specification.
#### 4.2.3.3 The roles of the participating MCPTT function
##### 4.2.3.3.1 For the floor control procedures
When a floor control message or a media packet is received from an MCPTT
client, in the MCPTT-4 and MCPTT-7 reference points respectively, the
participating MCPTT function forwards it to the controlling MCPTT function
over MCPTT-3 reference point or to the application and signalling plane. When
a floor control message or a media packet is received from the controlling
MCPTT function, over MCPTT-3 reference point or the application and signalling
plane, for MCPTT clients which do not use an MBMS subchannel, the
participating MCPTT function forwards the floor control message to the MCPTT
client over the MCPTT-4 and MCPTT-7 reference points respectively. For MCPTT
clients which use an MBMS subchannel, for floor control messages directed to
all of these MCPTT clients and for media packets, the participating MCPTT
function forwards a single floor control message or a single media packet
using the MBMS subchannel over MCPTT-9 and MCPTT-8 reference points
respectively.
When MCPTT clients are listening to the MBMS subchannel multiple copies of the
same media packet destined to each individual MCPTT client are sent by the
controlling MCPTT function while the participating MCPTT function only
forwards one single media packet over the MBMS bearer. Any optimizations for
not sending the media packet from the controlling MCPTT function to all MCPTT
clients are out of scope of the present document.
When MCPTT clients are listening to the MBMS subchannel multiple copies of the
same Floor Idle message and Floor Taken message destined to each individual
MCPTT client are sent by the controlling MCPTT function while the
participating MCPTT function only forwards one single Floor Idle or Floor
Taken message over the MBMS bearer. Any optimizations for not sending the
Floor Idle or Floor Taken message from the controlling MCPTT function to all
MCPTT clients are out of scope of the present document.
The participating MCPTT function specifications related to the floor control
are specified in subclause 6.4 for unicast media and media plane control
delivery and in subclause 10.3.3 for MBMS delivery.
##### 4.2.3.3.2 For the call over pre-established session procedures
For a pre-established session between an MCPTT client and the participating
MCPTT function, when a call is initiated over this pre-established session,
the participating MCPTT function informs the originating MCPTT client the
acceptance or rejection decision of the controlling MCPTT function by sending
Connect or Disconnect messages respectively over MCPTT-4 reference point. When
a call initiation is accepted by the controlling server and informed to the
participating MCPTT function, the participating MCPTT function informs the
terminating MCPTT client which has a pre-established session the initiation of
this call, using Connect message over MCPTT-4 reference point.
When the controlling MCPTT function informs the participating MCPTT function
that a call which is setup over a pre-established session is released (either
over the MCPTT-3 reference point or from application and signalling plane),
the participating MCPTT function informs the MCPTT client the release of this
call using Disconnect message over MCPTT-4 reference point. By the end of the
release of the call the pre-established session is reserved for possible
future use.
When an Acknowledgment message is received, over the MCPTT-4 reference point,
as result of a message informing the MCPTT client for the initiation, the
rejection or the release related to a call conducted over a pre-established
session, the participating MCPTT function communicates the positive or
negative acknowledgment information towards the controlling MCPTT function
according to the procedures in 3GPP TS 24.379 [2] (either over MCPTT-3
reference point or from application and signalling plane).
The participating MCPTT function specifications related to the call setup over
pre-established session are in subclause 9.3.
##### 4.2.3.3.3 For the use of MBMS bearer procedures
In the initiation of a conversation, if the MBMS bearer management in the
participating MCPTT function decides to use an MBMS subchannel for the media
plane control messages and the media packets, the participating MCPTT function
sends a Map Group To Bearer message over the MCPTT-9 reference point, for
indicating the association information between the group identity of this call
and the TMGI of the MBMS bearer and additional parameters necessary for the
identification of this MBMS subchannel using the general purpose MBMS
subchannel already associated for the transmission of this information. In the
termination of a conversation the participating MCPTT function sends an Unmap
Group To Bearer message for terminating the association between the MBMS
subchannel in use for this conversation and the group identity.
The participating MCPTT function specifications related to the declaration of
the association between an MBMS bearer and related parameters and the MBMS
subchannel for media and media plane control are specified in subclause 10.3.2
and subclause 10.3.4.
### 4.2.4 Non-controlling MCPTT function of an MCPTT group
According to 3GPP TS 24.379 [2] subclause 5.3 the MCPTT server can act in a
non-controlling MCPTT function of an MCPTT group role. In the present document
the internal structure of the non-controlling MCPTT function of an MCPTT group
is illustrated in figure 4.2.4-1.
NOTE: The real internal structure of the MCPTT server is implementation
specific but a possible internal structure is shown to illustrate the logic
and the procedures.
Figure 4.2.4-1: Internal structure of the non-controlling MCPTT function
All entities in the non-controlling MCPTT function of an MCPTT group are
assumed to have a direct communication interface to the application and
signalling plane. The interface to the application and signaling plane carries
information about SIP session initialisation and SIP session release, SDP
content, etc.
The floor participant interface receives and transmits the floor control
messages from and to the MCPTT client via the participating MCPTT function or
non-controlling MCPTT function. The procedures are controlled by a state
machine described in subclause 6.5.5. One state machine is needed for each
MCPTT client participating in an MCPTT call. A non-controlling MCPTT function
is seen by the floor participant interface as an MCPTT client.
The floor control server interface is distributing floor control message to
and from the floor control server in the controlling MCPTT function or non-
controlling MCPTT function. The floor control server interface procedures are
described in subclause 6.5.4. One floor control server interface is needed per
MCPTT call.
The network media interface is receiving and sending media from and to the
associated MCPTT client via the participating MCPTT function or non-
controlling MCPTT function. The network media interface is out of scope of the
present document. One network media interface is needed for each MCPTT client
participating in an MCPTT call. A non-controlling MCPTT function is seen by
the network media interface as an MCPTT client.
The media distributor is controlled by the floor control server interface. The
media distributor is out of scope of the present document. One media
distributor is needed per MCPTT call.
The internal interfaces are assumed to transport the following type of
information.
1\. The interface between the network media interface and the floor
participant interface:
a. Indication that the network media interface has started to receive media
packets from the associated MCPTT client and requests from the floor
participant interface to forward received RTP packets towards the media
distributor or to stop forward RTP media packets to the media distributor.
NOTE: It is an implementation option whether an indication e.g. is sent for
every received RTP media packet or only when the first packet is received.
2\. The interface between the floor participant interface and the floor
control server interface:
a. Floor control messages to and from the associated floor participant. The
floor control message to the floor control server interface are limited to
floor control messages that can result in an action towards the floor control
server.
3\. The interface between the network media interface and the media
distributor:
a. RTP media packets to and from associated MCPTT clients. This interface is
out of scope of the present document.
4\. The interface between the floor control server interface and the media
distributor:
a. Requests to start or stop distributing media to participants in the MCPTT
call. Indication that the media distributor has started to receive media
packets from the network media interface associated with the MCPTT client with
the permission to send media.
## 4.3 The media plane control channel
### 4.3.1 General
The media plane control channel is used for transport of messages associated
with the floor control protocol, the pre-established session call control
protocol and the MBMS bearer management protocol, all specified in the present
document.
### 4.3.2 Control channel realization
The media plane control channel is realized by sending RTCP APP packets on top
of UDP/IP. RTCP APP packets are defined in IETF RFC 3550 [3]. The MCPTT
specific coding of the RTCP APP packets is defined in clause 8 of the present
document.
### 4.3.3 Establishing a media plane control channel
#### 4.3.3.1 General
The MCPTT client and the MCPTT server use the SDP offer/answer mechanism in
order to negotiate the establishment of the media plane control channel. The
SDP offer/answer procedures for negotiating media plane control channel
capabilities are specified in clause 14. The ABNF is defined in clause 12.
The media description (\"m=\" line) associated with the media plane control
channel shall have the values as described in table 4.3.3.1-1.
Table 4.3.3.1-1: Media plane control channel media description
Media description element Value
* * *
\ \"application\" \ RTCP port \ \"udp\" \ \"MCPTT\"
The port used for RTCP messages associated with the media plane control
channel shall be different than ports used for RTCP messages associated with
other \"m=\" lines (e.g. RTP) in the SDP.
NOTE 1: As RTCP is used to transport messages on the media plane control
channel, the \"m=\" line port value indicates an RTCP port. This is different
from cases where an \"m=\" line is associated with an RTP-based stream, and
the \"m=\" line port value indicates an RTP port.
NOTE 2: In case the media plane control channel uses a different IP address
than other media described in the SDP, a media plane control channel specific
\"c=\" line also needs to be associated with the \"m=\" line associated with
the media plane control channel.
The format of the optional SDP fmtp attribute, when associated with the media
plane control channel, is described in clause 12.
The example below shows an SDP media description for a media plane control
channel.
m=application 20032 udp MCPTT
a=fmtp:MCPTT mc_queueing;mc_priority=5;mc_granted
# 5 Entities
## 5.1 General
This clause associates the functional entities with the MCPTT roles described
in the stage 2 architecture document (see 3GPP TS 23.379 [5]).
## 5.2 MCPTT client
### 5.2.1 Introduction
To be compliant with the procedures in the present document, an MCPTT client
shall:
1\. support the role of an MCPTT client as specified 3GPP TS 23.379 [5];
2\. support the on-network MCPTT client role as specified in 3GPP TS 24.379
[2];
3\. support the off-network MCPTT client role as specified in 3GPP TS 24.379
[2]; and
4\. support media plane security as specified in clause 13.
To be compliant with the on-network procedures in the present document, an
MCPTT client shall:
1\. provide the role of a floor participant in on-network mode as specified in
subclause 5.2.2;
2\. provide the media mixer function as described in subclause 4.2.2 and
support the related procedures in subclause 6.2;
3\. when operating in systems that support MBMS functionality, provide the
MBMS interface as described in subclause 4.2.2 and support the related MBMS
subchannel control procedure as specified in subclause 10.3;
4\. provide PTT button events towards the on-network floor participant as
specified in subclause 6.2;
5\. provide means (sound, display, etc.) for indications towards the MCPTT
user as specified in subclause 6.2;
6\. support negotiating media plane control channel media level attributes as
specified in subclause 4.3; and
7\. support call setup control over pre-established session as specified in
subclause 9.2.
To be compliant with the off-network procedures in the present document, an
MCPTT client shall:
1\. provide the role of a floor participant in off-network mode as specified
in subclause 5.2.3;
2\. support the role of an off-network floor participant as specified in 3GPP
TS 23.379 [5] and in the present specification;
3\. provide the media mixer function as described in subclause 4.2.2 and
support the related procedures as specified in clause 7;
4\. provide PTT button events towards the off-network floor participant as
specified in clause 7; and
5\. provide means (sound, display, etc.) for indications towards the MCPTT
user as specified in clause 7.
### 5.2.2 Floor participant in on-network mode
To be compliant with the on-network procedures in the present document, a
floor participant in on-network mode shall:
1\. support the on-network floor control procedures as defined in 3GPP TS
23.379 [5];
2\. support acting as an on-network floor participant as specified in
subclause 6.2; and
3\. support the on-network mode floor control protocol elements as specified
in the clause 8.
A floor participant in on-network mode may:
1\. support queueing of floor requests as specified in subclause 6.2 and
subclause 4.1.1.2.
### 5.2.3 Floor participant in off-network mode
To be compliant with the off-network procedures in the present document, a
floor participant in off-network mode shall:
1\. support off-network floor control procedures as specified in 3GPP TS
23.379 [5];
2\. support acting as an off-network floor participant as specified in clause
7;
3\. support acting as an off-network floor control server as specified in
clause 7; and
4\. support the off-network mode floor control protocol elements in clause 8.
A floor participant in off-network mode may:
1\. support queueing of floor requests as specified in clause 7 and subclause
4.1.1.3.
## 5.3 Controlling MCPTT function
An MCPTT server providing the controlling MCPTT function shall:
1\. support the role of a controlling MCPTT function as specified in 3GPP TS
23.379 [5];
2\. support negotiating media plane control channel media level attributes as
specified in subclause 4.3;
3\. provide floor control arbitration logic with an interface to MCPTT clients
as described in subclause 4.2.1 and support the related procedures as
specified in subclause 6.3;
4\. provided a network media interface as described in subclause 4.2.1 and
support associated procedures as specified in subclause 6.3;
5\. provide a media distributor with a floor control interface towards the
MCPTT clients as described in subclause 4.2.1 and support associated
procedures in subclause 6.3;
6\. support the on-network mode floor control protocol elements as specified
in clause 8: and
7\. support media plane security as specified in clause 13.
An MCPTT server providing the controlling MCPTT function may:
1\. provide a floor request queue as described in subclause 4.2.1 and support
the related procedures as specified in subclause 6.3 and subclause 4.3.
## 5.4 Participating MCPTT function
An MCPTT server providing the participating MCPTT function shall:
1\. support the role of a participating MCPTT function as specified in 3GPP TS
23.379 [5];
2\. distribute floor control messages as described in subclause 6.3 and
support associated procedures as specified in subclause 6.4;
3\. support call setup control over a pre-established session as specified in
subclause 9.3;
4\. when operating in systems that support and employ MBMS functionality, act
as a GCS AS as specified in 3GPP TS 29.468 [6] and execute the related MBMS
subchannel control procedures as specified in subclause 10.2; and
5\. support media plane security as specified in clause 13.
## 5.5 Non-controlling MCPTT function
An MCPTT server providing the non-controlling MCPTT function of an MCPTT group
shall:
1\. support floor control involving groups from multiple MCPTT systems as
specified in 3GPP TS 24.379 [2];
2\. provide a floor control interface towards the controlling MCPTT function
as described in subclause 4.2.4 and support the related procedures as
specified in subclause 6.5;
3\. provide a media interface towards the controlling MCPTT function as
described in subclause 4.2.4 and support the related procedure as specified in
subclause 6.5;
4\. provide a media distributor as described in subclause 4.2.4 and the
related procedures as specified in subclause 6.5; and
5\. support media plane security as specified in clause 13.
# 6 On-network floor control
## 6.1 General
This clause provides:
1\. the floor participant procedures in subclause 6.2;
2\. the floor control server procedures in subclause 6.3;
3\. the participating MCPTT function floor control procedures in subclause
6.4; and
4\. the non-controlling MCPTT function of an MCPTT group in subclause 6.5.
If media plane security is required, the MCPTT client, the controlling MCPTT
function, the participating MCPTT function and the non-controlling MCPTT
function shall perform the additional procedures in clause 13.
## 6.2 Floor participant procedures
### 6.2.1 Floor participant procedures at MCPTT session initialization
Based on the negotiations during the call establishment specified in 3GPP TS
24.379 [2], a new instance of the \'Floor participant state transition diagram
for basic operation\', as specified in subclause 6.2.4, shall be created for
this call.
The SIP INVITE request sent by the application and signalling plane:
1\. shall be regarded an implicit floor request when an implicit floor request
is negotiated; and
2\. shall not be regarded as an implicit floor request in case of a rejoin to
an already on-going group call.
NOTE: The floor participant can negotiate the use of prioritization of the
Floor Request message. In that case, the floor participant can request
permission to send media at a priority level that is either the same as or
lower than the highest priority that was permitted to the participant in the
MCPTT call initialization. If a floor participant is authorized for pre-
emptive priority in the MCPTT call it is good practise to always request
permission to send RTP media packets at a priority level that is lower than
pre-emptive priority unless the user explicitly requests to pre-empt the
current RTP media packets\' sender. In any case pre-emptive priority will have
no effect for audio cut-in floor control.
### 6.2.2 Floor participant procedures at MCPTT call release
The MCPTT call release (whether it is initiated by the floor participant or
floor control server) is a two-step procedure.
> Step 1 The floor participant stops sending floor control messages and the
> MCPTT client stops sending RTP media packets.
>
> Step 2 When the application and signalling plane has determined that the
> MCPTT call is released, the corresponding instance of the \'Floor
> participant state transition diagram for basic operation\' as specified in
> subclause 6.2.4 is terminated and the floor participant releases all the
> used resources.
The user plane can initiate the release step 1, but the application and
signalling plane always initiates the release step 2.
### 6.2.3 Floor participant procedures at MCPTT call modification
Adding or removing media streams during an MCPTT call does not influence the
floor control procedures.
### 6.2.4 Floor participant state transition diagram for basic operation
#### 6.2.4.1 General
The floor participant shall behave according to the state diagram and the
state transitions specified in this subclause.
Figure 6.2.4.1-1 shows the state diagram for \'Floor participant state
transition diagram for basic operation\'.
Figure 6.2.4.1-1: Floor participant state transition diagram for basic
operation.
State details are explained in the following subclauses.
If an RTP media packet or a floor control message arrives in a state where
there is no specific procedure specified for the RTP media packets or the
received floor control message, the floor participant shall discard the floor
control message or the RTP media packet and shall remain in the current state.
NOTE 1: A badly formatted RTP packet or floor control message received in any
state is ignored by the floor participant and does not cause any change of the
current state.
NOTE 2: The state transition diagram is the same for groups configured for
audio cut-in floor control but the U: queued state should never be visited.
#### 6.2.4.2 State: \'Start-stop\'
##### 6.2.4.2.1 General
When a new instance of the \'Floor participant state transition diagram for
basic operation\' is initiated, before any floor control related input is
applied, the state machine is in \'Start-stop\' state. Similarly, when the
call is released the state machine shall return to the Start-Stop state.
##### 6.2.4.2.2 MCPTT call initiated, originating MCPTT user
When a call is initiated as described in 3GPP TS 24.379 [2], the floor
participant:
1\. shall create an instance of the \'Floor participant state transition
diagram for basic operation\';
2\. if the originating floor participant receives a floor control message
before it receives the SIP 200 (OK) response, shall store the floor control
message;
NOTE: The originating floor participant might receive a floor control message
before the SIP 200 (OK) response when initiating, joining or rejoining a call
because of processing delays of the SIP 200 (OK) response in the SIP core.
3\. if the established MCPTT call is a chat group call and the SIP INVITE
request is not an implicit floor request, shall enter the \'U: has no
permission\' state; and
4\. if for the established MCPTT call the SIP INVITE request is an implicit
floor request:
a. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
Request) to 1;
b. shall enter the \'U: pending Request\' state; and
c. if the floor participant has received and stored a floor control message
before the reception of the SIP 200 (OK) response, shall act as if the floor
control message was received in the \'U: pending Request\' state after
entering the \'U: pending Request\' state.
When the floor participant is rejoining an ongoing MCPTT call as described in
3GPP TS 24.379 [2] the floor participant shall enter the \'U: has no
permission\' state.
##### 6.2.4.2.3 MCPTT call established, terminating MCPTT user
When an MCPTT call is established, the terminating floor participant:
1\. shall create an instance of a \'Floor participant state transition diagram
for basic operation\'; and
2\. shall enter the \'U: has no permission\' state.
NOTE: From a floor participant perspective the MCPTT call is established when
the application and signalling plane sends the SIP 200 (OK) response.
#### 6.2.4.3 State: \'U: has no permission\'
##### 6.2.4.3.1 General
The floor participant is in this state when the floor participant is not
sending RTP media packets or is not waiting for a floor control message
response.
In this state RTP media packets and floor control messages can be received.
##### 6.2.4.3.2 Receive Floor Idle message (R: Floor Idle)
Upon receiving a Floor Idle message, the participant:
1\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'5\' (Floor Idle); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. may provide floor idle notification to the user, if it has not already
done so;
3\. shall stop the optional timer T103 (End of RTP media), if it is running;
and
4\. shall remain in the \'U: has no permission\' state.
##### 6.2.4.3.3 Receive Floor Taken message (R: Floor Taken)
Upon receiving the Floor Taken message, the floor participant:
1\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'2\' (Floor Taken); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. may provide a floor taken notification to the user;
3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call;
4\. should start the optional timer T103 (End of RTP media); and
5\. shall remain in the \'U: has no permission\' state.
##### 6.2.4.3.4 Receive RTP media packets (R: RTP media)
Upon receiving RTP media packets, the floor participant:
1\. shall request the MCPTT client to start rendering the received RTP media
packets;
2\. should restart/start the optional timer T103 (End of RTP media); and
3\. shall remain in the \'U: has no permission\' state.
NOTE: RTP media packets can be received from two sources when dual floor
control is applied by the floor control server (see subclause 6.3.6). The
MCPTT client can differentiate between the two sources using the SSRC in the
received RTP media packets. How the media mixer in the MCPTT client mixes the
two RTP media stream sources is out of scope of the present document.
##### 6.2.4.3.5 Send Floor Request message (PTT button pressed)
Upon receiving an indication from the user to request permission to send
media, the floor participant:
1\. shall send the Floor Request message toward the floor control server; The
Floor Request message:
a. if a different priority than the normal priority is required, shall include
the Floor Priority field with the priority not higher than negotiated with the
floor control server as specified in subclause 14.3.3; and
b. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall start timer T101 (Floor Request) and initialise counter C101 (Floor
Request) to 1; and
3\. shall enter the \'U: pending Request\' state.
##### 6.2.4.3.6 Timer T103 (End of RTP media) expired
On expiry of timer T103 (End of RTP media), the floor participant:
1\. may provide a floor idle notification to the user; and
2\. shall remain in the \'U: has no permission\' state.
#### 6.2.4.4 State: \'U: pending Request\'
##### 6.2.4.4.1 General
The floor participant is in this state when the floor participant is waiting
for response to a Floor Request message.
In this state the floor participant can receive RTP media packets and floor
control messages.
Timer T101 (Floor Request) is running in this state.
Timer T103 (End of RTP media) can be running in this state but there is no
action in this state if the timer expires. The timer is started as a
preparation for the state change that occurs once a response to the Floor
Request message is received.
##### 6.2.4.4.2 Receive Floor Granted message (R: Floor Granted)
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the floor participant:
1\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'1\' (Floor Granted); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. if the call is not an ambient listening call, shall provide floor granted
notification to the user, if not already done;
NOTE: Providing the floor granted notification to the user prior to receiving
the Floor Granted message is an implementation option.
3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call;
4\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
store an indication that the participant is overriding without revoke;
5\. shall stop the optional timer T103 (End of RTP media), if running;
6\. shall stop timer T101 (Floor Request); and
7\. shall enter the \'U: has permission\' state.
##### 6.2.4.4.3 Void
##### 6.2.4.4.4 Receive Floor Deny message (R: Floor Deny)
Upon receiving a Floor Deny message, the floor participant:
1\. if the first bit in the subtype of the Floor Deny message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'3\' (Floor Deny); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. shall provide floor deny notification to the user;
3\. may display the floor deny reason to the user using information in the
Reject Cause field;
4\. shall stop timer T101 (Floor Request); and
5\. shall enter the \'U: has no permission\' state.
##### 6.2.4.4.5 Timer T101 (Floor request) expired
On expiry of timer T101 (Floor Request) less than the upper limit of counter
C101 (Floor Request) times the timer is allowed to expire, the floor
participant:
1\. shall send a Floor Request message towards the floor control server. The
Floor Request message:
a. if a different priority than the normal priority is required, shall include
the Floor Priority field with the priority not higher than negotiated with the
floor control server as specified in subclause 14.3.3; and
b. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall restart timer T101 (Floor request) and increment counter C101 (Floor
Request) by 1; and
3\. shall remain in the \'U: pending Request\' state.
##### 6.2.4.4.6 Timer T101 (Floor Request) expired N times
When timer T101 (Floor Request) expires by the upper limit of counter C101
(Floor Request), the floor participant:
1\. shall provide a floor request timeout notification to the user; and
2\. shall enter the \'U: has no permission\' state.
##### 6.2.4.4.7 Receive RTP media packets (R: RTP Media)
Upon receiving RTP media packets, the floor participant:
1\. shall request the MCPTT client to start rendering the received RTP media
packets;
2\. should start the optional timer T103 (End of RTP media); and
3\. shall remain in the \'U: pending Request\' state.
##### 6.2.4.4.8 Send Floor Release message (PTT button released)
Upon receiving an indication from the user to release permission to send
media, the floor participant:
1\. shall send a Floor Release message towards the floor control server;
a. if the session is a broadcast call and if the session was established as a
normal call, shall include the Floor Indicator with the A-bit set to \'1\'
(Normal call);
2\. may include the first bit in the subtype of the Floor Release message set
to \'1\' (Acknowledgment is required) as described in subclause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall start timer T100 (Floor Release) and initialise counter C100 (Floor
Release) to 1;
4\. shall stop timer T101 (Floor Request); and
5\. shall enter the \'U: pending Release\' state.
##### 6.2.4.4.9 Receive Floor Queue Position Info message (R: Floor Queue
Position Info)
Upon receiving a Floor Queue Position Info message, the floor participant:
1\. if the first bit in the subtype of the Floor Queue Position Info message
is set to \'1\' (Acknowledgment is required) as described in subclause 8.3.2,
shall send a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'9\' (Floor Queue Position
Info); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. shall provide floor request queued response notification to the MCPTT
user;
3\. may provide the queue position and priority to the MCPTT user; and
4\. shall enter the \'U: queued\' state.
NOTE: For groups configured for audio cut-in floor control the floor
participant will never receive Floor Queue Position Info.
#### 6.2.4.5 State: \'U: has permission\'
##### 6.2.4.5.1 General
The floor participant is in this state when the MCPTT client is permitted to
send RTP media. In this state the floor participant can receive floor control
messages.
In this state, the floor participant can release permission to send RTP media
at any time, even before sending any media.
The MCPTT client could have already buffered media when it enters this state.
NOTE: If the floor participant was queued, the floor participant requests a
confirmation from the MCPTT user before start sending media. If confirmed, the
media sending starts otherwise the permission to send media is released.
##### 6.2.4.5.2 Send RTP media packets (RTP media)
Upon receiving indication from the MCPTT client that encoded voice is received
from the user or if encoded voice is already buffered the floor participant:
1\. shall request the MCPTT client to start forward encoded voice to the MCPTT
server; and
2\. shall remain in the \'U: has permission\' state.
##### 6.2.4.5.3 Send Floor Release message (PTT button released)
Upon receiving an indication from the user to release the permission to send
RTP media, the floor participant:
1\. shall send a Floor Release message towards the floor control server. The
Floor Release message:
a. may include the first bit in the subtype of the Floor Release message set
to \'1\' (acknowledgement is required) as specified in subclause 8.2.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
b. if the session is a broadcast call and if the session was established as a
normal call, shall include the Floor Indicator with the A-bit set to \'1\'
(Normal call); and
c. if the Floor Granted message included the G-bit set to \'1\' (Dual floor),
shall include the Floor Indicator with the G-bit set to \'1\' (Dual floor);
2\. shall remove the indication that the participant is overriding without
revoke if this indication is stored;
3\. shall remove the indication that the participant is overridden without
revoke if this indication is stored;
4\. shall start timer T100 (Floor Release) and initialize counter C100 (Floor
Release) to 1; and
5\. shall enter the \'U: pending Release\' state.
##### 6.2.4.5.4 Receive Floor Revoke message (R: Floor Revoke)
Upon receiving a Floor Revoke message, the floor participant:
1\. shall inform the user that the permission to send RTP media is being
revoked;
2\. may give information to the user about the reason for revoking the
permission to send media;
3\. shall request the media mixer in the MCPTT client discard any remaining
buffered RTP media packets and to stop forwarding encoded voice to the MCPTT
server;
4 if the G-bit in the Floor Indicator is set to \'1\' (Dual floor):
a. shall send a Floor Release message. In the Floor Release message:
i. shall include the Floor Indicator with the G-bit set to \'1\' (Dual floor);
and
ii. may set the first bit in the subtype to \'1\' (Acknowledgment is required)
as described in subclause 8.3.2;
5 if the G-bit in the Floor Indicator is set to \'0\' (not Dual floor):
a. shall send a Floor Release message. In the Floor Release message:
i. shall include the Floor Indicator with the G-bit set to \'0\' (not Dual
floor); and
ii. may set the first bit in the subtype to \'1\' (Acknowledgment is required)
as described in subclause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
6\. shall start timer T100 (Floor Release) and initialize counter C100 (Floor
Release) to 1; and
7\. shall enter the \'U: pending Release\' state.
##### 6.2.4.5.5 Receive Floor Granted message (R: Floor Granted)
Upon receiving a Floor Granted message from the floor control server, the
floor participant:
1\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'1\' (Floor Granted); and
b. shall include the Source field set to \'0\' (the floor participant is the
source); and
2\. shall remain in the \'U: has permission\' state.
##### 6.2.4.5.6 Receive RTP media packets (R: RTP Media)
Upon receiving RTP media packets the floor participant:
1\. shall request the MCPTT client, based on configuration, either to continue
rendering or stop the rendering and start storing the received RTP media
packets if an indication is stored that the participant is overriding without
revoke;
NOTE: The configuration whether to continue rendering or to start storing the
incoming RTP media is out of the scope of the present document.
2\. shall request the MCPTT client to render the received RTP media packets if
an indication is stored that the participant is overridden without revoke; and
3\. shall remain in the \'U: has permission\' state.
##### 6.2.4.5.7 Receive Floor Idle message (R: Floor Idle)
Upon receiving a Floor Idle message from the floor control server, the floor
participant:
1\. if an indication that the participant is overriding without revoke is
stored:
a. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
i. shall include the Message Type field set to \'1\' (Floor Idle); and
ii. shall include the Source field set to \'0\' (the floor participant is the
source);
b. shall remove the indication that the participant is overriding without
revoke; and
c. shall remain in the \'U: has permission\' state; and
2\. if the G-bit in the Floor Indicator is set to \'1\' (Dual Floor) and an
indication that the participant is overridden without revoke is stored:
a. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
i. shall include the Message Type field set to \'1\' (Floor Idle); and
ii. shall include the Source field set to \'0\' (the floor participant is the
source);
b. shall remove the indication that the participant is overridden without
revoke; and
c. shall remain in the \'U: has permission\' state.
##### 6.2.4.5.8 Receive Floor Taken message (R: Floor Taken)
Upon receiving a Floor Taken message with the G-bit in the Floor Indicator set
to \'1\' (Dual Floor) the floor participant:
1\. shall inform the user that the call is overridden without revoke;
2\. shall store an indication that the participant is overridden without
revoke; and
3\. shall remain in the \'U: has permission\' state.
#### 6.2.4.6 State: \'U: pending Release\'
##### 6.2.4.6.1 General
The floor participant is in this state when the floor participant is waiting
for response to a Floor Release message.
In this state the floor participant can receive floor control messages and RTP
media packets.
Timer T100 (Floor Release) is running can be running in this state.
##### 6.2.4.6.2 Timer T100 (Floor Release) expired
On expiry of timer T100 (Floor Release) less than the configurable number of
the upper limit of counter C100 (Floor Release) times, the floor participant:
1\. shall send a Floor Release message towards the floor control server;
2\. may set the first bit in the subtype of the Floor Release message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall restart timer T100 (Floor Release) and increment counter C100 (Floor
Release) by 1; and
4\. shall remain in state \'U: pending Release\'.
##### 6.2.4.6.3 Timer T100 (Floor release) expired N times
When timer T100 (Floor Release) expires by the upper limit of counter C100
(Floor Release) times, the floor participant:
1\. shall enter the \'U: has no permission\' state.
##### 6.2.4.6.4 Receive Floor Idle message (R: Floor Idle)
Upon receiving a Floor Idle message, the floor participant:
1\. if the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'5\' (Floor Idle); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. may provide a floor idle notification to the MCPTT user;
3\. if the Floor Indicator field is included and the B-bit set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call;
4\. shall stop timer T100 (Floor Release);
5\. if the session is not a broadcast group call or if the A-bit in the Floor
Indicator field is set to \'1\' (Normal call), shall enter the \'U: has no
permission\' state; and
6\. if the session was initiated as a broadcast group call:
a. shall indicate to the MCPTT client the media transmission is completed; and
b shall enter the \'Releasing\' state.
##### 6.2.4.6.5 Receive Floor Taken message (R: Floor Taken)
Upon receiving a Floor Taken message, the floor participant:
1\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'2\' (Floor Taken); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. may provide floor taken notification to the user;
3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call;
4\. should start the optional timer T103 (End of RTP media);
5\. shall stop timer T100 (Floor Release); and
6\. shall enter the \'U: has no permission\' state.
##### 6.2.4.6.6 Receive RTP media packets (R: RTP Media)
Upon receiving an indication from the MCPTT client that RTP media packets are
received, the floor participant:
1\. shall request the MCPTT client to start rendering the RTP media packets;
2\. should start the optional timer T103 (End of RTP media);
3\. shall stop timer T100 (Floor Release); and
4\. shall enter the \'U: has no permission\' state.
##### 6.2.4.6.7 Receive Floor Revoke message (R: Floor Revoke)
Upon receiving a Floor Revoke message, the floor participant:
1\. may give information to the user that permission to send RTP media is
being revoked;
2\. may inform the user of the reason contained in the Floor Revoke message;
and
3\. shall remain in the \'U: pending Release\' state.
##### 6.2.4.6.8 Receive Floor Granted message (R: Floor Granted)
Upon receiving a Floor Granted message, the floor participant:
1\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'1\' (Floor Granted); and
b. shall include the Source field set to \'0\' (the floor participant is the
source); and
2\. shall remain in the \'U: pending Release\' state.
#### 6.2.4.7 In any state
##### 6.2.4.7.1 General
This subclause describes the actions to be taken in all states defined for the
basic state diagram with the exception of the \'Start-stop\' state and the
\'Releasing\' state.
##### 6.2.4.7.2 Receive MCPTT call release -- step 1 (R: MCPTT call release -
1)
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane when the MCPTT call is going to be released or when the floor
participant is leaving the MCPTT call, the floor participant:
1\. shall stop sending floor control messages;
2\. shall request the MCPTT client to stop sending RTP media packets; and
3\. shall enter the \'Releasing\' state.
##### 6.2.4.7.3 Receive a Floor Control message with a Floor Indicator field
(R: Floor Indicator)
Upon receiving any Floor Control message containing the Floor Indicator field,
the floor participant:
1\. may provide notifications based on the Floor Indicator field to the user.
NOTE: Any change of state due to receipt of the Floor Indicator field is
described in other parts of this specification.
#### 6.2.4.8 State: \'Releasing\'
##### 6.2.4.8.1 General
The floor participant is in this state while waiting for the application and
signalling plane to finalize the disconnection of an MCPTT call.
##### 6.2.4.8.2 Receive MCPTT call release -- step 2 (R: MCPTT call release -
2)
Upon receiving an MCPTT call release step 2 request from the application and
signalling, the floor participant:
1\. shall release all resources including any running timers associated with
the MCPTT call; and
2\. shall enter the \'Start-stop\' state and terminate the current instance of
the \'Floor control state machine -- basic\'.
#### 6.2.4.9 State: \'U: queued\'
##### 6.2.4.9.1 General
The floor participant uses this state when a Floor Request message has been
queued by the floor control server, and is awaiting the Floor Granted message.
In this state, the MCPTT client can receive RTP Media packets and the floor
participant can send and receive floor control messages.
The timer T104 (Floor Queue Position Request) can be running in this state.
##### 6.2.4.9.2 Receive RTP media packets (R: RTP media)
Upon receiving an indication from the media mixer in the MCPTT client that the
media mixer is receiving RTP media packets, the floor participant:
1\. shall request to the media mixer to start rendering received RTP media
packets;
2\. should restart timer T103 (End of RTP media); and
3\. shall remain in the \'U: queued\' state.
NOTE: RTP media packets can be received from two sources when dual floor
control is applied by the floor control server (see subclause 6.3.6). The
MCPTT client can differentiate between the two sources using the SSRC in the
received RTP media packets. How the media mixer in the MCPTT client mixes the
two RTP media stream sources is out of scope of the present document.
##### 6.2.4.9.3 Receive Floor Taken message (R: Floor Taken)
Upon receiving a Floor Taken message, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'2\' (Floor Taken); and
b. shall include the Source field set to \'0\' (the floor participant is the
source); and
3\. should start the optional timer T103 (End of RTP media); and
4\. shall remain in the \'U: queued\' state.
##### 6.2.4.9.4 Receive Floor Granted message (R: Floor Granted)
Upon receiving a Floor Granted message, the floor participant:
1\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'1\' (Floor Granted); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. shall provide a floor granted notification to the MCPTT user;
3\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call;
4\. shall stop timer T104 (Floor Queue Position Request), if running;
5\. shall start timer T132 (Queued granted user action);
6\. shall stop the optional timer T103 (End of RTP media), if running, and if
associated to a participant for which the previously received Floor Taken did
not include a Floor Indicator field with the G-bit set to \'1\' (Dual floor);
7\. shall indicate the user that the floor is granted; and
8\. shall remain in the \'U: queued\' state.
##### 6.2.4.9.5 Receive Floor Deny message (R: Floor Deny)
Upon receiving a Floor Deny message, the floor participant:
1\. if the first bit in the subtype of the Floor Deny message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'3\' (Floor Deny); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. shall provide floor deny notification to the MCPTT user;
3\. may display the deny reason to the user using information in the Reject
Cause field;
4\. shall stop timer T104 (Floor Queue Position Request), if running; and
5\. shall enter the \'U: has no permission\' state.
##### 6.2.4.9.6 Send Floor Release message (PTT button released)
Upon receiving an indication from the MCPTT user to release the queued floor
request, the floor participant:
1\. shall send a Floor Release message: The Floor Release message:
a. may include the Floor Indicator field changing a broadcast group call to a
normal call;
2\. may set the first bit in the subtype of the Floor Release message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall start timer T100 (Floor Release) and initialise counter C100 (Floor
Release) to 1;
4\. shall stop timer T104 (Floor Queue Position Request), if running;
5\. shall stop timer T132 (queued request granted user action); and
6\. shall enter the \'U: pending Release\' state.
##### 6.2.4.9.7 Receive Floor Queue Position Info message (R: Floor Queue
Position Info)
Upon receiving a Floor Queue Position Info message, the floor participant:
1\. if the first bit in the subtype of the Floor Queue Position Info message
is set to \'1\' (Acknowledgment is required) as described in subclause 8.3.2,
shall send a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'9\' (Floor Queue Position
Info); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. if the message indicates that the request has been queued or if a request
for the queue position was sent, the floor participant:
a. may provide the queue position and priority (if available) to the MCPTT
user;
3\. shall stop the timer T104 (Floor Queue Position Request), if running; and
4\. shall remain in the \'U: queued\' state.
##### 6.2.4.9.8 Receive Floor Idle message (R: Floor Idle)
Upon receiving a Floor Idle message, the floor participant:
1\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'5\' (Floor Idle); and
b. shall include the Source field set to \'0\' (the floor participant is the
source);
2\. may provide a floor idle notification to the MCPTT user;
3\. shall stop timer T104 (Floor Queue Position Request), if running; and
4\. shall enter the \'U: has no permission\' state.
##### 6.2.4.9.9 Send Floor Queue Position Request message (S: Floor Queue
Position Request)
Upon receipt of an indication from the MCPTT client to request the queue
position, the floor participant:
1\. shall send the Floor Queue Position Request message;
2\. shall start timer T104 (Floor Queue Position Request) and initialize
counter C104 (Floor Queue Position Request) to 1; and
3\. remain in the \'U: queued\' state.
##### 6.2.4.9.10 Timer T104 (Floor Queue Position Request) expired
On expiry of timer T104 (Floor Queue Position Request) less than the upper
limit of C104 (Floor Queue Position Request) times, the floor participant:
1\. shall send a Floor Queue Position Request message towards the floor
control server;
2\. shall restart timer T104 (Floor Queue Position Request) and increment
counter C104 (Floor Queue Position Request) by 1; and
3\. shall remain in the \'U: queued\' state.
##### 6.2.4.9.11 Timer T104 (Floor Queue Position Request) expired N times
When timer T104 (Floor Queue Position Request) expires by the upper limit of
counter C104 (Floor Queue Position Request) times, the floor participant:
1\. shall provide a floor queued timeout to the MCPTT client;
2\. send the Floor Release message;
3\. may set the first bit in the subtype of the Floor Queue Position message
to \'1\' (Acknowledgment is required) as described in subclause 8.3.2, and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
4\. shall enter the \'U: pending Release\' state.
##### 6.2.4.9.12 User indication for accept of pending request
Upon receiving an indication from the user that the user wants to send media
and the timer T132 (Queued granted user action) is running, the floor
participant:
1\. shall stop timer T132 (queued request granted user action); and
2\. shall enter \'U: has permission\' state.
##### 6.2.4.9.13 Timer T132 (Queued granted user action) expires
Upon expiry of timer T132 (Queued granted user action) the floor participant:
1\. shall send Floor Release message;
2\. may indicate the user that the floor is no more available;
3\. may set the first bit in the subtype of the Floor Release message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
4\. shall enter \'U: has no permission\' state.
## 6.3 Floor control server procedures
### 6.3.1 General
The floor control server arbitration logic in the floor control server shall
support the procedures in subclauses 6.3.2 and 6.3.3 and shall behave
according to the floor control server state transition diagram for \'general
floor control operation\' in subclause 6.3.4.
The floor control interface towards the MCPTT client in the floor control
server shall behave according to the floor control server state transition
diagram for \'basic floor control operation towards the floor participant\' as
specified in subclause 6.3.5.
### 6.3.2 Controlling MCPTT function procedures at MCPTT call initialization
#### 6.3.2.1 General
The subclause 6.3.2.2 describes the initial procedures when a new SIP session
is establishing a group session or a private session with floor control.
The subclause 6.3.2.3 describes the procedures when a non-controlling MCPTT
function switches from the non-controlling mode to the controlling mode.
#### 6.3.2.2 Initial procedures
When an MCPTT call is established a new instance of the floor control server
state machine for \'general floor control operation\' is created.
For each MCPTT client added to the MCPTT call, a new instance of the floor
control server state machine for \'basic floor control operation towards the
floor participant\' is added.
If the optional \"mc_queueing\" feature is supported and has been negotiated
as specified in clause 14, the floor control server could queue the implicit
floor control request for the media-floor control entity.
The initial SIP INVITE request or SIP REFER request to establish an MCPTT chat
group call or to rejoin an ongoing MCPTT call is not handled as an implicit
floor control request message by the floor control server unless explicitly
stated in the SIP INVITE request or in the SIP REFER request.
The permission to send media to the inviting MCPTT client due to implicit
floor control request is applicable to both confirmed indication and
unconfirmed indication.
When the first unconfirmed indication is received from the invited
participating MCPTT function (see 3GPP TS 24.379 [2]) the floor control server
optionally can give an early indication to send RTP media packets, to the
inviting MCPTT client.
If an early indication to send RTP media packets is given to the inviting
MCPTT client, the floor participant is granted the permission to send media
and the MCPTT server buffers RTP media packets received from the MCPTT client
at least until the first invited MCPTT client accepts the invitation or until
the RTP media packet buffer maximum limit is exceeded.
If the MCPTT server does not support or does not allow media buffering then an
early indication to send RTP media packets is not given to the inviting MCPTT
client, the floor participant is granted the permission to send media when the
first invited MCPTT client accepts the media.
Before the floor control server sends the first floor control message in the
MCPTT call, the floor control server has to assign itself a SSRC identifier to
be included in media floor control messages and quality feedback messages if
the MCPTT server is supporting that option. A suitable algorithm to generate
the SSRC identifier is described in IETF RFC 3550 [3].
The floor participant and the floor control server can negotiate the maximum
priority level that the floor participant is permitted to request. The floor
control server can pre-empt the current sender based on the negotiated maximum
priority level that the floor participant is permitted to request and the
priority level included in the Floor Request message.
NOTE: The maximum priority level that a floor participant can use is
negotiated as specified in subclause 14.3.3 and is based on group
configuration data retrieved by the controlling MCPTT function from the group
management server as described in 3GPP TS 24.481 [12] and service
configuration data retrieved by the controlling MCPTT function from the
configuration management server as described in 3GPP TS 24.484 [13].
For groups configured for audio cut-in floor control, pre-empting of the
current sender is not according to priority. Each new floor request results in
the floor being revoked from the current talker and being granted to the new
requesting talker.
The floor participant and the floor control server can negotiate queueing of
floor requests using the \"mc_queueing\" fmtp attribute as described in clause
14. If queueing is supported and negotiated, the floor control server queues
the floor control request if a Floor Request message is received when another
floor participant has the floor and the priority of the current speaker is the
same or higher. Queueing is not permitted for groups configured for audio cut-
in floor control.
#### 6.3.2.3 Switching from a non-controlling MCPTT function mode to a
controlling MCPTT function mode
When the MCPTT server switches from the non-controlling MCPTT function mode to
controlling MCPTT function mode a new instance of the floor control server
state machine for \'general floor control operation\' is created.
For each MCPTT client in the MCPTT call a new instance of the floor control
server state machine for \'basic floor control operation towards the floor
participant\' is added.
Any floor request in the passive floor request queue is moved to the active
floor request queue.
NOTE: The passive floor request queue is a floor request queue used by the
non-controlling MCPTT function as specified in subclause 6.5.4 to monitor
floor request sent by floor participants controlled by the non-controlling
MCPTT function.
### 6.3.3 MCPTT floor control procedures at MCPTT call release
When an MCPTT client leaves an MCPTT call and the MCPTT call remains ongoing
with the other MCPTT clients, the floor control server follows a two-step
procedure.
> Step 1 The MCPTT server stops sending floor control messages and RTP media
> packets to the MCPTT client leaving the MCPTT call and, the MCPTT server
> discards floor control messages and RTP media packets received from the
> MCPTT client leaving the MCPTT call.
>
> Step 2 When the application and signalling plane has determined that the
> MCPTT call with this floor participant has been released, the corresponding
> instance of the floor control server state machine for \'basic floor control
> operation towards the floor participant\' is released.
When an MCPTT call is released, the floor control server follows a two-step
procedure.
> Step 1 The MCPTT server stops sending floor control messages and RTP media
> packets to all floor participants in the MCPTT call.
>
> Step 2 When the application and signalling plane has determined that the
> MCPTT call has been released, the corresponding instance of the floor
> control server state machine for \'general floor control operation\' are
> also terminated, along with any \'basic floor control operation towards the
> floor participant\' state machines for the floor participants of this call.
The floor control server state machine for general floor control operation
initiates the MCPTT call release depending on the release policy specified in
3GPP TS 24.379 [2].
### 6.3.4 Floor control server state transition diagram for general floor
control operation
#### 6.3.4.1 General
The floor control server arbitration logic in the floor control server shall
behave according to the state diagram and state transitions specified in this
subclause.
Figure 6.3.4.1-1 shows the general floor control operation states (G states)
and the state transition diagram.
Figure 6.3.4.1-1: Floor control server state transition diagram for \'general
floor control operation\'
The floor control arbitration logic in the floor control server shall keep one
instance of the \'general floor control operation\' state machine per MCPTT
call.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following subclauses the floor control
arbitration logic in the floor control server:
1\. shall discard the floor control message;
2\. shall request the media distributor in the MCPTT server to discard any
received RTP media packet; and
3\. shall remain in the current state.
State details are explained in the following subclauses.
#### 6.3.4.2 State: \'Start-stop\'
##### 6.3.4.2.1 General
When a new instance of the \'general floor control operation\' state machine
is initiated, before any floor control related input is applied, the state
machine is in \'Start-stop\' state. Similarly when the call is released the
state machine shall return to the \'Start-stop\' state or the related MCPTT
call is released.
##### 6.3.4.2.2 MCPTT call initialization
When an MCPTT call is initiated as specified in 3GPP TS 24.379 [2] and
1\. if a confirmed indication is required and at least one invited MCPTT
client has accepted the invitation;
2\. if a confirmed indication is not required; or
3\. if the initialised MCPTT call is a temporary group session;
NOTE: A MCPTT group call is a temporary group session when the \ element is present in the \ element as specified in
3GPP TS 24.481 [12].
then the floor control arbitration logic in the floor control server:
1\. shall create an instance of the \'general floor control operation\' state
machine;
2\. shall wait for the \'basic floor control operation towards the floor
participant\' to be initialized before continuing the following steps;
3\. when the \'basic floor control operation towards the floor participant\'
state machine is initialized and the initialised session is not a temporary
group session:
a. if the \"mc_granted\" fmtp attribute is not negotiated as specified in
clause 14 or this is an ambient listening call:
i. if the floor control server is granting an implicit floor request at MCPTT
call establishment, shall act as if a Floor Request message was received and
perform the actions specified in subclause 6.3.4.3.3; or
ii. if the floor control server is not granting an implicit floor request at
MCPTT call establishment, shall enter the\'G: Floor Idle\' state as specified
in subclause 6.3.4.3.2; or
b. if the \"mc_granted\" fmtp attribute is negotiated as specified in clause
14 and this is not an ambient listening call, shall enter the \'G: Floor
Taken\' state as specified in subclause 6.3.4.4.2; and
4\. if the \'basic floor control operation towards the floor participant\'
state machine is initialized and the initialised session is a temporary group
session, shall enter the \'G: Initialising\' state as specified in the
subclause 6.3.4.8.1.
#### 6.3.4.3 State: \'G: Floor Idle\'
##### 6.3.4.3.1 General
The floor control arbitration logic in the floor control server is in this
state when no MCPTT user currently has permission to send media.
Timer T4 (Inactivity) and timer T7 (Floor Idle) can be running when the floor
control arbitration logic in the floor control server is in this state.
##### 6.3.4.3.2 Enter the \'G: Floor Idle\' state
When entering this state from any state except the \'Start-stop\' state and if
no MCPTT client negotiated support of queueing floor requests as described in
clause 14, and the state machine specified in subclause 6.3.6 does not exist,
the floor control arbitration logic in the floor control server:
1\. if there is a Track Info field associated with the floor control server
state transition diagram for \'general floor control operation\' stored, shall
remove the Track Info field from the storage;
2\. if the active floor request queue is empty the floor control server:
a. shall send Floor Idle message to all floor participants. The Floor Idle
message:
i. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
b. shall start timer T7 (Floor Idle) and initialise counter C7 (Floor Idle) to
1;
c. shall start timer T4 (Inactivity); and
d. shall set the general state to the \'G: Floor Idle\' state; and
3\. if the active floor request queue is not empty the floor control server:
a. shall select a queued floor request from the top of the active floor
request queue;
b. shall remove that queued floor request from the active floor request queue;
c. if the queued floor request includes a Track Info field, shall store the
Track Info field and associate it with the floor control server state
transition diagram for \'general floor control operation\'; and
d. shall enter the \'G: Floor Taken\' state as specified in the subclause
6.3.4.4.2 with respect to that floor participant.
When entering this state from any state except the \'Start-stop\' state and
the state machine specified in subclause 6.3.6 exists, the floor control
arbitration logic in the floor control server:
1\. if there is a Track Info field associated with the floor control server
state transition diagram for \'general floor control operation\' stored, shall
remove the Track Info field from the storage;
2\. shall send Floor Idle message to all floor participants which are
configured to listen to the overridden participant. The Floor Idle message:
a. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. shall send Floor Taken message to floor participants which are configured
to listen only to the overridden participant. The Floor Taken message:
a. if privacy is not requested, shall include the granted MCPTT user's
(overriding participant) MCPTT ID in the Granted Party\'s Identity field;
b. shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4\. shall set the general state to the \'G: Floor Taken\' state; and
5\. shall send the termination instruction to the state machine for dual floor
control operation.
##### 6.3.4.3.3 Receive Floor Request message (R: Floor Request)
Upon receiving a floor request message (from a floor participant that is
permitted to make a floor request) the floor control arbitration logic in the
floor control server:
1\. shall reject the request if one of the following conditions is fulfilled:
a. if there is only one MCPTT client in the MCPTT call; and
b. \ element is present in the \ element as
specified 3GPP TS 24.481 [12] for the associated floor participant;
2\. if the floor request is rejected the floor control server:
a. shall send the Floor Deny message. The Floor Deny message:
i. shall include in the Reject Cause field the \ value:
A. cause #3 (Only one participant), if there is only one MCPTT client in the
MCPTT call; or
B. cause #5 (Receive only), if the \ element is present
in the \ element as specified in 3GPP TS 24.481 [12] for the associated
floor participant;
ii. may include an additional text string explaining the reason for rejecting
the floor request in the \ value of the Reject Cause field; and
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field;
b. shall remain in the \'G: Floor Idle\' state; and
3\. if the floor request is granted the floor control server:
a. shall stop timer T4 (Inactivity);
b. shall stop timer T7 (Floor Idle);
c. shall store the SSRC of floor participant granted the permission to send
media until the floor is released associated to that floor request;
d. if a Track Info field is included in the Floor Request message, shall store
the received Track Info field, and
e. shall enter the \'G: Floor Taken\' state as specified in the subclause
6.3.4.4.2.
##### 6.3.4.3.4 Timer T7 (Floor Idle) expired
On expiry of timer T7 (Floor Idle) the floor control arbitration logic in the
floor control server:
1\. shall restart timer T7 (Floor Idle) and increment counter C7 (Floor Idle)
by 1 if counter C7 (Floor Idle) has not reached its upper limit;
2\. shall send a Floor Idle message to all floor participants in the MCPTT
call if counter C7 (Floor Idle) has not reached its upper limit. The Floor
Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1; and
3\. shall remain in the \'G: Floor Idle\' state.
##### 6.3.4.3.5 Timer T4 (Inactivity) expired
On expiry of timer T4 (Inactivity) the floor control arbitration logic in the
floor control server based on a configurable service provider policy either:
1\. shall indicate to the application and signalling plane that timer T4
(Inactivity) has expired;
2\. if the application and signalling planes initiates MCPTT call release,
shall enter the \'Releasing\' state; and
3\. if the application and signalling planes do not initiate MCPTT call
release:
a. should restart the T4 (Inactivity) timer; and
b. shall remain in the \'G: Floor Idle\' state.
##### 6.3.4.3.6 Receive an implicit floor request (R: Implicit floor request)
Upon receiving an implicit floor request due to an upgrade to an emergency
group call or due to an upgrade to imminent peril call, the floor control
arbitration logic in the floor control server:
1\. shall reject the request if there is only one MCPTT client in the MCPTT
call;
2\. if the floor request is rejected the floor control server:
a. shall send the Floor Deny message. The Floor Deny message:
i. shall include in the Reject Cause field the \ value cause #3
(Only one participant); and
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
b. shall remain in the \'G: Floor Idle\' state; and
3\. if the floor request is granted the floor control server:
a. shall stop the timer T4 (Inactivity);
b. shall stop the timer T7 (Floor Idle);
c. shall store the SSRC of floor participant granted the permission to send
media until the floor is released associated to that floor request; and
d. shall enter the \'G: Floor Taken\' state as specified in the subclause
6.3.4.4.2.
#### 6.3.4.4 State: \'G: Floor Taken\'
##### 6.3.4.4.1 General
The floor control arbitration logic in the floor control server uses this
state when it has permitted one of the MCPTT clients in the MCPTT call to send
media.
Timer T1 (End of RTP media) can be running when the floor control server is in
this state.
Timer T2 (End talking) can be running when the floor control server is in this
state.
Timer T20 (Floor Granted) is running to guarantee reliable delivery of the
Floor Granted message, if the granted floor request was queued.
##### 6.3.4.4.2 Enter the \'G: Floor Taken\' state
When entering this state the floor control arbitration logic in the floor
control server:
1\. shall send a Floor Granted message to the floor participant to which the
floor is granted. The Floor Granted message:
a. shall include the value of timer T2 (Stop talking)in the Duration field;
b. shall include the granted priority in the Floor priority field;
c. if a Track Info field associated with the floor control server state
transition diagram for \'general floor control operation\' is stored, shall
include the stored Track Info field; and
d. if a group call is a broadcast group call, system call, emergency call, an
imminent peril call or a temporary group session, shall include the Floor
Indicator field with appropriate indications;
NOTE: If the call is an ambient listening call and the ambient listening call
type is remote-initiated, then the floor participant to which the floor is
granted is the terminating floor participant of the call. Otherwise the floor
is granted to the participant which requested the floor.
2\. shall start timer T20 (Floor Granted) if the floor request was queued and
initialise the counter C20 (Floor Granted) to 1;
3\. shall send Floor Taken message to all other floor participants. The Floor
Taken message:
a. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
b. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1;
c. if the session is a broadcast group call or an ambient listening call,
shall include the Permission to Request the Floor field set to \'0\';
d. if the session is not a broadcast group call, may include the Permission to
Request the Floor field set to \'1\'; and
e. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4\. shall start timer T1 (End of RTP media); and
5\. shall enter the \'G: Floor Taken\' state.
##### 6.3.4.4.3 Timer T1 (End of RTP media) expired
On expiry of timer T1 (End of RTP media), the floor control arbitration logic
in the floor control server:
1\. shall stop the timer T2 (Stop talking); if running;
2\. shall stop timer T20 (Granted re-send), if running;
3\. shall request the media distributor in the MCPTT server to stop
distributing RTP media packets (with the exception of RTP media packets
already in the buffer (if RTP media buffering is ongoing)) to other MCPTT
clients, and
4\. shall enter the \'G: Floor Idle\' state as specified in the subclause
6.3.4.3.2.
##### 6.3.4.4.4 Timer T2 (Stop talking) expired
On expiry of timer T2 (Stop talking) the floor control arbitration logic in
the floor control server:
1\. shall stop timer T1 (End of RTP media);
2\. shall include the Reject Cause field with the \ value set to
#2 (Media burst too long) in the Floor Revoke message sent in subclause
6.3.4.5.2; and
3\. shall enter the \'G: pending Floor Revoke\' state as specified in the
subclause 6.3.4.5.2.
##### 6.3.4.4.5 Receive RTP media packets (R: RTP media)
Upon receiving an indication from the media distributor in the MCPTT server
that RTP media packets are received from the permitted MCPTT client, the floor
control arbitration logic in the floor control server:
1\. if the session is not an ambient listening call, shall start timer T2
(Stop talking), if not running;
2\. shall restart timer T1 (End of RTP media);
3\. shall stop timer T20 (Floor Granted), if running;
4\. shall instruct the media distributor to forward the RTP media packets to
MCPTT clients according to local policy; and
NOTE: If dual floor control is ongoing as described in subclause 6.3.6, the
list of floor participants that receive the overriding, overridden, or both
transmissions is based on configuration.
5\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.6 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message the floor control arbitration logic in
the floor control server:
1\. shall request the media distributor in the MCPTT server to stop forwarding
RTP media packets;
2\. shall stop timer T2 (Stop talking), if running;
3\. shall stop timer T20 (Granted re-send), if running; and
4\. shall enter the \'G: Floor Idle\' state as specified in the subclause
6.3.4.3.2.
##### 6.3.4.4.7 Receive Floor Request message with pre-emptive priority (R:
pre-emptive Floor Request)
NOTE 1: This procedure is also invoked from the subclause 6.3.5.4.4.
On receipt of a floor request message with effective priority indicating pre-
emptive priority, and if the effective priority of the floor participant with
permission to send media is not the pre-emptive priority, or if the group is
configured for audio cut-in, the floor control arbitration logic in the floor
control server:
1\. based on local policy, select one of the following options:
a. revoke the current speaker; or
b. allow media from both the current speaker and from the participant now
requesting floor with a pre-emptive floor priority;
NOTE 2: If the group is configured for audio cut-in, media is allowed only for
the participant now requesting the floor.
2\. if revoking current speaker is selected:
a. shall stop timer T1 (End of RTP media), if running;
b. shall stop timer T20 (Floor Granted), if running;
c. shall include a Reject Cause field with the \ value set to #4
(Media Burst pre-empted) in the Floor Revoke message sent in subclause
6.3.4.5.2;
d. shall enter the \'G: pending Floor Revoke\' state as specified in the
subclause 6.3.4.5.2;
e. shall insert the floor participant into the active floor request queue to
the position in front of all queued requests, if not inserted yet or update
the position of the floor participant in the active floor request queue to the
position in front of all other queued requests, if already inserted; and
f. shall send a Floor Queue Position Info message to the requesting floor
participant, if negotiated support of queueing of floor requests as specified
in clause 14. The Floor Queue Position Info message:
i. include the queue position and floor priority in the Queue Info field; and
ii. if the Floor Request message included a Track Info field, shall include
the received Track Info field; and
3\. if allow media from both the current speaker and from the participant now
requesting floor with a pre-emptive priority is selected:
a. shall perform the actions specified in the subclause 6.3.6.2.2
##### 6.3.4.4.8 Receive Floor request message from permitted floor participant
(R: Floor Request)
Upon receiving a floor request message from the floor participant that has
been granted permission to send media, the floor control arbitration logic in
the floor control server:
1\. shall send a Floor Granted message to the previously granted floor
participant. The Floor Granted message:
a. shall include the value of timer T2 (Stop talking) in the Duration field;
b. shall include the granted priority in the Floor priority field; and
c. if the Floor Request message included a Track Info field, shall include the
received Track Info field; and
2\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.9 Timer T20 (Floor Granted) expired
On expiry of timer T20 (Floor Granted), the floor control arbitration logic in
the floor control server:
1\. shall send a Floor Granted message to the granted floor participant if
counter C20 (Floor Granted) has not reached its upper limit: The Floor Granted
message:
a. shall include the value of timer T2 (Stop talking) in the Duration field;
b. shall include the granted priority in the Floor priority field; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. shall start timer T20 (Floor Granted) and increment counter C20 (Floor
Granted) by 1 if counter C20 (Floor Granted) has not reached its upper limit;
and
3\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.10 Timer T20 (Floor Granted) expired N times
When timer T20 (Floor Granted) expires and counter C20 (Floor Granted) reaches
its upper limit, the floor control arbitration logic in the floor control
server:
1\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.11 Permitted MCPTT client release (R: client release)
If the floor control server receives an indication from the floor control
interface towards the MCPTT client that the MCPTT client has started to
disconnect from the MCPTT call, the floor control arbitration logic in the
floor control server:
1\. shall enter the \'G: Floor Idle\' state as specified in the subclause
6.3.4.3.2.
##### 6.3.4.4.12 Receive an implicit floor request (R: Implicit floor request)
Upon receiving an implicit floor request due to an upgrade to an emergency
group call or due to an upgrade to imminent peril call, the floor control
arbitration logic in the floor control server:
1\. shall stop timer T1 (End of RTP media), if running;
2\. shall stop timer T20 (Floor Granted), if running;
3\. shall set the Reject Cause field in the Floor Revoke message to #4 (Media
Burst pre-empted);
4\. shall enter the \'G: pending Floor Revoke\' state as specified in the
subclause 6.3.4.5.2;
5\. shall insert the floor participant into the active floor request queue to
the position in front of all queued requests, if not inserted yet or update
the position of the floor participant in the active floor request queue to the
position in front of all other queued requests, if already inserted; and
6\. shall send a Floor Queue Position Info message to the requesting floor
participant, if negotiated support of queueing floor requests as specified in
clause 14. The Floor Queue Position Request message:
a. shall include the queue position and floor priority in the Queue Info
field; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications.
#### 6.3.4.5 State: \'G: pending Floor Revoke\'
##### 6.3.4.5.1 General
The floor control arbitration logic in the floor control server uses this
state after having sent a Floor Revoke message to the permitted floor
participant.
Timer T3 (Stop talking grace) is running when the floor control arbitration
logic in the floor control server is in this state. If the group is configured
for audio cut-in floor control the value of timer T3 shall be considered to be
zero.
In this state the MCPTT server forwards RTP media packets to the other floor
participants in the MCPTT call.
##### 6.3.4.5.2 Enter the \'G: pending Floor Revoke\' state
When entering this state the floor control arbitration logic in the floor
control server:
1\. shall send the Floor Revoke message to the permitted floor participant.
The Floor Revoke message:
a. shall include the reason for sending the Floor Revoke message in the
\ value in the Reject Cause field; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. shall start timer T3 (Stop talking grace); and
3\. shall set the general state to \'G: pending Floor Revoke\'.
##### 6.3.4.5.3 Receive RTP media packets (R: RTP media)
Upon receiving an indication from the media distributor in the MCPTT server
that RTP media packets are received from the permitted floor participant the
floor control server:
1\. shall restart timer T1 (End of RTP media);
NOTE 1: If the upper limit for timer T3 (Stop talking grace) is less than the
upper limit of timer T1 (End of RTP media) then timer T1 (End of RTP media)
will not expire.
2\. shall instruct the media distributor to forward the RTP media packets to
MCPTT clients according to local policy; and
NOTE 2: If dual floor control is ongoing as described in subclause 6.3.6, the
list of floor participants that receive the overriding, overridden, or both
transmissions is based on configuration.
3\. shall remain in the \'G: pending Floor Revoke\' state.
##### 6.3.4.5.4 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message the floor control arbitration logic in
the floor control server:
1\. shall request the media distributor in the MCPTT server to stop forwarding
RTP media packets;
2\. shall stop timer T1 (End of RTP media) , if running;
3\. shall stop timer T3 (Stop talking grace); and
4\. enter the \'G: Floor Idle\' state as specified in the subclause 6.3.4.3.2.
##### 6.3.4.5.5 Timer T3 (Stop talking grace) expired
On expiry of timer T3 (Stop talking grace) the floor control arbitration logic
in the floor control server:
1\. shall indicate to the interface towards the MCPTT client that the general
state machine is now \'G: Floor Idle\'; and
2\. shall enter the \'G: Floor Idle\' state as specified in the subclause
6.3.4.3.2.
##### 6.3.4.5.6 Timer T1 (End of RTP media) expired
On expiry of timer T1 (End of RTP media) the floor control arbitration logic
in the floor control server:
1\. shall stop timer T3 (Stop talking grace); and
2\. shall enter the \'G: Floor Idle\' state as specified in the subclause
6.3.4.3.2.
#### 6.3.4.6 In any state
##### 6.3.4.6.1 General
This subclause describes the actions to be taken in all states defined for the
general state diagram with the exception of the \'Start-stop\' state.
##### 6.3.4.6.2 Receive MCPTT call release - 1
This subclause is used by the floor control arbitration logic in the floor
control server when an MCPTT call is released.
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane the floor control arbitration logic in the floor control
server:
1\. shall request the media distributor in the MCPTT server to stop sending
RTP media packets MCPTT clients; and
2\. shall enter the \'Releasing\' state.
##### 6.3.4.6.3 Receive an instruction to merge group calls (R: Merge)
Upon receiving an instruction from the application and signalling plane to
merge the ongoing group call with other group calls, the floor control server:
1\. shall perform the actions in subclause 6.5.2.3;
2\. shall enter the \'Start-stop\' state.
#### 6.3.4.7 State: \'Releasing\'
##### 6.3.4.7.1 General
The floor control arbitration logic in the floor control server uses this
state while waiting for the application and signalling plane to finalize the
disconnection of an MCPTT call.
##### 6.3.4.7.2 Receive MCPTT call release - 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control arbitration logic in the floor control
server:
1\. shall release all resources reserved in the media plane including the
instances used for the \'Floor control server state transition diagram for
general floor control operation\', and \'Floor control server state transition
diagram for basic floor control operation towards the floor participant\'
state machines and any running timers associated with the state machines; and
2\. shall enter the \'Start-stop\' state.
#### 6.3.4.8 State: \'G: Floor Initialising\'
##### 6.3.4.8.1 General
The floor control arbitration logic in the floor control server uses this
state while waiting for all invited constituent MCPTT groups to reply with a
final SIP response.
There are no timers running in this state. The floor control arbitration logic
is relying on SIP timers in the signalling and application plane.
##### 6.3.4.8.2 Enter the \'G: Initialising\' state
When entering this state the floor control arbitration logic:
1\. shall set the general state to the \'G: Initialising\' state.
##### 6.3.4.8.3 Receiving a floor request from a constituent MCPTT group (R:
mcptt-floor-request)
Upon receiving an indication from the application and signalling plane that a
floor request is received from one of the invited constituent MCPTT groups in
an application/vnd.3gpp.mcptt-floor-request+xml MIME body, the floor control
arbitration logic:
1\. shall cache the application/vnd.3gpp.mcptt-floor-request+xml MIME body;
and
2\. remain in the \'G: Initialising\' state.
##### 6.3.4.8.4 All final SIP responses received (R: final SIP responses)
Upon receiving an indication from the application and signalling plane that
all invited constituent MCPTT groups have sent a final SIP response, the floor
control arbitration logic:
1\. if at least one application/vnd.3gpp.mcptt-floor-request+xml MIME body
exists with the \ element set to \"general\":
a. shall select the floor participant with the highest priority as described
in subclause 4.1.1.4:
i. among the cached application/vnd.3gpp.mcptt-floor-request+xml MIME bodies
with the \ element set to \"general\"; and
ii. the floor participant initialising the temporary group session as
described in subclause 4.1.1.4, if the floor participant initialising the
temporary group session negotiated implicit floor request as specified in
clause 14;
b. shall send a Floor Revoke message to all floor participants in the cached
application/vnd.3gpp.mcptt-floor-request+xml MIME body with the \
element set to \"general\" that are not granted the permission to send media.
The Floor Revoke message:
i. shall include the \ value set to \'4\' (Media Burst pre-
empted) in the Reject Cause field;
ii. shall include information taken from the \ element in the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the
\ element set to \"general\" in the Track Info field; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
c. if the floor participant selected to be granted the floor is one of invited
constituent MCPTT groups:
i. shall convert the \ element to a format of a Track Info field
and cache the Track Info field associated with the floor control server state
transition diagram for \'general floor control operation\'; and
ii. shall enter the \'G: Taken\' state as specified in the subclause 6.3.4.4.2
using the selected floor participant as the requesting floor participant;
2\. if at least one application/vnd.3gpp.mcptt-floor-request+xml MIME body
exists with the \ element set to \"dual\":
a. shall select the floor participant with the highest priority as described
in subclause 4.1.1.4 among the cached application/vnd.3gpp.mcptt-floor-
request+xml MIME bodies with the \ element set to \"dual\"; and
b. shall send a Floor Revoke message to all floor participants in the cached
application/vnd.3gpp.mcptt-floor-request+xml MIME body with the \
element set to \"dual\" that are not granted the permission to send media. The
Floor Revoke message:
i. shall include the \ value set to \'4\' (Media Burst pre-
empted) in the Reject Cause field;
ii. shall include information taken from the \ element in the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the
\ element set to \"general\" in the Track Info field;
iii. shall include the Floor Indicator with the G-bit set to \'1\' (Dual
floor);
iv. shall convert the \ element to a format of a Track Info field
and cache the Track Info field associated with floor control server state
transition diagram for \'dual floor control operation\'; and
v. shall enter the \'D: Floor Taken\' state as specified in the subclause
6.3.6.3.2 using the selected floor participant as the requesting floor
participant; and
3\. if no cached application/vnd.3gpp.mcptt-floor-request+xml MIME with the
\ element set to \"general\" body exists:
a. if an implicit floor request is negotiated as described in clause 14 when
the temporary group session was established, shall enter the \'G: Taken\'
state as specified in the subclause 6.3.4.4.2; and
b. if an implicit floor request is not negotiated as described in clause 14
when the temporary group session was established, shall enter the \'G: Idle\'
state as specified in the subclause 6.3.4.3.2.
### 6.3.5 Floor control server state transition diagram for basic floor
control operation towards the floor participant
#### 6.3.5.1 General
The floor control interface towards the MCPTT client in the floor control
server shall behave according to the state diagram and state transitions
specified in this subclause.
Figure 6.3.5.1-1 shows the states and state transitions for an associated
floor participant in the floor control server.
Figure 6.3.5.1-1: Floor control server state transition diagram for basic
floor control operation towards the floor participant
The floor control interface towards the MCPTT client in the floor control
server shall create one instance of the \'basic floor control operations\'
state machine towards the MCPTT client for every floor participant served by
the floor control server as follows:
1\. For pre-arranged group call in case of an originating MCPTT call, the
\'basic floor control operation towards the floor participant\' state machine
shall be created when the MCPTT server sends the SIP 200 (OK) response towards
the originating MCPTT client.
2\. For pre-arranged group call in case of a terminating MCPTT call, the
\'basic floor control operation towards the floor participant\' state machine
shall be created when the floor control server receives the SIP 200 (OK)
response.
3\. For chat group call the \'basic floor control operation state machine
towards the floor participant\' shall be created when the MCPTT server sends
the SIP 200 (OK) response to the received initial SIP INVITE request.
The floor participant associated to the \'basic floor control operation
towards the floor participant\' state machine is here referred to as the
\"associated floor participant\".
The external inputs to the state machine are:
1\. directives coming from the floor control arbitration logic;
2\. floor messages sent by the floor participants;
3\. media; and
4\. in certain cases, SIP messages used for call handling.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following subclauses, the floor control
interface towards the MCPTT client in the floor control server:
1\. shall discard the floor control message;
2\. shall request the network media interface in the MCPTT server to discard
any received RTP media packet; and
3\. shall remain in the current state.
State details are explained in the following subclauses.
#### 6.3.5.2 State: \'Start-stop\'
##### 6.3.5.2.1 General
When a new instance of the \'basic floor control operations towards the floor
participant\' state machine is created, before any floor control related input
is applied, the state machine is in the \'Start-stop\' state. Similarly, when
the call is released the state machine shall return to the Start-Stop state.
An association between the floor control server and a floor participant in the
MCPTT client is created, when the state machine is created; and
1\. in case of an originating MCPTT call, when the MCPTT server sends the SIP
200 (OK) response to the originating MCPTT client; and
2\. in case of a terminating MCPTT call, when the floor control server
receives the SIP 200 (OK) response sent from the terminating MCPTT client.
##### 6.3.5.2.2 SIP Session initiated
When a SIP Session is established and if:
1\. the session is not a temporary group call session;
2\. the session is a temporary group call session and the associated floor
participant is an invited MCPTT client (i.e. not a constituent MCPTT group);
or
3\. the session is not an ambient listening call;
then:
NOTE 1: A MCPTT group call is a temporary group session when the \ element is present in the \ element as specified in
3GPP TS 24.481 [12].
1\. if an MCPTT client initiates an MCPTT call with an implicit floor request,
and the MCPTT call does not exist yet, the floor control interface towards the
MCPTT client in the floor control server:
a. shall initialize a general state machine as specified in subclause
6.3.4.2.2; and
NOTE 2: In the subclause 6.3.4.2.2 the \'general floor control operation\'
state machine will continue with the initialization of the \'general floor
control operation\' state machine.
b. shall enter the state \'U: permitted\' as specified in the subclause
6.3.5.5.2;
2\. if the associated MCPTT client rejoins an ongoing MCPTT call without an
implicit floor request or initiates or joins a chat group call without an
implicit floor request or attempts to initiate an already existing MCPTT call
without an implicit floor request, and
a. if an MCPTT call already exists but no MCPTT client has the permission to
send a media, the floor control interface towards the MCPTT client in the
floor control server:
i. should send a Floor Idle message to the MCPTT client. The Floor Idle
message:
A. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the state \'U: not permitted and Floor Idle\' as specified in
the subclause 6.3.5.5.2;
b. if an MCPTT call is initiated, the floor control interface towards the
MCPTT client in the floor control server:
i. shall enter the state \'U: not permitted and Floor Idle\' as specified in
the subclause 6.3.5.5.2; and
ii. shall initialize a general state machine as specified in subclause
6.3.4.2.2; and
NOTE 3: In the subclause 6.3.4.2.2 the general state machine will continue
with the initialization of the general state machine.
c. if another MCPTT client has the permission to send a media, the floor
control interface towards the MCPTT client in the floor control server:
i. should send a Floor Taken message to the MCPTT client. The Floor Taken
message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
B. shall include a Message Sequence Number field with a \ value increased with 1;
C. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
D. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\'; and
E. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2;
3\. if the associated floor participant attempts to initiate an already
existing MCPTT call with an implicit floor request, and
a. if no MCPTT client has the permission to send media, the floor control
interface towards the MCPTT client in the floor control server:
i. shall processes the implicit floor request as if a Floor Request message
was receive as specified in subclause 6.3.4.3.3; and
ii. shall enter the state \'U: permitted\' as specified in the subclause
6.3.5.5.2;
b. if the MCPTT client negotiated support of queueing floor requests as
specified in clause 14 and if another MCPTT client has the permission to send
media, the floor control interface towards the MCPTT client in the floor
control server:
i. shall set the priority level to the negotiated maximum priority level that
the MCPTT client is permitted to request, except for pre-emptive priority,
when high priority is used;
NOTE 4: The maximum floor priority the floor participant is permitted to
request is negotiated in the \"mc_priority\" fmtp attribute as specified in
clause 14.
NOTE 5: The initial implicit floor request will not result in pre-emption when
an MCPTT client is joining an ongoing MCPTT call. If the MCPTT client wants to
pre-empt the current MCPTT client that is sending media, an explicit floor
request with pre-emptive floor priority is required.
ii. shall insert the MCPTT client into the active floor request queue to the
position immediately following all queued floor requests with the same floor
priority;
iii. shall send a Floor Queue Position Info message to the MCPTT client. The
Floor Queue Position Info message:
A shall include the queue position and floor priority in the Queue Info field;
and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
iv. should send a Floor Queue Position Info message with the updated status to
the MCPTT clients in the active floor request queue which negotiated queueing
of floor requests as specified in clause 14, which have requested the queue
status, whose queue position has been changed since the previous Floor Queue
Position Info message and which is not the joining MCPTT client. The Floor
Queue Position Info message:
A shall include the queue position and floor priority in the Queue Info field;
and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
v. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2; and
c. if the MCPTT client did not negotiate queueing of floor requests and if
another MCPTT client has the permission to send a media, the floor control
interface towards the MCPTT client in the floor control server:
i. shall send a Floor Taken message to the MCPTT client. The Floor Taken
message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
B. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1;
C. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
D. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\'; and
E. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2; and
4\. if the MCPTT client is invited to the MCPTT call and
a. if another MCPTT client has permission to send a media, the floor control
interface towards the MCPTT client in the floor control server:
i. should send a Floor Taken message to the MCPTT client. The Floor Taken
message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
B. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1;
C. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
D. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\'; and
E. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2; and
b. if no other MCPTT client has the permission to send a media; the floor
control interface towards the MCPTT client in the floor control server:
i. should send a Floor Idle message to the MCPTT client. The Floor Idle
message:
A. shall include a Message Sequence Number field with a \ value increased with 1; and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the subclause 6.3.5.3.2.
When a SIP Session is established and if the session is a temporary group call
session and,
1\. if the associated floor participant is a constituent MCPTT group; or
2\. if the associated floor participant is the initiator of the temporary
group session;
then the floor control interface towards the MCPTT client:
1\. shall initialize a general state machine as specified in subclause
6.3.4.2.2, if not already initiated; and
2\. shall enter the \'U: not permitted and initiating\' state as specified in
subclause 6.3.5.10.2.
When a SIP Session is established and if the session is an ambient listening
call session then the floor control interface towards the MCPTT client:
1\. if the floor is granted to the associated floor participant
a. shall forward the \"Floor Granted\" message to the associated floor
participant; and
b. shall enter the state \'U: permitted\' as specified in the subclause
6.3.5.5.2; and
2\. if the floor is not granted to the associated floor participant
a. shall forward the \"Floor Taken\" message to the associated floor
participant; and
b. shall enter the state \'U: not permitted Floor Taken\' as specified in the
subclause 6.3.5.4.2.
#### 6.3.5.3 State: \'U: not permitted and Floor Idle\'
##### 6.3.5.3.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state when the associated floor participant is not permitted
to send media.
##### 6.3.5.3.2 Enter state \'U: not permitted and Floor Idle\'
When entering this state the floor control interface towards the MCPTT client
in the floor control server:
1\. if a Track Info field is stored, shall remove the Track Info field from
the storage; and
2\. shall set the state for the associated floor participant to \'U: not
permitted and Floor Idle\'.
##### 6.3.5.3.3 Send Floor Taken message (S: Floor Taken)
When a Floor Taken message is received from the floor control server
arbitration logic, the floor control interface towards the MCPTT client in the
floor control server:
1\. shall forward the Floor Taken message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2, and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2.
##### 6.3.5.3.4 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message from the associated floor participant,
the floor control interface towards the MCPTT client in the floor control
server:
1\. if the session is not a broadcast group call or if the session is a
broadcast group call and the associated floor participant is the initiator of
the broadcast group call, shall forward the Floor Request message to the floor
control server arbitration logic;
NOTE 1: The Floor Request message can contain a Floor Indicator field
indicating that the floor request is an attempt to upgrade a group call to a
broadcast group call. If the floor control arbitration logic accepts the floor
request, the ongoing group call will be upgraded accordingly by the Floor
Granted message and, for other participants, by the Floor Taken message.
NOTE 2 Initiating a broadcast group call is done in the application and
signalling plane using SIP. Initiating or upgrading a call to an emergency
call or an imminent peril call is done in the application and signalling plane
using SIP.
2\. if the session is a broadcast group call and the associated floor
participant is not the initiator of the broadcast group call, shall send a
Floor Deny message to the associated floor participant. The Floor Deny
message:
a. shall include in the Reject Cause field the \ value cause #5
(Receive only);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
c. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 3: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall remain in the \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.5 Send Floor Grant message (S: Floor Grant)
When a Floor Granted message is received from the floor control arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the floor control server:
1\. shall forward the Floor Granted messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Granted message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the state \'U: permitted\' as specified in subclause
6.3.5.5.2.
##### 6.3.5.3.6 Send Floor Deny message (S: Floor Deny)
When a Floor Deny message is received from the floor control arbitration logic
in the MCPTT server, the floor control interface towards the MCPTT client in
the floor control server:
1\. shall forward the Floor Deny messages to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.7 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client in the floor control
server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. shall send a Floor Idle message to the associated floor participant. The
Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1;
b. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. if a Track Info field is included in the Floor Release message, shall use
the topmost \ value and the SSRC in the received Floor
Release message to check if the floor participant has a queued floor request;
4\. if a no Track Info field is included in the Floor Release message, shall
use the SSRC in the received Floor Release message to check if the floor
participant has a queued floor request;
5 if the floor participant has a floor request in the queue, shall remove the
queued floor request from the queue; and
6\. shall remain in the state \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.8 Receive RTP media packets (R: media)
Upon receiving an indication from the network media interface that RTP media
packets are received with payload from the associated floor participant and if
Floor Release message was received in the previous \'U: permitted\' state, the
floor control interface towards the MCPTT client in the floor control server:
NOTE: Reception of unauthorized RTP media packets can only happen if the
associated floor participant is in an MCPTT client. If the associated floor
participant is a floor control server interface in a non-controlling MCPTT
function of an MCPTT group, the unauthorized RTP media packets are handled in
the non-controlling MCPTT function.
1\. shall request the network media interface in the MCPTT server to not
forward the received RTP media packets to the media distributor in the MCPTT
server;
2\. shall send a Floor Revoke message to the associated floor participant. The
Floor Revoke message:
a. shall include the Reject Cause field with the \ value set to
#3 (No permission to send a Media Burst); and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall enter the \'U: not permitted but sends media\' state as specified in
the subclause 6.3.5.7.2.
##### 6.3.5.3.9 Receive an implicit floor request (R: Implicit floor request)
When an ongoing session is upgraded to an emergency group call and when the
application and signalling plane indicates that a subsequent SDP offer
included the \"mc_implicit_request\" fmtp attribute as described in clause 14,
the floor control interface towards the MCPTT client in the floor control
server:
1\. shall indicate to the floor control server arbitration logic that an
implicit floor request is received due to an upgrade to an emergency group
call; and
2\. shall remain in the \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.10 Send Floor Idle message (S: Floor Idle)
When receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the floor control server:
1\. shall forward the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Idle\' state.
#### 6.3.5.4 State \'U: not permitted and Floor Taken\'
##### 6.3.5.4.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state when another MCPTT client (i.e. not the associated
floor participant) has been given permission to send media.
In this state RTP media packets received from the media distributor in the
MCPTT server are forwarded to the associated floor participant by the network
media interface in the MCPTT server.
##### 6.3.5.4.2 Enter state \'U: not permitted and Floor Taken\'
When entering this state the floor control server:
1\. if a Track Info field is stored, shall remove the Track Info field from
the storage; and
2\. shall set the state to \'U: not permitted and Floor Taken\'.
##### 6.3.5.4.3 Send Floor Idle message (S: Floor Idle)
When receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the floor control server:
1\. shall forward the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. if an indication is stored that the participant is listening to media from
two sources,
a. shall remain in the \'U: not permitted and Floor Taken\' state; and
b. shall remove the indication that a participant is listening to media from
two sources; and
4\. if an indication is not stored that the participant is listening to media
from two sources, shall enter the \'U: not permitted and Floor Idle\' state as
specified in the subclause 6.3.5.3.2.
##### 6.3.5.4.4 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message from the associated floor participant,
if the group is configured for audio cut-in floor control, the floor control
interface towards the MCPTT client in the floor control server:
1\. shall forward the Floor Request message to the floor control server
arbitration logic; and
2\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Request message, without a Floor Indicator field or
with the Floor Indicator field included where the D-bit (Emergency call) and
the E-bit (Imminent peril call) are set to \'0\', from the associated floor
participant, and if the MCPTT client did not negotiate queueing of floor
requests or did not include a priority in the \"mc_priority\" fmtp attribute
as specified in clause 14, the floor control interface towards the MCPTT
client in the floor control server:
1\. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
c. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 1: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Request message from the associated floor participant
and the session is a broadcast group call or an ambient listening call, the
floor control interface towards the MCPTT client in the floor control server:
1\. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #5
(Receive only);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Request message from the associated floor participant
and if the MCPTT client negotiated support of queueing of floor requests or
included a floor priority in the \"mc_priority\" or both as described in
specified in clause 14 and according to local policy, the floor control
interface towards the MCPTT client in the floor control server:
1\. shall determine the effective priority level as described in subclause
4.1.1.4 by using the following parameters:
a. the floor priority shall be:
i. the lower of the floor priority included in Floor Request message and the
negotiated maximum floor priority that the MCPTT client is permitted to
request, if the MCPTT client negotiated floor priority \"mc_priority\" and
floor priority is included in the Floor Request message;
ii. the receive only floor priority, if the MCPTT client negotiated floor
priority in the \"mc_priority\" fmtp attribute and if the negotiated maximum
floor priority that the MCPTT client is permitted to request is \"receive
only\";
iii. the default priority, if the MCPTT client negotiated floor priority in
the \"mc_priority\" fmtp attribute, if the negotiated maximum floor priority
that the MCPTT client is permitted to request is not receive only and if the
floor priority is not included in the Floor Request message; and
iv. the default priority, if the MCPTT client did not negotiate floor priority
in the \"mc_priority\" fmtp attribute; and
b. the type of the call shall be
i. if the Floor Indicator field is included in the message and the D-bit
(Emergency call bit) is set to \'1\', determined to be an emergency call;
ii. if the Floor Indicator field is included in the message and the E-bit
(Imminent peril call) is set to \'1\', determined to be an imminent peril
call; and
iii. if the Floor Indicator field is not included in the message or the Floor
Indicator field is included and neither the D-bit (Emergency call bit) nor the
E-bit (Imminent peril call) is set to \'1\', determined to be a normal call;
2\. if the effective priority is \"receive only\", the floor control interface
towards the MCPTT client in the floor control server:
a. shall send a Floor Deny message to the floor participant. The Floor Deny
message:
i. shall include in the Reject Cause field the \ value cause #5
(Receive only) ;
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iv. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state;
3\. if
a. a Track Info field is included in the Floor Request message, shall use the
topmost \ value and the SSRC in the received Floor
Request message to check if the floor participant has a queued floor request;
or
b. a Track Info field is not included in the Floor Request message, shall use
the SSRC in the received Floor Request message to check if the floor
participant has a queued floor request;
4\. if the floor participant already has a queued floor request with the same
effective priority level, the floor control interface towards the MCPTT client
in the floor control server:
a. shall send a Floor Queue Position Info message to the requesting MCPTT
client, if the MCPTT client negotiated support of queueing of floor requests
as specified in clause 14. The Floor Queue Position Info message:
i. shall include the queue position and floor priority in the Queue Info
field;
ii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state
5\. if the effective priority level is pre-emptive and there are no other pre-
emptive requests in the active floor request queue and the effective priority
level of the current MCPTT client with permission to send a media is not the
pre-emptive priority, the floor control interface towards the MCPTT client in
the floor control server:
a. shall forward the Floor Request message to the floor control server
arbitration logic indicating that a Floor Request message with pre-emptive
priority is received; and
b. shall remain in the \'U: not permitted and Floor Taken\' state
NOTE 3: The Floor control server arbitration logic initiates revoking the
permission to send media towards the current MCPTT client with the permission
to send media as specified in the subclause 6.3.4.4.7;
6\. if the MCPTT client did not negotiate support of queueing of floor
requests as specified in clause 14, the effective priority level is pre-
emptive and either other pre-emptive request is queued or the effective
priority level of the current MCPTT client with permission to send a media is
the pre-emptive priority, the floor control interface towards the MCPTT client
in the floor control server:
a. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
i. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iv. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state;
7\. if the MCPTT client did not negotiate \"queueing\" and the effective
priority level is not pre-emptive, the floor control interface towards the
MCPTT client in the floor control server:
a. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
i. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iv. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state; and
8\. if the MCPTT client negotiated support of queueing of floor requests as
specified in clause 14 and the effective priority level is not pre-emptive,
the floor control interface towards the MCPTT client in the floor control
server:
a. shall insert the MCPTT client into the active floor request queue, if not
inserted yet, or update the position of the MCPTT client in the active floor
request queue, if already inserted, to the position immediately following all
queued requests at the same effective priority level;
b. the floor control server shall send a Floor Queue Position Info message to
the floor participant. The Floor Queue Position Info message:
i. shall include the queue position and floor priority in the Queue Info
field;
ii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
c. shall remain in the \'U: not permitted and Floor Taken\' state; and
d. may set the first bit in the subtype of the Floor Queue Position message to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2.
NOTE 4: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
##### 6.3.5.4.5 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant
and if the MCPTT client did not negotiate support of queueing of floor
requests or included a floor priority in the \"mc_priority\" fmtp attribute as
specified in clause 14, the floor control interface towards the MCPTT client
in the floor control server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. shall send a Floor Taken message to the associated floor participant. The
Floor Taken message:
a. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
b. shall include a Message Sequence Number field with a \ value increased with 1;
c. shall include the Permission to Request the floor field set to \'0\', if
the floor participants are not allowed to request the floor;
d. if the Floor Release message included a Track Info field, shall include the
received Track Info field;
e. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 1: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
f. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Release message from the associated floor participant
and if the MCPTT client negotiated support of queueing of floor requests as
specified in clause 14, the floor control interface towards the MCPTT client
in the floor control server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if
a. a Track Info field is included in the Floor Release message, shall use the
topmost \ value and the SSRC in the received Floor
Release message to check if the floor participant has a queued floor request;
or
b. if a Track Info field is not included in the Floor Release message, shall
use the SSRC in the received Floor Release message to check if the floor
participant has a queued floor request;
3\. shall remove the MCPTT client from the active floor request queue, if the
MCPTT client was in the active floor request queue;
4\. shall send a Floor Taken message to the associated floor participant. The
Floor Taken message:
a. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
b. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
c. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\';
d. if a Track Info field is included in the Floor Release message, shall
include the received Track Info field;
e. shall include a Message Sequence Number field with a \ value increased with 1; and
f. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
5\. may set the first bit in the subtype of the Floor Taken message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
6\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.6 Receive RTP media packets (R: media)
Upon receiving an indication from the network media interface in the MCPTT
server that RTP media packets with payload are received from the associated
floor participant, the floor control interface towards the MCPTT client in the
floor control server:
NOTE: Reception of unauthorized RTP media packets can only happen if the
associated floor participant is in an MCPTT client. If the associated floor
participant is a floor control server interface in a non-controlling MCPTT
function of an MCPTT group, the unauthorized RTP media packets are handled in
the non-controlling MCPTT function.
1\. shall request the network media interface to not forward the RTP media
packets to the media distributor in the MCPTT server;
2\. shall send a Floor Revoke message to the associated floor participant. The
Floor Revoke message:
a. shall include the Reject Cause field with the Reject Cause value set to #3
(No permission to send a Media Burst); and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall enter the \'U: not permitted but sends media\' state as specified in
the subclause 6.3.5.7.2.
##### 6.3.5.4.7 Send Floor Queue Position Info message (R: Floor Queue
Position Request)
Upon receiving a Floor Queue Position Request message from the associated
floor participant, the floor control interface towards the MCPTT client in the
floor control server:
1\. shall send the Floor Queue Position Info message. The Floor Queue Position
Info message:
a. shall include the queue position and floor priority in the Queue Info
field;
b. if a Track Info field is included in the Floor Queue Position Info message,
shall include the received Track Info field;
c. may include the first bit in the subtype of the Floor Queue Position Info
message set to \'1\' (Acknowledgment is required) as described in subclause
8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.8 Receive an implicit floor request (R: Implicit floor request)
When an ongoing session is upgraded to an emergency group call and when the
application and signalling plane indicates that a subsequent SDP offer
included the \"mc_implicit_request\" fmtp attribute as specified in clause 14,
the floor control interface towards the MCPTT client in the floor control
server:
1\. shall indicate to the floor control server arbitration logic that an
implicit floor request is received due to an upgrade to an emergency group
call; and
2\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.9 Send Floor Granted message (S: Floor Granted)
When a Floor Granted message is received from the floor control arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the floor control server:
1\. shall forward the Floor Granted messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Granted message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
NOTE 1: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
store an indication that the participant is overriding without revoke; and
NOTE 2: The G-bit in the Floor Indicator is set to \'1\' as specified in
subclause 6.3.6.3.2.
4\. shall enter the state \'U: permitted\' as specified in subclause
6.3.5.5.2.
##### 6.3.5.4.10 Send Floor Taken message (S: Floor Taken)
When a Floor Taken message is received from the floor control arbitration
logic in the MCPTT server, if the G-bit in the Floor Indicator is set to \'1\'
(Dual floor) the floor control interface towards the MCPTT client in the floor
control server:
1\. shall forward the Floor Taken message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall store an indication that the participant is listening to media from
two sources; and
4\. shall remain in the \'U: not permitted and Floor Taken\' state.
#### 6.3.5.5 State: \'U: permitted\'
##### 6.3.5.5.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state when the associated floor participant has been given
permission to send media.
##### 6.3.5.5.2 Enter state \'U: permitted\'
When entering this state the floor control interface towards the MCPTT client
in the floor control server:
1\. shall set the state for the associated floor participant to \'U:
permitted\'.
##### 6.3.5.5.3 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client in the floor control
server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if an indication that the participant is overriding without revoke is
stored,
a. shall forward the Floor Release message to the dual floor control operation
state machine of the floor control arbitration logic in the MCPTT server with
the first bit in the subtype of the Floor Release message set to \'0\'
(Acknowledgment is not required), if not already set;
b. shall remove the indication that the participant is overriding without
revoke; and
c. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2;
3\. if an indication that the participant is overridden without revoke is
stored,
a. shall forward the Floor Release message to the general floor control
operation state machine of the floor control arbitration logic in the MCPTT
server with the first bit in the subtype of the Floor Release message set to
\'0\' (Acknowledgment is not required), if not already set;
b. shall remove the indication that the participant is overridden without
revoke; and
c. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2; and
4\. if no indication is stored:
a. shall forward the Floor Release message to the general floor control
operation state machine of the floor control arbitration logic in the MCPTT
server with the first bit in the subtype of the Floor Release message set to
\'0\' (Acknowledgment is not required), if not already set; and
b. shall remain in the \'U: permitted\' state.
##### 6.3.5.5.4 Send Floor Idle message (S: Floor Idle)
Upon receiving the Floor Idle message from the floor control server
arbitration logic in the MCPTT server, the floor control interface towards the
MCPTT client in the floor control server:
1\. if the G-bit in the Floor Indicator is set to \'1\' (Dual Floor) and an
indication that the participant is overridden without revoke is stored
a. shall send Floor Idle message to the associated floor participant;
b. shall remove the indication that a participant is overridden without
revoke; and
c. shall remain in \'U: permitted state\';
2\. if no indication is stored shall enter the \'U: not permitted and Floor
Idle\' state as specified in the subclause 6.3.5.3.2; and
3\. if an indication that the participant is overriding without revoke is
stored
a. shall send Floor Idle message to the associated floor participant;
b. shall remove the indication that a participant is overriding without
revoke; and
c. shall remain in \'U: permitted state\'.
##### 6.3.5.5.5 Send Floor Revoke message (S: Floor Revoke)
When receiving the Floor Revoke message from the floor control server
arbitration logic in the MCPTT server, the floor control interface towards the
MCPTT client in the floor control server:
1\. shall forward the Floor Revoke message to the floor participant;
2\. if the Floor Revoke message includes the Track Info field, shall store the
Track Info field; and
3\. shall enter the state \'U pending Floor Revoke\' as specified in the
subclause 6.3.5.6.2.
##### 6.3.5.5.6 Receive RTP media packets (R: media)
Upon receiving an indication from the network media interface in the MCPTT
server that RTP media packets with payload are received from the associated
floor participant, the floor control interface towards the MCPTT client in the
floor control server:
1\. if an indication that the participant is overriding without revoke is not
stored,
a. shall request the network media interface in the MCPTT server to forward
RTP media packets to the media distributor in the MCPTT server.
##### 6.3.5.5.7 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message from the associated floor participant,
the floor control interface towards the MCPTT client in the floor control
server:
1\. shall forward the Floor Request message to the floor control server
arbitration logic in the MCPTT server; and
b. shall instruct the media distributor to act as in subclause 6.3.4.4.5.
2\. if an indication that the participant is overriding without revoke is
stored,
a. shall request the network media interface in the MCPTT server to forward
RTP media packets to the media distributor in the MCPTT server; and
b. shall instruct the media distributor to act as in subclause 6.3.6.3.5; and
3\. shall remain in the \'U: permitted\' state.
##### 6.3.5.5.8 Send RTP Media (S: media)
When RTP packets are received from the media distributor, the floor control
interface towards the MCPTT client in the floor control server:
1\. shall forward the RTP packet to the associated floor participant if the
indication that the participant is overridden without revoke is stored;
2\. shall forward the RTP packet to the associated floor participant if the
indication that the participant is overriding without revoke is stored; and
3\. shall remain in the \'U: permitted\' state.
##### 6.3.5.5.9 Send Floor Taken message (S: Floor Taken)
When receiving the Floor Taken message from the floor control server
arbitration logic in the MCPTT server with the G-bit in the Floor Indicator
set to \'1\' (Dual Floor), the floor control interface towards the MCPTT
client in the floor control server:
1\. shall send the Floor Taken message to the associated floor participant;
2\. shall store an indication that the participant is overridden without
revoke; and
3\. shall remain in the \'U: permitted\' state.
When receiving the Floor Taken message from the floor control server
arbitration logic in the MCPTT server with the G-bit in the Floor Indicator
set to \'0\' (Not dual floor), the floor control interface towards the MCPTT
client in the floor control server:
1\. shall send the Floor Taken message to the associated floor participant;
and
2\. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2.
#### 6.3.5.6 State: \'U: pending Floor Revoke\'
##### 6.3.5.6.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state during the grace period after sending the Floor Revoke
message.
In this state timer T8 (Floor Revoke) is running.
##### 6.3.5.6.2 Enter state \'U pending Floor Revoke\'
When entering this state the floor control interface towards the MCPTT client
in the floor control server:
1\. shall start timer T8 (Floor Revoke); and
2\. shall enter the state \'U: pending Floor Revoke\'.
##### 6.3.5.6.3 Timer T8 (media Revoke) expired
On expiry of timer T8 (Floor Revoke) the floor control interface towards the
MCPTT client in the floor control server:
1\. shall retransmit the Floor Revoke message to the associated floor
participant. The Floor Revoke message:
a. shall include the same Rejection Cause field and the same Floor Indicator
field as in the previous sent Floor Revoke message;
2\. shall start timer T8 (Floor Revoke); and
3\. shall remain in the \'U: pending Floor Revoke\' state.
NOTE: The number of times the floor control server retransmits the Floor
Revoke message and the action to take when the floor control server gives up
is an implementation option. However, it is recommended that the MCPTT client
is disconnected from the MCPTT call when the floor control server gives up.
##### 6.3.5.6.4 Receive RTP media packets (R: media)
Upon receiving an RTP media packet with payload from the associated floor
participant, the floor control interface towards the MCPTT client in the floor
control server:
1\. shall forward RTP media packets to the media distributor; and
2\. shall remain in the \'U: pending Floor Revoke\' state.
##### 6.3.5.6.5 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client in the floor control
server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor):
a. if the state in the \'general floor control operation\' state machine is
\'G: Taken\':
i. shall send a Floor Taken message to the associated floor participant. The
Floor Taken message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field of the permitted MCPTT client, if privacy is not requested; and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2; and
b. if the state in the \'general floor control operation\' state machine is
\'G: Idle\':
i. shall send a Floor Idle message to the associated floor participant;
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
iii. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the subclause 6.3.5.3.2; and
3\. if the G-bit in the Floor Indicator is set to \'0\':
a. shall forward the Floor Release message to the floor control server
arbitration logic; and
b. shall remain in the state \'U: pending Floor Revoke\'.
##### 6.3.5.6.6 Send Floor Idle message (S: Floor Idle)
Upon receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the floor control server:
NOTE 1: The Floor Idle message is sent when timer T3 (Stop talking grace)
expires and when timer T1 (End of RTP media) expires and when there are no
queued floor requests.
1\. shall send the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the subclause 6.3.5.3.2.
##### 6.3.5.6.7 Send Floor Taken message (S: Floor Idle)
Upon receiving a Floor Taken message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the floor control server:
NOTE 1: The Floor Taken message is sent when timer T3 (Stop talking grace)
expires or when timer T1 (End of RTP media) expires and if there are queued
floor requests.
1\. shall send the Floor Taken message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.3.2.
#### 6.3.5.7 State \'U: not permitted but sends media\'
##### 6.3.5.7.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state when it receives RTP media packets from the MCPTT
client and the MCPTT client is not permitted to send media.
Timer T8 (Floor Revoke) is running in this state.
##### 6.3.5.7.2 Enter state \'U: not permitted but sends media\'
When entering this state the floor control interface towards the MCPTT client
in the floor control server:
1\. shall start timer T8 (Floor Revoke); and
2\. shall enter the state \'U: not permitted but sends media\'.
In this state the floor control interface towards the MCPTT client in the
floor control server:
1\. shall not request the network media interface in the MCPTT server to
forward RTP media packets from the MCPTT client to the media distributor in
the MCPTT server.
##### 6.3.5.7.3 Timer T8 (Floor Revoke) expired
On expiry of timer T8 (Floor Revoke), the floor control interface towards the
MCPTT client in the floor control server:
1\. shall send a Floor Revoke message to the associated floor participant. The
Floor Revoke message:
a. shall include in the Rejection Cause field the \ value set
to #3 (No permission to send a Media Burst); and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. shall restart timer T8 (Floor Revoke); and
3\. shall remain in the \'U: not permitted but sends media\' state.
NOTE: The number of times the floor control server retransmits the Floor
Revoke message and the action to take when the floor control server gives up
is an implementation option. However, the recommended action is that the MCPTT
client is disconnected from the MCPTT call.
##### 6.3.5.7.4 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message, the floor control interface towards
the MCPTT client in the floor control server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if the general state is \'G: Floor Idle\', the floor control interface
towards the MCPTT client in the floor control server:
a. shall send the Floor Idle message. The Floor Idle message:
i. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the subclause 6.3.5.3.2; and
3\. if the general state is \'G: Floor Taken\', the floor control interface
towards the MCPTT client in the floor control server:
a. shall send a Floor Taken message. The Floor Taken message:
i. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
ii. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
iii. if the session is not a broadcast group call, may include the Permission
to Request the floor field set to \'1\';
iv. may include the first bit in the subtype of the Floor Taken message set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
v. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
c. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the subclause 6.3.5.4.2.
#### 6.3.5.8 In any state
##### 6.3.5.8.1 General
This subclause describes the actions to be taken in all states defined for the
basic state diagram with the exception of the \'Start-stop\' and \'Releasing\'
states.
##### 6.3.5.8.2 Receive MCPTT call release -- 1
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane e.g. when the MCPTT call is going to be released or when the
MCPTT client leaves the MCPTT call, the floor control interface towards the
MCPTT client in the floor control server:
1\. shall stop sending floor control messages to the associated floor
participant;
2\. shall request the network media interface to stop sending RTP media
packets towards to the associated MCPTT client;
3\. shall ignore any floor control messages received from the associated floor
participant;
4\. shall request the network media interface to stop forwarding RTP media
packets from the associated MCPTT client to the media distributor in the MCPTT
server;
5\. shall indicate to the floor control server arbitration logic in the MCPTT
server that the MCPTT client has started to disconnect from the MCPTT call;
and
6\. shall enter the \'Releasing\' state.
##### 6.3.5.8.3 Receiving a merging instruction (R: Merge)
Upon receipt of an instruction to merge with another group due to the group
regrouping function, the floor control interface towards the MCPTT client:
1\. shall create an instance of the \'floor participant interface state
transition\' as specified in subclause 6.5.5;
2\. shall move information associated with the instance used for \'floor
participant interface state transition\' to the \'basic floor control
operation towards the floor participant\' state machine;
NOTE: Which information that needs to be moved is an implementation option.
3\. shall enter the \'Start-stop\' state and terminate the \'basic floor
control operation towards the floor participant\'\' state machine associated
with this floor participant and this MCPTT call;
4\. if the state was \'U: not permitted and Floor Idle\', \'U: not permitted
Floor Taken\', \'U: pending Floor Revoke\', \'U: not permitted and
initiating\' or \'U: not permitted but sends media\':
a. shall enter the \'P: has no permission\' state as specified in subclause
6.5.5; and
b. shall perform actions specified in subclause 6.5.5.3; and
5\. if the state was \'U: permitted\':
a. shall enter the \'P: has permission\' state; and
b. shall perform actions specified in subclause 6.5.5.4.
#### 6.3.5.9 State: \'Releasing\'
##### 6.3.5.9.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state while waiting for the application and signalling plane
to finalize the release of the MCPTT call or finalizing the removal of the
MCPTT client from the MCPTT call.
##### 6.3.5.9.2 Receive MCPTT call release - 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control interface towards the MCPTT client in the
floor control server:
1\. shall request the network media interface to release all resources
associated with this MCPTT client for this MCPTT call; and
2\. shall enter the \'Start-stop\' state and terminate the \'basic floor
control operation towards the floor participant\'\' state machine associated
with this floor participant and this MCPTT call.
#### 6.3.5.10 State: \'U: not permitted and initiating\'
##### 6.3.5.10.1 General
The floor control interface towards the MCPTT client uses this state when
waiting for the floor control arbitration logic to finalize the initialisation
of the state machine to be used for a temporary group session.
During this state Floor Request messages can be received from the non-
controlling MCPTT function. Any Floor Request message received will be added
to the queue according to the priority of the floor request determine as
described in subclause 4.1.1.4.
##### 6.3.5.10.2 Enter the \'U: not permitted and initiating\' state
The floor control interface towards the MCPTT client:
1\. shall set the state for the associated floor participant to \'U: not
permitted and Initiating\'.
##### 6.3.5.10.3 Send Floor Taken message (S: Floor Taken)
When a Floor Taken message is received from the floor control arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client:
1\. shall forward the Floor Taken messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the state \'U: not permitted and Floor Taken\' as specified in
subclause 6.3.5.4.2.
##### 6.3.5.10.4 Send Floor Idle message (S: Floor Idle)
When receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client:
1\. shall forward the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the subclause 6.3.5.3.2.
##### 6.3.5.10.5 Receive Floor Request message (R: Floor Request)
Upon receipt of a Floor Request message, the floor control interface towards
the MCPTT client:
1\. shall determine the effective priority level as described in subclause
4.1.1.4;
2\. shall put the Floor Request message in the floor request queue according
to the determined effective priority level;
3\. if the \ value in the Track Info field is set to
\'1\' (the floor participant in the MCPTT client supports queueing), shall
send a Floor Queue Position Info message to the requesting non-Controlling
MCPTT function, The Floor Queue Position Info message:
a. shall include the queue position and floor priority in the Queue Info
field;
b. shall include the received Track Info field; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4 if the \ value in the Track Info field is set to \'0\'
(the floor participant in the MCPTT client does not support queueing), shall
send the Floor Deny message. The floor Deny message:
NOTE: A Floor Request from a MCPTT client in a constituent group can be
received without the queueuing capability if a floor participant in an ongoing
constituent MCPTT group request floor while the floor was idle during the
merging process.
a. shall include in the Reject Cause field the \ value cause
\'1\' (Another MCPTT client has permission);
b. shall include the received Track Info field; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
5\. shall remain in the \'U: not permitted and initiating\' state.
##### 6.3.5.10.6 Send Floor Granted message (S: Floor Granted)
When a Floor Granted message is received from the floor control arbitration
logic, the floor control interface towards the MCPTT client:
1\. shall forward the Floor Granted messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Granted message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the state \'U: permitted\' as specified in subclause
6.3.5.5.2.
##### 6.3.5.10.7 Receive a Floor Release message (S: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in subclause 8.3.2, shall send
a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. shall use the topmost \ value and the SSRC in the
Track Info field of the received Floor Release message to check if the floor
participant has a queued floor request and if not, check if there is a floor
request in one of the cached application/vnd.3gpp.mcptt-floor-request+xml MIME
bodies;
3\. shall remove the MCPTT client from the active floor request queue or the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body, if the MCPTT
client was in the active floor request queue or in the
application/vnd.3gpp.mcptt-floor-request+xml MIME body; and
4\. shall remain in the \'U: not permitted and initiating\' state.
### 6.3.6 Dual floor control
#### 6.3.6.1 General
Dual floor control is used when a floor participant requests floor with a pre-
emptive floor priority allowing the floor control in subclause 6.3.4 to
continue without revoking the floor from the MCPTT client permitted to send
media as specified in 3GPP TS 23.379 [5] subclause 10.9.1.3.2.2.
The floor control server arbitration logic in the floor control server shall
behave according to the state diagram and state transitions specified in this
subclause.
Figure 6.3.6.1-1 shows the \'dual floor control operation\' states (D states)
and the state transition diagram.
Figure 6.3.6.1-1: Floor control server state transition diagram for \'dual
floor control operation\'
The floor control arbitration logic in the floor control server shall keep one
instance of the \'dual floor control operation\' state machine for a floor
participant with pre-emptive floor priority where this MCPTT user is allowed
to talk without revoking a current speaker with lower flow priority.
NOTE: Only one MCPTT user with this type of pre-emptive floor priority can
exist within an MCPTT call.
The floor participant associated to the \'\'dual floor control operation\'
state machine is in the following subclauses referred to as the overriding
MCPTT client.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following subclauses the floor control
arbitration logic in the floor control server:
1\. shall discard the floor control message;
2\. shall request the media distributor in the MCPTT server to discard any
received RTP media packet; and
3\. shall remain in the current state.
State details are explained in the following subclauses.
#### 6.3.6.2 State: \'Start-stop\'
##### 6.3.6.2.1 General
When a new instance of the \'general dual floor control operation\' state
machine is initiated, before any floor control related input is applied, the
state machine is in \'Start-stop\' state. Similarly when the media burst is
released the state machine shall return to the \'Start-Stop\' state or the
related MCPTT call is released.
##### 6.3.6.2.2 Receive Floor Request message with overriding pre-emptive
floor priority (R: Floor Request)
When a floor participant request floor with an overriding pre-emptive priority
is granted the floor the floor control arbitration logic:
1\. shall create instance of the \'dual floor control operation\' state
machine;
2\. shall store the SSRC of floor participant;
3\. if a Track Info field is included in the Floor Request message, shall
store the received Track Info field associated with the floor control server
state transition diagram for \'dual floor control operation\', and
4 shall enter the state \'D: Floor Taken\' as specified in the subclause
6.3.6.3.2.
#### 6.3.6.3 State: \'D: Floor Taken\'
##### 6.3.6.3.1 General
The floor control arbitration logic in the floor control server uses this
state when it has permitted one floor participant to override a current
speaker in an MCPTT call to send media.
Timer T11 (End of RTP dual) can be running when the floor control server is in
this state.
Timer T12 (Stop talking dual) can be running when the floor control server is
in this state.
##### 6.3.6.3.2 Enter state \'D: Floor Taken\'
When entering this state the floor control arbitration logic in the floor
control server:
1\. shall send a Floor Granted message to the requesting floor participant.
The Floor Granted message:
a. shall include the value of the T12 (Stop talking dual) timer in the
Duration field;
b. shall include the granted priority in the Floor priority field;
c. if a Track Info field associated with the floor control server state
transition diagram for \'dual floor control operation\' is stored, shall
include the stored Track Info field;
d. shall include the Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
e. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
f. if non-controlling MCPTT functions are involved, shall include the SSRC of
granted floor participant;
2\. shall send a Floor Idle message to any non-controlling MCPTT functions
involved in the session and to those floor participants controlled by the
controlling MCPTT function that will only listen to RTP media from the
overriding MCPTT client according to local policy. The Floor Idle message:
NOTE 1: The non-controlling MCPTT function will send the Floor Idle message to
those floor participants controlled by the non-controlling MCPTT function that
will only listen to RTP media from the overriding MCPTT client according to
local policy when the non-controlling MCPTT function receives the Floor Taken
with the G-bit set to \'1\' (Dual floor) in the Floor Indicator field.
i. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. shall send a Floor Taken message to any non-controlling MCPTT functions
involved and to floor participants controlled by the controlling MCPTT
function that will listen to the RTP media from the overriding MCPTT client
according to local policy. The Floor Taken message:
NOTE 2: The MCPTT client overridden by the overriding MCPTT client is still
sending voice (overridden). The list of floor participants that receive the
overriding, overridden, or both transmissions is based on configuration.
a. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested;
b. shall include a Message Sequence Number field with a \ value increased with 1;
c. shall include the Floor Indicator field with the G-bit set to \'1\' (Dual
floor); and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4\. shall start the T11 (End of RTP dual) timer; and
5\. shall enter the state to \'D: Floor Taken\' state.
##### 6.3.6.3.3 Timer T11 (End of RTP dual) expired
On expiry of timer T11 (End of RTP dual), the floor control arbitration logic
in the floor control server:
1\. shall stop the T12 (Stop talking dual) timer; if running;
2\. shall request the media distributor in the MCPTT server to stop
distributing RTP media packets received from the overriding MCPTT client to
other MCPTT clients;
NOTE: If dual floor control is ongoing as described in subclause 6.3.6, the
list of floor participants that receive the overriding, overridden, or both
transmissions is based on configuration.
3\. shall release all resources reserved in the media plane including the
instances used for the \'dual floor control operation\' state machine and any
running timers associated with the state machine;
4\. shall send a Floor Idle message to any non-controlling MCPTT functions and
to those floor participants controlled by the controlling MCPTT functions
receiving RTP media from the overriding MCPTT client. The Floor Idle message:
a. shall include a Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b. shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
5\. if the state in the \'general floor control operation\' state machine is
\'G: Taken\';
a shall send a Floor Taken message to any non-controlling MCPTT functions and
to those floor participants controlled by the controlling MCPTT function that
only received RTP media from the overriding MCPTT client. The Floor Taken
message:
i. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field of the permitted MCPTT client, if privacy is not requested;
ii. shall include a Message Sequence Number field with a \ value increased with 1; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
6\. if the state in the \'general floor control operation\' state machine is
\'G: Idle\', shall send a Floor Idle message to all floor participants. The
Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
7\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.4 Timer T12 (Stop talking dual) expired
On expiry of the T12 (Stop talking dual) timer the floor control arbitration
logic in the floor control server:
1\. shall stop the T11 (End of RTP dual) timer;
2\. shall request the media distributor in the MCPTT server to stop
distributing RTP media packets to other MCPTT client;
3\. shall send the Floor Revoke message to the permitted participant. The
Floor Revoke message:
a. shall include the Reject Cause field with the \ value set to
#2 (Media burst too long) in the Floor Revoke message sent in subclause
6.3.4.5.2;
b. shall include the Floor Indicator with the G-bit set to \'1\' (Dual floor);
c. if a Track Info field associated with the dual floor is stored, shall
include the stored Track Info field; and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4\. shall remove the stored Track info field associated with the dual floor;
5\. if the state in the \'general floor control operation\' state machine is
\'G: Taken\';
a. shall send a Floor Taken message to all non-controlling functions (if the
session is a temporary group session involving non-controlling MCPTT
functions) and to those floor participants that only received RTP media from
the overriding MCPTT client. The Floor Taken message:
i. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field of the permitted MCPTT client, if privacy is not requested; and
ii shall include a Message Sequence Number field with a \ value increased with 1;
6\. if the state in the \'general floor control operation\' state machine is
\'G: Idle\', shall send a Floor Idle message to all floor participants. The
Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
7\. shall release all resources reserved in the media plane including the
instances used for the \'Floor control server state transition diagram for
dual floor control operation\'; and
8\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.5 Receive RTP media packets (R: media)
Upon receiving an indication from the media distributor in the MCPTT server
that RTP media packets are received from the permitted MCPTT client, the floor
control arbitration logic in the floor control server:
1\. shall start the T12 (Stop talking dual) timer, if not already running;
2\. shall restart the T11 (End of RTP dual) timer;
3\. shall instruct the media distributor to forward the received RTP media
packets to any non-controlling MCPTT functions, to the overridden MCPTT client
and to those MCPTT clients receiving RTP media from the overriding MCPTT
client controlled by the controlling MCPTT functions according to local
policy; and
NOTE 1: The RTP media is sent to the MCPTT clients subjected to the maximum
number of simultaneous transmissions received in one group call for override
(N7) as indicated in 3GPP TS 23.379 [5].
NOTE 2: The non-controlling MCPTT function will forward the RTP media packets
to MCPTT clients receiving RTP media from the overriding MCPTT client
according to local policy in the non-controlling MCPTT function.
4\. shall remain in the \'D: Floor Taken\' state.
##### 6.3.6.3.6 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message the floor control arbitration logic in
the floor control server:
1\. shall request the media distributor in the MCPTT server to stop
distributing RTP media packets received from the overriding MCPTT client to
other MCPTT client;
2\. shall stop the T12 (Stop talking dual) timer, if running;
3\. shall stop the T11 (End of RTP dual) timer;
4\. shall release all resources reserved in the media plane including the
instances used for the \'Floor control server state transition diagram for
dual floor control operation\' and any running timers associated with the
state machine;
5\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (acknowledgement is required) as specified in subclause 8.2.2:
a. shall send a Floor Ack message. The Floor Ack message:
i. shall set the Source field to the value \'2\' (the controlling MCPTT
function is the source); and
ii. shall set the Message Type field to the value \'4\'( Floor Release);
6\. shall send a Floor Idle message to any non-controlling MCPTT functions, to
the overridden floor participant and to those floor participants controlled by
the controlling MCPTT functions receiving RTP media from the overriding MCPTT
client. The Floor Idle message:
a. shall include an Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
7\. if the state in the \'general floor control operation\' state machine is
\'G: Taken\',
a. shall send a Floor Taken message to any non-controlling MCPTT functions and
to those floor participants that only received RTP media from the overriding
MCPTT client. The Floor Taken message:
i. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field of the permitted MCPTT client, if privacy is not requested;
ii. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
8\. if the state in the \'general floor control operation\' state machine is
\'G: Idle\', shall send a Floor Idle message to all floor participants;. The
Floor Idle message:
a. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
9\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.7 Receive Floor request message from permitted floor participant
(R: Floor Request)
Upon receiving a Floor Request message from the floor participant that has
been granted permission to send overriding media, the floor control
arbitration logic in the floor control server:
1\. shall send a Floor Granted message to the previously granted floor
participant. The Floor Granted message:
a. shall include the value of the T12 (Stop talking dual) timer in the
Duration field;
b. shall include the granted priority in the Floor priority field;
c. if the Floor Request message included a Track Info field, shall include the
received Track Info field; and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
2\. shall remain in the \'D: Floor Taken\' state.
##### 6.3.6.3.8 Permitted MCPTT client release
If the floor control server receives an indication from the floor control
interface towards the MCPTT client that the MCPTT client has started to
disconnect from the MCPTT call, the floor control arbitration logic in the
floor control server:
1\. shall request the media distributor in the MCPTT server to stop
distributing RTP media packets received from the overriding MCPTT client to
other MCPTT clients;
2\. shall send a Floor Idle message to any non-controlling MCPTT functions and
to those floor participants controlled by the controlling MCPTT functions
receiving RTP media from the overriding MCPTT client. The Floor Idle message:
a. shall include an Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. shall release all resources reserved in the media plane including the
instances used for the \'Floor control server state transition diagram for
dual floor control operation\' and any running timers associated with the
state machine; and
4\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.9 Receive Terminate (Terminate)
Upon receiving the termination instruction, the floor control arbitration
logic in the floor control server:
1\. shall set the value of timer T1 (End of RTP media) to the value of timer
T11 (End of RTP dual) and start timer T1, if timer T11 (End of RTP dual) is
running;
2\. shall set the value of timer T2 (Stop talking) to the value of timer T12
(Stop talking dual) and start timer T2, if timer T12 (Stop talking dual) is
running;
3\. shall release all resources reserved in the media plane including the
instances used for the \'general dual floor control operation\' state machine
and stop any running timers associated with the state machine; and
4\. shall enter the \'Start-stop\' state.
NOTE: The overriding participant continues to have the floor until its current
talk burst is terminated.
#### 6.3.6.4 In any state
##### 6.3.6.4.1 General
This subclause describes the actions to be taken in all states defined for the
general state diagram with the exception of the \'Start-stop\' state.
##### 6.3.6.4.2 Receive MCPTT call release - 1
This subclause is used by the floor control arbitration logic in the floor
control server when an MCPTT call is released.
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane the floor control arbitration logic in the floor control
server:
1\. shall request the media distributor in the MCPTT server to stop sending
RTP media packets MCPTT clients; and
2\. shall enter the \'Releasing\' state.
#### 6.3.6.5 State: \'Releasing\'
##### 6.3.6.5.1 General
The floor control arbitration logic in the floor control server uses this
state while waiting for the application and signalling plane to finalize the
disconnection of an MCPTT call.
##### 6.3.6.5.2 Receive MCPTT call release - 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control arbitration logic in the floor control
server:
1\. shall release all resources reserved in the media plane including the
instances used for the \'general dual floor control operation\' state machine
and any running timers associated with the state machine; and
2\. shall enter the \'Start-stop\' state.
## 6.4 Participating MCPTT function floor control procedures
### 6.4.1 General
Once an on-demand MCPTT session is established or a pre-established session is
in use when the participating MCPTT function receives floor control messages
from the floor participant in the MCPTT client or from the floor control
server in the controlling MCPTT function, the behaviour of the participating
MCPTT function is described in the following subclauses.
### 6.4.2 Receive floor control messages
Upon receiving a floor control message the participating MCPTT function:
1\. shall immediately forward the floor control message to the floor control
server if the message is received from the floor participant;
2\. if an MBMS subchannel is not used for a conversation in the session the
floor control message is associated with, shall immediately forward the floor
control message to the floor participant if the message is received from the
floor control server; and
3\. if an MBMS subchannel is used for a conversation in the session the floor
control message is associated with:
a. if
i. the floor control message is not a Floor Idle message or a Floor Taken
message;
ii. the MCPTT client has not reported \"listening\" status as specified in
3GPP TS 24.379 [2] subclause 14.2.3;
iii. the MCPTT client has reported \"not-listening\" status as specified in
3GPP TS 24.379 [2] subclause 14.2.3 in the latest received MBMS bearer
listening status report; or
iv. the floor control message is a Floor Idle message or a Floor Taken
message, protection of floor control messages sent over the MBMS subchannel
from the participating MCPTT function to the served MCPTT clients is required,
and the participating MCPTT function determined that the MCPTT client does not
support MuSiK as specified in 3GPP TS 24.379 [2];
shall immediately forward the floor control message to the floor participant;
and
b. if
i. the MCPTT client has reported \"listening\" status as specified in 3GPP TS
24.379 [2] subclause 14.2.3 in the latest received MBMS bearer listening
status report; and
ii if the floor control message is the Floor Idle message or the Floor Taken
message, and:
\- protection of floor control messages sent over the MBMS subchannel from the
participating MCPTT function to the served MCPTT clients is not required; or
\- the participating MCPTT function determined that the MCPTT client supports
MuSiK as specified in 3GPP TS 24.379 [2];
shall perform actions as specified in subclause 10.2.
NOTE: When the Floor Idle or Floor Taken messages are discarded the messages
are sent to the MCPTT clients over the MBMS subchannel allocated for the
conversation as specified in subclause 10.2.
### 6.4.3 Receive RTP media packets (R: RTP Media)
Upon receiving RTP media packets the participating MCPTT function:
1\. shall immediately forward the RTP media packet to the controlling MCPTT
function if the RTP packet is from an MCPTT client; and
2\. if an MBMS subchannel is not used for a conversation in the session the
RTP media packets are associated with, shall immediately forward the RTP media
packets to the MCPTT client if the RTP packet is from the controlling MCPTT
function or the non-controlling MCPTT function.
3\. if an MBMS subchannel is used for a conversation in the session the RTP
media packets are associated with and if RTP media packets are received from
the controlling MCPTT function or the non-controlling MCPTT function:
a. if
i. the MCPTT client has not reported \"listening\" status as specified in 3GPP
TS 24.379 [2] subclause 14.2.3; or
ii. the MCPTT client has reported \"not-listening\" status as specified in
3GPP TS 24.379 [2] subclause 14.2.3 in the latest received MBMS bearer
listening status report,
shall immediately forward the RTP media packets to the MCPTT client; and
b. if the MCPTT client has reported \"listening\" status as specified in 3GPP
TS 24.379 [2] subclause 14.2.3 in the latest received MBMS bearer listening
status report, shall perform actions as specified in subclause 10.2.
### 6.4.4 Release of session
When the participating function receives an indication from the application
and signalling plane that session release is initiated, the participating
MCPTT function:
1\. shall stop sending floor control messages towards the floor participant
and the floor control server; and
2\. shall stop sending RTP media packets towards the MCPTT client and towards
the controlling MCPTT function.
When the participating MCPTT function receives an indication from the
application and signalling plane that the session is released, the
participating MCPTT function:
1\. in case of a pre-established session, shall perform the actions in
subclause 9.3.2; and
2\. in case of an on-demand session, shall release the media resources
associated with the session.
## 6.5 Non-controlling MCPTT function of an MCPTT group
### 6.5.1 General
The floor control server interface in the non-controlling MCPTT function of an
MCPTT group shall support the procedures in subclauses 6.5.2, 6.5.3 and 6.5.4.
The floor participant interface in the non-controlling MCPTT function of an
MCPTT group shall support the procedures in subclause 6.5.5.
### 6.5.2 The MCPTT call initialization procedure in the non-controlling MCPTT
function of an MCPTT group
#### 6.5.2.1 General
The subclause 6.5.2.2 describes the initial procedures when a new SIP session
is establishing a group session.
The subclause 6.5.2.3 describes the procedure for switching from a controlling
MCPTT function mode to a non-controlling MCPTT function mode.
#### 6.5.2.2 Initial procedures when a new SIP session is establishing a group
session
When receiving an indication from the application and signalling plane that a
group session is initiated, the floor control server interface:
1\. shall initiate and store a message sequence number value with the value to
be used in the Message Sequence Number field in the Floor Idle and Floor Taken
messages;
2\. shall for each MCPTT client in the MCPTT group controlled by the non-
controlling MCPTT function that are participating in the session:
a. generate a random temporary identifier between \'0\' and \'4294967295\';
b. store an association between the generated temporary identifier and the
floor participant interface;
c. store information about capabilities negotiated in the \"mc_queueing\" and
\"mc_priority\" fmtp attributes as described in clause 14;
d. store information whether the MCPTT client requested privacy or not; and
e. initiate an instance of the \'floor participant state transition\' state
machine as specified in subclause 6.5.5; and
3\. shall perform the actions in the subclause 6.5.4.
When receiving an indication from the application and signalling plane that an
MCPTT client has accepted an invitation to the session, the floor participant
interface shall perform the actions in subclause 6.5.5.
#### 6.5.2.3 Switching from a controlling MCPTT function mode to a non-
controlling MCPTT function mode
##### 6.5.2.3.1 Overview
The switching from working in a controlling MCPTT functional mode to a non-
controlling MCPTT functional mode is a 2-step procedure.
> Step 1 The controlling MCPTT function prepares for acting as a non-
> controlling MCPTT function. The step 1 procedure is specified in subclause
> 6.5.2.3.2.\ \ Before continuing with step 2 the application and signalling
> plane needs to receive a confirmation that the SIP session between the floor
> control server and the interface to the floor control server is established.
>
> Step 2 The controlling MCPTT functions starts acting as a non-controlling
> MCPTT function. The step 2 procedure is specified in subclause 6.5.2.3.3.
##### 6.5.2.3.2 Preparing for the switch to non-controlling MCPTT function
(Step 1)
When receiving a request from the application and signalling plane to prepare
for merging with another group session, the floor control server:
1\. if in the \'G: taken\' state, shall provide information about current
speaker to the signalling and application plane;
NOTE: The signalling and application plane will use the information about the
current speaker to send a floor request in an SIP MESSAGE request as specified
in 3GPP TS 24.379.
2\. shall release the instant used for \'general floor control operation\';
and
3\. shall for each MCPTT client in the MCPTT group controlled by the
controlling MCPTT function and participating in the session:
a. generate a random temporary identifier between \'0\' and \'4294967295\';
b. store an association between the generated temporary identifier and the
floor participant interface;
c. store information about capabilities negotiated in the \"mc_queueing\" and
\"mc_priority\" fmtp attributes as specified in clause 14;
d. store information whether the MCPTT client requested privacy or not; and
e. initiate an instance of the \'floor participant state transition\' state
machine as specified in subclause 6.3.5.8.3.
##### 6.5.2.3.3 Start acting as a non-controlling MCPTT function (Step 2)
When receiving a request from the application and signalling plane to finalize
the switch to non-controlling MCPTT function behaviour, the floor control
server:
1\. shall start acting as a floor control server interface;
2\. if an active floor request queue exists, for each queued floor request in
the active floor request queue:
NOTE: The active floor request queue was built up when the non-controlling
MCPTT function was acting as a floor control server.
a. shall send a Floor Request message to the floor control server. The Floor
Request:
i. shall include all fields included by the floor participant;
ii. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
iii. if a Track Info field is not included, shall include a Track Info field
populated as follows:
A. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value;
B. shall include a \ value based on the \
element specified in 3GPP TS 24.481 [12], if value in the \
element is available, otherwise set the \ value to
\"unknown\"; and
C. shall include the temporary identifier as the first \ value;
3\. if an active floor request queue exists, shall move the active floor
request queue to a passive floor request queue; and
4\. shall perform the actions in the subclause 6.5.4.
When receiving an indication from the application and signalling plane that an
MCPTT client has joined the session, the floor participant interface shall
perform the actions in subclause 6.5.5.
### 6.5.3 The MCPTT call release procedure in the non-controlling MCPTT
function of an MCPTT group
When an MCPTT client leaves an MCPTT call and the MCPTT call remains ongoing
with the other MCPTT clients, the non-controlling MCPTT function of an MCPTT
group follows a two-step procedure:
> Step 1 The floor participant interface stops sending floor control messages
> and RTP media packets to the MCPTT client leaving the MCPTT call and the
> floor participant interface discards floor control messages and RTP media
> packets received from the MCPTT client leaving the MCPTT call; and
>
> Step 2 When the application and signalling plane has determined that the
> session with this floor participant has been released, the corresponding
> instance of the \'floor participant state transition\' state machine is
> released.
When an MCPTT call is released, the floor control server interface follows a
two-step procedure:
> Step 1 The floor control server interface stops sending floor control
> messages and RTP media packets to MCPTT clients in the MCPTT call; and
>
> Step 2 When the application and signalling plane has determined that the
> MCPTT call has been released, resources in the floor control server
> interface are released, along with all \'floor participant state
> transition\' state machines.
The non-controlling MCPTT function of an MCPTT group can initiate an MCPTT
call release depending on the release policy specified in 3GPP TS 24.379 [2].
### 6.5.4 Floor control server interface procedures
#### 6.5.4.1 General
The floor control server interface is stateless with regards to the floor
control message received and sent.
The following subclauses specifies what the floor control server interface
shall do when receiving a floor control message sent by the controlling MCPTT
function or received at the floor participant interface and how the floor
control server controls the media distribution function in the non-controlling
MCPTT function.
#### 6.5.4.2 Receiving a Floor Request message
Upon receiving a Floor Request message from one floor participant interface,
the floor control server interface:
1\. shall forward the Floor Request message to the controlling MCPTT function.
The Floor Request message:
a. shall include all fields included by the floor participant;
b. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field
populated as follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value;
ii. shall include a \ value based on the \
element specified in 3GPP TS 24.481 [12], if value in the \
element is available, otherwise set the \ value to
\"unknown\"; and
iii. shall include the temporary identifier as the first \ value; and
2\. if the value of the \ in the Track Info is \'1\' (the
floor participant in the MCPTT client supports queueing), shall store the
outgoing Floor Request message in the passive floor request queue.
#### 6.5.4.3 Receive Floor Release message
Upon receiving a Floor Release message from one floor participant interface,
the floor control server interface:
NOTE: A Floor Release message can be received from the permitted floor
participant and from any participant that is queued in the floor control
server.
1\. shall forward a Floor Release message to the controlling MCPTT function.
The Floor Release message:
a. shall include all fields included by the floor participant in the Floor
Release message;
b. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field as
follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value; and
ii. shall include the temporary identifier as the first \ value; and
2\. if a Floor Request message received from this floor participant is in the
passive floor request queue, shall remove the floor request from the passive
floor request queue.
#### 6.5.4.4 Receive Floor Queue Position Request message
Upon receiving a Floor Queue Position Request message from one floor
participant interface, the floor control server interface:
1\. shall forward the Floor Queue Position Request message to the controlling
MCPTT function. The Floor Queue Position Request message:
a. shall include all fields included by the floor participant;
b. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field as
follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value; and
ii. shall include the temporary identifier as the first \ value.
#### 6.5.4.5 Receive Floor Ack message
Upon receiving a Floor Ack message from one floor participant interface the
floor control server interface:
1\. shall send the Floor Ack message towards the controlling MCPTT function.
The Floor Ack message:
a. shall include all fields included by the floor participant in the Floor Ack
message;
b. if Track Info field is included, shall include the temporary identifier at
the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field
with temporary identifier as the first \.
#### 6.5.4.6 Receive Floor Granted message
Upon receiving a Floor Granted message sent from the controlling MCPTT
function, the floor control server interface:
1\. shall send the Floor Granted to the floor participant interface identified
by the \ value at the end of the Track Info field. The
Floor Granted message:
a. shall include the fields as received with the following exceptions:
i. if the Track Info field only contains one \ value,
shall remove the Track Info field from the outgoing Floor Granted message; and
ii. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field from the outgoing Floor Granted message; and
b if the Floor Indicator field is included in the Floor Granted message and
the G-bit is set to \'1\' (Dual floor), shall store the SSRC of granted floor
participant and associate the stored value with dual floor;
2\. if:
a. a SSRC of granted floor participant and associate the stored value with
dual floor is not stored, shall send a Floor Taken message populated as
specified in step d. below to all participant interfaces with the exception of
the floor participant interface to which the Floor Granted message is sent;
b. a SSRC of granted floor participant associate with dual floor is stored and
if the Floor Indicator field is not included in the Floor Granted message or
if the Floor Indicator field is included in the Floor Granted message and the
G-bit is set to \'0\' (Not dual floor), shall send a Floor Taken message
populated as specified in step d. below to all participant interfaces with the
exception of:
i. the floor participant interface to which the Floor Granted message is sent;
and
ii. the floor participants only listening to the overriding floor participant;
c. the Floor Indicator field is included in the Floor Granted message and the
G-bit is set to \'1\' (Dual floor):
i. shall send a Floor Taken message populated as specified in step d. below to
floor participants that will listen to the RTP media from the overriding MCPTT
client according to local policy;
NOTE 1: The MCPTT client overridden by the overriding MCPTT client is still
sending voice (overridden). The list of floor participants that receive the
overriding, overridden, or both transmissions is based on configuration.
d. The Floor Taken message:
i. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field, if privacy is not requested by the granted floor participant
when the MCPTT client was invited to the session;
NOTE 2: The privacy request was stored for each invited MCPTT client when the
MCPTT client accepted the invitation as specified in subclause 6.5.2.
ii. shall include in the Message Sequence Number field the local \ value increased with 1;
iii. shall include the Permission to Request Floor field to \'0\', if the
group call is a broadcast group call;
iv. may include the Permission to Request the Floor field set to \'1\', if the
group call is not a broadcast group call; and
v. shall set the first bit in the subtype of the Floor Taken message to \'0\'
(acknowledgement is not required); and
NOTE 3: A Floor Taken message sent to all participants does not require
acknowledgement.
e. if the Floor Indicator field was included in the Floor Granted message,
shall include the received Floor Indicator field; and
3\. if the Floor Request message received from the floor participant is in the
passive floor request queue, shall remove the floor request from the passive
floor request queue; and
4 if the Floor Indicator field is included in the Floor Granted message and
the G-bit is set to \'1\' (Dual floor), shall send a Floor Idle message to
those floor participants that will only listen to RTP media from the
overriding MCPTT client. The Floor Idle message:
a. shall include the Floor Indicator field as received in the Floor Granted
message with the G-bit set to \'0\' (Not dual floor); and
b. shall include in the Message Sequence Number field the local \ value increased with 1.
#### 6.5.4.7 Receive Floor Deny message
Upon receiving a Floor Deny message sent from the controlling MCPTT function,
the floor control server interface:
1\. shall use the \ value at the end of the Track Info
field to identify the floor participant interface;
2\. if:
a. the Track Info field only contains one \ value,
shall remove the Track Info field from the outgoing Floor Granted message; and
b. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field;
3\. shall forward the Floor Deny message to the floor participant interface;
and
4\. if the Floor Request message received from the floor participant is in the
passive floor request queue, shall remove the floor request from the passive
floor request queue.
#### 6.5.4.8 Receive Floor Idle message
Upon receiving a Floor Idle message sent from the controlling MCPTT function,
the floor control server interface:
NOTE 1: The Floor Idle message can be either destined to floor participants in
all MCPTT clients or is sent to the floor participant in a specific MCPTT
client. In the latter case the Floor Idle message contains the Track Info
field.
1\. if the Floor Idle message contains a Track Info field;
a. shall use the \ value at the end of the Track Info
field to identify the floor participant interface;
b. if:
i. the Track Info field only contains one \ value:
A. shall remove the Track Info field from the outgoing Floor Idle message;
B. shall increase the stored message sequence number value with 1; and
C. shall include in the Message Sequence Number field the local \ value increased with 1; and
ii. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field; and
c. shall send the Floor Idle message to the floor participant interface;
2\. if the Floor Idle message does not contain a Track Info field;
a. shall set the first bit in the subtype of the Floor Idle message to \'0\'
(acknowledgement is not required);
NOTE 2: A Floor Idle message sent to all participants does not require
acknowledgement.
b if:
i. the Floor Indicator field is not included in the Floor Idle message or if
the Floor Indicator field is included and the G-bit is set to \'0\' (Not dual
floor), shall send the Floor Idle message to all floor participant interfaces.
The Floor Idle message:
A. shall include received fields; and
B. shall include in the Message Sequence Number field the local \ value increased with 1; and
ii. the Floor Indicator field is included in the Floor Idle message and the
G-bit is set to \'1\' (Dual floor),
A. shall send the Floor Idle message to floor participants listening to the
overriding MCPTT client according to local policy. The Floor Idle message:
\- shall include received fields; and
\- shall include in the Message Sequence Number field the local \ value increased with 1; and
B. shall discard the stored SSRC of granted floor participant associated with
a dual floor;
c. shall send a Floor Ack message towards the controlling MCPTT function if
the first bit in the subtype of the received Floor Idle message is set to
\'1\' (acknowledgement is required) as specified in subclause 8.2.2. The Floor
Ack message:
i. shall include the Source field set to \'3\' (the non-controlling MCPTT
function is the source); and
ii. shall include the Message Type field set to \'5\' (Floor Idle); and
3\. shall empty the passive floor request queue.
#### 6.5.4.9 Receive Floor Taken message
Upon receiving a Floor Taken message sent from the controlling MCPTT function,
the floor control server interface:
NOTE 1: The Floor Taken message can be either destined to floor participants
in all MCPTT clients or is sent to the floor participant in a specific MCPTT
client. In the latter case the Floor Taken message contains the Track Info
field.
1\. if the Floor Taken message contains a Track Info field;
a. shall use the \ value at the end of the Track Info
field to identify the floor participant interface;
b. if the Track Info field only contains one \ value:
A. shall remove the Track Info field from the outgoing Floor Taken message;
and
B. shall include in the Message Sequence Number field the local \ value increased with 1;
c. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field; and
d. shall send the Floor Taken message to the floor participant interface;
2\. if the Floor Taken message does not contain a Track Info field:
a. shall set the first bit in the subtype of the Floor Taken message to \'0\'
(acknowledgement is not required);
NOTE 2: A Floor Taken message sent to all participants does not require
acknowledgement.
b. if the Floor Indicator field is included in the Floor Taken message and the
G-bit is set to \'1\' (Dual floor), shall store the SSRC of granted floor
participant and associate the stored SSRC with dual floor;
c. if there is no stored SSRC of granted floor participant associated with a
dual floor, shall send the Floor Taken message to all floor participant
interfaces. The Floor Taken message:
i. shall include all received fields with the exception of the Message
Sequence Number field;
ii. shall include in the Message Sequence Number field the local \ value increased with 1;
d. if there is a stored SSRC of granted floor participant associated with a
dual floor:
i. if the Floor Indicator field is not included in the Floor Taken message or
if the Floor Indicator field is included in the Floor Taken message and the
G-bit is set to \'0\' (Not dual floor), shall send the Floor Taken message to
all floor participant interfaces with the exception of the floor participants
only listening to RTP media from the overriding floor participant. The Floor
Idle message:
A. shall include all received fields; and
B. shall include in the Message Sequence Number field the local \ value increased with 1; and
ii. if the Floor Indicator field is included in the Floor Taken message and
the G-bit is set to \'1\' (Dual floor):
A. shall send the Floor Taken message to all floor participants listening to
the RTP media from the overriding MCPTT client according to local policy. The
Floor Taken message:
\- shall include all received fields; and
\- shall include in the Message Sequence Number field the local \ value increased with 1; and
B. shall send a Floor Idle message to those floor participants that will only
listen to RTP media from the overriding MCPTT client according to local
policy. The Floor Idle message:
\- shall include all received fields;
\- shall include in the Message Sequence Number field the local \ value increased with 1; and
\- shall update the received Floor Indicator field and set the G-bit to \'0\'
and;
e. shall send a Floor Ack message towards the controlling MCPTT function if
the first bit in the subtype of the received Floor Taken message is set to
\'1\' (acknowledgement is required) as specified in subclause 8.2.2. The Floor
Ack message:
i. shall include the Source field set to \'3\' (the non-controlling MCPTT
function is the source); and
ii. shall include the Message Type field set to \'2\' (Floor Taken);
#### 6.5.4.10 Receive Floor Revoke message
Upon receiving a Floor Revoke message from the controlling MCPTT function, the
floor control server interface:
1\. shall use the \ value at the end of the Track Info
field to identify the floor participant interface;
2\. if:
a. the Track Info field only contains one \ value,
shall remove the Track Info field from the outgoing Floor Revoke message; and
b. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field; and
3\. shall forward the Floor Revoke message to the floor participant interface.
#### 6.5.4.11 Receive Floor Queue Position Info message
Upon receiving a Floor Queue Position Info message from the controlling MCPTT
function, the floor control server interface:
1\. shall use the \ value at the end of the Track Info
field to identify the floor participant interface;
2\. if:
a. the Track Info field only contains one \ value,
shall remove the Track Info field from the outgoing Floor Granted message; and
b. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field; and
3\. shall forward the Floor Queue Position Info message to the floor
participant interface.
#### 6.5.4.12 Receive RTP media packets from controlling MCPTT function
Upon receiving an indication from the media distributor that RTP media packets
are received from the controlling MCPTT function, the floor control server
interface:
1\. if a SSRC of granted floor participant associated with a dual floor is not
stored shall request the network media distributor to forward received RTP
media packets to all MCPTT clients in the session controlled by the non-
controlling MCPTT function where the SSRC of the received RTP media packets
are different to SSRC used by an MCPTT client;
NOTE: If one of the MCPTT client controlled by the non-controlling MCPTT
function is granted the floor, media originated from that MCPTT client is not
distributed back to the MCPTT client granted the floor.
2\. if a SSRC of granted floor participant associated with a dual floor is
stored and if the SSRC in the media packet is not the same as the stored SSRC,
shall request the network media distributor to forward received RTP media
packets to MCPTT clients controlled by the non-controlling MCPTT function:
i. where the SSRC of the received RTP media packets are different to SSRC used
by the MCPTT client; and
ii. that are not only listening to the dual floor according to local policy;
and
3\. if a SSRC of granted floor participant associated with a dual floor is
stored and if the SSRC in the media packet is the same as the stored SSRC,
shall request the network media distributor to forward received RTP media
packets to all MCPTT client:
i. where the SSRC of the received RTP media packets are different to SSRC used
by the MCPTT client; and
ii. listening to the dual floor according to local policy.
#### 6.5.4.13 Receive RTP media packets from an MCPTT client
Upon receiving an indication from the media distribution function that RTP
media packets are received from one of the network media interfaces, the floor
control server interface:
1\. shall request the network media distributor to forward received RTP media
packets towards the controlling MCPTT function.
NOTE: If RTP media packets are received from an MCPTT client not permitted to
send media, the floor participant interface will send a Floor Revoke message
to the floor participant of the misbehaving MCPTT client without involving the
floor control server interface.
#### 6.5.4.14 MCPTT session release step 1
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane e.g. when the session is going to be released, the floor
control interface:
1\. shall ignore floor control message from the floor control server;
2\. shall request the media distributor to stop distributing RTP media packets
to the network media interface of the MCPTT clients; and
3\. shall ignore any floor control messages received from the floor
participant interfaces.
#### 6.5.4.15 MCPTT session release step 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control server interface:
1\. shall release all resources associated with this session.
#### 6.5.4.16 Receiving a split instruction (R: Split)
Upon receiving an instruction from the application and signalling plane to
split the ongoing group session, as specified in 3GPP TS 24.379 [2] in
subclause 10.1.1.5.2.4 for prearranged group call and in subclause
10.1.2.5.1.4 for chat group call, the floor control server interface:
1\. shall perform the actions in subclause 6.3.2.3.
### 6.5.5 Floor participant interface procedures
#### 6.5.5.1 General
The floor participant interface shall behave according to the state diagram
and state transitions specified in this subclause.
Figure 6.5.5.1-1 shows the general floor control operation states (P states)
and the state transition diagram.
Figure 6.5.5.1-1: The \'floor participant interface state transition\' state
diagram
The floor participant interface shall keep one instance of the \'floor
participant interface state transition\' state machine per MCPTT client in a
session.
The floor participant associated to the \'floor participant interface state
transition\' state machine is in the following subclauses referred to as the
associated floor participant.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following subclauses the floor participant
interface:
1\. shall discard the floor control message;
2\. shall request the network media interface to discard any received RTP
media packet; and
3\. shall remain in the current state.
State details are explained in the following subclauses.
#### 6.5.5.2 State: \'Start-Stop\'
##### 6.5.5.2.1 General
When a new instance of the \'Floor participant interface state transition\'
state machine is initiated, before any floor control related input is applied,
the state machine is in \'Start-stop\' state. Similarly when the session is
released the state machine shall return to the \'Start-stop\' state.
##### 6.5.5.2.2 Participant invited to session
When the floor participant interface receives an indication from the floor
control server interface that an MCPTT client has accepted the invitation to a
session (i.e. when the SIP 200 (OK) response to the initial SIP INVITE request
is received as specified in 3GPP TS 24.379 [2]) , the floor participant
interface:
1\. shall enter the \'P: has no permission\' state.
#### 6.5.5.3 State: \'P: has no permission\'
##### 6.5.5.3.1 General
The floor participant interface uses this state when the associated floor
participant is not permitted to send media.
##### 6.5.5.3.2 Receive Floor Idle message (R: Floor Idle)
When the floor participant interface receives a Floor Idle message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Idle message to the floor participant;
2\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(acknowledgement is required) as specified in subclause 8.2.2, shall store an
indication that a Floor Ack message to a Floor Idle messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.3 Receive Floor Taken message (R: Floor Taken)
When the floor participant interface receives a Floor Taken message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Taken message to the floor participant;
2\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(acknowledgement is required) as specified in subclause 8.2.2, shall store an
indication that a Floor Ack message to a Floor Taken messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.4 Receive Floor Request message (R: Floor Request)
When the floor participant interface receives a Floor Request message from the
floor participant, the floor participant interface:
1\. shall send the Floor Request message to the floor control server
interface; and
2\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.5 Receive Floor Granted message (R: Floor Granted)
When the floor participant interface receives a Floor Granted message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Granted message to the floor participant;
2\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (acknowledgement is required) as specified in subclause 8.2.2, shall
store an indication that a Floor Ack message to a Floor Granted messages is
expected; and
3\. shall enter the \'P: has permission\' state.
##### 6.5.5.3.6 Receive Floor Deny message (R: Floor Deny)
When the floor participant interface receives a Floor Deny message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Deny message to the floor participant;
2\. if the first bit in the subtype of the Floor Deny message is set to \'1\'
(acknowledgement is required) as specified in subclause 8.2.2, shall store an
indication that a Floor Ack message to a Floor Deny messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.7 Receive Floor Queue Position Info message (R: Floor Queue
Position Info)
When the floor participant interface receives a Floor Queue Position Info
message from the floor control server interface, the floor participant
interface:
1\. shall send the Floor Queue Position Info message to the floor participant;
2\. if the first bit in the subtype of the Floor Queue Position Info message
is set to \'1\' (acknowledgement is required) as specified in subclause 8.2.2,
shall store an indication that a Floor Ack message to a Floor Queue Position
Info messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.8 Receive Floor Queue Position Request message (R: Floor Queue
Position Request)
When the floor participant interface receives a Floor Queue Position Request
message from the floor participant, the floor participant interface:
1\. shall send the Floor Queue Position Request message to the floor control
server interface; and
2\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.9 Receive RTP media packets (R: RTP media)
When the floor participant interface receives an indication from the network
media interface that RTP media packets are received from the media
distributor, the floor participant interface
1\. shall instruct the network media interface to send the received RTP media
packets towards the MCPTT client; and
2\. shall remain in the \'P: has no permission\' state.
When the floor participant interface receives an indication from the network
media interface that RTP media packets are received from the MCPTT client, the
floor participant interface
1\. shall send a Floor Revoke message to the floor participant. The Floor
Revoke message:
a. shall include the Reject Cause field with the \ value set to
#3 (No permission to send a Media Burst);
2\. shall store that a Floor Release message is expected from the floor
participant; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.10 Receive Floor Release message (R: Floor Release)
When the floor participant interface receives a Floor Release message from the
floor participant, the floor participant interface:
1\. if a Floor Release message is not expected from the floor participant:
a. if the first bit in the subtype of the Floor Release message is set to
\'1\' (acknowledgement is required) as specified in subclause 8.2.2, based on
local policy:
i shall send a Floor Ack message to the floor participant and set the first
bit in the subtype of the Floor Release message to \'0\' (acknowledgement is
not required) in the outgoing Floor Release message; or
ii. wait for the Floor Ack from the floor control server; and
b. shall forward the Floor Release message to the floor control server
interface;
2\. if a Floor Release message is expected from the floor participant:
a. if the first bit in the subtype of the Floor Release message is set to
\'1\' (acknowledgement is required) as specified in subclause 8.2.2:
i. shall send a Floor Ack message to the floor participant; and
b. shall remove that a Floor Release message is expected from the floor
participant; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.11 Receive split instruction (R: Split)
Upon receiving an instruction to split the ongoing MCPTT call, to the floor
participant interface:
1\. shall create a new instance of the \'basic floor control operation towards
the floor participant\' state machine;
2\. shall move information associated with the instance used for \'floor
participant interface state transition\' to the \'basic floor control
operation towards the floor participant\' state machine;
NOTE: Which information that needs to be moved is an implementation option.
3\. shall enter the \'Start-stop\' state and terminate the \'floor participant
state transition\' state machine associated with this floor participant and
this session;
4\. if the state in \'general floor control operation\' state machine is \'G:
Floor Idle\' state; shall enter the \'U: not permitted and Floor Idle\' state
as specified in subclause 6.3.5.3.2; and
5\. if the state in \'general floor control operation\' state machine is \'G:
Floor Taken\' state; shall enter the \'U: not permitted and Floor Taken\'
state as specified in subclause 6.3.5.4.2.
#### 6.5.5.4 State: \'P: has permission\'
##### 6.5.5.4.1 General
The floor participant interface uses this state when the floor participant has
permission to send media
##### 6.5.5.4.2 Receive RTP media packets
When the floor participant interface receives an indication from the network
media interface that RTP media packets are received from the MCPTT client, the
floor participant interface:
1\. shall instruct the media interface to forward received RTP media packets
towards the media distributor; and
2\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.3 Receive Floor Release message
When the floor participant interface receives a Floor Release message from the
floor participant, the floor participant interface:
1\. shall send the Floor Release message to the floor control server
interface; and
3\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.4 Receive Floor Ack message
When the floor participant interface receives a Floor Ack message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Ack message to the floor participant; and
2\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.5 Receive Floor Idle message
When the floor participant interface receives a Floor Idle message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Idle message to the floor participant;
2\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(acknowledgement is required), shall store an indication that a Floor Ack
message to a Floor Idle messages is expected; and
3\. shall enter the \'P: has no permission\' state.
##### 6.5.5.4.6 Receive Floor Taken message
When the floor participant interface receives a Floor Taken message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Taken message to the floor participant;
2\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(acknowledgement is required), shall store an indication that a Floor Ack
message to a Floor Taken messages is expected; and
3\. shall enter the \'P: has no permission\' state.
##### 6.5.5.4.7 Receive Floor Revoke message
When the floor participant interface receives a Floor Revoke message from the
floor control server interface, the floor participant interface:
1\. shall send the Floor Revoke message to the floor participant;
2\. if the first bit in the subtype of the Floor Revoke message is set to
\'1\' (acknowledgement is required), shall store an indication that a Floor
Ack message to a Floor Revoke messages is expected; and
3\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.8 Receive split instruction (R: Split)
Upon receiving an instruction to split the ongoing MCPTT call, the floor
participant interface:
1\. shall create a new instance of the \'basic floor control operation towards
the floor participant\' state machine as specified in subclause 6.3.5;
2\. shall move information associated with the instance used for \'floor
participant interface state transition\' to the \'basic floor control
operation towards the floor participant\' state machine;
NOTE: Which information that needs to be moved is an implementation option.
3\. shall enter the \'Start-stop\' state and terminate the \'floor participant
state transition\' state machine associated with this floor participant and
this session; and
4\. shall enter the \'U: permitted\' state as specified in subclause
6.3.5.5.2.
#### 6.5.5.5 In any state
##### 6.5.5.5.1 General
This subclause describes the actions to be taken in all states defined for the
\'floor participant state transition\' diagram with the exception of the
\'Start-stop\' and \'Releasing\' states.
##### 6.5.5.5.2 Receive Floor Ack message (R: Floor Ack)
If a Floor Ack message is received from the floor participant, the floor
participant interface:
1\. if an indication exists that a Floor Ack message is expected for the
message in the Message Type field;
a. shall forward the Floor Ack message to the floor control server interface;
and
b. shall remove the indication that a Floor Ack message is expected for the
message in the Message Type field; and
NOTE: It is an implementation option what action to take if an indication
exists that a Floor Ack message is expected for the message in the Message
Type field, but the Floor Ack message is not received
2\. shall remain in the current state.
If a Floor Ack message is received from the floor control server interface,
the floor participant interface:
1\. shall send the Floor Ack message to the floor participant; and
2\. shall remain in the current state.
##### 6.5.5.5.3 MCPTT session release step 1 (MCPTT call release - 1)
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane e.g. when the session is going to be released or when the
MCPTT client leaves the session, the floor participant interface:
1\. shall stop sending floor control messages to the floor participant;
2\. shall request the network media interface to stop sending RTP media
packets towards to the MCPTT client;
3\. shall ignore any floor control messages received from the floor
participant;
4\. shall request the network media interface to stop forwarding RTP media
packets from the MCPTT client to the media distributor;
5\. shall indicate to the floor control server interface that the MCPTT client
has started to disconnect from the session; and
6\. shall enter the \'P: Releasing\' state.
#### 6.5.5.6 State: \'P: Releasing\'
##### 6.5.5.6.1 General
The floor participant interface uses this state while waiting for the
application and signalling plane to finalize the release of the session or
finalizing the removal of the MCPTT client from the session.
##### 6.5.5.6.2 MCPTT session release step 2 (MCPTT call release - 2)
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor participant interface:
1\. shall request the network media interface to release all resources
associated with this MCPTT client for this MCPTT call; and
2\. shall enter the \'Start-stop\' state and terminate the \'floor participant
state transition\' state machine associated with this floor participant and
this session.
# 7 Off-network floor control
## 7.1 General
A floor control session may be initiated only if there is a successfully
established off-network call.
In off-network, floor control is performed using floor control messages among
the MCPTT clients without a centralized floor arbitrator. When off-network, if
a floor control session is active, the floor arbitrator and the floor
participant are co-located in the MCPTT client (see 3GPP TS 23.379 [5]).
During a floor control session the MCPTT client currently speaking serves as
the temporary floor arbitrator. All other MCPTT clients in the call play the
role of floor participant. When the floor arbitrator grants the floor to
another MCPTT client, that new MCPTT client, when starts to send media,
becomes the new floor arbitrator and the former (the MCPTT client which
granted the floor) becomes a floor participant.
The procedures in subclause 7.2 are from the perspective of a single MCPTT
client. No special message other than floor control messages and media is used
for coordinating the floor arbitrator and floor participant status of the
separate MCPTT clients participating in the off-network call.
The floor control messages are always sent to all the participants of the
call. Therefore they can be monitored by any MCPTT client listening to the
call.
In a floor control session queueing of floor requests may be supported.
It is assumed that the MCPTT user presses the PTT button for requesting talk
permission and keeps it pressed until the request is resolved. If queueing of
floor requests is not supported, this request is either granted or rejected or
no answer is received. If the request is granted the user is notified with
talk permission tone (or equivalent) and the user continues to press the PTT
until the user finishes the talk burst. If the request is rejected or no
answer is received the user is notified and releases the PTT button.
If queueing of floor requests is supported, the MCPTT user shall be notified
when a floor request is queued and the MCPTT user shall release the PTT
button. When, after queueing, the floor is granted to this user the MCPTT user
shall be informed that the queued request is now granted. Then the MCPTT user
should press the PTT button within a short duration. Otherwise, the grant is
taken from this MCPTT user. An MCPTT user can appear in a queue only once. The
floor request queue is transferred from the former to the new floor
arbitrator.
After the initiation of a floor control session the MCPTT client behaves
according to the state machine presented in subclause 7.2.3. The state machine
is designed such that in normal cases only one of the MCPTT clients, which
participates in the call, acts as floor arbitrator and all others act as floor
participants. However, there may be situations such that more than one MCPTT
client are at an internal state causing them to act as floor arbitrator. A
short sequence of floor control messages and RTP media packets are initiated
to resolve these situations.
## 7.2 Floor participant procedures
### 7.2.1 Floor participant procedures at MCPTT session initialization
This subclause applies when no active floor control session exists.
Before a floor control entity is initiated a state machine with a single
state, named as \'Start-stop\' state, shall exist. At \'Start-stop\' state,
when the MCPTT client receives a request of the MCPTT call control entity to
initiate the floor control as originating client, then the MCPTT client shall
initiate a floor control entity and the floor control entity shall enter into
the \'O: has permission\' state. Otherwise, if MCPTT client receives a request
of the MCPTT call control entity to initiate the floor control as terminating
client, then the MCPTT client shall initiate a floor control entity and the
floor control entity for an MCPTT group call shall enter into the \'O:
silence\' state or for both MCPTT private call and MCPTT broadcast call shall
enter the \'O: has no permission\' state.
Once the session is initiated, the initial floor control messages are sent
according to the state machine presented in subclause 7.2.3. Normally, once
the session is started the originating MCPTT client has the floor implicitly.
For an on-going off-network group call, if an MCPTT client joins later, then
it starts the floor control session and takes the role of floor participant
and enters \'O: silence\' state.
#### 7.2.1.2 Determine off-network floor priority
Upon receiving a Floor Request message, to determine the floor priority of the
Floor Request message, the floor arbitrator:
1\. shall check the presence of Floor Priority field in the received Floor
Request message. If present, the floor arbitrator:
a. shall determine the floor priority of the Floor Request message by choosing
the lowest value from the following inputs:
i. the value of the Floor Priority field in the received Floor Request
message;
ii. the value of the \"/_\
_/\/Common/MCPTTGroupMemberList/\/UserPriority\" leaf node of the
sender of the Floor Request message, present in group configuration as
specified in 3GPP TS 24.483 [4]; and
iii. the value of the \"/\/OffNetwork/NumLevelHierarchy\" leaf node present
in service configuration as specified in 3GPP TS 24.483 [4]; and
2\. if the Floor Priority field is not present in the Floor Request message,
the floor arbitrator:
a. shall use the minimum value allowed for the Floor Priority as floor
priority of the Floor Request message.
Once the floor priority of the Floor Request message is determined, to
determine the effective priority of the Floor Request message, the floor
arbitrator:
1\. shall check the type of call indicated by the Floor Indicator field of the
received Floor Request message and:
a. if the type of call indicated by the Floor Indicator field is Normal call:
i. if the current type of the call is normal, shall continue to check the next
input parameter from step 2; and
ii if the current type of the call is emergency or imminent-peril and:
A. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
shall queue the floor request;
B. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to
\"false\", shall deny the floor request; and
C. shall skip step 2;
b. if the type of call indicated by the Floor Indicator field is Imminent
peril call and:
i. if the current type of the call is normal, shall pre-empt the current
talker, grant the floor request and skip step 2;
ii. if the current type of the call is imminent-peril, shall continue to check
the next input parameter from step 2; and
iii. if the current type of the call is emergency and:
A. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
shall queue the floor request;
B. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to
\"false\", shall deny the floor request; and
C. shall skip step 2; and
c. if the type of the call indicated by the Floor Indicator field is Emergency
call and:
i. if the current type of the call is normal or imminent-peril, shall pre-empt
the current talker and grant the floor request; and
ii. if the current type of the call is emergency and:
A. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
shall queue the floor request;
B. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to
\"false\", shall deny the floor request; and
iii shall skip step 2; and
2\. shall compare the determined floor priority of the received Floor Request
message to the effective priority of the current talker (determined at the
time of floor grant to the current talker) and:
a. if the effective priority of the current talker is equal to or higher than
the determined floor priority of the Floor Request message and:
i. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
shall queue the floor request; and
ii. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to
\"false\", shall deny the floor request; and
b. if the determined floor priority of the Floor Request message is higher
than that of the current talker, shall pre-empt the current talker and shall
grant the floor request.
### 7.2.2 Floor participant procedures at MCPTT call release
This subclause applies when an active floor control session exists.
When the off-network call is released the floor control session is terminated.
The off-network floor control session can also be terminated when no media
transmission or reception takes place during floor control session hold time,
T230 (Inactivity). The termination of the floor control session as a result of
the expiry of timer T230 (Inactivity) may terminate the call session.
### 7.2.3 Floor participant state diagram -- basic operation
#### 7.2.3.1 General
The floor participant shall behave according to the state diagram and the
transitions specified in this subclause.
The received floor messages and the RTP media packets are inputs to the state
machine according to their arrival order. They are not ignored unless
otherwise stated.
The MCPTT client also provides input to the state machine as request to talk
(press PTT button) or as end of talk (release PTT button).
Figure 7.2.3.1-1 show the \'Floor participant state diagram -- basic
operation\'.
Figure 7.2.3.1-1: \'Floor participant state diagram -- basic operation\'
State details are explained in the following subclauses.
If an RTP media packet or a floor control message arrives in a state where
there is no specific procedure specified for the RTP media packet or the
received floor control message, the floor participant shall discard the floor
control message or the RTP media packet and shall remain in the current state.
NOTE: A badly formatted RTP packet or floor control message received in any
state is ignored by the floor participant and does not cause any change of the
current state.
#### 7.2.3.2 State: \'Start-stop\'
##### 7.2.3.2.1 General
When a new instance of the state machine is created, before any floor control
related input is applied, the state machine is in the \'Start-stop\' state.
Similarly when the call is released or the floor control session is
terminated, the state machine shall return to the \'Start-stop\' state.
##### 7.2.3.2.2 MCPTT call established -- originating MCPTT user
When an MCPTT call is established with session announcement including an
explicit floor request, the originating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall send Floor Granted message towards other floor participants. The
Floor Granted message:
a. shall include the granted priority in the Floor priority field;
b. shall include the MCPTT user\'s own MCPTT ID in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall set the stored SSRC of the current florr arbitrator to its own SSRC;
and
4\. shall enter \'O: has permission\' state.
##### 7.2.3.2.3 MCPTT group call established -- terminating MCPTT user
When an MCPTT call is established the terminating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall start timer T230 (Inactivity); and
3\. shall enter \'O: silence\' state.
##### 7.2.3.2.4 MCPTT private call established -- terminating MCPTT user
When an MCPTT private call is established the terminating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall start timer T203(End of RTP media); and
3\. shall enter \'O: has no permission\' state.
##### 7.2.3.2.5 Send Floor Request message (PTT button pressed)
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a different priority than the normal priority is required, shall include
the Floor Priority field with the requested priority in the \
value;
b. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall initialize the counter C201 (Floor request) with value set to 1;
4\. shall start the timer T201 (Floor request); and
5\. shall enter \'O: pending request\' state.
##### 7.2.3.2.6 Receive Floor Taken message (R: Floor Taken)
When a Floor Taken message is received, the floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. may provide a floor taken notification to the MCPTT user;
3\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
granted floor participant field in the Floor Taken message;
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
##### 7.2.3.2.7 Receive Floor Granted message (R: Floor Granted to other)
When a Floor Granted message is received and if the User ID in the Floor
Granted message does not match its own User ID, the floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. may provide a floor taken notification to the MCPTT user;
3\. shall set the stored SSRC of the candidate floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
##### 7.2.3.2.8 Receive RTP media (R: RTP media)
Upon receiving RTP media packets, the floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. may provide a floor taken notification to the MCPTT user;
3\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
RTP media packet;
4\. shall restart timer T203 (End of RTP media);
5\. shall request the MCPTT client to start rendering received RTP media
packets; and
6\. shall enter \'O: has no permission\' state.
##### 7.2.3.2.9 MCPTT broadcast call established -- terminating MCPTT user
When an MCPTT broadcast call is established the terminating floor participant:
1\. shall create an instance of a floor participant state transition diagram
for basic operation state machine;
2\. shall start timer T203 (End of RTP media); and
3\. shall enter \'O: has no permission\' state.
NOTE: In MCPTT broadcast call, only originating MCPTT user is allowed to
request floor and transmit media. A Floor Request message is locally denied to
terminating MCPTT user, if requested.
#### 7.2.3.3 State: \'O: silence\'
##### 7.2.3.3.1 General
When in this state the MCPTT client for the session is unaware of any MCPTT
client acting as a floor arbitrator, has not itself initiated a floor control
request and is not currently receiving RTP media packets.
Timer T230 (Inactivity) is running in this state.
##### 7.2.3.3.2 Send Floor Request message (PTT button pressed)
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T201 (Floor Request); and
5\. shall enter \'O: pending request\' state.
##### 7.2.3.3.3 Receive RTP media (R: RTP media)
Upon receiving RTP media packets and if there is no stored SSRC of the current
floor arbitrator, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. shall stop timer T230 (Inactivity);
3\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
RTP media packet;
4\. shall restart (or start, if not running already) timer T203 (End of RTP
media);
5\. shall request the MCPTT client to start rendering received RTP media
packets; and
6\. shall enter \'O: has no permission\' state.
Otherwise, if SSRC of floor participant sending the media matches the stored
SSRC of current floor arbitrator, the floor participant:
1\. shall restart (or start, if not running already) timer T203 (End of RTP
media);
2\. shall stop timer T230 (Inactivity);
3\. shall request the MCPTT client to start rendering received RTP media
packets; and
4\. shall enter \'O: has no permission\' state.
##### 7.2.3.3.4 Receive Floor Granted message (R: Floor Granted to other)
When a Floor Granted message is received and if the User ID in the Floor
Granted message does not match its own User ID, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. if the Floor Indicator field is included and the B-bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
that this is a broadcast group call;
3\. shall set the stored SSRC of the candidate floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
4\. shall stop timer T230 (Inactivity);
5\. shall start timer T203 (End of RTP media); and
6\. shall enter \'O: has no permission\' state.
##### 7.2.3.3.5 Receive Floor Request message (R: Floor Request)
The transition is used in private call only. When a Floor Request message is
received, the floor participant:
1\. shall send a Floor Granted message toward the other floor participant. The
Floor Granted message:
a. shall include the MCPTT ID of the Floor Request message received in User ID
value of the User ID field;
b. shall include the SSRC of the Floor Request message received in the SSRC of
floor control server field;
c. shall include the max duration as configured in the MCPTT client in the
OffNetwork/MaxDuration parameter in the \ value of the Duration
field; and
d. shall include the priority of the Floor Request message received in the
\ value of the Floor Priority field;
2\. shall stop timer T230 (Inactivity);
3\. shall start timer T205 (Floor Granted ); and
4\. shall enter \'O: pending granted\' state.
##### 7.2.3.3.6 Receive Floor Taken message (R: Floor Taken)
When a Floor Taken message is received, the floor participant:
1\. may provide a floor taken notification to the MCPTT user;
2\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
granted floor participant field in the Floor Taken message;
3\. shall stop timer T230 (Inactivity);
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
##### 7.2.3.3.7 Timer T230 (Inactivity) expired
Upon expiry of timer T230 (Inactivity), the floor participant:
1\. shall indicate to the call control that timer T230 (inactivity) has
expired;
2\. shall terminate the instance of floor participant state transition
diagram; and
3\. shall enter \'Start-stop\' state.
#### 7.2.3.4 State: \'O: has no permission\'
##### 7.2.3.4.1 General
In this state the MCPTT client does not have permission to send media.
##### 7.2.3.4.2 Sending Floor Request message (PTT button pressed)
If the floor participant receives an indication from the MCPTT user that the
MCPTT user wants to send media, the floor participant:
1\. shall send the Floor Request message to other clients. The Floor Request
message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall initialize the counter C201 (Floor request) with value set to 1;
3\. shall start timer T201 (Floor Request); and
4\. shall enter \'O: pending request\' state.
##### 7.2.3.4.3 Receive Floor Release message (R: Floor Release)
When a Floor Release message is received and if the SSRC in the Floor Release
message matches with the stored SSRC of the current arbitrator or with the
stored SSRC of the candidate arbitrator, the floor participant:
1\. may provide floor idle notification to the MCPTT user.
2\. shall request the MCPTT client to stop rendering received RTP media
packets;
3\. shall stop timer T203 (End of RTP media);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. shall clear the stored SSRC of the current floor arbitrator; and
7\. shall enter \'O: silence\' state;
##### 7.2.3.4.4 Timer T203 (End of RTP media) expired
On expiry of T203 (End of RTP media) timer, the floor participant:
1\. may provide floor idle notification to the MCPTT user.
2\. shall request the MCPTT client to stop rendering received RTP media
packets;
3\. shall start timer T230 (Inactivity);
4\. shall clear the stored SSRC of the current floor arbitrator; and
5\. shall enter \'O: silence\' state;
##### 7.2.3.4.5 Receive Floor Granted message (R: Floor Granted to other)
When a Floor Granted message is received and if the \ value in the
User ID field does not match its own MCPTT ID and SSRC of floor participant
sending the Floor Granted message matches the stored SSRC of current floor
arbitrator, the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall restart timer T203 (End of RTP media);
3\. shall set the stored SSRC of the candidate floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
4\. may provide a floor taken notification to the MCPTT user;
5\. if the Floor Indicator field is included with the B-bit set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
that this is a broadcast group call; and
6\. shall remain in the \'O: has no permission\' state.
##### 7.2.3.4.6 Receive RTP media (R: RTP media)
Upon receiving RTP media packets and if there is no stored SSRC of the current
floor arbitrator, the floor participant:
1\. shall request the MCPTT client to render the received RTP media packets;
2\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
RTP media packet;
3\. shall clear the stored SSRC of the candidate arbitrator, if any;
4\. shall restart timer T203 (End of RTP media); and
5\. shall remain in \'O: has no permission\' state.
Otherwise, if SSRC of floor participant sending the media matches the stored
SSRC of current arbitrator, the floor participant:
1\. shall request the MCPTT client to render the received RTP media packets;
2\. shall clear the stored SSRC of the candidate arbitrator, if any;
3\. shall restart timer T203 (End of RTP media); and
4\. shall remain in \'O: has no permission\' state.
Otherwise, if SSRC of floor participant sending the media packet matches with
the stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to render the received RTP media packets;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of RTP
media packet;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall restart timer T203 (End of RTP media); and
5\. shall remain in \'O: has no permission\' state.
#### 7.2.3.5 State: \'O: has permission\'
##### 7.2.3.5.1 General
In this state the MCPTT client is acting as a floor control server (floor
arbitrator) and has the permission to send media.
Timer T206 (Stop talking warning) and timer T207 (Stop Talking) are running in
this state.
##### 7.2.3.5.2 Send RTP Media packets (S: RTP Media)
Upon receiving encoded media from the user or if encoded media is already
buffered the floor participant:
1\. shall start timer T206 (Stop talking warning), if not running;
2\. shall request the MCPTT client to start sending RTP media packets towards
other MCPTT clients; and
3\. shall remain in \'O: has permission\' state.
##### 7.2.3.5.3 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message and if the value of
\"/\/\/OffNetwork/QueueUsage\" leaf node present in the group
configuration as specified in 3GPP TS 24.483 [4] is set to \"true\", the floor
participant:
1\. shall remove the sender of the Floor Release message from the queue, if
the \ value in the floor release message matches the \ value
of the queued request; and
2\. shall remain in \'O: has permission\' state.
##### 7.2.3.5.4 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, in a session where:
1\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.483 [4] is set to \"false\"; or
2\. the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in the
group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\" but
the F-bit in the Floor Indicator field is set to \'0\' (i.e. indicating that
queueing of floor requests is not supported) or the Floor Indicator field is
not included in the Floor Request message;
then the floor participant:
1\. shall send the Floor Deny message. The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
2\. shall remain in \'O: has permission\' state.
Upon receiving a Floor Request message which is not pre-emptive as determined
by subclause 4.1.1.5, and the value of \"/\/\/OffNetwork/QueueUsage\"
leaf node present in the group configuration as specified in 3GPP TS 24.483
[4] is set to \"true\" and the F-bit in the Floor Indicator field is set to
\'1\' (i.e. indicating that queueing of the floor requests is supported) in
the Floor Request message, the floor participant:
1\. shall store the received Floor Request messages;
2\. if the pending request queue is not full, shall send the Floor Queue
Position Info message. The Floor Queue Position Info message:
a. shall include in the User ID field the MCPTT ID of the floor participant
sending the Floor Request message;
b. shall include the SSRC of the floor participant in the SSRC of queued floor
participant field;
c. shall include the position in the floor request queue in the Queue Info
field; and
d. shall include the floor priority in the Queue Info field;
3\. if the pending request queue is full, shall send the Floor Deny message.
The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #7
(Queue full);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
4\. shall remain in \'O: has permission\' state.
##### 7.2.3.5.5 Send Floor Release message (PTT button released with no
pending request in queue)
Upon receiving an indication from the MCPTT user to release permission to send
RTP media, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall send a Floor Release message towards other floor participants, if no
queued requests exist: The Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
4\. shall start timer T230 (Inactivity);
5\. shall clear the stored SSRC of the current floor arbitrator; and
6\. shall enter \'O: silence\' state.
##### 7.2.3.5.6 Send Floor Granted message (PTT button released with pending
request(s) in queue)
When no more encoded media is received from the user and if at least one Floor
Request message is stored (i.e. queueing mode is used in the session), the
floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
4\. shall send the Floor Granted message toward the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the first floor participant in the queue in
the User ID field;
b. shall include the SSRC of the first floor participant in the queue in the
SSRC of the granted floor participant field;
c. shall remove the first floor participant from the queue;
d for the remaining floor participants in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field; and
e. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
5\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
6\. shall start timer T205 (Floor Granted ) and shall initiate counter C205
(Floor Granted ) to 1; and
7 shall enter the \'O: pending granted\' state.
##### 7.2.3.5.7 Receive Floor Request message with pre-emption indication (R:
Floor Request with pre-emption)
Upon receiving a Floor Request message which is pre-emptive as determined by
subclause 4.1.1.5, the floor participant:
1\. shall stop timer T206 (Stop talking warning), if running;
2\. shall stop timer T207 (Stop talking), if running;
3\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
4\. shall send a Floor Granted message towards the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the Floor Request message received in the
User ID field;
b. shall include the SSRC of floor participant sending the Floor Request
message in the SSRC of floor control server field; and
c. if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to \"true\",
for each floor participant in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field;
5\. shall start timer T205 (Floor Granted) and shall initiate counter C205
(Floor Granted) to 1;
6\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
the user to whom the floor was granted in the Floor Granted message; and
7\. shall enter the \'O: pending granted\' state.
##### 7.2.3.5.8 Receive Floor Queue Position Request message (R: Floor Queue
Position Request)
Upon receiving a Floor Queue Position Request message, the floor participant:
1\. shall send the Floor Queue Position Info message. The Floor Queue Position
Info message:
a. shall include the floor participant's own MCPTT ID in the User ID field;
b. shall include the queue position and floor priority in the Queue Info
field;
c. shall include the value of the SSRC of floor participant requesting floor
queue status info field from the received Floor Queue Position Request message
in the SSRC of queued floor participant field; and
d. shall include the value of the User ID field from the received Floor Queue
Position Request message in the Queued User ID field; and
2\. remain in the \'O: has permission\' state.
##### 7.2.3.5.9 Transmission time limit warning (Timer T206 expires)
When timer T206 (Stop talking warning) expires, the floor participant:
1\. may notify the MCPTT user that the transmission time limit is about to
reach;
2\. shall start timer T207 (Stop talking); and
3\. shall remain in the current state.
##### 7.2.3.5.10 Transmission time limit reached with pending request(s) in
queue (Timer T207 expires)
When the timer T207 (Stop talking) expires and if at least one Floor Request
message is stored (i.e. queueing mode is used in the session), the floor
participant:
1\. shall request the MCPTT client to stop sending RTP media packets towards
other MCPTT clients;
2\. shall send the Floor Granted message toward the other floor participants.
The Floor Granted message:
a. shall include the MCPTT ID of the first floor participant in the queue in
the User ID field;
b. shall include the SSRC of the first floor participant in the queue in the
SSRC of the granted floor participant field;
c. shall remove the first floor participant from the queue;
d. for the remaining floor participants in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field; and
e. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
4\. shall start timer T205 (Floor Granted ) and shall initiate counter C205
(Floor Granted ) to 1; and
5 shall enter the \'O: pending granted\' state.
##### 7.2.3.5.11 Transmission time limit reached with no pending request in
queue (Timer T207 expires)
When timer T207 (Stop talking) expires with no pending requests in the queue
or if the value of \"/\/\/OffNetwork/QueueUsage\" leaf node present in
the group configuration as specified in 3GPP TS 24.483 [4] is set to
\"false\", the floor participant:
1\. shall send a Floor Release message towards other floor participants. The
Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
2\. shall start timer T230 (Inactivity);
3\. shall clear the stored SSRC of the current floor arbitrator; and
4\. shall enter \'O: silence\' state.
#### 7.2.3.6 State: \'O: pending request\'
##### 7.2.3.6.1 General
In this state the MCPTT client is waiting for a response to a Floor request
message.
In this state timer T201 (Floor Request) is running.
To resolve race condition between multiple simultaneous floor requests, the
MCPTT client resets the counter associated with timer T201, if another floor
request with higher priority or higher SSRC, in case the priority is same, is
received.
##### 7.2.3.6.2 Receive RTP media (R: RTP media)
Upon receiving RTP media packets and if there is no stored SSRC of the current
floor arbitrator, the floor participant:
1\. shall request the MCPTT client to render the RTP media packets;
2\. shall reset the value of the counter C201 (Floor Request) to 1;
3\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
RTP media packet;
4\. shall restart (or start, if not running already) timer T203 (End of RTP
media); and
5\. shall remain in \'O: pending request\' state.
Otherwise, if SSRC of floor participant sending the media matches with the
stored SSRC of current floor arbitrator, the floor participant:
1\. shall request the MCPTT client to render the RTP media packets;
2\. shall reset the value of the counter C201 (Floor Request) to 1;
3\. shall restart (or start, if not running already) timer T203 (End of RTP
media); and
4\. shall remain in \'O: pending request\' state.
Otherwise, if SSRC of floor participant sending the media packet matches with
the stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to render the RTP media packets;
2\. shall reset the value of the counter C201 (Floor Request) to 1;
3\. shall set the stored SSRC of the current arbitrator to the SSRC of RTP
media packet;
4\. shall clear the stored SSRC of the candidate arbitrator;
5\. shall restart (or start, if not running already) timer T203 (End of RTP
media); and
6\. shall remain in \'O: pending request\' state.
##### 7.2.3.6.3 Receive Floor Queue Position Info message (R: Floor Queue
Position Info)
Upon receiving Floor Queue Position Info message, if the \ value in
the Queued User ID field matches its own MCPTT ID and the value in the SSRC of
floor control server field as received in the Floor Queue Position Info
message matches the stored SSRC of current floor arbitrator, the floor
participant:
1\. shall update the queue status;
2\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
3\. shall stop timer T201 (Floor Request); and
4\. shall enter \'O: queued\' state.
Otherwise, if the \ value in the Queued User ID field matches its own
MCPTT ID and there is no stored SSRC of the current floor arbitrator, the
floor participant:
1\. shall update the queue status;
2\. shall set the stored SSRC of the current floor arbitrator to the value in
the SSRC of floor control server field as received in the Floor Queue Position
Info message;
3\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
4\. shall stop timer T201 (Floor Request); and
5\. shall enter \'O: queued\' state.
Otherwise, if the \ value in the Queued User ID field matches its own
MCPTT ID and the value in the SSRC of floor control server field as received
in the Floor Queue Position Info message matches the stored SSRC of candidate
arbitrator, the floor participant:
1\. shall update the queue status;
2\. shall set the stored SSRC of the current arbitrator to the value in the
SSRC of the floor control server field as received in the Floor Queue Position
Info message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. may notify the MCPTT user about the queue position received in the \ value in the Queue Info field;
5\. shall stop timer T201 (Floor Request); and
6\. shall enter \'O: queued\' state.
##### 7.2.3.6.4 Receive Floor Deny message (R: Floor Deny)
Upon receiving Floor Deny message, if the \ value in the User ID
field matches its own MCPTT ID and SSRC of floor participant sending the Floor
Deny message matches the stored SSRC of current floor arbitrator, the floor
participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall provide floor deny notification to the user;
3\. shall restart the timer T203 (End of RTP media);
4\. may display the floor deny reason to the user using information in the
Reject Cause field; and
5\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and there is no stored SSRC of the current floor arbitrator, the floor
participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall set the stored SSRC of the current floor arbitrator to the value in
the SSRC of floor control server field as received in the Floor Deny message;
3\. shall restart the timer T203 (End of RTP media);
4\. shall provide floor deny notification to the user;
5\. may display the floor deny reason to the user using information in the
Reject Cause field; and
6\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Deny message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall stop the timer T201 (Floor Request);
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Deny message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall restart the timer T203 (End of RTP media);
5\. shall provide floor deny notification to the user;
6\. may display the floor deny reason to the user using information in the
Reject Cause field; and
7\. shall enter \'O: has no permission\' state.
##### 7.2.3.6.5 Send Floor Release message (PTT button released)
When an indication from the MCPTT user to release the pending request for the
floor is received, the floor participant:
1\. shall send a Floor Release message towards other floor participants. The
Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the \ value of the
User ID field; and
b. if the session is not initiated as a broadcast group call with the B-bit
set to \'1\' (Broadcast group call), shall include a Floor Indicator field set
to \'0\' (normal call);
2\. shall stop the timer T201 (Floor Request);
3\. shall stop timer T203 (End of RTP media), if running;
4\. shall start the timer T230 (Inactivity);
5\. shall clear the stored SSRC of the current floor arbitrator; and
6\. shall enter \'O: silence\' state.
##### 7.2.3.6.6 Send Floor Taken message (Timer T201 expired N times)
When timer T201 (Floor Request) expires and counter C201 (Floor Request)
reaches its upper limit, the floor participant:
1\. shall send the Floor Taken message toward the other floor participants.
The Floor Taken message:
a. shall include the floor participant\'s own SSRC in the SSRC of the granted
floor participant field;
b. shall include the floor participant\'s own MCPTT ID in the User ID field;
and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
3\. shall stop timer T203 (End of RTP media), if running; and
4\. shall enter \'O: has permission\' state.
##### 7.2.3.6.7 Receive Floor Granted message (R: Floor Granted to me)
Upon receiving Floor Granted message and if the \ value in the User
ID field matches its own MCPTT ID and SSRC of floor participant sending the
Floor Granted message matches the stored SSRC of current floor arbitrator, the
floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
3\. shall stop timer T203 (End of RTP media), if running;
4\. shall stop timer T201 (Floor Request);
5\. may provide a floor granted notification to the MCPTT user;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall enter \'O: has permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and there is no stored SSRC of the current floor arbitrator, the floor
participant:
1\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
2\. shall stop timer T203 (End of RTP media);
3\. shall stop timer T201 (Floor Request);
4\. may provide a floor granted notification to the MCPTT user;
5\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
6\. shall enter \'O: has permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Granted message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall set the stored SSRC of the current arbitrator to its own SSRC;
2\. shall stop timer T203 (End of RTP media);
3\. shall stop timer T201 (Floor Request);
4\. may provide a floor granted notification to the MCPTT user;
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall enter \'O: has permission\' state.
##### 7.2.3.6.8 Receive Floor Granted message (R: Floor Granted to other)
Upon receiving a Floor Granted message and if the \ value in the User
ID field does not match its own MCPTT ID and SSRC of floor participant sending
the Floor Granted message matches the stored SSRC of current arbitrator, the
floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall set the stored SSRC of the candidate arbitrator to the SSRC of user
to whom the floor was granted in the Floor Granted message;
3\. shall reset the counter C201 (Floor Request) associated with timer T201
(Floor Request) with the value set to 1;
4\. shall restart timer T203 (End of RTP media);
5\. shall restart timer T201 (Floor Request);
6\. may provide a floor taken notification to the MCPTT user;
7\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
8\. shall remain in \'O: pending request\' state.
Otherwise, if the \ value in the User ID field does not match its own
MCPTT ID and there is no stored SSRC of the current floor arbitrator, the
floor participant:
1\. shall set the stored SSRC of the candidate floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
2\. shall reset the counter C201 (Floor Request) associated with timer T201
(Floor Request) with the value set to 1;
3\. shall restart timer T203 (End of RTP media);
4\. shall restart timer T201 (Floor Request);
5\. may provide a floor taken notification to the MCPTT user;
6\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall remain in \'O: pending request\' state.
Otherwise, if the \ value in the User ID field does not match its own
MCPTT ID and SSRC of floor participant sending the Floor Granted message
matches the stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall set the stored SSRC of the candidate arbitrator to the SSRC of user
to whom the floor was granted in the Floor Granted message;
3\. shall reset the counter C201 (Floor Request) associated with timer T201
(Floor Request) with the value set to 1;
4\. shall restart timer T203 (End of RTP media);
5\. shall restart timer T201 (Floor Request);
6\. may provide a floor taken notification to the MCPTT user;
7\. if the Floor Indicator field is included and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
8\. shall remain in \'O: pending request\' state.
##### 7.2.3.6.9 Timer T201 (Floor Request) expired (Timer T201 expired)
On expiry of timer T201 (Floor Request) if the counter C201 (Floor Request)
has not reached its upper limit, the floor participant:
1\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID of the own MCPTT user in the User ID field; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall restart the timer T201 (Floor Request) and increment counter C201
(Floor Request) by 1; and
3\. shall remain in the \'O: pending request\' state.
##### 7.2.3.6.10 Receive Floor Request message (R: Floor request)
Upon receiving Floor Request message, if the priority of received request is
higher than priority of the floor participant or if the SSRC of received
request is higher, if the priority is same, the floor participant:
1\. shall reset the value of the counter C201 (Floor Request) to 1;
2\. shall re-start timer T201 (Floor Request); and
3\. shall remain in \'O: pending request\' state.
##### 7.2.3.6.11 Receive Floor Taken message (R: Floor Taken)
Upon receiving a Floor Taken message, the floor participant:
1\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
granted floor participant field the Floor Taken message;
2\. shall reset the value of the counter C201 (Floor request) to 1;
3\. shall restart timer T201 (Floor request); and
4\. shall remain in \'O: pending request\' state.
#### 7.2.3.7 State: \'O: pending granted\'
##### 7.2.3.7.1 General
In this state the MCPTT client is waiting for another client to take over the
role of floor arbitrator.
The timer T205 (Floor Granted) is running in this state.
##### 7.2.3.7.2 Receive RTP media (R: RTP Media)
Upon receiving the RTP media and the SSRC of RTP media packet matches with the
stored SSRC of current floor arbitrator, the floor participant:
1\. shall request the MCPTT client to render the received RTP media packets;
2\. shall stop timer T205 (Floor Granted), if running;
3\. shall stop timer T233 (Pending user action), if running;
4\. shall start timer T203 (End of RTP media); and
5\. shall enter \'O: has no permission\' state.
##### 7.2.3.7.3 Timer T205 (Floor Granted) expired (timer T205 expired)
On expiry of timer T205 (Floor Granted) and counter C205 (Floor Granted) is
less than the upper limit, the floor participant:
1\. shall send again the Floor Granted message toward the other floor
participants. For each participant in the queue the Floor Granted message:
a. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
b. shall include the SSRC of the floor participant in the SSRC of queued floor
participant field;
c. shall include the queue position of the floor participant in the Queue Info
field; and
d. shall include the priority of the floor participant in the Queue Info
field;
2\. shall restart timer T205 (Floor Granted) and shall increment counter C205
(Floor Granted) by 1; and
3\. shall remain in \'O: pending granted\' state.
##### 7.2.3.7.4 Timer T205 (Floor Granted) expired N times with pending
request(s) in the queue (Timer T205 expired N times AND pending request(s) in
queue)
On the expiry of timer T205 (Floor Granted) for the configured upper limit of
counter C205 (Floor Granted) with request pending in the queue, the floor
participant:
1\. shall reset the value of counter C205 (Floor Granted) to 1;
2\. shall start the timer T233 (Pending user action); and
3\. shall remain in \'O: pending granted\' state.
##### 7.2.3.7.5 Timer T205 (Floor Granted) expired N times with no pending
request in the queue (Timer T205 expired N times AND no pending request in
queue)
On the expiry of timer T205 (Floor Granted) for the configured upper limit of
counter C205 (Floor Granted) with no request pending in the queue, the floor
participant:
1\. shall reset the value of counter C205 (Floor Granted) to 1;
2\. shall start timer T230 (Inactivity);
3\. shall clear the stored SSRC of the current floor arbitrator; and
4\. shall enter \'O: silence\' state.
##### 7.2.3.7.6 Timer T233 (Pending user action) expires with no pending
request in the queue (Timer T233 expired AND no pending request in queue)
On expiry of timer T233 (Pending user action) with no request pending in the
queue, the floor participant:
1\. shall send a Floor Release message towards other floor participants. The
Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field;
2\. shall start timer T230 (Inactivity);
3\. shall clear the stored SSRC of the current floor arbitrator; and
4\. shall enter \'O: silence\' state.
##### 7.2.3.7.7 Timer T233 (Pending user action) expires with pending
request(s) in the queue (Timer T233 expired AND pending request(s) in queue)
On the expiry of timer T233 (Pending user action) with more request(s) pending
in the queue, the floor participant:
1\. shall send the Floor Granted message for the next pending request in the
queue towards other floor participants. The Floor Granted message:
a. shall include the MCPTT ID of the first floor particant in the queue in the
User ID field;
b. shall include the SSRC of the first floor participant in the queue in the
SSRC of the granted floor participant field;
c. shall remove the first floor participant from the queue;
d. for the remaining floor participants in the queue:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of floor participant in the Queue Info
field;
iv. shall include the priority of the floor participant in the Queue Info
field; and
e. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
2\. shall set the stored SSRC of the current floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message;
3\. shall start timer T205 (Floor Granted);
4\. shall initialize the counter C205 (Floor Granted) with the value set to 1;
and
5\. shall remain in \'O: pending granted\' state.
##### 7.2.3.7.8 PTT button pressed
If the floor participant receives an indication from the MCPTT user to send
media, the floor participant:
1\. may notify the MCPTT user about rejection; and,
2\. shall remain in \'O: pending granted\' state.
##### 7.2.3.7.9 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message, the floor participant:
1\. shall remove the sender of the Floor Release message from the queue, if
the User ID in the floor release message matches the queued request of User
ID; and
2\. shall remain in \'O: pending granted\' state.
##### 7.2.3.7.10 Receive Floor Request message (R: Floor Request)
When a Floor Request message is received, the floor participant:
1\. if the SSRC in the received Floor Request message equals the stored SSRC
of the current floor arbitrator,
a. shall send again the Floor Granted message toward the other floor
participants. For each participant in the queue the Floor Granted message:
i. shall include the MCPTT ID of the floor participant in the Queued User ID
field;
ii. shall include the SSRC of the floor participant in the SSRC of queued
floor participant field;
iii. shall include the queue position of the floor participant in the Queue
Info field; and
iv. shall include the priority of the floor participant in the Queue Info
field; and
b. shall restart timer T205 (Floor Granted) and shall increment counter C205
(Floor Granted) by 1;
2\. if the SSRC in the received Floor Request message does not equal the
stored SSRC of the current floor arbitrator, shall send the Floor Deny message
toward the other floor participant. The Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. shall include the User ID field received in the Floor Request message; and
3\. shall remain in 'O: pending granted' state.
#### 7.2.3.8 State: \'O: queued\'
##### 7.2.3.8.1 General
In this state the MCPTT client is waiting for a response to a queued request.
##### 7.2.3.8.2 Receive RTP media (R: RTP media)
Upon receiving RTP media packets and the SSRC of RTP media packet matches with
the stored SSRC of current floor arbitrator, the floor participant:
1\. shall request the MCPTT client to render the RTP media packets;
2\. shall restart timer T203 (End of RTP media); and
3\. shall remain in \'O: queued\' state.
Otherwise, if SSRC of floor participant sending the media packet matches with
the stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to render the RTP media packets;
2\. shall restart timer T203 (End of RTP media);
3\. shall set the stored SSRC of the current arbitrator to the SSRC of RTP
media packet;
4\. shall clear the stored SSRC of the candidate arbitrator; and
5\. shall remain in \'O: queued\' state.
##### 7.2.3.8.3 Receive Floor Queue Position Info message (R: Floor Queue
Position Info)
Upon receiving Floor Queue Position Info message, if the \ value in
the Queued User ID field matches its own MCPTT ID and SSRC of floor
participant sending the Floor Queue Position Info message matches the stored
SSRC of current floor arbitrator, the floor participant:
1\. shall update the queue position;
2\. shall notify the MCPTT user about the queue position received in the
\ value in the Queue Info field;
3\. shall stop timer T204 (Floor Queue Position request); and
4\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Queue Position Info message
matches the stored SSRC of candidate arbitrator, the floor participant:
1\. shall update the queue position;
2\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Queue Position Info message;
3\. shall clear the stored SSRC of the candidate arbitrator;
4\. shall notify the MCPTT user about the queue position received in the
\ value in the Queue Info field;
5\. shall stop timer T204 (Floor Queue Position request); and
6\. shall remain in \'O: queued\' state.
##### 7.2.3.8.4 Receive Floor Deny message (R: Floor Deny)
Upon receiving Floor Deny message, if the \ value in the User ID
field matches its own MCPTT ID and SSRC of floor participant sending the Floor
Deny message matches the stored SSRC of current floor arbitrator, the floor
participant:
1\. shall stop timer T204 (Floor Queue Position request), if running;
2\. shall stop the timer T233 (Pending user action), if running;
3\. shall provide floor deny notification to the user;
4\. may display the floor deny reason to the user using information in the
Reject Cause field; and
5\. shall enter \'O: has no permission\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Deny message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall stop timer T204 (Floor Queue Position request), if running;
2\. shall stop the timer T233 (Pending user action), if running;
3\. shall set the stored SSRC of the current arbitrator to the SSRC of the
floor control server as received in the Floor Deny message;
4\. shall clear the stored SSRC of the candidate arbitrator;
5\. shall provide floor deny notification to the user;
6\. may display the floor deny reason to the user using information in the
Reject Cause field; and
7\. shall enter \'O: has no permission\' state.
##### 7.2.3.8.5 User indication for release of pending request
When an indication from the MCPTT user to release the queued request for the
floor is received, the floor participant:
1\. shall send a Floor Release message towards other floor participants. The
Floor Release message:
a. shall include the MCPTT ID of the MCPTT user in the User ID field;
2\. shall stop timer T204 (Floor Queue Position request), if running;
3\. shall stop timer T233 (Pending user action), if running; and
4\. shall enter \'O: has no permission\' state.
##### 7.2.3.8.6 Receive Floor Granted message (R: Floor Granted to me)
Upon receiving Floor Granted message and if the \ value in the User
ID field matches its own MCPTT ID and SSRC of floor participant sending the
Floor Granted message matches the stored SSRC of current floor arbitrator, the
floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall start timer T233(Pending user action), if not running already;
3\. shall notify the MCPTT user about of the floor grant;
4\. if the Floor Indicator field is included, and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
5\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field matches its own MCPTT
ID and SSRC of floor participant sending the Floor Granted message matches the
stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall start timer T233(Pending user action), if not running already;
3\. shall notify the MCPTT user about of the floor grant;
4\. shall set the stored SSRC of the current arbitrator to its own SSRC;
5\. shall clear the stored SSRC of the candidate arbitrator;
6\. if the Floor Indicator field is included, and the B bit is set to \'1\'
(Broadcast group call), shall provide a notification to the user indicating
the type of call; and
7\. shall remain in \'O: queued\' state.
##### 7.2.3.8.7 Timer T233 (Pending user action) expires
On expiry of timer T233 (Pending user action), the floor participant:
1\. shall stop timer T204 (Floor Queue Position request), if running;
2\. shall start timer T230 (Inactivity); and
3\. shall enter \'O: silence\' state.
##### 7.2.3.8.8 User indication for accept of pending request
If the floor participant receives an indication from the user that the user
wants to send media and the timer T233 (pending user action) is running, the
floor participant:
1\. shall stop timer T204 (Floor Queue Position request), if running;
2\. shall stop the timer T233 (Pending user action);
3\. shall set the stored SSRC of the current floor arbitrator to its own SSRC;
and
4\. shall enter \'O: has permission\' state.
##### 7.2.3.8.9 Receive Floor Granted message (R: Floor Granted to other)
Upon receiving Floor Granted message and if the \ value in the User
ID field does not match its own MCPTT ID and SSRC of floor participant sending
the Floor Granted message matches the stored SSRC of current floor arbitrator,
the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall restart timer T203 (End of RTP media);
3\. shall set the stored SSRC of the candidate floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message; and
4\. shall remain in \'O: queued\' state.
Otherwise, if the \ value in the User ID field does not match its own
MCPTT ID and SSRC of floor participant sending the Floor Granted message
matches the stored SSRC of candidate arbitrator, the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall restart timer T203 (End of RTP media);
3\. shall set the stored SSRC of the candidate floor arbitrator to the SSRC of
user to whom the floor was granted in the Floor Granted message; and
4\. shall remain in \'O: queued\' state.
##### 7.2.3.8.10 Timer T203 (End of RTP media) expires
On expiry of timer T203 (End of RTP media), the floor participant:
1\. shall request the MCPTT client to stop rendering received RTP media
packets;
2\. shall send the Floor Request message to other floor participants. The
Floor Request message:
a. if a priority different than the default floor priority is required, shall
include the Floor Priority field with the requested priority in the \ element;
b. shall include the MCPTT ID in the \ value; and
c. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types;
3\. shall stop timer T204 (Floor Queue Position request), if running;
4\. shall initialize the counter C201 (Floor request) with value set to 1;
5\. shall start timer T201 (Floor Request);
6\. shall clear the stored SSRC of the current floor arbitrator; and
7\. shall enter \'O: pending request\' state.
##### 7.2.3.8.11 Send Floor Queue Position Request message (R: Request queue
position info)
Upon receipt of an indication from the MCPTT client to request the queue
position information, the floor participant:
1\. shall send the Floor Queue Position Request message; The Floor Queue
Position Request message:
a. shall include the SSRC of sent Floor Request message in SSRC of floor
participant field; and
b. shall include the own MCPTT User ID in User ID field;
2\. shall initialize the counter C204 (Floor Queue Position request) with
value set to 1;
3\. shall start timer T204 (Floor Queue Position request); and
4\. remain in the \'O: queued\' state.
##### 7.2.3.8.12 Timer T204 (Floor Queue Position request) expires
Upon expiry of timer T204 (Floor Queue Position request), the floor
participant:
1\. shall send the Floor Queue Position Request message; The Floor Queue
Position Request message:
a. shall include the SSRC of sent Floor Request message in SSRC of floor
participant field; and
b. shall include the own MCPTT User ID in User ID field;
2\. shall increment the value of counter C204 (Floor Queue Position request)
by 1;
3\. shall start timer T204 (Floor Queue Position request); and
4\. remain in the \'O: queued\' state.
##### 7.2.3.8.13 Timer T204 (Floor Queue Position request) expires N times
Upon expiry of timer T204 (Floor Queue Position request) when the value of the
counter C204 (Floor Queue Position request) is equal to the value upper limit,
the floor participant:
1\. shall reset the counter C204 (Floor Queue Position request) with value set
to 1;
2\. shall start timer T230 (Inactivity);
3\. shall clear the stored SSRC of the current floor arbitrator; and
4\. shall enter \'O: silence\' state.
#### 7.2.3.9 In any state
##### 7.2.3.9.1 General
This subclause describes the actions to be taken in all states defined for the
basic state diagram with the exception of the \'Start-stop\' state.
##### 7.2.3.9.2 Receive MCPTT call release (R: MCPTT call release)
Upon receiving an MCPTT call release request from the application and
signalling plane when the MCPTT call is going to be released, the floor
participant:
1\. shall stop sending floor control messages towards other floor
participants;
2\. shall request the MCPTT client to stop sending and receiving RTP media
packets;
3\. shall release all resources including any running timers associated with
the MCPTT call;
4\. shall terminate the instance of floor participant state transition
diagram; and
5\. shall enter \'Start-stop\' state.
# 8 Coding
## 8.1 Introduction
### 8.1.1 General
The media plane control protocols specified in the present document are based
on the RTCP Application Packets (RTCP: APP), as defined in IETF RFC 3550 [3],
but the media plane control messages do not conform to the rules for compound
RTCP packets or RTCP packet transmission.
Each media plane control message is one RTCP: APP packet. These RTCP: APP
packets are not to be sent in compound RTCP packets, but more than one media
plane control message can be sent in a single IP packet.
The three first 32-bit words in any of the media plane control protocols
defined in the present document are structured commonly as described in
subclause 8.1.2.
Outside tables, binary values are expressed with a decimal value with single
quotation marks e.g. 00000000 is \'0\', 00000001 is \'1\', 00000010 is \'2\'
and so on.
### 8.1.2 RTCP: APP message format
The definition of the fields in the RTCP APP packet is found in IETF RFC 3550
[3].
Table 8.1.2-1 shows the RTCP APP packet format.
Table 8.1.2-1: RTCP: APP message format
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name (ASCII) \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| application-dependent data \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Secure RTCP message part \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
**[P]{.underline}**
The padding bit P is set to \'0\'.
**[Subtype:]{.underline}**
Dependent upon the relevant set of media plane control messages, as identified
by the Name field, the possible Subtype values are defined in the following
tables:
\- Name field = \"MCPT\" (i.e. Floor control): Table 8.2.2.1-1
\- Name field = \"MCPC\" (i.e. Pre-established session call control): Table
8.3.2-1
\- Name field= \"MCMC\" (i.e. MBMS subchannel control): Table 8.4.2-1
**[Length]{.underline}**
The length field in the RTCP header is the length of the packet in 32-bit
words, not counting the first 32-bit word in which the length field resides.
NOTE: The length field can indicate message size longer than specified in this
version of the protocol. This can be the case e.g. if message is of later
version of this protocol.
**[SSRC]{.underline}**
The content of this field is described for each floor control message
separately.
**[Name]{.underline}**
The 4-byte ASCII string in the RTCP header is used to define the set of media
plane control messages to be unique with respect to other APP packets that the
media plane might receive.
The present document specified the use of the following names:
1\. For the floor control protocol specified in the present document the ASCII
name string is: MCPT (Mission Critical Push-to-Talk).
2\. For the pre-established session call control protocol specified in the
present document the ASCII name string is: MCPC (Mission Critical Pre-
established Session Control).
3\. For the MBMS subchannel control protocol specified in the present document
the ASCII name string is: MCMC (Mission Critical MBMS subchannel Control).
**[Application-dependent data]{.underline}**
The application-dependent data contains zero or more application specific data
fields is specified in subclause 8.1.3.
This part is encrypted if SRTCP is used.
**[Secure RTCP message part]{.underline}**
The content of the secure RTCP message part is in specified in clause 13 and
in IETF RFC 3711 [16].
### 8.1.3 Application specific data field
Each application specific data field is composed of:
1\. a field ID which is one octet long;
2\. a length value which is:
\- one octet long, if the field ID is less than 192; and
\- two octets long, if the field ID is equal to or greater than 192;
3\. a field value. The length in octets of the field value is indicated in the
length value; and
4\. a padding. The padding is zero, one, two, or three octets long. The value
of the padding octet(s) is set to zero by sender and ignored by receiver.
An application specific data field has always a multiple of 4 octets.
Table 8.1.3-1 shows the application dependent data field structure when the
field ID is less than 192. Table 8.1.3-2 shows the application dependent data
field structure when the field ID is equal to or greater than 192.
Table 8.1.3.-1: Application specific data field structure when the field ID is
less than 192
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Field ID \| Length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ +
: \ :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Table 8.1.3.-2: Application specific data field structure when the field ID is
equal to or greater than 192
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Field ID \| Length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ +
: \ :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
### 8.1.4 Handling of unknown messages and fields
When an RTCP APP message is received, the receiver shall:
1\. ignore the whole message, if the subtype is unknown;
2\. ignore the unspecified fields in the message (e.g. specified in future
version of the protocol); and
3\. ignore the syntactically incorrect optional fields.
## 8.2 Floor control
### 8.2.1 Introduction
The floor control messages are coded as described in subclause 8.1.2 where the
floor control message is part of the application-dependent data.
For the floor control protocol the ASCII name string is: MCPT (Mission
Critical Push-to-Talk).
A list of floor control messages can be found in subclause 8.2.2.1.
The same floor control messages are used for on-network, off-network floor
control and over the MBMS subchannel control channel.
In case of off-network, the floor participant that has the floor acts as the
floor control server (referred to as floor arbitrator in clause 7) in the
following subclauses.
The floor control specific fields are specified in subclause 8.2.3.
### 8.2.2 Floor control messages
#### 8.2.2.1 General
The table 8.2.2.1-1 provides a list of floor control messages.
Table 8.2.2.1-1: Floor control specific messages
+--------------------+---------+------------------+---------------+ | Message name | Subtype | Reference | Direction | +====================+=========+==================+===============+ | Floor Request | 00000 | Subclause 8.2.4 | Client server | +--------------------+---------+------------------+---------------+ | Floor Granted | x0001 | Subclause 8.2.5 | Server client | +--------------------+---------+------------------+---------------+ | Floor Deny | x0011 | Subclause 8.2.6 | Server client | +--------------------+---------+------------------+---------------+ | Floor Release | x0100 | Subclause 8.2.7 | Client server | +--------------------+---------+------------------+---------------+ | Floor Idle | x0101 | Subclause 8.2.8 | Server client | +--------------------+---------+------------------+---------------+ | Floor Taken | x0010 | Subclause 8.2.9 | Server client | +--------------------+---------+------------------+---------------+ | Floor Revoke | 00110 | Subclause 8.2.10 | Server client | +--------------------+---------+------------------+---------------+ | Floor Queue | 01000 | Subclause 8.2.11 | Client server | | Position Request | | | | +--------------------+---------+------------------+---------------+ | Floor Queue | x1001 | Subclause 8.2.12 | Server client | | Position Info | | | | +--------------------+---------+------------------+---------------+ | Floor Ack | 01010 | Subclause 8.2.13 | Server client | | | | | | | | | | Client server | +--------------------+---------+------------------+---------------+ | NOTE: The floor | | | | | control server is | | | | | the server and the | | | | | floor participant | | | | | is the client. | | | | +--------------------+---------+------------------+---------------+
For some messages the first bit (marked as x in the subtype) can be used to
indicate if the sender wants to have an acknowledgment. The x is coded as
follows:
\'0\' Acknowledgment is not required
\'1\' Acknowledgment is required
NOTE: Whether a message needs to be acknowledged or not is described in
clauses 6.
If an acknowledgment is required the Floor Ack message is used to acknowledge
the message.
#### 8.2.2.2 Void
### 8.2.3 Floor control specific fields
#### 8.2.3.1 Introduction
This subclause describes the floor control specific data fields.
The floor control messages can include floor control specific data fields
contained in the application-dependent data of the floor control message. The
floor control specific data fields follow the syntax specified in subclause
8.1.3.
Table 8.2.3.1-1: Void
Table 8.2.3.1-2 lists the available floor control specific data fields
including the assigned field ID.
Table 8.2.3.1-2: Floor control specific data fields
Field name Field ID Reference
* * *
                                    Decimal    Binary
Floor Priority 000 00000000 Subclause 8.2.3.2 Duration 001 00000001 Subclause
8.2.3.3 Reject Cause 002 00000010 Subclause 8.2.3.4 Queue Info 003 00000011
Subclause 8.2.3.5 Granted Party\'s Identity 004 00000100 Subclause 8.2.3.6
Permission to Request the Floor 005 00000101 Subclause 8.2.3.7 User ID 006
00000110 Subclause 8.2.3.8 Queue Size 007 00000111 Subclause 8.2.3.9 Message
Sequence-Number 008 00001000 Subclause 8.2.3.10 Queued User ID 009 00001001
Subclause 8.2.3.11 Source 010 00001010 Subclause 8.2.3.12 Track Info 011
00001011 Subclause 8.2.3.13 Message Type 012 00001100 Subclause 8.2.3.14 Floor
Indicator 013 00001101 Subclause 8.2.3.15 SSRC 014 00001110 Subclause 8.2.3.16
The following subclauses describe the coding of each field.
#### 8.2.3.2 Floor Priority field
The Floor Priority field describes the level of priority requested in a Floor
Request message or granted in a Floor Granted message. The max floor priority
that can be requested in a Floor Request message is negotiated between the
MCPTT client and the controlling MCPTT function using the \"mc_priority\" fmtp
parameter as specified in clause 14.
Table 8.2.3.2-1 describes the coding of the Floor Priority field.
Table 8.2.3.2-1: Floor Priority field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Floor Priority \|Floor Priority \|Floor Priority \|spare \|
\|field ID value \|Length value \|value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is a binary value and has the value \'2\'
indicating the total length in octets of the \ value item and
the spare bits.
The \ value consists of 8 bit parameter giving the floor
priority (\'0\' to \'255\') where \'0\' is the lowest priority and \'255\' is
the highest priority. If the Floor Priority field is not included in the
message the default priority is used as the Floor Priority value. The value of
the default priority is \'0\'. The default priority is sometimes referred to
as normal priority. Whether a floor priority is pre-emptive or not is
determined:
1\. for on-network by the floor control server as described in subclause
4.1.1.4; and
2\. for off-network by the floor arbitrator as described in subclause 4.1.1.5.
The spare bits are set to zero.
#### 8.2.3.3 Duration field
The Duration field describes the time in seconds for which the granted party
is allowed to transmit.
Table 8.2.3.3-1 describes the coding of the Duration field.
Table 8.2.3.3-1: Duration field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Duration \|Duration \|Duration value \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to table
8.2.3.1-2.
The \ value is a binary value and has the value \'2\'
indicating the total length in octets of the \ value item.
The \ value is a binary value in seconds.
#### 8.2.3.4 Reject Cause field
The Reject Cause field contains a \ value and can contain a
\ value. The content of the \ value is floor
control message dependent and is described per individual floor control
message carrying the Reject Cause field.
Table 8.2.3.4-1 describes the coding of the Reject Cause field.
Table 8.2.3.4-1: Reject Cause field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Reject Cause \|Reject Cause \| Reject Cause \|
\|field ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
: Reject Phrase :
: \|
\| (Padding) \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is a binary value and indicates the total
length in octets of the \ value and the \ value
items excluding any padding octets. If the length field is set to \'2\', there
is no \ value in the Reject Cause field.
The \ value is a 16 bit binary value as defined in subclause
8.2.6.2 for Floor Deny message and as defined in subclause 8.2.10.2 for Floor
Revoke message.
The \ value is a text string encoded the text string in the
SDES item CNAME as specified in IETF RFC 3550 [3].
If the length of the \ value is not a multipleof 4 bytes, the
Re\ value is padded to a multipleof 4 bytes. The value of the
padding bytes is set to zero. The padding bytes are ignored by the receiver.
#### 8.2.3.5 Queue Info field
The Queue Info field includes information about the position for one MCPTT
client in the floor request queue and the priority of the floor request.
Table 8.2.3.5-1 describes the coding of the Queue Info field.
Table 8.2.3.5-1: Queue Info field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Queue Info \|Queue Info \|Queue Position \|Queue Priority \|
\|field ID value \|length value \|Info value \| Level value \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is a binary value and has the value \'2\'
indicating the total length in octets of the \ value and
the \ value items.
The \ value is a binary value. The \
value has the value \'254\' if the MCPTT client is not queued. The \ value has the max value (\'255\') if the MCPTT client is queued
but the MCPTT server is unable to determine the queue position or if MCPTT
server policy is not to release information of the queue position to the MCPTT
client.
The \ value is coded as the \ value in
subclause 8.2.3.2.
#### 8.2.3.6 Granted Party\'s Identity field
The Granted Party\'s Identity field identifies the MCPTT user that is granted
to send media.
Table 8.2.3.6-1 describes the coding of the Granted Party\'s Identity field.
Table 8.2.3.6-1: Granted Party\'s Identity field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Granted Party\'s\|Granted Party\'s\| Granted Party\'s Identity \|
\|Identity field \|Identity length\| :
\|ID \| \| :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set
according to table 8.2.3.1-2.
The \ value is coded as the \ value in subclause 8.2.3.8.
The \ value is coded as the \ value in
subclause 8.2.3.8.
If the length of the \ value is not (2 + multiple
of 4) bytes, the \ value shall be padded to (2 +
multiple of 4) bytes. The value of the padding bytes is set to zero. The
padding bytes are ignored by the receiver.
#### 8.2.3.7 Permission to Request the Floor field
The Permission to Request the Floor field indicates whether receiving parties
are allowed to request the floor or not.
Table 8.2.3.7-1 describes the coding of the Permission to Request the Floor
field.
Table 8.2.3.7-1: Permission to Request the Floor field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Permission to \|Permission to \| Permission to Request \|
\|Request the \|Request the \| the Floor value \|
\|Floor field ID \|Floor length \| \|
\| \|value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is
set according to table 8.2.3.1-2.
The \ value is a binary value and has
the value \'2\' indicating the total length in octets of the \ value.
The \ value is 16 bit binary value and coded
as follows:
\'0\' The receiver is not permitted to request floor.
\'1\' The receiver is permitted to request floor.
All other values are reserved for future use.
#### 8.2.3.8 User ID field
The User ID field contains the MCPTT ID of an MCPTT user.
Table 8.2.3.8-1 describes the coding of the User ID field.
Table 8.2.3.8-1: User ID field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|User ID \|User ID \| User ID \|
\|field ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: :
: \|
\| Padding \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to table
8.2.3.1-2.
The \ value is a binary value and includes the value
indicating the length in octets of the \ value item except padding.
The \ value is coded as described in table 8.2.3.8-2.
Table 8.2.3.8-2: ABNF syntax of string values of the \ value
user-id = URI
If the length of the \ value is not (2 + multiple of 4) bytes \ value shall be padded to (2 + multiple of 4) bytes. The value of the
padding bytes is to zero. The padding bytes are ignored by the receiver.
#### 8.2.3.9 Queue Size field
The Queue Size field contains the numbers of queued MCPTT clients in an MCPTT
call.
Table 8.2.3.9-1 describes the coding of the Queue size field.
Table 8.2.3.9-1: Queue Size field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Queue Size \|Queue Size \|Queue Size value \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is a binary value and has the value \'2\'
indicating the total length in octets of the \ value item.
The \ value is a 16 bit binary value.
#### 8.2.3.10 Message Sequence Number field
The Message Sequence Number field is used to bind a number of Floor Taken or
bind a number of Floor Idle messages together.
Table 8.2.3.10-1 describes the coding of the Message Sequence Number field.
Table 8.2.3.10-1: Message Sequence Number field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Message \|Message \|Message Sequence Number value \|
\|Sequence Number\|Sequence Number\| \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set
according to table 8.2.3.1-2.
The \ value is a binary value and has the
value \'2\' indicating the total length in octets of the \ value item.
The \ value is a binary value. The \ value can be between \'0\' and \'65535\'. When the \'65535\' value is
reached, the \ value starts from \'0\' again.
#### 8.2.3.11 Queued User ID field
The Queued User ID field includes information about the identity of a queued
MCPTT user.
Table 8.2.3.11-1 describes the coding of the Queued User ID field.
Table 8.2.3.11-1: Queued User ID field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Queued User ID \|Queued User ID\| Queued User ID \|
\|field ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is coded as the \ value in
subclause 8.2.3.8.
The \ value is coded as the \ value in subclause
8.2.3.8.
If the length of the \ value is not (2 + multiple of 4) bytes,
the \ value shall be padded to (2 + multiple of 4) bytes. The
value of the padding bytes is set to zero. The padding bytes are ignored by
the receiver.
#### 8.2.3.12 Source field
The Source field contains the source of the message.
Table 8.2.3.12-1 describes the coding of the Source field.
Table 8.2.3.12-1: Source field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Source \|Source \| Source value \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to table
8.2.3.1-2.
The \ value is a binary value and has the value 2 indicating
the total length in octets of the \ value item.
The \ value is a 16 bit binary value where:
\'0\' the floor participant is the source
\'1\' the participating MCPTT function is the source
\'2\' the controlling MCPTT function is the source
\'3\' the non-controlling MCPTT function is the source
All other values are reserved for future use.
#### 8.2.3.13 Track Info field
The Track Info field contains the path a floor control message has been routed
along with the priority and the queueing capability of the MCPTT client.
Table 8.2.3.13-1 describes the coding of the Track Info field.
Table 8.2.3.13-1: Track Info field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Track Info \|Track Info \|Queueing \|Participant \|
\|field ID value \|length value \|Capability \|Type Length \|
\| \| \|value \|value \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Participant Type value \|
: :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Participant Reference 1 \|
: \| :
\| Floor Participant Reference n \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is a binary value and has a value indicating
the total length in octets of the \ value and one or more
\ value items.
The \ value is an 8 bit binary value where:
\'0\' the floor participant in the MCPTT client does not support queueing
\'1\' the floor participant in the MCPTT client supports queueing
All other values are reserved for future use.
The \ value is 8 bit binary value set to the length
of the \ value.
The \ value is string coded as specified in table
8.2.3.13-2:
Table 8.2.3.13-2: ABNF syntax of values of the \ value
participant-type = 1*( %x20-7E / UTF8-NONASCII )
If the length of the \ value is not a multiple of 4 bytes,
the \ value is padded to a multiple of 4 bytes. The value of
the padding bytes is set to zero. The padding bytes are ignored by the
receiver.
NOTE 1: The content of the \ value is MCPTT service provider
specific and out of scope of the present document.
The \ value is a 32 bit binary value containing a
reference to the floor participant in the non-controlling MCPTT function of an
MCPTT group.
NOTE 2: The reference to the floor participant is a value only understandable
by the floor control server interface in the non-controlling MCPTT function of
an MCPTT group.
#### 8.2.3.14 Message Type field
The Message Type field contains the subtype of the floor control message that
is acknowledged.
Table 8.2.3.14-1 describes the coding of the Message Type field.
Table 8.2.3.14-1: Message Type field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Message Type \|Message Type \|Message Type \|Spare \|
\|field ID \|Length \| \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to
table 8.2.3.1-2.
The \ value is a binary value and has the value \'2\'.
The \ value is an 8 bit binary value containing the binary value
consisting of the 5 bit message subtype as coded in table 8.2.2.1-1 (including
the first bit (used by some floor control messages to indicate that a Floor
Ack message is requested) of the five bit subtype) preceeded by \"000\".
The spare bits are set to zero.
#### 8.2.3.15 Floor Indicator field
The Floor Indicator contains additional information about a received floor
control message.
Table 8.2.3.15-1 describes the coding of the Floor Indicator field.
Table 8.2.3.15-1: Floor Indicator field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Floor Indicator\|Floor Indicator\|Floor Indicator value \|
\|field ID value \|Length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according
to table 8.2.3.1-2.
The \ value is a binary value and has the value \'2\'.
The \ value is a 16 bit bit-map named as shown in table
8.2.3.15-2:
Table 8.2.3.15-2: Floor Indicator bit marking
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|A\|B\|C\|D\|E\|F\|G\|H\|I\|J\|K\|L\|M\|N\|O\|P\|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
When set to 1, the bit has the following meaning:
A = Normal call
B = Broadcast group call
C = System call
D = Emergency call
E = Imminent peril call
F = Queueing supported
G = Dual floor
H = Temporary group call (NOTE 2)
NOTE 1: The indicators C, D and E are only informative. There are no
procedures specified for the C, D and E indicators in this release of the
present document and the use of the indicators are implementation specific.
NOTE 2: An MCPTT group call is a temporary group session when the \ element is present in the \ element as
specified in 3GPP TS 24.481 [12].
Bits I to P are reserved for future use and are set to 0.
There can be more than one bit set to 1 at the same time. The local policy in
the floor control server decides which combinations are possible and the
priority of the indications.
#### 8.2.3.16 SSRC field
The content of the SSRC field is coded as specified in IETF RFC 3550 [3]. An
SSRC field can also have a Field ID and a length value. This subclause
specifies an SSRC field including a Field ID and a length value.
Table 8.2.3.16-1: SSRC field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|SSRC \|SSRC \|SSRC value \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC value \|Spare \|
\| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and is set according to table
8.2.3.1-2.
The \ value is a binary value and has the value \'6\'.
The \ value is coded as the SSSRC specified in IETF RFC 3550 [3].
The spare bits are set to zero.
### 8.2.4 Floor Request message
The Floor Request message is a request from a floor participant to get
permission to send media. The Floor Request message is used in the off-network
mode and in the on-network mode. In the on-network mode the Floor Request
message is only used over the unicast bearer.
Table 8.2.4-1 shows the content of the Floor Request message.
Table 8.2.4-1: Floor Request message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor participant sending the Floor Request message \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Priority field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
: User ID field :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor participant sending the Floor
Request message.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[Floor priority:]{.underline}**
The Floor Priority field is coded as described in subclause 8.2.3.2.
**[User ID:]{.underline}**
The User ID field is used in off-network only and is coded as described in
subclause 8.2.3.8.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
### 8.2.5 Floor Granted message
The Floor Granted message is sent by the floor control server to inform the
requesting floor participant that it has been granted the permission to send
media.
The Floor Granted message is used in the off-network mode and in the on-
network mode. In the on-network mode the Floor Granted message is only used
over the unicast bearer.
Table 8.2.5-1 shows the content of the Floor Granted message.
Table 8.2.5-1: Floor Granted message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor control server/floor arbitrator \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Duration field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of granted floor participant field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Priority field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Queue Size field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of queued floor participant field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Queued User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Queue Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant. However, any set of Queue size field, SSRC of queued floor
participant field, Queued User ID field and the Queue Info field shall be kept
together.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor control server for on-network and
floor arbitrator for off-network.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[Duration:]{.underline}**
The Duration field is coded as specified in subclause 8.2.3.3.
**[SSRC of granted floor participant:]{.underline}**
The SSRC of granted floor participant is coded as specified in subclause
8.2.3.16.
**[Floor Priority:]{.underline}**
The Floor Priority field contains the granted floor priority and is coded as
specified in subclause 8.2.3.2.
**[User ID:]{.underline}**
The User ID field is used in off-network only. The User ID field carries the
MCPTT ID of the floor participant granted the floor. The User ID field is
coded as described in subclause 8.2.3.8.
**[Queue Size:]{.underline}**
The Queue Size field is only applicable in off-network and contains the
numbers of queued MCPTT clients in the MCPTT call.
The Queue Size field is coded as specified in subclause 8.2.3.9.
For each waiting floor participant the following set of fields are included:
1\. the SSRC of queued floor participant;
2\. the Queued User ID field; and
3\. the Queue info field.
The set occurs as many times as the \ value in the Queue size
field.
**[SSRC of queued floor participant:]{.underline}**
The SSRC of queued floor participant is only applicable in off-network and
carries the SSRC of the floor participant in the queue.
The content of the SSRC of queued floor participant is coded as the SSRC
specified in IETF RFC 3550 [3].
**[Queued User ID:]{.underline}**
The Queued User ID field is only applicable in off-network and contains the
MCPTT ID of the floor participant in the queue.
The Queued User ID field is coded as specified in subclause 8.2.3.11.
**[Queue Info:]{.underline}**
The Queue Info field is only applicable in off-network and defines the queue
position and granted floor priority in the queue.
The Queue Info field is coded as specified in subclause 8.2.3.5.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
### 8.2.6 Floor Deny message
#### 8.2.6.1 General
The Floor Deny message is sent as an action from the floor control server to
the requesting floor participant to inform that the floor request was
rejected.
The Floor Deny message is used in the off-network mode and in the on-network
mode. In the on-network mode the Floor Deny message is only used over the
unicast bearer.
Table 8.2.6.1-1 shows the content of the Floor Deny message.
Table 8.2.6.1-1: Floor Deny message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor control server/floor arbitrator \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Reject Cause field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor control server for on-network and
floor arbitrator for off-network.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[Reject Cause:]{.underline}**
The Reject Cause field includes the reason for the rejecting the floor request
and can be followed by a text-string explaining why the floor request was
rejected. Therefore the length of the packet will vary depending on the size
of the application dependent field.
The Reject Cause field contains:
1\. a \ value; and
2\. a \ value.
Available \ values are listed in subclause 8.2.6.2. The Reject
Cause field is coded as described in subclause 8.2.3.4.
**[User ID:]{.underline}**
The User ID field is used in off-network only. The User ID carries the MCPTT
ID of the requesting floor participant to which the Floor Deny message is
sent.
The User ID field is coded as specified in subclause 8.2.3.8.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
#### 8.2.6.2 Rejection cause codes and rejection cause phrase
Cause #1 - Another MCPTT client has permission
The \ value set to \'1\' indicates that another MCPTT user has
permission to send a media.
Cause #2 - Internal floor control server error
The \ value set to \'2\' indicates that the floor control server
cannot grant the floor request due to an internal error.
Cause #3 - Only one participant
The \ value set to \'3\' indicates that the floor control server
cannot grant the floor request, because the requesting party is the only
participant in the MCPTT session.
Cause #4 - Retry-after timer has not expired
The \ value set to \'4\' indicates that the floor control server
cannot grant the floor request, because timer T9 (Retry-after) has not expired
after permission to send media has been revoked.
Cause #5 - Receive only
The \ value set to \'5\' indicates that the floor control server
cannot grant the floor request, because the requesting party only has receive
privilege.
Cause #6 - No resources available
The \ value set to \'6\' indicates that the floor control server
cannot grant the floor request due to congestion.
Cause #7 -- Queue full
The \ value set to 7 indicates that the floor control server
cannot queue the floor request, because the queue is full.
Cause #255 - Other reason
The \ value set to \'255\' indicates that the floor control
server does not grant the floor request due to the floor control server local
policy.
### 8.2.7 Floor Release message
The Floor Release message is sent as an action from the floor participant to
the floor control server to inform that the floor can be released.
The Floor Release message can also be sent if the floor participant has a
request in the floor request queue. In this case, the Floor Release message is
sent to cancel the floor request in the queue.
The Floor Release message is used in the off-network mode and in the on-
network mode. In the on-network mode the Floor Release message is only used on
the unicast bearer.
Table 8.2.7-1 shows the content of the Floor Release message.
Table 8.2.7-1: Floor Release message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor participant with permission to send media \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor participant with permission to
send media.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[User ID:]{.underline}**
The User ID field is used in off-network only. The User ID field carries the
MCPTT ID of the floor participant sending the floor release message.
The User ID field is coded as specified in subclause 8.2.3.8.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
### 8.2.8 Floor Idle message
The Floor Idle message is sent as an action from the floor control server to
the floor participant indicating that no floor participant has permission to
send media.
The Floor Idle message is only used in the on-network mode. The Floor Idle
message is used over both the unicast and MBMS bearer.
Table 8.2.8-1 shows the content of the Floor Idle message.
Table 8.2.8-1: Floor Idle message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length=2 \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor control server \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Message Sequence Number field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor control server.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[Message Sequence Number:]{.underline}**
The Message Sequence Number field is coded as specified in to subclause
8.2.3.10.
**[Track Info:]{.underline}**
The Track Info field shall be included when an MCPTT call involves a non-
controlling MCPTT function. The coding of the Track Info field is described in
subclause 8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
### 8.2.9 Floor Taken message
The Floor Taken message is sent as an action from the floor control server to
inform non-requesting floor participant(s) that someone has been granted
permission to send media.
The Floor Taken message is used in the off-network mode and in the on-network
mode. In the on-network mode the Floor Taken message is used over both the
unicast and MBMS bearer.
Table 8.2.9-1 shows the content of the Floor Taken message.
Table 8.2.9-1: Floor Taken message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor control server/floor arbitrator \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Granted Party\'s Identity field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Permission to Request the Floor field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Message Sequence Number field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of granted floor participant field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor control server for on-network and
floor arbitrator for off-network.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[Granted Party's Identity:]{.underline}**
The Granted Party's Identity field is coded as specified in subclause 8.2.3.6.
**[Permission to request the floor:]{.underline}**
The Permission to Request the Floor field is coded as specified in subclause
8.2.3.7.
**[User ID:]{.underline}**
The User ID field is used in off-network only. The User ID field carries the
MCPTT user ID of the floor participant sending the Floor Taken message.
The User ID field is coded as specified in subclause 8.2.3.8.
**[Message Sequence Number:]{.underline}**
The Message Sequence Number field is coded as specified in to subclause
8.2.3.10.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
**[SSRC of granted floor participant:]{.underline}**
The SSRC of granted floor participant is coded as specified in subclause
8.2.3.16.
### 8.2.10 Floor Revoke message
#### 8.2.10.1 General
The Floor Revoke message is sent from the floor control server to the floor
participant with the permission to send media to inform that the permission to
send media is revoked.
The Floor Revoke message is used in the on-network mode. The Floor Revoke
message is only used over the unicast bearer.
Table 8.2.10.1-1 shows the content of the Floor Revoke message.
Table 8.2.10.1-1: Floor Revoke message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor control server \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Reject Cause value \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor control server.
The content of the SSRC field is coded as specified in IETF RFC 3550 [3].
**[Reject Cause:]{.underline}**
The Reject Cause field for the Floor Revoke message includes \
cause value in the Reject Cause field explaining why the floor control server
wants the floor participant to stop sending media and can be followed by
additional information. Therefore the length of the packet can vary depending
on the value of the rejection cause.
The coding of the \ value is specified in subclause 8.2.3.4.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
#### 8.2.10.2 Floor revoke cause codes and revoke cause phrases
Cause #1 -- Only one MCPTT client
The \ value set to \'1\' indicates that the MCPTT client is the
only MCPTT client in the MCPTT session or the only participant connected to a
floor control server. No additional information included.
Cause #2 -- Media burst too long
The \ value set to \'2\' indicates that the MCPTT User has
talked too long (e.g., the stop-talking timer has expired). No additional
information included.
Cause #3 - No permission to send a Media Burst
The \ value set to \'3\' indicates that the MCPTT client does
not have permission to send media. No additional information is included.
Cause #4 - Media Burst pre-empted
The \ value set to \'4\' indicates that the MCPTT client \'s
permission to send a media is being pre-empted. No additional information is
included.
Cause #6 - No resources available
The \ value set to \'6\' indicates that the floor control server
can no longer grant MCPTT client to send media due to congestion. No
additional information is included.
Cause #255 -- Other reason
The \ value set to \'255\' indicates that the floor control
server can no longer grant MCPTT client to send media due to the floor control
server local policy. No additional information is included.
### 8.2.11 Floor Queue Position Request message
The Floor Queue Position Request message is a request from a floor participant
to get information about the floor participant\'s position in the floor
request queue.
The Floor Queue Position Request message is used in the off-network mode and
in the on-network mode. In the on-network mode the Floor Queue Position
Request message is only used over the unicast bearer.
Table 8.2.11-1 shows the content of the Floor Queue Position Request message.
Table 8.2.11-1: Floor Queue Position Request message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor participant requesting floor queue status info \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor participant that is requesting
information about its position in the floor request queue.
The SSRC field is coded as specified in IETF RFC 3550 [3].
**[User ID:]{.underline}**
The User ID field is used in off-network only. The User ID field carries the
MCPTT user ID of the floor participant sending the Floor Queue Position
Request message.
The User ID field is coded as specified in subclause 8.2.3.8.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
### 8.2.12 Floor Queue Position Info message
The Floor Queue Position Info message is sent by the floor control server to
notify the floor participant of its position in the floor request queue.
The Floor Queue Position Info message is used in off-network and in on-network
mode. In the on-network mode the Floor Queue Position Info message is only
used over the unicast bearer.
Table 8.2.12-1 shows the content of the Floor Queue Position Info message.
Table 8.2.12-1: Floor Queue Position Info message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor control server/floor arbitrator \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of queued floor participant field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Queued User ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Queue Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor Indicator field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the floor control server for on-network and
floor arbitrator for off-network.
The SSRC field is coded as specified in IETF RFC 3550 [3].
**[User ID:]{.underline}**
The User ID field is used in off-network only. The User ID field carries the
MCPTT ID of the floor participant sending the Floor Queue Position Info
message.
The User ID value is coded as specified in subclause 8.2.3.8.
**[SSRC of queued floor participant:]{.underline}**
The SSRC of queued floor participant is only applicable in off-network and
shall carry the SSRC of the queued floor participant.
The SSRC field shall be coded as specified in subclause 8.2.3.16.
**[Queued User ID:]{.underline}**
The Queued User ID field is used in off-network only. The Queued User ID field
carries the MCPTT ID of the queued floor participant.
The Queued User ID value is coded as specified in subclause 8.2.3.8.
**[Queue Info:]{.underline}**
The Queue Info field defines the queue position and granted floor priority in
the queue.
The Queue Info field is coded as specified in subclause 8.2.3.5.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
**[Floor Indicator:]{.underline}**
The Floor Indicator field is coded as described in subclause 8.2.3.15.
### 8.2.13 Floor Ack message
The Floor Ack message is used to acknowledge any floor control message that
included the first bit (marked as x in the subtype) set to 1 (see subclause
8.2.2).
The Floor Ack message is only used in the on-network mode. The Floor Ack
message is only used over the unicast bearer.
Table 8.2.13-1 shows the content of the Floor Ack message.
Table 8.2.13-1: Floor Ack message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of the sender \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPT \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Source field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Message Type field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Track Info field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
**[Subtype:]{.underline}**
The subtype is coded according to table 8.2.2-1.
**[Length:]{.underline}**
The length is coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field carries the SSRC of the source identified by the Source field.
The SSRC field is coded as specified in IETF RFC 3550 [3].
**[Source:]{.underline}**
The Source field is coded as specified in subclause 8.2.3.12.
**[Message Type:]{.underline}**
The Message Type field contains the floor control message that is acknowledged
by the Floor Ack message. The Message Type field is coded as specified in
subclause 8.2.3.14.
**[Track Info:]{.underline}**
The Track Info field is included when an MCPTT call involves a non-controlling
MCPTT function. The coding of the Track Info field is described in subclause
8.2.3.13.
## 8.3 Pre-established session call control
### 8.3.1 Introduction
The pre-established session call control messages shall be coded as described
in subclause 8.1.2 where the pre-established session call control message is
part of the application-dependent data.
For the pre-established session call control protocol the ASCII name string
shall be: MCPC (Mission Critical Pre-established session call Control).
A list of pre-established session call control messages can be found in the
subclause 8.3.2.
Pre-established session call control specific fields are specified in
subclause 8.3.3.
### 8.3.2 Pre-established session call control message
The table 8.3.2-1 provides a list of call control messages.
Table 8.3.2-1: Pre-established session call control specific messages
Message name Subtype Reference Direction
* * *
Connect x0000 Subclause 8.3.4 Server client Disconnect x0001 Subclause 8.3.5
Server client Acknowledge 00010 Subclause 8.3.6 Client server NOTE: The
participating MCPTT function is the server and the floor participant is the
client.
For some messages the first bit (marked as x in the subtype) can be used to
indicate if the sender wants to have an acknowledgment. The x is coded as
follows:
\'0\' Acknowledgment is not required
\'1\' Acknowledgment is required
NOTE: Whether a message needs to be acknowledged or not is described in clause
9.
If an acknowledgment is required, the Acknowledge message is used to
acknowledge the message.
### 8.3.3 Pre-established session call control fields
#### 8.3.3.1 Introduction
This subclause describes the pre-established session call control specific
data fields.
The pre-established session call control specific data fields are contained in
the application-dependent data of the pre-established session call control
message. The pre-established session call control specific data fields follow
the syntax specified in subclause 8.1.3.
Table 8.3.3.1-1: Void
Table 8.3.3.1-2 lists the available data fields including the assigned field
ID.
Table 8.3.3.1-2: Pre-established session call control data fields
Field name Field ID Reference
* * *
                                 Decimal    Binary
Media Streams 000 00000000 Subclause 8.3.3.2 MCPTT Session Identity 001
00000001 Subclause 8.3.3.3 Warning Text 002 00000010 Subclause 8.3.3.4 MCPTT
Group Identity 003 00000011 Subclause 8.3.3.5 Answer State 004 00000100
Subclause 8.3.3.6 Inviting MCPTT User Identity 005 00000101 Subclause 8.3.3.7
Reason Code 006 00000110 Subclause 8.3.3.8 PCK I_MESSAGE 192 11000000
Subclause 8.3.3.10
The following subclauses describe the coding of each data field.
#### 8.3.3.2 Media Streams field
The Media Streams field describes which media streams to use in the session.
At the minimum one \ value shall be included. The \ value item is only needed when floor control applies during the MCPTT
call.
Table 8.3.3.2-1 describes the coding of the Media Streams field.
Table 8.3.3.2-1: Media Streams field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Media Stream \|Media Streams \|Media Stream \|Control Channel\|
\|field ID value \|length value \|value \|value \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set
according to table 8.3.3.1-2.
The \ value shall is a binary value indicating the
length in octets of the \ value and \ value
items.
The \ value shall consist of 8 bit parameter giving the number
of the\" m=audio\" m-line negotiated in the pre-established session.
The \ value shall consist of 8 bit parameter giving the
number of the \"m=application\" m-line negotiated in the pre-established
session. The \ value is set to \"0\" when no floor control is
used during the session.
#### 8.3.3.3 MCPTT Session Identity field
The MCPTT Session Identity field contains the MCPTT session identity and the
session type.
Table 8.3.3.3-1 describes the coding of the MCPTT Session Identity field.
Table 8.3.3.3-1: MCPTT Session Identity field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|MCPTT session \|MCPTT session \|Session Type \|MCPTT Session \|
\|identity field \|identity field \| \|Identity \|
\|ID \|length \| \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: (Padding) :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be
set according to table 8.3.3.1-2.
The \ value shall is a binary value indicating
the length in octets of the \ value and \ value items.
The \ value is coded as follows:
\- 00000000 = no session type
\- 00000001 = private
\- 00000011 = prearranged
\- 00000100 = chat
All other values are reserved for future use.
\ value contains a SIP URI, which identifies the MCPTT
session between the MCPTT client and the controlling MCPTT function; see 3GPP
TS 24.379 [2] subclause 4.5. The \ value is coded
specified in table 8.3.3.3-2.
Table 8.3.3.3-2: ABNF syntax of string values of the \
value
mcptt-session-identity = SIP-URI
If the length of the \ value is not (1 + multiple of
4) bytes, the \ value shall be padded to (1 + multiple
of 4) bytes. The value of the padding bytes should be set to zero. The padding
bytes shall be ignored.
#### 8.3.3.4 Warning Text field
The Warning Text field contains the text string returned by the controlling
MCPTT function in responses to a SIP INVITE request as described in 3GPP TS
24.379 [2] subclause 4.4.
Table 8.3.3.4-1 describes the coding of the Warning Text field.
Table 8.3.3.4-1: Warning Text field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Warning Text \|Warning Text \|Warning Text \|
\|field ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: (Padding) :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set
according to table 8.3.3.1-2.
The \ value is a binary value indicating the length in
octets of the \ value item excluding any padding octets.
The \ value shall be coded as specified in 3GPP TS 24.379 [2]
table 4.4.2-1.
EXAMPLE: If the Warning: 399 \"100 User not authorised to make group calls\"
is received, the 399 \"100 User not authorised to make group calls\" is
included as the \ value.
If the length of the \ value is not (2 + multiple of 4) bytes,
the \ value shall be padded to (2 + multiple of 4) bytes. The
value of the padding bytes should be set to zero. The padding bytes shall be
ignored.
#### 8.3.3.5 MCPTT Group Identity field
The MCPTT Group Identity field contains a SIP URI identifying the group that
an MCPTT client is invited to.
Table 8.3.3.5-1 describes the coding of the MCPTT Group Identity field.
Table 8.3.3.5-1: MCPTT Group Identity field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|MCPTT Group \|MCPTT Group \|MCPTT Group Identity \|
\|identity field \|identity field \| \|
\|ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: (Padding) :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set
according to table 8.3.3.1-2.
The \ value is a binary value indicating the
length in octets of the \ value item.
\ value contains the MCPTT group identity or the
temporary MCPTT group identity as defined in 3GPP TS 24.379 [2]. The \ value shall be coded as specified in the table 8.3.3.5-2.
Table 8.3.3.5-2: ABNF syntax of string values of the \
value
mcptt-group-identity = URI
If the length of the \ value is not (2 + multiple of 4)
bytes, the \ value shall be padded to (2 + multiple of
4) bytes. The value of the padding bytes should be set to zero. The padding
bytes shall be ignored.
#### 8.3.3.6 Answer State field
The Answer State field indicates if invited MCPTT users are invited using
automatic or manual commencement mode.
Table 8.3.3.6-1 describes the coding of the Answer State field.
Table 8.3.3.6-1: Answer State field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Answer State \|Answer State \|Answer State value \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set
according to table 8.3.3.1-2.
The \ value is a binary value and shall have the value
\'2\' indicating the total length in octets of the \ value item.
The \ value is a 16-bit binary value with the following values:
\'0\' Unconfirmed
\'1\' Confirmed
All other values are reserved for future use.
#### 8.3.3.7 Inviting MCPTT User Identity field
The Inviting MCPTT User Identity field contains the MCPTT ID identifying the
inviting MCPTT user.
Table 8.3.3.7-1 describes the coding of the Inviting MCPTT User Identity
field.
Table 8.3.3.7-1: Inviting MCPTT User Identity field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Inviting MCPTT \|Inviting MCPTT \|Inviting MCPTT User Identity \|
\|User Identity \|User Identity \| \|
\|field ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: (Padding) :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall
be set according to table 8.3.3.1-2.
The \ value is a binary value indicating
the length in octets of the \ value item.
The \ value contains the MCPTT ID of the
inviting MCPTT user. The \ value shall be coded
as specified in the table 8.3.3.7-2. The MCPTT ID is specified in 3GPP TS
24.379 [2].
Table 8.3.3.7-2: ABNF syntax of string values of the \ value
inviting-mcptt-user-identity = URI
If the length of the \ value is not (2 +
multiple of 4) bytes, the \ value shall be
padded to (2 + multiple of 4) bytes. The value of the padding bytes should be
set to zero. The padding bytes shall be ignored.
#### 8.3.3.8 Reason Code field
The Reason Code field contains the answer to a pre-established call control
message.
Table 8.3.3.8-1 describes the coding of the Reason Code field.
Table 8.3.3.8-1: Reason Code field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|Reason Code \|Reason Code \|Reason Code value \|
\|field ID value \|length value \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set according
to table 8.3.3.1-2.
The \ value is a binary value and shall have the value
\'2\' indicating the total length in octets of the \ value item.
The \ value is a 16-bit binary value with the following values:
\'0\' Accepted
\'1\' Busy
\'2\' Not Accepted
All other values are reserved for future use.
#### 8.3.3.9 Handling of unknown fields and messages
When a pre-establish session control message is received the MCPTT client and
the participating MCPTT function shall:
1\. ignore the whole message, if the subtype is unknown;
2\. ignore the unspecified fields in the message (e.g. specified in future
version of the pre-establish session control protocol); and
3\. ignore the syntactically incorrect optional fields.
#### 8.3.3.10 PCK I_MESSAGE field
The PCK I_MESSAGE field is a MIKEY payload containing a MIKEY-SAKKE I_MESSAGE
as defined in IETF RFC 6509 [17] and as received in the SIP INVITE message.
The PCK I_MESSAGE contains the PCK and PCK-ID (see 3GPP TS 24.379 [2]
subclause 4.7).
Table 8.3.3.10-1 describes the coding of the PCK I_MESSAGE field.
Table 8.3.3.10-1: PCK I_MESSAGE field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|PCK I_MESSAGE \|PCK I_MESSAGE \|PCK I_MESSAGE \|
\|field ID value \|field length value \|field value \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-\| :
: (Padding) :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set
according to table 8.3.3.1-2.
The \ value is a binary value indicating the
length in octets of the \ value item.
The \ value contains the MIKEY-SAKKE I_MESSAGE for PCK as
received in the SIP INVITE message.
### 8.3.4 Connect message
The Connect message is sent by the participating MCPTT function on the
originating side to the MCPTT client to confirm the establishment of an MCPTT
call or sent on the terminating side to initiate an MCPTT call. The Connect
message is only used in the on-network mode and only sent over the unicast
bearer.
Table 8.3.4-1 shows the content of the Connect message.
Table 8.3.4-1: Connect message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| Length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of participating MCPTT function \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPC \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| MCPTT Session Identity field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| MCPTT Group Identity field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Media Streams field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Warning Text field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Answer State field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Inviting MCPTT User Identity field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| PCK I_MESSAGE field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype shall be coded according to table 8.3.2-1.
**[Length:]{.underline}**
The length shall be coded as specified in to subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field shall carry the SSRC of the participating MCPTT function.
The SSRC field shall be coded as specified in IETF RFC 3550 [3].
**[MCPTT Session Identity:]{.underline}**
The MCPTT Session Identity field is coded as described in subclause 8.3.3.3.
**[MCPTT Group Identity:]{.underline}**
The MCPTT Group Identity field is coded as described in subclause 8.3.3.5.
**[Media Streams:]{.underline}**
The Media Streams field is coded as described in subclause 8.3.3.2.
**[Warning Text:]{.underline}**
The Warning Text field is coded as described in subclause 8.3.3.4.
**[Answer State:]{.underline}**
The Answer State field is coded as described in subclause 8.3.3.6.
When the Answer State field is not included the value \"confirmed\" shall be
assumed.
**[Inviting MCPTT User Identity:]{.underline}**
The Inviting MCPTT User Identity field is coded as described in subclause
8.3.3.5.
When the inviting MCPTT user requested privacy, the
\ identity shall be used.
**[PCK I_MESSAGE:]{.underline}**
The PCK I_MESSAGE is used to transport the PCK and PCK-ID for use in private
call.
This field is used when the terminating participating MCPTT function sends the
Connect message to the terminating client for a private call.
### 8.3.5 Disconnect message
Table 8.3.5-1 shows the content of the Connect message.
Table 8.3.5-1: Disconnect message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| Length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of participating MCPTT function \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPC \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| MCPTT Session Identity field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype shall be coded according to table 8.3.2-1.
**[Length:]{.underline}**
The length shall be coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field shall carry the SSRC of the participating MCPTT function.
The SSRC field shall be coded as specified in IETF RFC 3550 [3].
**[MCPTT Session Identity:]{.underline}**
The MCPTT Session Identity field is coded as described in subclause 8.3.3.3.
### 8.3.6 Acknowledgement message
Table 8.3.6-1 shows the content of the Acknowledgement message.
Table 8.3.6-1: Acknowledgement message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| Length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of floor participant \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCPC \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Reason Code field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words the order of the fields are
irrelevant.
**[Subtype:]{.underline}**
The subtype shall be coded according to table 8.3.2-1.
**[Length:]{.underline}**
The length shall be coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field shall carry the SSRC of the floor participant.
The SSRC field shall be coded as specified in IETF RFC 3550 [3].
**[Reason Code:]{.underline}**
The Reason Code field is coded as described in subclause 8.3.3.8.
## 8.4 MBMS subchannel control
### 8.4.1 Introduction
The MBMS subchannel control messages shall be coded as described in subclause
8.1.2 where the MBMS subchannel control message is part of the application-
dependent data.
For the MBMS subchannel control protocol the ASCII name string shall be: MCMC.
The list of MBMS subchannel control messages can be found in the subclause
8.4.2.
The MBMS subchannel control specific fields are specified in subclause 8.4.3.
### 8.4.2 MBMS subchannel control messages
Table 8.4.2-1 provides a list of MBMS subchannel control protocol messages.
Table 8.4.2-1: MBMS subchannel control protocol messages
Message name Subtype Reference Direction
* * *
Map Group To Bearer 00000 subclause 8.4.4 Server client Unmap Group To Bearer
00001 subclause 8.4.5 Server client NOTE: The participating MCPTT function is
the server and the MCPTT client is the client.
### 8.4.3 MBMS subchannel control specific fields
#### 8.4.3.1 Introduction
This subclause describes the MBMS subchannel control specific data fields.
The MBMS subchannel control specific data fields are contained in the
application-dependent data of the MBMS subchannel control message. The MBMS
subchannel control specific data fields follow the syntax specified in
subclause 8.1.3.
Table 8.4.3.1-1: Void
Table 8.4.3.1-2 lists the available fields including the assigned Field ID.
Table 8.4.3.1-2: MBMS subchannel control specific data fields
Field name Field ID Description
* * *
                    Decimal    Binary
MBMS Subchannel 000 00000000 Subclause 8.4.3.3 TMGI 001 00000001 Subclause
8.4.3.4. MCPTT Group ID 002 00000010 Subclause 8.4.3.2
#### 8.4.3.2 MCPTT Group ID field
The MCPTT Group ID field contains a SIP URI identifying the MCPTT group for
which media and floor control messages are going to be broadcasted over a MBMS
subchannel.
The MCPTT Group ID field is coded as the MCPTT Group Identity field specified
in subclause 8.3.3.5.
#### 8.4.3.3 MBMS Subchannel field
The MBMS Subchannel field describes which MBMS subchannel to use for media and
for floor control.
Table 8.4.3.3-1 describes the coding of the MBMS Subchannel field.
Table 8.4.3.3-1: MBMS Subchannel field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|MBMS Subchannel\|MBMS Subchannel\|Audio \|Floor \|IP \| spare \|
\|field ID value \|length value \|m-line \|m-line \|Version\| \|
\| \| \|Number \|Number \| \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Floor control Port Number \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| Media Port Number \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
: IP Address :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set
according to table 8.4.3.1-2.
The \ value is a binary value indicating the total
length in octets of the \ value, \ value,
spare, \ value and \ items.
The \ value shall consist of 4 bit parameter giving the
number of the\" m=audio\" m-line in the SIP MESSAGE request announcing the
MBMS bearer described in 3GPP TS 24.379 [2].
The \ value shall consist of 4 bit parameter giving the
number of the \"m=application\" m-line in the SIP MESSAGE request announcing
the MBMS bearer described in 3GPP TS 24.379 [2]. The \
value is set to \"0\" when the same subchannel is used for media and for floor
control.
The \ value indicates the IP version:
\'0\' IP version 4
\'1\' IP version 6
All other values are reserved for future use.
The \"spare\" 4 bits shall be set to \"0000\".
The \ value is a 32-bit binary value giving the
port to be used if the\ value is greater than \'0\'. If
the \ value is equal to \'0\', the \ value is not included in the MBMS Subchannel field.
The \ value is a 32-bit binary value giving the port to be
used. The \ value is always present in the MBMS Subchannel
field.
The \ value is:
1\. a 32 bit binary value containing the IP v4 address if the \
indicates that the \ value is a IP v4 Address; or
2\. four 32-bit words that together forms a 128 bit binary value representing
the IP v6 address, if the \ indicates that the \ value
is a IP v6 Address
#### 8.4.3.4 TMGI field
Table 8.4.3.4-1 describes the coding of the TMGI field.
Table 8.4.3.4-1: TMGI field coding
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|TMGI \|TMGI \|TMGI \|
\|ID \|length \| \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ :
: (Padding) :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
The \ value is a binary value and shall be set according to
table 8.4.3.1-2.
The \ value is a binary value indicating the length in octets of
the \ value item.
The \ value is coded as described in 3GPP TS 24.008 [11] subclause
10.5.6.13 excluding the Temporary Mobile Group Identity IEI and Length of
Temporary Mobile Group Identity contents (octet 1 and octet 2 in 3GPP TS
24.008 [11] subclause 10.5.6.13).
If the length of the \ value is not (2 + multiple of 4) bytes, the
\ value shall be padded to (2 + multiple of 4) bytes. The value of the
padding bytes should be set to zero. The padding bytes shall be ignored.
#### 8.4.3.5 Void
### 8.4.4 Map Group To Bearer message
The Map Group To Bearer message is sent by the participating function when a
conversation is started.
Table 8.4.4-1 shows the content of the Map Group To Bearer message.
Table 8.4.4-1: Map Group To Bearer message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype\| PT=APP=204 \| Length \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of participating MCPTT function \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCMC \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| MCPTT Group ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| TMGI field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| MBMS Subchannel field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words, the order of the fields
are irrelevant.
**[Subtype:]{.underline}**
The subtype shall be coded according to table 8.4.2-1.
**[Length:]{.underline}**
The length shall be coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field shall carry the SSRC of the participating MCPTT function.
The SSRC field shall be coded as specified in IETF RFC 3550 [3].
**[MCPTT Group ID:]{.underline}**
The MCPTT Group ID field is coded as described in subclause 8.4.3.2.
**[TMGI:]{.underline}**
The TMGI field is coded as described in subclause 8.4.3.4.
**[MBMS Subchannel:]{.underline}**
The MBMS Subchannel field is coded as described in subclause 8.4.3.3.
### 8.4.5 Unmap Group To Bearer message
The Unmap Group To Bearer message is sent by the participating function when a
conversation is ended.
Table 8.4.5-1 shows the content of the Unmap Group To Bearer message.
Table 8.4.5-1: Unmap Group To Bearer message
0 1 2 3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\|V=2\|P\| Subtype \| PT=APP=204 \| length=3 \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| SSRC of participating MCPTT function \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| name=MCMC \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\| MCPTT Group ID field \|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
With the exception of the three first 32-bit words, the order of the fields
are irrelevant.
**[Subtype:]{.underline}**
The subtype shall be coded according to table 8.4.2-1.
**[Length:]{.underline}**
The length shall be coded as specified in subclause 8.1.2.
**[SSRC:]{.underline}**
The SSRC field shall carry the SSRC of the participating MCPTT function.
The SSRC field shall be coded as specified in IETF RFC 3550 [3].
**[MCPTT Group ID:]{.underline}**
The MCPTT Group ID field is coded as described in subclause 8.4.3.2.
# 9 Call setup control over pre-established session
## 9.1 General
The procedures described in this clause are applicable only after a pre-
established session is established between the participating MCPTT function
and the MCPTT client.
Once the use of an existing pre-established session is decided for a pre-
arranged group call or for a chat group call or for a private call, as
specified in 3GPP TS 24.379 [2], the participating MCPTT function shall inform
the MCPTT client that this pre-established session is to be used as described
in subclause 9.3 and the MCPTT client shall respond as described in subclause
9.2.
When a pre-arranged group call or a chat group call or a private call which
uses a pre-established session is released as specified in 3GPP TS 24.379 [2],
the participating MCPTT function shall inform the MCPTT client that the use of
this pre-established session has ended as described in subclause 9.3 and the
MCPTT client shall respond as described in subclause 9.2.
Media and media plane control procedures between a participating MCPTT
function and MCPTT client for a pre-arranged group call or for a chat group
call or for a private call and setup over a pre-established session are not
affected by the use of the pre-established session.
Media plane security procedures for pre-established call control messages are
specified in clause 13.
## 9.2 MCPTT client
### 9.2.1 General
If the MCPTT client supports pre-established session, the MCPTT client shall
also support the behaviour implied by the state machine specified in this
subclause. The specifications are on the reception or sending of media plane
control messages related to the call setup control over pre-established
session
An MCPTT client may have several pre-established sessions at a time.
### 9.2.2 Call setup control over pre-established session state machine
#### 9.2.2.1 General
A call setup control over pre-established state machine has two states: Pre-
established Session_Not_in_use and Pre-established Session_In_use. In addition
the \'Start-Stop\' state is specified for the initiation or the termination of
the state machine. The state transitions are partly controlled by the call
control procedures specified in 3GPP TS 24.379 [2].
Figure 9.2.2.1-1 shows the call setup control over pre-established session
state machine and the state transitions.
Figure 9.2.2.1-1: Call setup control over pre-established session state
machine.
The MCPTT client shall create one instance of the call setup control over pre-
established state machine per pre-established session.
If a pre-established session call control message, a SIP request or RTP media
packet arrives in any state and there is no procedure specified in the
subclauses below, the MCPTT client shall discard the pre-established session
call control message, SIP request or RTP media packet and shall remain in the
current state.
#### 9.2.2.2 State: \'Start-stop\'
##### 9.2.2.2.1 General
In this state no pre-established session exists
##### 9.2.2.2.2 Pre-established session started
When a pre-established session is created between the MCPTT client and the
participating MCPTT function, as specified in 3GPP TS 24.379 [2], the MCPTT
client:
1\. shall initialize any needed user plane resources for the pre-established
session as specified in 3GPP TS 24.379 [2]; and
2\. shall enter the \'U: Pre-established session not in use\' state.
#### 9.2.2.3 State: \'U: Pre-established session not in use\'
##### 9.2.2.3.1 General
The \'U: Pre-established session not in use\' state is a stable state. The
MCPTT client is in this state when a pre-established session is established,
but it is not used for a call.
In this state the MCPTT client can receive call initiation message and floor
control messages.
##### 9.2.2.3.2 Receive Connect message (R: Connect)
Upon reception of a Connect message:
1\. if the MCPTT client accepts the incoming call the MCPTT client:
a. shall send the Acknowledgement message with Reason Code field set to
\'Accepted\';
b. shall use only the media streams of the pre-established session which are
indicated as used in the associated call session Media Streams field, if the
Connect contains a Media Streams field;
c. shall create an instance of the \'Floor participant state transition
diagram for basic operation\' as specified in subclause 6.2.4; and
d. shall enter the \'U: Pre-established session in use\' state; or
2\. Otherwise the MCPTT client:
a. shall send the Acknowledgement message with the Reason Code field set to
\'Busy\' or \'Not Accepted\'; and
b. shall remain in \'U: Pre-established session not in use\' state.
##### 9.2.2.3.3 Pre-established session stopped
When the associated pre-established session between the MCPTT client and the
MCPTT server is released the MCPTT client:
1\. shall release any user plane resources including any running timers
associated with the pre-established session; and
2\. shall enter the \'Start-stop\' state and then the \'Call setup control
over pre-established session state machine\' is released.
##### 9.2.2.3.4 Receive Disconnect message (R: Disconnect)
Upon reception of a Disconnect message the MCPTT client:
1\. if the first bit in the subtype of the Disconnect message is set to \'1\'
(acknowledgement is required), shall send the Acknowledgement message with the
Reason Code set to \'Accepted\'; and
2\. shall remain in \'U: Pre-established session not in use\' state.
##### 9.2.2.3.5 Receive SIP 2xx response (R:2xx response)
Upon reception of a SIP 2xx response for the SIP REFER request sent to
initiate an MCPTT call session over a pre-established session as specified in
3GPP TS 24.379 [2], (to initiates a pre-arranged group call or private call or
to join a chat group call) the MCPTT client shall enter the \'U: Pre-
established session in use\' state.
##### 9.2.2.3.6 Receive SIP re-INVITE request (R: re-INVITE)
Upon sending the SIP 200 (OK) response to the SIP re-INVITE request for the
use of the Pre-established session initiating an MCPTT call session as
specified in 3GPP TS 24.379 [2] the MCPTT client shall enter the \'U: Pre-
established session in use\' state.
#### 9.2.2.4 State: \'U: Pre-established session in use\'
##### 9.2.2.4.1 General
The MCPTT client is in this state when a pre-established session is
established and it is used for an MCPTT call session.
In this state the MCPTT client can receive call release indication, floor
control messages and RTP media packets.
##### 9.2.2.4.2 Receive Connect message (R: Connect)
Upon reception of a Connect message the MCPTT client:
1\. if the first bit in the subtype of the Connect message is set to \'1\'
(acknowledgement is required), shall send Acknowledgement message with the
Reason Code field set to \'Accepted\'; and
2\. shall remain in the \'U: Pre-established session in use\' state.
##### 9.2.2.4.3 Receive other floor control message (R: other message)
Upon reception of a floor control message (i.e. messages other than the
Connect message and the Disconnect message) the MCPTT client:
1\. shall act as specified in subclause 6.2.4; and
2\. shall remain in the \'U: Pre-established session in use\' state.
##### 9.2.2.4.4 Receive RTP media packets (R:RTP packet)
Upon reception of an RTP media packet the MCPTT client:
1\. shall act as specified in subclause 6.2.4; and
2\. shall remain in the \'U: Pre-established session in use\' state.
##### 9.2.2.4.5 Receive Disconnect message (R: Disconnect)
Upon reception of Disconnect message the MCPTT client:
1\. if the first bit in the subtype of the Disconnect message is set to \'1\'
(acknowledgement is required), shall send Acknowledgement message with the
Reason Code field set to \'Accepted\';
2\. shall enter the \'U: Pre-established session not in use\' state; and
3\. shall act as specified in subclause 6.2.4.
##### 9.2.2.4.6 Receive SIP 2xx response (R: 2xx response)
Upon receiving a 2xx response to the sent SIP REFER request as described in
3GPP TS 24.379 [2] when the call is released, but the Pre-established Session
is kept alive the MCPTT client:
1\. shall enter the \'U: Pre-established session not in use\' state; and
2\. shall terminate the instance of \'Floor participant state transition
diagram for basic operation\' state machine as specified in subclause 6.2.4.
## 9.3 Participating MCPTT function
### 9.3.1 General
The participating MCPTT function shall support the behaviour implied by the
state machine specified in this subclause. The specifications are on the
sending and reception of media plane control messages related to the call
setup control over a pre-established session
A participating MCPTT function may have several pre-established session at a
time for multiple MCPTT clients and multiple pre-established sessions per
MCPTT client.
### 9.3.2 Call setup control over pre-established session state machine for
the participating MCPTT function
#### 9.3.2.1 General
If the participating MCPTT function supports pre-established session, the
participating MCPTT function shall behave according to the \'pre-established
session state machine\' and state transitions specified in this subclause.
The \'pre-established session state machine\' has three states: \'G: Pre-
established session not in use\' state, \'G: Pre-established session in use\'
state and \'G: Call releasing\' state, the state transitions are partially
controlled by the specifications in 3GPP TS 24.379 [2]. The \'Start-stop\'
state is the initial and final state.
Figure 9.3.2.1-1 shows the state diagram and the state transitions of the
\'pre-established session state machine\'.
Figure 9.3.2.1-1: State transitions of Pre-established Session state machine
The participating MCPTT function shall create one instance of the \'pre-
established session state machine\' per pre-established session per MCPTT
client.
State and state transition details are explained in the following subclauses.
If a pre-established session call control message, SIP request, SIP response
or RTP media packet arrives in any state and there is no procedure specified
for it in this subclauses below, the participating MCPTT function shall
discard the pre-established session call control message, SIP request, SIP
response or RTP media packet and remain in the current state.
#### 9.3.2.2 State: \'Start-stop\'
##### 9.3.2.2.1 General
In this state no pre-established session exists.
##### 9.3.2.2.2 Pre-established session started
When a pre-established session is created between the participating MCPTT
function and an MCPTT client, the participating MCPTT function:
1\. shall initiate any needed user plane resources for the pre-established
session; and
2\. shall enter the \'G: Pre-established session not in use\' state.
#### 9.3.2.3 State: \'G: Pre-established session not in use\'
##### 9.3.2.3.1 General
The \'G: Pre-established session not in use\' state is a stable state. The
participating MCPTT function is in this state when the pre-established session
is established but it is not used for an MCPTT call.
In this state the participating MCPTT function can receive call initiation
indication.
##### 9.3.2.3.2 Receive SIP REFER request (R: SIP REFER)
Upon receiving a SIP REFER request from the MCPTT client the participating
MCPTT function:
1\. shall reserve user plane resources for the call session, if not yet
reserved; and,
2\. shall enter the \'G: Pre-established session in use\' state.
##### 9.3.2.3.3 Receive SIP INVITE request (R: SIP INVITE)
Upon receiving a SIP INVITE request from the controlling MCPTT function, if in
automatic answer mode, the participating MCPTT function:
1\. shall send the Connect message to the invited MCPTT client using the media
plane control transport channel defined for this call. The Connect message:
a. shall include the SIP URI received in the Contact header field of the SIP
INVITE request in the \ value in the MCPTT Session
Identity field;
b. if the SIP INVITE request included an \"application/vnd.3gpp.mcptt-
info+xml\" MIME body with the \ element set to a value of
\"prearranged\" or \"chat\":
i. shall include the content of the \ element in the
MCPTT Group Identity field;
ii. shall include the value \'prearranged\' or \'chat\' in the \
value in the MCPTT Session Identity field;
iii. shall include the content of the \ element in the
Inviting MCPTT User Identity field if available from the SIP INVITE message
and privacy of the inviting MCPTT ID is not required; and
iv. shall include \'anonymous\@anonymous.invalid\' in the Inviting MCPTT User
Identity field if the MCPTT ID of the inviting MCPTT user is not available
from the SIP INVITE message or privacy of the inviting MCPTT ID is required;
c. if the SIP INVITE request includes an \"application/vnd.3gpp.mcptt-
info+xml\" MIME body with the \ element set to a value of
\"private\":
i. shall include the content of the \ element in the
Inviting MCPTT User Identity field if available from the SIP INVITE message
and privacy of the inviting MCPTT ID is not required;
ii. shall include \'anonymous\@anonymous.invalid\' in the Inviting MCPTT User
Identity field if the MCPTT ID of the inviting MCPTT user is not available
from the SIP INVITE message or privacy of the inviting MCPTT ID is required;
iii. shall include the value \'private\' in the \ value in the
MCPTT Session Identity field; and
iv. if the MIKEY-SAKKE I_MESSAGE is included in the received SIP INVITE
request, shall include the MIKEY-SAKKE I_MESSAGE as received, in the PCK
I_MESSAGE field;
d. shall include a Media Streams field, if the negotiated SDP in the pre-
arranged session contains more media streams than required by the SDP in the
SIP INVITE request; and
NOTE 1: For example if the call is a private call without floor control the
Media Streams field needs to be included with the \ value set
to \'0\'.
e. shall set the first bit in the subtype of the Connect message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
2\. shall start timer T55 (Connect);
3\. shall initialize counter C55 (Connect) to 1;
4\. shall reserve the media channel resources if not yet reserved; and
5\. shall enter the \'G: Pre-established session in use\' state.
NOTE 2: The case of manual answer is described in 3GPP TS 24.379 [2].
##### 9.3.2.3.4 Pre-established session stopped
When the pre-established session between the MCPTT client and the
participating MCPTT function is released, the participating MCPTT function:
1\. shall release any media plane resources and timers associated with this
pre-established session; and,
2\. shall enter the \'Start-stop\' state
##### 9.3.2.3.5 Receive SIP 200 (OK) response to the SIP re-INVITE request (R:
200 OK)
Upon receiving the SIP 200 (OK) response to the SIP re-INVITE request of the
pre-established session a call as specified in 3GPP TS 24.379 [2] (call setup
with manual answer with pre-established session) the participating MCPTT
function:
1\. shall send the Connect message to the invited MCPTT client(s) using the
media plane control transport channel defined for this call. The Connect
message:
a. shall include the SIP URI received in the Contact header field of the SIP
INVITE request in the \ value in the MCPTT Session
Identity field;
b. if the SIP INVITE request included an \"application/vnd.3gpp.mcptt-
info+xml\" MIME body with the \ element set to a value of
\"prearranged\" or \"chat\":
i. shall include the content of the \ element in the
MCPTT Group Identity field; and
ii. shall include the value \'prearranged\' or \'chat\' in the \
value in the MCPTT Session Identity field;
c. if the SIP re-INVITE request included an \"application/vnd.3gpp.mcptt-
info+xml\" MIME body with the \ element set to a value of
\"private\":
i. may include the content of the \ element in the
Inviting MCPTT User Identity field, if available from the SIP re-INVITE
message and privacy of the inviting MCPTT ID is not required;
ii. may include \'anonymous\@anonymous.invalid\' in the Inviting MCPTT User
Identity field if the MCPTT ID of the inviting MCPTT user is not available
from the SIP re-INVITE message or privacy of the inviting MCPTT ID is
required; and
iii. shall include the value \'private\' in the \ value in the
MCPTT Session Identity field;
d. shall include a Media Streams field, if the negotiated SDP in the pre-
arranged session contains more media streams than required by the SDP in the
SIP INVITE request; and
NOTE: For example if the call is a private call without floor control the
Media Streams field needs to be included with the \ value set
to \'0\'.
e. may set the first bit in the subtype of the Connect message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
2\. shall start timer T55 (Connect);
3\. shall initialise counter C55 (Connect) to 1;
4\. shall reserve the media channel resources if not yet reserved; and
5\. shall enter the \'G: Pre-established session in use\' state.
#### 9.3.2.4 State: \'G: Pre-established session in use\'
##### 9.3.2.4.1 General
The \'G: Pre-established session in use\' state is a stable state. The
participating MCPTT function is in this state when a pre-established session
is used for a call.
In this state the participating MCPTT function can receive RTP media packets
and pre-established session call control messages.
##### 9.3.2.4.2 Receive floor control message (R: Floor control message)
Upon receiving a floor control message the participating MCPTT function:
1\. shall perform the actions in subclause 6.4.1; and
2\. shall remain in the \'G: Pre-established session in use\' state.
##### 9.3.2.4.3 Receive RTP media packets (R: RTP Media)
Upon receiving an RTP media packet the participating MCPTT function:
1\. shall perform the actions in subclause 6.4.1; and
2\. shall remain in the \'G: Pre-established session in use\' state.
##### 9.3.2.4.4 Receive call session release indication from MCPTT client (R:
Call Release from MCPTT client)
Upon receiving an indication from the MCPTT client that the call is released
but the pre-established session is kept alive (see 3GPP TS 24.379 [2]), the
participating MCPTT function:
1\. shall send call release to the controlling MCPTT function as specified in
3GPP TS 24.379 [2];
2\. may release the media resources associated with the call not needed for
the pre-established session;
3\. shall stop timer T55 (Connect); and
4\. shall enter the \'G: Pre-established session not in use\' state.
##### 9.3.2.4.5 Receive call session release indication from the controlling
MCPTT function (R: Call Release from MCPTT server)
Upon receiving an indication from the controlling MCPTT function that the call
is released (see 3GPP TS 24.379 [2]), the participating MCPTT function:
1\. shall stop timer T55 (Connect)if running;
2\. shall send Disconnect message to the MCPTT client. The Disconnect message:
a. shall include the MCPTT Session Identity field with the same content as
sent in the Connect message when the MCPTT call was established; and
b. should set the first bit in the subtype of the Disconnect message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
3\. shall start timer T56 (Disconnect);
4\. shall initialise counter C56 (Disconnect) to 1; and
5\. shall enter the \'G: Call releasing\' state.
##### 9.3.2.4.6 Receive pre-established session stopped indication from the
MCPTT client (R: Pre-established Session Stopped from MCPTT client)
Upon receiving the pre-established session release indication (see 3GPP TS
24.379 [2]) from the MCPTT client. The participating MCPTT function:
1\. shall stop sending RTP media packet and floor control messages between the
MCPTT client and the controlling MCPTT function;
2\. shall release any media plane resources and timers associated with this
pre-established session; and
3\. shall enter the \'Start-stop\' state.
##### 9.3.2.4.7 Receive Acknowledge message ((R: successful Ack) or (R:
failure Ack))
Upon receiving an Acknowledge message from the MCPTT client, the participating
MCPTT function:
1\. shall stop timer T55 (Connect);
2\. if the Reason Code is not \'Accepted\' the participating MCPTT function:
a. shall send Disconnect message to the MCPTT client;
i. shall include the MCPTT Session Identity field with the same content as
sent in the Connect message when the MCPTT call was established; and
ii. should set the first bit in the subtype of the Disconnect message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
b. shall start timer T56 (Disconnect);
c. shall initialise counter C56 (Disconnect) to 1;
d. shall send a call release indication to the controlling MCPTT function (see
3GPP TS 24.379 [2]); and
e. shall enter the \'G: Call releasing\' state; and
3\. otherwise the participating MCPTT function:
a. shall send a SIP 200 (OK) response to the SIP INVITE request as specified
in 3GPP TS 24.379 [2] if the SIP 200 (OK) response to the SIP INVITE request
is not already sent; and
b. shall remain in the \'G: Pre-established session in use\' state.
##### 9.3.2.4.8 Timer T55 (Connect) expired
On the expiry of timer T55 (Connect) the participating MCPTT function:
1\. shall retransmit the Connect message sent to the MCPTT client using the
media plane control transport channel defined for this MCPTT call;
2\. shall start timer T55 (Connect);
3\. shall increment counter C55 (Connect) by 1; and
4\. shall remain in the \'G: Pre-established session in use\' state.
##### 9.3.2.4.9 Timer T55 (Connect) expired N times
When timer T55 (Connect) expires by the upper limit of counter C55 (Connect)
times, the participating MCPTT function:
1\. shall send a call release indication to the controlling MCPTT function as
specified in 3GPP TS 24.379 [2];
2\. may release the media resources associated with the call not needed for
the pre-established session; and
3\. shall enter the \'G: Pre-established session not in use\' state.
##### 9.3.2.4.10 Receive SIP 200 (OK) response (R: 200 OK)
Upon receiving a SIP 200 (OK) response from the controlling MCPTT function,
the participating MCPTT function:
1\. shall send the Connect message to the MCPTT client which initiated this
call using the media plane control transport channel defined for this call.
The Connect message:
a. shall include the SIP URI received in the Contact header field of the SIP
200 (OK) response in the \ value in the MCPTT Session
Identity field;
b. if an \"application/vnd.3gpp.mcptt-info+xml\" MIME body with an \ element is included in the SIP 200 (OK) response, shall include the
\ value in the MCPTT Session Identity field with a value
corresponding to the \ element;
c. if an \"application/vnd.3gpp.mcptt-info+xml\" MIME body with an \ element is not included in the SIP 200 (OK) response, shall include the
\ value set to \'no session type\' in the MCPTT Session Identity
field;
d. if a Warning header field with set to the value \"399\" is received in the
SIP 200 (OK) response, shall include the content of the \"warn-text\"
parameter in the Warn Text header field;
e. if a P-Answer-State header field is included in the SIP 200 (OK) response,
shall include an Answer State field with a value corresponding to the
\"answer-type\" parameter; and
f should set the first bit in the subtype of the Connect message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
2\. shall start timer T55 (Connect);
3\. shall increment counter C55 (Connect) by 1; and,
4\. shall remain in the \'G: Pre-established session in use\' state.
##### 9.3.2.4.11 Receive failed SIP response from the controlling MCPTT
function (R: Call Release from the MCPTT server)
Upon receiving a failed call setup indication from the controlling MCPTT
function, the participating MCPTT function:
1\. shall send an Disconnect message to the MCPTT client;
a. shall include the MCPTT Session Identity field with the same content as
sent in the Connect message when the MCPTT call was established; and
b. should set the first bit in the subtype of the Disconnect message to \'1\'
(Acknowledgment is required) as described in subclause 8.3.2;
2\. shall start timer T56 (Disconnect);
3\. shall initialise counter C56 (Disconnect) to 1;
4\. shall terminate the call; and
5\. shall enter the \'G: Call releasing\' state.
#### 9.3.2.5 State: \'G: Call releasing\'
##### 9.3.2.5.1 General
The \'G: Call releasing\' state is a transition state. The participating MCPTT
function is in this state when a call is being released by keeping the pre-
established session.
Timer T56 (Disconnect) is running in this state.
##### 9.3.2.5.2 Receive Acknowledge message (R: Ack)
Upon receiving an Acknowledge message from the MCPTT client, the participating
MCPTT function:
1\. shall stop timer T55 (Connect), if running;
2\. shall stop timer T56 (Disconnect);
3\. may release the media resources associated with the call not needed for
the pre-established session; and
4\. shall enter the \'G: Pre-established session not in use\' state.
##### 9.3.2.5.3 Timer T56 (Disconnect) expired
On the expiry of timer T56 (Disconnect) less than the upper limit of counter
C56 (Disconnect) times, the participating MCPTT function:
1\. shall retransmit the Disconnect message sent to the MCPTT client using the
media plane control transport channel defined for this call;
2\. shall start timer T56 (Disconnect);
3\. shall increment counter C56 (Disconnect) by 1; and
4\. shall remain in the \'G: Call releasing\' state.
##### 9.3.2.5.4 Timer T56 (Disconnect) expired N times
When timer T56 (Disconnect) expires by the upper limit of counter C56
(Disconnect) times, the participating MCPTT function:
1\. may release the media resources associated with the call not needed for
the pre-established session; and
2\. shall enter the \'G: Pre-established session not in use\' state.
# 10 MBMS subchannel control procedure
## 10.1 General
A participating MCPTT function sending floor control messages and RTP media
packets over a MBMS bearer shall support the procedures in the following
subclauses.
The MBMS bearer can be used for conversations in group calls. Prior to using
the MBMS bearer the participating MCPTT function needs to activate the MBMS
bearer and announce the MBMS bearer as described in subclause 4.1. 3.
Floor control messages and RTP media packets received over the MBMS subchannel
are used as input to the floor participant state machine in the same way as
floor control messages and RTP media packets received over the unicast bearer.
Media plane security procedures for media and floor control messages sent over
the MBMS subchannels are specified in clause 13.
## 10.2 MBMS subchannel control procedure for the participating MCPTT function
### 10.2.1 General
If the participating MCPTT function supports the MBMS subchannel control
procedure, the participating MCPTT function shall support the behaviour
implied by the state machine specified in this subclause. The specifications
are on the reception of floor control messages from the controlling MCPTT
function, sending of floor control messages and the allocation/deallocation of
a MBMS subchannel for a conversation in a group session.
Figure 10.2.1-1 shows the participating MCPTT function MBMS subchannel control
state diagram.
Figure 10.2.1-1: Participating MCPTT function MBMS subchannel control state
diagram
If a floor control message or RTP media packet arrives in a state where there
are no procedures specified in the subclauses below, the participating MCPTT
function shall discard the message.
### 10.2.2 State: \'Start-stop\'
#### 10.2.2.1 General
In this state:
\- no instance of the \'Participating MCPTT function MBMS subchannel control
state machine exists;
\- a pre-activated MBMS bearer may exist;
\- no conversation using a MBMS subchannel control is active but a group
session exists where a conversation over the unicast channel may be ongoing;
and
\- the participating MCPTT function handles floor control messages and RTP
media packets as for during normal operations described in subclause 6.4.
#### 10.2.2.2 Send Map Group To Bearer message (R: Floor Request or Floor
Taken)
Upon receiving a Floor Request message or a Floor Taken message and when the
participating MCPTT function decides that a MBMS subchannel shall be used for
a conversation in an ongoing group session, the participating MCPTT function:
NOTE: The participating MCPTT function can take that decision when receiving
the first Floor Request from a floor participant or when receiving a Floor
Taken message destined to one of the floor participants served by the
participating MCPTT client.
1\. shall create an instance of the \'Participating MCPTT function MBMS
subchannel control\' state machine;
2\. shall send a Map Group To Bearer message over the general purpose MBMS
subchannel. The Map Group To Bearer message:
a. shall include TMGI;
b. shall include the identifier of the media stream; and
c. shall include the MCPTT Group identifier field;
3\. shall start timer T15 (Conversation);
4\. shall start timer T16 (Unmap Group To Bearer);
5\. shall enter the \'M: A conversation is active\' state;
6\. if the Floor Request was received, shall perform actions as described in
subclause 6.4; and
7\. if the Floor Taken was received, shall perform the actions described in
subclause 10.2.3.3.
### 10.2.3 State: \'M: A conversation is active\'
#### 10.2.3.1 General
In this state a MBMS subchannel exists and can be used by a group call.
In this state a conversation is active and Floor Taken and Floor Idle messages
and RTP media packets shall be sent over the MBMS subchannel.
In this state timer T15 (Conversation) and timer T16 (Map Group To Bearer re-
transmit) are running.
In this state the timer T17 (Unmap Group To Bearer) may be running.
#### 10.2.3.2 Send Floor Idle message (R: Floor Idle)
When a Floor Idle message destined to a floor participant listening to the
MBMS subchannel is received, the participating MCPTT function:
1\. shall for each received Floor Idle message, check if there is a stored
message-sequence-number value associated with the conversation;
2\. if a message-sequence-number value associated with the conversation is
stored, compared the value of the stored message-sequence-number value with
the value in the received Floor Idle message;
a. if the received message-sequence-number value is higher than the stored
value:
i. shall replace the stored message-sequence-number value with the received
message-sequence-number field;
ii. shall set the acknowledgment bit to \'0\' as specified in subclause 8.2.2,
if not already set; and
iii. shall send the received Floor Idle message over the MBMS subchannel; and
b. if the received message-sequence-number value is lower or the same as the
stored value, shall discard the received Floor Idle message;
3\. if a message-sequence-number value associated with the conversation is not
stored (i.e. this is the first floor control message received in the
conversation):
a. shall store the received message-sequence-number value and associate the
value with the conversation;
b. shall set the acknowledgment bit to \'0\' as specified in subclause 8.2.2,
if not already set; and
c. shall send the received Floor Idle message over the MBMS subchannel;
4\. if the received Floor Idle message indicates that a Floor Ack message is
expected (i.e. the acknowledgment bit is set to \'1\' as specified in
subclause 8.2.2), shall send a Floor Ack message towards the controlling MCPTT
function. The Floor Ack message:
a. shall include the Message Type field set to \'5\' (Floor Idle); and
b. shall include the Source field set to \'1\' (participating MCPTT function
is the source);
5\. shall restart timer T15 (Conversation); and
6\. shall remain in the \'M: A conversation is active\' state.
#### 10.2.3.3 Send Floor Taken message (R: Floor Taken)
When a Floor Taken message destined to a floor participant listening to the
MBMS subchannel is received, the participating MCPTT function:
1\. shall for each received Floor Taken message, check if there is a stored
message-sequence-number value associated with the conversation;
2\. if a message-sequence-number value associated with the conversation is
stored, compare the value of the stored message-sequence-number value with the
value in the received Floor Taken message;
a. if the received message-sequence-number value is higher than the stored
value:
i. shall replace the stored message-sequence-number value with the received
message-sequence-number field;
ii. shall set the acknowledgment bit to \'0\' as specified in subclause 8.2.2,
if not already set; and
iii. shall send the received Floor Taken message over the MBMS subchannel; and
b. if the received message-sequence-number value is lower or the same as the
stored value, shall discard the received Floor Taken message;
3\. if a message-sequence-number value associated with the conversation is not
stored (i.e. this is the first floor control message received in the
conversation):
a. shall store the received message-sequence-number value and associate the
value with the conversation;
b. shall set the acknowledgment bit to \'0\' as specified in subclause 8.2.2,
if not already set; and
c. shall send the received Floor Taken message over the MBMS subchannel;
4\. if the received Floor Taken message indicates that a Floor Ack message is
expected (i.e. the acknowledgment bit is set to \'1\' as specified in
subclause 8.2.2), shall send a Floor Ack message towards the controlling MCPTT
function The Floor Ack message:
a. shall include the Message Type field set to \'2\' (Floor Taken); and
b. shall include the Source field set to \'1\' (participating MCPTT function
is the source);
5\. shall restart timer T15 (Conversation); and
6\. shall remain in the \'M: A conversation is active\' state.
#### 10.2.3.4 Send any other floor control message (R: Any other message)
When a floor control message other than the Floor Idle and Floor Taken message
is received from a floor participant or received from the floor control
server, the participating MCPTT function:
1\. shall forward the floor control message as specified in subclause 6.4;
2\. shall restart timer T15 (Conversation); and
3\. shall remain in the \'M: A conversation is active\' state.
#### 10.2.3.5 Send RTP media packet over the MBMS subchannel (R: RTP packet)
When receiving a RTP media packet destined to one of the MCPTT client
listening to the MBMS subchannel, the participating MCPTT function:
NOTE: An RTP media packet not destined to an MCPTT client listening to the
MBMS subchannel is forwarded to the MCPTT client over the unicast bearer.
1\. shall check if the media packet is already sent over the MBMS subchannel
or not;
2\. if the RTP media packet is already sent over the MBMS subchannel, shall
discard the RTP media packet;
3\. if the RTP media packet is not already sent over the MBMS sub channel,
shall instruct the media distribution function to send the RTP media packet
over the MBMS subchannel;
4\. shall restart timer T15 (Conversation); and
5\. shall remain in the \'M: A conversation is active\' state.
#### 10.2.3.6 Timer T15 (Conversation) expired
Upon expiry of timer T15 (Conversation), the participating MCPTT function
shall:
1\. if the application indicates that there is no longer an MCPTT client
listening to the MBMS bearer,
a. shall release the instance of the \'Participating MCPTT function MBMS
subchannel management\' state machine used for the conversation; and
b. shall enter the \'Start-stop\' state; and
2\. if the application indicates that there are MCPTT client still listening
to the MBMS bearer:
a. shall send the Unmap Group To Bearer message over the MBMS subchannel. The
Unmap Group To Bearer message:
i. shall include the MCPTT Group ID field;
b. shall start timer T17 (Unmap Group To Bearer) and initialise counter C17
(Unmap Group To Bearer) to 1; and
c. shall remain in the \'M: A conversation is active\' state.
#### 10.2.3.7 Timer T16 (Map Group To Bearer) expired
Upon expiry of timer T16 (Map Group To Bearer), the participating MCPTT
function:
1\. shall send a Map Group To Bearer message over the general purpose MBMS
subchannel. The Map Group To Bearer message:
a. shall include a TMGI field;
b. shall include a MBMS Subchannel field; and
c shall include the MCPTT Group identifier field;
2\. shall restart timer T16 (Map Group To Bearer); and
3\. shall remain in the \'M: A conversation is active\' state.
#### 10.2.3.8 Timer T17 (Unmap Group To Bearer) expired
Upon expiry of timer T17 (Unmap Group To Bearer) less than the upper limit of
counter C17 (Unmap Group To Bearer) times, the participating MCPTT function:
1\. shall send the Unmap Group To Bearer message over the MBMS subchannel. The
Unmap Group To Bearer message:
a. shall include the MCPTT Group ID field; and
2\. shall restart the timer T17 (Map Group To Bearer re-transmit) and
increment counter C17 (Unmap Group To Bearer) by 1.
#### 10.2.3.9 Timer T17 (Unmap Group To Bearer) expired Nth time
Upon expiry of timer T17 (Unmap Group To Bearer) by the upper limit of counter
C17 (Unmap Group To Bearer), the participating MCPTT function:
1\. shall send the Unmap Group To Bearer message over the MBMS subchannel. The
Unmap Group To Bearer message:
a. shall include the MCPTT Group ID field; and
2\. shall release the instance of the \'Participating MCPTT function MBMS
subchannel management\' state machine used for the conversation.
#### 10.2.3.10 End conversation over the MBMS bearer (End conversation)
Upon receiving an indication from the application and signalling plane that
all MCPTT clients now listens to the unicast channel, the participating MCPTT
function:
1\. shall release the instance of the \'Participating MCPTT function MBMS
subchannel management\' state machine used for the conversation.
#### 10.2.3.11 Group call released
If the control and signalling plane indicates that the group call session is
released, the participating MCPTT function:
1\. shall send the Unmap Group To Bearer message over the MBMS subchannel. The
Unmap Group To Bearer message:
a. shall include the MCPTT Group ID field;
2\. shall stop timer T15 (Conversation), timer T16 (Map Group To Bearer) and
timer T17 (Unmap Group To Bearer), if running; and
3\. shall release the instance of the \'Participating MCPTT function MBMS
subchannel management\' state machine used for the conversation.
## 10.3 MBMS subchannel control procedure for the MCPTT client
### 10.3.1 General
An MCPTT client that supports receiving floor control messages and RTP media
packets over an MBMS bearer shall support the procedures in the following
subclauses.
The procedures in the following subclauses assume that an MBMS bearer is
active and announced as described in subclause 4.1.3.
NOTE: The floor control procedures described in subclause 6.2 are not impacted
due to the use of an MBMS bearer.
### 10.3.2 Conversation over a pre-activated MBMS bearer is started
When receiving a Map Group To Bearer message over the general purpose MBMS
subchannel, the MBMS interface in the MCPTT client:
1\. shall associate the TMGI in the TMGI field, the MBMS subchannel for audio
and for floor control with the MCPTT group identity in the MCPTT Group ID
field.
### 10.3.3 Receive floor control messages and RTP media packets over a MBMS
subchannel
If the MBMS interface receives RTP media packets or floor control messages
over the MBMS subchannel, the MBMS interface in the MCPTT client:
1\. if there is an association between the TMGI, the MBMS subchannel for audio
and for floor control to an ongoing conversation in a group session:
a. shall forward the received floor control messages to the floor participant
in the conversation; and
b. if the received RTP media contains a different SSRC value than the SSRC
value used by the MCPTT client, shall forward the received RTP packets to the
media mixer in the conversation; and
2\. if there is no such association:
a. shall ignore the received floor control message or received RTP media
packet.
### 10.3.4 Conversation ended
When receiving the Unmap Group To Bearer message over a MBMS subchannel, the
MBMS interface in the MCPTT client:
1\. shall remove the association between the TMGI, the MBMS subchannel for
audio and for floor control from the conversation in the group session
identified by the MCPTT Group ID field, if such an association exists.
# 11 Configurable parameters
## 11.1 Timers
### 11.1.1 Timers in the on-network floor participant
The table 11.1.1-1 recommends timer values, describes the reason for starting
the timer, normal stop and the action on expiry for the on-network floor
participant procedures.
Table 11.1.1-1: Timers in the on-network floor participant
+-------------+-------------+-------------+-------------+-------------+ | Timer | Timer value | Cause of | Normal stop | On expiry | | | | start | | | +=============+=============+=============+=============+=============+ | T100 | C | When the | Reception | If the | | | onfigurable | floor | of a Floor | counter is | | (Floor | as | participant | Idle | less than | | Release) | specified | sends a | message or | the upper | | | in | Floor | when the | limit of | | | 3GPP TS 24 | Release | floor | C100, a new | | | .483 [4]. | message. | participant | Floor | | | | | detects the | Release | | | (NOTE 1) | | receipt of | message is | | | | | RTP media. | sent and | | | | | | counter is | | | | | | incremented | | | | | | by 1. | | | | | | | | | | | | When the | | | | | | limit in | | | | | | C100 is | | | | | | reached, | | | | | | the floor | | | | | | participant | | | | | | stops | | | | | | sending the | | | | | | Floor | | | | | | Release | | | | | | message. | +-------------+-------------+-------------+-------------+-------------+ | T101 | C | When the | Reception | When T101 | | | onfigurable | floor | of a Floor | expires, a | | (Floor | as | participant | Granted | new Floor | | Request) | specified | sends a | message, a | Request | | | in | Floor | Floor Taken | message is | | | 3GPP TS 24 | Request | message, a | sent. | | | .483 [4]. | message. | Floor Deny | | | | | | message, a | | | | (NOTE 2) | T101 is | Floor Queue | | | | | also | Position | | | | | started | Info | | | | | when the | message or | | | | | application | when the | | | | | layer and | floor | | | | | signalling | participant | | | | | plane | receives | | | | | initiates a | RTP media | | | | | session as | from | | | | | an implicit | another | | | | | floor | floor | | | | | request | p | | | | | using the | articipant. | | | | | \"m | | | | | | c_implicit | | | | | | _request\" | | | | | | as | | | | | | specified | | | | | | in | | | | | | clause 14. | | | +-------------+-------------+-------------+-------------+-------------+ | T103 | Should be | Reception | The | When T103 | | | equal to | of a Floor | reception | expires the | | (end of RTP | T1. | Taken | of a Floor | floor | | media) | | message or | Idle | control | | | C | an RTP | message. | client | | | onfigurable | media | | concludes | | | as | packet. | | that the | | | specified | | | RTP media, | | | in | T13 is | | which it | | | 3GPP TS 24 | reset and | | was started | | | .483 [4]. | started | | for, has | | | | again every | | completed. | | | | time an RTP | | | | | | media | | | | | | packet is | | | | | | received. | | | +-------------+-------------+-------------+-------------+-------------+ | T104 (Floor | C | When the | Reception | If the | | Queue | onfigurable | floor | of a Floor | counter is | | Position | as | participant | Queue | less than | | Request) | specified | sends a | Position | the upper | | | in | Floor Queue | Info | limit of | | | 3GPP TS 24 | Position | message. | C104, a new | | | .483 [4]. | Request | | Floor Queue | | | | message. | Leaving the | Position | | | T104 shall | | 'U: queued' | Request | | | only permit | | state. | message is | | | a certain | | | sent and | | | number of | | | counter is | | | retr | | | incremented | | | ansmissions | | | by 1. | | | of the | | | | | | Floor Queue | | | When the | | | Position | | | limit in | | | Request | | | C104 is | | | message. | | | reached, | | | | | | the floor | | | | | | participant | | | | | | stops | | | | | | sending the | | | | | | Floor Queue | | | | | | Position | | | | | | Request | | | | | | message. | +-------------+-------------+-------------+-------------+-------------+ | T132 | Default | When the | When a | The floor | | (Queued | value: | floor | floor | participant | | granted | | participant | participant | sends a | | user | 2 seconds. | receives a | in 'U: | Floor | | action) | | Floor | queued' | Release | | | C | Granted | state | message and | | | onfigurable | message for | pushes PTT | may | | | as | a queued | button. | indicate to | | | specified | request. | | the user | | | in | | | that the | | | 3GPP TS 24 | | | floor is no | | | .483 [4]. | | | more | | | | | | available | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: The | | | | | | total time | | | | | | during | | | | | | which the | | | | | | floor | | | | | | participant | | | | | | retransmits | | | | | | the Floor | | | | | | Release | | | | | | messages | | | | | | shall be | | | | | | less than 6 | | | | | | seconds. | | | | | | | | | | | | NOTE 2: The | | | | | | total time | | | | | | during | | | | | | which the | | | | | | floor | | | | | | participant | | | | | | retransmits | | | | | | Floor | | | | | | Request | | | | | | messages | | | | | | should be | | | | | | less than 6 | | | | | | seconds. | | | | | +-------------+-------------+-------------+-------------+-------------+
### 11.1.2 Timers in the off-network floor participant
The table 11.1.2-1 recommends timer values, describes the reason for starting
the timer, normal stop and the action on expiry for the off-network floor
participant procedures.
Table 11.1.2-1: Timers in the off-network floor participant
+-------------+-------------+-------------+-------------+-------------+ | Timer | Timer value | Cause of | Normal stop | On expiry | | | | start | | | +=============+=============+=============+=============+=============+ | T201 | Default | When the | Reception | If the | | | value: | floor | of a Floor | counter is | | (Floor | | participant | Granted | less than | | Request) | 40 | sends a | message or | the upper | | | m | Floor | a Floor | limit of | | | illiseconds | Request | Deny | C201, a new | | | | message. | message or | Floor | | | Depends on | | a Floor | Request | | | the | | Queue | message is | | | cha | | Position | sent and | | | racteristic | | Info | counter is | | | of the D2D. | | message or | incremented | | | (D2D Side | | when the | by 1. | | | link | | MCPTT user | | | | period) | | releases | When the | | | | | the PTT | limit in | | | Co | | button. | C201 is | | | nfigurable. | | | reached, | | | | | | the floor | | | Set to the | | | participant | | | value of | | | stops | | | \"/\/Of | | | sending the | | | fNetwork/Ti | | | Floor | | | mers/T201\" | | | Request | | | leaf node | | | message. | | | present in | | | | | | the UE | | | | | | initial | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483. [4] | | | | | | | | | | | | T201 shall | | | | | | permit only | | | | | | a certain | | | | | | number of | | | | | | retr | | | | | | ansmissions | | | | | | of the | | | | | | Floor | | | | | | Request | | | | | | message. | | | | +-------------+-------------+-------------+-------------+-------------+ | T203 | Default | When the | Reception | When T203 | | | value: | floor | of a Floor | expires the | | (End of RTP | | participant | Release | floor | | media) | 4 seconds. | receives an | message or | participant | | | | RTP media | a Floor | concludes | | | Maximum | packet. | Granted to | that there | | | value: | | me or | is no floor | | | | T203 is | | arbitrator | | | 6 seconds. | also reset | when the | at present. | | | | and started | floor | | | | Co | again every | participant | | | | nfigurable. | time an RTP | enters 'O: | | | | | media | has | | | | Set to the | packet is | permission' | | | | value of | received or | | | | | \"/\/Of | | | | | | fNetwork/Ti | when the | | | | | mers/T203\" | floor | | | | | leaf node | participant | | | | | present in | enters 'O: | | | | | the UE | has no | | | | | initial | permission' | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483 [4]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T204 (Floor | Default | When the | Reception | If the | | Queue | value: | floor | of the | counter is | | Position | | participant | Floor Queue | less than | | Request) | 80 | sends a | Position | the upper | | | mi | Floor Queue | Info | limit of | | | lliseconds. | Position | message. | C204, a new | | | | Request | | Floor Queue | | | Depends on | message. | | Position | | | the | | | Request | | | cha | | | message is | | | racteristic | | | sent and | | | of the D2D. | | | counter is | | | (D2D Side | | | incremented | | | link | | | by 1. | | | period*2). | | | | | | | | | When the | | | T204 shall | | | limit in | | | permit only | | | C204 is | | | a certain | | | reached, | | | number of | | | the floor | | | retr | | | participant | | | ansmissions | | | stops | | | of the | | | sending the | | | Floor Queue | | | Floor Queue | | | Position | | | Position | | | Request | | | Request | | | message. | | | message. | | | | | | | | | Co | | | | | | nfigurable. | | | | | | | | | | | | Set to the | | | | | | value of | | | | | | \"/\/Of | | | | | | fNetwork/Ti | | | | | | mers/T204\" | | | | | | leaf node | | | | | | present in | | | | | | the UE | | | | | | initial | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483 [4]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T205 (Floor | Default | When the | Reception | If the | | Granted) | value: | floor | of an RTP | counter is | | | | arbitrator | media | less than | | | 80 | grants the | packet from | the upper | | | mi | permission | granted | limit of | | | lliseconds. | to send | floor | C205, a new | | | | media to a | participant | Floor | | | Depends on | floor | in 'O: | Granted | | | the | p | pending | message is | | | cha | articipant, | granted' | sent and | | | racteristic | which was a | | counter is | | | of the D2D. | pre-empting | | incremented | | | (D2D | floor | | by 1. | | | Sidelink | request or | | | | | period*2). | was in its | | When the | | | | queue when | | limit in | | | Co | the PTT | | C205 is | | | nfigurable. | button was | | reached, | | | | released. | | the floor | | | Set to the | | | arbitrator | | | value of | | | stops | | | \"/\/Of | | | sending the | | | fNetwork/Ti | | | Floor | | | mers/T205\" | | | Granted | | | leaf node | | | message. | | | present in | | | | | | the UE | | | | | | initial | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483 [4]. | | | | | | | | | | | | T205 shall | | | | | | permit only | | | | | | a certain | | | | | | number of | | | | | | retr | | | | | | ansmissions | | | | | | of the | | | | | | Floor | | | | | | Granted | | | | | | message. | | | | +-------------+-------------+-------------+-------------+-------------+ | Timer T206 | Default | When the | When the | Start timer | | (Stop | value: | MCPTT | MCPTT user | T207 (Stop | | talking | | client | releases | talking) | | warning) | 27 seconds. | starts | the PTT | | | | | sending the | button. | | | | Co | RTP media | | | | | nfigurable. | packets. | | | | | | | | | | | Set to X-Y, | | | | | | where X is | | | | | | the value | | | | | | of | | | | | | \"/_\ _/OffNet | | | | | | work/Transm | | | | | | itTimeout\" | | | | | | and Y is | | | | | | the value | | | | | | \"/_\ _ | | | | | | /OffNetwork | | | | | | /Transmissi | | | | | | onWarning\" | | | | | | of leaf | | | | | | nodes | | | | | | present in | | | | | | the UE | | | | | | service | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483 [4]. | | | | +-------------+-------------+-------------+-------------+-------------+ | Timer T207 | Default | Expiry of | When the | If the | | (Stop | value: | timer T206 | MCPTT user | value of | | talking) | | (Stop | releases | \"/\/\/O | | | | warning) | button. | ffNetwork/Q | | | Co | | | ueueUsage\" | | | nfigurable. | | | leaf node | | | | | | present in | | | Set to the | | | the group | | | value of | | | co | | | \"/_\ _ | | | nfiguration | | | /OffNetwork | | | as | | | /Transmissi | | | specified | | | onWarning\" | | | in | | | leaf node | | | 3GPP TS 2 | | | present in | | | 4.483 [4] | | | the service | | | is set to | | | co | | | \"true\" | | | nfiguration | | | and queue | | | as | | | is not | | | specified | | | empty, | | | in | | | grant to | | | 3GPP TS 24 | | | the next | | | .483 [4]. | | | MCPTT user | | | | | | in the | | | | | | queue. | | | | | | | | | | | | Otherwise, | | | | | | release the | | | | | | floor. | +-------------+-------------+-------------+-------------+-------------+ | T230 | Default | When the | A floor | The floor | | | value: | floor | control | control | | ( | | participant | message or | entity is | | Inactivity) | 600 | enters \'O: | media is | released. | | | seconds. | silence\' | received. | | | | | state. | | | | | Value | | | | | | should be | | | | | | more than | | | | | | T203. | | | | | | | | | | | | Co | | | | | | nfigurable. | | | | | | | | | | | | For group | | | | | | calls: | | | | | | | | | | | | Set to the | | | | | | value of | | | | | | \"/_\ | | | | | | _/\ | | | | | | /OffNetwork | | | | | | /HangTime\" | | | | | | leaf node | | | | | | present in | | | | | | the group | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483 [4]. | | | | | | | | | | | | For private | | | | | | calls: | | | | | | | | | | | | Set to the | | | | | | value of | | | | | | \"/_\ _/ | | | | | | OffNetwork/ | | | | | | PrivateCall | | | | | | /HangTime\" | | | | | | leaf node | | | | | | present in | | | | | | the service | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .483 [4]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T233 | Default | Reception/T | When a | Assume the | | (Pending | value: | ransmission | floor | participant | | user | | of Floor | participant | is out of | | action) | 3 seconds. | Granted | in 'O: | coverage or | | | | message for | queued' | doesn\'t | | | Maximum | a queued | state | want to | | | value: | request. | pushes PTT | speak | | | | | button. | anymore. | | | 5 seconds. | | | Grant to | | | | | Reception | next in | | | Co | | of RTP | queue if | | | nfigurable. | | media | any, | | | | | packet from | otherwise | | | Set to the | | granted | assume | | | value of | | floor | silence. | | | \"/\/Of | | participant | | | | fNetwork/Ti | | in 'O: | | | | mers/T233\" | | pending | | | | leaf node | | granted' | | | | present in | | | | | | the UE | | | | | | initial | | | | | | co | | | | | | nfiguration | | | | | | as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 2 | | | | | | 4.483 [4] | | | | | | | | | | | | The total | | | | | | time | | | | | | ( | | | | | | T205*C205+ | | | | | | T233) | | | | | | during | | | | | | which the | | | | | | floor | | | | | | arbitrator | | | | | | retransmits | | | | | | Floor | | | | | | Granted | | | | | | message and | | | | | | waits for | | | | | | user to | | | | | | accept | | | | | | floor | | | | | | should be | | | | | | less than | | | | | | T203. | | | | +-------------+-------------+-------------+-------------+-------------+
### 11.1.3 Timers in the floor control server
The table 11.1.3-1 recommends timer values, describes the reason for starting
the timer, normal stop and the action on expiry for the floor control server
procedures.
Table 11.1.3-1: Timers in the floor control server.
+-------------+-------------+-------------+-------------+-------------+ | TIMER | TIMER VALUE | CAUSE OF | NORMAL STOP | ON EXPIRY | | | | START | | | +=============+=============+=============+=============+=============+ | T1 | Default | T | When the | When T1 | | | value: | ransmission | floor is | expires it | | (End of RTP | | of either a | released. | is | | media) | 4 seconds | SIP message | | concluded | | | | that | | that the | | | Maximum | includes an | | granted | | | value: | optional | | floor | | | | \"mc | | request has | | | 6 seconds. | _granted\" | | been | | | | fmtp | | completed. | | | C | attribute, | | | | | onfigurable | or a Floor | | | | | | Granted | | | | | Obtained | message to | | | | | from the | the floor | | | | | \ | participant | | | | |  | given | | | | | element of | permission | | | | | the | to send | | | | | \ | when RTP | | | | | element of | media | | | | | the | packets are | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | | | | | | | | | (NOTE 1, | | | | | | NOTE 2) | | | | +-------------+-------------+-------------+-------------+-------------+ | T2 | Default | Detection | Detection | When T2 | | | maximum | of an RTP | of the | expires, it | | (Stop | value: | media | completion | is | | talking) | | packet. | of media. | concluded | | | 30 seconds. | | | that the | | | | (NOTE 5) | | floor | | | Co | | | participant | | | nfigurable. | | | that has | | | | | | permission | | | Obtained | | | to send RTP | | | from the | | | media has | | | \ | | | long. | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T3 | Default | Expiry of | **Reception | When T3 | | | value: | T2. | of a Floor | expires, no | | (Stop | | | Release | more RTP | | talking | 3 seconds | | message | media is | | grace) | or 0 | | from the | allowed and | | | seconds if | | floor | that the | | | group is | | participant | floor is | | | configured | | that has | idle. | | | for audio | | permission | | | | cut-in | | to send | | | | obtained | | media.** | | | | from the \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the group | | | | | | document as | | | | | | in | | | | | | 3GPP TS 24. | | | | | | 481 [12]. | | | | | | | | | | | | Co | | | | | | nfigurable. | | | | | | | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T4 | Default | When the | A floor | The MCPTT | | | value: | floor | participant | call is | | ( | | control | requests | released. | | Inactivity) | 30 seconds. | server | the | | | | | enters the | permission | | | | Co | \'G: | to send | | | | nfigurable. | \'Floor | media. | | | | | idle\' | | | | | For private | state. | | | | | calls: | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | | | | | | | | | For group | | | | | | calls: | | | | | | | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 481 [12]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T7 | Depends on | The | The stop | When T7 | | | the | t | can be | expire the | | (Floor | cha | ransmission | supervised | floor | | Idle) | racteristic | of a Floor | by a timer | control | | | of the | Idle | (out of | server | | | radio | message to | scope of | sends | | | access | the floor | this | another | | | network. | p | spec | Floor Idle | | | | articipants | ification). | message to | | | Co | in the | The | the floor | | | nfigurable. | MCPTT call. | recommended | pa | | | | | value of | rticipants. | | | Obtained | | this timer | | | | from the | | is the same | | | | \ | | the value | | | | element of | | of the T15 | | | | the | | (co | | | | \ | | timer. | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T8 | Default | A Floor | Expiry of | Send | | | value: | Revoke | T3 or | another | | (Floor | | message is | reception | Floor | | Revoke) | 1 second. | sent to a | of a Floor | Revoke | | | | floor | Release | message to | | | Co | participant | message | the floor | | | nfigurable. | with the | from the | participant | | | | permission | revoked | and reset | | | Obtained | to send | floor | and start | | | from the | media. | p | T8 again. | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T11 (End of | Default | When floor | When the | When T11 | | RTP dual) | value: | is granted | floor is | expires it | | | | to to the | released. | is | | | 4 seconds. | overriding | | concluded | | | | MCPTT | | that the | | | Maximum | client. T11 | | granted | | | value: | is | | overriding | | | | restarted | | floor has | | | 6 seconds. | each time | | been | | | | an RTP | | completed | | | C | packet is | | | | | onfigurable | received | | | | | | from the | | | | | Obtained | overriding | | | | | from the | MCPTT | | | | | \ | client. | | | | |  | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | | | | | | | | | (NOTE 1) | | | | +-------------+-------------+-------------+-------------+-------------+ | T12 (Stop | Default | Detection | Detection | When T12 | | talking | maximum | of an RTP | of the | expires it | | dual) | value: | media | completion | is | | | | packet of | of media of | concluded | | | 30 seconds. | the | the | that the | | | | overriding | overriding | overriding | | | Co | MCPTT | MCPTT | MCPTT | | | nfigurable. | client if | client. | client has | | | | not already | | talked too | | | Obtained | running. | | long. | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T20 (Floor | Default | When the | Reception | When T20 | | Granted) | value: | floor | of an RTP | expires, a | | | | control | Media | new Floor | | | 1 second. | server | packet or | Granted | | | | grants the | when the | message is | | | Co | permission | MCPTT | sent unless | | | nfigurable. | to send | client is | the total | | | | media to a | losing its | time as | | | Obtained | floor | permission | limited by | | | from the | p | to send | T1 is | | | \ | which was | | | | | element of | queued and | | | | | the | which | | | | | \ | queueing. | | | | | element of | | | | | | the | T20 is also | | | | | \ | again when | | | | | element in | the floor | | | | | 3GPP TS 24 | control | | | | | .484 [13] | server | | | | | | sends a | | | | | (NOTE 4) | Floor | | | | | | Granted | | | | | | message | | | | | | upon T20 | | | | | | expiry. | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: The | | | | | | minimum | | | | | | value (Min) | | | | | | should be | | | | | | greater | | | | | | than the | | | | | | expected | | | | | | round trip | | | | | | delay from | | | | | | floor | | | | | | control | | | | | | server to | | | | | | the remote | | | | | | floor | | | | | | p | | | | | | articipant. | | | | | | Special | | | | | | co | | | | | | nsideration | | | | | | should be | | | | | | given to | | | | | | o | | | | | | ver-the-air | | | | | | connections | | | | | | that | | | | | | introduce | | | | | | significant | | | | | | t | | | | | | ransmission | | | | | | latency due | | | | | | to low | | | | | | bandwidth. | | | | | | | | | | | | NOTE 2: T1 | | | | | | can be set | | | | | | to higher | | | | | | value than | | | | | | normally | | | | | | when a | | | | | | queued | | | | | | MCPTT | | | | | | client is | | | | | | granted the | | | | | | permission | | | | | | to send | | | | | | media. | | | | | | | | | | | | NOTE 3: If | | | | | | the Floor | | | | | | Release | | | | | | message | | | | | | doesn\'t | | | | | | include the | | | | | | sequence | | | | | | number of | | | | | | the last | | | | | | RTP packet | | | | | | the T3 is | | | | | | stopped on | | | | | | the | | | | | | reception | | | | | | of the MBCP | | | | | | Media Burst | | | | | | Release | | | | | | message. | | | | | | | | | | | | NOTE 4: T20 | | | | | | shall only | | | | | | permit a | | | | | | certain | | | | | | number of | | | | | | retr | | | | | | ansmissions | | | | | | of the | | | | | | Floor | | | | | | Granted | | | | | | message. | | | | | | The total | | | | | | time during | | | | | | which the | | | | | | floor | | | | | | control | | | | | | server | | | | | | retransmits | | | | | | the Floor | | | | | | Granted | | | | | | messages is | | | | | | limited by | | | | | | T1. | | | | | | | | | | | | NOTE 5: T2 | | | | | | is not | | | | | | started in | | | | | | the case of | | | | | | an ambient | | | | | | listening | | | | | | call. | | | | | +-------------+-------------+-------------+-------------+-------------+
### 11.1.4 Timers in the participating MCPTT function
The table 11.1.4-1 and table 11.1.4-2 recommends timer values, describes the
reason for starting the timer, normal stop and the action on expiry.
Table 11.1.4-1 shows the timers used in the call over pre-established session
procedures in the participating MCPTT function.
Table 11.1.4-1: Timers in the participating MCPTT function for pre-established
session control.
+-------------+-------------+-------------+-------------+-------------+ | TIMER | TIMER VALUE | CAUSE OF | NORMAL STOP | ON EXPIRY | | | | START | | | +=============+=============+=============+=============+=============+ | T55 | Default | T | Reception | On the | | | value: | ransmission | of an | expiry of | | (Connect) | | of | Ackn | this timer | | | 2 seconds. | \'Connect\' | owledgement | less than a | | | | message by | to the | c | | | Maximum | the | Connect | onfigurable | | | value: | pa | message. | number of | | | | rticipating | | times the | | | 4 seconds. | MCPTT | | \'Connect\' | | | | function. | | message is | | | Co | | | resent. | | | nfigurable. | | | | | | | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T56 | Default | T | Reception | On the | | | value: | ransmission | of an | expiry of | | ( | | of | Acknowledge | this timer | | Disconnect) | 2 seconds. | \'D | message to | less than a | | | | isconnect\' | the | c | | | Maximum | message by | Disconnect | onfigurable | | | value: | the | message. | number of | | | | pa | | times the | | | 4 seconds. | rticipating | | \'D | | | | MCPTT | | isconnect\' | | | Co | function. | | message is | | | nfigurable. | | | resent. | | | | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+
Table 11.1.4-2 shows the timers used in the participating MCPTT function for
MBMS channel control.
Table 11.1.4-2: Timers in the participating MCPTT function for MBMS channel
control.
+-------------+-------------+-------------+-------------+-------------+ | TIMER | TIMER VALUE | CAUSE OF | NORMAL STOP | ON EXPIRY | | | | START | | | +=============+=============+=============+=============+=============+ | T15 | Default | T | Release of | Send Unmap | | (Co | value: | ransmission | the call. | Group To | | nversation) | | of Map | | Bearer | | | 30 seconds. | Group To | | message. | | | | Bearer | | | | | Co | message. | | | | | nfigurable. | | | | | | | Restarted | | | | | Obtained | when an RTP | | | | | from the | packet or a | | | | | \ | control | | | | | element of | message is | | | | | the | sent. | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T16 (Map | Default | T | Release of | Send Map | | Group To | value: | ransmission | the call | Group To | | Bearer) | | of Map | (or MBMS | Bearer | | | 500 | Group To | S | message. | | | mi | Bearer | ubchannel). | | | | lliseconds. | message. | | | | | | | | | | | Co | | | | | | nfigurable. | | | | | | | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+ | T17 (Unmap | Default | T | Release of | Send Unmap | | Group To | value: | ransmission | the call. | Group To | | Bearer) | | of Unmap | | Bearer | | | 200 | Group To | | message. | | | mi | Bearer | | | | | lliseconds. | message. | | | | | | | | | | | Co | | | | | | nfigurable. | | | | | | | | | | | | Obtained | | | | | | from the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element of | | | | | | the | | | | | | \ | | | | | | element in | | | | | | 3GPP TS 24. | | | | | | 484 [13]. | | | | +-------------+-------------+-------------+-------------+-------------+
## 11.2 Counters
### 11.2.1 Counters in the on-network floor participant
Table 11.2.1-1 enlists counters, their limits and the action on expiry.
Table 11.2.1-1: Counter used in the floor participant for on-network floor
control
Counter Limit Associated timer On reaching the limit
* * *
C100 (Floor Release) Default value: 3 T100 (Floor Release) Floor Release
message is no more repeated C101 (Floor Request) Default value: 3 T101 (Floor
Request) Floor Request message is no more repeated C104 (Floor Queue Position
Request) Default value: 3 T104 (Floor Queue Position Request) Floor Queue
Position Request message is no more repeated
### 11.2.2 Counters in the off-network floor participant
The table 11.2.2-1 lists the counters used by the off-network participant,
their default upper limits and the action to take upon reaching the upper
limit. The counters start at 1.
Table 11.2.1.2-1: Counter used in the floor participant for off-network floor
control
+----------------+----------------+----------------+----------------+ | Counter | Upper Limit | Associated | Upon reaching | | | | timer | the upper | | | | | limit | +================+================+================+================+ | C201 | Default value: | T201 (Floor | Assume there | | | 3. | Request) | is no floor | | (Floor | | | arbitrator and | | Request) | Configurable. | | send Floor | | | | | Taken message | | | Set to the | | | | | value of | | | | | \"/\/OffNetwork/C | | | | | ounters/C201\" | | | | | leaf node | | | | | present in the | | | | | UE initial | | | | | configuration | | | | | as specified | | | | | in | | | | | 3GPP TS | | | | | 24.483 [4]. | | | +----------------+----------------+----------------+----------------+ | C204 | Default value: | T204 (Floor | Floor Queue | | | 3. | Queue Position | Position | | (Floor Queue | | Request) | Request | | Position | Configurable. | | message is no | | Request) | | | more repeated | | | Set to the | | | | | value of | | | | | \"/\/OffNetwork/C | | | | | ounters/C204\" | | | | | leaf node | | | | | present in the | | | | | UE initial | | | | | configuration | | | | | as specified | | | | | in | | | | | 3GPP TS | | | | | 24.483 [4]. | | | +----------------+----------------+----------------+----------------+ | C205 (Floor | Default value: | T205 (Floor | If there is a | | Granted) | 4. | Granted) | pending | | | | | request(s) in | | | Configurable. | | the queue, | | | | | start timer | | | Set to the | | T233 (pending | | | value of | | user action) | | | \"/\/OffNetwork/C | | RTP media from | | | ounters/C205\" | | the client. | | | leaf node | | | | | present in the | | | | | UE initial | | | | | configuration | | | | | as specified | | | | | in | | | | | 3GPP TS | | | | | 24.483 [4]. | | | +----------------+----------------+----------------+----------------+
### 11.2.3 Counters in the controlling MCPTT function
The table 11.2.3-1 enlists counters, their limits and the action on expiry for
the \'general control operation\' state machine in the controlling MCPTT
function.
Table 11.2.3-1: Counters used in the \'general floor control operation\' state
machine
+----------------+----------------+----------------+----------------+ | Counter | Limit | Associated | On reaching | | | | timer | the limit | +================+================+================+================+ | C7 | Default value: | T7 (Floor | The Floor Idle | | | 10. | Idle) | message is no | | (Floor Idle) | | | more re-send | | | Configurable. | | | | | | | | | | Obtained from | | | | | the | | | | | \ | | | | | element of the | | | | | \ | | | | | element of the | | | | | \ | | | | | element in | | | | | 3GPP TS | | | | | 24.484 [13]. | | | +----------------+----------------+----------------+----------------+ | C20 | Default value: | T20 (Floor | The Floor | | | 3. | Granted) | Granted | | (Floor | | | message is no | | Granted) | Configurable. | | more re-send | | | | | in case a | | | Obtained from | | queued floor | | | the | | participant is | | | \ | | floor. | | | element of the | | | | | \ | | | | | element of the | | | | | \ | | | | | element in | | | | | 3GPP TS | | | | | 24.484 [13]. | | | +----------------+----------------+----------------+----------------+ | NOTE: If a | | | | | counter value | | | | | is not | | | | | configured the | | | | | default value | | | | | shall be used. | | | | +----------------+----------------+----------------+----------------+
### 11.2.4 Counters in the participating MCPTT function
The table 11.2.4-1 enlists counters, their limits and the action on expiry for
the \'pre-established session state machine\'.
Table 11.2.4-1: Counters used in the \'pre-established session state machine\'
+--------------+----------------+----------------+----------------+ | Counter | Limit | Associated | On reaching | | | | timer | the limit | +==============+================+================+================+ | C55 | Default value: | T55 (Connect) | The Connect | | | 3. | | message is no | | (Connect) | | | more re-send | | | Configurable. | | | | | | | | | | Obtained from | | | | | the | | | | | \ | | | | |  | | | | | element of the | | | | | \ | | | | | element of the | | | | | \ | | | | | element in | | | | | 3GPP TS | | | | | 24.484 [13]. | | | +--------------+----------------+----------------+----------------+ | C56 | Default value: | T56 | The Disconnect | | | 3. | (Disconnect) | message is no | | (Disconnect) | | | more re-send | | | Configurable. | | | | | | | | | | Obtained from | | | | | the | | | | | \ | | | | | element of the | | | | | \ | | | | | element of the | | | | | \ | | | | | element in | | | | | 3GPP TS | | | | | 24.484 [13]. | | | +--------------+----------------+----------------+----------------+
The table 11.2.4-2 enlists counters, their limits and the action on expiry for
the \'Participating MCPTT function MBMS subchannel control state machine\'.
Table 11.2.4-2: Counters used in the \'Participating MCPTT function MBMS
subchannel control state machine\'
+----------------+----------------+----------------+----------------+ | Counter | Limit | Associated | On reaching | | | | timer | the limit | +================+================+================+================+ | C17 | Default value: | T17 (Unmap | The Unmap | | | 3. | Group To | Group To | | (Unmap Group | | Bearer) | Bearer message | | To Bearer) | Configurable. | | is no more | | | | | re-sent. | | | Obtained from | | | | | the | | | | | \ | | | | |  | | | | | element of the | | | | | \ | | | | | element in | | | | | 3GPP TS | | | | | 24.484 [13]. | | | +----------------+----------------+----------------+----------------+
# 12 Extensions within the present document
## 12.1 Session description types defined within the present document
### 12.1.1 General
This subclause contains definitions for SDP parameters that are specific to
SDP usage with MCPTT and therefore are not described in an RFC.
### 12.1.2 SDP \"fmtp\" attribute for MCPTT
#### 12.1.2.1 General
This subclause defines the structure and syntax of the SDP \"fmtp\" attribute,
when used to negotiate an MCPTT media plane control channel. The MCPTT media
plane control channel, and the protocols used on the control channel, is
described in the present specification.
#### 12.1.2.2 Semantics
In an SDP offer and answer, the \"mc_queueing\" fmtp attribute is used to
indicate support of the Floor Request message queueing mechanism, as defined
in the present specification.
In an SDP offer, the \"mc_priority\" fmtp attribute indicates (using an
integer value between \'1\' and \'255\') the maximum floor priority that the
offerer requests to be used with Floor Request messages sent by the offerer.
In an SDP answer, the attribute parameter indicates the maximum priority level
that the answerer has granted to the offerer. The value must be equal or less
than the value provided in the associated SDP offer.
NOTE 1: If the \"mc_priority\" fmtp attribute is not used within an SDP offer
or answer, a default priority value is assumed.
In an SDP offer, the \"mc_granted\" fmtp attribute parameter indicates that
the offerer supports the procedure where the answerer indicates, using the
fmtp attribute in the associated SDP answer, that the floor has been granted
to the offerer.
NOTE 2: When the \"mc_granted\" fmtp attribute is used in an SDP offer, it
does not indicate an actual request for the floor. The SDP
\"mc_implicit_request\" fmtp attribute can be used to request the floor. In an
SDP answer, the attribute indicates that the floor has been granted to the
offerer.
NOTE 3: Once the offerer has been granted the floor, the offerer has the floor
until it receives a Floor Revoke message, or until the offerer itself releases
the floor by sending a Floor Release message, as described in the present
specification.
In an SDP offer, the \"mc_implicit_request\" fmtp attribute indicates that the
offerer implicitly requests the floor (without the need to send a Floor
Request message). In an SDP answer, the attribute parameter indicates that the
answerer has accepted the implicit floor request. Once the answerer grants the
floor to the offerer, the answerer will send a Floor Granted message.
NOTE 4: The usage of the \"mc_implicit_request\" fmtp attribute in an SDP
answer does not mean that the answerer has granted the floor to the offerer,
only that the answerer has accepted the implicit floor request.
In an SDP answer, the \"mc_ssrc\" fmtp attribute indicates ssrc value of the
offerer. The value may be equal to the value provided in the associated SDP
offer or different if a collision is detected. If the associated SDP offer
does not indicate the ssrc value then server can determine an appropriate
value. This value is returned in an SDP answer only if the answerer accepts
the implicit floor request offered in SDP.
In an SDP offer, the \"mc_no_floor_ctrl\" fmtp attribute indicates that the
offerer wants to use pre-established session call control during the session
without floor control over the offered media plane control channel. In an SDP
answer, the attribute parameter indicates that the answerer has accepted the
request to use the offered media plane control channel for pre-established
session call control during the session without floor control.-
#### 12.1.2.3 Syntax
Table 12.1.2.3-1: SDP \"fmtp\" attribute for the MCPTT media plane control
channel
fmtp-attr-mpcp = \"a=fmtp:\" \"MCPTT\" SP attr-param-list
attr-param-list = attr-param *(COLON attr-param)
attr-param = mc_queueing / mc_priority / mc_granted / mc_implicit_request /
mc_ssrc / mc_no_floor_ctrl
mc_queueing = \"mc_queueing\"
mc_priority = \"mc_priority=\" 1*2(DIGIT)
mc_granted = \"mc_granted\"
mc_implicit_request = \"mc_implicit_request\"
mc_ssrc = \"mc_ssrc=\" 1*(DIGIT)
mc_no_floor_ctrl = \"mc_no_floor_ctrl\"
# 13 Media plane security
## 13.1 General
Media plane security provides integrity and confidentiality protection of
individual media streams and media plane control messages in MCPTT sessions.
The media plane security is based on 3GPP MCPTT security solution including
key management and end-to-end media and floor control messages protection as
defined in 3GPP TS 33.180 [18].
Various keys and associated key identifiers protect:
1\. RTP transported media;
2\. RTCP transported media control messages (i.e. RTCP SR packets, RTCP RR
packets, RTCP SDES packets);
3\. RTCP APP transported floor control messages;
4\. RTCP APP transported pre-established session call control messages; and
5\. RTCP APP transported MBMS subchannel control messages.
In an on-network group call of an MCPTT group which is not a constituent MCPTT
group of a temporary MCPTT group:
1\. if protection of media is negotiated, the GMK and the GMK-ID of the MCPTT
group protect the media sent and received by an MCPTT clients;
2\. if protection of floor control messages sent using unicast between the
MCPTT client and the participating MCPTT function serving the MCPTT client is
negotiated, the CSK and the CSK-ID protect the floor control messages sent and
received using unicast by the MCPTT client and by a participating MCPTT
function;
3\. if protection of floor control messages sent over the MBMS subchannel from
the participating MCPTT function to the served MCPTT clients is required:
A) if a MuSiK and a MuSiK-ID are associated with the on-network group call,
the MuSiK and the MuSiK-ID associated with the on-network group call protect
the floor control messages sent over the MBMS subchannel from the
participating MCPTT function to the served MCPTT clients; and
B) if a MuSiK and a MuSiK-ID are not associated with the on-network group
call, the MKFC and the MKFC-ID of the MCPTT group protect the floor control
messages sent over the MBMS subchannel from the participating MCPTT function
to the served MCPTT clients;
NOTE 1: If protection of floor control messages sent over the MBMS subchannel
from the participating MCPTT function to the served MCPTT clients is required
and the participating MCPTT function is compliant to Release 14 of the present
document, a MuSiK and a MuSiK-ID are always associated with the on-network
group call.
4\. if protection of floor control messages between the participating MCPTT
function and the controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the floor control messages sent and received between the
participating MCPTT function and the controlling MCPTT function;
5\. if protection of media control messages sent using unicast between the
MCPTT client and the participating MCPTT function serving the MCPTT client is
negotiated, the CSK and the CSK-ID protect the media control messages sent and
received using unicast by the MCPTT client and by a participating MCPTT
function; and
6\. if protection of media control messages between the participating MCPTT
function and the controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the media control messages sent and received between the
participating MCPTT function and the controlling MCPTT function.
In an on-network group call of an MCPTT group which is a constituent MCPTT
group of a temporary MCPTT group:
1\. if protection of media is negotiated, the GMK and the GMK-ID of the
temporary MCPTT group protect the media sent and received by an MCPTT client;
2\. if protection of floor control messages sent using unicast between the
MCPTT client and the participating MCPTT function serving the MCPTT client is
negotiated, the CSK and the CSK-ID protect the floor control messages sent and
received using unicast by the MCPTT client and by the participating MCPTT
function;
3\. if protection of floor control messages sent over the MBMS subchannel from
the participating MCPTT function to the served MCPTT clients is required:
A) if a MuSiK and a MuSiK-ID are associated with the on-network group call,
the MuSiK and the MuSiK-ID associated with the on-network group call protect
the floor control messages sent over the MBMS subchannel from the
participating MCPTT function to the served MCPTT clients; and
B) if a MuSiK and a MuSiK-ID are not associated with the on-network group
call, the MKFC and the MKFC-ID of the temporary MCPTT group protect the floor
control messages sent over the MBMS subchannel from the participating MCPTT
function to the served MCPTT clients;
NOTE 2: If protection of floor control messages sent over the MBMS subchannel
from the participating MCPTT function to the served MCPTT clients is required
and the participating MCPTT function is compliant to Release 14 of the present
document, a MuSiK and a MuSiK-ID are always associated with the on-network
group call.
4\. if protection of floor control messages between the participating MCPTT
function and the non-controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the floor control messages sent and received between the
participating MCPTT function and the non-controlling MCPTT function;
5\. if protection of floor control messages between the non-controlling MCPTT
function and the controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the floor control messages sent and received between the non-
controlling MCPTT function and the controlling MCPTT function;
6\. if protection of media control messages sent using unicast between the
MCPTT client and the participating MCPTT function serving the MCPTT client is
negotiated, the CSK and the CSK-ID protect the media control messages sent and
received using unicast by the MCPTT client and by a participating MCPTT
function;
7\. if protection of media control messages between the participating MCPTT
function and the non-controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the media control messages sent and received between the
participating MCPTT function and the non-controlling MCPTT function; and
8\. if protection of media control messages between the non-controlling MCPTT
function and the controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the media control messages sent and received between the non-
controlling MCPTT function and the controlling MCPTT function.
In an on-network private call:
1\. if protection of media is negotiated, the PCK and the PCK-ID protect media
sent and received by the MCPTT clients;
2\. if protection of floor control messages sent using unicast between the
MCPTT client and the participating MCPTT function serving the MCPTT client is
negotiated, the CSK and the CSK-ID protect the floor control messages sent and
received by the MCPTT client and by the participating MCPTT function;
3\. if protection of floor control messages between the participating MCPTT
function and the controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the floor control messages sent and received between the
participating MCPTT function and the controlling MCPTT function;
4\. if protection of media control messages sent using unicast between the
MCPTT client and the participating MCPTT function serving the MCPTT client is
negotiated, the CSK and the CSK-ID protect the media control messages sent and
received using unicast by the MCPTT client and by a participating MCPTT
function; and
5\. if protection of media control messages between the participating MCPTT
function and the controlling MCPTT function is negotiated, the SPK and the
SPK-ID protect the media control messages sent and received between the
participating MCPTT function and the controlling MCPTT function.
In an off-network group call of an MCPTT group:
1\. if protection of media is announced, the GMK and the GMK-ID of the MCPTT
group protect the media sent and received by an MCPTT client;
2\. if protection of floor control messages is announced, the GMK and the GMK-
ID of the MCPTT group protect the floor control messages sent and received by
an MCPTT client; and
3\. if protection of media control messages is announced, the GMK and the GMK-
ID of the MCPTT group protect the media sent and received by an MCPTT client.
In an off-network private call:
1\. if protection of media is negotiated, the PCK and the PCK-ID protect media
sent and received by an MCPTT client;
2\. if protection of floor control messages is negotiated, the PCK and the
PCK-ID protect floor control messages sent and received by an MCPTT client;
and
3\. if protection of media control messages is negotiated, the PCK and the
PCK-ID protect media control messages and received by an MCPTT client.
In an pre-established session, if the pre-established session call control
messages between the MCPTT client and the participating MCPTT function serving
the MCPTT client are negotiated to be protected, the CSK and the CSK-ID
protect the pre-established session call control messages sent and received by
the MCPTT client and by the participating MCPTT function serving the MCPTT
client.
If protection of MBMS subchannel control messages sent over the general
purpose MBMS subchannel of an MBMS bearer is required, the MSCCK and the
MSCCK-ID associated with the MBMS bearer protect the MBMS subchannel control
messages sent over the general purpose MBMS subchannel of the MBMS bearer by
the participating MCPTT function to the MCPTT client.
The GMK and the GMK-ID are distributed to the MCPTT clients using the group
document subscription and notification procedure specified in 3GPP TS 24.481
[12].
The CSK and the CSK-ID are generated by the MCPTT client and provided to the
participating MCPTT function serving the MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2].
The MKFC and the MKFC-ID are distributed to the MCPTT clients using the group
document subscription and notification procedure specified in 3GPP TS 24.481
[12]. The MKFC and the MKFC-ID are distributed to the controlling MCPTT
function using the group document subscription and notification procedure
specified in 3GPP TS 24.481 [12] and the controlling MCPTT function provides
the MKFC and the MKFC-ID to the participating MCPTT function using SIP
signalling according to 3GPP TS 24.379 [2].
The SPK and the SPK-ID are configured in the participating MCPTT function, the
controlling MCPTT function and the non-controlling MCPTT function.
The PCK and the PCK-ID are generated by the MCPTT client initiating the
private call and provided to the MCPTT client receiving the private call using
SIP signalling according to 3GPP TS 24.379 [2], using Connect message
described in subclause 8.3.4 or using MONP signalling according to 3GPP TS
24.379 [2].
The MSCCK and the MSCCK-ID associated with an MBMS bearer are generated by the
participating MCPTT function which activated the MBMS bearer and are provided
to one or more served MCPTTs clients using SIP signalling according to 3GPP TS
24.379 [2].
The MuSiK and the MuSiK-ID are associated with the on-network group call
according to 3GPP TS 24.379 [4].
## 13.2 **Derivation of SRTP/SRTCP master keys**
Each key (i.e. CSK, GMK, MKFC, PCK, SPK, MSCCK, MuSiK) and its associated key
identifier (i.e. CSK-ID, GMK-ID, MKFC-ID, PCK-ID, SPK-ID, MSCCK-ID, MuSiK-ID)
described in subclause 13.1 are used to derive SRTP-MK, SRTP-MS and SRTP-MKI.
SRTP-MK, SRTP-MS and SRTP-MKI are used in encryption of media or floor control
messages in SRTP as specified in IETF RFC 3711 [16] and 3GPP TS 33.180 [18].
## 13.3 Media plane encryption and decryption
### 13.3.1 General
Void.
### 13.3.2 The participating MCPTT function
The participating MCPTT function:
1\. if protection of media is negotiated, shall be transparent to RTP media
streams and shall forward encrypted RTP media streams without decrypting the
payload;
2\. if protection of floor control messages sent using unicast between the
participating MCPTT function and the MCPTT client is negotiated and the CSK
and the CSK-ID were received from the MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2]:
A) shall encrypt floor control messages sent using unicast to the served MCPTT
client according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK,
SRTP-MS and SRTP-MKI generated using the CSK and CSK-ID as specified in
subclause 13.2; and
B) shall decrypt floor control messages received using unicast from the served
MCPTT client according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the CSK and CSK-ID as specified
in subclause 13.2;
3\. if protection of floor control messages sent over the MBMS subchannel from
the participating MCPTT function to the served MCPTT clients is required and a
MuSiK and a MuSiK-ID are associated with the on-network group call of the
floor control messages:
A) shall encrypt floor control messages sent over the MBMS subchannel
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the MuSiK and MuSiK-ID as specified in subclause
13.2;
NOTE: The participating MCPTT function compliant to Release 14 of the present
document does not use MKFC and MKFC-ID.
4\. if protection of floor control messages between the participating MCPTT
function and the controlling MCPTT function is negotiated and the SPK and the
SPK-ID are configured in the participating MCPTT function:
A) shall encrypt floor control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in subclause
13.2; and
B) shall decrypt floor control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2;
5\. if protection of floor control messages between the participating MCPTT
function and the non-controlling MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the participating MCPTT function:
A) shall encrypt floor control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
B) shall decrypt floor control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in subclause 13.2;
6\. if protection of pre-established session call control messages between the
participating MCPTT function and the MCPTT client is negotiated and the CSK
and the CSK-ID were received from the MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2]:
A) shall encrypt pre-established session call control messages sent to the
served MCPTT client according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18]
using SRTP-MK, SRTP-MS and SRTP-MKI generated using the CSK and CSK-ID as
specified in subclause 13.2; and
B) shall decrypt pre-established session call control messages received from
served MCPTT client according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18]
using SRTP-MK, SRTP-MS and SRTP-MKI generated using the CSK and CSK-ID as
specified in subclause 13.2;
7\. if protection of media control messages sent using unicast between the
participating MCPTT function and the MCPTT client is negotiated between the
participating MCPTT function and the MCPTT client and the CSK and the CSK-ID
were received from the MCPTT client using SIP signalling according to 3GPP TS
24.379 [2];
A) shall encrypt media control messages sent using unicast to the served MCPTT
client according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK,
SRTP-MS and SRTP-MKI generated using the CSK and CSK-ID as specified in
subclause 13.2; and
B) shall decrypt media control messages received using unicast from the served
MCPTT client according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the CSK and CSK-ID as specified
in subclause 13.2;
8\. if protection of media control messages between the participating MCPTT
function and the controlling MCPTT function is negotiated and the SPK and the
SPK-ID are configured in the participating MCPTT function:
A) shall encrypt media control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in subclause
13.2; and
B) shall decrypt media control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2;
9\. if protection of media control messages between the participating MCPTT
function and the non-controlling MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the participating MCPTT function:
A) shall encrypt media control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
B) shall decrypt media control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in subclause 13.2; and
10\. if protection of MBMS subchannel control messages sent over the general
purpose MBMS subchannel of an MBMS bearer is required and the MSCCK and the
MSCCK-ID associated with the MBMS bearer were sent to one or more served MCPTT
clients using SIP signalling according to 3GPP TS 24.379 [2]:
A) shall encrypt MBMS subchannel control messages specified in subclause 8.4
sent over the general purpose MBMS subchannel of the MBMS bearer according to
IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the MSCCK and MSCCK-ID associated with the MBMS bearer as
specified in subclause 13.2.
### 13.3.3 The MCPTT client
The MCPTT client:
1\. in an on-network group call of an MCPTT group which is not a constituent
MCPTT group of a temporary MCPTT group:
A) if protection of media is negotiated and the GMK and the GMK-ID of the
MCPTT group were received using the group document subscription and
notification procedure specified in 3GPP TS 24.481 [12] for the MCPTT group:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID as
specified in subclause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
GMK-ID as specified in subclause 13.2;
B) if protection of floor control messages sent using unicast is negotiated
and the CSK and the CSK-ID were sent to the participating MCPTT function using
SIP signalling according to 3GPP TS 24.379 [2]:
i) shall encrypt floor control messages sent using unicast according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2; and
ii) shall decrypt floor control messages received using unicast according to
IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2;
C) if protection of floor control messages sent over the MBMS subchannel from
the participating MCPTT function to the served MCPTT clients is required:
i) if a MuSiK and a MuSiK-ID are associated with the on-network group call,
shall decrypt floor control messages received over the MBMS subchannel for
floor control messages according to IETF RFC 3711 [16] and 3GPP TS 33.180 [14]
using SRTP-MK, SRTP-MS and SRTP-MKI generated using the MuSiK and the MuSiK-ID
associated with the on-network group call as specified in subclause 13.2; and
ii) if a MuSiK and a MuSiK-ID are not associated with the on-network group
call and the MKFC and the MKFC-ID of the MCPTT group were received using the
group document subscription and notification procedure specified in 3GPP TS
24.481 [12] for the MCPTT group, shall decrypt floor control messages received
over the MBMS subchannel for floor control messages according to IETF RFC 3711
[16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated
using the MKFC and MKFC-ID as specified in subclause 13.2; and
NOTE 1: The MCPTT client can receive floor control messages encrypted using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the MKFC and MKFC-ID from a
participating MCPTT function compliant only to Release 13 of the present
document.
D) if protection of media control messages sent using unicast between the
participating MCPTT function and the MCPTT client is negotiated and the CSK
and the CSK-ID were sent to the participating MCPTT function using SIP
signalling according to 3GPP TS 24.379 [2]:
i) shall encrypt media control messages sent using unicast according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2; and
ii) shall decrypt media control messages received using unicast according to
IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2;
2\. in an on-network group call of an MCPTT group which is a constituent MCPTT
group of a temporary MCPTT group:
A) if protection of media is negotiated and the GMK and the GMK-ID of the
temporary MCPTT group were received using the group document subscription and
notification procedure specified in 3GPP TS 24.481 [12] for the constituent
MCPTT group:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID of
the temporary MCPTT group as specified in subclause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
GMK-ID of the temporary MCPTT group as specified in subclause 13.2;
B) if protection of floor control messages sent using unicast is negotiated
and the CSK and the CSK-ID were sent to the participating MCPTT function using
SIP signalling according to 3GPP TS 24.379 [2]:
i) shall encrypt floor control messages sent using unicast according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2; and
ii) shall decrypt floor control messages received using unicast according to
IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2;
C) if protection of floor control messages sent over the MBMS subchannel from
the participating MCPTT function to the served MCPTT clients is required:
i) if a MuSiK and a MuSiK-ID are associated with the on-network group call,
shall decrypt floor control messages received over the MBMS subchannel for
floor control messages according to IETF RFC 3711 [16] and 3GPP TS 33.180 [14]
using SRTP-MK, SRTP-MS and SRTP-MKI generated using the MuSiK and the MuSiK-ID
associated with the on-network group call as specified in subclause 13.2; and
ii) if a MuSiK and a MuSiK-ID are not associated with the on-network group
call and the MKFC and the MKFC-ID of the temporary MCPTT group were received
using the group document subscription and notification procedure specified in
3GPP TS 24.481 [12] for the constituent MCPTT group, shall decrypt floor
control messages received over the MBMS subchannel for floor control messages
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the MKFC and MKFC-ID of the temporary MCPTT group
as specified in subclause 13.2; and
NOTE 2: The MCPTT client can receive floor control messages encrypted using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the MKFC and MKFC-ID from a
participating MCPTT function compliant only to Release 13 of the present
document.
D) if protection of media media control messages sent using unicast between
the participating MCPTT function and the MCPTT client is negotiated and the
CSK and the CSK-ID were sent to the participating MCPTT function using SIP
signalling according to 3GPP TS 24.379 [2]:
i) shall encrypt media control messages sent using unicast according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2;
ii) shall decrypt media control messages received using unicast according to
IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2;
3\. in an on-network private call:
A) if:
i) protection of media is negotiated in originating call and the PCK and the
PCK-ID were sent to the remote MCPTT client using SIP signalling according to
3GPP TS 24.379 [2]; or
ii) protection of media is negotiated in terminating call and the PCK and the
PCK-ID were received from the remote MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2];
then:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and PCK-ID as
specified in subclause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
PCK-ID as specified in subclause 13.2;
B) if protection of floor control messages is negotiated and the CSK and the
CSK-ID were sent to the participating MCPTT function using SIP signalling
according to 3GPP TS 24.379 [2]:
i) shall encrypt sent floor control messages according to IETF RFC 3711 [16]
and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using
the CSK and CSK-ID as specified in subclause 13.2; and
ii) shall decrypt received floor control messages according to IETF RFC 3711
[16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated
using the CSK and CSK-ID as specified in subclause 13.2; and
D) if protection of media media control messages sent using unicast between
the participating MCPTT function and the MCPTT client is negotiated and the
CSK and the CSK-ID were sent to the participating MCPTT function using SIP
signalling according to 3GPP TS 24.379 [2]:
i) shall encrypt media control messages sent using unicast according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2; and
ii) shall decrypt media control messages received using unicast according to
IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the CSK and CSK-ID as specified in subclause 13.2;
4\. in an off-network group call of an MCPTT group:
A) if protection of media is announced and the GMK and GMK-ID of the MCPTT
group were received when on-network using the group document subscription and
notification procedure specified in 3GPP TS 24.481 [12] for the MCPTT group:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID as
specified in subclause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
GMK-ID as specified in subclause 13.2;
B) if protection of floor control messages is announced and the GMK and the
GMK-ID of the MCPTT group were received when on-network using the group
document subscription and notification procedure specified in 3GPP TS 24.481
[12] for the MCPTT group:
i) shall encrypt sent floor control messages according to IETF RFC 3711 [16]
and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using
the GMK and GMK-ID as specified in subclause 13.2; and
ii) shall decrypt received floor control messages according to IETF RFC 3711
[16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated
using the GMK and GMK-ID as specified in subclause 13.2; and
C) if protection of media control messages is announced and the GMK and GMK-ID
of the MCPTT group were received when on-network using the group document
subscription and notification procedure specified in 3GPP TS 24.481 [12] for
the MCPTT group:
i) shall encrypt sent sent media control messages according to IETF RFC 3711
[16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated
using the GMK and GMK-ID as specified in subclause 13.2; and
ii) shall decrypt received received media control messages according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the GMK and GMK-ID as specified in subclause 13.2;
5\. in an off-network private call:
A) if:
i) protection of media is negotiated in originating call and the PCK and the
PCK-ID were sent to the remote MCPTT client using MONP signalling according to
3GPP TS 24.379 [2]; or
ii) protection of media is negotiated in terminating call and the PCK and the
PCK-ID were received from the remote MCPTT client using MONP signalling
according to 3GPP TS 24.379 [2];
then:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and PCK-ID as
specified in subclause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
PCK-ID as specified in subclause 13.2;
B) if:
i) protection of floor control messages is negotiated in originating call and
the PCK and the PCK-ID were sent to the remote MCPTT client using MONP
signalling according to 3GPP TS 24.379 [2]; or
ii) protection of floor control messages is negotiated in terminating call and
the PCK and the PCK-ID were received from the remote MCPTT client using MONP
signalling according to 3GPP TS 24.379 [2].
then:
i) shall encrypt sent floor control messages according to IETF RFC 3711 [16]
and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using
the PCK and PCK-ID as specified in subclause 13.2; and
ii) shall decrypt received floor control messages according to IETF RFC 3711
[16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated
using the PCK and PCK -ID as specified in subclause 13.2; and
C) if:
i) protection of media control messages is negotiated in originating call and
the PCK and the PCK-ID were sent to the remote MCPTT client using MONP
signalling according to 3GPP TS 24.379 [2]; or
ii) protection of media control messages is negotiated in terminating call and
the PCK and the PCK-ID were received from the remote MCPTT client using MONP
signalling according to 3GPP TS 24.379 [2];
then:
i) shall encrypt sent sent media control messages according to IETF RFC 3711
[16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated
using the PCK and PCK-ID as specified in subclause 13.2; and
ii) shall decrypt received received media control messages according to IETF
RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI
generated using the PCK and PCK-ID as specified in subclause 13.2;
6\. if protection of pre-established session control messages is negotiated
and the CSK and the CSK-ID were sent to the participating MCPTT function using
SIP signalling according to 3GPP TS 24.379 [2]:
A) shall encrypt sent pre-established session call control messages according
to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-
MKI generated using the CSK and CSK-ID as specified in subclause 13.2; and
B) shall decrypt received pre-established session call control messages
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the CSK and CSK-ID as specified in subclause
13.2; and
6\. if the MSCCK and the MSCCK-ID associated with the MBMS bearer were
received from the participating MCPTT function using SIP signalling according
to 3GPP TS 24.379 [2]:
A) shall decrypt MBMS subchannel control messages specified in subclause 8.4
received over the general purpose MBMS subchannel of the MBMS bearer according
to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS and SRTP-
MKI generated using the MSCCK and MSCCK-ID associated with the MBMS bearer as
specified in subclause 13.2.
### 13.3.4 The controlling MCPTT function
The controlling MCPTT function:
1\. if protection of media is negotiated, shall be transparent to RTP media
streams and shall forward encrypted RTP media streams without decrypting the
payload;
2\. in an on-network group call of an MCPTT group which is not a constituent
MCPTT group of a temporary MCPTT group:
A) if protection of floor control messages between the controlling MCPTT
function and the participating MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the controlling MCPTT function:
i) shall encrypt floor control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
ii) shall decrypt floor control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
B) if protection of media control messages between the controlling MCPTT
function and the participating MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the controlling MCPTT function:
i) shall encrypt media control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
ii) shall decrypt media control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2;
3\. in an on-network group call of an MCPTT group which is a constituent MCPTT
group of a temporary MCPTT group:
A) if protection of floor control messages between the controlling MCPTT
function and the non-controlling MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the controlling MCPTT function:
i) shall encrypt floor control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
ii) shall decrypt floor control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in subclause 13.2; and
B) if protection of media control messages between the controlling MCPTT
function and the non-controlling MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the controlling MCPTT function:
i) shall encrypt media control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
ii) shall decrypt media control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in subclause 13.2; and
4\. in an on-network private call:
A) if protection of floor control messages between the controlling MCPTT
function and the participating MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the controlling MCPTT function:
i) shall encrypt floor control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
ii) shall decrypt floor control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
B) if protection of media control messages between the controlling MCPTT
function and the participating MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the controlling MCPTT function:
i) shall encrypt media control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2;
ii) shall decrypt media control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2.
### 13.3.5 The non-controlling MCPTT function
The non-controlling MCPTT function:
1\. if protection of media is negotiated, shall be transparent to RTP media
streams and shall forward encrypted RTP media streams without decrypting the
payload;
2\. if protection of floor control messages between the non-controlling MCPTT
function and the participating MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the non-controlling MCPTT function:
A) shall encrypt floor control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
B) shall decrypt floor control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2;
3\. if protection of floor control messages between the non-controlling MCPTT
function and the controlling CPTT function is negotiated and the SPK and the
SPK-ID are configured in the non-controlling MCPTT function:
A) shall encrypt floor control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in subclause
13.2; and
B) shall decrypt floor control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2;
4) if protection of media control messages between the non-controlling MCPTT
function and the participating MCPTT function is negotiated and the SPK and
the SPK-ID are configured in the non-controlling MCPTT function:
A) shall encrypt media control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
B) shall decrypt media control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2; and
5) if protection of media control messages between the non-controlling MCPTT
function and the controlling MCPTT function is negotiated and the SPK and the
SPK-ID are configured in the non-controlling MCPTT function:
A) shall encrypt media control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in subclause
13.2; and
B) shall decrypt media control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
subclause 13.2.
# 14 SDP offer/ answer procedures
## 14.1 General
The capabilities described in subclause 4.3 are negotiated in the signalling
and application plane using SDP offer / answer in SIP requests or SIP
responses as specified in 3GPP TS 24.379 [2].
NOTE: If the group is configured for audio cut-in floor control the
\"mc_quueing\" and the \"mc_priority\" attributes are ignored as specified in
3GPP TS 24.379 [2].
This clause describes the details of the SDP offer / answer procedures with
regards to the MCPTT fmtp attribute in the \"m=application\" m-line.
## 14.2 Generating an SDP offer
### 14.2.1 General
When the offerer generates an SDP offer, in order to negotiate the
establishment of a media plane control channel, the offerer shall include a
media description (\"m=\" line) associated with the media plane control
channel. In addition, the offerer may associate an SDP fmtp attribute with the
media description.
NOTE: \"Initial offer\" refers to the offer when the media plane control
channel is initially negotiated. It might, or might not, be the initial offer
within the session.
### 14.2.2 \"mc_queueing\" fmtp attribute
The MCPTT client shall include the \"mc_queueing\" fmtp attribute in SDP
offers when queueing of floor request is supported.
The controlling MCPTT function shall include the \"mc_queueing\" fmtp
attribute in SDP offers when queueing of floor request is supported.
The non-controlling MCPTT function shall include the \"mc_queueing\" fmtp
attribute in SDP offers if the controlling MCPTT included the \"mc_queueing\"
fmtp attribute in the SDP offer.
### 14.2.3 \"mc_priority\" fmtp attribute
The MCPTT client shall include the \"mc_priority\" fmtp attribute when a floor
priority different than the default priority is required. The MCPTT client
should base floor priority on the configured value in 3GPP TS 24.484 [13].
When inviting an MCPTT client or an MCPTT group to a pre-arranged group call,
the controlling MCPTT function and the non-controlling MCPTT function shall
include in the \"mc_priority\" fmtp attribute with the value of the \ element in the \ element specified in 3GPP TS 24.481 [12].
### 14.2.4 \"mc_granted\" fmtp attribute
The MCPTT client shall include the \"mc_granted\" fmtp attribute in the SDP
offer of an initial SIP INVITE request when it is acceptable for the MCPTT
client to receive a granted indication in the SIP 200 (OK) response to an
initial INVITE request.
### 14.2.5 \"mc_implicit_request\" fmtp attribute
The MCPTT client shall include the \"mc_implicit_request\" fmtp attribute when
a SIP request shall be interpreted as an implicit floor request. If not
explicitly stated in procedures in the present document or in procedures in
3GPP TS 24.379 [2] that the \"mc_implicit_request\" fmtp attribute shall be
included, the decision to include the \"mc_implicit_request\" fmtp attribute
or not, is an implementation option.
### 14.2.6 \"mc_no_floor_ctrl\" fmtp attribute
When the MCPTT user wants to make a private call or a first-to-answer call
without floor control using a pre-established session, the MCPTT client shall
include the \"mc_no_floor_ctrl\" fmtp attribute in SDP offer of a SIP request.
The floor control related fmtp attributes shall not be included.
The MCPTT client shall include the \"mc_no_floor_ctrl\" fmtp attribute in SDP
offer of an initial SIP INVITE request for establishing pre-established
session when a floor control shall not be used during the private call or
first-to-answer call session. The floor control related fmtp attributes shall
not be included.
## 14.3 Generating the SDP answer
### 14.3.1 General
When the answerer receives an SDP offer, which contains a media description
for a media plane control channel, the answerer shall include a media
description associated with the media plane control channel in the answer. In
addition, the answerer may associate an SDP fmtp attribute with the media
description. The SDP fmtp attribute shall not include parameters that were not
present in the associated SDP offer.
### 14.3.2 \"mc_queueing\" fmtp attribute
The MCPTT client shall include the \"mc_queueing\" fmtp attribute in SDP
answers when queueing of floor request is supported.
The controlling MCPTT function shall include the \"mc_queueing\" fmtp
attribute in SDP answers when queueing of floor request is supported and the
\"mc_queueing\" fmtp attribute was included in the SDP offer.
The non-controlling MCPTT function shall include the \"mc_queueing\" fmtp
attribute in SDP answers if the controlling MCPTT function included the
\"mc_queueing\" fmtp attribute in the SDP offer.
NOTE: For MCPTT clients connected to the non-controlling MCPTT function, the
determination of if queueing is supported or not is determine case by case
using the Track Info field for each individual floor participant.
### 14.3.3 \"mc_priority\" fmtp attribute
If the \"mc_priority\" fmtp attribute is included in an SDP offer, the
controlling MCPTT function:
1\. if the \ element is present in the \ element
as specified in 3GPP TS 24.481 [12] for the MCPTT user identified by the
\ element, shall not include a \"mc_priority\" fmtp attribute in the
SDP answer;
2\. if the \ element is not present in the \
element as specified in 3GPP TS 24.481 [12] for the MCPTT user identified by
the \ element in the MCPTT group document:
a. shall determine the priority value to include in \"mc_priority\" fmtp
attribute of the SDP answer, by choosing the lowest value from the following
inputs:
i. the value of floor priority in the \"mc_priority\" fmtp attribute included
in the SDP offer;
ii. the value of the \ element in the MCPTT group document as
specified in 3GPP TS 24.481 [12]; and
iii the value of the \ element in the MCPTT
service configuration document as specified in 3GPP TS 24.484 [13]; and
b. shall include the priority value determined above in step 2a, in the
\"mc_priority\" fmtp attribute of the SDP answer.
If the \"mc_priority\" fmtp attribute is included in an SDP offer, the MCPTT
client and the non-controlling MCPTT function shall return the value included
in the SDP offer in the SDP answer.
### 14.3.4 \"mc_granted\" fmtp attribute
If the mc_granted\" fmtp attribute is included in an SDP offer, the
controlling MCPTT function:
1\. if the MCPTT call is not a temporary group session, may use the SIP 200
(OK) response to indicate that the implicit floor request is granted; and
2\. if the MCPTT call is a temporary group session, shall not indicate that
the implicit floor request is granted.
NOTE: A MCPTT group call is a temporary group session when the \ element is present in the \ element as specified in
3GPP TS 24.481 [12].
If the controlling MCPTT function grants the implicit request and decide to
use the SIPP 200 (OK) response to grant the implicit request, the controlling
MCPTT function shall include the \"mc_granted\" fmtp attribute in the SDP
answer.
If the controlling MCPTT function decides not to grant the implicit request,
the controlling MCPTT function shall not include the \"mc_granted\" fmtp
attribute in the SDP answer.
### 14.3.5 \"mc_implicit_request\" fmtp attribute
If the \"mc_implicit_request\" fmtp attribute is included in an SDP offer, the
MCPTT server shall accept the initial INVITE request to be an implicit request
for floor unless the MCPTT client is joining a chat group call or an ongoing
pre-arranged call and include the \"mc_implicit_request\" fmtp attribute in
responses to the SIP request.
### 14.3.6 \"mc_ssrc\" fmtp attribute
If the \"ssrc\" media attribute is included in an SDP offer and the SIP
request shall be interpreted as an implicit floor request
(\"mc_implicit_request\" fmtp attribute is included), the MCPTT server shall
return the value included in the SDP offer or a new ssrc value if a collision
is detected or if the associated SDP offer does not indicate the ssrc value
then the server can determine an appropriate value in the SDP answer of
\"mc_ssrc\" fmtp attribute irrespective of whether \"mc_granted\" fmtp
attribute is present or not in the application m-line.
### 14.3.4 \"mc_no_floor_ctrl\" fmtp attribute
If the \"mc_no_floor_ctrl\" fmtp attribute is included in an SDP offer, the
MCPTT server shall accept the initial SIP INVITE request for establishing pre-
established session without the floor control support during the private call
or first-to-answer call session and include the \"mc_implicit_request\" fmtp
attribute in responses to the initial SIP INVITE request. Shall discard if any
floor control related fmtp attributes are included.
## 14.4 Offerer processing of the SDP answer
When the offerer receives an SDP answer, if an SDP fmtp attribute is
associated with the media description associated with the media plane control
channel, and if the attribute contains attribute parameters that were not
present in the associated offer, the offerer shall discard those attribute
parameters.
## 14.5 Modifying the media plane control channel
When an offerer generates a subsequent SDP offer, the offerer follows the
rules for generating an initial offer, as described in subclause 14.2, with
the exception that the offerer shall not include the \'mc_granted\' SDP fmtp
attribute parameter in a subsequent offer. No semantics has been defined for
the \'mc_granted\' attribute parameter in a subsequent offer.
For the \'mc_implicit_request\' semantic is only defined for a subsequent SDP
offer when upgrading from normal to an emergency call using an SIP re-INVITE
request as specified in 3GPP TS 24.379 [2].
## 14.6 The use of SDP offer / answer procedures in off-network mode
## 14.6.1 General
The MCPTT client can negotiate the capabilities used in a private call using
PRIVATE CALL SETUP REQUEST message and PRIVATE CALL ACCEPT message as
specified in 3GPP TS 24.379 [2]. The PRIVATE CALL SETUP REQUEST message
contains the SDP offer and the PRIVATE CALL ACCEPT message contains the SDP
answer.
When initiating a group call or a broadcast group call using the GROUP CALL
ANNOUNCEMENT message or GROUP CALL BROADCAST message as specified in 3GPP TS
24.379 [2] the capabilities to be used during the call cannot be negotiated.
## 14.6.2 fmtp attribute \"mc_queueing\"
When initiating a private call and if the MCPTT client supports queueing of
floor requests, the MCPTT client shall include the fmtp attribute
\"mc_queueing\" in the SDP offer.
When an MCPTT client accepting the invitation to the private call receives an
SDP offer containing the fmtp attribute \"mc_queueing\" and if the MCPTT
client supports queueing of floor requests, the MCPTT client shall include the
fmtp attribute \"mc_queueing\" in the SDP answer.
When initiating a group call and if queueing of floor requests is supported,
the MCPTT client shall include the fmtp attribute \"mc_queueing\" in the SDP
offer.
NOTE: Participants in a group call where queueing is used acknowledge the
support of queueing in the Floor Indicator field in the Floor Request message.
###### ## Annex A (informative): Signalling flows
# A.1 Scope of signalling flows
This annex gives examples of signalling flows for media plane such as:
1\. On-network floor control signalling flows;
2\. Off-network floor control signalling flows;
2\. Pre-established session control signalling; and
3\. MBMS subchannel control signalling flows.
These signalling flows provide detailed signalling flows, which expand on the
overview information flows provided in 3GPP TS 23.379 [5].
# A.2 Introduction
## A.2.1 General
The signalling flows provided in this annex follow the methodology developed
in this specification.
## A.2.2 Key required to interpret signalling flows
In order to differentiate between messages for floor control, pre-established
call session control, MBMS subchannel control messages, SIP messages and RTP
media packets, the notation in figure A.2.2-1 is used.
Figure A.2.2-1: Signalling flow notation
# A.3 On-network floor control signalling flows
## A.3.1 General
The following subclauses contain the following on-network example flows:
1\. Floor request when the floor is idle in subclause A.3.2;
2\. Floor request when floor is taken and queueing is not applied in subclause
A.3.3;
3\. Floor request when floor is taken and queueing is applied in subclause
A.3.4; and
4\. Pre-emptive floor request when floor is taken in subclause A.3.5.
## A.3.2 Floor request when the floor is idle
Figure A.3.2-1 illustrates a case a user request floor and is granted the
floor during an ongoing MCPTT call.
Figure A.3.2-1: Floor request when the floor is idle
The user at MCPTT client A wants to talk and presses the push-to-talk button.
The steps of the flow are as follows:
1\. The floor participant in the MCPTT client A sends a Floor Request message
to the floor control server.
2\. When the floor control interface towards the MCPTT client A receives the
Floor Request message in the \'U: not permitted and Idle\' state the Floor
Request message is forwarded to the floor control arbitration logic.
3\. When the floor control arbitration logic receives the Floor Request
message in the \'G: Idle\' state, the floor request is authorized. If the
floor request is authorized, the floor control arbitration logic sends the
Floor Grant message to the floor control interface towards the MCPTT client A
and changes the state to \'G: Floor Taken\'.
4\. The floor control interface towards the MCPTT client A forwards the Floor
Grant message to the floor participant in the associated MCPTT client and
changes the state to \'U: permitted\'.
5\. The floor control arbitration logic sends a Floor Taken message to all
other participants in the MCPTT call via the other floor control interfaces
towards the MCPTT clients.
When the Floor Taken message is received by the other floor control interfaces
towards the MCPTT clients the Floor Taken message is forwarded to the floor
participant in the associated MCPTT client and the state is changed to the
\'U: not permitted and Taken\' state.
6\. On receipt of the Floor Grant message the floor participant in the
associated MCPTT client provides a grant notification to the MCPTT user,
changes the state to \'U: has permission\' and the MCPTT client A starts to
forward RTP media packets towards the MCPTT server.
7\. The media distributor distributes the RTP media packets to all other MCPTT
clients in the MCPTT call.
8\. When the user at MCPTT client A stops talking and releases the push-to-
talk button the floor participant in the MCPTT client A sends a Floor Release
message to the floor control server and enter the \'U: pending Release\'
state.
9\. When the floor control interface towards the MCPTT client A receives the
Floor Release message the Floor Release message is forwarded to the floor
control arbitration logic. The floor control interface towards the MCPTT
client A allows the last RTP media packets to be forwarded to the media
distributor in the MCPTT server.
10\. When the last RTP media packet is forwarded to the media distributor in
the MCPTT server the floor control interface towards the MCPTT client A sends
the Floor Idle message to the floor participant in associated MCPTT client A
and changes the state to \'U: not permitted and Floor Idle\'.
11\. When the floor control arbitration logic receives the Floor Release
message the last RTP media packets are allowed to be forwarded.
12\. When the last RTP media packets are distributed by the media distributor
the floor control arbitration logic sends a Floor Idle message to all
participants in the MCPTT call with the exception of the MCPTT client that was
permitted to send media and changes state to \'G: Floor Idle\'. The Floor Idle
message is forwarded by the other floor control interface towards MCPTT
clients. The state in the other floor control interface towards MCPTT clients
is changed to \'U: not permitted and Floor Idle\'.
## A.3.3 Floor request when floor is taken and queueing is not applied
Figure A.3.3-1 illustrates a case when a user request floor when the floor is
taken and queueing is not applied in the MCPTT call.
Figure A.3.3-1: Floor request when floor is taken when queueing is not applied
One of the users in the MCPTT call wants to speak and presses the push-to-talk
when the floor is already taken by the MCPTT client A.
1\. The floor participant in one of the other MCPTT clients sends the Floor
Request message towards the floor control server. The Floor participant enters
the \'U: pending Floor Request\' state.
2\. When one of the other floor control interface towards MCPTT clients
receives a Floor Request message in the \'U: not permitted and Taken\' state
and if:
\- the floor request does not include higher priority than the current user
permitted to talk requested; and
\- when queueing of floor requests are not negotiated;
then the other floor control interface towards MCPTT clients send a Floor Deny
message towards the floor participant in the associated MCPTT client.
When the floor participant in the associated MCPTT client receives the Floor
Deny message, the floor participant provides a deny notification to the user.
The Floor participant enters the \'U: has no permission\' state.
## A.3.4 Floor request when floor is taken and queueing is applied
Figure A.3.4-1 illustrates a case when a user request floor when the floor is
taken and queueing is applied in the MCPTT call.
Figure A.3.4-1: Floor request when floor is taken and queueing applied
The users at MCPTT client B wants to speak and presses the push-to-talk when
the floor is already taken by the MCPTT client A.
The steps of the flow is as follows:
1\. The floor participant in the MCPTT client B sends the Floor Request
message towards the floor control server.
2\. When the floor control interface towards the MCPTT client B receives a
Floor Request message in the \'U: not permitted and Taken\' state and if:
a. the floor request does not include higher priority than the user already
permitted to talk requested; and
b. when queueing of floor requests are negotiated as specified in clause 14;
then the floor control interface towards the MCPTT client B queues the Floor
Request message and sends a Floor Queue Position Info message towards the
floor participant in the MCPTT client B.
When the floor participant in MCPTT client B receives the Floor Queue Position
Info message the floor participant provides a queueing indications to the user
and enter the \'U: queued\' state.
3\. When the user at MCPTT client A stops talking and releases the push-to-
talk button the floor participant in the MCPTT client A sends a Floor Release
message to the floor control server and enter the \'U: pending Release\'
state.
4\. When the floor control interface towards the MCPTT client A receives the
Floor Release message the Floor Release message is forwarded to the floor
control arbitration logic.
5\. When the floor control arbitration logic receives the Floor Release
message the last RTP media packets are allowed to be forwarded. When the last
RTP media packets are distributed the floor control arbitration logic checks
the floor request queue. In this example there is one floor request in the
queue and a Floor Grant message is sent towards the floor participant in the
MCPTT client B.
6\. The floor control interface towards MCPTT client B interface forwards the
message to the floor participant in MCPTT client B and changes the state to
\'U: permitted\'.
7\. The floor control arbitration logic sends a Floor Taken message to all
other participants in the MCPTT call via the other floor control interfaces
towards MCPTT clients.
When the Floor Taken message is received by the other floor control interface
towards MCPTT clients Floor Taken message is forwarded to the floor
participants in the associated MCPTT client. The floor participant in the
MCPTT client A changes the state to the \'U: not permitted and Taken\' state.
8\. On receipt of the Floor Grant message the floor participant in MCPTT
client B provides a grant notification to the MCPTT user, changes the state to
\'U: has permission\' and the MCPTT client A starts to forward RTP media
packets towards the MCPTT server.
9\. The media distributor distributes the RTP media packets to all other MCPTT
clients in the MCPTT call.
## A.3.5 Pre-emptive floor request when floor is taken
Figure A.3.5-1 shows the message flow when a user with pre-emptive priority
request floor when the floor is already taken by another user.
Figure A.3.5-1: Pre-emptive floor request when floor is taken
The user at MCPTT client B wants to interrupt the user at the MCPTT client
presses the push-to-talk indicating a pre-emptive priority.
The steps of the flow are as follows:
1\. The floor participant in the MCPTT client B sends the Floor Request
message towards the floor control server. The message includes a pre-emptive
priority.
2\. When the floor control interface towards MCPTT client interface in the
MCPTT server receives a Floor Request message in the \'U: not permitted and
Taken\' state and since the Floor Request message includes a higher pre-
emptive priority than the user that is already permitted to send media the
floor control interface towards the MCPTT client sends the Floor Request
message to the floor control server arbitration logic.
3\. When the floor control server arbitration logic receives the Floor Request
message with the high pre-emptive priority, the floor control server
arbitration logic revokes the current talker\'s permission to talk by sending
a Floor Revoke message to the floor control interface towards the MCPTT client
A.
4\. The floor control interface towards MCPTT client A forwards the Floor
Revoke message to the floor participant in MCPTT A.
5\. When the floor participant in the MCPTT client A receives the Floor Revoke
message, the floor participant provides a floor revoke indication to the MCPTT
user, sends a Floor Release message and changes the state to \'U: pending
Release\'.
6\. When the floor control interface towards the MCPTT client A receives the
Floor Release message, the Floor Release message is forwarded to the floor
control server arbitration logic.
7\. When the floor control arbitration logic receives the Floor Release
message the last RTP media packets are allowed to be received. When the last
RTP media packets are distributed the floor control arbitration logic sends a
Floor Grant message towards the floor control interface towards the MCPTT
client B.
8\. The floor control interface towards MCPTT client receives the Floor Grant
message the Floor Grant message is sent to the floor participant in MCPTT
client B and changes the state to \'U: permitted\'.
9\. The floor control arbitration logic sends a Floor Taken message to all
other participants in the MCPTT call via the other floor control interfaces
towards the MCPTT clients.
When the Floor Taken message is received by the other floor control interfaces
to MCPTT clients the Floor Taken message is forwarded to the floor participant
in the associated MCPTT client. The floor participant in the MCPTT client A
changes the state to the \'U: not permitted and Taken\' state.
10\. On receipt of the Floor Grant message the floor participant in MCPTT
client B provides a grant notification to the MCPTT user, changes the state to
\'U: has permission\' and the MCPTT client A starts to forward RTP media
packets towards the MCPTT server.
11\. The media distributor in the MCPTT server distributes the RTP media
packets to all other MCPTT clients in the MCPTT call.
# A.4 Off-network floor control signalling flows
## A.4.1 General
This subclause provides the following message flow examples:
1\. floor request when the floor is idle is shown in subclause A.4.2.1;
2\. floor request when floor is taken and queueing of floor requests is not
applied is shown in subclause A.4.2.2;
3\. floor request when floor is taken and queueing of floor requests is
applied is shown in subclause A.4.2.3; and
4\. pre-emptive floor request when floor is taken is shown in subclause
A.4.2.4.
## A.4.2 Off-network floor control during an MCPTT group call
### A.4.2.1 Floor request when the floor is idle
Figure A.4.2.1-1 illustrates a user's floor request when the floor is idle
i.e. there is no floor arbitrator.
Figure A.4.2.1-1: Floor request when the floor is idle
The user at MCPTT client A wants to talk and presses the push-to-talk button.
The steps of the flow are as follows:
1\. The floor participant in the MCPTT client A sends a Floor Request message
towards other MCPTT clients and starts timer T201 (Floor Request). MCPTT
client A moves to 'O: pending request' state.
2\. On expiry of T201 (Floor Request) MCPTT client A re-sends the Floor
Request message and restarts timer T201 (Floor Request). This step has to be
repeated for a pre-configured number of times (3 times in the example figure)
before assuming that the floor is idle.
3\. On the expiry of the last iteration of timer T201 (Floor Request), MCPTT
client A sends a Floor Taken message towards other MCPTT client and assumes
the role of floor arbitrator. MCPTT client A moves to 'O: has permission
state'.
4\. On receiving Floor Taken message, all other MCPTT clients move to 'O: has
no permission state'.
### A.4.2.2 Floor request when floor is taken and queueing of floor requests
is not applied
Figure A.4.2.2-1 illustrates a user\'s floor request when the floor is taken
and queueing is not applied in the MCPTT call.
Figure A.4.2.2-1: Floor request when floor is taken when queueing is not
applied
One of the users in the MCPTT call wants to speak and presses the push-to-talk
when the floor is already taken by the MCPTT client B and queueing is not
applied.
1\. The floor participant in MCPTT client A sends the Floor Request message
towards other MCPTT clients. The Floor participant enters the \'O: pending
request\' state.
2\. On receiving Floor Request message, MCPTT client B sends a Floor Deny
message with MCPTT client A's ID towards all MCPTT clients.
3\. On receiving Floor Deny message, MCPTT client A moves back to 'O: has no
permission' state.
### A.4.2.3 Floor request when floor is taken and queueing is applied
Figure A.4.2.3-1 illustrates a user's floor request when the floor is taken
and queueing is applied in the MCPTT call.
Figure A.4.2.3-1: Floor request when floor is taken and queueing applied
The users at MCPTT client A wants to speak and presses the PTT button when the
floor is already taken by the MCPTT client B.
The steps of the flow are as follows:
1\. The floor participant in the MCPTT client A sends the Floor Request
message towards other MCPTT clients. MCPTT client A moves to 'O: pending
request' state and starts timer T201 (Floor Request).
2\. On expiry of timer T201 (Floor Request) MCPTT client A re-sends the Floor
Request message and restarts timer T201 (Floor Request). This step has to be
repeated for a pre-configured number of times before assuming that the floor
is idle.
3\. Receiving RTP media indicates that the floor is taken and a floor
arbitrator is present. Sending multiple requests till a reply to the request
is received helps reduce conflicts. Therefore, the counter associated to T201
(Floor Request) is reset every time RTP media is received.
4\. On receiving Floor Queue Position Info message from the floor arbitrator,
MCPTT client A stops timer T201 (Floor Request) and moves to 'O: queued'
state. Any RTP media received in this state is rendered.
5\. When the user at MCPTT client B indicates to terminate RTP media
transmission, MCPTT client B sends Floor Granted message to the next (MCPTT
client A) in queue. MCPTT client B start timer T205 (Floor Granted request)
and moves to 'O: pending grant' state.
6\. On receiving Floor Granted message, MCPTT client A starts timer T233
(pending user action) and waits for user to indicate start of RTP media
transmission.
7\. On expiry of timer T205 (Floor Granted) MCPTT client B re-sends the Floor
Granted message and restarts timer T205 (Floor Granted). This step has to be
repeated for a pre-configured number of times while no media is received from
MCPTT client A.
8\. Upon expiry of timer T205 (Floor Granted) for a preconfigured number of
times, MCPTT client B starts timer T233 (pending user action), waiting for RTP
media from MCPTT client A.
9\. MCPTT client A stops timer T233 (pending user action) upon user action.
MCPTT client A moves to 'O: has permission' state and starts transmission of
RTP media as floor arbitrator.
10\. On receiving RTP media from MCPTT client A, MCPTT client B stops timer
T233 (pending user action) and moves to 'O: has no permission' state.
### A.4.2.4 Pre-emptive floor request when floor is taken
Figure A.4.2.4-1 shows the message flow when a user requests floor with a pre-
emptive priority when the floor is already taken.
Figure A.4.2.4-1: Pre-emptive Floor request
The user at MCPTT client A, with higher priority than the current floor
arbitrator, wants to speak and presses the push-to-talk when the floor is
taken by the MCPTT client B.
The steps of the flow are as follows:
1\. The floor participant in the MCPTT client A sends the pre-emptive Floor
Request message towards other MCPTT clients and starts timer T201 (Floor
Request). MCPTT client A moves to 'O: pending request' state.
2\. Upon receiving a higher priority floor request, MCPTT client B sends Floor
Granted message and start timer T205 (Floor Granted request) . Any RTP media
transmission is stopped and MCPTT client B moves to 'O: pending grant' state.
User at MCPTT client B can be notified of the pre-emption and any RTP media
transmission is stooped.
3\. On expiry of timer T205 (Floor Granted) the MCPTT client B re-sends the
Floor Granted message and restarts timer T205 (Floor Granted). This step has
to be repeated for a pre-configured number of times, if no RTP media from
MCPTT client A.
4\. MCPTT client A moves to 'O: has permission' state and assumes the role of
floor arbitrator upon receiving Floor Granted message.
5\. On receiving RTP media from MCPTT client A, MCPTT client B stops timer
T205 (Floor Granted) and moves to 'O: has no permission' state.
# A.5 Pre-established session signalling flows
## A.5.1 General
In the following subclauses signalling flows are presented for sample
procedures related to the call setup and the call release when pre-established
session is used.
The behaviour of an originating and terminating client is specified in
subclause 9.2. The behaviour of the participating MCPTT function is specified
in subclause 9.3
The behaviour of the controlling MCPTT function is specified in 3GPP TS 24.379
[2]
Only the names of the messages are indicated on the signal flow arrows. The
information elements of each message can be found in subclause 9.2 and
subclause 9.3 for media plane control messages and in 3GPP TS 24.379 [2] for
SIP messages.
The signalling flow diagrams also indicate the state of the MCPTT client and
the participating MCPTT function in the state machines specified in subclause
9.2 and subclause 9.3 respectively.
When the call initialization is accepted additional floor control dialogue is
also indicated in the signalling flow.
The following signalling flows are provided:
1\. call initialization at the originating side when the initialization is
accepted (subclause A.5.2.1);
2\. call initialization at the originating side when the initialization is
rejected (subclause A.5.2.2);
3\. call initialization at the termination side when call is accepted
(subclause A.5.2.3); and
4\. call release (subclause A.5.3).
## A.5.2 Call Initialization
### A.5.2.1 Originating Side when initialization accepted
Figure A.5.2.1-1 illustrates the flow of MBCP messages when the call
initiation request sent by an originating MCPTT client is accepted by the
controlling MCPTT function. In this diagram it is assumed that the call
initiation request includes implicit floor request.
Figure A.5.2.1-1: Call initialization accepted; originating side
One of the users with a pre-established session initiates a call and the call
is accepted by the controlling MCPTT function. Steps 1 to 5 are conducted
using SIP messages (see 3GPP TS 24.379 [2]).
1\. A pre-established session is created between the origination MCPTT user
and the participating MCPTT server. The MCPTT client is in \'U: Pre-
established session not in use\" state and the participating MCPTT function is
in \'G: Pre-established session not in use\' state.
2\. The origination MCPTT client initiates a call as described in 3GPP TS 24
379 [2] by sending a SIP REFER message. The participating MCPTT function
enters into \'G: Pre-established session in use\' state.
3\. The participating MCPTT function sends SIP 200 (OK) to the originating
MCPTT client and then the originating MCPTT client enters into \'U:Pre-
established session in use\' state.
4-5.The participating MCPTT function sends a SIP INVITE message to the
controlling MCPTT function and receives the SIP 200 (OK) response from the
controlling MCPTT function.
6\. The participating MCPTT server sends a \'Connect\' message to the
Originating MCPTT client.
7\. The originating MCPTT client responds with an Acknowledge (accepted)
message.
8\. The controlling MCPTT server grants the floor to the originating MCPTT
client by sending a Floor Granted message
9\. The participating MCPTT server forwards the Floor Granted message to the
originating MCPTT client
10\. The originating MCPTT clients starts sending the media packets.
11\. The participating MCPTT server forwards the media packets to the
controlling MCPTT server.
### A.5.2.2 Originating Side when initialization rejected
Figure A.5.2.2-1 illustrates the flow of MBCP messages when the call
initiation request by an originating MCPTT client is rejected.
Figure A.5.2.2-1: Call initialization rejected
One of the users with a pre-established session initiates a call and the call
is rejected by the controlling MCPTT function. Steps 1- 5 are conducted using
SIP messages (see 3GPP TS 24.379 [2]).
1\. A pre-established session is created between the origination MCPTT client
and the participating MCPTT server. The MCPTT client is in \'U:Pre-established
session not in use\" state and the participating MCPTT function is in \'G:
Pre-established session not in use\' state.
2\. The origination MCPTT client initiates a call as described in 3GPP TS
24.379 [2] by sending a SIP REFER message.The participating MCPTT function
enters into \'G:Pre-established session in use\' state.
3\. The participating MCPTT function sends SIP 200 (OK) to the originating
MCPTT client and then the originating MCPTT client enters into \'U:Pre-
established session in use\' state.
4-5.The participating MCPTT function sends a SIP INVITE message to the
controlling MCPTT function and receives SIP 4xx response from the controlling
MCPTT function. The participating MCPTT function enters into \'G: Call
Releasing\' state.
6\. The participating MCPTT server sends a Disconnect message to the
originating MCPTT client. The originating MCPTT client enters into \'U: Pre-
established session not in use\' state.
7\. The originating MCPTT client responds with an Acknowledge message. After
receiving the Acknowledge message the participating MCPTT function enters into
\'G:Pre-established session not in use\' state.
### A.5.2.3 Termination Side when call initialization accepted
Figure A.5.2.3-1 illustrates the flow of MBCP messages when the call
initiation is informed to the terminating MCPTT client. In this figure it is
assumed that the call initiation request includes implicit floor request.
Although the figure shows only one terminating MCPTT client, the messaging
takes place with each one of the terminating MCPTT clients with a pre-
established session.
Figure A.5.2.3-1: Call initialization accepted; terminating side
When a call initiation is accepted by the controlling MCPTT function, the
terminating MCPTT client(s) with pre-established session is (are) informed.
Steps 1 to 3 are conducted using SIP messages (see 3GPP TS 24.379 [2]).
1\. A pre-established session is created between the terminating MCPTT user
and the participating MCPTT server. The MCPTT client is in \'U: Pre-
established session not in use\" state and the participating MCPTT function is
in \'G: Pre-established session not in use\' state.
2\. The controlling MCPTT server informs the participating MCPTT server the
call initiation by sending an SIP INVITE message. The participating MCPTT
function enters into \'G: pre-established session in use\' state.
3\. The participating MCPTT function sends SIP 200 (OK) to the controlling
MCPTT function.
4\. The participating MCPTT function sends a Connect message to the
terminating MCPTT client.
5\. The terminating MCPTT client responds with an Acknowledge message. The
terminating MCPTT client enters into \'U:Pre-established session in use\'
state.
6\. The controlling MCPTT server informs that the floor is granted to another
MCPTT client by sending a Floor Taken message
7\. The participating MCPTT server forwards the Floor Taken message to the
originating MCPTT client
8\. The controlling MCPTT server starts distributing the media packets sent by
the talking MCPTT client.
9\. The participating MCPTT server forwards the media packets to the
terminating MCPTT client.
## A.5.3 Call release
Figure A.5.3-1 illustrates the flow of MBCP messages when the call is released
but the pre-established session used by this call is preserved.
Figure A.5.3-1: Call release for a call with pre-established session
A call with a pre-established session is released by preserving the pre-
established session used by this call. Steps 2 and 3 are conducted using SIP
messages (see 3GPP TS 24.379 [2]).
1\. A call using a pre-established session is being conducted. The MCPTT
client is in \'U:Pre-established session in use\' state and the participating
MCPTT function is in \'G: Pre-established session in use\' state.
2\. The call release decision is taken by the controlling MCPTT function and
informed to the participating MCPTT function as described in 3GPP TS 24.379
[2] by sending a SIP BYE message.
3\. The participating MCPTT function sends an SIP ACK message to the
controlling MCPTT function and enters into \'G: Call Releasing\' state.
4\. The participating MCPTT server sends a Disconnect message to the MCPTT
client of this pre-established session.
5\. The MCPTT client sends an Acknowledge message to the participating MCPTT
server. The MCPTT client enters to \'U: Pre-established session not in use\'
state and the participating MCPTT function is in \'G: Pre-established session
not in use\' state.
6\. The pre-established session between the MCPTT client and the participating
MCPTT server is preserved.
# A.6 MBMS subchannel control signalling flows
## A.6.1 General
The following subclauses describe examples of how an MBMS bearer is managed
during group call.
The following signalling flows are provided:
\- announcing MBMS subchannels (subclause A.6.2);
\- initiating a conversation and requesting floor, originating side (subclause
A.6.3); and
\- releasing floor and ending a conversation (subclause A.6.4).
## A.6.2 Announcing MBMS subchannels
This subclause contains an example message flow illustrating how the
participating MCPTT function announces MBMS subchannels.
The pre-requisites to the flow are:
1\. The MCPTT client participates in an ongoing group session. The group
session can be either a chat group session or a pre-arranged group session.
2\. There is no conversation ongoing, i.e. the floor is idle.
3\. The group session has a small number of participants that depending on the
availability of MBMS subchannels can use a MBMS subchannel or the unicast
bearer when in an MBMS service area.
Figure A.6.2-1 shows the message flow.
Figure A.6.2-1: Announcing MBMS subchannels
The steps of the message flow are as follows:
1\. A group session is ongoing. This can be a chat group or a pre-arranged
group. The MCPTT session identity for this group is 12345\@controller1.mcptt-
op.net.
2\. The participating MCPTT function pre-activates MBMS bearers. The trigger
for doing this is implementation dependent but can be a result of received
location reports from MCPTT clients served by the participating MCPTT
function.
3-5. The participating MCPTT functions sends a SIP MESSAGE request to a
selected number of MCPTT clients. This can happen exactly after a pre-
activated MBMS bearer is created or when an MCPTT client registers or an MCPTT
user affiliates to a group. The SIP MESSAGE request contains:
a. the \"application/vnd.3gpp.mcptt-mbms-usage-info\" MIME body with:
i. a reference to media line in the \"application/sdp\" MIME body where the
general purpose MBMS subchannels are defined in the \ element; and
ii. one or more \ elements where each announcement contains:
A. TMGI in the \ element identifying the announcement;
B. QCI in the \ element;
C. if multiple carrier are supported, frequency in the \ element;
D. a list of MBMS service areas in the \ element;
b. an \"application/sdp\" MIME body with:
i. one \"a=audio ...\" media line containing the relevant media-line
attributes. Where:
A. the IP address is set the unspecified address (0.0.0.0), if IPv4, or to a
domain name within the \".invalid\" DNS top-level domain; and
B the port number is set to \"9\".
i. one \"a=application ...\" media line to be used as the general purpose MBMS
subchannel; and
ii. optionally, one or more \"a=application ...\" media lines to be used as
the MBMS subchannel for floor control.
6-8. The MCPTT client acknowledges the SIP MESSAGE request by means of the SIP
200 (OK) response.
9\. The MCPTT client moves into an MBMS service area where the announced MBMS
bearer is available.
10-12. The MCPTT client sends a SIP MESSAGE request containing the
\"application/vnd.3gpp.mcptt-mbms-usage-info\" MIME body containing:
a. the \ element set to the value \"listening\"; and
b. the \ set to \"true\".
13-15. The participating MCPTT function acknowledges the SIP MESSAGE request
by means of the SIP 200 (OK) response.
16\. The participating MCPTT server receives a Floor Request message from one
of the served MCPTT clients or a Floor Taken message from the controlling
MCPTT function indicating that a conversation is started in the group session.
17\. The participating MCPTT function decides to use one of the MBMS
subchannels in the pre-activated MBMS bearer for the conversation in the group
session.
18\. The participating MCPTT function sends the Map Group to Bearer messages
over the general purpose MBMS subchannel, the Map Group To Bearer message
contains:
a. the TMGI in the TMGI field;
b. the MCPTT Group Identity field in the MCPTT Group ID field;
c. the MBMS Subchannel field containing:
i. the TMGI,
ii. a reference to which media line to be used for audio; and
ii. optionally, a reference to the media line specifying the \"m=application
...\". If this reference is absent, floor control messages are sent over the
MBMS subchannel used for audio.
19-21. The MCPTT client sends a SIP MESSAGE request containing the
\"application/vnd.3gpp.mcptt-mbms-usage-info\" MIME body containing:
a. the \ element set to the value \"listening\";
b. the \ set to 12345\@controller1.mcptt-op.net; and
c. the TMGI;
22\. The MCPTT client starts listen to the MBMS subchannel(s) indicated in the
Map Group To Bearer message. Note that RTP media packets can now be received
over both the MBMS subchannel and the unicast channel (the same applies for
floor control messages) and the MCPTT client needs to ignore duplicated RTP
media packets and floor control messages.
23-25. The participating MCPTT function acknowledge with a 200 (OK) response
to the SIP MESSAGE request.
26\. When the MCPTT client receives the SIP 200 (OK) response the MCPTT client
stops listen to the unicast bearer.
## A.6.3 Initiating a conversation and requesting floor, originating side
This subclause shows the signalling flow when an MCPTT client starts a
conversation in an ongoing group session using a pre-activated MBMS bearer.
Figure A.6.3-1 shows the signalling flow.
NOTE: The arrows and boxes with dotted lines represent events sent over the
MBMS bearer.
Figure A.6.3-1: Initiating a conversation and requesting floor
The MCPTT clients 1 to 4 participate in a group session. All MCPTT clients are
served by the same participating MCPTT function. The MCPTT clients 1 to 3 are
within an area where an MBMS bearer is available. The MCPTT client 4 is
outside this area and can only use a unicast bearer.
A MBMS subchannel exists and associated with a general purpose media plane
control channel which can be used to deliver MBMS subchannel control messages
of any group in this MBMS service area.
The steps of the flow are as follows:
1\. A group session is ongoing. At the moment none of the group members has
the permission to send media.
2\. The participating MCPTT function activates and announces an MBMS bearer as
described in subclause A.6.2. The pre-activated MBMS bearer is not yet
associated with a particular group with participants served by this
participating MCPTT function.
3\. The user at the MCPTT client 1 presses the PTT button.
4-5. The floor participant 1 sends a Floor Request as specified in subclause
6.2. The Floor Request is forwarded by the participating MCPTT function to the
controlling MCPTT function.
6\. When the participating MCPTT function receives the Floor Request message
the participating MCPTT function determines that the previously activated and
announced MBMS bearer can be used for this conversation and sends the Map
Group to Bearer message over the general purpose MBMS subchannel to inform
about the start of the conversation. The Map Group to Bearer message includes
the TMGI, the MBMS subchannel for audio and floor control and the MCPTT group
identifier in the activated MBMS bearer used for the conversation. The
participating MCPTT function enters the \'M: A conversation is active\' state.
On receipt of the Map Group to Bearer message the MBMS interface in the MCPTT
client 1, 2 and 3 associates the conversation with the TMGI, the MBMS
subchannel for audio and floor control with the MCPTT group identifier in the
Map Group to Bearer message.
7-8. On receipt of the Floor Request message, the floor control server
function grants the floor participant 1 to send media by sending the Floor
Granted message. The participating MCPTT function forwards the message to the
floor participant 1 over the unicast bearer.
9-16. The floor control server sends the Floor Taken message towards all
participants. The participating MCPTT functions sends one Floor Taken message
over the MBMS subchannel associated with this group as declared in step 6 and
discards the remaining Floor Taken messages with the exception of the Floor
Taken messages towards participants not listening to the MBMS bearer, in this
example, the floor participant 4.
NOTE: The participating MCPTT function uses the message-sequence-number field
to determine if a Floor Taken message is already sent over the MBMS floor
control bearer or not.
17\. The floor control continues as described in subclause A.5.2.
18\. When the Floor Granted message is received in the floor participant 1,
the floor participant 1 requests the MCPTT client to start encoding voice and
send RTP media packets. The MCPTT client 1 starts encoding voice from the
MCPTT user and sends RTP media packets over the unicast bearer towards the
participating MCPTT function. The participating MCPTT function forwards the
RTP media packets towards the controlling MCPTT function.
19-24. The controlling MCPTT function distributes the RTP media packets to all
MCPTT clients. The participating MCPTT function sends one media stream over
the MBMS subchannel associated with this group. If an MCPTT client is not
listening to the MBMS bearer, in this example the MCPTT client 4, the
participating MCPTT function forwards the RTP media packets to MCPTT client 1
over the unicast bearer.
As long as the conversation is active and the MBMS subchannel for this group
is available any of the MCPTT users can request floor and the Floor Taken,
Floor Idle and RTP packets are sent over the MBMS bearer.
## A.6.4 Releasing floor and ending a conversation
This subclause describes how the participant 1 releases the floor and how the
participating MCPTT function decides to end the conversation.
Figure A.6.4-1 shows the signalling flow.
NOTE: The arrows and boxes with dotted lines represent events sent over the
MBMS bearer.
Figure A.6.4-1: Releasing floor and ending a conversation
The steps of the flow are:
1\. The MCPTT clients 1 to 4 participate in a group session. All MCPTT clients
are served by the same participating MCPTT function. The MCPTT clients 1 to 3
are within an area where a MBMS subchannel is used for the conversation. The
MCPTT client 4 is outside this area and can only use a unicast bearer. At the
moment the participant at MCPTT client 1 has the floor. The conversation over
the MBMS bearer started as described in subclause A.6.4.
2\. The MCPTT user at the MCPTT client 1 releases the PTT button. The MCPTT
client 1 indicates to the floor participant 1 that the PTT button is released.
3-4. The floor participant 1 sends the Floor Release message over the unicast
bearer. The participating MCPTT function forwards the message to the
controlling MCPTT function.
5-13. The floor control server sends the Floor Idle message to all
participants. The participating MCPTT function sends the first received Floor
Idle message destined to an MCPTT client using the MBMS subchannel mentioned
in step 1. Any other Floor Idle messages destined to an MCPTT client listening
to the MBMS bearer are discarded. Any Floor Idle message destined to an MCPTT
client outside the MBMS bearer coverage, in this case the MCPTT client 4, is
forwarded over the unicast bearer to the floor participant.
14\. The conversation ends. The conversation timer expires and the
participating MCPTT server decides to end the conversation on this MBMS
subchannel.
The conversation timer is a relative long timer and needed to avoid that
inactive group sessions are unnecessarily occupying the MBMS subchannel. The
MBMS subchannel can then be reused by other conversations in other group
sessions.
15\. The participating MCPTT function sends the Unmap Group to Bearer message
over the MBMS subchannel. The MBMS interfaces in the MCPTT clients 1, 2 and 3
removes the association between the TMGI, the MBMS subchannel for audio and
for floor control and the MCPTT group identity.
16\. The participating MCPTT function continues to retransmit the Unmap Group
to Bearer message until all MCPTT clients has moved to unicast. When all MCPTT
client is listening to the unicast bearer, the participating MCPTT function
enter the \'M: No conversation is active\' state.
###### ## Annex B (informative): Media encapsulation for end-to-end
distribution using MBMS bearers
Table B-1 shows specific header field values of the media plane packet from
the originating MCPTT client, starting with the codec payload to the MCPTT
server, from where it is distributed in downlink via IP multicast over MBMS to
the terminating MCPTT clients. Each line represents a logical or physical
\"Entity\" which handles the incoming packet (or generated packet for the
first line) and passes it to the next \"Entity\" via the interface \"Reference
Point\" indicated in this line. Additional entries of the line represent
specific parts of the packet when it is put to the \"Reference Point\" by the
\"Entity\". The rightmost column is the inner part of the packet. The
parameters indicated in a column indicate the value of specific information
elements set by the \"Entity\" in the header encapsulating all the parts to
the right of the column.
All shown IP addresses (as s= for the source address and as d= as the
destination address) can be IPv4 or IPv6 and are considered routable as
necessary and distinct from each other within the same domain if they have
different designations: it is up to the implementations to handle local IP
addresses, perform NAT or use additional tunnelling. UDP ports of different
designations correspond to potentially different port numbers. The UDP port
numbers are designated as capital letter within squared brackets.
The unicast IP address IP~1~ and the sending UDP port [A] of the originator UE
are as specified in the SDP during the most recent setup for the SIP session
which precedes the MBMS distribution of MCPTT traffic. The multicast IP
address IP~5m~ and the associated receiving UDP port [H] used for the
distribution of media packets are provided to the terminating MCPTT clients
via MCPTT signalling.
The SSRC is set to a value that uniquely identifies the originating MCPTT
client during the (S)RTP session, in accordance to IETF RFC 3550 [3] and IETF
RFC 3711 [8].
Table B-1 Media encapsulation for end-to-end distribution using downlink MBMS
bearers
System | Entity | Reference Points | Media encapsulation for transmission (unicast uplink / MBMS downlink) |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---  
| outer IP header | outer UDP port |  |  | inner IP header | inner UDP port | (S)RTP | Payload |  |   
Originating | _Codec_ |  |  |  |  |  |  |  |  | Codec payload  
| _MCPTT client_ (IP1) | Unicast uplink (Uu-> S1-U -> S5 -> SGi) |  |  |  |  | s= IP1 d= IP2 | [A] [B] | SSRC= unique id | (as above)  
| _MCPTT function (participating)_ (IP2) | MCPTT-3 |  |  |  |  | s= IP2 d= IP3 | [C] [D] | (as above) | (as above)  
Controlling | _MCPTT function (controlling)_ (IP3) | MCPTT-3 |  |  |  |  | s= IP3 d= IP4 | [E] [F] | (as above) | (as above)  
Terminating | _MCPTT function (participating)_ (IP4) | MB2-U (NOTE 1) | s= IP4 d= IP6 | [I] [J] |  |  | s= IP4 d= IP5m | [G] [H] | (as above) | (as above)  
| _BM-SC_ (IP6) | SGimb | s= IP6 d= IP8 | [K] [L] |  | SYNC header (NOTE 4) | (as above) | (as above) | (as above) | (as above)  
| _MBMS-GW_ (IP8) | M1 | s= IP8 d=IP7m | [M] [N] | GTP-U (NOTE 5) | (as above) | (as above) | (as above) | (as above) | (as above)  
| _eNB_ (IP7m) (NOTE 2) | Uu downlink (MBMS) |  |  |  |  | (as above) | (as above) | (as above) | (as above)  
| _MCPTT client (_ IP5m) (NOTE 3) |  |  |  |  |  |  |  | (as above) | (as above)  
| _Codec_ |  |  |  |  |  |  |  |  | (as above)  
NOTE 1: IP6 and [J] are provided to the participating MCPTT function by the BM-SC over MB2-C reference point during the MBMS bearer activation procedure. NOTE 2: IP7m is given to eNBs when they are informed that the activated MBMS Bearer will be transmitted by them. Then the eNBs join this IP multicast address. NOTE 3: The terminating MCPTT client starts listening for traffic on IP5m and [H] when the group/media stream is mapped to this multicast IP address and port number respectively, via MCPTT signalling (Map Group To Bearer message). NOTE 4: Specified in 3GPP TS 25.446 [9]. NOTE 5: Specified in 3GPP TS 29.281 [10]. |  |  |  |  |  |  |  |  |  |   
###### ## Annex C (Informative): Floor control state machine transitions
tables
# C.1 Introduction
This annex contains state transitions tables.
# C.2 Off-network tables
## C.2.1 Off-network call floor control state machine transitions
The table is a representation of the off-network call floor control state
machine in terms of:
1) the resulting state, and
2) the actions to be done;
as a function of:
3) the current state, and
4) the trigger causing the transition.
The trigger is either an external event, an input coming externally to the
state machine or an auxiliary internal even like the expiry of a timer or a
counter.
Examples for an action to be done are the transmission of a message,
initiation of a timer or a counter etc.
Table C.2.1-1 shows the off-network group call floor control transitions.
Table C.2.1-1: Off-network group call floor control transitions
* * *
Current State Trigger Resulting State Remarks
* * *
O: silence R: Floor Granted to other O: has no permission Another client took
the floor.
                         R: RTP media                                         O: has no permission   Another client took the floor.
                         PTT Button pressed                                   O: pending request     MCPTT User indicated to transmit media. Client contends for floor.
                         R: Floor Request                                     O: pending granted     Another client requested floor (only private call)
                         R: Floor Taken                                       O: has no permission   Another client took the floor.
                         R: MCPTT call release                                Start-stop             Call ended. Release floor control entity.
                         Timer T230 (Inactivity) expiry                       Start-stop             No floor activity for long. Assume call ended. Release floor control entity.
O: has no permission R: Floor Granted to other O: has no permission Another
client received floor; stop rendering media.
                         R: RTP media                                         O: has no permission   Current floor arbitrator speaking. Render media.
                         PTT Button pressed                                   O: pending request     MCPTT User indicated to transmit media. Client contends for floor.
                         R: Floor Release                                     O: silence             Current floor arbitrator released the floor.
                         Timer T203 (end of RTP media) expires                O: silence             No media for long. Assume silence.
                         R: MCPTT call release                                Start-stop             Call ended. Release floor control entity.
O: pending request Timer T201 (Floor Request) expires Conditional - O: has
permission if the associated counter reached upper limit. Otherwise, O:
pending request
                         R: Floor Granted to me                               O: has permission      Contention won. Client is the new Floor Arbitrator.
                         R: Floor Deny                                        O: has no permission   The request was denied.
                         R: RTP media                                         O: pending request     Render media. Reset counter associated with T201.
                         R: Floor Granted to other                            O: pending request     Another client received floor; stop rendering media.
                         R: Floor Request                                     O: pending request     Another client requested floor, reset counter associated with T201.
                         R: Floor Taken                                       O: pending request     Another client took the floor.
                         R: Floor Queue Position Info                         O: queued              If own queue position is received.
                         PTT Button released                                  O: silence             MCPTT User indicated to end floor contention.
                         R: MCPTT call release                                Start-stop             Call ended. Release floor control entity.
O: queued User indication to accept grant of pending request O: has permission
Only after \'floor granted to me\' is received. Otherwise, ignore.
                         R: Floor Deny                                        O: has no permission   Queued request was denied.
                         Timer T233 (pending user action) expires             O: silence             No response from user.
                         User releases floor                                  O: has no permission   Send a floor release message.
                         Timer T203 (End of RTP media) expires                O: pending request     Send Floor request message and start timer T201.
                         R: Floor Granted to me                               O: queued              Wait for user action. Start timer T233.
                         R: Floor Granted to other                            O: queued              Another client received floor; stop rendering media.
                         R: Floor Queue Position Info                         O: queued              Update queue position.
                         R: RTP media                                         O: queued              Render the media.
                         Request queue position info                          O: queued              Update info.
                         R: MCPTT call release                                Start-stop             Call ended. Release floor control entity.
                         Timer T204 (Floor Queue Position request) expires    Conditional -          if the associated counter has reached maximum value enter O: silence, otherwise, restart Timer T204
O: has permission PTT Button released Conditional - O: pending granted if
request(s) are pending in Queue.\ Otherwise, O: silence
                         R: Floor Request                                     Conditional -          O: pending granted if the request is of higher priority. Otherwise, Queue or deny.
                         R: Floor Release                                     O: has permission      A client released contention, remove from Queue.
                         R: Floor Queue Position Request                      O: has permission      Respond by sending Floor Queue Position Info.
                         R: MCPTT call release                                Start-stop             Call ended. Release floor control entity.
                         Timer T206 (Stop talking warning) expires            O: has permission      Warn user and start timer T207
                         Timer T207 (Stop talking) expires                    Conditional -          O: pending granted if request(s) are pending in Queue.\
                                                                                                     Otherwise, O: silence
O: pending granted R: RTP media O: has no permission New floor arbitrator took
control.
                         Timer T205 (Floor Granted) expires                   O: Conditional         if the associated counter has reached maximum value, enter O: silence if there are no pending requests or enter O: pending granted if there are pending request(s). Otherwise, restart Timer T205
                         PTT button pressed                                   O: pending granted     Reject the request internally.
                         R: Floor Request                                     O: pending granted     Send either a Floor Granted message or a Floor Deny message as it can result in unsynchronised queue.
                         R: Floor release                                     O: pending granted     Remove the sending user from queue.
                         Timer T233 (Pending user action) expires             Conditional -          If queue not empty, restart timer T205 and grant to next in queue. Otherwise, move to \'O: silence\'.
                         R: MCPTT call release                                Start-stop             Call ended. Release floor control entity.
Start-stop Group Call established as originating user O: has permission The
client initiated the call.
                         Group Call established as terminating user           O: silence             The client responded to the call.
                         Private Call established as terminating user         O: has no permission   The client responded to the call.
                         Broadcast Call established as terminating user       O: has no permission   The client responded to the call.
                         PTT button pressed                                   O: pending request     MCPTT User indicated to transmit media. Client contends for floor.
                         R: Floor Taken                                       O: has no permission   Another client took the floor.
                         R: RTP media                                         O: has no permission   Another client took the floor.
                         R: Floor Granted to other                            O: has no permission   Another client took the floor.
* * *
#
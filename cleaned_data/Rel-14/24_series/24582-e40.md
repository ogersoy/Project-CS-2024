# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the media plane control protocols and
interactions with the media needed to support Mission Critical Data (MCData)
services, which are Short Data Service (SDS) and File Distribution (FD).
Mission critical communication services are services that require preferential
handling compared to normal telecommunication services, e.g. in support of
police or fire brigade.
The MCData service and its associated media plane control protocols can be
used for public safety applications and also for general commercial
applications (e.g., utility companies and railways).
The present document is applicable to User Equipment (UE) supporting MCData
client functionality and to servers in the MCData system.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.282: \"Functional architecture and information flows to support
Mission Critical Data (MCData) Stage-2\".
[3] 3GPP TS 23.280: \"Common functional architecture to support mission
critical services Stage-2\".
[4] 3GPP TS 24.481: \"Mission Critical Services (MCS) group management;
Protocol Specifications\".
[5] 3GPP TS 24.482: \"Mission Critical Services (MCS) identity management;
Protocol Specifications\".
[6] 3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object
(MO)\".
[7] 3GPP TS 24.484: \"Mission Critical Services (MCS) configuration
management; Protocol Specifications \".
[8] 3GPP TS 24.282: \"Mission Critical Services (MCS) signalling control;
Protocol Specifications \".
[9] IETF RFC 2046 (November 1996): \"Multipurpose Internet Mail Extensions
(MIME) Part Two: Media Types\".
[10] IETF RFC 4122 (July 2005): \"A Universally Unique IDentifier (UUID) URN
Namespace\".
[11] IETF RFC 4975 (September 2007): \"The Message Session Relay Protocol
(MSRP)\".
[12] IETF RFC 6135 (February 2011): \"An Alternative Connection Model for the
Message Session Relay Protocol (MSRP)\".
[13] IETF RFC 6714 (August 2012): \"Connection Establishment for Media
Anchoring (CEMA) for the Message Session Relay Protocol (MSRP)\".
[14] IETF RFC 4976 (September 2007): \"Relay Extensions for the Message
Session Relay Protocol (MSRP)\".
[15] 3GPP TS 33.180: \"Security of mission critical services\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**example:** text used to clarify abstract rules by applying them literally.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
CSK Client-Server Key
CSK-ID Client-Server Key Identifier
DPCK MCData Payload Cipher Key
DPCK-ID MCData Payload Cipher Key Identifier
DPKK MCData Payload Protection Key
DPKK-ID MCData Payload Protection Key Identifier
FD File Distribution
GMK Group Master Key
GMK-ID Group Master Key Identifier
KMS Key Management Server
KPAK KMS Public Authentication Key
PCK Private Call Key
PCK-ID Private Call Key Identifier
PVT Public Validation Token
SDS Short Data Service
SPK Signalling Protection Key
SPK-ID Signalling Protection Key Identifier
SSK Secret Signing Key
# 4 General
## 4.1 Overview
### 4.1.1 Short data service
The media plane control procedures, both for one-to-one and group short data
services, take place for on-network only, when standalone short data is sent
using media plane or when the short data is sent after an SDS session is
established. In both cases the media plane is established as specified in 3GPP
TS 24.282 [8].
The media plane uses the MSRP protocol as specified in RFC 4975 [11], RFC 4976
[14], RFC 6135 [12], and RFC 6714 [13].
In a standalone SDS using media plane, a single SDS message is sent by the
originating MCData client as specified in this document. The procedure is
terminated as specified in 3GPP TS 24.282 [8].
When an SDS session is established any MCData client with appropriate
permissions, which participates this SDS session, can initiate the
transmission of and SDS message until the termination of the SDS session. The
termination of an SDS session is specified in 3GPP TS 24.282 [8].
An SDS message sent using media plane is carried in the body of an MSRP SEND
request. The media control parameters and the data of an SDS message are
carried in separate bodies in the same MSRP SEND request.
The Conversation ID,the Message ID, the optional InReplyTo message ID, the
optional SDS disposition request type and the optional Application identifier
are communicated by the MCData client which sends the SDS message in the media
control part of the body in the MSRP SEND request. The data is carried in a
separate body of the MSRP SEND request.
For standalone SDS using media plane, the disposition notification is
communicated as specified in 3GPP TS 24.282 [8].
For SDS during an SDS session the disposition notification is communicated
using the procuderes specified in the current document until the SDS session
is terminated. After the termination of the SDS session the disposition
notification, if any, is communicated as specified in 3GPP TS 24.282 [8].
### 4.1.2 File distribution
The media plane control procedures, both for one-to-one and group file
distribution using media plane, take place for on-network only. The media
plane for FD is established as specified in 3GPP TS 24.282 [8].
The media plane uses the MSRP protocol as specified in RFC 4975 [11], RFC 4976
[14], RFC 6135 [12], and RFC 6714 [13].
A file is sent using media plane by the originating MCData client as specified
in this document. The procedure is terminated as specified in 3GPP TS 24.282
[8].
The Conversation ID , the Message ID, the optional InReplyTo message ID, the
optional FD disposition request type, the optional Application ID, the
optional Mandatory download and the optional Metadata are communicated by the
MCData client which sends the file using the procedures specified in 3GPP TS
24.282 [8] while establishing the media plane.
The file is carried in the body of the MSRP SEND request as specified in this
document.
The disposition notification is communicated as specified in 3GPP TS 24.282
[8].
### 4.1.3 Void
## 4.2 Other considerations
When an SDS message is sent using media plane, the body included in the MSRP
SEND request, which carries media control information or which carries
notification information, is protected between each entity separately if
protection is applied. On the other hand the body included in the MSRP SEND
request which carries the data is end to end protected. The procedures for the
protection of the media control information or notification or of the data are
specified in this document.
When a file is is sent using media plane, the file or file portion, included
in the body of the MSRP SEND request, is end to end protected. The procedure
for the protection of the file is specified in this document.
# 5 Functional entities
## 5.1 General for MCData functional entities
Media plane control is conducted between the MCData server and MCData UE.
MCData server has capability functions for SDS and FD. MCData UE incorporates
the MCData client. MCData user or MCData user application may feed or consume
data transmitted or received via the capability functions in the MCData
client. The capability function in the MCData client provides SDS and FD
services.
The capability functions of the MCData server are specified for the
controlling MCData function and the participating MCData function. The
capability functions of the MCData UE are specified for the MCData client.
Data to be transmitted either by the MCData user or by a MCData user
application using media plane shall be transmitted by the MCData client to the
participating MCData function. The participating MCData function shall forward
the data to the controlling MCData function. The controlling MCData function
shall distribute the data to the destination MCData client for one-to-one
MCData service and to the MCData clients of the affiliated group members for
group MCData service via the participating MCData functions serving each
destination MCData client. A participating MCData function may serve one or
more MCData clients. Based on deployment, controlling MCData function may be
in communication with zero, one or more participating MCData functions. If a
participating MCData function is collocated with the controlling MCData
function, the controlling MCData function may perform the functions of this
co-located participating MCData function. In this case the controlling MCData
function and this co-located participating MCData function shall act as a
single entity.
In the media plane the MCData client and the controlling MCData function shall
act as MSRP clients. If and when a participating MCData function is in the
communication path as a separate entity between the controlling MCData
function and one or more MCData clients, it shall act as an MSRP relay.
## 5.2 Functional entities for SDS
The capability function for SDS for media plane in the MCData server is
composed of SDS distribution function and the Tranmission/Reception control.
In the media plane the functions of SDS distribution and the
Tranmission/Reception control are specified for the controlling MCData
function and the participating MCData function. The functions of the SDS are
specified for the SDS function in MCData client.
For SDS, data is composed of short data in the form of text, hypertext, binary
string or location information. Short data generated in the MCData client and
sent using media plane follows the path for the originating MCData client to
the terminating MCData clients as explained in subclause 5.1.
## 5.3 Functional entities for FD
The capability function for FD for media plane in the MCData server is
composed of FD function and the Tranmission/Reception control. The file
distribution over media plane functionalities in the MCData server are
specified for the controlling MCData function and the participating MCData
function. The functions of the FD are specified for the FD function in the
MCData client.
For FD, data is composed of a file. A file provided at the MCData client and
sent using media plane follows the path from the originating MCData client to
the terminating MCData clients as explained in subclause 5.1.
# 6 SDS media plane procedures
## 6.1 MCData client procedures
### 6.1.1 Standalone SDS via media plane
#### 6.1.1.1 General
In a standalone SDS via media plane, upon receiving an SDS request from the
user or user application the originating MCData client establishes the media
plane as specified in 3GPP TS 24.282 [8]. When the media plane is established
a conversation ID is associated with this SDS message.
For the procedures in subclause 6.1.1.2 it is assumed that it has been
verified that:
1\. if standalone one to one SDS using media plane is initiated:
a. the MCData client is allowed to transmit data;
b. the size of the SDS message is less than or equal to maximum amount of data
that the MCData user can transmit in a single request during one-to-one
communication; and
c. the size of the SDS message is less than or equal to maximum data size for
SDS;
2\. if standalone group SDS using media plane is initiated:
a. the MCData client is allowed to transmit data in this group;
b. the size of the SDS message is less than or equal to maximum amount of data
that the MCData user can transmit in a single request during group
communication;and
c. the size of the SDS message is less than or equal to maximum data size for
SDS; and3. the size of the short data including the media plane information
elements is larger than the allowed limits over MCData-SDS-1 interface using
SIP reference points.
before the media plane establishment is initiated as specified in 3GPP TS
24.282[8]:
The procedures in subclause 6.1.1.2 and subclause 6.1.1.3 are applicable for
one-to-one and group standalone SDS using media plane.
#### 6.1.1.2 Procedures for the originating MCData client
##### 6.1.1.2.1 Handling MSRP connection
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4; and
4\. shall send the MSRP SEND request on the established MSRP connection.
If MSRP chunking is not used then on receipt of a 200 (OK) response, the
MCData client shall terminate the SIP session as specified in 3GPP TS 24.282
[8].
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the SDS message could not be sent; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
On receiving an indication to terminate the session from the signalling plane,
the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks and may indicate to MCData user that the SDS message
could not be sent.
##### 6.1.1.2.2 Generate signalling payload
In order to generate an SDS signalling payload, the MCData client:
1\. shall generate an SDS SIGNALLING PAYLOAD message as specified in 3GPP TS
24.282 [8]; and
2\. shall include the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8]; and
When generating a an SDS SIGNALLING PAYLOAD message, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD message as defined in 3GPP TS
24.282 [8]. In the SDS SIGNALLING PAYLOAD message, the MCData client:
a. may include and set the Disposition request type IE to:
i. \"DELIVERY\", if only delivery disposition is requested;
ii. \"READ\", if only read disposition is requested; or
iii. \"DELIVERY AND READ\", if both delivery and read dispositions are
requested;
b. shall set Date and time IE to current UTC time;
c. shall set Conversation ID IE to a universally unique message ID generated
as per IETF RFC 4122 [10];
d. shall set Message ID IE to a universally unique message ID generated as per
IETF RFC 4122 [10];
e. if indicated that the SDS message is in reply to another SDS message then,
shall include the Reply ID IE set to the message identifier of the indicated
SDS message;
f. if indicated that the target recipient of the SDS message is an application
then, shall set Application Identifier IE to the application identifier; and
g) shall set the Sender MCData user ID to its own MCData user ID as specified
in subclause 15.2.15 of 3GPP TS 24.282 [8].
##### 6.1.1.2.3 Generate data payload
In order to generate SDS data payload, the MCData client:
1\. shall generate a DATA PAYLOAD message as specified in 3GPP TS 24.282 [8];
and
2\. shall include the DATA PAYLOAD message in an application/vnd.3gpp.mcdata-
payload MIME body as specified in 3GPP TS 24.282 [8].
When generating a a DATA PAYLOAD message, the MCData client:
1\. shall generate a SDS DATA PAYLOAD message as defined in 3GPP TS 24.282
[8]. In the SDS DATA PAYLOAD message, the MCData client:
a. shall set Number of payloads IE to the total number of payloads being sent;
and
b. for each payload, shall include Payload IE. In the Payload IE:
i. shall set Payload content type to \"TEXT\", or \"BINARY\", or
\"HYPERLINKS\", or \"LOCATION\" according to the payload type; and
ii. shall set Payload data IE to actual payload.
##### 6.1.1.2.4 Generate MSRP SEND for SDS message
The MCData client shall take the procedures in subclause 6.4.1 into
consideration when generating MSRP SEND messages.
The MCData client shall generate MSRP SEND for SDS message requests according
to IETF RFC 4975 [11].
When generating an MSRP SEND for SDS message request containing an SDS
SIGNALLING PAYLOAD message and an SDS DATA PAYLOAD message, the MCData client
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall include two MIME bodies in accordance with subclause 6.4.1 where:
a. in the first body the Content-Type header field is set to
\"application/vnd.3gpp.mcdata-signalling\" and the generated SDS SIGNALLING
PAYLOAD message is included; and
b. in the second body the Content-Type header field is set to
\"application/vnd.3gpp.mcdata-payload\" and the generated SDS DATA PAYLOAD
message is included.
When generating an MSRP SEND for SDS message request containing only an SDS
DATA PAYLOAD message, the MCData client:
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the Content-Type as \"application/vnd.3gpp.mcdata-payload\"; and
3\. shall set the body of the MSRP SEND request to the generated SDS DATA
PAYLOAD message.
When generating an MSRP SEND for SDS message request containing only an SDS
SIGNALLING PAYLOAD, the MCData client.
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the Content-Type as \"application/vnd.3gpp.mcdata-signalling\";
and
3\. shall set the body of the MSRP SEND request to the generated SDS
SIGNALLING PAYLOAD message.
#### 6.1.1.3 Procedures for the terminating MCData client
##### 6.1.1.3.1 Handling MSRP connection
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the terminating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP connection is established, the MCData client:
1\. on receipt of an MSRP request in an MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData standalone
message before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.1.3.2.
##### 6.1.1.3.2 Handling received content and disposition requests
The MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body;
2\. shall decode the contents of the application/vnd.3gpp.mcdata-payload MIME
body;
3\. if the SDS SIGNALLING PAYLOAD message contains a new Conversation ID,
shall instantiate a new conversation with the Message ID in the SDS SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
4\. if the SDS SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
a. if the SDS SIGNALLING PAYLOAD message does not contain an InReplyTo Message
ID, shall use the Message ID in the SDS SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
b. if the SDS SIGNALLING PAYLOAD message contains an InReplyTo Message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo Message ID in the SDS SIGNALLING PAYLOAD and
use the Message ID in the SDS SIGNALLING PAYLOAD to identify the new message;
5\. shall identify the number of Payload IEs in the DATA PAYLOAD message from
the Number of Payloads IE in the DATA PAYLOAD message;
6\. if the SDS SIGNALLING PAYLOAD message does not contain an Application
identifier IE:
a. shall determine that the payload contained in the DATA PAYLOAD message is
for user consumption;
b. may notify the MCData user; and
c. shall render the contents of the Payload IE(s) to the MCData user;
7\. if the SDS SIGNALLING PAYLOAD message contains an Application identifier
IE:
a. shall determine that the payload contained in the DATA PAYLOAD message is
not for user consumption;
b. shall not notify the MCData user;
c. if the Application identifier value is unknown, shall discard the SDS
message; and
d. if the Application identifier value is known, shall deliver the contents of
the Payload IE(s) to the identified application; and
8\. if SDS Disposition request type IE is present in the SDS SIGNALLING
PAYLOAD message received in subclause 6.1.1.3.1 then, shall send a disposition
notification as described in 3GPP TS 24.282 [8] subclause 9.2.1.3.
### 6.1.2 Short data during an SDS session
#### 6.1.2.1 General
In a SDS session, upon receiving an SDS request from the user or user
application the originating MCData client establishes the media plane as
specified in 3GPP TS 24.282 [8].
The procedure in subclause 6.1.2.2 and subclause 6.1.2.3 are applicable for
one-to-one and group SDS session.
Any MCData user with appropriate permissions, originator of the SDS session or
not, can send a SDS message during the SDS session.
A client which is not permitted to transmit data should not use the procedure
in subclause 6.1.2.2 and subclause 6.1.2.3.
#### 6.1.2.2 Procedures for the originating MCData client
##### 6.1.2.2.1 Handling MSRP connection
Upon receiving an indication to establish MSRP connection for SDS session as
the originating MCData client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData SDS message
before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client can generate and send an SDS message as specified in subclause 6.1.2.4,
or can generate and send an SDS disposition notification for a received SDS
message as specified in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
##### 6.1.2.2.2 Void
##### 6.1.2.2.3 Void
##### 6.1.2.2.4 Void
#### 6.1.2.3 Procedures for the terminating MCData client
##### 6.1.2.3.1 Handling MSRP connection
Upon receiving an indication to establish MSRP connection for SDS session as
the terminating MCData client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData SDS message
before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request sent as
\"active\" endpoint, or after sending MSRP 200 (OK) response to the first MSRP
SEND request received as \"passive\" endpoint, the MCData client can generate
and send an SDS message as specified in subclause 6.1.2.4, or can generate and
send an SDS disposition notification for a received SDS message as specified
in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
##### 6.1.2.3.2 Void
#### 6.1.2.4 Sending SDS message
An MCData client is allowed to send an one-to-one SDS message only if
1\. the \ element of an \ element is present
with a value \"true\" (see the MCData user profile document in 3GPP TS 24.484
[7]);
2\. the size of the SDS message is less than or equal to the value of the
\ element in the MCData service configuration
document as specified in 3GPP TS 24.484 [7]; and
3\. the size of the SDS message is less than or equal to the value of
\ element of the MCData user profile document (see the MCData
user profile document in 3GPP TS 24.484 [7]).
An MCData client is allowed to send a group SDS message only if
1\. the \ element of an \
element is present with a value \"true\" as defined in the MCData group
document for this MCData group as specified in 3GPP TS 24.481 [4];
2\. the size of the SDS message is less than or equal to the value contained
in the \ as defined in the MCData
group document for this MCData group as specified in 3GPP TS 24.481 [4]; and
3\. the size of the SDS message is less than or equal to the value contained
in the \ element of the \ element of
the MCData group document for this MCData group as specified in 3GPP TS 24.481
[11].
If the above mentioned conditions satisfy, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4, with the following
clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
4\. shall send the MSRP SEND request on the established MSRP connection.
#### 6.1.2.5 SDS Notification
##### 6.1.2.5.1 Sending SDS Notification
To send an SDS disposition notification, the MCData client:
1\. shall generate a SDS NOTIFICATION as specified in subclause 6.1.2.5.2;
2\. shall include the SDS NOTIFICATION in an MSRP SEND request as specified in
subclause 6.1.2.5.3, with the following clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
3\. shall send the MSRP SEND request on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary.
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks; and
2\. shall indicate to MCData user that the SDS message or the SDS disposition
notification could not be sent.
##### 6.1.2.5.2 Generate SDS NOTIFICATION
In order to generate an SDS notification, the MCData client:
1\. shall generate an SDS NOTIFICATION message as specified in 3GPP TS 24.282
[8]; and
2\. shall include the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8].
When generating an SDS NOTIFICATION message, the MCData client:
1\. if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\";
2\. if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\";
3\. if sending a delivered and read notification, shall set the SDS
disposition notification type IE as \"DELIVERED AND READ\";
4\. if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\";
5\. shall set the Date and time IE to the current time;
6\. shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message;
7\. shall set the Message ID to the value of the Message ID that was received
in the SDS message;
8\. if the SDS message was destined for the user, shall not include an
Application ID IE;
9\. if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message; and
10\. shall set the Sender MCData user ID to its own MCData user ID as
specified in subclause 15.2.15 of 3GPP TS 24.282 [8].
##### 6.1.2.5.3 Generate MSRP SEND for SDS disposition notification
The MCData client shall generate MSRP SEND requests for SDS disposition
notification according to IETF RFC 4975 [11].
When generating an MSRP SEND request for SDS disposition notification
containing an SDS NOTIFICATION message, the MCData client
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the content type as Content-Type =
\"application/vnd.3gpp.mcdata-signalling\"; and
3\. shall set the body of the MSRP SEND request to the generated SDS
NOTIFICATION message.
#### 6.1.2.6 Handling received content and disposition requests
Upon receiving an SDS message, the MCData client:
1\. shall follow the procedure defined in subclause 6.1.1.3.2, with the
following clarification:
a. if SDS Disposition request type IE is present in the received SDS
SIGNALLING PAYLOAD message then, shall send an SDS disposition notification as
described in subclause 6.1.2.5.
Upon receiving an SDS disposition notification, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2\. shall deliver the notification to the user or application.
## 6.2 Participating MCData function procedures
### 6.2.1 Standalone SDS via media plane
#### 6.2.1.1 General
For a standalone SDS via media plane, the media plane is established between
the originating MCData client and the originating participating MCData
function, the originating participating MCData function and the controlling
MCData function, the controlling MCData function and the terminating
participating MCData function(s) and each terminating participating MCData
function and the terminating MCData client(s) as specified in 3GPP TS 24.282
[8].
The procedures in subclause 6.2.1.4 and subclause 6.2.1.5 are applicable for
one-to-one and group standalone SDS using media plane.
#### 6.2.1.2 Establishing MSRP session to receive standalone SDS message
To receive a SDS message over MSRP, the participating MCData function:
1\. shall act according to IETF RFC 6135 [12], as:
a. an \"passive\" endpoint, if a=setup attribute in the sent SDP answer was
set to \"passive\"; and
b. an \"active\" endpoint, if a=setup attribute in the sent SDP answer was set
to \"active\"; and
2\. shall establish an MSRP connection according to the MSRP connection
parameters in the sent SDP answer response as described in IETF RFC 4976 [14].
#### 6.2.1.3 Establish MSRP session to send standalone SDS message
To send a SDS message over MSRP, the participating MCData function:
1\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\"; and
2\. shall establish the MSRP connection according to the MSRP connection
parameters in the received SDP answer response as described in IETF RFC 4976
[14].
#### 6.2.1.4 Procedures for the originating participating MCData function
##### 6.2.1.4.1 Establish MSRP session with the originating MCData client
The originating participating MCData function should establish the MSRP
session with the originating MCData client as specified in subclause 6.2.1.2.
##### 6.2.1.4.2 Establish MSRP session with the controlling MCData function
The originating participating MCData function should establish the MSRP
session with the controlling MCData function as specified in subclause
6.2.1.3.
##### 6.2.1.4.3 Handling of received MSRP messages
Upon receiving an MSRP SEND request from the originating MCData client, the
originating participating MCData function:
1\. if in a standalone one-to-one SDS using media plane, shall verify the SDS
message size is less than or equal to \ element of the MCData
user profile document for the originating MCData client (see the MCData user
profile document in 3GPP TS 24.484 [7]);
2\. if the verifications in 1 above fails, shall send the MSRP response with
the error code 403 to the originating MCData client and shall not continue
with the rest of the procedure;
3\. if an MSRP connection is not established with the controlling MCData
function then, shall establish the MSRP connection as specified in subclause
6.2.1.4.2. Otherwise, shall use the existing MSRP connection; and
4\. shall forward the received MSRP SEND request to the controlling MCData
function according to the rules and procedures of IETF RFC 4975 [11].
Upon receiving an MSRP 200 (OK) response from the controlling MCData function,
the participating MCData function shall forward the MSRP 200 (OK) response to
the originating MCData client according to the rules and procedures of IETF
RFC 4975 [11].
Upon receiving an error MSRP response from the controlling MCData function,
the participating MCData function shall forward the error MSRP response to the
originating MCData client according to the rules and procedures of IETF RFC
4975 [11].
#### 6.2.1.5 Procedures for the terminating participating MCData function
##### 6.2.1.5.1 Establish MSRP session with the controlling MCData function
The terminating participating MCData function should establish the MSRP
session with the controlling MCData function as specified in subclause
6.2.1.2.
##### 6.2.1.5.2 Establish MSRP session with the terminating MCData client
The terminating participating MCData function should establish MSRP session to
terminating MCData client as specified in subclause 6.2.1.3.
##### 6.2.1.5.3 Handling of received MSRP messages
Upon receiving an MSRP SEND request from the controlling MCData function, the
terminating participating MCData function:
1\. shall generate and send a MSRP 200 (OK) response for the received MSRP
SEND request to the controlling MCData function, according to the rules and
procedures of IETF RFC 4975 [11]; and
2\. shall forward the received MSRP SEND request to the terminating MCData
client according to the rules and procedures of IETF RFC 4975 [11].
Upon receiving an error MSRP response from the terminating MCData client, the
participating MCData function shall forward the error MSRP response to the
originating MCData client according to the rules and procedures of IETF RFC
4975 [11].
### 6.2.2 Short data during an SDS session
#### 6.2.2.1 General
For a one-to-one or group SDS session, the media plane is established between
the originating MCData client and the originating participating MCData
function, the originating participating MCData function and the controlling
MCData function, the controlling MCData function and the terminating
participating MCData function(s) and each terminating participating MCData
function and the terminating MCData client(s) as specified in 3GPP TS 24.282
[8]. The procedures in subclause 6.2.2.4 and subclause 6.2.2.5 are applicable
for one-to-one and group SDS session.
#### 6.2.2.2 Establishing MSRP session to receive SDS message
To receive a SDS message over MSRP, the participating MCData function:
1\. shall act according to IETF RFC 6135 [12], as:
a. an \"passive\" endpoint, if a=setup attribute in the sent SDP answer was
set to \"passive\"; and
b. an \"active\" endpoint, if a=setup attribute in the sent SDP answer was set
to \"active\"; and
2\. shall establish an MSRP connection according to the MSRP connection
parameters in the sent SDP answer response as described in IETF RFC 4976 [14].
#### 6.2.2.3 Establish MSRP session to send SDS message
To send a SDS message over MSRP, the participating MCData function:
1\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\"; and
2\. shall establish the MSRP connection according to the MSRP connection
parameters in the received SDP answer response as described in IETF RFC 4976
[14].
#### 6.2.2.4 Procedures for the originating participating MCData function
##### 6.2.2.4.1 Establish MSRP session with the originating MCData client
The originating participating MCData function should establish the MSRP
session with the originating MCData client as specified in subclause 6.2.2.2.
##### 6.2.2.4.2 Establish MSRP session with the controlling MCData function
The originating participating MCData function should establish the MSRP
session with the controlling MCData function as specified in subclause
6.2.2.3.
##### 6.2.2.4.3 Handling of received MSRP messages
Upon receiving an MSRP SEND request from the originating MCData client, the
originating participating MCData function:
1\. if an MSRP connection is not established with the controlling MCData
function then, shall establish the MSRP connection as specified in subclause
6.2.2.4.2. Otherwise, shall use the existing MSRP connection; and
2\. shall forward the received MSRP SEND request to the controlling MCData
function according to the rules and procedures of IETF RFC 4975 [11].
Upon receiving an MSRP 200 (OK) response from the controlling MCData function,
the participating MCData function shall forward the MSRP 200 (OK) response to
the originating MCData client according to the rules and procedures of IETF
RFC 4975 [11].
Upon receiving an error MSRP response from the controlling MCData function,
the participating MCData function shall forward the error MSRP response to the
originating MCData client according to the rules and procedures of IETF RFC
4975 [11].
#### 6.2.2.5 Procedures for the terminating participating MCData function
##### 6.2.2.5.1 Establish MSRP session with the controlling MCData function
The terminating participating MCData function should establish the MSRP
session with the controlling MCData function as specified in subclause
6.2.2.2.
##### 6.2.2.5.2 Establish MSRP session with the terminating MCData client
The terminating participating MCData function should establish MSRP session to
terminating MCData client as specified in subclause 6.2.2.3.
##### 6.2.2.5.3 Handling of received MSRP messages
Upon receiving an MSRP SEND request from the controlling MCData function, the
terminating participating MCData function:
1\. shall generate and send a MSRP 200 (OK) response for the received MSRP
SEND request to the controlling MCData function, according to the rules and
procedures of IETF RFC 4975 [11]; and
2\. shall forward the received MSRP SEND request to the terminating MCData
client according to the rules and procedures of IETF RFC 4975 [11].
Upon receiving an error MSRP response from the terminating MCData client, the
participating MCData function shall forward the error MSRP response to the
originating MCData client according to the rules and procedures of IETF RFC
4975 [11].
## 6.3 Controlling MCData function procedures
### 6.3.1 Standalone SDS via media plane
#### 6.3.1.1 General
The controlling MCData function plays a key role in anchoring the media
between the originating MCData client and the terminating MCData client. Hence
controlling MCData function maintains a MSRP session with all the active
MCData clients.
The procedures in subclause 6.3.1.2 and subclause 6.3.1.3 are applicable for
both, one-to-one and group standalone SDS using media plane.
#### 6.3.1.2 Establishing MSRP session
##### 6.3.1.2.1 MSRP session establishment with originating MCData client
To establish the MSRP connection with the originating MCData client, the
controlling MCData function performs below procedures:
1\. shall act as an MSRP client and establish TLS connection with the
originating participating MCData function, if exists, otherwise the
originating MCData client, according to the rules and procedures as described
in IETF RFC 4975 [11];
2\. shall act as an MSRP client to send MSRP SEND requests according to the
rules and procedures described in IETF RFC 6135 [12];
3\. shall act as an \"passive\" endpoint according to the rules and procedures
described in IETF RFC 6135 [12];
4\. shall establish the MSRP connection with originating MCData client,
according to the rules and procedures described in IETF RFC 6135 [12]; and
5\. as a passive endpoint, shall wait for MSRP SEND request on established
MSRP connection, to bind the MSRP connection to the MSRP session according to
the rules and procedures of IETF RFC 4975 [11] and IETF RFC 6135 [12].
##### 6.3.1.2.2 MSRP session establishment with terminating MCData client
To establish the MSRP connection with the terminating MCData client, the
controlling MCData function performs below procedures:
1\. shall act as an MSRP client and establish TLS connection with the
terminating participating MCData function, if exists, otherwise the
terminating MCData client, according to the rules and procedures as described
in IETF RFC 4975 [11];
2\. shall act as an MSRP client to send MSRP SEND requests according to the
rules and procedures described in IETF RFC 6135 [12];
3\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
4\. shall establish the MSRP connection with each terminating MCData client
identified in the 3GPP TS 24.282 [8], according to the rules and procedures
described in IETF RFC 6135 [12]; and
5\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
on each established MSRP connection, to bind the MSRP connection to the MSRP
session according to the rules and procedures of IETF RFC 4975 [11] and IETF
RFC 6135 [12].
#### 6.3.1.3 Handling of received MSRP messages
Upon receiving a MSRP SEND request from the originating participating MCData
function, the controlling MCData function:
1\. if in a standalone one-to-one SDS using media plane, shall verify the SDS
message size is less than or equal to \ element in
the MCData service configuration document as specified in 3GPP TS 24.484 [7];
2\. if in a standalone group SDS using media plane shall verify:
a. the SDS message size is less than or equal to \ element of the MCData group document for the (see the MCData group
document in 3GPP TS 24.481 [4]); and
b. the SDS message size is less than or equal to \ element of the MCData group document (see the MCData group
document in 3GPP TS 24.481 [4]);
3\. if the verifications in either 1 or 2 a or 2 b above fails, shall send the
MSRP response with the error code 403 to the MCData client which sent the SDS
message and shall not continue with the rest of the procedure;
4\. shall generate and send a MSRP 200 (OK) response for the received MSRP
SEND requests to the originating participating MCData function, according to
the rules and procedures of IETF RFC 4975 [11]; and
5\. shall forward the received MSRP SEND requests to each terminating MCData
client with which a successful MSRP connection was established, according to
the rules and procedures of IETF RFC 4975 [11]. Following clarifications apply
to the generated MSRP SEND request:
a. shall modify the To-Path header according to the MSRP URI received in the
answer SDP from the MCData client in accordance with rules and procedures of
IETF RFC 4975 [11]; and
b. shall modify the From-Path header to the controlling MCData function's own
MSRP URI, according to the rules and procedures of IETF RFC 4975 [11].
### 6.3.2 Short data during SDS session
#### 6.3.2.1 General
#### 6.3.2.2 Establishing MSRP session
##### 6.3.2.2.1 MSRP session establishment with originating MCData client
To establish the MSRP connection with the originating MCData client, the
controlling MCData function performs below procedures:
1\. shall act as an MSRP client and establish TLS connection with the
originating participating MCData function, if exists, otherwise the
originating MCData client, according to the rules and procedures as described
in IETF RFC 4975 [11];
2\. shall act as an MSRP client to send MSRP SEND requests according to the
rules and procedures described in IETF RFC 6135 [12];
3\. shall act as an \"passive\" endpoint according to the rules and procedures
described in IETF RFC 6135 [12];
4\. shall establish the MSRP connection with originating MCData client,
according to the rules and procedures described in IETF RFC 6135 [12]; and
5\. acting as a \"passive\" endpoint, shall wait for MSRP SEND request on
established MSRP connection, to bind the MSRP connection to the MSRP session
according to the rules and procedures of IETF RFC 4975 [11] and IETF RFC 6135
[12].
##### 6.3.2.2.2 MSRP session establishment with terminating MCData client
To establish the MSRP connection with the terminating MCData client, the
controlling MCData function performs below procedures:
1\. shall act as an MSRP client and establish TLS connection with the
terminating participating MCData function, if exists, otherwise the
terminating MCData client, according to the rules and procedures as described
in IETF RFC 4975 [11];
2\. shall act as an MSRP client to send MSRP SEND requests according to the
rules and procedures described in IETF RFC 6135 [12];
3\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
4\. shall establish the MSRP connection with each terminating MCData client
identified in the 3GPP TS 24.282 [8], according to the rules and procedures
described in IETF RFC 6135 [12]; and
5\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
on each established MSRP connection, to bind the MSRP connection to the MSRP
session according to the rules and procedures of IETF RFC 4975 [11] and IETF
RFC 6135 [12].
#### 6.3.2.3 Handling of received MSRP messages
Upon receiving a MSRP SEND request from the originating participating MCData
function, the controlling MCData function:
1\. shall generate and send a MSRP 200 (OK) response for the received MSRP
SEND requests to the originating participating MCData function, according to
the rules and procedures of IETF RFC 4975 [11]; and
2\. shall forward the received MSRP SEND requests to each terminating MCData
client with which a successful MSRP connection was established, according to
the rules and procedures of IETF RFC 4975 [11]. Following clarifications apply
to the generated MSRP SEND request:
a. shall modify the To-Path header according to the MSRP URI received in the
answer SDP from the MCData client in accordance with rules and procedures of
IETF RFC 4975 [11]; and
b. shall modify the From-Path header to the controlling MCData function's own
MSRP URI, according to the rules and procedures of IETF RFC 4975 [11].
## 6.4 General
### 6.4.1 Handling of MIME bodies in MSRP SEND messages
The MCData client and MCData server shall support several MIME bodies in MSRP
SEND requests as specified in IETF RFC 4975 [11].
When the MCData client or the MCData server sends a MSRP SEND that contains
more than one MIME body, the MCData client or the MCData server:
1) shall, as specified in IETF RFC 2046 [9], include one Content-Type header
field with the value set to multipart/mixed and with a boundary delimiter
parameter set to any chosen value;
2) for each MIME body:
a) shall insert the boundary delimiter;
b) shall insert the Content-Type header field with the MIME type of the MIME
body; and
c) shall insert the content of the MIME body; and
3) shall insert a final boundary delimiter.
When the MCData client or the MCData server sends an MSRP SEND containing only
one MIME body, the MCData client or the MCData server:
1) shall include a Content-Type header field set to the MIME type of the MIME
body; and
2) shall insert the content of the MIME body.
# 7 FD media plane procedures
## 7.1 MCData client procedures
### 7.1.1 General
For file distribution, upon receiving a request from the user or user
application the originating client establishes the media plane as specified in
3GPP TS 24.282 [8].
The procedures in subclause 7.1.2 and subclause 7.1.3 are applicable for one-
to-one and group file distribution.
A MCData client which is not permitted to transmit data should not use the
procedure in subclause 7.1.2.
### 7.1.2 Originating MCData client procedures
#### 7.1.2.1 Handling MSRP connection
Upon receiving an indication to establish MSRP connection for file
distribution as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client can send the file. To send the file, the MCData client:
1\. shall generate MSRP SEND for file distribution request according to IETF
RFC 4975 [11]. When generating an MSRP SEND, the MCData client:
a. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
b. shall set the first content type as Content-Type =
\"application/vnd.3gpp.mcdata-file\"; and
c. shall set the body of the MSRP SEND request with MSRP payload. MSRP payload
is set to the file or part of the file.
2\. shall send the MSRP SEND request(s) on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests containing the file as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the file could not be distributed; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
### 7.1.3 Terminating MCData client procedures
#### 7.1.3.1 Handling MSRP connection
Upon receiving an indication to establish MSRP connection for file
distribution as the terminating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the file before
delivering the content to the application; and
3\. shall handle the received content as described in subclause 7.1.3.2.
#### 7.1.3.2 Handling received content and disposition requests
Upon receiving a file, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-file MIME
body; and
2\. once all the chunks of the file are successfully received, shall indicate
to the signalling plane that the file download is completed.
## 7.2 Participating MCData function procedures
### 7.2.1 General
For a one-to-one or group file distribution, the media plane is established
between the originating MCData client and the originating participating MCData
function, the originating participating MCData function and the controlling
MCData function, the controlling MCData function and the terminating
participating MCData function(s) and each terminating participating MCData
function and the terminating MCData client(s) as specified in 3GPP TS 24.282
[8]. The procedures in subclause 7.2.1.2 and subclause 7.2.1.3 are applicable
for one-to-one and group file distribution.
### 7.2.2 Establishing MSRP session to receive the file
To receive a file over MSRP, the participating MCData function:
1\. shall act according to IETF RFC 6135 [12], as:
a. an \"passive\" endpoint, if a=setup attribute in the sent SDP answer was
set to \"passive\"; and
b. an \"active\" endpoint, if a=setup attribute in the sent SDP answer was set
to \"active\"; and
2\. shall establish an MSRP connection according to the MSRP connection
parameters in the sent SDP answer response as described in IETF RFC 4976 [14].
### 7.2.3 Establish MSRP session to send the file
To send a file over MSRP, the participating MCData function:
1\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\"; and
2\. shall establish the MSRP connection according to the MSRP connection
parameters in the received SDP answer response as described in IETF RFC 4976
[14].
### 7.2.4 Originating participating MCData function procedures
#### 7.2.4.1 Establish MSRP session with the originating MCData client
The originating participating MCData function should establish the MSRP
session with the originating MCData client as specified in subclause 7.2.2.
#### 7.2.4.2 Establish MSRP session with the controlling MCData function
The originating participating MCData function should establish the MSRP
session with the controlling MCData function as specified in subclause 7.2.3.
#### 7.2.4.3 Handling of received MSRP messages
Upon receiving an MSRP SEND request from the originating MCData client, the
originating participating MCData function:
1\. if an MSRP connection is not established with the controlling MCData
function then, shall establish the MSRP connection as specified in subclause
7.2.4.2. Otherwise, shall use the existing MSRP connection; and
2\. shall forward the received MSRP SEND request to the controlling MCData
function according to the rules and procedures of IETF RFC 4975 [11].
Upon receiving an MSRP 200 (OK) response from the controlling MCData function,
the participating MCData function shall forward the MSRP 200 (OK) response to
the originating MCData client according to the rules and procedures of IETF
RFC 4975 [11].
Upon receiving an error MSRP response from the controlling MCData function,
the participating MCData function shall forward the error MSRP response to the
originating MCData client according to the rules and procedures of IETF RFC
4975 [11].
### 7.2.5 Terminating participating MCData function procedures
#### 7.2.5.1 Establish MSRP session with the controlling MCData function
The terminating participating MCData function should establish the MSRP
session with the controlling MCData function as specified in subclause 7.2.2.
#### 7.2.5.2 Establish MSRP session with the terminating MCData client
The terminating participating MCData function should establish MSRP session to
terminating MCData client as specified in subclause 7.2.3.
#### 7.2.5.3 Handling of received MSRP messages
Upon receiving an MSRP SEND request from the controlling MCData function, the
terminating participating MCData function:
1\. shall generate and send a MSRP 200 (OK) response for the received MSRP
SEND request to the controlling MCData function, according to the rules and
procedures of IETF RFC 4975 [11]; and
2\. shall forward the received MSRP SEND request to the terminating MCData
client according to the rules and procedures of IETF RFC 4975 [11].
Upon receiving an error MSRP response from the terminating MCData client, the
participating MCData function shall forward the error MSRP response to the
originating MCData client according to the rules and procedures of IETF RFC
4975 [11].
## 7.3 Controlling MCData function procedures
### 7.3.1 General
### 7.3.2 Establishing MSRP session
#### 7.3.2.1 MSRP session establishment with originating MCData client
To establish the MSRP connection with the originating MCData client, the
controlling MCData function performs below procedures:
1\. shall act as an MSRP client and establish TLS connection with the
originating participating MCData function, if exists, otherwise the
originating MCData client, according to the rules and procedures as described
in IETF RFC 4975 [11];
2\. shall act as an MSRP client to send MSRP SEND requests according to the
rules and procedures described in IETF RFC 6135 [12];
3\. shall act as an \"passive\" endpoint according to the rules and procedures
described in IETF RFC 6135 [12];
4\. shall establish the MSRP connection with originating MCData client,
according to the rules and procedures described in IETF RFC 6135 [12]; and
5\. acting as a \"passive\" endpoint, shall wait for MSRP SEND request on
established MSRP connection, to bind the MSRP connection to the MSRP session
according to the rules and procedures of IETF RFC 4975 [11] and IETF RFC 6135
[12].
#### 7.3.2.2 MSRP session establishment with terminating MCData client
To establish the MSRP connection with the terminating MCData client, the
controlling MCData function performs below procedures:
1\. shall act as an MSRP client and establish TLS connection with the
terminating participating MCData function, if exists, otherwise the
terminating MCData client, according to the rules and procedures as described
in IETF RFC 4975 [11];
2\. shall act as an MSRP client to send MSRP SEND requests according to the
rules and procedures described in IETF RFC 6135 [12];
3\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
4\. shall establish the MSRP connection with each terminating MCData client
identified in the 3GPP TS 24.282 [8], according to the rules and procedures
described in IETF RFC 6135 [12]; and
5\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
on each established MSRP connection, to bind the MSRP connection to the MSRP
session according to the rules and procedures of IETF RFC 4975 [11] and IETF
RFC 6135 [12].
### 7.3.3 Handling of received MSRP messages
Upon receiving a MSRP SEND request from the originating participating MCData
function, the Controlling function:
1\. shall generate and send a MSRP 200 (OK) response for the received MSRP
SEND requests to the originating participating MCData function, according to
the rules and procedures of IETF RFC 4975 [11]; and
2\. shall forward the received MSRP SEND requests to each terminating MCData
client with which a successful MSRP connection was established, according to
the rules and procedures of IETF RFC 4975 [11]. Following clarifications apply
to the generated MSRP SEND request:
a. shall modify the To-Path header according to the MSRP URI received in the
answer SDP from the MCData client in accordance with rules and procedures of
IETF RFC 4975 [11]; and
b. shall modify the From-Path header to the controlling MCData function's own
MSRP URI, according to the rules and procedures of IETF RFC 4975 [11].
# 8 Communication release media plane procedures
When communication is released by the MCData client or by the MCData server,
as specified in 3GPP TS 24.282 [8], for an SDS or FD session which uses the
media plane, the related MSRP session and the TCP or TLS connections used for
this MSRP session shall also be released.
# 9 Coding
## 9.1 General
SDS and FD over media plane messages are coded according to MSRP as specified
in RFC 4975 [11] both for short data and disposition notification. The body of
an MSRP message includes SDS specific messages of a file.
## 9.2 SDS specific messages
SDS specific messages used for on-network SDS using media plane are SDS
SIGNALLING PAYLOAD message, DATA PAYLOAD message and SDS NOTIFICATION message.
The message structures and the format of the information elements are
specified in clause 15 of 3GPP TS 24.282 [8]
# 10 Media plane security aspects
## 10.1 General
Media plane security provides integrity and confidentiality protection for the
MCData media information and media plane control information transmitted using
media plane. Media plane security also provides the authentication of MCData
media information.
The media plane security is based on 3GPP MCData security solution including
key management as defined in 3GPP TS 33.180 [15].
NOTE: In 3GPP TS 33.180 [15] media information is denoted as MCData Data
Payload and media plane control information is denoted as MCData Data
signalling Payload.
Various keys and associated key identifiers protect the media information and
media plane control information carried in the body of an MSRP SEND message.
The media plane control information may be:
1\. SDS SIGNALLING PAYLOAD; or
2\. SDS NOTIFICATION.
The media information may be:
1\. DATA PAYLOAD; or
2\. File or file portion.
In an on-network MCData communication for an MCData group, if protection of
media is negotiated, the GMK and the GMK-ID of the MCData group shall be used
for protecting the media sent and received by MCData clients.
In an on-network one-to-one MCData communication, if protection of media is
negotiated, the PCK and the PCK-ID shall be used for protecting the media sent
and received by MCData clients.
If protection of media control information sent using unicast between the
MCData client and the participating MCData function serving the the MCData
client is negotiated, the CSK and the CSK-ID shall be used for protecting the
media control information sent and received using unicast by the MCData client
and by a participating MCData function.
If protection of media control information between the participating MCData
function and the controlling MCData function is configured, the SPK and the
SPK-ID shall be used for protecting the media control information sent and
received between the participating MCData function and the controlling MCData
function.
The GMK and the GMK-ID are distributed to the MCData clients using the group
document subscription and notification procedure specified in 3GPP TS 24.481
[4].
The PCK and the PCK-ID are generated by the MCData client initiating the
standalone one-to-one SDS using media plane or one-to-one SDS session or one-
to-one FD using media plane and provided to the MCData client receiving the
SIP signalling according to 3GPP TS 24.282 [8].
The CSK and the CSK-ID are generated by the MCData client and provided to the
participating MCData function serving the MCData client using SIP signalling
according to 3GPP TS 24.282 [8].
The SPK and the SPK-ID are configured in the participating MCData function and
the controlling MCData function.
The key material for creating and verifying the authentication signature (SSK,
PVT and KPAK) is provisioned to the MCData clients by the KMS as specified in
3GPP TS 33.180 [15].
## 10.2 **Derivation of master keys for media and media control**
Each MCData Payload Protection Key (DPPK) (i.e. GMK, PCK, CSK, SPK) and its
associated key identifier DPPK-ID (i.e. GMK-ID, PCK-ID, CSK-ID, SPK -ID)
described in subclause 10.1 shall be used to derive a MCData Payload Cipher
Key (DPCK) and its associated DPCK-ID as specified in 3GPP TS 33.180 [15].
DPCK and DPCK-ID shall be used in the protection of media or media plane
control information as specified in 3GPP TS 33.180 [15].
## 10.3 Protection of media and media control and authentication of media
### 10.3.1 General
The media information may be protected. Protection shall be applied as
specified in subclause 8.5.4 in 3GPP TS 33.180 [15].
The media control information may be protected. Protection shall be applied as
specified in subclause 8.5.4 in 3GPP TS 33.180 [15].
MCData media information or protected MCData media information may also be
authenticated as specified in subclause 8.5.5 in 3GPP TS 33.180 [15].
### 10.3.2 The MCData client
A MCData client transmitting media information shall protect the media
information using the related DPPK and DPPK-ID according to the negotiatd
protection method. For one-to-one communication PCK and PCK-ID shall be used
as DPPK and DPPK-ID. For group communication GMK and GMK-ID shall be used as
DPPK and DPPK-ID.
A MCData client transmitting media information or protected media information
shall use the key material provisioned by the KMS when generating the
authentication signature.
A MCData client which receives protected media information shall decrypt and
check the integrity of the protected media using the related DPPK and DPPK-ID
according to the negotiated protection method.
A MCData client which receives signed media information or signed and
protected media information shall verify the signature by using the signature,
the identity of the originating MCData client and the KPAK provisioned by the
KMS.
A MCData client transmitting media control information shall protect the media
control information using CPK and CPK-ID if media control information
protection is negotiated.
A MCData client which receives protected media control information shall
decrypt and check the integrity of the protected media control information
using CPK and CPK-ID.
### 10.3.3 The participating MCData function
A participating MCData function which receives protected media information
shall forward it to the next entity without any additional action related to
the security framework.
A participating MCData function, when receiving a protected media control
information from a MCData client shall decrypt and integrity check the
protected media control using the CSK and CSK-ID negotiated with the MCData
client which has sent the media control. Then, the participating MCData
function shall forward the media control information to the controlling MCData
function by protecting the media control information using SPK and SPK-ID, if
protection is configured between the participating MCData function and the
controlling MCData function.
A participating MCData function, when receiving a protected media control
information from the controlling MCData function shall decrypt and integrity
check the protected media control information using the SPK and SPK-ID
configured between the participating MCData function and the controlling
MCData function. Then, the participating MCData function shall forward the
media control information to the destination MCData client by protecting the
media control information using the CSK and CSK-ID if protection is negotiated
between the participating MCData function and the MCData client.
### 10.3.4 The controlling MCData function
A controlling MCData function which receives protected media information shall
forward it to the next entity without any additional action related to the
security framework.
A controlling MCData function, when receiving a protected media control
information from a participating MCData function shall decrypt and integrity
check the protected media control information using the SPK and SPK-ID
configured between the participating MCData function and the controlling
MCData function. Then, the controlling MCData function shall forward the media
control information to the participating MCData function serving the
destination MCData client by protecting the media control information using
SPK and SPK-ID, if protection is configured between the participating MCData
function and the controlling MCData function.
#
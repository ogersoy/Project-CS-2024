# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
During any phase of a voice or video call, the Online Charging System (OCS)
may need to deliver billing/charging in-session notifications to the end user
via announcements as part of the rating, balance management and billing
process. For example, the OCS may need to inform the user about usage states,
threshold crossings, offer statuses, reason for call rejection, alerts about
low balances, etc.
In Circuit Switched (CS) domain, online charging of a voice session is
performed using Customised Applications for Mobile network Enhanced Logic
(CAMEL) mechanisms. In order to deliver in-session notifications or to
interact with the end user, OCS can use CAMEL messages such as: Play
Announcement, Prompt and Collect, Connect to Resource, Establish Temporary
Connection. Such notifications can be delivered pre-, mid- or post-call.
However, in IMS and MMTel charging defined in TS 32.260 [20] and TS 32.275
[35] as well as in Diameter Credit-Control Application (DCCA) defined in RFC
4006 [402], announcement capabilities, available at the OCS level, are limited
to redirection of a session to a given SIP URI at completion of the session.
When redirected the session may be connected to a resource that delivers an
announcement.
The Announcement service in this specification provides announcement
capabilities for use in a Diameter based online charging session. The OCS is
able to specify that a given announcement be played to a call party in order
to deliver charging/billing related notifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging Architecture and Principles\".
[2] -- [9] Void
[10] 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
[11] -- [19] Void
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] -- [29] void
[30] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[31] - [34] void
[35] 3GPP TS 32.275: \"Telecommunication management; Charging management;
MultiMedia Telephony (MMTel) charging\".
[36] - [49] Void
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] - [99] Void
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] - [200] Void.
[201] -[203] Void.
[204] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[205] - [243] Void.
[244] 3GPP TS 24.628: \"Common Basic Communication procedures using IP
Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".
[245] - [299] Void.
[300] - [401] Void.
[402] IETF RFC 4006 (2005): \"Diameter Credit-Control Application\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**CAMEL:** network feature that provides the mechanisms to support operator
specific services even when roaming outside HPLMN.
**circuit switched domain:** domain within GSM / UMTS in which information is
transferred in circuit switched mode.
**Credit-Control:** mechanism which directly interacts in real-time with an
account and controls or monitors the charges, related to the service usage.
Credit-Control is a process of: checking if credit is available, credit
reservation, deduction of credit from the end user account when service is
completed and refunding of reserved credit not used.
**online charging:** charging mechanism where charging information can affect,
in real-time, the service rendered and therefore a direct interaction of the
charging mechanism with bearer/session/service control is required.
**Online Charging System:** the entity that performs real-time Credit-Control.
Its functionality includes transaction handling, rating, online correlation
and management of subscriber accounts/balances.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Symbol format
Cr Reference Point between an AS and an MRFC for media control.
ISC Reference Point between a CSCF and an Application Server and between a
CSCF and an MRB.
Mp Reference Point between an MRFC and an MRFP.
Mr Reference Point between an CSCF and an MRFC.
Mr′ Reference Point between an AS and an MRFC for session control.
Ro Online Charging Reference Point between an AS, MRFC or the IMS-GWF and the
OCS
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[100] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in TR 21.905 [100].
AS Application Server
CAMEL Customised Applications for Mobile network Enhanced Logic
CCA Credit-Control-Answer
CCR Credit-Control-Request
CS Circuit Switched
CSCF Call Session Control Function (I-Interrogating; P-Proxy; and S-Serving)
DCCA Diameter Credit-Control Application
IMS-GWF IMS Gateway Function
ISC IMS Service Control
MMTel MultiMedia Telephony
MRB Media Resource Broker
MRFC Media Resource Function Controller
MRFP Multimedia Resource Function Processor
OCS Online Charging System
SIP _Session Initiation Protocol_
UE User Equipment
# 4 Architecture considerations
## 4.1 High level Announcement aspects
Each technology to which the Announcement service is applied will utilize a
technology-specific special resource function to play announcement media. Each
of the architectures described in this clause utilizes the common Announcement
service specified in this document.
## 4.2 Announcement in IP Multimedia Subsystem (IMS) architecture
The MRFC/MRFP are resources of the IMS that provide support for bearer related
services such as announcements. Collectively, the MRFC/MRFP is known as the
Media Resource Function. The architecture of MRF is shown in figure 4.2.1.
Figure 4.2.1: Architecture of Media Resource Function in IMS
In the IMS online charging architecture specified in TS 32.260 [20], both the
AS and the IMS-GWF have Ro interfaces to the OCS and are connected to the
S-CSCF via the ISC reference point. Either the AS or the IMS-GWF may utilize
the Announcement service specified in this document.
# 5 Announcement principles and flows
## 5.1 Common announcement principles
The OCS may provide information in charging messages over the Ro reference
point that describe announcements to be played to a subscriber. When receiving
announcement information provided by the OCS, the receiving node shall use the
procedures defined for the specific technology in use. The clauses that follow
identify the principles and message flows applicable to each specific
technology to which the common Announcement service is applied.
## 5.2 Announcement in IMS
### 5.2.1 Basic principles and definitions
The OCS may provide information in charging messages over the Ro reference
point that describe video or audio announcements which can be rendered to a
subscriber involved in an IMS session at different stages of interactions with
OCS.
When receiving announcement information provided by OCS, the AS or the IMS-GWF
shall use the procedures defined in clause 10.2.2 of TS 24.229 [204] and TS
24.628 [244] in order to deliver the required announcement in accordance with
the provided announcement information.
OCS can provide announcement information upon interaction with the AS or the
IMS-GWF, during different phases of an IMS session:
\- At IMS session initiation, before the IMS session is allowed to continue
and no quota is granted, or before the IMS session is allowed to continue and
use granted quota;
\- During an ongoing established IMS session, with media components between
the parties of the session, on quota allocation control process;
\- At an IMS session termination due to final quota consumption.
Announcements provided by OCS are driven by quota allocation during the IMS
session, and controlled by an indication on when they shall be played:
\- Pre-quota announcement shall be played prior to any quota consumption (i.e.
immediately);
\- Mid-quota announcements shall be played at a specified duration before
granted quota is exhausted, which ranges from non-zero value smaller than the
granted quota.
\- Post-quota announcements shall be played upon granted quota exhaustion
OCS can provide information for one or more announcements in the same charging
message.
An OCS-provided announcement is delivered to a single party of an IMS session.
OCS indicates to which party the announcement shall be played. This can be the
served party or the remote party. When the privacy indicator for the
announcement is set to \"private\", the announcement shall be played only to
the requested party. The handling toward the other party during announcement
playback is determined by the AS or the IMS-GWF internal logic.
The AS or the IMS-GWF shall control delivery of the announcements based on the
announcement content information provided by the OCS. The AS or the IMS-GWF
shall use the procedures in TS 24.628 [244] for announcement delivery. When
the AS or the IMS-GWF are separate from the MRFC, the AS or the IMS-GWF shall
support one or more of the control methods for announcement referenced in
clause 10.2.2 of TS 24.229 [204], regardless of the announcement content
information provided by the OCS. The AS or the IMS-GWF is responsible for
determining the MRF handling the announcement.
Announcement information indicates whether any of the granted quota shall be
used by the AS or the IMS-GWF during the time the announcement is connected.
If not explicitly indicated in the announcement information by the OCS, it is
up to the service logic implemented in the AS or the IMS-GWF to use or not the
granted quota.
For announcements delivered by the AS or the IMS-GWF during an IMS established
session, the existing media shall be suspended while the announcement media is
played.
### 5.2.2 Message flows and types for online charging
The following figures show the Reserve Units transactions that are required
between the IMS-GWF/AS and the OCS for session-related IMS procedures when the
Announcement service is invoked.
The SIP messages and Charging Data transactions associated with these charging
scenarios are shown primarily for general information and to illustrate the
charging triggers. They are not intended to be exhaustive and they depend on
the Reserve Units Request triggers configured by the operator.
All of the scenarios depict originating sessions only.
**Scenario 1: Pre-quota announcement with successful session establishment**
Figure 5.2.2.1 shows the Reserve Units transactions that are required in the
IMS-GWF/AS during a SIP session establishment for which a pre-quota
announcement is requested with successful session establishment.
Figure 5.2.2.1: Message sequence chart for pre-quota announcement with
successful session establishment
1) An initial SIP Invite Request is received in the S-CSCF. This request is
forwarded to the IMS-GWF/AS.
2) The IMS-GWF/AS sends a Reserve Units Request[Initial] to the OCS requesting
service units. The online Credit-Control session is initiated.
3) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result and requests an announcement to be
played to the calling party immediately. Announcement information may indicate
whether or not the granted quota for the IMS session shall be used for playing
the announcement.
3a) The IMS-GWF/AS establishes a SIP session between the calling party and an
MRFC/MRFP for the requested announcement as per TS 24.628 [244] and TS 24.229
[204].
3b) The MRFP plays the announcement to the calling party.
3c) When the announcement is complete, the IMS-GWF/AS disconnects the SIP
session with the MRFC/MRFP as per TS 24.628 [244] and TS 24.229 [204].
4) The IMS-GWF/AS and S-CSCF forward the initial SIP INVITE.
5) A final response is received in the IMS-GWF/AS.
6) If the trigger is active, the SIP 200 OK answer triggers a Reserve Units
Request[Update] in the IMS-GWF/AS in order to update the Credit-Control
session. New service units are requested in a Multiple Unit Operation. Also
the used service units (if any) are reported in the Multiple Unit Operation.
If the indication in step 3 is to use the granted quota then the quota usage
allocated for playing the announcement shall be reported by the IMS-GWF/AS to
the OCS in the used service units.
7) The OCS sends the Reserve Units Response to acknowledge the Reserve Units
Request. New service units are granted in a Multiple Unit Operation.
8) The final answer is forwarded.
**Scenario 2: Pre-quota announcement with session termination**
Figure 5.2.2.2 shows the Reserve Units transactions that are required in the
IMS-GWF/AS during a SIP session establishment for which a pre-quota
announcement is requested with the termination of the session.
Figure 5.2.2.2: Message sequence chart for pre-quota announcement with session
termination
1) An initial SIP Invite Request is received in the S-CSCF. This request is
forwarded to the IMS-GWF/AS.
2) The IMS-GWF/AS sends a Reserve Units Request[Initial] to the OCS requesting
service units. The online Credit-Control session is initiated.
3) The OCS rejects the session in the Reserve Units Response with an
unsuccessful Operation Result and requests an announcement to be played to the
calling party immediately. No quota is used during the announcement playback
when the SIP session is to be terminated.
3a) The IMS-GWF/AS establishes a SIP session between the calling party and an
MRFC/MRFP for the requested announcement as per TS 24.628 [244] and TS 24.229
[204].
3b) The MRFP plays the announcement to the calling party.
3c) When the announcement is complete, the IMS-GWF/AS disconnects the SIP
session with the MRFC/MRFP as per TS 24.628 [244] and TS 24.229 [204].
4) The IMS-GWF/AS and S-CSCF releases the session with a SIP BYE that is
forwarded by the S-CSCF towards the calling party. The message sequence shown
here assumes that the announcement playback established a SIP dialog with the
calling party in Step 3a. For other variations of SIP session termination for
use when announcement playback utilized signalling for early media, see Annex
B of TS 32.260 [20].
5) A final response is forward by the S-CSCF to the IMS-GWF/AS.
**Scenario 3: Mid-quota announcement during IMS session**
Figure 5.2.2.3 shows the Reserve Units transactions that are required in the
IMS-GWF/AS for a mid-quota announcement during an established IMS session,
followed by session continuation.
Figure 5.2.2.3: Message sequence chart for mid-quota announcement during IMS
session
1) During an ongoing SIP session, a charging trigger encountered for an update
as per table 5.3.1.1 in TS 32.260 [20]. The IMS-GWF/AS sends a Reserve Units
Request[Update] to the OCS requesting service units.
2) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result and requests an announcement to be
played to the calling party prior to quota exhaustion. Announcement
information may indicate whether or not the granted quota for the IMS session
shall be used for playing the announcement. The announcement is indicated as
to be played to a specified duration before the end of the quota is reached.
2a) When the timing conditions are met for the requeted announcement, the IMS-
GWF/AS establishes a SIP session between the calling party and an MRFC/MRFP
for the requested announcement as per TS 24.628 [244] and TS 24.229 [204].
2b) The MRFP plays the announcement to the calling party.
2c) When the announcement is complete, the IMS-GWF/AS re-connects the called
party, disconnecting the SIP session with the MRFC/MRFP as per TS 24.628 [244]
and TS 24.229 [204].
**Scenario 4: Post-quota announcement with IMS session termination**
Figure 5.2.2.4 shows the Reserve Units transactions that are required in the
IMS-GWF/AS for a post-quota announcement which is initiated at final quota
exhaust.
Figure 5.2.2.4: Message sequence chart for post-quota announcement with IMS
session termination
1) During an ongoing SIP session, a charging trigger encountered for an update
as per table 5.3.1.1 in TS 32.260 [20]. The IMS-GWF/AS sends a Reserve Units
Request[Update] to the OCS requesting service units.
2) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result, a final unit indication and a
request for an announcement to be played when the quota is exhausted. Granted
quota shall not be used for an announcement playback at final quota exhaust.
3) When end of quota is reached, the IMS-GWF/AS initiates session termination
to the called party by sending a SIP BYE message which is forwarded by the
S-CSCF.
4) The final answer to the SIP BYE message is forwarded by the S-CSCF to the
IMS-GWF/AS ending the SIP dialog with the called party. The IMS-GWF/AS does
not wait for this response before continuing the message sequence.
5a) The IMS-GWF/AS establishes a SIP session between the calling party and an
MRFC/MRFP for the requested announcement as per TS 24.628 [244] and TS 24.229
[204].
5b) The MRFP plays the announcement to the calling party.
5c) When the announcement is complete, the IMS-GWF/AS disconnects the SIP
session with the MRFC/MRFP as per TS 24.628 [244] and TS 24.229 [204].
6) The IMS-GWF/AS initiates session termination to the calling party by
sending a SIP BYE message which is forwarded by the S-CSCF.
7) The IMS-GWF/AS sends a Reserve Units Request[Terminate] reporting the used
service units in a Multiple Unit Operation.
8) The OCS sends a Reserve Units Response. The online Credit-Control session
is terminated.
9) The final answer to the SIP BYE message is forwarded by the S-CSCF to the
IMS-GWF/AS ending the SIP dialog.
**Scenario 5: Combined pre- and post-quota announcements with IMS session
termination**
Figure 5.2.2.5 shows the Reserve Units transactions that are required in the
IMS-GWF/AS during a SIP session establishment for which a pre-quota
announcement is requested at IMS session initiation along with a post-quota
announcement to be played at final quota exhaust.
Figure 5.2.2.5: Message sequence chart for combined pre- and post-quota
announcement with IMS session termination
1) An initial SIP Invite Request is received in the S-CSCF. This request is
forwarded to the IMS-GWF/AS.
2) The IMS-GWF/AS sends a Reserve Units Request[Initial] to the OCS requesting
service units. The online Credit-Control session is initiated.
3) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result and a final unit indication. The
OCS requests an announcement to be played immediately and an announcement to
be played at the final end of quota. Only the announcement information for the
immediate announcement may indicate to use granted quota for the announcement
playback.
3a) The IMS-GWF/AS establishes a SIP session between the calling party and an
MRFC/MRFP for the requested announcement as per TS 24.628 [244] and TS 24.229
[204].
3b) The MRFP plays the announcement to the calling party.
3c) When the announcement is complete, the IMS-GWF/AS disconnects the SIP
session with the MRFC/MRFP as per TS 24.628 [244] and TS 24.229 [204].
4) The IMS-GWF/AS and S-CSCF forward the initial SIP INVITE.
5) A final response is received in the IMS-GWF/AS.
6) The final answer is forwarded.
7) When end of quota is reached, the IMS-GWF/AS initiates session termination
to the called party by sending a SIP BYE message which is forwarded by the
S-CSCF.
8) The final answer to the SIP BYE message is forwarded by the S-CSCF to the
IMS-GWF/AS ending the SIP dialog with the called party. The IMS-GWF/AS does
not wait for this response before continuing the message sequence.
9a) The IMS-GWF/AS establishes a SIP session between the calling party and an
MRFC/MRFP for the requested announcement as per TS 24.628 [244] and TS 24.229
[204].
9b) The MRFP plays the announcement to the calling party.
9c) When the announcement is complete, the IMS-GWF/AS disconnects the SIP
session with the MRFC/MRFP as per TS 24.628 [244] and TS 24.229 [204].
10) The IMS-GWF/AS initiates session termination to the calling party by
sending a SIP BYE message which is forwarded by the S-CSCF.
11) The IMS-GWF/AS sends a Reserve Units Request[Terminate] reporting the used
service units in a Multiple Unit Operation. If the indication in step 3 is to
use the granted quota for the announcement playback then the quota usage for
playing the announcement shall be reported by the IMS-GWF/AS to the OCS in the
used service units. This is applicable only for an announcement initiated
prior to end of granted quota.
12) The OCS sends a Reserve Units Response. The online Credit-Control session
is terminated.
13) The final answer to the SIP BYE message is forwarded by the S-CSCF to the
IMS-GWF/AS ending the SIP dialog.
**Scenario 6: Combined mid- and post-quota announcements with IMS session
termination**
Figure 5.2.2.6 shows the Reserve Units transactions that are required in the
IMS-GWF/AS for a mid-quota announcement prior to final quota exhaust. An
example would be to play a low balance warning tone to the calling party
before the end of the call and then play a terminating announcement reminding
the user to top up the account.
Figure 5.2.2.6: Message sequence chart for combined mid- and post-quota
announcements with IMS session termination
1) During an ongoing SIP session, a charging trigger encountered for an update
as per table 5.3.1.1 in TS 32.260 [20]. The IMS-GWF/AS sends a Reserve Units
Request[Update] to the OCS requesting service units.
2) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result and a final unit indication. The
OCS requests an announcement to be played a specified number of seconds prior
to end of quota and an announcement to be played at the final end of quota.
Only the announcement information for the announcement prior to end of quota
may indicate to use granted quota for the announcement playback.
2a) When the time prior to end of quota is reached, the IMS-GWF/AS establishes
a SIP session between the calling party and an MRFC/MRFP for the requested
announcement as per TS 24.628 [244] and TS 24.229 [204].
2b) The MRFP plays the announcement to the calling party.
2c) When the announcement is complete, the IMS-GWF/AS re-connects the called
party, disconnecting the SIP session with the MRFC/MRFP as per TS 24.628 [244]
and TS 24.229 [204].
3) When end of quota is reached, the IMS-GWF/AS initiates session termination
to the called party by sending a SIP BYE message which is forwarded by the
S-CSCF.
4) The final answer to the SIP BYE message is forwarded by the S-CSCF to the
IMS-GWF/AS ending the SIP dialog with the called party. The IMS-GWF/AS does
not wait for this response before continuing the message sequence.
5a) The IMS-GWF/AS establishes a SIP session between the calling party and an
MRFC/MRFP for the requested announcement as per TS 24.628 [244] and TS 24.229
[204].
5b) The MRFP plays the announcement to the calling party.
5c) When the announcement is complete, the IMS-GWF/AS disconnects the SIP
session with the MRFC/MRFP as per TS 24.628 [244] and TS 24.229 [204].
6) The IMS-GWF/AS initiates session termination to the calling party by
sending a SIP BYE message which is forwarded by the S-CSCF.
7) The IMS-GWF/AS sends a Reserve Units Request[Terminate] reporting the used
service units in a Multiple Unit Operation. If the indication in step 2 is to
use the granted quota then the quota usage for playing the announcement shall
be reported by the IMS-GWF/AS to the OCS in the used service units. This is
applicable only for an announcement initiated prior to end of granted quota.
8) The OCS sends a Reserve Units Response. The online Credit-Control session
is terminated.
9) The final answer to the SIP BYE message is forwarded by the S-CSCF to the
IMS-GWF/AS ending the SIP dialog.
**Scenario 7: Announcement handling subsequent to a Re-Auth-Request**
**Figure 5.2.2.7: Message sequence chart for of announcement handling
subsequent to Re-Auth-Request message**
1) During an ongoing SIP session, a charging trigger encountered for an update
as per table 5.3.1.1 in TS 32.260 [20]. The IMS-GWF/AS sends a Reserve Units
Request[Update] to the OCS requesting service units.
2) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result and requests an announcement to be
played to the calling party. Announcement information may indicate whether or
not the granted quota for the IMS session shall be used for playing the
announcement. A timing indicator is provided that can indicate the
announcement be played immediately or delayed to a specified number of seconds
before the end of the quota is reached.
3) As a result of an external event (e.g. recharge activity), the OCS decides
that announcement needs to be cancelled.
4) The OCS sends a Re-Auth-Request to the IMS-GWF/AS requesting to perform new
Reserve Units Request.
5) The IMS-GWF/AS sends a Re-Auth-Answer response to the OCS.
6) The IMS-GWF/AS sends a Reserve Units Request[Update] to the OCS requesting
service units.
7) The OCS grants units in a Multiple Unit Operation of the Reserve Units
Response with a successful Operation Result (with or without request for
announcement). This cancels any pending announcement related to the previous
granted quota.
# 6 Definition of Announcement Information
## 6.1 Announcement Information principles
The following principles apply to the Announcement Information used to support
the Announcement service:
\- A set of Announcement Information elements may be provided within a
Multiple Unit Operation element in a _Debit and Reserve Units Response_
message.
\- When a _Debit and Reserve Units Response_ message is received, all
previously received Announcement Information elements are discarded.
\- When a _Debit and Reserve Units Response_ message is received while an
announcement is being played, whether the user is disconnected from the
announcement is determined by the logic in the receiving node.
\- An Announcement Identifier shall be provided within each Announcement
Information element to identify the announcement to be played. When the
specified announcement includes variable parts, the Variable Part Sequence
information element shall be provided with the order, type, and value of each
variable required for the announcement. The following types are supported:
Integer, Number, Time, Date, Currency.
\- Each Announcement Information element contains a Time Indicator. It
indicates the specified time before the granted quota is exhausted at which
the announcement is to be played. The specified time ranges from zero to any
value smaller than the granted quota. A value of zero means: at the time the
quota is exhausted, and absence of the indicator means that the announcement
is to be played before the session is allowed to continue.
\- When a Final Unit Indication with the granted quota and an Announcement
Information element with Time Indicator with a value of zero are received, the
announcement is to be played upon quota exhaust prior to processing the Final
Unit Action received within the Final Unit Indication.
\- When there are multiple Announcement Information elements with the same
Time Indicator, an Announcement Order shall be provided that indicates the
order in which announcements shall be played.
\- Within each Announcement Information element is a Quota Indicator
indicating whether the granted quota shall be deducted during announcement
setup and playback or if the quota usage is suspended while the announcement
is setup and played back and absence of the information element indicates that
the logic implemented in the receiving node determines whether to use or not
the granted quota.
\- When a Final Unit Indication with the granted quota and an Announcement
Information element with a non-zero or absent Time Indicator and a Quota
Indicator indicating deduction of quota required during announcement are
received, the user shall be disconnected from the announcement if the
announcement is still being played when final quota exhausts.
\- Within each Announcement Information element is a Play Alternative
identifying either the \"served party\" or the \"remote party\" to which the
announcement is to be played and absence of the information element indicates
that the announcement is to be played to the \"served party\".
\- Within each Announcement Information element is a Privacy Indicator
identifying either that the announcement is private and shall be played only
to the party identified by the Play Alternative or that the announcement is
not private. Absence of the information element indicates that the
announcement is private.
\- Within each Announcement Information element, there may be a Language
information element indicating the language of the announcement that shall be
played and absence of the information element indicates that the default
language shall be used as per the receiving node.
## 6.2 Announcement data definition
### 6.2.1 Multiple Unit Operation contents for Announcement service
The components in the Multiple Unit Operation that are used for Announcement
service can be found in Table 6.2.1.1.
Table 6.2.1.1: Multiple Unit Operation contents for Announcement service
+--------------------------+----------+----------------------------+ | Information Element | Category | Description | +--------------------------+----------+----------------------------+ | Multiple Unit Operation | O~M~ | Described in TS 32.299 | | | | [50]. | +--------------------------+----------+----------------------------+ | Announcement Information | O~C~ | This is a structured field | | | | and holds the Announcement | | | | service parameters. It is | | | | a grouped information | | | | element and may appear | | | | multiple times, once per | | | | announcement to be played. | | | | | | | | The details are defined in | | | | clause 6.2.2. | +--------------------------+----------+----------------------------+
### 6.2.2 Definition of Announcement Information
Announcement Information is provided within the Multiple Unit Operation.
The detailed structure of the Announcement Information can be found in table
6.2.2.1.
Table 6.2.2.1: Structure of the Announcement Information
+-------------------------+----------+----------------------------+ | Information Element | Category | Description | +-------------------------+----------+----------------------------+ | Announcement Identifier | O~M~ | A code identifying the | | | | announcement to be played. | +-------------------------+----------+----------------------------+ | Variable Part Sequence | O~C~ | Sequence of elements | | | | specifying each variable | | | | part (order, type, and | | | | value) to be played back | | | | during the announcement. | | | | The following types are | | | | supported: Integer, | | | | Number, Time, Date, | | | | Currency. | +-------------------------+----------+----------------------------+ | Time Indicator | O~C~ | Instructs the announcement | | | | to be connected at the | | | | specified time before | | | | granted quota is | | | | exhausted, which ranges | | | | from zero to a value | | | | smaller than the granted | | | | quota. | | | | | | | | A value of zero means at | | | | the time quota is | | | | exhausted. Absence of this | | | | field indicates that the | | | | announcement is to be | | | | played before the IMS | | | | session is allowed to | | | | continue. | +-------------------------+----------+----------------------------+ | Quota Indicator | O~C~ | Indicates whether the | | | | granted quota should be | | | | deducted during | | | | announcement setup and | | | | playback or if the quota | | | | usage is suspended while | | | | the announcement is setup | | | | and played back. If not | | | | explicitly indicated it is | | | | up to the logic | | | | implemented in the | | | | receiving node to use or | | | | not the granted quota. | +-------------------------+----------+----------------------------+ | Announcement Order | O~C~ | When multiple announcement | | | | information blocks are | | | | provided in a single | | | | message with the same | | | | timing indicator, the | | | | announcement order | | | | indicates the order in | | | | which announcements should | | | | be connected for playback. | +-------------------------+----------+----------------------------+ | Play Alternative | O~C~ | Identifies either the | | | | \"served party\" or the | | | | \"remote party\" to which | | | | the announcement is to be | | | | played. | +-------------------------+----------+----------------------------+ | Privacy Indicator | O~C~ | Identifies if the | | | | announcement is | | | | \"private\" or \"not | | | | private\". | +-------------------------+----------+----------------------------+ | Language | O~C~ | A language code indicating | | | | the language of the | | | | announcement that should | | | | be played. | +-------------------------+----------+----------------------------+
### 6.2.3 Formal Announcement Information parameter description
The detailed Announcement Information parameter definitions are specified in
TS 32.299 [50].
## 6.3 Bindings for Announcement Information
This clause describes the mapping between the information elements and
messages described for Announcement service and the Diameter messages and
AVPs.
As defined in TS 32.299 [50], the corresponding Diameter Credit-Control
Application (DCCA) commands for the _Debit and Reserve Units Request_ message
is Credit-Control-Request (CCR) and for the _Debit and Reserve Units Response_
message is Credit-Control-Answer (CCA).
Table 6.3.1 specifies the bindings for parameters used for Announcement
service for the _Debit and Reserve Units_ operation.
Table 6.3.1: Bindings between Information Elements and AVPs
* * *
Information Element AVP Announcement Information Announcement-Information
Announcement Identifier Announcement-Identifier Variable Part Sequence
Variable-Part Time Indicator Time-Indicator Quota Indicator Quota-Indicator
Announcement Order Announcement-Order Play Alternative Play-Alternative
Privacy Indicator Privacy-Indicator Language Language
* * *
#
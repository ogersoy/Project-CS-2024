# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document studies forward compatibility for 3GPP Charging
Applications over Rf and Ro Reference Points, specified by using IETF Diameter
protocol.
In particular, it will be investigated how to conform with TR 29.819 [413]
conclusion on Diameter extensibility rules, per following clause 5.3.1.4
statement:
\" For 3GPP Diameter Accounting application using the Diameter Base Protocol
Accounting (application Id =3), such as specified in the 3GPP TS 32.299 [16],
further studies are required to evaluate how AVPs can be added to existing
commands with the M-bit cleared to avoid backward compatible issues. \"
This study is independent of whether IETF RFC 3588 [401] or IETF RFC 6733
[412] is refered to as the Diameter Base protocol for Rf and Ro. Update from
IETF RFC 3588 [401] to IETF RFC 6733 [412] can be decided prior to any
conclusion from this study.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] - [10] Void.
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] Void.
[13] 3GPP TS 32.253: \"Telecommunication management; Charging management;
Control Plane (CP) data transfer domain charging\".
[14] - [19] Void.
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] - [29] Void.
[30] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[31] 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
[32] 3GPP TS 32.272: \"Telecommunication management; Charging management;
Push-to-talk over Cellular (PoC) charging\".
[33] 3GPP TS 32.273: \"Telecommunication management; Charging management;
Multimedia Broadcast and Multicast Service (MBMS) charging\".
[34] 3GPP TS 32.274: \"Telecommunication management; Charging management;
Short Message Service (SMS) charging\".
[35] 3GPP TS 32.275: \"Telecommunication management; Charging management;
MultiMedia Telephony (MMTel) charging\".
[36] 3GPP TS 32.276: \"Telecommunication management; Charging management;
Voice Call Service Charging\".
[37] 3GPP TS 32.277: \"Telecommunication management; Charging management;
Proximity-based Services (ProSe) Charging\".
[38] 3GPP TS 32.278: \"Telecommunication management; Charging management;
Monitoring Event charging\".
[39] Void.
[40] 3GPP TS 32.280: \"Telecommunication management; Charging management;
Advice of Charge (AoC) service\".
[41] 3GPP TS 32.281: \"Telecommunication management; Charging management;
Announcement service\".
[42] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51- [52] Void.
[53] 3GPP TS 32.296: \"Telecommunication management; Charging management;
Online Charging System (OCS) applications and interfaces\".
[54 - 55] Void.
[56] 3GPP TS 32.293: \"Telecommunication management; Charging management;
Proxy Function\".
[57] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102-199] Void.
[200-299] Void.
[300-399] Void.
[400] Void.
[401] IETF RFC 3588 (2003): \"Diameter Base Protocol\".
[402] IETF RFC 4006 (2005): \"Diameter Credit-Control Application\".
[403] - [411] Void.
[412] IETF RFC 6733: \"Diameter Base Protocol\".
[413] TR 29.819 Study on Impacts of the Diameter Base Protocol Specification
Update.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Gy Online charging reference point between a PCEF and an OCS.
Gyn Online charging reference point between a TDF and an OCS.
Gz Offline charging reference point between a PCEF and an OFCS.
Gzn Offline charging reference point between a TDF and an OFCS.
Rf Offline charging reference point between a 3G network element and the CDF.
Ro Online charging reference point between a 3G network element and the OCS.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
> AVP Attribute Value Pair
>
> DCCA Diameter Credit-Control Application
>
> IE Information Element
# 4 3GPP Charging Applications forward compatibility
## 4.1 3GPP Charging Applications and mandatory concept
### 4.1.1 High level Charging requirements
In TS 22.115 [101], the high level principles for the charging requirements
are stated as \"It shall be possible to charge...\" identifying the required
criteria to be considered. The charging mechanisms have therefore been
specified to mandate necessary information (matching the criteria) to be
available in CDRs (offline charging) and OCS (online charging), for complying
with these requirements.
­­­­As part of the mechanisms, category has been defined, and it is further
detailed how this category concept applies within the whole charging
framework, focusing on Rf/Ro Reference Points as they use the IETF Diameter
protocol.
One of the key assumption is: CDF and OCS addresses allocation mechanisms are
kept unchanged, therefore CDF and OCS addresses which are allocated to the UE
for the transaction (IMS session, IP-CAN session, SMS...) cannot be changed
during this transaction.
### 4.1.2 Charging TSs structure
How Charging TSs are organized (the complete structure is defined in TS 32.240
[1]), is essential to interpret the category for an information, and it is
summarized below:
A set of domain/subsystem/service specific charging stage 2 TSs (referred to
as the middle tier charging TSs) covers:
  * the bearer (CS, PS, CP Data Transfer domains) level in the TS 32.25x;
  * the subsystem (IMS) level in the TS 32.26x;
  * the service (MMS, LCS, PoC, MBMS, SMS, MMTel, ProSe, Monitoring Event, etc.) levels, in the TS 32.27x;
  * common services (Advice of Charge, Announcement) in the TS 32.28x.
The TSs 32.29x range stage 3 cover common aspects, one of those is the TS
32.299 [50], which specifies the Diameter based 3GPP online and offline
charging applications, when applicable (i.e. not all the stage 2 Charging TSs
have Rf/Ro applicable), and therefore owns the Diameter part description.
### 4.1.3 Information Element -- Category per middle Tier TS
#### 4.1.3.1 Category definition
In order to meet the high level requirements as mentioned in clause 4.1.1,
category settings are specified per stage 2 TSs (i.e. for the corresponding
service) for Information Elements (IE) and CDRs fields.
The categories are defined in clause 5.4 of TS 32.240 [1] and copied below:
> \"**M** This parameter is **M** andatory and shall always be present in the
> event / CDR.
>
> **C** This parameter shall be present in the event / CDR only when certain
> Conditions are met. These Conditions are specified as part of the parameter
> definition.
>
> **OM** This is a parameter that, if provisioned by the operator to be
> present, shall always be included in the events CDRs. In other words, an OM
> parameter that is provisioned to be present is a mandatory parameter.
>
> **OC** This is a parameter that, if provisioned by the operator to be
> present, shall be included in the events / CDRs when the specified
> conditions are met. In other words, an OC parameter that is configured to be
> present is a conditional parameter. \"
#### 4.1.3.2 IE Category and charging architecture
IEs are conveyed over Rf/Ro and their category apply to the CTF (Network
Element): i.e. on the sender side. There is no differentiation between Rf and
Ro for the category, from the CTF\'s perspective.
The CDF is the receiver side for Rf; CDR fields are also marked with category
which are applicable to the CDF behavior.
The receiver side for Ro is the OCS.
#### 4.1.3.3 Non-supported IE by receiver
Whatever the category **M** , **C** , **OM** or **OC** , they are specified,
per middle Tier TS, to mandate the CTF to send the IE (unconditionally, or
under conditions), or to prevent the CTF from sending the IE (unconditionally,
or under conditions).
IE category is a mean to control the IE to be sent, with the assumption this
IE will be processed by the receiver. This is explained in more details,
considering the different categories:
An IE with category M is mandatory to be sent by the CTF unconditionally, and
obviously, mandatory to be supported by the receiver.
An IE with category C is mandatory to be sent by the CTF when certain
conditions are met, therefore such IE is also mandatory to be supported by the
receiver, so the met conditions can be complied with (although it may not
always be possible for the receiver, to check this upon the IE reception).
An IE with category **OM** or **OC** is mandatory to be sent by the CTF under
the condition it is provisioned by the operator to be present unconditionally
or with conditions respectively. The provisioning in CTFs is expected to be
consistent with the support of IEs by the receivers (CDF/OCS): in that sense,
when provisioned in the CTF, they are mandatory to be supported by the
receiver, otherwise there is an inconsistency.
For an IE which is not specified by the middle Tier TS as applicable over
Ro/Rf (i.e. not part of corresponding \"Service Information\" definition),
when received corresponds to an error scenario (supported or not supported by
the receiver).
It can be summarized that in all cases an IE, is mandatory to be supported by
the receiver, when received in the context of a specific middle Tier TS. When
unexpected in the context of a specific middle Tier TS, it is also rejected,
although it could also be possible to be ignored per Operator policy.
### 4.1.4 3GPP Charging applications and Diameter
Since the introduction of Rf and Ro Reference points from 3GPP Rel-6, Diameter
has been the protocol used, by adoption of IETF Diameter Applications extended
with 3GPP-specific AVPs, i.e.:
\- IETF RFC 3588 [401] Diameter Base Protocol Accounting application
(application Id =3), for Rf.
\- IETF RFC 4006 [402] Diameter Credit-Control Application and Authentication
application (Auth-Application-Id = 4), for Ro.
This is specified in TS 32.299 [50], and the mapping of the stage 2 TSs to
this Diameter description is based on following principles:
\- \"Charging Data Request/Response messages contents\" common structure is
mapped to IETF RFC 3588 [401] ACR/ACA commands and AVPs for Rf.
\- \"Debit / Reserve Units Request/Response contents\" common structure is
mapped to IETF RFC 4006 [402] CCR/CCA commands and AVPs for Ro.
with the \"Operation Token\" IE mapped to \"Service-Context-Id\" AVP which
identifies the middle-tier TS where the message contents are specified along
with IEs and their category.
The mapping of IEs under the \"Service Information\" to Diameter AVPs is
either explicitly described under binding tables in middle tiers TSs (e.g.
\"SM Client Address\" IE in TS 32.274 table 6.3.1.2.1 is mapped to Client-
Address AVP per binding table 6.4.1 in same TS 32.274), either implicit by
adoption of similar names.
### 4.1.5 Non-supported Diameter AVP by receiver
The clause 4.1.3.3 summary is transposed to 3GPP Diameter Charging
applications description as follow:
In all cases an AVP, is mandatory to be supported by the receiver, when
received in the context of a specific \"Service-Context-Id\" (middle Tier TS).
When unexpected in the context of a specific \"Service-Context-Id\", it causes
the command rejection, although it could also be possible the AVP to be
ignored per Operator policy.
Support of an AVP in the context of a \"Service-Context-Id/Service
Information\" means the receiver is able to understand the content and to
process with the AVP under this context.
Before the AVP can be checked at the \"Service-Context-Id\" level:
\- it has to be successfully parsed and determined as defined for Rf/ACR
command, by the receiver supporting the Diameter base protocol and the 3GPP
Diameter Charging application Rf (application Id =3, and Service-Context-Id).
\- it has to be successfully parsed and determined as defined for Ro/CCR
command, by the receiver supporting the Diameter base protocol and the 3GPP
Diameter Charging application Ro (application Id =4, and Service-Context-Id).
On failure upon above check by the receiver (AVP not supported by the 3GPP
Diameter Charging application Rf/Ro), the selected and simplest approach is
rejection by the receiver.
By doing so, it is not possible for the few cases of \"unexpected\" AVPs per
\"Service-Context-Id\" to be able to be ignored based on Operator Policy
(instead of causing command rejection), since they are not passed to the
\"Service-Context-Id\" level for evaluation. On one side, this avoids extra-
processing by passing to the \"Service-Context-Id\" level each time at least
one AVP is found as not supported by the 3GPP Diameter Charging application
Rf/Ro, even for the case the decision is to reject the command. On the other
side, it does not allow the service to be able to continue by ignoring the
AVP.
### 4.1.6 Use of Diameter capability
#### 4.1.6.1 General principle
In order to achieve the IE Category setting to govern IE presence/absence per
middle Tier TSs and per 3GPP Diameter applications Rf/Ro, it was needed to use
Diameter appropriately.
#### 4.1.6.2 AVP ABNF syntax
In particular, it was needed to have most of the AVPs used by 3GPP Diameter
charging applications \"optional\" per ABNF syntax (i.e. with []), so that
corresponding IE category can override the ABNF syntax.
The few AVPs which are used as \"required\" AVP in the ABNF syntax (i.e. with
{} and \<>), are for most of them, inherited from IETF ACR/ACA, CCR/CCA common
structure, (e.g. { Origin-Host }), and it can be only category M for the
corresponding IE.
#### 4.1.6.3 M-bit setting
The selected approach to reject the command with an AVP identified by the
receiver as not supported by the 3GPP Diameter Charging application Rf/Ro
whatever under which \"Service-Context-Id\" this AVP is received, is achieved
by mandating the M-bit set for all AVPs used by 3GPP Diameter Charging
applications.
## 4.2 Key issue #1
### 4.2.1 Description
### 4.2.2 Current status
## 4.3 Key issue #2
### 4.3.1 Description
### 4.3.2 Current status
# 5 Solutions for Key issues
# 6 Conclusions and recommendations
# Annex \: Change history
+-------+-------+-------+-------+-------+-------+-------+-------+ | **C | | | | | | | | | hange | | | | | | | | | hist | | | | | | | | | ory** | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | **D | * |** T | * | ** | ** | **Su |** New | | ate**| *Meet | Doc** | _CR_ _| Rev_ _| Cat_ _| bject | vers | | | ing_ _| | | | | /Comm | ion_ _| | | | | | | | ent_ * | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 20 | SA5 | | | | | Ske | 0.1.0 | | 16-12 | #110 | | | | | leton | | | | | | | | | ( | | | | | | | | | S5-16 | | | | | | | | | 6233) | | | | | | | | | | | | | | | | | | S5-16 | | | | | | | | | 6342: | | | | | | | | | Scope | | | | | | | | | and | | | | | | | | | Refer | | | | | | | | | ences | | | | | | | | | | | | | | | | | | S5-16 | | | | | | | | | 6236: | | | | | | | | | C | | | | | | | | | lause | | | | | | | | | 3 | | | | | | | | | s | | | | | | | | | ymbol | | | | | | | | | and | | | | | | | | | abb | | | | | | | | | revia | | | | | | | | | tions | | | | | | | | | | | | | | | | | | S5-16 | | | | | | | | | 6343: | | | | | | | | | C | | | | | | | | | lause | | | | | | | | | 4.1 | | | | | | | | | 3GPP | | | | | | | | | Cha | | | | | | | | | rging | | | | | | | | | a | | | | | | | | | pplic | | | | | | | | | ation | | | | | | | | | and | | | | | | | | | mand | | | | | | | | | atory | | | | | | | | | co | |
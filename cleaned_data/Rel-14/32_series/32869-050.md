# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The objective is to study overload control mechanisms for Rc, Re, Rf and Ro
interfaces based on the conclusion of TR 29.809 [212].
For 3GPP Diameter Charging interfaces, the Diameter overload control mechanism
are based on the IETF Draft \"Diameter Overload Indication Conveyance\" that
defines the AVPs for the transport of overload information of Diameter
application as well as the basic behaviour of the Diameter endpoints receiving
this information.
The IETF RFC 7683 [404] is considered as the reference of this TR and not the
IETF Draft draft-ietf-dime-ovli-02 referenced by TR 29.809 [212].
As per TR 29.809 [212], the following conclusions apply and are not studied in
this TR:
\- How a reporting node determines it is entering into an overload condition
is implementation dependent.
\- How a reporting node determines the contents value of the overload report
(i.e. OC-OLR AVP) is implementation dependent.
\- How a reacting node achieves traffic reduction (i.e. selection of impacted
sessions) is implementation dependent.
The following issues are covered by the TR:
\- Application and/or modification of current failure handling functionality
defined in TS 32.299 [50] for Diameter online and offline charging in the
Charging Trigger Function when reacting to overload control indication from
the OCS or CDF, respectively.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging Architecture and Principles\".
[2] - [10] Void.
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] - [19] Void.
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] - [29] Void.
[30] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[31] 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
[32] 3GPP TS 32.272: \"Telecommunication management; Charging management;
Push-to-talk over Cellular (PoC) charging\".
[33] 3GPP TS 32.273: \"Telecommunication management; Charging management;
Multimedia Broadcast and Multicast Service (MBMS) charging\".
[34] 3GPP TS 32.274: \"Telecommunication management; Charging management;
Short Message Service (SMS) charging\".
[35] 3GPP TS 32.275: \"Telecommunication management; Charging management;
MultiMedia Telephony (MMTel) charging\".
[36] 3GPP TS 32.276: \"Telecommunication management; Charging management;
Voice Call Service Charging\".
[37] 3GPP TS 32.277: \"Telecommunication management; Charging management;
Proximity-based Services (ProSe) Charging\".
[38] 3GPP TS 32.278: \"Telecommunication management; Charging management;
Monitoring Event charging\".
[39] Void.
[40] 3GPP TS 32.280: \"Telecommunication management; Charging management;
Advice of Charge (AoC) service\".
[41] 3GPP TS 32.281: \"Telecommunication management; Charging management;
Announcement service\".
[42] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging applications\".
[51] - [52] Void.
[53] 3GPP TS 32.296: \"Telecommunication management; Charging management;
Online Charging System (OCS) applications and interfaces\".
[54] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] - [199] Void.
[200] - [211] Void.
[212] 3GPP TR 29.809: \"Study on Diameter overload control mechanisms\".
[213] - [299] Void.
[300] - [399] Void.
[400] Void.
[401] IETF RFC 6733 (2015): \"Diameter Base Protocol\".
[402] IETF RFC 4006 (2005): \"Diameter Credit-Control Application\".
[403] IETF RFC 7683 (2015): \"Diameter Overload Indication Conveyance \".
[404] - [499] Void.
[500] - [599] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**middle tier TS:** term used for the 3GPP charging TSs that specify the
domain / subsystem / service specific, online and offline, charging
functionality. These are all the TSs in the numbering range from TS 32.250 to
TS 32.27x, e.g. TS 32.250 [10] for the CS domain, or TS 32.270 [30] for the
MMS service. Currently, there is only one \"tier 1\" TS in 3GPP, which is the
TS 32.240 that specifies the charging architecture and principles. Finally,
there are a number of top tier TSs in the 32.29x numbering range ([50] ff)
that specify common charging aspects such as parameter definitions, encoding
rules, the common billing domain interface or common charging applications.
**offline charging:** charging mechanism where charging information **does
not** affect, in real-time, the service rendered
**online charging:** charging mechanism where charging information can affect,
in real-time, the service rendered and therefore a direct interaction of the
charging mechanism with session/service control is required
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Gy Online charging reference point between a PCEF and an OCS.
Gz Offline charging reference point between a PCEF and an OFCS.
Rf Offline Charging Reference Point between a 3G network element and the CDF.
Ro Online Charging Reference Point between a 3G network element and the OCS.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
ACA ACcounting-Answer
ACR ACcounting-Request
AS Application Server
ASA Abort-Session-Answer
ASR Abort-Session- Request
AVP Attribute Value Pair
CCA Credit-Control-Answer
CCR Credit-Control-Request
CDF Charging Data Function
CDR Charging Data Record
CEA Capabilities-Exchange-Answer
CER Capabilities-Exchange-Request
DBPA Diameter Base Protocol Accounting
DCCA Diameter Credit-Control Application
DCD Dynamic Content Delivery
DPA Disconnect-Peer-Answer
DPR Disconnect-Peer-Request
DWA Device-Watchdog-Answer
DWR Device-Watchdog-Request
ECUR Event Charging with Unit Reservation
FUI Final-Unit-Indication
GSU Granted-Service-Unit
IE Information Element
IEC Immediate Event Charging
MSCC Multiple Services Credit-Control
OCS Online Charging System
OFCS OFfline Charging System
RAA Re-Auth-Answer
RAR Re-Auth-Request
TDF Traffic Detection Function
# 4 Overview
## 4.1 Introduction
TR 29.809 [212] has investigated the possible Diameter-based mechanisms to
support overload control mechanisms in 3GPP core networks.
Two main activities have been addressed:
  * Identification of requirements for an improved overload control mechanism over Diameter based signaling interfaces used in 3GPP core networks;
  * Evaluations of the proposed IETF solutions to cover the requirements of Diameter overload control.
The TR 29.809 [212] concludes that the generic solution as currently defined
in the draft-ietf-dime-ovli-02, which is IETF RFC 7683 [403] is recommended as
the basis to perform overload control over 3GPP Diameter applications (see
clause 8.3.2 in TR 29.809 [212]). This solution provides a set of generic
Diameter AVPs that can be re-used over any Diameter application to transport
overload indication between Diameter endpoints. However, the exact solution to
implement will be decided per Diameter application, depending on the specific
requirements of each interface. Since the solution is application dependent
this study aims to investigate the solution applicable for the Charging
applications.
## 4.2 Problems and goals
The focus of the TR 29.809 [212] has been on the existing Diameter
applications Protocol Error \"DIAMETER_TOO_BUSY\" and
\"DIAMETER_UNABLE_TO_DELIVER\". The Protocol Error \"DIAMETER_TOO_BUSY\" is
used by the Diameter node to indicate that the specific server requested is
busy and unable to provide the requested service. When a Diameter agent (Relay
or Proxy) is in the path between the client and the server, the Diameter
client may receive from the agent the Protocol Error
\"DIAMETER_UNABLE_TO_DELIVER\" as answer to the request if there is no server
that can handle the request either due an overloaded or no response.
The default behaviour of the client relies only on the availability of
alternate peers to offload the requests when the primary server is overloaded.
A limitation with all the existing mechanisms is that the downstream Diameter
node can only react after overload happens, i.e. after overload is detected.
The TR 29.809 [212] points out that a mechanism for overload protection is
worth investigated and concludes that the generic solution as defined in the
IETF RFC 7683 [403] is recommended as the basis to perform overload control
over 3GPP Diameter applications (see clause 8.3.2 in TR 29.809 [212]). However
little guidance is provided on how to apply the DOIC (Diameter Overload
Indication Conveyance) mechanism for Diameter charging applications in TR
29.809 [212]. This will be investigated in this report.
# 5 Impacts of Diameter overload on 3GPP charging interfaces
## 5.1 Introduction
### 5.1.1 3GPP Diameter Charging Interfaces
The Offline Charging System terminates the Rf reference point as defined in TS
32.240 [1]. Other 3GPP specifications define additional reference points that
are functionally equivalent to the Rf reference point. These are the Gz
reference point for PCEF embedded in PGW and the Gzn reference point for TDF.
The Offline Charging System (OFCS) may be decomposed into Charging Data
Function (CDF) and the Charging Gateway Function (CGF) in which case, the CDF
provides the Diameter Accounting Application. Between the decomposed function
Diameter is not used. As defined in TS 32.240 [1], the network elements
connected to the OFCS by the Rf reference point, such as P-GW can be regarded
as Diameter client.
The Online Charging System terminates the Ro reference point as defined in TS
32.240 [1]. Other 3GPP specifications define additional reference points that
are functionally equivalent to the Ro reference point. These are the Gy for
PCEF embedded in PGW and the Gyn reference point for TDF. The Online Charging
System (OCS) may be decomposed and between these functions Diameter is used,
but for the Ro reference point it is the OCS as such that provides the
Diameter Credit-Control Application. As defined in TS 32.240 [1], the network
elements connected to the OCS by the Ro reference point, such as P-GWcan be
regarded as Diameter client.
The Diameter Accounting Application used on the Rf interface and Diameter
Credit-Control Application used on the Ro interface are defined in TS 32.299
[50].
This clause considers application and/or modification of current failure
handling functionality defined in TS 32.299 [50] for Diameter online and
offline charging in the Charging Trigger Function (CTF) when reacting to
overload control indication from the OCS or CDF, respectively.
Today there is a support on the reference points for alternative servers both
in online and offline charging in the case one service is not reachable. In
most cases charging messages cannot be dropped, even if there is a Diameter
overload situation on charging interfaces, since these are the bases for the
subscribers' bill and dropping a charging message will mean that there will be
no means to charge for the service.
### 5.1.2 IETF Diameter Overload Indication Conveyance
The interaction between reacting node and reporting node specified in IETF RFC
7683 [403] can be illustrated as following figure.
Figure 5.1.2.1 Interaction between Reacting Node and Reporting Node
One abatement algorithm described in IETF RFC 7683 [403] is to select a random
number between 1 and 100. If the random number is less than or equal to the
indicated reduction percentage received by the reacting node then the request
will be given abatement treatment otherwise the request is given normal
routing treatment.
## 5.2 Overload of the Offline Charging System (OFCS)
### 5.2.1 Existing overload control mechanism on Diameter charging interface
#### 5.2.1.1 Failure handling
The current failure handling uses the Charging Characteristics as defined in
TS 32.251 [11] Annex A, allows to specify both primary and secondary OFCS
addresses as well as the possibility to produce CDR or buffer these for
offline charging as a backup for the Diameter offline.
#### 5.2.1.2 Limitation
The current solution will only be used when there is a failure and cannot be
used for preventing an overload situation, i.e. it will manage the event that
a failure occurs but it cannot decrease the load if the systems are getting
close to their limits.
### 5.2.2 Solutions for Diameter overload indication handling
#### 5.2.2.1 Alternative solution 1- OLR with buffer mechanism
Using OLR with buffer mechanism is proposed to be an alternative solution 1.
The reacting node determines if overload control treatment should be applied
to the request based on the OLR. One approach that could be taken for each
request is to select a random number between 1 and 100. If the random number
is less than or equal to the indicated reduction percentage received by the
reacting node then the request is buffered, otherwise the request is given
normal routing treatment. This algorithm enables request messages of the
reduction percentage to be buffered. And when the overload ends, according to
FIFO (first-in first-out) principle, the buffered request messages will be
sent out to CDF in order. The CDF can apply existing duplicate detection and
sort ACRs according to sequence number of each ACR to generate CDR. The
shortage of the solution is that buffering request messages randomly may lead
to additional workload on sorting ACRs in CDF.
OLR_DEFAULT_ALGO (0x0000000000000001) of OC-Feature-Vector AVP specified in
IETF RFC 7683 [403] is used.
Supposing a standby CDF case is not considered in this report, the basic idea
is illustrated as following,
Figure 5.2.2.1.1 Basic buffer mechanism solution
#### 5.2.2.2 Alternative solution 2 OFCS with buffer mechanism
In this case the OFCS selects which messages to reply with a Protocol Error
"DIAMETER_TOO_BUSY" and for these the client will follow the Charging
Characteristics on the treatment, e.g. try the secondary address, start
buffering or producing CDR. This means that the OFCS would have to decide on
which request that should be buffered and this can in this case be based on
type of service. This will mean that the OFCS still will receive all Diameter
messages and will reject them one by one, that is if the Client itself don't
start using an algorithm to select messages to go to the secondary address
would it encounter a Protocol Error "DIAMETER_TOO_BUSY".
### 5.2.3 Evaluation and recommendation
## 5.3 Overload of the Online Charging System (OCS)
### 5.3.1 Existing overload control mechanism on Diameter charging interface
#### 5.3.1.1 Failure handling
#### 5.3.1.2 Limitation
### 5.3.2 Solutions for Diameter overload indication handling
#### 5.3.2.1 Alternative solution 1
#### 5.3.2.2 Alternative solution 2
### 5.3.3 Evaluation and recommendation
# 6 Conclusions
Editor\'s note: This subclause describes the conclusions within the present
document.
###### ###
#
# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The objective of this study item is to identify and document methods to
guarantee that all the relevant charging data for an IMS session has been
received in order to charge the IMS session correctly.
Within the study scenarios could be covered where a concatenation of
applications leads to an correlation of charging relevant information.
In addition a method to identify all network elements generating CDR for
offline charging within an IMS call in order to serve for an effective and
accurate IMS Charging correlation is in focus of this study.
The following scenarios are be covered this study:
  * IMS calls where the service invocation is done in the originating and/or terminating home network. Scenarios to be considered should cover different network scenarios like roaming, transit, PSTN interworking, intra home network or home-a to home-b network. IMS Calls where a concatenation of applications appear. The invoked applications can be provided by AS from different networks.
  * IMS Calls where an Application Server hosts several applications invoked during one call.
\- IMS Calls where call leg manipulation apply and more than one application
is involved.
  * IMS Calls where only several IMS network elements are necessary to generate charging information based on operator\'s configuration.
  * IMS Other scenarios where a correlation of charging relevant information created by application servers is needed.
The study will identify recommended enhancements to the charging architecture,
message and CDR content, and internode signalling.
It will analyse operator requirements in consideration of the roaming
scenarios and the existing charging specifications.
The conclusions are presented in a further section with assumptions made and
proposed further proceedings on that issues.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging Architecture and Principles\".
[2] - [10] Void.
[11] - [19] Void.
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] - [30] Void.
[31] - [34] Void
[35] 3GPP TS 32.275: \"Telecommunication management; Charging management;
MultiMedia Telephony (MMTel) charging\".
[36] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] Void
[102] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[103] 3GPP TS 23.002: \"Network Architecture\".
[104] -- [105] Void
[106] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[107] 3GPP TS 23.228: \"IP multimedia subsystem; Stage 2\".
[108] 3GPP TS 22.173: \"IP Multimedia Core Network Subsystem (IMS) Multimedia
Telephony Service and supplementary services; Stage 1\"
[109] - [207] Void.
[208] 3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model;
Stage 2\".
[209] - [217] Void.
[218] 3GPP TS 24.237: \"IP Multimedia (IM) Core Network (CN) subsystem IP
Multimedia Subsystem (IMS) service continuity; Stage 3\".
[219] - [299] Void.
[300] - [399] Void.
[400] - [403] Void.
[404] IETF RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".
[405] IETF RFC 4282 (December 2005): \"The Network Access Identifier\".
[406] -- [411] Void
[412] IETF RFC 7092 (December 2013): \"A Taxonomy of Session Initiation
Protocol (SIP) Back-to-Back User Agents\".
[413] IETF RFC 7315 (2014): \"Private Header (P-Header) Extensions to the
Session Initiation Protocol (SIP) for the 3rd-Generation Partnership Project
(3GPP)\".
[414] - [499] Void.
[500] - [599] Void.
[600] - [699] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**chargeable event:** activity utilizing telecommunication network resources
and related services for:
\- user to user communication (e.g. a single call, a data communication
session or a short message); or
\- user to network communication (e.g. service profile administration); or
\- inter-network communication (e.g. transferring calls, signalling, or short
messages); or
\- mobility (e.g. roaming or inter-system handover); and
\- that the network operator may want to charge for.
As a minimum, a chargeable event characterizes the resource / service usage
and indicates the identity of the involved end user(s).
**charged party:** user involved in a chargeable event who has to pay parts or
the whole charges of the chargeable event, or a third party paying the charges
caused by one or all users involved in the chargeable event, or a network
operator.
**charging:** function within the telecommunications network and the
associated OCS/BD components whereby information related to a chargeable event
is collected, formatted, transferred and evaluated in order to make it
possible to determine usage for which the charged party may be billed (offline
charging) or the subscriber\'s account balance may be debited (online
charging).
**charging event:** set of charging information forwarded by the CTF towards
the CDF (offline charging) or towards the OCS (online charging). Each charging
event matches exactly one chargeable event.
**charging function:** entity inside the core network domain, subsystem or
service that is involved in charging for that domain, subsystem or service.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Cr Reference Point between an AS and an MRFC for media control.
ISC Reference Point between an AS and a S-CSCF.
Ma Reference Point between an AS and an I‑CSCF.
Mf Reference Point between a transit function and AS (is equivalent to the
ISC).
Mr\' Reference Point between an AS and an MRFC for session control.
Rc Reference Point between an AS and an MRB.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[100] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [100].
ACR Anonymous Communication Rejection
AOC Advice of Charge
AS Application Server
ATCF Access Transfer Control Function
3G 3rd Generation
3GPP 3^rd^ Generation Partnership Project
B2BUA Back to Back User Agent
BD Billing Domain
CAMEL Customized Applications for Mobile network Enhanced Logic
CAT Customized Alerting Tone Service
CB **Communication Barring**
CCBS Completion of Communication to Busy Subscriber
CCNR Completion of Communications on No Reply
CDF Charging Data Function
CDIV **Communications Diversion**
CDR Charging Data Record
CSCF Call Session Control Function (I-Interrogating; P-Proxy; and S-Serving)
**CONF Conference**
CRS Customized Ringing Signal
CS Circuit Switched
CTF Charging Trigger Function
CUG Closed User Group
CW Communication Waiting
ECT Explicit Communication Transfer
EMT Enhanced Multimedia Telephony
EBS Enterprise Billing Service
FA Flexible Alerting
GSM Global System for Mobile communication
IARI IMS Application Reference Identifier
ICID IMS Charging Identifier
ICSI IMS Communication Service Identifier
IMEI International Mobile Equipment Identity
IMSI International Mobile Subscriber Identity
LCS LoCation Service
MCID Malicious Communication Identification
MGCF Media Gateway Control Function
MWI Message Waiting Indication
NE Network Element
OCB **Outgoing Communication Barring**
OCF Online Charging Function
OCS Online Charging System
OIP Originating Identification Presentation
OIR Originating Identification Restriction
PLMN Public Land Mobile Network
PNM Personal Network Management
PSTN Public Switched Telephony Network
TAP Transferred Account Procedure
TIP **Terminating Identification Presentation**
**TIR Terminating Identification Restriction**
UA User Agent
UAC User Agent Client
UAS User Agent Server
UMTS Universal Mobile Telecommunications System
VCC Voice Call Continuity
VoLTE Voice over LTE
VPLMN Visited PLMN
# 4 Overview
## 4.1 General
Within TS 22.115 [102] (subclause 4.3.7 Service Aware Charging Requirements)
it is one requirement that charging based on identified IMS communication
service and the service in use is applied.
IMS enables deployment of new services that can be concatenated. Thus for one
session, more than one AS can process a call from User A to User B. Because
each service used influences the charging result, an aggregation/correlation
of charging data from several IMS elements is required to correctly charge the
subscriber. Depending on the services being executed and the particular call
type being processed, information from additional IMS nodes, such as the MGCF
may also be required to correctly charge the subscriber. The IMS Charging ID
(ICID) is used for this correlation.
Information collected in a CDR from S-CSCF indicates which Application Servers
are involved in an IMS session. Each AS provides charging data required for
correct charging of the session in a separate CDR. When multiple services are
invoked on a single AS, it is common practice for each service to generate its
own charging data resulting in an individual CDR per service. In this case,
the Application Servers information is not sufficient to determine that
multiple CDRs are required to correctly charge the session.
In addition in the current IMS Charging, accounting information generated by
several network elements may neither be received in real-time nor be
synchronized. Currently charging information in CDR cannot enable the Billing
Domain (BD) to check integrity of IMS CDRs involved in an IMS call. This could
result in the incompleteness of IMS charging correlation.
Also, not all of IMS network elements involved in an IMS call generate
charging information since operators may configure just several IMS network
elements to generate charging information based on their requirements. This
means charging correlation is only applied to CDRs created by these configured
IMS network elements. Thus the Billing Domain needs to know which IMS network
element is generating offline charging information and is involved in the IMS
call to judge the integrity of IMS charging correlation.
Accounting information across several network elements may also neither be
received in real-time nor be synchronized. As specified in TS 32.260 [20],
subclause 5.2.2.2.4, CDF Connection Failure, CDRs of 1 network element may not
be received within a pre-set timeframe. Still a rating algorithm never
overcharge even in case of such delayed CDRs.
When processing millions of records from multiple IMS nodes (with, in some
cases, multiple records per node), an efficient method is required to
guarantee that all the records necessary to charge the user for the IMS
session have been received.
Accurate differentiated service-aware correlation and rating requires an
algorithm to determine if all CDRs are delivered and available for processing.
Problematic is a correlation of CDR\'s in cases like:
\- Rating of CDRs only based on Service 1 information will be faulty in case
AS hosting Service 1 and AS hosting Service 2 both had been involved.
\- An algorithm expecting always Service 1 and Service 2 CDRs will fail, where
only AS hosting Service 1 had been involved.
\- An algorithm to determine if CDRs from all IMS nodes (not only AS)
necessary have been received.
## 4.2 Consideration of different Application Server (AS) types and roles
TS 23.002 [103] defines an Application Server as a SIP Application Server, OSA
Application Server, or CAMEL IM-SSF, that offers value added IM services and
resides either in the user\'s home network or in a third party location. The
third party could be a network or simply a stand-alone AS.
The following Reference points are relevant for this study:
1\. Between Call-Control and AS:
ISC Reference Point between an AS and a S-CSCF.
Ma Reference Point between an AS and an I‑CSCF.
Mf Reference Point between a transit function and AS (is equivalent to the
ISC).
2\. Between AS and Media Resource Control:
Cr Reference Point between an AS and an MRFC for media control.
Mr\' Reference Point between an AS and an MRFC for session control.
Rc Reference Point between an AS and an MRB.
The modes of operation between the Application Server and the Transit Function
are identical to the modes of operation between the Application Server and the
S-CSCF.
For an Application Server connected via Ma the mode of operation for
terminating sessions is based on the called number which is a Public Service
Identity hosted by an Application Server. For originating sessions the AS has
no knowledge of a S-CSCF assigned to that user or Public Service Identity for
which the Application Server is originating the session.
Within TS 23.218 [208] is defining different Application Server roles as
follows:
1\. Application Server acting as terminating UA, or redirect server:
\- TS 23.218 [208] defines the Application Server only a UA regarding RFC 3261
[404]. When the Application Server is acting a terminating UA the SIP session
will be terminated with the procedures defined for a User Agent Server (UAS).
RFC 3261 defines a UAS: As a logical entity that generates a SIP response to a
SIP request. The SIP response accepts, rejects, or redirects the SIP request.
This role lasts only for the duration of that transaction.
\- A redirect server as specified within RFC3261 [404] is a user agent server
that generates 3xx SIP responses to SIP requests it receives, directing the
client to contact an alternate set of URIs.
2\. Application Server acting as originating UA:
\- TS 23.218 [208] defines the Application Server acting as originating UA as
a UA as specified in IETF RFC 3261 [404] which generates a SIP Request which
it sends to the S-CSCF which then proxies it towards the destination.
Regarding RFC 3261 [404] The UA acts then as a User Agent Client is a logical
entity that creates a new request, and then uses the client transaction state
machinery to send it. The role of UAC lasts only for the duration of that
transaction.
3\. Application Server acting as a SIP proxy:
\- TS 23.218 [208] defines the Application Server as function which acts as a
proxy as specified in IETF RFC 3261 [404]. During the proxy operation the
Application Server can add, remove or modify the header contents contained in
the SIP request according to the Proxy rules specified in IETF RFC 3261 [404].
The main task of a proxy is to route the request to an entity that is nearer
to the terminating UAS.
4\. Application Server performing 3rd party call control:
\- The Application Server performing 3rd party call control acts as a B2BUA.
IETF RFC 7092 [412] defines the B2BUA taxonomy and different roles more in
detail. IETF RFC 7092 [412] differentiates for B2BUA between SIP and Media
layer. For Application Server the SIP layer is relevant. When the Application
Server triggers MRFC then the media layer may need additional consideration.
\- Within TS 23.218 [208] are two roles described for Application Server
applying the B2BUA role:
1\. The routeing B2BUA Application Server which terminates a SIP request as
UAS and generates as UAC a new SIP request for a different SIP dialog, which
is based on the received SIP request. In this mode the Application Server
behaves as a B2BUA for the multiple SIP dialogs as specified in IETF RFC 3261
[404].
2\. An initiating B2BUA is an Application Server which initiates two SIP
requests, which are logically connected together at the Application Server. In
this mode of operation the Application Server initiates two SIP requests with
different SIP dialogs. The Application Server is responsible for correlating
the two dialogs. In this mode the Application Server behaves as a B2BUA for
the multiple SIP dialogs as specified in IETF RFC 3261 [404].
## 4.3 Identifiers used for application differentiation
### 4.3.1 IMS Communication Service Identifier (ICSI)
TS 23.228 [107] defines the IMS Communication Service Identifier (ICSI) as a
identifier that provides a framework for the identification of IMS
communication services utilizing the IMS enablers. The purpose of identifying
IMS communication services is to help triggering to Application Servers and
internal routing in UEs. See TS 23.228 [107] for further information on IMS
communication services.
The ICSI is used by an originating UE to identify which services are supported
by the originating UE. The ICSI is included within the initial SIP request.
The responding UE include the ICSI for the IMS communication services that the
responding UE supports.
The UE could be also an AS including a ICSI value into a SIP request or SIP
response.
The ICSI may be used to trigger specific Application Server. The ICSI does not
reflect the currently provided or executed services. It only reflects the
possibly supported services by UE\'s.
The Procedures in TS 24.229 [106] does not guarantee that the appearance of an
ICSI indicates that a specific service was executed.
### 4.3.2 IMS Application Reference Identifier (IARI)
TS 23.218 [208] defines the IARI as value that identifies the application to
be invoked by the terminating UE. When no IARI value is present in a SIP
request, the default application is assumed.
TS 23.228 [107] shows that the IMS application reference identifies the
application utilizing the IMS communication service. Figure 4.3.2.1 which is a
copy out of TS 23.228 [107] shows the relevance of the IARI.
{width="6.654861111111111in" height="3.438888888888889in"}
Figure 4.3.2.1: IMS applications on top of an IMS communication service
The application reference is used to identify the application on top of a
communication service used. An AS can add, remove or modify the IARI based on
the knowledge of the used service or services.
The procedures in TS 24.229 [106] do not guarantee that the appearance of an
IARI indicates that a specific application was executed.
## 4.4 Charging correlation
### 4.4.1 General
The charging architecture, charging principles and charging data for IM CN
subsystem are described in TS 32.240 [1] and TS 32.260 [20]. The charging
correlation information between IM CN subsystem is described in TS 24.229
[106].
### 4.4.2 Charging data correlation
The principle of charging data correlation is described within TS 32.240 [1]
as follows:
\"The charging data correlation combines charging events generated by CTF
while they are belong to the same bearer/session/service resource usage. The
correlation provides an association of charging information for the mobile
subscriber\'s resource usage.\"
There are different access network charging identifier used for the
correlation. Since this study reflects only applications within the IMS the
IMS Charging Identifier (ICID) is evaluated.
Three different correlation types are defined within TS 32.240 [1]:
1\. Intra-level correlation aggregates the charging events belonging to the
same charging session, e.g. over a time period, and implies the generation of
interim charging records.
2\. Inter-level correlation combines the charging events belonging to the same
service but generated by different CTFs e.g. for PS access control via IM
Subsystem.
3\. Inter-network correlation enables the different operators involved in IMS
sessions to identify each other by using the Inter Operator Identification
concept (IOI).
The principle of charging data correlation in TS 32.260 [20] reflects how the
SIP headers are used for extracting information for correlation. For IMS
correlation the P-Charging-Vector header parameters ICID, access network
charging identifier and IOI are used.
### 4.4.3 SIP Identifier used for charging correlation
#### 4.4.3.1 IMS Charging Identifier (ICID)
The IMS domain correlation is based on IMS Charging Identifier (ICID) shared
between IMS Network Elements involved with the same session/transaction. With
ICID it is possible to correlate session/transaction related charging data
generated in different IMS elements (i.e. x-CSCFs, ASs\'). The ICID is
included in all SIP methods, if the P-Charging-Vector header is present, and
transferred through originating and terminating side nodes, except to UE.
The value of the ICID parameter is identical with the \'icid-value\' parameter
defined in TS 24.229 [106] and is included within The P-Charging-Vector. The
ICID value is globally unique across all 3GPP IMS networks for a time period
of at least one month.
The ICID is generated within the first IMS Network Element and present within
the SIP request(s) and SIP response(s). For SIP session unrelated methods
session unrelated ICID is generated for a specific SIP transaction. For SIP
session related methods the ICID is generated for the initial INVITE and is
then used in all subsequent SIP messages for that session (e.g. SIP 200 OK,
SIP (RE-)INVITE, SIP BYE etc.) until the session is terminated
Since TS 32.260 [20] defines that at each SIP session establishment a new,
session specific ICID is generated at the first IMS Network Element that
processes the session-initiating SIP INVITE message, depending on charging
principles retained by a B2BUA AS can keep the used ICID or change it. The
charging principle is selected per-AS service logic: in case the service
requires the outgoing leg created by the new session SIP INVITE to be
considered as the same IMS session from charging's perspective, the ICID of
the incoming session needs to be preserved, otherwise a new ICID needs to be
generated by the AS (i.e. the outgoing session is required to be considered
separately from charging's perspective). In the first case, the ICID is the
key information used for the correlation within the IMS session, in the latter
case, the correlation is assumed to be not required between the IMS session
for the incoming leg and the IMS session for the outgoing leg.
This goes along with TS 32.275 [35] which describes that for AS(s) providing
MMTel specific service and supplementary services, the \"OneChargingSession\"
option, as described in TS 32.260 [20] can be applied, when acting as a B2BUA
with IMS Charging Identifier (ICID) preserved between dialogs.
The same principle applies to the ATCF as a particular AS acting as a B2BUA.
This \"OneChargingSession\" option in the different descriptions is applicable
per Operator configuration and implicitly requires the B2BUA AS to consider
the outgoing leg as part of the same IMS session from a charging perspective.
In this case the ICID is the key information used for the correlation.
#### 4.4.3.2 Related ICID
The related ICID is used in cases where SRVCC apply. For the purpose of
charging correlation between the source access leg and the target access leg
the SCC AS and the ATCF includes the ICID used on the source access leg as the
Related ICID for the target access leg as described in TS 24.229 [106].
This Related ICID is sent in the 1xx and 2xx SIP responses to the initial SIP
INVITE as described in TS 24.237 [218].
#### 4.4.3.3 Access network charging identifier
The access network charging identifier is the media flow level data shared
among the IMS Network Elements for one side of the session (either the
originating or terminating side). This information is used to correlate the
access network charging data with the IMS charging data.
The access network charging identifier is populated in the P-Charging-Vector
using the access-network-charging-info parameter. For further information
regarding the composition and usage of the access-network-charging-info
parameter refer to TS 24.229 [106] and RFC 7315 [413].
#### 4.4.3.4 Inter Operator Identifier (IOI)
The Inter Operator Identifier (IOI) identifies originating, terminating and
transit networks involved in a session/transaction. The IOI may appear in SIP
requests and SIP responses and are generated from each side of
session/transaction to identify the home networks associated with each side.
The Orig-IOI and Term-IOI parameters identifying the originating and
terminating network are present in the P-Charging-Vector.
For interconnection scenarios in multi operator environments where one or more
transit operators are between the originating and terminating operator, a list
of Transit-IOI values may occur additionally to identify involved transit
operators. For further information regarding the composition and usage of the
parameters refer to TS 24.229 [204] and IETF RFC 7315 [413].
#### 4.4.3.5 IMS visited network identifier
The IMS visited network identifier identifies the visited network involved in
a session/transaction. The IMS visited network identifier is available in the
SIP P-Visited-Network-ID header field as defined in RFC 7315 [413] of the SIP
REGISTER and should be used for all charging events associated with the user.
#### 4.4.3.6 Loopback Indication
During the loopback the TRF will set the Loopback-indication parameter
identify when loopback apply. When the TRF receives SIP responses to initial
or subsequent SIP requests from the terminating side, the TRF inserts in the
P‑Charging-Vector header field, if present, the \"loopback-indication\" header
field parameter to the outgoing SIP response.
#### 4.4.3.7 Session-ID
For a SIP session the Session-ID (Session identification) contains the SIP
Call-ID as defined in the Session Initiation Protocol RFC 3261 [404]. The
Session-ID is used for charging purposes as defined in TS 32.260 [20].RFC 3261
[404] defines that the SIP Call-ID contains a globally unique identifier for
this call. The To tag, From tag and SIP Call‑ID does define the peer-to-peer
relationship of a SIP Session. RFC 3261 [404] describes that SIP Call-ID
header field acts as a unique identifier to group together a series of
messages.
Important is that a B2BUA will change the SIP Call-ID when initiating a new
session at the outgoing leg. Thus it cannot be used to correlate a SIP end-to-
end session in each case. Thus a MMTel depended on the functionality may
change the SIP Call-ID. The SIP Call-ID can only be used to correlate SIP
Messages between a UAC and UAS when no initiating B2BUA is in between. The
same apply for a SIP session between two B2BUAs.
#### 4.4.3.8 Outgoing Session-ID
This identifier is the SIP Call-ID generated within an AS acting as B2BUA at
the outgoing side. It contains the SIP Call-ID as defined in the Session
Initiation Protocol RFC 3261 [404] generated by the UAC at the outgoing side.
The outgoing Session-ID is used for charging purposes as defined in TS 32.260
[20].Due to the fact that a B2BUA changes the SIP Call-ID, it cannot be used
to correlate a SIP end-to-end session. But tracking this within an AS CDR as
Session-ID and outgoing Session-ID may be used for correlation purposes.
### 4.4.4 SIP Identifier used for dialog correlation
#### 4.4.4.1 Original dialog identifier
The original dialog identifier as defined in TS 24.229 [106] is an
implementation specific token that the S-CSCF encodes into the own S-CSCF URI
in a SIP Route header field, prior to forwarding the request to an AS. This is
possible because the S-CSCF is the only entity that creates and consumes the
value.
The token may identify the original dialog of the request, so in case an AS
acting as a B2BUA changes the dialog, the S-CSCF is able to identify the
original dialog when the request returns to the S-CSCF.
The main purpose of this token is that the S-CSCF can identify the original
dialog which allows to trigger the iFC for this dialog. The S-CSCF can
associate requests as part of the same iFC sequence that trigger iFC
evaluation in priority order (and not rely on SIP dialog information that may
change due to B2BUA AS). Thus when the AS deletes the originating dialog
identifier the iFC-sequence is not evaluated any longer.
In cases where the AS is acting as a proxy the original dialog identifier will
never be deleted since a proxy will not change the dialog.
Such a value could be used to correlate CDR. Since the value is written within
the Route header field the information for charging purposes will be lost due
to the fact that the S-SCCF CDR will only write the incoming Route header
fields prior to triggering of any ASs and outgoing Route header fields after
triggering all AS. Thus an original dialog identifier which is included within
the Route header filed sent to the AS and back indicating the S-CSCF will be
lost.
Currently the original dialog identifier is not used for charging purposes.
## 4.5. Comparison of S-CSCF and AS CDR for correlation purposes
This section of the study shows a comparison of the CDR content of an AS
generated CDR and an S-CSCF generated CDR. The following table shows the
possible fields of correlation and the assumptions if it could be used for it.
In the column for \"Usable for Correlation\" three values are used:
No = Element does **not** help correlating Calls
Yes = Element needed for correlation
Partly =Element may be used with other indications for correlation
Table 4.5.1
+-------------+-------------+-------------+-------------+-------------+ | Field | Description | Created at | Comment | Usable | | | | | | | | | | | | for | | | | | | Correlation | +-------------+-------------+-------------+-------------+-------------+ | Role of | This field | AS and | May help | Partly | | node | indicates | S-CSCF | for | | | | whether the | | overarching | | | | AS/S-CSCF | | services | | | | is serving | | like a | | | | the | | private PBX | | | | Originating | | service. | | | | or the | | But only | | | | Terminating | | for | | | | party. | | diff | | | | | | erentiating | | | | | | the CDR\'s | | | | | | between | | | | | | terminating | | | | | | and | | | | | | o | | | | | | riginating. | | +-------------+-------------+-------------+-------------+-------------+ | Node | This item | AS and | Will not | No | | Address | holds the | S-CSCF | help for | | | | address of | | different | | | | the node | | a | | | | providing | | pplications | | | | the | | located at | | | | information | | one AS. | | | | for the | | Each CDR | | | | CDR. This | | written by | | | | may either | | a specific | | | | be the IP | | application | | | | address or | | will have | | | | the FQDN of | | the same | | | | the IMS | | Node | | | | node | | Address. | | | | generating | | | | | | the | | | | | | accounting | | | | | | data. | | | | +-------------+-------------+-------------+-------------+-------------+ | Session ID | The Session | AS and | As per | Partly | | | iden | S-CSCF | description | | | | tification. | | for the | | | | For a SIP | | \"OneChargi | | | | session the | | ngSession\" | | | | Session-ID | | option, the | | | | contains | | incoming or | | | | the SIP | | outgoing | | | | Call ID as | | Session-ID | | | | defined in | | (i.e. SIP | | | | the Session | | Call Id) | | | | Initiation | | will be | | | | Protocol | | included | | | | RFC 3261 | | during IMS | | | | [404]. | | session | | | | When the AS | | setup. It | | | | acts as | | is not | | | | B2BUA, the | | und | | | | incoming | | erstandable | | | | session is | | since a | | | | identified, | | B2BUA will | | | | except for | | change the | | | | the | | Call-ID why | | | | \"OneChargi | | either | | | | ngSession\" | | incoming or | | | | option, | | outgoing | | | | where it | | Session-ID | | | | contains | | is then | | | | either the | | included. | | | | incoming or | | Normally it | | | | outgoing | | should then | | | | dialog SIP | | be both. | | | | Call Id | | | | | | involved | | For normal | | | | during IMS | | service | | | | session | | behaviour | | | | setup. | | together | | | | | | with the | | | | | | Outgoing | | | | | | Session ID | | | | | | tracks the | | | | | | AS and the | | | | | | incoming | | | | | | and | | | | | | outgoing | | | | | | dialog ID | | | | | | but will | | | | | | not track | | | | | | the | | | | | | Application | | | | | | itself. | | | | | | Even each | | | | | | Application | | | | | | acts as | | | | | | B2BUA. | | +-------------+-------------+-------------+-------------+-------------+ | Outgoing | When the AS | AS only | For normal | Partly | | Session ID | acts as | | service | | | | B2BUA, the | | behaviour | | | | outgoing | | together | | | | session is | | with the | | | | identified | | Incoming | | | | by the | | Session ID | | | | Outgoing | | tracks the | | | | Session ID | | AS and the | | | | which | | incoming | | | | contains | | and | | | | the SIP | | outgoing | | | | Call ID (as | | dialog ID | | | | defined in | | but will | | | | the RFC | | not track | | | | 3261 | | the | | | | [404]). | | Application | | | | This field | | itself. | | | | is not used | | Even each | | | | for the | | Application | | | | \"OneChargi | | acts as | | | | ngSession\" | | B2BUA. | | | | option | | | | +-------------+-------------+-------------+-------------+-------------+ | List Of | The address | AS and | | Partly | | Calling | or | S-CSCF | | | | Party | addresses | | | | | Address | (Public | | | | | | User ID or | | | | | | Public | | | | | | Service ID) | | | | | | of the | | | | | | party | | | | | | requesting | | | | | | a service | | | | | | or | | | | | | initiating | | | | | | a session. | | | | | | In the case | | | | | | of no | | | | | | P-Assert | | | | | | ed-Identify | | | | | | is known, | | | | | | this list | | | | | | includes a | | | | | | one item | | | | | | with the | | | | | | value | | | | | | \ | | | | | | "unknown\". | | | | +-------------+-------------+-------------+-------------+-------------+ | List of | The list of | S-CSCF only | Will only | No | | Associated | non-barred | | help to | | | URI | public user | | identify | | | | identities | | the | | | | (SIP URIs | | originating | | | | and/or Tel | | user. Not | | | | URIs) | | usable for | | | | associated | | c | | | | to the | | orrelation. | | | | public user | | | | | | identity | | | | | | under | | | | | | re | | | | | | gistration. | | | | +-------------+-------------+-------------+-------------+-------------+ | Called | For SIP | AS and | The AS may | Partly | | Party | tr | S-CSCF | change the | | | Address | ansactions, | | address, In | | | | except for | | forwarding | | | | re | | cases the | | | | gistration, | | AS. | | | | this field | | | | | | holds the | | | | | | address of | | | | | | the party | | | | | | (Public | | | | | | User ID or | | | | | | Public | | | | | | Service ID) | | | | | | to whom the | | | | | | SIP | | | | | | transaction | | | | | | is posted. | | | | | | | | | | | | For | | | | | | r | | | | | | egistration | | | | | | tr | | | | | | ansactions, | | | | | | this field | | | | | | holds the | | | | | | Public User | | | | | | ID under | | | | | | re | | | | | | gistration. | | | | +-------------+-------------+-------------+-------------+-------------+ | Requested | For SIP | AS and | | Partly | | Party | t | S-CSCF | | | | Address | ransactions | | | | | | this field | | | | | | holds the | | | | | | address of | | | | | | the party | | | | | | (Public | | | | | | User ID or | | | | | | Public | | | | | | Service ID) | | | | | | to whom the | | | | | | SIP | | | | | | transaction | | | | | | was | | | | | | originally | | | | | | posted. | | | | | | | | | | | | This field | | | | | | is only | | | | | | present if | | | | | | different | | | | | | from the | | | | | | Called | | | | | | Party | | | | | | Address | | | | | | parameter. | | | | +-------------+-------------+-------------+-------------+-------------+ | Alternate | The address | AS only | Will not | No | | Charged | of an | | help for | | | Party | alternate | | correlation | | | Address | party that | | since it is | | | | is | | only | | | | identified | | available | | | | by the AS | | at the AS. | | | | at session | | | | | | initiation, | | | | | | and is | | | | | | charged in | | | | | | place of | | | | | | the calling | | | | | | party. | | | | +-------------+-------------+-------------+-------------+-------------+ | List of | This field | AS only | Will not | No | | Requested | is a list | | help for | | | Party | of | | correlation | | | Address | Requested | | since it is | | | | Party | | only | | | | Address. | | available | | | | This field | | at the AS. | | | | is only | | | | | | present if | | | | | | different | | | | | | from the | | | | | | Called | | | | | | Party | | | | | | Address | | | | | | parameter. | | | | +-------------+-------------+-------------+-------------+-------------+ | List of | The address | AS and | Is then | Partly | | Called | or | S-CSCF | available | | | Asserted | addresses | | for S-CSCF | | | Identity | of the | | and AS in | | | | final | | backward | | | | asserted | | direction. | | | | identities. | | Thus such a | | | | Present if | | field will | | | | the final | | have an | | | | asserted | | unique | | | | identities | | called | | | | are | | number. | | | | available | | Maybe used | | | | in the SIP | | for | | | | 2xx | | c | | | | response. | | orrelation. | | | | | | But only | | | | | | when the AS | | | | | | will | | | | | | forward the | | | | | | P-Assert | | | | | | ed-Identity | | | | | | in backward | | | | | | direction. | | | | | | In some | | | | | | cases this | | | | | | will not | | | | | | happen. | | | | | | i.e. CDIV | | +-------------+-------------+-------------+-------------+-------------+ | Private | Holds the | S-CSCF only | Private | No | | User ID | used | | user id is | | | | private | | not | | | | user | | available | | | | identity of | | for AS and | | | | the served | | will only | | | | party | | be used | | | | according | | between | | | | to RFC2486 | | originating | | | | [405] if | | user and | | | | available. | | originating | | | | | | P-CSCF. | | | | | | Thus not | | | | | | usable for | | | | | | correlation | | | | | | purposes. | | +-------------+-------------+-------------+-------------+-------------+ | Service | This field | AS and | This | No | | Request | contains | S-CSCF | timestamp | | | Time Stamp | the time | | is accurate | | | | stamp which | | time down | | | | indicates | | to 1 sec. | | | | the time at | | | | | | which the | | | | | | service was | | | | | | requested. | | | | | | This | | | | | | parameter | | | | | | corresponds | | | | | | to SIP | | | | | | Request | | | | | | Timestamp. | | | | | | Present | | | | | | with | | | | | | Charging | | | | | | Data | | | | | | Request | | | | | | [Start] | | | | | | and | | | | | | Charging | | | | | | Data | | | | | | Request | | | | | | [Event]. | | | | +-------------+-------------+-------------+-------------+-------------+ | Service | This | AS and | This will | No | | Request | parameter | S-CSCF | then differ | | | Time Stamp | contains | | per | | | Fraction | the | | application | | | | m | | due to | | | | illiseconds | | runtime | | | | fraction in | | constrains | | | | relation to | | and will | | | | the Service | | not | | | | Request | | identify | | | | Time Stamp. | | which | | | | | | application | | | | | | is | | | | | | involved. | | | | | | Because | | | | | | there will | | | | | | exist more | | | | | | than one | | | | | | time stamp | | | | | | for one | | | | | | call. | | +-------------+-------------+-------------+-------------+-------------+ | Service | This field | AS and | This | Partly | | Delivery | holds the | S-CSCF | timestamp | | | Start Time | time stamp | | is accurate | | | Stamp | reflecting | | time down | | | | either: | | to 1 sec. | | | | successful | | | | | | session | | | | | | set-up, a | | | | | | delivery | | | | | | unrelated | | | | | | service, an | | | | | | u | | | | | | nsuccessful | | | | | | session | | | | | | set-up and | | | | | | an | | | | | | u | | | | | | nsuccessful | | | | | | session | | | | | | unrelated | | | | | | request. | | | | | | This | | | | | | parameter | | | | | | corresponds | | | | | | to SIP | | | | | | Response | | | | | | Timestamp. | | | | | | Present | | | | | | with | | | | | | Charging | | | | | | Data | | | | | | Request | | | | | | [Start] | | | | | | and | | | | | | Charging | | | | | | Data | | | | | | Request | | | | | | [Event]. | | | | +-------------+-------------+-------------+-------------+-------------+ | Service | This | AS and | This will | Partly | | Delivery | parameter | S-CSCF | then differ | | | Start Time | contains | | per | | | Stamp | the | | application | | | Fraction | m | | due to | | | | illiseconds | | runtime | | | | fraction in | | constrains | | | | relation to | | and will | | | | the Service | | not | | | | Delivery | | identify | | | | Start Time | | which | | | | Stamp. | | application | | | | | | is | | | | | | involved. | | | | | | Because | | | | | | there will | | | | | | exist more | | | | | | than one | | | | | | time stamps | | | | | | for one | | | | | | call. | | +-------------+-------------+-------------+-------------+-------------+ | Record | A time | AS and | Not usable | No | | Opening | stamp | S-CSCF | for | | | Time | reflecting | | correlation | | | | the time | | purposes | | | | the CDF | | since the | | | | opened this | | time may | | | | record. | | vary | | | | Present | | between the | | | | only in SIP | | CDR\'s. And | | | | session | | will also | | | | related | | not be | | | | case. | | unique over | | | | | | several | | | | | | CDRs. | | +-------------+-------------+-------------+-------------+-------------+ | Record | A Time | AS and | Not usable | No | | Closure | stamp | S-CSCF | for | | | Time | reflecting | | correlation | | | | the time | | purposes | | | | the CDF | | since the | | | | closed the | | time may | | | | record. | | vary | | | | | | between the | | | | | | CDR\'s. And | | | | | | will also | | | | | | not be | | | | | | unique over | | | | | | several | | | | | | CDRs. | | +-------------+-------------+-------------+-------------+-------------+ | Application | This a | S-CSCF only | Will only | No | | Servers | grouped CDR | | include AS | | | Information | field | | Information | | | | containing | | when AS | | | | the fields: | | will be | | | | \" | | invoked by | | | | Application | | the S-CSCF. | | | | Server | | Will not | | | | Involved\" | | help for | | | | and | | application | | | | \" | | c | | | | Application | | orrelation, | | | | Provided | | when | | | | Called | | c | | | | Parties \". | | oncatenated | | | | | | within one | | | | | | AS. | | +-------------+-------------+-------------+-------------+-------------+ | Application | Holds the | S-CSCF only | Will only | No | | Servers | ASs (if | | include AS | | | Involved | any) | | Information | | | | identified | | when AS | | | | by the SIP | | will be | | | | URIs. | | invoked by | | | | | | the S-CSCF. | | | | | | Will not | | | | | | help for | | | | | | application | | | | | | c | | | | | | orrelation, | | | | | | when | | | | | | c | | | | | | oncatenated | | | | | | within one | | | | | | AS. | | +-------------+-------------+-------------+-------------+-------------+ | Application | Holds a | S-CSCF only | Will only | No | | Provided | list of the | | include AS | | | Called | Called | | Information | | | Parties | party | | when AS | | | | a | | will be | | | | ddress(es), | | invoked by | | | | if the | | the S-CSCF. | | | | address(es) | | Will not | | | | are | | help for | | | | determined | | application | | | | by an AS | | c | | | | (SIP URI, | | orrelation, | | | | E.164, | | when | | | | etc.). | | c | | | | | | oncatenated | | | | | | within one | | | | | | AS and | | | | | | Called | | | | | | Parties | | | | | | will change | | | | | | more than | | | | | | once. | | +-------------+-------------+-------------+-------------+-------------+ | Inter | Holds the | AS and | Will not | No | | Operator | ide | S-CSCF | really help | | | Identifiers | ntification | | for | | | | of the home | | c | | | | network | | orrelation. | | | | ( | | ioi\'s will | | | | originating | | help for | | | | and | | identifying | | | | t | | when | | | | erminating) | | service | | | | if | | will have | | | | exchanged | | different | | | | via SIP | | use cases. | | | | signalling, | | | | | | as recorded | | | | | | in the | | | | | | P-Char | | | | | | ging-Vector | | | | | | header. | | | | +-------------+-------------+-------------+-------------+-------------+ | Originating | This | AS and | orig-ioi | No | | IOI | parameter | S-CSCF | may due to | | | | corresponds | | roaming or | | | | to Orig-IOI | | 3rd AS | | | | header of | | service | | | | the | | provider, | | | | P‑Char | | change thus | | | | ging-Vector | | not usable | | | | defined in | | for | | | | TS 24.229 | | c | | | | [204]. | | orrelation. | | +-------------+-------------+-------------+-------------+-------------+ | Terminating | This | AS and | term-ioi | No | | IOI | parameter | S-CSCF | may due to | | | | corresponds | | roaming or | | | | to Term-IOI | | 3rd AS | | | | header of | | service | | | | the | | provider, | | | | P‑Char | | change thus | | | | ging-Vector | | not usable | | | | defined in | | for | | | | TS 24.229 | | c | | | | [204]. | | orrelation. | | +-------------+-------------+-------------+-------------+-------------+ | Transit IOI | This | AS and | transit-ioi | No | | List | parameter | S-CSCF | may due to | | | | corresponds | | roaming or | | | | to | | 3rd AS | | | | Transit-IOI | | service | | | | List of the | | provider, | | | | P‑Char | | change thus | | | | ging-Vector | | not usable | | | | defined in | | for | | | | TS 24.229 | | c | | | | [204] . | | orrelation. | | | | This field | | | | | | may occur | | | | | | several | | | | | | times in | | | | | | one CDR. | | | | | | Each | | | | | | occurrence | | | | | | represents | | | | | | transit IOI | | | | | | values | | | | | | received | | | | | | from the | | | | | | path | | | | | | inbound to | | | | | | or outbound | | | | | | from the | | | | | | S‑CSCF. | | | | +-------------+-------------+-------------+-------------+-------------+ | IMS | This | AS and | Key element | Yes | | Charging | parameter | S-CSCF | for | | | Identifier | holds the | | correlation | | | | IMS | | within an | | | | charging | | IMS | | | | identifier | | session. | | | | (ICID) as | | | | | | generated | | | | | | by the IMS | | | | | | node for | | | | | | the SIP | | | | | | session. | | | | +-------------+-------------+-------------+-------------+-------------+ | Related IMS | This field | AS only | Only for | No | | Charging | contains | | SRVCC | | | Identifier | the related | | | | | | IMS | | | | | | Charging | | | | | | Identifier | | | | | | in case of | | | | | | access | | | | | | transfer. | | | | +-------------+-------------+-------------+-------------+-------------+ | Related IMS | This | AS only | Only for | No | | Charging | parameter | | SRVCC | | | Identifier | holds the | | | | | Generation | identifier | | | | | Node | of the | | | | | | server that | | | | | | generated | | | | | | the Related | | | | | | IMS | | | | | | charging | | | | | | identifier. | | | | +-------------+-------------+-------------+-------------+-------------+ | Access | This | AS and | Only for | No | | Correlation | parameter | S-CSCF | access type | | | ID | holds the | | correlation | | | | charging | | | | | | identifier | | | | | | from the | | | | | | access | | | | | | network, | | | | | | consisting | | | | | | of either | | | | | | GPRS | | | | | | charging ID | | | | | | (GCID) | | | | | | which is | | | | | | generated | | | | | | by the GGSN | | | | | | for a GPRS | | | | | | PDP | | | | | | context, | | | | | | Charging Id | | | | | | which is | | | | | | generated | | | | | | by P-GW for | | | | | | IP-CAN | | | | | | bearer or | | | | | | the Access | | | | | | Network | | | | | | Charging | | | | | | Identifier | | | | | | Value which | | | | | | is | | | | | | generated | | | | | | by another | | | | | | type of | | | | | | access | | | | | | network. | | | | | | | | | | | | It is | | | | | | present | | | | | | only if | | | | | | received | | | | | | from the | | | | | | access | | | | | | network | | | | | | when PCC | | | | | | a | | | | | | rchitecture | | | | | | is | | | | | | i | | | | | | mplemented. | | | | +-------------+-------------+-------------+-------------+-------------+ | Service | This is a | AS only | Will not | No | | Specific | grouped | | help for | | | Info | field that | | correlation | | | | contains | | since it is | | | | service | | only | | | | specific | | available | | | | data if and | | at the AS. | | | | as provided | | Not aimed | | | | by an AS. | | to be for | | | | It may | | different | | | | occur | | Ap | | | | several | | plications. | | | | times in | | | | | | one CDR. | | | | +-------------+-------------+-------------+-------------+-------------+ | Service | This | AS only | Will not | No | | Specific | sub-field | | help for | | | Data | of Service | | correlation | | | | Specific | | since it is | | | | Data holds | | only | | | | the value | | available | | | | of the | | at the AS. | | | | Service | | Not aimed | | | | Specific | | to be for | | | | Data. | | different | | | | | | Ap | | | | | | plications. | | +-------------+-------------+-------------+-------------+-------------+ | Service | This | AS only | Will not | No | | Specific | sub-field | | help for | | | Type | of Service | | correlation | | | | Specific | | since it is | | | | Data holds | | only | | | | the type of | | available | | | | the Service | | at the AS. | | | | Specific | | Not aimed | | | | Data. | | to be for | | | | | | different | | | | | | Ap | | | | | | plications. | | +-------------+-------------+-------------+-------------+-------------+ | Originator | This | AS and | | No | | | sub-field | S-CSCF | | | | | of the | | | | | | \"List of | | | | | | Message | | | | | | Bodies\" | | | | | | indicates | | | | | | the | | | | | | originating | | | | | | party of | | | | | | the message | | | | | | body. | | | | +-------------+-------------+-------------+-------------+-------------+ | Access | This field | AS and | | No | | Network | contains | S-CSCF | | | | Information | the content | | | | | | of the | | | | | | first | | | | | | available | | | | | | SIP | | | | | | P-header | | | | | | \"P | | | | | | -Access-Net | | | | | | work-Info\" | | | | | | if | | | | | | available. | | | | +-------------+-------------+-------------+-------------+-------------+ | Additional | This field | AS and | | No | | Access | contains | S-CSCF | | | | Network | the content | | | | | Information | of an | | | | | | additional | | | | | | SIP | | | | | | P-header | | | | | | \"P | | | | | | -Access-Net | | | | | | work-Info\" | | | | | | if | | | | | | available. | | | | +-------------+-------------+-------------+-------------+-------------+ | List of | This field | AS only | Only used | No | | Access | is a list | | for SRVCC | | | Transfer | of grouped | | | | | Information | field | | | | | | describing | | | | | (grouped | the | | | | | field) | subsequent | | | | | | session | | | | | | transfers. | | | | | | | | | | | | Each other | | | | | | occurrence | | | | | | comprises | | | | | | sub-fields | | | | | | describing | | | | | | the session | | | | | | transfer | | | | | | performed. | | | | +-------------+-------------+-------------+-------------+-------------+ | Access | This field | AS only | Only used | No | | Transfer | contains | | for SRVCC | | | Type | indication | | | | | | about the | | | | | | access | | | | | | transfer | | | | | | performed. | | | | | | This field | | | | | | is present | | | | | | only when | | | | | | transfer | | | | | | occurred. | | | | +-------------+-------------+-------------+-------------+-------------+ | Inter-UE | This field | AS only | Only used | No | | Transfer | indicates | | for SRVCC | | | | that an | | | | | | inter-UE | | | | | | access | | | | | | transfer | | | | | | has been | | | | | | performed. | | | | | | This field | | | | | | is present | | | | | | only when | | | | | | transfer | | | | | | occurred. | | | | +-------------+-------------+-------------+-------------+-------------+ | Access | This field | AS only | Only used | No | | Network | holds the | | for SRVCC | | | Information | content of | | | | | | one SIP | | | | | | P-header | | | | | | \"P | | | | | | -Access-Net | | | | | | work-Info\" | | | | | | from the | | | | | | SIP INVITE | | | | | | requesting | | | | | | the | | | | | | transfer, | | | | | | if | | | | | | available. | | | | +-------------+-------------+-------------+-------------+-------------+ | Additional | This field | AS only | Only used | No | | Access | contains | | for SRVCC | | | Network | the content | | | | | Information | of an | | | | | | additional | | | | | | SIP | | | | | | P-header | | | | | | \"P | | | | | | -Access-Net | | | | | | work-Info\" | | | | | | from the | | | | | | SIP INVITE | | | | | | requesting | | | | | | the | | | | | | transfer, | | | | | | if | | | | | | available. | | | | +-------------+-------------+-------------+-------------+-------------+ | Related IMS | This field | AS only | Only used | No | | Charging | contains | | for SRVCC | | | Identifier | the related | | | | | | IMS | | | | | | Charging | | | | | | Identifier | | | | | | in case of | | | | | | access | | | | | | transfer. | | | | +-------------+-------------+-------------+-------------+-------------+ | Related IMS | This | AS only | Only used | No | | Charging | parameter | | for SRVCC | | | Identifier | holds the | | | | | Generation | identifier | | | | | Node | of the | | | | | | server that | | | | | | generated | | | | | | the Related | | | | | | IMS | | | | | | charging | | | | | | identifier. | | | | +-------------+-------------+-------------+-------------+-------------+ | Access | This field | AS only | Only used | | | Transfer | contains | | for SRVCC | | | Time | the time | | | | | | stamp, | | | | | | which | | | | | | indicates | | | | | | the time at | | | | | | which the | | | | | | session | | | | | | transfer | | | | | | has been | | | | | | performed. | | | | +-------------+-------------+-------------+-------------+-------------+ | Service | Holds the | AS and | The Service | No | | Context Id | context | S-CSCF | context | | | | information | | will only | | | | to which | | contain | | | | the CDR | | more | | | | belongs. | | generic | | | | The | | information | | | | information | | about the | | | | is obtained | | used | | | | from the | | service as | | | | Operation | | follows: | | | | Token of | | | | | | the | | 3225 | | | | Charging | | 1\@3gpp.org | | | | Data | | for PS | | | | Request | | charging | | | | message. | | | | | | | | 3226 | | | | | | 0\@3gpp.org | | | | | | for IMS | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 0\@3gpp.org | | | | | | for MMS | | | | | | service | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 1\@3gpp.org | | | | | | for LCS | | | | | | service | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 2\@3gpp.org | | | | | | for PoC | | | | | | service | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 3\@3gpp.org | | | | | | for MBMS | | | | | | service | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 4\@3gpp.org | | | | | | for SMS | | | | | | service | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 5\@3gpp.org | | | | | | for MMTel | | | | | | service | | | | | | charging | | | | | | | | | | | | 3227 | | | | | | 6\@3gpp.org | | | | | | for VCS | | | | | | charging | | | | | | | | | | | | 3228 | | | | | | 0\@3gpp.org | | | | | | for AoC | | | | | | Service | | | | | | Information | | | | | | | | | | | | 3229 | | | | | | 6\@3gpp.org | | | | | | for ABMF Rc | | | | | | information | | | | | | | | | | | | Thus not | | | | | | done for | | | | | | specific | | | | | | a | | | | | | pplications | | | | | | at the | | | | | | server. | | +-------------+-------------+-------------+-------------+-------------+ | IMS | This field | AS and | This | No | | Co | contains | S-CSCF | information | | | mmunication | the IMS | | will be | | | Service ID | co | | setup by | | | | mmunication | | the UE and | | | | service | | sent | | | | identifier | | towards the | | | | if received | | AS. It will | | | | in the | | not 100% | | | | P-Asser | | identify | | | | ted-Service | | the service | | | | header in | | used. The | | | | the SIP | | information | | | | request. | | is used for | | | | | | triggering | | | | | | specific | | | | | | AS. | | +-------------+-------------+-------------+-------------+-------------+ | Online | This field | AS and | | No | | Charging | indicates | S-CSCF | | | | Flag | the Online | | | | | | Charging | | | | | | Request was | | | | | | sent based | | | | | | on the | | | | | | provided | | | | | | ECF address | | | | | | from the | | | | | | SIP | | | | | | P-header | | | | | | \ | | | | | | "P-Charging | | | | | | -Function-A | | | | | | ddresses\". | | | | | | | | | | | | NOTE: No | | | | | | proof that | | | | | | online | | | | | | charging | | | | | | action has | | | | | | been taken | | | | +-------------+-------------+-------------+-------------+-------------+ | Real Time | This field | AS and | Only tariff | No | | Tariff | holds the | S-CSCF | information | | | Information | ta | | so not | | | | riff/add-on | | usable for | | | | charge | | c | | | | received. | | orrelation. | | +-------------+-------------+-------------+-------------+-------------+ | Initial IMS | This | AS only | Only for | No | | Charging | parameter | | SRVCC | | | Identifier | holds the | | | | | | Initial IMS | | | | | | charging | | | | | | identifier | | | | | | (ICID) as | | | | | | generated | | | | | | by the IMS | | | | | | node for | | | | | | the initial | | | | | | SIP session | | | | | | created for | | | | | | IMS service | | | | | | continuity. | | | | | | | | | | | | This field | | | | | | is not used | | | | | | for the | | | | | | \"OneChargi | | | | | | ngSession\" | | | | | | option. | | | | +-------------+-------------+-------------+-------------+-------------+ | From | Contains | AS and | Due to | partly | | Address | the | S-CSCF | B2BUA | | | | information | | procedures | | | | from the | | the From | | | | SIP From | | header may | | | | header. | | be changed | | +-------------+-------------+-------------+-------------+-------------+ | IMS Visited | Contains | AS and | Only usable | No | | Network | the | S-CSCF | when | | | Identifier | information | | roaming and | | | | from the | | will not be | | | | SIP | | available | | | | P-Visited | | in all | | | | -Network-ID | | calls. | | | | header | | | | | | received in | | | | | | a REGISTER | | | | | | request. | | | | +-------------+-------------+-------------+-------------+-------------+ | SIP Route | Contains | S-CSCF only | This is the | No | | header | the | | incoming | | | received | information | | Route | | | | in the | | header. | | | | topmost | | Thus it | | | | route | | does only | | | | header in a | | contain | | | | received | | routeing | | | | initial SIP | | information | | | | INVITE or | | towards the | | | | non-session | | S-CSCF | | | | related SIP | | (i.e. | | | | MESSAGE | | S-CSCF | | | | request | | Address) | | | | prior to | | and does | | | | triggering | | not contain | | | | of any ASs. | | the AS | | | | This field | | i | | | | is present | | nformation. | | | | only for | | | | | | requests | | | | | | from the | | | | | | served | | | | | | user. | | | | +-------------+-------------+-------------+-------------+-------------+ | SIP Route | Contains | S-CSCF only | This is the | No | | header | the | | outgoing | | | transmitted | information | | Route | | | | in the | | header of | | | | route | | the S-CSCF. | | | | header | | Thus | | | | r | | it does | | | | epresenting | | only | | | | the | | contain | | | | destination | | routeing | | | | in a | | information | | | | transmitted | | towards the | | | | SIP INVITE | | terminating | | | | or | | P-CSCF, and | | | | non-session | | does not | | | | related SIP | | contain the | | | | MESSAGE | | AS. | | | | request | | | | | | following | | | | | | triggering | | | | | | of all | | | | | | application | | | | | | servers. | | | | | | This field | | | | | | is present | | | | | | for | | | | | | requests | | | | | | toward the | | | | | | served user | | | | | | and for | | | | | | requests | | | | | | from the | | | | | | served user | | | | | | when "VPLMN | | | | | | routing\" | | | | | | is applied | | | | | | in a | | | | | | Roaming | | | | | | A | | | | | | rchitecture | | | | | | for Voice | | | | | | over IMS | | | | | | with Local | | | | | | breakout. | | | | +-------------+-------------+-------------+-------------+-------------+ | Subscriber | This field | AS and | This | No | | Equipment | contains | S-CSCF | information | | | Number | the | | will be | | | | ide | | terminated | | | | ntification | | within the | | | | of the | | AS and not | | | | mobile | | sent back | | | | device ( | | to the | | | | e.g. IMEI) | | S-CSCF. | | | | that the | | | | | | subscriber | | | | | | is using. | | | | +-------------+-------------+-------------+-------------+-------------+ | Instance Id | This field | AS and | Is used for | No | | | uniquely | S-CSCF | GRUU | | | | identifies | | addressing | | | | the device | | thus | | | | (fixed or | | | | | | mobile) of | | | | | | the served | | | | | | user. | | | | +-------------+-------------+-------------+-------------+-------------+ | Record | A set of | AS and | Only | No | | Extensions | operator/m | S-CSCF | proprietary | | | | anufacturer | | i | | | | specific | | nformation. | | | | extensions | | | | | | to the | | | | | | record, | | | | | | conditioned | | | | | | upon | | | | | | existence | | | | | | of an | | | | | | extension. | | | | +-------------+-------------+-------------+-------------+-------------+
# 5 Description of scenarios
## 5.1 Methodology
Section 5 describes key IMS scenarios for identifying key issues in
determination of charging data completeness.
For these key issues described in clause 6, alternatives methods are studied
to ensure that all the relevant charging data for an IMS session has been
received in order to charge the IMS session correctly. Each method is
evaluated and a recommendation is made.
Final recommendations are summarized in clause 7.
## 5.2 Scenario 1 MMTel
## 5.2.1 Description of scenario
\- Vast majority of users A are only subscribed to Multimedia Telephony
Service (TS 22.173 [108]).
\- \"Calling Party Pays\" charging model is applicable (TS 22.115[102]).
\- MMTel AS CDR provides sufficient accounting information to charge the call.
For this scenario, the Application Servers information stored in the S-CSCF
CDR is sufficient for the Billing Domain (BD) to know that there is a CDR
required from the MMTel server and that BD could be aware that the MMTel
server only hosts one service that can be executed to ensure that it has all
the necessary CDRs.
Figure 5.2.1.1
The fields used for correlation may be:
Application Servers Information and IMS Charging Identifier (ICID) tracked in
the S-CSCF are normally sufficient to identify the all CDR for a specific
call. The Application Servers Information will contain Application Server
Involved and Application Provided Called Parties. i.e. the MMTEL URI and the
B-Party.
Same belongs to AS acting as B2BUA when the OneChargingSession option applies.
But when the AS acting as B2BUA changes the ICID depending on the service
invoked either one or two charging sessions have to be opened. In case two
charging sessions will apply (e.g. CDIV) the AS and S-CSCF has to fill the
CDR\'s to identify the information needed for each charging session. In case
only one charging session applies then additional values needed to be
considered. The Session ID and Outgoing Session ID are needed in addition to
identify the bindings.
In case of CDIV the C-Party is also included within the Application Provided
Called Parties.
Table 5.2.1.1
+----------------------------------+----------------------------------+ | Field | Description | +----------------------------------+----------------------------------+ | Application Servers Information | This a grouped CDR field | | | containing the fields: | | | \"Application Server Involved\" | | | and \"Application Provided | | | Called Parties \". | +----------------------------------+----------------------------------+ | Application Servers Involved | The URI Addresses of the MMTEL | | | or possibly concatenated MMTELs | | | included within this field. | | | | | | e.g. MMTel_OIP@operator.net; | | | MMTEL_CB\@operator.net | +----------------------------------+----------------------------------+ | Application Provided Called | Will contain the B-Party URI. | | Parties | | | | Possibly are routed C-Party URI | | | if changed by the EBS AS | +----------------------------------+----------------------------------+
### 5.2.2 Further considerations with the MMTEL when acting as B2BUA
This clause gives additional information about the service behaviour and if
only the ICID and Application Servers Information given within the S-CSCF CDR
is sufficient for correlation information. The OneChargingSession would help
to avoid more complex correlation.
In cases when the AS is acting as B2BUA two options may apply. Either the ICID
may change or the ICID will be kept the same due to the OneChargingSession
feature applied. This section shows where the OneChargingSession applies
The following Services may be applied by the MMTEL with the related session
model.
Table 5.2.2.1
+----------------------+----------------------+----------------------+ | Service applied by | Comments | One Charging Session | | AS | | ? | +----------------------+----------------------+----------------------+ | OIP | Presentation of | Yes | | | Number maybe | | | | manipulation of From | | | | header. No Call Leg | | | | manipulation. | | +----------------------+----------------------+----------------------+ | OIR | Restriction of | Yes | | | Number. | | | | P-Asserted-Identity | | | | and From header | | | | manipulation but No | | | | Call Leg | | | | manipulation. | | +----------------------+----------------------+----------------------+ | TIP | Presentation of | Yes | | | called number. No | | | | Call Leg | | | | manipulation | | +----------------------+----------------------+----------------------+ | TIR | Restriction of | Yes | | | Number. | | | | P-Asserted-Identity | | | | and From header | | | | manipulation but No | | | | Call Leg | | | | manipulation. | | +----------------------+----------------------+----------------------+ | HOLD | Manipulation of call | Yes | | | leg from active to | | | | inactive and vice | | | | versa. But no change | | | | of A- and B-Party | | +----------------------+----------------------+----------------------+ | CB | Session will not be | Yes | | | established. | | | (IBC, ACR. OCB) | | | +----------------------+----------------------+----------------------+ | CDIV | Forwards call to a | No | | | new destination. For | | | | the diverting user a | | | | separate charging | | | | dialog is needed. | | | | | | | | Charging at the | | | | S-CSCF is done in | | | | alignment with the | | | | TS 32.260 [20] but | | | | the S-CSCF has no | | | | knowledge of the | | | | CDIV service. | | +----------------------+----------------------+----------------------+ | CW | Call will be set to | Yes | | | waiting status and | | | | will not consume | | | | resources as long as | | | | it is not active. | | +----------------------+----------------------+----------------------+ | ECT | Party involved in a | Yes | | | communication | | | | transfer that | | | | communication to a | | | | third party. | | +----------------------+----------------------+----------------------+ | MWI | AS indicates to the | Yes | | | subscriber, that | | | | there is at least | | | | one message waiting. | | +----------------------+----------------------+----------------------+ | **CONF** | Enables a user to | No | | | participate in and | | | | control a | | | | simultaneous | | | | communication | | | | involving a number | | | | of users. A separate | | | | charging dialog at | | | | the SIP AS is | | | | needed. | | +----------------------+----------------------+----------------------+ | **CCBS** | Call back service | Yes (The recall | | | when B party was | itself) | | | busy. A new recall | | | | dialog will be | No (Call try and | | | created but it is an | recall are separate | | | normal end to end | and arecorrelated) | | | call. | | +----------------------+----------------------+----------------------+ | **CCNR** | Call back service | Yes(The recall | | | when B party was not | itself) | | | reachable. A new | | | | recall dialog will | No (Call try and | | | be created but it is | recall are separate | | | an normal end to end | and are correlated) | | | call. | | +----------------------+----------------------+----------------------+ | **FA** | Branch the call into | Yes | | | several legs to | | | | alert several | | | | termination | | | | addresses (FA group | | | | members) | | | | simultaneously. | | | | | | | | S-CSCF will have no | | | | knowledge of the FA | | | | service | | +----------------------+----------------------+----------------------+ | MCID | Enables an incoming | Yes | | | communication to be | | | | identified as | | | | malicious and | | | | registered | | +----------------------+----------------------+----------------------+ | CAT | Operator specific | Yes | | | service where an | | | | operator enables the | | | | subscriber to | | | | customize the | | | | alerting tone which | | | | is played to the | | | | calling party | | | | | | | | The service itself | | | | is owned by the B | | | | Party, but the | | | | session itself is | | | | one. | | +----------------------+----------------------+----------------------+ | CUG | Enables users to | Yes | | | form groups of | | | | members, whose | | | | communication | | | | profile is | | | | restricted for | | | | incoming and | | | | outgoing | | | | communications. | | +----------------------+----------------------+----------------------+ | PNM | Allows a user to | Yes | | | manage his UEs in | | | | regard to | | | | terminating services | | | | according to | | | | preferences set by | | | | the user, | | | | capabilities and | | | | availabilities of | | | | devices. | | +----------------------+----------------------+----------------------+ | CRS | Operator specific | Yes | | | service by which an | | | | operator enables the | | | | subscriber to | | | | customize the | | | | ringing signal which | | | | is played to the | | | | called party | | +----------------------+----------------------+----------------------+ | Reverse charging | Enables that at | Yes | | | communication set up | | | | allows that the | | | | terminating party to | | | | be charged for the | | | | entire | | | | communication. | | | | | | | | Note: There is no | | | | stage 3 description | | | | for Reverse Charging | | | | in this Release: | | | | FFS. | | +----------------------+----------------------+----------------------+ | AOC | Allows the served | Yes | | | user to be provided | | | | with charging | | | | information related | | | | at call setup, | | | | during call and end | | | | of the call. | | +----------------------+----------------------+----------------------+
## 5.3 Scenario 2 TelCo enterprise service
\- Minor group of users are subscribed to Multimedia Telephony Service (TS
22.173 [108]) and additionally to Enterprise Billing Service (EBS).
\- EBS Service enables:
\- Charging of session and service to 3rd party (TS 22.115 [102])
\- Both MMTel AS and EBS AS provide accounting-relevant information.
For this scenario, the Application Servers Information stored in the S-CSCF
CDR is sufficient for the BD to know that there is a CDR required from the
MMTel server and EBS Server and that BD could be aware that both the MMTel
server and EBS server only host one service that can be executed to ensure
that it has all the necessary CDRs.
Figure 5.3.1
The fields used for correlation may be:
Application Servers Information and IMS Charging Identifier (ICID) are
normally sufficient to identify the all CDR for a single SIP Session.
Same belongs to MMTEL AS and EBS AS acting as B2BUA when the
OneChargingSession option applies.
It may be that AS acting as B2BUA changes the ICID depending on the service
invoked either one or two charging sessions have to be opened. In case two
charging sessions will apply (e.g. CDIV) the AS and S-CSCF has to fill the
CDR\'s to identify the information needed for each charging session. In case
only one charging session applies then additional values needed to be
considered. The Session ID and Outgoing Session ID are needed in addition to
identify the bindings.
Table 5.3.1
+----------------------------------+----------------------------------+ | Field | Description | +----------------------------------+----------------------------------+ | Application Servers Information | This a grouped CDR field | | | containing the fields: | | | \"Application Server Involved\" | | | and \"Application Provided | | | Called Parties\". | +----------------------------------+----------------------------------+ | Application Servers Involved | The URI Addresses of the MMTEL | | | (or possibly concatenated | | | MMTELs) and the EBS AS will be | | | included within this field. | +----------------------------------+----------------------------------+ | Application Provided Called | Will contain the B-Party URI. | | Parties | | | | Possibly are routed C-Party URI | | | if changed by the EBS AS. | +----------------------------------+----------------------------------+
## 5.4 Scenario 3: Enhanced Multimedia Telephony (EMT)
\- User A is subscribed to Multimedia Telephony Service (TS 22.173 [108]).
\- Additionally User A is subscribed to EMT Service, which invokes App1.
\- Two applications resides on same generic service platform SIP-AS:
\- App1: Filtering/manipulation of customer-specific headers. No CDR is
written.
\- App2: Tailored implementation of call leg manipulation.\ Would write CDRs
in case of invocation. But is not invoked in this example.
\- In case of involvement of App1, MMTel AS provide sufficient accounting
information.
In case of involvement of App2, accounting information of both services a
correlation is needed for this scenario, since CDRs may be generated by the
SIP AS, the Application Server Information stored in the S-CSCF CDR is not
sufficient for the BD to know which CDRs may be required from the SIP AS
server.
Figure 5.4.1
The fields used for correlation may be:
As identified above it is not sufficient to take the Application Servers
Information in the S-CSCF CDR to have the information which AS will have
further CDR\'s created. Thus a correlation can only be done within the BD with
more identifiers.
The Application Servers Information will point to the SIP AS. The IMS Charging
Identifier (ICID) is normally sufficient to identify the all CDR for a single
SIP Session. In cases the ICID will not be changed all CDR\'s created for the
SIP AS applications and the MMTEL needs to be evaluated to find the fitting
data.
When the ICID changes due to B2BUA behaviour the BD needs to evaluate in
addition.
Same belongs to MMTEL AS and SIP AS acting as B2BUA when the
OneChargingSession option applies.
It may be that AS acting as B2BUA changes the ICID depending on the service
invoked either one or two charging sessions have to be opened. In case two
charging sessions will apply (e.g. CDIV) the AS and S-CSCF has to fill the
CDR\'s to identify the information needed for each charging session. In case
only one charging session applies then additional values needed to be
considered. The Session ID and Outgoing Session ID are needed in addition to
identify the bindings.
Table 5.4.1
+----------------------------------+----------------------------------+ | Field | Description | +----------------------------------+----------------------------------+ | Application Servers Information | This a grouped CDR field | | | containing the fields: | | | \"Application Server Involved\" | | | and \"Application Provided | | | Called Parties \". | +----------------------------------+----------------------------------+ | Application Servers Involved | The URI Addresses of the MMTEL | | | (or possibly concatenated | | | MMTELs) and the SIP AS will be | | | included within this field | +----------------------------------+----------------------------------+ | Application Provided Called | Will contain the B-Party URI. | | Parties | | | | Possibly are routed C-Party URI | | | if changed by the SIP AS | +----------------------------------+----------------------------------+
## 5.5 Scenario 4: Small Business Telephony (SBT)
\- User A is subscribed to Multimedia Telephony Service (TS 22.173 [108]).
\- Additionally User A is subscribed to SBT Service which invokes App2:
\- At end of call App2 terminates leg towards A-party including MMTel session
and connects B-party with an IVR e.g. collecting customer feedback.
\- In case of involvement of App2, accounting information of both services a
correlation is needed as MMTel CDR provides wrong service delivery end
timestamp.
For this scenario, since CDRs may be generated by the SIP AS, the Application
Server information stored in the S‑CSCF CDR is not sufficient for the BD to
know which CDRs are required from the SIP AS server.
For this scenario a correlation of MMTel-AS CDR and App2/SIP-AS CDR is
mandatory for a correct service charging.
Figure 5.5.1
The fields used for correlation may be:
As identified above it is not sufficient to take the Application Servers
Information in the S-CSCF CDR to have the information which AS will have
further CDR\'s created. This is due to the fact that the App\'s will create
the CDR information and the knowledge of the AS URS in the S-CSCF is not
enough. Thus a correlation can only be done within the BD with more
identifiers and evaluation of CDR\'s of all possible passed Functions.
The Application Servers Information will point to the SIP AS. The IMS Charging
Identifier (ICID) is normally sufficient to identify the all CDR for a single
SIP Session. In cases the ICID will not be changed all CDR\'s created for the
SIP AS applications and the MMTEL needs to be evaluated to find the fitting
data.
Since APP2 is releasing the leg to the A-Party and creating a new dialog to
the MRF sufficient information is only given within the APP2 CDR. Thus the BD
needs to correlate and search for all possible CDR information.
The use the OneChargingSession option would help for correlating all CDRs but
as already identified the S-CSCF CDR will not help to indicate which APPs have
created the CDR\'s.
Table 5.5.1
+----------------------------------+----------------------------------+ | Field | Description | +----------------------------------+----------------------------------+ | Application Servers Information | This a grouped CDR field | | | containing the fields: | | | \"Application Server Involved\" | | | and \"Application Provided | | | Called Parties \". | +----------------------------------+----------------------------------+ | Application Servers Involved | The URI Addresses of the MMTEL | | | (or possibly concatenated | | | MMTELs) and the SIP AS will be | | | included within this field. | +----------------------------------+----------------------------------+ | Application Provided Called | Will contain the B-Party URI. | | Parties | | | | Possibly are routed C-Party URI | | | if changed by the SIP AS | | | | | | BUT NOT the MRF URI | +----------------------------------+----------------------------------+
## 5.6 Scenario 5: Charging information from all IMS NEs including AS
Depending on the services being executed and the particular call type being
processed, information from additional IMS nodes, such as the MGCF may also be
required to correctly charge the subscriber.
In addition in the current IMS Charging, accounting information generated by
several network elements may neither be received in real-time nor be
synchronized. Currently charging information in CDR cannot enable the Billing
Domain (BD) to check integrity of IMS CDRs involved in an IMS call. This could
result in the incompleteness of IMS charging correlation.
Also, not all of IMS network elements involved in an IMS call generate
charging information since operators may configure just several IMS network
elements to generate charging information based on their requirements. This
means charging correlation is only applied to CDRs created by these configured
IMS network elements. Thus the Billing Domain needs to know which IMS network
element is generating offline charging information and is involved in the IMS
call to judge the integrity of IMS charging correlation.
In IMS Number Portability scenario, the following figure shows Call Flow from
the IMS Network to the PSTN or PLMN Network.
Figure 5.6.1: Call Flow from the IMS Network to the PSTN or PLMN Network
The call steps are as follows.
Step 1. 2. 3. A normal originating call flow.
Step 4. 5. CSCF queries the ENUM/NPDB for the home PSTN or PLMN network of the
called party.
Step 6. The calling network routes the call to the MGCF according to the query
result.
Step 7. A normal call flow on the called party in the PSTN or PLMN network.
In this example, it is supposed that operators don\'t need CDRs of all IMS NEs
involved in this call flow. For this example only S-CSCF, AS and MGCF are
configured to generate charging information. This means charging correlation
is only applied to CDRs created by these configured IMS network elements. Thus
the BD needs to know which IMS network element is generating offline charging
information and is involved in the IMS call to judge the integrity of IMS
charging correlation. However currently charging information in CDR is not
sufficient to enable the BD to check integrity of IMS CDRs required by
operators involved in an IMS call.
# 6 Key Issues
## 6.1 Key Issue #1
### 6.1.1 General
Currently the Billing Domain does not know which IMS network element is
generating offline charging information and is involved in an IMS call to
judge the integrity of IMS charging correlation. Charging information in CDR
cannot enable the Billing Domain (BD) to check integrity of IMS CDRs involved
in an IMS call.
### 6.1.2 Description
The incompleteness of IMS charging correlation can be caused by:
1\. Accounting information generated by several network elements may neither
be received in real-time nor be synchronized.
2\. Not all of IMS network elements involved in an IMS call generate charging
information since operators may configure just several IMS network elements to
generate charging information based on their requirements. This means charging
correlation is only applied to CDRs created by these configured IMS network
elements.
### 6.1.3 Assumptions
In scenario 5, it is supposed that operators don\'t need CDRs of all IMS NEs
involved in this call flow and only S-CSCF, AS and MGCF are configured to
generate charging information. This means charging correlation is only applied
to CDRs created by these configured IMS network elements (S-CSCF, AS and
MGCF). Thus the Billing Domain needs to know which IMS network element is
generating offline charging information and is involved in the IMS call to
judge the integrity of IMS charging correlation.
### 6.1.4 Current status
Currently charging information in CDR is not sufficient to enable the Billing
Domain (BD) to check integrity of IMS CDRs required by operators involved in
an IMS call. Some information should be considered to be provided by CDR to
satisfy the determination of completeness of charging information in IMS.
### 6.1.5 Alternative options
#### 6.1.5.1 Alternative 1 - SIP information which element writes a CR
The main idea is if an IMS NE is configured to generate charging information,
when the IMS NE receives a SIP INVITE message, this IMS NE inserts its address
into next SIP INVITE message to be sent out within the trust domain. And
addresses of all IMS NEs configured to generate charging information will be
taken back to P-CSCF in SIP 200ok response. Then the addresses of all IMS NEs
configured to generate charging information will be sent to CDF via offline
charging interface, which can enable the Billing Domain (BD) to check
integrity of IMS CDRs required by operators involved in an IMS call. Figure
6.1.5.1.1 illustrates an alternative solution of the example in clause 6.1.2
and the assumption is only S-CSCF, AS and MGCF are configured by operators to
generate charging information.
Figure 6.1.5.1.1: Message flow from the IMS Network to the PSTN or PLMN
Network
#### 6.1.5.2 Alternative 2 - Furnish Charging Information to CTF
This alternative proposes a flexible mechanism that allows an operator to
identify charging data to be sent between IMS nodes to enable a single CTF to
generate data, not only for its own services, but also include data from other
nodes. This will make it possible to remove or reduce the need for aggregation
of charging data in the Billing Domain and enable real-time charging using
data generated at multiple IMS nodes in a single session.
Each IMS node is able to add charging data to the SIP signalling between IMS
nodes. It is expected that this would apply to SIP session related and
unrelated requests and responses in order to not exclude any CTF within IMS.
The charging data should be added by a node to a container in a structured way
so that the node can find its own data if required to remove or update it
later in the same session. The data should also be identifiable by the Billing
Domain to simplify its further actions. Since this data is useful only with an
operator domain, it should be removed by a SIP node at the network boundary. A
version of this mechanism was defined for the transport of transit IOI
information in the P-Charging-Vector using the Relayed-Charge header field in
TS 24.229 [106].
Upon receipt of this additional charging data via SIP, the CTF will include
this data in the next charging trigger message or, based on configuration,
trigger an update for an existing charging session.
An example of a SIP AS as the CTF and MGCF with the proposed solution is
depicted in figure 6.1.5.2.1. As can be seen, a set of charging data
containing the selected trunk group is delivered to the SIP AS in a SIP
response message. This data is included in charging messages generated by the
SIP AS.
Figure 6.1.5.2.1: Example CDR generation from SIP AS with charging data from
MGCF
The introduction of the furnish charging information capability will:
a) Reduce and possibly remove the need for aggregation of charging data.
b) Allow an operator to delegate IMS charging to a single node for generation
of charging data.
c) Introduce mechanism for nodes to send data to the Billing Domain in a
flexible way without a CTF necessarily being aware of the content.
d) Directly extensible to online charging from the SIP AS.
#### 6.1.5.3 Alternative 3 - Definition of a type of call
Idea is to use an indication mechanism which elements have written CDR\'s for
specific call scenarios.
This indication will define the type of call which will then be reflected to a
profile which NE\'s are creating CDR\'s.
A type of call could be: PSTN terminating call, IMS terminating call from
PSTN, roaming originating call in the visited network etc.
E.g if the call is a terminating IMS call coming from the PSTN an indication
is included within the call to indicate that this is a IMS terminating call
only. And based on operator configuration only specific NE\'s are creating
CDR\'s.
Such an indication for the type of call included within the INVITE and/or the
related responses can then be used within the BD to identify for which
indication which CDR\'s were generated.
The indication for a type of call has the advantage that the length of the
INVITE and other messages will not increase too much.
On the other side the network needs a method to guarantee the identification
of types so that each call scenario can be indicated by a type of call.
#### 6.1.5.4 Alternative 4 - Subscribe/Notify for CDR events
Alternative 4 is shown more for Completeness what may be possible for
correlation purposes.
The SIP SUBCRIBE/NOTIFY mechanism may be used to indicate when CDR\'s are
created in NE\'s. The idea is that an AS will subscribe to each NE generating
CDR\'s This AS will collect all NOTIFY Messages to get the indication which NE
creates a CDR for a specific call. This will then help at correlation level
because the information is given which NE created a CDR for a specific call.
Figure 6.1.5.4.1: Principle of SIP SUBSCRIBE NOTIFY
Drawback is that an enormous message load will appear where the NE\'s are
sending SIP NOTIFY to the AS.
Also the reliability of the received SIP NOTIFY may not be guaranteed and will
lead to the same problems with a normal CDR correlation within the BD.
### 6.1.6 Evaluation and recommendation
#### 6.1.6.1 Evaluation
The comparison and evaluation are provided in the subclause.
The table 6.1.6.1 provides a comparison of the different solutions in the
clause 6.1.5.
Table 6.1.6.1: solutions evaluation
+-------------+-------------+-------------+-------------+-------------+ | | Solution 1 | Solution 2 | Solution 3 | Solution 4 | +-------------+-------------+-------------+-------------+-------------+ | TR clause | 6.1.5.1 | 6.1.5.2 | 6.1.5.3 | 6.1.5.4 | +-------------+-------------+-------------+-------------+-------------+ | Short | IMS NE | A SIP node | Use an | An AS for | | description | configured | may | indication | correlation | | | to generate | transfer | mechanism | is required | | | charging | charging | to specify | to | | | information | data by SIP | specific | subscribe | | | inserts its | signalling | call | to each NE | | | address | to another | scenarios. | generating | | | into next | node acting | This | CDR\'s. | | | SIP INVITE | as CTF. | indication | This AS | | | message to | Upon | will define | will | | | be sent out | receipt of | the type of | collect all | | | within the | this | call | NOTIFY | | | trust | additional | r | Messages to | | | domain. And | charging | epresenting | get the | | | addresses | data via | a profile | indication | | | of all IMS | SIP, the | which NE\'s | which NE | | | NEs | CTF of | are | creates a | | | configured | other node | creating | CDR for a | | | to generate | will | CDR\'s. | specific | | | charging | include | | call. | | | information | this data | | | | | will be | in the next | | | | | taken back | charging | | | | | to P-CSCF | trigger | | | | | in SIP | message or, | | | | | 200ok | based on | | | | | response. | con | | | | | | figuration, | | | | | | trigger an | | | | | | update for | | | | | | an existing | | | | | | charging | | | | | | session. | | | +-------------+-------------+-------------+-------------+-------------+ | Impact on | None | None | None | None | | Roaming | | | | | | agreements | | | | | +-------------+-------------+-------------+-------------+-------------+ | Flexibility | Fully | Fully | Not | Fully | | | flexible: | flexible: | flexible: | flexible: | | | the | the | To maintain | the | | | solution | solution | the mapping | solution | | | enables | enables | of the | enables | | | operator to | operator to | indication | operator to | | | change | change | of call | change | | | co | co | type and | co | | | nfiguration | nfiguration | the | nfiguration | | | at any | at any | addresses | at any | | | time. No | time. No | of | time. No | | | need to | need to | c | need to | | | maintain | maintain | onfigurered | maintain | | | any mapping | any mapping | NEs | any mapping | | | r | r | generating | r | | | elationship | elationship | charging | elationship | | | between NE | between NE | information | between NE | | | configured | configured | is | configured | | | to generate | to generate | necessary. | to generate | | | charging | charging | If a | charging | | | information | information | specific | information | | | and other | and other | call type | and other | | | additional | additional | has several | additional | | | i | i | different | i | | | nformation. | nformation. | con | nformation. | | | | | figurations | | | | | | of NEs | | | | | | generating | | | | | | charging | | | | | | i | | | | | | nformation, | | | | | | the | | | | | | original | | | | | | indicarion | | | | | | of call | | | | | | type has to | | | | | | be extended | | | | | | again. | | +-------------+-------------+-------------+-------------+-------------+ | Impact 3GPP | SIP message | SIP header | An | An AS is | | | extension | and main | indication | introduced | | | is required | body is | of call | just for | | | to take | required to | type is | charging | | | back | be | introduced | correlation | | | addresses | extended. | to identify | and enomous | | | of all IMS | | each call | message | | | NEs | CT1 is | scenario. | load of | | | configured | required to | Who does | subsc | | | to generate | implement. | it? SA1 may | ribe/notify | | | charging | | be | may occur | | | i | | affected? | in this | | | nformation. | | | case. It | | | | | Even if the | has big | | | CT1 is | | mapping of | impacts on | | | required to | | the | SA2 and | | | implement. | | indication | CT1. | | | | | of call | | | | | | type with | | | | | | each call | | | | | | scenario is | | | | | | defined, | | | | | | SIP message | | | | | | is required | | | | | | to be | | | | | | extended to | | | | | | include the | | | | | | indication | | | | | | of call | | | | | | type. And | | | | | | it still | | | | | | has impacts | | | | | | on SA2 and | | | | | | CT1. | | | | | | | | | | | | BD is | | | | | | required to | | | | | | maintain | | | | | | the mapping | | | | | | of the | | | | | | indication | | | | | | of call | | | | | | type and | | | | | | the | | | | | | addresses | | | | | | of | | | | | | c | | | | | | onfigurered | | | | | | NEs | | | | | | generating | | | | | | charging | | | | | | i | | | | | | nformation. | | +-------------+-------------+-------------+-------------+-------------+ | Issues/ | None | 1 | 1) the | 1) an | | limitations | | ) Operator | > ide | | | | | must | ntification | enormous | | | | decide | > of | message | | | | which | > call | load | | | | | > types | may | | | | information | > must | appear | | | | | > be | where | | | | transferred | > | the | | | | by SIP | guaranteed | NE\'s | | | | instead | > by | are | | | | of | > the | sending | | | | | | SIP | | | | generating | > network | NOTIFY | | | | CDRs. | > so | to the | | | | | > that | AS. | | | | 2) | > each | | | | | Extensive | > call | 2) the | | | | use of | | | | | | this | > scenario | reliability | | | | | > can | of the | | | | mechanism | > be | | | | | may | | received | | | | lead to | > indicated | SIP | | | | a very | > by a | NOTIFY | | | | large | > type | may not | | | | SIP | > of | be | | | | | > call | | | | | message. | > and | guaranteed | | | | | > it's | and | | | | | > hard. | will | | | | | | lead to | | | | | 2) To | the | | | | | | same | | | | | > maintain | | | | | | > the | problems | | | | | | with a | | | | | > mapping | normal | | | | | > of | CDR | | | | | > the | | | | | | > | correlation | | | | | indication | within | | | | | > of | the BD. | | | | | > call | | | | | | > type | | | | | | > and | | | | | | > the | | | | | | | | | | | | > addresses | | | | | | > of | | | | | | > c | | | | | | onfigurered | | | | | | > NEs | | | | | | > | | | | | | generating | | | | | | | | | | | | > charging | | | | | | > | | | | | | information | | | | | | > is | | | | | | > | | | | | | necessary. | | | | | | > If a | | | | | | | | | | | | > specific | | | | | | > call | | | | | | > type | | | | | | > has | | | | | | | | | | | | > several | | | | | | | | | | | | > different | | | | | | > con | | | | | | figurations | | | | | | > of | | | | | | > NEs | | | | | | > | | | | | | generating | | | | | | | | | | | | > charging | | | | | | > i | | | | | | nformation, | | | | | | > the | | | | | | | | | | | | > original | | | | | | > | | | | | | indicarion | | | | | | > of | | | | | | > call | | | | | | > type | | | | | | > has | | | | | | > to be | | | | | | | | | | | | > extended | | | | | | | | | | | | > again. | | +-------------+-------------+-------------+-------------+-------------+
#### 6.1.6.2 Recommendation
The recommendation is to select the solution 1 for fast implementation and
small impacts on CT1.
Further exchange on SIP header extension is required between SA5 and CT1.
## 6.2 Key Issue #2:
### 6.2.1 Description
The Billing Domain has currently no way to determine which applications are
invoked by an AS involved in an IMS session, when multiple applications are
hosted in the same AS. Besides, there is no way to determine which
applications hosted on the same AS are configured to generate charging
information. Therefore, the Billing Domain cannot determine the completeness
of charging information for a given IMS session.
### 6.2.2 Assumptions
The following assumptions are made:
\- Each invoked application may generate its own charging information in a
dedicated charging session, which means an AS hosting multiple applications
may manage several charging session leading to several CDRs covering the same
IMS session.
\- Whether an invoked application generates charging information or not is
operator configurable.
### 6.2.3 Current status
As illustrated in scenario 3 and 4 in clause 5, an AS involved in an IMS
session may invoke one or more hosted applications. The AS information stored
in the S-CSCF CDR provides the list of all AS involved in an IMS session.
However the list of applications per involved AS, which are invoked and
configured to generate charging information is not available in any IMS CDR.
### 6.2.4 Alternative options
#### 6.2.4.1 Alternative 1 - SIP Indication which Application is involved in
Call
Improve solution described in subclause 6.1.5.1 for AS, so that if an involved
SIP AS and one or more invoked application hosted on this AS are configured to
generate charging information, this AS should insert a list of application
specific identifiers in addition to the AS address into the next SIP INVITE
message to be forwarded to the trusted domain. Only the identifier of
application invoked and configured to generate charging information is
included in the list. The type of identifier to be included in the list could
be possibly the IMS Application Reference Identifier described in subclause
4.3.2. Figure 6.2.5.1.1 illustrates the use of this solution for scenario 4
described in subclause 5.5. In this example, only S-CSCF, MMTel AS, SIP AS and
associated application are configured to generate charging information, and
considered to be in the trusted domain.
Figure 6.2.4.1.1: Message flow from the IMS Network for use of solution for
scenario 4
#### 6.2.4.2 Alternative 2 - One CDR per AS
Introduce the requirement that one AS should not generate different CDRs per
applications invoked and configured to generate charging information. If
generated, the AS CDR should include all specific information for invoked
applications which are configured to generate charging information. In case
this requirement is met, the proposed solution described in subclause 6.1.5.1
is sufficient to determine the completeness of charging information for
scenario 4 described in subclause 5.5.
### 6.2.5 Evaluation
The introduction of both solution 1 and 2 has the following impacts with
regard to the 3GPP standard:
\- Update of the SIP protocol used for IMSto reflect addresses of IMS NEs
configured to generate charging information for the SIP session, as described
in subclause 6.1.5.1.
\- Update of all the IMS CDR definition, in order to record the list of
invoked IMS nodes (and invoked application for solution 2) which are
configured to generate charging information.
Compared to solution 1, solution 2 requires only one offline charging session
per AS and per IMS session, irrespective of the number of invoked
applications, which allows the followings:
\- Minimizing information redundancy by gathering charging information in a
single CDR per IMS session.
\- Optimizing the number of Charging Data Request per IMS session.
\- Optimizing the number of CDRs to correlate per IMS session.
Unless the set of invoked application is limited to the supplementary service
defined in [35] is sufficient, solution 1 is more flexible than solution 2 in
case multiple applications are invoked by the same AS, for the following
reasons:
\- No need for complex merge of charging information from different
applications in the CTF (e.g. selection of the relevant ICID or Outgoing
Session ID to be reported, in case an AS invoke several applications acting as
B2BUA).
\- Less or even no additional improvement of AS CDR definition, as there is
for example no need to allow multiple occurrence of existing Information
Element in the same message which is required for solution 2 (e.g. IARI).
6.2.6 Recommendation
As stated within the evaluation the impact on introducing alternative 1 is
less compared to alternative 2 since the application has only to set an
identifier which application creates a CDR. The correlation of the CDR\'s
using this information will then be easier.
Therefore alternative 1 is recommended.
# 7 Conclusions
For Key Issue#1 Alternative 1 is proposed. A work item will be proposed for
SA5. When the requirements are finalized by SA5 the CT1 needs to define a
proper mechanism.
For Key Issue#2 Alternative 1 is proposed. A work item will be proposed for
SA5. When the requirements are finalized by SA5 the CT1 needs to define a SIP
extension is needed.
#
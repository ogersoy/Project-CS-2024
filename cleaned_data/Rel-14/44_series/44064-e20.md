# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document defines the Logical Link Control (LLC) layer protocol to
be used for packet data transfer between the Mobile Station (MS) and Serving
GPRS Support Node (SGSN).
It defines the frame structure, elements of procedure, format of fields, and
procedures for the proper operation of the logical link control layer. It is
based on ideas contained in IS-130 [21], ISO 3309 [16], ISO 4335 [17], and ISO
7809 [18, 19, 20] (HDLC of ISO), as well ITU-T Q.920 [13] and Q.921 [14]
(LAPD). The concepts, the overview description of LLC layer functions and
procedures, and the relationship with other Technical Specifications are
described in general terms in 3GPP TS 23.060 [5].
LLC spans from the Mobile Station (MS) to the Serving GPRS Support Node
(SGSN). LLC is intended for use with both acknowledged and unacknowledged data
transfer.
The frame formats defined for LLC are based on those defined for LAPD and RLP.
However, there are important differences between LLC and other protocols, in
particular with regard to frame delimitation methods and transparency
mechanisms. These differences are necessary for independence from the radio
path.
The LLC procedures are modelled upon the concepts of HDLC as outlined in ISO
4335. Data sequence integrity between the data source and data sink is
effected by means of a cyclic numbering scheme. An independent numbering
scheme is used for each logical data link, as identified by the a data link
connection identifier. LLC supports two modes of operation:
\- Unacknowledged peer-to-peer operation:
A logical link entity may initiate transmissions to a peer entity without
prior establishment of a logical connection with the peer entity. LLC does not
guarantee in-order delivery. LLC can detect errors in a received frame, and,
depending on whether the frame is sent in protected mode or not, either
discard or deliver the erroneous frame. No error recovery procedures are
defined at the LLC layer. Higher-layer protocols can be used to provide
reliability, if needed. This mode of operation is known as Asynchronous
Disconnected Mode (ADM).
\- Acknowledged peer-to-peer operation:
A balanced data link involves two participating entities, and each entity
assumes responsibility for the organisation of its data flow and for error
recovery procedures associated with the transmissions that it originates. Each
entity operates as both a data source and data sink in a balanced link,
allowing information to flow in both directions. This mode of operation is
known as Asynchronous Balanced Mode (ABM), and provides a reliable service
with in-order delivery.
In unacknowledged operation, LLC can provide integrity protection.
The present document is organised as follows:
\- An overview of the LLC layer functions is given in clause 4.
\- The frame structure for peer-to-peer communication is given in clause 5.
\- The elements of procedure and formats of fields are given in clause 6.
\- The elements of layer-to-layer communication are contained in clause 7.
\- The details of the peer-to-peer ABM procedures are given in clause 8.
\- The details of LLC frame ciphering are given in annex A.
\- The details of the TOM protocol layer are contained in annex B.
\- An overview of the LLC layer states is provided in annex C.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 41.061: \"General Packet Radio Service (GPRS); GPRS ciphering
algorithm requirements\".
[3] 3GPP TS 22.060: \"General Packet Radio Service (GPRS); Service
description; Stage 1\".
[3a] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[4] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS); Point-to-Point (PP)\".
[5] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[5a] 3GPP TS 23.251: \"Network Sharing; Architecture and Functional
Description\".
[6] 3GPP TS 43.064: \"General Packet Radio Service (GPRS); Overall description
of the GPRS radio interface; Stage 2\".
[7] 3GPP TS 44.001: \"Mobile Station ‑ Base Station System (MS ‑ BSS)
interface; General aspects and principles\".
[8] 3GPP TS 44.018: \"Mobile radio interface; Layer 3 specification; Radio
Resource Control Protocol\".
[8a] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core
Network Protocols; Stage 3\".
[9] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[10] 3GPP TS 24.022: \"Radio Link Protocol (RLP) for circuit switched bearer
and teleservices\".
[11] 3GPP TS 44.065: \"General Packet Radio Service (GPRS); Mobile Station
(MS) -- Serving GPRS Support Node (SGSN); Subnetwork Dependent Convergence
Protocol (SNDCP)\".
[12] 3GPP TS 48.018: \"General Packet Radio Service (GPRS); Base Station
System (BSS) ‑ Serving GPRS Support Node (SGSN); BSS GPRS Protocol (BSSGP)\".
[13] ITU-T Recommendation Q.920 (1988): \"ISDN user-network interface data
link layer - General aspects\".
[14] ITU-T Recommendation Q.921 (1988): \"ISDN user-network interface \- Data
link layer specification\".
[15] ITU-T Recommendation Z.100 (1988): \"CCITT specification and description
language (SDL)\".
[16] ISO 3309 (1984): \"Information processing systems - Data communications -
High-level data link control procedure - Frame structure\".
[17] ISO 4335 (1987): \"Information processing systems -- Data communication
-- High-level logical link control procedures -- Consolidation of elements of
procedures\".
[18] ISO 7809 (1984): \"Information processing systems -- Data communication
-- High-level logical link control procedures -- Consolidation of classes of
procedures\".
[19] ISO 7809 (1984): \"Information processing systems -- Data communication
Add. 1: 1987 -- High-level logical link control procedures \-- Consolidation
of classes of procedures -- Addendum 1\".
[20] ISO 7809 (1984): \"Information processing systems -- Data communication
Add. 2: 1987 -- High-level logical link control procedures \-- Consolidation
of classes of procedures -- Addendum 2: Description of optional functions\".
[21] TIA IS-130 (1995): \"800 MHz Cellular System -- TDMA Radio Interface --
Radio Link Protocol 1\" Arlington: Telecommunications Industry Association.
[22] TIA/EIA‑136 (1999): \"TDMA Cellular / PCS\"; Arlington:
Telecommunications Industry Association.
[23] 3GPP TS 44.060: \"General Packet Radio Service (GPRS); Mobile Station
(MS) - Base Station System (BSS) interface; Radio Link Control/Medium Access
Control (RLC/MAC) protocol\".
[23a] 3GPP TS 29.018: \"General Packet Radio Service (GPRS); Serving GPRS
Support Node (SGSN) -- Visitors Location Register (VLR); Gs interface layer 3
specification\".
[24] 3GPP TS 44.031: "Mobile Station (MS) - Serving Mobile Location Centre
(SMLC) Radio Resource LCS Protocol (RRLP)".
[25] 3GPP TS 43.059: \"Functional Stage 2 Description of Location Services
(LCS) in GERAN\".
[26] 3GPP TS 43.129: \"Packet-switched handover for GERAN A/Gb mode; Stage
2\".
[27] 3GPP TS 43.020: \"Security-related network functions\"
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TS 21.905 [1] and 3GPP TS 22.060 [3] and the following apply:
**active LLE: an LLE which** SAPI is assigned to a layer‑3 entity.
**empty XID command:** an XID command sent by the SGSN which does not contain
parameters to negotiate.
**frame rejection condition:** a condition that results from the receipt of an
undefined or incorrect frame.
**inquiry process:** a process performed in the peer receiver busy condition
in which the LLE checks that the peer LLE is still in the own receiver busy
condition.
**invalid frame condition:** a condition that results from the receipt of an
invalid frame.
**logical link connection:** the logical connection between two LLE peers. A
logical link connection is identified with a Data Link Connection Identifier
(DLCI). A logical link connection is always in one of three states: TLLI
Unassigned, TLLI Assigned / ADM, or ABM.
**logical link control layer:** the protocol layer between an MS and an SGSN
consisting of one or more logical link management entities, one or more
logical link entities, and a multiplex procedure.
**logical link entity:** the LLC layer protocol state machine controlling one
logical link connection.
**own receiver busy condition:** a condition that results from the inability
to accept additional I frames from the peer logical link entity.
**peer receiver busy condition:** a condition that results from the reception
in of a RNR frame from the peer logical link entity.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.251 [5a] apply:
**Multi-Operator Core Network**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TS
21.905 [1] and 3GPP TS 23.060 [5], and the following apply:
ABM Asynchronous Balanced Mode
ACK ACKnowledgement
ADM Asynchronous Disconnected Mode
CNF CoNFirm
DISC DISConnect
DM Disconnected Mode
FCS field Frame Check Sequence field
FRMR FRaMe Reject
GMM GPRS Mobility Management
GRR GPRS Radio Resources service access point
I Information
IND INDication
IOV Input Offset Value
Kc 64-bit ciphering key
Kc~128~ 128-bit ciphering key
LAPD Link Access Procedure on the D-channel
LCS Location Services
LL Logical Link
LLC Logical Link Control
LLE Logical Link Entity
LLGMM LLC to GPRS Mobility Management service access point
LLM Logical Link Management
LLME Logical Link Management Entity
MAC layer Medium Access Control layer
MAC field Message Authentication Code field
MOCN Multi-Operator Core Network
REQ REQuest
RES RESponse
RLC layer Radio Link Control layer
RNR Receive Not Ready
RR Receive Ready
RRLP Radio Resource LCS Protocol
S Supervisory
SABM Set Asynchronous Balanced Mode
SACK Selective ACKnowledgement
TIA Telecommunications Industry Association
TOM Tunnelling Of Messages
UA Unnumbered Acknowledgement
UI Unconfirmed Information
XID eXchange IDentification
# 4 Overview description of LLC functions and procedures
## 4.0 General
The requirements of the LLC layer can be summarised as follows:
\- LLC shall provide a highly reliable logical link between the MS and the
SGSN.
\- LLC shall be independent of the underlying radio interface protocols in
order to allow introduction of alternative GPRS radio solutions with minimal
change to the NSS.
\- LLC shall support variable-length information frames.
\- LLC shall support peer-to-peer data transfers.
\- LLC shall support both acknowledged and unacknowledged data transfers.
\- LLC shall permit information transfer between the SGSN and one or more MSs
using the same physical (e.g. radio) resources. Thus each LLC frame shall
uniquely identify the MS sending (uplink) or receiving (downlink) the
information.
\- LLC shall allow information transfer with different service criteria, such
that high-priority data transfers may take precedence over lower-priority
transfers to the same MS.
\- LLC shall provide user data confidentiality by means of a ciphering
function.
\- LLC shall support user identity confidentiality.
\- LLC may support integrity protection.
## 4.1 Reference model
A model of layering the protocols in GPRS is illustrated in figure 1.
Figure 1: Protocol layering in GPRS
The LLC layer operates above the RLC and BSSGP layers in the reference
architecture to provide logical links between an MS and its SGSN.
Above the LLC layer is located the SubNetwork Dependent Convergence (SNDC)
layer, that controls the transfer of user data network layer PDUs (N‑PDUs)
between the MS and SGSN. The SNDC functionality is described in 3GPP TS 23.060
[5] and specified in 3GPP TS 44.065 [11].
The logical link control layer Service Access Points (SAPs) are the points at
which the LLC layer provides services to the layer‑3 protocols in figure 1. In
addition to the SNDC protocol, LLC provides service to the GPRS Mobility
Management (GMM) protocol, to the SMS protocol, and to the Tunnelling of
Messages (TOM) protocol.
An LLC layer connection is identified by the DLCI consisting of the SAP
Identifier (SAPI) and the MS\'s Temporary Logical Link Identifier (TLLI).
Each LLC frame consists of the header, trailer, and information field. The
header and trailer fields contain information such as SAPI, frame number and
checksum, that are used to identify the frame and to provide reliable
transmission. The information field is variable length. Both transmission and
retransmission of each frame are controlled by the LLC layer.
Many of the formats and procedures are similar to the reference protocols, and
differences are introduced only where needed to reflect the unique aspects of
the GPRS architecture and requirements.
## 4.2 General description of the LLC protocol
### 4.2.0 LLC protocol functions
LLC is considered to be a sublayer of layer 2 in the ISO 7-layer model. The
purpose of LLC is to convey information between layer‑3 entities in the MS and
SGSN. Specifically, LLC shall support:
\- multiple MSs at the Um interface;
\- multiple layer‑3 entities within an MS.
LLC includes functions for:
\- the provision of one or more logical link connections discriminated between
by means of a DLCI;
\- sequence control, to maintain the sequential order of frames across a
logical link connection;
\- detection of transmission, format and operational errors on a logical link
connection;
\- recovery from detected transmission, format, and operational errors;
\- notification of unrecoverable errors;
\- flow control;
\- ciphering; and
\- integrity protection.
LLC layer functions provide the means for information transfer via peer-to-
peer logical link connections between an MS and SGSN pair.
### 4.2.1 Services required by the lower layers
LLC requires the following services from the layers below:
\- LLC PDU delimitation to allow the LLC layer to determine the first octet
and the last octet in each LLC PDU; and
\- transport of the MS address (a TLLI) of each LLC PDU between the MS and the
SGSN.
To \"transmit a frame\" and \"send a frame\" refers to the delivery of a frame
by the LLC layer to the layer below.
## 4.3 Unacknowledged operation
With this type of operation, layer‑3 information is transmitted in numbered
Unconfirmed Information (UI) frames. The UI frames are not acknowledged at the
LLC layer. Neither error recovery nor reordering mechanisms are defined, but
transmission and format errors are detected. Duplicate UI frames are
discarded.
Flow control procedures are not defined.
Two modes of unacknowledged operation are defined:
\- protected mode in which the FCS field protects the frame header and
information field, including the MAC field, if any; and
\- unprotected mode in which the FCS field protects the frame header and only
the first N202 octets of the information field, including the MAC field, if
any.
The MAC field, when used, protects the frame header and the information field.
Unacknowledged operation is allowed for all SAPIs that are not reserved (see
table 2).
## 4.4 Acknowledged operation
With this type of operation, layer‑3 information is transmitted in order in
numbered Information (I) frames. The I frames are acknowledged at the LLC
layer. Error recovery and reordering procedures based on retransmission of
unacknowledged I frames are specified. Several I frames may be unacknowledged
at the same time. In the case of errors that cannot be corrected by the
logical link control layer, a report to GPRS mobility management shall be
made.
Flow control procedures are defined.
Acknowledged operation requires that ABM operation has been initiated by an
establishment procedure using the Set Asynchronous Balanced Mode (SABM)
command.
Acknowledged operation is allowed for all SAPIs that are not reserved (see
table 2) except SAPIs 1, 2, 7, and 8.
## 4.5 Establishment of information transfer modes
### 4.5.1 Data link connection identification
A logical link connection is identified by a DLCI consisting of two
identifiers: a SAPI and a TLLI.
The SAPI is used to identify the service access point on the SGSN side and the
MS side of the LLC interface. SAPI is carried in the address field of each LLC
frame.
The TLLI is used to identify a specific MS. TLLI assignment is controlled by
GMM. TLLI is not carried in LLC frames, but in BSSGP messages as defined in
3GPP TS 48.018 [12], and in RLC/MAC layer blocks as defined in 3GPP TS 44.018
[8].
### 4.5.2 Logical link states
A logical link entity may be in one of three basic states:
\- TLLI Unassigned state: information transfer shall not be possible with the
following exception: the SGSN shall be able to receive UI and XID frames for
SAPI = 1;
\- TLLI Assigned / ADM state: in this state a TLLI has been assigned.
Unacknowledged information transfer and XID negotiation shall be possible on
SAPIs that are assigned to a layer‑3 entity; or
\- ABM state: this state shall be established by means of an ABM establishment
procedure. Both acknowledged and unacknowledged information transfer shall be
possible.
The basic states and additional states are shown in annex C.
### 4.5.3 TLLI assignment
TLLI assignment is controlled by GMM. TLLIs are assigned, changed, and
unassigned with the LLGMM-ASSIGN-REQ primitive, as described in subclause
7.2.1.1.
### 4.5.4 Establishment of ABM operation
Before peer-to-peer acknowledged information transfer can start, an exchange
of a SABM frame and an Unnumbered Acknowledgement (UA) frame shall take place.
The ABM establishment procedure is specified in clause 8.
## 4.6 Data confidentiality
The LLC layer shall provide data confidentiality by ciphering the information
and FCS fields of data frames:
\- The information and FCS fields of I frames shall be ciphered whenever
ciphering information has been assigned to the TLLI.
\- The information field (including the MAC field if integrity protection is
used) and the FCS field of UI frames shall be ciphered whenever layer 3
indicates that the UI frame shall be ciphered and ciphering information has
been assigned to the TLLI.
For details and usage of ciphering, see Annex A.
## 4.6a Integrity protection
The LLC layer may provide integrity protection of the frame header and the
information field of data frames:
\- The frame header and the information field of UI frames shall be integrity
protected whenever layer 3 indicates that the UI frame shall be integrity
protected and integrity protection information has been assigned to the TLLI.
For details and usage of integrity protection, see 3GPP TS 43.020 [27].
## 4.7 LLC layer structure
### 4.7.0 General
The LLC layer structure is shown in figure 2. This figure is a model shown for
illustrative purposes only, and does not constrain implementations.
Figure 2: Functional model of the LLC layer
### 4.7.1 Logical Link Entity
The logical link procedures consist of multiple Logical Link Entities (LLEs)
that control the information flow of individual connections. There may be
multiple LLEs per TLLI. Functions provided by each LLE are:
\- unacknowledged information transfer;
\- acknowledged information transfer;
\- flow control in ABM operation;
\- frame error detection; and
\- integrity protection (in unacknowledged information transfer).
The LLE analyses the control field of the received frame (see subclause 6.3)
and provides appropriate responses and layer-to-layer indications. In
addition, LLE analyses the LLC layer service primitives and transmits the
appropriate command and response frames. There is one logical link entity for
each DLCI.
### 4.7.2 Multiplex procedure
On frame transmission, the multiplex procedure generates and inserts the FCS
field and the MAC field if integrity protection is used, performs the frame
ciphering function, and provides SAPI-based logical link control layer
contention resolution between the various LLEs.
On frame reception, the multiplex procedure performs the frame decipher
function and checks the FCS field and the MAC field if integrity protection is
used. If the frame passes the FCS field and the MAC field checks, the
multiplex procedure distributes the frame to the appropriate logical link
entity based on the DLCI.
3GPP TS 41.061 [2] contains the requirements for the GPRS ciphering algorithm.
### 4.7.3 Logical Link Management
The Logical Link Management Entity (LLME) manages the resources that have an
impact on individual connections. There is one LLME per TLLI. Functions
provided by the LLME are:
\- parameter initialisation;
\- error processing; and
\- connection flow control invocation.
The RLC/MAC layer functions are described in 3GPP TS 43.064 [6]. BSSGP is
specified in 3GPP TS 48.018 [12]. SNDCP is specified in 3GPP TS 44.065 [11].
## 4.8 GPRS Mobility Management
GPRS Mobility Management (GMM) uses the services of the LLC layer to transfer
messages between the MS and the SGSN. GMM includes functions such as attach
and authentication, and transport of session management messages for functions
such as PDP context activation and deactivation. GMM procedures are defined in
3GPP TS 24.008 [8a] and are beyond the scope of the LLC layer. Interaction
between GMM and LLC is defined in terms of service primitives, see clause 7.
## 4.9 Short Message Service
The Short Message Service (SMS) uses the services of the LLC layer to transfer
short messages between the MS and the SGSN. SMS procedures are defined in 3GPP
TS 23.040 [4] and 3GPP TS 24.011 [9] and are beyond of the scope of the LLC
layer. Interaction between SMS and LLC is defined in terms of service
primitives, see clause 7.
## 4.10 Tunnelling Of Messages
TOM is a generic protocol layer used for the exchange of TOM Protocol
Envelopes between the MS and the SGSN. TOM procedures are defined in annex B.
# 5 Frame structure
## 5.1 General
All logical link control layer peer-to-peer exchanges shall be in frames
conforming to the format shown in figure 3 and figure 3a. The frame header
shall consist of the address and control fields, and is a minimum of 2 octets
and a maximum of 37 octets long.
* * *
8 7 6 5 4 3 2 1 Address field (1 octet)
Control field  
(variable length, max. 36 octets)
Information field  
(variable length, max. N201 octets)
Frame Check Sequence field  
(3 octets)
* * *
Figure 3: LLC frame format
* * *
8 7 6 5 4 3 2 1 Address field (1 octet)
Control field (2 octets)
Information field  
(variable length, max. N201-4 octets)
Message Authentication Code field  
(4 octets)
Frame Check Sequence field  
(3 octets)
* * *
Figure 3a: LLC frame format with integrity protection
NOTE: For an LLC frame with integrity protection, the MAC field is included in
the information field. When the MAC field is included in the mess age, the
maximum length of the integrity protected message is N201 \-- 4 octets.
## 5.2 Address field
The address field consists of a single octet. The address field contains the
SAPI and identifies the DLCI for which a downlink frame is intended and the
DLCI transmitting an uplink frame. The format of the address field is defined
in subclause 6.2.
## 5.3 Control field
The control field typically consists of between one and three octets. The SACK
supervisory frame also includes a variable-length bitmap field of up to 32
octets. The format of the control field is defined in subclause 6.3.
## 5.4 Information field
The information field of a frame, when present, follows the control field (see
subclause 6.4). The maximum number of octets in the information field (N201)
is defined in subclause 8.9.5.
## 5.5 Frame Check Sequence (FCS) field
The FCS field shall consist of a 24 bit cyclic redundancy check (CRC) code.
The CRC-24 is used to detect bit errors in the frame header and information
fields.
The FCS field contains the value of a CRC calculation that is performed over
the entire contents of the header and information field, except for UI frames
transmitted in unprotected mode, in which case the FCS field contains the
value of a CRC calculation that is performed over the frame header and the
first N202 octets (see subclause 8.9.6) of the information field only (see
subclause 6.3.5.5.2). The information over which the CRC is calculated is
referred to as the dividend in this subclause. Bit (1, 1) of the dividend is
the highest-order term in the calculation (see subclause 5.7.3). CRC
calculation shall be done before ciphering at the transmitting side, and after
deciphering at the receiving side.
NOTE: The definition below is different from that in 3GPP TS 24.022 [10] only
with respect to the variable dividend length k of the LLC frames. In 3GPP TS
24.022, the RLP frame has a fixed dividend length, but the LLC frame has a
variable dividend length.
The CRC shall be the ones complement of the sum (modulo 2) of:
\- the remainder of x^k^ (x^23^ + x^22^ + x^21^ +... + x^2^ + x + 1) divided
(modulo 2) by the generator polynomial, where k is the number of bits of the
dividend; and
\- the remainder of the division (modulo 2) by the generator polynomial of the
product of x^24^ by the dividend.
The CRC-24 generator polynomial is:
G(x) = x^24^ + x^23^ + x^21^ + x^20^ + x^19^ + x^17^ + x^16^ + x^15^ + x^13^ +
x^8^ + x^7^ + x^5^ + x^4^ + x^2^ + 1
The result of the CRC calculation is placed within the FCS field as described
in subclause 5.7.3.
NOTE: As a typical implementation at the transmitter, the initial content of
the register of the device computing the remainder of the division is pre-set
to all \"1\'s\" and is then modified by division by the generator polynomial
(as described above) of the dividend; the ones complement of the resulting
remainder is put into the FCS field.
As a typical implementation at the receiver, the initial content of the
register of the device computing the remainder of the division is pre-set to
all \"1\'s\". The final remainder, after multiplication by x^24^ and then
division (modulo 2) by the generator polynomial of the received frame, will be
(in the absence of errors):
C(x) = x^22^ + x^21^ + x^19^ + x^18^ + x^16^ + x^15^ + x^11^ + x^8^ + x^5^ +
x^4^
## 5.5a Message Authentication Code (MAC) field
The MAC field, when present, shall contain the integrity protection
information for the frame. The MAC field shall be included in the security
protected frames when integrity protection has been activated. For usage and
detailed coding of the MAC field, see 3GPP TS 43.020 [27].
MAC calculation shall be done before the CRC calculation at the transmitting
side, and after CRC calculation at the receiving side.
## 5.6 Transparency
### 5.6.1 Bit transparency
Because of the frame delimitation technique used in LLC, the frame can include
any possible sequence of bits without the need for e.g., bit stuffing as
defined in ITU-T Recommendation Q.921 [14].
### 5.6.2 Information protection
The information carried within a UI frame may be considered as either
\"protected\" or \"unprotected\" (see subclause 6.3.5.5.2). CRC error
detection procedures are only used on the first N202 octets of the information
content within unprotected UI frames, supporting applications that can
tolerate bit errors.
### 5.6.3 Octet alignment
LLC provides only an octet-aligned service to layer 3. LLC requires that
information exchanged with layer 3 contains an integral number of octets.
## 5.7 Format convention
### 5.7.1 Numbering convention
The basic convention used in the present document is illustrated in figure 4.
The bits are grouped into octets. The bits of an octet are shown horizontally
and are numbered from 1 to 8. Multiple octets are shown vertically and are
numbered from 1 to n.
Figure 4: Format convention
### 5.7.2 Order of transmission
Frames are transferred between the LLC layer and underlying protocol layers in
units of octets, in ascending numerical octet order (i.e., octet 1, 2, ...,
n-1, n). The order of bit transmission is specific to the underlying protocols
used across the Um interface (e.g., RLC) and the Gb interface (BSSGP).
### 5.7.3 Field mapping convention
When a field is contained within a single octet, the lowest bit number of the
field represents the lowest-order value. When a field spans more than one
octet, the order of bit values within each octet progressively decreases as
the octet number increases. In that part of the field contained in a given
octet the lowest bit number represents the lowest-order value.
For example, a bit number can be identified as a couple (o, b) where o is the
octet number and b is the relative bit number within the octet. Figure 5
illustrates a field that spans from bit (1, 3) to bit (2, 7). The high-order
bit of the field is mapped on bit (1, 3) and the low-order bit is mapped on
bit (2, 7).
Figure 5: Field mapping convention
An exception to the preceding field mapping convention is the FCS field. In
this case bit 1 of the first octet is the high-order bit and bit 8 of the last
octet is the low-order bit. The field mapping for a 24 bit FCS field is shown
in figure 6.
Figure 6: FCS field mapping convention
## 5.8 Invalid frames
An invalid frame is a frame that:
\- contains fewer octets than necessary to include the address field, control
field, information field (including the MAC field if integrity protection is
used), and FCS field necessary to constitute a complete frame according to the
contents of the control field;
\- has the PD bit set to 1;
\- contains a reserved SAPI or a SAPI that is not supported or not assigned to
a layer‑3 entity;
\- contains an FCS field error (see subclause 6.3.5.5.2 for details on FCS
field error) ; or
\- contains a MAC field error (see subclause 6.3.5.5.2a for details on MAC
field error).
An invalid frame shall be discarded without notification to the sender. No
action shall be taken as the result of that frame.
# 6 Elements of procedures and formats of fields
## 6.1 General
The elements of procedures define the commands and responses that are used on
the logical link connections between the MS and SGSN.
Procedures are derived from these elements of procedures and are described in
clause 8.
If a bit position is marked as \"spare\", it shall be coded as 0. A spare bit
is indicated with an \'X\' in the format figures in this clause. For future
compatibility reasons, an entity receiving frames, where spare bit positions
are coded otherwise, shall ignore those values without notification of any
error.
## 6.2 Address field format and variables
### 6.2.0 Address field format
The address field consists of
\- the Protocol Discriminator bit PD;
\- the Command/Response bit C/R; and
\- the SAPI.
The format of the address field is shown in figure 7.
Figure 7: Address field format
### 6.2.1 Protocol Discriminator bit (PD)
The PD bit indicates whether a frame is an LLC frame or belongs to a different
protocol. LLC frames shall have the PD bit set to 0. If a frame with the PD
bit set to 1 is received, then it shall be treated as an invalid frame, see
subclause 5.8.
### 6.2.2 Command/Response bit (C/R)
The C/R bit identifies a frame as either a command or a response. The MS side
shall send commands with the C/R bit set to 0, and responses with the C/R bit
set to 1. The SGSN side shall do the opposite; i.e., commands are sent with
C/R set to 1, and responses are sent with C/R set to 0. The combinations for
the SGSN side and MS side are shown in table 1.
Table 1: C/R field bit usage
* * *
Type Direction C/R value Command SGSN side to MS side 1 Command MS side to
SGSN side 0 Response SGSN side to MS side 0 Response MS side to SGSN side 1
* * *
### 6.2.3 Service Access Point Identifier (SAPI)
SAPI identifies a point at which LLC services are provided by an LLE to a
layer‑3 entity. Consequently, SAPI identifies an LLE that should process an
LLC frame and also a layer‑3 entity that is to receive information carried by
the LLC frame.
SAPI allows 16 service access points to be specified. The SAPI values are
allocated as shown in table 2.
Table 2: Allocation of SAPI values
* * *
SAPI Related Service SAP Name 0000 Reserved - 0001 GPRS Mobility Management
LLGMM 0010 Tunnelling of messages 2 TOM2 0011 User data 3 LL3 0100 Reserved -
0101 User data 5 LL5 0110 Reserved - 0111 SMS LLSMS 1000 Tunnelling of
messages 8 TOM8 1001 User data 9 LL9 1010 Reserved - 1011 User data 11 LL11
1100 Reserved - 1101 Reserved - 1110 Reserved - 1111 Reserved -
* * *
## 6.3 Control field formats, parameters, and variables
### 6.3.0 Control field formats
The control field identifies the type of frame. Four types of control field
formats are specified:
\- confirmed information transfer (I format);
\- supervisory functions (S format);
\- unconfirmed information transfer (UI format); and
\- control functions (U format).
The control field formats for LLC are shown in figure 8 and figure 9. For
definition of values for supervisory function bits and unnumbered function
bits, see table 4.
Figure 8: Control field format
Figure 9: SACK I and S frame control field format
### 6.3.1 Information transfer format - I
The I format shall be used to perform an information transfer between layer‑3
entities with acknowledgement. The functions of N(S), N(R), and A are
independent; that is, each I frame has an N(S) sequence number, an N(R)
sequence number that may or may not acknowledge additional I frames received
by the LLE, and an A bit that may be set to 0 or 1. The use of N(S), N(R), and
A is defined in clause 8.
Each I frame also contains supervisory information, in effect \"piggy-
backing\" an S frame with each I frame, so that it may be considered to be an
I+S frame.
### 6.3.2 Supervisory format - S
The S format shall be used to perform logical link supervisory control
functions such as acknowledge I frames and request a temporary suspension of
I‑frame transmission. The functions of N(R) and the A bit are independent;
that is, each supervisory frame has an N(R) sequence number that may or may
not acknowledge additional I frames received by the LLE, and an A bit that may
be set to 0 or 1. The use of N(R) and the A bit is described in clause 8.
### 6.3.3 Unconfirmed Information format - UI
The UI format shall be used to perform an information transfer between layer‑3
entities without acknowledgement. No verification of sequence numbers is
performed for UI frames. Therefore, a UI frame may be lost without
notification to the layer‑3 entity if a logical link exception occurs during
transmission of the frame. The information field may be encrypted or not as
indicated by the E bit (see subclause 6.3.5.5.1). The frame also includes a PM
bit that allows the transfer of unprotected information (see subclause
6.3.5.5.2). If integrity protection is intended to be used, the frame may be
integrity protected or not as indicated by the IP bit (see subclause
6.3.5.2a).
### 6.3.4 Unnumbered format ‑ U
The U format shall be used to provide additional logical link control
functions. This format contains no sequence number. The format includes a P/F
bit that may be set to 0 or 1.
### 6.3.5 Control field parameters and associated state variables
The various parameters associated with the control field formats are described
in this subclause.
#### 6.3.5.1 Poll/Final bit (P/F)
All U frames contain the Poll/Final (P/F) bit. The P/F bit serves a function
in both command frames and response frames. In command frames the P/F bit is
referred to as the P bit. In response frames it is referred to as the F bit.
The P bit set to 1 is used by an LLE to solicit (poll) a response frame from
the peer LLE. The F bit set to 1 is used by an LLE to indicate the response
frame transmitted as a result of a soliciting (poll) command.
The use of the P/F bit is described in clause 8.
#### 6.3.5.2 Acknowledgement request bit (A)
All I and S frames contain the Acknowledgement Request (A) bit.
The A bit set to 1 is used by an LLE to solicit an acknowledgement (i.e., an
I+S or S frame) from the peer LLE. The A bit set to 0 is used by an LLE to
indicate that the peer LLE is not requested to send an acknowledgement.
The use of the A bit is described in clause 8.
#### 6.3.5.2a Integrity Protection bit (IP)
UI frames contain the Integrity Protection (IP) bit.
The IP bit set to 1 is used by an LLE to indicate integrity protected frames
that include the 4 octet MAC field. The IP bit set to 0 is used by an LLE to
indicate non-integrity protected frames.
#### 6.3.5.3 Modulus
Each I and UI frame is sequentially numbered by a sequence number that may
have the value 0 through 511.
Arithmetic acting on parameters and variables that are related to such
sequence numbers operates modulo 512 (i.e. N(S), N(R), N(U), V(S), V(R), V(A),
V(U), V(UR); see the following subclauses).
NOTE: Modulo 512 operation on negative numbers is performed by adding
multiples of 512 to the negative number until the result becomes non-negative.
Then common modulo 512 operation is applied.
#### 6.3.5.4 ABM variables and sequence numbers
##### 6.3.5.4.1 Send state variable V(S)
In Asynchronous Balanced Mode, each LLE peer shall have an associated send
state variable V(S) when using I frames. V(S) denotes the sequence number of
the next in-sequence I frame to be transmitted. V(S) can take on the value 0
through 511. The value of V(S) shall be incremented by 1 with each successive
I frame transmission, and shall not exceed V(A) by more than the maximum
number of outstanding I frames k. The value of k may be in the range 1 ≤ k ≤
255, as defined in subclause 8.9.8. V(S) shall not be incremented when an I
frame is retransmitted.
##### 6.3.5.4.2 Acknowledge state variable V(A)
In Asynchronous Balanced Mode, each LLE peer shall have an associated
acknowledge state variable V(A) when using I frame and supervisory frame
commands and responses. V(A) identifies the first I frame in the transmit
window, so that V(A) ‑ 1 equals N(S) of the last in-sequence acknowledged I
frame. V(A) can take on the value 0 through 511. The value of V(A) shall be
updated by the valid N(R) values received from its peer (see subclause
6.3.5.4.5). A valid N(R) value is one that is in the range V(A) ≤ N(R) ≤ V(S).
These inequalities shall be interpreted in the following way:
N(R) is valid if, and only if, ( N(R) ‑ V(A) ) mod 512 ≤ ( V(S) ‑ V(A) ) mod
512.
Furthermore, from subclause 6.3.5.4.1, ( V(S) ‑ V(A) ) mod 512 ≤ k.
##### 6.3.5.4.3 Send sequence number N(S)
In Asynchronous Balanced Mode, only I frames contain N(S), the send sequence
number of transmitted I frames. At the time that an in-sequence I frame is
designated for transmission, the value of N(S) is set equal to the value of
the send state variable V(S).
##### 6.3.5.4.4 Receive state variable V(R)
In Asynchronous Balanced Mode, each LLE peer shall have an associated receive
state variable V(R) when using I frame and supervisory frame commands and
responses. V(R) denotes the sequence number of the next in-sequence I frame
expected to be received. V(R) can take on the value 0 through 511. The value
of V(R) shall be incremented by one with the receipt of an error-free, in-
sequence I frame whose send sequence number N(S) equals V(R).
##### 6.3.5.4.5 Receive sequence number N(R)
In Asynchronous Balanced Mode, all I frames and supervisory frames contain
N(R), the expected send sequence number of the next in-sequence received I
frame. At the time that a frame of the above types is designated for
transmission, the value of N(R) is set equal to the value of the receive state
variable V(R). N(R) indicates that the LLE transmitting the N(R) has correctly
received all I frames numbered up to and including N(R) ‑ 1.
##### 6.3.5.4.6 SACK bitmap R(n)
In Asynchronous Balanced Mode, all I+S and S SACK frames contain R(n), the
SACK bitmap. At the time that a SACK frame is designated for transmission, the
value of each bit R(n) in the bitmap shall be set to 0 or 1 depending on
whether I frame number N(R) + n has been received or not. R(n) = 1 indicates
that the LLE transmitting the SACK frame has correctly received I frame number
N(R) + n. R(n) = 0 indicates that the LLE transmitting the SACK frame has not
correctly received I frame number N(R) + n.
The SACK bitmap contains a maximum of 255 bits, or 32 octets, as shown in
figure 9. The bitmap shall be truncated so that only bitmap octets up to and
including the last bitmap octet containing at least one bit set to 1 are
transmitted. The trailing bitmap octets shall not be transmitted.
The I+S SACK frame contains a bitmap length indicator K. K + 1 indicates the
number of octets in the bitmap. K can take any value 0 through 31.
##### 6.3.5.4.7 I frame buffer variable B
In Asynchronous Balanced Mode, each LLE peer shall have an associated I frame
buffer variable B when using I frame and supervisory frame commands and
responses. The value of B has a range of 0 ≤ B ≤ M, where M is defined in
subclause 8.9.7.
Function L(x) gives the total information field length in octets of the I
frame with sequence number x. B shall be incremented with L(x) of each
transmitted I frame as defined in subclause 8.6.1. B shall be decremented by
L(x) of each acknowledged I frame as defined in subclause 8.6.3.2.
##### 6.3.5.4.8 Other parameters and variables
For definition and values of additional parameters and variables, see
subclause 8.9.
#### 6.3.5.5 Unacknowledged operation variables and parameters
##### 6.3.5.5.1 Encryption mode bit (E)
The E bit is used to indicate whether the information and FCS fields of the UI
frame are encrypted (ciphered) to provide user data confidentiality. The E bit
is set to 1 to indicate an encrypted frame. The E bit is set to 0 to indicate
a frame sent without encryption.
##### 6.3.5.5.2 Protected Mode bit (PM)
The PM bit is used to indicate whether the FCS field shall be calculated using
both the frame header and information fields.
The PM bit is set to 1 to indicate that the FCS field covers the frame header
field and the information field (including the MAC field if any).
The PM bit is set to 0 to indicate that the FCS field covers only the frame
header field and the first N202 octets of the information field. If the length
of the information field is less than N202 octets then the FCS field shall
cover the complete information field. This permits UI frames to transport
\"unprotected\" information, such that errors beyond the first N202 octets of
the information field do not result in the frame being discarded.
Table 3: UI frame content, relationship between PM bit and E bit
* * *
PM E UI frame information field 0 0 unprotected, non-ciphered information 0 1
unprotected, ciphered information 1 0 protected, non-ciphered information 1 1
protected, ciphered information
* * *
##### 6.3.5.5.3 Unconfirmed send state variable V(U)
Each LLE peer shall have an associated unconfirmed send state variable V(U)
when using UI frame commands. V(U) denotes the sequence number of the next UI
frame to be transmitted. V(U) can take on the value 0 through 511. The value
of V(U) shall be incremented by 1 with each successive UI frame transmission.
##### 6.3.5.5.4 Unconfirmed sequence number N(U)
Only UI frames contain N(U), the unconfirmed sequence number of transmitted UI
frames. At the time that a UI frame is designated for transmission, the value
of N(U) is set equal to the value of the unconfirmed send state variable V(U).
##### 6.3.5.5.5 Unconfirmed receive state variable V(UR)
Each LLE peer shall have an associated unconfirmed receive state variable
V(UR) when using UI frame commands. V(UR) denotes the sequence number of the
next in-sequence UI frame expected to be received. V(UR) can take on the value
0 through 511.
##### 6.3.5.5.6 Other parameters and variables
The only other parameter defined for unacknowledged operation is the number of
octets (N201‑U) in the information field of the UI frame. See subclause 8.9.4.
## 6.4 Commands and responses
### 6.4.1 General
The following commands and responses are used by the MS and the SGSN LLEs and
are represented in table 4. Each logical link connection shall support the
appropriate set of commands and responses for the type of operation desired
(see clause 8).
Those frame types not identified in figure 8, figure 9, or table 4, shall be
identified as having undefined command and/or response control fields, and
shall be treated as defined in subclause 8.8.2.
Table 4: Commands and responses
+---------------------------+----------+-----------+----------+----+----+----+----+----+ | Format | Commands | Responses | Encoding | | | | | | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | | | | S1 | S2 | M4 | M3 | M2 | M1 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Supervisory | RR | RR | 0 | 0 | - | - | - | - | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Supervisory | ACK | ACK | 0 | 1 | - | - | - | - | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Supervisory | RNR | RNR | 1 | 0 | - | - | - | - | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Supervisory | SACK | SACK | 1 | 1 | - | - | - | - | | | | | | | | | | | | or | | | | | | | | | | | | | | | | | | | | Information + Supervisory | | | | | | | | | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | - | DM | - | - | 0 | 0 | 0 | 1 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | DISC | - | - | - | 0 | 1 | 0 | 0 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | - | UA | - | - | 0 | 1 | 1 | 0 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | SABM | - | - | - | 0 | 1 | 1 | 1 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | - | FRMR | - | - | 1 | 0 | 0 | 0 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | XID | XID | - | - | 1 | 0 | 1 | 1 | +---------------------------+----------+-----------+----------+----+----+----+----+----+ | Unnumbered | NULL | - | - | - | 0 | 0 | 0 | 0 | +---------------------------+----------+-----------+----------+----+----+----+----+----+
The commands and responses in table 4 are defined in the following subclauses.
### 6.4.1 Unnumbered (U) frames
#### 6.4.1.1 Set Asynchronous Balanced Mode (SABM) command
The SABM unnumbered command shall be used to place the addressed MS or SGSN
side into ABM acknowledged operation.
An LLE shall confirm acceptance of a SABM command by the transmission at the
first opportunity of a UA response. Upon acceptance of this command, the
LLE\'s send state variable V(S), acknowledge state variable V(A), and receive
state variable V(R), shall be set to 0. The transmission of a SABM command
indicates the clearance of any exception condition, and a busy condition that
was reported by the earlier transmission of an RNR frame by that same LLE.
Previously transmitted I frames that are unacknowledged when this command is
actioned shall be discarded. It is the responsibility of a higher layer to
recover from the possible loss of the contents of such I frames.
An information field is permitted with the SABM command. If included, the
information field shall contain XID parameters. This allows the LLC peers to
negotiate LLC layer parameters and layer‑3 parameters with the SABM command
and UA response, using the procedure (but not the XID frames) defined in
subclauses 6.4.1.6 and 8.5.3.
#### 6.4.1.2 Disconnect (DISC) command
The DISC unnumbered command shall be transmitted in order to terminate the ABM
operation.
No information field is permitted with the DISC command. Prior to executing
the command, the LLE receiving the DISC command shall confirm the acceptance
of a DISC command by the transmission of a UA response. The LLE sending the
DISC command shall terminate the ABM operation when it receives the
acknowledging UA or DM response.
Previously transmitted I frames that are unacknowledged when this command is
executed shall remain unacknowledged and shall be discarded. It is the
responsibility of a higher layer to recover from the possible loss of the
contents of such I frames.
#### 6.4.1.3 Unnumbered Acknowledgement (UA) response
The UA unnumbered response shall be used by an LLE to acknowledge the receipt
and acceptance of the mode-setting commands (SABM or DISC). Received mode-
setting commands are not actioned until the UA response is transmitted.
An information field is only permitted when UA is the response to a SABM
command. The UA response shall in this case contain XID parameters with
negotiated XID values, using the procedure (but not the XID frames) defined in
subclauses 6.4.1.6 and 8.5.3.
The transmission of the UA response indicates the clearance of any busy
condition that was reported by the earlier transmission of an RNR frame by
that same LLE.
#### 6.4.1.4 Disconnected Mode (DM) response
The DM unnumbered response shall be used by an LLE to report to its peer that
the LLE is in a state such that ABM operation cannot be performed. An LLE
shall transmit a DM response to any valid command received that it cannot
action.
No information field is permitted with the DM response.
#### 6.4.1.5 Frame Reject (FRMR) response
The FRMR unnumbered response may be received by an LLE as a report of a frame
rejection condition not recoverable by retransmission of the identical frame:
1) receipt of a command or response control field that is undefined or not
implemented (see subclause 6.4, 2^nd^ paragraph);
2) receipt of a supervisory or unnumbered frame with incorrect length; or
3) receipt of an I frame with an information field that exceeds the maximum
established length.
An undefined control field is any of the control field encodings that are not
identified in figure 8, figure 9, or table 4.
An information field that immediately follows the control field and that
consists of 10 octets shall be returned with this response to provide the
reason for the FRMR response. This information field format is given in figure
10. Only the first 6 octets of the control field of the rejected frame shall
be sent. If the control field of the rejected frame is fewer than 6 octets,
then the unused octets shall be set to 0.
Figure 10: FRMR frame information field format
The information fields defined for the FRMR response are listed in table 5.
Table 5: FRMR frame fields
* * *
Field Description Rejected frame control field The control field of the
received frame that caused the frame reject. V(S) The current send state
variable value of the LLE reporting the rejection condition. V(R) The current
receive state variable value of the LLE reporting the rejection condition.
V(R) shall not be treated as an acknowledgement of I frames. C/R Set to 1 if
the frame rejected was a response and set to 0 if the frame rejected was a
command. W1 Set to 1 to indicate that the control field received and returned
in octets 1 and 2 was considered invalid because the frame contained an
information field that is not permitted within this frame or is a supervisory
or unnumbered frame with incorrect length. Bit W3 shall be set to 1 in
conjunction with this bit. W2 Set to 1 to indicate that the information field
received exceeded the maximum established information field length (N201) of
the LLE reporting the rejection condition. W3 Set to 1 to indicate that the
control field received and returned in octets 1 and 2 was undefined or not
implemented. W4 Set to 1 to indicate that the LLE was in ABM when reporting
the rejection condition.
* * *
#### 6.4.1.6 Exchange Identification (XID) command/response
This frame shall be used to negotiate and re-negotiate LLC layer parameters
and layer‑3 parameters. XID frames can be transmitted in ADM and ABM.
The negotiation procedure is one-step, i.e., one side shall start the process
by sending an XID command, offering a certain set of parameters from the
applicable parameter repertoire (see table 6) the sending entity wants to
negotiate, proposing values within the allowed range. In return, the other
side shall send an XID response, either confirming these parameter values by
returning the requested values, or offering higher or lower ones in their
place. As an optimisation, parameters confirming the requested values may be
omitted from the XID response. See table 6 for sense of negotiation. This
shall end the negotiation process.
Parameters that are not included in neither the XID command nor in the XID
response, shall retain their current values.
The responding side may respond with parameters that were not included in the
XID command. A parameter that was not included in the XID command shall in
this case be treated as if the current value of the parameter was included in
the XID command. The responding side shall include such a parameter in every
XID response until the parameter has been explicitly negotiated, either by
responding to an XID command that included the parameter, or by explicitly
including the parameter the next time an XID command is transmitted.
Both entities shall support the negotiated values, however under certain
conditions one or more parameters may need to be re-negotiated (e.g., in the
case of a change in SGSN).
XID frames shall always be used with the P/F bit set to 1.
Without any prior XID exchange, default values shall apply.
Negotiated XID parameters shall apply to the LLE identified by the DLCI of the
XID frames used, except Version, Reset, IOV‑UI, i-IOV-UI, i-IOV-UI-cnt and
MAC-IOV-UI that applies to an LLME (i.e., a TLLI), and except Layer‑3
Parameters that apply to the layer 3 above the LLE.
Table 6 lists the negotiable LLC layer parameters. Figure 11 shows the format
of the XID parameter field.
Figure 11: XID parameter field format
A parameter item consists of one or two type/length octets followed by the
value of that parameter. The XID Length (XL) bit indicates whether the Length
field is 2 bits or 8 bits long. If XL is set to 0, then Length consists of 2
bits and type/length occupies one octet. If XL is set to 1 then Length
consists of 8 bits and type/length occupies two octets. The length indicator
gives the number of octets that the value actually occupies. Length shall be
set to the value in table 6 for XID parameters that do not have a variable
length. The parameter items can be arranged in arbitrary order. The parameter
items shall begin in the first octet of the XID information field and follow
on contiguously.
Table 6: LLC layer parameter negotiation
+---------+------+---------+---------+---------+---------+---------+ | Pa | Type | Length | Format | Range | Units | Sense | | rameter | | | (87 | | | of | | Name | | | 654321) | | | Nego | | | | | | | | tiation | +---------+------+---------+---------+---------+---------+---------+ | Version | 0 | 1 | 0 | 0 | - | down | | (LLC | | | 000bbbb | through | | | | version | | | | 15 | | | | number) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | IOV‑UI | 1 | 4 | bb | 0 | - | - | | (ci | | | bbbbbb\ | through | | | | phering | | | bb | 232 ‑ 1 | | | | Input | | | bbbbbb\ | | | | | offset | | | bb | | | | | value | | | bbbbbb\ | | | | | for UI | | | b | | | | | f | | | bbbbbbb | | | | | rames), | | | | | | | | common | | | | | | | | for all | | | | | | | | SAPIs | | | | | | | | of a | | | | | | | | TLLI | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | IOV‑I | 2 | 4 | bb | 0 | - | - | | (ci | | | bbbbbb\ | through | | | | phering | | | bb | 232 ‑ 1 | | | | Input | | | bbbbbb\ | | | | | offset | | | bb | | | | | value | | | bbbbbb\ | | | | | for | | | b | | | | | I f | | | bbbbbbb | | | | | rames), | | | | | | | | for the | | | | | | | | SAPI | | | | | | | | under | | | | | | | | nego | | | | | | | | tiation | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | T200 | 3 | 2 | 00 | 1 | 0,1 s | up | | ( | | | 00bbbb\ | through | | | | retrans | | | b | 4 095 | | | | mission | | | bbbbbbb | | | | | ti | | | | | | | | me-out) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | N200 | 4 | 1 | 0 | 1 | - | up | | ( | | | 000bbbb | through | | | | maximum | | | | 15 | | | | number | | | | | | | | of | | | | | | | | re | | | | | | | | transmi | | | | | | | | ssions) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | N201‑U | 5 | 2 | 00 | 140 | octets | down | | ( | | | 000bbb\ | through | | | | maximum | | | b | 1 520 | | | | info | | | bbbbbbb | | | | | rmation | | | | | | | | field | | | | | | | | length | | | | | | | | for U | | | | | | | | and UI | | | | | | | | frames) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | N201‑I | 6 | 2 | 00 | 140 | octets | down | | ( | | | 000bbb\ | through | | | | maximum | | | b | 1 520 | | | | info | | | bbbbbbb | | | | | rmation | | | | | | | | field | | | | | | | | length | | | | | | | | for | | | | | | | | I | | | | | | | | frames) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | mD | 7 | 2 | 0b | 0, 9 | 16 | down | | ( | | | bbbbbb\ | through | octets | | | I frame | | | b | 24 320 | | | | buffer | | | bbbbbbb | | | | | size in | | | | | | | | the | | | | | | | | d | | | | | | | | ownlink | | | | | | | | dir | | | | | | | | ection) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | mU | 8 | 2 | 0b | 0, 9 | 16 | down | | ( | | | bbbbbb\ | through | octets | | | I frame | | | b | 24 320 | | | | buffer | | | bbbbbbb | | | | | size in | | | | | | | | the | | | | | | | | uplink | | | | | | | | dir | | | | | | | | ection) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | kD | 9 | 1 | b | 1 | frames | down | | (window | | | bbbbbbb | through | | | | size in | | | | 255 | | | | the | | | | | | | | d | | | | | | | | ownlink | | | | | | | | dir | | | | | | | | ection) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | kU | 10 | 1 | b | 1 | frames | down | | (window | | | bbbbbbb | through | | | | size in | | | | 255 | | | | the | | | | | | | | uplink | | | | | | | | dir | | | | | | | | ection) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | Layer‑3 | 11 | V | See | | | | | Par | | ariable | 3GPP | | | | | ameters | | | TS | | | | | | | | 44.065 | | | | | | | | [11] | | | | +---------+------+---------+---------+---------+---------+---------+ | Reset | 12 | 0 | - | - | - | - | +---------+------+---------+---------+---------+---------+---------+ | i | 13 | 4 | bb | 0 | - | - | | -IOV‑UI | | | bbbbbb\ | through | | | | (in | | | bb | 232 ‑ 1 | | | | tegrity | | | bbbbbb\ | | | | | pro | | | bb | | | | | tection | | | bbbbbb\ | | | | | Input | | | b | | | | | offset | | | bbbbbbb | | | | | value | | | | | | | | for UI | | | | | | | | f | | | | | | | | rames), | | | | | | | | common | | | | | | | | for all | | | | | | | | SAPIs | | | | | | | | of a | | | | | | | | TLLI | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | i-IOV | 14 | 1 | b | 1 | - | - | | -UI-cnt | | | bbbbbbb | through | | | | (i-IOV | | | | 255 | | | | update | | | | | | | | c | | | | | | | | ounter) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | MAC | 15 | 4 | bb | 0 | - | - | | -IOV‑UI | | | bbbbbb\ | through | | | | (MAC | | | bb | 232 ‑ 1 | | | | value | | | bbbbbb\ | | | | | created | | | bb | | | | | over | | | bbbbbb\ | | | | | i | | | b | | | | | -IOV-UI | | | bbbbbbb | | | | | and | | | | | | | | i-IOV- | | | | | | | | UI-cnt) | | | | | | | +---------+------+---------+---------+---------+---------+---------+ | NOTE 1: | | | | | | | | The | | | | | | | | Range | | | | | | | | for | | | | | | | | N201‑U | | | | | | | | for | | | | | | | | SAPI 1 | | | | | | | | is 400 | | | | | | | | through | | | | | | | | 1 520 | | | | | | | | octets, | | | | | | | | and for | | | | | | | | S | | | | | | | | APIs 2, | | | | | | | | 7, and | | | | | | | | 8 270 | | | | | | | | through | | | | | | | | 1 520 | | | | | | | | octets. | | | | | | | | | | | | | | | | NOTE 2: | | | | | | | | All | | | | | | | | other | | | | | | | | Types | | | | | | | | and | | | | | | | | Ranges | | | | | | | | are | | | | | | | | r | | | | | | | | eserved | | | | | | | | for | | | | | | | | future | | | | | | | | v | | | | | | | | ersions | | | | | | | | of the | | | | | | | | present | | | | | | | | do | | | | | | | | cument. | | | | | | | | | | | | | | | | NOTE 3: | | | | | | | | The | | | | | | | | length | | | | | | | | for | | | | | | | | Layer‑3 | | | | | | | | Par | | | | | | | | ameters | | | | | | | | shall | | | | | | | | be set | | | | | | | | equal | | | | | | | | to the | | | | | | | | number | | | | | | | | of | | | | | | | | octets | | | | | | | | r | | | | | | | | eceived | | | | | | | | from | | | | | | | | l | | | | | | | | ayer 3. | | | | | | | | If an | | | | | | | | empty | | | | | | | | XID | | | | | | | | block | | | | | | | | is | | | | | | | | r | | | | | | | | eceived | | | | | | | | from | | | | | | | | l | | | | | | | | ayer 3, | | | | | | | | the LLE | | | | | | | | shall | | | | | | | | include | | | | | | | | a | | | | | | | | zero | | | | | | | | -length | | | | | | | | Layer‑3 | | | | | | | | Par | | | | | | | | ameters | | | | | | | | XID | | | | | | | | pa | | | | | | | | rameter | | | | | | | | in the | | | | | | | | XID | | | | | | | | pa | | | | | | | | rameter | | | | | | | | field | | | | | | | | to | | | | | | | | allow | | | | | | | | the | | | | | | | | re | | | | | | | | ceiving | | | | | | | | LLE to | | | | | | | | dist | | | | | | | | inguish | | | | | | | | between | | | | | | | | LLC and | | | | | | | | layer‑3 | | | | | | | | in | | | | | | | | itiated | | | | | | | | proc | | | | | | | | edures. | | | | | | | +---------+------+---------+---------+---------+---------+---------+
Version shall not be negotiated while in ABM.
Reset shall only be negotiated with an XID frame, and only be transmitted in
the downlink direction. If Reset is present in an XID frame, then it shall be
the first XID parameter in the XID information field.
IOV‑UI, i-IOV-UI, i-IOV-UI-cnt and MAC-IOV-UI shall only be negotiated in ADM.
IOV‑I shall only be negotiated with SABM and UA frames. IOV‑UI, i-IOV-UI,
i-IOV-UI-cnt, MAC-IOV-UI and IOV‑I shall only be transmitted in the downlink
direction.
T200, N200, and N201‑U can be negotiated in ADM and ABM. The new values of
T200 shall only apply to timers set after the negotiation has been completed.
If N201‑U is negotiated to a lower value than previously used, then any queued
or new U and UI frames that violate the new value of N201‑U should be
discarded and not transmitted.
U or UI frames that violate the negotiated value of N201-U may be discarded by
the receiver.
If N201‑U is negotiated to a lower value than previously used and the side
originating the XID negotiation does not suspend the transfer of U and UI
frames for the respective SAPI during the negotiation, then it should apply
the proposed value for N201-U already to the U and UI frames transmitted
during the negotiation. For received U and UI frames the side originating the
XID negotiation shall apply the previous value of N201-U until the negotiation
is completed.
N201‑I, mD, mU, kD, and kU can be negotiated to any value in Range in ADM. In
ABM, N201‑I, mD, mU, kD, and kU can only be negotiated to the same or higher
value as previously used.
#### 6.4.1.7 NULL command
The NULL unnumbered command shall be used by an MS LLE to indicate a cell
update. The NULL unnumbered command is only allowed if the Cell Notification
is indicated by the SGSN (see 3GPP TS 23.060 [5] and 3GPP TS 24.008 [8a]).
No information field is permitted with the NULL command.
### 6.4.2 Unconfirmed Information (UI) frame
#### 6.4.2.1 Unconfirmed Information (UI) command
When a layer‑3 entity requests unacknowledged information transfer, the UI
command shall be used to send information to its peer. No verification of
sequence numbers is performed for UI frames. Therefore, the UI frame may be
lost without notification to the layer‑3 entity if a logical link exception
occurs during transmission of the command.
#### 6.4.2.2 Unconfirmed Information (UI) Dummy command
The UI Dummy command is a special UI command that shall never be transmitted
by an LLC entity, but it can be received by the LLC entity at the MS.
If the LLC entity at the MS receives a UI Dummy command, it shall discard it
without any further actions.
NOTE 1: The UI Dummy command may be used by the network for different purposes
which are specified in 3GPP TS 44.060 [23] (e.g. to delay the release of a
downlink TBF).
The format of the UI Dummy command is illustrated in figure 11a. The length of
the UI Dummy command is variable, with a minimum value of 6 octets and a
maximum value of 79 octets. All octets from octet 4 to the last octet N shall
be encoded with a hexadecimal value of 2B.
NOTE 2: The format specified for the UI Dummy command ensures that a receiving
LLC entity will always discard it, since the FCS field check always fails (no
matter what the length of the UI Dummy command is).
* * *
Bit  
8 7 6 5 4 3 2 1  
PD=0 C/R=1 0 0 SAPI=3 Octet 1  
1 1 D=0 0 0 N(U) =0 Octet 2  
N(U) =0 E=0 PM=1 Octet 3  
0 0 1 0 1 0 1 1 Octet 4 0 0 1 0 1 0 1 1 Octet 5 0 0 1 0 1 0 1 1 Octet 6 ·  
·  
·  
0 0 1 0 1 0 1 1 Octet N-2 (LLC FCS field) 0 0 1 0 1 0 1 1 Octet N-1 (LLC FCS
field) 0 0 1 0 1 0 1 1 Octet N (LLC FCS field)
* * *
Figure 11a: Format of the UI Dummy command
### 6.4.3 Combined Information (I) and Supervisory (S) frames
The function of the information (I) frame is to transfer, across a logical
link connection, sequentially-numbered frames containing information fields
provided by layer 3. This frame shall only be used in the ABM operation.
Numbered I frames shall also carry supervisory information, and are for this
reason also called I+S frames. A separate S frame is sent when there is no
information field to be transferred. Whether an I+S or S frame is transmitted
as a command or as a response is insignificant in the ABM procedures.
#### 6.4.3.1 Receive Ready (RR) command / response
The receive ready (RR) supervisory frame is used by an LLE to:
\- indicate that it is ready to receive an I frame; and
\- acknowledge previously received I frames numbered up to and including N(R)
‑ 1 (as defined in clause 8).
In addition to indicate the status of an LLE, the RR frame with the A bit set
to 1 may be used by the LLE to request an acknowledgement from its peer LLE.
The transmission of an RR frame shall also indicate the clearance of any busy
condition within the sending LLE that was reported by the earlier transmission
of an RNR frame by the same LLE.
#### 6.4.3.2 Acknowledgement (ACK) command / response
The ACK supervisory frame shall be used by an LLE to acknowledge a single or
multiple I frames. Frames up to and including N(R) ‑ 1, and frame N(R) + 1,
have been received correctly. The procedures associated with the ACK control
field are defined in subclause 8.6.3.
In addition to indicate the status of an LLE, the ACK frame with the A bit set
to 1 may be used by the LLE to request an acknowledgement from its peer LLE.
The transmission of an ACK frame shall also indicate the clearance of any busy
condition within the sending LLE that was reported by the earlier transmission
of an RNR frame by the same LLE.
#### 6.4.3.3 Selective Acknowledgement (SACK) command / response
The SACK supervisory frame shall be used by an LLE to acknowledge a single or
multiple I frames. Frames up to and including N(R) ‑ 1, and frames indicated
by the SACK bitmap, have been received correctly. The format of the SACK
control field is shown in figure 9. The procedures associated with the SACK
control field are defined in subclause 8.6.3.
In addition to indicate the status of an LLE, the SACK frame with the A bit
set to 1 may be used by the LLE to request an acknowledgement from its peer
LLE.
The transmission of a SACK frame shall also indicate the clearance of any busy
condition within the sending LLE that was reported by the earlier transmission
of an RNR frame by the same LLE.
#### 6.4.3.4 Receive Not Ready (RNR) command / response
The receive not ready (RNR) supervisory frame shall be used by an LLE to
indicate a busy condition; that is, a temporary inability to accept additional
incoming I frames. The value of N(R) in the RNR frame acknowledges I frames
numbered up to and including N(R) ‑ 1. Subsequent frames, if any, shall not be
considered confirmed. The acceptance status of those is a matter of further
status exchange.
In addition to indicate the status of an LLE, the RNR frame with the A bit set
to 1 may be used by the LLE to request an acknowledgement from its peer LLE.
# 7 Elements for layer-to-layer communication
## 7.1 Definition of service primitives and parameters
### 7.1.0 General
Communications between layers and between entities within the logical link
control layer are accomplished by means of service primitives. Service
primitives represent, in an abstract way, the logical exchange of information
and control between the logical link control layer and adjacent layers. They
do not specify or constrain implementations.
Service primitives consist of commands and their respective responses
associated with the services requested of another layer. The general syntax of
a primitive is:
XXX ‑ Generic name ‑ Type (Parameters)
where XXX designates the service access point between the LLC layer and the
layer providing or using the service. For the present document XXX is:
\- \"LLGMM\" for the SAP between the LLC layer and the GPRS mobility
management function;
\- \"LL\" for the SAPs between the LLEs and layer 3;
\- \"GRR\" for the SAP between the LLC layer and the RLC/MAC layer; and
\- \"BSSGP\" for the SAP between the LLC layer and the BSSGP layer.
### 7.1.1 Primitives types
The primitives types defined in the present document are:
NOTE: For the action sequence of these primitive types, see 3GPP TS 44.001
[7].
#### 7.1.1.1 Request
The Request primitive type is used when a higher layer is requesting a service
from the next lower layer.
#### 7.1.1.2 Indication
The Indication primitive type is used by a layer providing a service to notify
the next higher layer of activities related to the Request primitive type of
the peer.
#### 7.1.1.3 Response
The Response primitive type is used by a layer to acknowledge receipt, from
the next lower layer, of the Indication primitive type.
#### 7.1.1.4 Confirm
The Confirm primitive type is used by the layer providing the requested
service to confirm that the activity has been completed (successfully or
unsuccessfully).
### 7.1.2 LLC layer service primitives
A service primitive specifies the activity that the identified layer should
perform. Table 7 lists the primitives defined in the present document.
Table 7: LLC layer service primitives
* * *
Generic Name Location Type Parameters  
MS SGSN REQ IND RES CNF  
**GMM ↔ LLME**  
LLGMM-ASSIGN X X X TLLI Old, TLLI New, Ciphering Key, Ciphering Algorithm,
Integrity Key, Integrity Algorithm LLGMM-RESET X X X TLLI LLGMM-TRIGGER X X
TLLI, Cause LLGMM-SUSPEND X X TLLI LLGMM-SUSPEND X X TLLI, Page LLGMM-RESUME X
X X TLLI LLGMM-PAGE X X TLLI LLGMM-IOV X X X TLLI LLGMM-STATUS X X X TLLI,
Cause LLGMM-PSHO X X TLLI, Ciphering Algorithm LLGMM-PSHO X X TLLI, Ciphering
Key, Ciphering Algorithm LLGMM-PSHO X X TLLI, IOV-UI, old XID indicator LLGMM-
ASSIGN-USERPLANE X X X TLLI **GMM ↔ LLE, SNDCP ↔ LLE, SMS ↔ LLE, and TOM ↔
LLE**  
LL-RESET X X X TLLI, old XID indicator LL-ESTABLISH X X X TLLI, XID Req LL-
ESTABLISH X X X TLLI, XID Req, N201‑U, N201‑I LL-ESTABLISH X X X TLLI, XID Neg
LL-ESTABLISH X X X TLLI, XID Neg, N201‑U, N201‑I LL-RELEASE X X X TLLI, Local
LL-RELEASE X X X TLLI, Cause LL-RELEASE X X X TLLI LL-XID X X X TLLI, XID Req
LL-XID X X X TLLI, XID Req, N201‑U, N201‑I LL-XID X X X TLLI, XID Neg LL-XID X
X X TLLI, XID Neg, N201‑U, N201‑I LL-DATA X X TLLI, L3‑PDU, Reference, QoS
Parameters, Radio Priority LL-DATA X X TLLI, L3‑PDU, Reference, QoS Parameters
LL-DATA X X X TLLI, L3‑PDU LL-DATA X X X TLLI, Reference LL-UNITDATA X X TLLI,
L3‑PDU, QoS Parameters, Radio Priority, Cipher, Integrity Protection LL-
UNITDATA X X TLLI, L3‑PDU, QoS Parameters, Cipher, Redirect indication, IMSI,
GMM cause, Redirect complete, Integrity Protection LL-UNITDATA X X TLLI,
L3‑PDU, Cipher, Integrity Protection, MAC Verified, LLC-MAC LL-UNITDATA X X
TLLI, L3‑PDU, Cipher, Redirect attempt, IMSI, Integrity Protection, MAC
Verified, LLC-MAC LL-STATUS X X X TLLI, Cause **LLE ↔ RLC/MAC**  
GRR-DATA X X TLLI, LL‑PDU, SAPI, Cause, QoS Parameters, Radio Priority GRR-
DATA X X TLLI, LL‑PDU GRR-UNITDATA X X TLLI, LL‑PDU, SAPI, QoS Parameters,
Radio Priority GRR-UNITDATA X X TLLI, LL‑PDU **LLE ↔ BSSGP**  
BSSGP-DL-UNITDATA X X TLLI, LL‑PDU, QoS Parameters, RLC Confirm, SAPI,
Redirect indication, IMSI,GMM cause, V(U) for redirect, Redirect complete
BSSGP-UL-UNITDATA X X TLLI, LL‑PDU, Cell Id, Redirect attempt, IMSI, V(U) for
redirect NOTE: Parameters related to MOCN configuration, i.e. Redirect
indication, IMSI, GMM cause, Redirect attempt, V(U) for redirect, and Redirect
complete are applicable only to SAPI 1.
* * *
## 7.2 Primitive procedures
### 7.2.1 GMM - LLME primitives
#### 7.2.1.1 LLGMM-ASSIGN
The LLGMM-ASSIGN primitive shall be used by the GPRS mobility management
entity to assign, change, or unassign the TLLI, the ciphering key (Kc or
Kc~128~), the ciphering algorithm, the integrity key and the integrity
algorithm.
The TLLI Old and TLLI New parameters shall be interpreted as follows:
\- If TLLI Old = all 1\'s and TLLI New ≠ all 1\'s then TLLI New shall be
assigned and used when (re‑)transmitting LLC frames. If a TLLI Old ≠ all 1\'s
was assigned to the LLME, then TLLI Old is unassigned. Only TLLI New shall be
accepted when received from the peer. It shall be treated as a TLLI change
according to subclause 8.3.2. If TLLI Old = all 1\'s was assigned to the LLME,
then this shall be treated as a TLLI assignment according to subclause 8.3.1,
and the LLGMM-ASSIGN-REQ shall be the first primitive sent by GMM in order to
enable LLC to process requests from layer 3.
\- If TLLI Old ≠ all 1\'s and TLLI New ≠ all 1\'s then TLLI Old and TLLI New
are assigned, and TLLI New shall be used when (re‑)transmitting LLC frames.
Both TLLI Old and TLLI New shall be accepted when received from the peer. It
shall be treated as a TLLI change according to subclause 8.3.2.
\- If TLLI Old ≠ all 1\'s and TLLI New = all 1\'s then TLLI Old shall be
unassigned. It shall be treated as a TLLI unassignment according to subclause
8.3.3, and the LLGMM-ASSIGN-REQ shall be the last primitive sent by GMM in
order to disable LLC to not any longer process requests from layer 3.
An LLC frame received with a DLCI belonging to an unassigned TLLI shall be
discarded without any further actions, with the following exception: UI and
XID frames with TLLI = unassigned and SAPI = 1 received in the SGSN shall be
handled according to the LLC protocol.
Ciphering Key and Ciphering Algorithm are associated with TLLI New (and with
TLLI Old if assigned):
\- If Ciphering Algorithm indicates no ciphering, then the ciphering function
shall be disabled.
\- Otherwise, the ciphering function shall be enabled. If a Ciphering
Algorithm was already associated with TLLI New or TLLI Old, then the new
Ciphering Key shall replace the previous Ciphering Key, and Ciphering
Algorithm shall replace the previous algorithm selection. All I frames, and UI
frames with the E bit set to 1, shall use the new Ciphering Key and algorithm
for ciphering. All unacknowledged I frames shall be ciphered using the new
Ciphering Key and algorithm before retransmission. As an implementation
option, the previous Ciphering Key and algorithm may be used to decipher
received frames.
Integrity Key and Integrity Algorithm are associated with TLLI New (and with
TLLI Old if assigned). This is only applicable to a network supporting
integrity protection in the LLC layer (see subclause 4.6a):
\- If Integrity Algorithm indicates no integrity protection, then the
integrity protection function shall be disabled.
\- Otherwise, the integrity protection function shall be enabled. If an
Integrity Algorithm was already associated with TLLI New or TLLI Old, then the
new Integrity Key shall replace the previous Integrity Key, and Integrity
Algorithm shall replace the previous algorithm selection. All UI frames with
the IP bit set to 1, shall use the new Integrity Key and algorithm for
integrity protection. As an implementation option, the previous Integrity Key
and algorithm may be used to integrity protect received frames.
#### 7.2.1.2 LLGMM-RESET
LLGMM-RESET-REQ shall be used to order LLC in the SGSN to perform an XID
negotiation of Reset and IOV‑UI (if ciphering is used) and i-IOV-UI (if
integrity protection is used). The LLC layer shall randomly select the value
of IOV‑UI (if ciphering is used) and i-IOV-UI (if integrity protection is
used).
LLGMM-RESET-CNF shall be used to inform GMM in the SGSN that a successful XID
negotiation of Reset and IOV‑UI (if ciphering is used) and i-IOV-UI (if
integrity protection is used) have been made.
#### 7.2.1.3 LLGMM-TRIGGER
LLGMM-TRIGGER-REQ shall be used in the MS to order LLC to transmit any single
frame.
If there is a frame waiting to be transmitted in the MS, then this frame shall
be transmitted on the corresponding SAPI or optionally a UI frame with no
information field shall be transmitted on any SAPI. Otherwise if Cause
indicates Cell Update and if Cell Notification is indicated by the SGSN (see
3GPP TS 24.008 [8a]), then a NULL frame with P=0 shall be transmitted on any
SAPI. Otherwise, and if the LLE is in ABM state, a supervisory frame shall be
transmitted according to subclause 8.6.4.1 or optionally a UI frame with no
information field shall be transmitted on any SAPI. Otherwise, and if the LLE
is in ADM state a UI frame with no information field shall be transmitted.
There is only need to transmit one frame on one SAPI.
LLGMM-TRIGGER-REQ is normally used for cell updates or for page responses, and
the reason shall be indicated in the Cause parameter. If Cause indicates page
response, then the GRR-DATA-REQ Cause parameter shall also indicate page
response.
#### 7.2.1.4 LLGMM-SUSPEND
LLGMM-SUSPEND-REQ shall be used to order LLC to suspend operation for an MS
until LLGMM-RESUME-REQ is received. While suspended, LLC shall:
\- reset timer T201 if running and (in the SGSN) if the Page parameter is not
set; and
\- stop frame transmission.
Frame reception shall still be possible. The Page parameter in the SGSN
controls whether LLGMM-PAGE-IND shall be sent to GMM or not (see subclause
7.2.1.6). In the MS, and in the SGSN if the Page parameter is not set, ADM
procedures for SAPI = 1 including UI frame transmission shall still be
possible, and ABM (re‑)establishment, ABM release, and XID negotiation
procedures on all SAPIs including U frame transmission shall still be
possible.
L3‑PDUs and unacknowledged I frames that are buffered shall be preserved while
LLC operation is suspended, and may be deleted by procedures allowed while LLC
operation is suspended.
The state (e.g., ABM, ADM) and the state variables (e.g. the transmit and
receive counters) shall be preserved while LLC operation is suspended, and may
be changed by procedures allowed while LLC operation is suspended.
#### 7.2.1.5 LLGMM-RESUME
LLGMM-RESUME-REQ shall be used to order LLC to resume a suspended operation
for an MS. LLC operation shall continue with the current set of buffered
L3‑PDUs, buffered unacknowledged I frames, the state, and the state variables.
If timer T201 was reset upon reception of LLGMM-SUSPEND-REQ then timer T201
shall be set.
#### 7.2.1.6 LLGMM-PAGE
If the Page parameter received in the LLGMM-SUSPEND-REQ primitive is set to
true, LLGMM-PAGE-IND shall be sent to GMM in the SGSN whenever LLC has an
LL‑PDU ready for transmission and LLC operation is suspended. The LL‑PDU shall
not be transmitted until LLGMM-RESUME-REQ has been received from GMM.
If the Page parameter is set to false, LLGMM-PAGE-IND shall not be sent, and
the LL‑PDU shall not be transmitted until LLGMM-RESUME-REQ has been received
from GMM.
NOTE: LLGMM-PAGE-IND causes GMM to initiate paging of the MS.
#### 7.2.1.7 LLGMM-IOV
LLGMM-IOV-REQ shall be used to order LLC in the SGSN to perform an XID
negotiation of IOV‑UI (if ciphering is used) and i-IOV-UI (if integrity
protection is used). The LLC layer shall randomly select the value of IOV‑UI
(if ciphering is used) and i-IOV-UI (if integrity protection is used).
LLGMM-IOV-CNF shall be used to inform GMM in the SGSN that a successful XID
negotiation of IOV‑UI (if ciphering is used) and i-IOV-UI (if integrity
protection is used) have been made.
#### 7.2.1.8 LLGMM-STATUS
LLGMM-STATUS-IND shall be used to inform GMM when an LLC error that cannot be
corrected by the LLC layer has occurred.
#### 7.2.1.9 LLGMM-PSHO
The LLGMM-PSHO primitives shall be used in the SGSN during PS Handover (see
3GPP TS 43.129 [26]) as follows:
  * LLGMM-PSHO-REQ shall be used by GMM to provide LLC with the local TLLI to be associated with the mobile station in the new cell. It is used to order LLC in the SGSN to select an IOV‑UI. The LLC layer shall randomly select the value of IOV‑UI. It is further used to assign the ciphering key (Kc or Kc~128~) and the ciphering algorithm.
  * LLGMM-PSHO-CNF shall be used by LLC to confirm the local TLLI allocation. It is used to indicate whether each LLE shall use the default configuration for the LLC layer parameters and layer‑3 parameters or shall re-initialize the latest negotiated configuration for the LLC layer parameters and layer‑3 parameters after PS Handover. It is further used to provide the selected IOV-UI value to use after PS Handover.
The LLGMM-PSHO primitives shall be used in the MS during PS Handover (see 3GPP
TS 43.129 [26]) as follows:
  * LLGMM-PSHO-IND shall be used by LLC to indicate the Ciphering Algorithm.
#### 7.2.1.10 LLGMM-ASSIGN-USERPLANE
The LLGMM-ASSIGN-USERPLANE primitive shall be used by the GPRS mobility
management entity to request to start integrity protection of user plane data
in the LLC layer.
This is only applicable to a network supporting integrity protection in the
LLC layer (see subclause 4.6a).
### 7.2.2 Layer 3 - LLE primitives
#### 7.2.2.1 LL-RESET
LL-RESET-IND shall be used in the SGSN to indicate that the Reset XID
parameter is transmitted to the MS. LL-RESET-IND shall be used in the MS to
indicate that the Reset XID parameter has been received from the SGSN or that
a Reset is requested in a PS handover. In case of a PS Handover the old XID
indicator indicates whether to keep the configuration for the layer‑3
parameters that was applicable before the receipt of the LL-RESET-IND
#### 7.2.2.2 LL-ESTABLISH
The LL-ESTABLISH primitives shall be used to request, indicate, respond to,
and confirm establishment of ABM operation. XID Req and XID Neg are used to
negotiate layer‑3 XID parameters between the layer‑3 peers, see 3GPP TS 44.065
[11].
#### 7.2.2.3 LL-RELEASE
The LL-RELEASE primitives shall be used to request, indicate, and confirm
termination of a previously established ABM operation. The Local parameter
indicates whether the termination shall be local, i.e., a DISC frame shall not
be transmitted, or not local, i.e. a DISC frame shall be transmitted. The
Cause parameter indicates the cause for termination of ABM operation.
#### 7.2.2.4 LL-XID
The LL-XID primitives shall be used to request, indicate, respond to, and
confirm negotiation of layer‑3 XID parameters.
#### 7.2.2.5 LL-DATA
The LL-DATA primitives shall only be used for LLEs in ABM. The following
operations are defined:
\- LL-DATA-REQ shall be used to request the confirmed transmission of an
L3‑PDU to the peer. QoS Parameters in the SGSN includes precedence class,
delay class, and peak throughput. QoS Parameters in the MS includes peak
throughput. QoS Parameters is defined as part of the Quality of Service
information element in 3GPP TS 24.008 [8a]. Radio Priority indicates the radio
priority level to be used by the RLC/MAC layer.
\- LL-DATA-IND shall be used to deliver a correctly received L3‑PDU to layer
3.
\- LL-DATA-CNF shall be used to confirm the delivery of an L3‑PDU to layer 3
in the peer. The Reference parameter shall be set to the same value as the
Reference parameter received in the corresponding LL-DATA-REQ.
#### 7.2.2.6 LL-UNITDATA
LL-UNITDATA-REQ shall be used to request the unconfirmed transmission of an
L3‑PDU to the peer. QoS Parameters in the SGSN includes precedence class,
delay class, reliability class, and peak throughput. QoS Parameters in the MS
includes peak throughput and reliability class. Reliability class indicates
whether the UI frame carrying the L3‑PDU shall be transmitted in protected or
unprotected mode, and whether the RLC/MAC layer acknowledged or unacknowledged
mode shall be used. Radio Priority indicates the radio priority level to be
used by the RLC/MAC layer. Cipher indicates whether the UI frame shall be
ciphered or not.
Redirect indication, if included, indicates that the SGSN in a multi-operator
core network (MOCN) configuration (see 3GPP TS 23.251 [5b]) cannot serve the
L3 request. IMSI indicates the IMSI of the UE that is associated with the LLE.
GMM cause is the cause code in the L3 message. Redirect complete, if included,
indicates that the SGSN will serve the L3 request. Redirect indication and
redirect complete shall not both be included.
Only applicable to a network supporting integrity protection in the LLC layer
(see subclause 4.6a):
\- Integrity Protection indicates whether the GMM message was integrity
protected with a MAC or not.
LL-UNITDATA-IND shall be used to deliver an L3‑PDU received in a UI frame to
layer 3. Cipher indicates whether the received UI frame was ciphered or not.
Redirect attempt and IMSI indicate parameters related to MOCN configuration
that are to be forwarded with the L3-PDU received in the associated BSSGP-UL-
UNITDATA-IND primitive.
NOTE: The MOCN parameters map to BSSGP information elements as described in
3GPP TS 48.018 [12].
Only applicable to a network supporting integrity protection in the LLC layer
(see subclause 4.6a):
\- Integrity Protection indicates whether the GMM message was integrity
protected with a MAC or not:
\- MAC Verified indicates whether the MAC protecting the GMM message in LLC
layer was successfully verified or not; and
\- MAC-LCC contains the MAC protecting the GMM message in LLC layer which
could not be verified in the LLC layer due to no integrity key or no integrity
algorithm configured in the LLC layer.
#### 7.2.2.7 LL-STATUS
LL-STATUS-IND shall be used to inform layer 3 when an LLC error that cannot be
corrected by the LLC layer has occurred.
### 7.2.3 LLE ‑ RLC/MAC primitives
#### 7.2.3.0 General
Although the GRR-DATA or GRR-UNITDATA primitives are used in all LLC frame
transfer operations, for simplicity reasons they are not included in the
procedure descriptions in clause 8.
#### 7.2.3.1 GRR-DATA
GRR-DATA-REQ shall be used by an LLE in an MS to request the reliable
transmission of an LL‑PDU. SAPI indicates the SAPI of the LLE. Cause indicates
whether GRR-DATA-REQ is sent due to a page response. QoS Parameters includes
peak throughput. For UI frames, peak throughput shall be set according to the
QoS parameters of the layer‑3 entity requesting the transmission of the UI
frame. For all other LLC frames, peak throughput may be set according to the
QoS parameters for any layer‑3 entity that is using the SAPI. Radio Priority
indicates the radio priority level to be used by the RLC/MAC layer.
GRR-DATA-IND shall be used by the RLC/MAC layer in an MS to indicate the
successful reception of an LL‑PDU. The LL‑PDU was completely received without
errors detected by the RLC layer.
All LLC frames except UI frames for SAPIs 3, 5, 9, and 11 shall be transferred
with GRR-DATA primitives. All UI frames for SAPIs 3, 5, 9, and 11 shall be
transferred with GRR-DATA or GRR-UNITDATA primitives.
#### 7.2.3.2 GRR-UNITDATA
GRR-UNITDATA-REQ shall be used by an LLE in an MS to request the unreliable
transmission of a UI frame. SAPI indicates the SAPI of the LLE. QoS Parameters
includes peak throughput. Peak throughput shall be set according to the QoS
parameters of the layer‑3 entity requesting the transmission of the UI frame.
Radio Priority indicates the radio priority level to be used by the RLC/MAC
layer.
GRR-UNITDATA-IND shall be used by the RLC/MAC layer in an MS to indicate the
reception of a UI frame.
Only UI frames for SAPIs 3, 5, 9, and 11 shall be transferred with GRR-
UNITDATA primitives.
### 7.2.4 LLE ‑ BSSGP primitives
#### 7.2.4.0 General
Although the BSSGP-UNITDATA primitives are used in all LLC frame transfer
operations, for simplicity reasons they are not included in the procedure
descriptions in clause 8.
#### 7.2.4.1 BSSGP-DL-UNITDATA
BSSGP-DL-UNITDATA-REQ shall be used by an LLE in an SGSN to request the
transmission of an LL‑PDU. QoS Parameters includes precedence class, delay
class, and peak throughput. RLC Confirm indicates whether the request shall be
mapped into a GRR-DATA-REQ or GRR-UNITDATA-REQ primitive in the BSS. SAPI
indicates the SAPI of the LLE.
All LLC frames except UI frames for SAPI 3, 5, 9 and 11 shall be transferred
with RLC Confirm indicating mapping into GRR-DATA-REQ primitive. All UI frames
for SAPIs 3, 5, 9, and 11 shall be transferred with RLC Confirm indicating
mapping into a GRR-DATA-REQ or GRR-UNITDATA-REQ primitives.
In a MOCN configuration, Redirect indication, IMSI, GMM cause, and Redirect
complete indicate the values received for the same parameters in the
associated LL-UNITDATA-IND primitive on SAPI 1, if included with the L3 PDU to
be transferred.
If Redirect indication is included with the L3 PDU to be transferred by the
SAPI 1 LLE, the V(U) for redirect parameter value shall be set to N(U) + 1
where N(U) is the value included in the header of the LL-PDU.
NOTE: The decision of whether to include MOCN parameters in the associated
BSSGP PDU is taken in BSSGP (see 3GPP TS 48.018 [12]).
#### 7.2.4.2 BSSGP-UL-UNITDATA
BSSGP-UL-UNITDATA-IND shall be used by the BSSGP layer in an SGSN to indicate
the reception of an LL‑PDU. Cell Id indicates the location of the MS when the
LL‑PDU was transmitted.
In a MOCN configuration, for SAPI 1, the Redirect attempt, IMSI, and V(U) for
redirect parameters may apply. Redirect attempt indicates that the L3 PDU has
been redirected by another SGSN. IMSI indicates the IMSI as defined in 3GPP TS
23.003 [3a] corresponding to the UE associated with the LLE. If the V(U) for
redirect parameter is included, the SAPI 1 LLE in the SGSN shall set its value
of V(U) equal to the value of the V(U) for redirect parameter received.
Redirect attempt and IMSI are forwarded to GMM along with the L3 PDU.
### 7.2.5 LLME - LLE primitives
The primitives that co-ordinate activities between the LLM and LL entities are
not described. Implementations shall perform the necessary co-ordination
between GMM ↔ LLME primitives and LLE operation.
# 8 Definition of the LLC peer-to-peer protocol
## 8.1 General
In the following subclauses, a protocol for use by the GPRS logical link
control layer between the SGSN and MS is specified, referred to as \"LLC\".
The LLC elements of procedure (frame types) that apply are:
\- for unacknowledged information transfer:
\- UI command; and
\- for ABM acknowledged information transfer:
\- SABM command;
\- UA response;
\- DM response;
\- DISC command;
\- RR command / response;
\- RNR command / response;
\- ACK command / response;
\- SACK command / response;
\- I command / response; and
\- for both unacknowledged and acknowledged information transfer:
\- FRMR response; and
\- XID command / response.
For handling of timers, the procedures and terminology of ITU-T Recommendation
Z.100 [15] are used:
Set \ means that:
a) if the timer is inactive, the timer becomes active, i.e., a timer value is
associated with the timer and it starts running; and
b) if the timer is active, the timer is first reset as in c) below, and then
set as in a) above.
Reset \ means that:
c) if the timer is active, the timer becomes inactive, i.e., the association
with the timer value is lost and it stops running; and
d) if the timer is inactive, it remains inactive.
## 8.2 Procedure for the use of the P/F bit
Timer T200 shall be set when a command frame with the P bit set to 1 is
transmitted. An LLE receiving a command frame with the P bit set to 1 shall
set the F bit to 1 in the next response frame it transmits. An LLE receiving a
command frame with the P bit set to 0 shall discard the command frame with no
further action.
Only one frame with a P bit set to 1 shall be outstanding in a given direction
at a given time. Before another frame with the P bit set to 1 can be
transmitted, a response frame with the F bit set to 1 shall be received, N200
retransmissions of the outstanding frame shall occur, or the frame shall be
discarded because of an unnumbered frame collision.
## 8.3 TLLI assignment procedures
### 8.3.0 General
TLLI assignment and unassignment is further described in clause 7 and annex C.
The following two subclauses illustrate the TLLI assignment and unassignment
procedures.
### 8.3.1 TLLI assignment
GMM shall assign a TLLI by sending an LLGMM-ASSIGN-REQ (TLLI New ≠ all 1\'s)
primitive to LLME. Upon receiving LLGMM-ASSIGN-REQ, LLME shall enter the TLLI
Assigned state, and set LLC layer parameters, states, and variables as defined
in subclause 8.5.3.1. TLLI assignment is illustrated in figure 12.
### 8.3.2 TLLI change
This procedure is used to change from a previously assigned TLLI value to a
new TLLI value. GMM shall change TLLI by sending an LLGMM-ASSIGN-REQ (TLLI Old
≠ all 1\'s, TLLI New ≠ all 1\'s) primitive to LLME. Upon receiving LLGMM-
ASSIGN-REQ, LLME and all its LLEs shall not change their states. This is
illustrated in figure 12.
### 8.3.3 TLLI unassignment
This procedure is used to unassign a previously assigned TLLI value. GMM shall
unassign a TLLI by sending an LLGMM-ASSIGN-REQ (TLLI New = all 1\'s) primitive
to LLME. Upon receiving LLGMM-ASSIGN-REQ, LLME and all its LLEs shall enter
the TLLI Unassigned state. This is illustrated in figure 12.
Figure 12: TLLI assignment, change, and unassignment procedure
## 8.4 Procedures for unacknowledged information transfer
### 8.4.0 General
The procedures that apply to the unacknowledged transmission of information
are defined below. No LLC layer error recovery procedures are defined for
unacknowledged operation.
Figure 13: Unacknowledged information transmission
### 8.4.1 Transmission of unacknowledged information
Unacknowledged information shall be passed from layer 3 to the LLC layer with
the LL-UNITDATA-REQ (L3‑PDU, Protect, Cipher, Integrity Protection) primitive.
The L3‑PDU shall be transmitted in a UI command frame to the peer LLE. The PM,
E and IP bits in the UI frame shall be set according to the Protect, Cipher
and Integrity Protection parameters received from layer 3.
### 8.4.2 Receipt of unacknowledged information
On receipt of a UI command frame the contents of the information field shall
be passed to the appropriate layer‑3 entity with an LL-UNITDATA-IND (L3‑PDU,
Integrity Protection, MAC Verified, LLC-MAC) primitive, except:
\- if the DLCI of the received UI frame is not supported by the receiver; or
\- if N(U) of the received UI frame is in the range ( V(UR) ‑ 32 ) ≤ N(U) \ M ‑ B (where M is the maximum buffer
size -- see subclause 8.9.7), then the LLE shall not transmit any new I
frames, but may retransmit I frames as a result of the error recovery
procedures as described in subclauses 8.6.3 and 8.6.6.
When there is an opportunity to transmit a frame, then the LLE shall do one of
the following in order of priority:
\- If there are any I frames marked for retransmission and if the LLE is not
in the peer receive busy condition, then the LLE shall increment by 1 the
retransmission count variable for the I frame with the lowest send sequence
number N(S). If the retransmission count variable exceeds the value of N200,
then the LLE shall initiate the re-establishment procedure as described in
subclause 8.7.2. If the retransmission count variable does not exceed the
value of N200, then the LLE shall retransmit the I frame.
\- If the LLE has a new I frame to transmit, if V(S) \ M ‑ N201 as a result of the transmission of the I frame, unless the
next I frame to be transmitted is available and has an information field
length that is less than or equal to M ‑ B; or
\- V(S) = V(A) + k as a result of the transmission of the I frame.
When requesting an acknowledgement, the LLE shall set timer T201 and associate
the timer with the I frame currently being transmitted, or, if the A bit is
transmitted in an S frame, with the I frame last transmitted.
### 8.6.4 Peer receiver busy condition
After receiving a valid RNR frame, the LLE shall:
\- set a peer receiver busy condition;
\- not transmit nor retransmit any I frames to the peer LLE;
\- treat the N(R) contained in the received RNR frame as an acknowledgement
for all the I frames that have been (re‑)transmitted with an N(S) up to and
including N(R) ‑ 1, and set its V(A) to the value of the N(R) contained in the
RNR frame;
\- set timer T201 to initiate the inquiry process; and
\- reset the retransmission count variable.
If timer T201 expires, the LLE shall:
\- if the value of the retransmission count variable is less than N200:
\- transmit an appropriate supervisory frame (see subclause 8.6.4.1) with an A
bit set to 1;
\- set timer T201; and
\- add one to its retransmission count variable;
\- if the value of the retransmission count variable is equal to N200,
initiate a re-establishment procedure as defined in subclause 8.7. LLME shall
indicate this by means of the LLGMM-STATUS-IND primitive to GMM.
The LLE receiving the supervisory frame with the A bit set to 1 shall respond,
at the earliest opportunity, with an appropriate supervisory frame (see
subclause 8.6.4.1) to indicate whether or not its own receiver busy condition
still exists.
Upon receipt of the supervisory frame, the LLE shall reset timer T201, and:
\- if the frame is an RR, ACK or SACK frame:
\- the peer receiver busy condition shall be cleared;
\- if timer T201 was active before the peer receiver busy condition was set,
and if the associated I frame is still not acknowledged, then timer T201 shall
be set and associated with the same I frame; and
\- the LLE may transmit new I frames or retransmit I frames as defined in
subclauses 8.6.1 or 8.6.3, respectively; or
\- if the frame is an RNR frame, then the LLE shall proceed according to
subclause 8.6.4, first paragraph.
Upon receipt of a SABM command, the LLE shall clear the peer receiver busy
condition.
#### 8.6.4.1 Supervisory frame selection
If the LLE is in the own receiver busy condition, the appropriate supervisory
frame is the RNR frame.
Otherwise, if the highest-numbered I frame was received with N(S) = V(R), the
appropriate supervisory frame is the RR frame.
Otherwise, if the highest-numbered I frame was received with N(S) = V(R) + 1,
the appropriate supervisory frame is the ACK frame.
Otherwise, the appropriate supervisory frame is the SACK frame.
### 8.6.5 Own receiver busy condition
When the LLE enters the own receiver busy condition, it shall transmit an RNR
frame at the earliest opportunity.
All received I frames may be discarded, after updating V(A). If the A bit of a
received I frame was set to 1, then the LLE shall transmit an RNR frame.
All received supervisory frames shall be processed, including updating V(A).
If the A bit of a received S frame was set to 1, then the LLE shall transmit
an RNR frame.
To indicate to the peer LLE the clearance of the own receiver busy condition,
the LLE shall transmit an appropriate supervisory frame (see subclause
8.6.4.1).
The transmission of a SABM command or a UA response (in reply to a SABM
command) also indicates to the peer LLE the clearance of the own receiver busy
condition.
### 8.6.6 Waiting for acknowledgement
Frames may be lost any time during transmission due to e.g., transmission
errors. An LLE that has not received acknowledgement for a transmitted I frame
shall therefore on the expiry of timer T201 take appropriate recovery action.
The LLE shall maintain an internal retransmission count variable for each
transmitted I frame.
If timer T201 expires, the LLE shall increment by 1 the retransmission count
variable for the I frame associated with timer T201, and:
\- if the value of the retransmission count variable does not exceed N200, set
timer T201, and retransmit the I frame with the A bit set to 1; or
\- if the value of the retransmission count variable exceeds N200, initiate a
re-establishment procedure as defined in subclause 8.7.2. LLME shall indicate
this by means of the LLGMM-STATUS-IND primitive to GMM.
## 8.7 Re-establishment of ABM operation
### 8.7.1 Criteria for re-establishment
The criteria for re-establishing the ABM mode of operation are defined in this
clause by the following conditions:
\- the receipt, while in the ABM state, of a SABM;
\- the receipt of an LL-ESTABLISH-REQ primitive from layer 3 (see subclause
8.5.1.1);
\- the occurrence of N200 retransmission failures (see subclauses 8.6.4 and
8.6.6);
\- the occurrence of a frame rejection condition as identified in subclause
8.8.2; and
\- the receipt of an unsolicited DM response with the F bit set to 0 (see
subclause 8.8.4) while in ABM state.
### 8.7.2 Procedures
In all re-establishment situations, the LLE shall follow the procedures
defined in subclause 8.5.1. All locally-generated conditions for re-
establishment shall cause the transmission of the SABM.
In the case of LLC layer and peer-initiated re-establishment, the LLE shall
issue an LL-ESTABLISH-IND primitive to layer 3 and discard all outstanding LL-
DATA-REQ primitives and all queued I frames, and LLME shall issue an LLGMM-
STATUS-IND primitive to GMM.
In case of layer 3-initiated re-establishment, or if an LL-ESTABLISH-REQ
primitive occurs pending re-establishment, the LL-ESTABLISH-CNF primitive
shall be used.
Figure 21: LLC-initiated ABM re-establishment procedure
## 8.8 Exception condition reporting and recovery
### 8.8.0 General
Exception conditions may occur as the result of lower layer errors or LLC
layer procedural errors.
The error recovery procedures available to effect recovery following the
detection of an exception condition at the LLC layer are defined in this
subclause.
### 8.8.1 Invalid frame condition
Any received invalid frame shall be discarded, and no action shall be taken as
a result of that frame.
### 8.8.2 Frame rejection condition
A frame rejection condition results from one of the conditions described in
subclause 6.4.1.5 items 1) to 3).
Upon occurrence of a frame rejection condition, the LLME shall issue an LLGMM-
STATUS-IND primitive; and the LLE shall:
\- discard the frame causing the frame rejection condition;
\- transmit a FRMR response frame; and
\- if the LLE is in ABM operation, initiate re-establishment (see subclause
8.7.2).
### 8.8.3 Receipt of a FRMR response frame
Upon receipt of a FRMR response frame, the LLME shall issue an LLGMM-STATUS-
IND primitive.
### 8.8.4 Unsolicited response frames
The action to be taken on the receipt of an unsolicited response frame is
defined in table 8. Upon the receipt of an unsolicited UA response, the LLE
shall assume a possible multiple-TLLI assignment, and LLME shall inform GMM by
means of the LLGMM-STATUS-IND primitive.
Table 8: Actions taken on receipt of unsolicited response frames
+----------+----------+----------+----------+----------+----------+ | Uns | State | | | | | | olicited | | | | | | +----------+----------+----------+----------+----------+----------+ | R | TLLI | Local\ | Local\ | ABM | Timer\ | | esponse\ | A | Estab | Release | | Recovery | | Frame | ssigned\ | lishment | | | | | | / ADM | | | | | +----------+----------+----------+----------+----------+----------+ | UA | LLGMM-ST | S | S | LLGMM-ST | LLGMM-ST | | r | ATUS-IND | olicited | olicited | ATUS-IND | ATUS-IND | | esponse\ | | | | | | | F = 1 | | | | | | +----------+----------+----------+----------+----------+----------+ | UA | LLGMM-ST | LLGMM-ST | LLGMM-ST | LLGMM-ST | LLGMM-ST | | r | ATUS-IND | ATUS-IND | ATUS-IND | ATUS-IND | ATUS-IND | | esponse\ | | | | | | | F = 0 | | | | | | +----------+----------+----------+----------+----------+----------+ | DM | Ignore | S | S | LLGMM-ST | LLGMM-ST | | r | | olicited | olicited | ATUS-IND | ATUS-IND | | esponse\ | | | | | | | F = 1 | | | | | Re-e | | | | | | | stablish | | | | | | | ABM | +----------+----------+----------+----------+----------+----------+ | DM | Ignore | Ignore | Ignore | LLGMM-ST | LLGMM-ST | | r | | | | ATUS-IND | ATUS-IND | | esponse\ | | | | | | | F = 0 | | | | Re-e | Re-e | | | | | | stablish | stablish | | | | | | ABM | ABM | +----------+----------+----------+----------+----------+----------+ | Supe | Ignore | Ignore | Ignore | S | S | | rvisory\ | | | | olicited | olicited | | response | | | | | | +----------+----------+----------+----------+----------+----------+
A UA or XID response frame with the F bit set to 1, and that does not contain
a Layer‑3 Parameters XID parameter, received while a SABM or XID command
respectively that does contain a Layer‑3 Parameters XID parameter is
outstanding, shall be ignored.
A UA or XID response frame with the F bit set to 1, and that contains a
Layer‑3 Parameters XID parameter, received while a SABM or XID command
respectively that does not contain a Layer‑3 Parameters XID parameter is
outstanding, shall be ignored.
## 8.9 List of LLC layer parameters
### 8.9.0 General
The LLC layer parameters listed in this subclause are associated with each
DLCI, except the LLC version number and IOV‑UI, i-IOV-UI, i-IOV-UI-cnt and
MAC-IOV-UI that are associated with a TLLI.
A method of assigning these parameters is defined in subclauses 6.4.1.6 and
8.5.3.
Table 9 provides an overview of the LLC layer parameters and summarises the
recommended default values to be used in GSM networks. The term default
implies that the value defined should be used in the absence of any
negotiation of alternative values.
Some of the parameters, e.g., T200, T201, and N200, may have the same name as
parameters used in other GSM specifications. All the parameters listed here
are local to the LLC layer protocol, and shall not impact or be impacted by
parameters with the same name in other specifications.
### 8.9.1 LLC version number (Version)
The LLC version number (Version) is an LLC layer parameter. The default
version number is given in table 9.
### 8.9.2 Input Offset Values (IOV)
The Input Offset Values (IOV) are LLC layer parameters used for ciphering and
integrity protection.
For ciphering, the IOV values are IOV-I and IOV-UI. The IOV-I and IOV-UI are
random 32 bit values, generated by the SGSN. See also annex A.
The value for IOV can be different for I frames and UI frames. IOV‑UI is IOV
for UI frames. IOV‑I is IOV for I frames.
The default values of IOV-I and IOV-UI are given in table 9. The following
rules apply to the IOV values for ciphering:
\- After a change of ciphering key to a different value a random IOV-I value
shall be negotiated. If ABM is re-established for an LLE, and ciphering key is
not changed to a different value since ABM was last (re‑)established for this
LLE, then a random IOV‑I value shall be negotiated.
\- After a change of ciphering key to a different value, a random IOV-UI value
shall be negotiated. If the unconfirmed send state variable V(U) is reset for
an LLE, and ciphering key is not changed to a different value since V(U) was
last reset for this LLE, then a random IOV‑UI value shall be negotiated.
For integrity protection, the IOV values are i-IOV-UI and i-IOV-UI-cnt. The
i-IOV-UI is used for UI frames and is a random 32 bit value, generated by the
SGSN. See also 3GPP TS 43.020 [27].
The default values of i-IOV-UI and i-IOV-UI-cnt are given in table 9. The
following rules apply to the IOV values for integrity protection:
\- After a successful authentication, a random i-IOV-UI value shall be
negotiated. If the unconfirmed send state variable V(U) is reset for an LLE,
and integrity key is not changed to a different value since V(U) was last
reset for this LLE, then a random i-IOV‑UI value shall be negotiated.
\- After a successful authentication, both the MS and the SGSN shall store a
local counter i-IOV-UI-cnt showing the number of IOV updates since the
previous authentication. The counter is incremented by 1 every time the SGSN
updates the IOV values. The i-IOV-UI-cnt in the MS side represents the number
of successful IOV updates, and shall have the same or a lower value than the
value received from the SGSN.
NOTE: The maximum acceptable difference beween the value of the i-IOV-UI-cnt
stored in the MS and the new value received from the SGSN is implementation
specific.
The default value of MAC-IOV-UI is given in table 9. The MAC-IOV-UI is
calculated over the IOV values for ciphering and integrity protection that are
included in the same XID command. See 3GPP TS 43.020 [27] annex H.9.1 for
further details.
### 8.9.3 Retransmission timers (T200 and T201)
The retransmission timers (T200 and T201) are LLC layer parameters. Upon
expiry of timer T200 or T201, retransmission of a frame may be initiated
according to the procedures described in clause 8. The default value of timers
T200 and T201 for each SAPI is given in table 9. The value of timer T200 shall
be used when setting timer T201.
### 8.9.4 Maximum number of retransmissions (N200)
The maximum number of retransmissions of a frame (N200) is an LLC layer
parameter. The default value of N200 for each SAPI is given in table 9.
### 8.9.5 Maximum number of octets in an information field (N201)
The maximum number of octets in an information field (N201) is an LLC layer
parameter. See also subclause 5.4. The default value of N201 for each SAPI is
given in table 9. The minimum value of N201 shall be 140 octets, and the
maximum value shall be 1 520 octets.
NOTE: For an LLC frame with integrity protection, the MAC field is included in
the information field. When the MAC field is included in the message, the
maximum length of the integrity protected message is N201 \-- 4 octets (see
subclause 5.1).
The value of N201 may be different for I frames and U and UI frames. N201‑U is
used for U and UI frames, and N201‑I is used for I frames.
### 8.9.6 Maximum number of octets in the layer‑3 header (N202)
The maximum number of octets in the layer‑3 unitdata PDU header (N202) is an
LLC layer parameter. The N202 value shall be 4 for LLC version number 0.
NOTE: The N202 value of 4 octets coincides with the maximum-length SNDCP
SN‑UNITDATA PDU header.
### 8.9.7 Maximum I frame buffer size (m)
The maximum I frame buffer size (m) that may be used to buffer outstanding I
frame information fields at any given time is an LLC layer parameter that
shall be either 0 or from 9 through 24 320 in units of 16 octets. The default
values of m are given in table 9. If the value of m equals 0, then the LLE
shall not keep count of the number of outstanding I frame octets, i.e. the I
frame buffer variable B shall not be used. M is the maximum buffer size
expressed in octets, so that M = m x 16.
The value of m can be different in each direction of transmission. mD is m in
the downlink direction. mU is m in the uplink direction.
### 8.9.8 Maximum number of outstanding I frames (k)
The maximum number (k) of sequentially-numbered I frames that may be
outstanding (i.e. unacknowledged) at any given time is an LLC layer parameter
that shall not exceed 255. k is also denoted window size. The default values
of k are given in table 9.
The value of k can be different in each direction of transmission. kD is k in
the downlink direction, and kU is k in the uplink direction.
### 8.9.9 LLC layer parameter default values
Table 9: LLC layer parameter default values
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | LLC\ | SA | SA | SA | SA | SA | SA | SA | SAP | | Para | PI 1\ | PI 2\ | PI 3\ | PI 5\ | PI 7\ | PI 8\ | PI 9\ | I 11\ | | meter | GMM | TOM 2 | User | User | SMS | TOM 8 | User | User | | | | | D | D | | | D | Da | | | | | ata 3 | ata 5 | | | ata 9 | ta 11 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Ve | 0 | | | | | | | | | rsion | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | I | 0 | | | | | | | | | OV‑UI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | i-I | 0 | | | | | | | | | OV-UI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | i- | 0 | | | | | | | | | IOV-U | | | | | | | | | | I-cnt | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | MAC-I | 0 | | | | | | | | | OV-UI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | IOV‑I | Note | Note | 2^ | 2^ | Note | Note | 2^ | 2^ | | | 2 | 2 | 27^ x | 27^ x | 2 | 2 | 27^ x | 27^ x | | | | | SAPI | SAPI | | | SAPI | SAPI | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | T200 | 5 s | 5 s | 5 s | 10 s | 20 s | 20 s | 20 s | 40 s | | and | | | | | | | | | | T201 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | N200 | 3 | 3 | 3 | 3 | 3 | 3 | 3 | 3 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | N | 400 | 270 | 500 | 500 | 270 | 270 | 500 | 500 | | 201‑U | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | N | Note | Note | 1 503 | 1 503 | Note | Note | 1 503 | 1 503 | | 201‑I | 2 | 2 | | | 2 | 2 | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | mD | Note | Note | 1 520 | 760 | Note | Note | 380 | 190 | | | 2 | 2 | | | 2 | 2 | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | mU | Note | Note | 1 520 | 760 | Note | Note | 380 | 190 | | | 2 | 2 | | | 2 | 2 | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | kD | Note | Note | 16 | 8 | Note | Note | 4 | 2 | | | 2 | 2 | | | 2 | 2 | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | kU | Note | Note | 16 | 8 | Note | Note | 4 | 2 | | | 2 | 2 | | | 2 | 2 | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | T100 | 3s | 3s | 3s | 3s | 3s | 3s | 3s | 3s | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | NO | | | | | | | | | | TE 1: | | | | | | | | | | P | | | | | | | | | | roper | | | | | | | | | | LLC | | | | | | | | | | oper | | | | | | | | | | ation | | | | | | | | | | req | | | | | | | | | | uires | | | | | | | | | | that | | | | | | | | | | timer | | | | | | | | | | T200 | | | | | | | | | | be | | | | | | | | | | gr | | | | | | | | | | eater | | | | | | | | | | than | | | | | | | | | | the | | | | | | | | | | ma | | | | | | | | | | ximum | | | | | | | | | | time | | | | | | | | | | be | | | | | | | | | | tween | | | | | | | | | | tr | | | | | | | | | | ansmi | | | | | | | | | | ssion | | | | | | | | | | of | | | | | | | | | | co | | | | | | | | | | mmand | | | | | | | | | | f | | | | | | | | | | rames | | | | | | | | | | and | | | | | | | | | | the | | | | | | | | | | rece | | | | | | | | | | ption | | | | | | | | | | of | | | | | | | | | | their | | | | | | | | | | cor | | | | | | | | | | respo | | | | | | | | | | nding | | | | | | | | | | res | | | | | | | | | | ponse | | | | | | | | | | or | | | | | | | | | | ackno | | | | | | | | | | wledg | | | | | | | | | | ement | | | | | | | | | | fr | | | | | | | | | | ames. | | | | | | | | | | | | | | | | | | | | NO | | | | | | | | | | TE 2: | | | | | | | | | | This | | | | | | | | | | para | | | | | | | | | | meter | | | | | | | | | | ap | | | | | | | | | | plies | | | | | | | | | | to | | | | | | | | | | ABM | | | | | | | | | | p | | | | | | | | | | roced | | | | | | | | | | ures. | | | | | | | | | | ABM | | | | | | | | | | oper | | | | | | | | | | ation | | | | | | | | | | is | | | | | | | | | | not | | | | | | | | | | al | | | | | | | | | | lowed | | | | | | | | | | for | | | | | | | | | | GMM, | | | | | | | | | | SMS, | | | | | | | | | | and | | | | | | | | | | TOM | | | | | | | | | | that | | | | | | | | | | use | | | | | | | | | | only | | | | | | | | | | UI f | | | | | | | | | | rames | | | | | | | | | | for | | | | | | | | | | i | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | tran | | | | | | | | | | sfer. | | | | | | | | | | | | | | | | | | | | NO | | | | | | | | | | TE 3: | | | | | | | | | | The | | | | | | | | | | de | | | | | | | | | | fault | | | | | | | | | | v | | | | | | | | | | alues | | | | | | | | | | for | | | | | | | | | | SAPIs | | | | | | | | | | 3, 5, | | | | | | | | | | 9, | | | | | | | | | | and | | | | | | | | | | 11 | | | | | | | | | | have | | | | | | | | | | been | | | | | | | | | | c | | | | | | | | | | hosen | | | | | | | | | | to | | | | | | | | | | corre | | | | | | | | | | spond | | | | | | | | | | with | | | | | | | | | | the | | | | | | | | | | four | | | | | | | | | | GPRS | | | | | | | | | | qu | | | | | | | | | | ality | | | | | | | | | | of | | | | | | | | | | se | | | | | | | | | | rvice | | | | | | | | | | delay | | | | | | | | | | cla | | | | | | | | | | sses, | | | | | | | | | | see | | | | | | | | | | 3GPP | | | | | | | | | | TS 2 | | | | | | | | | | 2.060 | | | | | | | | | | \ | | | | | | | | | | [3]. | | | | | | | | | | How | | | | | | | | | | ever, | | | | | | | | | | there | | | | | | | | | | is no | | | | | | | | | | fixed | | | | | | | | | | re | | | | | | | | | | latio | | | | | | | | | | nship | | | | | | | | | | be | | | | | | | | | | tween | | | | | | | | | | SAPI | | | | | | | | | | and | | | | | | | | | | delay | | | | | | | | | | c | | | | | | | | | | lass. | | | | | | | | | | The | | | | | | | | | | LLC | | | | | | | | | | layer | | | | | | | | | | param | | | | | | | | | | eters | | | | | | | | | | for | | | | | | | | | | any | | | | | | | | | | SAPI | | | | | | | | | | can | | | | | | | | | | be | | | | | | | | | | negot | | | | | | | | | | iated | | | | | | | | | | to | | | | | | | | | | su | | | | | | | | | | pport | | | | | | | | | | any | | | | | | | | | | QoS | | | | | | | | | | pro | | | | | | | | | | file, | | | | | | | | | | see | | | | | | | | | | 3GPP | | | | | | | | | | TS 2 | | | | | | | | | | 3.060 | | | | | | | | | | \ | | | | | | | | | | [5]. | | | | | | | | | | | | | | | | | | | | NO | | | | | | | | | | TE 4: | | | | | | | | | | P | | | | | | | | | | roper | | | | | | | | | | LLC | | | | | | | | | | oper | | | | | | | | | | ation | | | | | | | | | | req | | | | | | | | | | uires | | | | | | | | | | that | | | | | | | | | | the | | | | | | | | | | v | | | | | | | | | | alues | | | | | | | | | | for | | | | | | | | | | N | | | | | | | | | | 201‑U | | | | | | | | | | and | | | | | | | | | | N | | | | | | | | | | 201‑I | | | | | | | | | | are | | | | | | | | | | not | | | | | | | | | | gr | | | | | | | | | | eater | | | | | | | | | | than | | | | | | | | | | the | | | | | | | | | | ma | | | | | | | | | | ximum | | | | | | | | | | n | | | | | | | | | | umber | | | | | | | | | | of | | | | | | | | | | o | | | | | | | | | | ctets | | | | | | | | | | in an | | | | | | | | | | i | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | field | | | | | | | | | | that | | | | | | | | | | can | | | | | | | | | | be | | | | | | | | | | t | | | | | | | | | | ransm | | | | | | | | | | itted | | | | | | | | | | or | | | | | | | | | | ret | | | | | | | | | | ransm | | | | | | | | | | itted | | | | | | | | | | over | | | | | | | | | | the | | | | | | | | | | Gb | | | | | | | | | | inter | | | | | | | | | | face, | | | | | | | | | | see | | | | | | | | | | 3GPP | | | | | | | | | | TS 4 | | | | | | | | | | 8.018 | | | | | | | | | | [ | | | | | | | | | | 12]. | | | | | | | | | | It is | | | | | | | | | | the | | | | | | | | | | resp | | | | | | | | | | onsib | | | | | | | | | | ility | | | | | | | | | | of | | | | | | | | | | the | | | | | | | | | | SGSN | | | | | | | | | | to | | | | | | | | | | nego | | | | | | | | | | tiate | | | | | | | | | | N | | | | | | | | | | 201‑U | | | | | | | | | | and | | | | | | | | | | N | | | | | | | | | | 201‑I | | | | | | | | | | to | | | | | | | | | | v | | | | | | | | | | alues | | | | | | | | | | compa | | | | | | | | | | tible | | | | | | | | | | with | | | | | | | | | | the | | | | | | | | | | usage | | | | | | | | | | of | | | | | | | | | | the | | | | | | | | | | Gb | | | | | | | | | | inter | | | | | | | | | | face. | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
###### ## Annex A (normative): Ciphering
# A.1 General
This annex specifies how LLC shall interface with the GPRS ciphering
algorithm. The requirements for the GPRS ciphering algorithm are contained in
3GPP TS 41.061 [2] (for GEA algorithms which require 64-bit ciphering key or
Kc), and in 3GPP TS 43.020 [27] (for GEA algorithms which require 128-bit
ciphering key or Kc~128~).
# A.2 Ciphering algorithm interface
## A.2.0 General
The ciphering algorithm has three input parameters:
\- the ciphering key (Kc or Kc~128~);
\- the frame-dependent input (Input); and
\- the transfer direction (Direction).
The ciphering algorithm has one output parameter:
\- Output.
The relationship between the input and output parameters and the ciphering
algorithm is illustrated in figure A.1.
Figure A.1: GPRS ciphering environment
The input and output parameters and the other elements from figure A.1 are
defined in table A.1.
Table A.1: Ciphering parameters and frames
* * *
Parameter Length Description
Kc 64 bits The LLGMM-ASSIGN-REQ Ciphering Key parameter received from GMM.
Kc~128~ 128 bits The LLGMM-ASSIGN-REQ Ciphering Key parameter received from
GMM.
Input 32 bits A modulo counter as defined in subclause A.2.1.
Direction 1 bit Set to 0 if the direction of LLC frame transmission is from
the MS to the SGSN.\ Set to 1 if the direction of LLC frame transmission is
from the SGSN to the MS.
Ciphering Algorithm - A GPRS ciphering algorithm as determined by the LLGMM-
ASSIGN-REQ Ciphering Algorithm parameter received from GMM.
Output maximum 1 523 octets The output of Ciphering Algorithm --- a sequence
of octets.
Unciphered Frame maximum 1 523 octets An LLC layer I or UI frame to be
ciphered.
Ciphered Frame maximum 1 523 octets A ciphered LLC layer I or UI frame. Only
the information field and the FCS field shall be ciphered. Ciphered Frame
shall be generated by XORing the octets of Output and the information field
and the FCS field of Unciphered Frame, starting with the lowest numbered octet
of Unciphered Frame.
Deciphered Frame maximum 1 523 octets A deciphered LLC layer I or UI frame.
Deciphered Frame shall be generated by XORing the octets of Output and the
ciphered part of Ciphered Frame, starting with the lowest numbered octet of
Ciphered Frame. When transmitting an LLC frame, Deciphered Frame shall be
identical to Unciphered Frame if no transmission errors have occurred.
* * *
It is an implementation option to optimise the ciphering algorithm by for
example producing only as many Output octets as is needed to cipher Unciphered
Frame.
## A.2.1 Generation of Input
The Input parameter shall be generated according to the following algorithm if
the frame is a UI frame:
Input = ( ( IOV‑UI ⊗ SX ) + LFN + OC ) modulo 2^32^
The Input parameter shall be generated according to the following algorithm if
the frame is an I frame:
Input = ( IOV‑I + LFN + OC ) modulo 2^32^
where:
\- IOV‑UI is a 32 bit random value generated by the SGSN.
\- IOV‑I is a 32 bit random value generated by the SGSN.
\- LFN is the LLC frame number in the LLC frame header. LFN is a binary value
with a length of nine bits. For I frames, N(S) shall be used as the LFN. For
UI frames, N(U) shall be used as the LFN.
\- OC is a binary overflow counter that is calculated and maintained
independently at the sending and receiving sides. The length of OC is 32 bits.
There are four OC counters associated with each DLCI; two for unacknowledged
information transfer (one for each direction of transmission), and two for
acknowledged information transfer (one for each direction of transmission). An
OC for acknowledged operation shall be set to 0 whenever ABM operation is
(re‑)established for the corresponding DLCI. OC shall be incremented by 512
every time when the corresponding LFN rolls over, i.e., when LFN exhausts its
modulo and restarts counting from 0, so that OC and LFN when added together in
effect is a 32 bit modulo 2^32^ counter.
\- SX is a 32 bit SAPI XOR mask calculated as follows: SX = 2^27^ x SAPI +
2^31^.
\- + is the binary addition operation.
\- ⊗ is the bitwise XOR operation.
###### ## Annex B (normative): Tunnelling of Messages (TOM)
Tunnelling of Messages (TOM) is a generic protocol layer used for the exchange
of TOM Protocol Envelopes (see figure B.1) between the MS and the SGSN. TOM
uses two LLC SAPs, one for high-priority messages and another for low-priority
messages. The TOM Protocol Envelope is composed of a TOM Protocol Header
(containing one or more octets) and a Message Capsule. The TOM Protocol Header
contains information about the specific application using the TOM protocol
layer and any other TOM Protocol Discriminator-specific information. The
Message Capsule is the actual payload of information in the TOM Protocol
Envelope. One of the uses of the TOM protocol layer is to tunnel signalling
messages between an MS and a non-GSM MSC/VLR when GPRS network elements are
used in non-GSM networks. See 3GPP TS 23.060 [5] and 3GPP TS 29.018 [23a]. The
TOM protocol layer is also used to tunnel Radio Resource LCS Protocol (RRLP)
messages. See 3GPP TS 43.059[25] and 3GPP TS 44.031[24].
# B.1 TOM Protocol Envelope structure
## B.1.0 TOM Protocol Envelope format
All TOM protocol peer-to-peer exchanges shall be in TOM Protocol Envelopes
conforming to the format shown in figure B.1. The TOM Protocol Header shall
consist of the TOM Protocol Discriminator, Remaining Length of TOM Protocol
Header, and Remaining Octets of TOM Protocol Header fields, and is a minimum
of 1 octet and a maximum of 15 octets long.
* * *
8 7 6 5 4 3 2 1 Remaining Length of TOM Protocol Header TOM Protocol
Discriminator
Remaining Octets of TOM Protocol Header  
(variable length, max. 14 octets)
Message Capsule  
(variable length, max. application specific)  
(variable length, max. 220 octets)
* * *
Figure B.1: TOM Protocol Envelope format
NOTE: When the TOM Protocol Discriminator indicates TIA/EIA-136, the maximum
size of the message capsule is 220 octets (see TIA/EIA-136 [22]).\ When the
TOM Protocol Discriminator indicates RRLP, the maximum size of the message
capsule is 242 octets (see 3GPP TS 44.031 [24]).
## B.1.1 TOM Protocol Discriminator
TOM Protocol Discriminator indicates the specific protocol using TOM, and is
coded as follows:
bits 4 3 2 1
> 0 0 0 0 Not specified
>
> 0 0 0 1 TIA/EIA‑136 (see TIA/EIA-136 ([22])
>
> 0 0 1 0 RRLP (see 3GPP TS 44.031 [24])
>
> 1 1 1 1 Reserved for extension
All other values are reserved
If any other value than \'0 0 0 1\' or \'0 0 1 0\' is received, then the TOM
Protocol Envelope shall be discarded with no further action.
## B.1.2 Remaining Length of TOM Protocol Header
Remaining Length of TOM Protocol Header indicates the number of octets
remaining in the TOM-protocol-header part of the TOM Protocol Envelope, and is
coded as follows:
**bits 8 7 6 5**
0 0 0 0 0 octets remaining in TOM protocol header
0 0 0 1 1 octet remaining in TOM protocol header
1 1 1 0 14 octets remaining in TOM protocol header
1 1 1 1 Reserved for extension
If the value 1 1 1 1 is received, then the TOM Protocol Envelope shall be
discarded with no further action.
## B.1.3 Remaining Octets of TOM Protocol Header
This field contains the octets following the first octet in the TOM-protocol-
header. If present, the interpretation of the information contained in this
field is TO M Protocol Discriminator-specific.
## B.1.4 Message Capsule
This field contains TOM Protocol Discriminator-specific payload in the TOM
Protocol Envelope.
###### ## Annex C (informative): LLC layer states for peer-to-peer operation
# C.1 General
The purpose of this annex is to provide a representative example of the peer-
to-peer procedures of the LLC layer, to assist in the understanding of the
present document. This representation does not describe all of the possible
actions of the LLC layer. The representation does therefore not constrain
implementations from exploiting the full scope of the procedures as presented
within the text of the present document. The text description of the
procedures is normative.
The representation is a model of the peer-to-peer procedures of the LLC layer
and is applicable to the LLC layers at both the MS and SGSN sides for all
ranges of TLLI values.
Figure C.1: Model of the LLC layer peer-to-peer procedures
# C.2 An overview of the peer-to-peer LLC layer states
The state diagram representation of the peer-to-peer procedures is based on an
expansion of the three basic states identified in subclause 4.5.2 to 7 states.
An overview of the inter-relationship of these states is provided in figure
C.2.
An LLME and its LLEs are conceptually initiated in the TLLI Unassigned state
(state 1). LLME interacts with GMM in order to be assigned a TLLI value. TLLI
assignment causes LLME to transition to the TLLI Assigned state (state 2) and
each of its LLEs to transition to the ADM state (state 2).
The receipt of an LL-ESTABLISH-REQ primitive by an LLE in the ADM state (state
2) causes the initiation of the local establishment procedure and the
transition to the Local Establishment state (state 3). Completion of the
establishment procedure takes the LLE to the ABM state (state 5).
Peer-initiated establishment causes a transition from the ADM state (state 2)
to the Remote Establishment state (state 4). The receipt of an LL-ESTABLISH-
RES primitive completes the establishment procedure and moves the LLE to the
ABM state (state 5). In ABM state (state 5), LL-DATA-REQ primitives can be
serviced directly subject to the restrictions of the procedures.
Expiry of timer T200, that is used in both the flow control and data transfer
aspects of each LLE\'s procedures initiates the transition to the Timer
Recovery state (state 7). Completion of the timer recovery procedures returns
the LLE to the ABM state (state 5). In states 5 and 7, the following
conditions that are identified within the LLC specification are observed:
\- peer receiver busy; and
\- own receiver busy.
A peer-initiated release takes the LLE directly to the ADM state (state 2),
whilst an LL-RELEASE-REQ returns the LLE state to the ADM state via the Local
Release state (state 6).
TLLI Unassignment causes a transition to the TLLI Unassigned state (state 1)
from any other state (states 2-7). Reset causes a transition to the TLLI
Assigned / ADM state (state 2) from any other state except state 1.
In addition, all states should observe the suspended operation (reception of
LLGMM-SUSPEND-REQ) restrictions, during which LLC frames may not be
transmitted.
Figure C.2: Overview of the states of the peer-to-peer procedures
#
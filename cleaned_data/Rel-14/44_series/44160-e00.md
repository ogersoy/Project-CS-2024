# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
## 1.1 General
The present document specifies procedures for the following layers of the
radio interface (_Um_ reference point), the interface between the GSM/EDGE
Radio Access Network (GERAN) and the Mobile Station (MS) in GERAN _Iu mode_ :
\- Radio Link Control (RLC).
\- Medium Access Control (MAC), including Physical Link Control functions.
## 1.2 Related documents
The following documents provide information related to the present document:
\- 3GPP TS 43.051 is an overall description of the GSM/EDGE Radio Access
Network (GERAN) in _Iu mode_.
\- 3GPP TS 44.003 specifies channel types, access capabilities and channel
configurations at the _Um_ reference point.
\- 3GPP TS 44.004 specifies services offered by the physical layer of the _Um_
reference point. It also specifies control channels. RLC and MAC use these
services and control channels.
\- 3GPP TS 24.007 specifies, in general terms, this protocol\'s structured
functions, its procedures and its relationship with other layers and entities.
It also specifies the basic message format and error handling applied by layer
3 protocols.
\- 3GPP TS 44.118 specifies the RRC procedures when operating in _Iu mode_.
\- 3GPP TS 44.060 specifies RLC/MAC procedures specific to _A/Gb mode_ as well
as the procedures that are common to both _A/Gb mode_ and _Iu mode_. It also
specifies the messages and Information Elements for both modes.
\- 3GPP TS 51.010 specifies test procedures for radio-interface signalling.
## 1.3 Use of logical control channels
3GPP TS 45.002 defines the following logical control channels:
\- Broadcast Control Channel (BCCH): downlink only, used to broadcast Cell
specific information.
\- Packet Broadcast Control Channel (PBCCH): downlink only, used to broadcast
Cell specific information.
\- Packet Paging Channel (PPCH): downlink only, used to send page requests to
Mobile Stations (MSs).
\- Packet Random Access Channel (PRACH): uplink only, used to request GPRS
resources.
\- Packet Access Grant Channel (PAGCH): downlink only, used to allocate GPRS
resources.
\- Packet Associated Control Channel (PACCH): bi-directional, associated with
a Temporary Block Flow (TBF).
\- Packet Timing advance control channel uplink (PTCCH/U): used to transmit
random access bursts to allow estimation of the timing advance for one MS in
transfer state.
\- Packet Timing advance control channel downlink (PTCCH/D): used to transmit
timing advance updates for several MS. One PTCCH/D is paired with several
PTCCH/U\'s.
## 1.4 Use of logical traffic channels
3GPP TS 45.002 defines the following logical traffic channels used by RLC and
MAC:
\- Traffic Channel (TCH): bidirectional, carries encoded speech or user data
using GMSK on a dedicated basic physical subchannel (DBPSCH). TCH can be full-
rate (TCH/F) or half-rate (TCH/H).
\- Octal Traffic Channel (O-TCH): bidirectional, carries encoded speech using
8-PSK on a DBPSCH. O-TCH can be full-rate (O‑TCH/F) or half-rate (O-TCH/H).
\- Enhanced Traffic Channel (E-TCH): bidirectional, carries user data using
8-PSK on a DBPSCH.
\- Packet Data Traffic Channel (PDTCH): downlink or uplink, carries user data
using GMSK or 8-PSK on a shared basic physical subchannel (SBPSCH) or a
DBPSCH. PDTCHs can be full-rate (PDTCH/F) or half-rate (PDTCH/H).
## 1.4a Use of transport channels
For the flexible layer one (FLO) 3GPP TS 45.002 defines the following
transport channel type:
\- Dedicated Channel (DCH): carries user or control data using GMSK or 8-PSK
on a DBPSCH. A mobile station may have one or more transport channels of type
DCH active at the same time in each direction.
In the present document, the following notations are used:
\- UDCH: refers to a transport channel of type DCH used exclusively for
carrying RLC/MAC blocks for data transfer belonging to user-plane;
\- CDCH: refers to a transport channel of type DCH used exclusively for
carrying RLC/MAC blocks for data transfer belonging to control-plane. The
signalling TFC (see 3GPP TS 44.118) shall be used when CDCH is active;
\- ADCH: refers to a transport channel of type DCH used exclusively for
carrying RLC/MAC blocks for control message transfer. The signalling TFC (see
3GPP TS 44.118) shall be used when ADCH is active.
## 1.5 Conventions
Unless explicitly stated otherwise, the following conventions apply:
\- The notations \"further study\", \"FS\" or \"FFS\" indicate the annotated
text is not normative.
\- References to \"PDCH\" also apply to \"SBPSCH\" and vice-versa.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
```{=html}
``` \- For a non-specific reference, the latest version applies. In the case
of a reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[3] 3GPP TS 43.013: \"Discontinuous Reception (DRX) in the GSM system\".
[4] 3GPP TS 24.002: \"GSM-UMTS Public Land Mobile Network (PLMN) access
reference configuration\".
[5] 3GPP TS 44.003: \"Mobile Station - Base Station System (MS - BSS)
interface; Channel structures and access capabilities\".
[6] 3GPP TS 44.004: \"Layer 1 - General requirements\".
[7] 3GPP TS 44.118: \"Mobile radio interface layer 3 specification; Radio
Resource Control (RRC) protocol Iu mode\".
[8] 3GPP TS 45.002: \"Multiplexing and multiple access on the radio path\".
[9] 3GPP TS 45.003: \"Channel coding\".
[10] 3GPP TS 45.008: \"Radio subsystem link control\".
[11] 3GPP TS 45.010: \"Radio subsystem synchronization\".
[12] 3GPP TS 51.010-1: \"Mobile Station (MS) conformance specification; Part
1: Conformance specification\".
[13] 3GPP TS 51.021: \"GSM radio aspects base station system equipment
specification\".
[14] 3GPP TS 25.331: \"Radio Resource Control (RRC) protocol specification\".
[15] 3GPP TS 25.133: \"Requirements for support of radio resource management
(FDD)\".
[16] 3GPP TS 25.123: \"Requirements for support of radio resource management
(TDD)\".
[17] 3GPP TS 43.051: \"GSM/EDGE Radio Access Network (GERAN); Overall
Description; Stage 2\".
[18] 3GPP TS 44.060: \"General Packet Radio Service (GPRS); Mobile Station
(MS) - Base Station System (BSS) interface; Radio Link Control/ Medium Access
Control (RLC/MAC) protocol\".
[19] 3GPP TS 51.010-2: \"Mobile Station (MS) conformance specification; Part
2: Protocol Implementation Conformance Statement (ICS) proforma
specification\".
[20] 3GPP TS 51.010-3: \"Mobile Station (MS) conformance specification; Part
3: Layer 3 (L3) Abstract Test Suite (ATS)\".
[21] 3GPP TS 51.010-4: \"Mobile Station (MS) conformance specification; Part
4: SIM application toolkit conformance specification\".
[22] 3GPP TS 35.201: \"Specification of the 3GPP confidentiality and integrity
algorithms; Document 1: f8 and f9 specifications\".
[23] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[24] 3GPP TS 44.018: \"Mobile radio interface layer 3 specification; Radio
Resource Control Protocol\".
[25] 3GPP TS 45.005: \"Radio transmission and reception\".
[26] 3GPP TS 43.064: \"Overall description of the GPRS radio interface; Stage
2\".
[27] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
Aspects\".
[28] 3GPP TR 45.902: "Flexible Layer One".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TS 44.060 and the following apply:
**Active transport channel:** a transport channel is active during a TTI if it
carries an RLC/MAC block. This definition applies to FLO only.
**Block period:** sequence of timeslots on a SBPSCH or a DBPSCH used to convey
one radio block.\ There are 4 timeslots in this sequence for PDTCH, PACCH,
SACCH, SDCCH, TCH/AHS, E-FACCH. There are 6 timeslots in this sequence for
FACCH/H. There are 8 timeslots in this sequence for TCH/AFS and FACCH/F. There
are 22 timeslots in this sequence for (E-)TCH/F.
**CDCH TBF Mode: refers to a TBF belonging to a signalling radio bearer and
using FLO.**
**DCCH TBF mode:** refers to a TBF mapped onto a FACCH, SACCH or SDCCH.
**Radio block:** sequence of normal bursts carrying one RLC/MAC protocol data
unit (see 3GPP TS 44.004).\ (The one exception is a radio block occasionally
used on PACCH consisting of a sequence of four access bursts, each carrying a
repetition of one short RLC/MAC block.). There are 4 normal bursts in this
sequence for PDTCH, PACCH, SACCH, SDCCH, TCH/AHS, E-FACCH. There are 6 normal
bursts in this sequence for FACCH/H. There are 8 normal bursts in this
sequence for TCH/AFS and FACCH/F. There are 22 normal bursts in this sequence
for (E‑)TCH/F.
**RLC non-transparent mode:** refers to either RLC acknowledged mode or RLC
unacknowledged mode.
**TCH TBF mode:** refers to a TBF mapped onto a TCH.
**Transport format:** configuration of a transport channel, including for
instance block size and CRC. This definition applies to FLO only.
**Transport format combination:** allowed combination of transport format(s)
of the different transport channels that are multiplexed together on a basic
physical subchannel
**Signalling TFC:** transport format combination that shall be used for
signalling (ADCH, CDCH). It may also be used for user-plane data (UDCH). On
each DBPSCH, the signalling TFC is the lowest TFC in the TFCS of this DBPSCH
(see 3GPP TS 44.118).
**Transport format combination set:** set of allowed transport format
combinations on a basic physical subchannel
**Transport format set:** set of all transport formats defined for a
particular transport channel.
**Transmission time interval:** rate at which RLC/MAC blocks are exchanged
between the physical layer and the MAC sublayer on a transport channel: 20ms.
This definition applies to FLO only.
**UDCH TBF mode:** refers to a TBF belonging to a user-plane radio bearer and
using FLO.
NOTE: _Iu mode_ specific definitions that are not used in 3GPP TS 44.060
should be added here.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
_A_ Interface between a BSS and a 2G MSC
_Gb_ Interface between a BSS and a 2G SGSN
_Iu_ Interface between a BSS or an RNC and a 3G MSC or a 3G SGSN
_Iu-cs_ Interface between a BSS or an RNC and a 3G MSC
_Iu-ps_ Interface between a BSS or an RNC and a 3G SGSN
_Um_ Interface between an MS and the GERAN
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 and 3GPP TS 43.064, and the following apply:
ADCH Associated DCH
ARQ Automatic Repeat reQuest
BCCH Broadcast Control CHannel
BSS Base Station Subsystem
CBCH Cell Broadcast CHannel
CCN Cell Change Notification
CDCH Control-plane DCH
CN Core Network
CS-_i_ GPRS Coding Scheme _i_
DBPSCH Dedicated Basic Physical Sub CHannel
DCH Dedicated CHannel
ECSD Enhanced Circuit Switched Data
EDGE Enhanced Data rates for Global Evolution
EGPRS Enhanced General Packet Radio Service
FACCH Fast Associated Control CHannel
FLO Flexible Layer One
GERAN [Gsm/Edge]{.smallcaps} Radio Access Network
GPRS General Packet Radio Service
GRA [Geran]{.smallcaps} Registration Area
G-RNTI [Geran]{.smallcaps} Radio Network Temporary Identity
GSM Global System for Mobile communications
HFN Hyper Frame Number
IMSI International Mobile Subscriber Identity
LCS LoCation Services
MAC Medium Access Control
MCS-_i_ EGPRS Modulation and Coding Scheme _i_
MS Mobile Station
MSC Mobile Switching Centre
NAS Non Access Stratum
NSAPI Network-layer SAPI
NT-RLC RLC non-transparent mode
PBCCH Packet BCCH
PDCH Packet Data CHannel
PDCP Packet Data Convergence Protocol
PDP Packet Data Protocol
PDTCH Packet Data TCH
PDU Protocol Data Unit
PLMN Public Land Mobile Network
PTCCH Packet Timing-advance Control CHannel
P-TMSI Packet TMSI
QoS Quality of Service
RB Radio Bearer
RBid Radio bearer identity
RLC Radio Link Control
RNC Radio Network Controller
RR Radio Resource
RRBid Reduced RBid
RRC Radio Resource Control
SACCH Slow Associated Control CHannel
SAP Service Access Point
SAPI Service Access Point Identifier
SBPSCH Shared Basic Physical Sub CHannel
SDCCH Stand-alone Dedicated Control CHannel
SDU Service Data Unit
SGSN Serving GPRS Support Node
SRB Signalling Radio Bearer
TBF Temporary Block Flow
TCH Traffic Channel
TF Transport Format
TFC Transport Format Combination
TFCS Transport Format Combination Set
TFS Transport Format Set
TMSI Temporary Mobile Subscriber Identity
TrCH Transport CHannel
T-RLC RLC transparent mode
TTI Transport Time Interval
UDCH User-plane DCH
UMTS Universal Mobile Telecommunication System
URB User Radio Bearer
USF Uplink State Flag
UTRAN UMTS Terrestrial Radio Access Network
# 4 Layered overview of radio interface
## 4.0 Protocol architecture
The protocol architecture for the radio interface is shown in figure 4.1 where
the flexible layer one (FLO) is not represented. Figure 4.2 represents the
protocol architecture in relation to FLO only.
The RLC/MAC function provides a service to PDCP for User plane data, to RRC
for Control plane data and to the application layer of the CS User plane.
Figure 4.1: Radio Interface Protocol architecture
{width="3.6152777777777776in" height="3.7534722222222223in"}
Figure 4.2: Radio Interface Protocol architecture with FLO only
## 4.1 Layer services
The RLC/MAC sublayer provides services for the transfer over the physical
layer between the network and mobile station of upper layer PDUs for one
mobile station when operating on a dedicated basic physical subchannel, or for
one or more mobile stations when operating on a shared basic physical
subchannel.
The RLC function provides the following services to the upper layers:
**\- Transparent data transfer:** This service transmits higher layer PDUs
without adding any protocol information.
**\- Acknowledged data transfer:** This service transmits higher layer PDUs
and guarantees delivery to the peer entity.
**\- Unacknowledged data transfer:** This service transmits higher layer PDUs
without guaranteeing delivery to the peer entity.
**\- Notification of unrecoverable errors:** RLC notifies the upper layer of
errors that cannot be resolved by RLC itself by normal exception handling
procedures.
**\- Notification of discard:** RLC notifies the upper layer of the higher
layer PDUs (RLC SDUs) it discards.
\- **Suspend:** The RLC entity does not transmit any new RLC PDUs to the lower
layer.
\- **Resume:** The RLC entity resumes data transmission.
\- **Stop:** The RLC entity does not transmit any RLC PDUs to the lower layer
and does not receive any PDUs from the lower layer.
\- **Continue:** The RLC entity resumes data transmission and reception.
\- **Re-establishment:** The RLC entity is re-established.
The MAC function provides the following service to the upper layer:
\- **Data transfer.**
## 4.2 Layer functions
### 4.2.1 RLC function
The functions provided by the RLC are given in table 4.2.1.1. Transparent RLC
mode provides no functionality.
Table 4.2.1.1: RLC Functions
* * *
                                                                                                                             Acknowledged mode RLC   Unacknowledged mode RLC   Transparent mode RLC
Segmentation of upper layer PDUs into RLC data blocks X X  
Concatenation of upper layer PDUs into RLC data blocks X X  
Padding to fill out RLC data block X X  
Backward Error Correction (BEC) procedure enabling the selective
retransmission of RLC data blocks X  
Discard of RLC SDUs not yet segmented into RLC PDUs, according to the delay
requirements of the associated Radio Bearers X  
Reassembly of RLC data blocks into upper layer PDUs X X  
In-sequence delivery of upper layer PDUs X X  
Link Adaptation X X  
Ciphering X X  
Sequence number check to detect lost RLC blocks X X
* * *
### 4.2.2 MAC layer function
The functions of the MAC layer include:
**\- Configuring the mapping between logical channels and basic physical
subchannels:** The MAC layer is responsible for configuring the mapping of
logical channel(s) onto the appropriate basic physical subchannel(s).
**\- Mapping between TBFs and transport channels.** When FLO is used, the MAC
layer is responsible for mapping TBF(s) onto the appropriate transport
channel(s).
**\- Selecting logical channels to be used for each signalling radio bearer
service:** The MAC layer is responsible for mapping SRBs onto logical
channels. There are a set of rules defined for this mapping (see sub-clause
5.6) which shall be used in the uplink and should be used in the downlink. The
mapping is dependent on the SRB to be sent, the MAC state, and the logical
channels available. The SFACCH may be selected in preference to the PDTCH if a
TBF is not already established for the SRB. In the downlink there is an
additional requirement that the PHYSICAL INFORMATION message is always sent on
the FACCH.
\- **Selecting transport channel to be used for signalling radio bearer
service:** When FLO is used, the MAC layer is responsible for mapping some
SRBs onto transport channels. There is a set of rules defined for this mapping
(see sub-clause 5.6) which shall be used in the uplink and should be used in
the downlink. The mapping is dependent on the SRB to be sent, the MAC state,
and the logical channels and transport channels available. When SRB data is
sent using FLO on a DBPSCH/F, the signalling TFC shall be used. When SRB data
is sent using FLO on a DBPSCH/H, the MAC layer shall send every RLC/MAC block
for data transfer twice in a row. The corresponding first and second transport
blocks shall use the signalling TFC.
**\- Selecting logical channels to be used for each user radio bearer
service:** The logical channels used by the MAC for user radio bearers are set
up by configuration from RRC.
\- **Selecting transport channels to be used for each user radio bearer
service:** When FLO is used, the transport channels used by the MAC for user
radio bearers are set up by configuration from RRC.
\- **Selection of the appropriate transport format per transport channel.**
When FLO is used, the MAC layer is responsible for selecting the appropriate
transport format for each transport channel within the transport format set
configured by RRC for each transport channel so that the resulting transport
format combination belongs to the transport format combination set configured
by RRC.
**\- Assignment, reconfiguration and release of shared radio resources for a
TBF:** The MAC layer may handle the assignment of radio resources needed for a
TBF including needs from both the control and user plane. The MAC layer may
reconfigure radio resources of a TBF.
**\- MS measurement reporting and control of the reporting:** The MAC layer is
responsible for sending information that control the MS measurement reporting
when using PBCCH or PACCH channels. The MAC layer also performs the reporting
of the measurements from the MS to the network using PACCH.
**\- Broadcasting/listening of/to PBCCH and PCCCH:** The MAC layer
broadcasts/listens (to) the PBCCH of the serving cell for the sending/decoding
of packet system information messages. The MAC layer also sends paging
information on the PCCCH or and monitors the paging occasions according to the
DRX cycle. Within the Mobile Station, the MAC layer notifies the RRC layer
when receiving a paging message; within the network, it is responsible for
aggregating and sending paging messages addressed to one or more Mobile
Stations when received from the RRC layer.
**\- Timing advance control:** The MAC layer controls the operation of timing
advance on shared basic physical subchannels.
**\- Ciphering and deciphering** (only in combination with transparent RLC
mode).
**\- Priority handling between data flows of one MS. When FLO is used, the MAC
layer is responsible for prioritization between data flows of one MS on
DBPSCH.**
When the MAC layer is providing services to a non-transparent RLC mode entity,
the MAC layer supports the following additional functions:
**\- Ciphering.**
**\- Identification of different traffic flows of one or more MSs on the basic
physical subchannels:** Inband identification is needed to address a flow to
an MS in the downlink or identify a flow from an MS in the uplink.
**\- Multiplexing/demultiplexing** **of higher layer PDUs:** This may include
priority handling between data flows of one or more mobile stations, e.g. by
attributes of Radio Bearer services.
**\- Multiplexing/demultiplexing user and control plane data to/from the
physical layer for PDTCHs:** The MAC layer is responsible for
multiplexing/demultiplexing RLC data blocks carried on PDTCH and RLC/MAC
control blocks carried on PACCH.
**\- Scheduling of RLC/MAC data and control PDUs delivered to the physical
layer on shared basic physical subchannels:** This includes USF and RRBP field
monitoring for uplink transfer and sharing radio resources on the downlink.
**\- Splitting/recombining:** This includes splitting/recombining of the
RLC/MAC PDU flow belonging to one or more TBF(s) onto/from several shared
logical channels. This function does not apply for RLC/MAC control blocks.
## 4.3 Service primitives
### 4.3.1 MAC to Physical Layer Primitives
These are defined in 3GPP TS 44.004.
### 4.3.2 PDCP to RLC Primitives
#### 4.3.2.1 Primitives
The primitives between PDCP and RLC are shown in table 4.3.2.1.1.
Table 4.3.2.1.1: Primitives between RLC and upper layers
* * *
Generic Name Parameters  
Req. Ind. Resp. Conf. RLC-AM-DATA Data, CNF, MUI Data Not Defined Status, MUI
RLC-UM-DATA Data Data Not Defined Not Defined RLC-TM-DATA Data Data,
Error_Indicator Not Defined Not Defined
* * *
Each Primitive is defined as follows:
**RLC-AM-DATA-Req/Ind/Conf**
\- RLC-AM-DATA-Req is used by upper layers to request transmission of an RLC
SDU in acknowledged mode.
\- RLC-AM-DATA-Ind is used by the AM RLC entity to deliver to upper layers an
RLC SDU that has been transmitted in acknowledged mode.
\- RLC-AM-DATA-Conf is used by the AM RLC entity to confirm to upper layers
the reception of an RLC SDU by the peer-RLC AM entity or to inform the upper
layers of a discarded RLC SDU.
**RLC-UM-DATA-Req/Ind/Conf**
\- RLC-UM-DATA-Req is used by upper layers to request transmission of an RLC
SDU in unacknowledged mode.
\- RLC-UM-DATA-Ind is used by the UM RLC entity to deliver to upper layers an
RLC SDU that has been transmitted in unacknowledged mode.
**RLC-TM-DATA-Req/Ind/Conf**
\- RLC-TM-DATA-Req is used by upper layers to request transmission of an RLC
SDU in transparent mode.
\- RLC-TM-DATA-Ind is used by the TM RLC entity to deliver to upper layers an
RLC SDU that has been transmitted in transparent mode.
#### 4.3.2.2 Primitive parameters
The following parameters are used in the primitives:
> 1) The parameter Data is the RLC SDU that is mapped onto the Data field in
> RLC PDUs.
>
> 2) The parameter Confirmation Request (CNF) indicates whether the
> transmitting side of the AM RLC entity needs to confirm the reception of the
> RLC SDU by the peer-RLC AM entity. If required, once all AMD PDUs that make
> up the RLC SDU are positively acknowledged by the receiving AM RLC entity,
> the transmitting AM RLC entity notifies upper layers.
>
> 3) The parameter Message Unit Identifier (MUI) is an identity of the RLC
> SDU, which is used to indicate which RLC SDU that is confirmed with the RLC-
> AM-DATA-Conf. Primitive.
>
> 4) The Error_Indicator parameter indicates that the RLC SDU is erroneous.
>
> 5) The parameter Status is only applicable for AM operation. This parameter
> indicates whether a RLC SDU is successfully transmitted or discarded.
### 4.3.3 RRC to RLC Primitives
#### 4.3.3.1 Primitives
The primitives between RRC and RLC are shown in table 4.3..3.1.
Table 4.3.3.1: Primitives between RRC and RLC
+-------------+-------------+-------------+-------------+-------------+ | Generic | Parameters | | | | | Name | | | | | +-------------+-------------+-------------+-------------+-------------+ | | Req. | Ind. | Resp. | Conf. | +-------------+-------------+-------------+-------------+-------------+ | RLC-AM-DATA | Data, CNF, | Data | Not Defined | Status, MUI | | | MUI, | | | | | | DiscardReq | | | | +-------------+-------------+-------------+-------------+-------------+ | RLC-UM-DATA | Data | Data | Not Defined | Not Defined | +-------------+-------------+-------------+-------------+-------------+ | CRLC-CONFIG | E/R, Stop | Not Defined | Not Defined | Not Defined | | | (UM/AM | | | | | | only), | | | | | | Continue | | | | | | (UM/AM | | | | | | only), | | | | | | Ciphering | | | | | | Elements | | | | | | (UM/AM | | | | | | only), | | | | | | | | | | | | TM\ | | | | | | _parameters | | | | | | (TM only), | | | | | | UM\ | | | | | | _parameters | | | | | | (UM | | | | | | only-SDU | | | | | | discard, | | | | | | EGPRS | | | | | | window | | | | | | size), | | | | | | AM\ | | | | | | _parameters | | | | | | (AM only | | | | | | --SDU | | | | | | discard, | | | | | | resegment | | | | | | bit, EGPRS | | | | | | window | | | | | | size) | | | | +-------------+-------------+-------------+-------------+-------------+ | C | N | Not Defined | Not Defined | V(S) (AM/UM | | RLC-SUSPEND | | | | only) | | (UM/AM | | | | | | only) | | | | | +-------------+-------------+-------------+-------------+-------------+ | CRLC-RESUME | No | Not Defined | Not Defined | Not Defined | | (UM/AM | Parameter | | | | | only) | | | | | +-------------+-------------+-------------+-------------+-------------+
Each Primitive is defined as follows:
**RLC-AM-DATA-Req/Ind/Conf**
\- RLC-AM-DATA-Req is used by upper layers to request transmission of an RLC
SDU in acknowledged mode.
\- RLC-AM-DATA-Ind is used by the AM RLC entity to deliver to upper layers an
RLC SDU that has been transmitted in acknowledged mode.
\- RLC-AM-DATA-Conf is used by the AM RLC entity to confirm to upper layers
the reception of an RLC SDU by the peer-RLC AM entity.
**RLC-UM-DATA-Req/Ind/Conf**
\- RLC-UM-DATA-Req is used by upper layers to request transmission of an RLC
SDU in unacknowledged mode.
\- RLC-UM-DATA-Ind is used by the UM RLC entity to deliver to upper layers an
RLC SDU that has been transmitted in unacknowledged mode.
**CRLC-CONFIG-Req**
This primitive is used by upper layers to establish, re-establish, release,
stop, continue or modify the RLC. Ciphering elements are included for UM and
AM operation.
**CRLC-SUSPEND-Req/Conf**
\- CRLC-SUSPEND-Req is used by upper layers to suspend the UM or AM RLC
entity.
\- CRLC-SUSPEND-Conf is used by the UM or AM RLC entity to confirm that the
entity is suspended.
**CRLC-RESUME-Req**
This primitive is used by upper layers to resume the UM or AM RLC entity after
the UM or AM RLC entity has been suspended.
#### 4.3.3.2 Primitive parameters
Following parameters are used in the primitives:
> 1) The parameter Data is the RLC SDU that is mapped onto the Data field in
> RLC PDUs.
>
> 2) The parameter Confirmation Request (CNF) indicates whether the
> transmitting side of the AM RLC entity needs to confirm the reception of the
> RLC SDU by the peer-RLC AM entity. If required, once all AMD PDUs that make
> up the RLC SDU are positively acknowledged by the receiving AM RLC entity,
> the transmitting AM RLC entity notifies upper layers.
>
> 3) The parameter Message Unit Identifier (MUI) is an identity of the RLC
> SDU, which is used to indicate which RLC SDU that is confirmed with the RLC-
> AM-DATA-Conf. Primitive.
>
> 4) The parameter E/R indicates establishment, re-establishment, release or
> modification of an RLC entity, where re-establishment is applicable to AM
> and UM RLC entities only.
>
> 5) The parameter Ciphering Elements are only applicable for UM and AM
> operations. These parameters are Ciphering Key, Activation Time (Sequence
> Number (BSN) to activate a new ciphering configuration) and HFN (Hyper Frame
> Number).
>
> 6) The AM_parameters are only applicable for AM operation.
>
> 7) The Stop parameter is applicable to AM and UM RLC entities only and
> indicates to the RLC entity to not transmit nor receive any RLC PDUs.
>
> 8) The Continue parameter is applicable to AM and UM RLC entities only and
> indicates to the RLC entity to continue transmission and reception of RLC
> PDUs.
>
> 9) The UM_parameters are only applicable for UM operation.
>
> 10) The TM_parameters are only applicable for TM operation.
>
> 11) The N parameter indicates that an RLC entity will not send a PDU with
> \"Sequence Number\"≥V(S)+N for UM/AM RLC entities where N is a non-negative
> integer.
>
> 12) The V(S) parameter indicates the value of the Send State Variable for
> the case of the AM/UM RLC entities.
>
> 13) The parameter Status is only applicable for AM operation. This parameter
> indicates whether a RLC SDU is successfully transmitted or discarded.
>
> 14) The parameter DiscardReq indicates whether the transmitting RLC entity
> needs to inform the upper layers of the discarded RLC SDU. If required, the
> transmitting RLC entity notifies upper layers when the RLC SDU is
> discarded..
### 4.3.4 RRC to MAC Primitives
#### 4.3.4.1 Primitives
The primitives between MAC and RRC are shown in table 4.3.4.1.
Table 4.3.4.1: Primitives between RRC sub-layer and MAC
+---------------+---------------+---------------+----------+---------+ | Generic Name | Parameter | | | | +---------------+---------------+---------------+----------+---------+ | | Request | Indication | Response | Confirm | +---------------+---------------+---------------+----------+---------+ | CMAC-CONFIG | MS | | | | | | information | | | | | | elements, | | | | | | | | | | | | RB | | | | | | information | | | | | | elements, | | | | | | | | | | | | Ciphering | | | | | | elements, | | | | +---------------+---------------+---------------+----------+---------+ | CMAC-SYS-INFO | System | | | | | | Information | | | | | | Elements | | | | +---------------+---------------+---------------+----------+---------+ | PAGING | MS Identity, | MS Identity, | NA | NA | | | CN Domain | CN Domain | | | | | Identity, | Identity, | | | | | Paging Cause, | Paging Cause, | | | | | Paging Record | Paging Record | | | | | Type | Type | | | | | Identifier | Identifier | | | +---------------+---------------+---------------+----------+---------+ | HANDOVER | Handover | Handover | NA | NA | | | Reference | Reference | | | | | Value | Value | | | +---------------+---------------+---------------+----------+---------+ | PHYSICAL-INFO | Timing | Timing | NA | NA | | | Advance Value | Advance Value | | | +---------------+---------------+---------------+----------+---------+
**CMAC-CONFIG-Req**
\- CMAC-CONFIG-Req is used to request for setup, release and configuration of
a logical channel, G-RNTI allocation, mapping between radio bearer and logical
channel, setup, release and configuration of transport channels and mapping
between radio bearers and transport channels.
**CMAC-SYS-INFO-Req**
\- CMAC-SYS-INFO-Req is used to pass information elements needed for the
generation of system information messages within the MAC entity.
**PAGING-Req/Ind:**
\- PAGING-Req is used by RRC to page a MS.
\- PAGING-Ind is used by the MS to inform the RRC of the reception of a PACKET
PAGING REQUEST message.
HANDOVER-Req/Ind:
\- HANDOVER-Req is used by the mobile station\'s RRC to trigger the
transmission of the HANDOVER ACCESS message to the network
\- HANDOVER-Ind is used by the network to inform the RRC of the reception of a
HANDOVER ACCESS message
PHYSICAL-INFO-Req/Ind:
\- PHYSICAL-INFO-Req is used by the network\'s RRC to trigger the transmission
of the PHYSICAL INFORMATION message to the mobile station
\- PHYSICAL-INFO-Ind is used by the mobile station to inform the RRC of the
reception of the PHYSICAL INFORMATION message
#### 4.3.4.2 Primitive Parameters
The MAC configuration primitives use the following parameters. See 3GPP TS
44.118 for a detailed description of the MS, and RB information elements.
1) MS information elements\ G-RNTI\ SRNC identity\ Activation time
2) RB information elements\ RB multiplexing info (Logical channel identity,
radio priority, mapping of reduced radio bearer id to radio bearer id,
transport channel identity)
3) Ciphering elements\ Ciphering key\ Activation Time (TDMA Frame Number) HFN
The system information primitives use the following parameter:
1) System Information elements\ See 3GPP TS 44.118
The paging primitives use the following parameters:
1) The _MS Identity_ parameter is the IMSI, TMSI, PTMSI, or G-RNTI.
2) The _CN Domain Identity_ parameter indicates whether a CN-initiated page is
from the packet domain or circuit domain.
3) The _Paging Cause_ parameter indicates the reason for the page.
4) The _Paging Record Type Identifier_ parameter indicates the type of MS
identity used by the CN in a CN-initiated page, e.g. IMSI (GSM), IMSI (DS-41),
TMSI/PTMSI (GSM).
The handover primitives use the following parameter:
1) The _Handover Reference Value_ parameter indicates the handover reference
value used for access identification in the HANDOVER ACCESS message
The physical info primitives use the following parameter:
1) The _Timing Advance Value_ parameter indicates the timing advance value in
the PHYSICAL INFORMATION message to be applied by the mobile station
## 4.4 Services required from lower layers
The RLC/MAC function uses the services provided by the physical link layer as
defined in 3GPP TS 44.004.
The following services are required of the physical layer:
**\- Access capabilities: In configurations where FLO is not used,** the
physical layer offers logical channels and the transmission services
associated to higher layers. Logical channels are multiplexed either in a
fixed predefined manner (multiframe structure) or dynamically by the MAC layer
on basic physical subchannels. In configurations where FLO is used, the
physical layer offers transport channels and the transmission services
associated to higher layers. Transport channels are multiplexed in a dynamic
manner on dedicated basic physical subchannels. Basic physical subchannels are
the units scheduled on the radio medium. Some are reserved by the network for
common use (e.g. for use by a combination of CCCH and BCCH), others are
assigned to dedicated connections with MSs (dedicated basic physical
subchannels), or are assigned to a shared usage between MSs (shared basic
physical subchannels).
**\- Error detection:** The physical layer offers an error protected
transmission service, it includes error detection functions and to a lower
level, error correction functions. Erroneous received frames may be notified
to upper layers and, depending on the need of the upper layer, offered to it.
The probability of one or more errors in a physical block transferred by the
physical layer is defined in 3GPP TS 45.005. Due to non-specified methods of
quality detection, the probability of residual errors in transferred blocks
may vary between implementations.
> **\- Measurement of the signal strength of neighbouring base stations**.
> Measurements are transferred to RRC.
**\- Measurement of the signal quality of the basic physical subchannel
used**. Measurements are transferred to the MAC layer for reporting to the
base station.
**\- Cell/PLMN selection in MAC-Idle state**. In MAC-Idle state the physical
layer selects the best cell with its BCCH in close co‑operation with layer 3,
meeting requirements for PLMN selection specified in 3GPP TS 42.011.
# 5 Introduction to the Medium Access Control (MAC) procedures
## 5.1 General
The Medium Access Control procedures include the functions related to the
management of the shared transmission resources (e.g. the packet data physical
channels and the radio link connections on packet data physical channels) and
dedicated transmission resources (e.g. the multiplexing of logical channels
onto DBPSCHs).
The Medium Access Control procedures support the provision of Temporary Block
Flows that allow the point-to-point transfer of signalling and user data
within a cell between the network and a mobile station.
Moreover, the Medium Access Control procedures include the procedures for
reception of PBCCH and PCCCH, which permits autonomous cell reselection
performed by the mobile station (see 3GPP TS 45.008).
## 5.2 Multiplexing principles
### 5.2.1 Temporary Block Flow
A TBF is a logical connection used by two MAC entities to support the
unidirectional transfer of upper-layer PDUs on basic physical sub-channels. A
mobile station shall support eight TBFs in each direction (uplink and
downlink) . The network shall not assign more than eight TBFs to a mobile
station. The total amount of TBFs assigned to a mobile station in a given
direction shall always be lower than or equal to eight.
The TBF is allocated radio resources on one or more BPSCHs of the same type
(i.e. either SBPSCH(s) or DBPSCH(s)) and may only be mapped on one logical
channel type at a time. A TBF shall not be mapped on more than one DBPSCH/S.
The TBF comprises a number of RLC/MAC blocks carrying one or more upper-layer
PDUs.
A TBF mapped on PDTCH(s) may operate in either GPRS TBF mode or EGPRS TBF
mode. If this TBF is operating on SBPSCH(s), the network sets the TBF mode in
the PACKET UPLINK ASSIGNMENT message, MULTIPE TBF UPLINK ASSIGNMENT message,
PACKET DOWNLINK ASSIGNMENT message, MUTLIPLE TBF DOWNLINK ASSIGNMENT message,
PACKET TIMESLOT RECONFIGURE message, MULTIPLE TBF TIMESLOT RECONFIGURE
message. If this TBF is operating on DBPSCH(s), the network sets the TBF mode
using RRC procedures (see 3GPP TS 44.118). The EGPRS TBF mode is only
supported by EGPRS capable MSs.
A TBF mapped on FACCH, SACCH or SDCCH operates implicitly in DCCH TBF mode.
A TBF mapped on TCH operates implicitly in TCH TBF mode.
A TBF mapped on UDCH(s) operates in UDCH TBF mode. UDCH TBF mode is applicable
only when FLO is used.
A TBF mapped on CDCH(s) operates in CDCH TBF mode. CDCH TBF mode is applicable
only when FLO is used.
A TBF associated with a URB may operate in either GPRS TBF mode, EGPRS TBF
mode, DCCH TBF mode, TCH TBF mode or UDCH TBF mode.
A TBF associated with a SRB may operate in either GPRS TBF mode (CS-1 coding
only), DCCH TBF mode or CDCH TBF mode. It shall not operate in EGPRS TBF mode.
### 5.2.2 Temporary Flow Identity
#### 5.2.2.1 Temporary Flow Identity for SBPSCH
See 3GPP TS 44.060 sub-clause 5.2.2.
Global_TFI is used in an uplink or a downlink RLC/MAC control message to
unambiguously identify the mobile station or one of its TBFs on SBPSCH. If
present, the Global TFI addresses the mobile station using either an uplink
TFI or a downlink TFI. The TFI used shall obey the rules below:
\- If the TFI is used to identify the mobile station, any TFI may be used
provided:
\- The timeslot number (TN) of the SBPSCH on which the RLC/MAC control message
is sent corresponds to a timeslot assigned to the TBF in the direction of the
TBF.
\- If the TFI is used to identify a TBF, the TFI of this TBF shall be used.
Additionally if the RLC/MAC control message is sent in uplink, and the TBF is
a downlink TBF:
\- If the timeslot number (TN) of the SBPSCH on which the RLC/MAC control
message is sent is different from the TN of each of the timeslots assigned to
the TBF in the direction of the TBF, the TN of the TBF shall be included in
the RLC/MAC control message to uniquely identify this TBF.
#### 5.2.2.2 Temporary Flow Identity for DBPSCH
A TBF mapped on DBPSCH(s) may operate in either GPRS, EGPRS, DCCH, TCH, CDCH
or UDCH TBF mode. A TBF mapped on DBPSCH/S shall operate in DCCH TBF mode.
A TBF in either GPRS TBF mode, EGPRS TBF mode or UDCH TBF mode (NT-RLC) is
implicitly assigned a TFI that equals the identity (RBid) of the radio bearer
it carries. An RLC/MAC block associated with such TBF shall contain a TFI. The
TBF to which a RLC data block belongs is identified by the TFI and the
direction (uplink or downlink) in which this RLC data block is sent. The TBF
to which a RLC/MAC control message belongs is identified by the TFI, the
direction in which this RLC/MAC control message is sent and the message type.
A TBF in TCH TBF mode is not assigned a TFI. This TBF is in its direction the
only user of the TCH on which it is mapped, as described in sub-clause 9.2.2.
A TBF in UDCH TBF mode running in T-RLC is not assigned a TFI.
A TBF in DCCH TBF mode is implicitly assigned a Reduced Radio Bearer identity
(RRBid) that provides a one-to-one mapping with the RBid of the radio bearer
it carries. In case this radio bearer is a User-plane Radio Bearer (URB), the
mapping between RRBid and RBid is given at radio bearer set-up of this URB by
means of primitive exchange between RRC and MAC (CMAC-CONFIG). An RLC/MAC
block associated with a DCCH TBF mode shall contain a RRBid. The TBF to which
a RLC data block belongs is identified by the RRBid and the direction (uplink
or downlink) in which this RLC data block is sent. The TBF to which a RLC/MAC
control message belongs is identified by the RRBid, the direction in which
this RLC/MAC control message is sent and the message type.
A TBF in CDCH TBF mode is implicitly assigned a Reduced Radio Bearer identity
(RRBid) that provides a one-to-one mapping with the RBid of the signalling
radio bearer it carries. An RLC/MAC block associated with a CDCH TBF mode
shall contain a RRBid. The TBF to which a RLC data block belongs is identified
by the RRBid and the direction (uplink or downlink) in which this RLC data
block is sent. The TBF to which a RLC/MAC control message belongs is
identified by the TFI or RRBid, the direction in which this RLC/MAC control
message is sent and the message type.
### 5.2.3 Uplink State Flag
See 3GPP TS 44.060 sub-clause 5.2.3.
### 5.2.4 Medium Access modes
#### 5.2.4.1 Medium Access modes for SBPSCH
See 3GPP TS 44.060 sub-clause 5.2.4.
#### 5.2.4.2 Medium Access modes for DBPSCH
The dedicated allocation is applicable exclusively on a dedicated channel
(i.e. mapped onto a DBPSCH). No other MAC mode may apply on DBPSCH. If the
mobile station is assigned a DBPSCH (e.g. PACKET DBPSCH ASSIGNMENT), dedicated
allocation shall be used in both uplink and downlink directions on this
DBPSCH.
### 5.2.5 Multiplexing of GPRS and EGPRS TBF mode capable mobile stations
See 3GPP TS 44.060 sub-clause 5.2.4a.
## 5.3 MAC States
### 5.3.1 MAC-Idle state
#### 5.3.1.1 General
In MAC-Idle state no TBF exists and the mobile station monitors relevant
paging subchannels on the PCCCH. The mobile station may use DRX for monitoring
the PCCCH.
#### 5.3.1.2 Establishment of a SBPSCH
In MAC-Idle state, upper layers may require the transfer of an upper-layer
PDU, which may trigger the establishment of a TBF on SBPSCH(s) and the
transition to MAC-Shared state.
#### 5.3.1.3 Establishment of a DBPSCH
In MAC-Idle state upper layers may require the transfer of an upper-layer PDU,
which may trigger the establishment of a TBF on DBPSCH(s) either through RRC
procedures (see 3GPP TS 44.118) or RLC/MAC procedures, in which case the
mobile station leaves MAC-Idle state and enters the MAC-Dedicated state
immediately after assignment of the DBPSCH(s). A mobile station shall not be
assigned more than one DBPSCH/S.
### 5.3.2 MAC-Shared state
#### 5.3.2.1 General
In MAC-Shared state, the mobile station is allocated radio resources providing
a TBF for a point-to-point connection on one or more SBPSCHs. The TBF is used
for the unidirectional transfer of upper-layer PDUs between the network and
the mobile station. In MAC-Shared state the following services are offered:
\- transfer of upper-layer PDUs in RLC acknowledged mode;
\- transfer of upper-layer PDUs in RLC unacknowledged mode.
#### 5.3.2.2 Release of all SBPSCHs
In MAC-Shared state, when all TBFs have been released in the downlink and
uplink direction, the mobile station returns to MAC-Idle state.
#### 5.3.2.3 Establishment of a DBPSCH
In MAC-Shared state upper layers may require the transfer of an upper-layer
PDU, which may trigger the establishment of a TBF on a DBPSCH through RRC
procedures (see 3GPP TS 44.118), in which case the mobile station leaves
MAC‑Shared state and enters the MAC-DTM state.
#### 5.3.2.4 Radio bearer reconfiguration
Upon reconfiguration of all Radio Bearers from SBPSCH(s) to DBPSCH(s), the
mobile station shall leave the MAC‑Shared state and enter the MAC-Dedicated
state after release of all TBFs on SBPSCH(s) and set-up of the first DBPSCH.
See 3GPP TS 44.118.
### 5.3.3 MAC-DTM state
#### 5.3.3.1 General
In MAC-DTM state a mobile station has been allocated radio resources providing
one or more DBPSCHs and one or more SBPSCHs. A mobile station shall not be
allocated radio resources providing a DBPSCH/S with any other BPSCH(s). The
allocation of radio resources is co-ordinated by the network, in agreement
with the capabilities of the mobile station.
The transfer of upper-layer PDUs in RLC acknowledged, RLC unacknowledged mode
or RLC transparent mode is provided.
#### 5.3.3.2 Release of all SBPSCHs
In MAC-DTM state, when all TBFs on SBPSCHs have been released, in downlink and
uplink directions, the mobile station enters MAC-Dedicated state.
#### 5.3.3.3 Release of all DBPSCHs
In MAC-DTM state, upon release of all DBPSCHs, the mobile station enters the
MAC-Shared state.
#### 5.3.3.4 Release of all SBPSCHs and DBPSCHs
In MAC-DTM state, upon release of all SBPSCHs and DBPSCHs, the mobile station
enters the MAC-Idle state.
### 5.3.4 MAC-Dedicated state
#### 5.3.4.1 General
In MAC-Dedicated state a mobile station has been allocated radio resources
providing one or more DBPSCHs. A mobile station shall not be allocated more
than one DBPSCH/S. The allocation of radio resources is co-ordinated by the
network, in agreement with the capabilities of the mobile station.
The transfer of upper-layer PDUs in RLC acknowledged, RLC unacknowledged mode
or RLC transparent mode is provided.
#### 5.3.4.2 Release of all DBPSCHs
In MAC-Dedicated state, upon release of all DBPSCHs, the mobile station shall
enter the MAC-Idle state.
#### 5.3.4.3 Radio bearer reconfiguration
Upon reconfiguration of all Radio Bearers from DBPSCH(s) to SBPSCH(s), the
mobile station shall leave the MAC‑Dedicated state and enter the MAC-Shared
state after release of all DBPSCH(s) and set-up of the first TBF on SBPSCH(s)
(see 3GPP TS 44.118).
### 5.3.5 MAC state machine
Figure 5.3.5.1 represents the state machine of the MAC sublayer.
{width="6.375in" height="4.550694444444445in"}
Figure 5.3.5.1: MAC state machine
## 5.4 General MAC procedures in MAC-Idle state and MAC-Shared state
### 5.4.1 Mobile station side
#### 5.4.1.1 General
A mobile station in MAC-Idle state or MAC-Shared state shall monitor the
system information broadcast in the cell.
In MAC-Idle state, the mobile station shall monitor the radio blocks on PCCCH
as defined in sub-clauses 5.4.1.8 and 5.4.1.9. The determination of the paging
group for the mobile station is defined in 3GPP TS 45.002.
#### 5.4.1.2 Cell reselection
Cell reselection in MAC-Idle state and MAC-Shared state is specified in 3GPP
TS 45.008. The MAC entity on the mobile station side indicates to the RRC
layer the availability of a cell and a cell change when decided by the MAC
sublayer. RRC is advised of system information broadcast in the cell when a
new cell has been selected or when a relevant part of this information
changes.
If the new cell supports _Iu mode_ the mobile station shall operate in _Iu
mode_ unless ordered to operate in _A/Gb mode_ by the network. If the new cell
does not support _Iu mode_ , a mobile station which supports _A/Gb mode_ shall
operate in _A/Gb mode_ as described in 3GPP TS 44.060. If operating in _Iu
mode_ , the mobile station shall perform packet access in _Iu mode otherwise
the mobile station shall perform packet access in A/Gb mode_.
When a cell reselection is determined by the mobile station or ordered by the
network, the mobile station may continue its operation in MAC-Idle state or
MAC-Shared state in the old serving cell, while acquiring certain system
information for the target cell.
If the old cell does not support CCN, the operation in the old cell shall be
aborted when one of the following conditions are met:
\- the mobile station starts to receive information on PBCCH in the target
cell;
\- the mobile station has received the SI13 message (see 3GPP TS 44.018) and
there is no PBCCH present in the target cell; or
\- the criteria for camping on the old cell are no longer fulfilled (see 3GPP
TS 45.008).
If PBCCH is present in the target cell, the mobile station shall delay the
start of receiving information on PBCCH until the first occurrence of PSI1 in
block B0. If the reception of PSI1 or PSI2 messages fails (see sub-clause
5.4.1.5) the mobile station may re-establish and continue its operation in the
old cell, until the next occurrence of PSI1 in block B0.
While the operation is maintained in the old cell, the mobile station may
suspend its TBF(s) or suspend the monitoring of radio blocks on PCCCH, in
order to receive necessary information on BCCH in the target cell. Such
suspension may be required in MAC-Idle state and MAC-Shared state. It is
performed without notification to the network.
Suspension of the operation in the old cell for this purpose is allowed during
the time required, for each message and according to the mobile station\'s
multislot class, to receive the required messages on BCCH in the target cell.
The allowable suspension of an uplink TBF may be extended with one block
period, in case of dynamic or extended dynamic allocation, if the mobile
station is unable to receive the corresponding USF due to the suspension of
downlink operation.
When the conditions are fulfilled to switch to the new cell, the mobile
station shall abort any TBF in progress by immediately ceasing to decode the
downlink, ceasing to transmit on the uplink, stopping all RLC/MAC timers
except for timers related to measurement reporting. The mobile station shall
then switch to the identified specified new cell and shall obey the relevant
RLC/MAC procedures on this new cell.
If the old cell supports CCN, a mobile station shall, when the cell
reselection has been determined, follow the procedures for Network Assisted
Cell Change as specified in 3GPP TS 44.060 sub-clauses 5.5.1.1a.2 and 8.8.2.
Under no circumstances and independent of whether CCN mode is supported,
operations in the old cell shall be continued more than 5 seconds after a cell
reselection has been determined.
#### 5.4.1.3 Network Assisted Cell Change
See 3GPP TS 44.060 sub-clause 5.5.1.1a.
#### 5.4.1.4 Release of DBPSCHs
##### 5.4.1.4.1 General
The mobile station shall acquire system information broadcast in the serving
cell when in MAC-Idle state, after the release of all DBPSCHs if the mobile
station had been unable to monitor the system information broadcast on PBCCH
while one or more DBPSCHs were allocated:
> \- The acquisition of system information shall be performed according to the
> requirements in sub-clause 5.4.1.5.
\- The mobile station shall not attempt a packet access or accept a packet
downlink assignment before these requirements are fulfilled.
The following exceptions, stated in sub-clauses 5.4.1.4.2 and 5.4.1.4.3, may
apply.
##### 5.4.1.4.2 Continuation of PBCCH information
At the allocation of a DBPSCH, the mobile station may keep the PSI messages
received on PBCCH before the allocation of the DBPSCH. If all DBPSCHs are
released in the same serving cell within 30 s after the PSI1 message was last
received, the mobile station may resume the supervision of PBCCH_CHANGE_MARK
and update of PBCCH information, defined in 3GPP TS 44.060 sub-clause
5.5.1.2.1, and need not initiate a _complete acquisition_ of PBCCH
information, as specified in sub-clause 5.4.1.5.
##### 5.4.1.4.3 Receipt of PSI14 message in MAC-DTM state
In MAC-DTM state, the mobile station may receive the PSI14 message on PACCH in
the serving cell. If all DBPSCHs are released in the same serving cell within
30 s after the PSI14 message was last received, the mobile station may use the
PSI14 message as a substitute for the SI13 or SI13-Alt message after the
release of all DBPSCHs, until either the SI13 or SI13-Alt message has been
received or the mobile station starts to receive information on PBCCH.
The presence of a PBCCH in the cell is indicated by a PBCCH description in the
PSI14 message. If the message does not contain the PBCCH description, the
mobile station shall assume that PBCCH is not present in the cell.
After the release of all of DBPSCHs, the mobile station shall perform a
_complete acquisition_ of PBCCH information, as defined in sub-clause 5.4.1.5.
#### 5.4.1.5 System information on PBCCH
See 3GPP TS 44.060 sub-clause 5.5.1.2.
#### 5.4.1.6 System information on BCCH
##### 5.4.1.6.1 General
The support of _Iu mode_ shall be indicated in SI3 message sent on BCCH. In
addition, the support of _Iu mode_ shall be indicated in either SI4 or SI7 and
8 messages. The SI3, SI4, SI7 and SI8 messages contain the CBQ3 parameter that
indicates if _Iu mode_ is supported in the cell _(see 3GPP TS 44.018)_.
If CBQ3 parameter sent on BCCH indicates that _Iu mode_ is supported in the
cell then a mobile station shall acquire a PBCCH description from either SI13
or SI13-Alt and shall operate in _Iu mode (see 3GPP TS 44.118)_.
If CBQ3 indicates that _Iu mode_ is not supported in the cell then a mobile
station may operate in _A/Gb mode_ as described in 3GPP TS 44.060.
When a new cell has been selected where PBCCH is not present, the mobile
station shall operate as described in 3GPP TS 44.060.
##### 5.4.1.6.2 Establishment of PBCCH
The mobile station may receive an SI13, SI13-Alt or PSI13 message providing a
PBCCH description indicating that PBCCH is present in the cell. The mobile
station shall then perform a _complete acquisition_ of PBCCH messages using
the indicated PBCCH (see sub-clause 5.4.1.7).
##### 5.4.1.6.3 (void)
#### 5.4.1.7 (void)
#### 5.4.1.8 Discontinuous reception (DRX)
A mobile station in MAC-Idle state may use Discontinuous Reception (DRX) to
reduce its power consumption.
In DRX mode, the MAC layer receives the paging group relevant for the mobile
station from the RRC layer via the CMAC-CONFIG primitive. The computation of
the paging group is defined in 3GPP TS 44.118. The mobile station shall only
monitor the blocks corresponding to its paging group. The GERAN shall initiate
paging procedures for this mobile station on the blocks corresponding to its
paging group.
In non-DRX mode, the mobile station shall monitor all paging blocks on the
monitored PCCCH (see 3GPP TS 45.002).
There are three cases when the mobile station enters a non-DRX mode period:
1) When entering the MAC-Idle state, the mobile station shall enter the non-
DRX mode period.
> The duration of the non-DRX mode period is determined by the value of the
> DRX_TIMER_MAX parameter broadcast in the cell.
>
> If the mobile station receives a new value of the DRX_TIMER_MAX parameter
> during the non-DRX mode period, the mobile station may wait to apply the new
> value until the next time the non-DRX mode period is entered.
2) When the network operates in NC2 mode and the MS sends a NC measurement
report, both the MS and the network shall enter the NC2 non-DRX mode period.
The duration of this period is defined by the NC_NON_DRX_PERIOD parameter.
3) When initiating the MM procedures for GPRS attach and routeing area update
defined in 3GPP TS 24.008, the mobile station shall enter the MM non-DRX mode
period. This period ends when either of the messages GPRS ATTACH ACCEPT, GPRS
ATTACH REJECT, ROUTING AREA UPDATE ACCEPT or ROUTING AREA UPDATE REJECT is
received by the mobile station. This period also ends after timeout when
waiting for any of these messages.
The non-DRX mode periods defined above run independent of each other and may
overlap. In RRC-Idle mode, the mobile station shall be in non-DRX mode during
any of the non-DRX mode periods.
#### 5.4.1.9 Page mode procedures on PCCCH
See 3GPP TS 44.060 sub-clause 5.5.1.6.
#### 5.4.1.10 Frequency Parameters
See 3GPP TS 44.060 sub-clause 5.5.1.7.
#### 5.4.1.11 G-RNTI Management
G-RNTI is used to identify a mobile station during contention resolution and
is allocated by RRC in the GERAN. If a mobile station does not possess a GERAN
allocated G-RNTI when making a contention access it shall use a Random G-RNTI.
Upon receiving a G-RNTI allocation from the GERAN a mobile station shall use
it for subsequent contention accesses for as long as it remains valid.
### 5.4.2 Network side
#### 5.4.2.1 System Information broadcasting
##### 5.4.2.1.1 System information on PBCCH
If PBCCH is present in the cell, the network regularly broadcasts PACKET
SYSTEM INFORMATION TYPE (PSI) 1, 2, 3, 3bis and PSI16 messages, and optionally
PSI3ter, PSI3quater and some types of PSI messages on the PBCCH. The PSI 2,
PSI 3bis, PSI3 ter, PSI3quater messages and some further types of PSI messages
may be broadcast in multiple number of instances. Based on the information
broadcast in PSI messages, a mobile station is able to decide whether and how
it may gain access to the system via the current cell.
NOTE: The network should take into account the limitations of earlier version
of mobile equipments to understand the 3-digit MNC format of the location area
identification, see 3GPP TS 44.060 sub-clause 12.23 and 3GPP TS 44.018, table
\"Location Area Identification information element\".
Instances of the PSI 5 message are broadcast on PBCCH if the mobile stations
camping on the cell shall perform measurement reporting (see 3GPP TS 45.008).
Instances of the PSI6 and PSI7 message may be broadcast on the PBCCH if non-
GSM broadcast information is transmitted.
The PSI8 message may be broadcast on the PBCCH if additional information (i.e.
CBCH configuration and dynamic ARFCN mapping) shall be provided to the mobile
station camping on the cell.
The PSI16 message shall be broadcast on the PBCCH to provide mobile stations
with additional information required for _Iu mode_ operation.
The PSI1 message contains the PBCCH_CHANGE_MARK and PSI_CHANGE_FIELD
parameters. The value of the PBCCH_CHANGE_MARK may be incremented by one,
modulo 8, each time the network makes a change in the PBCCH information. Such
change includes any addition, removal or replacement of PSI messages, contents
of PSI messages, or change in the scheduling of PSI messages on PBCCH. A
change in the contents of the PSI1 message alone shall not be reflected in the
PBCCH_CHANGE_MARK. When the PBCCH_CHANGE_MARK is incremented, the
PSI_CHANGE_FIELD parameter shall be set to an appropriate value to indicate
the nature of the latest change in the PBCCH information.
The network may increment the PBCCH_CHANGE_MARK value by more than one, modulo
8, in order to enforce a complete acquisition of PBCCH information of all
mobile stations.
In order to avoid extensive TBF suspensions following an increment of the
PBCCH_CHANGE_MARK parameter, the network may send PSI messages on PACCH to
mobile stations in MAC-Shared state.
The network indicates the support of the PACKET PSI STATUS and EGPRS PACKET
CHANNEL REQUEST messages in the PSI1 message.
##### 5.4.2.1.2 System information on BCCH
In addition to the requirements in 3GPP TS 44.018, a SYSTEM INFORMATION TYPE
13 (SI13) message or a SYSTEM INFORMATION TYPE 13 Alt (SI13-Alt) message is
regularly broadcast by the network on the BCCH to support _Iu mode_. Note that
either the SI13 message or the SI13-Alt message is required on BCCH to support
_Iu mode_.
##### 5.4.2.1.3 System information on PACCH (and other logical channels)
See 3GPP TS 44.060 sub-clause 5.5.2.1.3.
##### 5.4.2.1.4 Consistent sets of system information messages
Certain types of PSI messages are sent on PBCCH in a multiple number of
instances. If such a PSI message type is sent on (P)BCCH, a mobile station
shall receive a consistent set of that type of PSI message. In some cases,
more than one type of PSI messages may be joined into one consistent set, see
table 5.4.2.1.4.1.
Table 5.4.2.1.4.1: Consistent sets of system information messages
* * *
Consistent set /\ Broadcast\ Number of instances PSI change mark\ PSI index\
PSI count\ Message Type(s) Channel parameter parameter parameter
PSI2 PBCCH 1 -- 8 PSI2_CHANGE_MARK PSI2_INDEX PSI2_COUNT
PSI3 PBCCH 1 PSI3_CHANGE_MARK
PSI3 bis PBCCH 1 -- 16 PSI3_CHANGE_MARK PSI3bis_INDEX PSI3bis_COUNT
PSI3 ter PBCCH 0 -- 16 PSI3_CHANGE_MARK PSI3ter_INDEX PSI3ter_COUNT
PSI3 quater PBCCH 0 -- 16 PSI3_CHANGE_MARK PSI3quater_INDEX PSI3quater_COUNT
PSI5 PBCCH 0 -- 8 PSI5_CHANGE_MARK PSI5_INDEX PSI5_COUNT
PSI6 PBCCH 0 -- 8 PSI6_CHANGE_MARK PSI6_INDEX PSI6_COUNT
PSI7 PBCCH 0 -- 8 PSI7_CHANGE_MARK PSI7_INDEX PSI7_COUNT
PSI8 PBCCH 0 -- 8 PSI8_CHANGE_MARK PSI8_INDEX PSI8_COUNT
PSI16 PBCCH 0 -- 8 PSI16_CHANGE_MARK PSI16 _INDEX PSI16_COUNT
* * *
A consistent set of system information messages is identified by a PSI _change
mark_ parameter included in each message in the set. All messages within a
consistent set shall have the same value of this parameter.
The total number of system information messages of a certain type within a
consistent set is indicated by a PSI _count_ parameter included in each
message in the set. The position of a certain message instance within the
consistent set of system information messages is indicated by a PSI _index_
parameter.
The PSI _count_ parameter shall have the value N--1, where N is the number of
instances of the particular message type present in the consistent set. The
PSI _index_ parameter shall have a range from zero to N--1. Different
instances of a particular message type in a consistent set shall have
different values of the PSI _index_ parameter.
#### 5.4.2.2 Paging
See 3GPP TS 44.060 sub-clause 5.5.2.2.
#### 5.4.2.3 Network Assisted Cell Change
See 3GPP TS 44.060 sub-clause 5.5.2.3.
## 5.5 Measurement reports
### 5.5.1 General
See 3GPP TS 44.060 sub-clause 5.6.0.
### 5.5.2 Network Control (NC) measurement reporting
The behaviour of the mobile station is controlled by the parameter
NETWORK_CONTROL_ORDER broadcast in the PSI5 message on PBCCH, in the SI13,
SI13-Alt and SI2quater messages on the BCCH and in the PSI13 message on PACCH.
Alternatively, the network may send the NETWORK_CONTROL_ORDER parameters in a
PACKET MEASUREMENT ORDER or in a PACKET CELL CHANGE ORDER message on PCCCH or
PACCH to a particular mobile station. The parameter NETWORK_CONTROL_ORDER may
have one of the values NC0, NC1, NC2 or RESET (see 3GPP TS 45.008).
When in mode NC1 or NC2, the mobile station shall perform the NC measurements
as defined in 3GPP TS 45.008. The reporting periods are indicated in the
NC_REPORTING_PERIOD_I and NC_REPORTING_PERIOD_T field of the PSI5, the
SI2quater, the PACKET CELL CHANGE ORDER or the PACKET MEASUREMENT ORDER
message. If NC_NON_DRX_PERIOD, NC_REPORTING_PERIOD_I or NC_REPORTING_PERIOD_T
have not been received by the mobile station the default values shall be used.
The mobile station shall apply to the timer T3158 either the
NC_REPORTING_PERIOD_I when in MAC-Idle state or the NC_REPORTING_PERIOD_T when
in MAC-Shared state. The measurement results shall be sent to the network
using the procedures specified in sub-clause 7.4 for MAC Idle state, and in
sub-clause 8.4 for MAC-Shared state.
On expiry of timer T3158, the mobile station shall restart timer T3158 with
the indicated reporting period, perform the measurements and send either the
PACKET MEASUREMENT REPORT message or the PACKET ENHANCED MEASUREMENT REPORT to
the network. The condition for sending the PACKET ENHANCED MEASUREMENT REPORT
message instead of the PACKET MEASUREMENT REPORT message is based on the
REPORT_TYPE parameter and if the MS has received BSIC information for all
cells. For the detailed conditions see 3GPP TS 44.060 sub-clause 11.2.23, sub-
clause 11.2.4 and sub-clause 11.2.9b and also 3GPP TS 44.018 sub-clause
10.5.2.33b.
A mobile station in mode NC1 or NC2 may receive a new indicated reporting
period while timer T3158 is active. If the new indicated reporting period is
less than the time to expiry of timer T3158, the mobile station shall
immediately restart timer T3158 with the new indicated reporting period.
Otherwise, the timer T3158 shall continue to run.
When changing from MAC-Shared state to MAC-Idle state, a mobile station in
mode NC1 or NC2 shall restart the timer T3158 with the reporting period
determined by the NC_REPORTING_PERIOD_I parameter if at least one PACKET
MEASUREMENT REPORT or PACKET ENHANCED MEASUREMENT REPORT message was sent in
MAC-Shared state. Otherwise the timer T3158 shall continue to run.
When changing from MAC-Idle state to MAC-Shared state, a mobile station in
mode NC1 or NC2 shall restart the timer T3158 with the reporting period
determined by the NC_REPORTING_PERIOD_T parameter if the reporting period is
less than the time to expiry of timer T3158. Otherwise the timer T3158 shall
continue to run.
When a mobile station in _Iu mode_ leaves RRC-Cell Shared state and enters
RRC-GRA_PCH state or RRC-Idle mode, the timer T3158 shall be stopped and no
more measurement reports shall be sent to the network.
A mobile station may reselect a new cell or may be ordered to reselect a new
cell with mode NC1 or NC2 while timer T3158 is active. If time to expiry of
timer T3158 is greater than the indicated reporting period for the new cell,
the mobile station shall immediately restart timer T3158 with the indicated
reporting period for the new cell. Otherwise, the timer T3158 shall continue
to run.
At cell reselection the NC measurement parameters valid for the mobile station
in the new cell (NETWORK_CONTROL_ORDER, NC_NON_DRX_PERIOD,
NC_REPORTING_PERIOD_I and NC_REPORTING_PERIOD_T) are either:
\- brought from the old cell (if received in a PACKET MEASUREMENT ORDER or
PACKET CELL CHANGE ORDER message); or
\- received in a broadcast PSI5, SI13, SI13-Alt, PSI13 or SI2quater message in
the new cell. If no parameters have been brought from the old cell, and until
individual measurement parameters are received in the new cell, the mobile
station shall use the broadcast measurement parameters from PSI5 or use the
default parameter values.
The default frequency list to be applied in the new cell shall be the BA(GPRS)
list of that cell until a new PACKET MEASUREMENT ORDER message is received.
The BA(GPRS) list could also have been modified by frequency parameters
received in a PACKET_CELL_CHANGE_ORDER message in the old cell.
For (NC) measurement reporting, the Mobile Station shall use PACKET ENHANCED
MEASUREMENT REPORT messages instead of PACKET MEASUREMENT REPORT messages if
that is indicated by the parameter REPORT_TYPE and if at least one BSIC is
allocated to each frequency in the BA(GPRS) list.
For a multi-RAT mobile station, reports on 3G cells may also be included in
the reporting. For report with the PACKET MEASUREMENT REPORT message,
reporting is performed on two separate lists: the BA(GPRS) and the 3G
Neighbour Cell List (for a multi-RAT MS). For report with the PACKET ENHANCED
MEASUREMENT REPORT message, reporting is performed on the Neighbour Cell List
(defined in 3GPP TS 44.060 sub-clause 5.6.3.3).
A mobile station that has been allocated one or more DBPSCHs, shall not send
Network Control measurement reports to the network during that period. The
mobile station shall return to the previous reporting mode when all the
DBPSCHs have been released.
### 5.5.3 (void)
### 5.5.4 Additional measurement and reporting parameters
See 3GPP TS 44.060 sub-clause 5.6.4.
## 5.6 Mapping of Signalling Radio Bearers (SRB) onto logical channels /
transport channels
### 5.6.1 Downlink
In downlink direction, the mapping of SRBs onto logical channels or, in case
of FLO, transport channels is left up to network implementation. The rules
defined in sub-clause 5.6.2 should be used. The MS shall be able to receive
SRB data on any of the following logical channels if available: SDCCH, SACCH,
FACCH, PDTCH and SFACCH. Additionaly, a MS supporting FLO shall be able to
receive SRB data on CDCH.
### 5.6.2 Uplink
#### 5.6.2.1 MAC-Dedicated State
Table 5.6.2.1.1 represents the alternatives for mapping a given SRB onto a
given logical channel or, in case of FLO, transport channel when the MS is in
MAC‑Dedicated state. The MS shall obey the rules given in this table. Only the
logical channels or transport channels available for SRBs are listed.
In case more than one DBPSCHs are assigned, with a mixed allocation of TCH(s)
and PDTCH(s) (e.g. TCH on one DBPSCH, and PDTCH on the other DBPSCH), any
ongoing transfer of a given SRB shall continue in the same TBF mode.
Table 5.6.2.1.1: Mapping of SRBs onto logical channels or transport channels
in MAC-Dedicated State
* * *
         MAC-Dedicated State                                   
         SDCCH + SACCH         FACCH + SACCH   PDTCH + SACCH   CDCH + SACCH
SRB1 SACCH SACCH SACCH SACCH SRB2 SDCCH FACCH PDTCH CDCH SRB3 SDCCH FACCH
PDTCH CDCH SRB4 SDCCH SACCH PDTCH SACCH
* * *
#### 5.6.2.2 MAC-Shared State
Table 5.6.2.2.1 represents the alternatives for mapping a given SRB onto a
given logical channel when the MS is in MAC‑Shared state. The MS shall obey
the rules given in this table. Only the logical channels available for SRBs
are listed.
Table 5.6.2.2.1: Mapping of SRBs onto logical channels in MAC-Shared State
* * *
                                                                                                                                                                              MAC-Shared State
                                                                                                                                                                              PDTCH + SFACCH
SRB1 PDTCH xor SFACCH (_i_) SRB2 PDTCH xor SFACCH (_i_) SRB3 PDTCH xor SFACCH
(_i_) SRB4 PDTCH xor SFACCH (_i_) Rule _i_ : PDTCH shall be used if and only
if the corresponding TBF is established or a TBF establishment request is
ongoing for this SRB, otherwise SFACCH shall be used.
* * *
#### 5.6.2.3 MAC-DTM State
Table 5.6.2.3.1 represents the alternatives for mapping a given SRB onto a
given logical channel or, in case of FLO, transport channel when the MS is in
MAC‑DTM state. The MS shall obey the rules given in this table. Only the
logical channels or transport channel available for SRBs are listed.
Table 5.6.2.3.1: Mapping of SRBs onto logical channels or transport channels
in MAC-DTM State
+----------------------------------+----------------------------------+ | | MAC-DTM State | +----------------------------------+----------------------------------+ | | (FACCH/H + SACCH/H) + (PDTCH/H | | | (see note) + SFACCH/H) | +----------------------------------+----------------------------------+ | SRB1 | SACCH/H | +----------------------------------+----------------------------------+ | SRB2 | PDTCH/H xor FACCH/H (_ii_) | +----------------------------------+----------------------------------+ | SRB3 | PDTCH/H xor SFACCH/H (_i_) | +----------------------------------+----------------------------------+ | SRB4 | PDTCH/H xor SFACCH/H (_i_) | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | | MAC-DTM State | +----------------------------------+----------------------------------+ | | (CDCH + SACCH/H) + (PDTCH/H (see | | | note) + SFACCH/H) | +----------------------------------+----------------------------------+ | SRB1 | SACCH/H | +----------------------------------+----------------------------------+ | SRB2 | PDTCH/H xor CDCH (_iv_) | +----------------------------------+----------------------------------+ | SRB3 | PDTCH/H xor SFACCH/H (_i_) | +----------------------------------+----------------------------------+ | SRB4 | PDTCH/H xor SFACCH/H (_i_) | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | | MAC-DTM State | +----------------------------------+----------------------------------+ | | (FACCH/F + SACCH/F) + (PDTCH/F + | | | SFACCH/F) | +----------------------------------+----------------------------------+ | SRB1 | SACCH/F | +----------------------------------+----------------------------------+ | SRB2 | FACCH/F xor PDTCH/F (_ii_) | +----------------------------------+----------------------------------+ | SRB3 | PDTCH/F xor SFACCH/F (_i_) | +----------------------------------+----------------------------------+ | SRB4 | PDTCH/F xor SFACCH/F (_i_) | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | | MAC-DTM State | +----------------------------------+----------------------------------+ | | (CDCH + SACCH/F) + (PDTCH/F + | | | SFACCH/F) | +----------------------------------+----------------------------------+ | SRB1 | SACCH/F | +----------------------------------+----------------------------------+ | SRB2 | CDCH xor PDTCH/F (_iv_) | +----------------------------------+----------------------------------+ | SRB3 | PDTCH/F xor SFACCH/F (_i_) | +----------------------------------+----------------------------------+ | SRB4 | PDTCH/F xor SFACCH/F (_i_) | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | | MAC-DTM State | +----------------------------------+----------------------------------+ | | (PDTCH + SACCH) + (PDTCH + | | | SFACCH) | +----------------------------------+----------------------------------+ | SRB1 | SACCH | +----------------------------------+----------------------------------+ | SRB2 | PDTCH (_iii_) | +----------------------------------+----------------------------------+ | SRB3 | PDTCH xor SFACCH (_i_) | +----------------------------------+----------------------------------+ | SRB4 | PDTCH xor SFACCH (_i_) | +----------------------------------+----------------------------------+ | Rule _i_ : PDTCH shall be used if | | | and only if the corresponding | | | TBF is established or a TBF | | | establishment request is ongoing | | | for this SRB, otherwise SFACCH | | | shall be used. | | | | | | Rule _ii_ : PDTCH shall be used | | | if and only if the corresponding | | | TBF is established or a TBF | | | establishment request is ongoing | | | for SRB2, else FACCH shall be | | | used. In case more than one | | | DBPSCHs are assigned, with a | | | mixed allocation of TCH(s) and | | | PDTCH(s) (e.g. TCH on one | | | DBPSCH, and PDTCH on the other | | | DBPSCH), any ongoing SRB2 | | | transfer shall continue in the | | | same TBF mode. | | | | | | Rule _iii_ : PDTCH on SBPSCH | | | shall be used if and only if the | | | corresponding TBF is established | | | or a TBF establishment request | | | is ongoing for SRB2, else PDTCH | | | on DBPSCH shall be used. | | | | | | Rule _iv_ : PDTCH shall be used | | | if and only if the corresponding | | | TBF is established or a TBF | | | establishment request is ongoing | | | for SRB2, else CDCH shall be | | | used. | | | | | | NOTE: Single-slot operation with | | | exclusive allocation. | | +----------------------------------+----------------------------------+
## 5.7 Multiplexing principles with Flexible Layer One
### 5.7.1 General
The Flexible Layer One may only be used on DBPSCH in MAC-Dedicated and MAC-DTM
states. The allowed channel combinations are defined in 3GPP TS 45.002.
Multiplexing of TBFs in UDCH TBF mode or CDCH TBF mode with TBFs in GPRS TBF
mode, EGPRS TBF mode, TCH TBF mode or DCCH TBF mode on the same DBPSCH is not
allowed with the exceptions of TBFs on SACCH and half-rate configurations.
A mobile station may have up to four simultaneous active transport channels in
the same TTI on a DBPSCH (see 3GPP TS 45.002)
### 5.7.2 Mutliplexing between user-plane and control-plane
The figure below illustrates the multiplexing between user-plane and control-
plane onto transport channels.
A TBF may send data onto one transport channel at a time per TTI per DBPSCH,
following the rules below:
\- RLC/MAC blocks for data transfer associated with an SRB shall be sent on
CDCH.
\- RLC/MAC blocks for data transfer associated with a URB shall be sent on
UDCH.
\- RLC/MAC blocks for control message transfer shall be sent on ADCH.
There may be up to four simultaneous UDCHs active during the same TTI on a
DBPSCH, allowing for transfer of data from four different TBFs during the same
TTI.
On a DBPSCH, when either CDCH or ADCH is active during a TTI, no other
transport channel may be active at the same time.
NOTE: User-plane and control-plane data are effectively multiplexed on the
same DBPSCH on a TTI-basis.
{width="3.0652777777777778in" height="3.426388888888889in"}
Figure 5.7.2.1: Control-plane and user-plane multiplexing on transport
channels
# 6 Paging procedures
## 6.1 General
The Packet Paging procedure is always initiated upon request by RRC. RRC shall
provide all the necessary information to construct a PACKET PAGING REQUEST
message. The MAC layer shall include in the PACKET PAGING REQUEST message all
information received from the RRC layer. A number of mobile stations can be
paged in the same paging message.
On receipt of a PACKET PAGING REQUEST message, the MAC shall forward all
received information for this mobile station to RRC.
## 6.2 Paging initiation in MAC-Idle state
In MAC-Idle state and upon request from RRC, the MAC layer initiates the
Packet Paging procedure by transmitting a PACKET PAGING REQUEST message on an
appropriate paging subchannel on the PCCCH, taking into account the DRX
parameters valid for each targeted mobile station (see sub-clause 5.4.1.8).
The following IEs shall be included in the in the PACKET PAGING REQUEST
message. RRC determines the values of the IEs (see 3GPP TS 44.118).
\- MS Identity (IMSI, TMSI, P-TMSI or G-RNTI).
The following IEs may be included in the in the PACKET PAGING REQUEST message.
RRC determines which IEs to include and their values (see 3GPP TS 44.118).
\- CN domain identity.
\- Paging cause.
\- Paging Record Type Identifier.
## 6.3 Paging initiation in MAC-Shared state
In MAC-Shared state and upon request from RRC, the MAC layer initiates the
paging procedure by transmitting a PACKET PAGING REQUEST message on the PACCH.
The following IEs shall be included in the in the PACKET PAGING REQUEST
message. RRC determines the values of the IEs (see 3GPP TS 44.118).
\- MS Identity (IMSI, TMSI, P-TMSI or G-RNTI).
The following IEs may be included in the in the PACKET PAGING REQUEST message.
RRC determines which IEs to include and their values (see 3GPP TS 44.118).
\- CN domain identity.
\- Paging cause.
\- Paging Record Type Identifier.
## 6.4 Reception of PACKET PAGING REQUEST by an MS
Upon reception of a PACKET PAGING REQUEST message on either PCCCH or PACCH,
the MAC shall forward all received information for this mobile station to RRC.
# 7 Medium Access Control (MAC) procedures on PCCCH
## 7.1 General
The establishment of a Temporary Block Flow (TBF) can be initiated by either
the mobile station or the network.
The request for establishment of a TBF using the PCCCH is described in this
sub-clause. For mobile stations in MAC-Idle state measurement reports messages
are sent on temporary fixed allocations without the establishment of an uplink
TBF (see sub-clause 7.4).
## 7.2 TBF establishment initiated by the mobile station on PCCCH
### 7.2.1 General
The purpose of the packet access procedure is to establish a TBF to support
the transfer of upper-layer PDUs in the direction from the mobile station to
the network. Packet access shall be done on PCCCH, as defined in this sub-
clause. The packet access can be done in either one phase (sub-clause 7.2.3)
or in two phases (sub-clauses 7.2.3 and 7.2.4).
TBF establishment can also be done on PACCH if a TBF for transfer of upper-
layer PDUs in the direction from the network to the mobile station is already
established (see sub-clause 8.2.2.1.3). TBF establishment can also be done on
PACCH if the mobile station is releasing its last TBF for transfer of upper-
layer PDUs in the direction from the mobile station to the network and TBF for
transfer of upper-layer PDUs in the direction from the network to the mobile
station is not established (see sub-clause 10.4.5.5 and sub-clause 10.4.6.4).
If the mobile station is in MAC-Dedicated state the establishment of a TBF
shall be performed by the procedures specified in 3GPP TS 44.118.
The packet access procedure is initiated by the mobile station. Initiation is
triggered by a request from upper layers to transfer an upper-layer PDU using
the primitives that are defined in sub-clause 4.3.
Upon such a request:
\- if access to the network is allowed (sub-clause 7.2.2), the mobile station
shall initiate the packet access procedure as defined in sub-clause 7.2.3.1.1;
\- otherwise, the MAC sublayer in the mobile station shall reject the request.
### 7.2.2 Permission to access the network
See 3GPP TS 44.060 sub-clause 7.1.1.
### 7.2.3 Initiation of a TBF establishment
#### 7.2.3.1 Initiation of the packet access procedure
##### 7.2.3.1.1 General
The mobile station shall initiate the packet access procedure by scheduling
the sending of (EGPRS) PACKET CHANNEL REQUEST messages on the PRACH
corresponding to its PCCCH_GROUP. The mobile station shall use the last access
parameters received on PBCCH. At sending of the first (EGPRS) PACKET CHANNEL
REQUEST message, the mobile station shall store the value for the Retry (R)
bit to be transmitted in all the subsequent MAC headers for this TBF as \'MS
sent channel request message once\'. If a second (EGPRS) PACKET CHANNEL
REQUEST message is sent, the mobile station shall change the value for the
Retry (R) bit to \'MS sent channel request message once or more\'.
While waiting for a response to the (EGPRS) PACKET CHANNEL REQUEST message,
the mobile station shall monitor the full PCCCH corresponding to its
PCCCH_GROUP. The mobile station shall perform signal strength measurements as
they are defined for MAC-Idle state (see 3GPP TS 45.008).
While monitoring the full PCCCH, the mobile station shall decode any
occurrence of the PERSISTENCE_LEVEL parameter included in a message received
on PCCCH. When the mobile station receives the PERSISTENCE_LEVEL parameter,
the value of the PERSISTENCE_LEVEL parameter shall be taken into account at
the next (EGPRS) PACKET CHANNEL REQUEST attempt that follows.
The (EGPRS) PACKET CHANNEL REQUEST messages are sent on PRACH and contain an
indication of the type of access and parameters required to indicate the
mobile station\'s demand of radio resource.
There are two formats of the PACKET CHANNEL REQUEST message containing either
8 bits or 11 bits of information. The format to be applied on PRACH is
controlled by the parameter ACC_BURST_TYPE which is broadcast on PBCCH. The
cause value to be used in the PACKET CHANNEL REQUEST message for a non-EGPRS
TBF mode capable MS depends on the purpose of the packet access procedure as
follows:
\- If the mobile station intends to use the TBF to send user data it shall
determine the RLC mode from the configuration of the radio bearer for which
the TBF is to be established. If the requested RLC mode is acknowledged mode,
the mobile station shall request either one phase access or two phase access.
If the requested RLC mode is unacknowledged mode, the mobile station shall
indicate in the PACKET CHANNEL REQUEST message either One phase Access Request
in RLC unacknowledged mode or two phase access.
\- If the purpose of the packet access procedure is to send a message on SRB1;
in this case, the mobile station shall indicate either \'Single Block Without
TBF Establishment\' or \'One phase Access Request in RLC unacknowledged mode\'
in the PACKET CHANNEL REQUEST message.
\- If the purpose of the packet access procedure is to send a message on
SRB2-4 and a dedicated channel is not needed; in this case the mobile station
shall indicate \'MM Procedure\' in the PACKET CHANNEL REQUEST message.
\- If the purpose of the packet access procedure is to send a message on
SRB2-4 and a dedicated channel is needed; in this case, the mobile station
shall indicate \'Dedicated channel request\' in the PACKET CHANNEL REQUEST
message
\- If the purpose of the packet access procedure is to initiate an Emergency
Call; in this case, the mobile station shall indicate \'Emergency Call\' in
the PACKET CHANNEL REQUEST message.
\- If the purpose of the packet access procedure is to request multiple TBFs,
the mobile station shall request a two phase access.
EGPRS TBF mode capable MSs shall monitor the GPRS Cell Options IE on the
PBCCH(PSI1/PSI13) for the cell\'s EGPRS capability. In the GPRS Cell Options
IE it is also indicated if the EGPRS PACKET CHANNEL REQUEST is supported in
the cell.
\- If the cell is EGPRS TBF mode capable and EGPRS PACKET CHANNEL REQUEST is
supported in the cell the EGPRS PACKET CHANNEL REQUEST messages shall be used
at one-phase access attempts (in RLC acknowledged or unacknowledged mode),
two-phase access attempts, sending of a message on SRB2-4 if a dedicated
channel is needed or initiation of an emergency call. The corresponding cause
value shall be used.
\- If the cell is EGPRS TBF mode capable and EGPRS PACKET CHANNEL REQUEST
messages are not supported in the cell or if the cell is not EGPRS TBF mode
capable, the EGPRS TBF mode capable mobile station shall use the PACKET
CHANNEL REQUEST message as for non-EGPRS TBF mode capable MSs (see above).
##### 7.2.3.1.2 Access persistence control on PRACH
See 3GPP TS 44.060 sub-clause 7.1.2.1.1.
#### 7.2.3.2 Packet assignment procedure
##### 7.2.3.2.1 On receipt of a PACKET CHANNEL REQUEST or EGPRS PACKET CHANNEL
REQUEST message
##### 7.2.3.2.1.1 General {#general-15 .H6}
On receipt of a PACKET CHANNEL REQUEST or EGPRS PACKET CHANNEL REQUEST
message, the network may assign to the mobile station a radio resource on
either one or more SBPSCHs or on one or more DBPSCHs, based on the cause field
in the received message. The network shall not assign more than one DBPSCH/S
to the mobile station.
###### 7.2.3.2.1.2 Allocation of resource on SBPSCH(s)
See 3GPP TS 44.060 sub-clause 7.1.2.2.1
###### 7.2.3.2.1.3 Allocation of resource on DBPSCH(s)
When the mobile station has been allocated a resource on one or more DBPSCHs,
the allocated dedicated resource is assigned to the mobile station in a PACKET
DBPSCH ASSIGNMENT message, sent on any PAGCH block on the same PCCCH on which
the network has received the PACKET CHANNEL REQUEST or EGPRS PACKET CHANNEL
REQUEST message. The _Packet Request Reference_ information element shall be
used to address the mobile station and frequency parameters shall be included.
The mobile station may use information received on PBCCH or a previous
assignment message to decode the frequency parameters contained in the
assignment message. If the mobile station detects an invalid _Frequency
Parameters_ information element in the assignment message, it shall abort the
procedure, if required initiate a partial acquisition of PBCCH information,
and may then re-initiate this procedure.
In case the allocated channel type is PDTCH+PACCH+SACCH (see 3GPP TS 44.060),
the network shall include the USF value to be used on PDTCH and PACCH in the
PACKET DBPSCH ASSIGNMENT message.
On receipt of a PACKET DBPSCH ASSIGNMENT message corresponding to one of its 3
last PACKET CHANNEL REQUEST or EGPRS PACKET CHANNEL REQUEST messages the
mobile station shall stop timers T3186 and T3170 if running and stop sending
PACKET CHANNEL REQUEST or EGPRS PACKET CHANNEL REQUEST messages. The mobile
station shall then switch to the assigned DBPSCH(s), enter the MAC-Dedicated
state and proceed with contention resolution of the one phase packet access
procedure according to sub-clause 7.2.3.3.2.
When the mobile station switches to the assigned DBPSCH(s), it shall take into
account the power control parameters received in downlink SACCH blocks,
perform signal strength measurements and apply output power control procedures
as they are defined for MAC-Dedicated state (see 3GPP TS 45.008). The mobile
station shall not send any measurement reports until contention resolution is
complete. It shall follow the procedures in sub-clauses 9 and 11.
##### 7.2.3.2.1.4 Packet access queuing notification procedure {#packet-
access-queuing-notification-procedure .H6}
See 3GPP TS 44.060 sub-clause 7.1.2.2.2.
##### 7.2.3.2.1.5 Packet polling procedure {#packet-polling-procedure .H6}
See 3GPP TS 44.060 sub-clause 7.1.2.2.3.
##### 7.2.3.2.1.6 Packet access reject procedure {#packet-access-reject-
procedure .H6}
The network may, as response to a PACKET CHANNEL REQUEST or EGPRS PACKET
CHANNEL REQUEST message, send to the mobile station a PACKET ACCESS REJECT
message on any PAGCH block on the same PCCCH on which the channel-request
message was received. This message contains the request reference with time of
reception of the PACKET CHANNEL REQUEST or EGPRS PACKET CHANNEL REQUEST
message and optionally a WAIT_INDICATION field in the _Reject structure_ of
the PACKET ACCESS REJECT message.
On receipt of a [PACKET ACCESS REJECT]{.smallcaps} message containing a
_Reject structure_ addressed to the mobile station, where the _Packet Request
Reference_ in the _Reject structure_ corresponds to one of the mobile
station's last 3 [PACKET CHANNEL REQUEST]{.smallcaps} or EGPRS [PACKET CHANNEL
REQUEST]{.smallcaps} messages:
\- The mobile station shall stop T3186, stop sending [PACKET CHANNEL
REQUEST]{.smallcaps} or EGPRS [PACKET CHANNEL REQUEST]{.smallcaps} messages,
start T3172 with the value indicated in the WAIT_INDICATION field, start T3170
if it has not already been started, and listen to the downlink PCCCH until
T3170 expires. During this time, the mobile station shall ignore additional
[PACKET ACCESS REJECT]{.smallcaps} messages, but on reception of any [PACKET
UPLINK ASSIGNMENT]{.smallcaps} or [PACKET DBPSCH ASSIGNMENT]{.smallcaps}
message corresponding to any other of its last 3 [PACKET CHANNEL
REQUEST]{.smallcaps} or EGPRS [PACKET CHANNEL REQUEST]{.smallcaps} messages,
the mobile station shall stop T3170, stop T3172, and follow the procedure
defined in sub-clause 7.2.3.2.1.
\- If no [PACKET UPLINK ASSIGNMENT]{.smallcaps} or [PACKET DBPSCH
ASSIGNMENT]{.smallcaps} message is received before expiration of T3170, the
mobile station shall indicate a packet access failure to upper layer and
return to _MAC-Idle state._ As an option, the mobile station may stop T3170,
indicate a packet access failure to upper layer and return to _MAC-Idle state_
as soon as it has received responses from the network on all, or in case more
than 3 were sent, the last 3 of its [PACKET CHANNEL REQUEST]{.smallcaps} or
EGPRS [PACKET CHANNEL REQUEST]{.smallcaps} messages.
\- If an erroneous [PACKET UPLINK ASSIGNMENT]{.smallcaps} or [PACKET DBPSCH
ASSIGNMENT]{.smallcaps} message (_e.g._ , the mobile station has been assigned
more PDCHs than it supports according to its multislot class) addressed to the
mobile station is received before expiration of T3170, the mobile station
shall stop T3170 and act as stated in sub-clause 7.2.5.
\- If the mobile station receives a [PACKET DOWNLINK ASSIGNMENT]{.smallcaps}
message, it shall stop T3170 and respond to the message (see sub-clause
7.3.2).
\- If the mobile station receives a [PACKET DBPSCH ASSIGNMENT]{.smallcaps}
message, it shall stop T3170 and respond to the message (see sub-clause
7.3.3).
\- The mobile station shall not make a new attempt for packet access in the
same cell until T3172 expires, but may attempt packet access in another cell
after successful cell reselection for radio-conditions reasons (see 3GPP TS
45.008).
\- The value of the WAIT_INDICATION field (_i.e._ , T3172) relates to the cell
from which it was received.
#### 7.2.3.3 Contention resolution at one phase access
##### 7.2.3.3.1 Contention resolution at one phase access on SBPSCHs
The G-RNTI is used to uniquely identify the mobile station when sending on
uplink. The Radio bearer Id is used to identify the RLC instance to which the
RLC/MAC block belongs. Every RLC data block that is sent on the TBF shall
include the G-RNTI of the mobile station and the RB Id of the RLC instance
being addressed, until the contention resolution is completed on the mobile
station side. If MCS-7, MCS-8 or MCS-9 is used for the transmission of the
G‑RNTI and RB Id in EGPRS TBF mode (i.e. the RLC/MAC block is carrying two RLC
data blocks), the G-RNTI and RB Id shall be inserted in both RLC data blocks.
The G-RNTI and RB Id shall also be included in the PACKET RESOURCE REQUEST
message, if sent during the contention resolution. If ciphering is used, the
least significant bit of the uplink HFN of this radio bearer shall be inserted
in each RLC data block sent on the TBF and if applicable in the PACKET
RESOURCE REQUEST message until the contention resolution is completed on the
mobile station side. If the least significant bit of the HFN in the network
for the same radio bearer in the same direction is different from the one
received from the mobile station, the network shall increase its HFN by one
unit.
The retransmission of an RLC data block shall include the G-RNTI and RB Id if
the RLC data block was originally transmitted including these fields, also if
the retransmission occurs after the completion of the contention resolution.
At sending of the first RLC data block, the mobile station shall stop timer
T3164, set counter N3104 to 1, and start timer T3166. The counter N3104 shall
be stepped each time the mobile station sends an RLC data block.
The network shall respond by including the G-RNTI in the PACKET UPLINK
ACK/NACK message after the first correctly received RLC data block that
comprises the G-RNTI and RB Id. In EGPRS TBF mode, the network may instead
respond by addressing the mobile station with the TFI of the assigned TBF and
including the G-RNTI (in the CONTENTION_RESOLUTION_TLLI field) in a PACKET
UPLINK ASSIGNMENT message, if the resources allocated for the TBF need to be
reallocated (see sub-clause 8.2.2.1.2).
The contention resolution is completed on the network side when the network
receives an RLC data block that comprises the G-RNTI value that identifies the
mobile station, the RB Id that identifies the RLC instance being addressed and
the TFI value associated with the TBF.
The contention resolution is successfully completed on the mobile station side
when the mobile station receives a PACKET UPLINK ACK/NACK message addressing
the mobile station with the TFI value associated with the uplink TBF and
including the same G-RNTI value that the mobile station has included in the
RLC header of the first RLC data blocks, or alternatively, in EGPRS TBF mode,
a PACKET UPLINK ASSIGNMENT message addressing the mobile station with the TFI
value associated with the uplink TBF and including the same G-RNTI value that
the mobile station included in the RLC header of the first RLC data blocks.
The mobile shall then stop timer T3166 and counter N3104.
The contention resolution has failed on the mobile station side when the
counter N3104 reaches its maximum value, or timer T3166 expires. The
contention resolution also fails, if the mobile station receives a PACKET
UPLINK ACK/NACK message or in EGPRS TBF mode alternatively a PACKET UPLINK
ASSIGNMENT message addressing the mobile station with the TFI associated with
the uplink TBF and including a G-RNTI value other than that the mobile station
included in the RLC header of the first RLC data blocks; in such a case, the
mobile station shall not transmit a PACKET CONTROL ACKNOWLEDGEMENT in the
uplink radio block specified if a valid RRBP field is received as part of the
PACKET UPLINK ACK/NACK message or in EGPRS TBF mode alternatively as part of
the PACKET UPLINK ASSIGNMENT message.
In case of a contention resolution failure on the mobile station side, the
mobile station shall reset the counter N3104 and stop timer T3166. The mobile
station shall stop transmitting on the TBF and reinitiate the packet access
procedure, unless the packet access procedure has already been attempted four
times. In that case, a TBF failure has occurred, see sub-clause 7.2.5.
##### 7.2.3.3.2 Contention resolution at one phase access on DBPSCH
##### 7.2.3.3.2.1 General {#general-16 .H6}
During contention resolution the mobile station shall only send on the RB for
which packet access was initiated via the PCCCH. The RB may be mapped onto a
PDTCH, SDCCH or FACCH logical channel.
##### 7.2.3.3.2.2 Contention resolution at one phase access on PDTCH
{#contention-resolution-at-one-phase-access-on-pdtch .H6}
The G-RNTI is used to identify uniquely the mobile station when sending on
uplink. The Radio bearer Id is used to identify the RLC instance to which the
RLC/MAC block belongs. Every RLC data block that is sent on any of the mobile
station\'s TBFs, shall include the G-RNTI of the mobile station, until the
contention resolution is completed on the mobile station side.
The retransmission of an RLC data block shall include the G-RNTI if the RLC
data block was originally transmitted including this field, also if the
retransmission occurs after the completion of the contention resolution.
At sending of the first RLC data block, the mobile station shall set counter
N3104 to 1, and start timer T3166. The counter N3104 shall be incremented each
time the mobile station sends a RLC data block.
The network shall respond by including the G-RNTI in the PACKET UPLINK
ACK/NACK message after the first correctly received RLC data block that
comprises the G-RNTI and valid RB Id.
The contention resolution is completed on the network side when the network
receives an RLC data block that comprises the G-RNTI value that identifies the
mobile station, and a valid RB Id that identifies the RLC instance to which
the RLC/MAC block belongs.
The contention resolution is successfully completed on the mobile station side
when the mobile station receives a PACKET UPLINK ACK/NACK message addressing
the mobile station with a valid RBId (contained in the UPLINK_TFI field, see
3GPP TS 44.060) and including the same G-RNTI value that the mobile station
included in the RLC header of the first RLC data blocks. The mobile station
shall then stop timer T3166 and counter N3104.
The contention resolution has failed on the mobile station side when the
counter N3104 reaches its maximum value, or timer T3166 expires. The
contention resolution also fails, if the mobile station receives a PACKET
UPLINK ACK/NACK message addressing the mobile station with a G-RNTI value
other than that the mobile station included in the RLC header of the first RLC
data blocks; in such a case, the mobile station shall not transmit a PACKET
CONTROL ACKNOWLEDGEMENT in the uplink radio block specified if a valid RRBP
field is received as part of the PACKET UPLINK ACK/NACK message.
In case of a contention resolution failure on the mobile station side, the
mobile station shall reset the counter N3104 and stop timer T3166. The mobile
station shall stop transmitting on the TBF and reinitiate the packet access
procedure, unless the packet access procedure has already been attempted four
times. In that case, a TBF failure has occurred, see sub-clause 7.2.5.
##### 7.2.3.3.2.3 Contention resolution at one phase access on SDCCH or FACCH
{#contention-resolution-at-one-phase-access-on-sdcch-or-facch .H6}
The G-RNTI is used to identify uniquely the mobile station when sending on
uplink. The Reduced Radio bearer Id is used to identify the RLC instance to
which the RLC/MAC block belongs. Every RLC data block that is sent on any of
the mobile station\'s TBFs, shall include the G-RNTI of the mobile station,
until the contention resolution is completed on the mobile station side.
The retransmission of an RLC data block shall include the G-RNTI if the RLC
data block was originally transmitted including this field, also if the
retransmission occurs after the completion of the contention resolution.
At sending of the first RLC data block, the mobile station shall set counter
N3104 to 1, and start timer T3166. The counter N3104 shall be incremented each
time the mobile station sends a RLC data block.
The network shall respond by including the G-RNTI in the PACKET DBPSCH UPLINK
ACK/NACK message after the first correctly received RLC data block that
comprises the G-RNTI and valid RRB Id.
The contention resolution is completed on the network side when the network
receives an RLC data block that comprises the G-RNTI value that identifies the
mobile station, and a valid RRB Id that identifies the RLC instance to which
the RLC/MAC block belongs.
The contention resolution is successfully completed on the mobile station side
when the mobile station receives a PACKET DBPSCH UPLINK ACK/NACK message
addressing the mobile station with a valid RBId (i.e. associated with an
assigned RRB Id) and including the same G-RNTI value that the mobile station
included in the RLC header of the first RLC data blocks. The mobile station
shall then stop timer T3166 and counter N3104.
The contention resolution has failed on the mobile station side when the
counter N3104 reaches its maximum value, or timer T3166 expires. The
contention resolution also fails, if the mobile station receives a PACKET
DBPSCH UPLINK ACK/NACK message addressing the mobile station with a G-RNTI
value other than that the mobile station included in the RLC header of the
first RLC data blocks; in such a case, the mobile station shall not transmit a
PACKET CONTROL ACKNOWLEDGEMENT even if the poll bit is set in the received
message.
In case of a contention resolution failure on the mobile station side, the
mobile station shall reset the counter N3104 and stop timer T3166. The mobile
station shall stop transmitting on the TBF and reinitiate the packet access
procedure, unless the packet access procedure has already been attempted four
times. In that case, a TBF failure has occurred, see sub-clause 7.2.5.
#### 7.2.3.4 RLC/MAC procedures during contention resolution
##### 7.2.3.4.1 RLC/MAC procedures during contention resolution on SBPSCHs
During the contention resolution, the mobile station may receive a non-
distribution RLC/MAC control message addressing the mobile station by G-RNTI
or the TFI value associated with the uplink TBF. The mobile station shall act
on that message using the procedure defined for the message when it is
received in MAC-Shared state during operation on an uplink TBF (see sub-clause
8), with the following restrictions:
\- The mobile station shall not accept a PACKET MEASUREMENT ORDER message, a
PACKET CELL CHANGE ORDER message and a PACKET POWER CONTROL/TIMING ADVANCE
message addressing the mobile station with the TFI value associated with the
uplink TBF.
\- The mobile station shall not accept a PACKET DOWNLINK ASSIGNMENT, a
MULTIPLE TBF DOWNLINK ASSIGNMENT, a PACKET TIMESLOT RECONFIGURE or a MULTIPLE
TBF TIMESLOT RECONFIGURE message.
If a valid RRBP field is received as part of the RLC/MAC control block and the
mobile station acts on the message, then it shall transmit a PACKET CONTROL
ACKNOWLEDGEMENT message in the uplink radio block specified (see 3GPP TS
44.060 sub-clause 10.4.5); The mobile station shall not transmit a PACKET
CONTROL ACKNOWLEDGEMENT message if it does not act on the received message.
In either case, the mobile station shall continue with the contention
resolution on the uplink TBF, till it either completes successfully or fails,
or that the uplink TBF is released as a result of the procedure defined for
the message that is received.
During the contention resolution at one phase access, the mobile station shall
not send a Packet Resource Request message to request the establishment of
additional UL TBFs.
##### 7.2.3.4.2 RLC/MAC procedures during contention resolution on DBPSCHs
During the contention resolution, the mobile station may receive a non-
distribution RLC/MAC control message addressing the mobile station by G-RNTI,
RB Id (PACCH) or the RRB Id (SDCCH or FACCH) value associated with one its
uplink TBFs. The mobile station shall act on that message using the procedure
defined for the message in sub-clause 9.
If a RLC/MAC control block is received with the poll bitset or with valid RRBP
field and the mobile station acts on the message, then it shall transmit a
PACKET CONTROL ACKNOWLEDGEMENT message in the next possible uplink occurrence
on the same logical channel. The mobile station shall continue with the
contention resolution on the uplink TBF, until it either completes
successfully or fails, or that the uplink TBF is released through release of
the dedicated resource using the CRLC-CONFIG primitive (see sub-clause
4.3.3.1)
#### 7.2.3.5 One phase packet access completion
##### 7.2.3.5.1 One phase packet access completion on SBPSCHs
See 3GPP TS 44.060 sub-clause 7.1.2.4.
##### 7.2.3.5.2 One phase packet access completion on DBPSCHs
The one phase packet access procedure is completed upon a successful
contention resolution.
#### 7.2.3.6 Timing Advance
##### 7.2.3.6.1 Timing advance on SBPSCHs
See 3GPP TS 44.060 sub-clause 7.1.2.5.
##### 7.2.3.6.2 Timing advance on DBPSCHs
Initial timing advance may be provided in the PACKET DBPSCH ASSIGNMENT message
in the TIMING_ADVANCE_VALUE field.
### 7.2.4 TBF establishment using two phase access
#### 7.2.4.1 Initiation of the Packet resource request procedure
In the first phase of a two-phase access, the same procedures as for one-phase
access shall be used until the network sends to the mobile station a PACKET
UPLINK ASSIGNMENT message including a _Single Block Allocation struct_ or a
_Multi Block Allocation struct._. The network may only include a _Multi Block
Allocation struct_ if it sends the PACKET UPLINK ASSIGNMENT message in
response to an EGPRS PACKET CHANNEL REQUEST.
A two-phase access may be initiated:
\- by the network, by ordering the mobile station to send a PACKET RESOURCE
REQUEST message. The order shall be sent implicitly to the mobile station in
the PACKET UPLINK ASSIGNMENT message by including a _Single Block Allocation
struct_ or a _Multi Block Allocation struct_ ;
\- by a mobile station, by requiring a two-phase access in the PACKET CHANNEL
REQUEST or EGPRS PACKET CHANNEL REQUEST message. If access is granted, the
network shall order the mobile station to send a PACKET RESOURCE REQUEST
message. The order shall be sent implicitly to the mobile station in the
PACKET UPLINK ASSIGNMENT message by including a _Single Block Allocation
struct_ or a _Multi Block Allocation struct_.
When the mobile station has received the PACKET UPLINK ASSIGNMENT message, it
shall respond with a PACKET RESOURCE REQUEST message in the first allocated
radio block. If the network allocated more than a single radio block, the
mobile station shall send any of the following in each additional block:
\-- Another control block (_e.g._ , a PACKET UPLINK DUMMY CONTROL BLOCK or a
PACKET MEASUREMENT REPORT message); however, the mobile station shall not send
an ADDITIONAL MS RADIO ACCESS CAPABILITIES message or a PACKET RESOURCE
REQUEST message.
\-- Nothing.
The mobile station may request the establishment of multiple UL TBFs in the
PACKET RESOURCE REQUEST message. The _MS Radio Access Capability_ IE shall not
be included in the PACKET RESOURCE REQUEST message. If ciphering is used, the
least significant bit of the uplink HFN of the radio bearer for which radio
resources are requested, shall be inserted in the PACKET RESOURCE REQUEST
message. If the least significant bit of the HFN in the network for the same
radio bearer in the same direction is different from the one received from the
mobile station, the network shall increase its HFN by one unit.
When the mobile station switches to the assigned PDCH, it shall take the power
control parameters received in the PACKET UPLINK ASSIGNMENT message into
account, perform signal strength measurements and apply output power control
procedures as they are defined for MAC-Shared state (see 3GPP TS 45.008).
At sending of the PACKET RESOURCE REQUEST message, the mobile station shall
start timer T3168 for each of the radio bearers for which resources were
requested. Furthermore, the mobile station shall not respond to PACKET
DOWNLINK ASSIGNMENT or MULTIPLE TBF DOWNLINK ASSIGNMENT messages - but may
acknowledge such messages if they contain a valid RRBP field - while timer
T3168 is running, before contention resolution is completed on the mobile
station side.
The mobile station may indicate in the PACKET RESOURCE REQUEST message the
number of octets of user data it has to transfer.
#### 7.2.4.2 Packet resource assignment for uplink procedure
##### 7.2.4.2.1 (void)
##### 7.2.4.2.2 On receipt of a PACKET RESOURCE REQUEST message
On receipt of a PACKET RESOURCE REQUEST message, the network shall respond by
sending a PACKET UPLINK ASSIGNMENT or MULTIPLE TBF UPLINK ASSIGNMENT message
(radio resources assignment on one or more PDCHs to be used by the mobile
station for the TBF in EGPRS or GPRS TBF mode) or a PACKET ACCESS REJECT
message to the mobile station on PACCH on the same PDCH on which the mobile
station has sent the PACKET RESOURCE REQUEST message. These messages may only
be for a subset of the resources requested in the PACKET RESOURCE REQUEST
message. For the resource requests that have not been processed by the first
assignment or reject message, additional PACKET UPLINK ASSIGNMENT, MULTIPLE
TBF UPLINK ASSIGNMENT or PACKET ACCESS REJECT messages may be sent to the
mobile station on the PACCH to which the mobile station has been assigned.
On receipt of a PACKET UPLINK ASSIGNMENT or MULTIPLE TBF UPLINK ASSIGNMENT
message the mobile station shall switch to the assigned PDCHs. If dynamic or
extended dynamic allocation is assigned then start timer T3164 for each of the
TBFs that have been assigned resources.
At sending of the first RLC data block on a TBF, the mobile station shall stop
timer T3164 for that TBF.
The mobile station may use information received on PBCCH or a previous
assignment message to decode the frequency parameters contained in the
assignment message. If the mobile station detects an invalid Frequency
Parameters information element in the assignment message, it shall abort the
procedure, if required initiate a _partial acquisition_ of PBCCH information,
and may then re-initiate the access on the PRACH.
On receipt of a PACKET ACCESS REJECT message that contains a Reject structure
addressed to the mobile station, the mobile station shall stop timer T3168 and
indicate a packet access failure to upper layer for those TBFs identified as
rejected in the message.
If the PACKET ACCESS REJECT message contains a WAIT_INDICATION field in a
Reject structure addressed to the mobile station, the mobile station shall
start timer T3172 with the indicated value (Wait Indication). The mobile
station is not allowed to make a new attempt for packet access in the same
cell until all instances of timer T3172 expires, but may attempt packet access
in another cell after successful cell reselection.
#### 7.2.4.3 Contention resolution at two phase access
The contention resolution is completed on the network side when the network
receives a G-RNTI value identifying the mobile station, as part of the
contention resolution procedure on the TBF.
The contention resolution is completed on the mobile station side when the
mobile station receives a PACKET UPLINK ASSIGNMENT message or MULTIPLE TBF
UPLINK ASSIGNMENT message with the same G-RNTI as the mobile station has
included in the PACKET RESOURCE REQUEST message and assigning resource to at
least one radio bearer that requested resource in the PACKET RESOURCE REQUEST
message. The mobile station shall then stop timer T3168 for each radio bearer
for which resource is granted. It does not include its G-RNTI in any RLC data
block.
The contention resolution has failed on the mobile station side when the
mobile station does not receive a PACKET UPLINK ASSIGNMENT message or MULTIPLE
TBF UPLINK ASSIGNMENT message with its G-RNTI, assigning resource to at least
one radio bearer that requested resource in the PACKET RESOURCE REQUEST
message, before expiry of timer T3168. The mobile station shall then
reinitiate the packet access procedure unless the packet access procedure has
already been attempted four times. In that case, TBF failure has occurred for
all of the requested TBF(s) and an RLC/MAC error should be reported to the
higher layer for each of the radio bearers that requested resources.
On expiry of an instance of timer T3168 after contention resolution is
completed on the mobile station side, TBF establishment for the corresponding
radio bearer has failed. In that case the mobile station shall reinitiate
resource request for that radio bearer using the procedures described in sub-
clause 8.2.2.1.2
#### 7.2.4.4 Two phase packet access completion
See 3GPP TS 44.060 sub-clause 7.1.3.4.
#### 7.2.4.5 Timing Advance
See 3GPP TS 44.060 sub-clause 7.1.3.5.
### 7.2.5 Abnormal cases
If a failure occurs on the mobile station side of the new TBF before the
mobile station has successfully completed contention resolution, the newly
reserved resources are released; the subsequent behaviour of the mobile
station depends on the type of failure and previous actions.
\- If the failure is due to a G-RNTI mismatch, or to the expiry of timers
T3166 or T3168, or to the fact that the counter N3104 reaches its maximum
value in the contention resolution procedure, and repetition as described in
sub-clauses 7.2.3.3, 3GPP TS 44.060 sub-clause 7.1.3.2.1 or sub-clause 7.1.3.3
has been performed, the mobile station shall return to MAC-Idle state, notify
higher layer (TBF establishment failure), transactions in progress shall be
aborted and cell reselection may take place, unless the failure takes place
during a Packet Cell Change Order procedure, in which case the mobile
behaviour shall be as described in the Abnormal cases of theNetwork controlled
cell reselection procedure in 3GPP TS 44.060 sub-clause 8.4.2.
\- If the mobile station has been assigned more PDCHs than it supports
according to its MS multislot class, the mobile station shall reinitiate the
packet access procedure unless the packet access procedure has already been
attempted four times. In that case, TBF failure has occurred.
\- If the information in the PACKET UPLINK ASSIGNMENT message does not
properly specify an uplink PDCH or violates the mobile station\'s multislot
capabilities, the mobile station shall reinitiate the packet access procedure
unless the packet access procedure has already been attempted four times. In
that case, TBF failure has occurred.
\- If the mobile station has been assigned more than one DBPSCH/S, the mobile
station shall reinitiate the packet access procedure unless the packet access
procedure has been attempted four times. In that case, TBF failure has
occurred.
\- If the information in the PACKET DBPSCH ASSIGNMENT message does not
properly specify a DBPSCH or violates the mobile station\'s multislot
capabilities, the mobile station shall reinitiate the packet access procedure
(i.e. using access cause \"dedicated channel request\") unless the packet
access procedure has already been attempted four times. In that case, TBF
failure has occurred.
\- If the mobile station has been assigned a TCH that it does not support
(e.g. using 8-PSK), the mobile station shall return to MAC-Idle state and
notify higher layers (TBF establishment failure).
\- If the information in the MULTIPLE TBF UPLINK ASSIGNMENT message does not
properly specify an uplink PDCH or violates the mobile station\'s multislot
capabilities, the mobile station shall reinitiate the packet access procedure
for each of the TBFs for which there is an error unless the procedure has
already been attempted 4 times for the TBF. In that case, TBF failure has
occurred.
> \- If the MULTIPLE TBF UPLINK ASSIGNMENT message contains assignments for
> radio bearers for which a TBF was not requested, the mobile station shall
> not act upon these assignments. The mobile station shall act upon the valid
> assignments.
>
> \- If the MULTIPLE TBF UPLINK ASSIGNMENT message contains assignments such
> that more than one RB is mapped onto one TBF, then TBF failure has occurred
> for each of the RBs that are mapped onto the same TBF.
\- If the mobile station has been assigned a TBF in EGPRS mode and the MS does
not support EGPRS, or has been assigned an MCS (e.g. 8-PSK in the Uplink) that
the MS does not support, the MS shall return to MAC-Idle state and notify
higher layers (TBF establishment failure).
\- On expiry of timer T3164, the mobile station shall reinitiate the packet
access procedure for the related RB unless the packet access procedure has
already been attempted four times for this RB, in which case the mobile
station shall notify higher layers of TBF establishment failure. If the mobile
station has no remaining TBFs it shall return to MAC-Idle state.
\- If the failure is due to any other reason, the mobile station shall return
to MAC-Idle state, notify higher layer (TBF establishment failure),
transactions in progress shall be aborted and cell reselection continues.
## 7.3 TBF establishment initiated by the network on PCCCH
### 7.3.1 General
The purpose of network initiated TBF establishment is to establish a TBF to
support the transfer of upper layer PDUs in the direction from the network to
the mobile station. The procedure may be entered when the mobile station is in
MAC‑Idle state. Network initiated TBF establishment can also be done on PACCH
if a TBF for transfer of upper layer PDUs in the direction from the mobile
station to the network is already established (sub-clause 8.2.3.5).
If the mobile station is in MAC-Dedicated state the establishment of a TBF
shall be performed by procedures that are specified in 3GPP TS 44.118.
### 7.3.2 Entering the MAC-Shared state
#### 7.3.2.1 General
The procedure is triggered by a request from upper layers on the network side
to transfer an upper layer PDU to a mobile station in MAC-Idle state. The
request is implicit when receiving an upper layer PDU to a mobile station not
already having any assigned radio resources. Upon such a request, the network
shall initiate a packet downlink assignment procedure as defined in sub-clause
7.3.2.2.
#### 7.3.2.2 Packet downlink assignment procedure
##### 7.3.2.2.1 Packet downlink assignment procedure
See 3GPP TS 44.060 sub-clause 7.2.1.1.
##### 7.3.2.2.2 HFN synchronization
If ciphering is used, the least significant bit of the downlink HFN of this
radio bearer shall be inserted in the PACKET DOWNLINK ASSIGNMENT message sent
in the packet downlink assignment procedure (see sub-clause 7.3.2.2.1). If the
least significant bit of the HFN in the mobile station for the same radio
bearer in the same direction is different from the one received from the
network, the mobile station shall increase its HFN by one unit.
#### 7.3.2.3 Packet downlink assignment procedure completion
See 3GPP TS 44.060 sub-clause 7.2.1.2.
#### 7.3.2.4 Packet polling procedure
See 3GPP TS 44.060 sub-clause 7.2.1.3.
#### 7.3.2.5 Abnormal cases
See 3GPP TS 44.060 sub-clause 7.2.2.
### 7.3.3 Entering the MAC-Dedicated state
#### 7.3.3.1 General
The procedure is triggered by a request from upper layers on the network side
to transfer an upper layer PDU to a mobile station in MAC-Idle state. The
request is implicit when receiving an upper layer PDU to a mobile station not
already having any assigned radio resources and the request requires dedicated
resources. Upon such a request, the network shall initiate a packet DBPSCH
assignment procedure as defined in sub-clause 7.3.3.2.
#### 7.3.3.2 Packet DBPSCH assignment procedure
The network may assign a radio resource on one or more DBPSCHs to be used for
the TBF. The amount of radio resources to be reserved is a network dependent
choice. The network shall not assign radio resources on more than one DBPSCH/S
to the TBF.
The allocated radio resource is assigned to the mobile station in a PACKET
DBPSCH ASSIGNMENT message to the mobile station. The PACKET DBPSCH ASSIGNMENT
message is transmitted on the PCCCH timeslot corresponding to the PCCCH group
the mobile station belongs to. The appropriate PCCCH group is calculated from
the IMSI (see 3GPP TS 45.002). The behaviour of the network when the IMSI is
not provided by the upper layers is implementation dependent for the
calculation of the PCCCH group where the PACKET DBPSCH ASSIGNMENT message has
to be sent. If the mobile station is in non-DRX mode or if the IMSI or the DRX
parameters are not provided by the upper layers, there is no further
restriction on what part of the downlink PCCCH timeslot this PACKET DBPSCH
ASSIGNMENT message can be sent, provided that this part corresponds to one or
more blocks where paging may appear. If the mobile station applies DRX, this
message shall be sent in one or more PCCCH block(s) corresponding to a paging
group determined for the mobile station in MAC-Idle state (see 3GPP TS
45.002). The multislot capabilities of the mobile station shall be considered.
Initial timing advance can be provided in the PACKET DBPSCH ASSIGNMENT message
as Timing Advance Value field. For the case where Timing Advance Value is not
provided in the assignment message, the mobile station is not allowed to send
normal bursts (e.g. PACKET DOWNLINK ACK/NACK message) on the uplink until it
receives a valid timing advance on the SACCH.
The mobile station shall use information received on the PBCCH to decode the
channel descriptions contained in the assignment. If frequency hopping is
applied, the mobile station shall use the last CA received on PBCCH to decode
the Mobile Allocation. Alternatively, the network may provide a Mobile
Allocation in the assignment. The radio resource is assigned to the mobile
station in a PACKET DBPSCH ASSIGNMENT message. On receipt of a PACKET DBPSCH
ASSIGNMENT message, the mobile station shall switch to the assigned DBPSCHs.
If the mobile station receives more than one PACKET DBPSCH ASSIGNMENT message
while it monitors the PCCCH, it shall act upon the most recently received
message and shall ignore the previous message.
When the PACKET DBPSCH ASSIGNMENT message is received the mobile station shall
switch to the assigned DBPSCH(s), start timer T3190 and enters the MAC-
Dedicated state. The timer T3190 is restarted when receiving the first valid
RLC data block addressed to itself.
When the mobile station switches to the assigned DBPSCHs, it shall take the
power control parameters received in the PACKET DBPSCH ASSIGNMENT message into
account, perform signal strength measurements and apply output power control
procedures as they are defined for MAC-Dedicated state (see 3GPP TS 45.008).
On expiry of timer T3190, the mobile station shall abort the procedure and
return to MAC-Idle state.
#### 7.3.3.3 Packet DBPSCH assignment procedure completion
The Packet DBPSCH assignment procedure is completed when the mobile station
receives a valid RLC/MAC block.
#### 7.3.3.4 Packet polling procedure
On receipt of a control message with the poll bit set, the mobile station
shall respond to the network with the PACKET CONTROL ACKNOWLEDGEMENT message.
#### 7.3.3.5 Abnormal cases
If a failure occurs on the mobile station side of the new TBF before mobile
station has successfully entered the MAC-Dedicated state, the newly reserved
resources are released; the subsequent behaviour of the mobile station depends
on the type of failure and previous actions.
\- If the mobile station has been assigned more DBPSCHs than it supports
according to its MS multislot class, the mobile station shall ignore the
assignment and return to MAC-Idle state.
\- If the mobile station has been assigned more than one DBPSCH/S, the mobile
station shall ignore the assignment and return to MAC-Idle state
\- On expiry of timer T3190, the mobile station shall return to MAC-Idle
state.
\- If the failure is due to any other reason, the mobile station shall ignore
the assignment and return to MAC-Idle state and cell reselection continues.
## 7.4 Procedure for measurement report sending in MAC-Idle state
### 7.4.1 General
The procedure for measurement report sending shall be initiated by the mobile
station at expiry the NC measurement report interval timer T3158. At expiry of
the timer T3158 shall restart the expired timer T3158, perform the
measurements and initiate the packet access.
The procedure for measurement report sending is initiated by the mobile
station on PCCCH (sub-clause 7.4.2).
If the mobile station initiates the establishment of a DBPSCH, the timer T3158
shall be stopped and no measurement reports shall be sent. When the last
DBPSCH is released and if the mobile station has not changed cell, the
measurement reporting procedure shall be restarted.
If a cell change has occurred while the mobile station had one or more DBPSCHs
allocated, the measurements shall be cancelled until new NC orders have been
received (see sub-clause 5.5).
### 7.4.2 Measurement report sending procedure initiated on PCCCH
#### 7.4.2.1 General
The packet access procedure is initiated by the MAC entity in the mobile
station as specified in sub-clauses 7.2.3.1 and 7.2.3.2 but with access type
\"Single block without TBF establishment\" indicated in the PACKET CHANNEL
REQUEST message.
#### 7.4.2.2 On receipt of a PACKET CHANNEL REQUEST message
See 3GPP TS 44.060 sub-clause 7.3.1.1.
#### 7.4.2.3 On receipt of a PACKET UPLINK ASSIGNMENT message
See 3GPP TS 44.060 sub-clause 7.3.1.2.
#### 7.4.2.4 On receipt of a PACKET ACCESS REJECT message
See 3GPP TS 44.060 sub-clause 7.3.1.3.
#### 7.4.2.5 Abnormal cases
See 3GPP TS 44.060 sub-clause 7.3.1.4.
## 7.5 Cell Change Order procedures in MAC-Idle state
### 7.5.1 General
For an individual mobile station in MAC-Idle state, the network may initiate
the cell change order procedure on PCCCH.
The network may initiate the cell change order procedure by sending a PACKET
CELL CHANGE ORDER message in a PCCCH block monitored by the mobile station. No
TBF shall be established.
The PACKET CELL CHANGE ORDER message contains:
\- The characteristics of the new cell that are necessary to identify it (i.e.
BSIC + BCCH frequency).
\- The NC measurement parameters valid for the mobile station in the new cell
(NETWORK_CONTROL_ORDER and optionally: NC_NON_DRX_PERIOD,
NC_REPORTING_PERIOD_I and NC_REPORTING_PERIOD_T).
For a multi-RAT mobile station, the PACKET CELL CHANGE ORDER message may
contain information on a 3G target cell; in the case of UTRAN, the
establishment of channel(s) and subsequent measurement reporting are defined
in 3GPP TS 25.331.
Upon receipt of the PACKET CELL CHANGE ORDER message, the mobile station shall
stop all relevant RLC/MAC timers except for timers related to measurement
reporting and start timer T3174. The mobile station shall then switch to the
specified new cell and obey the relevant RLC/MAC procedures on this new cell.
If a valid RRBP field was received in the PACKET CELL CHANGE ORDER message
then the MS shall send a PACKET CONTROL ACKNOWLEDMENT message in the reserved
uplink radio block specified by the RRBP field before switching to the new
cell. If the timers related to measurement reporting expire while the
reselection procedure has not yet been completed, these timers shall be
restarted so that the mobile station resumes the measurement reporting
procedures once camped on the new cell. The mobile station shall obey the
PACKET CELL CHANGE ORDER message irrespective of whether or not the mobile
station has any knowledge of the relative synchronisation of the target cell
to the serving cell. A UTRAN capable mobile station shall obey the command
irrespective of whether the cell is known or not known (see 3GPP TS 25.133 and
3GPP TS 25.123).
The procedure for completion of the cell change order is defined in 3GPP TS
44.060 sub-clause 8.4.1 and abnormal procedures are defined in 3GPP TS 44.060
sub-clause 8.4.2.
## 7.6 Measurement Order procedures in MAC-Idle state
### 7.6.1 General
To send the NC Measurement order to an individual mobile station in MAC‑Idle
state, the network may establish a connection on PCCCH.
### 7.6.2 Measurement Order procedures initiated on PCCCH
See 3GPP TS 44.060 sub-clause 7.5.1.
# 8 Medium Access Control (MAC) procedures on SBPSCH
## 8.1 General
The MAC procedures defined in this sub-clause are applicable in MAC-Shared
state and MAC-DTM state.
The full set of downlink assignment messages comprises the PACKET DOWNLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE, MULTIPLE TBF DOWNLINK ASSIGNMENT and
MULTIPLE TBF TIMESLOT RECONFIGURE messages.
The full set of uplink assignment messages comprises the PACKET UPLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE, MULTIPLE TBF UPLINK ASSIGNMENT and
MULTIPLE TBF TIMESLOT RECONFIGURE messages.
The network may choose to send either single assignment messages (PACKET
UPLINK ASSIGNMENT, PACKET DOWNLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE) or
multiple TBF assignment messages (MULTIPLE TBF DOWNLINK ASSIGNMENT, MULTIPLE
TBF UPLINK ASSIGNMENT, MULTIPLE TBF TIMESLOT RECONFIGURE) on the PACCH. The
network shall only use the multiple TBF assignment messages when assigning or
reallocating the mobile station with more than one uplink TBF and/or more than
one downlink TBF.
## 8.1a Resource stealing (SFACCH)
The use of SFACCH in MAC-Shared state for SRBs 1 through 4 is specified in
sub-clause 5.6.2.2.
The use of SFACCH in MAC-DTM state for SRBs 3 and 4 is specified in sub-clause
5.6.2.3. SFACCH shall not be used for SRBs 1 and 2 in MAC-DTM state.
If the mobile station has data to send for an SRB that can be sent on SFACCH,
and neither a TBF nor a TBF establishment request is ongoing for this SRB, the
following procedure applies:
\- The mobile station may select a current TBF on an SBPSCH, construct an
uplink RLC data block that includes octet 3 (this octet contains the SRBid),
and send the SRB data at the TBF's next scheduled transmission opportunity for
an RLC data block. GERAN shall use the SRBid to route the SRB data to the
correct RLC instance.
\- Otherwise, the mobile station shall initiate a new TBF operating on an
SBPSCH (see sub-clause 8.2.2.0.2).
If the mobile station has data to send for an SRB, and a TBF exists for this
SRB, the following procedure applies:
\- The mobile station shall construct an uplink RLC data block that does not
include octet 3 and send the SRB data on the TBF.
If GERAN has data to send for an SRB that can be sent on SFACCH, and no TBF
exists for this SRB, the following procedure applies:
\- GERAN may select a current TBF on an SBPSCH, construct a downlink RLC data
block that includes octet 3, and send the SRB data at the TBF\'s next
scheduled transmission opportunity for an RLC data block. The mobile station
shall use the SRBid to route the SRB data to the correct RLC instance.
\- Otherwise, GERAN shall establish a new TBF operating on an SBPSCH (see sub-
clause 8.2.2.0.2).
If GERAN has data to send for an SRB, and a TBF exists for this SRB, the
following procedure applies:
\- GERAN shall construct a downlink RLC data block that does not include octet
3 and send the SRB data on the TBF.
## 8.2 Transfer of RLC data blocks
### 8.2.1 Medium access mode
The transfer of RLC data blocks on SBPSCH is governed by different principles
on both uplink and downlink for each of the defined medium access modes:
dynamic allocation, extended dynamic allocation, and exclusive allocation.
The medium access mode the mobile station is to use, except when exclusive
allocation is applied in MAC-DTM state, is given by the MAC_MODE parameter.
The MAC_MODE parameter is included in the downlink assignment (e.g. PACKET
DOWNLINK ASSIGNMENT or PACKET TIMESLOT RECONFIGURE) message, whereas in the
uplink the MAC_MODE parameter is given by the EXTENDED_DYNAMIC_ALLOCATION
parameter. The value of the MAC_MODE parameter shall not be changed while the
mobile station is in MAC-Shared state or MAC-DTM state.
Exclusive allocation is applicable only in MAC-DTM state when a single TBF is
allocated on a half-rate PDCH.
When the conditions for exclusive allocation are fulfilled, the mobile station
shall store the value of the MAC_MODE parameter. The MAC_MODE parameter has no
effect as long as exclusive allocation is used. When the conditions for
exclusive allocation are not fulfilled, the mobile station shall use the
medium access mode given by the value of the MAC_MODE parameter.
### 8.2.2 Uplink RLC data block transfer
##### 8.2.2.0 General
##### 8.2.2.0.1 General
See 3GPP TS 44.060 sub-clause 8.1.1.
##### 8.2.2.0.2 Establishment of additional uplink TBF(s)
When the mobile station has data to send that does not have the same radio
bearer identity as (any of) the uplink TBF(s) or TBF request(s) in progress,
the mobile station shall request uplink resources through one of the following
procedures:
\- If the data belongs to a signalling radio bearer
\- Use the SFACCH (see sub-clause 8.1a)
\- Establish an additional TBF (sub-clause 8.2.2.1.2)
\- If the mobile station cannot support the establishment of an additional
TBF, then the network may release an on-going TBF in order to establish a new
TBF (sub-clause 8.2.2.1.2)
\- If the data belongs to a user radio bearer
\- Establish an additional TBF (sub-clause 8.2.2.1.2)
\- If the mobile station cannot support the establishment of an additional
TBF, then the network may release an on-going TBF in order to establish a new
TBF (sub-clause 8.2.2.1.2)
##### 8.2.2.0.3 Uplink resource reallocation / reconfiguration
Neither the mobile station nor the network are allowed to modify the RLC mode,
TBF mode or radio bearer identity of an already established TBF. If the mobile
station has data to send that requires a modification of existing uplink
resources, an uplink resource request shall be sent, see sub-clause 8.2.2.0.2.
If no modifications to the uplink resources are required, the network may
reallocate existing resources through one of the following procedures:
\- The network may send a PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message to the mobile station on the PACCH to reallocate uplink
(and also downlink) resources, see sub-clause 8.2.2.1.2.2.
\- The network may send a PACKET UPLINK ASSIGNMENT or MULTIPLE TBF UPLINK
ASSIGNMENT message to the mobile station on the PACCH to reallocate uplink
resources, see sub-clause 8.2.2.1.2.2.
##### 8.2.2.0.4 Establishment of downlink TBF(s)
During uplink data transfer, the network may initiate downlink data transfer
for one or more TBFs by sending a downlink assignment message to the mobile
station on the downlink PACCH.
The network initiates assignment of a single downlink TBF by sending a PACKET
DOWNLINK ASSIGNMENT or a PACKET TIMESLOT RECONFIGURE message. The network
initiates assignment of more than one downlink TBF by sending a MULTIPLE TBF
DOWNLINK ASSIGNMENT or a MULTIPLE TBF TIMESLOT RECONFIGURE message.
The procedure to be followed is described in sub-clause 8.2.2.1.3.
#### 8.2.2.1 Dynamic Allocation uplink RLC data block transfer
See 3GPP TS 44.060 sub-clause 8.1.1.1.
##### 8.2.2.1.1 PACCH operation
See 3GPP TS 44.060 sub-clause 8.1.1.1.1.
##### 8.2.2.1.2 Resource Allocation / Reallocation for Uplink
##### 8.2.2.1.2.1 General {#general-27 .H6}
The mobile station shall initiate the uplink resource (re)allocation procedure
by sending a PACKET RESOURCE REQUEST message on the PACCH and starting timer
T3168 for each TBF request included in the Iu mode Channel Request Description
IE.
###### # 8.2.2.1.2.2 On receipt of the PACKET RESOURCE REQUEST
On receipt of the PACKET RESOURCE REQUEST message the network shall respond by
sending one or more uplink assignment messages (e.g. PACKET UPLINK ASSIGNMENT,
MULTIPLE TBF UPLINK ASSIGNMENT, MULTIPLE TBF TIMESLOT RECONFIGURE or PACKET
TIMESLOT RECONFIGURE) and/or a PACKET ACCESS REJECT message and/or a PACKET
TBF RELEASE message to the mobile station on the downlink PACCH.
When the mobile station has already been allocated the maximum number of TBFs
in the uplink direction that it can support, the network shall respond with
either a PACKET ACCESS REJECT message, or a PACKET TBF RELEASE message
followed by an uplink assignment message.
On receipt of an uplink assignment message the mobile station shall stop timer
T3168 for each uplink TBF assigned in the assignment message and switch to the
assigned SBPSCHs. A new assignment shall not terminate the previous assignment
unless the uplink assignment message explicitly contains a reassignment for an
on-going TBF.
On expiry of timer T3168 the mobile station shall retransmit the PACKET
RESOURCE REQUEST message for the TBF(s) for which T3168 has expired unless the
PACKET RESOURCE REQUEST message has already been transmitted four times for
this TBF in which case the mobile station shall indicate a packet access
failure to upper layer and perform an abnormal release without retry (see sub-
clause 8.7.1).
If no uplink assignment message is received for a TBF for which timer T3168 is
running before the mobile station has completed its currently assigned TBF(s),
the mobile station shall stop timer T3168 for that TBF, return to MAC-Idle
state and start the packet access procedure on the PCCCH.
The network may at any time during an uplink TBF initiate a change of
resources or allocation of new resources by sending on the downlink PACCH
monitored by the MS, an unsolicited uplink assignment message to the mobile
station.
On receipt of a PACKET ACCESS REJECT message, the mobile station shall stop
timer T3168, if running, for each TBF request rejected in the PACKET ACCESS
REJECT message and indicate a packet access failure to the upper layer. If no
other uplink or downlink TBFs exist, the mobile station in MAC-Shared state
shall return to MAC-Idle state; the mobile station in MAC-DTM state shall
return to MAC-Dedicated state. The DRX mode procedures shall be applied, as
specified in sub-clause 5.5.1.5.
If the PACKET ACCESS REJECT message contains a WAIT_INDICATION field in a
Reject structure addressed to the mobile station, the mobile station shall
\- start timer T3172 for each TBF request rejected in the message (listed by
radio bearer identity). The mobile station is not allowed to make a new
attempt for an uplink TBF establishment for this radio bearer in the same cell
until this instance of timer T3172 expires. It may attempt a TBF establishment
for another radio bearer while T3172 is running. It may attempt an uplink TBF
establishment in another cell after successful cell reselection. While T3172
is running, the mobile station shall ignore all received PACKET PAGING REQUEST
messages.
The value of the WAIT_INDICATION field (i.e. timer T3172) relates to the cell
from which it was received.
##### 8.2.2.1.2.3 Abnormal cases {#abnormal-cases-4 .H6}
The following abnormal cases apply:
\- If the mobile station receives a PACKET UPLINK ASSIGNMENT, MULTIPLE TBF
UPLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message and detects an invalid Frequency Parameters information
element in the message, the mobile station shall perform an abnormal release
with system information (see sub-clause 8.8.4), performing a partial
acquisition of system information messages containing frequency information.
> \- If the information in the PACKET UPLINK ASSIGNMENT or MULTIPLE TBF UPLINK
> ASSIGNMENT message incorrectly specifies one or more uplink PDCHs, the
> mobile station shall perform an abnormal release with access retry of the
> uplink TBF(s) with erroneous assignments (see sub-clause 8.8.5). The mobile
> station shall act upon the valid assignments.
>
> \- If the information in the PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
> TIMESLOT RECONFIGURE message incorrectly specifies one or more uplink and/or
> downlink PDCHs, the mobile station shall perform an abnormal release with
> access retry of the uplink TBF(s) with erroneous assignments (see sub-clause
> 8.8.5). The mobile station shall act upon the valid assignments.
>
> \- If the information in the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK
> ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE
> message violates the mobile station's multislot capabilities, the mobile
> station shall perform an abnormal release with access retry (see sub-clause
> 8.8.3).
\- If the mobile station receives a PACKET UPLINK ASSIGNMENT, MULTIPLE TBF
UPLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message specifying frequencies that are not all in one frequency
band then the mobile station shall perform an abnormal release with access
retry (see sub-clause 8.8.3).
\- If the mobile station receives a PACKET UPLINK ASSIGNMENT or MULTIPLE TBF
UPLINK ASSIGNMENT message containing a Frequency Parameters information
element specifying a frequency that is in a frequency band not supported by
the mobile station then the mobile station shall perform an abnormal release
with access retry (see sub-clause 8.8.3).
\- If the mobile station receives a PACKET UPLINK ASSIGNMENT, MULTIPLE TBF
UPLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message containing assignments such that more than one radio
bearer is mapped onto one TBF, then the mobile station shall perform an
abnormal release with access retry (see sub-clause 8.8.3).
\- If the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK ASSIGNMENT, PACKET
TIMESLOT RECONFIGURE, or MULTIPLE TBF TIMESLOT RECONFIGURE message assigns the
same USF to more than one TBF on the same timeslot, then the mobile station
shall perform an abnormal release with access retry (sub-clause 8.8.3).
\- If the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK ASSIGNMENT, PACKET
TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE message specifies a
RB Id that is not assigned to the mobile station, then the mobile station
shall perform an abnormal release with access retry (sub-clause 8.8.3).
\- If a mobile station in MAC-DTM state receives a PACKET UPLINK ASSIGNMENT,
MULTIPLE TBF UPLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
TIMESLOT RECONFIGURE message including the Frequency Parameters information
element, the mobile station shall perform an abnormal release with access
retry (see sub-clause 8.8.3).
> \- If the MULTIPLE TBF UPLINK ASSIGNMENT or MULTIPLE TBF TIMESLOT
> RECONFIGURE message does not specify a Channel Coding scheme for one or more
> of the uplink TBFs that it is assigning, then the mobile station shall
> perform an abnormal release with access retry of the uplink TBFs with
> erroneous assignments (see sub-clause 8.8.5). The mobile station shall act
> upon the valid assignments.
>
> \- If the PACKET ACCESS REJECT message does not specify a G-RNTI_extension
> field in the Iu mode Reject structure for each G-RNTI included in the TLLI /
> G-RNTI field in the Reject structure, then the mobile station shall ignore
> the message.
>
> \- If the PACKET ACCESS REJECT message includes one or more RB Id fields in
> the Iu mode Reject structure which were not included by the mobile station
> in the Iu mode Channel Request Description structure, then the mobile
> station shall perform abnormal release with access retry (see sub-clause
> 8.8.3).
\- If a failure in the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE
message is due to any other reason, the mobile station shall perform an
abnormal release with access retry (see sub-clause 8.8.3).
> A PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK ASSIGNMENT, PACKET TIMESLOT
> RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE message received by a
> multi-band mobile station shall not be considered invalid if it indicates
> new frequencies that are all in a different frequency band to that of the
> PDCH(s) on which the assignment was received. The assignment may however be
> rendered invalid for some other reason.
##### 8.2.2.1.3 Establishment of downlink TBF
###### 8.2.2.1.3.1 General
During uplink transfer, the network may initiate one or more downlink TBFs by
sending a downlink assignment message (e.g. PACKET DOWNLINK ASSIGNMENT, PACKET
TIMESLOT RECONFIGURE, MULTIPLE TBF DOWNLINK ASSIGNMENT, MULTIPLE TBF TIMESLOT
RECONFIGURE) to the mobile station on the PACCH.
If a PACKET TIMESLOT RECONFIGURE message is sent, then the message shall
contain the DOWNLINK_TFI_ASSIGNMENT field. The multislot restrictions of the
mobile station shall be observed.
A mobile allocation or reference frequency list, received as part of a
downlink assignment, replaces the previous parameters and shall be used until
a new assignment is received or the mobile station has released all TBFs.
On receipt of a downlink assignment message, and after the TBF starting time,
if present, the mobile station shall switch to the assigned SBPSCHs, and start
timer T3190 for each TBF. The operation of the downlink TBF follows the
procedures in sub-clause 8.2.3 and 3GPP TS 44.060 sub-clause 8.1.2 with the
following additions:
\- the mobile station shall prioritise transmission of RLC/MAC control blocks
associated with the downlink TBF over RLC/MAC control blocks associated with
the uplink TBF;
\- if a timer or counter expiry causes the uplink TBF to be aborted in the
mobile station triggering an abnormal release with access retry on PCCCH (see
sub-clause 8.8.3), the mobile station shall also abort all downlink TBF(s).
The mobile station shall not abort the downlink TBF(s) in case an abnormal
release with access retry on PACCH is triggered;
\- If both uplink and downlink TBFs are already established and if more than
one TBF is already established in either/both direction(s), then the network
may send a MULTIPLE TBF TIMESLOT RECONFIGURE message. If this message contains
a change in frequency in the frequency parameters and does not contain a
reassignment for one or more of the mobile station's TBFs, these TBFs are to
be released upon moving to the new frequency. If no change in frequency
parameters is included, the TBFs not explicitly reconfigured shall continue
according to their original assignment.
###### 8.2.2.1.3.2 Abnormal cases
In the following abnormal cases it is assumed that at least one uplink TBF
exists. The subsequent behaviour of the mobile station depends on the type of
failure and previous actions:
> \- If the information in the PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
> TIMESLOT RECONFIGURE message incorrectly specifies an uplink and/or downlink
> PDCH, the mobile station shall perform an abnormal release of the downlink
> TBF(s) with erroneous assignments (see sub-clause 8.8.6). The mobile station
> shall act upon the valid assignments.
>
> \- If the information in the PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
> TIMESLOT RECONFIGURE message violates the mobile station's multislot
> capabilities, the mobile station shall perform an abnormal release with
> access retry (see sub-clause 8.8.3).
\- If a downlink TBF is not already established and the PACKET TIMESLOT
RECONFIGURE message does not include a DOWNLINK_TFI_ASSIGNMENT field, then the
mobile station shall perform an abnormal release with access retry (sub-clause
8.8.3).
\- If a downlink TBF is not already established and the MULTIPLE TBF TIMESLOT
RECONFIGURE message does not assign any downlink TBFs, then the mobile station
shall perform an abnormal release with access retry (sub-clause 8.8.3).
\- If the mobile station receives a PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF
DOWNLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message containing assignments such that more than one radio
bearer is mapped onto a TBF, then the mobile station shall perform an abnormal
release with access retry (see sub-clause 8.8.3).
\- If the PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF DOWNLINK ASSIGNMENT, PACKET
TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE message specifies a
RB Id not assigned to the mobile station, then the mobile station shall
perform an abnormal release with access retry (sub-clause 8.8.3).
\- If a mobile station in MAC-DTM state receives a PACKET DOWNLINK ASSIGNMENT,
MULTIPLE TBF DOWNLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
TIMESLOT RECONFIGURE message including the Frequency Parameters information
element, the mobile station shall perform an abnormal release with access
retry (sub-clause 8.8.3).
\- If a failure in the PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF DOWNLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE
message is due to any other reason, the mobile station shall abort the
procedure. If other uplink TBFs exist, the mobile station shall perform an
abnormal release with access retry (sub-clause 8.8.3). If only downlink TBFs
exist, the mobile station shall continue the normal operation of these TBFs.
If no other TBFs exist, the mobile station shall perform an abnormal release
without retry (see sub-clause 8.8.2).
#### 8.2.2.2 Extended Dynamic Allocation uplink RLC data block transfer
##### 8.2.2.2.0 General
The Extended Dynamic Allocation medium access method extends the Dynamic
Allocation medium access method to allow higher uplink throughput.
This sub-clause defines the extensions to the Dynamic Allocation medium access
method. All procedures defined in sub-clause 8.2.2.1 apply, except where this
sub-clause defines a new procedure. In cases where this sub-clause conflicts
with sub-clause 8.2.2.1, this sub-clause takes precedence.
##### 8.2.2.2.1 Uplink PDCH Allocation
See 3GPP TS 44.060 sub-clause 8.1.1.2.1.
##### 8.2.2.2.2 PACCH operation
See 3GPP TS 44.060 sub-clause 8.1.1.2.2.
##### 8.2.2.2.3 Neighbour cell power measurements
See 3GPP TS 44.060 sub-clause 8.1.1.2.3.
##### 8.2.2.2.4 Shifted USF operation
See 3GPP TS 44.060 sub-clause 8.1.1.2.4.
#### 8.2.2.3 Exclusive Allocation uplink RLC data block transfer
See 3GPP TS 44.060 sub-clause 8.1.1.3a.
##### 8.2.2.3.1 (void)
##### 8.2.2.3.2 (void)
##### 8.2.2.3.3 (void)
##### 8.2.2.3.4 (void)
##### 8.2.2.3.5 (void)
##### 8.2.2.3.6 (void)
#### 8.2.2.4 Network initiated release of uplink TBF
See 3GPP TS 44.060 sub-clause 8.1.1.4.
#### 8.2.2.5 Abnormal cases
The following additional abnormal cases are applicable to an uplink transfer:-
\- if the mobile station receives a PACKET UPLINK ACK/NACK message with
missing mandatory fields, the mobile station shall perform an abnormal release
with access retry of the uplink TBF (sub-clause 8.8.5) associated with this
message.
\- if the mobile station receives a PACKET UPLINK ACK/NACK message that
contains a RB Id that is not assigned to the mobile station or that is
assigned to the mobile station but without any corresponding uplink TBF, the
mobile station shall perform an abnormal release with access retry (sub-clause
8.8.3).
### 8.2.3 Downlink RLC data block transfer
#### 8.2.3.1 General
##### 8.2.3.1.0 General
The network initiates assignment of a single downlink TBF by sending a PACKET
DOWNLINK ASSIGNMENT or a PACKET TIMESLOT RECONFIGURE message on the downlink
PACCH. The network initiates assignment of more than one downlink TBF by
sending a MULTIPLE TBF DOWNLINK ASSIGNMENT or a MULTIPLE TBF TIMESLOT
RECONFIGURE message on the downlink PACCH. Prior to the initiation of RLC data
block transfer on the downlink, the network assigns the following parameters
to the downlink TBF in the downlink assignment message:
\- a Temporary Flow Identity (TFI). The TFI applies to all radio blocks
transferred in regards to the downlink Temporary Block Flow (TBF).
\- a radio bearer identity (RB Id). There is a one-to-one mapping between the
TFI and the RB Id of the radio bearer for which the downlink TBF is
established.
\- a set of PDCHs to be used for the downlink transfer;
\- optionally, a TBF starting time indication.
For each TBF, the network shall prioritise RLC/MAC control blocks, not
containing a PACKET DOWNLINK DUMMY CONTROL BLOCK message, to be transmitted
ahead of RLC data blocks for that TBF. If the network has no other RLC/MAC
block to transmit, but wishes to transmit on the downlink, the network shall
transmit an RLC/MAC control block containing a PACKET DOWNLINK DUMMY CONTROL
BLOCK message.
##### 8.2.3.1.1 Downlink resource reallocation
Neither the mobile station nor the network are allowed to modify the RLC mode,
TBF mode or radio bearer identity of an already established TBF.
If no modifications to the downlink resources are required, the network may
reallocate existing resources through one of the following procedures:
\- The network may send a PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message to the mobile station on the PACCH to reallocate downlink
(and also uplink) resources, see sub-clause 8.2.3.2.
\- The network may send a PACKET DOWNLINK ASSIGNMENT or MULTIPLE TBF DOWNLINK
ASSIGNMENT message to the mobile station on the PACCH to reallocate downlink
resources, see sub-clause 8.2.3.2.
##### 8.2.3.1.2 (void)
#### 8.2.3.2 Downlink RLC data block transfer procedure
##### 8.2.3.2.0 General
Upon reception of a downlink assignment message (e.g. PACKET DOWNLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE, MULTIPLE TBF DOWNLINK ASSIGNMENT,
MULTIPLE TBF TIMESLOT RECONFIGURE) that does not contain a TBF starting time
the mobile station shall start timer T3190 for each downlink TBF assigned in
the downlink assignment message and, within the reaction time defined in 3GPP
TS 45.010, it shall attempt to decode every downlink block on its assigned
SBPSCH(s). If the downlink assignment message contains a TBF starting time
information element and there are no downlink TBFs in progress, but one or
more uplink TBFs are in progress, the mobile station shall remain on the
assigned SBPSCHs until the TDMA frame number indicated by the TBF starting
time, at which time the mobile station shall start timer T3190 for each
downlink TBF assigned in the downlink assignment message and immediately begin
decoding the assigned downlink SBPSCH(s).
If the downlink assignment message contains a TBF starting time and there are
one or more downlink TBFs already in progress, the mobile station shall
continue to use the parameters of the downlink TBFs in progress until the TDMA
frame number indicated in the TBF starting time occurs, at which time the
mobile station shall immediately begin to use the new assigned downlink TBF
parameters. If, while waiting for the frame number indicated by the TBF
starting time, the mobile station receives another downlink assignment for the
same TBF, the mobile station shall act upon the most recently received
downlink assignment and shall ignore the previous downlink assignment.
Procedures on receipt of a downlink assignment message (e.g. PACKET DOWNLINK
ASSIGNMENT message) while no TBF is in progress are specified in sub-clause
sub-clause 7.3.2.1 and 3GPP TS 44.060 sub-clause 7.2.1.1.
If the mobile station receives a valid RLC data block addressed to (one of)
its TBF(s), the mobile station shall restart timer T3190 for that TBF. If
timer T3190 expires for a TBF and if one or more uplink TBFs are in progress,
the mobile station shall perform an abnormal release with access retry (see
sub-clause 8.8.3, 3GPP TS 44.060 sub-clause 8.7.2). If no other TBFs are in
progress, the mobile station shall perform an abnormal release without retry
(see sub-clause 8.7.1).
Upon receipt of a PACKET TBF RELEASE message referring to the downlink TBF,
the mobile station shall follow the procedure in sub-clause 8.2.3.6.
##### 8.2.3.2.1 Abnormal cases
The following abnormal cases apply:
\- If a mobile station receives a PACKET TIMESLOT RECONFIGURE, MULTIPLE TBF
TIMESLOT RECONFIGURE, PACKET DOWNLINK ASSIGNMENT or MULTIPLE TBF DOWNLINK
ASSIGNMENT PACKET DOWNLINK ASSIGNMENT or PACKET TIMESLOT RECONFIGURE message
and detects an invalid Frequency Parameters information element in the
message, it shall perform an abnormal release with system information (see
sub-clause 8.8.4), performing a partial acquisition of system information
messages containing frequency information.
> \- If the information in the PACKET DOWNLINK ASSIGNMENT or MULTIPLE TBF
> DOWNLINK ASSIGNMENT message incorrectly specifies one or more downlink
> PDCHs, the mobile station shall perform an abnormal release of the downlink
> TBF(s) with erroneous assignments (see sub-clause 8.8.6). The mobile station
> shall act upon the valid assignments.
>
> \- If the information in the PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
> TIMESLOT RECONFIGURE message incorrectly specifies one or more uplink and/or
> downlink PDCHs, the mobile station shall perform an abnormal release of the
> downlink TBF(s) with erroneous assignments (see sub-clause 8.8.6). The
> mobile station shall act upon the valid assignments.
>
> \- If the information in the PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF
> DOWNLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
> RECONFIGURE message violates the mobile station's multislot capabilities,
> the mobile station shall perform an abnormal release without retry (see sub-
> clause 8.8.2).
\- If a mobile station in MAC-DTM state receives a PACKET DOWNLINK ASSIGNMENT
or MULTIPLE TBF DOWNLINK ASSIGNMENT message including the Frequency Parameters
information element, the mobile station shall abort the procedure. If another
TBF exists on a SBPSCH, the mobile station shall continue the normal operation
of these TBFs. If no other TBF exists, the mobile station shall perform an
abnormal release without retry (see sub-clause 8.8.2).
\- If a mobile station in MAC-DTM state receives a PACKET TIMESLOT RECONFIGURE
or MULTIPLE TBF TIMESLOT RECONFIGURE message including the Frequency
Parameters information element, the mobile station shall perform an abnormal
release without retry (see sub-clause 8.8.2).
\- If one or more uplink TBFs are already established and the mobile station
receives a PACKET DOWNLINK ASSIGNMENT or MULTIPLE TBF DOWNLINK ASSIGNMENT
message containing different frequency parameters than are currently in effect
for the uplink TBF(s), the mobile station shall ignore the received message
and continue normal operation of the existing TBFs.
\- If a downlink TBF is not already established and the PACKET TIMESLOT
RECONFIGURE message does not include a DOWNLINK_TFI_ASSIGNMENT field, then the
mobile station shall perform an abnormal release without retry (sub-clause
8.8.2).
\- If a downlink TBF is not already established and the MULTIPLE TBF TIMESLOT
RECONFIGURE message does not assign any downlink TBFs, then the mobile station
shall perform an abnormal release without retry (sub-clause 8.8.2).
\- If the mobile station receives a PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF
DOWNLINK ASSIGNMENT PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message containing assignments such that more than one radio
bearer is mapped onto a TBF, then the mobile station shall perform an abnormal
release without retry (see sub-clause 8.8.2).
\- If the PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF DOWNLINK ASSIGNMENT, PACKET
TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE message specifies an
RB Id that is not assigned to the mobile station, then the mobile station
shall perform an abnormal release without retry (sub-clause 8.8.2).
\- If the mobile station receives a PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF
DOWNLINK ASSIGNMENT message so that the total amount of downlink TBFs assigned
to the mobile station (i.e. new and existing TBFs) is larger than the maximum
number of downlink TBFs the mobile station supports, the mobile station shall
ignore the message and continue normal operation of the existing TBFs.
\- If the mobile station receives a PACKET TIMESLOT RECONFIGURE or MULTIPLE
TBF TIMESLOT RECONFIGURE message so that the total amount of TBFs assigned to
the mobile station (i.e. new and existing TBFs) in any direction is larger
than the maximum number of TBFs the mobile station supports in any direction,
the mobile station shall perform an abnormal release with access retry (sub-
clause 8.8.3).
\- If a failure in the PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF DOWNLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE
message is due to any other reason, the mobile station shall abort the
procedure. If other uplink TBFs exist, the mobile station shall perform an
abnormal release with access retry (sub-clause 8.8.3). If only downlink TBFs
exist, the mobile station shall continue the normal operation of these TBFs.
If no other TBFs exist, the mobile station shall perform an abnormal release
without retry (see sub-clause 8.8.2).
#### 8.2.3.3 Polling for Packet Downlink Ack/Nack
Whenever the mobile station receives an RLC data block addressed to (one of)
its TBF(s) with a valid RRBP field in the RLC data block header (i.e. is
polled), the mobile station may transmit one of the following messages in the
uplink radio block specified by the RRBP field whatever the BSN value of the
received RLC data block, according to the subsequent decreasing order of
priority:
1) (EGPRS) PACKET DOWNLINK ACK/NACK message containing a Final Ack Indicator,
2) PACKET CELL CHANGE NOTIFICATION, if such a message is waiting to be
transmitted,
3) (EGPRS) PACKET DOWNLINK ACK/NACK message containing a Channel Request
Description IE,
4) any other RLC/MAC control message, if such a message is waiting to be
transmitted, other than a (EGPRS) PACKET DOWNLINK ACK/NACK,
5) (EGPRS) PACKET DOWNLINK ACK/NACK message not containing a Final Ack
Indicator or a Channel Request Description IE.
However, the mobile station shall transmit an RLC/MAC control message other
than a (EGPRS) PACKET DOWNLINK ACK/NACK message at most every second time it
is polled for that TBF.
The mobile station shall not send a PACKET CONTROL ACKNOWLEDGEMENT message
unless otherwise specified.
In EGPRS TBF mode the mobile station shall react on a poll inside an
erroneously received RLC data block for which the header is correctly received
and which addresses the mobile station.
Whenever the network receives a valid RLC/MAC control message from the TBF, it
shall reset counter N3105. The network shall increment counter N3105 for each
radio block allocated to that TBF with the RRBP field, for which no RLC/MAC
control message is received. If N3105 = N3105max, the network shall release
the downlink TBF internally and start timer T3195 for that TBF. When T3195
expires, the network may reuse the TFI _._
The PACKET DOWNLINK ACK/NACK message contains a Channel Quality Report (see
3GPP TS 45.008). The optional I_LEVEL measurement results shall be included in
at least every other PACKET DOWNLINK ACK/NACK message.
The EGPRS PACKET DOWNLINK ACK/NACK message may contain an EGPRS Channel
Quality Report (see 3GPP TS 45.008).
In the case of simultaneous uplink and downlink TBFs, the transmission of the
polling response takes precedence over the transmission of allocated uplink
radio blocks.
A mobile station of multislot class 1 to 12 need not respond to the poll if it
is not compliant with the mobile station\'s multislot class (see 3GPP TS
45.002).
A mobile station of multislot class 13 to 18 shall always respond to the poll.
NOTE: The mobile station is required to make neighbour cell measurements while
transmitting the polling response (see 3GPP TS 45.008).
#### 8.2.3.4 Resource Reassignment for downlink
The network initiates downlink resource reassignment by sending a downlink
assignment message (e.g. PACKET DOWNLINK ASSIGNMENT, PACKET TIMESLOT
RECONFIGURE, MULTIPLE TBF DOWNLINK ASSIGNMENT or MULTIPLE TBF TIMESLOT
RECONFIGURE) to the mobile station on the PACCH.
If the mobile station has a TBF for which T3192 is running, the network may
choose to reallocate this existing TBF and reuse the TFI value for the new
data by setting the Control Ack bit to \'1\' as specified in 3GPP TS 44.060
sub-clauses 9.3.2.6 and 9.3.3.5.
On receipt of a downlink assignment message and after the TBF starting time,
if present, the mobile station shall switch to the assigned SBPSCHs. Upon
switching to the new SBPSCHs the mobile station shall restart timer T3190 for
each newly assigned downlink TBF.
When the mobile station receives an RLC/MAC block addressed to (one of) its
TBF(s) on any of the new assigned resources it shall restart timer T3190 for
the TBF. If timer T3190 expires, the mobile station shall perform an abnormal
release without retry (see sub-clause 8.7.1).
#### 8.2.3.5 Establishment of uplink TBF
##### 8.2.3.5.0 General
The mobile station initiates the packet access procedure by sending the Iu
mode Channel Request Description information element in the (EGPRS) PACKET
DOWNLINK ACK/NACK message on the PACCH and starting timer T3168 for each TBF
requested.
On receipt of an Iu mode Channel Request Description information element in
the (EGPRS) PACKET DOWNLINK ACK/NACK message, the network may assign radio
resources to the mobile station on one or more SBPSCHs by transmitting an
uplink assignment (e.g. PACKET UPLINK ASSIGNMENT, PACKET TIMESLOT RECONFIGURE,
MULTIPLE TBF UPLINK ASSIGNMENT or MULTIPLE TBF TIMESLOT RECONFIGURE) message
on the PACCH, or may reject the request by sending a PACKET ACCESS REJECT
message on the PACCH. If the PACKET TIMESLOT RECONFIGURE message is sent, then
the message shall contain the UPLINK_TFI_ASSIGNMENT field.
A mobile allocation or reference frequency list, when received in the
Frequency Parameters IE, as part of an uplink assignment, replaces the
previous parameters and shall be used until a new assignment is received or
the mobile station has released all TBFs.
On receipt of an uplink assignment message the mobile station shall follow the
procedure below. On reception of an uplink assignment message the mobile
station shall stop timer T3168 for each TBF assigned in the message.
The mobile station shall, after expiry of the TBF starting time, if present,
act upon the uplink assignment.
The mobile station shall then switch to the assigned uplink SBPSCHs and begin
to send RLC data blocks on the assigned SBPSCH(s). The G-RNTI shall not be
included in any of the uplink RLC data blocks.
On receipt of a PACKET ACCESS REJECT message that contains a Reject structure
addressed to the mobile station, the mobile station shall stop timer T3168 for
each TBF rejected in the PACKET ACCESS REJECT message and indicate a packet
access failure to the upper layer.
If the PACKET ACCESS REJECT message contains a WAIT_INDICATION field in a
Reject structure addressed to the mobile station, the mobile station shall
start timer T3172 for each TBF rejected with the indicated value (Wait
Indication). The mobile station is not allowed to make a new attempt for an
uplink TBF establishment in the same cell until all instances of timer T3172
expire, but it may attempt uplink TBF establishment in another cell after
successful cell reselection.
If timer T3168 expires for a TBF, the mobile station shall:
\- if the mobile station has no existing uplink TBF:
\- retransmit the Iu mode Channel Request Description information element in
the next (EGPRS) PACKET DOWNLINK ACK/NACK message unless the Iu mode Channel
Request Description has already been transmitted four times for that TBF in
which case the mobile station shall perform an abnormal release with access
retry (see sub-clause 8.8.3, 3GPP TS 44.060 sub-clause 8.7.2).
\- if the mobile station has at least one uplink TBF:
\- proceed with uplink TBF establishment as defined in sub-clause 8.2.2.1.2.
If the downlink TBF is released, including expiry of timer T3192, before
expiry of timer T3168, the mobile station shall stop timer T3168 for each TBF
and perform an abnormal release with access retry (see sub-clause 8.8.3, 3GPP
TS 44.060 sub-clause 8.7.2).
##### 8.2.3.5.1 Abnormal cases
In the following abnormal cases it is assumed that at least one downlink TBF
exists. The subsequent behaviour of the mobile station depends on the type of
failure and previous actions.
> \- If the information in the PACKET UPLINK ASSIGNMENT or MULTIPLE TBF UPLINK
> ASSIGNMENT message incorrectly specifies one or more uplink PDCHs, the
> mobile station shall perform an abnormal release with access retry of the
> uplink TBF(s) with erroneous assignments (see sub-clause 8.8.5). The mobile
> station shall act upon the valid assignments.
>
> \- If the information in the PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF
> TIMESLOT RECONFIGURE message incorrectly specifies one or more uplink and/or
> downlink PDCHs, the mobile station shall perform an abnormal release with
> access retry of the uplink TBF(s) with erroneous assignments (see sub-clause
> 8.8.5). The mobile station shall act upon the valid assignments.
>
> \- If the information in the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK
> ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE
> message violates the mobile station's multislot capabilities, the mobile
> station shall perform an abnormal release with access retry (see sub-clause
> 8.8.3).
\- If the mobile station receives a PACKET UPLINK ASSIGNMENT or MULTIPLE TBF
UPLINK ASSIGNMENT message containing different frequency parameters than are
currently in effect for its existing TBFs, the mobile station shall ignore the
PACKET UPLINK ASSIGNMENT or MULTIPLE TBF UPLINK ASSIGNMENT message, continue
normal operation of the existing TBFs, and reinitiate the establishment of the
new uplink TBFs unless the establishment of any of these TBFs has already been
attempted four times, in which case, the mobile station shall perform an
abnormal release with access retry (see sub-clause 8.8.3).
\- If a mobile station in MAC-DTM state receives a PACKET UPLINK ASSIGNMENT or
MULTIPLE TBF UPLINK ASSIGNMENT message including the Frequency Parameters
information element, the mobile station shall perform an abnormal release with
access retry (see sub-clause 8.8.3).
\- If an uplink TBF is not already established and the PACKET TIMESLOT
RECONFIGURE message does not include a UPLINK_TFI_ASSIGNMENT field, then the
mobile station shall perform an abnormal release with access retry (sub-clause
8.8.3).
\- If an uplink TBF is not already established and the MULTIPLE TBF TIMESLOT
RECONFIGURE message does not assign any uplink TBFs, then the mobile station
shall perform an abnormal release with access retry (sub-clause 8.8.3).
\- If the mobile station receives a PACKET UPLINK ASSIGNMENT, MULTIPLE TBF
UPLINK ASSIGNMENT PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT
RECONFIGURE message contains assignments such that more than one radio bearer
is mapped onto a TBF, then the mobile station shall perform an abnormal
release with access retry (see sub-clause 8.8.3).
> \- If the MULTIPLE TBF UPLINK ASSIGNMENT or MULTIPLE TBF TIMESLOT
> RECONFIGURE message does not specify a Channel Coding scheme for all of the
> uplink TBFs that it is assigning, then the mobile station shall perform an
> abnormal release with access retry of the uplink TBFs with erroneous
> assignments (see sub-clause 8.8.5). The mobile station shall act upon the
> valid assignments.
\- If the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK ASSIGNMENT, MULTIPLE
TBF TIMESLOT RECONFIGURE message assigns the same USF to more than one TBF on
the same timeslot, then the mobile station shall perform an abnormal release
with access retry (sub-clause 8.8.3).
\- If the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK ASSIGNMENT, PACKET
TIMESLOT RECONFIGURE, MULTIPLE TBF TIMESLOT RECONFIGURE message specifies a RB
Id that is not assigned to the mobile station, then the mobile station shall
perform an abnormal release with access retry (sub-clause 8.8.3).
> \- If the PACKET ACCESS REJECT message does not specify a G-RNTI_extension
> field in the Iu mode Reject structure for each G-RNTI included in the TLLI /
> G-RNTI field in the Reject structure, then the mobile station shall ignore
> the message.
\- If the PACKET ACCESS REJECT message includes one or more RB Id fields in
the Iu mode Reject structure which were not included by the mobile station in
the Iu mode Channel Request Description structure, then the mobile station
shall perform abnormal release with access retry (see sub-clause 8.8.3).- If a
mobile station in MAC-DTM state receives a PACKET TIMESLOT RECONFIGURE or
MULTIPLE TBF TIMESLOT RECONFIGURE message including the Frequency Parameters
information element, the mobile station shall perform an abnormal release with
access retry (see sub-clause 8.8.3).
\- If a failure in the PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK
ASSIGNMENT, PACKET TIMESLOT RECONFIGURE or MULTIPLE TBF TIMESLOT RECONFIGURE
message is due to any other reason, the mobile station shall perform an
abnormal release with access retry (see sub-clause 8.8.3).
#### 8.2.3.6 Network initiated abnormal release of downlink TBF
See 3GPP TS 44.060 sub-clause 8.1.2.8.
## 8.3 Packet PDCH Release
See 3GPP TS 44.060 sub-clause 8.2.
## 8.4 Procedure for measurement report sending in MAC-Shared state
See 3GPP TS 44.060 sub-clause 8.3.
## 8.5 Network Controlled cell reselection procedures in MAC-Shared state
See 3GPP TS 44.060 sub-clause 8.4.
## 8.6 Measurement Order procedures in MAC-Shared state
See 3GPP TS 44.060 sub-clause 8.5.
## 8.7 PACKET CONTROL ACKNOWLEDGEMENT
See 3GPP TS 44.060 sub-clause 8.6.
## 8.8 Abnormal cases
### 8.8.1 General
See 3GPP TS 44.060 sub-clause 8.7.0.
### 8.8.2 Abnormal release without retry
See 3GPP TS 44.060 sub-clause 8.7.1.
### 8.8.3 Abnormal release with access retry
The mobile station shall abort all TBFs in progress. The mobile station in
MAC-Shared state shall return to MAC-Idle state and initiate the establishment
of a new uplink TBF on SBPSCH(s), using the procedures on PCCCH, as defined in
sub-clause 7.2.
The mobile station in MAC-DTM state shall return to MAC-Dedicated state and
initiate the establishment of a new uplink TBF on SBPSCH(s) using DTM
procedures on SRB2, as defined in 3GPP TS 44.118.
In case the mobile station fails to establish a new uplink TBF on SBPSCH(s),
the mobile station shall report an RLC/MAC failure to upper layers. The DRX
mode procedures shall be applied, as specified in sub-clause 5.4.1.8.
### 8.8.4 Abnormal release with system information
See 3GPP TS 44.060 sub-clause 8.7.3.
### 8.8.5 Abnormal release of an Uplink TBF with access retry
The mobile station shall abort the uplink TBF.
If there are no remaining TBFs on SBPSCHs and the mobile station was in MAC-
Shared state, then it shall return to MAC-Idle state and reinitiate the
establishment of the uplink TBF on SBPSCH(s) using the procedures on PCCCH, as
defined in sub-clause 7.2. In the case that this TBF was not the last
remaining TBF on SBPSCHs, the mobile station shall reinitiate the
establishment of the TBF on SBPSCHs, using the procedures defined on PACCH, as
defined in sub-clauses 8.2.3 and 8.3.3.
If there are no remaining TBFs on SBPSCHs and the mobile station was in MAC-
DTM state, then it shall return to MAC-Dedicated state and initiate the
establishment of the uplink TBF on SBPSCH(s) using DTM procedures on SRB2, as
defined in 3GPP TS 44.118. In the case that this TBF was not the last
remaining TBF on SBPSCHs, the mobile station shall initiate the establishment
of the TBF on SBPSCHs, using the procedures defined on PACCH, as defined in
sub-clauses 8.2.3 and 8.3.3
In case the mobile station fails to establish the new uplink TBF on SBPSCH(s),
the mobile station shall report an RLC/MAC failure to upper layers. The DRX
mode procedures shall be applied, as specified in sub-clause 5.4.1.8.
### 8.8.6 Abnormal release of a Downlink TBF
The mobile station shall abort the downlink TBF.
If there are no remaining TBFs on SBPSCHs and the mobile station was in MAC-
Shared state, then it shall return to MAC-Idle state.
If there are no remaining TBFs on SBPSCHs and the mobile station in MAC-DTM
state, then it shall return to MAC-Dedicated state.
If there is a TBF remaining on SBPSCHs, then the mobile station shall remain
in its current state.
The DRX mode procedures shall be applied as specified in sub-clause 5.5.1.5,
3GPP TS 44.160 sub-clause 5.4.1.8.
## 8.9 Network Assisted Cell Change procedures in MAC-Shared state
See 3GPP TS 44.060 sub-clause 8.8.
# 9 Medium Access Control (MAC) procedures on DBPSCH
## 9.1 General
The MAC procedures defined in this sub-clause are applicable in MAC-Dedicated
state and in MAC-DTM state on DBPSCH only. When a radio bearer is set-up on
DBPSCH(s) (see 3GPP TS 44.118) the corresponding TBF is implicitly
established, on this DBPSCH(s), on the logical channel (when FLO is not used)
on which this TBF is mapped. This TBF shall use the TBF mode as specified in
sub-clause 5.2.2.2 and according to the radio bearer attributes as may be
indicated in the CMAC-CONFIG primitive received from RRC.
## 9.2 Transfer of RLC/MAC blocks
### 9.2.0 General
Tables 9.2.0.1 to 9.2.0.3 summarise the RLC/MAC control messages that may be
sent on a DBPSCH.
Table 9.2.0.1: RLC/MAC control messages sent on PACCH or ADCH when mapped on
DBPSCH
* * *
RLC messages: Reference Packet Downlink Ack/Nack 3GPP TS 44.060 sub-clause
11.2.6 EGPRS Packet Downlink Ack/Nack 3GPP TS 44.060 sub-clause 11.2.6a Packet
DBPSCH Downlink Ack/Nack Type 2 3GPP TS 44.060 sub-clause 11.2.6b Packet
Uplink Ack/Nack 3GPP TS 44.060 sub-clause 11.2.28 Packet DBPSCH Uplink
Ack/Nack Type 2 3GPP TS 44.060 sub-clause 11.2.28a Miscellaneous messages:
Reference Packet Control Acknowledgement 3GPP TS 44.060 sub-clause 11.2.2
Packet Downlink Dummy Control Block 3GPP TS 44.060 sub-clause 11.2.8 Packet
Uplink Dummy Control Block 3GPP TS 44.060 sub-clause 11.2.8b Packet Polling
Request 3GPP TS 44.060 sub-clause 11.2.12 Packet Uplink Assignment 3GPP TS
44.060 sub-clause 11.2.29 Handover Access 3GPP TS 44.060 sub-clause 11.2.33
Physical Information 3GPP TS 44.060 sub-clause 11.2.34
* * *
Table 9.2.0.2: RLC/MAC control messages on SDCCH, SACCH,\ FACCH (PT=\"01\")
* * *
RLC messages: Reference Packet DBPSCH Downlink Ack/Nack 3GPP TS 44.060 sub-
clause 11.2.6b Packet DBPSCH Uplink Ack/Nack 3GPP TS 44.060 sub-clause
11.2.28a Miscellaneous messages: Reference Packet Control Acknowledgement 3GPP
TS 44.060 sub-clause 11.2.2 Packet Downlink Dummy Control Block 3GPP TS 44.060
sub-clause 11.2.8 Packet Uplink Dummy Control Block 3GPP TS 44.060 sub-clause
11.2.8b Handover Access 3GPP TS 44.060 sub-clause 11.2.33 Physical Information
(not on SACCH) 3GPP TS 44.060 sub-clause 11.2.34
* * *
Table 9.2.0.3: RLC/MAC control messages on FACCH (PT=\"10\")
* * *
RLC messages: Reference Packet DBPSCH Downlink Ack/Nack 3GPP TS 44.060 sub-
clause 11.2.6b Packet DBPSCH Uplink Ack/Nack 3GPP TS 44.060 sub-clause
11.2.28a Miscellaneous messages: Reference Packet Control Acknowledgement 3GPP
TS 44.060 sub-clause 11.2.2
* * *
### 9.2.1 Dedicated allocation
#### 9.2.1.1 General
On DBPSCH, the transfer of RLC/MAC blocks is governed by the principles of the
dedicated allocation. Dedicated allocation is applicable to GPRS TBF mode,
EGPRS TBF mode, TCH TBF mode, DCCH TBF mode, UDCH TBF mode and CDCH TBF mode.
No other medium access mode shall apply for TCH TBF mode, DCCH TBF mode, UDCH
TBF mode and CDCH TBF mode.
A mobile station in dedicated allocation shall monitor the assigned DBPSCH(s).
The mobile station shall attempt to decode every downlink RLC/MAC block on the
assigned DBPSCH(s). Whenever the mobile station receives an RLC/MAC block
containing an RLC/MAC control block, the mobile station shall attempt to
interpret the message contained therein and act upon it.
Except for TCH TBF mode in T-RLC mode, PACKET UPLINK DUMMY CONTROL block(s)
(respectively PACKET DOWNLINK DUMMY CONTROL block(s)) shall be sent in periods
when no RLC/MAC block is scheduled for transmission in uplink direction
(respectively downlink direction, following the scheduling requirements
defined in 3GPP TS 45.008). For TCH TBF mode and UDCH TBF mode in T-RLC mode,
DTX may apply.
#### 9.2.1.2 Performance requirements for TCH and DCCH TBF modes
When the mobile station receives a DBPSCH assignment, the mobile station shall
switch to the assigned DBPSCH(s) and be ready to transmit within the reaction
time defined in 3GPP TS 45.010.
The network (NW) and the mobile station (MS) shall follow the performance
requirements defined in the table below. These performance requirements are
given on a logical channel and MAC state basis, and define the response time
of the network and the mobile station upon receipt of a request from the
remote peer entity, where:
\- Trmin and Tresp denote respectively the minimum and maximum response times
following the reception of a given request, expressed in TDMA frames, as
follows:
\- if a polling request is received whose last burst has been physically
transmitted in the TDMA frame number FNcomm, then the first burst carrying a
segment of the corresponding response shall be physically transmitted in the
TDMA frame number FNresp where:
FNcomm + Trmin + 1 ≤ FNresp ≤ FNcomm + Tresp +1
\- following the mapping of logical channels onto physical channels and the
arithmetics on TDMA frame numbers specified in 3GPP TS 45.002.
Table 9.2.1.2.1: Response time
+-------------+-------------+-------------+-------------+-------------+ | Request | Response | Trmin | Tresp (see | | | sent on | sent on | | note 1) | | +-------------+-------------+-------------+-------------+-------------+ | | | | MA | MAC-DTM | | | | | C-Dedicated | state | | | | | state | | +-------------+-------------+-------------+-------------+-------------+ | SDCCH | SDCCH | MS: 11 | MS: 113 | Not | | | | | | applicable | | | | NW: | NW: | | | | | T | T | | | | | RMIN_SDCCH | RESP_SDCCH | | | | | (32 or 83) | (134 or | | | | | | 185, | | | | | | re | | | | | | spectively) | | +-------------+-------------+-------------+-------------+-------------+ | SACCH | SACCH | MS: 11 | MS: 11 | | | | | | | | | | | NW: 83 | NW: 83 | | +-------------+-------------+-------------+-------------+-------------+ | SACCH | SACCH | MS: 25 | MS: 129 | MS: 25 | | | | | | | | (with a TCH | (with a TCH | NW: | NW: | NW: | | or PDTCH) | or PDTCH) | T | T | T | | | | RMIN_SACCH | RESP_SACCH | RMIN_SACCH | | | | (25 or 129) | (129 or | | | | | | 233, | | | | | | re | | | | | | spectively) | | +-------------+-------------+-------------+-------------+-------------+ | FACCH/Full | FACCH/Full | MS: 9 | MS: 18 (max | MS: 14 (max | | rate | rate | | between 18 | between 13 | | | | NW: TRMIN | and 17) | and 14) | | | | | | | | | | | NW: | NW: | | | | | TRESP_MAC | TRES | | | | | _Dedicated | P_MAC_DTM | +-------------+-------------+-------------+-------------+-------------+ | TCH/Full | FACCH/Full | MS: 9 | MS: 18 (max | MS: 14 (max | | rate | rate | | between 18 | between 13 | | | | NW: TRMIN | and 17) | and 14) | | | | | | | | | | | NW: | NW: | | | | | TRESP_MAC | TRES | | | | | _Dedicated | P_MAC_DTM | +-------------+-------------+-------------+-------------+-------------+ | FACCH/Half | FACCH/Half | MS: 10 | MS: 28 (max | MS: 19 (max | | rate | rate | | between 28 | between 18 | | | | NW: TRMIN | and 27) | and 19) | | | | | | | | | | | NW: | NW: | | | | | TRESP_MAC | TRES | | | | | _Dedicated | P_MAC_DTM | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | these | | | | | | values | | | | | | account for | | | | | | the maximum | | | | | | amount of | | | | | | Radio | | | | | | Bearers | | | | | | multiplexed | | | | | | on a given | | | | | | logical | | | | | | channel, | | | | | | and the | | | | | | priorities | | | | | | of | | | | | | associated | | | | | | RLC/MAC | | | | | | blocks. For | | | | | | FACCH, it | | | | | | also | | | | | | accounts | | | | | | for the | | | | | | RLC/MAC | | | | | | control | | | | | | signalling | | | | | | related to | | | | | | the traffic | | | | | | on the TCH. | | | | | | | | | | | | NOTE 2: The | | | | | | combination | | | | | | TCH/H -- | | | | | | FACCH/H is | | | | | | not | | | | | | supported. | | | | | | | | | | | | NOTE 3: | | | | | | \"max | | | | | | between n | | | | | | and m\" is | | | | | | to account | | | | | | for the | | | | | | shift of | | | | | | the start | | | | | | of the | | | | | | FACCH block | | | | | | where the | | | | | | response is | | | | | | sent, that | | | | | | occurs | | | | | | depending | | | | | | on the end | | | | | | of the | | | | | | TCH/FACCH | | | | | | block where | | | | | | the request | | | | | | was sent. | | | | | | (due to a | | | | | | different | | | | | | number of | | | | | | idle/SACCH | | | | | | frames | | | | | | included in | | | | | | the | | | | | | counts). | | | | | +-------------+-------------+-------------+-------------+-------------+
#### 9.2.1.3 Performance requirements for UDCH and CDCH TBF modes
On a DBPSCH where FLO is used, the network (NW) and the mobile station (MS)
shall follow the performance requirements defined in the table below. These
performance requirements are given on a transport channel and MAC state basis,
and define the response time of the network and the mobile station upon
receipt of a request from the remote peer entity, where:
\- Trmin and Tresp denote respectively the minimum and maximum response times
following the reception of a given request, expressed in TDMA frames, as
follows:
\- if a polling request is received whose last burst has been physically
transmitted in the TDMA frame number FNcomm, then the first burst carrying a
segment of the corresponding response shall be physically transmitted in the
TDMA frame number FNresp where:
FNcomm + Trmin + 1 ≤ FNresp ≤ FNcomm + Tresp +1
\- following the mapping of transport channels onto physical channels and the
arithmetics on TDMA frame numbers specified in 3GPP TS 45.002.
Table 9.2.1.3.1: Response time
+-------------+-------------+-------------+-------------+-------------+ | Request | Response | Trmin | Tresp (see | | | sent on | sent on | | note 1) | | +-------------+-------------+-------------+-------------+-------------+ | | | | MA | MAC-DTM | | | | | C-Dedicated | state | | | | | state | | +-------------+-------------+-------------+-------------+-------------+ | UDCH/Full | ADCH/Full | MS: 9 | MS: 31 (max | MS: 27 (max | | rate | rate | | between 31 | between 27 | | | | NW: | and 30) | and 26) | | | | TRMIN_DCH | | | | | | | NW: | NW: | | | | | TRES | TRESP_DC | | | | | P_DCH_MAC | H_MAC_DTM | | | | | _Dedicated | | +-------------+-------------+-------------+-------------+-------------+ | CDCH/Full | ADCH/Full | | | | | rate | rate | | | | +-------------+-------------+-------------+-------------+-------------+ | ADCH/Full | ADCH/Full | | | | | rate | rate | | | | +-------------+-------------+-------------+-------------+-------------+ | UDCH/Half | ADCH/Half | MS: 10 | MS: 54 (max | MS: 45 (max | | rate | rate | | between 54 | between 45 | | | | NW: | and 53) | and 44) | | | | TRMIN_DCH | | | | | | | NW: | NW: | | | | | TRES | TRESP_DC | | | | | P_DCH_MAC | H_MAC_DTM | | | | | _Dedicated | | +-------------+-------------+-------------+-------------+-------------+ | CDCH/Half | ADCH/Half | | | | | rate | rate | | | | +-------------+-------------+-------------+-------------+-------------+ | ADCH/Half | ADCH/Half | | | | | rate | rate | | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | these | | | | | | values | | | | | | account for | | | | | | the maximum | | | | | | amount of | | | | | | Radio | | | | | | Bearers | | | | | | multiplexed | | | | | | on DBPSCH, | | | | | | and the | | | | | | priorities | | | | | | of | | | | | | associated | | | | | | RLC/MAC | | | | | | blocks. For | | | | | | ADCH, it | | | | | | also | | | | | | accounts | | | | | | for the | | | | | | RLC/MAC | | | | | | control | | | | | | signalling | | | | | | related to | | | | | | TBFs in | | | | | | CDCH or | | | | | | UDCH TBF | | | | | | modes. | | | | | | | | | | | | NOTE 2: | | | | | | \"max | | | | | | between n | | | | | | and m\" is | | | | | | to account | | | | | | for the | | | | | | shift of | | | | | | the start | | | | | | of the | | | | | | FACCH block | | | | | | where the | | | | | | response is | | | | | | sent, that | | | | | | occurs | | | | | | depending | | | | | | on the end | | | | | | of the | | | | | | TCH/FACCH | | | | | | block where | | | | | | the request | | | | | | was sent. | | | | | | (due to a | | | | | | different | | | | | | number of | | | | | | idle/SACCH | | | | | | frames | | | | | | included in | | | | | | the | | | | | | counts). | | | | | | | | | | | | NOTE 3: | | | | | | these | | | | | | r | | | | | | equirements | | | | | | are valid | | | | | | for both | | | | | | i | | | | | | nterleaving | | | | | | a | | | | | | lternatives | | | | | | i.e. 20ms | | | | | | and 40ms. | | | | | +-------------+-------------+-------------+-------------+-------------+
### 9.2.2 Transfer of RLC/MAC blocks on TCH
One and only one TBF in TCH TBF mode may be mapped onto a TCH.
No RLC/MAC control blocks shall be sent on TCH. RLC/MAC control blocks
belonging to a TBF in TCH TBF mode operating in NT-RLC mode shall be sent on
FACCH with Payload Type (PT) = \"10\". No RLC/MAC control block shall be sent
on FACCH if the corresponding TCH is occupied by a TBF operating in T-RLC mode
unless this RLC/MAC control block belongs to a TBF in DCCH TBF mode mapped on
this FACCH or carries a PHYSICAL INFORMATION message. The HANDOVER ACCESS
message shall be sent on FACCH irrespective of the TBF mapped on TCH,
following the rules defined in sub-clause 9.2.3.
An RLC/MAC control block carrying a PHYSICAL INFORMATION message on FACCH
shall be sent with Payload Type (PT) = "01".
RLC/MAC blocks shall be transmitted with the following priority (highest
priority first):
\- RLC/MAC blocks on FACCH, except Packet Uplink/Downlink Dummy Control
Blocks;
\- RLC data blocks on TCH;
\- RLC/MAC control blocks on FACCH containing Packet Uplink/Downlink Dummy
Control Blocks.
### 9.2.3 Transfer of RLC/MAC blocks on FACCH, SACCH and SDCCH
A TBF associated with a URB may operate in DCCH TBF mode but shall not be
mapped on SACCH.
On SACCH, MAC shall ensure the following as long as there is data to send for
SRB1, and SRB3 and/or SRB4:
\- every second RLC/MAC block sent on SACCH shall belong to SRB1, and the
other to SRB3 or SRB4, and
\- every second RLC/MAC block belonging to SRB1 shall be discarded, the other
shall be sent on SACCH.
All RLC data blocks belonging to a TBF in DCCH TBF mode shall be encoded using
CS-1.
The mobile station shall attempt to decode every downlink RLC/MAC block on
FACCH, SACCH or SDCCH. Whenever the mobile station receives an RLC/MAC block
containing an RLC/MAC control block, the mobile station shall attempt to
interpret the message contained therein, and shall act on it.
Each RLC data block sent on FACCH, SACCH or SDCCH shall contain a Reduced
Radio Bearer identity (RRBid) field corresponding to the radio bearer to which
the RLC data block belongs.
On SDCCH, all the RLC data blocks of an uplink TBF shall each contain a G-RNTI
field in the RLC data block header until contention resolution is completed on
the mobile station side (see sub-clause 7.2.3.3.2.3). After the reaction time
specified in 3GPP TS 45.010 no other RLC data blocks shall contain a G-RNTI
field, except for those retransmitted RLC data blocks that originally
contained a G-RNTI, which will be repeated including the same G-RNTI.
RLC/MAC blocks and HANDOVER ACCESS message shall be transmitted with the
following priority (highest priority first):
\- HANDOVER ACCESS message
\- RLC/MAC control blocks with a Payload Type (PT) = \"01\" i.e. related to a
TBF in DCCH TBF mode or carrying a PHYSICAL INFORMATION message, except Packet
Uplink/Downlink Dummy Control blocks;
\- RLC data blocks containing a piggy-backed acknowledgement;
\- RLC/MAC control blocks with a Payload Type (PT) = \"10\" i.e. related to a
TBF in TCH TBF mode, except Packet Uplink/Downlink Dummy Control blocks;
\- RLC data blocks not containing a piggy-backed acknowledgement;
\- RLC/MAC control blocks containing Packet Uplink/Downlink Dummy Control
Blocks.
### 9.2.4 Transfer of RLC/MAC blocks on PDTCH and PACCH
#### 9.2.4.1 General
##### 9.2.4.1.1 Downlink transfer
###### 9.2.4.1.1.1 General
RLC/MAC blocks shall be transmitted in the downlink with the following
priority (highest priority first):
\- RLC/MAC control blocks except Packet Downlink Dummy Control blocks;
\- RLC data blocks;
\- RLC/MAC control blocks containing Packet Downlink Dummy Control Blocks.
If the network has no other RLC/MAC block to transmit, but wishes to transmit
on the downlink (e.g. to provide USF), the network shall transmit an RLC/MAC
control block containing a Packet Downlink Dummy Control block.
###### 9.2.4.1.1.2 Polling for Packet Downlink Ack/Nack
Whenever the mobile station receives an RLC data block addressed to (one of)
its TBF(s) with a valid RRBP field in the RLC data block header (i.e. is
polled), the mobile station may transmit a (EGPRS) Packet Downlink ACK/NACK
message in the uplink radio block specified by the RRBP field whatever the BSN
value of the received RLC data block, unless another RLC/MAC control message
is waiting to be transmitted, in which case the other RLC/MAC control message
shall be sent. The mobile station shall transmit an RLC/MAC control message
other than a (EGPRS) PACKET DOWNLINK ACK/NACK message at most every second
time it is polled for that TBF. Furthermore the mobile station shall not
transmit an RLC/MAC control message on this TBF other than a (EGPRS) PACKET
DOWNLINK ACK/NACK message if the (EGPRS) PACKET DOWNLINK ACK/NACK message
contains a Final Ack Indicator set to '1' and shall not start T3192. The
mobile station shall not send a PACKET CONTROL ACKNOWLEDGEMENT message unless
otherwise specified (see sub-clause 9.3).The mobile station shall not send the
Iu mode channel request description field in the (EGPRS) PACKET DOWNLINK
ACK/NACK message.
In EGPRS TBF mode the mobile station shall react on a poll inside an
erroneously received RLC data block for which the header is correctly
received.
Whenever the network receives a valid RLC/MAC control message from the TBF, it
shall reset counter N3105. The network shall increment counter N3105 for each
radio block allocated to that TBF with the RRBP field, for which no RLC/MAC
control message is received. If N3105 = N3105max, the network shall start
timer T3195. When T3195 expires, the network shall notify a link failure to
the RRC layer.
The PACKET DOWNLINK ACK/NACK message contains a Channel Quality Report (see
3GPP TS 45.008). The optional I_LEVEL measurement results shall be included in
at least every other PACKET DOWNLINK ACK/NACK message.
The EGPRS PACKET DOWNLINK ACK/NACK message may contain an EGPRS Channel
Quality Report (see 3GPP TS 45.008).
In the case of simultaneous uplink and downlink TBFs, the transmission of the
polling response takes precedence over the transmission of allocated uplink
radio blocks.
A mobile station of multislot class 1 to 12 need not respond to the poll if it
is not compliant with the mobile station\'s multislot class (see 3GPP TS
45.002).
A mobile station of multislot class 13 to 18 shall always respond to the poll.
##### 9.2.4.1.2 Uplink transfer
###### 9.2.4.1.2.1 General
RLC/MAC blocks and HANDOVER ACCESS message shall be transmitted with the
following priority (highest priority first):
\- HANDOVER ACCESS message
\- RLC/MAC control blocks except Packet Uplink Dummy Control blocks;
\- RLC data blocks;
> \- RLC/MAC control blocks containing Packet Uplink Dummy Control Blocks.
Uplink TBFs are scheduled with USF. USF is assigned as described in sub-clause
9.2.4.1.2.2.
Whenever the mobile station detects an assigned USF value on an assigned
DBPSCH, the mobile station shall transmit either a single RLC/MAC block or a
sequence of four RLC/MAC blocks on the same DBPSCH and, in case there are more
DBPSCHs assigned in uplink than in downlink, also on all higher numbered
assigned DBPSCHs. The time relation between an uplink block, which the mobile
station shall use for transmission, and the occurrence of the USF value is
defined in 3GPP TS 45.002. The number of RLC/MAC blocks to transmit is
controlled by the USF_GRANULARITY parameter characterising the uplink TBF.
When the mobile station transmits an RLC/MAC block to the network, it shall
start timer T3180 for the uplink TBF on which the block was sent. When the
mobile station detects an assigned USF value on an assigned DBPSCH for the
TBF, the mobile station shall restart timer T3180. If timer T3180 expires, the
mobile station shall notify a link failure to the RRC layer.
Whenever the network receives a valid RLC/MAC block from the TBF, it shall
reset counter N3101. The network shall increment counter N3101 for each radio
block, allocated to that TBF, for which no data is received. If N3101 =
N3101max, the network shall stop the scheduling of RLC/MAC blocks from the TBF
and start timer T3169. When T3169 expires, the network shall notify a link
failure to the RRC layer.
The mobile station shall attempt to decode every downlink RLC/MAC block on all
assigned DBPSCHs. Whenever the mobile station receives an RLC/MAC block
containing an RLC/MAC control block, the mobile station shall attempt to
interpret the message contained therein and act on the message.
Whenever the mobile station detects an assigned USF value on any assigned
DBPSCH, the mobile station may transmit a PACCH block on the same DBPSCH in
the next block period (see 3GPP TS 45.002). The mobile station shall not
transmit an RLC data block in any uplink radio block allocated via the polling
mechanism (see 3GPP TS 44.060 sub-clause 10.4.4).
In case there are more DBPSCHs assigned in uplink than in downlink, the
network shall transmit all PACCH messages on the DBPSCH carried on the lowest
numbered timeslot in the allocation.
###### 9.2.4.1.2.2 On receipt of a Packet Uplink Assignment message
The USF of a TBF belonging to a URB is initially assigned by RRC using radio
bearer control procedures (see 3GPP TS 44.118). The USF of a TBF belonging to
a SRB is assigned by RLC/MAC.
The network may send a PACKET UPLINK ASSIGNMENT message to the mobile station
on the PACCH on DBPSCH addressing a particular TBF on DBPSCH (identified in
the Global_TFI field) in order to:
\- assign a USF to this TBF only in case this TBF does not already have any
assigned USF and/or to
\- change one or more of the following parameters of this TBF: (EGPRS) channel
coding command field, resegment bit, BEP_PERIOD2 field. All other parameters
may only be changed through radio bearer control procedures (see 3GPP TS
44.118)
The network shall include a valid RRBP field in the RLC/MAC control block
header and clear counter N3105.
In case the mobile station receives a PACKET UPLINK ASSIGNMENT message on
PACCH (DBPSCH) addressing a particular uplink TBF on DBPSCH (identified in the
Global_TFI field), the mobile station shall only act on the following fields:
\- USF granularity and USF value per timeslot fields in the message (see 3GPP
TS 44.060) if the mobile station does not already have a USF assigned to this
TBF,
\- starting time (if included),
\- (EGPRS) Channel coding command,
\- Resegment bit (if included), and
\- BEP_PERIOD2 field (if included) and ignore other fields.
When the mobile station receives an uplink assignment that does not contain a
TBF starting time, the mobile station shall begin to use the newly assigned
parameters immediately for this TBF. If a TBF starting time information
element is present the mobile station shall wait until the starting time
before beginning to use these parameters for this TBF. If while waiting for
the frame number indicated by the TBF starting time the mobile station
receives another uplink assignment for the same TBF, the mobile station shall
act upon the most recently received uplink assignment and shall ignore the
previous uplink assignment.
When the mobile station receives the PACKET UPLINK ASSIGNMENT message, it
shall transmit the PACKET CONTROL ACKNOWLEDGEMENT message in the radio block
indicated by the RRBP field.
If the network does not receive the PACKET CONTROL ACKNOWLEDGEMENT message in
the radio block indicated by the RRBP field, it shall increment counter N3105
and retransmit the PACKET UPLINK ASSIGNMENT message. If counter N3105 exceeds
its limit, the network shall stop scheduling new uplink resources for the TBF,
stop sending the PACKET UPLINK ASSIGNMENT message to the mobile station and
start timer T3195.
When timer T3195 expires the network shall notify a link failure to the RRC
layer.
###### 9.2.4.1.2.3 Release of the USF
The network may initiate the release of the USF of a particular TBF by sending
a PACKET UPLINK ACK/NACK message with the Final Ack Indicator set to \'1\'.
The network shall include a valid RRBP field in the RLC/MAC control block
header and clear counter N3103. The release of the USF, using this procedure,
may be initiated at a point determined by the network.
If the mobile station receives a PACKET UPLINK ACK/NACK message with the Final
Ack Indicator bit set to \'1\', it shall transmit a PACKET CONTROL
ACKNOWLEDGEMENT message in the radio block indicated by the RRBP field and
release the USF.
When the network receives the PACKET CONTROL ACKNOWLEDGEMENT message in the
radio block indicated by the RRBP field, it may reuse the USF resource.
If the network does not receive the PACKET CONTROL ACKNOWLEDGEMENT message in
the radio block indicated by the RRBP field, it shall increment counter N3103
and retransmit the PACKET UPLINK ACK/NACK message. If counter N3103 exceeds
its limit, the network shall stop scheduling new uplink resources for the TBF,
stop sending the PACKET UPLINK ACK/NACK message to the mobile station and
start timer T3169.
When timer T3169 expires the network shall notify a link failure to the RRC
layer.
#### 9.2.4.2 Scheduling an inactive TBF on a DBPSCH
When a previously inactive TBF (i.e. for which the latest transmitted CV was
equal to 0 and for which no USF is assigned) has data to send, the mobile
station shall send one RLC data block for this TBF the next time the network
schedules any of the mobile station\'s TBFs using the assigned USFs. This TBF
shall be considered inactive until a USF is assigned to it. This RLC data
block shall not be sent in a block that has been reserved for sending a
RLC/MAC control message via the RRBP field. On sending a RLC data block on a
radio block that has been stolen by this mechanism, the mobile station start
timer T3194 for the associated radio bearer. The mobile station shall stop
timer T3194 on receipt of the USF for this radio bearer (see sub-clause
9.2.4.1.2.2). The mobile station shall be able to steal further blocks from
any of its scheduled TBFs, provided that no more than one block is stolen for
a particular radio bearer during an interval defined by the duration of timer
T3194. On expiry of timer T3194 the mobile station shall restart the timer
unless it has expired four times, in which case the mobile station shall
notify a link failure to the RRC layer.
#### 9.2.4.3 Further USF handling
If the mobile station has more than one active TBF with data to send, the
mobile station shall send data for the TBF corresponding to the received USF,
with the exception given in sub-clause 9.2.4.2. If the mobile station has no
data to send for the scheduled TBF (i.e. no RLC data block or no RLC/MAC
control message other than PACKET UPLINK DUMMY CONTROL BLOCK message), and if
the MS has data to send for one or more other TBFs mapped onto the same
DBPSCH, the mobile station may send data from one of these other TBFs.
If the mobile station has only one TBF with data to send, the mobile station
shall ignore the USF and shall transmit data for this TBF.
### 9.2.5 Transfer of RLC/MAC blocks on UDCH, CDCH and ADCH
#### 9.2.5.1 General
On the DBPSCH(s) where FLO is used, the transfer of RLC/MAC blocks on
transport channels shall follow the rules below:
\- RLC/MAC blocks for data transfer belonging to a SRB shall only be sent on
CDCH, with Payload Type = '00';
\- RLC/MAC blocks for data transfer belonging to a URB operating in NT-RLC
mode shall only be sent on UDCH, with Payload Type = '01';
\- RLC/MAC blocks for data transfer belonging to a URB operating in T-RLC mode
shall only be sent on UDCH. No RLC/MAC overhead is used (see sub-clauses
12.8b.1.3 and 12.8b.2.3);
\- RLC/MAC blocks for control message transfer shall only be sent on ADCH,
with Payload Type = '10'.
RLC/MAC blocks shall be transmitted with the following priority (highest
priority first):
\- HANDOVER ACCESS message;
\- RLC/MAC blocks for control message transfer on ADCH, except Packet
Uplink/Downlink Dummy Control blocks;
\- RLC/MAC blocks for SRB data transfer on CDCH containing a piggy-backed
acknowledgement;
\- RLC/MAC blocks for SRB data transfer on CDCH not containing a piggy-backed
acknowledgement;
\- RLC/MAC blocks for URB data transfer on UDCH;
\- RLC/MAC blocks for control message transfer on ADCH containing Packet
Uplink/Downlink Dummy Control blocks.
In addition, on DBPSCH/H where FLO is used, the transfer of RLC/MAC blocks on
transport channels shall follow the rule below:
\- Every RLC/MAC block for data transfer belonging to a SRB shall be sent
twice in a row. The first and second transport blocks used for the RLC/MAC
block shall be sent with the signalling TFC.
\- Every RLC/MAC block for control message transfer shall be sent twice in a
row. The first and second transport blocks used for the RLC/MAC block shall be
sent with the signalling TFC. In case ciphering is used, the RLC/MAC block
shall only be ciphered with the parameters used with the first transport
block, in both transport blocks.
The mobile station shall attempt to decode every downlink RLC/MAC block on
DBPSCH. Whenever the mobile station receives an RLC/MAC block containing an
RLC/MAC control block, the mobile station shall attempt to interpret the
message contained therein, and shall act on it.
#### 9.2.5.2 Transport format combination (TFC) selection
##### 9.2.5.2.1 General requirements
On each DBPSCH where FLO is used, the MAC layer shall select a TF for each
TrCH within the TFS configured by RRC for each TrCH so that the resulting TFC
belongs to the TFCS configured by RRC.
For RLC/MAC block for data transfer belonging to a TBF in CDCH TBF mode, the
MAC layer shall always select the signalling TFC(s) specified in 3GPP TS
44.118.
For RLC/MAC block for data transfer belonging to a TBF in UDCH TBF mode, the
MAC layer shall select a TF within the TFS of the TrCH on which the
corresponding radio bearer is mapped. It shall not select a TF that does not
belong to this TFS.
For RLC/MAC block for control message transfer, the MAC layer shall always
select the signalling TFC specified in 3GPP TS 44.118.
##### 9.2.5.2.2 Downlink
The selection of the TFC in the downlink is left up to network implementation.
The network shall follow the requirements defined in sub-clause 9.2.5.2.1.
##### 9.2.5.2.3 Uplink
The mobile station shall be notified of the highest allowed TFC in the TFCS,
that may be used for uplink transmission. The mobile station shall not select
any TFC of which the TFCI is higher than the TFCI of the highest allowed TFC.
If no highest allowed TFC is notified to the mobile station, the highest
allowed TFC shall be the highest TFC in the TFCS. All the TFCs up to and
including the highest allowed TFC are valid TFCs. All other TFCs are invalid.
Every TTI, the mobile station shall select a valid TFC as follows:
\- No other TFC shall allow the transmission of more highest priority data
than the selected TFC
\- No other TFC shall allow the transmission of more data from the next lower
priority TBF. This shall be applied for each TBF for the remaining priority
levels.
#### 9.2.5.3 Polling for PACKET DBPSCH DOWNLINK ACK/NACK TYPE 2
Upon receipt by the mobile station of a polling request within an RLC/MAC
block for data transfer, the mobile station shall send a PACKET DBPSCH
DOWNLINK ACK/NACK TYPE 2 message within the next possible uplink occurrence on
ADCH, following the requirements defined in sub-clause 9.2.1.3.
## 9.3 PACKET CONTROL ACKNOWLEDGEMENT
Upon receipt by the mobile station of a polling request (see sub-clauses
12.7.4 and 12.9.3) within an RLC/MAC control message sent on a given logical
channel, the mobile station shall send a corresponding PACKET CONTROL
ACKNOWLEDGEMENT message within the next possible uplink occurrence on the same
logical channel or ADCH (FLO only). The PACKET CONTROL ACKNOWLEDGEMENT message
shall be formatted using the normal burst format. The next possible uplink
occurrence is defined following the rules below:
\- If the RLC/MAC control message is received on PACCH with a valid RRBP field
as part of this RLC/MAC control message, the mobile station shall transmit a
PACKET CONTROL ACKNOWLEDGEMENT message in the uplink radio block specified
(see 3GPP TS 44.060 sub-clause 10.4.5)
\- Otherwise, the mobile station shall send the PACKET CONTROL ACKNOWLEDGEMENT
message following the requirements defined in sub-clauses 9.2.1.2 and 9.2.1.3,
considering the PACKET CONTROL ACKNOWLEDGEMENT message has higher priority
than any other RLC/MAC control messages, and any RLC data block. Upon
reception by the network of a PACKET CONTROL ACKNOWLEDGEMENT message that does
not target a specific RLC entity, within the requirements defined in sub-
clauses 9.2.1.2 and 9.2.1.3, the network shall reset counter N3105. If the
network does not receive a PACKET CONTROL ACKNOWLEDGEMENT message before the
response time specified in sub-clauses 9.2.1.2 and 9.2.1.3, it shall increment
counter N3105. If counter N3105=N3105max, the network shall indicate a link
failure to the RRC layer.
## 9.3a Handover Access and Physical Information
### 9.3a.1 Handover Access
During a handover, upon trigger from RRC through the HANDOVER-Req primitive,
the mobile station shall send a HANDOVER ACCESS message containing the
necessary handover reference value (see sub-clause 4.3.4) to the network on
either FACCH, PACCH (on DBPSCH), ADCH (FLO only) or SDCCH. While the HANDOVER
ACCESS message is being sent on FACCH, PACCH (on DBPSCH) , ADCH (FLO only) or
SDCCH, the mobile station may send additional HANDOVER ACCESS messages on
SACCH. In this case, the HANDOVER ACCESS message may be sent on any TDMA frame
block (Bn) belonging to the allocated SACCH (see 3GPP TS 45.002). The mobile
station shall not send any HANDOVER ACCESS message on SACCH if no HANDOVER
ACCESS message is being sent on FACCH, PACCH, ADCH (FLO only) or SDCCH.
Upon reception of a HANDOVER ACCESS message by the network, the RRC shall be
notified through the HANDOVER-Ind primitive (see sub-clause 4.3.4) and the
network shall then proceed as specified in 3GPP TS 44.118.
In case of non-synchronized cells (see 3GPP TS 44.118), no other RLC/MAC block
than those containing the HANDOVER ACCESS message shall be sent by the mobile
station while the PHYSICAL INFORMATION message has not been received by this
mobile station.
### 9.3a.2 Physical Information
During a handover, upon trigger from RRC layer through the PHYSICAL-INFO-Req
primitive, the network shall send a PHYSICAL INFORMATION message containing
the necessary timing advance value (see sub-clause 4.3.4) to the mobile
station, on FACCH, PACCH (on DBPSCH) , ADCH (FLO only) or SDCCH. The PHYSICAL
INFORMATION message shall be ciphered if applicable i.e. if ciphering is
started (see 3GPP TS 44.118).
Upon reception of a PHYSICAL INFORMATION message, the RRC shall be notified
through the PHYSICAL-INFO-Ind primitive and the mobile station shall then
proceed as specified in 3GPP TS 44.118.
## 9.4 Abnormal cases
\- If the mobile station receives an RLC/MAC control message on a logical
channel where this RLC/MAC control message is not allowed (see sub-clause
9.2.0), the mobile station shall ignore the message.
\- If the mobile station receives an acknowledgement message (PACKET UPLINK
ACK/NACK, PACKET DBPSCH UPLINK ACK/NACK, PACKET DBPSCH UPLINK ACK/NACK TYPE 2)
with missing mandatory fields, the mobile station shall notify the RRC layer,
which shall in turn re-establish all RLC entities for the radio bearers
currently established on the DBPSCH(s) and release the DBPSCH(s), as specified
in 3GPP TS 44.118.
\- If the mobile station receives an acknowledgement message (PACKET UPLINK
ACK/NACK, PACKET DBPSCH UPLINK ACK/NACK, PACKET DBPSCH UPLINK ACK/NACK TYPE 2)
for a radio bearer that is either not established on the DBPSCH(s) or for
which no data has been sent in the direction of the acknowledgement on the
DBPSCH(s), the mobile station shall notify the RRC layer, which shall in turn
re-establish all RLC entities for the radio bearers currently established on
the DBPSCH(s) and release the DBPSCH(s), as specified in 3GPP TS 44.118.
# 10 Radio Link Control (RLC) procedures on PDTCH and PACCH
## 10.1 General
See 3GPP TS 44.060 sub-clause 9.0.
## 10.2 Procedures and parameters for peer-to-peer operation
### 10.2.1 Send state variable V(S)
See 3GPP TS 44.060 sub-clause 9.1.1.
### 10.2.2 Control send state variable V(CS)
See 3GPP TS 44.060 sub-clause 9.1.1a.
### 10.2.3 Acknowledge state variable V(A)
See 3GPP TS 44.060 sub-clause 9.1.2.
### 10.2.4 Acknowledge state array V(B)
See 3GPP TS 44.060 sub-clause 9.1.3.
### 10.2.5 Block sequence number BSN
See 3GPP TS 44.060 sub-clause 9.1.4.
### 10.2.6 Receive state variable V(R)
See 3GPP TS 44.060 sub-clause 9.1.5.
### 10.2.7 Receive window state variable V(Q)
See 3GPP TS 44.060 sub-clause 9.1.6.
### 10.2.8 Receive state array V(N)
See 3GPP TS 44.060 sub-clause 9.1.7.
### 10.2.9 Starting sequence number (SSN) and received block bitmap (RBB)
See 3GPP TS 44.060 sub-clause 9.1.8.
### 10.2.10 Window Size
See 3GPP TS 44.060 sub-clause 9.1.9.
### 10.2.10a RLC buffer
See 3GPP TS 44.060 sub-clause 9.1.9.3.
### 10.2.11 Compression
See 3GPP TS 44.060 sub-clause 9.1.10.
### 10.2.12 Segmentation of upper layer PDUs into RLC data units
See 3GPP TS 44.060 sub-clause 9.1.11.
If so ordered by RRC for a given signalling radio bearer using RLC
acknowledged mode, in order to assure duplication avoidance at higher layer,
RLC shall guarantee that no more than three upper layer PDUs shall be
outstanding in the transmit window at any given time: there may be at most
three upper layer PDUs that are being transmitted i.e. that have been
segmented and for which the RLC PDUs are being transferred to the receiving
end.
If so ordered by RRC (CRLC-CONFIG-Req primitive), the RLC transmitter may
discard:
\- in RLC acknowledged mode, RLC SDU(s) not yet segmented into RLC PDUs. The
RLC transmitter shall notify the higher layer of all discarded RLC SDUs, if
indicated (RLC-AM-DATA-DiscardReq primitive).
\- in RLC unacknowledged mode, RLC SDU(s).
### 10.2.13 Re-assembly of upper layer PDUs from RLC data units
See 3GPP TS 44.060 sub-clause 9.1.12.
### 10.2.14 Segmentation of RLC/MAC control messages into RLC/MAC control
blocks
See 3GPP TS 44.060 sub-clause 9.1.12a.
### 10.2.15 Re-assembly of RLC/MAC control messages from RLC/MAC control
blocks
RLC/MAC control blocks shall be collected at the receiver until all RLC/MAC
control blocks comprising an RLC/MAC control message have been received.
In MAC-Idle state, the mobile station shall be capable of receiving eight
RLC/MAC control messages in parallel. If the mobile station receives RLC/MAC
control blocks containing part of a ninth RLC/MAC control message while it
still has RLC/MAC control blocks for eight partially received RLC/MAC control
messages, the mobile station shall discard the RLC/MAC control block of the
oldest partially received message.
In MAC-Shared state, MAC-Dedicated state or MAC-DTM state, the mobile station
shall be capable of receiving sixteen RLC/MAC control messages in parallel. If
the mobile station receives RLC/MAC control blocks containing part of a
seventeenth RLC/MAC control message while it still has RLC/MAC control blocks
for sixteen partially received RLC/MAC control messages, the mobile station
shall discard the RLC/MAC control block of the oldest partially received
message.
The mobile station shall start an instance of timer T3200 following the
receipt of an RLC/MAC control block whose RTI value does not correspond to the
RTI value of a partially received RLC/MAC control message or if the RLC/MAC
control blocks were received on different SBPSCHs (respectively DBPSCHs). In
non-DRX mode the duration of timer T3200 shall be four BS_CV_MAX block
periods. In DRX mode the duration of timer T3200 shall be four times the DRX
period (see 3GPP TS 43.064).
On receipt of an RLC/MAC control block containing a segment of an RLC/MAC
control message such that the mobile station now has the complete RLC/MAC
control message, the mobile station shall stop the corresponding instance of
timer T3200.
If the mobile station discards a partially received RLC/MAC control message
while the corresponding instance of timer T3200 is running, the mobile station
shall stop the corresponding instance of timer T3200.
On expiry of an instance of timer T3200, the mobile station shall discard and
ignore all segments of the corresponding partially received RLC/MAC control
message.
Upon successful change of SBPSCH (respectively DBPSCH) allocation, the mobile
station shall discard all partially received RLC/MAC control messages on
SBPSCH (respectively DBPSCH) and stop the corresponding instances of timer
T3200.
The mobile station shall discard any control message segment that contains an
unknown TFI.
## 10.3 Operation during RLC/MAC control message transfer
See 3GPP TS 44.060 sub-clause 9.2.
## 10.4 Operation during RLC data block transfer
### 10.4.1 General
See 3GPP TS 44.060 sub-clause 9.3.0.
### 10.4.2 Countdown procedure
See 3GPP TS 44.060 sub-clause 9.3.1.
The countdown value that is included in each uplink RLC data block by the
mobile station shall correspond to the RLC instance to which the RLC data
block belongs. In case SFACCH is used, a TBF shall have a countdown value for
each of the RLC instances multiplexed onto the TBF.
### 10.4.3 Delayed release of downlink Temporary Block Flow
This procedure is applicable in MAC-Shared state and in MAC-DTM state, on
SBPSCH only. See 3GPP TS 44.060 sub-clause 9.3.1a.
### 10.4.4 Extended uplink TBF mode
This procedure is applicable in MAC-Shared state and in MAC-DTM state, on
SBPSCH only.
See 3GPP TS 44.060 sub-clause 9.3.1b.
### 10.4.5 Acknowledged mode operation
#### 10.4.5.1 General
See 3GPP TS 44.060 sub-clause 9.3.2.0.
#### 10.4.5.2 Additional functionality in acknowledged EGPRS TBF Mode
See 3GPP TS 44.060 sub-clause 9.3.2.1.
#### 10.4.5.3 Establishment of Temporary Block Flow
The establishment of a TBF occurs as described in clause 7. RLC functions
related to the ARQ function shall not operate until RLC data block transfer
has been initiated.
If for a given radio bearer, the uplink TBF ended with an incompletely
transmitted upper layer PDU or any unacknowledged upper layer PDUs, the mobile
station shall begin transmission on the new TBF corresponding to this radio
bearer with the oldest unacknowledged upper layer PDU.
#### 10.4.5.4 Operation of uplink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.2.3.
#### 10.4.5.5 Release of uplink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.2.4.
#### 10.4.5.6 Operation of downlink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.2.5.
#### 10.4.5.7 Release of downlink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.2.6.
### 10.4.6 Unacknowledged mode operation
#### 10.4.6.1 General
See 3GPP TS 44.060 sub-clause 9.3.3.0.
#### 10.4.6.2 Establishment of Temporary Block Flow
If for a given radio bearer, the uplink TBF ended with an incompletely
transmitted upper layer PDU, the mobile station shall begin transmission on
the new TBF corresponding to this radio bearer with the last incompletely
transmitted upper layer PDU.
#### 10.4.6.3 Operation of uplink Temporary Block Flow
The network shall send PACKET UPLINK ACK/NACK messages when needed.
The mobile station shall set the Stall indicator (SI) bit to \'0\' in all RLC
data blocks of the TBF.
On SBPSCH, if the mobile station transmits the number of RLC data blocks
corresponding to the RLC window size (WS),without receiving a Packet Ack/Nack
message the mobile station shall start timer T3182 for the TBF. Timer T3182
shall be stopped upon reception of a PACKET UPLINK ACK/NACK message for this
TBF. If timer T3182 expires, the mobile station shall decrement counter N3102
by PAN_DEC, and perform an abnormal release with access retry (see sub-clause
8.7.2).
On SBPSCH, whenever the mobile station receives a PACKET UPLINK ACK/NACK
message, the mobile station shall increment N3102 by PAN_INC, however N3102
shall never exceed the value PAN_MAX. Upon cell reselection the mobile station
shall set counter N3102 to the value PAN_MAX. When N3102 ≤ 0 is reached, the
mobile station shall perform an abnormal release with cell re-selection (see
sub-clause 9.4.2). If PAN_DEC, PAN_INC, or PAN_MAX are set to the value 0,
counter N3102 shall be disabled.
On SBPSCH, a mobile station operating with an exclusive allocation shall start
or restart timer T3184 upon reception of a PACKET UPLINK ACK/NACK message. If
timer T3184 expires, the mobile station shall perform an abnormal release with
access retry (see sub-clause 9.4.1).
#### 10.4.6.4 Release of uplink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.3.3.
#### 10.4.6.5 Operation of downlink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.3.4.
#### 10.4.6.6 Release of downlink Temporary Block Flow
See 3GPP TS 44.060 sub-clause 9.3.3.5.
## 10.5 Abnormal release cases
### 10.5.1 Abnormal release with access retry
Abnormal release with access retry is described in sub-clause 8.8.3. It is
applicable in MAC-Shared state and in MAC‑DTM state, on SBPSCH only.
### 10.5.2 Abnormal release with cell reselection
Abnormal release with cell reselection is applicable in MAC-Shared state only.
See 3GPP TS 44.060 sub-clause 9.4.2.
## 10.6 Uplink TBF release in extended uplink TBF mode
This procedure is applicable in MAC-Shared state and in MAC-DTM state, on
SBPSCH only.
In the extended uplink TBF mode (see sub-clause 10.4.4), the network may
initiate the release an uplink TBF by sending a PACKET UPLINK ACK/NACK message
with the Final Ack Indicator set to \'1\'. The network shall include a valid
RRBP field in the RLC/MAC control block header and clear counter N3103. The
network may use the TBF Est field in the PACKET UPLINK ACK/NACK message to
allow the mobile station to request the establishment of new TBF. The release
of the uplink TBF, using this procedure, may be initiated at a point
determined by the network.
If the PACKET UPLINK ACK/NACK message has the Final Ack Indicator bit set to
\'1\' and the following conditions are fulfilled: TBF Est field is set to
\'1\'; the mobile station has new data to transmit; the mobile station has no
ongoing downlink TBF, the mobile station shall release the TBF and may request
the establishment of new TBF using one of the following procedures:
\- If Control Ack Type parameter in System Information indicates
acknowledgement is access burst, the mobile station shall transmit the PACKET
CONTROL ACKNOWLEDGEMENT message with the Ctrl Ack bits set to \'00\'. The
mobile station shall start timer T3168 and continue to monitor the PDCH used
for transmitting the PACKET CONTROL ACKNOWLEDGEMENT message. The mobile
station shall stop timer T3168 upon reception of the PACKET UPLINK ASSIGNMENT
message including Single Block Allocation structure or the PACKET ACCESS
REJECT message. The mobile station shall use the same procedures as are used
for TBF establishment using two phase access described in sub-clause 7.2.4
starting from the point where the mobile station receives the PACKET UPLINK
ASSIGNMENT message including Single Block Allocation structure or the PACKET
ACCESS REJECT message.
\- If Control Ack Type parameter in System Information indicates
acknowledgement is RLC/MAC control block, the mobile station shall transmit
the PACKET RESOURCE REQUEST message and start timer T3168. The mobile station
shall use the same procedures as are used for TBF establishment using two
phase access described in sub-clause 7.2.4 starting from the point where the
mobile station transmits the PACKET RESOURCE REQUEST message.
If the PACKET UPLINK ACK/NACK message has the Final Ack Indicator bit set to
\'1\' and the mobile station does not initiate the establishment of a new
uplink TBF according to one of the procedures described above, the mobile
station shall transmit the PACKET CONTROL ACKNOWLEDGEMENT message and release
the TBF. If there is no ongoing downlink TBF, the mobile station in MAC-Shared
state shall return to respectively MAC-Idle state; the mobile station in MAC-
DTM state shall return to MAC-Dedicated state. The DRX mode procedures shall
be applied as specified in sub-clause 5.4.1.8.
When the network receives the PACKET CONTROL ACKNOWLEDGEMENT message or the
PACKET RESOURCE REQUEST message in the radio block indicated by the RRBP
field, it may reuse the TFI and USF resources.
If the network receives the PACKET CONTROL ACKNOWLEDGEMENT message with Ctrl
Ack bits set to \'00\' or the PACKET RESOURCE REQUEST message in the radio
block indicated by the RRBP field and the network has set the TBF Est field to
\'1\' in the PACKET UPLINK ACK/NACK message, the network shall follow one of
the following procedures:
\- In case the mobile station requested the establishment of new TBF with the
PACKET CONTROL ACKNOWLEDGEMENT message, the network shall respond to the
mobile station with the PACKET UPLINK ASSIGNMENT message including Single
Block Allocation structure or the PACKET ACCESS REJECT message on the same
PDCH as the mobile station has sent the PACKET CONTROL ACKNOWLEDGEMENT
message. The G-RNTI shall be used to identify the mobile station. The network
shall use the same procedures as are used for TBF establishment using two
phase access described in sub-clause 7.2.4 starting from the point where the
network transmits the PACKET UPLINK ASSIGNMENT message including Single Block
Allocation structure or the PACKET ACCESS REJECT message.
\- In case the mobile station requested the establishment of new TBF with the
PACKET RESOURCE REQUEST message, the network shall use the same procedures as
are used for TBF establishment using two phase access described in sub-clause
7.2.4 starting from the point where the network has received the PACKET
RESOURCE REQUEST message. The G-RNTI shall be used to identify the mobile
station.
If the network does not receive the PACKET CONTROL ACKNOWLEDGEMENT message or
the PACKET RESOURCE REQUEST message in the radio block indicated by the RRBP
field, it shall increment counter N3103 and retransmit the PACKET UPLINK
ACK/NACK message. If counter N3103 exceeds its limit, the network shall stop
scheduling new uplink resources for the TBF, stop sending the PACKET UPLINK
ACK/NACK message to the mobile station and start timer T3169.
When timer T3169 expires, the network may reuse the TFI and USF resources.
If for a given radio bearer the uplink TBF was operating in RLC acknowledged
mode and there is an incompletely transmitted upper layer PDU or an upper
layer PDU, which is not fully acknowledged, it shall be transmitted after
establishing a new uplink TBF for this radio bearer.
# 11 Radio Link Control (RLC) procedures on TCH, FACCH, SACCH, SDCCH and CDCH
## 11.1 General
This sub-clause describes the RLC procedures in TCH TBF mode, DCCH TBF mode
and CDCH TBF mode applicable in MAC-Dedicated state and MAC-DTM state. Unless
explicitly stated otherwise, the procedures and parameters in this sub-clause
are not applicable in T-RLC mode.
In TCH TBF mode, the following definitions apply in NT-RLC mode only:
\- Sequence Number Space (SNS): 256.
\- Window Size (WS): 128.
In DCCH TBF mode and CDCH TBF mode, the following definitions apply:
\- Sequence Number Space (SNS): 16.
\- Window Size (WS): 8.
## 11.2 Procedures and parameters for peer-to-peer operation
### 11.2.1 Send state variable V(S)
See 3GPP TS 44.060 sub-clause 9.1.1.
### 11.2.2 Control send state variable V(CS)
See 3GPP TS 44.060 sub-clause 9.1.1a.
### 11.2.3 Acknowledge state variable V(A)
See 3GPP TS 44.060 sub-clause 9.1.2.
### 11.2.4 Acknowledge state array V(B)
In RLC acknowledged mode, each RLC endpoint transmitter shall have an
associated acknowledge state array (V(B)). V(B) is an array of SNS elements
indicating the acknowledgement status of WS previous RLC data blocks. The
array is indexed relative to the acknowledge state variable V(A) modulo SNS.
The values of V(B) shall be updated from the latest values received from its
peer in the received block bitmap (RBB) of either the piggy-backed
acknowledgement (DCCH TBF mode and CDCH TBF mode only) or the Packet Ack/Nack
message (DCCH TBF mode, CDCH TBF mode or TCH TBF mode) (see sub-clause
11.2.10).
The transmitter shall transmit the oldest RLC data block whose corresponding
element in V(B) indexed relative to V(A) has the value NACKED. As each RLC
data block is transmitted the corresponding element in V(B) is set to the
value PENDING_ACK.
If [ V(S) \ \- Window Size (WS): 8.
## 11a.2 Procedures and parameters for peer-to-peer operation
### 11a.2.1 Send state variable V(S)
See 3GPP TS 44.060 sub-clause 9.1.1.
### 11a.2.2 Control send state variable V(CS)
See 3GPP TS 44.060 sub-clause 9.1.1a.
### 11a.2.3 Acknowledge state variable V(A)
See 3GPP TS 44.060 sub-clause 9.1.2.
### 11a.2.4 Acknowledge state array V(B)
See 3GPP TS 44.060 sub-clause 9.1.3.1.
### 11a.2.5 Block sequence number BSN
Each RLC data block contains a block sequence number (BSN) field that is 10
bits in length in RLC-AM and 4 bits in length in RLC-UM. At the time that an
in‑sequence RLC data block is designated for transmission, the value of BSN is
set equal to the value of the send state variable V(S).
### 11a.2.6 Reduced block sequence number RBSN
See 3GPP TS 44.060 sub-clause 9.1.4a.
### 11a.2.7 Receive state variable V(R)
See 3GPP TS 44.060 sub-clause 9.1.5.
### 11a.2.8 Receive window state variable V(Q)
See 3GPP TS 44.060 sub-clause 9.1.6.
### 11a.2.9 Receive state array V(N)
See 3GPP TS 44.060 sub-clause 9.1.7.1.
### 11a.2.10 Starting sequence number (SSN) and received block bitmap (RBB)
#### 11a.2.10.1 General
The Packet Ack/Nack message (PACKET DBPSCH UPLINK/DOWNLINK ACK/NACK TYPE 2
message) contains a starting sequence number (SSN) and a reported bitmap. The
Packet Ack/Nack message is sent by the RLC receiver and is received by the RLC
transmitter. The SSN and reported bitmap are determined as defined in this
sub-clause 11a.2.10 and transmitted in RLC acknowledged mode.
The BSN values specified in the reported bitmap are interpreted by
substracting the bit position in the bitmap to the starting sequence number
(SSN), modulo SNS (where the bit in first position in the bitmap has the bit
position '1').
A valid BSN value in the reported bitmap is one that is in the range [ V(A) ≤
BSN \ N (i.e. FRB cannot be reported uncompressed), the
mobile station shall determine whether a first partial bitmap or a next
partial bitmap is transmitted, as follows:
\- If [PBSN-V(Q)] mod SNS \ N then SSN shall be set to the last
sequence number + 1 (mod SNS) for which the Ack/Nack status can be indicated
in the reported bitmap and the reported bitmap covers the RLC data blocks
having a BSN within the interval [PBSN+1, SSN-1]. PBSN shall then be set to
the last sequence number for which the Ack/Nack status can be indicated in the
reported bitmap i.e. SSN-1.
\- If [V(R) -- (PBSN+1)] mod SNS ≤ N, then SSN = V(R) and the reported bitmap
covers as many RLC data blocks having a BSN smaller than the SSN as can fit in
the reported bitmap. PBSN shall then be set to V(Q).
NOTE: The next partial bitmap may cover the entire FRB when compression is
used
The beginning of window (BOW) bit shall be set to '0' when the reported bitmap
does not cover V(Q), and to '1' otherwise. The end of window (EOW) bit shall
be set to '0' when the reported bitmap does not cover [V(R)-1], and to '1'
otherwise.
If V(Q) equals V(R), then SSN shall be set to the value SSN = V(R), BOW bit
shall be set to the value \'1\', EOW shall be set to the value \'1\' and the
reported bitmap size shall equal 0 bits.
#### 11a.2.10.4 Interpretation of the bitmap
If a compressed bitmap is received, the bitmap shall first be decompressed
according to the one-dimensional run length coding algorithm specified in 3GPP
TS 44.060 sub-clause 9.1.10. The uncompressed bitmap shall be treated as
follows:
The first bit in the uncompressed bitmap corresponds to the block SSN-1 (mod
SNS). The second bit in the uncompressed bitmap corresponds to the block SSN-2
(mod SNS), and so on.
If the BOW bit in the Packet Ack/Nack message has the value '1', then the
bitmap acknowledges all blocks between V(A) and the block corresponding to
V(Q)-1 (the block corresponding to V(Q) corresponds to the first '0' starting
from the end of the bitmap), and the corresponding elements in V(B) shall be
set to the value ACKED.
If the EOW bit in the Packet Ack/Nack message has the value \'1\', then bitmap
value \'0\' shall be assumed for all RLC blocks with a BSN value higher than
the last entry in the bitmap but less than V(S) (i.e. [ V(R) - 1 \ ::= | | | | \ | | | | \\\ | | | | \\\ | +----------------------------------------------------------------------+ | Reduced Rbid | | | | > The reduced radio bearer identity field provides a one-to-one | | > mapping with the RBid of the RB in the opposite direction to which | | > the acknowledgement bitmap is targetted. It is encoded as shown in | | > table 12.3, sub-clause 12.9.4. | | | | STARTING_SEQUENCE_NUMBER (SSN): | | | | > The SSN contains the value of V(R) when this field was | | > transmitted. This field is encoded as the binary representation of | | > V(R). | | > | | > Range 0 to 15 | | | | RECEIVED_BLOCK_BITMAP (RBB): | | | | > The RBB is a bitmap representing Block Sequence Numbers. The | | > bitmap is indexed relative to SSN as follows: | | > | | > BSN=(SSN -- bit_number) modulo 16 for bit_number=1 to 8. | | > | | > The BSN values represented range from (SSN-1) mod 16 to (SSN-8) | | > mod 16. | | > | | > The value of each bit is encoded as: | | > | | > 0: Negative acknowledgement of the RLC data block with | | > BSN=(SSN-bit_number) mod 16 | | > | | > 1: Positive acknowledgement of the RLCdata block with | | > BSN=(SSN-bit_number) mod 16. | | > | | > Mapping of the bitmap is defined in sub-clause 11. | +----------------------------------------------------------------------+
### 12.9.10 G-RNTI indicator (GI) bit
The G-RNTI indicator bit indicates the presence of an optional G-RNTI field
within the RLC data block, when on SDCCH. It is encoded as shown in table
12.9.10.1.
Table 12.9.10.1: G-RNTI indicator (GI) bit
* * *
Bit GI: G-RNTI indicator bit 0 G-RNTI field is not present 1 G-RNTI field is
present
* * *
### 12.9.11 Segmentation (S) bit
The Segmentation bit indicates whether or not the RLC/MAC control block is a
segment of an RLC/MAC control message. It is encoded as shown in table
12.9.11.1.
Table 12.9.11.1: Segmentation (S) bit
* * *
Bit S: Segmentation bit 0 The RLC/MAC control block contains an entire RLC/MAC
control message 1 The RLC/MAC control block is a segment of an RLC/MAC control
message
* * *
### 12.9.12 Reduced Block Sequence Number (RBSN) bit
The Reduced Block Sequence Number (RBSN) bit carries the sequence number of
the RLC/MAC control blocks. The RBSN bit is encoded as a binary number with
range 0 to 1. The RBSN bit is present if and only if the S bit is set (see
sub-clause 12.9.11).
### 12.9.13 (void)
### 12.9.14 Radio Transaction Identifier (RTI) field
The Radio Transaction Identifier (RTI) field is used to group the RLC/MAC
control blocks that make up an RLC/MAC control message and identifies the
segmented control message sequence with which the RLC/MAC control block is
associated. The RTI field is 2 bits in length with range 0 to 3. The RTI field
is present if and only if the S bit is set (see sub-clause 12.9.11). The RTI
is unique on a given logical channel in a given direction.
NOTE: An RTI value may be repeated in both directions on a given logical
channel (e.g. FACCH uplink and FACCH downlink), and across logical channels
(e.g.. FACCH and SACCH).
### 12.9.15 Block Sequence Number (BSN) field
The Block Sequence Number (BSN) field carries the sequence absolute Block
Sequence Number (BSN\') modulo Sequence Number Space (SNS) (16 in DCCH TBF
mode, 256 in TCH TBF mode (NT-RLC)) of each RLC data block within the TBF.
In DCCH TBF mode and CDCH TBF mode, the BSN is 4 bits in length and is encoded
as a binary number with range 0 to 15.
In TCH TBF mode (NT-RLC), the BSN is 8 bits in length and is encoded as a
binary number with range 0 to 255.
In UDCH TBF mode, in RLC unacknowledged mode, the BSN is 4 bits in length and
is encoded as a binary number with range 0 to 15.
In UDCH TBF mode, in RLC acknowledged mode, the BSN is 10 bits in length and
is encoded as a binary number with range 0 to 1023.
### 12.9.16 Radio Bearer Identity (RB Id) field
The Rb Id uniquely identifies a Radio Bearer. This field is encoded as a
binary number with range 0-31.
### 12.9.17 Signalling Radio Bearer Identity (SRB Id) field
The Signalling Radio Bearer Identity (SRB Id) field is used to identify the
SRB to which the RLC data block belongs. It is encoded as shown in table
12.9.17.1.
Table 12.9.17.1: Signalling Radio Bearer Identity (SRB Id) field
+-----+------------------------------------------+ | Bit | SRB Id: Signalling Radio Bearer Identity | | | | | 2 1 | | +-----+------------------------------------------+ | 0 0 | SRB1 | +-----+------------------------------------------+ | 0 1 | SRB2 | +-----+------------------------------------------+ | 1 0 | SRB3 | +-----+------------------------------------------+ | 1 1 | SRB4 | +-----+------------------------------------------+
### 12.9.18 GERAN Radio Network Temporary Identity Extension (G-RNTI
Extension) field
This field contains the extra 4 bits of the G-RNTI not included in the TLLI /
G-RNTI field.
### 12.9.19 Length Indicator (LI) field
In GPRS TBF mode, EGPRS TBF mode, TCH TBF mode, DCCH TBF mode and CDCH TBF
mode, the Length Indicator bit is used as is described in 3GPP TS 44.060 sub-
clauses 10.4.14 and 10.4.14a.
In UDCH TBF mode, the Length Indicator is used as described in 3GPP TS 44.060
sub-clauses 10.4.14 and 10.4.14a, with the following exceptions:
\- The Length Indicator field is 8 bits in length and shall be encoded as a
binary number.
\- The valid values are the values ranging from 0 to 171, and the value 255\.
All other values are reserved.
\- An 8-bit Length Indicator of value 255 shall be treated as described in
3GPP TS 44.060 for a 7-bit Length Indicator of value 127
\- An 8-bit Length Indicator of value 127 shall be treated as a length
indication of 127 octets, and not as a 7-bit Length Indicator of value 127
The interpretation of the value contained in the length indicator with
corresponding E bit in UDCH TBF mode is summarized in table 12.9.19.1.
Table 12.9.19.1: Interpretation of values of LI field and E bit in UDCH TBF
mode
+----------------------+----------------------+----------------------+ | Value of LI in a RLC | Value of the | Interpretation | | data block | following E bit | | +----------------------+----------------------+----------------------+ | k-th LI: | | The value of the | | | | k-th LI is the | | 0\0 integer) | | PDU, or the last | | | | segment of it, in | | | | the current RLC data | | | | block. | +----------------------+----------------------+----------------------+ | | 0 | There is at least | | | | one Upper Layer PDU | | | | following the k-th | | | | Upper Layer PDU in | | | | the current RLC data | | | | block. | +----------------------+----------------------+----------------------+ | | 1 | There is no more | | | | than one Upper Layer | | | | PDU following the | | | | k-th Upper Layer PDU | | | | in the current RLC | | | | data block. | +----------------------+----------------------+----------------------+ | 1^st^ LI: value =0 | 0 | The last Upper Layer | | | | PDU of the previous | | | | in sequence RLC data | | | | block ends at the | | | | boundary of that RLC | | | | data block and it | | | | has no LI in the | | | | header of that RLC | | | | data block. | +----------------------+----------------------+----------------------+ | k-th LI: | | The k-th LI contains | | | | the number of octets | | 0\1 integer) | | the current RLC data | | | | block. | +----------------------+----------------------+----------------------+ | | 0 | There is at least | | | | one Upper Layer PDU | | | | following the | | | | (k-1)-th Upper Layer | | | | PDU in the current | | | | RLC data block. | +----------------------+----------------------+----------------------+ | | 1 | There is no more | | | | than one Upper Layer | | | | PDU following the | | | | (k-1)-th Upper Layer | | | | PDU in the current | | | | RLC data block. | +----------------------+----------------------+----------------------+ | k-th LI: value=255 | 1 | The octets between | | | | the end of the Upper | | | | Layer PDU indicated | | | | by the (k-1)-th LI | | | | and the end of the | | | | current RLC data | | | | block are filling | | | | octets, or the | | | | octets contain part | | | | of an Upper Layer | | | | PDU that cannot be | | | | transmitted | | | | completely in the | | | | current RLC data | | | | block and will not | | | | be continued in the | | | | next in-sequence RLC | | | | data block. | +----------------------+----------------------+----------------------+ | 1^st^ LI: value=0 | 1 | The previous RLC | | | | data block contains | | | | a Upper Layer PDU, | | | | or a part of it, | | | | that fills precisely | | | | the previous data | | | | block and for which | | | | there is no length | | | | indicator in that | | | | RLC data block. The | | | | current RLC data | | | | block contains a | | | | Upper Layer PDU that | | | | either fills the | | | | current RLC data | | | | block precisely or | | | | continues in the | | | | next RLC data blcok. | +----------------------+----------------------+----------------------+ | 1^st^ LI: value=255 | 1 | All octets of the | | | | RLC Data block | | | | contain filling | | | | information. | +----------------------+----------------------+----------------------+ | No LI field present | n.a. | The Upper Layer PDU | | | | that starts with the | | | | current RLC data | | | | block either fills | | | | the current RLC data | | | | block precisely or | | | | continues in the | | | | following | | | | in-sequence RLC data | | | | block | +----------------------+----------------------+----------------------+
### 12.9.20 PFI Indicator (PI) field
The PFI Indicator is not used in _Iu mode_.
### 12.9.21 HFN Least Significant Bit (HFN_LSB) field
The HFN Least Significant Bit (HFN_LSB) field contains the least significant
bit of the HFN of the radio bearer to which the RLC/MAC block belongs, in the
direction where this RLC/MAC block is sent.
# 13 Ciphering
## 13.1 General
The ciphering function is performed either in the RLC sublayer or in the MAC
sublayer according to the following rules:
\- The RLC sublayer is responsible for ciphering/deciphering RLC data blocks
in case of non-transparent RLC mode (unacknowledged or acknowledged).
\- The MAC sublayer is responsible for ciphering/deciphering user data in case
of transparent RLC mode. It is also responsible for ciphering/deciphering some
RLC/MAC control messages.
The ciphering function shall use the ciphering algorithm f8 specified in 3GPP
TS 35.201. Four input parameters are necessary to configure the ciphering
algorithm:
\- _Ciphering key_ : the 128-bit _ciphering key_ is received from RRC by means
of interlayer primitive.
\- _Bearer_ : the 5-bit _bearer_ indicates, when available, the radio bearer
identity of the radio bearer to cipher. It is received from RRC by means of
interlayer primitive.
\- _Direction_ : the 1-bit _direction_ indicates the direction of
transmission, uplink or downlink, of the flow to cipher.
\- _Count_ : the 32-bit _count_ is used to ensure that the blocks of a same
flow are all ciphered differently.
A fifth parameter, _Length_ , is used to indicate the length in bits of the
plain data to cipher. Plain, ciphered and deciphered data are of the same
length. Length is not input to the ciphering algorithm.
## 13.2 Applicability of ciphering
Ciphering may apply only between the mobile station and the serving BSS when
contention resolution is successfully completed, i.e. uplink data
(respectively downlink data) between the mobile station and the serving BSS
may be ciphered after contention is successfully completed on mobile station
side (respectively serving BSS side).
## 13.3 Ciphering at RLC sublayer
### 13.3.1 General
The RLC sublayer is responsible for ciphering/deciphering RLC data blocks in
case of non-transparent RLC mode (unacknowledged or acknowledged).
For a given radio bearer, ciphering/deciphering is ordered by RRC by means of
the CRLC-CONFIG-Req primitive containing the necessary ciphering elements (see
sub-clause 4.3.3). Upon receipt of the CRLC-CONFIG-Req primitive containing
the ciphering elements, ciphering shall be performed at RLC sublayer according
to these ciphering elements for the corresponding radio bearer. Ciphering
shall not be performed at RLC sublayer otherwise.
### 13.3.2 Parameter settings
#### 13.3.2.1 Input parameters to the ciphering algorithm
Table 13.3.2.1.1 defines how to set the input parameters to the ciphering
algorithm.
Table 13.3.2.1.1: Input parameters to the ciphering algorithm
+-------+-------+-------+-------+-------+-------+-------+-------+ | Input | Size | Set | | | | | | | param | in | tings | | | | | | | eters | bits | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | TBF | DCCH | TCH | GPRS | EGPRS | | | | | mode | | | | | | | | | | | | | | | | | | (see | | | | | | | | | note | | | | | | | | | 1) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | Count | 32 | MSB | HFN | 27 | 23 | 24 | 20 | | | | | (see | bits | bits | bits | bits | | | | | note | | | | | | | | | 2) | _0... |_ 0\. | _0.. |_ 0\. | | | | | | 13421 | ..838 | .1677 | ..104 | | | | | | 7727 _| 8607_ | 7215 _| 8575_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | | RBid | 1 bit | | | | | | | | indi | | | | | | | | | cator | _1_ | | | | | | | | | (RBid | | | | | | | | | avail | | | | | | | | | able) | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | | | LSB | BSN | 4 | 8 | 7 | 11 | | | | | | bits | bits | bits | bits | | | | | | | | | | | | | | | _0\. |_ 0.. | _0.. |_ 0... | | | | | | ..15 _| .255_ | .127 _| 2047_ | +-------+-------+-------+-------+-------+-------+-------+-------+ | Dire | 1 | | Dire | 1 bit | | | | | ction | | | ction | | | | | | | | | | _0_ | | | | | | | | | (up | | | | | | | | | link) | | | | | | | | | | | | | | | | | | _1_ | | | | | | | | | (down | | | | | | | | | link) | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | B | 5 | | RBid | 5 | | | | | earer | | | | bits | | | | | | | | | | | | | | | | | | _0\. | | | | | | | | | ..31_ | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | L | 10 | | L | 10 | | | | | ength | | | ength | bits | | | | | | | | in | | | | | | | | | bits | _0.. | | | | | | | | of | .592_ | | | | | | | | the | | | | | | | | | plain | | | | | | | | | data | | | | | | | | | to | | | | | | | | | c | | | | | | | | | ipher | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | NOTE | | | | | | | | | 1: | | | | | | | | | Four | | | | | | | | | cases | | | | | | | | | are | | | | | | | | | dis | | | | | | | | | tingu | | | | | | | | | ished | | | | | | | | | as | | | | | | | | | per | | | | | | | | | the | | | | | | | | | f | | | | | | | | | ormat | | | | | | | | | of | | | | | | | | | the | | | | | | | | | BSN | | | | | | | | | used | | | | | | | | | in | | | | | | | | | the | | | | | | | | | RLC | | | | | | | | | data | | | | | | | | | block | | | | | | | | | to | | | | | | | | | ci | | | | | | | | | pher, | | | | | | | | | acco | | | | | | | | | rding | | | | | | | | | to | | | | | | | | | the | | | | | | | | | TBF | | | | | | | | | mode: | | | | | | | | | DCCH | | | | | | | | | TBF | | | | | | | | | mode, | | | | | | | | | TCH | | | | | | | | | TBF | | | | | | | | | mode, | | | | | | | | | GPRS | | | | | | | | | TBF | | | | | | | | | mode | | | | | | | | | and | | | | | | | | | EGPRS | | | | | | | | | TBF | | | | | | | | | mode. | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | 2: | | | | | | | | | The | | | | | | | | | han | | | | | | | | | dling | | | | | | | | | of | | | | | | | | | the | | | | | | | | | HFN | | | | | | | | | is | | | | | | | | | desc | | | | | | | | | ribed | | | | | | | | | in | | | | | | | | | sub-c | | | | | | | | | lause | | | | | | | | | 13.3 | | | | | | | | | .2.2. | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | 3: | | | | | | | | | The | | | | | | | | | v | | | | | | | | | alues | | | | | | | | | in | | | | | | | | | i | | | | | | | | | talic | | | | | | | | | repr | | | | | | | | | esent | | | | | | | | | the | | | | | | | | | range | | | | | | | | | for a | | | | | | | | | given | | | | | | | | | param | | | | | | | | | eter. | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
Table 13.3.2.1.2: Input parameters to the ciphering algorithm (FLO)
+----------+----------+----------+----------+----------+----------+ | Input | Size in | Settings | | | | | pa | bits | | | | | | rameters | | | | | | +----------+----------+----------+----------+----------+----------+ | | | TBF mode | UDCH | UDCH | CDCH | | | | | (RLC AM) | (RLC UM) | | | | | (see | | | | | | | note 1) | | | | +----------+----------+----------+----------+----------+----------+ | Count | 32 | MSB | HFN (see | 21 bits | See DCCH | | | | | note 2) | | TBF Mode | | | | | | _0... | | | | | | | 2097171_ | | +----------+----------+----------+----------+----------+----------+ | | | | RBid | 1 bit | | | | | | i | | | | | | | ndicator | _1_ | | | | | | | (RBid | | | | | | | av | | | | | | | ailable) | | +----------+----------+----------+----------+----------+----------+ | | | LSB | BSN | 10 bits | | | | | | | | | | | | | | _0 | | | | | | | ...1023_ | | +----------+----------+----------+----------+----------+----------+ | D | 1 | | D | 1 bit | | | irection | | | irection | | | | | | | | _0_ | | | | | | | (uplink) | | | | | | | | | | | | | | _1_ | | | | | | | (d | | | | | | | ownlink) | | +----------+----------+----------+----------+----------+----------+ | Bearer | 5 | | RBid | 5 bits | | | | | | | | | | | | | | _0...31_ | | +----------+----------+----------+----------+----------+----------+ | Length | 10 | | Length | 11 bits | | | | | | in bits | | | | | | | of the | _0 | | | | | | plain | ...1370_ | | | | | | data to | | | | | | | cipher | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | Four | | | | | | | cases | | | | | | | are | | | | | | | disti | | | | | | | nguished | | | | | | | as per | | | | | | | the | | | | | | | format | | | | | | | of the | | | | | | | BSN used | | | | | | | in the | | | | | | | RLC data | | | | | | | block to | | | | | | | cipher, | | | | | | | a | | | | | | | ccording | | | | | | | to the | | | | | | | TBF | | | | | | | mode: | | | | | | | UDCH TBF | | | | | | | mode, | | | | | | | CDCH TBF | | | | | | | mode. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | handling | | | | | | | of the | | | | | | | HFN is | | | | | | | d | | | | | | | escribed | | | | | | | in | | | | | | | su | | | | | | | b-clause | | | | | | | 1 | | | | | | | 3.3.2.2. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The | | | | | | | values | | | | | | | in | | | | | | | italic | | | | | | | r | | | | | | | epresent | | | | | | | the | | | | | | | range | | | | | | | for a | | | | | | | given | | | | | | | pa | | | | | | | rameter. | | | | | | +----------+----------+----------+----------+----------+----------+
#### 13.3.2.2 Handling of the HFN
The HFN is radio bearer specific.
In RLC acknowledged mode, the HFN used at retransmission of an RLC data block
shall be the same as the one used at original transmission of this RLC data
block.
The HFN shall be increased by one at every cycle of the BSN, when the BSN
reaches 0.
Further handling of the HFN is described in 3GPP TS 44.118.
### 13.3.3 Ciphering of RLC PDUs in non-transparent RLC mode
Ciphering may only apply on the payload of the RLC PDUs. For instance, if
MCS-9 is used, only the 592 bits of the payload of each of the two RLC data
blocks in the RLC/MAC block may be ciphered.
## 13.4 Ciphering at MAC sublayer
### 13.4.1 General
The MAC sublayer is responsible for ciphering/deciphering user data in case of
transparent RLC mode. It is also responsible for ciphering some RLC/MAC
control messages.
For a given radio bearer, ciphering/deciphering is ordered by RRC by means of
the CMAC-CONFIG-Req primitive containing the necessary ciphering elements (see
sub-clause 4.3.4). Upon receipt of the CMAC-CONFIG-Req primitive containing
the ciphering elements, ciphering/deciphering shall be performed at MAC
sublayer according to these ciphering elements for the corresponding radio
bearer. Ciphering shall not be performed at MAC sublayer otherwise.
### 13.4.2 Parameter settings
#### 13.4.2.1 Input parameters to the ciphering algorithm
Table 13.4.2.1.1 defines how to set the input parameters to the ciphering
algorithm in case of transparent RLC mode.
Table 13.4.2.1.1: Input parameters to the ciphering algorithm\ for layer 2
data in transparent RLC mode
+-------------+-------------+----------+-------------+-------------+ | Input | Size in | Settings | | | | parameters | bits | | | | +-------------+-------------+----------+-------------+-------------+ | Count | 32 | MSB | HFN (see | 11 bits | | | | | note 1) | | | | | | | _0...2047_ | +-------------+-------------+----------+-------------+-------------+ | | | | TDMA Frame | 17 bits | | | | | Number (see | | | | | | note 2) | | +-------------+-------------+----------+-------------+-------------+ | | | | RBid | 1 bit | | | | | indicator | | | | | | | _1_ (RBid | | | | | | available) | +-------------+-------------+----------+-------------+-------------+ | | | LSB | Timeslot | 3 bits | | | | | number | | | | | | | _0...7_ | +-------------+-------------+----------+-------------+-------------+ | Direction | 1 | | Direction | 1 bit | | | | | | | | | | | | _0_ | | | | | | (uplink) | | | | | | | | | | | | _1_ | | | | | | (downlink) | +-------------+-------------+----------+-------------+-------------+ | Bearer | 5 | | RBid | 5 bits | | | | | | | | | | | | _0...31_ | +-------------+-------------+----------+-------------+-------------+ | Length | N | | Length in | Size of the | | | | | bits of the | RLC PDU | | | | | plain data | | | | | | to cipher | (see note | | | | | | 3) | +-------------+-------------+----------+-------------+-------------+ | NOTE 1: The | | | | | | handling of | | | | | | the HFN is | | | | | | described | | | | | | in | | | | | | sub-clause | | | | | | 13.4.2.2.1. | | | | | | | | | | | | NOTE 2: The | | | | | | 17-bit TDMA | | | | | | Frame | | | | | | Number is | | | | | | described | | | | | | below. | | | | | | | | | | | | NOTE 3: In | | | | | | transparent | | | | | | RLC mode, | | | | | | the size of | | | | | | an RLC PDU | | | | | | equals that | | | | | | of the RLC | | | | | | SDU it | | | | | | carries. | | | | | | | | | | | | NOTE 4: The | | | | | | values in | | | | | | _italic_ | | | | | | represent | | | | | | the range | | | | | | for a given | | | | | | parameter. | | | | | +-------------+-------------+----------+-------------+-------------+
Table 13..4.2.1.2 defines how to set the input parameters to the ciphering
algorithm for ciphering of RLC/MAC control messages. The rules for ciphering
RLC/MAC control messages are given in sub-clause 13.4.3.
Table 13.4.2.1.2: Input parameters to the ciphering algorithm for RLC/MAC
control messages
+-------------+-------------+----------+-------------+-------------+ | Input | Size in | Settings | | | | parameters | bits | | | | +-------------+-------------+----------+-------------+-------------+ | Count | 32 | MSB | HFN (see | 11 bits | | | | | note 1) | | | | | | | _0...2047_ | +-------------+-------------+----------+-------------+-------------+ | | | | TDMA Frame | 17 bits | | | | | Number (see | | | | | | note 2) | | +-------------+-------------+----------+-------------+-------------+ | | | | RBid | 1 bit | | | | | indicator | | | | | | | _0_ (RBid | | | | | | not | | | | | | available) | +-------------+-------------+----------+-------------+-------------+ | | | LSB | Timeslot | 3 bits | | | | | number | | | | | | | _0...7_ | +-------------+-------------+----------+-------------+-------------+ | Direction | 1 | | Direction | 1 bit | | | | | | | | | | | | _0_ | | | | | | (uplink) | | | | | | | | | | | | _1_ | | | | | | (downlink) | +-------------+-------------+----------+-------------+-------------+ | Bearer | 5 | | RBid | 5 bits | | | | | | | | | | | | _\"00000\"_ | +-------------+-------------+----------+-------------+-------------+ | Length | 9 | | Length in | 9 bits | | | | | bits of the | | | | | | plain data | _0...368_ | | | | | to cipher | (see note | | | | | | 3) | +-------------+-------------+----------+-------------+-------------+ | NOTE 1: The | | | | | | handling of | | | | | | the HFN is | | | | | | described | | | | | | in | | | | | | sub-clause | | | | | | 13.4.2.2.2. | | | | | | | | | | | | NOTE 2: The | | | | | | 17-bit TDMA | | | | | | Frame | | | | | | Number is | | | | | | described | | | | | | below. | | | | | | | | | | | | NOTE 3: The | | | | | | length in | | | | | | bits of the | | | | | | plain data | | | | | | to cipher | | | | | | can be | | | | | | derived | | | | | | from the | | | | | | rules given | | | | | | in | | | | | | sub-clause | | | | | | 13.4.3 on a | | | | | | per RLC/MAC | | | | | | control | | | | | | message | | | | | | basis. | | | | | | | | | | | | NOTE 4: The | | | | | | values in | | | | | | _italic_ | | | | | | represent | | | | | | the range | | | | | | for a given | | | | | | parameter. | | | | | +-------------+-------------+----------+-------------+-------------+
The 17-bit TDMA Frame Number is constructed as follows:
* * *
Bit  
17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1 T1\' T2 T3
* * *
Figure 13.4.2.1.1: 17-bit TDMA Frame Number
T1\' (6 bits) range 0 to 63 = T1 mod 64.
T2 (5 bits) range 0 to 25 = FN mod 26 as defined in 3GPP TS 45.002.
T3 (6 bits) range 0 to 50 = FN mod 51 as defined in 3GPP TS 45.002.
where
T1 = FN div (26 x 51) as defined in 3GPP TS 45.002.
and
FN = TDMA frame number as defined in 3GPP TS 45.002.
#### 13.4.2.2 Handling of the HFN
##### 13.4.2.2.1 Ciphering in transparent RLC mode
The HFN is radio bearer specific. It shall obey the following rules for the
lifetime of the corresponding radio bearer:
\- It shall be incremented by 1 every time the TDMA Frame Number is smaller
than the previous one.
\- It shall also be incremented by 1 at every cell change.
Further handling of the HFN is described in 3GPP TS 44.118.
##### 13.4.2.2.2 Ciphering of RLC/MAC control messages
The HFN presented in table 13.3 shall obey the following rules:
\- It shall be reset to START value every time a new authentication is made.
\- During an RRC connection:
\- It shall be incremented by 1 every time the TDMA Frame Number is smaller
than the previous one.
\- It shall also be incremented by 1 at every cell change.
\- It shall be incremented by 1 at every new RRC connection and notified to
the network at RRC connection set-up see 3GPP TS 44.118.
### 13.4.3 Ciphering of RLC/MAC control messages
The following RLC/MAC control messages may be ciphered:
\- PACKET RESOURCE REQUEST, PACKET UPLINK ASSIGNMENT, MULTIPLE TBF UPLINK
ASSIGNMENT, PACKET DOWNLINK ASSIGNMENT, MULTIPLE TBF DOWNLINK ASSIGNMENT,
PACKET DBPSCH ASSIGNMENT, PACKET UPLINK ACK/NACK, PACKET DBPSCH UPLINK
ACK/NACK, PACKET DBPSCH UPLINK ACK/NACK TYPE 2, PACKET DOWNLINK ACK/NACK,
EGPRS PACKET DOWNLINK ACK/NACK, PACKET DBPSCH DOWNLINK ACK/NACK, PACKET DBPSCH
DOWNLINK ACK/NACK TYPE 2, PACKET TIMESLOT RECONFIGURE, MULTIPLE TBF TIMESLOT
RECONFIGURE, PACKET TBF RELEASE and PACKET CELL CHANGE ORDER, PHYSICAL
INFORMATION.
NOTE 1: This list should be updated according to the RLC/MAC development i.e.
if new messages are created or if some of the messages in this list are no
more applicable to _Iu mode_. The list of Fields and IEs in the table below
will also be updated according to the RLC/MAC development.
Within these messages, all CSN-1 syntax bits shall be kept unciphered.
Furthermore, the ciphering of these messages shall obey the rules given in
table 13.4.3.1.
NOTE 2: An informative annex will be introduced to illustrate an example of
ciphering of an RLC/MAC control message.
Table 13.4.3.1: Ciphering of RLC/MAC control messages
* * *
RLC/MAC Control Message Direction Fields and IEs that shall be kept unciphered
Packet Resource Request Uplink Message type, GLOBAL_TFI, Length of MS RA
capabilities, Length Packet Uplink Assignment Downlink Message type,
PAGE_MODE, PERSISTENCE_LEVEL, GLOBAL_TFI, TLLI/G-RNTI, G-RNTI extension, TQI,
Length of MA Frequency List contents, MA_LENGTH Multiple TBF Uplink Assignment
Downlink Message type, PAGE_MODE, PERSISTENCE_LEVEL, GLOBAL_TFI, TLLI/G-RNTI,
G-RNTI extension Packet Downlink Assignment Downlink Message type, PAGE_MODE,
PERSISTENCE_LEVEL, GLOBAL_TFI, TLLI/G-RNTI, G-RNTI extension, Length of MA
Frequency List contents, MA_LENGTH Multiple TBF Downlink Assignment Downlink
Message type, PAGE_MODE, PERSISTENCE_LEVEL, GLOBAL_TFI, TLLI/G-RNTI, G-RNTI
extension Packet DBPSCH Assignment Downlink Message type, PAGE_MODE,
PERSISTENCE_LEVEL, GLOBAL_TFI, G-RNTI Packet Uplink Ack/Nack Downlink Message
type, PAGE_MODE, UPLINK_TFI, CONTENTION_RESOLUTION_ G-RNTI, G-RNTI extension,
Extension length, COMPRESSED_BITMAP_LENGTH Packet DBPSCH Uplink Ack/Nack
Downlink Message type, RBId Packet DBPSCH Uplink Ack/Nack Type 2 Downlink
Message type, RBId Packet Downlink Ack/Nack Uplink Message type, DOWNLINK_TFI
EGPRS Packet Downlink Ack/Nack Uplink Message type, DOWNLINK_TFI, Extension
length, COMPRESSED_BITMAP_LENGTH Packet DBPSCH Downlink Ack/Nack Uplink
Message type, RBId Packet DBPSCH Downlink Ack/Nack Type 2 Downlink Message
type, RBId Packet Timeslot Reconfigure Downlink Message type, PAGE_MODE,
GLOBAL_TFI, Length of MA Frequency List contents, MA_LENGTH Multiple TBF
Timeslot Reconfigure Downlink Message type, PAGE_MODE, GLOBAL_TFI Packet TBF
Release Downlink Message type, PAGE_MODE, GLOBAL_TFI Packet Cell Change Order
Downlink Message type, PAGE_MODE, GLOBAL_TFI, TLLI/G-RNTI, G-RNTI extension,
NR_OF_REMOVED_FREQ, NR_OF_FREQUENCIES, FREQ_DIFF_LENGTH Physical Information
Downlink Message type
* * *
### 13.4.4 Ciphering of RLC PDUs in transparent RLC mode
Ciphering applies on the complete RLC PDUs.
# 14 RLC suspension, stop and re-establishment procedures
## 14.1 General
This sub-clause describes the following RLC procedures: suspend/resume,
stop/continue and re-establishment. These procedures are requested by RRC (see
3GPP TS 44.118), and are applicable in NT-RLC only. Suspend/resume is used
when e.g. ciphering parameters are changed. Stop/continue and re-establishment
are used during e.g. RB reconfiguration.
## 14.2 Local suspend/resume function (NT-RLC)
The upper layers may suspend/resume a RLC entity. Suspension of a RLC entity
is ordered through the CRLC‑SUSPEND-Req primitive (see sub-clause 4.3.3).
Resumption is ordered through the CRLC-RESUME-Req primitive (see sub-clause
4.3.3).
When a RLC entity operating in unacknowledged mode is suspended by upper
layers with the parameter N, the RLC entity shall:
\- acknowledge the suspend request through the CRLC-SUSPEND-Conf primitive
containing the current value of the send-state variable V(S);
\- not send any RLC data block with a \"Block Sequence Number\" BSN≥(V(S)+N)
modulo SNS;
\- send Packet Uplink/Downlink Dummy control blocks on allocated radio
resources if there is no other RLC/MAC control message to be sent.
When a RLC entity operating in acknowledged mode is suspended by upper layers
with the parameter N, the RLC entity shall:
\- acknowledge the suspend request through the CRLC-SUSPEND-Conf primitive
containing the current value of the send-state variable V(S);
\- not send any RLC data block with \"Block Sequence Number\" BSN ≥ (V(S) + N)
modulo SNS;
\- proceed with retransmission procedures for RLC data blocks with BSN \ \- continue the data transmission and reception from the stored state
> variables.
\- otherwise, if the RLC is not stopped:
\- take no action.
## 14.4 RLC re-establishment function (NT-RLC)
The RLC re-establishment function is applicable in NT-RLC only, on DBPSCHs
only.
The upper layers may re-establish a RLC entity. Re-establishment of a RLC
entity is ordered through the RLC-CONFIG-Req primitive (see sub-clause 4.3.3).
When a RLC entity is re-established by upper layers, the RLC entity shall:
\- reset the state variables to their initial value;
\- set the configurable parameters (e.g. EGPRS RLC window size) to their
configured value;
\- set the hyper frame number (HFN) in UL and DL to the value configured by
upper layers;
\- if the RLC entity is operating in unacknowledged mode:
\- if it is a receiving RLC entity:
\- discard all RLC data blocks (PDUs).
\- if it is a transmitting RLC entity:
\- discard the RLC SDUs for which one or more segments have been submitted to
the MAC layer.
\- otherwise if the RLC entity is operating in acknowledged mode:
\- discard all RLC data blocks (PDUs) and RLC/MAC control messages for this
RLC entity.
#
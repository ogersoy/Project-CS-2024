# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This document provides the stage 3 specification of the PC2 reference point.
The functional requirements and the stage 2 procedures of the PC2 reference
point are contained in 3GPP TS 23.303 [2]. The PC2 reference point lies
between the ProSe Function and ProSe Application Server.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[3] Void.
[4] IETF RFC 791: \"Transmission Control Protocol\".
[5] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[6] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[7] 3GPP TS 29.345: \"Inter-Proximity-services (ProSe) Function signalling
aspects; Stage 3\".
[8] IETF RFC 5719: \"Updated IANA Considerations for Diameter Command Code
Allocations\".
[9] IETF RFC 2234: \"Augmented BNF for syntax specifications\".
[10] 3GPP TS 24.334: \"Proximity-services (ProSe) User Equipment (UE) to
Proximity-services (ProSe) Function Protocol aspects; Stage 3\".
[11] IETF RFC 8583:"Diameter Load Information Conveyance".
[12] IETF RFC 6733: \"Diameter Base Protocol\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1]. The term definition in the present document has a
reference to that in 3GPP TS 23.303 [2].
**Announcing UE:** The UE that announces certain information that could be
monitored by UEs in proximity that have permission to discover.
**Discoveree UE:** The UE that receives the request message and responds with
certain information related to the discoverer UE\'s request.
**Discoverer UE:** The UE that transmits a request containing certain
information about what it is interested to discover.
**Monitoring UE:** The UE that monitors certain information of interest in
proximity of announcing UEs.
**EPC-level ProSe Discovery:** A ProSe Discovery procedure by which the EPC
determines the proximity of two ProSe-enabled UEs and informs them of their
proximity.
**Model A:** involves one UE announcing \"I am here\" in restricted ProSe
direct discovery.
**Model B:** involves one UE asking \"who is there\" and/or \"are you there\"
in restricted ProSe direct discovery.
**ProSe Discovery:** A process that identifies that a UE that is ProSe-enabled
is in proximity of another, using E-UTRA (with or without E-UTRAN) or EPC.
**ProSe Discovery UE ID:** A temporary identifier assigned by the ProSe
Function in the HPLMN to the UE for the restricted direct discovery service.
It includes the PLMN ID and a temporary identifier that uniquely identifies
the UE in the HPLMN.
**ProSe Function ID:** An FQDN that identifies a ProSe Function.
**Restricted ProSe Application User ID:** An identifier associated with the
Application Layer User ID in the ProSe Application Server in order to
hide/protect the application level user identity from the 3GPP layer. It
unambiguously identifies the user within a given application. The format of
this identifier is outside the scope of 3GPP.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
ACE Application-Controlled Extension
ALUID Application Layer User ID
AVP Attribute-Value Pair
EPUID EPC ProSe User ID
PDUID ProSe Discovery UE ID
PFID ProSe Function ID
ProSe Proximity-based Services
RPAUID Restricted ProSe Application User ID
# 4 PC2 reference point
## 4.1 PC2 reference model
Proximity Services (ProSe) are services that can be provided by the 3GPP
system based on UEs being in proximity to each other. The PC2 reference point
is located between the ProSe Application Server and the ProSe Function. It is
used to define the interaction between ProSe Application Server and ProSe
functionality provided by the 3GPP EPS via ProSe Function (e.g. name
translation) for open ProSe direct discovery, restricted ProSe direct
discovery and EPC-level ProSe discovery.
The stage 2 level requirements for the PC2 reference point are defined in 3GPP
TS 23.303 [2].The relationships between the functional entities are depicted
in Figure 4.1.1.
NOTE: For EPC-level ProSe discovery the roaming architecture is not specified
in this release.
Figure 4.1.1: PC2 reference point in ProSe Architecture
## 4.2 Functional elements
### 4.2.1 ProSe Function
The ProSe Function is the logical function that is used for network related
actions required for ProSe. The ProSe Function plays different roles for each
of the features of ProSe. In this version of the specification it is assumed
that there is only one logical ProSe Function in each PLMN that supports
Proximity Services.
Over PC2 reference point, the ProSe Function supports EPC-level discovery by
the following functionality:
\- Storage of a list of applications that are authorized to use EPC-level
ProSe Discovery.
\- Handling of EPC ProSe User IDs and Application Layer User IDs;
\- Exchange of signalling with 3^rd^ party Application Servers for application
registration and identifier mapping;
The ProSe Function also supports open ProSe direct discovery and restricted
ProSe direct discovery by the following functionality:
\- Generates and maintains the ProSe Discovery UE ID (PDUID) for restricted
ProSe direct discovery.
\- Initiates authorization of the discovery requests over PC2 reference point.
The ProSe Function provides the necessary charging and security functionality
for usage of ProSe via the EPC.
### 4.2.2 ProSe Application Server
The ProSe Application Server supports the following functionality:
\- Storage of EPC ProSe User IDs, ProSe Function IDs, ProSe Discovery UE ID,
metadata and RPAUIDs;
\- Mapping of Application Layer User IDs and EPC ProSe User IDs.
\- Mapping of RPAUID and PDUID for restricted ProSe direct discovery.
\- Maintaining permission information for the restricted ProSe direct
discovery using RPAUIDs;
\- Allocation of the ProSe Restricted Code Suffix pool, if restricted direct
discovery with application-controlled extension is used;
\- Allocation of the mask(s) for ProSe Restricted Code Suffix, if restricted
direct discovery with application-controlled extension is used;
\- Allocation of the mask(s) for ProSe Application Code Suffix, if open direct
discovery with application-controlled extension is used.
# 5 PC2 procedures
## 5.1 EPC-level ProSe discovery
### 5.1.1 Application registration for ProSe
#### 5.1.1.1 General Description
The application registration procedure is used by a ProSe Function serving the
originating UE to request the ProSe Application Server to register the UE's
Application Layer User ID (ALUID) with an EPC ProSe User ID (EPUID).
This procedure uses the Diameter commands ProXimity-Action-Request (PXR) and
ProXimity-Action-Answer (PXA) in the Diameter application as specified in
clause 6.
#### 5.1.1.2 Detailed description of the application registration for ProSe
procedure
The ProSe Function of the UE triggering the ProSe EPC-level discovery
application registration procedure shall send the ProXimity-Action-Request
(PXR) command to the ProSe Application Server of the specific application
requested by the UE in its initial Application Registration message. The ProSe
Function shall include in the request the ProSe-Request-Type AVP with the
value APPLICATION_REGISTRATION_FOR_PROSE (0), the Requesting-EPUID AVP with
the EPC ProSe User ID of the originating UE, the Origin-App-Layer-User-Id AVP
with the Application Layer User Identity of the originating UE, and the ProSe-
Function-ID AVP with the ProSe Function Identity of the originating UE.
When receiving a PXR command for application registration from a ProSe
Function, the ProSe Application Server shall process the request and respond
to the ProSe Function with a PXA command.
If the ProSe Application Server accepts the PXR command, it acknowledges the
reception of the PXR command for ProSe application registration and sets the
Result-Code AVP to \"SUCCESS\" in the PXA command. When receiving PXA from the
ProSe Application Server, the ProSe Function of the originating UE checks the
Result-Code AVP. If it indicates SUCCESS, the ProSe Function notifies the
originating UE, according to the ProSe EPC-level discovery application
registration procedure as specified in clause 7.2.3 of 3GPP TS 24.334 [10]. In
case of an unsuccessful application registration request, applicable value
defined in clause 6.7.3 shall be used to indicate the cause.
### 5.1.2 Proximity map request
#### 5.1.2.1 General
The Proximity map request procedure may be used by the ProSe Function to
request the EPC ProSe User identity for a targeted application user for which
the originating UE shall get alerts when in proximity of the targeted UE, and
the identity of the ProSe Function for this targeted UE as well. The identity
of the ProSe Function is used in the execution of the Proximity Request
procedure described in 3GPP TS 29.345 [7].
#### 5.1.2.2 Detailed description of the proximity map request procedure
To apply this procedure, the ProSe Function shall send a ProXimity-Action-
Request (PXR) command including the ProSe-Request-Type AVP with the value
PROSE_MAP_REQUEST (1), the Origin-App-Layer-User-ID AVP indicating the
application layer user identity of the originating UE and the Target-App-
Layer-User-ID AVP indicating the application layer user identity of the
targeted UE.
Upon reception of a PXR command including the Origin-App-Layer-User-ID AVP and
the Target-App-Layer-User-ID AVP, the ProSe Application Server shall determine
whether the originating UE is allowed to discover the targeted UE.
The ProSe Application Server shall then send a ProXimity-Action-Answer (PXA)
command including the Targeted-EPUID AVP and ProSe-Function-ID AVP indicating
the targeted UE and the corresponding ProSe Function ID respectively.\ In case
of an unsuccessful proximity map request, applicable value defined in clause
6.7.3 shall be used to indicate the cause.
## 5.2 Restricted ProSe direct discovery
### 5.2.1 Overview
Restricted ProSe direct discovery is a process that a UE detects and
identifies another UE in proximity using E-UTRA direct radio signals with
explicit permission of the UE that is being discovered. Detailed description
of ProSe direct discovery refers to 3GPP TS 23.303 [2] clause 5.3. There are
two models that restricted ProSe direct discovery applies:
Model A (\"I am here\")
Two roles of ProSe-enabled UEs are involved in this model: Announcing UE and
Monitoring UE. The announcing UE broadcasts discovery messages at pre-defined
discovery intervals and the monitoring UEs that are interested in these
messages read them and process them.
Model B (\"who is there?\" / \"are you there?\")
Two roles of ProSe-enabled UEs are involved in this model: Discoverer UE and
Discoveree UE. It is equivalent to \" who is there/are you there\" since the
discoverer UE sends information about other UEs that would like to receive
responses from, e.g. the information can be about a ProSe Application Identity
corresponding to a group and the members of the group can respond.
### 5.2.2 Authorization for Announce Request (model A)
#### 5.2.2.1 General Description
The announce authorization procedure (model A) is used by the ProSe Function
serving the originating UE to obtain announce authorization information
related to restricted ProSe direct discovery. The procedure is invoked by the
ProSe Function and is used for the following purposes:
\- to request the ProSe Application Server to map the UE\'s Restricted ProSe
Application User ID (RPAUID) to the corresponding ProSe Discovery UE ID(s)
(PDUID(s)) .
#### 5.2.2.2 Detailed description of the procedure
To apply this procedure, the ProSe Function of the UE triggering the
restricted ProSe direct discovery announce request procedure shall send the
ProXimity-Action-Request (PXR) command to the ProSe Application Server of the
specific application requested by the UE in its initial request message. The
ProSe Function shall include in the request the ProSe-Request-Type AVP with
the value AUTHORIZATION_ANNOUNCE (2) and the Requesting-RPAUID AVP with the
RPAUID assigned for this application to the originating UE.
When receiving a PXR command for announce authorization for restricted ProSe
direct discovery, the ProSe Application Server shall acknowledge the reception
of the PXR command and shall send a PXA command with the Result-Code AVP set
to \"SUCCESS\", with one or more PDUID AVPs set to each PDUID associated with
the requesting RPAUID. In case of an unsuccessful announce authorization
request for restricted ProSe direct discovery, applicable value defined in
clause 6.7.3 shall be used to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function of
the originating UE checks the Result-Code AVP. If it indicates SUCCESS, the
ProSe Function verifies that there exists one received PDUID belonging to the
requesting UE, and notifies the originating UE, according to the procedure
specified in 3GPP TS 24.334 [10].
### 5.2.3 Authorization for Announce Request with Application-controlled
extension (model A)
#### 5.2.3.1 General Description
The announce authorization procedure (model A) with application-controlled
extension is used by the ProSe Function serving the originating UE to obtain
announce authorization information related to restricted ProSe direct
discovery. The procedure is invoked by the ProSe Function and is used for the
following purposes:
\- to request the ProSe Application Server to map the UE\'s Restricted ProSe
Application User ID (RPAUID) to the corresponding ProSe Discovery UE ID(s)
(PDUID(s));
\- to request the ProSe Application Server to allocate ProSe Restricted Code
Suffix(es) for the RPAUID based on application layer information provided by
the UE.
#### 5.2.3.2 Detailed description of the procedure
To apply this procedure, the ProSe Function of the UE triggering the
restricted ProSe direct discovery announce request procedure shall send the
ProXimity-Action-Request (PXR) command to the ProSe Application Server of the
specific application requested by the UE in its initial request message, the
PXR command shall include the ProSe-Request-Type AVP with the value
AUTHORIZATION_ANNOUNCE_ACE (3), the Requesting-RPAUID AVP with the RPAUID
assigned for this application to the originating UE, the Application-Data AVP
with the data contained in the Application Level Container parameter in the
initial request message from the originating UE, and the Allowed-Suffix-Number
AVP with the allowed number of suffixes provisioned based on operator policy
for this application.
When receiving a PXR command for announce authorization for restricted ProSe
direct discovery with application controlled extension, the ProSe Application
Server shall first check if the application supports application-controlled
extension. If yes, the ProSe Application Server shall assign the ProSe
Restricted Code Suffix(es) for the requesting RPAUID based on the Application-
Data AVP. The number of ProSe Restricted Code Suffixes allocated shall not
exceed the value in Allowed-Suffix-Number AVP in the PXR command. The ProSe
Application Server shall then send a ProXimity-Action-Answer (PXA) command
including the PDUID(s) associated with the requesting RPAUID in one or more
PDUID AVP(s), and one or more ProSe-Restricted-Code-Suffix-Range AVP(s)
indicating the assigned ProSe Restricted Code Suffix(es). In case of an
unsuccessful announce authorization request for restricted ProSe direct
discovery with application-controlled extension, applicable value defined in
clause 6.7.3 shall be used to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function of
the originating UE checks the Result-Code AVP. If it indicates SUCCESS, the
ProSe Function verifies that there exists one received PDUID belonging to the
requesting UE, and notifies the originating UE, according to the procedure
specified in 3GPP TS 24.334 [10].
### 5.2.4 Authorization for Monitor Request (model A)
#### 5.2.4.1 General Description
The authorization for monitor request procedure is used by the ProSe Function
serving the originating UE to obtain monitor authorization information related
to restricted ProSe direct discovery. The procedure is invoked by the ProSe
Function and is used:
\- to request the ProSe Application Server to select eligible target RPAUIDs
from the application layer data enclosed in the monitoring request from the
originating UE and provide the corresponding PDUIDs for those target RPAUIDs .
#### 5.2.4.2 Detailed description of the procedure
To apply this procedure, the ProSe Function serving the monitoring UE shall
send a ProXimity-Action-Request (PXR) command including the ProSe-Request-Type
AVP with the value AUTHORIZATION_MONITOR (4), the Requesting-RPAUID AVP
indicating the restricted ProSe Application User ID of the monitoring UE, and
the Application-Data AVP with the data contained in the Application Level
Container parameter in the initial request message from the originating UE.
When receiving a PXR command for monitor authorization for restricted ProSe
direct discovery, the ProSe Application Server shall examine the Application-
Data AVP and determine which target RPAUID(s) the requesting RPAUID is allowed
to discover based on application-specific permissions. The ProSe Application
Server shall then acknowledge the reception via a PXA command, set the Result-
Code AVP to \"SUCCESS\" in the PXA command, include the PDUID(s) associated
with the requesting RPAUID in PDUID AVP(s) in the PXA command, and one or more
Monitor-Target AVP(s), each of which contains the target RPAUID that the
requesting RPAUID is allowed to discover as well as the corresponding PDUID.
If there is metadata associated with a target RPAUID, the ProSe Application
Server shall also include the Metadata-Indicator in the corresponding Monitor-
Target AVP. The ProSe Function shall include the Application-Data AVP with the
successfully authenticated Target RPAUID(s), too. In case of an unsuccessful
monitor authorization request for restricted ProSe direct discovery,
applicable value defined in clause 6.7.3 shall be used to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function of
the originating UE checks the Result-Code AVP. If it indicates SUCCESS, the
ProSe Function verifies that there exists one received PDUID belonging to the
requesting UE, and notifies the originating UE, according to the procedure
specified in 3GPP TS 24.334 [10].
### 5.2.5 Authorization for Monitor Request with Application-controlled
Extension (model A)
#### 5.2.5.1 General Description
The authorization for monitor request with application-controlled extension
procedure is used by the ProSe Function serving the originating UE to obtain
monitor authorization information related to restricted ProSe direct discovery
with application-controlled extension. The procedure is invoked by the ProSe
Function and is used:
\- to request the ProSe Application Server to select eligible target RPAUIDs
from the application layer data enclosed in the monitoring request from the
originating UE and provide the corresponding PDUIDs for those target RPAUIDs;
and
\- to request the ProSe Application Server to allocate \"masks\" for the ProSe
Restricted Code Suffix for the target RPAUID based on application layer
information provided by the originating UE, if restricted discovery with
application-controlled extension is used .
#### 5.2.5.2 Detailed description of the procedure
To apply this procedure, the ProSe Function serving the monitoring UE shall
send a ProXimity-Action-Request (PXR) command including the ProSe-Request-Type
AVP with the value AUTHORIZATION_MONITOR_ACE (5), the Requesting-RPAUID AVP
with the RPAUID assigned for this application to the originating UE, and the
Application-Data AVP with the data contained in the Application Level
Container parameter in the initial request message from the originating UE.
When receiving a PXR command for monitor authorization for restricted ProSe
direct discovery with application-controlled extension, the ProSe Application
Server shall examine the Application-Data AVP and determine which target
RPAUID(s) the requesting RPAUID is allowed to discover based on application-
specific permissions. The ProSe Application Server shall then acknowledge the
reception via a PXA command, sets the Result-Code AVP to \"SUCCESS\" in the
PXA command, include the PDUID associated with the requesting RPAUID in PDUID
AVP in the PXA command, and one or more Monitor-Target AVP(s), each of which
contains the target RPAUID that the requesting RPAUID is allowed to discover
as well as the corresponding PDUID. If there is metadata associated with a
target RPAUID, the ProSe Application Server shall also include the Metadata-
Indicator in the corresponding Monitor-Target AVP. The ProSe Application
Server shall also include the ProSe Restricted Code Suffix Masks in each
Monitor-Target AVP. The ProSe Function shall include the Application-Data AVP
with the successfully authenticated Target RPAUID(s), too. In case of an
unsuccessful monitor authorization request for restricted ProSe direct
discovery, applicable value defined in clause 6.7.3 shall be used to indicate
the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function of
the originating UE checks the Result-Code AVP. If it indicates SUCCESS, the
ProSe Function verifies that there exists one received PDUID belonging to the
requesting UE, and notifies the originating UE, according to the procedure
specified in 3GPP TS 24.334 [10].
### 5.2.6 Authorization for Discovery Permission (model A)
#### 5.2.6.1 General
The discovery permission authorization procedure is used by the ProSe Function
to verify the application layer permission for restricted discovery model A
between a requesting application user and a target application user, which are
represented, respectively, by the requesting RPAUID and the target RPAUID.
#### 5.2.6.2 Detailed description of the procedure
To apply this procedure, the ProSe Function shall send a PXR command including
the ProSe-Request-Type AVP with the value
RESTRICTED_DISCOVERY_MONITOR_PERMISSION (6), the Requesting-RPAUID AVP
indicating, respectively, the RPAUID of the originating UE and the Target-
RPAUID AVP indicating the RPAUID of the targeted UE.
Upon reception of a PXR command including the Requesting-RPAUID AVP and the
Target-RPAUID AVP, the ProSe Application Server shall determine whether the
application user of the originating UE is allowed to discover the application
user of the targeted UE. If it is allowed, the ProSe Application Server shall
then acknowledge the reception of the PXR command by sending the PXA command
with the Result-Code AVP set to \"SUCCESS\" and the target-PDUID AVP(s) set to
the PDUID(s) of the targeted application user. In case of an unsuccessful
permission authorization request, an applicable value defined in clause 6.7.3
shall be used to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function
checks the Result-Code AVP. If it indicates SUCCESS, the ProSe Function
notifies the ProSe Function of the originating UE, according to the procedure
specified in 3GPP TS 29.345 [7].
### 5.2.7 Authorization for Match Report (model A/model B)
#### 5.2.7.1 General Description
This procedure is used by the ProSe Function serving the monitoring UE (in
model A) or discoverer UE (in model B) to obtain authorization information
related to Match Report in restricted ProSe Direct Discovery.
#### 5.2.7.2 Detailed description of the procedure
To apply this procedure, the ProSe Function shall send a ProXimity-Action-
Request (PXR) command including the ProSe-Request-Type AVP with the value
AUTHORIZATION_MATCH_REPORT (9), the Requesting-RPAUID AVP indicating the
restricted ProSe Application User ID of the requesting UE and the Target-
RPAUID AVP indicating the target restricted ProSe Application User ID.
Upon reception of the PXR command, the ProSe Application Server shall
determine whether the restricted ProSe Application User ID within Requesting-
RPAUID AVP is allowed to discover the target restricted ProSe Application User
ID within Target-RPAUID AVP.
The ProSe Application Server shall then send a ProXimity-Action-Answer (PXA)
command including the PDUID AVP(s) indicating the PDUID(s) associated with the
RPAUID of the requesting UE, the Target-PDUID AVP(s) indicating the PDUID(s)
associated with the target RPAUID, and optionally the ProSe-Application-
Metadata AVP indicating certain metadata corresponding to the target RPAUID,
such as welcome message.
In case of an unsuccessful authorization for Match Report Request, an
applicable value defined in clause 6.7.3 shall be used to indicate the cause.
NOTE: The application logic in the ProSe Application Server triggered by the
Diameter PXR command in this procedure is out of the scope of 3GPP.
When receiving PXA from the ProSe Application Server, the ProSe Function
checks the Result-Code AVP. If it indicates SUCCESS, the ProSe Function shall
verify that there exists one received PDUID belonging to the requesting UE,
and the target PDUID(s) are the same as the stored target PDUID(s) for the
target RPAUID. If the ProSe-Application-Metadata AVP has been included in the
PXA command, and the Metadata -Indicator (see subclauses 5.2.4.2 and 5.2.5.2)
associated with the target RPAUID indicates METADATA_UPDATE_ALLOWED, the ProSe
Function shall not cache the received metadata as the latest metadata for this
target RPAUID. If the check of PDUID(s) is successful, ProSe Function notifies
the originating UE, according to the procedure specified in 3GPP TS 24.334
[10].
### 5.2.8 Authorization for Discoveree Request (model B)
#### 5.2.8.1 General Description
This procedure may be used by the ProSe Function serving the Discoveree UE to
obtain authorization information of the Discoveree UE related to Discoveree
Request in restricted ProSe direct discovery.
#### 5.2.8.2 Detailed description of the procedure
The procedure in clause 5.2.4.2 shall be applied, with the only exception that
the ProSe-Request-Type AVP included in PXR and PXA messages shall be set with
the value AUTHORIZATION_RESPONSE (7).
### 5.2.9 Authorization for Discoverer Request (model B)
#### 5.2.9.1 General Description
This procedure is used by the ProSe Function serving the Discoverer UE to
obtain authorization information of the Discoverer UE related to Discoverer
Request in restricted ProSe Direct Discovery.
#### 5.2.9.2 Detailed description of the procedure
The procedure in clause 5.2.4.2 shall be applied, with the only exception that
the ProSe-Request-Type AVP included in PXR and PXA messages shall be set with
the value AUTHORIZATION_QUERY (8).
### 5.2.10 Authorization for Discovery Permission (model B)
#### 5.2.10.1 General Description
The discovery permission authorization procedure is used by the ProSe Function
to verify the application layer permission for restricted discovery model B
between a requesting application user and a target application user, which are
represented, respectively, by the requesting RPAUID and the target RPAUID.
#### 5.2.10.2 Detailed description of the procedure
The procedure in clause 5.2.6.2 shall be applied, with the only exception that
the ProSe-Request-Type AVP included in PXR and PXA messages shall be set with
the value QUERY_PERMISSION (10).
### 5.2.11 Discovery Authorization Update
#### 5.2.11.1 General Description
The discovery authorization update procedure is used by the ProSe Application
Server to request the Prose Function serving the UE which has revoked
permissions related to other users, to take actions to update the ProSe
Restricted Code or Restricted Discovery Filters to prevent the banned users
(users whose permissions have been revoked) from discovering the announcing
user.
This procedure uses the Diameter commands ProXimity-Application-Request
(XAR)/ProXimity-Application-Answer (XAA), and ProXimity-Action-Request
(PXR)/ProXimity-Action-Answer (PXA) in the respective Diameter applications as
specified in subclause 6.
#### 5.2.11.2. Detailed description of the discovery authorization update
procedure
The ProSe Application Server shall send the ProXimity-Application-Request
(XAR) command to the ProSe Function serving the UE which has announced the
RPAUID whose discovery permissions related to other users has been revoked.
The identity of this ProSe Function is found by the ProSe Application Server
by mapping the RPAUID to a PDUID. If multiple PDUIDs have been found to be
used for this RPAUID, the procedure shall be invoked multiple times, for each
ProSe Function to which the PDUID belongs.
The ProSe Application Server shall include in the request the ProSe-Request-
Type AVP with the value AUTHORIZATION_UPDATE (11), the Requesting-RPAUID AVP
with the RPAUID which originated this application-layer permission change, and
one or more Banned-User-Target AVP identifying the RPAUID(s) whose discovery
permissions have been revoked and the corresponding PDUID(s).
When receiving an XAR command for authorization update for restricted ProSe
direct discovery, the ProSe Function shall examine the RPAUID AVP and locate
the UE context which stores the allocated ProSe Restricted Code for this
RPAUID. If this check is successful, the ProSe Function shall then acknowledge
the reception of the XAR command, set the Result-Code AVP to \"SUCCESS\" in
the XAA command, and include the ProSe-Request Type AVP set to the same value
as that included in the XAR command. In case of an unsuccessful request, an
applicable value defined in subclause 6.7.3 shall be used to indicate the
cause.
Then the ProSe Function shall check the Banned-User-Target AVP(s) (i.e. ,
blacklist users) and compare it with all RPAUIDs which are currently
authorized for monitoring the RPAUID being announced (i.e. , white-list
users). If the black-list users and white-list users have no overlapping, the
procedure is completed and no further action needs to be taken. Otherwise, the
ProSe Function shall either allocate a new ProSe Restricted Code and notify
the still-eligible white-list users, or revoke the Restricted Discovery
Filters for the white-list users who have been banned. Depending on the
action, the corresponding procedures described in 3GPP TS 29.345 [7] are to be
invoked.
When receiving XAA from the ProSe Function, the ProSe Application Server shall
check if the Result-Code AVP indicates SUCCESS. If it indicates SUCCESS, the
ProSe Application Server shall wait for the result of this discovery
authorization update.
After a time configured by the operator, the ProSe Function of the UE
announcing the requesting RPAUID shall send the ProXimity-Action-Request (PXR)
command to notify the ProSe Application Server of the specific application
requested by the UE in its initial request message, about the result of
discovery update process. The ProSe Function shall include in the request the
ProSe-Request-Type AVP with the value AUTHORIZATION_UPDATE (11) and the
Requesting-RPAUID AVP with the RPAUID of the announcing UE involved in this
discovery authorization update, and one or more Banned-User-Target AVPs
including the RPAUID-PDRID pairs which have been successfully banned from
discovering the requesting RPAUID.
When receiving a PXR command for discovery authorization update for restricted
ProSe direct discovery, the ProSe Application Server shall acknowledge the
reception of the PXR command and shall send a PXA command with the Result-Code
AVP set to \"SUCCESS\". In case of an unsuccessful discovery authorization
update result notification for restricted ProSe direct discovery, applicable
value defined in subclause 6.7.3 shall be used to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function
checks the Result-Code AVP to see if it indicates SUCCESS.
## 5.3 Open ProSe direct discovery
### 5.3.1 Authorization for Announce Request with Application-controlled
extension
#### 5.3.3.1 General Description
The announce authorization procedure with application-controlled extension is
used by the ProSe Function serving the originating UE to obtain announce
authorization information related to open ProSe direct discovery. The
procedure is invoked by the ProSe Function and to request the ProSe
Application Server to allocate ProSe Application Code Suffix(es) for the ProSe
Application ID based on application layer information provided by the UE.
#### 5.3.3.2 Detailed description of the procedure
To apply this procedure, the ProSe Function of the UE triggering the open
ProSe direct discovery announce request procedure shall send the ProXimity-
Action-Request (PXR) command to the ProSe Application Server of the specific
application requested by the UE in its initial request message, the PXR
command shall include the ProSe-Request-Type AVP with the value
AUTHORIZATION_ANNOUNCE_ACE_OPEN (12), the ProSe-Application-ID AVP with the
ProSe Application ID requested by the application in the originating UE, the
Application-Data AVP with the data contained in the Application Level
Container parameter in the initial request message from the originating UE,
and the Allowed-Suffix-Number AVP with the allowed number of suffixes
provisioned based on operator policy for this application.
When receiving a PXR command for announce authorization for open ProSe direct
discovery with application-controlled extension, the ProSe Application Server
shall first check if the application supports application-controlled
extension. If yes, the ProSe Application Server shall assign the ProSe
Application Code Suffix(es) for the requesting ProSe Application ID based on
the Application-Data AVP. The number of ProSe Application Code Suffixes
allocated shall not exceed the value in Allowed-Suffix-Number AVP in the PXR
command. The ProSe Application Server shall then send a ProXimity-Action-
Answer (PXA) command including one or more ProSe-Application-Code-Suffix-Range
AVP(s) indicating the assigned ProSe Application Code Suffix(es). In case of
an unsuccessful announce authorization request for open ProSe direct discovery
with application-controlled extension, applicable value defined in clause
6.7.3 shall be used to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function of
the originating UE checks the Result-Code AVP. If it indicates SUCCESS, the
ProSe Function notifies the originating UE, according to the procedure
specified in 3GPP TS 24.334 [10].
### 5.3.2 Authorization for Monitor Request with Application-controlled
Extension
#### 5.3.2.1 General Description
The authorization for monitor request with application-controlled extension
procedure is used by the ProSe Function serving the originating UE to obtain
monitor authorization information related to restricted ProSe direct discovery
with application-controlled extension. The procedure is invoked by the ProSe
Function and is used:to request the ProSe Application Server to allocate
\"masks\" for the ProSe Application Code Suffix for the monitored ProSe
Application ID based on application layer information provided by the
originating UE, if open discovery with application-controlled extension is
used.
#### 5.3.2.2 Detailed description of the procedure
To apply this procedure, the ProSe Function serving the monitoring UE shall
send a ProXimity-Action-Request (PXR) command including the ProSe-Request-Type
AVP with the value AUTHORIZATION_MONITOR_ACE_OPEN (13), the ProSe Application
ID AVP with the ProSe Application ID requested by the application in the
originating UE, and the Application-Data AVP with the data contained in the
Application Level Container parameter in the initial request message from the
originating UE.
When receiving a PXR command for monitor authorization for open ProSe direct
discovery with application-controlled extension, the ProSe Application Server
shall examine the Application-Data AVP and determine proper ProSe Application
Code Suffix Masks matching the data enclosed in the Application-Data AVP.
Then, the ProSe Application Server shall then acknowledge the reception via a
PXA command, sets the Result-Code AVP to \"SUCCESS\" in the PXA command,
include one or more ProSe Application Code Suffix Masks in ProSe-Code-Suffix-
Mask AVP(s). In case of an unsuccessful monitor authorization request for open
ProSe direct discovery, applicable value defined in clause 6.7.3 shall be used
to indicate the cause.
When receiving PXA from the ProSe Application Server, the ProSe Function of
the originating UE checks the Result-Code AVP. If it indicates SUCCESS, the
ProSe Function notifies the originating UE, according to the procedure
specified in 3GPP TS 24.334 [10].
# 6 PC2 protocol
## 6.1 Protocol Support
### 6.1.1 Use of Diameter base protocol
The Diameter base protocol as specified in IETF RFC 6733 [12] shall apply
except as modified by the defined support of the methods and the defined
support of the commands and AVPs, result and error codes as specified in this
specification. Unless otherwise specified, the procedures specified in IETF
RFC 6733 [12] (including error handling and unrecognised information handling)
shall be used unmodified. Only commands related to peer-to-peer connection are
re-used from the Diameter base protocol (IETF RFC 6733 [12]), i.e.
Capabilities-Exchange-Request (CER), Capabilities-Exchange-Answer (CEA),
Disconnect-Peer-Request (DPR), Disconnect-Peer-Answer (DPA), Device-Watchdog-
Request (DWR) and Device-Watchdog-Answer (DWA).
With regards to the Diameter protocol defined over the PC2 interface, the
ProSe Application Server shall act as the Diameter server, in the sense that
it is the network element that handles action requests. The ProSe Function
shall act as the Diameter client, in the sense that it is the network element
requesting actions.
A Diameter routing table entry can have a different destination based on the
application identifier of the command. The application identifier stored in
the command header must match the value of any application identifier AVPs in
the command body. Diameter agents (relay, proxy, redirection, translation
agents) should use the application identifier in the command header to route
to a suitable destination.
### 6.1.2 Transport protocol
Diameter messages over the PC2 interface shall make use of TCP IETF RFC 791
[4] or SCTP IETF RFC 4960 [5].
### 6.1.3 Advertising Application Support
The Diameter application identifier assigned to the PC2 interface application
in the present release is 16777350.
NOTE: The PC2 interface application identifier 16777337 is used in Release 12
document where only the usage PXR/PXA is specified. For backward
compatibility, the ProSe Applicaiton Server in releases later than Rel-12 is
encouraged to also support the Rel-12 version of this specification and the
old application ID 16777337.
The ProSe Application Server and ProSe Function shall advertise support of the
Diameter PC2 applications by including the value of the PC2 application
identifiers in the Auth-Application-Id AVP within the Vendor-Specific-
Application-Id grouped AVP of the CER and CEA commands.
The vendor identifier value of 3GPP (10415) shall be included in the
Supported-Vendor-Id AVP of the CER and CEA commands, and in the Vendor-Id AVP
within the Vendor-Specific-Application-Id grouped AVP of the CER and CEA
commands.
The Vendor-Id AVP included in CER and CEA commands that is not included in the
Vendor-Specific-Application-Id AVPs as described above shall indicate the
manufacturer of the Diameter node as per IETF RFC 6733 [12].
## 6.2 Initialization and maintenance of connection and session
A peer-to-peer connection is a connection between ProSe Application Server and
ProSe Function.
A PC2 Diameter session shall consist of a single request and answer pair. The
PC2 Diameter session is terminated after each request and answer pair
interaction. In order to indicate that the session state is not to be
maintained, the Diameter client and server shall include the Auth-Session-
State AVP with the value set to NO_STATE_MAINTAINED (1), in the request and in
the answer messages (see IETF RFC 6733 [12]).
## 6.3 Security over PC2 reference point
Security aspects of ProSe PC2 reference point are defined in 3GPP TS 33.303
[6].
## 6.4 PC2 specific AVPs
### 6.4.1 General
Table 6.4.1-1 describes the Diameter AVPs defined for the PC2 reference point,
their AVP Code values, types and possible flag values. The Vendor-Id header of
all AVPs defined in the present document shall be set to 3GPP (10415).
Table 6.4.1-1: PC2 specific Diameter AVPs
* * *
                                                                                                                                                                                                                                                                                                             AVP Flag rules (Note)
Attribute Name AVP Code Clause defined Value Type Must May Should not Must not
Origin-App-Layer-User-Id 3600 6.4.2 UTF8String M,V P  
Target-App-Layer-User-Id 3601 6.4.3 UTF8String M,V P  
ProSe-Function-ID 3602 6.4.4 OctetString M,V P  
ProSe-Request-Type 3603 6.4.5 Unsigned32 M,V P  
PDUID 3604 6.4.6 OctetString V P M Application-Data 3605 6.4.7 UTF8String V P
M Allowed-Suffixes-Number 3606 6.4.8 Unsigned32 V P M Monitor-Target 3607
6.4.9 Grouped V P M ProSe-Code-Suffix-Mask 3608 6.4.10 Grouped V P M Suffix-
Code 3609 6.4.11 OctetString V P M Suffix-Mask 3610 6.4.12 OctetString V P M
Banned-User-Target 3611 6.4.17 Grouped V P M Metadata-Indicator 3612 6.4.18
Unsigned32 V P M NOTE : The AVP header bit denoted as \'M\', indicates whether
support of the AVP is required. The AVP header bit denoted as \'V\', indicates
whether the optional Vendor-ID field is present in the AVP header. For further
details, see IETF RFC 6733 [12].
* * *
### 6.4.2 Origin-App-Layer-User-Id AVP
The Origin-App-Layer-User-Id AVP (AVP code 3600) is of type UTF8String, and it
contains an identity identifying an origin user within the context of a
specific application (e.g. alice\@social.net).
### 6.4.3 Target-App-Layer-User-Id AVP
The Target-App-Layer-User-Id AVP (AVP code 3601) is of type UTF8String, and it
contains an identity identifying a target user within the context of a
specific application (e.g. tommy\@social.net).
### 6.4.4 ProSe-Function-ID AVP
The ProSe-Function-ID AVP (AVP code 3602) is of type OctetString, and it
indicates an FQDN that identifies a ProSe Function.
### 6.4.5 ProSe-Request-Type AVP
The ProSe-Request-Type AVP (AVP code 3603) is of type Unsigned32, and contains
the reason for sending the PX-Request message or XA-Request message.
The following values are defined:
0 (APPLICATION_REGISTRATION_FOR_PROSE):
The ProXimity-Action-Request message is sent to initiate an application
registration for ProSe procedure.
1 (PROSE_MAP_REQUEST):
The ProXimity-Action-Request message is sent to initiate a Proximity map
request procedure.
2 (AUTHORIZATION_ANNOUNCE):
The ProXimity-Action-Request message is sent to initiate an announce
authorization procedure for restricted discovery.
3 (AUTHORIZATION_ANNOUNCE_ACE):
The ProXimity-Action-Request message is sent to initiate an announce
authorization procedure for restricted discovery with application-controlled
extension.
4 (AUTHORIZATION_MONITOR):
The ProXimity-Action-Request message is sent to initiate a monitor
authorization procedure for restricted discovery.
5 (AUTHORIZATION_MONITOR_ACE):
The ProXimity-Action-Request message is sent to initiate a monitor
authorization procedure for restricted discovery with application-controlled
extension.
6 (MONITOR_PERMISSION):
The ProXimity-Action-Request message is sent to initiate an inquiry for the
discovery permissions between two RPAUIDs used in restricted ProSe direct
discovery monitoring model A.
7 (AUTHORIZATION_RESPONSE):
The ProXimity-Action-Request message is sent to initiate an authorization for
Discoveree Request procedure.
8 (AUTHORIZATION_QUERY):
The ProXimity-Action-Request message is sent to initiate an authorization for
Discoverer Request procedure.
9 (AUTHORIZATION_MATCH_REPORT):
The ProXimity-Action-Request message is sent to initiate an authorization for
Match Report procedure in model A or model B.
10 (QUERY_PERMISSION)
The ProXimity-Action-Request message is sent to initiate an inquiry for the
discovery permissions between two RPAUIDs used in restricted ProSe direct
discovery model B discoverer operation.
11 (AUTHORIZATION_UPDATE)
The ProXimity-Action-Request message or ProXimity-Application-Request message
is sent for the purpose of discovery authorization update.
12 (AUTHORIZATION_ANNOUNCE_ACE_OPEN):
The ProXimity-Action-Request message is sent to initiate an announce
authorization procedure for open discovery with application-controlled
extension.
13 (AUTHORIZATION_MONITOR_ACE_OPEN):
The ProXimity-Action-Request message is sent to initiate a monitor
authorization procedure for open discovery with application-controlled
extension.
### 6.4.6 PDUID AVP
The PDUID AVP (AVP code 3604) is of type OctetString, and it indicates a ProSe
Discovery UE ID that identifies a UE identity used in restricted ProSe direct
discovery.
### 6.4.7 Application-Data AVP
The Application-Data AVP (AVP code 3605) is of type UTF8String, and it
contains
\- a list of target RPAUIDs of UEs in restricted ProSe Direct Discovery for
monitoring or query requests.
\- information related to suffix allocation for an announcing UE when
application-controlled extension is used.
\- a list of successfully authenticated target RPAUIDs of UEs in restricted
ProSe Direct Discovery.
### 6.4.8 Allowed-Suffixes-Number AVP
The Allowed-Suffixes-Number AVP (AVP code 3606) is of type Unsigned32, and it
indicates the maximum number of suffix codes which are used as part of ProSe
Application Code or ProSe Restricted Code that the ProSe Application Server
can assign to the UE for a ProSe Appplication ID or an RPAUID.
### 6.4.9 Monitor-Target AVP
The Monitor-Target AVP (AVP code 3607) is of type Grouped. It contains a
Target-RPAUID, a PDUID and zero or more ProSe Code Suffix Mask(s).
The AVP format shall conform to:
Monitor-Target ::= \
{ Target-RPAUID }
{ PDUID }
[ Metadata-Indicator ]
*[ ProSe-Code-Suffix-Mask ]
*[AVP]
If the Metadata-Indicator value is \"0 (NO_METADATA)\", the Metadata-Indicator
AVP may be omitted.
### 6.4.10 ProSe- Code-Suffix-Mask AVP
The ProSe-Code-Suffix-Mask AVP (AVP code 3608) is of type Grouped. It contains
a suffix code and one or more suffix mask(s), each of which has the same size
as the suffix code.
The AVP format shall conform to:
ProSe-Code-Suffix-Mask ::= \
{ Suffix-Code }
1*{ Suffix-Mask }
*[AVP]
### 6.4.11 Suffix-Code AVP
The Suffix-Code AVP (AVP code 3609) is of type OctetString. It contains a
suffix code which shall be used as either the allocated ProSe Application Code
Suffix or ProSe Restricted Code Suffix, or a matching target for the suffix
part of a ProSe Application Code or ProSe Restricted Code.
### 6.4.12 Suffix-Mask AVP
The Suffix-Mask AVP (AVP code 3610) is of type OctetString. It contains a
suffix mask which shall be used as a bitmask for matching the target suffix
code in the suffix part of a ProSe Application Code or ProSe Restricted Code.
### 6.4.13 Void
### 6.4.14 Void
### 6.4.15 Void
### 6.4.16 Void
### 6.4.17 Banned-User-Target AVP
The Banned-User-Target AVP (AVP code 3611) is of type Grouped. It contains a
Target-RPAUID and a Target-PDUID.
The AVP format shall conform to:
Banned-User-Target ::= \
{ Target-RPAUID }
{ Target-PDUID }
*[AVP]
### 6.4.18 Metadata-Indicator AVP
The Metadata-Indicator AVP (AVP code 3612) is of type Unsigned32, and contains
the options for metadata associated with a particular target RPAUID. The
following values are defined:
0 (NO_METADATA):
This value may be used to indicate that there is no metadata associated with
the target RPAUID. This is the default value applicable if this AVP is not
supplied.
1 (METADATA_UPDATE_DISALLOWED):
This value shall be used to indicate that there exists metadata associated
with the target RPAUID, but the metadata is not allowed to be updated.
2 (METADATA_UPDATE_ALLOWED):
This value shall be used to indicate that there exists metadata associated
with the target RPAUID, and the metadata is allowed to be updated.
## 6.5 PC2 re-used AVPs
Table 6.5.1-1 lists the Diameter AVPs re-used by the PC2 reference point from
existing Diameter Applications, reference to their respective specifications
and a short description of their usage within the PC2 reference point. Other
AVPs from existing Diameter Applications, except for the AVPs from the
Diameter base protocol specified in IETF RFC 6733 [12], do not need to be
supported. The AVPs from the Diameter base protocol specified in IETF RFC 6733
[12] are not included in Table 6.5.1-1, but they are re-used for the PC2
reference point. Unless otherwise stated, re-used AVPs shall maintain their
\'M\', \'P\' and \'V\' flag settings.
Table 6.5.1-1: PC2 re-used Diameter AVPs
* * *
Attribute Name Reference Description Load IETF RFC 8583 [11] The AVP used to
convey load information between Diameter nodes. This AVP and all AVPs within
this grouped AVP shall have the 'M' bit cleared. Requesting-EPUID 3GPP TS
29.345 [7] Contains an identifier for EPC-level ProSe Discovery that uniquely
identifies a UE registered for ProSe triggering a Proximity request. Targeted-
EPUID 3GPP TS 29.345 [7] Contains an identifier for EPC-level ProSe Discovery
that uniquely identifies a UE registered for ProSe targeted by a Proximity
request. ProSe-Restricted-Code-Suffix-Range 3GPP TS 29.345 [7] Contains a
range of suffixes which can be used for restricted ProSe direct discovery
announcing when application-controlled extension is used. ProSe-Application-
Code-Suffix-Range 3GPP TS 29.345 [7] Contains a range of suffixes which can be
used for open ProSe direct discovery announcing when application-controlled
extension is used. ProSe-App-Id 3GPP TS 29.345 [7] Contains an ProSe
Application ID associated with the announcing or monitoring request for open
ProSe direct discovery with application-controlled extension. Requesting-
RPAUID 3GPP TS 29.345 [7] Contains a Restricted ProSe Application User ID
associated with the requesting UE for the announcing or monitoring request for
restricted ProSe direct discovery. Target-RPAUID 3GPP TS 29.345 [7] Contains a
Restricted ProSe Application User ID of the target UE associated with the
monitoring request for restricted ProSe direct discovery. Target-PDUID 3GPP TS
29.345 [7] Contains a ProSe Discovery User ID of the target UE associated with
the monitoring request for restricted ProSe direct discovery. ProSe-
Application-Metadata 3GPP TS 29.345 [7] Contains the metadata corresponding to
the target RPAUID for restricted ProSe direct discovery, such as welcome
message.
* * *
## 6.6 PC2 messages
### 6.6.1 Command-Code Values
This section defines the Command-Code values for the PC2 interface application
as allocated by IANA from the vendor-specific namespace defined in IETF RFC
5719 [8]. Every command is defined by means of the ABNF syntax in IETF RFC
2234 [9], and according to the Command Code Format (CCF) specification defined
in IETF RFC 6733 [12].
The following Command Codes are defined in this specification:
Table 6.6.1.1: Command-Code values for PC2
* * *
Command-Name Abbreviation Code Section ProXimity-Action-Request PXR 8388676
6.6.2 ProXimity-Action-Answer PXA 8388676 6.6.3 ProXimity-Application-Request
XAR 8388727 6.6.4 ProXimity-Application-Answer XAA 8388727 6.6.5
* * *
### 6.6.2 ProXimity-Action-Request (PXR) command
The PXR command, indicated by the Command-Code field set to 8388676 and the
\'R\' bit set in the Command Flags field, is sent by the ProSe Function to the
ProSe Application Server as part of the procedures specified for EPC-level
ProSe discovery and ProSe direct discovery in clause 5.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Auth-Session-State }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
[ Destination-Host ]
[ Origin-State-Id ]
*[ Proxy-Info ]
*[ Route-Record ]
{ ProSe-Request-Type }
[ **Origin-** App-Layer-User-Id ]
[ **Target-** App-Layer-User-Id **]**
**[ Requesting-EPUID ]**
[ ProSe-Function-ID ]
[ Requesting-RPAUID ]
[ ProSe-App-Id ]
[ Application-Data ]
[ Allowed-Suffix-Number]
[ Target-RPAUID ]
*[ Banned-User-Target ]
*[ AVP ]
### 6.6.3 ProXimity-Action-Answer (PXA) command
The PXA command, indicated by the Command-Code field set to 8388676 and the
\'R\' bit cleared in the Command Flags field, is sent by the ProSe Application
Server to the ProSe Function in response to the PXR command as part of the
procedures specified for EPC-level ProSe discovery and ProSe direct discovery
in clause 5.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Auth-Session-State }
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
[ Error-Message ]
[ Error-Reporting-Host ]
[ Failed-AVP ]
[ Origin-State-Id ]
*[ Redirect-Host ]
[ Redirect-Host-Usage ]
[ Redirect-Max-Cache-Time ]
*[ Proxy-Info ]
{ ProSe-Request-Type }
**[ Targeted-EPUID ]**
[ ProSe-Function-ID ]
*[ PDUID ]
*[ ProSe-Restricted-Code-Suffix-Range ]
*[ ProSe-Application-Code-Suffix-Range ]
*[ ProSe-Code-Suffix-Mask ]
*[ Monitor-Target ]
*[ Target-PDUID ]
[ProSe-Application-Metadata ]
[Application-Data ]
*[ Load ]
*[ AVP ]
### 6.6.4 ProXimity-Application-Request (XAR) command
The XAR command, indicated by the Command-Code field set to 8388727 and the
\'R\' bit set in the Command Flags field, is sent by the ProSe Application
Server to the ProSe Function as part of the discovery authorization update
procedure.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Auth-Session-State }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
[ Destination-Host ]
[ Origin-State-Id ]
*[ Proxy-Info ]
*[ Route-Record ]
{ ProSe-Request-Type }
[ **Requesting-RPAUID** ]
*[ **Banned-User-Target}**
*[ AVP ]
### 6.6.5 ProXimity-Application-Answer (XAA) command
The XAA command, indicated by the Command-Code field set to 8388727 and the
\'R\' bit cleared in the Command Flags field, is sent by the ProSe Function to
the ProSe Application Server in response to the XAR command as part of the
discovery authorization update procedure.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Auth-Session-State }
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
[ Error-Message ]
[ Error-Reporting-Host ]
[ Failed-AVP ]
[ Origin-State-Id ]
*[ Redirect-Host ]
[ Redirect-Host-Usage ]
[ Redirect-Max-Cache-Time ]
*[ Proxy-Info ]
{ ProSe-Request-Type }
*[ AVP ]
## 6.7 PC2 specific Experimental-Result-Code AVP values
### 6.7.1 General
This clause defines result code values that shall be supported by Diameter
implementations that conform to this specification.
### 6.7.2 Success
Result Codes that fall into the Success category are used to inform a peer
that a request has been successfully completed. The Result-Code AVP values
defined in the Diameter base protocol (IETF RFC 6733 [12] are applied.
### 6.7.3 Failures
Errors that fall into the Failures category shall be used to inform the peer
that the request has failed. The Result-Code AVP values defined in Diameter
base protocol (IETF RFC 6733 [12] are applied. When one of the result codes as
defined below is included in the PXA command, it is included in an
Experimental-Result AVP and the Result-Code AVP is absent.
#### 6.7.3.1 DIAMETER_ERROR_ORIGIN_ALUID_UNKNOWN (5590)
This result code indicates that there is no valid context associated to the
origin ALUID received in the request.
#### 6.7.3.2 DIAMETER_ERROR_TARGET_ALUID_UNKNOWN (5591)
This result code indicates that there is no valid context associated to the
target ALUID received in the request.
#### 6.7.3.3 DIAMETER_ERROR_PFID_UNKNOWN (5592)
This result code indicates that there is no valid ProSe Function associate to
the PFID received in the request.
#### 6.7.3.4 DIAMETER_ERROR_APP_REGISTER_REJECT (5593)
This result code indicates that the ProSe Application Server cannot accept the
application registration request for an unspecific reason.
#### 6.7.3.5 DIAMETER_ERROR_PROSE_MAP_REQUEST_DISALLOWED (5594)
This result code indicates that the ProSe Application Server cannot accept the
map request because the targeted application user is not allowed to be
discovered by the originating application user.
#### 6.7.3.6 DIAMETER_ERROR_MAP_REQUEST_REJECT (5595)
This result code indicates that the ProSe Application Server cannot accept the
map request for an unspecific reason.
#### 6.7.3.7 DIAMETER_ERROR_REQUESTING_RPAUID_UNKNOWN (5596)
This result code indicates that the ProSe Application Server cannot find the
requesting RPAUID included in the restricted discovery authorization request.
#### 6.7.3.8 DIAMETER_ERROR_UNKNOWN_OR_INVALID_TARGET_SET (5597)
This result code indicates that the ProSe Application Server cannot authorize
the request because all target RPAUID(s) provided in the request are either
unknown to the ProSe Application Server, or not eligible to be discovered by
the requesting RPAUID.
#### 6.7.3.9 DIAMETER_ERROR_MISSING_APPLICATION_DATA (5598)
This result code indicates that there is no application data provided so the
ProSe Application Server cannot process the corresponding discovery request.
#### 6.7.3.10 DIAMETER_ERROR_AUTHORIZATION_REJECT (5599)
This result code indicates that for the particular requesting type of
restricted discovery, the ProSe Application Server found that the requesting
RPAUID is not authorized.
#### 6.7.3.11 DIAMETER_ERROR_DISCOVERY_NOT_PERMITTED (5600)
This result code indicates that the requesting RPAUID is not allowed to
discover the target RPAUID.
#### 6.7.3.12 DIAMETER_ERROR_TARGET_RPAUID_UNKNOWN (5601)
This result code indicates that there is no valid target RPAUID received in
the request.
#### 6.7.3.13 DIAMETER_ERROR_INVALID_APPLICATION_DATA (5602)
This result code indicates that there is invalid application data provided so
the ProSe Application Server cannot process the corresponding discovery
request.
###### ## Annex A (informative): Call Flows over PC2
# A.1 EPC-Level ProSe discovery
## A.1.1 Application registration for ProSe
The Application registration for ProSe procedure is used by the UE to register
an application with the ProSe Function to activate ProSe features e.g. EPC-
level ProSe discovery for a specific application.
Figure A.1.1: Application registration for ProSe Procedure
1\. When the ProSe Function have received an application registration request,
as defined in 3GPP**** TS 24.334 [10], from the originating UE and the
requested application is on the stored list of authorised Application IDs, the
ProSe Function sends a PXR command to the ProSe Application Server including
the parameters as defined in clause 5.1.1.
2\. The ProSe Application Server determines whether the registration can be
accepted for the originating UE.
3\. The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in clause 5.1.1.
4\. The ProSe Function send a response message to the originating UE
indicating that the registration was successful (or not) as defined in 3GPP TS
24.334 [10].
## A.1.2 Proximity map request
The proximity map request procedure is used by the ProSe Function to request
the identity of the ProSe Function for the targeted UE for which the
originating UE shall get alerts when in proximity of the targeted UE.
Figure A.2.1: Proximity map request procedure
1\. When the ProSe Function have received a proximity request, as defined in
3GPP TS 24.334 [10], from the UE the ProSe Function sends a PXR command to the
ProSe Application Server including the parameters as defined in clause 5.1.2.
2\. The ProSe Application Server determines whether the originating UE is
allowed to discover the targeted UE.
3\. The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in clause 5.1.2.
4\. If the mapping is successful, the ProSe Function initialize the proximity
request procedure as defined in 3GPP TS 29.345 [7].
# A.2 Restricted ProSe direct discovery
## A.2.1 Authorization for Announce Request (model A)
The authorization for announce request procedure is used by the ProSe Function
serving the originating UE to obtain announce authorization information
related to restricted ProSe direct discovery.
Figure A.2.1: Authorization for announce request procedure
1\. When the ProSe Function has received an announce request, as defined in
3GPP TS 24.334 [10], from the originating UE and the application represented
by the Application ID is authorized for restricted ProSe direct discovery
model A announcing, the ProSe Function sends a PXR command to the ProSe
Application Server including the parameters as defined in subclause 5.2.2.
2\. The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.2.
3\. The ProSe Function verifies that the received PDUID belongs to the
originating UE and sends a response message to the originating UE as defined
in 3GPP TS 24.334 [10].
## A.2.2 Authorization for Restricted Discovery Announce Request with
Application-controlled extension (model A)
The announce authorization procedure with application-controlled extension is
used by the ProSe Function serving the originating UE to obtain announce
authorization information related to restricted ProSe direct discovery.
Figure A.2.2: Authorization for restricted discovery announce request with
application-controlled extension procedure
1\. When the ProSe Function has received an announce request with application-
controlled extension, as defined in 3GPP TS 24.334 [10], from the originating
UE and the application represented by the Application ID is authorized for
restricted ProSe direct discovery model A announcing, the ProSe Function sends
a PXR command to the ProSe Application Server including the parameters as
defined in subclause 5.2.3.
2\. The ProSe Application Server shall check if the application supports
application-controlled extension.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.3.
4\. The ProSe Function verifies that the received PDUID belongs to the
originating UE and sends a response message to the originating UE as defined
in 3GPP TS 24.334 [10].
## A.2.3 Authorization for Monitor Request (model A)
The authorization for monitor request procedure is used by the ProSe Function
serving the originating UE to obtain monitor authorization information related
to restricted ProSe direct discovery.
Figure A.2.3: Authorization for Monitor request
1\. When the ProSe Function has received a monitor request as defined in 3GPP
TS 24.334 [10], from the originating UE and the application represented by the
Application ID is authorized for restricted ProSe direct discovery model A
monitoring, the ProSe Function sends a PXR command to the ProSe Application
Server including the parameters as defined in subclause 5.2.4.
2\. The ProSe Application Server shall examine the Application-Data AVP and
determine which target RPAUID(s) the requesting RPAUID is allowed to discover
based on application-specific permissions.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.4.
4\. The ProSeF unction verifies that the received PDUID belongs to the
originating UE and sends a response message to the originating UE as defined
in 3GPP TS 24.334 [10].
## A.2.4 Authorization for Restricted Discovery Monitor Request with
Application-controlled extension (model A)
The authorization for monitor request with application-controlled extension
procedure is used by the ProSe Function serving the originating UE to obtain
monitor authorization information related to restricted ProSe direct discovery
with application-controlled extension.
Figure A.2.4: Authorization for restrictred discovery monitor request with
application-controlled extension procedure
1\. When the ProSe Function has received a monitor request with application-
controlled extension as defined in 3GPP TS 24.334 [10], from the originating
UE and the application represented by the Application ID is authorized for
restricted ProSe direct discovery model A monitoring, the ProSe Function sends
a PXR command to the ProSe Application Server including the parameters as
defined in subclause 5.2.5.
2\. The ProSe Application Server shall examine the Application-Data AVP and
determine which target RPAUID(s) the requesting RPAUID is allowed to discover
based on application-specific permissions.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.5.
4\. The ProSe Function verifies that the received PDUID belongs to the
originating UE and sends a response message to the originating UE as defined
in 3GPP TS 24.334 [10].
## A.2.5 Authorization for Discovery Permission (model A)
The discovery permission authorization procedure is used by the ProSe Function
to verify the application layer permission for restricted discovery model A
between an originating application user and a target application user, which
are represented, respectively, by the requesting RPAUID and the target RPAUID.
Figure A.2.5: Authorization for discovery permission procedure
1\. When the ProSeFunction has received a monitor request as defined in 3GPP
TS 29.345 [7], from the ProSe Function of the origination UE and the ProSe
Restricted Code has been retrieved, the ProSe Function sends a PXR command to
the ProSe Application Server including the parameters as defined in subclause
5.2.6.
2\. The ProSe Application Server shall determine whether the originating UE is
allowed to discover the targeted UE.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.6.
4\. The ProSe Function sends a response message to the ProSe Function of the
originating UE as defined in 3GPP TS 29.345 [7].
## A.2.6 Authorization for Match Report (model A/model B)
This authorization for match report procedure is used by the ProSe Function
serving the monitoring UE (in model A) or discoverer UE (in model B) to obtain
authorization information related to Match Report in restricted ProSe Direct
Discovery.
Figure A.2.6: Authorization for Match report procedure
1\. When the ProSe Function has received a match report from the originating
UE and the originating UE is authorized for restricted discovery, t he ProSe
Function sends a PXR command to the ProSe Application Server including the
parameters as defined in subclause 5.2.7.
2\. The ProSe Application Server shall determine whether the originating UE is
allowed to discover the target restricted ProSe Application User.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.7.
4\. The ProSe Function verifies that the received PDUID belongs to the
originating UE and and the target PDUID is the same as the stored target
PDUID, then sends a response message to the originating UE.
## A.2.7 Authorization for Discoveree Request (model B)
This authorization for discoveree request procedure is used by the ProSe
Function serving the Discoveree UE to obtain authorization information of the
Discoveree UE related to Discoveree Request in restricted ProSe direct
discovery.
Figure A.2.7: Authorization for Discoveree request
1\. When the ProSe Function have received a discoveree request as defined in
3GPP TS 24.334 [10], from the originating UE and the application represented
by the Application ID is authorized for restricted ProSe direct discovery
model B discoveree operation, the ProSe Function sends a PXR command to the
ProSe Application Server including the parameters as defined in subclause
5.2.8.
2\. The ProSe Application Server shall examine the Application-Data AVP and
determine which target RPAUID(s) the requesting RPAUID is allowed to discover
based on application-specific permissions.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.8.
4\. The ProSeF unction verifies that the received PDUID belongs to the
originating UE and sends a response message to the originating UE as defined
in 3GPP TS 24.334 [10].
## A.2.8 Authorization for Discoverer Request (model B)
This authorization for discoverer procedure is used by the ProSe Function
serving the Discoverer UE to obtain authorization information of the
Discoverer UE related to Discoverer Request in restricted ProSe Direct
Discovery.
Figure A.2. 8: Authorization for Discoverer request
1\. When the ProSe Function have received a discoverer request as defined in
3GPP TS 24.334 [10], from the origination UE and the application represented
by the Application ID is authorized for restricted ProSe direct discovery
model B discoverer operation, t he ProSe Function sends a PXR command to the
ProSe Application Server including the parameters as defined in subclause
5.2.9.
2\. The ProSe Application Server shall examine the Application-Data AVP and
determine which target RPAUID(s) the requesting RPAUID is allowed to discover
based on application-specific permissions.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.9.
4\. The ProSe Function verifies that the received PDUID belongs to the
originating UE and sends a response message to the originating UE as defined
in 3GPP TS 24.334 [10].
## A.2.9 Authorization for Discovery Permission (model B)
The discovery permission authorization procedure is used by the ProSe Function
to verify the application layer permission for restricted discovery model B
between an originating application user and a target application user, which
are represented, respectively, by the requesting RPAUID and the target RPAUID.
Figure A.2.9: Authorization for discovery permission procedure
1\. When the ProSe Function have received a discovery request as defined in
3GPP TS 29.345 [7], from the ProSe Function of the originating UE and the
ProSe Restricted Code has been retrieved. The ProSe Function sends a PXR
command to the ProSe Application Server including the parameters as defined in
subclause 5.2.10.
2\. The ProSe Application Server shall determine whether the originating UE is
allowed to discover the targeted UE.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.2.10.
4\. The ProSe Function sends a response message to the ProSe Function of the
originating UE as defined in 3GPP TS 29.345 [7].
## A.2.10 Discovery Authorization Update
The discovery authorization update procedure is used by ProSe Application
Server to revoke discovery permissions without a delay while a specific
originating user revokes the discovery permissions relating to some other
users in the ProSe Application Server.
Figure A.2.10: Discovery authorization update
1\. When the ProSe Application Server has received authorization update
request from the UE, the ProSe Application Server sends a XAR command to the
ProSe Function including the parameters as defined in subclause 5.2.11;
2\. The ProSe Function acknowledges the XAR command and sends the XAA command
to the ProSe Application Server including the parameters as defined in
subclause 5.2.11.
3\. The ProSe Function determines to trigger the discovery update procedure to
the afftected UE(s) based on the received update information from the ProSe
Application.
4\. After a time configured by the operator, the ProSe Function sends a PXR
command to the ProSe Application Server including the parameters as defined in
subclause 5.2.11 for reporting the authorization update result.
5\. The ProSe Application Server acknowledges the PXR Command and sends the
PXA command back to the ProSe Function.
## A.2.11 Authorization for Open Discovery Announce Request with Application-
controlled extension
The announce authorization procedure with application-controlled extension is
used by the ProSe Function serving the originating UE to obtain announce
authorization information related to open ProSe direct discovery.
Figure A.2.11: Authorization for open discovery announce request with
application-controlled extension procedure
1\. When the ProSe Function has received an announce request with application-
controlled extension, as defined in 3GPP TS 24.334 [10], from the originating
UE and the application represented by the Application ID is authorized for
open ProSe direct discovery announcing, the ProSe Function sends a PXR command
to the ProSe Application Server including the parameters as defined in
subclause 5.3.1.
2\. The ProSe Application Server shall check if the application supports
application-controlled extension and allocate ProSe Application Code
suffix(es).
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.3.1.
4\. The ProSe Function sends a response message to the originating UE as
defined in 3GPP TS 24.334 [10].
## A.2.12 Authorization for Open Discovery Monitor Request with Application-
controlled extension
The authorization for monitor request with application-controlled extension
procedure is used by the ProSe Function serving the originating UE to obtain
monitor authorization information related to open ProSe direct discovery with
application-controlled extension.
Figure A.2.12: Authorization for open discovery monitor request with
application-controlled extension procedure
1\. When the ProSe Function has received a monitor request with application-
controlled extension as defined in 3GPP TS 24.334 [10], from the originating
UE and the application represented by the Application ID is authorized for
open ProSe direct discovery monitoring, the ProSe Function sends a PXR command
to the ProSe Application Server including the parameters as defined in
subclause 5.3.2.
2\. The ProSe Application Server shall check if the application supports
application-controlled extension and examine the Application-Data AVP and
determine the suffix masks to be used to monitor the information represented
by the Application Data.
3 The ProSe Application Server sends a PXA command to the ProSe Function
including the parameters as defined in subclause 5.3.2.
4\. The ProSe Function sends a response message to the originating UE as
defined in 3GPP TS 24.334 [10].
Annex B (normative):\ Diameter load control mechanism
## B.1 General
IETF RFC 8583 [11] specifies the Diameter load control mechanism. This
includes the definition of Diameter Load AVP and the Diameter load related
behaviour.
The Diameter load control mechanism on the PC2 interface is optional for the
ProSe Function and the ProSe Application Server.
NOTE: The Diameter Load AVP will simply be ignored by peers not supporting
Diameter load control.
If the ProSe Function and the ProSe Application Server support the Diameter
load control mechanism, they shall apply the procedures in the present Annex.
## B.2 ProSe Function behaviour
The ProSe Function shall act as a reacting node as defined in IETF RFC 8583
[11] and may use the load information in an implementation dependent manner,
e.g. when deciding where to route requests for new Diameter sessions.
## B.3 ProSe Application Server behaviour
The ProSe Application Server shall act as endpoint reporting node as defined
IETF RFC 8583 [11]. The ProSe Application Server shall include load
information in the the Load AVP within ProXimity-Action-Answer messages.
When and in which frequency to include the Load AVP is implementation
dependent and based on operator policy.
How the ProSe Application Server determines the specific contents of the Load-
Value AVP within the Load AVP is implementation dependent and based on
operator policy.
#
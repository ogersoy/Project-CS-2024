# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document describes the Diameter-based V4 interface between the V2X
Control Function and the Home Subscriber Server (HSS) defined for V2X
services.
This specification defines the Diameter application for V4 reference point
between the V2X Control Function and the HSS. The interactions between the V2X
Control Function and the HSS are specified.
The stage 2 description for V2X service features in EPS is specified in 3GPP
TS 23.285 [2].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.285: \"Architecture enhancements for V2X services; Stage 2\".
[3] IETF RFC 6733: \"Diameter Base Protocol\".
[4] 3GPP TS 33.210: \"3G Security; Network Domain Security; IP Network Layer
Security\".
[5] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[6] 3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol\".
[7] IETF RFC 5234: \"Augmented BNF for Syntax Specifications: ABNF\".
[8] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[9] 3GPP TS 29.228: \"IP multimedia (IM) Subsystem Cx and Dx Interfaces;
Signalling flows and Message Elements\".
[10] 3GPP TS 29.272: \"Evolved Packet System; MME and SGSN Related Interfaces
Based on Diameter Protocol\".
[11] 3GPP TS 29.329: \"Sh Interface based on the Diameter protocol\".
[12] IETF RFC 7683: \"Diameter Overload Indication Conveyance\".
[13] IETF RFC 7944: \"Diameter Routing Message Priority\".
[14] 3GPP TS 23.007: \"Restoration procedures\".
[15] 3GPP TS 29.344: \"Proximity-services (ProSe) Function to Home Subscriber
Server (HSS) aspects\".
[16] IETF RFC 8583: \"Diameter Load Information Conveyance\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**example:** text used to clarify abstract rules by applying them literally.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
ProSe Proximity-based Services
V2X Vehicle-to-Everything
# 4 General Description
## 4.1 Introduction
The V4 reference point between the V2X Control Function and the HSS is defined
in the 3GPP TS 23.285 [2].
This document describes the V4 interface related procedures, message
parameters and protocol specifications.
The V4 interface allows the V2X Control Function to retrieve V2X related
subscription data in order to authorise access from the UE for V2X services.
# 5 Procedure Description
## 5.1 Introduction
This clause describes the Diameter-based V4 interface related procedures and
information elements exchanged between the V2X Control Function and the HSS.
In the tables that describe the Information Elements transported by each
Diameter command, each Information Element is marked as (M) Mandatory, (C)
Conditional or (O) Optional in the \"Cat.\" column. For the correct handling
of the Information Element according to the category type, see the description
detailed in clause 6 of the 3GPP TS 29.228 [9].
## 5.2 V2X Subscriber Information Retrieval
### 5.2.1 General
This procedure shall be used between the V2X Control Function and the HSS for
authorization of the UE for V2X services. The procedure shall be invoked by
the V2X Control Function and is used:
\- to request V2X related subscription data.
This procedure is mapped to the commands ProSe-Subscriber-Information-
Request/Answer (PIR/PIA) in the Diameter application specified in clause 6.
Table 5.2.1-1 and table 5.2.1-2 detail the involved information elements.
Table 5.2.1-1: V2X Subscriber Information Retrieval Request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | Element Name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | IMSI | User-Name (See | M | This information | | | IET | | element shall | | | F RFC 6733 [3]) | | contain the user | | | | | IMSI, formatted | | | | | according to | | | | | 3GPP TS | | | | | 23.003 [8], | | | | | clause 2.2. | +-------------------+-------------------+------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+------+-------------------+
Table 5.2.1-2: V2X Subscriber Information Retrieval Answer
+-------------------+-------------------+-------+-------------------+ | Information | Mapping to | Cat. | Description | | Element Name | Diameter AVP | | | +-------------------+-------------------+-------+-------------------+ | Result\ | Result-Code / | **M** | This IE shall | | (See 6) | Ex | | contain the | | | perimental-Result | | result of the | | | | | operation. | | | | | | | | | | The Result-Code | | | | | AVP shall be used | | | | | to indicate | | | | | success / errors | | | | | as defined in the | | | | | Diameter base | | | | | protocol. | | | | | | | | | | The | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for V4 errors. | | | | | This is a grouped | | | | | AVP which shall | | | | | contain the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | | | | | | | | | | The following | | | | | errors are | | | | | applicable: | | | | | | | | | | - User Unknown\ | | | | | - Unknown V2X | | | | | Subscription\ | | | | | - V2X Not Allowed | +-------------------+-------------------+-------+-------------------+ | V2X Subscription | V2X- | C | This information | | Data | Subscription-Data | | element shall | | | | | contain the V2X | | (See 6.3.2) | | | Subscription Data | | | | | that gives the | | | | | user permission | | | | | to use V2X. | +-------------------+-------------------+-------+-------------------+ | MSISDN | MSISDN | C | This information | | | | | element shall | | (See | | | contain the user | | 3GPP TS 29.329 | | | MSISDN, formatted | | [11]) | | | according to | | | | | 3GPP TS 29.329 | | | | | [11]. It shall | | | | | be present if | | | | | available. | +-------------------+-------------------+-------+-------------------+ | Visited PLMN Id | Visited-PLMN-Id | **C** | This IE shall | | | | | contain the MCC | | (See | | | and the MNC of | | 3GPP | | | the PLMN where | | TS 29.272 [10]) | | | the UE is | | | | | registered, see | | | | | 3GPP | | | | | TS 23.003 [8]. | | | | | | | | | | It shall be | | | | | present if the UE | | | | | is roaming in a | | | | | PLMN different | | | | | from the Home | | | | | PLMN. | +-------------------+-------------------+-------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+-------+-------------------+ | Reset-IDs | Reset-ID | O | The Reset-ID | | | | | uniquely | | (See | | | identifies a | | 3GPP | | | fallible resource | | TS 29.272 [10]) | | | in the HSS\'s | | | | | realm on which | | | | | the user (IMSI) | | | | | depends. In the | | | | | event of a | | | | | restart of the | | | | | fallible resource | | | | | a Reset message | | | | | containing the | | | | | Reset-ID will | | | | | exactly identify | | | | | the impacted | | | | | subscribers. | +-------------------+-------------------+-------+-------------------+
### 5.2.2 Detailed Behaviour of the V2X Control Function
The V2X Control Function shall make use of this procedure to request V2X
related subscription data.
If the V2X Control Function retrieved the V2X related subscription data, the
V2X Control Function shall perform the authorisation for V2X as described in
the 3GPP TS 23.285 [2].
### 5.2.3 Detailed Behaviour of the HSS
When receiving a V2X Subscriber Information Retrieval Request the HSS shall
check if the IMSI for whom data is requested exists in the HSS. If not, an
Experimental-Result of DIAMETER_ERROR_USER_UNKNOWN shall be returned.
If the IMSI exists but there is not any V2X subscription data for the IMSI,
the HSS shall return an Experimental-Result of
DIAMETER_ERROR_UNKNOWN_V2X_SUBSCRIPTION.
If the UE is not allowed to use V2X in the visited PLMN, the HSS shall return
an Experimental-Result of DIAMETER_ERROR_V2X_NOT_ALLOWED. Otherwise, the HSS
shall return a Result-Code of DIAMETER_SUCCESS and shall store V2X Control
Function identity (the V2X Control Function identity is received within the
Origin-Host AVP) and download the V2X subscription data to the V2X Control
Function. The HSS shall provide the Visited PLMN ID of where the UE is
registered if the UE is roaming in a PLMN different from the Home PLMN.
## 5.3 Update V2X Subscriber Data
### 5.3.1 General
The Update V2X Subscriber Data procedure shall be used between the V2X Control
Function and the HSS to update the subscriber related data downloaded by means
of the V2X Subscriber Information Retrieval operation (see clause 5.2) and
stored in the V2X Control Function.
It shall be used to update subscriber related data in the V2X Control Function
due to administrative changes of the user data in the HSS, i.e. if the user
was given a subscription and the subscription has changed. It shall be used at
least to perform the following:
\- update of all of V2X subscription data of the subscriber,
\- update of a subset of the V2X subscription data of the subscriber,
\- deletion of the V2X subscription data of the subscriber.
The procedure will also be triggered when the VPLMN has changed.
This procedure is mapped to the commands Update-ProSe-Subscriber-Data-
Request/Answer (UPR/UPA) in the Diameter application specified in clause 6.
Table 5.3.1-1 specifies the involved information elements for the request.
Table 5.3.1-2 specifies the involved information elements for the answer.
Table 5.3.1-1: Update V2X Subscriber Data Request
+-------------------+-------------------+-------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+-------+-------------------+ | IMSI | User-Name (See | M | This information | | | IET | | element shall | | | F RFC 6733 [3]) | | contain the user | | | | | IMSI, formatted | | | | | according to | | | | | 3GPP | | | | | TS 23.003 [8], | | | | | clause 2.2. | +-------------------+-------------------+-------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+-------+-------------------+ | V2X Subscription | V2X- | C | This information | | Data (See 6.3.2) | Subscription-Data | | element shall | | | | | contain the V2X | | | | | Subscription Data | | | | | that gives the | | | | | user permission | | | | | to use V2X | | | | | service. | +-------------------+-------------------+-------+-------------------+ | Visited PLMN Id | Visited-PLMN-Id | **C** | This IE shall | | | | | contain the MCC | | (See | | | and the MNC of | | 3GPP | | | the PLMN where | | TS 29.272 [10]) | | | the UE is | | | | | registered, see | | | | | 3GPP | | | | | TS 23.003 [8]. | | | | | | | | | | It shall be | | | | | present if the UE | | | | | is roaming in a | | | | | PLMN different | | | | | from the Home | | | | | PLMN. | +-------------------+-------------------+-------+-------------------+ | V2X Update Flags | V2X-Update-Flags | M | This Information | | | | | Element shall | | (See 6.3.4) | | | contain a bit | | | | | mask. See | | | | | clause 6.3.6 for | | | | | the meaning of | | | | | the bits. | +-------------------+-------------------+-------+-------------------+ | Reset-IDs | Reset-ID | O | The Reset-ID | | | | | uniquely | | (See | | | identifies a | | 3GPP | | | fallible resource | | TS 29.272 [10]) | | | in the HSS\'s | | | | | realm on which | | | | | the user (IMSI) | | | | | depends. In the | | | | | event of a | | | | | restart of the | | | | | fallible resource | | | | | a Reset message | | | | | containing the | | | | | Reset-ID will | | | | | exactly identify | | | | | the impacted | | | | | subscribers. | +-------------------+-------------------+-------+-------------------+
Table 5.3.1-2: Update V2X Subscriber Data Answer
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | This IE shall | | | Ex | | contain the | | (See 6.4) | perimental-Result | | result of the | | | | | operation. | | | | | | | | | | The Result-Code | | | | | AVP shall be used | | | | | to indicate | | | | | success / errors | | | | | as defined in the | | | | | Diameter base | | | | | protocol. | | | | | | | | | | The | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for V4 errors. | | | | | This is a grouped | | | | | AVP which shall | | | | | contain the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | | | | | | | | | | The following | | | | | errors are | | | | | applicable in | | | | | this case: | | | | | | | | | | - User Unknown | | | | | | | | | | - Unknown V2X | | | | | Subscription | +-------------------+-------------------+------+-------------------+
### 5.3.2 Detailed behaviour of the V2X Control Function
When receiving an Update V2X Subscriber Data request, the V2X Control Function
shall check whether the IMSI is known.
If it is not known, a result code of DIAMETER_ERROR_USER_UNKNOWN shall be
returned.
If it is known, the V2X Control Function shall update the corresponding data
according to the indication as sent in the request, and acknowledge the Update
V2X Subscriber Data message by returning an Update V2X Subscriber Data Answer.
If the V2X-Update-Flags indicates that the V2X subscription data is to be
deleted, the V2X Control Function shall delete the associated V2X UE context
if it has been stored before.
If the update of the subscription data succeeds in the V2X Control Function,
the Result-Code shall be set to DIAMETER_SUCCESS.
If the V2X Control Function cannot fulfil the received request for other
reasons, e.g. due to a database error, it shall set the Result-Code to
DIAMETER_UNABLE_TO_COMPLY. In this case, the V2X Control Function shall mark
the subscription record \"Subscriber data to be restored in the HSS\".
### 5.3.3 Detailed behaviour of the HSS
The HSS shall make use of this procedure to update the relevant subscriber
related data in the V2X Control Function to replace a specific part of the
user data stored in the V2X Control Function with the data sent.
If the V2X related subscription data is updated or revoked, the HSS sends the
updated V2X subscription data to the V2X Control Function. The HSS shall
include the V2X-Update-Flags to indicate which part of the data is updated. If
all of the V2X subscription data is to be removed, the HSS shall set the
\"Removal of all V2X Subscription Data\" bit of the V2X-Update-Flags, and the
HSS shall delete the V2X Control Function Identity if it is stored for this
subscriber.
## 5.4 Notification Procedure
### 5.4.1 General
This procedure shall be used between the V2X Control Function and the HSS when
the HSS needs to be notified about:
\- revocation of authorization for V2X service on one PLMN.
\- removal of the subscription data from the V2X Control Function either by an
MMI interaction or automatically.
This procedure is mapped to the commands ProSe-Notify-Request/Answer (PNR/PNA)
in the Diameter application specified in clause 6. Table 5.4.1-1 and table
5.4.1-2 detail the involved information elements.
Table 5.4.1-1: V2X Notify Request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | Element Name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | IMSI | User-Name (See | C | This information | | | IET | | element shall | | | F RFC 6733 [3]) | | contain the user | | | | | IMSI, formatted | | | | | according to | | | | | 3GPP | | | | | TS 23.003 [8], | | | | | clause 2.2. | | | | | | | | | | It shall be | | | | | present if the | | | | | revocation is for | | | | | a specific UE. | +-------------------+-------------------+------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+------+-------------------+ | PLMN ID (see | Visited-PLMN-Id | C | This information | | 3GPP | | | element shall | | TS 29.272 [10]) | | | contain the MCC | | | | | and the MNC of | | | | | the PLMN where | | | | | the UE\'s | | | | | authorization for | | | | | V2X service is | | | | | revoked, see | | | | | 3GPP TS 23.285 | | | | | [2]. | | | | | | | | | | It shall be | | | | | present if the | | | | | V2X Control | | | | | Function revokes | | | | | the authorization | | | | | for V2X service | | | | | in a specific | | | | | PLMN. | +-------------------+-------------------+------+-------------------+ | V2X Notify Flags | V2X-Notify-Flags | C | This Information | | | | | Element shall | | (see 6.3.5) | | | contain a bit | | | | | mask. See 6.3.7 | | | | | for the meaning | | | | | of the bits. | +-------------------+-------------------+------+-------------------+
Table 5.4.1-2: V2X Notify Answer
+-------------------+-------------------+-------+-------------------+ | Information | Mapping to | Cat. | Description | | Element Name | Diameter AVP | | | +-------------------+-------------------+-------+-------------------+ | Result\ | Result-Code / | **M** | This IE shall | | (See 6) | Ex | | contain the | | | perimental-Result | | result of the | | | | | operation. | | | | | | | | | | The Result-Code | | | | | AVP shall be used | | | | | to indicate | | | | | success / errors | | | | | as defined in the | | | | | Diameter base | | | | | protocol. | | | | | | | | | | The | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for V4 errors. | | | | | This is a grouped | | | | | AVP which shall | | | | | contain the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | | | | | | | | | | The following | | | | | errors are | | | | | applicable: | | | | | | | | | | - User Unknown | | | | | | | | | | - Unknown V2X | | | | | Subscription | +-------------------+-------------------+-------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+-------+-------------------+
### 5.4.2 Detailed Behaviour of the V2X Control Function
The V2X Control Function shall make use of this procedure to revoke
authorization for V2X service.
The V2X Control Function shall make use of this procedure to inform the HSS
when the subscription data is deleted from the V2X Function database due to
MMI interaction or automatically.
The V2X Control Function shall send the updated V2X Permission and the PLMN ID
for which the V2X Permission is to be updated. If the revocation is for a
single UE in the indicated PLMN, the V2X Function shall include IMSI in the
request.
### 5.4.3 Detailed Behaviour of the HSS
When receiving a V2X Notify Request the HSS shall check if the IMSI, if
present in the message, exists in the HSS. If not, an Experimental-Result of
DIAMETER_ERROR_USER_UNKNOWN shall be returned.
If the IMSI exists but there is not any V2X subscription data for the IMSI and
the PLMN ID as indicated by the Visited-PLMN-Id AVP in the request, the HSS
shall return an Experimental-Result of
DIAMETER_ERROR_UNKNOWN_V2X_SUBSCRIPTION.
If the V2X-Notify-Flags indicates revocation of authorization for V2X service,
and
\- if the IMSI exists and there is V2X subscription data for the IMSI and the
PLMN ID as indicated by the Visited-PLMN-Id AVP in the request, the HSS shall
revoke V2X service as indicated by the VNR Flags received in the request on
that PLMN for the user and update the V2X Subscription data accordingly. The
HSS shall set the result code to DIAMETER_SUCCESS.
\- if IMSI is not present in the message, the HSS shall check if there are any
users subscribed to V2X subscription for the PLMN as indicated by the Visited-
PLMN-Id AVP in the request, and if yes, revoke V2X service as indicated by the
VNR Flags received in the request on that PLMN for all the impacted users and
update their V2X Subscription data accordingly. The HSS shall set the result
code to DIAMETER_SUCCESS.
If the VNR Flags indicates the subscription data is deleted from the V2X
Control Function, the HSS shall remove the V2X Function Identity for the
subscriber and set the result code to DIAMETER_SUCCESS.
For any other reasons if the HSS cannot fulfil the received request, e.g. due
to a database error, it shall set the result code to
DIAMETER_UNABLE_TO_COMPLY.
## 5.5 Reset
### 5.5.1 General
The Reset Procedure shall be used by the HSS, after a restart, to indicate to
the V2X Control Function that a failure has occurred.
The Reset Procedure may also be used by the HSS as part of operation and
maintenance actions e.g. to allow planned HSS outage without service
interruption.
This procedure is mapped to the commands Reset-Request/Answer (RSR/RSA) in the
Diameter application specified in clause 6.
Table 5.5.1-1 specifies the involved information elements for the request.
Table 5.5.1-2 specifies the involved information elements for the answer.
Table 5.5.1-1: Reset Request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Id List | User-Id | O | This IE shall | | | | | contain a list of | | (See | | | V2X User-Ids | | 3GPP | | | where an V2X | | TS 29.272 [10]) | | | User-Id comprises | | | | | the leading | | | | | digits of an IMSI | | | | | (i.e. MCC, MNC, | | | | | leading digits of | | | | | MSIN) and it | | | | | shall identify | | | | | the set of | | | | | subscribers whose | | | | | IMSIs begin with | | | | | the User-Id. The | | | | | HSS may include | | | | | this information | | | | | element if the | | | | | occurred failure | | | | | is limited to | | | | | subscribers | | | | | identified by one | | | | | or more User-Ids. | +-------------------+-------------------+------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+------+-------------------+ | Reset-IDs | Reset-ID | O | If present, this | | | | | information | | (See | | | element | | 3GPP | | | identifies | | TS 29.272 [10]) | | | together with the | | | | | HSS\'s realm the | | | | | set of impacted | | | | | subscribers. | +-------------------+-------------------+------+-------------------+
Table 5.5.1-2: Reset Answer
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Supported | S | O | If present, this | | Features | upported-Features | | information | | | | | element shall | | (See | | | contain the list | | 3GPP | | | of features | | TS 29.229 [6]) | | | supported by the | | | | | origin host. | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | This IE shall | | | Ex | | contain the | | (See 6.4) | perimental-Result | | result of the | | | | | operation. | | | | | | | | | | The Result-Code | | | | | AVP shall be used | | | | | to indicate | | | | | success / errors | | | | | as defined in the | | | | | Diameter Base | | | | | Protocol. | | | | | | | | | | The | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for V4 errors. | | | | | This is a grouped | | | | | AVP which shall | | | | | contain the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | | | | | | | | | | There are no | | | | | Ex | | | | | perimental-Result | | | | | codes applicable | | | | | for this command. | +-------------------+-------------------+------+-------------------+
### 5.5.2 Detailed behaviour of the V2X Control Function
When receiving a Reset message the V2X Control Function shall mark all
impacted subscriber records \"Subscriber Data Confirmed in HSS\" as \"Not
Confirmed\", as defined in 3GPP TS 23.007 [14]. If the Reset-IDs IE is
supported and received, the V2X Control Function shall make use of the Reset-
IDs (together with the HSS\'s realm) in order to determine which subscriber
records are impacted (i.e. check whether at least one received Reset-ID is
associated with the subscriber, and the HSS\'s realm identity received in the
Origin-Realm AVP matches the value stored after successful V2X-Subscriber-
Information retrieval); otherwise the V2X Control Function shall make use of
the HSS Identity received in the Origin-Host AVP (by comparing it with the
value stored after successful V2X-Subscriber-Information retrieval) and may
make use of the received User-Id-List (if any) in order to determine which
subscriber records are impacted.
### 5.5.3 Detailed behaviour of the HSS
The HSS shall make use of this procedure in order to indicate to all relevant
V2X Control Functions that the HSS has restarted and may have lost the current
V2X Control Function Identity of some of its subscribers who may be currently
roaming in the V2X Control Function Area and that the HSS, therefore, cannot
send an Update V2X Subscriber Data messages when needed.
If the Reset-ID feature is not supported by the V2X Control Function and the
HSS, the HSS may include a list of User Ids identifying a subset of
subscribers served by the HSS, if the occurred failure is limited to those
subscribers.
If the Reset-ID feature is supported by the V2X Control Function, the HSS
optionally may include one (or several) Reset-ID AVPs identifying e.g. failed
hardware components if the occured failure is limited to those subscribers
associated with e.g. the identified failed hardware components.
# 6 Protocol Specification and Implementations
## 6.1 Introduction
### 6.1.1 Use of Diameter base protocol
The Diameter Base Protocol as specified in IETF RFC 6733 [3] shall apply
except as modified by the defined support of the methods and the defined
support of the commands and AVPs, result and error codes as specified in this
specification. Unless otherwise specified, the procedures (including error
handling and unrecognised information handling) shall be used unmodified as
specified in IETF RFC 6733 [3].
### 6.1.2 Securing Diameter Messages
For secure transport of Diameter messages, see 3GPP TS 33.210 [4].
### 6.1.3 Accounting Functionality
Accounting functionality (Accounting Session State Machine, related command
codes and AVPs) shall not be used on the V4 interface.
### 6.1.4 Use of Sessions
Between the V2X Control Function and the HSS, Diameter sessions shall be
implicitly terminated. An implicitly terminated session is one for which the
server does not maintain state information. The client shall not send any re-
authorization or session termination requests to the server.
The Diameter base protocol includes the Auth-Session-State AVP as the
mechanism for the implementation of implicitly terminated sessions.
The client (server) shall include in its requests (responses) the Auth-
Session-State AVP set to the value NO_STATE_MAINTAINED (1), as described in
IETF RFC 6733 [3]. As a consequence, the server shall not maintain any state
information about this session and the client shall not send any session
termination request. Neither the Authorization-Lifetime AVP nor the Session-
Timeout AVP shall be present in requests or responses.
### 6.1.5 Transport Protocol
Diameter messages over the V4 interface shall make use of SCTP, see IETF RFC
4960 [5].
### 6.1.6 Routing Considerations
This clause specifies the use of the Diameter routing AVPs Destination-Realm
and Destination-Host.
The V4 reference point is defined as an intra-operator interface, and both the
V2X Control Function and the HSS are located in the home PLMN of the UE that
requests V2X. If the V2X Control Function knows the address/name of the HSS
for a certain user, both the Destination-Realm and Destination-Host AVPs shall
be present in the request. Otherwise, the Destination-Realm AVP shall be
present and the command shall be routed to the next Diameter node.
Consequently, the Destination-Host AVP is declared as optional in the ABNF for
all requests initiated by the V2X Control Function.
The HSS obtains the Destination-Host AVP to use in requests towards the V2X
Control Function, from the Origin-Host AVP received in previous requests from
the V2X Control Function. Consequently, the Destination-Host AVP is declared
as mandatory in the ABNF for all requests initiated by the HSS.
If the Vendor-Specific-Application-ID AVP is received in any of the commands
defined in this specification, it shall be ignored by the receiving node, and
it shall not be used for routing purposes.
### 6.1.7 Advertising Application Support
The V2X Control Function and the HSS shall advertise support of the Diameter
V4 Application by including the value of the application identifier in the
Auth-Application-Id AVP within the Vendor-Specific-Application-Id grouped AVP
of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer
commands.
The vendor identifier value of 3GPP (10415) shall be included in the
Supported-Vendor-Id AVP of the Capabilities-Exchange-Request and Capabilities-
Exchange-Answer commands, and in the Vendor-Id AVP within the Vendor-Specific-
Application-Id grouped AVP of the Capabilities-Exchange-Request and
Capabilities-Exchange-Answer commands.
The Vendor-Id AVP included in Capabilities-Exchange-Request and Capabilities-
Exchange-Answer commands that is not included in the Vendor-Specific-
Application-Id AVPs as described above shall indicate the manufacturer of the
Diameter node as per IETF RFC 6733 [3].
### 6.1.8 Diameter Application Identifier
The V4 interface protocol shall be defined as an IETF vendor specific Diameter
application, where the vendor is 3GPP. The vendor identifier assigned by IANA
to 3GPP (http://www.iana.org/assignments/enterprise-numbers) is 10415.
The Diameter application identifier assigned to the V4 interface application
is 16777355 (allocated by IANA).
### 6.1.9 Use of the Supported-Features AVP
When new functionality is introduced on the V4 interface, it should be defined
as optional. If backwards incompatible changes cannot be avoided, the new
functionality shall be introduced as a new feature and support advertised with
the Supported-Features AVP. The usage of the Supported-Features AVP on the V4
interface is consistent with the procedures for the dynamic discovery of
supported features as defined in clause 7.2 of 3GPP TS 29.229 [6].
When extending the application by adding new AVPs for a feature, the new AVPs
shall have the M bit cleared and the AVP shall not be defined mandatory in the
command ABNF.
As defined in 3GPP TS 29.229 [6], the Supported-Features AVP is of type
grouped and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On
the all reference points as specified in this specification, the Supported-
Features AVP is used to identify features that have been defined by 3GPP and
hence, for features defined in this document, the Vendor-Id AVP shall contain
the vendor ID of 3GPP (10415). If there are multiple feature lists defined for
the reference point, the Feature-List-ID AVP shall differentiate those lists
from one another.
## 6.2 Commands
### 6.2.1 Introduction
This clause defines the Command code values and related ABNF for each command
described in this specification.
### 6.2.2 Command-Code Values
This clause defines Command-Code values for the V4 interface application as
allocated by IANA.
Every command is defined by means of the ABNF syntax IETF RFC 5234 [7],
according to the rules in IETF RFC 6733 [3]. In the case, the definition and
use of an AVP is not specified in this document, the guidelines in IETF RFC
6733 [3] shall apply.
The Vendor-Specific-Application-Id AVP shall not be included in any command
sent by Diameter nodes supporting applications defined in this specification.
If the Vendor-Specific-Application-Id AVP is received in any of the commands
defined in this specification, it shall be ignored by the receiving node.
NOTE: The Vendor-Specific-Application-Id is included as an optional AVP in all
Command Code Format specifications defined in this specification in order to
overcome potential interoperability issues with intermediate Diameter agents
non-compliant with the IETF RFC 6733 [3].
The following Command Codes are defined in this specification:
Table 6.2.2-1: Command-Code values for V4
* * *
Command-Name Abbreviation Code Clause ProSe-Subscriber-Information-Request PIR
8388664 6.2.3 ProSe-Subscriber-Information-Answer PIA 8388664 6.2.4 Update-
ProSe-Subscriber-Data-Request UPR 8388665 6.2.5 Update-ProSe-Subscriber-Data-
Answer UPA 8388665 6.2.6 ProSe-Notify-Request PNR 8388666 6.2.7 ProSe-Notify-
Answer PNA 8388666 6.2.8 Reset-Request RSR 322 6.2.9 Reset-Answer RSA 322
6.2.10
* * *
For these commands, the Application-ID field shall be set to 16777355
(application identifier of the V4 interface application, allocated by IANA).
### 6.2.3 ProSe-Subscriber-Information-Request (PIR) Command
The ProSe-Subscriber-Information-Request (PIR) command, indicated by the
Command-Code field set to 8388664 and the \"R\" bit set in the Command Flags
field, is sent from the V2X Control Function to the HSS. The ProSe-Subscriber-
Information-Request (PIR) is originally defined in 3GPP TS 29.344 [15].
Message Format when used over the V4 application:
> \ ::= \ REQ, PXY, 16777355 >
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> [ Destination-Host ]
>
> { Destination-Realm }
>
> { **User-Name** }
>
> ***[ Supported-Features ]**
>
> [ OC-Supported-Features ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
>
> *[ AVP ]
### 6.2.4 ProSe-Subscriber-Information-Answer (PIA) Command
The ProSe-Subscriber-Information-Answer (PIA) command, indicated by the
Command-Code field set to 8388664 and the \"R\" bit cleared in the Command
Flags field, is sent from the HSS to the V2X Control Function. The ProSe-
Subscriber-Information-Answer (PIA) is originally defined in 3GPP TS 29.344
[15].
Message Format when used over the V4 application:
> \ ::= \ PXY, 16777355 >
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> [ V2X-Subscription-Data ]
>
> [ MSISDN ]
>
> [ Visited-PLMN-Id ]
>
> ***[ Supported-Features ]**
>
> [ OC-Supported-Features ]
>
> [ OC-OLR ]
>
> *[ Load ]
>
> *[ Reset-ID ]
>
> *[ AVP ]
>
> [ Failed-AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.2.5 Update-ProSe-Subscriber-Data-Request (UPR) Command
The Update-ProSe-Subscriber-Data-Request (UPR) command, indicated by the
Command-Code field set to 8388665 and the \'R\' bit set in the Command Flags
field, is sent from the HSS to the V2X Control Function. The Update-ProSe-
Subscriber-Data-Request (UPR) is originally defined in 3GPP TS 29.344 [15].
Message Format when used over the V4 application:
> \ ::= \ REQ, PXY, 16777355 >
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> { Destination-Host }
>
> { Destination-Realm }
>
> { User-Name }
>
> *[ Supported-Features ]
>
> [ V2X-Subscription-Data ]
>
> [ Visited-PLMN-Id ]
>
> { V2X-Update-Flags }
>
> ***[ Reset-ID ]**
>
> *[ AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.2.6 Update-ProSe-Subscriber-Data-Answer (UPA) Command
The Update-ProSe-Subscriber-Data-Answer (UPA) command, indicated by the
Command-Code field set to 8388665 and the \'R\' bit cleared in the Command
Flags field, is sent from the V2X Control Function to the HSS. The Update-
ProSe-Subscriber-Data-Answer (UPA) is originally defined in 3GPP TS 29.344
[15].
Message Format when used over the V4 application:
> \ ::= \ PXY, 16777355 >
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> *[ Supported-Features ]
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> *[ AVP ]
>
> [ Failed-AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.2.7 ProSe-Notify-Request (PNR) Command
The ProSe-Notify-Request (VNR) command, indicated by the Command-Code field
set to 8388666 and the \"R\" bit set in the Command Flags field, is sent from
the V2X Control Function to the HSS. The ProSe-Nofity-Request (PNR) is
originally defined in 3GPP TS 29.344 [15].
Message Format when used over the V4 application:
> \ ::= \ 16777355 >
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> [ Destination-Host ]
>
> { Destination-Realm }
>
> [ **User-Name** ]
>
> [ Visited-PLMN-Id ]
>
> [ V2X-Notify-Flags ]
>
> ***[ Supported-Features ]**
>
> [ OC-Supported-Features ]
>
> *[ AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.2.8 ProSe-Notify-Answer (PNA) Command
The ProSe-Notify-Answer (VNA) command, indicated by the Command-Code field set
to 8388666 and the \"R\" bit cleared in the Command Flags field, is sent from
the HSS to the V2X Control Function. The ProSe-Nofity-Answer (PNA) is
originally defined in 3GPP TS 29.344 [15].
Message Format when used over the V4 application:
> \ ::= \
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> ***[ Supported-Features ]**
>
> [ OC-Supported-Features ]
>
> [ OC-OLR ]
>
> *[ Load ]
>
> *[ AVP ]
>
> [ Failed-AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.2.9 Reset-Request (RSR) Command
The Reset-Request (RSR) command, indicated by the Command-Code field set to
322 and the \'R\' bit set in the Command Flags field, is sent from HSS to the
V2X Control Function.
Message Format when used over the V4 application:
> \ ::= \
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> { Origin-Host }
>
> { Origin-Realm }
>
> { Destination-Host }
>
> { Destination-Realm }
>
> *[ Supported-Features ]
>
> *[ User-Id ]
>
> ***[ Reset-ID ]**
>
> *[ AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
### 6.2.10 Reset-Answer (RSA) Command
The Reset-Answer (RSA) command, indicated by the Command-Code field set to 322
and the \'R\' bit cleared in the Command Flags field, is sent from V2X Control
Function to HSS.
Message Format when used over the V4 application:
> \ ::= \
>
> \
>
> [ DRMP ]
>
> [ Vendor-Specific-Application-Id ]
>
> *[ Supported-Features ]
>
> [ Result-Code ]
>
> [ Experimental-Result ]
>
> { Auth-Session-State }
>
> { Origin-Host }
>
> { Origin-Realm }
>
> *[ AVP ]
>
> [ Failed-AVP ]
>
> *[ Proxy-Info ]
>
> *[ Route-Record ]
## 6.3 AVPs
### 6.3.1 General
The following table specifies the Diameter AVPs defined for the V4 interface
protocol, their AVP Code values, types, possible flag values and whether or
not the AVP may be encrypted. The Vendor-ID header of all AVPs defined in this
specification shall be set to 3GPP (10415).
Table 6.3.1-1: V4 specific Diameter AVPs
+-------+-------+-------+-------+------+-----+-------+-------+-------+ | | AVP | | | | | | | | | | Flag | | | | | | | | | | rules | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | Attr | AVP | C | Value | Must | May | S | Must | May | | ibute | Code | lause | Type | | | hould | not | Encr. | | Name | | de | | | | not | | | | | | fined | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | V2X-P | 4600 | 6.3.3 | Gr | M,V | | | | No | | C5-Al | | | ouped | | | | | | | lowed | | | | | | | | | | -PLMN | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | V | 4601 | 6.3.4 | Unsig | M,V | | | | No | | 2X-Up | | | ned32 | | | | | | | date- | | | | | | | | | | Flags | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | V | 4602 | 6.3.5 | Unsig | M,V | | | | No | | 2X-No | | | ned32 | | | | | | | tify- | | | | | | | | | | Flags | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+ | NOTE | | | | | | | | | | 1: | | | | | | | | | | The | | | | | | | | | | AVP | | | | | | | | | | h | | | | | | | | | | eader | | | | | | | | | | bit | | | | | | | | | | de | | | | | | | | | | noted | | | | | | | | | | as | | | | | | | | | | \ | | | | | | | | | | "M\", | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | wh | | | | | | | | | | ether | | | | | | | | | | su | | | | | | | | | | pport | | | | | | | | | | of | | | | | | | | | | the | | | | | | | | | | AVP | | | | | | | | | | is | | | | | | | | | | requ | | | | | | | | | | ired. | | | | | | | | | | The | | | | | | | | | | AVP | | | | | | | | | | h | | | | | | | | | | eader | | | | | | | | | | bit | | | | | | | | | | de | | | | | | | | | | noted | | | | | | | | | | as | | | | | | | | | | \ | | | | | | | | | | "V\", | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | wh | | | | | | | | | | ether | | | | | | | | | | the | | | | | | | | | | opt | | | | | | | | | | ional | | | | | | | | | | Vend | | | | | | | | | | or-ID | | | | | | | | | | field | | | | | | | | | | is | | | | | | | | | | pr | | | | | | | | | | esent | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | AVP | | | | | | | | | | he | | | | | | | | | | ader. | | | | | | | | | | For | | | | | | | | | | fu | | | | | | | | | | rther | | | | | | | | | | det | | | | | | | | | | ails, | | | | | | | | | | see | | | | | | | | | | IETF | | | | | | | | | | RFC 6 | | | | | | | | | | 733 \ | | | | | | | | | | [3]. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 2: If | | | | | | | | | | the | | | | | | | | | | M-bit | | | | | | | | | | is | | | | | | | | | | set | | | | | | | | | | for | | | | | | | | | | an | | | | | | | | | | AVP | | | | | | | | | | and | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | does | | | | | | | | | | not | | | | | | | | | | under | | | | | | | | | | stand | | | | | | | | | | the | | | | | | | | | | AVP, | | | | | | | | | | it | | | | | | | | | | shall | | | | | | | | | | r | | | | | | | | | | eturn | | | | | | | | | | a | | | | | | | | | | rejec | | | | | | | | | | tion. | | | | | | | | | | If | | | | | | | | | | the | | | | | | | | | | M-bit | | | | | | | | | | is | | | | | | | | | | not | | | | | | | | | | set | | | | | | | | | | for | | | | | | | | | | an | | | | | | | | | | AVP, | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | shall | | | | | | | | | | not | | | | | | | | | | r | | | | | | | | | | eturn | | | | | | | | | | a | | | | | | | | | | rejec | | | | | | | | | | tion, | | | | | | | | | | wh | | | | | | | | | | ether | | | | | | | | | | or | | | | | | | | | | not | | | | | | | | | | it | | | | | | | | | | u | | | | | | | | | | nders | | | | | | | | | | tands | | | | | | | | | | the | | | | | | | | | | AVP. | | | | | | | | | | If | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | u | | | | | | | | | | nders | | | | | | | | | | tands | | | | | | | | | | the | | | | | | | | | | AVP | | | | | | | | | | but | | | | | | | | | | the | | | | | | | | | | M-bit | | | | | | | | | | value | | | | | | | | | | does | | | | | | | | | | not | | | | | | | | | | match | | | | | | | | | | with | | | | | | | | | | the | | | | | | | | | | defin | | | | | | | | | | ition | | | | | | | | | | in | | | | | | | | | | this | | | | | | | | | | t | | | | | | | | | | able, | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eiver | | | | | | | | | | shall | | | | | | | | | | i | | | | | | | | | | gnore | | | | | | | | | | the | | | | | | | | | | M | | | | | | | | | | -bit. | | | | | | | | | +-------+-------+-------+-------+------+-----+-------+-------+-------+
The following table specifies the Diameter AVPs re-used by the V4 interface
protocol from existing Diameter Applications, including a reference to their
respective specifications and when needed, a short description of their use
within V4.
Any other AVPs from existing Diameter Applications, except for the AVPs from
the Diameter base protocol, do not need to be supported. The AVPs from the
Diameter base protocol are not included in table 6.3.1-2, but they may be re-
used for the V4 protocol.
Table 6.3.1-2: V4 re-used Diameter AVPs
+----------------+----------------+----------------+--------------+ | Attribute Name | Reference | Comments | M-bit | +----------------+----------------+----------------+--------------+ | V2X-Sub | 3GPP TS | See | | | scription-Data | 29.272 [10] | clause 6.3.2. | | +----------------+----------------+----------------+--------------+ | V | 3GPP TS | | | | isited-PLMN-Id | 29.272 [10] | | | +----------------+----------------+----------------+--------------+ | User-Name | IETF | | | | | RFC 6733 [3] | | | +----------------+----------------+----------------+--------------+ | User-Id | 3GPP TS | | | | | 29.272 [10] | | | +----------------+----------------+----------------+--------------+ | Reset-ID | 3GPP TS | | | | | 29.272 [10] | | | +----------------+----------------+----------------+--------------+ | MSISDN | 3GPP TS | | | | | 29.329 [11] | | | +----------------+----------------+----------------+--------------+ | Supp | 3GPP T | | | | orted-Features | S 29.229 [6] | | | +----------------+----------------+----------------+--------------+ | F | 3GPP T | | | | eature-List-ID | S 29.229 [6] | | | +----------------+----------------+----------------+--------------+ | Feature-List | 3GPP T | | | | | S 29.229 [6] | | | +----------------+----------------+----------------+--------------+ | OC-Supp | IETF R | See | Must set | | orted-Features | FC 7683 [12] | clause 6.3.6 | | +----------------+----------------+----------------+--------------+ | OC-OLR | IETF R | See | Must set | | | FC 7683 [12] | clause 6.3.7 | | +----------------+----------------+----------------+--------------+ | DRMP | IETF R | See | Must not set | | | FC 7944 [13] | clause 6.3.8 | | +----------------+----------------+----------------+--------------+ | Load | IETF R | See clause | Must not set | | | FC 8583 [16] | 6.3.9 | | +----------------+----------------+----------------+--------------+ | NOTE 1: The | | | | | M-bit settings | | | | | for re-used | | | | | AVPs override | | | | | those of the | | | | | defining | | | | | specifications | | | | | that are | | | | | referenced. | | | | | Values | | | | | include: | | | | | \"Must set\", | | | | | \"Must not | | | | | set\". If the | | | | | M-bit setting | | | | | is blank, then | | | | | the defining | | | | | specification | | | | | applies. | | | | | | | | | | NOTE 2: If the | | | | | M-bit is set | | | | | for an AVP and | | | | | the receiver | | | | | does not | | | | | understand the | | | | | AVP, it shall | | | | | return a | | | | | rejection. If | | | | | the M-bit is | | | | | not set for an | | | | | AVP, the | | | | | receiver shall | | | | | not return a | | | | | rejection, | | | | | whether or not | | | | | it understands | | | | | the AVP. If | | | | | the receiver | | | | | understands | | | | | the AVP but | | | | | the M-bit | | | | | value does not | | | | | match with the | | | | | definition in | | | | | this table, | | | | | the receiver | | | | | shall ignore | | | | | the M-bit. | | | | +----------------+----------------+----------------+--------------+
### 6.3.2 V2X-Subscription-Data
The V2X-Subscription-Data AVP is of type Group. It shall contain the V2X
related subscription data. The V2X-Subscription-Data is originally defined in
3GPP TS 29.272 [10].
AVP format when used over V4 interface:
> V2X-Subscription-Data ::= \
>
> [ V2X-PC5-Allowed-PLMN ]
>
> *[AVP]
### 6.3.3 V2X-PC5-Allowed-PLMN
The V2X-PC5-Allowed-PLMN AVP is of type Group. It shall contain the PLMN where
the UE is authorised to use V2X communication over PC5.
AVP format
> V2X-PC5-Allowed-PLMN ::= \
>
> *[ Visited-PLMN-Id ]
>
> *[AVP]
### 6.3.4 V2X-Update-Flags
The V2X-Update-Flags AVP is of type Unsigned32 and it shall contain a bit
mask. The meaning of the bits is defined in table 6.3.4-1:
Table 6.3.4-1: V2X-Update-Flags
* * *
Bit Name Description 0 Update This bit, when set, indicates that the V2X
subscriber related data are updated. 1 Removal This bit, when set, indicates
that all of the V2X subscriber related data are removed. 2 Reset-ID Update
This bit, when set, indicates that the complete list on Reset-IDs is updated.
3 Reset-ID Removal This bit, when set, indicates that the complete list on
Reset-IDs is removed. NOTE: Bits not defined in this table shall be cleared by
the sending HSS and discarded by the receiving V2X Control Function.
* * *
### 6.3.5 V2X-Notify-Flags
The V2X-Notify-Flags AVP is of type Unsigned32 and it shall contain a bit
mask. The meaning of the bits shall be as defined in table 6.3.5-1:
Table 6.3.5-1: V2X-Notify-Flags
+----------------------+----------------------+----------------------+ | bit | name | Description | +----------------------+----------------------+----------------------+ | 0 | V2X communication | This bit, when set, | | | over PC5 Revoked | shall indicate to | | | | the HSS that the | | | | authorization for | | | | V2X communication | | | | over PC5 is to be | | | | revoked on the | | | | indicated PLMN. | +----------------------+----------------------+----------------------+ | 1 | Purged UE | This bit, when set, | | | | shall indicate to | | | | the HSS that the | | | | subscriber\'s data | | | | has been deleted | | | | from the V2X Control | | | | Function. | +----------------------+----------------------+----------------------+ | NOTE 1: Bits not | | | | defined in this | | | | table shall be | | | | cleared by the | | | | sending V2X Control | | | | Function and | | | | discarded by the | | | | receiving HSS. | | | | | | | | NOTE 2: If Purged UE | | | | bit is set, all | | | | other bits in this | | | | table shall be | | | | cleared by the | | | | sending V2X Control | | | | Function and | | | | discarded by the | | | | receiving HSS. | | | +----------------------+----------------------+----------------------+
### 6.3.6 OC-Supported-Features
The OC-Supported-Features AVP is of type Grouped and it is defined in IETF RFC
7683 [12]. This AVP is used to support Diameter overload control mechanism,
see Annex A for more information.
### 6.3.7 OC-OLR
The OC-OLR AVP is of type Grouped and it is defined in IETF RFC 7683 [12].
This AVP is used to support Diameter overload control mechanism, see Annex A
for more information.
### 6.3.8 DRMP
The DRMP AVP is of type Enumerated and it is defined in IETF RFC 7944 [13].
This AVP allows the HSS and the V2X Control Function to indicate the relative
priority of Diameter messages over the V4 interface.
### 6.3.9 Load
The Load AVP is of type Grouped and it is defined in IETF RFC 8583 [16]. This
AVP is used to support Diameter load control mechanism, see Annex D for more
information.
## 6.4 Result-Code AVP and Experimental-Result AVP Values
### 6.4.1 General
This clause defines result code values that shall be supported by all Diameter
implementations that conform to this specification.
### 6.4.2 Success
Result codes that fall within the Success category shall be used to inform a
peer that a request has been successfully completed. The Result-Code AVP
values defined in the Diameter base protocol IETF RFC 6733 [3] shall be
applied.
### 6.4.3 Permanent Failures
#### 6.4.3.1 General
Errors that fall within the Permanent Failures category shall be used to
inform the peer that the request has failed, and should not be attempted
again. The Result-Code AVP values defined in the Diameter base protocol IETF
RFC 6733 [3] shall be applied. When one of the result codes defined here is
included in a response, it shall be inside an Experimental-Result AVP and the
Result-Code AVP shall be absent.
#### 6.4.3.2 DIAMETER_ERROR_USER_UNKNOWN (5001)
This result code shall be sent by the HSS to indicate that the user identified
by the IMSI is unknown. This error code is defined in 3GPP TS 29.229 [6].
#### 6.4.3.3 DIAMETER_ERROR_UNKNOWN_V2X_SUBSCRIPTION (5690)
This result code shall be sent by the HSS to indicate that no V2X subscription
is associated with the IMSI.
#### 6.4.3.4 DIAMETER_ERROR_V2X_NOT_ALLOWED (5691)
This result code shall be sent by the HSS to indicate that V2X is not allowed
to be used in the specific PLMN where the UE is registered.
###### ## Annex A (normative): Diameter overload control mechanism
## A.1 General
Diameter overload control mechanism is an optional feature.
IETF RFC 7683 [12] specifies a Diameter overload control mechanism which
includes the definition and the transfer of related AVPs between Diameter
nodes.
It is recommended to make use of IETF RFC 7683 [12] on the V4 interface where,
when applied, the V2X Control Function shall behave as reacting nodes and the
HSS as a reporting node.
## A.2 HSS behaviour
The HSS requests traffic reduction from the V2X Control Function when it is in
an overload situation, including OC-OLR AVP in answer commands as described in
IETF RFC 7683 [12].
The HSS identifies that it is in an overload situation by implementation
specific means. For example, the HSS may take into account the traffic over
the V4 interface or other interfaces, the level of usage of internal resources
(CPU, memory), the access to external resources, etc.
The HSS determines the specific contents of OC-OLR AVP in overload reports and
the HSS decides when to send OC-OLR AVPs by implementation specific means.
## A.3 V2X Control Function behaviour
The V2X Control Function applies required traffic reduction received in answer
commands to subsequent applicable requests, as per IETF RFC 7683 [12].
The V2X Control Function achieves requested traffic reduction by
implementation specific means. For example, the V2X Control Function may
implement message throttling with prioritization or a message retaining
mechanism for operations that can be postponed.
## Annex B (Informative): Diameter overload node behaviour
## B.1 Message prioritization
This clause describes possible behaviours of the V2X Control Function
regarding message prioritisation in an informative purpose.
The V2X Control Function may take the following into account when making
throttling decisions:
\- Identification of the procedures that can be deferred, so to avoid to drop
non deferrable procedures;
\- Prioritisation of certain types of request (e.g. between V2X-Subscriber-
Information-Request (PIR) and V2X-Notify-Request (PNR)) according to the
context of their use, in particular:
\- Higher prioritisation for commands that are related to a registered user
for a service, so to avoid the interruption of the registered service for the
user.
###### ## Annex C (normative):**** Diameter message priority mechanism
## C.1 General
IETF RFC 7944 [13] specifies a Diameter routing message priority mechanism
that allows Diameter nodes to indicate the relative priority of Diameter
messages. With this information, other Diameter nodes may leverage the
relative priority of Diameter messages into routing, resource allocation and
also abatement decisions when overload control is applied.
## C.2 V4 interface
### C.2.1 General
The Diameter message priority mechanism is an optional feature.
It is recommended to make use of IETF RFC 7944 [13] over the V4 interface of
an operator network when the overload control defined in Annex A is applied on
this V4 interface.
### C.2.2 HSS and V2X Control Function behaviour
When the HSS and the V2X Control Function support the Diameter message
priority mechanism over the V4 interface, the HSS and the V2X Control Function
shall comply with IETF RFC 7944 [13]. In particular, when priority is
required, the HSS and the V2X Control Function shall include the DRMP AVP
indicating a priority level in the requests it sends, and prioritise received
requests according to the priority level received within the DRMP AVP. They
shall prioritise received answers according to the priority level received
within the DRMP AVP if present, otherwise according to the priority level of
the corresponding request. They shall include the DRMP AVP in the answer to a
received request if the required priority of the answer is different from the
one of the request. The HSS and the V2X Control Function decisions for a
required priority and for the priority level value are implementation
specific.
Diameter requests related to high priority traffic should contain a DRMP AVP
with a high priority of which the level value is operator dependent.
## D.1 General
Diameter load control mechanism is an optional feature.
IETF RFC 8583 [16] specifies a Diameter load control mechanism which includes
the definition and the transfer of related AVPs between Diameter nodes.
It is recommended to make use of IETF draft-ieft-dime-load-08 [16] on the V4
interface where, when applied, the V2X Control Function shall behave as
reacting node and the HSS as a reporting node.
## D.2 HSS behaviour
The HSS may report its current load by including a Load AVP of type HOST in
answer commands as described in IETF RFC 8583 [16].
The HSS calculates its current load by implementation specific means. For
example, the HSS may take into account the traffic over the V4 interface or
other interfaces, the level of usage of internal resources (e.g. CPU, memory),
the access to external resources, etc.
The HSS determines when to send Load AVPs of type HOST by implementation
specific means.
## D.3 V2X Control Function behaviour
When performing next hop Diameter Agent selection for requests that are routed
based on realm, the V2X Control Function may take into account load values
from Load AVPs of type PEER received from candidate next hop Diameter nodes,
as per IETF RFC 8583 [16].
#
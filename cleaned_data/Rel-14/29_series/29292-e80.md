# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
IMS Centralized Services (ICS) enable the delivery of IM CN subsystem based
multimedia telephony and supplementary services as defined in 3GPP TS 24.173
[4] to users regardless of the attached access network type; e.g. CS domain
access or IP-CAN.
The present document specifies the principles of interworking between the IM
CN subsystem and CS domain in order to enable ICS for UEs using CS domain
access.
The present document addresses the area of registration procedures
interworking between the CS domain and IM CN subsystem.
The present document addresses the areas of control and user plane
interworking between the IM CN subsystem and CS domain through an MSC Server
enhanced for ICS and CS-MGW respectively. This includes the signalling
procedures between the MSC Server and CS-MGW. For the specification of control
plane interworking, present document defines the protocol interworking between
the 3GPP profile of SIP as described in 3GPP TS 24.229 [2] and NAS signalling
as described in 3GPP TS 24.008 [3] required for the support of IM CN subsystem
based multimedia telephony and supplementary services.
The present document addresses the area of supplementary service configuration
interworking between the CS domain and IM CN subsystem.
The present document is applicable to the MSC Server and CS-MGW.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and
SDP\".
[3] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core
Network protocols; Stage 3\".
[4] 3GPP TS 24.173: \"IMS multimedia telephony communication service and
supplementary services; Stage 3\".
[5] 3GPP TS 23.292: \"IP Multimedia Subsystem (IMS) Centralized Services;
Stage 2\".
[6] 3GPP TS 23.002: \"Network Architecture\".
[7] 3GPP TS 24.292: \"IP Multimedia (IM) Core Network (CN) subsystem
Centralized Services (ICS); Stage 3\".
[8] 3GPP TS 23.018: \"Basic call handling; Technical realization\".
[9] 3GPP TS 22.003: \"Circuit Teleservices supported by a Public Land Mobile
Network (PLMN)\".
[10] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[11] 3GPP TS 29.232: \"Media Gateway Controller (MGC) -- Media Gateway (MGW)
interface; Stage 3\".
[12] 3GPP TS 24.081: \"Line Identification Supplementary Services -- Stage
3\".
[13] Void
[14] 3GPP TS 24.608: \"Terminating Identification Presentation (TIP) and
Terminating Identification Restriction (TIR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[15] 3GPP TS 25.414: \"UTRAN Iu interface data transport and transport
signalling\".
[16] 3GPP TS 25.415: \"UTRAN Iu interface user plane protocols\".
[17] 3GPP TS 25.411: \"UTRAN Iu interface layer 1\".
[18] 3GPP TS 29.414: \"Core network Nb data transport and transport
signalling\".
[19] 3GPP TS 48.004: \"Base Station System -- Mobile-services Switching Centre
(BSS -- MSC) interface; Layer 1 specification\".
[20] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[21] Void.
[22] 3GPP TS 26.226: \"CTM Cellular Text telephony Modem, General
description\".
[23] 3GPP TS 24.604: \"Communication Diversion (CDIV) using IP Multimedia (IM)
Core Network (CN) subsystem; Protocol specification\".
[24] 3GPP TS 24.082: \"Call Forwarding (CF) supplementary services; Stage 3\".
[25] 3GPP TS 24.072: \"Call Deflection (CD) Supplementary Service; Stage 3\".
[26] 3GPP TS 24.083: \"Call Waiting (CS) and Call Hold (HOLD) supplementary
services; Stage 3\".
[27] 3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[28] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony;
Media handling and interaction\".
[29] 3GPP TS 24.080: \"Mobile radio interface layer 3 supplementary services
specification; Formats and coding\".
[30] 3GPP TS 24.088: \"Call Barring (CB) Supplementary Service -- Stage 3\".
[31] 3GPP TS 24.611: \"Anonymous Communication Rejection (ACR) and
Communication Barring (CB); using IP Multimedia (IM) Core Network (CN)
subsystem; Protocol specification\".
[32] 3GPP TS 24.091: \"Explicit Call Transfer (ECT) supplementary service;
Stage 3\".
[33] 3GPP TS 24.629: \"Explicit Communication Transfer (ECT) using IP
Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".
[34] 3GPP TS 24.084: \"Multi Party (MPTY) supplementary service -- Stage 3\".
[35] 3GPP TS 24.605: \"Conference (CONF) using IP Multimedia (IM) Core Network
(CN) subsystem; Protocol specification\".
[36] 3GPP TS 24.147: \"Conferencing using the IP Multimedia (IM) Core Network
(CN) subsystem; Stage 3\".
[37] 3GPP TS 23.009: \"Handover procedures\".
[38] 3GPP TS 48.103: \"Base Station System -- Media GateWay (BSS-MGW)
interface; User Plane transport mechanism\".
[39] 3GPP TS 23.205: \"Bearer Independent switched core network; Stage 2\".
[40] 3GPP TS 23.231: \"SIP-I based circuit-switched core network; Stage 2\".
[41] 3GPP TS 24.010: \"Mobile radio interface layer 3 Supplementary services
specification; General aspects\".
[42] 3GPP TS 24.623: \"Extensible Markup Language (XML) Configuration Access
Protocol (XCAP) over the Ut interface for Manipulating Supplementary
Services\".
[43] 3GPP TS 24.607: \"Originating Identification Presentation (OIP) and
Originating Identification Restriction (OIR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[44] 3GPP TS 24.615: \"Communication Waiting (CW) using IP Multimedia (IM)
Core Network (CN) subsystem; Protocol specification\".
[45] IETF RFC 3326: \"The Reason Header Field for the Session Initiation
Protocol (SIP)\".
[46] 3GPP TS 29.163: \"Interworking between the IP Multimedia (IM) Core
Network (CN) subsystem and Circuit Switched (CS) networks\".
[47] IETF RFC 5009: \"Private Header (P-Header) Extension to the Session
Initiation Protocol (SIP) for Authorization of Early Media\".
[48] IETF RFC 3168: \"The Addition of Explicit Congestion Notification (ECN)
to IP\".
[49] IETF RFC 6679: \"Explicit Congestion Notification (ECN) for RTP over
UDP\".
[50] IETF RFC 3959: \"The Early Session Disposition Type for the Session
Initiation Protocol (SIP)\".
[51] 3GPP TS 24.182: \"IP Multimedia Subsystem (IMS) Customized Alerting Tones
(CAT); Protocol specification\".
[52] 3GPP TS 24.642: \"Completion of Communications to Busy Subscriber (CCBS)
and Completion of Communications by No Reply (CCNR) using IP Multimedia (IM)
Core Network (CN) subsystem\".
[53] 3GPP TS 24.093: \"Completion of Calls to Busy Subscriber (CCBS); Stage
3\".
[54] 3GPP TS 22.153: \"Multimedia Priority Service\".
[55] IETF RFC 4458: \"Session Initiation Protocol (SIP) URIs for Applications
such as Voicemail and Interactive Voice Response (IVR)\".
[56] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[57] IETF RFC 3262: \"Reliability of provisional responses in Session
Initiation Protocol (SIP)\".
[58] IETF RFC 3312: \"Integration of Resource Management and Session
Initiation Protocol (SIP)\".
[59] IETF RFC 4032: \"Update to the Session Initiation Protocol (SIP)
Preconditions Framework\".
[60] IETF RFC 5245: \"Interactive Connectivity Establishment (ICE): A Protocol
for Network Address Translator (NAT) Traversal for Offer/Answer Protocols\".
[61] 3GPP TS 26.441: \"Codec for Enhanced Voice Services (EVS); General
Overview\".
[62] 3GPP TS 26.445: \"Codec for Enhanced Voice Services (EVS); Detailed
Algorithmic Description\".
[63] IETF RFC 5939:\"Session Description Protocol (SDP) Capability
Negotiation\".
[64] 3GPP TS 23.333:\" Multimedia Resource Function Controller (MRFC) \-
Multimedia Resource Function Processor (MRFP) Mp interface: Procedures
Descriptions\".
[65] IETF RFC 8197: \"A SIP Response Code for Unwanted Calls\".
[66] IETF RFC 8224: \"Authenticated Identity Management in the Session
Initiation Protocol (SIP)\".
[67] ITU-T Recommendation Q.850 (05/1998) including Amendment 1 (07/2001):
\"Usage of cause and location in the Digital Subscriber Signalling System No.
1 and the Signalling System No. 7 ISDN User Part\".
[68] IETF RFC 8606: \"ISDN User Part (ISUP) Cause Location Parameter for the
SIP Reason Header Field\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**ICE lite:** The lite implementation of the Interactive Connectivity
Establishment (ICE) specified in IETF RFC 5245 [60].
**Full ICE:** The full implementation of the Interactive Connectivity
Establishment (ICE) specified in IETF RFC 5245 [60].
**NAS signalling:** layer 3 signalling carried over CS domain access between
the UE and MSC Server as defined in 3GPP TS 24.008 [3].
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.629 [33] apply:
**transferee**
**transferor**
**transfer target**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
3PCC 3^rd^ Party Call Control
ACR **Anonymous Communication Rejection**
BAIC Barring of All Incoming Calls
BAOC Barring of All Outgoing Calls
BIC-Roam Barring of Incoming Calls when Roaming outside the home PLMN country
BOIC Barring of Outgoing International Calls
BOIC-exHC Barring of Outgoing International Calls except those directed to the
Home PLMN Country
CB Communication Barring
CCBS Completion of Communication to Busy Subscriber
CCNL Completion of Communications on Not Logged-in
CCNR Completion of Communications on No Reply
CD Communication Deflection
CDIV Communication DIVersion
CFNL Communication Forwarding on Not Logged-in
CFNR Communication Forwarding No Reply
CFNRc Communication Forwarding on subscriber Not Reachable
CFU Communication Forwarding Unconditional
CONF CONFerence
CS Circuit Switched
CS-MGW Circuit Switched Media Gateway
ECN Explicit Congestion Notification
ECT Explicit Communication Transfer
> EVS Enhanced Voice Services
GRUU Globally Routable User Agent URI
HOLD communication HOLD
ICB **Incoming Communication Barring**
ICE Interactive Connectivity Establishment
ICS IM CN subsystem Centralized Services
IMS-MGW IP Multimedia Subsystem-Media Gateway Function
IuFP Iu Framing Protocol
MboIP Mb over IP
MRFP Media Resource Function Processor
MPS Multimedia Priority Service
NAS Non Access Stratum
OCB **Outgoing Communication Barring**
OIP Originating Identification Presentation
OIR Originating Identification Restriction
RTCP RTP Control Protocol
SDPCapNeg SDP Capability Negotiation
TDM Time Division Multiplex
TIP Terminating Identification Presentation
TIR Terminating Identification Restriction
# 4 Interworking overview
## 4.1 Interworking reference model
Figure 4.1.1 details the reference model required to support interworking
between the 3GPP IM CN subsystem and CS domain access for IM basic voice calls
and supplementary services.
{width="4.688194444444444in" height="2.6979166666666665in"}
NOTE 1: The logical split of the signalling and bearer path between the CS
access network and MSC Server enhanced for ICS is as shown; however, the
signalling and bearer may be directly connected to the MGW.
NOTE 2: The CS-MGW may be connected via the Mb reference point to various
network entities, such as a UE (via a GTP tunnel to a GGSN), an MRFP, or an
IMS-MGW, or a remote CS-MGW.
Figure 4.1.1: MSC Server -- IM CN subsystem interworking reference model
## 4.2 Interworking reference points and interfaces
The reference points and network interfaces shown in figure 4.1.1 are as
described:
**A reference point: The** A reference point is defined in 3GPP TS 23.002 [6].
**IuCS reference point: The** IuCS reference point is defined in 3GPP TS
23.002 [6].
**I2 reference point:** The call control protocol specified in this document
for use on the I2 reference point (i.e. between MSC Server enhanced for ICS
and CSCF) is based on Mw reference point as defined in 3GPP TS 23.002 [6] and
the 3GPP profile of SIP as defined in accordance with 3GPP TS 24.229 [2].
**Mc reference point:** The Mc reference point is defined in 3GPP TS 23.002
[6].
**Mb reference point:** The Mb reference point is defined 3GPP TS 23.002 [6].
## 4.3 Interworking functional entities
### 4.3.1 MSC Server enhanced for ICS
This is the component which provides the interworking between CS domain access
and IM CN subsystem control planes, and it shall support the functions as
defined in accordance with 3GPP TS 23.002 [6].
For brevity, where the term \"MSC Server\" is used in the rest of the
specification, this shall be understood as \"MSC Server enhanced for ICS\".
### 4.3.2 Circuit Switched Media Gateway Function (CS-MGW)
This is the component which provides the interworking between CS domain access
and IM CN subsystem user planes, and it shall support the functions as defined
in accordance with 3GPP TS 23.002 [6].
## 4.4 Control plane interworking
Within the IM CN subsystem, the 3GPP profile of SIP defined in 3GPP TS 24.229
[2] is used for session control.
Over CS domain access, NAS signalling is used for call origination, call
termination and supplementary services.
Therefore, in order to provide the required interworking to enable ICS for UE
using CS domain access, the control plane protocols shall be interworked
within the MSC Server.
## 4.5 User plane interworking
Within the IM CN subsystem, framing protocols such as RTP are used to
transport media packets to and from IM CN subsystem entities such as the UE,
MRFP or IMS-MGW.
CS domain access uses circuit switched bearer channels like TDM circuits (e.g.
64kbits PCM), ATM/AAL2 circuits or IP bearers using the IuFP framing protocol
or RTP to carry voice frames.
Therefore, in order to provide the required interworking to enable ICS for a
UE using CS domain access, the user plane protocols shall be interworked
within the CS-MGW, under the control of the MSC Server.
# 5 Control plane procedures and interworking
## 5.1 General
The following subclauses define the procedures and signalling interworking
performed by the MSC Server to enable ICS for UEs attached to the CS domain.
The interworking between NAS signalling and the Session Initiation Protocol
(SIP) with its associated Session Description Protocol (SDP) is specified.
The capabilities of SIP and SDP that are interworked with NAS signalling are
defined in 3GPP TS 24.229 [2].
Table 5.1.1 lists the service interworking within the scope of the present
document.
Table 5.1.1: Interworking between NAS signalling and SIP/SDP
* * *
Telephony or Supplementary Service TS11 non-emergency speech calls Originating
Identification Presentation (OIP) Originating Identification Restriction (OIR)
Terminating Identification presentation (TIP) Terminating Identification
restriction (TIR) Communication Hold and Resume Communication Waiting
Communication Barring Communication Diversion Explicit Communication Transfer
Conferencing Communication Completion to Busy Subscriber (CCBS) Communication
Completion on No Reply (CCNR) Communication Completion on Not Logged-in (CCNL)
* * *
## 5.2 IMS registration procedures interworking
### 5.2.1 Initial registration
Upon successful completion of the location updating procedure as specified in
3GPP TS 24.008 [3], an MSC Server supporting the ICS Indicator parameter as
specified in 3GPP TS 29.002 [20] shall determine whether to perform initial
IMS registration on behalf of the UE.
The relevant location update case, when an initial registration is needed to
the IM CN subsystem is a location update to new MSC/VLR service area (the
MSC/VLR was not the previous serving network element).
In accordance with 3GPP TS 23.292 [5], clause 7.2.1.1, the MSC Server may
perform an initial IMS registration. The optional flag referred to in clause
7.2.1.1 of 3GPP TS 23.292 [5] is implemented as the ICS Indicator parameter in
3GPP TS 29.002 [20].
When performing initial IMS registration, the MSC Server shall send a REGISTER
request on behalf of the UE as described in 3GPP TS 24.292 [7].
### 5.2.2 Reregistration
The MSC Server shall initiate reregistration for a previously registered
Public User Identity as described in 3GPP TS 24.292 [7] if that subscriber is
still registered in the MSC Server via CS domain access.
### 5.2.3 MSC Server initiated deregistration
The MSC Server shall send a REGISTER request for deregistration on behalf of
the UE as described in 3GPP TS 24.292 [7] upon receipt of any indication that
the subscriber is no longer registered in this MSC Server.
Prior to sending a REGISTER request for deregistration, the MSC Server shall
release all IMS dialogs related to the Public User Identity that is going to
be deregistered or to one of the implicitly registered Public User Identities.
## 5.3 Interworking of mobile originating call setup from NAS signalling to
SIP
### 5.3.1 General
The mobile originating call shall be established in accordance with 3GPP TS
23.018 [8] and 3GPP TS 24.008 [3]. The IM CN subsystem originating session
shall be established in accordance with 3GPP TS 24.292 [7] and 3GPP TS 24.229
[2]. The following subclauses describe the additional requirements for
interworking between NAS signalling and SIP.
The following subclauses also assume the originating call is received from a
subscriber with an active IM CN subsystem registration via the MSC Server
performing the interworking.
### 5.3.2 Receipt of a setup message
Upon receipt of a setup message (a SETUP message or an EMERGENCY SETUP
message), the MSC Server shall determine whether the originating call shall be
directed to the IM CN subsystem.
The originating call shall be directed to the IM CN subsystem if all of the
following conditions are met:
\- the setup message is a SETUP message and is determined by the MSC Server
not to be an emergency call, and
\- the bearer capability 1 information element indicates teleservice 11 as
described in 3GPP TS 22.003 [9], and
\- the CTM text telephony indication in the bearer capability 1 information
element is set to \"CTM text telephony is not supported\", and
\- the bearer capability 2 information element is not present.
Otherwise the originating call shall be handled by the MSC Server without
interworking to the IM CN subsystem.
### 5.3.3 Sending of INVITE
#### 5.3.3.1 General
Upon determining that an incoming SETUP message shall be interworked to the IM
CN subsystem, the MSC Server shall generate an INVITE request as further
detailed in the subclauses below.
#### 5.3.3.2 Coding of INVITE
The INVITE request shall be coded as described in 3GPP TS 24.292 [7] with the
following SETUP message interworking applied:
\- The called party BCD number information element in the SETUP message is
used to derive the Request URI of the INVITE request as follows:
1\. if the type of number field is set to \"international number\", then the
number digit fields, prefixed with a \"+\", shall be used to build a tel URI
or a SIP URI with \"user=phone\"; or
2\. if the type of number field is set to \"national number\", according to
local policy:
a) if the called party BCD number is considered as if the mobile station sent
a \"geo-local number\" then the MSC Server shall, as an operator option,
either:
\- convert the number to international format by prefixing the number digits
with \"+CC\" (where CC is the country code of the network in which the MSC
Server is located) and use this to build a tel URI or a SIP URI with
\"user=phone\"; or
\- use the number digit fields to build a tel URI or a SIP URI with
\"user=phone\". The phone-context parameter shall include the home network
domain name defined for IMS centralized services in 3GPP TS 23.003 [10]. The
phone-context which includes the home network domain name of the calling party
is prefixed by the \"geo-local\" string according to 3GPP TS 24.229 [2].
b) if the called party BCD number is considered as if the mobile station sent
a \"home-local number\", then the MSC Server shall, as an operator option,
either:
\- convert the number to international format by prefixing the number digits
with \"+CC\" (where CC is the country code of the home network of the calling
party) and use this to build a tel URI or a SIP URI with \"user=phone\"; or
\- use the number digit fields to build a tel URI or a SIP URI with
\"user=phone\". The phone-context parameter shall include the home network
domain name defined for IMS centralized services in 3GPP TS 23.003 [10].
NOTE 1: When the calling party is not in roaming situation, the current
physical location of the user is identical to the home network of the user; by
default, the called party BCD number information element received in the SETUP
message should be considered as a \"geo-local number\".
3\. if the type of number field is set to \"unknown\", then the MSC Server
shall build a SIP URI with \"user=phone\" or a tel URI, including the received
digits as an unprocessed dial string to the IM CN subsystem, using one of the
formats for UEs without dial string processing capabilities, as defined in
3GPP TS 24.229 [2], clause 5.1.2A.1.3;
NOTE 2: This sets the requirement that the dialling plan is designed so it
enables the IM CN subsystem to differentiate local numbers from other numbers;
refer to clause 5.1.2A.1.3.
\- if the CLIR invocation information element is present in the SETUP message,
the From header shall be set to an Anonymous User Identity as defined in 3GPP
TS 23.003 [10] and the MSC Server shall include a Privacy header with priv-
value set to \"id\";
\- if the CLIR suppression information element is present in the SETUP
message, the MSC Server shall include a Privacy header with priv-value set to
\"none\";
\- if the CLIR invocation information element and CLIR suppression information
element are not present in the SETUP message, the MSC Server shall not include
a Privacy header;
\- the P-Asserted-Identity header shall be set to the default public identity
received during registration procedures;
\- the Contact header shall be set to:
\- the public GRUU received at registration as specified in 3GPP TS 24.229
[2]; or
\- if the CLIR suppression information element is present in the SETUP message
to the temporary GRUU received at registration as specified in 3GPP TS 24.229
[2].
When a SIP URI is used for the Request URI, the host portion of the SIP URI
shall be set to the home network domain name defined for IMS centralized
services in 3GPP TS 23.003 [10].
If the MSC server supports the P-Early-Media header as a network option, then
it shall include the header in each outgoing SIP INVITE request.
The MSC Server shall include a P-Charging-Vector header field in the initial
INVITE request with an \"icid-value\" header field parameter as specified in
3GPP TS 32.260 [56].
Unless local configuration indicates that the network is serving users not
supporting SIP preconditions, the MSC server shall include in a Supported
header field of the initial INVITE request:
1) a \"100rel\" option tag as defined in IETF RFC 3262 [57] to indicate the
support for reliable provisional responses; and
2) a \"precondition\" option tag as defined in IETF RFC 3312 [58] to indicate
the support for the SIP preconditions mechanism.
#### 5.3.3.3 Coding of the SDP offer
The MSC Server shall determine the speech codecs supported by the UE as
specified in 3GPP TS 24.008 [3] and use this information when constructing a
codec list for the SDP offer. The MSC Server may also add speech codecs. The
added speech codecs are based on configuration data in the MSC Server.
If the MSC Server indicated the support for the SIP preconditions mechanism as
described in clause 5.3.3.2 and
\- the access bearer establishment has been initiated prior to the sending of
the INVITE request (e.g. no speech codec or one speech codec is indicated from
the originating UE) the MSC Server shall indicate that preconditions have been
met in the initial SDP offer using the segmented status type, as defined in
IETF RFC 3312 [58] and IETF RFC 4032 [59], as well as the strength-tag value
\"mandatory\" for the local segment and the strength-tag value \"optional\"
for the remote segment. The MSC Server may indicate in the bearer
establishment procedure to the UE the speech codec the UE shall use; or
\- the access side bearer establishment has not been performed prior to
sending the INVITE request,
a) the MSC Server shall indicate that preconditions have not been met in the
SDP offer using the segmented status type, as defined in IETF RFC 3312 [58]
and IETF RFC 4032 [59], as well as the strength-tag value \"mandatory\" for
the local segment and the strength-tag value \"optional\" for the remote
segment; and.
b) once access side bearer establishment has been performed, the MSC Server
shall indicate that preconditions have been met in a new SDP offer in a
subsequent UPDATE or PRACK request.
#### 5.3.3.4 Actions on the SDP answer
At the receipt of the SDP answer the MSC Server shall analyse the received
speech codecs:
\- If the received speech codecs in the SDP answer do not include any of the
speech codecs provided by the UE in the SETUP message or the SDP answer only
include the default speech codec the MSC Server shall instruct the CS-MGW to
perform transcoding and indicate in the bearer establishment procedure to the
UE the speech codec the UE shall use. Which of the codecs used is based on
local policy;
\- if only one speech codec is received in the SDP answer, the MSC Server
shall select that speech codec and may indicate the speech codec in the bearer
establishment procedure to the UE;
\- if more than one speech codec is received in the SDP answer the MSC Server
shall select one codec based on local configuration and may indicate the
speech codec in the bearer establishment procedure to the UE; and send a new
SDP offer which shall indicate the speech codec that the MSC Server has
selected.
For UTRAN and GERAN Iu-mode, the NAS Synchronisation Indicator information
element shall be used to inform the UE of the selected codec as specified in
3GPP TS 24.008 [3].
### 5.3.4 Sending of ALERTING
The MSC Server shall send an ALERTING message towards the UE upon receiving
the first 180 Ringing response.
### 5.3.4a Sending of PROGRESS
Once all the following conditions have been met:
1) the MSC server supports the P-Early-Media header field, and received the
first SIP 181 (Call is being forwarded) response, or 182 (Queued) response, or
183 (Session Progress) response, or a SIP UPDATE request that includes a
P-Early-Media header field authorizing backward early media;
2) SDP preconditions are not used, or applicable SDP preconditions have been
met;
3) the MSC server did not receive a SIP 180 (Ringing) response; and
4) a PROGRESS message has not been sent before;
then the MSC server shall send a PROGRESS message.
### 5.3.4b Through-Connecting early media from IMS
If a SIP 18x response or a SIP UPDATE request is received by the MSC server,
once all the following conditions have been met:
1) the MSC server supports the P-Early-Media header field, and the response or
request includes a P-Early-Media header field authorizing backward early
media; and
2) SDP preconditions are not used, or applicable SDP preconditions have been
met;
then the MSC server shall instruct the CS-MGW to through-connect as described
in clause 7.1.5 for early media from the IMS side unless the CS-MGW has
already been through-connected.
NOTE: An MSC server supporting the early session model CAT supplementary
service applies additional procedure described in clause 5.6.9.
### 5.3.5 Applying ringback tone
The MSC Server shall instruct the CS-MGW to apply ringback tone towards the UE
in the following conditions:
\- a 180 Ringing response is received and either:
\- the MSC Server does not support the P-Early-Media header as a network
option; or
\- the MSC Server supports the P-Early-Media header as a network option and
according to IETF RFC 5009 [47] backward early media is not authorized (the
most recently received P-Early-Media header does not authorize backward early
media or the P-Early-Media header has not yet been received).
### 5.3.6 Receipt of 200 OK (INVITE)
Upon receipt of the first 200 OK (INVITE) response, the MSC Server shall:
\- instruct the CS-MGW to stop ringback if ringback was previously applied;
and
\- instruct the CS-MGW to through-connect the bearer in both directions; and
\- send a CONNECT message towards the UE as described in 3GPP TS 24.008 [3].
Interworking applied for the TIP service is described in clause 5.6.2.1.
The MSC Server shall not progress any further early dialogs to established
dialogs. Therefore, upon receipt of a subsequent 200 OK final response to the
initial INVITE request (e.g. due to forking), the MSC Server shall:
\- acknowledge the response with an ACK request; and
\- send a BYE request to this dialog in order to terminate it.
### 5.3.7 Receipt of status-codes 3xx
Upon receipt of a 3xx response to the initial INVITE, the default behaviour of
the MSC Server shall be to release the call with a cause code value of 127
(Interworking unspecified).
NOTE: The MSC Server may also decide to redirect the call toward the URI in
the Contact header field of the 3xx response, as an operator option. Such
handling is outside the scope of the present document.
### 5.3.8 Receipt of SIP status-codes 4xx, 5xx or 6xx
If the MSC Server receives a 4xx, 5xx or 6xx SIP response to the initial SIP
INVITE request and the MSC Server has not sent a SIP CANCEL request, the MSC
Server shall initiate call clearing procedures by sending a CC DISCONNECT
message towards the UE as described in 3GPP TS 24.008 [3] with the following
interworking applied:
1) If one or more Reason header fields are included in the 4xx, 5xx or 6xx SIP
response, then the cause value of each Reason header field shall be mapped to
a cause information element in the CC DISCONNECT message as follows:
a) if the Reason header field contains a Q.850 cause value, the numeric
\"cause\" parameter value shall be mapped to the cause value octet of the
cause information element in the CC DISCONNECT message according to table
5.3.8.2. The MSC Server shall set:
\- the coding standard to \"Standard defined for the GSM PLMNs\"; and
\- the location as follows:
I) to \"network beyond interworking point\"; or
II) if, as a network option, the MSC Server supports the location header field
parameter as described in IETF RFC 8606 [68], the MSC Server shall derive the
value of the location from the location parameter in the SIP Reason header
field according to table 5.3.8.3;
b) if the Reason header field contains a SIP status-code, the coding of the
cause information element in the CC DISCONNECT message shall be as follows:
\- set the coding standard to \"Standard defined for the GSM PLMNs\";
\- set the location to \"network beyond interworking point\"; and
\- derive the cause value from the SIP status-code received in the Reason
header field according to table5.3.8.1. The 4xx, 5xx, and 6xx SIP responses
that are not covered in this table shall be interworked to a cause value of
127 (Interworking, unspecified); and
c) if no Reason header field is included in the 4xx, 5xx or 6xx SIP response,
the coding of the cause information element in the CC DISCONNECT message is
derived from the SIP status-code of the SIP response according to table
5.3.8.1, where the following information elements shall be set to:
\- coding standard to \"Standard defined for the GSM PLMNs\"; and
\- location to \"network beyond interworking point\".
Table 5.3.8.1: Mapping the 4xx/5xx/6xx status-code to the cause information
element
+----------------------------------+----------------------------------+ | SIP status-code | Cause value | +----------------------------------+----------------------------------+ | 400 Bad Request | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 401 Unauthorized | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 402 Payment Required | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 403 Forbidden | 79 (Service or option not | | | implemented, unspecified) | +----------------------------------+----------------------------------+ | 404 Not Found | 1 (Unassigned (unallocated) | | | number) | +----------------------------------+----------------------------------+ | 405 Method Not Allowed | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 406 Not Acceptable | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 407 Proxy authentication | 127 (Interworking, unspecified) | | required | | +----------------------------------+----------------------------------+ | 408 Request Timeout | 102 (Recovery on timer expiry) | +----------------------------------+----------------------------------+ | 410 Gone | 22 (Number changed) | +----------------------------------+----------------------------------+ | 413 Request Entity too long | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 414 Request-URI too long | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 415 Unsupported Media type | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 416 Unsupported URI scheme | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 417 Unknown Resource-Priority | 79 (Service or option not | | | implemented, unspecified) | +----------------------------------+----------------------------------+ | 420 Bad Extension | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 421 Extension required | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 422 Session Interval Too Small | 31 (Normal, unspecified) | +----------------------------------+----------------------------------+ | 423 Interval Too Brief | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 424 Bad Location Information | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 428 Use Identity Header (NOTE 2) | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 433 Anonymity Disallowed | 24 (Call rejected due to feature | | | at the destination) | +----------------------------------+----------------------------------+ | 436 Bad Identity Info (NOTE 2) | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 437 Unsupported Credential | 127 (Interworking, unspecified) | | (NOTE 2) | | +----------------------------------+----------------------------------+ | 438 Invalid Identity Header | 127 (Interworking, unspecified) | | (NOTE 2) | | +----------------------------------+----------------------------------+ | 436 Bad Identity Info (NOTE 2) | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 480 Temporarily Unavailable | 41 (Temporary Failure) | +----------------------------------+----------------------------------+ | 481 Call/Transaction does not | 127 (Interworking, unspecified) | | exist | | +----------------------------------+----------------------------------+ | 482 Loop detected | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 483 Too many hops | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 484 Address Incomplete | 28 (Invalid number format | | | (incomplete number)) | +----------------------------------+----------------------------------+ | 485 Ambiguous | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 486 Busy Here | 17 (User busy) | +----------------------------------+----------------------------------+ | 487 Request terminated | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 488 Not acceptable here | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 493 Undecipherable | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 500 Server Internal error | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 501 Not implemented | 79 (Service or option not | | | implemented, unspecified) | +----------------------------------+----------------------------------+ | 502 Bad Gateway | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 503 Service Unavailable | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 504 Server timeout | 102 (Recovery on timer expiry) | +----------------------------------+----------------------------------+ | 505 Version not supported | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 513 Message too large | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 580 Precondition failure | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 600 Busy Everywhere | 17 (User busy) | +----------------------------------+----------------------------------+ | 603 Decline | 21 (Call rejected) | +----------------------------------+----------------------------------+ | 604 Does not exist anywhere | 1 (Unassigned (unallocated) | | | number) | +----------------------------------+----------------------------------+ | 606 Not acceptable | 127 (Interworking, unspecified) | +----------------------------------+----------------------------------+ | 607 Unwanted (NOTE) | 21 (Call rejected) | +----------------------------------+----------------------------------+ | NOTE 1: The \"607 Unwanted\" SIP | | | status code is defined in | | | IETF RFC 8197 [65]. | | | | | | NOTE 2: The 428, 436, 437 and | | | 438 SIP response codes are | | | defined in IETF RFC 8224 [66]. | | +----------------------------------+----------------------------------+
If the MSC Server supports restoration procedures, the MSC Server shall in
addition to the procedures in this clause perform the procedures in clause
5.3.10.
Table 5.3.8.2: Mapping of \"cause\" parameter for protocol \"Q.850\" to the
cause information element
+----------------------------------+----------------------------------+ | Reason header field with | Cause information element | | protocol value \"Q.850\" | | +----------------------------------+----------------------------------+ | \"cause\" parameter value | Cause value | +----------------------------------+----------------------------------+ | 1 (Unallocated (unassigned) | 1 (Unallocated (unassigned) | | number) | number) | +----------------------------------+----------------------------------+ | 3 (No route to destination) | 3 (No route to destination) | +----------------------------------+----------------------------------+ | 8 (Pre-emption) | 25 (Pre-emption) | +----------------------------------+----------------------------------+ | 16 (Normal call clearing) | 16 (Normal call clearing) | +----------------------------------+----------------------------------+ | 17 (User busy) | 17 (User busy) | +----------------------------------+----------------------------------+ | 18 (No user responding) | 18 (No user responding) | +----------------------------------+----------------------------------+ | 19 (No answer from user (user | 19 (User alerting, no answer) | | alerted)) | | +----------------------------------+----------------------------------+ | 21 (Call rejected) | 21 (Call rejected) | +----------------------------------+----------------------------------+ | 22 (Number changed) | 22 (Number changed) | +----------------------------------+----------------------------------+ | 24 (Call rejected due to feature | 24 (Call rejected due to feature | | at the destination) | at the destination) | +----------------------------------+----------------------------------+ | 26 (Non-selected user clearing) | 26 (Non selected user clearing) | +----------------------------------+----------------------------------+ | 27 (Destination out of order) | 27 (Destination out of order) | +----------------------------------+----------------------------------+ | 28 (Invalid number format | 28 (Invalid number format | | (address incomplete)) | (incomplete number)) | +----------------------------------+----------------------------------+ | 29 (Facility rejected) | 29 (Facility rejected) | +----------------------------------+----------------------------------+ | 31 (Normal, unspecified) | 31 (Normal, unspecified) | | | | | (class default) (NOTE 1, NOTE 2) | | +----------------------------------+----------------------------------+ | 34 (No circuit/channel | 34 (No circuit/channel | | available) | available) | +----------------------------------+----------------------------------+ | 38 (Network out of order) | 38 (Network out of order) | +----------------------------------+----------------------------------+ | 41 (Temporary failure) | 41 (Temporary failure) | +----------------------------------+----------------------------------+ | 42 (Switching equipment | 42 (Switching equipment | | congestion) | congestion) | +----------------------------------+----------------------------------+ | 43 (Access information | 43 (Access information | | discarded) | discarded) | +----------------------------------+----------------------------------+ | 44 (Requested circuit/channel | 44 (requested circuit/channel | | not available) | not available) | +----------------------------------+----------------------------------+ | 47 (Resource unavailable, | 47 (Resource unavailable, | | unspecified) | unspecified) | | | | | (class default) (NOTE 3) | | +----------------------------------+----------------------------------+ | 50 (Requested facility not | 50 (Requested facility not | | subscribed) | subscribed) | +----------------------------------+----------------------------------+ | 55 (Incoming calls barred within | 55 (Incoming calls barred within | | CUG) | the CUG) | +----------------------------------+----------------------------------+ | 57 (Bearer capability not | 57 (Bearer capability not | | authorised) | authorised) | +----------------------------------+----------------------------------+ | 58 (Bearer capability not | 58 (Bearer capability not | | presently available) | presently available) | +----------------------------------+----------------------------------+ | 63 (Service option not | 63 (Service option not | | available, unspecified)\ | available, unspecified) | | (class default) (NOTE 4) | | +----------------------------------+----------------------------------+ | 65 (Bearer capability not | 65 (Bearer capability not | | implemented) | implemented) | +----------------------------------+----------------------------------+ | 69 (Requested facility not | 69 (Requested facility not | | implemented) | implemented) | +----------------------------------+----------------------------------+ | 70 (Only restricted digital | 70 (Only restricted digital | | information capability is | information capability is | | available) | available) | +----------------------------------+----------------------------------+ | 79 (Service or option not | 79 (Service or option not | | implemented, unspecified) | implemented, unspecified) | | | | | (class default) (NOTE 5) | | +----------------------------------+----------------------------------+ | 87 (User not member of CUG) | 87 (User not member of CUG) | +----------------------------------+----------------------------------+ | 88 (Incompatible destination) | 88 (Incompatible destination) | +----------------------------------+----------------------------------+ | 91 (Invalid transit network | 91 (Invalid transit network | | selection) | selection) | +----------------------------------+----------------------------------+ | 95 (Invalid message, | 95 (Semantically incorrect | | unspecified)\ | message) | | (class default) (NOTE 6) | | +----------------------------------+----------------------------------+ | 97 (Message type non-existent or | 97 (Message type non-existent or | | not implemented) | not implemented) | +----------------------------------+----------------------------------+ | 98 (Message not compatible with | 98 (Message type not compatible | | call state or message type | with protocol state) | | non-existent or not implemented) | | +----------------------------------+----------------------------------+ | 99 (Information | 99 (Information element | | element/parameter non-existent | non-existent or not implemented) | | or not implemented) | | +----------------------------------+----------------------------------+ | 102 (Recovery on timer expiry) | 102 (Recovery on timer expiry) | +----------------------------------+----------------------------------+ | 111 (Protocol error, | 111 (Protocol error, | | unspecified)\ | unspecified) | | (class default) (NOTE 7) | | +----------------------------------+----------------------------------+ | 127 (Interworking, unspecified)\ | 127 (Interworking, unspecified) | | (class default) (NOTE 8) | | +----------------------------------+----------------------------------+ | NOTE 1: Class 0 and class 1 have | | | the same default value. | | | | | | NOTE 2: All other values in the | | | range 0 to 31 not appearing in | | | table shall be treated as cause | | | 31. | | | | | | NOTE 3: All other values in the | | | range 32 to 47 not appearing in | | | table shall be treated as cause | | | 47. | | | | | | NOTE 4: All other values in the | | | range 48 to 63 not appearing in | | | table shall be treated as cause | | | 63. | | | | | | NOTE 5: All other values in the | | | range 64 to 79 not appearing in | | | table shall be treated as cause | | | 79. | | | | | | NOTE 6: All other values in the | | | range 80 to 95 not appearing in | | | table shall be treated as cause | | | 95. | | | | | | NOTE 7: All other values in the | | | range 96 to 111 not appearing in | | | table shall be treated as cause | | | 111. | | | | | | NOTE 8: All other values in the | | | range 112 to 127 not appearing | | | in table shall be treated as | | | cause 127. | | | | | | NOTE 9: There are values which | | | are specified in | | | I | | | TU-T Recommendation Q.850 [67] | | | but not included in the present | | | table. The reasons for not | | | including them are: | | | | | | > \- the corresponding value is | | | > not specified in | | | > 3GPP TS 24.008 [3]; or | | | > | | | > \- the value is specified in | | | > 3GPP TS 24.008 [3] but not | | | > applicable to be sent to the | | | > user (for example value 6 | | | > \"Channel unacceptable\"). | | +----------------------------------+----------------------------------+
Table 5.3.8.3: Mapping of SIP Reason header field location parameter to
location parameter of Cause information element
* * *
Reason header field with protocol value \"Q.850\" Cause information element
\"location\" parameter value \"Location\" parameter value U user LPN private
network serving the local user LN public network serving the local user TN
transit network RLN public network serving the remote user RPN private network
serving the remote user LOC-6 network beyond interworking point INTL
international network LOC-8 network beyond interworking point LOC-9 network
beyond interworking point BI network beyond interworking point LOC-11 network
beyond interworking point LOC-12 network beyond interworking point LOC-13
network beyond interworking point LOC-14 network beyond interworking point
LOC-15 network beyond interworking point
* * *
### 5.3.9 Receipt of DISCONNECT
If the MSC Server receives a DISCONNECT message from the UE prior to receiving
a final response to the initial INVITE, the MSC Server shall send a CANCEL
request. If a 200 OK response to the initial INVITE is received after sending
the CANCEL request, the MSC Server shall send a BYE request to the IM CN
subsystem to terminate the session.
If the DISCONNECT message contains one or more cause information elements, the
first cause information element shall be mapped to a Reason header field in
the CANCEL or BYE request as follows:
\- set the protocol field to \"Q.850\"; and
\- set the numeric \"cause\" parameter value to the cause value field of the
cause information element according to table 5.4.8.1.2.
NOTE: The inclusion of reason-text in the Reason header is implementation
specific.
If, as a network option, the MSC Server supports the location header field
parameter as described in IETF RFC 8606 [68], the MSC Server shall map the
location parameter of the cause information element to the location parameter
in the SIP Reason header field according to table 5.4.8.1.3.
### 5.3.10 Restoration procedures
If the MSC Server receives a SIP 504 (Server Time-out) response and all the
following conditions are fulfilled:
1) there is no re-registration ongoing;
2) a P-Asserted-Identity header field set to a value equal to an URI:
\- from the Service-Route header field value received during registration; or
\- from the Path header field value received during registration; and
3) the SIP response contains a Content-Type header field set to
\"application/3gpp-ims+xml\" as defined in 3GPP TS 24.229 [2] clause 7.6; and
4) the SIP response includes an IM CN subsystem XML body as specified in 3GPP
TS 24.229 [2] clause 7.6 with the \ element, including a version
attribute, with the \ child element:
\- with the \ child element set to \"restoration\" (see 3GPP TS 24.229
[2] table 7.6.2); and
\- with the \ child element set to \"initial-registration\" (see 3GPP
TS 24.229 [2] table 7.6.3);
then the MSC Server shall initiate restoration procedures by performing an
initial registration as specified in clause 5.2.1.
If the MSC Server is unsuccessful to send an initial SIP INVITE request to the
next hop determined by one of the following:
\- there is no response to the SIP INVITE request by the MSC Server; or
\- by unspecified means available to the MSC Server;
and if there is no re-registration ongoing then the MSC Server may initiate
restoration procedures by performing an initial registration as specified in
clause 5.2.1.
NOTE: If there is an ongoing re-registration and the conditions in this clause
for initiating an initial registration were fulfilled the MSC Server regards
this user as not registered and waits until a successful registration before
sending any more INVITE request for this user. Meanwhile the MSC Server can
fall back to the procedures for non ICS UE attached to a legacy MSC for call
establishment as described in 3GPP TS 23.292 [5].
### 5.3.11 Autonomous clearing initiated by the MSC Server
If the MSC Server determines due to internal procedures that the call shall be
released, call release shall be in accordance with 3GPP TS 24.008 [3] clause
5.4.4 with the additional interworking defined here.
The MSC Server shall send a SIPâ€‘CANCEL request as specified in 3GPP TS 24.229
[2] to the IM CN subsystem. The MSC Server shall include a Reason header field
in the request populated as follows:
\- the protocol field set to \"Q.850\"; and
\- a \"cause\" header field parameter aligned with the value used in the cause
information element of the call clearing message towards the UE.
NOTE: The inclusion of reason-text in the Reason header is implementation
specific.
## 5.4 Interworking of mobile terminating call setup from SIP to NAS
signalling
### 5.4.1 General
The IM CN susbsystem terminating session shall be established in accordance
with 3GPP TS 24.292 [7] and 3GPP TS 24.229 [2]. The mobile terminating call
shall be established at the visited MSC Server in accordance with 3GPP TS
23.018 [8] and 3GPP TS 24.008 [3]. The following subclauses describe the
additional requirements for interworking between SIP and NAS signalling.
### 5.4.2 Receipt of initial INVITE
Upon receipt of an initial INVITE request, the MSC Server shall validate the
INVITE request and SDP offer, if present, as described in 3GPP TS 24.292 [7].
After validating the INVITE request, the terminating party shall be validated
as follows:
\- the MSC Server shall identify the terminating subscriber using the
P-Called-Party-ID header or Request-URI from the INVITE request and use this
to retrieve the VLR data;
\- if the VLR data cannot be retrieved, the MSC Server shall send a 500 Server
Internal Error response to the INVITE request;
\- if the VLR data can be retrieved, the following check shall be performed:
\- if the IMSI is detached, the MSC Server shall send a 500 Server Internal
Error response to the INVITE request.
Upon successful validation of the terminating party, the MSC Server shall
initiate the establishment of a MM connection as specified in 3GPP TS 24.008
[3]. If a MM connection cannot be established (e.g. no PAGE RESPONSE message
is received), the MSC Server shall send a 408 Request Timeout response to the
INVITE request.
If the initial INVITE request includes a MIME body (part) according to clause
4.4.1 of 3GPP TS 24.615 [44] with the \"communication-waiting-indication\"
element contained in the \"ims-cw\" root element according to 3GPP TS 24.615
[44], and if the MSC Server determines that the incoming call can be presented
to the subscriber as described in 3GPP TS 24.083 [26], then clause 5.6.4.1
applies.
NOTE: Clause 5.6.8.3.1.4 contains additional applicable procedures executed
upon receipt of an initial INVITE request if the MSC Server is as conference
participant.
The MSC Server shall store the \"icid-value\" header field parameter received
in the P-Charging-Vector header field.
If the received INVITE request:
a) does not contain a \"precondition\" option-tag in a Supported header field
or in a Require header field, the MSC Server shall not make use of the SIP
precondition mechanism; or
b) contains the \"precondition\" option-tag in the Supported header field or
in the Require header field and local configuration indicates support of the
SIP precondition mechanism, the MSC Server shall make use of the SIP
precondition mechanism and shall include the Require header field with the
\"precondition\" option-tag in any corresponding response containing the SDP
body, which the MSC Server sends towards to the originating end point. When
the MSC Server sends a 183 (Session Progress) response with an SDP answer, the
MSC Server shall only request confirmation for the result of the resource
reservation (as defined in as defined in IETF RFC 3312 [59]) at the
originating end point if an SDP offer has been received indicating that there
are any remaining unfulfilled preconditions at the originating end point.
If the MSC Server rejects the received INVITE request, then depending on
operator policy, the MSC Server may insert in a SIP failure response a
Response-Source header field with an \"fe\" header field parameter constructed
with the URN namespace \"urn:3gpp:fe\", the \"fe-id\" part of the URN set to
\"msc-server\" and the \"role\" header field parameter set to \"msc-server-
ics\" in accordance with subclause 7.2.17 of 3GPP TS 24.229 [2].
### 5.4.3 Sending of SETUP
After successful MM connection establishment, the MSC Server shall send a
SETUP message as described in 3GPP TS 24.008 [3] with the following INVITE
request interworking applied:
\- the MSC Server may include a bearer capability 1 information element set to
indicate teleservice 11 as described in 3GPP TS 22.003 [9];
\- the MSC Server shall not include a bearer capability 2 information element;
and
\- the MSC Server shall build the calling party number BCD information element
according to the tables 5.4.3.1 or 5.4.3.2 below.
{width="6.34375in" height="5.198611111111111in"}
Figure 5.4.3.1: Mapping of INVITE message (with From and/or P-Asserted-
Identity) to SETUP message (informative)
The default mapping is based on table 5.4.3.1.
As a network option, the mapping described in table 5.4.3.2 can be applied to
create the calling party number BCD information element in the SETUP message
based on the From header field in the following cases:
\- when the received P-Asserted-Identity header field and the From header
field contain URIs with an E.164 number format and the Privacy header field
does not contain values \"id\", \"header\" or \"user\"; or
\- when the P-Asserted-Identity header field is absent or not in the E.164
number format and the received From header field contains the URI with an
E.164 number format and the Privacy header field does not contain values
\"id\", \"header\" or \"user\".
Table 5.4.3.1: Setting of the calling party BCD number information element in
SETUP message from P-Asserted-Identity
+----------------+----------------+----------------+----------------+ | SIP Component | Value | Calling party | Value | | | | | | | | | BCD number | | | | | information | | | | | element | | +----------------+----------------+----------------+----------------+ | P-Ass | E.164 number | Digits | digits | | erted-Identity | | | contained in | | header field | and | | tel URI or SIP | | (NOTE 1, | | | URI | | NOTE 2) | Priv-valueâ‰  | | | | | \"id\" or | | | | and | \"header\" | | | | | | | | | Privacy header | | | | | field | | | | +----------------+----------------+----------------+----------------+ | | Type of number | _\"national | | | | | number\" or | | | | | \ | | | | | "international | | | | | number\"_ | | +----------------+----------------+----------------+----------------+ | | Numbering Plan | _\" | | | | Identification | ISDN/telephony | | | | | numbering | | | | | plan\"_ | | +----------------+----------------+----------------+----------------+ | | Presentation | * | | | | Indicator | \"presentation | | | | | allowed\"_| | +----------------+----------------+----------------+----------------+ | | Screening |_ \"Network | | | | indicator | provided\"_| | +----------------+----------------+----------------+----------------+ | P-Ass | priv-value= | Digits | do not include | | erted-Identity | \"id\" or | | any number | | header field | \"header\" | | digits fields | | present or not | | | | | and Privacy | | | | | header field | | | | | is present | | | | +----------------+----------------+----------------+----------------+ | | Type of number |_ \"unknown\"_| | +----------------+----------------+----------------+----------------+ | | Numbering Plan |_ \"unknown\"_| | | | Identification | | | +----------------+----------------+----------------+----------------+ | | Presentation | * | | | | Indicator | \"presentation | | | | | restricted\"_ | | +----------------+----------------+----------------+----------------+ | | Screening | _\"Network | | | | indicator | provided\"_ | | +----------------+----------------+----------------+----------------+ | P-Ass | Absent or | Digits | do not include | | erted-Identity | other than | | any number | | header field | E.164 number | | digits fields | | | | | except for | | and | and | | NOTE 3 and | | | | | NOTE 4 case | | Privacy header | Priv-valueâ‰  | | | | field | \"id\" or | | | | | \"header\" | | | +----------------+----------------+----------------+----------------+ | | Type of number | _\"unknown\"_ | | +----------------+----------------+----------------+----------------+ | | Numbering Plan | _\"unknown\"_ | | | | Identification | | | +----------------+----------------+----------------+----------------+ | | Presentation | * | | | | Indicator | \"presentation | | | | | allowed\"_| | +----------------+----------------+----------------+----------------+ | | Screening |_ \"Network | | | | indicator | provided\"_| | +----------------+----------------+----------------+----------------+ | Privacy header | priv-value | Presentation | * | | field | | Indicator | \"Presentation | | | | | Indicator\"_ | +----------------+----------------+----------------+----------------+ | priv-value | \"header\" | Presentation | Presentation | | | | Indicator | restricted | +----------------+----------------+----------------+----------------+ | | \"user\" | Presentation | Presentation | | | | Indicator | allowed | +----------------+----------------+----------------+----------------+ | | \"none\" | Presentation | Presentation | | | | Indicator | allowed | +----------------+----------------+----------------+----------------+ | | \"id\" | Presentation | Presentation | | | | Indicator | restricted | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | possible that | | | | | a | | | | | P-Ass | | | | | erted-Identity | | | | | header field | | | | | includes both | | | | | a tel URI and | | | | | a SIP or SIPS | | | | | URI. In this | | | | | case, either | | | | | the tel URI or | | | | | the SIP URI | | | | | with | | | | | user=\"phone\" | | | | | and a specific | | | | | host portion, | | | | | as selected by | | | | | operator | | | | | policy, may be | | | | | used. | | | | | | | | | | NOTE 2: The | | | | | number mapping | | | | | does not | | | | | include any | | | | | digits | | | | | contained in | | | | | the | | | | | phone-context | | | | | parameter. | | | | | | | | | | NOTE 3: If a | | | | | display-name | | | | | is present in | | | | | the | | | | | P-Ass | | | | | erted-Identity | | | | | header and if | | | | | the MSC Server | | | | | supports the | | | | | network option | | | | | of mapping | | | | | display name | | | | | to calling | | | | | name identity, | | | | | the MSC Server | | | | | may use the | | | | | P-Ass | | | | | erted-Identity | | | | | header to | | | | | build a | | | | | facility | | | | | information | | | | | element with a | | | | | name indicator | | | | | parameter set | | | | | to the display | | | | | name. | | | | | | | | | | NOTE 4: | | | | | Interworking | | | | | of display | | | | | name received | | | | | in conjunction | | | | | with a tel URI | | | | | or SIP URI to | | | | | calling name | | | | | presentation | | | | | using CNAP is | | | | | subject to | | | | | local | | | | | regulatory | | | | | requirements | | | | | on calling | | | | | line identity | | | | | and whether | | | | | the | | | | | originating | | | | | network of the | | | | | call is | | | | | trusted to | | | | | provide an | | | | | authentic | | | | | identity. | | | | +----------------+----------------+----------------+----------------+
Table 5.4.3.2: Setting of the calling party BCD number information element in
SETUP message from From header field
+----------------+----------------+----------------+----------------+ | SIP Component | Value | Calling party | Value | | | | BCD number | | | | | information | | | | | element | | +----------------+----------------+----------------+----------------+ | From header | E.164 number | Digits | digits | | field (NOTE 1, | | | contained in | | NOTE 2) | and | | tel URI or SIP | | | | | URI | | and | Priv-valueâ‰  | | | | | \"user\" | | | | Privacy header | | | | | field | | | | +----------------+----------------+----------------+----------------+ | | Type of number | _\"national | | | | | number\" or | | | | | \ | | | | | "international | | | | | number\"_ | | +----------------+----------------+----------------+----------------+ | | Numbering Plan | _\" | | | | Identification | ISDN/telephony | | | | | numbering | | | | | plan\"_ | | +----------------+----------------+----------------+----------------+ | | Presentation | * | | | | Indicator | \"presentation | | | | | allowed\"_| | +----------------+----------------+----------------+----------------+ | | Screening |_ \" | | | | indicator | User-provided, | | | | | not screened | | | | | \"_| | +----------------+----------------+----------------+----------------+ | From header | other than | Digits | do not include | | field | E.164 number | | any number | | | | | digits fields | | and | and | | except for | | | | | NOTE 3 and | | Privacy header | Priv-valueâ‰  | | NOTE 4 case | | field | \"user\" | | | +----------------+----------------+----------------+----------------+ | | Type of number |_ \"unknown\"_| | +----------------+----------------+----------------+----------------+ | | Numbering Plan |_ \"unknown\"_| | | | Identification | | | +----------------+----------------+----------------+----------------+ | | Presentation | * | | | | Indicator | \"presentation | | | | | allowed\"_ | | +----------------+----------------+----------------+----------------+ | | Screening | _\" | | | | indicator | User-provided, | | | | | not | | | | | screened\"_ | | +----------------+----------------+----------------+----------------+ | Privacy header | priv-value | Presentation | * | | field | | Indicator | \"Presentation | | | | | Indicator\"* | +----------------+----------------+----------------+----------------+ | priv-value | \"header\" | Presentation | Presentation | | | | Indicator | allowed | +----------------+----------------+----------------+----------------+ | | \"user\" | Presentation | Presentation | | | | Indicator | restricted | +----------------+----------------+----------------+----------------+ | | \"none\" | Presentation | Presentation | | | | Indicator | allowed | +----------------+----------------+----------------+----------------+ | | \"id\" | Presentation | Presentation | | | | Indicator | allowed | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | possible that | | | | | a From header | | | | | field includes | | | | | both a tel URI | | | | | and a SIP or | | | | | SIPS URI. In | | | | | this case, | | | | | either the tel | | | | | URI or the SIP | | | | | URI with | | | | | user=\"phone\" | | | | | and a specific | | | | | host portion, | | | | | as selected by | | | | | operator | | | | | policy, may be | | | | | used. | | | | | | | | | | NOTE 2: The | | | | | number mapping | | | | | does not | | | | | include any | | | | | digits | | | | | contained in | | | | | the | | | | | phone-context | | | | | parameter. | | | | | | | | | | NOTE 3: If a | | | | | display-name | | | | | is present in | | | | | the From | | | | | header and if | | | | | the MSC Server | | | | | supports the | | | | | network option | | | | | of mapping | | | | | display name | | | | | to calling | | | | | name identity, | | | | | the MSC Server | | | | | may use the | | | | | From header to | | | | | build a | | | | | facility | | | | | information | | | | | element with a | | | | | name indicator | | | | | parameter set | | | | | to the display | | | | | name. | | | | | | | | | | NOTE 4: | | | | | Interworking | | | | | of display | | | | | name received | | | | | in conjunction | | | | | with a tel URI | | | | | or SIP URI to | | | | | calling name | | | | | presentation | | | | | using CNAP is | | | | | subject to | | | | | local | | | | | regulatory | | | | | requirements | | | | | on calling | | | | | line identity | | | | | and whether | | | | | the | | | | | originating | | | | | network of the | | | | | call is | | | | | trusted to | | | | | provide an | | | | | authentic | | | | | identity. | | | | +----------------+----------------+----------------+----------------+
### 5.4.4 Receipt of CALL CONFIRMED
Upon receipt of a CALL CONFIRMED message:
\- if a bearer capabilities 1 information element is present and indicates a
teleservice other than 11 as described in 3GPP TS 22.003 [9], the MSC Server
shall initiate call clearing procedures using a cause value of 58 (bearer
capability not presently available);
\- if a bearer capabilities 1 information element is present and includes a
CTM text telephony indication set to \"CTM text telephony is supported\", the
default behaviour of the MSC Server shall be to continue with call setup but
not to provide user plane interworking between CTM and real-time-text at the
CS-MGW.
NOTE: Conversion between CTM as described in 3GPP TS 26.226 [22] and real-
time-text as described in 3GPP TS 26.114 [28] may be provided as an
implementation option if the SDP offer included the payload type for real-
time-text. Such conversion is outside the scope of the present document.
### 5.4.5 Bearer establishment
#### 5.4.5.1 Network side bearer establishment
If the initial INVITE request contained an SDP offer, the MSC Server should
use the codecs received in the SDP offer and determine the codecs supported by
the UE as specified in 3GPP TS 24.008 [3] to select and return a single codec
in the SDP answer.
The MSC Server shall reject all non-audio media descriptions from the SDP
offer in the SDP answer.
The SDP answer shall be returned in the first reliable response.
If the initial INVITE request did not contain an SDP offer, the MSC Server
should determine the codecs supported by the UE as specified in 3GPP TS 24.008
[3] and use this information when constructing a codec list for the SDP offer
and send the SDP offer in the first reliable response to the INVITE request.
#### 5.4.5.2 Access bearer assignment
The MSC Server shall initiate access bearer assignment only after the
following conditions are satisfied:
\- the incoming side RTP connection point has been successfully reserved and
configured in the CS-MGW; and
\- either:
\- preconditions were not requested in the SDP of the initial INVITE request;
or
\- an SDP offer has been received indicating that remote preconditions have
been met.
For UTRAN and GERAN Iu-mode, the NAS Synchronisation Indicator information
element shall be used to inform the UE of the selected codec as specified in
3GPP TS 24.008 [3].
#### 5.4.5.3 Transcoding
The CS-MGW may include a speech transcoder based upon the speech coding
information provided to each bearer termination.
### 5.4.6 Receipt of ALERTING
Upon receipt of the ALERTING message from the UE, the MSC Server shall send a
180 Ringing response.
NOTE: Starting timer T301 (or a corresponding internal alerting supervision
timing function) as specified in 3GPP TS 24.008 [3] at the MSC Server is an
implementation option. The default value for T301 in 3GPP TS 24.008 [3] is
longer than the range specified for the IM CN subsystem\'s no reply timer
specified in 3GPP TS 24.604 [23], which should allow the IM CN subsystem to
properly control CFNA. However, if T301 is started and expires prior to the no
reply timer in the IM CN subsystem, the non-2xx response returned to the IM CN
subsystem will prevent invocation of the CFNA service.
### 5.4.7 Applying early media
The MSC Server may instruct the CS-MGW to apply ringback tone or an
announcement towards the IM CN subsystem in the following condition:
\- the MSC Server supports the P-Early-Media header as a network option; and
\- the P-Early-Media header was received in the initial INVITE request.
If these conditions are met and the MSC Server chooses to apply early media,
the following actions are taken:
\- prior to applying an announcement, the MSC Server shall include in the 183
Session Progress response a P-Early-Media header authorizing backward early
media;
\- prior to applying ringback tone, the MSC Server shall include in the 180
Ringing response a P-Early-Media header authorizing backward early media.
### 5.4.8 Call rejection or abandonment
#### 5.4.8.1 Receipt of RELEASE COMPLETE or DISCONNECT
If the MSC Server receives a RELEASE COMPLETE or DISCONNECT message from the
UE during call establishment, the MSC Server shall send a status-code 4xx, 5xx
or 6xx response to the initial INVITE. The status-code sent shall be
determined by examining the first cause information element received in the
RELEASE COMPLETE or DISCONNECT message and applying the mapping specified in
table 5.4.8.1.1.
Table 5.4.8.1.1: Mapping the cause information element to the 4xx/5xx/6xx
status-code
* * *
Cause value SIP status-code 1 (Unassigned (unallocated) number 404 Not Found 3
(No route to destination) 500 Server Internal Error 6 (Channel unacceptable)
500 Server Internal Error 8 (Operator determined barring) 603 Decline 16
(Normal call clearing) 480 Temporarily Unavailable 17 (User busy) 486 Busy
Here 18 (No user responding) 480 Temporarily Unavailable 19 (User alerting, no
answer) 480 Temporarily Unavailable 21 (Call rejected) 603 Decline 22 (Number
changed) 410 Gone 25 (Pre-emption) 480 Temporarily Unavailable 26 (Non
selected user clearing) 480 Temporarily Unavailable 27 (Destination out of
order) 502 Bad Gateway 28 (Invalid number format (incomplete number) 484
Address Incomplete 29 (Facility rejected) 501 Not Implemented 30 (Response to
STATUS ENQUIRY) 500 Server Internal Error 31 (Normal, unspecified) 480
Temporarily Unavailable 34 (No circuit/channel available) 480 Temporarily
Unavailable 38 (Network out of order) 500 Server Internal Error 41 (Temporary
failure) 500 Server Internal Error 42 (Switching equipment congestion) 500
Server Internal Error 43 (Access information discarded) 500 Server Internal
Error 44 (Requested circuit/channel not available) 500 Server Internal Error
47 (Resources unavailable, unspecified) 500 Server Internal Error 49 (Quality
of service unavailable) 500 Server Internal Error 50 (Requested facility not
subscribed) 500 Server Internal Error 55 (Incoming calls barred within the
CUG) 603 Decline 57 (Bearer capability not authorized) 500 Server Internal
Error 58 (Bearer capability not presently available) 500 Server Internal Error
63 (Service or option not available, unspecified) 501 Not Implemented 65
(Bearer service not implemented) 500 Server Internal Error 68 (ACM equal to or
greater than ACMmax) 500 Server Internal Error 69 (Requested facility not
implemented) 501 Not Implemented 70 (Only restricted digital information
bearer capability is available) 501 Not Implemented 79 (Service or option not
implemented, unspecified) 501 Not Implemented 81 (Invalid transaction
identifier value) 500 Server Internal Error 87 (User not member of CUG) 403
Forbidden 88 (Incompatible destination) 500 Server Internal Error 91 (Invalid
transit network selection) 404 Not Found 95 (Semantically incorrect message)
500 Server Internal Error 96 (Invalid mandatory information) 500 Server
Internal Error 97 (Message type non-existent or not implemented) 501 Not
Implemented 98 (Message type not compatible with protocol state) 501 Not
Implemented 99 (Information element non-existent or not implemented) 501 Not
Implemented 100 (Conditional IE error) 500 Server Internal Error 101 (Message
not compatible with protocol state) 500 Server Internal Error 102 (Recovery on
timer expiry) 504 Server timeout 111 (Protocol error, unspecified) 500 Server
Internal Error 127 (Interworking, unspecified) 480 Temporarily Unavailable
* * *
NOTE 1: Alternative mappings are allowed per operator policy.
The first cause information element included in the RELEASE COMPLETE or
DISCONNECT message shall be mapped to a Reason header field in the SIP final
response sent as a result of this clause as follows:
\- set the protocol field to \"Q.850\"; and
\- set the numeric \"cause\" parameter value to the cause value field of the
cause information element according to table 5.4.8.1.2.
NOTE 2: The inclusion of reason-text in the Reason header is implementation
specific.
If, as a network option, the MSC Server supports the location header field
parameter as described in IETF RFC 8606c [68], the MSC Server shall map the
location parameter of the cause information element to the location parameter
in the SIP Reason header field according to table 5.4.8.1.3.
Table 5.4.8.1.2: Mapping of cause information element to \"cause\" parameter
for protocol \"Q.850\"
+----------------------------------+----------------------------------+ | Cause information element | Reason header field with | | | protocol value \"Q.850\" | +----------------------------------+----------------------------------+ | Cause value | \"cause\" parameter value | +----------------------------------+----------------------------------+ | 1 (Unallocated (unassigned) | 1 (Unallocated (unassigned) | | number) | number) | +----------------------------------+----------------------------------+ | 3 (No route to destination) | 3 (No route to destination) | +----------------------------------+----------------------------------+ | 6 (Channel unacceptable) | 6 (Channel unacceptable) | +----------------------------------+----------------------------------+ | 16 (Normal call clearing) | 16 (Normal call clearing) | +----------------------------------+----------------------------------+ | 17 (User busy) | 17 (User busy) | +----------------------------------+----------------------------------+ | 18 (No user responding) | 18 (No user responding) | +----------------------------------+----------------------------------+ | 19 (User alerting, no answer) | 19 (No answer from user (user | | | alerted)) | +----------------------------------+----------------------------------+ | 21 (Call rejected) | 21 (Call rejected) | +----------------------------------+----------------------------------+ | 22 (Number changed) | 22 (Number changed) | +----------------------------------+----------------------------------+ | 24 (Call rejected due to feature | 24 (Call rejected due to feature | | at the destination) | at the destination) | +----------------------------------+----------------------------------+ | 25 (Pre-emption) | 8 (Preemption) | +----------------------------------+----------------------------------+ | 26 (Non selected user clearing) | 26 (Non-selected user clearing) | +----------------------------------+----------------------------------+ | 27 (Destination out of order) | 27 (Destination out of order) | +----------------------------------+----------------------------------+ | 28 (Invalid number format | 28 (Invalid number format | | (incomplete number)) | (address incomplete)) | +----------------------------------+----------------------------------+ | 29 (Facility rejected) | 29 (Facility rejected) | +----------------------------------+----------------------------------+ | 30 (Response to STATUS ENQUIRY) | 30 (Response to STATUS ENQUIRY) | +----------------------------------+----------------------------------+ | 31 (Normal, unspecified) | 31 (Normal, unspecified) | | (NOTE 1) | | +----------------------------------+----------------------------------+ | 34 (No circuit/channel | 34 (No circuit/channel | | available) | available) | +----------------------------------+----------------------------------+ | 38 (Network out of order) | 38 (Network out of order) | +----------------------------------+----------------------------------+ | 41 (Temporary failure) | 41 (Temporary failure) | +----------------------------------+----------------------------------+ | 42 (Switching equipment | 42 (Switching equipment | | congestion) | congestion) | +----------------------------------+----------------------------------+ | 43 (Access information | 43 (Access information | | discarded) | discarded) | +----------------------------------+----------------------------------+ | 44 (requested circuit/channel | 44 (Requested circuit/channel | | not available) | not available) | +----------------------------------+----------------------------------+ | 47 (Resource unavailable, | 47 (Resource unavailable, | | unspecified) (NOTE 2) | unspecified) | +----------------------------------+----------------------------------+ | 49 (Quality of service | 49 (Quality of service not | | unavailable) | available) | +----------------------------------+----------------------------------+ | 50 (Requested facility not | 50 (Requested facility not | | subscribed) | subscribed) | +----------------------------------+----------------------------------+ | 55 (Incoming calls barred within | 55 (Incoming calls barred within | | the CUG) | CUG) | +----------------------------------+----------------------------------+ | 57 (Bearer capability not | 57 (Bearer capability not | | authorised) | authorised) | +----------------------------------+----------------------------------+ | 58 (Bearer capability not | 58 (Bearer capability not | | presently available) | presently available) | +----------------------------------+----------------------------------+ | 63 (Service option not | 63 (Service option not | | available, unspecified) (NOTE 3) | available, unspecified | +----------------------------------+----------------------------------+ | 65 (Bearer capability not | 65 (Bearer capability not | | implemented) | implemented) | +----------------------------------+----------------------------------+ | 69 (Requested facility not | 69 (Requested facility not | | implemented) | implemented) | +----------------------------------+----------------------------------+ | 70 (Only restricted digital | 70 (Only restricted digital | | information capability is | information capability is | | available) | available) | +----------------------------------+----------------------------------+ | 79 (Service or option not | 79 (Service or option not | | implemented, unspecified) | implemented, unspecified) | | (NOTE 4) | | +----------------------------------+----------------------------------+ | 81 (Invalid transaction | 81 (Invalid call reference | | identifier value) | value) | +----------------------------------+----------------------------------+ | 87 (User not member of CUG) | 87 (User not member of CUG) | +----------------------------------+----------------------------------+ | 88 (Incompatible destination) | 88 (Incompatible destination) | +----------------------------------+----------------------------------+ | 91 (Invalid transit network | 91 (Invalid transit network | | selection) | selection) | +----------------------------------+----------------------------------+ | 95 (Semantically incorrect | 95 (Invalid message, | | message) (NOTE 5) | unspecified) | +----------------------------------+----------------------------------+ | 97 (Message type non-existent or | 97 (Message type non-existent or | | not implemented) | not implemented) | +----------------------------------+----------------------------------+ | 98 (Message type not compatible | 98 (Message not compatible with | | with protocol state) | call state or message type | | | non-existent or not implemented) | +----------------------------------+----------------------------------+ | 99 (Information element | 99 (Information | | non-existent or not implemented) | element/parameter non-existent | | | or not implemented) | +----------------------------------+----------------------------------+ | 101 (Message not compatible with | 101 (Message not compatible with | | protocol state) | call state) | +----------------------------------+----------------------------------+ | 102 (Recovery on timer expiry) | 102 (Recovery on timer expiry) | +----------------------------------+----------------------------------+ | 111 (Protocol error, | 111 (Protocol error, | | unspecified) (NOTE 6) | unspecified) | +----------------------------------+----------------------------------+ | 127 (Interworking, unspecified) | 127 (Interworking, unspecified) | | (NOTE 7) | | +----------------------------------+----------------------------------+ | NOTE 1: All other values in the | | | range 0 to 31 not appearing in | | | table shall be treated as cause | | | 31. | | | | | | NOTE 2: All other values in the | | | range 32 to 47 not appearing in | | | table shall be treated as cause | | | 47. | | | | | | NOTE 3: All other values in the | | | range 48 to 63 not appearing in | | | table shall be treated as cause | | | 63. | | | | | | NOTE 4: All other values in the | | | range 64 to 79 not appearing in | | | table shall be treated as cause | | | 79. | | | | | | NOTE 5: All other values in the | | | range 80 to 95 not appearing in | | | table shall be treated as cause | | | 95. | | | | | | NOTE 6: All other values in the | | | range 96 to 111 not appearing in | | | table shall be treated as cause | | | 111. | | | | | | NOTE 7: All other values in the | | | range 112 to 127 not appearing | | | in table shall be treated as | | | cause 127. | | +----------------------------------+----------------------------------+
Table 5.4.8.1.3: Mapping of location parameter of Cause information element to
SIP Reason header field location parameter
* * *
Cause information element Reason header field with protocol value \"Q.850\"
\"Location\" parameter value \"location\" parameter value user U private
network serving the local user LPN public network serving the local user LN
transit network TN public network serving the remote user RLN private network
serving the remote user RPN international network INTL network beyond
interworking point BI
* * *
#### 5.4.8.2 Receipt of CANCEL or BYE
If the MSC Server receives a CANCEL or BYE request, the MSC Server shall
initiate call clearing procedures by sending a DISCONNECT message towards the
UE as described in 3GPP TS 24.008 [3] with the following interworking applied:
\- if one or more Reason header fields are included in the CANCEL or BYE
request, then the cause value of each Reason header field shall be mapped to a
cause information element in the DISCONNECT message as follows:
a) if the Reason header field contains the protocol header field parameter set
to \"Q.850\", or \"SIP\" with a cause header field parameter value other than
\"200\", the cause information element shall be built as described in clause
5.3.8; and
b) if the Reason header field contains the protocol header field parameter set
to \"SIP\", the cause header field parameter set to \"200\" as specified in
IETF RFC 3326 [45], the cause information element shall be set to cause value
13 (call completed elsewhere).
\- if no Reason header field is included in the CANCEL or BYE request, a cause
value set to 31 (normal, unspecified), coding standard set to \"Standard
defined for the GSM PLMNs\" and location set to \"network beyond interworking
point\" shall be used in the cause information element in the DISCONNECT
message.
### 5.4.9 Receipt of CONNECT
Upon receipt of the CONNECT message from the UE, the MSC Server shall send a
200 OK response to the initial INVITE.
Interworking applied for the TIR services is described in clause 5.6.2.2.
### 5.4.10 Call failure procedures
The MSC Server shall handle call failures (e.g. timer expiration) during
mobile terminating call establishment in accordance with 3GPP TS 24.008 [3].
The cause value used towards the calling user as specified in 3GPP TS 24.008
[3] shall be mapped to a final response to the INVITE request as specified in
clause 5.4.8.1.
### 5.4.11 Autonomous clearing initiated by the MSC Server
If the MSC Server determines due to internal procedures that the call shall be
released, call release shall be in accordance with 3GPP TS 24.008 [3] clause
5.4.4 with the additional interworking defined here.
NOTE 1: If a SIP 200 (OK) response has been sent but the SIP ACK request is
not yet received, the procedure in clause 5.5.4 is used instead.
Depending on the reason for the clearing, the MSC Server shall send a SIP 4xx
or 5xx response as specified in 3GPP TS 24.229 [2] to the IM CN subsystem. The
MSC Server shall include a Reason header field populated as follows:
\- the protocol field set to \"Q.850\"; and
\- a \"cause\" header field parameter aligned with the value used in the cause
information element of the call clearing message towards the UE.
NOTE 2: The inclusion of reason-text in the Reason header is implementation
specific.
## 5.5 Interworking of established call clearing between NAS signalling and
SIP
### 5.5.1 General
The following subclauses define the procedure and signalling interworking
performed by the MSC Server for call clearing of an established call. This
interworking is independent of the direction of original call establishment.
Call clearing during call setup is described in subclauses 5.3.7, 5.3.8,
5.3.9, 5.4.8.1 and 5.4.10.
### 5.5.2 Clearing initiated by the mobile
MSC Server handling of call clearing initiated by the mobile shall be in
accordance with 3GPP TS 24.008 [3] with the additional interworking defined
here.
Upon receipt of a DISCONNECT message, the MSC Server shall send a BYE request
as specified in 3GPP TS 24.229 [2] to the IM CN subsystem. The first cause
information element in the DISCONNECT message shall be included in a Reason
header field in the BYE request as follows:
\- set the protocol value to \"Q.850\"; and
\- set the numeric \"cause\" parameter value to the cause value field of the
cause information element according to table 5.4.8.1.2.
NOTE: The inclusion of the \"text\" header field parameter in the Reason
header field is implementation specific.
If, as a network option, the MSC Server supports the location header field
parameter as described in IETF RFC 8606 [68], the MSC Server shall map the
location parameter of the cause information element to the location parameter
in the SIP Reason header field according to table 5.4.8.1.3.
### 5.5.3 Clearing initiated by the IM CN subsystem
Upon receipt of a BYE request, the MSC Server shall send a DISCONNECT message
towards the mobile. If one or more Reason header fields is included in the BYE
request, each Reason header field shall be mapped to a cause information
element in the DISCONNECT message according to clause 5.3.8.
If no Reason header is present, a cause information element value of 16
(Normal call clearing) shall be used.
### 5.5.4 Autonomous clearing initiated by the MSC Server
If the MSC Server determines due to internal procedures that the call shall be
released, call release shall be in accordance with 3GPP TS 24.008 [3] with the
additional interworking defined here.
The MSC Server shall send a BYE request to the IM CN subsystem. The MSC Server
shall align according to table 5.4.8.1.2 the value used in the cause
information element in the DISCONNECT message with the value used in the
\"cause\" parameter for the \"Q.850\" protocol field in the Reason header of
the BYE request.
## 5.6 Supplementary Services invocation
### 5.6.1 Originating identification presentation/restriction (OIP/OIR)
The interworking required for OIP is defined in clause 5.4.3.
The interworking required for OIR is defined in clause 5.3.3.2.
### 5.6.2 Terminating identification presentation/restriction (TIP/TIR)
#### 5.6.2.1 Terminating identification presentation (TIP)
When interworking a SIP 200 OK (INVITE) response to a CONNECT message as
described in clause 5.3.6, a MSC Server which supports the normal operation of
the connected number supplementary service as described in 3GPP TS 24.081 [12]
shall apply the following interworking for the TIP supplementary service:
\- if a P-Asserted-Identity header containing a tel URI or a SIP URI with
\"user=phone\" is present, the MSC Server shall use this header to build a
connected number information element as follows:
\- if the tel URI or number within the userinfo part of the SIP URI is in
international format, set the type of number to \"international number\",
otherwise set the type of number to \"national number\"; and
\- set the number plan identification to \"ISDN/telephony numbering plan\";
and
\- set the presentation indicator to \"presentation allowed\"; and
\- set the screening indicator to \"network provided\"; and
\- set the number digits fields to the telephone number contained in the tel
URI or the userinfo part of the SIP URI; or
NOTE 1: If the P-Asserted-Identity header contains both a tel URI and a SIP
URI with \"user=phone\", the URI used for mapping is implementation specific.
NOTE 2: The number mapping does not include any digits contained in the phone-
context parameter.
\- if a P-Asserted-Identity header is present but does not contain a tel URI
or a SIP URI with \"user=phone\", the MSC Server shall build a connected
number information element as follows:
\- set the type of number to \"unknown\"; and
\- set the number plan identification to \"unknown\"; and
\- set the presentation indicator to \"number not available due to
interworking\"; and
\- set the screening indicator to \"network provided\"; and
\- do not include any number digits fields; or
\- if no P-Asserted-Identity header is present but a Privacy header with priv-
value set to \"id\" is present, the MSC Server shall build a connected number
information element as follows:
\- set the type of number to \"unknown\"; and
\- set the number plan identification to \"unknown\"; and
\- set the presentation indicator to \"presentation restricted\"; and
\- set the screening indicator to \"network provided\"; and
\- do not include any number digits fields; or
\- if neither a P-Asserted-Identity header nor a Privacy header field with a
priv-value set to \"id\" is present, then no connected number information
element shall be included.
#### 5.6.2.2 Terminating identification restriction (TIR)
The MSC Server shall not include a Privacy header in any response to an INVITE
request.
NOTE: 3GPP TS 24.081 [12] does not provide a mechanism for a terminator to
temporarily override default settings for this service. The inclusion of a
Privacy header could lead to the AS serving the terminating user to mistakenly
assume that a default setting is being temporarily overridden by the
terminating user. Omitting the Privacy header allows the AS supporting the
terminating user to perform the appropriate actions for the TIR service in
\"permanent mode\" as specified in 3GPP TS 24.608 [14].
### 5.6.3 Communication Hold (HOLD)
#### 5.6.3.1 HOLD initiated via NAS signalling
##### 5.6.3.1.1 Hold
When the MSC Server receives a HOLD message as specified in 3GPP TS 24.083
[26] and the media on the IM CN subsystem side of the CS-MGW is \"sendonly\"
or \"inactive\", no interworking is required and the MSC Server shall send a
HOLD ACKNOWLEDGE message to the UE as specified in 3GPP TS 24.083 [26]. If the
media on the IM CN subsystem side is \"recvonly\" or \"sendrecv\", the MSC
Server shall send an UPDATE or re-INVITE request containing an SDP offer
configured as follows:
\- mark the media as \"sendonly\" or \"inactive\" as described in 3GPP TS
24.610 [27]; and
\- if RTCP is disabled for this media stream, include RR and RS bandwidth
modifiers with values greater than zero to enable RTCP as described in 3GPP TS
26.114 [28] clause 7.3.1.
Upon receipt of the SDP answer in a 200 OK response to the UPDATE or re-INVITE
request, the MSC Server shall send a HOLD ACKNOWLEDGE message to the UE as
specified in 3GPP TS 24.083 [26].
If the SDP offer is rejected or a non-200 response is received to the UPDATE
or re-INVITE request, the MSC Server shall send a HOLD REJECT message to the
UE as specified in 3GPP TS 24.083 [26] with cause parameter set to \"Facility
rejected\".
##### 5.6.3.1.2 Resume
When the MSC Server receives a RETRIEVE message as specified in 3GPP TS 24.083
[26] and the media on the IM CN subsystem side of the CS-MGW is \"recvonly\"
or \"sendrecv\", no interworking is required and the MSC Server shall send a
RETRIEVE ACKNOWLEDGE message to the UE as specified in 3GPP TS 24.083 [26]. If
the media on the IM CN subsystem side is \"sendonly\" or \"inactive\", the MSC
Server shall send an UPDATE or re-INVITE request containing an SDP offer with
media marked as \"recvonly\" or \"sendrecv\" as described in 3GPP TS 24.610
[27]. The MSC Server may include RR and RS bandwidth modifiers set to zero in
the SDP offer to disable RTCP.
Upon receipt of the SDP answer in a 200 OK response to the UPDATE or re-INVITE
request, the MSC Server shall send a RETRIEVE ACKNOWLEDGE message to the UE as
specified in 3GPP TS 24.083 [26].
If the SDP offer is rejected or a non-200 response is received to the UPDATE
or re-INVITE request, the MSC Server shall send a RETRIEVE REJECT message to
the UE as specified in 3GPP TS 24.083 [26] with cause parameter set to
\"Facility rejected\".
#### 5.6.3.2 HOLD initiated via SIP signalling
##### 5.6.3.2.1 Hold
The IM CN subsystem makes a hold request by sending an UPDATE or re-INVITE
request with an \"inactive\" or \"sendonly\" SDP attribute, depending on the
current state of the session. Upon receipt of a hold request from the IM CN
subsystem, the MSC Server shall perform the following interworking:
\- if the MSC Server received a non-zero SS screening indicator as defined in
3GPP TS 24.080 [29] from the UE, the MSC Server shall send a FACILITY message
indicating the call has been placed on hold as specified in 3GPP TS 24.083
[26];
\- if the MSC Server did not receive a non-zero SS screening indicator from
the UE, the MSC Server shall not send any message to the UE.
##### 5.6.3.2.2 Resume
The IM CN subsystem requests to resume a session by sending an UPDATE or re-
INVITE request with an \"recvonly\" or \"sendrecv\" SDP attribute, depending
on the current state of the session. Upon receipt of a resume request from the
IM CN subsystem, the MSC Server shall perform the following interworking:
\- if the MSC Server received a non-zero SS screening indicator as defined in
3GPP TS 24.080 [29] from the UE, the MSC Server shall send a FACILITY message
indicating the call has been retrieved as specified in 3GPP TS 24.083 [26];
\- if the MSC Server did not receive a non-zero SS screening indicator from
the UE, the MSC Server shall not send any message to the UE.
### 5.6.4 Communication Waiting (CW)
#### 5.6.4.1 Receipt of initial INVITE
NOTE: Clause 5.4.2 contains general applicable procedures executed upon
receipt of an initial INVITE request.
If the initial INVITE request includes:
\- a MIME body (part) according to clause 4.4.1 of 3GPP TS 24.615 [44] with
the \"communication-waiting-indication\" element contained in the \"ims-cw\"
root element according to 3GPP TS 24.615 [44]; or
\- does not contain a Replaces header field corresponding to a established
dialog and the target of the INVITE request is engaged in the established SIP
dialog;
then, upon interworking the initial INVITE request to a SETUP message as
described in clause 5.4.3, the MSC Server shall apply the following additional
interworking:
\- the MSC Server shall include a Signal information element with value 7
(call waiting tone on); and
\- if the INVITE request includes a MIME body (part) according to clause 4.4.1
of 3GPP TS 24.615 [44] with the \"communication-waiting-indication\" element
contained in the \"ims-cw\" root element according to 3GPP TS 24.615 [44]:
\- the MSC Server shall store an indication that this session includes a CW
AS; and
\- the MSC Server may start timer TUE-CW as described in 3GPP TS 24.615 [44].
If the CALL CONFIRMED message received by the MSC Server during mobile
terminating call setup contains a Cause information element set to a value of
17 (User busy), then upon interworking the subsequent ALERTING message to a
180 Ringing response as described in clause 5.4.6, the MSC Server shall apply
the following additional interworking:
\- the MSC Server shall insert an Alert-Info header set to
\"urn:alert:service:call-waiting\" as described in 3GPP TS 24.615 [44] into
the 180 Ringing response.
#### 5.6.4.2 Accepting the waiting call
If the subscriber chooses to accept the waiting call and put the existing call
on hold, the MSC Server shall:
\- upon receipt of the HOLD message for the existing call, apply the
interworking specified in clause 5.6.3.1.1; and
\- upon receipt of the CONNECT message for the waiting call, stop timer T~UE-
CW~ if it was started and apply the interworking specified in clause 5.4.9.
If the subscriber chooses to accept the waiting call and release the existing
call, the MSC Server shall:
\- upon receipt of the DISCONNECT message for the existing call, apply the
interworking specified in clause 5.5.2; and
\- upon receipt of the CONNECT message for the waiting call, stop timer T~UE-
CW~ if it was started and apply the interworking specified in clause 5.4.9.
#### 5.6.4.3 Rejecting the waiting call
If the MSC Server receives a first clearing message from the UE during call
establishment, the cause value used towards the calling user as specified in
3GPP TS 24.008 [3] shall be mapped to a final response to the INVITE request
as specified in clause 5.4.8.1, except for cause codes:
\- 19 (User alerting, no answer) and 18 (No user responding). A first clearing
message from the UE during call establishment with cause code 19 (User
alerting, no answer) or 18 (No user responding) shall be mapped to the 480
(Temporarily unavailable) final response including a Reason header field (see
RFC 3326 [45]) with the protocol set to \"Q.850\" and the cause set to \"19\"
or \"18\", respectively;
\- 63 (Service or option not available, unspecified) and 69 (Requested
facility not implemented):
\- if the MSC Server stored an indication that the session includes a CW AS, a
first clearing message from the UE during call establishment with cause code
63 (Service or option not available, unspecified) or 69 (Requested facility
not implemented) used towards the calling user as specified in 3GPP TS 24.008
[3] shall be mapped to the 415 (Unsupported Media Type) final response; or
\- if the MSC Server did not store an indication that the session includes a
CW AS, the cause codes 63 (Service or option not available, unspecified) and
69 (Requested facility not implemented) used towards the calling user as
specified in 3GPP TS 24.008 [3] shall be mapped to a final response to the
INVITE request as specified in clause 5.4.8.1.
Depending on operator policy, the MSC Server may insert in a SIP failure
response a Response-Source header field with an \"fe\" header field parameter
constructed with the URN namespace \"urn:3gpp:fe\", the \"fe-id\" part of the
URN set to \"msc-server\" and the \"role\" header field parameter set to
\"msc-server-ics\" in accordance with subclause 7.2.17 of 3GPP TS 24.229 [2].
The MSC Server shall stop timer T~UE-CW~ if it was started.
#### 5.6.4.4 Communication release during waiting condition
Upon receipt of a BYE or CANCEL request for the waiting call, the MSC Server
shall stop timer T~UE-CW~ if it was started, and:
\- if the BYE or CANCEL request includes a Reason header field (see RFC 3326
[45]) with the protocol set to \"SIP\" and the cause set to \"408\" then the
MSC Server shall send a first clearing message according to clause 5.4.8.2,
with the following addition:
\- the Cause information element shall be set to cause 102 \"recovery on timer
expiry\"; or
\- the MSC Server shall act in accordance with clause 5.4.8.2.
#### 5.6.4.5 CW condition timeout
If timer T~UE-CW~ was started and expires, the MSC Server shall:
\- send a DISCONNECT message as described in 3GPP TS 24.008 [3], towards the
UE for the waiting call, including the Cause information element, where the
cause values is set to 102 \"recovery on timer expiry\", the coding standard
set to \"Standard defined for the GSM PLMNs\" and location set to \"network
beyond interworking point\";
\- if the MSC Server stored an indication that the session includes a CW AS,
send a 480 (Temporarily unavailable) final response, including a Reason header
field set to cause 19, according to 3GPP TS 24.615 [44] in response to the
initial INVITE request, and depending on operator policy, the MSC Server may
insert a Response-Source header field with an \"fe\" header field parameter
constructed with the URN namespace \"urn:3gpp:fe\", the \"fe-id\" part of the
URN set to \"msc-server\" and the \"role\" header field parameter set to
\"msc-server-ics\" in accordance with subclause 7.2.17 of 3GPP TS 24.229 [2];
;
\- if the MSC Server did not store an indication that the session includes a
CW AS, the MSC Server shall act in accordance with clause 5.4.10.
NOTE: Starting timer T2 or (optionally) T3 (or corresponding internal alerting
supervision timing functions) as specified in 3GPP TS 24.083 [26] is an
implementation option. Corresponding timers have been defined in 3GPP TS
24.615 [44] and 3GPP TS 24.604 [23]. If timers T2 or optionally T3 are started
and expire, any resulting SIP responses that are not a 480 (Temporarily
unavailable) final response, including a Reason header field set to cause 19,
can interact with CW and (optionally) CDIV.
#### 5.6.4.6 Notification to originator
For originating calls interworked to the IM CN subsystem as described in
clause 5.3, if the MSC Server receives a 180 Ringing response with a Alert-
Info header field set to \"urn:alert:service:call-waiting\" according to 3GPP
TS 24.615 [44], the MSC Server shall, according to 3GPP TS 24.083 [26], send
if possible, the ALERTING message as the carrier message for the Call Waiting
notification. Otherwise the MSC Server shall send a FACILITY message as the
carrier message for the Call Waiting notification as specified in 3GPP TS
24.083 [26].
### 5.6.5 Communication Barring (CB)
When interworking a 4xx, 5xx or 6xx response to the initial INVITE request to
a DISCONNECT message as described in clause 5.3.8, the MSC Server shall apply
the following additional interworking for the CB services described in 3GPP TS
24.611 [31]:
\- if a 433 Anonymity Disallowed response is received, the MSC Server shall
include in the DISCONNECT a NotifySS operation containing an SS-Code set to
the common code for incoming barring services and an SS-Status set to indicate
the service is active and operative as specified in 3GPP TS 24.088 [30];
\- if a 603 Decline response is received, the MSC Server shall include in the
DISCONNECT a NotifySS operation containing an SS-Code set to the common code
for all barring services and an SS-Status set to indicate the service is
active and operative as specified in 3GPP TS 24.088 [30].
NOTE: The common SS code is used as 3GPP TS 24.611 [31] specifies the use of a
603 Decline response for both the OCB and ICB services.
### 5.6.6 Communication Diversion
#### 5.6.6.1 General
The following subclauses describe the MSC Server interworking behaviour
related to the Communication Diversion (CDIV) services defined in 3GPP TS
24.604 [23].
#### 5.6.6.2 CDIV invocation
##### 5.6.6.2.1 Communication Forwarding Unconditional (CFU)
Invocation of CFU is handled by the IM CN subsystem as described in 3GPP TS
24.604 [23] and requires no interworking at the MSC Server.
##### 5.6.6.2.2 Communication Forwarding Busy (CFB)
For network determined user busy, invocation of CFB is handled by the IM CN
subsystem as described in 3GPP TS 24.604 [23] and requires interworking at the
MSC Server.
For user determined user busy during mobile terminating call establishment as
described in clause 5.4, if the MSC Server receives a DISCONNECT, RELEASE or
RELEASE COMPLETE message from the UE with a cause information element set to
\"User Busy\", the MSC Server shall perform the interworking described in
clause 5.4.8.1.
##### 5.6.6.2.3 Communication Forwarding No Reply (CFNR)
Invocation of CFNR is handled by the IM CN subsystem as described in 3GPP TS
24.604 [23] and requires no interworking at the MSC Server.
##### 5.6.6.2.4 Communication Forwarding on Not Logged-In (CFNL)
Invocation of CFNL is handled by the IM CN subsystem as described in 3GPP TS
24.604 [23] and requires no interworking at the MSC Server.
##### 5.6.6.2.5 Communication Deflection (CD)
During mobile terminating call establishment as described in clause 5.4, if
the MSC Server receives a DISCONNECT message from the UE with a facility
information element containing a call deflection request as specified in 3GPP
TS 24.072 [25], the MSC Server shall send a 302 (Moved Temporarily) response
to the initial INVITE with the following interworking applied:
\- the DeflectedToNumber parameter in the facility information element
received in the DISCONNECT message is used to derive a Contact header as
follows:
\- if the nature of address indicator is set to \"international number\", then
the address digits in the DeflectedToNumber parameter, prefixed with a \"+\",
shall be used to build a tel URI or a SIP URI with \"user=phone\"; or
\- if the nature of address indicator is not set to \"international number\",
then the MSC Server shall either:
\- convert the address digits in the DeflectedToNumber parameter to
international format by prefixing the number digits with \"+CC\" and use this
to build a tel URI or a SIP URI with \"user=phone\"; or
NOTE 1: CC is the country code of the network in which the MSC Server is
located.
\- use the address digits in the DeflectedToNumber parameter to build a tel
URI or a SIP URI with \"user=phone\". The phone-context parameter shall
include the home network domain name defined for IMS centralized services in
3GPP TS 23.003 [10]. For geo-local numbers, the home domain name shall be
prefixed by the \"geo-local\" string according to 3GPP TS 24.229 [2].
NOTE 2: The manner in which the MSC Server distinguishes between geo-local and
home-local numbers is implementation specific.
Depending on operator policy, the MSC Server may insert in a 302 (Moved
Temporarily) response a Response-Source header field with an \"fe\" header
field parameter constructed with the URN namespace \"urn:3gpp:fe\", the \"fe-
id\" part of the URN set to \"msc-server\" and the \"role\" header field
parameter set to \"msc-server-ics\" in accordance with subclause 7.2.17 of
3GPP TS 24.229 [2].
##### 5.6.6.2.6 Communication Forwarding on Subscriber Not Reachable (CFNRc)
Clause 5.4.2 describes a number of scenarios where the MSC Server determines
the terminating user is not reachable prior to sending the SETUP message and
returns the appropriate response to the INVITE request to allow CFNRc to be
initiated in the IM CN subsystem. If the MSC Server determines the terminating
user is not reachable prior to sending the SETUP message for any other
scenario not described in clause 5.4.2, the MSC Server shall send a 500 Server
Internal Error response to the initial INVITE request and depending on
operator policy, the MSC Server may insert in the 500 (Server Internal Error)
response a Response-Source header field with an \"fe\" header field parameter
constructed with the URN namespace \"urn:3gpp:fe\", the \"fe-id\" part of the
URN set to \"msc-server\" and the \"role\" header field parameter set to
\"msc-server-ics\" in accordance with subclause 7.2.17 of 3GPP TS 24.229 [2].
#### 5.6.6.3 Notifications relating to CDIV
##### 5.6.6.3.1 Void
##### 5.6.6.3.2 Notification to an originating user on CS access
For originating calls interworked to the IM CN subsystem as described in
clause 5.3, if communication diversion occurs for a served user with the
subscription option \"Originating user receives notification that his
communication has been diverted (forwarded or deflected)\" as described in
3GPP TS 24.604 [23], the following interworking shall be applied upon receipt
of a 181 (Call Is Being Forwarded) response:
\- if a History-Info header field is present and any history entry contains a
\"cause\" SIP URI parameter, as defined in IETF RFC 4458 [55] set to a value
listed in table 5.6.6.3.2.1, the MSC Server shall send a FACILITY message
containing a NotifySS operation indicating the call has been forwarded. The
NotifySS operation shall contain an SS-Code as specified in 3GPP TS 24.082
[24] and 3GPP TS 24.072 [25] mapped from the value of the last \"cause\" SIP
URI parameter according to table 5.6.6.3.2.1;
Table 5.6.6.3.2.1: Mapping the History-Info cause value to SS-Code
* * *
Cause value SS-Code 302 CFU 404 Common SS-Code for all forwarding SS 408 CFNRy
480 CD 486 CFB 487 CD 503 CFNRc
* * *
NOTE: Per 3GPP TS 24.604 [23] the History-Info header field can also be
received in a SIP 180 (Ringing) or SIP 200 (OK) response to the initial SIP
INVITE request. No interworking is performed in these scenarios as 3GPP TS
24.082 [24] does not allow this information to be presented to the subscriber
in a manner consistent with 3GPP TS 24.604 [23].
##### 5.6.6.3.3 Notification to a terminating user on CS access
When interworking a SIP INVITE request to a SETUP message as described in
clause 5.4.3, the MSC Server shall apply the following interworking to provide
notification of CDIV if a History-Info header field is present in the INVITE
request:
\- if any history entry in the History-Info header field contains a \"cause\"
SIP URI parameter, as defined in IETF RFC 4458 [55], set to a value listed in
table 5.6.6.3.2.1, the MSC Server shall send a FACILITY information element
containing a NotifySS operation indicating the call has been forwarded. The
NotifySS operation shall contain an SS-Code as specified in 3GPP TS 24.082
[24] and 3GPP TS 24.072 [25] mapped from the value of the last \"cause\" SIP
URI parameter according to table 5.6.6.3.2.1.
\- if
a) the SIP INVITE request does not contain a Privacy header field with any of
the privacy values \"header\", \"session\" or \"history\"; and
b) the history entry in the History-Info header field preceding the last
history entry in History-Info header field containing a \"cause\" SIP URI
parameter defined in IETF RFC 4458 [55] set to a value listed in table
5.6.6.3.2.1 does not contain an escaped privacy header with a value of
\"history\",
\- then the following additional interworking shall be applied:
\- if the hi-targeted-to-uri within the history entry preceding the last
history entry containing a \"cause\" SIP URI parameter contains a tel URI or a
SIP URI with \"user=phone\", the MSC Server shall include a redirecting party
BCD number information element set as follows:
\- if the tel URI or telephone number within the SIP URI is in international
format, set the type of number to \"international number\", otherwise set the
type of number to \"national number\";
\- set the number plan identification to \"ISDN/telephony numbering plan\";
\- set the presentation indicator to \"presentation allowed\";
\- set the screening indicator to \"network provided\"; and
\- set the number digits fields to the telephone number contained in the tel
URI or SIP URI;
NOTE: The number mapping does not include any digits contained in the phone-
context parameter.
\- otherwise,
\- the MSC Server shall build a redirecting party BCD number information
element as follows:
\- set the type of number to \"unknown\";
\- set the number plan identification to \"unknown\";
\- set the presentation indicator to \"number not available due to
interworking\"; and
\- set the screening indicator to \"network provided\".
### 5.6.7 Explicit Communication Transfer (ECT)
#### 5.6.7.1 General
The following subclauses describe the MSC Server interworking behaviour
related to the ECT service defined in 3GPP TS 24.629 [33] and a UE using CS
access domain signalling specified in 3GPP TS 24.091 [32].
#### 5.6.7.2 MSC Server as transferor on behalf of UE
When the MSC Server receives a FACILITY message containing an ECT request from
a UE with one answered call in a held state and another call in an answered
and active or alerting state as specified in 3GPP TS 24.091 [32], the MSC
Server shall build and send a REFER request as specified for a transferor UE
in 3GPP TS 24.629 [33].
When the MSC Server receives a NOTIFY request on the REFER dialog,
interworking shall be applied based upon the SIP response status-code
contained in the \"message/sipfrag\" message body as follows:
\- if status-code 100 Trying is received, no interworking is applied;
\- if status-code 200 OK is received, the MSC Server shall send a FACILITY
message indicating transfer success to the UE as specified in 3GPP TS 24.091
[32]. The MSC Server shall then initiate clearing of the two calls towards the
UE as specified in 3GPP TS 24.091 [32] and initiate clearing of the IM CN
subsystem session with the transferee as specified in clause 5.5.4.
\- if status-code 503 is received, the MSC Server shall send a FACILITY
message with a return error parameter set to \"SystemFailure\" and leave the
two calls from the UE in the conditions they were in prior to the ECT request;
\- if any other status-code is received, the MSC Server shall send a FACILITY
message with a return error parameter set to \"IllegalSS-Operation\" and leave
the two calls from the UE in the conditions they were in prior to the ECT
request.
#### 5.6.7.3 MSC Server as transferee on behalf of UE
##### 5.6.7.3.1 Actions without 3PCC
NOTE 1: CS domain access signalling as specified in 3GPP TS 24.091 [32] does
not provide a mechanism to present the transfer request to the transferee for
authorization of the transfer. Automatic acceptance and execution of the REFER
request by the MSC Server can therefore pose a security risk or have unwanted
charging consequences. Acceptance of REFER requests is therefore subject to
operator policy, which is outside the scope of the present document.
When the MSC Server receives a REFER request in the context of a call transfer
scenario as described in 3GPP TS 24.629 [33] clause 4.5.2.4.1.2.2, the MSC
Server may perform the actions specified for a transferee UE in 3GPP TS 24.629
[33].
If the MSC Server does not support accepting REFER requests on behalf of the
UE per operator policy, then the MSC Server shall return a 403 (Forbidden)
response and depending on operator policy, the MSC Server may insert in the
403 (Forbidden) response a Response-Source header field with an \"fe\" header
field parameter constructed with the URN namespace \"urn:3gpp:fe\", the \"fe-
id\" part of the URN set to \"msc-server\" and the \"role\" header field
parameter set to \"msc-server-ics\" in accordance with subclause 7.2.17 of
3GPP TS 24.229 [2].
If the MSC Server received a non-zero SS screening indicator from the UE as
defined in 3GPP TS 24.080 [29], then upon sending the NOTIFY request
indicating that the transfer is complete, the MSC Server may send a FACILITY
message to the UE as specified in 3GPP TS 24.091 [32]. The MSC Server may
include an Rdn parameter set to indicate that the remote party number is not
available due to interworking.
NOTE 2: The remote party number, as indicated in the Refer-To header sent by
the transferor, is not available to the MSC Server as it is replaced by the
transferor AS as specified in 3GPP TS 24.629 [33].
NOTE 3: Depending on the conferencing implementation in the IM CN subsystem
(e.g. the manner in which users are invited to a conference), the MSC Server
might not be able to distinguish between REFER requests for the ECT service
and REFER requests for the conferencing service. In such cases, the MSC Server
will not know which SS operation to indicate in the FACILITY message. Handling
of this scenario is implementation specific.
##### 5.6.7.3.2 Actions with 3PCC
When 3PCC is used for ECT as specified in 3GPP TS 24.629 [33], no special
interworking is required at the MSC Server.
#### 5.6.7.4 MSC Server as transfer target on behalf of UE
When the MSC Server receives an INVITE request which does not replace an
existing session (e.g. blind ECT), the MSC Server shall follow the
interworking procedures specified in clause 5.4.
When the MSC Server receives an INVITE request which replaces an existing
session, the MSC Server shall perform the actions specified for a transfer
target UE in 3GPP TS 24.629 [33]. If the MSC Server received a non-zero SS
screening indicator as defined in 3GPP TS 24.080 [29], then upon successful
session establishment with the transferee the MSC Server shall send a FACILITY
message to the UE as specified in 3GPP TS 24.091 [32] with the following
interworking applied:
\- if a Privacy header with priv-value set to \"id\" is present, the MSC
Server may include an Rdn parameter in the FACILITY message set to indicate
presentation restricted as specified in 3GPP TS 24.080 [29];
\- if a Privacy header with a priv-value set to \"id\" is not present in the
INVITE request, then:
\- if a P-Asserted-Identity header containing a tel URI or a SIP URI with
\"user=phone\" is present in the INVITE, the MSC Server may include an Rdn
parameter in the FACILITY message with a value set to the telephone number
contained in this URI;
\- if a P-Asserted-Identity header is present but does not contain a tel URI
or a SIP URI with \"user=phone\", the MSC Server may include an Rdn parameter
in the FACILITY message set to indicate the number is not available due to
interworking as specified in 3GPP TS 24.080 [29].
### 5.6.8 Conference (CONF)
#### 5.6.8.1 General
IM CN subsystem CONF functionality at a MSC Server is specified in 3GPP TS
24.292 [7]. The following subclauses describe the MSC Server interworking
behaviour related to the CONF service defined in 3GPP TS 24.605 [35] and a UE
using CS access domain signalling specified in 3GPP TS 24.084 [34].
#### 5.6.8.2 MSC Server as conference creator
##### 5.6.8.2.1 Conference creation
When the MSC Server receives a BuildMPTY request from a UE with one active
call and one held call as described in 3GPP TS 24.084 [34], the MSC Server
shall initiate conference creation and invite the remote parties to the
conference as described in 3GPP TS 24.292 [7].
NOTE: Conference creation and inviting users to the conference are two
distinct actions in the IM CN subsystem. However, in CS access signalling a
single message creates the conference and adds the existing calls to the
conference.
After receiving NOTIFY requests indicating both remote parties have
successfully transferred to the conference, the MSC Server shall send a
FACILITY message indicating BuildMPTY success as specified in 3GPP TS 24.084
[34].
If a non-200 final response to the INVITE request which attempts to create the
conference is received, the MSC Server shall send a FACILITY message with a
return error parameter set to \"SystemFailure\" and leave the two calls from
the UE in the conditions they were in prior to the conference creation
request.
##### 5.6.8.2.2 Putting the conference on hold
When the MSC Server receives a HoldMPTY request from a UE with an active
conference, the MSC Server shall send an UPDATE or re-INVITE request
containing a new SDP offer as described in clause 5.6.3.1.1.
Upon receipt of the SDP answer in a 200 OK response to the UPDATE or re-INVITE
request, the MSC Server shall send a FACILITY message indicating success as
specified in 3GPP TS 24.084 [34].
If the SDP offer is rejected or a non-200 response is received to the UPDATE
or re-INVITE request, the MSC Server shall send a FACILITY message as
specified in 3GPP TS 24.084 [34] with a return error parameter set to
\"SystemFailure\".
##### 5.6.8.2.3 Resuming a held conference
When the MSC Server receives a RetrieveMPTY request from a UE with a
conference on hold, the MSC Server shall send an UPDATE or re-INVITE request
containing a new SDP offer as described in clause 5.6.3.1.2.
Upon receipt of the SDP answer in a 200 OK response to the UPDATE or re-INVITE
request, the MSC Server shall send a FACILITY message indicating success as
specified in 3GPP TS 24.084 [34].
If the SDP offer is rejected or a non-200 response is received to the UPDATE
or re-INVITE request, the MSC Server shall send a FACILITY message with a
return error parameter set to \"SystemFailure\".
##### 5.6.8.2.4 Adding a party to the conference
When the MSC Server receives a BuildMPTY from a UE with a conference on hold
and separate active or waiting call as described in 3GPP TS 24.084 [34], the
MSC Server shall:
\- invite the remote party to the conference as described in 3GPP TS 24.292
[7]; and
\- send an UPDATE or re-INVITE request to resume the held conference as
described in clause 5.6.3.1.2.
##### 5.6.8.2.5 Terminating the conference or disconnecting a party from the
conference
When the MSC Server receives a DISCONNECT message from a UE with an
established conference, with a transaction identifier corresponding to a
specific remote party, the MSC Server shall start a conference termination
specific timer. While the timer is running, MSC Server shall collect potential
further DISCONNECT messages from the UE, with valid transaction identifiers,
corresponding to other remote parties. These additional DISCONNECT messages
shall not trigger starting a new timer and shall not restart the timer.
NOTE 1: The value for the conference termination timer is implementation
specific. The timer has to be long enough to allow that the UE encodes and
transmits all the DISCONNECT messages to the MSC Server but it should be kept
short so that the DISCONNECT messages used for disconnecting a single
conference participant are not delayed too long. A value around 1 sec is seen
as satisfactory.
When the timer expires, MSC Server shall examine, whether it has received a
DISCONNECT message corresponding to all remote parties that have been
participants of the established conference and depending on that shall act as
follows:
\- If a DISCONNECT messages has been received for each participant, the MSC
Server shall send a BYE request to the conference-URI.
NOTE 2: A complete set of DISCONNECT messages is interpreted as request to
terminate the established conference. The BYE request will lead to a
termination of the conference by the conference focus, after removal all the
participants, as described in 3GPP TS 24.147 [36], clause 5.3.2.7.
\- Otherwise, the MSC Server shall generate a separate REFER request for each
DISCONNECT message to remove the corresponding party/parties from the
conference as specified in 3GPP TS 24.147 [36] clause 5.3.1.6.3, with the
Refer-To header of the REFER request set to the address of the conference
participant being removed and also containing a \"method\" URI parameter set
to \"BYE\". If the address of the conference participant being removed is a
tel URI, the MSC server shall convert the tel URI to a SIP URI and shall set
the host portion of the SIP URI to the home network domain name defined for
IMS centralized services in 3GPP TS 23.003 [10].
NOTE 3: The MSC Server thus treats the DISCONNECT message(s) received before
timer expiry as the user's request for disconnecting the party/parties
belonging to the received transaction identity/identities.
##### 5.6.8.2.6 Receipt of a SplitMPTY message
When the MSC Server receives a SplitMPTY request from the UE, the MSC Server
shall send a FACILITY message with a return error parameter set to \"ss-
NotAvailable\".
##### 5.6.8.2.7 Remote party disconnects from the conference
When the MSC Server receives a SIP NOTIFY request from a conference focus
indicating that a specific remote party has disconnected from the conference,
the MSC Server shall send a CC DISCONNECT message to the UE, with a
transaction identifier corresponding to the specific remote party.
#### 5.6.8.3 MSC Server as conference participant
##### 5.6.8.3.1 Receipt of invitation to conference
###### 5.6.8.3.1.1 General
The methods by which the MSC Server, on behalf of the UE, can be invited to a
conference are described in 3GPP TS 24.605 [35] clause 4.5.2.1.2 and 3GPP TS
24.147 [36] clause 5.3.1.5.
###### 5.6.8.3.1.2 Receipt of REFER within a dialog
Upon receipt of a REFER request within a dialog, the MSC Server shall act as a
transferee on behalf of the UE as specified in clause 5.6.7.3.1.
NOTE 1: If the Refer-To header of the REFER request contains a conference URI,
this will result in the user joining a conference.
NOTE 2: CS domain access signalling as specified in 3GPP TS 24.091 [32] does
not provide a mechanism to present the transfer request to the transferee for
authorization of the transfer. Automatic acceptance and execution of the REFER
request by the MSC Server can therefore pose a security risk or have unwanted
charging consequences. Acceptance of REFER requests is therefore subject to
operator policy, which is outside the scope of the present document.
###### 5.6.8.3.1.3 Receipt of REFER outside a dialog
If the MSC Server does not support accepting REFER requests on behalf of the
UE per operator policy, then the MSC Server shall return a 403 Forbidden
response.
Support for the MSC Server, on behalf of a UE, joining a conference in this
manner requires that the MSC Server shall:
\- initiate a terminating call leg toward the UE in accordance with 3GPP TS
24.008 [3]; and
NOTE: If the user is involved in a call, then the call waiting procedures
described in 3GPP TS 24.008 [3] and 3GPP TS 24.083 [26] apply.
\- initiate an originating call toward the URI identified in the Refer-To
header (e.g. the conference URI); and
\- combine these two call legs into a single call.
Support for this method of joining a conference may be provided as an
implementation option but is outside the scope of the present document.
###### 5.6.8.3.1.4 Receipt of INVITE
NOTE: Clause 5.4.2 contains general applicable procedures executed upon
receipt of an initial INVITE request.
If an INVITE request is received, the MSC Server shall act as follows:
\- if the user is idle, the MSC Server shall act according to the mobile
terminating call set up procedures specified in clause 5.4;
\- if the user is engaged in an established SIP dialog and the INVITE request
contains a Replaces header field corresponding to the established dialog, the
MSC Server act as a transfer target on behalf of the UE as specified in clause
5.6.7.4; or
\- if the user is engaged in an established SIP dialog and the INVITE request
does not contain a Replaces header field corresponding to the established
dialog, the MSC Server shall follow the communication waiting procedures
described in clause 5.6.4.1.
##### 5.6.8.3.2 Notification of conference invocation
If the MSC Server received a non-zero SS screening indicator from the UE as
defined in 3GPP TS 24.080 [29], then upon joining a conference on behalf of a
UE, the MSC Server may send a FACILITY message to the UE indicating a
multiparty call has been invoked as specified in 3GPP TS 24.084 [34].
NOTE: If the MSC Server was invited to the conference via reception of a REFER
request as specified in 3GPP TS 24.147 [36] clause 5.3.1.5.2, the MSC Server
is not able to distinguish between REFER requests for the conferencing service
and REFER requests for the ECT service. In such cases, the MSC Server will not
know which SS operation to indicate in the FACILITY message. Handling of this
scenario is implementation specific.
### 5.6.9 Customized Alerting Tones (CAT)
#### 5.6.9.1 General
The following subclauses describe the MSC Server interworking behaviour
related to the Customized Alerting Tones (CAT) services defined in 3GPP TS
24.182 [51].
Based on operator options, one of three different models described in 3GPP TS
24.182 [51] is used in an IM CN subsystem to provide the CAT service. The CAT
interworking procedures at the MSC server differ between these models and are
described seperately for each model in the subsequent sub-clauses. Support of
the interworking procedures for each of those models is optional.
No special interworking procedures for the CAT service when MSC server receive
a terminating request from IMS network are required.
#### 5.6.9.2 Early session model
##### 5.6.9.2.1 Originating request
If the MSC server supports early-sesssion as a network option, upon receiving
an incoming SETUP message, before the MSC server sending the generated SIP
INVITE request as described in clause 5.3.3, it shall include the option tag
\"early-session\", as defined in IETF RFC 3959 [50], in Supported header
field.
After receiving the first SIP 18x response including an early-session SDP, the
MSC server shall send the ALERTING message as described in 3GPP TS 24.008 [3],
then the MSC server shall follow the same procedure as described for MGCF in
3GPP TS 29.163 [46] clause 7.5.13 to negotiate with IMS side for early-session
and normal session establishment.
#### 5.6.9.3 Forking model
Interworking at MSC server follows the basic call interworking procedures.
Support of the P-Early-Media header field and related procedures as described
in clause 5.3.4a and clause 5.3.4b are required in addition.
#### 5.6.9.4 Gateway model
Interworking at MSC server follows the basic call interworking procedures.
Support of the P-Early-Media header field and related procedures as described
in clause 5.3.4a and clause 5.3.4b are required in addition.
### 5.6.10 Communication Completion Services (CCBS/CCNL/CCNR)
#### 5.6.10.1 General
The following subclauses describe the MSC Server interworking behaviour
related to the Communication Completion services defined in 3GPP TS 24.642
[52] and a UE using CS access domain signalling specified in 3GPP TS 24.093
[53].
#### 5.6.10.2 Communication Completion Terminated at Served User
When the Served User is the terminating user, no special interworking is
required at the MSC Server.
#### 5.6.10.3 Communication Completion Originated at Served User
##### 5.6.10.3.1 Actions without 3PCC
When the MSC Server receives a CC Recall as a REFER request as described in
3GPP TS 24.642 [52] clause 4.5.4.2.3.1, the MSC Server may assign a CCBS Index
to this recall if not already done, and may perform the CC Recall procedures
as specified by 3GPP TS 24.093 [53]. When the SETUP message is received,
normal call handling continues.
If the MSC Server does not support accepting REFER requests on behalf of the
UE per operator policy, then the MSC Server shall return a 403 Forbidden
response.
##### 5.6.10.3.2 Actions with 3PCC
When 3PCC is used for CCBS/CCNL/CCNR as specified in 3GPP TS 24.642 [52], no
special interworking is required at the MSC Server.
## 5.7 Supplementary Service Configuration
### 5.7.1 General
The MSC Server may support the interworking between call independent
supplementary service signalling described in 3GPP TS 24.010 [41] and the XCAP
application usage for manipulating supplementary services data described in
3GPP TS 24.623 [42]. This MSC Server may support this interworking for any
subset of the supplementary services within the scope of the present document.
This interworking shall only be performed for the TS11 service code. If the
MSC Server interworks a supplementary service invoke operation received via
NAS signalling to the IM CN subsystem, the MSC Server shall not also transfer
the received information to the VLR as described in 3GPP TS 29.002 [20]. This
interworking is defined in the following subclauses.
NOTE: This interworking is subject to the limitations inherited by the NAS
signalling procedures defined for each supplementary service. For example, if
no NAS signalling procedure is defined for registration, erasure, activation,
deactivation or interrogation of a particular supplementary service that is
being controlled by the IM CN subsystem, then no interworking procedure is
defined.
### 5.7.2 Receipt of REGISTER message
Upon receipt of a REGISTER message for a supplementary service whose
interworking is within the scope of the present document, the MSC Server shall
generate the appropriate HTTP request according to table 5.7.2.1 if
supplementary service configuration interworking for that supplementary
service is supported by the MSC Server.
Table 5.7.2.1: Mapping REGISTER / FACILITY to HTTP request
* * *
Invoke operation in the REGISTER message HTTP request RegisterSS PUT
ActivateSS PUT DeactivateSS PUT InterrogateSS GET EraseSS PUT
* * *
NOTE: Not all invoke operations are valid for all supplementary services.
Interworking definitions for each supplementary service are only provided for
invoke operations explicitly defined for each supplementary service.
The interworking of message contents for each supplementary service is
described in clause 5.7.4.
### 5.7.3 Receipt of HTTP response
Upon receipt of an HTTP response to a previously sent HTTP request as
described in clause 5.7.2, the MSC Server shall terminate the appropriate
service interaction by sending a RELEASE COMPLETE message. The interworking of
message contents for each supplementary service is described in clause 5.7.4.
### 5.7.4 Service data interworking
#### 5.7.4.1 Originating identification presentation/restriction (OIP/OIR)
##### 5.7.4.1.1 Registration/erasure
The OIP/OIR services require no registration. Erasure is not applicable.
##### 5.7.4.1.2 Activation/deactivation
The OIP/OIR services are activated at provisioning and deactivated at
withdrawal and therefore require no interworking at the MSC Server.
##### 5.7.4.1.3 Interrogation
If the MSC Sever supports supplementary service configuration interworking for
the OIP/OIR services, the interworking procedures in this clause shall be
applied.
When the MSC Server receives a REGISTER message with an InterrogateSS invoke
operation for the CLIP or CLIR supplementary service code as described in 3GPP
TS 24.081 [12], the MSC Server shall generate and send an HTTP GET request to
fetch the instance of the Originating Identity document as specified in 3GPP
TS 24.623 [42].
Upon receiving a response to the HTTP GET request, the MSC Server shall apply
the following interworking:
\- If a 200 OK response is received which includes an Originating Identity
document as defined in 3GPP TS 24.607 [43], the MSC Server shall send a
RELEASE COMPLETE message as follows:
\- If the Originating Identity document indicates the interrogated service
(CLIP/OIP or CLIR/OIR) is active, the MSC Server shall indicate an SS-Status
of provisioned and active; or
\- If the Originating Identity document indicates the interrogated service
(CLIP/OIP or CLIR/OIR) service is not active, the MSC Server shall indicate an
SS-Status of provisioned but not active;
\- If the CLIR/OIR service was interrogated, then the following additional
interworking shall be applied:
\- If there is a \"default-behaviour\" attribute included and set to
\"presentation-restricted\" in the Originating Identity document, the MSC
Server shall set the CLI Restriction Option parameter to indicate Temporary
(Default Restricted);
\- If there is a \"default-behaviour\" attribute included and set to
\"presentation-not-restricted\" in the Originating Identity document the MSC
Server shall set the CLI Restriction Option parameter to Temporary (Default
Allowed);
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include an Originating Identity document, the MSC Server shall
send a RELEASE COMPLETE message with an implementation-specific error code.
#### 5.7.4.2 Terminating identification presentation/restriction (TIP/TIR)
##### 5.7.4.2.1 Registration/erasure
The TIP/TIR services require no registration. Erasure is not applicable.
##### 5.7.4.2.2 Activation/deactivation
The TIP/TIR services are activated at provisioning and deactivated at
withdrawal and therefore require no interworking at the MSC Server.
##### 5.7.4.2.3 Interrogation
If the MSC Sever supports supplementary service configuration interworking for
the TIP/TIR services, the interworking procedures in this clause shall be
applied.
When the MSC Server receives a REGISTER message with an InterrogateSS invoke
operation for the COLP or COLR supplementary service code as described in 3GPP
TS 24.081 [12], the MSC Server shall generate an HTTP GET request to fetch the
instance of the Terminating Identity document as specified in 3GPP TS 24.623
[42].
Upon receiving a response to the HTTP GET request, the MSC Server shall apply
the following interworking:
\- If a 200 OK response is received which includes a Terminating Identity
document as defined in 3GPP TS 24.608 [14], the MSC Server shall send a
RELEASE COMPLETE message as follows:
\- If the Terminating Identity document indicates the interrogated service
(COLP/TIP or COLR/TIR) is active, the MSC Server shall indicate an SS-Status
of provisioned and active; or
\- If the Terminating Identity document indicates the interrogated service
(COLP/TIP or COLR/TIR) service is not active, the MSC Server shall indicate an
SS-Status of provisioned but not active;
NOTE: CS signalling defined in 3GPP TS 24.081 [12] does not allow for the
temporary mode status of the COLR service to be sent to the UE.
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include a Terminating Identity document, the MSC Server shall
send a RELEASE COMPLETE message with an implementation-specific error code.
#### 5.7.4.3 Communication Hold (HOLD)
Configuration of the HOLD service involves no signalling and therefore
requires no interworking at the MSC Server.
#### 5.7.4.4 Communication Waiting (CW)
##### 5.7.4.4.1 Registration/erasure
The CW service requires no registration. Erasure is not applicable.
##### 5.7.4.4.2 Activation/deactivation
If the MSC Sever supports supplementary service configuration interworking for
the CW service, the interworking procedures in this clause shall be applied.
When the MSC Server receives a REGISTER message with an ActivateSS or
DeactivateSS invoke operation for the CW supplementary service code as
described in 3GPP TS 24.083 [26], the MSC Server shall include an instance of
the call waiting document described in 3GPP TS 24.615 [44] in the HTTP PUT
request as follows:
\- If the invoke operation is ActivateSS, the MSC Server shall set the
\"active\" attribute to \"true\";
\- If the invoke operation is DeactivateSS, the MSC Server shall set the
\"active\" attribute to \"false\".
##### 5.7.4.4.3 Interrogation
If the MSC Sever supports supplementary service configuration interworking for
the CW service, the interworking procedures in this clause shall be applied.
When the MSC Server receives a REGISTER message with an InterrogateSS invoke
operation for the CW supplementary service code as described in 3GPP TS 24.083
[26], the MSC Server shall generate and send an HTTP GET request to fetch the
instance of the call waiting document as specified in 3GPP TS 24.623 [42].
When a response to the HTTP GET request is received, the MSC Server shall
apply the following interworking:
\- If a 200 OK is received which includes a call waiting document as defined
in 3GPP TS 24.615 [44], the MSC Server shall send a RELEASE COMPLETE message
as follows:
\- If the call waiting document includes an \"active\" attribute set to
\"true\", the MSC Server shall indicate an SS-Status of provisioned and
active;
\- If the call waiting document includes an \"active\" attribute set to
\"false\", the MSC Server shall indicate an SS-Status of provisioned but not
active;
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include a call waiting document, the MSC Server shall send a
RELEASE COMPLETE message with an implementation-specific error code.
#### 5.7.4.5 Communication Barring (CB)
##### 5.7.4.5.1 Registration/erasure
If the user has the subscription option \"control of barring services\" set to
\"by subscriber using a password\" a password is registered at provisioning
time and the UE can change the registered password at any later time using the
procedures in this subclause.
When the MSC Server receives a REGISTER message with an invoke component of
the operation \"register password\" as specified in 3GPP TS 24.010 [41], the
MSC Server enhanced for ICS first sends a FACILITY message towards the UE with
an invoke component of the operation \"get password\". After receiving a
FACILITY message from the UE with a return result component including a
password, the MSC Server enhanced for ICS shall use this password to perform a
password check procedureby sending an HTTP POST request towards the XCAP
server as specified in 3GPP TS 24.623 [42].
Upon receiving an HTTP 200 (OK) response to the password check request as
above, the MSC Server enhanced for ICS requests the new password from the UE
as specified in 3GPP TS 24.010 [41] by sending a FACILITY message towards the
UE with an invoke component of the operation \"get password\". When the UE
returns the password the MSC Server enhanced for ICS requests the new password
again. After receiving the password again, the MSC Server enhanced for ICS
compares the two passwords, and if they are equal, registers the new password
by performing the password change procedure as specified in 3GPP TS 24.623
[42].
Upon receiving the HTTP 200 (OK) response to the password change request as
above, the MSC Server enhanced for ICS sends a Release Complete with the
return result component of the operation \"register password\" as specified in
3GPP TS 24.010 [41].
Error responses towards the UE are sent as specified in 3GPP TS 24.010 [41].
Erasure of the CB service is not specified for NAS signalling in 3GPP TS
24.088 [30], therefore interworking procedures for service erasure are not
applicable.
##### 5.7.4.5.2 Activation/deactivation
When the MSC Server receives a REGISTER message with an ActivateSS or
DeactivateSS invoke operation for any call barring supplementary service code
as described in 3GPP TS 24.088 [30], the MSC Server shall perform the password
procedure as specified in 3GPP TS 24.088 [30]. and store the received password
for later mapping to the password portion of the SIP URI in the XCAP user
identity as specified in 3GPP TS 24.623 [42]. The MSC Server shall then
perform an interrogation as specified in 3GPP TS 24.611 [31] of either the
\ element or the \ element depending on whether the received supplementary service code
indicated an incoming or an outgoing barring service.
To perform the interrogation the MSC Server populates the HTTP GET request as
specified in 3GPP TS 24.623 [42]. If the result of the interrogation is that
the user is not provisioned with the service indicated in the received
REGISTER message, the MSC Server sends an appropriate error response.
If the result of the interrogation is that the user is provisioned with the
supplementary service indicated in the REGISTER request, and the activation
status is different than the desired status, the MSC Server sends an HTTP PUT
request as specified in 3GPP TS 24.623 [42] including the following rule:
1) If the invoke operation is ActivateSS, the MSC Server shall set the
\"active\" attribute to \"true\":
a) If the supplementary service code is BAOC the MSC Server shall include an
\ element including barring rule where the
condition element is empty or no condition element is included, and not
include the \ elemenent, as defined in 3GPP TS 24.611 [31].
b) If the supplementary service code is BOIC the MSC Server shall include an
\ element including a barring rule for the
international condition, and not include the \ element, as
defined in 3GPP TS 24.611 [31].
c) If the supplementary service code is BOIC-exHC excluding home the MSC
Server shall include an \ element including a
barring rule for the international-exHC condition, and not include the \ element, as defined in 3GPP TS 24.611 [31].
d) If the supplementary service code is BAIC the MSC Server shall include an
\ element including a barring rule where the
condition element is empty or no condition element is included, and not
include the \ element, as defined in 3GPP TS 24.611 [31].
e) If the supplementary service code is BIC-Roam the MSC Server shall include
an \ element including a barring rule for the
roaming condition, and not include the \ element, as defined
in 3GPP TS 24.611 [31].
2) If the invoke operation is DeactivateSS:
a) If the supplementary service code is BAOC the MSC Server shall include an
\ element including barring rule where the
condition element is empty or no condition element is included, as defined in
3GPP TS 24.611 [31]. In addition, the MSC server shall in the condition
element add a \ element.
b) If the supplementary service code is BOIC the MSC Server shall include an
\ element including a barring rule for the
international condition, as defined in 3GPP TS 24.611 [31]. In addition, the
MSC server shall in the condition element add a \ element.
c) If the supplementary service code is BOIC-exHC excluding home the MSC
Server shall include an \ element including a
barring rule for the international-exHC condition, as defined in 3GPP TS
24.611 [31]. In addition, the MSC server shall in the condition element add a
\ element.
d) If the supplementary service code is BAIC the MSC Server shall include an
\ element including a barring rule where the
condition element is empty or no condition element is included, as defined in
3GPP TS 24.611 [31]. In addition, the MSC server shall in the condition
element add a \ element.
e) If the supplementary service code is BIC-Roam the MSC Server shall include
an \ element including a barring rule for the
roaming condition, as defined in 3GPP TS 24.611 [31]. In addition, the MSC
server shall in the condition element add a \ element.
##### 5.7.4.5.3 Interrogation
If the MSC Server supports supplementary service configuration interworking
for the CB service, the interworking procedures in this clause shall be
applied.
When the MSC Server receives a REGISTER message with an InterrogateSS invoke
operation for the BAOC, BAIC, BOIC, BOIC-exHC or BIC-Roam supplementary
service code as described in 3GPP TS 24.088 [30], the MSC Server shall
generate and send an HTTP GET request to fetch the instance of the
Communication Barring document as specified in 3GPP TS 24.623 [42].
When a response to the HTTP GET request is received, the MSC Server shall
apply the following interworking:
1) If an HTTP 200 (OK) response is received which includes a Communication
Barring document as defined in 3GPP TS 24.611 [31], the MSC Server shall send
a RELEASE COMPLETE message as follows:
\- If the Communication Barring document indicates the call barring service
being interrogated is active, the MSC Server shall include a BasicServiceCode
set to the TS11 service code;
\- If the Communication Barring document indicates the call barring service
being interrogated is not active, the MSC Server shall include an SS-Status of
deactivated;
2) If an HTTP non 200 (OK) response is received or if an HTTP 200 OK response
is received which does not include a Communication Barring document, the MSC
Server shall send a RELEASE COMPLETE message with an implementation-specific
error code.
#### 5.7.4.6 Communication Diversion (CDIV)
##### 5.7.4.6.1 Registration
If the MSC Server supports supplementary service configuration interworking
for the CDIV service, the interworking procedures in this clause shall be
applied.
When the MSC Server receives a REGISTER message with a RegisterSS invoke
operation for a supplementary service code listed below, the MSC Server shall
include Communication Diversion document as described in 3GPP TS 24.604 [23]
in the HTTP PUT request as follows:
\- The MSC Server shall set the active attribute to \"true\";
\- If the supplementary service code is CFU as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule where the condition
element is empty or no condition element is included, as defined in 3GPP TS
24.604 [23];;
\- If the supplementary service code is CFB as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule for the busy condition
defined in 3GPP TS 24.604 [23];
\- If the supplementary service code is CFNRy as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule for the no-answer
condition defined in 3GPP TS 24.604 [23];
\- If the supplementary service code is CFNRc as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule for the not-reachable
condition defined in 3GPP TS 24.604 [23];
\- The MSC Server shall include a \"target\" element set to the TEL URI
representation of the ForwardedToNumber parameter received in the REGISTER
message. The TEL URI shall be constructed as described in clause 5.3.3.2.
NOTE: The Communication Diversion document described in 3GPP TS 24.604 [23]
defines XML elements which have no functional equivalent in the service
configuration signalling defined in 3GPP TS 24.082 [24]. The inclusion of
these elements and the values assigned to them is subject to operator policy.
The MSC Server shall store a copy of the Communication Diversion document
until the HTTP PUT response is received and processed.
When a response to the HTTP PUT request is received, the MSC Server shall
apply the following interworking:
\- If a 200 OK is received, the MSC Server shall send a RELEASE COMPLETE
message as follows:
\- The MSC Server shall indicate an SS-Status of provisioned and active;
\- The MSC Server shall set the ForwardedToNumber parameter to the \"target\"
element in the stored Communication Diversion document.
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include a Communication Diversion document, the MSC Server
shall send a RELEASE COMPLETE message with an implementation-specific error
code.
##### 5.7.4.6.1a Erasure
If the MSC Server supports supplementary service configuration interworking
for the CDIV service, the interworking procedures in this clause shall be
applied.
When the MSC Server receives a REGISTER message with an EraseSS invoke
operation for a supplementary service listed below, the MSC Server shall first
fetch the instance of the Communication Diversion document as described in
clause 5.7.4.6.3. If the MSC Server is unable to fetch the Communication
Diversion document, the MSC Server shall send a RELEASE COMPLETE message with
an implementation-specific error code.
The MSC Server shall then include the Communication Diversion document as
described in 3GPP TS 24.604 [23] in an HTTP PUT request, modified as follows:
\- If the supplementary service code is CFU, the MSC Server shall remove the
forwarding rule with an empty condition element or no condition element
included, if present;
\- If the supplementary service code is CFB, the MSC Server shall remove the
forwarding rule for the busy condition defined in 3GPP TS 24.604 [23], if
present;
\- If the supplementary service code is CFNRy, the MSC Server shall remove the
forwarding rule for the no-answer condition defined in 3GPP TS 24.604 [23], if
present;
\- If the supplementary service code is CFNRc, the MSC Server shall remove the
forwarding rule for the not-reachable condition defined in 3GPP TS 24.604
[23], if present;
\- If the supplementary service code is \"all forwarding SS\", the MSC Server
shall remove all forwarding rules described above.
When a response to the HTTP PUT request is received, the MSC Server shall
apply the following interworking:
\- If a 200 OK is received, the MSC Server shall send a RELEASE COMPLETE
message as follows:
\- If an SS-Status parameter is required as specified in 3GPP TS 24.082 [24]
clause 1.3.1, the MSC Server shall indicate an SS-Status of not active;
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include a Communication Diversion document, the MSC Server
shall send a RELEASE COMPLETE message with an implementation-specific error
code.
##### 5.7.4.6.2 Activation/deactivation
If the MSC Sever supports supplementary service configuration interworking for
the CDIV service, the interworking procedures in this clause shall be applied.
When the MSC Server receives a REGISTER message with an ActivateSS or
DeactivateSS invoke operation for the CFU, CFB, CFNRy or CFNRc supplementary
service code as described in 3GPP TS 24.082 [24], the MSC Server shall include
a Communication Diversion document as described in 3GPP TS 24.604 [23] in the
HTTP PUT request as follows:
\- If the invoke operation is ActivateSS, the MSC Server shall set the
\"active\" attribute to \"true\";
\- If the invoke operation is DeactivateSS, the MSC Server shall set the
\"active\" attribute to \"false\";
\- If the supplementary service code is CFU as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule with an empty condition
element or no condition element included;
\- If the supplementary service code is CFB as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule for the busy condition
defined in 3GPP TS 24.604 [23];
\- If the supplementary service code is CFNRy as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule for the no-answer
condition defined in 3GPP TS 24.604 [23];
\- If the supplementary service code is CFNRc as described in 3GPP TS 24.082
[24], the MSC Server shall include a forwarding rule for the not-reachable
condition defined in 3GPP TS 24.604 [23];
NOTE: The Communication Diversion document described in 3GPP TS 24.604 [23]
defines XML elements which have no functional equivalent in the service
configuration signalling defined in 3GPP TS 24.082 [24]. The inclusion of
these elements and the values assigned to them is subject to operator policy.
The MSC Server shall store a copy of the Communication Diversion document
until the HTTP PUT response is received and processed.
When a response to the HTTP PUT request is received, the MSC Server shall
apply the following interworking:
\- If a 200 OK is received, the MSC Server shall send a RELEASE COMPLETE
message as follows:
\- If the \"active\" attribute in the stored Communication Diversion document
is set to \"true\", the MSC Server shall indicate an SS-Status of provisioned
and active;
\- If the \"active\" attribute in the stored Communication Diversion document
is set to \"false\", the MSC Server shall indicate an SS-Status of provisioned
but not active;
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include a Communication Diversion document, the MSC Server
shall send a RELEASE COMPLETE message with an implementation-specific error
code.
##### 5.7.4.6.3 Interrogation
If the MSC Sever supports supplementary service configuration interworking for
the CDIV service, the interworking procedures in this clause shall be applied.
When the MSC Server receives a REGISTER message with an InterrogateSS invoke
operation for the CFU, CFB, CFNRy or CFNRc supplementary service code as
described in 3GPP TS 24.082 [24], the MSC Server shall generate and send an
HTTP GET request to fetch the instance of the Communication Diversion document
as specified in 3GPP TS 24.604 [23].
When a response to the HTTP GET request is received, the MSC Server shall
apply the following interworking:
\- If a 200 OK is received which includes a Communication Diversion document
as defined in 3GPP TS 24.604 [23], the MSC Server shall send a RELEASE
COMPLETE message as follows:
\- If the Communication Diversion document indicates the call forwarding
service being interrogated is active, the MSC Server shall indicate an SS-
Status of provisioned and active;
\- If the Communication Diversion document indicates the call forwarding
service being interrogated is not active, the MSC Server shall indicate an SS-
Status of provisioned but not active;
\- If the Communication Diversion document contains a \"target\" attribute
containing a TEL URI, the MSC Server shall set the ForwardedToNumber parameter
to the TEL URI.
\- If a non 200 OK response is received or if a 200 OK response is received
which does not include a Communication Diversion document, the MSC Server
shall send a RELEASE COMPLETE message with an implementation-specific error
code.
#### 5.7.4.7 Explicit Communication Transfer (ECT)
Configuration of the ECT service involves no signalling and therefore requires
no interworking at the MSC Server.
#### 5.7.4.8 Conference (CONF)
Configuration of the CONF service involves no signalling and therefore
requires no interworking at the MSC Server.
#### 5.7.4.9 Communication Completion Services (CCBS/CCNL/CCNR)
##### 5.7.4.9.1 Activation/deactivation
Activation in the IMS network as specified in 3GPP TS 24.642 [52] is performed
using announcement procedures and inband interaction and no special
interworking is needed.
If the MSC Server supports interworking of deactivating all outstanding CCBS
requests, the MSC Server shall upon receipt of a REGISTER message with a
Deactivate all CCBS Requests Invoke operation revoke all outstanding CCBS
requests using the methods in 3GPP TS 24.642 [52].
If the MSC receives a REGISTER message with a Deactivate specific CCBS Request
the MSC Server shall if no interworking is supported respond with a RELEASE
COMPLETE message with an implementation specific error code.
##### 5.7.4.9.2 Interrogation
If the MSC Sever supports supplementary service configuration interworking for
the CCBS service, the interworking procedures in this clause shall be applied.
When the MSC Server receives a REGISTER message with an InterrogateSS invoke
operation for the CCBS supplementary service code as described in 3GPP TS
24.093 [53], the MSC Server shall generate and send an HTTP GET request to
fetch the instance of the Communication Completion document as specified in
3GPP TS 24.642 [52].
When an HTTP 200 OK response is received which includes a Communication
Completion document as defined in 3GPP TS 24.642 [52], the MSC Server shall:
1) if the Communication Completion document indicates the call forwarding
service being interrogated is active generate an HTTP GET request to fetch an
instance of the Communication Completion Request Records document as defined
in 3GPP TS 24.642 [52];\ \ when a response to the HTTP GET request is received
the MSC server shall:
a) if an HTTP 200 OK is received which includes a Communication Completion
Request Records document as defined in 3GPP TS 24.642 [52] where there is one
or more instances of the \"cc-entry\" element, assign to each of these
elements a CCBS Index and send a RELEASE COMPLETE message indicating an SS-
Status of provisioned and include the list of outstanding CCBS requests; and
b) if an HTTP non 200 OK response is received or if there are no instances of
the \"cc-entry\" element, send a RELEASE COMPLETE message indicating an SS-
status set to \"provisioned\", but there are no outstanding requests; and
2) if the Communication Completion document indicates the communication
completion service being interrogated is not active, send a RELEASE COMPLETE
message indicating an SS-Status of not provisioned.
When an HTTP non 200 OK response is received or if an HTTP 200 OK response is
received which does not include a Communication Completion document, the MSC
Server shall send a RELEASE COMPLETE message with an implementation-specific
error code.
## 5.8 Handover / Relocation
### 5.8.1 Intra-MSC Handover/Relocation
The MSC Server applies the procedures specified in 3GPP TS 23.009 [37] for
Intra-MSC handover/relocation in the CS domain. After the handover/relocation
is completed, the MSC Server shall process the interworking between the NAS
signalling with the SIP signalling as specified in sub-clauses 5.3 through
5.6.
### 5.8.2 Inter-MSC Handover/Relocation
The MSC Server applies the procedures specified in 3GPP TS 23.009 [37] for
Inter-MSC handover/relocation in the CS domain. After the handover/relocation
is completed, the anchor MSC Server shall process the interworking between the
NAS signalling with the SIP signalling as specified in sub-clauses 5.3 through
5.6. The NAS signalling contained in the MAP messages is passed between the
anchored MSC Server and the target MSC Server through the E interface as
specified in 3GPP TS 29.002 [20].
# 6 User plane interworking
## 6.1 General
The following subclauses define the interworking performed by the CS-MGW
between the IM CN subsystem and CS domain access. The interworking between the
Mb reference point and the user plane portions of the IuCS and A reference
points is specified.
## 6.2 IuCS to Mb interworking
### 6.2.1 Interworking with transcoding
Figure 6.2.1.1 shows the user plane protocol stacks for the IuCS and IM CN
subsystem interworking when transcoding is required.
Figure 6.2.1.1: IuCS to Mb protocol stack (transcoding)
IuFP is defined is defined in 3GPP TS 25.415 [16]. IuCS layer 2 and layer 3
are defined in 3GPP TS 25.414 [15]. The IuCS layer 1 is defined in 3GPP TS
25.411 [17].
### 6.2.2 Transcoder-less interworking
Figure 6.2.2.1 shows the user plane protocol stacks for the interworking when
the same codec configuration is used on the IuCS and Mb reference points and
transcoding is not required.
Figure 6.2.2.1: IuCS to Mb protocol stack (no transcoding)
If no transcoder is inserted, the CS-MGW shall interwork procedures between
the IuCS and Mb reference points as specified in 3GPP TS 29.414 [18] clause
7.4.
## 6.3 TDM-based A-interface to Mb interworking
### 6.3.1 Interworking with transcoding
Figure 6.3.1.1 shows the user plane protocol stacks for the TDM-based A and Mb
reference point interworking when transcoding is required.
Figure 6.3.1.1: TDM-based A to Mb protocol stack (transcoding)
Layer 1 for the TDM-based A-interface is defined in 3GPP TS 48.004 [19].
### 6.3.2 Transcoder-less interworking
Figure 6.3.2.1 shows the user plane protocol stacks for the interworking when
the same codec is used on the TDM-based A and Mb reference points and
transcoding is not required.
Figure 6.3.2.1: TDM-based A to Mb protocol stack (no transcoding)
## 6.4 IP-based A-interface to Mb interworking
### 6.4.1 Interworking with transcoding
Figure 6.4.1.1 shows the user plane protocol stacks for the IP-based A and Mb
reference point interworking when transcoding is required.
Figure 6.4.1.1: IP-based A to Mb protocol stack (transcoding)
The IP-based A-interface user plane transport is defined in 3GPP TS 48.103
[38].
### 6.4.2 Transcoder-less interworking
Figure 6.4.2.1 shows the user plane protocol stacks for the interworking when
the same codec is used on the IP-based A and Mb reference points and
transcoding is not required.
Figure 6.4.2.1: IP-based A to Mb protocol stack (no transcoding)
The IP-based A-interface user plane transport is defined in 3GPP TS 48.103
[38].
# 7 MSC Server -- CS-MGW interaction
## 7.1 Mobile originated call
### 7.1.1 CS-MGW selection
The MSC Server shall select a CS-MGW for the bearer connection before it
performs the access bearer assignment or the network side connection point
reservation.
### 7.1.2 IMS session side establishment
#### 7.1.2.1 General
The MSC Server shall either select bearer characteristics or request the CS-
MGW to select and provide the bearer characteristics for the network side
session before sending the INVITE request. The MSC Server shall use the
Reserve RTP Connection Point procedure as defined in 3GPP TS 23.205 [39] and
in 3GPP TS 29.232 [11], with additional information elements as specified in
the present subclause.
Within this procedure, the MSC Server shall indicate the received speech
codecs from the UE and the MSC Server may indicate some configured speech
codec(s) to the CS-MGW and request a local IP address and UDP port from the
CS-MGW and the MSC Server may also indicate that the IP interface type is for
MboIP as defined in 3GPP TS 23.205 [39] and in 3GPP TS 29.232 [11], with
additional information elements as specified in the present subclause. The
local IP address and UDP port are used by the CS-MGW to receive user plane
data.
The CS-MGW shall reply to the MSC Server with the selected local speech
codec(s) and the selected local IP address and UDP port(s).
After the succeeding node has provided the SDP answer, the MSC Server uses the
Configure RTP Resources procedure as defined in 3GPP TS 29.232 [11] to request
the CS-MGW to configure the bearer.
#### 7.1.2.2 Additions to Reserve RTP Connection Point Procedure
This procedure is used to reserve an RTP bearer termination. The Reserve RTP
Connection Point procedure defined in in 3GPP TS 23.205 [39] shall be applied
with additional information elements as defined in table 7.1.2.2.1.
Table 7.1.2.2.1: Additions to Reserve RTP Connection Point Procedure
+-------------+-------------+-------------+-------------+-------------+ | > Procedure | > Initiated | > | > | Information | | | | Information | Information | element | | | | > element | > element | description | | | | > name | > required | | +-------------+-------------+-------------+-------------+-------------+ | Reserve RTP | (G | Priority | O | This | | Connection | )MSC-Server | information | | information | | Point | | | | element | | | | | | requests | | | | | | the CS-MGW | | | | | | to apply | | | | | | priority | | | | | | treatment | | | | | | for the | | | | | | t | | | | | | erminations | | | | | | and bearer | | | | | | connections | | | | | | in the | | | | | | specified | | | | | | context. | +-------------+-------------+-------------+-------------+-------------+ | | | ECN Enable | O | This | | | | | | information | | | | | | element | | | | | | requests | | | | | | the CS-MGW | | | | | | to apply | | | | | | ECN | | | | | | procedures. | +-------------+-------------+-------------+-------------+-------------+ | | | ECN | C | This | | | | Initiation | | information | | | | Method | | element | | | | | | specifies | | | | | | the ECN | | | | | | Initiation | | | | | | method and | | | | | | requests | | | | | | the CS-MGW | | | | | | to perform | | | | | | IP header | | | | | | settings as | | | | | | an ECN | | | | | | endpoint. | | | | | | It may be | | | | | | included | | | | | | only if ECN | | | | | | is enabled. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify ECN | C | This | | | | Failure | | information | | | | Event | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | if an ECN | | | | | | failure | | | | | | occurs. It | | | | | | may only be | | | | | | supplied if | | | | | | ECN is | | | | | | enabled. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | password | | information | | | | request | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests an | | | | | | ICE | | | | | | password. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE Ufrag | O | This | | | | request | | information | | | | | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests an | | | | | | ICE ufrag. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE host | O | This | | | | candidate | | information | | | | request | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests an | | | | | | ICE host | | | | | | candidate. | +-------------+-------------+-------------+-------------+-------------+ | | | STUN server | O | This | | | | request | | information | | | | | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests | | | | | | the CS-MGW | | | | | | to answer | | | | | | STUN | | | | | | c | | | | | | onnectivity | | | | | | checks for | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | SDPCapNeg | O | This | | | | co | | information | | | | nfiguration | | element | | | | | | provides | | | | | | SDPCapNeg | | | | | | confi | | | | | | guration(s) | | | | | | using as | | | | | | \"a=acap\", | | | | | | \"a=tcap\", | | | | | | \"a=pcfg\" | | | | | | and | | | | | | \"a=acfg\" | | | | | | SDP | | | | | | attributes. | +-------------+-------------+-------------+-------------+-------------+ | Reserve RTP | MGW | ICE | C | This | | Connection | | password | | information | | Point | | | | element | | | | | | shall be | | Ack | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | indicates | | | | | | the ICE | | | | | | password | | | | | | assigned by | | | | | | the CS-MGW. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE Ufrag | C | This | | | | | | information | | | | | | element | | | | | | shall be | | | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | indicates | | | | | | the ICE | | | | | | Ufrag | | | | | | assigned by | | | | | | the CS-MGW. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE host | C | This | | | | candidate | | information | | | | | | element | | | | | | shall be | | | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | indicates | | | | | | the ICE | | | | | | host | | | | | | candidate | | | | | | assigned by | | | | | | the CS-MGW. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE lite | C | This | | | | indication | | information | | | | | | element | | | | | | shall be | | | | | | present | | | | | | only if an | | | | | | ICE host | | | | | | candidate | | | | | | request was | | | | | | contained | | | | | | in the | | | | | | request, | | | | | | and the | | | | | | CS-MGW | | | | | | supports | | | | | | ICE lite, | | | | | | but not | | | | | | full ICE. | | | | | | It | | | | | | indicates | | | | | | that the | | | | | | CS-MGW only | | | | | | supports | | | | | | ICE lite. | +-------------+-------------+-------------+-------------+-------------+ | | | SDPCapNeg | C | This | | | | co | | information | | | | nfiguration | | element | | | | | | shall be | | | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | provides | | | | | | SDPCapNeg | | | | | | confi | | | | | | guration(s) | | | | | | using as | | | | | | \"a=acap\", | | | | | | \"a=tcap\", | | | | | | \"a=pcfg\" | | | | | | and | | | | | | \"a=acfg\" | | | | | | SDP | | | | | | attributes. | +-------------+-------------+-------------+-------------+-------------+
#### 7.1.2.3 Additions to Configure RTP Connection Point Procedure
This procedure is used to configure or reconfigure an RTP bearer termination.
The Configure RTP Connection Point procedure defined in 3GPP TS 23.205 [39]
shall be applied with additional information elements as defined in table
7.1.2.3.1.
Table 7.1.2.3.1: Additions to Configure RTP Connection Point Procedure
+-------------+-------------+-------------+-------------+-------------+ | > Procedure | > Initiated | > | > | Information | | | | Information | Information | element | | | | > element | > element | description | | | | > name | > required | | +-------------+-------------+-------------+-------------+-------------+ | Configure | (G | Allowed | O | This | | RTP | )MSC-Server | RTCP APP | | information | | Connection | | message | | element is | | Point | | types | | present if | | | | | | MSC server | | | | | | allows the | | | | | | MGW to send | | | | | | RTCP APP | | | | | | packets of | | | | | | the | | | | | | indicated | | | | | | types | | | | | | defined in | | | | | | TS 26. | | | | | | 114 [28]. | | | | | | The MGW | | | | | | shall not | | | | | | send other | | | | | | RTCP APP | | | | | | packets. If | | | | | | the | | | | | | parameter | | | | | | is not | | | | | | supplied, | | | | | | the MGW | | | | | | shall not | | | | | | send any | | | | | | RTCP APP | | | | | | packets. | +-------------+-------------+-------------+-------------+-------------+ | | | ECN Enable | O | This | | | | | | information | | | | | | element | | | | | | requests | | | | | | the CS-MGW | | | | | | to apply | | | | | | ECN | | | | | | procedures. | +-------------+-------------+-------------+-------------+-------------+ | | | ECN | C | This | | | | Initiation | | information | | | | Method | | element | | | | | | specifies | | | | | | the ECN | | | | | | Initiation | | | | | | method and | | | | | | requests | | | | | | the CS-MGW | | | | | | to perform | | | | | | IP header | | | | | | settings as | | | | | | an ECN | | | | | | endpoint. | | | | | | It may be | | | | | | included | | | | | | only if ECN | | | | | | is enabled. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify ECN | C | This | | | | Failure | | information | | | | Event | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | if an ECN | | | | | | failure | | | | | | occurs. It | | | | | | may only be | | | | | | supplied if | | | | | | ECN is | | | | | | enabled. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | C | This | | | | C | | information | | | | onnectivity | | element | | | | Check | | requests | | | | | | the CS-MGW | | | | | | to perform | | | | | | ICE | | | | | | c | | | | | | onnectivity | | | | | | check as | | | | | | defined by | | | | | | IETF RFC 5 | | | | | | 245 [60]. | | | | | | It is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify ICE | C | This | | | | C | | information | | | | onnectivity | | element | | | | Check | | requests a | | | | Result | | n | | | | | | otification | | | | | | of ICE | | | | | | c | | | | | | onnectivity | | | | | | check | | | | | | result. It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify New | C | This | | | | Peer | | information | | | | Reflexive | | element | | | | Candidate | | requests a | | | | | | n | | | | | | otification | | | | | | of new peer | | | | | | reflexive | | | | | | candidate | | | | | | was | | | | | | discovered | | | | | | during a | | | | | | c | | | | | | onnectivity | | | | | | check. It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | Additional | C | This | | | | ICE | | information | | | | C | | element | | | | onnectivity | | requests | | | | Check | | the CS-MGW | | | | | | to perform | | | | | | additional | | | | | | ICE | | | | | | c | | | | | | onnectivity | | | | | | check as | | | | | | defined by | | | | | | IETF RFC 5 | | | | | | 245 [60]. | | | | | | It is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | candidate | | element is | | | | | | present if | | | | | | MSC Server | | | | | | indicates a | | | | | | received | | | | | | candidate | | | | | | for ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | password | | element is | | | | | | present if | | | | | | MSC Server | | | | | | indicates a | | | | | | received | | | | | | password | | | | | | for ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | SDPCapNeg | O | This | | | | co | | information | | | | nfiguration | | element | | | | | | provides | | | | | | SDPCapNeg | | | | | | confi | | | | | | guration(s) | | | | | | using as | | | | | | \"a=acap\", | | | | | | \"a=tcap\", | | | | | | \"a=pcfg\" | | | | | | and | | | | | | \"a=acfg\" | | | | | | SDP | | | | | | attributes. | +-------------+-------------+-------------+-------------+-------------+ | Configure | MGW | | | | | RTP | | | | | | Connection | | | | | | Point | | | | | | | | | | | | Ack | | | | | +-------------+-------------+-------------+-------------+-------------+ | | | | | | +-------------+-------------+-------------+-------------+-------------+
### 7.1.3 Access bearer establishment
#### 7.1.3.1 General
The way the MSC Server media gateway interaction is carried out depends on the
characteristics of the access bearer network.
#### 7.1.3.2 Iu interface on IP
The MSC Server and the CS-MGW shall act in accordance with clause 6.1.3 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
#### 7.1.3.3 A interface over IP
The MSC Server and the CS-MGW shall act in accordance with clause 6.1.5 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
#### 7.1.3.4 A interface over TDM
The MSC Server and the CS-MGW shall act in accordance with clause 6.1.1.4 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
#### 7.1.3.5 Iu over UTRAN and GERAN
The MSC Server and the CS-MGW shall act in accordance with clause 6.1.1.4 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
### 7.1.4 Apply ringing tone
If the condition as defined in clause 5.3.5 is fulfilled the MSC Server shall
instruct the CS-MGW to send ringing tone towards the calling party. In this
case the MSC Server shall use the Send Tone procedure in accordance with 3GPP
TS 23.205 [39] and 3GPP TS 29.232 [11].
If the MSC Server wishes to stop sending the ringing tone e.g. due to the
receipt of a 200 OK response to the INVITE request the MSC Server shall apply
the Stop Tone procedure as defined in 3GPP TS 23.205 [39] and 3GPP TS 29.232
[11].
### 7.1.5 Through connection
If the MSC Server wants to configure the CS-MGW so that the bearer will be
through-connected in the backward direction the MSC Server shall:
\- use Change Through-Connection procedure as defined in 3GPP TS 29.232 [11]
during any one of the Prepare Bearer and Reserve Circuit procedures as defined
in 3GPP TS 29.232 [11]; or
\- use Configure the RTP Connection Point procedure as defined in 3GPP TS
29.232 [11] during Prepare IP bearer procedure as defined in 3GPP TS 29.232
[11].
If the MSC Server wants to configure the CS-MGW so that the bearer will be
both-way through connected the MSC Server shall use Change Through-Connection
procedure as defined in 3GPP TS 29.232 [11].
### 7.1.5a Handling of Forking
The procedures described in subclauses 7.1.1 to 7.1.6 shall be applied with
the addition that the MSC Server and the CS-MGW shall act in accordance with
subclauses 9.2.3.4.1 to 9.2.3.4.4 in 3GPP TS 29.163 [46].
NOTE: For the references to 3GPP TS 29.163 [46], the O-MGCF and I-MGCF in 3GPP
TS 29.163 [46] is to be understood as MSC Server, the IM-MGW is to be
understood as CS-MGW, and the Configure IMS Resources procedure is to be
understood as Configure RTP Resources procedure.
### 7.1.6 Failure handling in MSC server
If any procedure between the MSC Server and the CS-MGW has not completed
successfully or the MSC Server receives a Bearer Released procedure from the
CS-MGW the procedure in accordance with clause 6.1.1.12 of 3GPP TS 23.231 [40]
and 3GPP TS 29.232 [11] shall be applied.
## 7.2 Mobile terminated call
### 7.2.1 CS-MGW selection
The MSC Server shall select an CS-MGW for the bearer connection before it
performs the network side bearer establishment or the access bearer
assignment. The selection of the CS-MGW does not take place before the call
proceeding has been received by the MSC Server.
### 7.2.2 Network side session establishment
#### 7.2.2.1 General
The MSC Server shall request the CS-MGW to prepare for the network side
session establishment using the Reserve and Configure RTP Connection Point
procedure as specified in 3GPP TS 23.205 [39] and 3GPP TS 29.232 [11], with
additional information elements as specified in the present subclause. Within
this procedure, the MSC Server shall indicate the received speech codecs from
the remote UE and request a local IP address and UDP port from the CS-MGW and
the MSC Server may also indicate that the IP interface type is for MboIP as
defined in 3GPP TS 29.232 [11]. The local IP address and UDP ports are used by
the CS-MGW to receive user plane data. The MSC Server shall include the local
IP address and UDP port number in the SDP answer for the selected codec.
#### 7.2.2.2 Additions to Reserve and Configure RTP Connection Point
This procedure is used to reserve and configure an RTP bearer termination. The
Reserve and Configure RTP Connection Point procedure defined in 3GPP TS 23.205
[39] shall be applied with additional information elements as defined in table
7.2.2.2.1.
Table 7.2.2.2.1: Additions to Reserve and Configure RTP Connection Point
Procedure
+-------------+-------------+-------------+-------------+-------------+ | > Procedure | > Initiated | > | > | Information | | | | Information | Information | element | | | | > element | > element | description | | | | > name | > required | | +-------------+-------------+-------------+-------------+-------------+ | Reserve and | (G | Allowed | O | This | | Configure | )MSC-Server | RTCP APP | | information | | RTP | | message | | element is | | Connection | | types | | present if | | Point | | | | MSC server | | | | | | allows the | | | | | | MGW to send | | | | | | RTCP APP | | | | | | packets of | | | | | | the | | | | | | indicated | | | | | | types | | | | | | defined in | | | | | | TS 26. | | | | | | 114 [28]. | | | | | | The MGW | | | | | | shall not | | | | | | send other | | | | | | RTCP APP | | | | | | packets. If | | | | | | the | | | | | | parameter | | | | | | is not | | | | | | supplied, | | | | | | the MGW | | | | | | shall not | | | | | | send any | | | | | | RTCP APP | | | | | | packets. | +-------------+-------------+-------------+-------------+-------------+ | | | Priority | O | This | | | | information | | information | | | | | | element | | | | | | requests | | | | | | the CS-MGW | | | | | | to apply | | | | | | priority | | | | | | treatment | | | | | | for the | | | | | | t | | | | | | erminations | | | | | | and bearer | | | | | | connections | | | | | | in the | | | | | | specified | | | | | | context. | +-------------+-------------+-------------+-------------+-------------+ | | | ECN Enable | O | This | | | | | | information | | | | | | element | | | | | | requests | | | | | | the CS-MGW | | | | | | to apply | | | | | | ECN | | | | | | procedures | | | | | | and IP | | | | | | header | | | | | | settings as | | | | | | an ECN | | | | | | endpoint. | +-------------+-------------+-------------+-------------+-------------+ | | | ECN | C | This | | | | Initiation | | information | | | | Method | | element | | | | | | specifies | | | | | | the ECN | | | | | | Initiation | | | | | | method and | | | | | | requests | | | | | | the CS-MGW | | | | | | to perform | | | | | | IP header | | | | | | settings as | | | | | | an ECN | | | | | | endpoint. | | | | | | It may be | | | | | | included | | | | | | only if ECN | | | | | | is enabled. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify ECN | C | This | | | | Failure | | information | | | | Event | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | if an ECN | | | | | | failure | | | | | | occurs. It | | | | | | may only be | | | | | | supplied if | | | | | | ECN is | | | | | | enabled. | +-------------+-------------+-------------+-------------+-------------+ | | | STUN server | O | This | | | | request | | information | | | | | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests | | | | | | the CS-MGW | | | | | | to answer | | | | | | STUN | | | | | | c | | | | | | onnectivity | | | | | | checks for | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | C | This | | | | C | | information | | | | onnectivity | | element | | | | Check | | requests | | | | | | the CS-MGW | | | | | | to perform | | | | | | ICE | | | | | | c | | | | | | onnectivity | | | | | | check as | | | | | | defined by | | | | | | IETF RFC 5 | | | | | | 245 [60]. | | | | | | It is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify ICE | C | This | | | | C | | information | | | | onnectivity | | element | | | | Check | | requests a | | | | Result | | n | | | | | | otification | | | | | | of ICE | | | | | | c | | | | | | onnectivity | | | | | | check | | | | | | result. It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | Notify New | C | This | | | | Peer | | information | | | | Reflexive | | element | | | | Candidate | | requests a | | | | | | n | | | | | | otification | | | | | | of new peer | | | | | | reflexive | | | | | | candidate | | | | | | was | | | | | | discovered | | | | | | during a | | | | | | c | | | | | | onnectivity | | | | | | check. It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | password | | information | | | | request | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests an | | | | | | ICE | | | | | | password. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE Ufrag | O | This | | | | request | | information | | | | | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests an | | | | | | ICE ufrag. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE host | O | This | | | | candidate | | information | | | | request | | element is | | | | | | present if | | | | | | MSC Server | | | | | | requests an | | | | | | ICE host | | | | | | candidate. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | candidate | | element is | | | | | | present if | | | | | | MSC Server | | | | | | indicates a | | | | | | received | | | | | | candidate | | | | | | for ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | password | | element is | | | | | | present if | | | | | | MSC Server | | | | | | indicates a | | | | | | received | | | | | | password | | | | | | for ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | Ufrag | | element is | | | | | | present if | | | | | | MSC Server | | | | | | indicates a | | | | | | received | | | | | | Ufrag for | | | | | | ICE. | +-------------+-------------+-------------+-------------+-------------+ | | | SDPCapNeg | O | This | | | | co | | information | | | | nfiguration | | element | | | | | | provides | | | | | | SDPCapNeg | | | | | | confi | | | | | | guration(s) | | | | | | using as | | | | | | \"a=acap\", | | | | | | \"a=tcap\", | | | | | | \"a=pcfg\" | | | | | | and | | | | | | \"a=acfg\" | | | | | | SDP | | | | | | attributes. | +-------------+-------------+-------------+-------------+-------------+ | Reserve and | MGW | ICE | C | This | | Configure | | password | | information | | RTP | | | | element | | Connection | | | | shall be | | Point | | | | present | | | | | | only if it | | Ack | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | indicates | | | | | | the ICE | | | | | | password | | | | | | assigned by | | | | | | the CS-MGW. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE Ufrag | C | This | | | | | | information | | | | | | element | | | | | | shall be | | | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | indicates | | | | | | the ICE | | | | | | Ufrag | | | | | | assigned by | | | | | | the CS-MGW. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE host | C | This | | | | candidate | | information | | | | | | element | | | | | | shall be | | | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | indicates | | | | | | the ICE | | | | | | host | | | | | | candidate | | | | | | assigned by | | | | | | the CS-MGW. | +-------------+-------------+-------------+-------------+-------------+ | | | ICE lite | C | This | | | | indication | | information | | | | | | element | | | | | | shall be | | | | | | present | | | | | | only if an | | | | | | ICE host | | | | | | candidate | | | | | | request was | | | | | | contained | | | | | | in the | | | | | | request, | | | | | | and the | | | | | | CS-MGW | | | | | | supports | | | | | | ICE lite, | | | | | | but not | | | | | | full ICE. | | | | | | It | | | | | | indicates | | | | | | that the | | | | | | CS-MGW only | | | | | | supports | | | | | | ICE lite. | +-------------+-------------+-------------+-------------+-------------+ | | | SDPCapNeg | C | This | | | | co | | information | | | | nfiguration | | element | | | | | | shall be | | | | | | present | | | | | | only if it | | | | | | was | | | | | | contained | | | | | | in the | | | | | | request. It | | | | | | provides | | | | | | SDPCapNeg | | | | | | confi | | | | | | guration(s) | | | | | | using as | | | | | | \"a=acap\", | | | | | | \"a=tcap\", | | | | | | \"a=pcfg\" | | | | | | and | | | | | | \"a=acfg\" | | | | | | SDP | | | | | | attributes. | +-------------+-------------+-------------+-------------+-------------+
### 7.2.3 Access bearer assignment
#### 7.2.3.1 General
The way the MSC Server-CS-MGW interaction is carried out depends on the
characteristics of the access bearer network.
#### 7.2.3.2 Iu interface on IP
The MSC Server and the CS-MGW shall act in accordance with clause 6.2.3 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
#### 7.2.3.3 A interface over IP
The MSC Server and the CS-MGW shall act in accordance with clause 6.2.4 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
#### 7.2.3.4 A interface over TDM
The MSC Server and the CS-MGW shall act in accordance with clause 6.2.2.2.4 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
#### 7.2.3.5 Iu over UTRAN and GERAN
The MSC Server and the CS-MGW shall act in accordance with clause 6.2.2.2.4 in
3GPP TS 23.205 [39] and apply the coding in accordance with 3GPP TS 29.232
[11].
### 7.2.4 Apply ringing tone
If the condition as defined in clause 5.4.7 is fulfilled the MSC Server shall
instruct the CS-MGW to send ringing tone towards the calling party. In this
case the MSC Server shall use the Send Tone procedure in accordance with 3GPP
TS 23.205 [39] and 3GPP TS 29.232 [11].
If the MSC Server wishes to stop sending the ringing tone, e.g. due to receipt
of the CONNECT message, the MSC Server shall apply the Stop Tone procedure as
defined in 3GPP TS 23.205 [39] and 3GPP TS 29.232 [11].
### 7.2.5 Through connection
If the MSC Server wants to configure the CS-MGW so that the bearer will not be
through-connected the MSC Server shall:
\- use Change Through-Connection procedure as defined in 3GPP TS 29.232 [11]
during any one of the Prepare Bearer and Reserve Circuit procedures as defined
in 3GPP TS 29.232 [11]; or
\- use Configure the RTP Connection Point procedure as defined in 3GPP TS
29.232 [11]during Prepare IP bearer procedure as defined in 3GPP TS 29.232
[11].
If the MSC Server wants to configure the CS-MGW so that the bearer will be
both-way through connected the MSC Server shall use the Change Through-
Connection procedure as defined in 3GPP TS 29.232 [11].
### 7.2.6 Announcement
If the MSC Server wants to provide an announcement, e.g. when the condition in
clause 5.4.7 is fulfilled, the MSC Server shall instruct the CS-MGW to send an
announcement. In this case the MSC Server shall use the Play Announcement
procedure in accordance with 3GPP TS 23.205 [39] and 3GPP TS 29.232 [11].
If the MSC Server wishes to stop the sending of an announcement the MSC Server
shall apply the Stop Announcement procedure as defined in 3GPP TS 23.205 [39]
and 3GPP TS 29.232 [11].
### 7.2.7 Failure handling in the MSC server
If any procedure between the MSC Server and the CS-MGW has not completed
successfully or the MSC Server receives a Bearer Released procedure from the
CS-MGW the procedure in accordance with clause 6.2.1.3.13 of 3GPP TS 23.231
[40] and 3GPP TS 29.232 [11] shall be applied.
## 7.2A Notification Procedures
### 7.2A.1 General information
This subclause contains procedures common to mobile originated and mobile
terminated calls which are not defined in 3GPP TS 23.205 [39] but are
applicabe to the MSC Server enhanced for ICS and the CS-MGW.
### 7.2A.2 ECN Failure Indication
This procedure is used to report ECN related errors (see 3GPP TS 29.163 [46]
clause 9.2.11.1c).
Table 7.2A.2.1: Procedures between MSC Server and CS-MGW: ECN Failure
Indication
* * *
Procedure Initiated Information element name Information element required
Information element description ECN Failure Indication CS-MGW Context M This
information element indicates the context for the bearer termination. Bearer
Termination M This information element indicates the bearer termination for
which the ECN failure is reported. ECN Failure Indication M This IE indicates
an ECN failure event. ECN Failure Indication Ack MSC Server Context M This
information element indicates the context where the command was executed.
Bearer Termination M This information element indicates the bearer termination
where the command was executed.
* * *
### 7.2A.3 ICE Connectivity Check Result Notification
This procedure is used to report ICE connectivity check result for Full ICE.
Table 7.2A.3.1: Procedures between MSC Server and CS-MGW: ICE Connectivity
Check Result Notification
* * *
Procedure Initiated Information element name Information element required
Information element description ICE Connectivity Check Result Notification CS-
MGW Context M This information element indicates the context for the bearer
termination. Bearer Termination M This information element indicates the
bearer termination for which the ICE Connectivity Check Result is reported.
ICE Connectivity Check Result M This information element indicates an ICE
Connectivity Check Result event. ICE Connectivity Check Result Notification
Ack MSC Server Context M This information element indicates the context where
the command was executed. Bearer Termination M This information element
indicates the bearer termination where the command was executed.
* * *
### 7.2A.4 ICE New Peer Reflexive Candidate Notification
This procedure is used to report ICE new peer reflexive candidate for Full
ICE.
Table 7.2A.4.1: Procedures between MSC Server and CS-MGW: ICE New Peer
Reflexive Candidate Notification
* * *
Procedure Initiated Information element name Information element required
Information element description ICE New Peer Reflexive Candidate Notification
CS-MGW Context M This information element indicates the context for the bearer
termination. Bearer Termination M This information element indicates the
bearer termination for which the ICE New Peer Reflexive Candidate is reported
ICE New Peer Reflexive Candidate M This information element indicates an ICE
New Peer Reflexive Candidate event. ICE New Peer Reflexive Candidate
Notification Ack MSC Server Context M This information element indicates the
context where the command was executed. Bearer Termination M This information
element indicates the bearer termination where the command was executed.
* * *
## 7.3 Call clearing
### 7.3.1 Clearing received from the network
#### 7.3.1.1 Access bearer clearing
Once the call clearing and the release of the associated radio resources have
been completed, the MSC Server releases any CS-MGW allocated resources for the
access side. If any resources were seized in the CS-MGW, the MSC Server uses
the Release Termination procedure as specified in 3GPP TS 29.232 [11] to
request the CS-MGW to remove the access side bearer termination.
#### 7.3.1.2 Network side clearing
If the MSC Server requires to release resources due to the receipt of a BYE or
CANCEL request or a response including a failure indication from the network
the MSC Server shall act in accordance with clause 7.2.6 in 3GPP TS 23.231
[40] and 3GPP TS 29.232 [11].
### 7.3.2 Clearing received from the user
#### 7.3.2.1 Access bearer clearing
Once the call clearing and the release of the associated radio resources have
been completed, the MSC Server releases any CS-MGW allocated resources for the
access side. If any resources were seized in the CS-MGW, the MSC Server uses
the Release Termination procedure as specified in 3GPP TS 29.232 [11] to
request the CS-MGW to remove the access side bearer termination.
#### 7.3.2.2 Network side clearing
If the MSC Server requires to release resources due to the receipt of a BYE or
CANCEL request or a response including a failure indication from the
originating or terminating UE the MSC Server shall act in accordance with
clause 7.2.6 in 3GPP TS 23.231 [40] and 3GPP TS 29.232 [11].
### 7.3.3 Call clearing received from the CS-MGW
#### 7.3.3.1 Bearer released received on the access side
After the MSC Server has received the Bearer Released procedure from the CS-
MGW on the access side, the MSC Server shall release the access resources as
described in 3GPP TS 24.008 [3]. If the call is already established towards
the network side, call clearing to the network side is performed as described
in clause 5.5.3.
#### 7.3.3.2 Bearer released received on the network side
After the MSC Server has received the Bearer Released procedure from the CS-
MGW on the network side, the MSC Server shall clear the call to the network
side as described in clause 5.5.3 and clear the call to the UE as described in
3GPP TS 24.008 [3].
## 7.4 Call independent procedures
The MSC Server and the CS-MGW are involved in a number of procedures which are
not related to the setting up and clearing of calls. The MSC Server and the
CS-MGW shall comply with the requirements stated in the different subclauses
10.1 - 10.10 of 3GPP TS 23.205 [39] and subclauses 10.12 - 10.16 of 3GPP TS
23.205 [39].
## 7.5 Explicit Congestion Notification
An MSC Server and a CS-MGW may support Multimedia Telephony using Explicit
Congestion Notification (see IETF RFC 3168 [48], IETF RFC 6679 [49], and 3GPP
TS 26.114 [28]), and may then act as an ECN endpoint to enable ECN with a
local ECN-capable terminal within a local network that properly handles ECN-
marked packets.
The ECN procedures described in 3GPP TS 29.163 [46], clause 9.2.11, for MGCF
and IM-MGW are then applicable for MSC Server and the CS-MGW.
## 7.6 Multimedia Priority Service (MPS) Support
The Multimedia Priority Service (MPS) is specified in 3GPP TS 22.153 [54]. An
MSC Server and a CS-MGW may support the priority treatment of a call/session
identified as an MPS call/session.
The MPS procedures described in 3GPP TS 29.163 [46], clause 9.4, for MGCF and
IM-MGW are then applicable for MSC Server and the CS-MGW.
## 7.7 Interactive Connectivity Establishment
An MSC Server and a CS-MGW may support ICE functionality as specified in IETF
RFC 5245 [60] and 3GPP TS 24.229 [2].
Support of full ICE functionality is optional, but if ICE is supported, the
MSC Server and the CS-MGW shall at least support ICE lite as specified in IETF
RFC 5245 [60]_._
The requirements as described in clause 9.2.12 of 3GPP TS 29.163 [46] for MGCF
and IM-MGW, apply to the MSC Server and the CS-MGW when the ICE procedures are
supported.
## 7.8 Codec Parameters Handling
### 7.8.1 Handling of common codec parameters
The requirements as described in clause 9.2.13.1 of 3GPP TS 29.163 [46] for
the MGCF and the IM-MGW, apply to the MSC Server and the CS-MGW.
### 7.8.2 EVS speech codec
The Enhanced Voice Services (EVS) speech codec is defined in 3GPP TS 26.441
[61]. Its RTP payload type is defined in 3GPP TS 26.445 [62], and procedures
for its usage as IMS Multimedia Telephony speech codec are defined in 3GPP TS
26.114 [28].
The MSC Server and the CS-MGW may support transcoding to and from the EVS
speech codec. If they do so, the requirements as described in clause 9.2.13.2
of 3GPP TS 29.163 [46] for the MGCF and the IM-MGW, apply to the MSC Server
and the CS-MGW.
## 7.9 SDP Capability Negotiation (SDPCapNeg)
The SDP Capability Negotiation (SDPCapNeg) as specified in IETF RFC 5939 [63]
is adopted as an optional functionality to negotiate capabilities and their
associated configurations according to 3GPP TS 24.229 [2].
The SDPCapNeg requirements and procedures described in subclause 5.2.23 of
3GPP TS 23.333 [64] for MRFC and MRFP are then applicable for MSC Server and
the CS-MGW.
#
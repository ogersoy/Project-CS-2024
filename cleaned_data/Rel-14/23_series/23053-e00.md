# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document defines the stage 2 service description for Tandem Free
Operation (TFO) in and between GSM and UMTS. Tandem Free Operation applies
only to speech calls.
NOTE: The TFO principles are built so that they could be used as well by other
systems other than GSM and UMTS.
In analogy with ITU-T Recommendations I.130 [2] and with reference to ITU-T
Recommendations Q.65 VI.1 (Stage 2 of the method for the characterisation of
services supported by an ISDN), the second stage of the following three-level
structure is derived from a stage 1 service description.
\- Stage 1 is an overall service description, from the service subscriber\'s
and user\'s standpoints, that views the network as a single entity which
provides services to the user.
\- Stage 2 identifies the functional capabilities and information flows needed
to support the service described in stage 1. Furthermore, it identifies
various possible physical locations for the functional capabilities. The
output of Stage 2, which is signalling system independent, is used as an input
to Stage 3, the design of signalling system and switching Recommendations.
\- Stage 3 defines the signalling system protocols and switching functions
needed to implement the service described in stage 2.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 01.04: \"Digital cellular telecommunications system (Phase 2+);
Abbreviations and acronyms\".
[2] ITU-T Recommendations I.130 (1988): \"Method for the characterization of
telecommunication services supported by an ISDN and network capabilities of an
ISDN\".
[3] 3GPP TS 22.053: \"Tandem Free Operation (TFO); Service Description \-
Stage 1\".
[4] 3GPP TS 48.060: \"Digital cellular telecommunications system (Phase 2+);
In-band control of remote transcoders and rate adaptors for full rate traffic
channels\".
[5] 3GPP TS 48.061: \"Digital cellular telecommunications system (Phase 2+);
In-band control of remote transcoders and rate adaptors for half rate traffic
channels\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**Tandem Free Operation:** corresponds to the Mobile-to-Mobile calls for which
the speech is not transcoded two times but only one by the Mobile Stations
For simplicity the term MS is also used when UE is meant for 3G systems. The
same is valid for TRAU and TC analogously.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
IPE: In Path Equipment
TFO: Tandem Free Operation
Further abbreviations used may be found in 3GPP TR 01.04 [1].
# 4 Main Concepts
In-band TFO aims to remove the speech coding and decoding done in the BSS in
MS-to-MS calls in order to improve the perceived speech quality. In-band TFO
is established after call set-up using in-band signalling. This signalling is
therefore controlled by the TRAU.
Using in-band signalling implies that the link between the TRAUs is
transparent in the sense that the digital content of what is emitted by a TRAU
is not modified. The so-called In Path Equipments must therefore be disabled
or configured in such a way that the information (signalling and coded speech)
required for Tandem Free is not altered.
# 5 TFO Architecture and Transmission Mechanism
## 5.1 TFO Access Interfaces and Reference Points
The GSM BSS reference points for TFO are described in figure 1. GSM A
interface reference point applies here with the exception that speech is not
in the standard 64 kbit/s PCM format and between TFO TRAUs in-band signalling
is used. For speech and in-band signalling the MSC is transparent.
The UMTS core network reference points for TFO are described in figure 2\. The
UMTS Nb interface reference point applies here with the exception that speech
is not in the standard 64 kbit/s PCM format and between TFO TRAUs in-band
signalling is used. For speech and in-band signalling the Core Network is
transparent.
Additional transmission equipments are taken into account. These equipments
are all those which can process the PCM signal between the two peer BSS, e.g.
echo cancellers, DCME. The BSS to BSS transmission is then considered
transparent provided no transmission equipment along the circuit do not modify
the 1 or more LSB or these transmission equipments implement a TFO
\"transparency mode\". A specific signalling allows to remotely control in-
band these equipments.
BSS-MSC out-of-band signalling consists in this version of TFO of the normal
BSSMAP signalling which carries the list of acceptable speech codec that may
be used for the TFO negotiation mechanism.
Use of TFO specific out-of-band mechanism is not foreseen in that version of
the specification.
Figure 1
Figure 2
## 5.2 General In-band Transmission Mechanism for TFO
In TFO establishment mode, one bit out of 16 LSB bits is regularly stolen of
the 64 kbits/s circuit. This provides for a 0,5 kbits/s channel and has been
selected so that the degradation on the speech quality is inaudible.
In TFO established mode bit stealing takes place on the LSB bit/s (bit 8, 7..
9-N; N>=1: number of stolen LSB bits) on each PCM sample. The number N of
stolen LSB bit/s depends on the codec type. This provides for a N*8 kbits/s
channel that allows to carry vocoded speech in TFO frames. The contents of the
\"unstolen\" bits 1- (8-N) is normal A/μ‑law information.
## 5.3 High-Level Functions Required for TFO
The high level functions which apply to TFO are described hereafter. Not all
these functions need necessarily to be covered by the first description of TFO
since some issues may be too complex to solve in an initial stage or at all.
The list of functions which are applicable to the BSS follows:
\- signalling a request message (TFO_REQ) on the A interface that the TRAU
supports TFO;
\- signalling an acknowledgement message (TFO_ACK) that the request message
has been received from the peer entity;
\- monitoring request and acknowledgement messages on the A interface that the
peer entity supports TFO;
\- remote control of echo cancellers, DCME, ...;
\- signalling of current speech codec with acknowledgement message;
\- signalling of speech codec capability with acknowledgement message;
\- change of current speech codec within the BSS (optional);
\- sending of TFO speech frames to the A interface;
\- reception of TFO speech frames from the A interface;
\- conversion of a flow of TRAU frames into TFO speech frames;
\- conversion of a flow of TFO speech frames into TRAU frames.
The following function applies to IPEs that may be along the 64 kbits/s
circuit, such as DCME or echo cancellers equipments:
\- monitoring of TFO negotiation messages;
\- repetition of LSB bit 8 one time out of 16 (TFO establishment mode, i.e.
reproduce at the output of the IPE the detected message);
\- capability to go full or sub-64 kbit/s transparent mode and to resume
normal operation based on TFO negotiation messages;
\- capability to monitor and alter TFO speech frame control information
(optional);
\- capability to insert TFO negotiation messages (optional).
No assumption is made currently on the interactions between call set-up as
seen by the MSC and TFO. This means that the initial working assumption is
that TFO works independently of the Call Control in the MSC, using only a
mechanisms internal to the BSS to activate and de-activate TFO operation.
# 6 Model of operation
## 6.1 Overview
The TRAU must first identify each other as TRAU that are TFO capable. Next the
TRAUs must check that they are using compatible speech codec types. If they
don\'t use compatible speech codec types they can inform the BSC in order to
modify the speech codec used in the MS. If they are using a compatible speech
codec type the TRAU starts to insert TFO speech frames in the LSB(s) of the
PCM octet present on the A / Nb interface. These frames contain the speech
parameters as obtained from the uplink TRAU frames.
## 6.2 TFO establishment phase
### 6.2.1 Sending of TFO_REQ message by a BSS
The TFO_REQ message is sent using bit stealing on bit 8, by stealing one bit
out of 16. This allows to have the least possible degradation of the PCM,
since the TFO_REQ message is sent even in cases where TFO will not be possible
e.g. MS to PSTN call.
### 6.2.2 Monitoring of TFO_REQ by a BSS
The monitoring of the TFO_REQ message can be performed by a BSS which is
capable of TFO.
Upon reception of a TFO_REQ message, the BSS replies with an TFO_ACK message
which can contain the following information:
\- system identification (GSM, UMTS...);
\- the current speech codec;
\- the list of supported speech codecs;
\- a random value that allows the detection of loop backs of a given BSS.
## 6.3 Transparency of transmission equipments
### 6.3.1 Local disabling
Not used.
### 6.3.2 Transparency to TFO negotiation messages
IPE which support TFO protocol need to first synchronise on \"transparency
patterns\" contained in the in-band transmitted TFO messages (negotiation
messages TFO_REQ, TFO_ACK) as discussed in clause 6.2 and in addition track
some specific TFO message (Go transparent command, Go to normal) needed to set
the transparency mode required in TFO established mode or return to normal
operation. Having synchronised to a transparency pattern, the IPE should
reproduce at its output the TFO message in order to ensure transparency of the
in-band signalling path. Some additional delay with respect to normal
operation of the IPE may be introduced by the IPE as far as the in-band
signalling information is concerned but such delay should be a multiple of 20
ms. No delay should be introduced on other bits.
### 6.3.3 Transparency to TFO speech frames
As part of the TFO establishment, if TFO can be successfully established (same
codec type) then each TRAU sends TFO negotiation messages (Go transparent
commands) which indicate to the In Path Equipment (IPE) along the BSS to BSS
circuit the type of IPE transparency mode. The TFO speech frame then contains
a \"keep open\" pattern that maintains the operation of the IPE as commanded.
That \"keep open\" pattern is part of the synchronisation pattern of each TRAU
frame and does not require hence complete tracking of the TFO speech frames by
the IPE (nevertheless the commands within the TFO negotiation messages should
be checked continuously). IPE revert to normal operation in case the keep open
pattern is absent for [1s] or a new command \"Go to normal\" is received.
IPE which support TFO protocol set the transparency mode as indicated in the
received Go transparent command after having reproduced the received Go
transparent command at its output. The IPE should simultaneously start to
track the keep open pattern. Then the bits corresponding to the
\"transparent\" path are copied in the 64 kbit/s output stream of the
equipment. The delay introduced by the IPE on the TFO contained in the
transparent part of the 64 kbit/s should be less than or equal to the delay in
normal operation.
These principles should be GSM/UMTS independent, allowing other systems to use
the same transparency principle.
The behaviour of the IPE regarding the remaining part of the circuit can be
either of the following:
\- the IPE is speech transparent, meaning that the upper bits in the 64
kbits/s output stream should contain PCM speech, that speech being obtained by
running the IPE in its normal way, possibly reproducing the PCM at the input.
IPE should keep the same alignment as present at the input between transparent
LSBs and upper bits containing the PCM speech;
\- the IPE is non speech transparent, meaning that the IPE may strip the upper
bits, if the IPE is the compressor part of an DCME. In such a case the peer
IPE (the decompression part of the DCME) should reproduce the speech from the
received TFO frame). This implies that the DCME implements the decoding part
of some vocoders.
## 6.4 Modification of speech codec
### 6.4.1 Introduction
In the speech codec modification procedure BSS informs the peer BSS the speech
codec types supported by the sending BSS (within the ongoing call) and tries
to align the codecs using implicit rule and BSS internal means to make
appropriate handover.
The support of the informing and BSS internal modification procedures are
optional for a BSS since it depends on the BSS internal capabilities. This
means that TFO should be applicable even if the informing and modification are
not supported by one of the two peer entities. In this case, TFO will be
available if both BSS happen to use a compatible speech codec type.
### 6.4.2 Exchanged parameters
The exchanged parameters are the speech codec currently in use and the other
possible codecs that can be used within the call Modification procedure.
In the TFO request message (TFO_REQ), the BSS informs the fact that it
supports TFO.
The possible modification procedure is started when the TFO request message
from the peer BSS has been detected. It is not synchronised explicitly on Call
Set-up states.
If both BSS receive a TFO_REQ indicating that a compatible speech codec type
is used, the modification is not necessary and the BSS can move to the TFO
established mode.
If the speech codec configurations used on both sides are not compatible, each
BSS looks at the list of the acceptable speech codec configurations from the
other BSS.
There is an implicit rule as to the speech codec configuration that every BSS
will try to use based on the current speech codec configuration, the list of
locally acceptable speech codec configurations, and the list of remotely
acceptable speech codec configuration. Each BSS then tries if it supports it
to perform a change of codec configuration via a intra-BSS (normally intra-
cell) handover.
When a handover has been performed, each BSS will reply to TFO_REQ by a new
TFO_ACK message indicating the newly used speech codec configuration. The
process goes on until either a compatible codec configuration is used, or no
more change of the codec configuration is possible according to the fixed
rule.
There is a timer that protects the TFO establishment phase. The BSS, after the
timer has elapsed, stops sending TFO request messages, but continues the
monitoring of the peer entity. This is in order not to degrade the
communication if TFO cannot be established. To resume the TFO establishment
phase, it will be up to the peer entity to send a new TFO_REQ message to
initiate a new attempt of establishment/modification of TFO e.g. when a
handover has occurred.
### 6.4.3 Change of speech codec configuration in the BSS
This procedure is internal to the BSS. It can be based on the use of O&M
frames on the Abis interface or on the use of a specific TRAU to BSC interface
or on some other method.
## 6.5 TFO operation
### 6.5.1 End to end delay
The end to end delay is similar to normal MS-MS call in TFO operation within a
20 ms range.
### 6.5.2 Synchronisation between TRAUs
The synchronisation depends on the kind of bit stealing used:
\- 0,5 kbits/s. There is a specific pattern one bit out of 16 on the LSB;
\- 8 kbits/s. The synchronisation contained in the TFO frames is used;
\- 16 kbits/s. The synchronisation contained in the TFO frames is used.
Some sub-part of the synchronisation patterns can be understood by
transmission equipments as well.
There is no time alignment between TRAUs.
### 6.5.3 Monitoring in TFO operation
A TRAU in TFO established mode monitors permanently the synchronisation with
the peer TRAU entity.
In case of loss of synchronisation, a timer is started. When the timer
elapses, the TRAU sends normal PCM speech, reverts to non-TFO mode and starts
re-establishment procedures.
### 6.5.4 DTX aspects
Each direction is independent from the DTX point of view. This leads to the
following scenarios for the transfer of speech in one direction.
Table 1
* * *
Uplink User A Downlink User B DTX DTX DTX no DTX no DTX DTX no DTX no DTX
* * *
The sending BSS, when DTX is applied on the uplink direction, generates normal
speech frames when no SID frame is received.
When a SID frame is received in the uplink, the BSS sends this SID frame to
the peer BSS.
When uplink DTX is applied and nothing is received from the MS by the BTS,
i.e. during comfort noise generation, NO_DATA frames are sent to the peer BSS.
Based on this information, the receiving BSS can perform the best action
depending on its mode.
### 6.5.5 Error concealment
The BSS which has received a bad frame in the uplink sends it unmodified to
the peer BSS. The peer BSS either performs error concealment or forwards the
frame to the MS.
### 6.5.6 Management of UFE bit
The UFE bit is managed as described in the 3GPP TS 48.060 and 3GPP TS 48.061.
### 6.5.7 Handover management
Different cases of handovers from the TRAU point of view will be encountered:
1) handover with modification of the TRAU on one side or, which is equivalent,
no modification of TRAU but change of transcoder DSP;
2) intra-cell handover without modification of transcoder DSP;
3) inter-cell handover without modification of transcoder DSP.
In case 1, TFO will be interrupted and re-established if the newly allocated
TRAU (TRAU B) is TFO capable. Indeed the newly allocated TRAU will start in
normal mode and, if it is TFO capable, will immediately attempt to establish
TFO. This will interrupt the reception of TFO frames at the TRAU in TFO mode
(TRAU A). As defined in clause 6.5.3, the synchronisation loss timer may
elapse and TRAU A will revert to normal mode. TFO will then be re-established
given TFO establishment attempts are performed by the new TRAU.
The management of handover for cases 2 and 3 will depend on the time put to
actually switch the communication from one traffic channel to another one in
the intra-cell handover case or between base stations in the inter-cell
handover case. If the handover is fast enough, i.e. the timers to detect the
loss of synchronisation do not elapse, then the TFO will be maintained. In the
opposite case there will be a fallback to regular tandem. Attempts to re-
establish TFO shall be performed if both TRAUs are still TFO-capable.
### 6.5.8 Other issues
The bridging of the communication in the MSC can potentially interfere TFO.
The conference bridge will prevent TFO operation as long as it is present. The
TFO synchronisation pattern should be lost and both TRAUs should revert to
non‑TFO operation if the bridge is present. TFO operation will start again
from the start when the bridge is removed (handover is performed).
# 7 Compatibility Issues
Since the radio interface is not modified, there is no compatibility issue
with the MS. It is up to the second TRAU to make sure that what it sends to
the BTS is compatible with the existing.
The compatibility issue is with end systems not supporting TFO.
The TFO negotiation message synchronisation patterns should be chosen such
that no other system uses such a pattern for another purpose, and that this
pattern cannot be generated by a peer entity which is not supporting TFO. This
does not preclude other systems than GSM or UMTS to use TFO since the type of
system is part of the negotiation mechanism.
# 8 Interactions with Other Services
## 8.1 General
The identified interactions are with the supplementary and basic services that
modify the configuration of a communication.
One example of Supplementary Service is Explicit Call Transfer, where a MS to
MS communication can result in a MS to non-MS communication. Similarly, in a
communication where user A is a Mobile user and User B is not a Mobile user
become a communication between user A and user C where both are Mobile users.
One example of Basic Service is Alternate speech and data, where TFO should
not degrade the transitions between speech and data.
More generally, the identified interactions are all related to the transitions
between a configuration where TFO is possible (and potentially used) and a
configuration where TFO is not possible.
The consequence of a Multiparty Call is that TFO operation is not possible.
The interactions between TFO and Lawful Intercept will depend on the
capability of the devices used in such a case to not alter the in-band
information (signalling and coded speech) required by the in-band TFO system.
These devices can either use the 6- or 7- bit PCM available on the
A-interface.
The SS that modifies the digital content of what is emitted by a TRAU will
interrupt TFO. Nevertheless as soon as the transparency is re-established the
TRAUs will attempt re-establishing TFO.
## 8.2 Support of DTMF
The existing DTMF could be applied independently of TFO. It should be noted
that DTMF in TFO operation means Mobile Terminated DTMF which is currently
excluded from the standard.
The DTMF when inserted by the MSC will interrupt the TFO since the TFO speech
frames are modified when crossing the MSC.
The TFO must be re-established as soon as possible when the DTMF insertion
stops.
# 9 Operational Aspects
TFO feature shall be defined so that a TFO capable TRAU should be able
interact with a TFO non capable TRAU without noticeable degradation of
quality. It shall be possible to roll-out TFO on part of the network.
The TFO establishment protocol shall define timers to set e.g. the negotiation
message transmission time or the time needed to declare the loss of
synchronisation (see clause 6.5.3). When setting the values of these timers it
should be made sure that two sets of timers at both TRAUs are consistent in
order to allow TFO establishment. Given that both TRAUs may be located in
different PLMN and be manufactured by different companies, most of the timers
will have to be initialised at pre-defined values.
#
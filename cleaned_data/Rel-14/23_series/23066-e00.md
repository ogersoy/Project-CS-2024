# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document describes several alternatives for the realisation of
Mobile Number Portability.
The present document includes information applicable to network operators,
service providers, switch and database manufacturers and national regulators.
It is left to operator and implementation decisions which option, or
combination of options, is used, taking into account the regulatory and
architectural constraints that may prevail. The possible implications of these
options on internal node functions and on signalling performance are not
covered in the present document.
Normative Annex A of the present document describes the technical realisation
of the handling of calls to ported UMTS or GSM mobile subscribers using IN
technology.
Normative Annex C of the present document describes the technical realisation
of the handling of calls to ported UMTS or GSM mobile subscribers using
Signalling Relay technology.
Normative Annex A and Normative Annex C describe alternative solutions. The
network operator may choose the solution to be used in his network.
Normative Annex B of the present document describes the technical realisation
of the handling of non-call related SCCP signalling for ported UMTS or GSM
mobile subscribers using Signalling Relay technology.
The present document does not specify the porting process.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 21.905: \"3G Vocabulary\".
[2] 3GPP TS 22.066: \"Support of Mobile Number Portability (MNP); Service
description. Stage 1\".
[3] 3GPP TS 23.018: \"Basic call handling; Technical realisation\".
[4] ETSI ETS 300 009 (1991): \"Integrated Services Digital Network (ISDN);
CCITT Signalling System No. 7 -- Signalling Connection Control Part (SCCP)
[connectionless services] to support international interconnection\".
[5] ETSI ETS 300 374-1: \"Intelligent Network (IN); Intelligent Network
Capability Set 1 (CS1); Core Intelligent Network Application Protocol (INAP);
Part 1: protocol specification\".
[6] ITU-T Recommendation Q.769.1; ISDN User Part (ISUP); Enhancements for the
support of Number Portability\".
[7] ETSI EN 300 356-2 V4.1: \"Integrated Services Digital Network (ISDN);
Signalling System No.7; ISDN User Part (ISUP) version 4 for the international
interface; Part 2: ISDN supplementary services [ITU-T Recommendation Q.730
modified]\".
[8} CTIA report on Wireless Number Portability, Version 2.0.0.
[9] ANSI T1.660 -- 1998, American National Standards for Telecommunications --
Signaling System Number 7 -- NumberPortability Call Completion to a Portable
Number.
[10] ANSI T1.111-1996, American National Standards for Telecommunication --
Signalling System No. 7 (SS7) Message Transfer Part (MTP).
[11] ANSI T1.112-1996, American National Standards for Telecommunication --
Signalling System No. 7 (SS7) Signalling Connection Control Part (SCCP).
Note: Translation Types 10 and 14 will be published in the next revision of
ANSI T1.112.
[12] American National Standard for Telecommunications -- Signalling System
Number 7 (SS7) - ISDN User Part (ISUP) - ANSI T1.113-1995.
[13] American National Standard for Telecommunications - Signalling System
Number 7 (SS7) --Transaction Capabilities Application Part (TCAP) \- ANSI
T1.114-1996.
[14] ETSI EN 302 097 V1.2: \"Integrated Services Digital Network (ISDN);
Signalling System No.7; ISDN User Part (ISUP); Enhancements for support of
Number Portability (NP)\".
[15] TI - Technical Requirements No. 3, April 1999, Number Portability
Database and Global Title Translation.
[16] 3GPP TS 23.096: \"Mobile Name Identification Supplementary Service --
Stage 2\".
[17] North American Numbering Council (NANC) Functional Requirement
Specification, Number Portability Administration Center- Service Management
System (NPAC-SMS), Version 1.0, May 25, 1995; Version 2.0, June 2, 1997**
_._**
[18] 3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced
Logic (CAMEL) Phase 4 -- Stage 2\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply.
**donor network** : subscription network from which a number is ported in the
porting process. This may or may not be the number range holder network
**interrogating network entity** : entity that submits a non-call related
signalling message to interrogate the HLR
**interrogating network:** network in which the interrogating network entity
resides
**mobile number portability** : ability for a mobile subscriber to change
mobile network subscription within the same country whilst retaining his/her
original MSISDN(s). Additional regulatory constraints apply in North America.
**mobile number portability information: an information set relevant to Mobile
Number Portability for a mobile subscriber. It may contain one or more of
Routeing Number, generic IMSI MSISDN,and Number Portability Status.**
**network operator** : GSM PLMN operator
**non-call related signalling message:** all signalling messages where the
MSISDN is used to route the message on SCCP level except MAP SRI without OR
parameter set (i.e. SRI_SMS, SRI for SOR, Send_IMSI, CCBS_Request etc)
**North American GSM Number portability** : the ability for a subscriber to
change subscription between North American GSM networks and other subscription
networks within a regulated geographical area within North America.
**number portability database:** operational database (used in real time at
call set-up) which provides portability information
**number portability location register:** internal MAP application terminating
function (MATF) in the MNP-SRF network entity with an (unspecified) interface
with a NPDB
**number portability status:** information indicating the status of number
portability for a mobile subscriber. It may be one of: own number ported out,
own number not ported out, foreign number ported in, foreign number ported to
a foreign network, foreign number not known to be ported
**number range holder network** : network to which the number range containing
the ported number has been allocated
**originating network** : network where the calling party is located
**portability domain** : set of GSM PLMNs in a country between which MSISDNs
may be ported or a set of North American GSM Mobile networks and other
subscription networks within a regulated geographical area within North
America
**portability network** : a PLMN or ,in North America, a PSTN or an ISDN
network
**portable number** : E.164 number that can be ported between networks in one
nation
**ported number** : portable number that has undergone the porting process
**ported subscriber** : subscriber of a ported number
**porting process** : description of the transfer of a number between network
operators
**recipient network** : network that receives the number in the porting
process. This network becomes the subscription network when the porting
process is complete
**routeing number:** routeing number is the data stored against the ported
number or the non-ported number in the Number Portability Database. The
routeing number points to Subscription Network or Recipient Network
**service key:** service Key can identify to the entity holding the Number
Portability Database that the service logic for Mobile Number Portability
should apply. The Service Key value for Mobile Number Portability is
administered in the MSC, and is passed transparently to the entity holding the
Number Portability Database
**service provider** : entity that offers service subscriptions to individual
subscribers and contracts with a network operator to implement services for a
specific MSISDN. A service provider may contract with more than one network
operator
**service provider portability** : transfer of numbers between two unique
Service Providers
**subscription network** : network with which the customer's Service Provider
has a contract to implement the customer's services for a specific MSISDN
NOTE: The term "recipient network" is used during the porting process. The
recipient network becomes the "subscription network" after the completion of
the porting process.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
CCBS Call Completion on Busy Subscriber
CCF Call Completion Function
CdPA Called Party Address
CgPA Calling Party Address
CNAP Calling Name Presentation
CNDB Calling Name Database
CRMNP Call Related Mobile Number Portability
FCI Forward Call Indicator
GAP Generic Address Parameter
GMSC Gateway MSC
GMSCB The GMSC in HPLMNB
GTT Global Title Translation
HLR Home Location Register
HPLMNB The subscription network of the B subscriber
IAM Initial Address Message
IDP Initial Detection Point
IE Information Element
INE Interrogating Network Entity
IF Information Flow
IPLMN Interrogating PLMN
MATF MAP application Terminating Function
MNP Mobile Number Portability
MNP-SRF Signalling Relay Function for support of MNP
MSA Mobile Station of the A subscriber
MSB Mobile Station of the B subscriber
MSC Mobile-services Switching Centre
MSISDN Mobile Station International ISDN Number
MSRN Mobile Station Roaming Number
> NANP North American Numbering Plan
NAGNP North American GSM Number Portability
NPDB Number Portability Database
NPLMN The number range holder network of the B subscriber
NPLR Number Portability Location Register
OQoD Originating call Query on Digit Analysis
PLMN Public Land Mobile Network
QoHR Query on HLR Release
RN Routeing Number
SMS Short Message Service
SOR Support of Optimal Routeing
SRI Send Routeing Information
STP Signalling Transfer Point
TQoD Terminating call Query on Digit Analysis
TT Translation Type
VMSC The Visited MSC
VMSCB The VMSC of the B subscriber
Further GSM related abbreviations are given in 3GPP TS 21.905: \"3G
Vocabulary\".
# 4 General
## 4.1 Overview
Mobile Number Portability (MNP) is the ability for a UMTS or GSM mobile
subscriber to change the subscription network within a portability domain
whilst retaining her original MSISDN or MSISDNs.
North American GSM Number Portability (NAGNP) is the ability for a subscriber
to change subscription between North American GSM networks and other
subscription networks within a regulated geographical area within North
America.
As part of the porting process administrative actions have to be performed by
the network operators of the number range holder network, donor network,
recipient network and, as an option, by operators of other national UMTS or
GSM networks as follows:
a) if the number range holder network is identical with the donor network:
* * *
Recipient network: add an entry in the HLR;\ add an entry in the Number
Portability Database.
Donor network: add an entry in the Number Portability Database;\ delete the
entry related to the ported MSISDNs in the HLR.
Other networks in the portability domain: add an entry in the Number
Portability Database (if direct routeing is used).
* * *
b) if the number range holder network is identical with the recipient network:
* * *
Recipient network: add an entry in the HLR;\ delete any entry related to the
ported MSISDN in the Number Portability Database.
Donor network: delete any entry related to the ported MSISDN in the Number
Portability Database;\ delete the entry related to the ported MSISDNs in the
HLR.
Other networks in the portability domain: delete any entry related to the
ported MSISDN in the Number Portability Database.
* * *
c) if the number range holder network is different from both the recipient and
the donor network:
* * *
Recipient network: add an entry in the HLR;\ add an entry in the Number
Portability Database.
Number range holder network: update the Number Portability Database
Donor network: delete (or update) the entry in the Number Portability
Database;\ delete the entry related to the ported MSISDNs in the HLR.
Other networks in the portability domain: update the Number Portability
Database (if an entry for the ported MSISDN exists).
* * *
Note that the order of sequence for the administrative actions to be performed
both within a network and by different network operators is significant with
respect to prevention of disruption in service to the mobile subscriber and
prevention of looping calls between networks during the porting process.
Termination of a subscription for a ported number results in the deletion of
any entry in an HLR and NPDB of that number.
If a call fails because databases are not correctly synchronised, the network
entity that detects the inconsistency will raise an MNP specific alarm to the
operation and maintenance subsystem.
The present document does not specify the porting process. It specifies the
functionality needed to set-up calls to both ported and non ported subscribers
including the functionality needed to query an NPDB for MNP information (in
order to be able to charge correctly for CAMEL pre-paid calls and SMS)
(Normative Annex A and Normative Annex C), and the functionality needed to
relay non-call related signalling messages to the HLR in the subscription
network (Normative Annex B) .
## 4.2 Compatibility
The IAM sent to the subscription network may contain additional routeing
information. Within a portability domain the method how to convey the Routeing
Number in the IAM between two portability networks shall be agreed upon by the
two network operators involved (for an ITU-T ISUP solution see [6] and for an
ANSI ISUP solution see [8] and [9]).
In general, IN-based and MNP-SRF (call-related) solutions are compatible and
may coexist in the same portability domain. The only restriction refers to the
case where the number range holder network relays call-related MAP messages
(i.e. SRI for national calls) to the subscription network. If this solution is
selected by at least one network operator within a portability domain, all the
portability networks and transit networks affected must fulfil the following
requirements:
1\. The SCCP interfaces between networks in a portability domain must be
agreed. This refers to the SCCP addressing mechanism being used (e.g. number
lengths, natures of address and translation types for call-related MAP
messages).\ For messages that do not cross network boundaries the SCCP
addressing mechanism is a choice of the network operator.
2\. The subscription network must be able to generate the SRI ack to allow the
onward routeing of the call from the number range holder network to the
subscription network.
In the rest of the possible architectures for MNP, no interworking problems
have been identified. In these cases, network architectures used within one
portability network (e.g. IN, MNP-SRF) are regarded as operator dependent.
In order to avoid loops and incompatibility situations, all the networks
within a portability domain shall use the same routeing convention either
direct routeing, indirect routeing or indirect routeing with reference to the
Subscription network. As an alternative, indirect routeing can interwork
successfully with direct routeing if the routeing number is transferred in the
IAM or if dedicated traffic connections are used.
## 4.3 Common Functionality of the MNP-SRF
In a PLMN that supports mobile number portability, SCCP messages sent to an
HLR may be relayed by an MNP-SRF. Depending on the implemented solution (IN-
based or MNP-SRF-based), on the type of message (call-related, non-call-
related or MNP information request) and on the porting status of the called
subscriber, the MNP-SRF may modify the SCCP called party address and route the
message to a different HLR or to the subscription network, or terminate the
dialogue and response to the INE.
Figure 1 shows the general steering functionality for SCCP message routeing.
It shows the SCCP routeing principle for mobile number portability within a
network.
Note that call related messages in the IN-based solution are not routed to the
MNP-SRF. Therefore Normative Annex A of the present document does not mention
the MNP-SRF.\ However, the usage of the IN-based solution for the call-related
messages should allow operators to have the routeing of the non call-related
messages determined in the same database. See [7] for the description of the
access of the MNP-SRF (node with relay capability) to the NPDB (external
database).
In order to guard against the possibility that the porting data for an MSISDN
is inconsistent between PLMNs in a porting domain, the SCCP hop counter may be
used to prevent indefinite looping of messages between PLMNs. The MNP-SRF
would then decrement the SCCP hop counter for every message that is relayed.
It should be noted that the use of the SCCP hop counter requires the use of
non segmented SCCP XUDT messages as defined in ITU-T 1996 SCCP recommendations
or in the ANSI T1.112-1996 SCCP recommendations for North America, reference
[11].
Figure 1: Steering Function for SCCP Message routeing
Figure 2 shows the process MNP_SRF in the MNP-SRF. The procedures
MNP_SRF_MATF_Call_Related, MNP_SRF_Non_Call_Related and
MNP_SRF_MATF_Info_Request are described in Normative Annex C and Normative
Annex B of the present document. Note that in networks which support the IN-
based solution for call related signalling, a distinction on SCCP level for
call related and non-call related messages is needed and that the MNP-SRF does
not require to include MATF's since call related messages and MNP information
request messages are not terminated at the MNP-SRF.
The test "MNP info-request" is a test on the SCCP Translation Type if a
dedicated Translation Type value for MNP information request messages is used
in the network. The handling of SCCP messages in the MNP-SRF in networks which
do not make use of a dedicated Translation Type value for MNP information
request messages is for further study.
The test \"call-related\" is a test on the SCCP Translation Type if a
dedicated Translation Type value for call related messages is used in the
network. The handling of SCCP messages in the MNP-SRF in networks which do not
make use of a dedicated Translation Type value for call related messages is
for further study.
Figure 2: Process MNP_SRF
# 5 Common Architecture for call setup
Figure 3 shows the general architecture of a portability domain for routeing
of calls. The more detailed architecture within the networks depends on the
chosen solution (IN-based or MNP/SRF-based) and options and is described in
Normative Annex A and Normative Annex C of the present document.
The architecture for non-call related signalling is described in Normative
Annex B of the present document.
Figure 3: General architecture of a portability domain for routeing of calls
The following routeing conventions are identified:
1\. Direct Routeing of calls is a PLMN option that allows to route calls
directly from the PLMN supporting this option to the ported subscriber\'s
subscription network.
2\. Indirect Routeing of calls is a PLMN option which allows to route calls
from the PLMN supporting this option via the number range holder network to
the ported subscriber\'s subscription network.
3\. Indirect Routeing of calls with reference to the subscription network is a
PLMN option for PLMN operators having chosen the MNP-SRF solution for call
related signalling described in Normative Annex C. If all PLMNs within a
portability domain support this option, calls are routed from the originating
network to the number range holder network. The number range holder network
obtains onward routeing information from the subscription network and routes
the call onward to the ported subscriber\'s subscription network.
The following action in the different networks can be identified:
1\. If the call is originated outside the portability domain, the IAM (1) is
received by the number range holder network.
2a. If the call is originated in another national network and the other
national network does not support originating call query (i.e. Indirect
Routeing of calls is applicable), the IAM (2) is received by the number range
holder network.
2b. If the call is originated in another national network and the other
national network supports originating call query (i.e. Direct Routeing of
calls is applicable), the IAM (7) containing the routeing number is sent to
the subscription network. If the routeing number is not used in the IAM sent
from the national originating network to the subscription network, all transit
networks involved are required to look up an NPDB in order to retrieve
routeing information to route the call to the subscription network without
looping.
3a. If the call is originated in the subscription network and the subscription
network does not support originating call query (i.e. Indirect Routeing of
calls is applicable), the IAM (3) is received by the number range holder
network.
3b. If the call is originated in the subscription network and the subscription
network supports originating call query (i.e. Direct Routeing of calls is
applicable), it sends an IAM (8) containing the MSRN to the visited network of
the called subscriber.
3c. If the subscription network receives IAM (6 or 7) containing the routeing
number, it sends an IAM (8) containing the MSRN to the visited network of the
called subscriber.
4a. If the call is routed via the number range holder network, and the number
range holder network supports the MNP-SRF/MATF solution with the option \'MATF
in subscription network\' described in Normative Annex C of the present
document (i.e. Indirect Routeing of calls with reference to the subscription
network is applicable), the number range holder network sends SRI (4) to the
subscription network. The subscription network returns SRI ack (5) containing
the routeing number. The number range holder network then sends IAM (6)
containing the routeing number to the subscription network. If the routeing
number is not used in the IAM sent from the number range holder network to the
subscription network, all transit networks involved are required to look up an
NPDB in order to retrieve routeing information to route the call to the
subscription network without looping.
4b. If the call is routed via the number range holder network, and the number
range holder network supports the IN solution described in Normative Annex A
of the present document or the MNP-SRF/MATF solution with the option \'MATF
inside number range holder network\' described in Normative Annex C of the
present document, the number range holder network sends IAM (6) containing the
routeing number to the subscription network.
# 6 Functional requirements of network entities
## 6.1 Procedure MNP_MT_GMSC_Set_MNP_Parameters
The procedure MNP_MT_GMSC_Set_MNP_Parameters is shown in figure 4. It is
called from the process MT_GMSC defined in 3G TS 23.018 [3].
{width="6.504861111111111in" height="7.857638888888889in"}
Figure 4: Procedure MNP_MT_GMSC_Set_MNP_Parameters
## 6.2 Procedure MNP_MT_GMSC_Check_MNP_Indicators
The procedure MNP_MT_GMSC_Check_MNP_Indicators is shown in figure 5\. It is
called from the process MT_GMSC defined in 3G TS 23.018 [3].
Figure 5: Procedure MNP_MT_GMSC_Check_MNP_Indicators
## 6.3 Procedure MNP_SRF_Check_MNP_Indicator
The procedure MNP_SRF_Check_MNP_Indicator is shown in figure 6. It is called
from the procedures MNP_SRF_Non_Call_Related and MNP_SRF_MATF_Call_Related.
Figure 6: Procedure MNP_SRF_Check_MNP_Indicator
###### ## Annex A (normative): IN Call-Related Technical Realisation
# A.1 Architecture
## A.1.1 Network Options
There are two IN-based solutions for querying the NPDB :-
\- ETSI Core INAP
\- ANSI IN Query.
The following network operator options are defined for the MT calls in the
GMSC:
\- Terminating call Query on Digit Analysis (TQoD);
\- Query on HLR Release (QoHR).
In a GSM network that supports the IN-based approach for call related MNP,
each GMSC shall support at least one of these options.
The following network operator option is defined for MO calls in VMSCA and for
forwarded calls in the GMSC and VMSCB:
\- Originating call Query on Digit Analysis (OQoD).
In a GSM network which supports the IN-based approach for call related MNP, it
is a network operator decision, taking into account the regulatory and
architectural constraints that may prevail, whether or not VMSCs and GMSCs
support this option.
The use of OQoD in transit switches in a PLMN while avoiding multiple database
interrogations is for further study.
The interworking between the CCF and the SSF for MNP is for further study.
Note that for different number ranges different options may be chosen.
An IN-based solution for querying the NPDB may also be used by the gsmSCF in
order to be able to apply different charging tariffs for CAMEL pre-paid
subscribers' calls or short messages established/sent when roaming in their
home PLMN and directed to ported and non-ported mobile subscribers, depending
on whether or not the called and the calling subscriber subscribe to the same
PLMN.
## A.1.2 No NP Query required -- Number is not subject for portability
Figure A.1.2 shows the architecture for a call to a number that is not subject
for portability. This can be for several reasons like for example:
\- the national regulator has stipulated some number series as being non-
portable or;
\- in an initial phase only a limited amount of subscribers might port in
certain number blocks and some operators might want to treat the call routeing
according to traditional routeing plans without any change.
Figure A.1.2: Call to a non-ported number, no NP query required
1 From an Originating Exchange a call is set up to MSISDN. The call is routed
to the Number range holder network being the Subscription network.
2 When GMSCB receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI to the HLRB including the MSISDN in the request.
3 The HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber
currently is registered;
4 The MSC/VLRB returns an MSRN back to the HLRB.
5 The HLRB responds to the GMSCB by sending an SRI ack with an MSRN.
6 GMSCB uses the MSRN to route the call to VMSCB.
## A.1.3 NP Query in Number Range Holder Network
### A.1.3.1 TQoD -- Number is not ported
Figure A.1.3.1 shows the architecture for a call where the Originating network
has no knowledge whether the MSISDN is ported or not and uses the traditional
routeing plans for routeing the call to the Number range holder network for
further routeing decisions.
Figure A.1.3.1: Call to a non-ported number using TQoD procedure
1 From an Originating Exchange a call is set up to MSISDN. The call is routed
to the Number range holder network being the Subscription network.
2 When GMSCB receives the ISUP IAM, it will send a database query to the NPDB
as a result of analysis of the received MSISDN. The MSISDN is included in the
query to the NPDB.
3 The NPDB detects that the MSISDN is not ported and responds back to the
GMSCB to continue the normal call setup procedure for MT calls.
4 The GMSCB requests routeing information by submitting a MAP SRI to the HLRB,
including the MSISDN in the request.
5 The HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber
owning the MSISDN currently is registered.
6 The MSC/VLRB returns an MSRN back to the HLRB.
7 The HLRB responds to the GMSCB by sending an SRI ack with an MSRN.
8 GMSCB uses the MSRN to route the call to VMSCB.
Note that the NPDB may be outside the number range holder network if a shared
NPDB is used.
### A.1.3.2 TQoD -- Number is ported
Figure A.1.3.2 shows the architecture for a call where the Originating network
has no knowledge whether the MSISDN is ported or not and uses the traditional
routeing plans for routeing the call to the Number range holder network for
further routeing decisions.
Figure A.1.3.2: Call to a ported number using TQoD procedure
1 From an Originating Exchange a call is set up to MSISDN. The call is routed
to the Number range holder network.
2 When GMSCA receives the ISUP IAM, it will send a database query, including
the MSISDN, to the NPDB as a result of analysis of the received MSISDN.
3 The NPDB detects that the MSISDN is ported and responds back to the GMSCA
with a Routeing Number pointing out the Subscription network.
4 The call is routed to the Subscription network based on the Routeing Number
carried in ISUP IAM message; also the MSISDN is included in IAM.
5 The GMSCB requests routeing information by submitting a MAP SRI to the HLRB,
including the MSISDN in the request. The capability to route messages to the
correct HLR is required.
6 The HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber
currently is registered.
7 The MSC/VLRB returns an MSRN back to the HLRB.
8 The HLRB responds to the GMSCB by sending an SRI ack with an MSRN.
9 GMSCB uses the MSRN to route the call to VMSCB.
Note that the NPDB may be outside the number range holder network if a shared
NPDB is used.
### A.1.3.3 QoHR -- Number is ported
Figure A.1.3.3 shows the architecture for a call where the Originating network
has no knowledge whether the MSISDN is ported or not and uses the traditional
routeing plans for routeing the call to the Number range holder network for
further routeing decisions.
Figure A.1.3.3: Call to a ported number using QoHR procedure
1 From an Originating Exchange a call is set up to MSISDN. The call is routed
to the Number range holder network.
2 When GMSCA receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI to the HLRA including the MSISDN in the request.
3 The HLRA returns a MAP SRI ack with an "Unknown Subscriber" error since no
record was found for the subscriber in the HLRA.
4 When GMSCA receives the error indication form the HLRA, this will trigger
the sending of a database query to the NPDB, including the MSISDN in the
query.
5 The NPDB detects that the MSISDN is ported and responds back to the GMSCA
with a Routeing Number pointing out the Subscription network.
6 The call is routed to the Subscription network based on the Routeing Number
carried in ISUP IAM message; also the MSISDN is included in IAM.
7 The GMSCB requests routeing information by submitting a MAP SRI to the HLRB,
including the MSISDN in the request. The capability to route messages to the
correct HLR is required.
8 The HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber
currently is registered.
9 The MSC/VLRB returns an MSRN back to the HLRB.
10 The HLRB responds to the GMSCB by sending an SRI ack with an MSRN.
11 GMSCB uses the MSRN to route the call to VMSCB.
Note that the NPDB may be outside the number range holder network if a shared
NPDB is used.
## A.1.4 NP Query in Originating Network
### A.1.4.1 OQoD -- Number is not ported
Figure A.1.4.1 shows the architecture for a call where already the Originating
network has the knowledge whether the MSISDN is ported or not and can route
the call directly to the Subscription network that in this case is the same as
the Number range holder network.
Figure A.1.4.1: Call to a non-ported number using OQoD procedure
1 A call is initiated by Mobile Subscriber A towards Mobile Subscriber B,
using the MSISDN of the called subscriber.
2 When VMSCA receives the call setup indication, it will send a database query
to the NPDB as a result of analysis of the received MSISDN, including the
MSISDN in the query.
3 The NPDB detects that the MSISDN is not ported and responds back to the
VMSCA to continue the normal call setup procedure for MO calls. Depending on
database configuration option, the NPDB could either return a Routeing Number
on not ported calls, as done for ported calls, or the call is further routed
using the MSISDN number only towards the Number range holder network.
4 The call is routed to the Number range holder/Subscription network based on
the MSISDN or Routeing Number carried in ISUP IAM message.
5 The GMSCB requests routeing information by submitting a MAP SRI to the HLRB,
including the MSISDN in the request.
6 The HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber
currently is registered.
7 The MSC/VLRB returns an MSRN back to the HLRB.
8 The HLRB responds to the GMSCB by sending an SRI ack with an MSRN.
9 GMSCB uses the MSRN to route the call to VMSCB.
Note that the NPDB may be outside the national originating network if a shared
NPDB is used.
### A.1.4.2 OQoD -- Number is ported
Figure A.1.4.2 shows the architecture for a call where already the Originating
network has the knowledge that the MSISDN is ported and can route the call
directly to the Subscription network without involving the Number range holder
network.
Figure A.1.4.2: Call to a ported number using OQoD procedure
1 A call is initiated by Mobile Subscriber A towards Mobile Subscriber B,
using the MSISDN of the called subscriber.
2 When VMSCA receives the call setup indication, it will send a database query
to the NPDB as a result of analysis of the received MSISDN including the
MSISDN in the query.
3 The NPDB detects that the MSISDN is ported and responds back to the VMSCA
with a Routeing Number pointing out the Subscription network.
4 The call is routed to the Subscription network based on the Routeing Number
carried in ISUP IAM message; also the MSISDN is included in IAM.
5 The GMSCB requests routeing information by submitting a MAP SRI to the HLRB,
including the MSISDN in the request. The capability to route messages to the
correct HLR is required.
6 The HLRB requests an MSRN from the MSC/VLRB where the mobile subscriber
currently is registered.
7 The MSC/VLRB returns an MSRN back to the HLRB.
8 The HLRB responds to the GMSCB by sending an SRI ack with an MSRN.
9 GMSCB uses the MSRN to route the call to VMSCB.
Note that the NPDB may be outside the national originating network if a shared
NPDB is used.
### A.1.4.3 IN-Query for CAMEL pre-paid service
Figure A.1.4.3 shows the architecture for a call or MO-Short-Message
originated by a CAMEL pre-paid subscriber while roaming in the Home PLMN where
the gsmSCF needs to know whether or not calling and called subscriber
subscribe to the same PLMN in order to apply the correct charging tariff.
Figure A.1.4.3: IN-Query for pre-paid service
1 A call or short message is initiated by Mobile Subscriber A towards Mobile
Subscriber B, using the MSISDN of the called subscriber.
2 When VMSCA receives the call setup indication, it will send a CAP IDP
message to the gsmSCF. The IDP contains the called party's MSISDN.
3 If the calling subscriber roams in her Home PLMN and the called subscriber's
MSISDN indicates that the called subscriber subscribes to a PLMN within the
calling subscriber's Home Country, the gsmSCF queries the NPDB based on the
called party's MSISDN.\ Otherwise the tariff to be applied does not depend on
the called subscriber's porting status and enough information to apply the
correct tariff is available; go to 5.
4 The NPDB returns a routing number to the gsmSCF pointing out the called
subscriber's subscription network. Based on this information the gsmSCF
applies the appropriate tariff for pre-paid subscriber A.
5 The gsmSCF returns CAP AC and CAP CUE messages to the VMSCA.
6 The call or short message is set up.
Note that the NPDB and gsmSCF may be integrated within one physical entity.
# A.2 Information flows
In the following figures the NPDB is shown as belonging to the Number range
holder network or to the national originating network. However, the NPDB may
be shared within one portability domain i.e. nation-wide.
Figure A.2.1 shows the information flow for successful QoHR.
| Number range holder network |  | subscription network |  | visited network |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---  
| GMSC | HLR |  | NPDB |  | GMSC | HLR |  | VLR | VMSC |  |  |   
IAM \---- |  |  |  |  |  |  |  |  |  |  |  |  |   
|  | SRI \--- |  |  |  |  |  |  |  |  |  |  |   
|  | neg. result ---- |  |  |  |  |  |  |  |  |  |  |   
|  | "query" \------------------------ |  |  |  |  |  |  |  |  |  |  |   
|  | "routing" ------------------------ |  |  |  |  |  |  |  |  |  |  |   
|  | IAM \-------------------------------------------- |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  | SRI \---- |  |  |  |  |   
|  |  |  |  |  |  |  |  |  | PRN \---- |  |  |   
|  |  |  |  |  |  |  |  |  | PRN ack ---- |  |  |   
|  |  |  |  |  |  |  | SRI ack ---- |  |  |  |  |   
|  |  |  |  |  |  |  | IAM \-------------------------------------------- |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |   
Figure A.2.1
Figure A.2.2 shows the information flow for unsuccessful QoHR (unallocated
number).
+---------------+---------------+---------------+-----+---+------+ | | Number range | | | | | | | holder | | | | | | | network | | | | | +---------------+---------------+---------------+-----+---+------+ | | GMSC | | HLR | | NPDB | +---------------+---------------+---------------+-----+---+------+ | IAM | | | | | | | | | | | | | | ---- | | | | | | | ------\ | | | | | | | ------- | | | | | | +---------------+---------------+---------------+-----+---+------+ | | | SRI | | | | | | | | | | | | | | --- | | | | | | | ------\ | | | | | | | ------- | | | | +---------------+---------------+---------------+-----+---+------+ | | | negative | | | | | | | result | | | | | | | | | | | | | | --\ | | | | | | | ------- | | | | | | | ------- | | | | +---------------+---------------+---------------+-----+---+------+ | | | \"query\" | | | | | | | | | | | | | | ---\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | +---------------+---------------+---------------+-----+---+------+ | | | \"result\" | | | | | | | | | | | | | | --- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------\ | | | | | | | ------- | | | | | | | ------- | | | | +---------------+---------------+---------------+-----+---+------+ | REL | | | | | | | | | | | | | | --\ | | | | | | | ------- | | | | | | | ------- | | | | | | +---------------+---------------+---------------+-----+---+------+ | | | | | | | +---------------+---------------+---------------+-----+---+------+
Figure A.2.2
Figure A.2.3 shows the information flow for successful TQoD.
| Number range holder network |  | subscription network |  | visited network |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---  
| GMSC | HLR |  | NPDB |  | GMSC | HLR |  | VLR | VMSC |  |  |   
IAM \---- |  |  |  |  |  |  |  |  |  |  |  |  |   
|  | "query" \------------------------ |  |  |  |  |  |  |  |  |  |  |   
|  | "routing" ------------------------ |  |  |  |  |  |  |  |  |  |  |   
|  | IAM \-------------------------------------------- |  |  |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  | SRI \---- |  |  |  |  |   
|  |  |  |  |  |  |  |  |  | PRN \---- |  |  |   
|  |  |  |  |  |  |  |  |  | PRN ack ---- |  |  |   
|  |  |  |  |  |  |  | SRI ack ---- |  |  |  |  |   
|  |  |  |  |  |  |  | IAM \-------------------------------------------- |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |  |  |   
Figure A.2.3
Figure A.2.4 shows the information flow for unsuccessful TQoD (number not
ported).
| Number range holder network |  | visited network |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
| GMSC |  | HLR |  | NPDB |  | VLR |  | VMSC  
IAM \------- |  |  |  |  |  |  |  |  |   
|  | "query" \----------------------------------- |  |  |  |  |  |  |   
|  | "result" ----------------------------------- |  |  |  |  |  |  |   
|  | SRI \------- |  |  |  |  |  |  |   
|  |  |  | PRN \------------------------------------ |  |  |  |  |   
|  |  |  | PRN ack ------------------------------------ |  |  |  |  |   
|  | SRI ack ------- |  |  |  |  |  |  |   
|  | IAM \-------------------------------------------------------------------------------------------- |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Figure A.2.4
Figure A.2.5 shows the information flow for successful OQoD (number ported).
National originating network A |  | subscription network B |  | visited network B |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---  
| VMSC |  | NPDB |  | GMSC |  | HLR |  | VLR |  | VMSC  
Set-up \----- |  |  |  |  |  |  |  |  |  |  |   
|  | "query" \------ |  |  |  |  |  |  |  |  |   
|  | "routing" ----- |  |  |  |  |  |  |  |  |   
|  | IAM \---------------------------- |  |  |  |  |  |  |  |  |   
|  |  |  |  |  | SRI \----- |  |  |  |  |   
|  |  |  |  |  |  |  | PRN \----- |  |  |   
|  |  |  |  |  |  |  | PRN ack ----- |  |  |   
|  |  |  |  |  | SRI ack ----- |  |  |  |  |   
|  |  |  |  |  | IAM \----------------------------------------------------- |  |  |  |  |   
|  |  |  |  |  |  |  |  |  |  |   
Figure A.2.5
Figure A.2.6 shows the information flow for unsuccessful OQoD (number not
ported in).
+--------------+-------+--------------+------+---+--------------+ | originating | | Number range | | | | | network | | holder | | | | | | | network | | | | +--------------+-------+--------------+------+---+--------------+ | | VMSCA | | NPDB | | GMSC | +--------------+-------+--------------+------+---+--------------+ | Set-up | | | | | | | | | | | | | | ---- | | | | | | | ------ | | | | | | | ------ | | | | | | +--------------+-------+--------------+------+---+--------------+ | | | \"query\" | | | | | | | | | | | | | | ---- | | | | | | | ------ | | | | | | | ------ | | | | +--------------+-------+--------------+------+---+--------------+ | | | \"routing\" | | | | | | | | | | | | | | ---\ | | | | | | | ------\ | | | | | | | ------- | | | | +--------------+-------+--------------+------+---+--------------+ | | | IAM | | | | | | | | | | | | | | ---- | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | | | | ------ | | | | +--------------+-------+--------------+------+---+--------------+ | | | | | | continue as | | | | | | | shown in | | | | | | | figures | | | | | | | A.2.1, | | | | | | | A.2.2, A.2.3 | | | | | | | and A.2.4 | +--------------+-------+--------------+------+---+--------------+
Figure A.2.6
# A.3 Functional requirements of network entities
## A.3.1 Functional requirement of GMSC
### A.3.1.1 Procedure MOBILE_NUMBER_PORTABILITY_IN_QoHR
The procedure MOBILE_NUMBER_PORTABILITY_IN_QoHR is shown in figure A.1.3. It
is called from the procedure Obtain_Routeing_Address defined in 3G TS 23.018
[3].
The text in this clause is a supplement to the definition in the SDL diagrams;
it does not duplicate the information in the SDL diagrams.
The query to NPDB contains the service key for MNP query and the called
party's MSISDN.
Figure A.3.1.1: Procedure MOBILE_NUMBER_PORTABILITY_IN_QoHR
### A.3.1.2 Procedure MOBILE_NUMBER_PORTABILITY_IN_TQoD
The procedure MOBILE_NUMBER_PORTABILITY_IN_TQoD is shown in figure A.3.1.2. It
is called from the procedure Obtain_Routeing_Address defined in 3G TS 23.018
[3].
The text in this clause is a supplement to the definition in the SDL diagrams;
it does not duplicate the information in the SDL diagrams.
The \"query\" to NPDB contains the service key for MNP query and the called
party's MSISDN.
{width="6.429166666666666in" height="7.7756944444444445in"}
Figure A.3.1.2: Procedure MOBILE_NUMBER_PORTABILITY_IN_TQoD
## A.3.2 Functional requirement of MSC
### A.3.2.1 Procedure MOBILE_NUMBER_PORTABILITY_IN_OQoD
The procedure MOBILE_NUMBER_PORTABILITY_IN_OQoD is shown in figure A.3.2.1. It
is called from the procedure Outgoing_Call_Setup_MSC and from the process
MT_CF_MSC defined in 3G TS 23.018 [3].
The text in this clause is a supplement to the definition in the SDL diagrams;
it does not duplicate the information in the SDL diagrams.
The MSC may recognise own numbers as not being within the ported number range.
For foreign numbers however, the MSC will not in general know whether the
number is portable. The test "called party number is a portable national
MSISDN" takes the "yes" exit if the number is a foreign national MSISDN or an
own portable MSISDN.
The \"query\" to NPDB contains the service key for MNP query and the called
party's MSISDN.
Figure A.3.2.1: Procedure MOBILE_NUMBER_PORTABILITY_IN_OQoD
## A.3.3 Functional requirement of NPDB
### A.3.3.1 Process IN_QUERY_NPDB
The process IN_QUERY_NPDB is shown in figure A.3.3.1.
Figure A.3.3.1: Process IN_QUERY_NPDB
# A.4 Contents of messages
This clause specifies the content of the following messages:
On the ISUP interface:
IAM.
On the MSC - NPDB interface:
\"query\";
\"routing\";
\"result\".
Messages in the MSC -- NPDB interface are mapped into ETSI Core INAP or ANSI
IN Query messages according to the protocols on this interface. This is listed
in the following table:
+--------------------------------+---------------+---------------------------+ | Messages in MSC-NPDB interface | INAP messages | ANSI IN Query messages | +--------------------------------+---------------+---------------------------+ | \"query\" | INITIAL DP | ProvideInstruction:Start | +--------------------------------+---------------+---------------------------+ | \"routing\" | CONNECT | ConnectionControl:Connect | | | | | | | CONTINUE | | +--------------------------------+---------------+---------------------------+ | \"result\" | CONTINUE | ConnectionControl:Connect | | | | | | | RELEASE CALL | | +--------------------------------+---------------+---------------------------+
In the tables that follow, information elements are shown as mandatory (M),
conditional (C) or optional (O). A mandatory information element shall always
be present. A conditional information element shall be present if certain
conditions are fulfilled; if those conditions are not fulfilled it shall be
absent. An optional element may be present or absent, at the discretion of the
application at the sending entity.
## A.4.1 Messages on the ISUP interface
### A.4.1.1 IAM for ETSI ISUP interface
This message is specified in [14]. It is necessary for the IAM to contain the
information needed to route the call to the subscription network of the ported
subscriber. The ways in which this may be coded are shown in [14].
### A.4.1.2 IAM for ANSI ISUP interface
This message is specified in [8] and [9]. It is necessary for the IAM to
contain the information needed to route the call to the subscription network
of the ported subscriber. The ways in which this may be coded are shown in [8]
and [9].
## A.4.2 Messages on the MSC - NPDB interface
### A.4.2.1 INITIAL DP
This message is specified in [5]. The following information elements are
required:
* * *
Information element name Required Description Service Key M Identifies the
requested IN service (MNP query) Called Party Number M The possibly ported
MSISDN
* * *
### A.4.2.2 INITIAL DP negative response
This message is specified in [5]. The negative response information element
can take the following values:
1\. missing parameter;
2\. unexpected data value;
3\. unexpected parameter;
4\. system failure.
### A.4.2.3 CONNECT
This message is specified in [5]. It shall be ensured that the information in
the Connect message shall be aligned with the coding supported in the ISUP
signalling.
### A.4.2.4 CONTINUE
This message is specified in [5]. This message does not contain any
information element.
### A.4.2.5 RELEASE CALL
This message is specified in [5]. The following information elements are
required:
* * *
Information element name Required Description Cause M Indicates the reason for
releasing the call
* * *
### A.4.2.6 ProvideInstruction:Start
* * *
**Parameter** **Type** **Number of Octets** **Contents** Package Type
Identifier M 1 Query with Permission Component Type Identifier M 1 Invoke
(last) Operation Code Identifier M 1 National TCAP Operation Code M 2
provideInstruction:Start (reply required) Service Key M 11* 10 digit called
party number digits Digits (calling party number) M ^1^ 6-9 3,6 or 10 ANI
digits Digits (LATA) M ^1^ 6 LATA ID Originating Station Type M ^1^ 1 Binary
value of ANI II digits
* * *
Note:
* = Value specific for number portability
^1^ = This mandatory parameter is required for the message but the content is
not essential for number portability.
### A.4.2.7 ConnectionControl:Connect
* * *
**Parameter** **Type** **Number of Octets** **Contents** Package Type
Identifier M 1 Response Component Type Identifier M 1 Invoke (last) Operation
Code Identifier M 1 National TCAP Operation Code M 2 connectionControl:Connect
(no reply required) Digits (Carrier) M ^1^ 6 3 or 4 digit CIC Digits (Routing
Number) M 9* 10 digit RN or Dialed Number Billing Indicators M ^1^ 4
Unspecified
* * *
Note:
* = Value specific for number portability
^1^ = This mandatory parameter is required for the message but the content is
not essential for number portability.
###### ## Annex B (normative): Handling of Non-Call Related Signalling
# B.1 Handling of Non-call Related Signalling
## B.1.1 Routeing Conventions
Figure B.1.1 illustrates the routeing of non-call related signalling messages
between networks in a number portability environment.
Figure B.1.1: Routeing of non-call related signalling messages in a number
portability environment
If a non-call related signalling message is originated outside the portability
domain, this message (1) is received by the number range holder network. The
number range holder network routes the message (5) onward to the subscription
network.
If a non-call related signalling message is originated in a network inside the
portability domain and this network supports direct routeing, this message (3)
is routed to the subscription network.
If a non-call related signalling message is originated in a network inside the
portability domain and this network does not support direct routeing, the
message (2, 4) is routed to the number range holder network. The number range
holder network routes the message (5) onward to the subscription network. This
is referred to as indirect routeing.
## B.1.2 Network Architecture
In a PLMN that supports MNP, non-call related signalling messages as mentioned
in section B.1.1 are relayed by an MNP-Signalling Relay Function (MNP-SRF).
The MNP-SRF provides re-routeing capability for signalling messages addressed
using the MSISDN. The MNP-SRF obtains routeing information from the NP
database to identify the subscription network associated with a particular
national MSISDN. The interface between the MNP-SRF and the NP database is
considered implementation dependent and is not detailed further. For further
details see clause 4.3.
From the perspective of the PLMN in which the MNP-SRF resides, the MSISDN in
the CdPA represents either:
1 An own number ported out.
2 An own number not ported out.
3 A foreign number ported in.
4 A foreign number ported to a foreign network.
5 A foreign number not known to be ported.
When a PLMN supports direct routeing (clause B.1.1), all non-call related
signalling messages where the MSISDN in the CdPA belongs to a number range
owned by a PLMN in the portability domain and all non-call related signalling
messages which are relayed towards the network, are routed to the PLMN's MNP-
SRF for treatment.
In case 2 and 3 the MNP-SRF relays the message to the Subscriber Database
supporting the Network Service e.g. HLR and Calling Name Database.
In case 1, 4 and 5 the MNP-SRF relays the message to subscription network.
When a PLMN does not support direct routeing, only non-call related signalling
messages where the MSISDN in the CdPA belongs to a number range owned by the
PLMN itself and all non-call related signalling messages which are relayed
towards the network are routed to the PLMN's MNP-SRF for treatment. All other
messages are routed to the number range holder network.
For this routeing convention, only cases 1, 2 and 3 are applicable:
In case 2 and 3 the MNP-SRF relays the message to the Subscriber Database
supporting the Network Service e.g. HLR and Calling Name Database.
In case 1 the MNP-SRF relays the message to the subscription network.
# B.2 Signalling Scenarios
## B.2.1 Non-call Related Signalling Message for a Non-ported Number --
Indirect Routeing
Figure B.2.1 shows the MNP-SRF operation for routeing a non-call related
signalling message for a non-ported number where the interrogating network is
inside the portability domain and indirect routeing is used or the
interrogating network is outside the portability domain.
Figure B.2.1: MNP-SRF operation for routeing a non-call related signalling
message for a non-ported number where the interrogating network is inside the
portability domain and indirect routeing is used or the interrogating network
is outside the portability domain
NOTE: that the TT may have a different value, e.g. TT=17 in the case of CCBS
Requests and TT=14 in the case of ANSI Routing of SRI_For_Short Message.
The Interrogating Network Entity (INE) submits a non-call related signalling
message. When MNP-SRFB receives the message, MNP-SRF operation is triggered.
The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being non-ported using information that may be retrieved from an NP
database. Figure B.2.1 shows an example where the MNP-SRF function then re-
routes the message to HLRB.
## B.2.2 Non-call Related Signalling Message for a Ported or Non‑ported Number
-- Direct Routeing
Figure B.2.2 shows the MNP-SRF operation for routeing a non-call related
signalling message for a ported or non-ported number where the interrogating
network supports direct routeing. If the interrogating network is the
subscription network, MNP-SRFA and MNP-SRFB coincide; i.e. the signalling
message passes the MNP-SRF only once.
{width="5.1097222222222225in" height="3.4in"}
Figure B.2.2: MNP-SRF operation for routeing a non-call related signalling
message for a ported or non-ported number where the interrogating network
supports direct routeing
NOTE 1: the TT may have a different value, e.g. TT=17 in the case of CCBS
Requests and TT=14 in the case of ANSI Routing of SRI_For_Short Message .
NOTE 2: the CdPA may have different values in the GT address and the nature of
address fields.
The Interrogating Network Entity (INE) submits a non-call related signalling
message. When MNP-SRFA receives the message, MNP-SRF operation is triggered.
The MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
subscription network using information that may be retrieved from an NP
database. The MNP-SRF function then modifies the CdPA according to the rules
agreed for the portability domain and routes the message to MNP-SRFB in the
subscription network.
When MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-
SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as
being ported into the network using information that may be retrieved from an
NP database. Figure B.2.2 shows an example where the MNP-SRF function then re-
routes the message to HLRB.
## B.2.3 Non-call Related Signalling Message for a Ported Number ‑ Indirect
Routeing
Figure B.2.3 shows the MNP-SRF operation for indirectly routeing (i.e. via the
number range holder network) a non-call related signalling message for a
ported subscriber.
Figure B.2.3: MNP-SRF operation for indirectly routeing (i.e. via the number
range holder network) a non-call related signalling message for a ported
subscriber
NOTE 1: the TT may have a different value, e.g. TT=17 in the case of CCBS
Requests and TT=14 in the case of ANSI Routing of SRI_For_Short Message.
NOTE 2: the CdPA may have different values in the GT address and the nature of
address fields.
The Interrogating Network Entity (INE) submits a non-call related signalling
message. This message is routed on MSISDN global title to MNP-SRFA in the
number range holder network.
When MNP-SRFA receives the message, MNP-SRF operation is triggered. The MNP-
SRF functionality analyses the MSISDN in the CdPA and identifies the
subscription network using information that may be retrieved from an NP
database. The MNP-SRF function then modifies the CdPA according to the rules
agreed for the portability domain and routes the message to MNP-SRFB in the
subscription network.
When MNP-SRFB receives the message, MNP-SRF operation is triggered. The MNP-
SRF functionality analyses the MSISDN in the CdPA and identifies the MSISDN as
being ported into the network using information that may be retrieved from an
NP database. Figure B.2.3 shows an example where the MNP-SRF function then re-
routes the message to HLRB.
# B.3 Functional Requirements of Network Entities
## B.3.1 Procedure MNP_SRF_Non_Call_Related
Figure B.3.1 shows the procedure MNP_SRF_Non_Call_Related. This procedure
handles non-call related signalling messages. It is called from the process
MNP_SRF (see chapter 4.3).
The check "CdPA contains own number ported out?" identifies all mobile numbers
from number ranges allocated to the network the MNP-SRF is located in and
which are ported to other networks. In this case the message is relayed to the
subscription network.
The check "CdPA contains own number not ported out?" identifies all mobile
numbers from the number ranges allocated to the network the MNP-SRF is located
in and which are still served by the network the MNP-SRF is located in, i.e.
the numbers are not ported out. In this case the message is relayed to the HLR
in the network.
The check "CdPA contains foreign number ported in?" identifies all mobile
numbers from the number ranges not allocated to the network the MNP-SRF is
located in and which are served by the network the MNP-SRF is located in, i.e.
the numbers are ported in. In this case the message is relayed to the HLR in
the network.
The check "CdPA contains foreign number ported to a foreign network?"
identifies all mobile numbers from the number ranges not allocated to the
network the MNP-SRF is located in and which are not served by the MNP-SRF is
located in and not served by the network the number range is allocated to,
i.e. the numbers are ported to a foreign network. In this case the message is
relayed to the subscription network.
The remaining numbers "CdPA contains number not known to be ported ?" are
mobile numbers from the number ranges not allocated to the network the MNP-SRF
is located in and which are also not served by the network the MNP-SRF is
located in. In this case the message is relayed to the number range holder
network.
Figure B.3.1: Procedure MNP_SRF_Non_Call_Related
# B.4 Signalling Scenarios (informative)
This (informative) chapter contains examples of signalling scenarios.
## B.4.1 Delivery of SMS to a Non-ported Number -- Direct Routeing -- MNP-SRF
acts as SCCP Relay
Figure B.4.1 shows the MNP-SRF operation for delivering an SMS message to a
non-ported number.
{width="5.800694444444445in" height="3.4159722222222224in"}
Figure B.4.1: SRF operation for delivering an SMS message to a non-ported
number where the SRI_for_SM message is submitted by a national interrogating
network
1\. The SMSC forwards a SM to the SMS-GMSC via a proprietary interface.
2\. The SMS-GMSC generates a routeing enquiry for SM delivery. The MAP
SRI_for_SM message is routed to the network's MNP-SRF.
3\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being non-ported using information which may be retrieved from an NP
database. The MNP-SRF function then populates the CdPA with an HLRB address.
After modifying the CdPA, the message is routed to HLRB.
4\. HLRB responds to the routeing enquiry by sending back an SRI_for_SM ack
with the address of the VMSC.
5\. The SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS
message.
6\. VMSCB further delivers the message to MSB.
## B.4.2 Delivery of SMS to a Non-ported Number - Direct Routeing -- MNP-SRF
acts as Higher-level Relay
Figure B.4.2 shows the MNP-SRF operation for delivering an SMS message to a
non-ported number where the SRI_for_SM message is submitted by a national
interrogating network. For further details of the higher level relay function
(e.g. TC relay), the reader is referred to [7].
{width="5.2972222222222225in" height="3.1243055555555554in"}
Figure B.4.2: SRF operation for delivering an SMS message to a non-ported
number where the SRI_for_SM message is submitted by a national interrogating
network
1\. The SMSC forwards a SM to the SMS-GMSC via a proprietary interface.
2\. The SMS-GMSC generates a routeing enquiry for SM delivery. The MAP
SRI_for_SM message is routed to the network's MNP-SRF.
3\. When MNP-SRFB receives the message it terminates the TCAP dialogue and an
MNP-SRF operation is triggered. The MNP-SRF functionality analyses the MSISDN
in the TCAP portion of the message and identifies the MSISDN as being non-
ported using information which may be retrieved from an NP database. The MNP-
SRF function then initiates a new dialogue and routes the message to HLRB.
4\. HLRB responds to the routeing enquiry by sending back an SRI_for_SM ack
with the address of the VMSC.
5\. MNP-SRFB responds to the routeing enquiry by sending back an SRI_for_SM
ack with the address of the VMSC to the SMS-GMSCA.
6\. The SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS
message.
7\. VMSCB further delivers the message to MSB.
## B.4.3 Delivery of SMS to a Ported Number -- Indirect Routeing
Figure B.4.3 shows the MNP-SRF operation for delivering an SMS message to a
ported number where the interrogating network does not support direct
routeing.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRF(s). If the MNP-SRF(s) use(s) a higher-level relay
function (e.g. TC-relay), then the response message will go via the MNP-SRF as
shown in B.4.2. For further details of the signalling relay functions, the
reader is referred to [7].
Figure B.4.3: SRF operation for delivering an SMS message to a ported number
where the interrogating network does not support direct routeing
1\. The SMSC forwards a SM to the SMS-GMSC via a proprietary interface.
2\. The SMS-GMSC generates a routeing enquiry for SM delivery. The MAP
SRI_for_SM message is routed to the number range holder network's MNP-SRF.
3\. When MNP-SRFB' receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported using information which may be retrieved from an NP
database. As the message is non-call related, the MNP-SRF function then
populates the CdPA with either a routeing number or a concatenation of a
routeing number and MSISDN. After modifying the CdPA, the message is routed to
MNP-SRFB in the subscription network.
4\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported into the network using information which may be
retrieved from an NP database. The MNP-SRF function then populates the CdPA
with an HLRB address. After modifying the CdPA, the message is routed to HLRB.
5\. HLRB responds to the routeing enquiry by sending back an SRI_for_SM ack
with the address of the VMSC.
6\. The SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS
message.
7\. VMSCB further delivers the message to MSB.
## B.4.4 Delivery of SMS to a Ported Number -- Direct Routeing
Figure B.4.4 shows the MNP-SRF operation for delivering an SMS message to a
ported number where the interrogating network supports direct routeing.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function
(e.g. TC-relay), then the response message will go via the MNP-SRF as shown in
B.4.2. For further details of the signalling relay functions, the reader is
referred to [7].
{width="6.634027777777778in" height="3.3555555555555556in"}
Figure B.4.4: SRF operation for delivering an SMS message to a ported number
where the interrogating network supports direct routeing
1\. The SMSC forwards a SM to the SMS-GMSC via a proprietary interface.
2\. The SMS-GMSC generates a routeing enquiry for SM delivery. The MAP
SRI_for_SM message is routed to the network's MNP-SRF.
3\. When MNP-SRFA receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported using information which may be retrieved from an NP
database. As the message is non-call related, the MNP-SRF function then
populates the CdPA with either a routeing number or a concatenation of a
routeing number and MSISDN. After modifying the CdPA, the message is routed to
MNP-SRFB in the subscription network.
4\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported into the network using information which may be
retrieved from an NP database. The MNP-SRF function then populates the CdPA
with an HLRB address. After modifying the CdPA, the message is routed to HLRB.
5\. HLRB responds to the routeing enquiry by sending back an SRI_for_SM ack
with the address of the VMSC.
6\. The SMS-GMSC can now deliver the message to the VMSCB using a Forward_SMS
message.
7\. VMSCB further delivers the message to MSB.
## B.4.5 International SOR for a Non-ported Number
Figure B.4.5 shows the MNP-SRF operation for optimally routeing an
international call to a non-ported number.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRF. If the MNP-SRF uses a higher-level relay function
(e.g. TC-relay), then the response message will go via the MNP-SRF as shown in
B.4.2. For further details of the signalling relay functions, the reader is
referred to [7].
Figure B.4.5: SRF operation for optimally routeing an international call to a
non-ported number
1\. MSA originates a call to MSISDN.
2\. VMSCA routes the call to the originating network's GMSCA.
3\. When GMSCA receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI with SOR parameter set to the number range holder network
of the dialled MSISDN. Within the number range holder network, the message is
routed to the network's MNP-SRF.
4\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being non-ported using information which may be retrieved from an NP
database. The MNP-SRF function then populates the CdPA with an HLRB address.
After modifying the CdPA, the message is routed to HLRB.
5\. When HLRB receives the SRI, it responds to the GMSCA by sending back an
SRI ack with a MSRN.
6\. GMSCA uses the MSRN to route the call to VMSCB.
7\. VMSCB further establishes a traffic channel to MSB.
## B.4.6 SOR for a Ported Number -- Indirect Routeing
Figure B.4.6 shows the MNP-SRF operation for optimally routeing a call (using
SOR) to a ported number where the interrogating network does not support
direct routeing.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function
(e.g. TC-relay), then the response message will go via the MNP-SRF as shown in
B.4.2. For further details of the signalling relay functions, the reader is
referred to [7].
Figure B.4.6: MNP-SRF operation for optimally routeing a call (using SOR) to a
ported number where the interrogating network does not support direct routeing
1\. MSA originates a call to MSISDN.
2\. VMSCA routes the call to the network's GMSCA.
3\. When GMSCA receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI with SOR parameter set to the number range holder network
of the dialled MSISDN. Within the number range holder network, the message is
routed to the network's MNP-SRF.
4\. When MNP-SRFB' receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported using information which may be retrieved from an NP
database. As the message is non-call related, the MNP-SRF function then
populates the CdPA with either a routeing number or a concatenation of a
routeing number and MSISDN. After modifying the CdPA, the message is routed to
MNP-SRFB in the subscription network.
5\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported into the network using information which may be
retrieved from an NP database. The MNP-SRF function then populates the CdPA
with an HLRB address. After modifying the CdPA, the message is routed to HLRB.
6\. When HLRB receives the SRI, it responds to the GMSCA by sending back an
SRI ack with a MSRN.
7\. GMSCA uses the MSRN to route the call to VMSCB.
8\. VMSCB further establishes a traffic channel to MSB.
## B.4.7 Any Time Interrogation for a Ported Number -- Indirect Routeing
Figure B.4.7 shows the MNP-SRF operation for routeing an
Any_Time_Interrogation message for a ported number where the interrogating
network does not support direct routeing.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function
(e.g. TC-relay), then the response message will go via the MNP-SRF as shown in
B.4.2. For further details of the signalling relay functions, the reader is
referred to [7].
Figure B.4.7: MNP-SRF operation for routeing an Any_Time_Interrogation message
for a ported number where the interrogating network does not support direct
routeing
1\. The gsmSCF generates an Any_Time_Interrogation (ATI) message. The message
is routed to the number range holder network's MNP-SRF.
2\. When MNP-SRFB' receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported using information which may be retrieved from an NP
database. As the message is non-call related, the MNP-SRF function then
populates the CdPA with either a routeing number or a concatenation of a
routeing number and MSISDN. After modifying the CdPA, the message is routed to
MNP-SRFB in the subscription network.
3\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported into the network using information which may be
retrieved from an NP database. The MNP-SRF function then populates the CdPA
with an HLRB address. After modifying the CdPA, the message is routed to HLRB.
4\. HLRB responds to the ATI by sending back an ATI ack with the requested
information.
## B.4.8 Any Time Interrogation for a Ported Number -- Direct Routeing
Figure B.4.8 shows the MNP-SRF operation for routeing an
Any_Time_Interrogation message for a ported number where the interrogating
network supports direct routeing.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRF. If the MNP-SRF uses a higher-level relay function
(e.g. TC-relay), then the response message will go via the MNP-SRF as shown in
B.4.2. For further details of the signalling relay functions, the reader is
referred to [7].
{width="3.063888888888889in" height="2.986111111111111in"}
Figure B.4.8: MNP-SRF operation for routeing an Any_Time_Interrogation message
for a ported number where the interrogating network supports direct routeing
1\. The gsmSCF generates an Any_Time_Interrogation (ATI) message. The message
is routed to the network's MNP-SRF.
2\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported into the network using information which may be
retrieved from an NP database. The MNP-SRF function then populates the CdPA
with an HLRB address. After modifying the CdPA, the message is routed to HLRB.
3\. HLRB responds to the ATI by sending back an ATI ack with the requested
information.
## B.4.9 CCBS where the Busy Subscriber is a Ported Subscriber ‑ Direct
Routeing
Figure B.4.9 shows the MNP-SRF operation for routeing a CCBS Request for a
ported number where the interrogating network supports direct routeing.
The message flows for this scenario are based on the use of an SCCP-relay
function in the MNP-SRFs. If the MNP-SRFs use a higher-level relay function
(e.g. TC-relay), then the response message will go via the MNP-SRF as shown in
B.4.2. For further details of the signalling relay functions, the reader is
referred to [7].
Figure B.4.9: MNP-SRF operation for routeing a CCBS Request for a ported
number where the interrogating network supports direct routeing
1\. The VMSCA receives a ISUP Release message with cause value 'subscriber
busy' from VMSCB.
2\. VLRA/VMSCA sends a Register_CC_Entry to HLRA using the HLRA address as
CdPA on SCCP.
3\. The HLRA sends a CCBS Request message to the networks MNP-SRFA.
4\. When MNP-SRFA receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported using information which may be retrieved from an NP
database. As the message is non-call related, the MNP-SRF function then
populates the CdPA with either a routeing number or a concatenation of a
routeing number and MSISDN. After modifying the CdPA, the message is routed to
MNP-SRFB in the subscription network.
5\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies the
MSISDN as being ported into the network using information which may be
retrieved from an NP database. The MNP-SRF function then populates the CdPA
with an HLRB address. After modifying the CdPA, the message is routed to HLRB.
6\. HLRB can now respond to HLRA by sending back a CCBS ack message.
## B.4.10 Calling Name Presentation Flows -- MNP-SRF acts as SCCP Relay
Figure B.4.10 shows the MNP-SRF operation for delivering an CNAP message to an
ANSI Calling Name Database.
Figure B.4.10: SRF operation for delivering an CNAP message to the CNDB
1\. An incoming call ( an Initial Address message with Generic Name parameter
set to "presentation allowed" is received at a MSC. The MSC inteerogates the
VLR to determine if the called party is subscribed to the CNAP service. The
VLR Response indicates that the called party is subscribed to CNAP;
2\. The MSC generates a TCAP message "Query With Permission". The Query With
Permission message is routed to the network's MNP-SRF;
3\. When MNP-SRFB receives the message, MNP-SRF operation is triggered. The
MNP-SRF functionality analyses the MSISDN in the CdPA and identifies which
CNDB the MSISDN is populated using information which may be retrieved from an
NP database. The MNP-SRF function then populates the CdPA with an CNDB
address. After modifying the CdPA, the message is routed to CNDB;
4\. CNDB responds to the routeing enquiry by sending back a Query With
Permission ack with the address of the MSC. The MSC can now deliver the
Calling Name to the terminating subscriber .
###### ## Annex C (normative): MNP Signalling Relay Function - Call Related
Signalling
# C.1 Handling of Call Related Signalling
The MAP messages affected by MNP are the MAP_SEND_ROUTING_INFORMATION (SRI)
message without OR parameter set sent to the HLR and the
MAP_ANY_TIME_INTERROGATION (ATI) message with parameter MNP-requestedInfo
present terminated in the MNP-SRF.
In a PLMN supporting MNP with direct routeing using signalling relay, all
incoming calls and calls originated in the network for which the called party
number is within the ranges owned by any network in the portability domain,
the gateway MSCs will send an SRI such that it will be handled by the MNP-SRF
in that network.
In a PLMN supporting MNP with direct routeing, where the called party number
is within the ranges owned by any network in the portability domain, the INE
sends an MNP Information request (ATI) such that it will be handled by the
MNP-SRF in the network.
In a PLMN supporting MNP with indirect routeing using signalling relay, all
incoming calls and calls originating in the network, for which the called
party number is within the range owned by the network, the gateway MSCs will
send SRI such that it will be handled by the MNP-SRF in that network.
In a PLMN supporting MNP with indirect routeing, the INE sends an MNP
Information Request (ATI) such that it will be handled by the MNP-SRF in the
Number Range Holder Network.
The MNP-SRF obtains routeing information from the NP database to identify the
subscription network associated with a particular national MSISDN. The
interface between the MNP-SRF and the NP database is considered implementation
dependent and is not detailed further.
From the perspective of the PLMN in which the MNP-SRF resides, the CdPA
represents one of:
1\. An own number ported out.
2\. An own number not ported out.
3\. A foreign number ported in.
4\. A foreign number ported to a foreign network.
5\. A foreign number not known to be ported.
Cases 4 and 5 are applicable only for direct routeing.
For SRI:
In case 1, the MNP-SRF may perform one of the following depending on
agreements within the number portability domain.
a. An SRI response is sent containing the necessary routeing information to
route the call to the subscription network. This is performed by an internal
MAP Application Termination Function (MATF) known as the Number Portability
Location Register (NPLR).
b. If indirect routeing of calls with reference to the subscription network is
used, the message is relayed to the MNP-SRF in the subscription network, whose
NPLR provides the necessary routeing information in an SRI response. The use
of an NPLR in the subscription network can only be by agreement within the
number portability domain.
In cases 2 and 3, the MNP-SRF relays the message to the HLR. For further
details of the signalling relay function, the reader is referred to [7].
In case 4, an SRI response is sent, containing the necessary routeing
information to route the call to the subscription network.
In case 5, an SRI response is sent, containing the necessary routeing
information to route the call to the number range holder network.
For ATI:
In all cases the MNP information request (ATI) is sent to the
MNP_SRF_MATF_Info_Request procedure/ MAP Application Termination Function
(MATF) for handling. A response is sent to the INE containing MNP information
or an error is returned.
# C.2 Functional Requirements of Network Entities
## C.2.1 Procedure MNP_SRF_MATF_Call_Related
Figure C.2.2 shows the procedure MNP_SRF_MATF_Call_Related. This procedure
handles call-related signalling messages. It is called from the process
MNP_SRF (see clause 4.3).
The check "message has been relayed" identifies all call related signalling
messages which are relayed from the number range holder network towards the
subscription network in the case of Indirect Routeing with reference to
subscription network implementation. These messages only refer to numbers
ported into the network.
The check "own number not ported out" identifies all mobile numbers from
number ranges allocated to the network the MNP-SRF/MATF is located in and
which are not ported to other networks. In this case the call related message
is relayed to the HLR in the network.
The check "foreign number ported in" identifies all mobile numbers from the
number ranges not allocated to the network the MNP-SRF/MATF is located in and
which are served by the network the MNP-SRF/MATF is located in. In this case
the call related message is relayed to the HLR in the network.
The check "foreign number not known to be ported" identifies all mobile
numbers from the number ranges not allocated to the network the MNP-SRF/MATF
is located in and which are also not served by the network the MNP-SRF/MATF is
located in. In this case the call is sent to the SRF_MATF procedure for
handling.
The check "foreign number ported to foreign network" identifies all mobile
numbers from the number ranges not allocated to the network the MNP-SRF/MATF
is located in and which are not served by the network the MNP-SRF is located
in and not served by the network the number range is allocated to, i.e. the
number is ported between two other networks. In this case the call related
message is sent to the SRF_MATF procedure for handling.
The remaining cases "own number ported out" are mobile numbers allocated to
the network the MNP-SRF/MATF is located in and which are served by other
networks, i.e. the number is ported out to another network. In this case the
call is relayed to the MATF in the subscription network if this option is the
one used by the operator, or sent to the SRF_MATF procedure for handling if
not.
## C.2.2 Process SRI_NPLR
Figure C.2.2.2 shows the process SRI_NPLR.
The check "unknown subscriber" identifies a subscriber without any associated
available information.
If the GMSC is in the database own network then a routeing number is provided
to route to the number range holder network.
If the GMSC is not in the database own network then the enquiry has been
routed from the number range holder network, so the call should fail.
The database query uses the MSISDN received at the application level in the
SRI, rather then the CdPA of the SCCP level.
If an error must be set as a result of the check "terminate", the user error
"unknown subscriber" shall be used. If version 3 or higher of the MAP protocol
is in use, then the diagnostic "NPDB mismatch" may be used.
The check "HPLMN MSISDN Range" identifies if the MSISDN received in the SRI
exists in a MSISDN Range owned by the HPLMN. This is a North American Network
implementation option and allows a MAP Error "Unknown Subscriber" to be sent
to the GMSC instead of the MSISDN.
The check "HPLMN RN Range" identifies if the Routeing Number assigned to the
MSISDN within the SRI_NPLR is assigned to the HPLMN. This is a North American
Network implementation option and allows a MAP Error "Unknown Subscriber" to
be sent to the GMSC instead of the RN+MSISDN.
## C.2.3 Procedure MNP_SRF_MATF_Info_Request
Figure C.2.3.1 shows the procedure MNP_SRF_MATF_Info_Request. This procedure
handles an information request signalling message to provide MNP information
for a subscriber. It is called from the process MNP_SRF (see clause 4.3).
## C.2.4 Process ATI_NPLR
Figure C.2.3.2 shows the process ATI_NPLR.
The database query uses the MSISDN received at the application level in the
ATI, rather than the CdPA of the SCCP level.
Figure C.2.2: Procedure MNP_SRF_MATF_Call_Related
Figure C.2.2.1: Procedure MATF
Figure C.2.2.2: Process SRI_NPLR
Figure C.2.3.1: Procedure MATF_Info_Request
Figure C.2.3.2: Process ATI_NPLR
# C.3 Call Scenarios
The notation TT=SRI in diagrams in this section assumes that SRI=CRMNP for
ETSI and SRI = Translation Type 14 for ANSI. The use of other translation
types is for further study. The message flows for the following scenarios are
based on the use of an SCCP relay function in MNP-SRF(s). The message flows
for the higher level relay function (e.g. TC relay) in MNP-SRF are not covered
here, but the principle can be found in B.4.2. For further details of the
signalling relay function, the reader is referred to [7].
## C.3.1 Call to a Non-Ported Number or Number Ported into the Network
Figure C.3.1 shows the signalling involved for a call to a non-ported number
or number ported into the network (see 3G TS 23.018 [3]).
Figure C.3.1: Call to a non-ported number
1\. From an Originating Exchange a call is set up to MSISDN. The call is
routed to the subscription network being the number range holder network, if
the number is non-ported.
2\. When GMSCB receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.
3\. When the MNP_SRF/MATF receives the message, the MNP_SRF/MATF analyses the
MSISDN in the CdPA and identifies the MSISDN as being non-ported. The
MNP_SRF/MATF function then replaces the CdPA by an HLRB address. After
modifying the CdPA, the message is routed to HLRB.
4\. When HLRB receives the SRI, it responds to the GMSCB by sending an SRI ack
with an MSRN that identifies the MSB in the VMSCB.
5\. GMSCB uses the MSRN to route the call to VMSCB.
## C.3.2 Call to a Ported Number -- Originating Network = Subscription Network
-- Direct Routeing
Figure C.3.2 shows the signalling involved for a call to a ported number via
direct routeing where the call is originated in the subscription network.
{width="5.147222222222222in" height="3.767361111111111in"}
Figure C.3.2: Call to a ported number via direct routeing where the call is
originated in the subscription network
1\. MSA originates a call to MSISDN.
2\. VMSCA routes the call to the network's GMSCA.
3\. When GMSCA receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.
4\. When the MNP_SRF/MATF receives the message, it analyses the MSISDN in the
CdPA and identifies the MSISDN as being ported into the network. The
MNP_SRF/MATF function then replaces the CdPA by an HLRA address. After
modifying the CdPA, the message is routed to HLRA.
5\. When HLRA receives the SRI, it responds to the GMSCA by sending an SRI ack
with an MSRN that identifies the MSB in the VMSCB.
6\. GMSCA uses the MSRN to route the call to VMSCB.
## C.3.3 Mobile Originated Call to a Ported or not known to be Ported Number
-- Originating Network **≠** Subscription Network-- Direct Routeing
Figure C.3.3 shows the signalling involved for a national mobile originated
call to a number not Subscribed in the originating network via direct
routeing. The scenario describes signalling in the originating network using
direct routeing in the cases when an own number is ported out, a foreign
number is not known to be ported or a foreign number is ported to other
foreign network.
{width="4.561111111111111in" height="3.536111111111111in"}
Figure C.3.3: National mobile originated call to a ported number via direct
routeing
1\. MSA originates a call to MSISDN.
2\. VMSCA routes the call to the network's GMSCA.
3\. When GMSCA receives the ISUP IAM, it requests routeing information by
submitting a MAP SRI to the MNP_SRF/MATF. The TT on SCCP may be set to 'SRI'.
4\. When the MNP_SRF/MATF receives the message, it analyses the MSISDN in the
CdPA and identifies the MSISDN as not known to be ported or being ported to
another network. As the message is a SRI message, the MNP_SRF/MATF responds to
the GMSCA by sending an SRI ack with a RN + MSISDN; For the case the number is
not known to be ported the routeing number may be omitted.
5\. GMSCA uses the (RN +) MSISDN to route the call to GMSCB in the
subscription network. Depending on the interconnect agreement, the RN will be
added in the IAM or not.
## C.3.4 Call to a Ported Number -- Indirect Routeing
Figure C.3.4 shows the signalling involved for a call to a ported number via
indirect routeing.
Figure C.3.4: Call to a ported number via indirect routeing
1\. From an Originating Exchange a call is set up to MSISDN. The call is
routed to the number range holder network.
2\. When GMSCA in the number range holder network receives the ISUP IAM, it
requests routeing information by submitting a MAP SRI to MNP_SRF/MATF. The TT
on SCCP may be set to 'SRI'.
3\. When the MNP_SRF/MATF receives the message, it analyses the MSISDN in the
CdPA and identifies the MSISDN as being ported to another network. As the
message is an SRI message, the MNP_SRF/MATF responds to the GMSCA by sending
an SRI ack with a RN + MSISDN.
4\. GMSCA uses the RN + MSISDN to route the call to GMSCB in the subscription
network. Depending on the interconnect agreement, the RN will be added in the
IAM or not.
## C.3.5 Call to a Ported Number -- Indirect Routeing with Reference to
Subscription Network
Figure C.3.5 shows the signalling involved for a call to a ported number where
indirect routeing with reference to the subscription network is used.
Figure C.3.5: National or international originated call to a ported number
where indirect routeing with reference to the subscription network is used
1\. From an Originating Exchange a call is set up to MSISDN. The call is
routed to the number range holder network.
2\. When GMSCA in the number range holder network receives the ISUP IAM, it
requests routeing information by submitting a MAP SRI to the MNP_SRF/MATF. The
TT on SCCP may be set to 'SRI'.
3\. When MNP_SRF/MATF receives the message, MNP_SRF/MATF operation is
triggered. The MNP_SRF/MATF functionality analyses the MSISDN in the CdPA and
identifies the MSISDN as being ported to another network. As the message is a
SRI message, the MNP_SRF/MATF function relays the message to the subscription
network by adding a routeing number to the CdPA which information may be
retrieved from a database. After modifying the CdPA, the message is routed to
the subscription network.
4\. When MNP_SRF/MATF in the subscription network receives the SRI, it
responds to the GMSCA in the number range holder network by sending a SRI ack
with a RN + MSISDN.
5\. GMSCA uses the (RN +) MSISDN to route the call to GMSCB in the
subscription network; Depending on the interconnect agreement, the RN will be
added in the IAM or not.
6\. When GMSCB in the subscription network receives the ISUP IAM, it requests
routeing information by submitting a MAP SRI to MNP_SRF/MATF. The TT on SCCP
may be set to 'SRI'.
7\. When MNP_SRF/MATF receives the message, MNP_SRF/MATF operation is
triggered. The MNP_SRF/MATF functionality analyses the MSISDN in the CdPA and
identifies the MSISDN as being ported into the network. The MNP_SRF/MATF
function then replaces the CdPA by an HLRB address which information may be
retrieved from a database. After modifying the CdPA, the message is routed to
HLRB.
8\. When HLRB receives the SRI, it responds to the GMSCB by sending an SRI ack
with an MSRN that identifies the MSB in the VMSCB.
9\. GMSCB uses the MSRN to route the call to VMSCB.
NOTE: The MNP_SRF/MATF in this scenario has only information about all ported
numbers to one subscription network, except those for which subscription
information is held in the subscription networks HLR. In this scenario the
routeing depends always on the number range holder and the subscription
network.
## C.3.6 MNP Info Query - Direct Routeing
Figure C.3.6: MNP-SRF operation for providing MNP Information where direct
routeing applies
In a PLMN using a MNP-SRF based MNP solution supporting direct routeing, the
INE always sends the MNP information request, containing the CdPA, to the MNP-
SRF in that network.
The INE may query the MNP information for the called party number or the
calling party number.
The INE requesting MNP information may be a gsmSCF for prepaid services (see
3GPP TS 23.078 [18]).
In order to provide enough information for a CAMEL SCP to charge correctly for
CAMEL Pre-Paid Calls and SMS to national MSISDNs originated in the HPLMN,
operators should ensure that the NPDB contains, at least, MNP information for
'own numbers ported out' and 'foreign numbers ported in'.
## C.3.7 MNP Info Query - Indirect Routeing
Figure C.3.7: MNP-SRF operation for Providing MNP information where indirect
routeing applies
The Interrogating Network Entity (INE) submits a MNP Information request
message to the MNP-SRFB, which triggers MNP-SRF operation. The MNP-SRF
functionality analyses the MSISDN in the application level and queries an MNP
database to get the MNP information. The INE may query the MNP information for
the called party number or the calling party number.
The INE requesting MNP information may be a gsmSCF for prepaid services (see
3GPP TS 23.078 [18]).
# C.4 Information Flows
Figure C.4.1 shows the information flow for a successful delivery of a call to
a non-ported number or number ported into the network. The figure is related
to figure C.3.1.
Figure C.4.1: Successful delivery of a call to a non-ported subscriber or
number ported into the network
Figure C.4.2 shows the signalling involved for a call to a ported number via
direct routeing where the call is originated in the subscription network. The
figure is related to figure C.3.2.
{width="6.284027777777778in" height="4.388194444444444in"}
Figure C.4.2: Successful delivery of a call to a ported number via direct
routeing where the call is originated in the subscription network
Figure C.4.3 shows the signalling involved for a national mobile originated
call to a ported number via direct routeing. The figure is related to figure
C.3.3.
{width="7.302083333333333in" height="7.229166666666667in"}
Figure C.4.3: Successful delivery of a national mobile originated call to a
ported number via direct routeing
Figure C.4.4 shows the signalling involved for a national mobile originated
call to a not known to be ported number via direct routeing. The figure is
related to figure C.3.3.
Figure C.4.4: Successful delivery of a national mobile originated call to a
not known to be ported number via direct routeing
Figure C.4.5 shows the signalling involved for a call to a ported number via
indirect routeing. The figure is related to figure C.3.4.
Figure C.4.5: Successful delivery of a call to a ported number via indirect
routeing
Figure C.4.6 shows the signalling involved for a call to a ported number where
indirect routeing with reference to the subscription network is used. The
figure is related to figure C.3.5.
Figure C.4.6: Successful delivery for a call to a ported number where indirect
routeing with reference to the subscription network is used
# C.5 Contents of the messages
This clause contains detailed description of the messages shown in this part B
of the specification.
The contents of the messages used on the gsmSCF -- MNP-SRF interface are
specified in 3G TS 23.078 [19]. When the message is sent from the NPLR to the
gsmSCF, the MNP specific information are defined as in clause C.5.2. The
gsmSCF may transit the information received from NPLR to the gateway MSC with
the CAP Connect message in order to avoid a subsequent SRI message.
## C.5.1 Send Routeing Info
The contents of this message are specified in 3G TS 23.018 [3].
## C.5.2 Send Routeing Info ack
The contents of this message are specified in 3G TS 23.018 [3]. In the case
that the message is sent from the NPLR to the GMSC, the following MNP specific
information is defined:
* * *
Information element name Required Description Imsi M The IMSI returned by an
NPLR is a generic IMSI, i.e. it is not tied necessarily to the Subscriber. MCC
and MNC values in this IMSI shall point to the Subscription Network of the B
Subscriber Msrn C When returned from the NPLR, this parameter contains a
Routeing Number that points to Subscription Network. If concatenate addressing
is used, it also contains the MSISDN in addition to the Routeing Number.In the
case of a number which is not known to be ported, the Routeing Number may be
omitted as an operator option. If the routeing number is omitted, this
parameter contains only the MSISDN. Msisdn C MSISDN of the B subscriber. This
information element shall be present if MSRN contains the routeing number to
reach the subscription network for B subscriber and the MSISDN is not
contained in the MSRN information element. MNP Indicator U Indicates the
number portability status of the subscriber.
* * *
# C.6 Handling of MAP to ISUP mapping (informative)
Different configurations can be possible within a portability domain depending
on the versions of MAP and ISUP protocols being used. The following sections
describe possible interworking scenarios.
## C.6.1 ETSI Mapping direction: ISUP to MAP
The GMSC always constructs the Send Routeing Info message using the MSISDN. If
the incoming IAM corresponds to a ported number the GMSC shall retrieve the
MSISDN from the corresponding parameter in the IAM.
## C.6.2 ETSI Mapping direction: MAP to ISUP
In MAP SRIack messages from NPLR, MAP versions 1 and 2 only support
concatenate addressing for MNP. If MSISDN parameter is present in the SRIack,
this means that separate addressing is used in MAP; this is only possible if
MAP version 3 is used. MAP version 3 can also support concatenate addressing.
In all cases, when a Routeing Number is returned, it is included in the MSRN
parameter of the SRIack.
Regardless of how MAP is established, the possible mappings of the parameters
in ISUP IAM message is one of these 4 options (see also [6]):
1\. CdPN parameter includes only the MSISDN.
2\. CdPN parameter includes both RN and MSISDN concatenated.
3\. CdPN parameter includes the MSISDN and NRN parameter includes the Routeing
Number.
4\. CdPN parameter includes the Routeing Number and CDN parameter includes the
MSISDN.
In all cases, the method to transport the routeing number in the IAM depends
on the interfaces agreed by the operators in the portability domain.
## C.6.3 ANSI Mapping direction: ISUP to MAP
The GMSC always constructs the Send Routeing Info message using the MSISDN. If
the incoming IAM corresponds to a ported number the GMSC shall retrieve the
MSISDN from the corresponding parameter in the IAM.
The IAM message is specified for ANSI ISUP implementation in [8] and [9].
## C.6.4 ANSI Mapping direction: MAP to ISUP
In MAP SRIack messages from NPLR, MAP versions 1 and 2 only support
concatenate addressing for MNP. If MSISDN parameter is present in the SRI Ack,
this means that separate addressing is used in MAP; this is only possible if
MAP version 3 is used. MAP version 3 can also support concatenate addressing.
In all cases, when a Routeing Number is returned, it is included in the MSRN
parameter of the SRI Ack.
Regardless of how MAP is established, the possible mappings of the parameters
in ISUP IAM message is one of these 4 options (see also [8] and [9]):
* * *
**MAP Parameters** **SRI Ack** **ISUP Parameters** **IAM** IMSI Subscriber
IMSI CdPN MSRN MSRN MSRN MAPS TO GAP N/A MSISDN Not Present FCI Bit M
Indicator 1 MNP Indicator Not Present
* * *
* * *
**MAP Parameters** **SRI Ack** **ISUP Parameters** **IAM** IMSI Default IMSI
CdPN Dialled DN MSRN Dialled DN MAPS TO GAP N/A MSISDN Not Present FCI Bit M
Indicator 1 MNP Indicator NotKnownToBePorted
* * *
* * *
**MAP Parameters** **SRI Ack** **ISUP Parameters** **IAM**
IMSI Default IMSI CdPN RN
MSRN RN MAPS TO GAP Dialled DN
MSISDN Dialled DN FCI Bit M Indicator 1
MNP Indicator OwnNumber\  
PortedOut
* * *
* * *
**MAP Parameters** **SRI Ack** **ISUP Parameters** **IAM**
IMSI Default IMSI CdPN RN
MSRN RN MAPS TO GAP Dialled DN
MSISDN Dialled DN FCI Bit M Indicator 1
MNP Indicator Foreign Number PortedToForeign\  
Network
* * *
In all cases, the method to transport the routing number in the IAM depends on
the interfaces agreed by the operators in the portability domain.
###### ### Annex D: Void
#
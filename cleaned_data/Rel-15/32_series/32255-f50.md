# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope.
The present document is part of a series of documents that specify charging
functionality and charging management in 3GPP networks. The 3GPP core network
charging architecture and principles are specified in TS 32.240 [1], which
provides an umbrella for other charging management TSs that specify:
\- the content of the CDRs per domain / subsystem / service (offline
charging);
\- the content of real-time charging messages per domain / subsystem / service
(online charging);
\- the functionality of online and offline charging for those domains /
subsystems / services;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in TS 32.240 [1].
The present document specifies the converged offline and online charging
description for the 5G Data Connectivity domain based on the functional stage
2 description in TS 23.501 [200], TS 23.502 [201] and TS 23.503 [202].
This charging description includes the converged offline and online charging
architecture and scenarios specific to the 5G Data Connectivity domain, as
well as the mapping of the common 3GPP charging architecture specified in TS
32.240 [1] onto the 5G Data Connectivity domain.
It further specifies the structure and content of the CDRs for offline
charging, and the charging events for converged online and offline charging.
The present document is related to other 3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [1].
\- The parameters, abstract syntax and encoding rules for the CDRs are
specified in TS 32.298 [51].
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in TS 32.295 [54].
\- The file based mechanism used to transfer the CDRs from the network to the
operator\'s billing domain (e.g. the billing system or a mediation device) is
specified in TS 32.297 [52].
\- The services, operations and procedures of charging, using Service Based
Interface are specified in TS 32.290 [57].
\- The charging service of 5G system is specified in TS 32.291 [58].
All references, abbreviations, definitions, descriptions, principles and
requirements, used in the present document, that are common across 3GPP TSs,
are defined in TR 21.905 [100]. Those that are common across charging
management in 3GPP networks/domains, services or subsystems are provided in
the umbrella TS 32.240 [1] and are copied into clause 3 of the present
document for ease of reading. Finally, those items that are specific to the
present document are defined exclusively in the present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] - [50] Void.
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] Void.
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55-56] Void.
[57] 3GPP TS 32.290: \"Telecommunication management; Charging management; 5G
system; Services, operations and procedures of charging using Service Based
Interface (SBI)\".
[58] 3GPP TS 32.291: \" Telecommunication management; Charging management; 5G
system; Charging service, stage 3\".
[59] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets\".
[103] - [199] Void
[200] 3GPP TS 23.501:\"System Architecture for the 5G System\".
[201] 3GPP TS 23.502:\"Procedures for the 5G System\".
[202] 3GPP TS 23.503:\"Policy and Charging Control Framework for the 5G
System; Stage 2\".
[203] - [299] Void
[300] - [399] Void.
[400] - [499] Void.
[500] - [599] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [100].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Bd Reference point for the CDR file transfer from the 5G Data connectivity CGF
to the BD.
Ga Reference point for CDR transfer between a CDF and the CGF.
Nchf Service based interface exhibited by CHF.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
5GC 5G Core Network
5GS 5G System
ABMF Account Balance Management Function
AF Application Function
AMF Access and Mobility Management Function
AUSF Authentication Server Function
BD Billing Domain
CCS Converged Charging System
CDF Charging Data Function
CGF Charging Gateway Function
CHF Charging Function
CP Control Plane
CTF Charging Trigger Function
DNN Data Network Name
FBC Flow Based Charging
GPSI Generic Public Subscription Identifier
GUAMI Globally Unique AMF Identifier
N3IWF Non-3GPP InterWorking Function
NE Network Element
NEF Network Exposure Function
NF Network Function
NRF Network Repository Function
NSSF Network Slice Selection Function
OCF Online Charging Function
OCS Online Charging System
PCC Policy and Charging Control
PCF Policy Control Function
PEI Permanent Equipment Identifier
QBC Qos flow Based Charging
QFI QoS Flow Identifier
SMF Session Management Function
SSC Session and Service Continuity
SUPI Subscription Permanent Identifier
UDM Unified Data Management
UDR Unified Data Repository
UPF User Plane Function
# 4 Architecture considerations
## 4.1 High-level 5G System architecture
### 4.1.1 Non-roaming reference architecture
Figure 4.1.1.1 shows the 5G System high level architecture as defined in TS
23.501 [200] for 5G data connectivity, in the service-based representation for
Control Plane (CP) Network Functions.
{width="4.260416666666667in" height="1.9083333333333334in"}
**Figure 4.1.1.1: 5G System architecture**
### 4.1.2 Roaming Home Routed reference architecture
Figure 4.1.2.1 shows the 5G System high level Roaming Home Routed architecture
as defined in TS 23.501 [200] for 5G data connectivity, in the service-based
representation for Control Plane (CP) Network Functions.
Figure 4.1.2.1: Roaming 5G System architecture - home routed scenario in
service-based interface representation
### 4.1.3 Interworking with EPC architecture
Figure 4.1.3.1 shows the non-roaming architecture for interworking between 5GS
and EPC/E-UTRAN as defined in TS 23.501 [200] for 5G data connectivity.
Figure 4.1.3.1: Non-roaming architecture for interworking between 5GS and
EPC/E-UTRAN
### 4.1.4 Architecture reference for Non-3GPP Accesses
Figure 4.1.4.1 shows the non-roaming architecture for Non-3GPP Accesses as
defined in TS 23.501 [200] for 5G data connectivity.
Figure 4.1.4.1: Non-roaming architecture for Non-3GPP Accesses
This reference architecture supports service based interfaces for AMF, SMF and
other NFs not represented in the figure.
## 4.2 5G data connectivity domain converged charging architecture
The SMF embedding the CTF, generates _charging events towards the CHF_ for PDU
connectivity converged online and offline charging.
_As described in TS 32.240 [1], the CTF generates charging events towards to
the CHF for converged online and offline charging processing. The CDRs
generation is performed by the CHF acting as a CDF, which transfers them to
the CGF.\ Finally, the CGF creates CDR files and forwards them to the BD._
If the CGF is external, the CHF acting as a CDF, forwards the CDRs to the CGF
across the Ga interface.\ If the CGF is integrated, there is only one internal
interface between the CHF and the CGF. In this case, the relationship between
CHF and CGF is 1:1. An integrated CGF may support the Ga interface from other
CDFs.
When an external CGF is used, this CGF may also be used by other, i.e.
non-5GCS, network elements, according to network design and operator decision.
It should be noted that the CGF may also be an integrated component of the BD
-- in this case, the Bd interface does not exist and is replaced by a
proprietary solution internal to the BD.
Figure 4.2.1 depicts the architectural options for converged charging.
**Figure 4.2.1: 5G data connectivity converged charging architecture**
Nchf is described in clauses 5.2.1 and 5.2.2, Ga in clause 5.2.4 and Bd in
clause 5.2.5.
# 5 5G data connectivity charging principles and scenarios
## 5.1 5G data connectivity charging principles
### 5.1.1 General
The charging functions specified for the 5G data connectivity charging:
\- PDU session in SMF, refer to TS 23.501 [200];
\- service data flows, within PDU session, refer to TS 23.503 [202].
\- QoS flows within PDU session refer to TS 23.501 [200] and TS 23.503 [202].
### 5.1.2 Requirements
The following are high-level charging requirements specific to the packet
domain, derived from the requirements in TS 22.115 [101], TS 22.261 [102], TS
23.501 [200], TS 23.502 [201] and TS 23.503 [202].
\- The SMF shall support converged online and offline charging.
\- The SMF shall support PDU session charging using service based interface.
\- The SMF shall support network slice instance charging.
\- The SMF shall collect charging information per PDU session for UEs served
under 3GPP access and non-3GPP access.
\- Every PDU session shall be assigned a unique identity number for billing
purposes per PLMN. (i.e. the Charging Id).
\- Data volumes on both the uplink and downlink directions shall be counted
separately. The data volumes shall reflect the data as delivered to and
forwarded from the user.
\- The charging mechanisms shall provide the date and time information when
the PDU session starts.
\- The SMF shall be capable of handling the Charging Characteristics. Charging
Characteristics can be specific to a subscription or subscribed DNN.
\- The SMF may be capable of identifying data volumes, elapsed time or events
for individual service data flows (flow based charging). One PCC rule
identifies one service data flow.
\- SMF shall allow reporting of the service or the detected application usage
per rating group or per combination of the rating group and service id. This
reporting level can be activated per PCC rule.
\- The quota management shall be per rating group per PDU session.
\- If there are multiple UPFs for one PDU session, the quota management may be
one for all UPFs or separate per UPF and the usage and charging information
reporting per UPF.
\- The SMF shall support charging for PDU Session types of IP, Ethernet and
Unstructured.
\- In Home Routed scenario, the SMF shall collect charging information per PDU
session and, based on Home Operator policy and agreement between Home and
Visit Operators, shall be able to collect charging information per Qos Flow
for in-bound and out-bound roamers in Home Routed scenario.
\- For interworking between 5GS and EPC, the dedicated PGW-C + SMF shall
collect charging information using the same mechanisms as the SMF.
### 5.1.3 Charging information
Charging information in the 5GC domain network is collected for each UE by the
SMFs. PDU session charging allows the SMF to collect and categorize per UE per
UPF per PDU session, charging information related to data volumes.
The SMF shall collect the following charging information for converged online
and offline charging:
\- usage of the access and core network resources: the charging information
shall describe the amount of data delivered to and forwarded from the UE;
\- usage duration: duration of PDU session is counted as the time interval
from PDU session establishment to PDU session release;
\- user: the charging information shall provide the actual UE addresses used
by the user for the PDU session;
\- data network: the charging information shall describe the data network
addresses with a level of accuracy as determined by the DNN;
\- usage of the external data networks: the charging information shall
describe the amount of data sent and received to and from the external data
network. External networks can be identified by the DNN;
\- start time: identifying the time when the PDU session was started;
\- user location: HPLMN, VPLMN, inside/outside presence reporting area, plus
optional higher-accuracy location information.
The service data flows categorization is achieved by rating group or
combination of the rating group and service id: i.e. based on the level of
reporting defined per PCC rule, counting per rating group or combination of
the rating group and service id. According to TS 23.503 [202], flow based
charging shall support different charging models per PCC rule. These charging
models may be based on volume, time and/or on number of events matching a
specific service data flow template in PCC rule.
For service data flows defined for FBC, the SMF shall collect the following
charging information:
\- the information described above for PDU session;
\- the amount of data transmitted in uplink and downlink directions
categorized by rating group or combination of the rating group and service id
when volume based charging applies;
\- the duration of service data flows is counted and categorized by rating
group or combination of the rating group and service id when time based
charging applies;
\- the number of events and corresponding time stamps categorized by rating
group or combination of the rating group and service id when event based
charging applies.
Within the PDU session the SMF shall collect the charging information for
service data flows per UPF, categorized with rating group or combination of
the rating group and service id.
The user can be identified by a Generic Public Subscription Identifier (GPSI)
and/or a 5G Subscription Permanent Identifier (SUPI).
### 5.1.4 Charging Identifier
Charging identifier is created to allow correlation of charging information.
For the SMF the charging identifier is assigned per PDU session. At each PDU
session establishment a new, i.e. assignment of a new PDU session id, PDU
session specific SMF Charging Identifier is generated at the first SMF that
processes the PDU session initiating request. This SMF Charging Identifier
shall be unique within the SMF and is then used in all subsequent messages for
that PDU session. The Charging Identifier shall be used throughout the PDU
session's lifetime once assigned. In case of inter-system changes or handovers
of PDU session, the Charging Identifier is preserved as long as the PDU
session Identifier is preserved.
### 5.1.5 PCC rules and charging
#### 5.1.5.1 PCC rules and chargeable events
PCC rules can be activated, deactivated and modified at any time during the
PDU session lifetime. The following attribute can be modified by the PCF in a
dynamic PCC rule active in the SMF: Charging key, Service identifier, Sponsor
Identifier, Application Service Provider Identifier, Measurement method and
reporting level. The QoS Flow binding mechanism employed by the SMF upon
operations on PCC rules, may result in QoS Flows establishment, modification,
or release. This is specified in TS 23.503 [202].
Activities on PCC rules are not chargeable events. However, change of charging
rule in PCC rules will lead to chargeable events \"start of service data
flow\" and when this is the last service data flow for the original PCC rule,
\"termination of service data flow\".
The charging key (i.e. Rating group) is a piece of information used to request
online charging quotas as defined in TS 23.503 [202].
#### 5.1.5.2 Specific PCC rules scenarios
The capability of SMF to support Application Based Charging is achieved with
appropriate PCC rules activation in the SMF. Such PCC Rule shall be defined
with service data flow template including an Application Identifier for the
application which needs to be detected, enforced and charged. The application
detection mechanism in SMF is defined in TS 23.503 [202].
### 5.1.6 Session and Service Continuity modes
For any scenario of SSC modes specified in TS 23.501 [200], one charging Id
shall correspond to a single PDU session ID.
As a result from such SSC mode, a new charging Id is generated by the SMF for
the new PDU session Id, and the charging session associated to the old PDU
session Id is released.
This behaviour applies to the following scenario:
\- PDU session anchor UPF relocation, in SSC mode 2;
\- PDU session anchor UPF relocation in SSC mode 3 with multiple PDU Sessions.
### 5.1.7 UE Presence in Presence Reporting Area (PRA)
During charging session lifetime , the CHF may provide the Presence Reporting
Area identifier to be activated for Core Network pre-configured Presence
Reporting Area(s) and additionally all of PRA Identifier(s) and list(s) of its
elements for UE-dedicated Presence Reporting Area(s) and provision the
\"Change of UE presence in Presence Reporting Area(s)\" re-authorization
trigger to the SMF to request the reporting of Change of UE presence in
Presence Reporting Area. After such trigger is enabled, SMF shall close the
current count, open a new count with the initial status of UE presence in the
PRA(s). In case of quota management is required, a Charging Data Response
[Update] including the initial status is sent. UE presence status in the
PRA(s) describes whether the UE is entering or leaving Presence Reporting Area
(s) and if the corresponding Presence Reporting Area(s) is set to inactive by
the serving node.
The CHF may modify the list of PRA Identifier(s) by providing the new Presence
Reporting Area(s) or by removing existing Presence Reporting Area(s) or modify
the list(s) of Presence Reporting Area elements by providing the updated
Presence Reporting Area.
The CHF may remove the re-authorization trigger of change of UE presence in
Presence Reporting Area as defined in subclause 5.2.1.2, if previously
activated.
### 5.1.8 CHF selection
The CHF selection, i.e. CHF address determination, by the SMF is done at the
PDU session establishment, this selection shall be based on the following and
with this priority order (highest to lowest):
\- PCF provided the CHF address(es) as part of the PCC rule.
\- UDM provided charging characteristics.
\- NRF based discovery.
\- SMF locally provisioned charging characteristics.
This means that if there are PCF provided CHF address(es) these shall be used,
otherwise if the UDM provides charging characteristics these shall be used. If
neither of these results in CHF address(es) the NRF can be used to discover
CHF instance(s), and as a last resource the SMF locally provisioned charging
characteristics shall be used.
### 5.1.9 Roaming
#### 5.1.9.1 General
Based on roaming agreements between the V-PLMN and the H-PLMN, in Home Routed
scenario, for each UE roaming in VPLMN:
\- The SMF in VPLMN (V-SMF) shall be able to collect charging information per
QoS Flow within a PDU session when UE is determined as an in-bound roamer, for
CDR generation in VPLMN.
\- The SMF in HPLMN (H-SMF) shall be able to collect charging information per
QoS Flow within a PDU session when UE is determined as an out-bound roamer,
for CDR generation in HPLMN.
This charging information collection mechanism is achieved under Roaming QoS
flow Based Charging (QBC) performed by each PLMN, based on a set of charging
parameters exchanged between the V-SMF and the H-SMF on a per PDU session
basis during the PDU session establishment.
The two main parameters exchanged are:
\- The Charging Id which also includes the VPLMN PLMN ID, assigned by the
V-SMF and transferred to the H-SMF in the HPLMN at PDU session establishment.
\- The \"Roaming Charging Profile\" negotiated between the VPLMN and the HPLMN
at PDU session establishment.
#### 5.1.9.2 CHF selection
In roaming Home routed scenario, the CHF selection mechanism specified in
clause 5.1.8 applies to:
\- The V-SMF for CHF selection in VPLMN\ when charging characteristics is used
it will be based on local configuration\ when NRF is used, the V-CHF can be
selected based on UE identified as in-bound roamer and the PLMN Id of the
H-PLMN;
\- The H-SMF for CHF selection in HPLMN\ when NRF is used, the H-CHF can be
selected based on UE identified as out-bound roamer and the PLMN Id of the
V-PLMN.
### 5.1.10 Data Volume Reporting for Secondary RAT usage
Volume reporting for Secondary RAT usage is an optional capability in the SMF
that provides usage reporting functionality when a Secondary RAT is used by
NG-RAN. Use of Secondary RAT refers to options supported by NG-RAN with dual
radio accesses, per NG-RAN definition in TS 23.501 [200]. This is valid for
both HPLMN and VPLMN.
The following principles are used:
\- The reporting of Secondary RAT Data Volume is controlled by the NG-RAN.
\- The uplink and downlink data volumes for the Secondary RAT are reported
(from NG-RAN to 5G Core) on a per QoS Flow basis and per time interval
(controlled by NG-RAN). The report contains Secondary RAT (e.g. E-UTRA)
resources used for transport of user data and indicated separately for uplink
and downlink per QoS Flow and per time interval. The time interval used for
the measurements reported (from NG-RAN) may be partitioned to indicate usage
that occurred before respectively after an absolute time (that occurs while
measurement for secondary RAT usage report is ongoing).
\- The reporting (performed by NG-RAN) in association with UE-related control
signaling and via standalone reporting is internally triggered by NG-RAN.
NOTE: Volumes for the secondary RAT are reported to the CHF in addition to,
and uncorrelated from volumes of reported usage, which are undifferentiated
between primary and secondary RAT. Considering both volumes would imply the
same traffic to be counted twice.
## 5.2 5G data connectivity converged online and offline charging scenarios
### 5.2.1 Basic principles
#### 5.2.1.1 General
Converged charging may be performed by the SMF interacting with CHF using Nchf
specified in TS 32.290 [57] and TS 32.291 [58]. In order to provide the data
required for the management activities outlined in TS 32.240 [1] (Credit-
Control, accounting, billing, statistics etc.), the SMF shall be able to
perform converged charging for each of the following:
\- Charging data related to PDU session;
\- Charging data related to service data flows within the PDU session.
Converged charging includes quota management and usage reporting.
The SMF shall be able to report charging events to CDF for CDR generation.
The SMF shall be able to perform convergent charging by interacting with CHF,
for charging data related to PDU sessions. The Charging Data Request and
Charging Data Response are exchanged between the SMF and the CHF, based on
SCUR scenarios specified in TS 32.290 [57]. The Charging Data Request is
issued by the SMF towards the CHF when certain conditions (chargeable events)
are met.
The quota management is always per rating group, reporting level can be either
per rating group or per combination of the rating group and service id, which
is defined per PCC rule.
Converged charging uses centralized or decentralized unit determination and
centralized rating scenarios for session based convergent charging specified
in TS 32.290 [57].
The charging information collected per PDU session includes the network slice
instance the PDU session belongs to.
The contents and purpose of each charging event that triggers interaction with
CHF, as well as the chargeable events that trigger them, are described in the
following sub-clauses.
The SMF initiates a charging session with Charging Date Request/Response
[Initial], updates the charging session with Charging Date Request/Response
[Update], and terminates the charging session with Charging Date
Request/Response [Termination].
A detailed formal description of the converged charging parameters defined in
the present document is to be found in TS 32.291 [58].
A detailed formal description of the CDR parameters defined in the present
document is to be found in TS 32.298 [51].
In order to avoid a charging session remaining inactive for a long period of
time, upon expiry of the Unit Count Inactivity Timer, the charging session may
be terminated by the SMF sending Charging Data Request [Termination],
indicating the PDU session shall continue and the CHF can expect a later
Charging Data Request [Initial] request for the same PDU session with the
original Charging ID and new session identifier. The SMF may send its locally
configured value of the Unit Count Inactivity Timer to the CHF. The CHF may
respond with a new Unit Count Inactivity Timer for use in the SMF.
#### 5.2.1.2 Applicable Triggers in the SMF
##### 5.2.1.2.1 General
When a charging event is issued towards the CHF, it includes details such as
Subscriber identifier (e.g. SUPI), Charging-id, etc. and also containers
identifying the volume count (separated for uplink and downlink traffic), with
charging condition change information.
Each trigger condition (i.e. chargeable event) defined for the 5G data
connectivity converged charging functionality, is specified with the
associated behaviour when they are met.
Two categories of chargeable events are identified:
\- immediate report: chargeable events for which, when occurring, the current
counts are closed and sent together with the charging data generated by the
SMF towards the CHF in a Charging Data Request. New counts are started by the
SMF.
\- deferred report: chargeable events for which, when occurring, the current
counts are closed and stored together with the charging data generated by the
SMF. The stored counts will be sent to the CHF in next a Charging Data
Request. New counts are started by the SMF
When a PDU session starts, and the converged charging is activated, the SMF
invokes a Charging Data Request [Initial] towards the CHF to get authorization
to start. The SMF is optionally provided in the Charging Data Response
[Initial], with a set of chargeable event triggers to be enabled, and the
associated category (i.e. immediate or deferred report).
When provided, these triggers override the default triggers in the SMF, they
remain active until they are updated or disabled by subsequent Charging Data
Response [Update] from the CHF or the PDU session is terminated.
A set of chargeable events are based on trigger thresholds and default ones
can be configured in Charging Characteristics which are described in Annex A.\
The SMF is optionally provided in the Charging Data Response [Initial], with
trigger thresholds which override the default ones configured in the Charging
Characteristics selected by the SMF for the PDU session. They remain active
until they are updated by subsequent Charging Data Response [Update] from the
CHF or the PDU session is terminated.
##### 5.2.1.2.2 Flow Based Charging (FBC) triggers
The set of chargeable events and associated category, which shall be supported
by the SMF as the default, is specified in the sub-clause 5.2.1.4 for Flow
Based Charging.
Two level of triggers can be supplied by the CHF:
\- Triggers associated to the PDU session.
\- Triggers associated to a rating group within the PDU session.
The set of triggers along with their category (i.e. immediate or deferred
report) and level (i.e. per PDU session or per rating group), which can be
supplied by the CHF to the SMF for 5G data connectivity converged charging are
detailed in the sub-clause 5.2.1.4 for Flow Based Charging.
##### 5.2.1.2.2 QoS flow Based Charging (QBC) triggers
The set of chargeable events and associated category, which shall be supported
by the SMF as the default for QoS flow Based Charging, when applicable, is
specified in the sub-clause 5.2.1.6.
Two level of triggers can be supplied by the CHF:
\- Triggers associated to the PDU session.
\- Triggers associated to a QoS Flow within the PDU session.
The set of triggers along with their category (i.e. immediate or deferred
report) and level (i.e. per PDU session or per QoS Flow), which can be
supplied by the CHF to the SMF for 5G data connectivity converged charging are
detailed in the sub-clause 5.2.1.6 for QBC.
When QBC is used in the context of roaming, the set of triggers, their
associated category, and trigger thresholds, compose the \"Roaming Charging
Profile\", which governs the SMF charging data generation, synchronously
between the V-SMF and the H-SMF when shared.
#### 5.2.1.3 PDU session charging
Converged charging allows the SMF to collect charging information related to
data volumes sent to and received by the UE/MS per user per PDU session. The
user can be identified by SUPI.
If PDU session specific converged charging is supported, this is achieved by
FBC charging, with specific rating group/service identifier, see clause
5.2.1.4.
#### 5.2.1.4 Flow Based Charging (FBC)
For FBC charging, the SMF categorizes the service data flows within PDU
session data traffic by rating group and / or combination of the rating group
and service id. The level of the reporting and charging method is defined per
PCC rule. Details of this functionality are specified in TS 23.503 [202] and
TS 32.240 [1].
NOTE: The SMF can only include one QoS Information occurrence per combination
of rating group/service id. This implies if an operator wishes to be able to
separate usage according to 5QI and ARP for the same charging method, they
will need to ensure that service data flows having different 5QI and ARP do
not have the same:
\- rating group in cases where rating reporting is used;
\- rating group/service id where rating group/service id reporting is used.
When a service data flow is governed by a PCC Rule indicated with \"Online\"
charging method, quota management is required before service delivery for
controlling this service data flow to be able to start or continue. There is
also a special case of \"Online\" where the SMF may allow traffic to start
before quota management.
When a service data flow is governed by a PCC Rule indicated with \"Offline\"
charging method, quota management is not required for this service data flow.
Usage reporting is required for this service data flow without affecting the
delivery.
According to TS 23.503 [202], FBC shall support different charging models per
PCC rule. These charging models may be based on volume and/or time and on
number of events matching a specific service data flow template in PCC rule.
When a chargeable event occurs for which quota needs to be requested by the
SMF to the CHF, the type of requested quota may depend on measurement method
configured for the PCC rule.
In general, the charging of a service data flow shall be linked to the PDU
session under which the service data flow has been activated.
The amount of data counted shall be the user plane payload at the UPF
separated between UL and DL.
For PDU session specific charging, time metering shall start when PDU session
is activated.
Table 5.2.1.4.1 summarizes the set of default trigger conditions and their
category which shall be supported by the SMF. For \"immediate report\"
category, the table also provides the corresponding Charging Data Request
[Initial, Update, Termination] message sent from SMF towards the CHF.
Table 5.2.1.4.1: Default Trigger conditions in SMF
* * *
Trigger Conditions Trigger level Default category CHF allowed to change
category CHF allowed to enable and disable Message when \"immediate
reporting\" category Start of PDU Session. PDU session Immediate Not
Applicable Not Applicable Charging Data Request [Initial] Start of the Service
data flow and no charging session exists. RG Immediate No No  
**Change of Charging conditions** Charging Data Request [Update]  
QoS change PDU session/ RG Deferred Yes Yes  
GFBR guaranteed status change RG Deferred Yes Yes  
User Location change PDU session/ RG Deferred Yes Yes  
Serving Node change PDU session/ RG Deferred Yes Yes  
Change of UE presence in Presence Reporting Area(s) PDU session/ RG Deferred
Yes Yes  
Change of 3GPP PS Data off Status PDU session/ RG Deferred Yes Yes  
Tariff time change PDU session/ RG Deferred No No  
UE time zone change PDU session/ RG Immediate Yes Yes  
PLMN change PDU session/ RG Immediate Yes Yes  
RAT type change PDU session/ RG Immediate Yes Yes  
Session-AMBR change PDU session Immediate Yes Yes  
Addition of UPF PDU Session Immediate Yes Yes  
Removal of UPF PDU session Immediate Yes Yes  
**Limit per PDU session**  
Expiry of data time limit per PDU session PDU session Immediate No Yes  
Expiry of data volume limit per PDU session PDU session Immediate No Yes  
Expiry of data event limit per PDU session PDU session Immediate No Yes  
Expiry of limit of number of charging condition changes PDU session Immediate
No Yes  
**Limit per Rating group**  
Expiry of data time limit per rating group RG Deferred Yes Yes  
Expiry of data volume limit per rating group RG Deferred Yes Yes  
Expiry of data event limit per rating group RG Deferred Yes Yes  
**Quota management**  
Time threshold reached RG Immediate No Yes  
Volume threshold reached RG Immediate No Yes  
Unit threshold reached RG Immediate No Yes  
Time quota exhausted RG Immediate No Yes  
Volume quota exhausted RG Immediate No Yes  
Unit quota exhausted RG Immediate No Yes  
Expiry of quota validity time RG Immediate No Yes  
Expiry of quota holding time RG Immediate No Yes  
Re-authorization request by CHF RG Immediate No No  
Start of service data flow, in case no valid quota for this rating group RG
Immediate No No  
**Others**  
Termination of service data flow - last service data flow under a given Rating
Group. RG Immediate No No  
Management intervention PDU session Immediate No No  
Expiry of Unit Count Inactivity Timer PDU session Immediate No Yes Charging
Data Request [Termination] End of PDU session PDU session Immediate No No  
CHF response with session termination PDU session Immediate No No  
Abort request is received from the CHF PDU session Immediate No No
* * *
The default \"Limit\" trigger conditions, are trigger thresholds configured in
the Charging Characteristics applied to the PDU session. It shall be possible
for the CHF to override these default triggers when providing Charging Data
Response [Initial], either to disable the triggers, or to enable triggers new
thresholds value.
When the traffic is counted in more than one UPF, the CHF overrides these
default triggers of volume limit for the all UPFs.
For converged charging, the following details of chargeable events and
corresponding actions in the SMF are defined in Table 5.2.1.4.2:
Table 5.2.1.4.2: Chargeable events and their related actions in SMF
+----------------------+----------------------+----------------------+ | Chargeable event | Conditions | SMF action | +----------------------+----------------------+----------------------+ | Start of PDU session | | Charging Data | | | | Request [Initial] | | | | with a possible | | | | request quota for | | | | later use | +----------------------+----------------------+----------------------+ | Start of service | If quota management | Charging Data | | data flow | is required, and | Request [Update] | | | valid quota for this | with a request quota | | | rating group does | with a possible | | | not exist | amount of quota. | +----------------------+----------------------+----------------------+ | | If service | Start new counts | | | identifier level | with time stamps for | | | reporting is | the combination of | | | required by the PCC | the rating group and | | | rule | service id | +----------------------+----------------------+----------------------+ | | If rating group | Start new counts | | | level reporting is | with time stamps for | | | required by the PCC | the rating group | | | rule | | +----------------------+----------------------+----------------------+ | | If sponsored | Start new counts | | | connectivity level | with time stamps for | | | reporting is | the combination of | | | required by the PCC | the rating group, | | | rule | sponsor identity and | | | | application service | | | | provider identity | +----------------------+----------------------+----------------------+ | | If charging | Charging Data | | | resource, i.e. | Request [Initial] | | | charging session, | with a possible | | | for the PDU session | request quota | | | does not exist | | +----------------------+----------------------+----------------------+ | Termination of | If service | Close the counts | | service data flow | identifier level | with time stamps | | | reporting is | | | | required by the PCC | | | | rule and this is the | | | | last service data | | | | flow for this | | | | combination of the | | | | rating group and | | | | service id | | +----------------------+----------------------+----------------------+ | | If rating group | Close the counts | | | level reporting is | with time stamps | | | required by the PCC | | | | rule and this is the | | | | last service data | | | | flow utilizing that | | | | specific rating | | | | group | | +----------------------+----------------------+----------------------+ | | If sponsored | Close the counts | | | connectivity level | with time stamps | | | reporting is | | | | required by the PCC | | | | rule and this was | | | | the last active | | | | service data flow | | | | for this combination | | | | of rating group, | | | | sponsor identity and | | | | application service | | | | provider identity | | +----------------------+----------------------+----------------------+ | Expiry of the Unit | | Charging Data | | Count Inactivity | | Req | | Timer for the PDU | | uest[Termination], | | session | | indicating that | | | | charging session is | | | | terminated, and the | | | | PDU session is still | | | | active | | | | | | | | May include the | | | | configured Unit | | | | Count Inactivity | | | | Timer | +----------------------+----------------------+----------------------+ | End of PDU session | | Charging Data | | in the SMF | | Request | | | | [Termination] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | Quota specific | | Charging Data | | chargeable events | | Request [Update] | | (e.g. threshold | | with a possible | | reached, QHT | | request quota | | expires, quota | | | | exhaustion, validity | | Close the counts and | | time reached, forced | | start new counts | | re-authorization, | | with time stamps | | expiry of quota | | | | holding time) | | | +----------------------+----------------------+----------------------+ | Change of charging | If the corresponding | Close the counts and | | condition in the SMF | trigger is enabled | start new counts | | (e.g. QoS change, | | with time stamps for | | Session-AMBR change, | | all active service | | user location | | data flows | | change, Radio access | | | | type change, PLMN | | | | change, Serving Node | | | | change, UE Timezone | | | | change, change of UE | | | | presence in Presence | | | | Reporting Area(s), | | | | change of 3GPP PS | | | | Data Off status, | | | | GFBR guaranteed | | | | status change) | | | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Addition of UPF | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | with a request quota | | | set to \"immediate | with a possible | | | reporting\" | amount of quota. | +----------------------+----------------------+----------------------+ | Tariff time change | | Close the counts and | | | | start new counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | CHF response with | | Charging Data | | session termination | | Request | | (e.g. Not | | [Termination] | | Applicable) , abort | | | | request | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | Removal of a UPF | If quota management | Charging Data | | | is being performed | Request[Update] | | | and quota is granted | | | | per each UPF | Close the counts | | | | with time stamps for | | | | the removed UPF | +----------------------+----------------------+----------------------+ | | If quota management | Close the counts | | | is being performed | with time stamps for | | | and quota is shared | the removed UPF | | | between UPFs | | +----------------------+----------------------+----------------------+ | | If there is no quota | Close the counts | | | management performed | with time stamps for | | | | the removed UPF | +----------------------+----------------------+----------------------+ | Expiry of time limit | | Close the counts | | per rating group | | with time stamps | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If any matching | Start new counts | | | service data flow is | with time stamps | | | still active | | +----------------------+----------------------+----------------------+ | Expiry of data | | Close the counts | | volume limit per | | with time stamps | | rating group | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If any matching | Open a new service | | | service data flow is | data container | | | still active | | +----------------------+----------------------+----------------------+ | Expiry of data event | | Close the counts | | limit per rating | | with time stamps | | group | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If any matching | Open a new service | | | service data flow is | data container | | | still active | | +----------------------+----------------------+----------------------+ | Expiry of data event | | Charging Data | | limit per PDU | | Request [Update] | | session | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of time limit | | Charging Data | | per PDU session | | Request [Update] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of data | | Charging Data | | volume limit per PDU | | Request [Update] | | session | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of a limit of | | Charging Data | | number of charging | | Request [Update] | | condition changes | | | | per PDU session | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Management | | Charging Data | | intervention | | Request [Update] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+
When event based charging applies, the first occurrence of an event matching a
service data flow template in PCC rule shall be considered as the start of a
service.
How the termination of service data flows is detected, is specified in TS
23.503 [202]. Termination of the service data flow itself does not trigger
Charging Data Request[Update].
The CDR generation mechanism processed by the CHF upon receiving Charging Data
Request [Initial, Update, Termination] issued by the SMF for these chargeable
events, is specified in clause 5.2.3.
#### 5.2.1.5 SSC Mode and Triggers
In case of SSC Mode1, the chargeable events are Change of charging condition
in the SMF.
In case of SSC Mode2 and SSC Mode3 PDU session Anchor with multiple PDU
session, the chargeable events are Start of PDU session and End of PDU
session.
There are two cases related to quota management when the granted quota is
volume for multiple UPFs and per Operator\'s policy, the traffic is counted in
more than one UPF:
\- Quota shared by UPFs means that SMF manages the shared quota consumption
per RG for multiple UPFs and reports the total quota consumed to CHF;
\- Quota granted for each UPF means that the CHF manages the quota granted for
each UPF and SMF manages and reports the quota consumption per UPF.
For configurations involving multiple UPFs and Operator\'s policy is to count
the traffic in a single UPF (e.g. BP), the quota is granted to the SMF for
this single UPF per RG for the whole traffic.
The following scenarios describe configurations in which the traffic is
counted in more than one UPF:
In case of SSC mode 3 PDU Session Anchor with IPv6 Multi-homed PDU Session,
\- The addition of UPF2 and BP (Change the part of traffic from UPF1 to UPF2):
\- if quota granted for each UPF, SMF triggers the chargeable event of Start
of SDF for UPF2 to request the quota;
\- if quota shared by UPFs, SMF requests UPF1 report usage of quota, caches
the usage from UPF1 and re-allocates the remaining quota to UPF2 and UPF1(if
needed). When the granted quota from CHF is used up, the SMF reports total
usage of quota to CHF.
\- The removal of UPF1and BP:
\- In case the quota management and quota granted for each UPF, UPF1 reports
final counts to SMF, SMF triggers the chargeable event of Remove the UPF to
report final counts from UPF1;
\- In case the quota management and quota shared by UPFs, UPF1 report final
counts to SMF, SMF caches the final count from UPF1. SMF sends counts from
UPF1 and UPF2 to the CHF together in next Charging Data Request.
\- In case without the quota management, UPF1 report final count to SMF, SMF
caches the final count from UPF1 and sends counts from UPF1 and UPF2 to the
CHF together in next a Charging Data Request.
In case of Addition of additional PDU Session Anchor and Branching Point or UL
CL:
\- The addition of UPF2 and BP (Change the part of traffic from UPF1 to UPF2):
\- if quota granted for each UPF, SMF triggers the chargeable event of Start
of SDF for UPF2 to request the quota for Rating group;
\- if quota shared by UPFs, SMF indicates UPF1 report usage of quota, caches
the usage from UPF1 and re-allocates the remain quota to UPF2 and UPF1(if
needed). When the granted quota from CHF is used up, the SMF reports total
usage of quota to CHF.
In case of Removal of additional PDU Session Anchor and Branching Point or UL
CL:
\- The removal of UPF1 and BP (Change traffic from UPF1 to UPF2):
\- In case the quota management and quota granted for each UPF, UPF1 report
final counts to SMF, SMF triggers chargeable event of Remove the UPF to report
final counts from UPF1;
\- In case the quota management and quota shared by UPFs, UPF1 report final
counts to SMF, SMF caches the final count from UPF1 and re-allocates the
remain quota to UPF2. SMF sends counts from UPF1 and UPF2 to the CHF together
in next a Charging Data Request.
\- In case without the quota management, UPF1 report final count to SMF, SMF
caches the final count from UPF1 and sends counts from UPF1 and UPF2 to the
CHF together in next a Charging Data Request.
In case of Change of additional PDU Session Anchor for IPv6 multi-homing or UL
CL and Simultaneous change of Branching Point or UL CL and additional PSA for
a PDU Session.
\- The additional of UPF2 (Change the part of traffic from UPF1 to UPF2):
\- if quota granted for each UPF, SMF triggers the chargeable event of Start
of SDF for UPF2 to request the quota for Rating group;
\- if quota shared by UPFs, SMF indicates UPF1 report usage of quota, caches
the usage from UPF1 and re-allocates the remain quota to UPF2 and UPF1(if
needed). When the granted quota from CHF is used up, the SMF reports total
usage of quota to CHF.
\- The removal of UPF1:
\- In case the quota management and quota granted for each UPF, UPF1 report
final counts to SMF, SMF triggers chargeable event of Remove the UPF to report
final counts from UPF1.
\- In case the quota management and quota shared by UPFs, UPF1 report final
counts to SMF, SMF caches the final count from UPF1 and re-allocates the
remain quota to UPF2. SMF sends counts from UPF1 and UPF2 to the CHF together
in next Charging Data Request.
\- In case without the quota management, UPF1 report final count to SMF, SMF
caches the final count from UPF1 and sends counts from UPF1 and UPF2 to the
CHF together in next a Charging Data Request.
#### 5.2.1.6 QoS flow Based Charging
QoS flow Based Charging allows the SMF to collect charging information related
to data volumes per PDU session, categorized per QoS Flow.
The user can be identified by SUPI.
For a given PDU session, QBC shall be performed by the SMF within the same
charging session used for Flow Based Charging.
The SMF categorizes the volume within PDU session by QoS Flow identified by
QoS Flow Identifier (QFI).
The amount of data counted for the QoS Flow shall be the user plane payload at
the UPF.
Table 5.2.1.6.1 summarizes the set of default trigger conditions and their
category which shall be supported by the SMF in QBC. For \"immediate report\"
category, the table also provides the corresponding Charging Data Request
[Initial, Update, Termination] message sent from SMF towards the CHF.
Table 5.2.1.6.1: Default Chargeable events in SMF for QBC
* * *
Chargeable event Trigger level Default category CHF allowed to change category
CHF allowed to enable and disable Message when \"immediate reporting\"
category Start of PDU session PDU session Immediate Not Applicable Not
Applicable Charging Data Request [Initial] Start of a QoS Flow QoS Flow
Deferred Not Applicable Not Applicable Charging Data Request [Update] **Change
of Charging conditions**  
QoS change QoS Flow Deferred Yes Yes  
GFBR guaranteed status change QoS Flow Deferred Yes Yes  
User Location change PDU session Deferred Yes Yes  
Serving Node change PDU session Deferred Yes Yes  
Change of UE presence in Presence Reporting Area(s) PDU session Deferred Yes
Yes  
Change of 3GPP PS Data off Status PDU session Deferred Yes Yes  
Tariff time change PDU session Deferred No No  
UE time zone change PDU session Immediate Yes Yes  
PLMN change PDU session Immediate Yes Yes  
RAT type change PDU session Immediate Yes Yes  
Session-AMBR change PDU session Immediate Yes Yes  
Addition of UPF PDU session Immediate Yes Yes  
Removal of UPF PDU session Immediate Yes Yes  
**Limit per PDU session**  
Expiry of data time limit per PDU session PDU session Immediate Yes Yes  
Expiry of data volume limit per PDU session PDU session Immediate Yes Yes  
Expiry of data event limit per PDU session PDU session Immediate Yes Yes  
Expiry of limit of number of charging condition changes PDU session Immediate
Yes Yes  
**Limit per QoS Flow**  
Expiry of data time limit per QoS Flow QoS Flow Deferred Yes Yes  
Expiry of data volume limit per QoS Flow QoS Flow Deferred Yes Yes  
**Others**  
End of QoS Flow QoS Flow Deferred Yes Yes  
Management intervention PDU session Immediate No No  
End of PDU session PDU session Immediate No No Charging Data Request
[Termination] Abort request is received from the CHF PDU session Immediate No
No
* * *
The default \"Limit\" trigger conditions, are trigger thresholds configured in
the Charging Characteristics applied to the PDU session for QBC. It shall be
possible for the CHF to override these default triggers when providing
Charging Data Response[Initial], either to disable the triggers, or to enable
triggers new thresholds value.
For QBC the following details of chargeable events and corresponding actions
in the SMF are defined in Table 5.2.1.6.2:
Table 5.2.1.6.2: Chargeable events and their related actions in SMF for QBC
+----------------------+----------------------+----------------------+ | Chargeable event | Conditions | SMF action | +----------------------+----------------------+----------------------+ | Start of PDU session | | Charging Data | | | | Request [Initial] | +----------------------+----------------------+----------------------+ | Start of a QoS Flow | Start of the QoS | Charging Data | | | Flow associated with | Request [Update]. | | | the default QoS rule | | +----------------------+----------------------+----------------------+ | | Start of a QoS Flow | Start new counts | | | | with time stamps. | +----------------------+----------------------+----------------------+ | End of a QoS Flow | | Close the counts | | | | with time stamps for | | | | the QoS flows | +----------------------+----------------------+----------------------+ | End of PDU session | | Charging Data | | | | Request | | | | [Termination] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | Change of charging | If the corresponding | Close the counts and | | condition in the SMF | trigger is enabled | start new counts | | (e.g. QoS change, | | with time stamps for | | Session-AMBR change, | | all active QoS | | user location | | flows. | | change, Radio access | | | | type change, PLMN | | | | change, Serving Node | | | | change, UE Timezone | | | | change, change of UE | | | | presence in Presence | | | | Reporting Area(s), | | | | change of 3GPP PS | | | | Data Off status, | | | | GFBR guaranteed | | | | status change) | | | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Addition of UPF | | Charging Data | | | | Request [Update]. | +----------------------+----------------------+----------------------+ | Removal of UPF | | Close the counts | | | | with time stamps for | | | | the removed UPF | +----------------------+----------------------+----------------------+ | Expiry of time limit | If the corresponding | Close the counts | | per QoS Flow | trigger is enabled | with time stamps. | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the QoS Flow is | Start new counts | | | still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of data | If the corresponding | Close the counts | | volume limit per QoS | trigger is enabled | with time stamps | | Flow | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the QoS Flow is | Start new counts | | | still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of time limit | If the corresponding | Close the counts | | per PDU session | trigger is enabled | with time stamps for | | | | all QoS flows. | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps for | | | | all active QoS flows | +----------------------+----------------------+----------------------+ | Expiry of data | If the corresponding | Close the counts | | volume limit per PDU | trigger is enabled | with time stamps for | | session | | all QoS flows. | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps for | | | | all active QoS flows | +----------------------+----------------------+----------------------+ | Expiry of a limit of | If the corresponding | Close the counts | | number of charging | trigger is enabled | with time stamps for | | condition changes | | all QoS flows. | | per PDU session | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps for | | | | all active QoS flows | +----------------------+----------------------+----------------------+ | Management | | Charging Data | | intervention | | Request [Update] | | | | | | | | Close the counts | | | | with time stamps for | | | | all QoS Flows | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Abort | | Charging Data | | | | Request | | | | [Termination] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+
The CDR generation mechanism processed by the CHF upon receiving Charging Data
Request[Initial, Update, Termination] issued by the SMF for these chargeable
events in QBC, is specified in clause 5.2.3.
#### 5.2.1.7 Roaming QoS flow Based charging (QBC)
When QoS flow Based Charging specified in 5.2.1.6 is used in a context of
roaming, a \"Roaming Charging Profile\" is defined to allow, when shared, QBC
synchronized between both PLMNs and includes:
\- The set of chargeable events as per Table 5.2.1.6.1 and associated
category.
\- The set of thresholds for chargeable events based on trigger thresholds.
\- An indication on whether the \"Default partial record\" or the \"Individual
partial record\" mechanism per clause 5.2.3, is used by CHF.
A default \"Roaming Charging Profile\" is specified for the SMF and comprises:
\- The set of chargeable events and associated category specified as the
default per Table 5.2.1.6.1.
\- The default set of thresholds configured in the Charging Characteristics
for QBC.
\- The \"Default partial record\" mechanism indicated as the one used by CHF.
In the VPLMN, at PDU session establishment the default \"Roaming Charging
Profile\" in the V-SMF may optionally be overridden by a new \"Roaming
Charging Profile\" supplied by the CHF in the Charging Data Response [Initial]
with:
\- updated set of chargeable events and associated category.
\- updated thresholds for chargeable events based on trigger thresholds.
\- the selected partial record mechanism (\"Default partial record\" or
\"Individual partial record\").
This updated \"Roaming Charging Profile\" is transferred from the V-SMF to the
H-SMF and may be acknowledged or replaced by the HPLMN selected \"Roaming
Charging Profile\" to be used by the V-SMF.
In the HPLMN, at PDU session establishment, the \"Roaming Charging Profile\",
when received by the H-SMF from the V-SMF, may be updated by the CHF in the
HPLMN in the Charging Data Response [Initial] to H-SMF. This HPLMN CHF
selected \"Roaming Charging Profile\" is used by the H-SMF and transferred
towards the VPLMN.
The \"Roaming Charging Profile\" resulting from the exchange between the VPLMN
and HPLMN at PDU session establishment shall remain unchanged during the PDU
session lifetime.
The capability specified in clause 5.2.1.2.1 for the CHF to be able to update
the triggers after the PDU session is established shall not be applicable for
Roaming QBC.
#### 5.2.1.8 Termination action
The termination action applies only in case of online charging, i.e. quota
management is active. It indicates the action, which the UPF should perform
when no quota is granted. A packet for a specific rating group is subject to a
termination action in the following cases:
\- Zero units have been granted;
\- The final granted units have been used;
\- Quota limit reached;
\- End user service rejected;
\- End user service denied;
\- Rating failed.
The defined termination actions include:
\- Allowing the packets to pass through;
\- Dropping the packets;
\- The SMF Default Termination Action;
\- The re-direction of packets to an application server (e.g. defined in the
termination action).
NOTE: Such a re-direction may trigger a new charging session to be initiated.
A Default Termination Action for all rating groups, for which no quota is
granted and there is no specific termination action, shall be pre-configured
in the SMF according to operator\'s policy. For instance, the default
behaviour may consist of allowing packets of any terminated service to pass
through the UPF.
The CHF may provide a termination action for each rating group. Any previously
provided termination action may be overwritten by the CHF. A termination
action remains valid and shall be applied by the SMF until all the
corresponding PCC rules are removed.
#### 5.2.1.9 Sponsored data connectivity charging
The Sponsor Identifier and Application Service Provider Identifier are
provided for sponsored data connectivity to the PCF from the AF, according to
TS 23.503 [215].
The Sponsor Identifier and Application Service Provider Identity may be
included in PCC rules with \"offline\" charging method from the PCF to the
SMF. In this case, charging information collected by the SMF includes the
Sponsor Identity and the Application Service Provider Identity. Correlation of
charging information from multiple users per sponsor and/or application
service provider can then be based on Sponsor Identity and Application Service
Provider Identity.
### 5.2.2 Message flows
#### 5.2.2.1 General
The flows in the present document specify the interaction between the SMF and
the CHF for 5G data connectivity converged charging functionality, in
different scenarios, based on TS 23.501 [200] and TS 23.502 [201] procedures
and flows.
This interaction is based on Charging Data Request /Response specified in TS
32.290 [57], exchanged between the SMF embedding the CTF and the CHF.
As a general principle, the steps in the figures for the message flows below
correspond to the steps of figures in TS 23.502 [202], which is the reference.
This document specifies the charging specific extension part.
#### 5.2.2.2 PDU session charging from SMF
##### 5.2.2.2.1 General
The subclause below describes PDU session charging in non-roaming scenarios.
##### 5.2.2.2.2 PDU session establishment
The following figure 5.2.2.2.1 describes a PDU session establishment charging,
based on figure 4.3.2.2.1.1 TS 23.502 [202] description:
{width="6.288888888888889in" height="8.853472222222223in"}
Figure 5.2.2.2.2.1: PDU session establishment
8\. The SMF selects an SSC mode for the PDU Session and also selects one or
more UPFs.
9\. The SMF may perform a Session Management Policy Modification procedure to
report some event to the PCF that has previously subscribed.
9ch-a.The SMF creates a Charging Id for the PDU session, and sends Charging
Data Request[initial] to CHF for authorization for the subscriber to start the
PDU session which is triggered by start of PDU session charging event.
9ch-b. The CHF opens CDR for this PDU session.
9ch-c. The CHF acknowledges by sending Charging Data Response[Initial] to the
SMF.
15\. AMF to SMF: SM Request (N2 SM information).
[16a-b]. N4 session Modification.
16ch-a. This step may occur in case \"start of service data flow\" needs quota
from CHF, for the SMF to request quota.
16ch-b. The CHF updates CDR for this PDU session.
16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
19\. In case of PDU Type IPv6, IPv6 Address Configuration.
#### 5.2.2.3 PDU session charging SSC Mode 1 from SMF
##### 5.2.2.3.1 General
The subclause below describes PDU session SSC mode 1 charging in non-roaming
scenarios.
##### 5.2.2.3.2 PDU session charging SSC Mode 1
The following figure 5.2.2.3.2.1 describes a PDU session SSC mode 1 charging,
based on clause 5.6.9.2.1 TS 23.501 [201] description:
Figure 5.2.2.3.2.1: PDU session anchor relocation in SSC mode 1
Ongoing charging interaction associated with the established PDU session
(UPF).
1\. A (R)AN relocation is performed.
2\. The SMF determines that the serving UPF needs to be maintained and
interacts with the UPF for the path switch to the new (R)AN access.
3\. the SMF acknowledges the path switch to the new (R)AN.
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for reporting
the charging information User location information/ Access Technology Type
Information.
3ch-b. The CHF updates the CDR.
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.4 PDU session Charging SSC Mode 2 from SMF
##### 5.2.2.4.1 General
The subclause below describes PDU session charging for change the PDU Session
Anchor serving a PDU Session of SSC mode 2
##### 5.2.2.4.2 PDU session Charging SSC Mode 2
The following figure 5.2.2.4.2.1 describes a PDU session anchor relocation in
SSC mode 2 charging, based on figure 4.3.5.1.1 TS 23.502 [202] description:
Figure 5.2.2.4.2.1: PDU session anchor relocation in SSC mode 2 with single
PDU session anchor
Ongoing charging session associated with the established PDU session (UPF1)
2\. PDU session release procedure (UPF1).
2ch-a. The SMF1 sends Charging Data Request[Termination] to the CHF for
terminating the charging associated with old PDU session in UPF1.
2ch-b. The CHF closes the CDR for old PDU session in UPF1.
2ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the SMF1.
3\. PDU session establishment procedure (UPF2).
3ch-a. The SMF2 creates a Charging Id for new PDU session ID in UPF2 and sends
Charging Data Request[initial] to CHF for authorization for the subscriber to
start the new PDU session which is triggered by start of PDU session charging
event.
3ch-b. The CHF opens CDR for new PDU session in UPF2.
3ch-c. The CHF acknowledges by sending Charging Data Response[initial] to the
SMF2.
NOTE: If the same SMF1 is re-selected is step 3, the same steps 3ch-a to b
apply to SMF1
#### 5.2.2.5 PDU session Charging SSC Mode 3 from SMF
##### 5.2.2.5.1 General
The subclause below describes PDU session charging for change the PDU Session
Anchor serving a PDU Session of SSC mode 3.
##### 5.2.2.5.2 PDU session Charging SSC Mode 3
The following figure 5.2.2.5.2.1 describes a PDU session anchor relocation in
SSC with mode 3 multiple PDU sessions and SMF reallocation, based on figure
4.3.5.2.1 TS 23.502 [202] description:
Figure 5.2.2.5.2.1: PDU session anchor relocation in SSC mode 3 with multiple
PDU sessions -- SMF reallocation
Ongoing charging interaction associated with the established PDU session (with
UPF1).
4\. UE initiates PDU session establishment procedure with UPF2..
4ch-a. The SMF2 creates a Charging Id for new PDU session ID with UPF2 and
sends Charging Data Request[initial] to CHF for authorization for the
subscriber to start the new PDU session (with UPF2) which is triggered by
start of PDU session charging event.
4ch-b. The CHF opens CDR for new PDU session in UPF2.
4ch-c. The CHF acknowledges by sending Charging Data Response[initial] to the
SMF2.
6\. Old PDU session for UPF1 release.
6ch-a. The SMF1 sends Charging Data Request[Termination] to the CHF for
terminating the charging associated with old PDU session in UPF1.
6ch-b. The CHF closes the CDR for old PDU session in UPF1.
6ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the SMF1.
#### 5.2.2.6 PDU session Charging SSC Mode 3 IPv6 Multi Homed from SMF
##### 5.2.2.6.1 General
The subclause below describes PDU session charging for service continuity with
SSC mode 3 using the multi-homed PDU Session.
##### 5.2.2.6.2 PDU session Charging SSC Mode 3 IPv6 Multi Homed
The following figure 5.2.2.6.2.1 describes a PDU session anchor relocation in
SSC mode 3 with IPv6 Multi homed PDU Session charging, based on figure
4.3.5.3.1 TS 23.502 [202] description:
Figure 5.2.2.6.2.1: PDU session anchor relocation in SSC mode 3 with IPv6
Multi homed PDU Session
Ongoing charging interaction associated with the established PDU session
(UPF1).
Traffic starts at UPF2.
11ch-a. The SMF sends Charging Data Request[Update] to the CHF for request
quota for UPF2 which is triggered by start of service data flow charging
event, if quota management per UPF.
11ch-b. The CHF updates CDR for this PDU session
11ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
[12a-b to 13a-b] The SMF releases the UE\'s old IPv6 prefix (IP\@1), and
releases the path between BP UPF and UPF1.
13ch-a. The SMF sends Charging Data Request[Update] to the CHF for usage
reporting for UPF1 which is triggered by termination of service data flow
charging event, if quota management per UPF.
13ch-b. The CHF updates CDR for this PDU session.
13ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
In this scenario, the PDU session Id is maintained during the whole procedure.
#### 5.2.2.7 Addition of additional PDU Session Anchor and Branching Point or
UL CL
The following figure 5.2.2.7.1 describes the charging procedure to add a PDU
Session Anchor and a Branching Point or UL CL for an established PDU Session,
based on figure 4.3.5.4.1 TS 23.502[201].
Figure 5.2.2.7.1: Addition of additional PDU Session Anchor and Branching
Point or UL CL
> Ongoing charging interaction associated with the established PDU session
> (UPF).
3\. The SMF establishes the Branching Point (in case of IPv6 multi-homing) or
a UL CL for the PDU Session.
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the
additional of UPF (PSA 2) if quota management is granted per UPF by trigger
\"Addition of UPF\".
3ch-b. The CHF updates the CDR for the charging information of UPF (PSA 2).
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.8 Removal of additional PDU Session Anchor and Branching Point or
UL CL
The following figure 5.2.2.8.1 describes charging procedure to remove a PDU
Session Anchor and (optionally) remove Branching Point or UL CL for an
established PDU Session, based on figure 4.3.5.5.1 TS 23.502[201].
Figure 5.2.2.8.1: Removal of additional PDU Session Anchor and Branching Point
or UL CL
> Ongoing charging interaction associated with the established PDU session
> (UPF).
5\. The SMF releases via N4 the PSA1.
5ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal
of UPF (PSA 1) if quota management is granted per UPF by trigger \"Removal of
UPF\".
5ch-b. The CHF updates the CDR for the charging information of UPF (PSA 1).
5ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
6\. If steps 4 and 5 were executed, the SMF releases the Branching Point / UL
CL.
#### 5.2.2.9 Change of additional PDU Session Anchor for IPv6 multi-homing or
UL CL
The following figure 5.2.2.9.1 charging procedure to establish a new
additional PDU Session Anchor (i.e., PSA2) and conditionally releases the
existing additional PDU Session Anchor (i.e. PSA1), while modifying IPv6
multi-homing or UL CL rule in the same Branching Point or UL CL under
controlled by the same SMF abased on figure 4.3.5.6.1 TS 23.502[201].
Figure 5.2.2.9.1: Change of additional PSA for a PDU Session in IPv6 multi-
homing or UL CL case
Ongoing charging interaction associated with the established PDU session
(UPF).
3a-b. The SMF exchange the N4 message toBranching Point or UL CL .
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the
additional of UPF (PSA 2) if quota management is granted per UPF by trigger
\"Addition of UPF\".
3ch-b. The CHF updates the CDR for the charging information of UPF (PSA 2).
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
6a-b. Step 6 occurs only if the Branching Point or UL CL does not have any
traffic filter on the PDU Session which forwards a traffic flow to PSA1.
6ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal
of UPF (PSA 1) if quota management is granted per UPF by trigger \"Removal of
UPF\".
6ch-b. The CHF updates the CDR for the charging information of UPF (PSA 1).
6ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.10 Simultaneous change of Branching Point or UL CL and additional
PSA for a PDU Session
The following figure 5.2.2.10.1 describe the charging procedure to change the
Branching Point or the UL CL and additional PSA serving a PDU Session for a UE
triggered by SMF ((just an example call flow triggered by Xn based handover)
based on figure 4.3.5.7.1 TS 23.502[201].
Figure 5.2.2.10.1: Simultaneous change of Branching Point or UL CL and
additional PSA for a PDU Session
> Ongoing charging interaction associated with the established PDU session
> (UPF).
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the
additional of Target UPF if quota management is granted per UPF by trigger
\"Addition of UPF\".
3ch-b. The CHF updates the CDR for the charging information of Target UPF.
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
9\. The SMF releases PSA2.
9ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal
of Source UPF if quota management is granted per UPF by trigger \"Removal of
UPF\".
9ch-b. The CHF updates the CDR for the charging information of Source UPF.
9ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.11 PDU session charging for interworking with EPC
##### 5.2.2.11.1 General
In order to interwork with EPC, the N26 interface is introduced as an inter-CN
interface between the MME in EPC and 5GS AMF in order to enable provide
seamless session continuity for single registration mode UE for inter-system
change in the clause 5.17.2.2 TS 23.501[201].
PCF + PCRF, PGW-C + SMF and UPF + PGW-U are dedicated for interworking between
5GS and EPC, which are optional and are based on UE MM Core Network Capability
and UE subscription in the clause 4.3 TS 23.501 [201]. The procedures for
interworking with EPS based on N26 interface are specified in clause 4.11.1 TS
23.502 [202].
Interaction between the PGW-C + SMF and CHF is using the same interface as for
interaction between SMF and CHF.
##### 5.2.2.11.2 5GS to EPS handover using N26 interface
The following figure 5.2.2.11.2.1 describes a PDU session charging handover
from 5GS to EPS when N26 is supported, based on figure 4.11.1.2.1.1 TS 23.502
[202] description:
Figure 5.2.2.11.2.1: PDU session charging: 5GS to EPS handover using N26
0\. A PDU session is established in 5GS with multiple QoS Flows.
0ch. A charging session exist for this PDU session.
10c. PDU session update response to AMF).
10ch-a. This step occurs if steps 10a-c occurred. All counts are closed and a
Charging Data Request [Update] is sent to CHF. New counts and time stamps for
all active service data flows are started in the PGW-C+SMF.
10ch-b. The CHF updates CDR for this PDU session.
10ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
PGW-C+SMF.
16\. User Plane path switch for the default bearer and the dedicated GBR
bearers between the UE and PGW-U+UPF via SGW.
16ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF, if required by \"radio access type change\" trigger. New counts and time
stamps for all active service data flows are started in the PGW-C+SMF.
16ch-b. The CHF updates CDR for this PDU session.
16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
PGW-C+SMF.
19\. Dedicated bearer activation procedure for non-GBR QoS flows initiated by
PGW-C+SMF.
19ch. Needed counts are started on start of service data flows of
corresponding non-GBR Qos Flows.
##### 5.2.2.11.3 EPS to 5GS handover using N26 interface
The following figures 5.2.2.11.3.1 and 5.2.2.11.3.2 describe a PDU session
charging handover from EPS to 5GS when N26 is supported, based on figures
4.11.1.2.2.2.1 and 4.11.1.2.2.3.1 TS 23.502 [202] description:
Figure 5.2.2.11.3.1: PDU session charging: EPS to 5GS handover using N26 \-
preparation
0\. A PDU session is established in EPC with default bearer and dedicated
bearers. Association between the EPS bearer and the corresponding 5G QoS Rules
is stored by the PGW-C+SMF.
0ch. A charging session exist for this PDU session with multiple QoS Flows
associated to the default bearer and dedicated bearers.
{width="6.66875in" height="3.91875in"}
Figure 5.2.2.11.3.2: PDU session charging: EPS to 5GS handover using N26 \-
execution
10ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF, if required by \"radio access type change\" trigger. New counts and time
stamps for all active service data flows are started in the PGW-C+SMF.
10ch-b. The CHF updates CDR for this PDU session.
10ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
PGW-C+SMF.
#### 5.2.2.12 PDU session charging for roaming in Home routed scenario
##### 5.2.2.12.1 General
The subclauses below describe PDU session charging for roaming in Home routed
scenario focusing on roaming QBC procedures between SMF and a CHF in
respective PLMNs.
In H-PLMN, PDU session charging for FBC between H-SMF and a H-CHF occurring
within the same charging session is not reflected.
##### 5.2.2.12.2 PDU session establishment
The following figure 5.2.2.12.2.1 describes a PDU session charging
establishment in roaming Home routed scenario based on figure 4.3.2.2.2.1 TS
23.502 [202] description:
Figure 5.2.2.12.2.1: PDU session charging: establishment roaming Home Routed
1-3a. UE initiates a new PDU session. V-SMF and H-SMF selection by the AMF.
3ch-a. The UE is identified as a roamer (PLMN ID of the received SUPI is
different from VPLMN PLMN ID), the CHF is selected accordingly.
3ch-b. A Charging Data Request [Initial] is sent to CHF, indicating \"in-bound
roamer\".
3ch-c. The CHF opens a CDR (indicating \"in-bound roamer\")
3ch-d. The CHF acknowledges by sending Charging Data Response[Initial] to the
SMF and optionally supplies a \"Roaming Charging Profile\" to the V-SMF which
overrides the default one.
10\. UPF selection.
11\. If dynamic PCC is deployed, SM policy association modification.
11ch-a. Based on UE is identified as roaming in a different PLMN, the CHF is
selected accordingly.
11ch-b. A Charging Data Request [Initial] is sent to CHF, indicating \"out-
bound roamer\", with the \"Roaming Charging Profile\" received from the VPLMN.
11ch-c. The CHF opens a CDR (indicating \"out-bound roamer\").
11ch-d. The CHF acknowledges by sending Charging Data Response[Initial] to the
H-SMF and supplies the HPLMN selected \"Roaming Charging Profile\" (either the
same as the one received from VPLMN, either its own selected) to the H-SMF.
[12a-b]. The SMF initiates an N4 Session Establishment procedure with the
selected UPF.
12ch. Counts per QFI are started.
13\. Nsmf_PDUSession_Create Response from H-SMF to V-SMF
13ch-a. Based on \"received PDU session conditions\" trigger, a Charging Data
Request [Update] is sent to CHF with charging information received from H-SMF,
which includes the HPLMN selected \"Roaming Charging Profile\" and counts per
QFI are started.
13ch-b. The CHF updates the CDR.
13ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
V-SMF.
19a-b. N4 session modification.
19ch-a. Counts per rejected QFI(s) are closed. A Charging Data Request
[Update] is sent to CHF to report if needed.
19ch-b. The CHF updates the CDR.
19ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
V-SMF.
23\. Nsmf_PDUSession_UpdateRequest from V-SMF to H-SMF. The rejected QFI(s)
are notified to H-SMF.
23ch-a. Counts per rejected QFI(s) are closed. A Charging Data Request
[Update] is sent to CHF to report if needed.
23ch-b. The CHF updates the CDR.
23ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
H-SMF.
##### 5.2.2.12.3 PDU session modification
The following figure 5.2.2.12.3.1 describes a PDU Session Modification
procedure, home-routed roaming scenario based on figure 4.3.3.3.1 TS 23.502
[202] description:
Figure 5.2.2.12.3.1: UE or network requested PDU Session Modification (for
home-routed roaming scenario)
9ch-a. A Charging Data Request [Update] is sent to V-CHF with charging
information received from V-SMF, if needed and new counts per QFI are started.
9ch-b. The CHF updates the CDR.
9ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
V-SMF.
16ch-a. A Charging Data Request [Update] is sent to H-CHF with charging
information received from H-SMF, if needed, and new counts per QFI are
started.
16ch-b. The CHF updates the CDR.
16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
H-SMF.
##### 5.2.2.12.4 PDU session release
The following figure 5.2.2.8.4.1 describes a PDU session charging release in
roaming Home routed scenario based on figure 4.3.4.3.1 TS 23.502 [202]
description:
Figure 5.2.2.12.4.1: PDU session charging: release roaming Home Routed
2a-2b. N4 session release between H-SMF and H-UPF.
2ch_a. A Charging Data Request [Termination] is sent to CHF with the set of
QFI(s) counts.
2ch-b. The CHF closes the CDR
2ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the H-SMF.
4a-4b. N4 session release between V-SMF and V-UPF.
4ch-a. A Charging Data Request [Termination] is sent to CHF with the set of
QFI(s) counts.
4ch-b. The CHF closes the CDR
4ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the V-SMF.
#### 5.2.2.13 PDU session charging - non-3GPP access
##### 5.2.2.13.1 General
After UE registration to 5GC via an untrusted non-3GPP access network, a PDU
session can be established via this non-3GPP access, as specified in 4.12.5 TS
23.502 [202] for different scenarios:
\- UE initiated PDU session establishment;
\- Handover of a PDU Session from 3GPP access to untrusted non-3GPP access;
\- Service Request procedures via Untrusted non-3GPP Access specified in
clause 4.12.4.1 TS 23.502 [202].
Handover procedure of a PDU Session between 3GPP access and untrusted non-3GPP
access is achieved by PDU Session Establishment over source access followed by
PDU Session Release over the target access for respective N2 Resources
Release. The PDU Session ID, IP address/prefix, and SSC mode are maintained
during the move.
PDU session over Untrusted non-3GPP Access release is specified in clause
4.12.7 TS 23.502 [202].
##### 5.2.2.13.2 PDU session establishment
The following figure 5.2.2.13.2.1 describes a PDU session charging
establishment via an untrusted non-3GPP access network scenario based on
figure 4.12. 5.1 in TS 23.502 [202] description:
Figure 5.2.2.13.2.1: PDU Session establishment via untrusted non-3GPP access
[2ch-a to 2ch-c]. Two cases:
\- In case of \"Initial request\" the same steps as steps 7ch-a to 7ch-c in
figure 5.2.2.2.1 apply, for initial SMF interaction with CHF, with Charging
Data Request [Initial].
\- In case of \"Existing PDU Session\" the \"radio access type change\"
trigger may apply for SMF interaction with CHF, with Charging Data Request
[Update].
##### 5.2.2.13.3 PDU session modification
The following figure 5.2.2.13.3.1 describes a PDU session charging
modification via an untrusted non-3GPP access network scenario based on figure
4.12.16.1 in TS 23.502 [202] description:
Figure 5.2.2.13.3.1: PDU Session modification via untrusted non-3GPP access
[2ch-a to 2ch-c]: Interaction between SMF and CHF triggered by the
modification applied to the PDU session (e.g. QoS handling).
##### 5.2.2.13.4 PDU session release
The following figure 5.2.2.13.4.1 describes a PDU session charging release via
an untrusted non-3GPP access network scenario based on figure 4.12.17.1 in TS
23.502 [202] description:
Figure 5.2.2.13.4.1: PDU Session release via untrusted non-3GPP access
[3cha-3chb]. Two cases:
\- In case the PDU session needs to be released, SMF interaction with CHF for
release, with Charging Data Request [Termination].
\- In case of handover from non-3GPP access to 3GPP access, SMF may interacts
with CHF, with Charging Data Request [Update].
NOTE 1: the \"radio access type change\" trigger, if enabled, applied during
the PDU session establishment over the 3GPP access which was performed prior
to this PDU session release over non-3GPP access.
### 5.2.3 CDR generation
#### 5.2.3.1 Introduction
The CHF CDRs for PDU session charging and roaming QBC are generated by the CHF
to collect charging information that they subsequently transfer to the
Charging Gateway Function (CGF).
The following clauses describe in detail the conditions for opening, adding
information to, and closing the CHF CDR.
#### 5.2.3.2 Triggers for CHF CDR
##### 5.2.3.2.1 General
A PDU session charging CHF CDR is used to collect charging information related
to the PDU session data information for a UE in Flow Based Charging. Multiple
service data flow containers per PDU session can be added in the CHF CDR by
the CHF, upon receiving a Charging Data Request including new counts as
defined in subclause 5.2.1.1.
A CHF CDR shall be opened when the CHF receives Charging Data
Request[Initial].
As an alternative to the default CHF behaviour, the \"Individual Partial
record\" mechanism can be used based on Operator\'s policy configured in the
CHF. In this case a new CDR shall be opened for each Charging Data
Request[Initial, Update, Termination], charging information shall be added and
the CDR shall then be closed. The Sequence Number will be incremented for each
Charging Data Request[Initial, Update, Termination] received by the CHF.
##### 5.2.3.2.2 Triggers for CHF CDR charging information addition
When the CHF receives Charging Data Request[Update], with the change
conditions identified in Table 5.2.3.2.2.1 the charging information shall be
added in the PDU session charging CHF CDR, and the CDR shall remain open, as
the default supported mechanism.
Table 5.2.3.2.2.1: Triggers for CHF CDR charging information addition
* * *
Trigger Conditions Change of Charging conditions QoS change User Location
change Serving Node change Change of UE presence in Presence Reporting Area(s)
Change of 3GPP PS Data off Status Limit per Rating Group Expiry of data time
limit per RG Expiry of data volume limit per RG Expiry of data event limit per
RG Quota management triggers Time threshold reached Volume threshold reached
Unit threshold reached Time quota exhausted Volume quota exhausted Unit quota
exhausted Expiry of quota validity time Re-authorization request by CHF
* * *
In case the \"Individual Partial record\" mechanism is enabled, the Table
5.2.3.2.2.1 is not applicable. The charging information consists of a set of
containers, which are added as \"List of Multiple Unit Usage\" parameter of
the CHF CDR. Each container identifies the configured counts (volume separated
for uplink and downlink, elapsed time or number of events) per rating group or
combination of the rating group and service id, associated with the changed
charging conditions.
##### 5.2.3.2.3 Triggers for CHF CDR partial record closure
When the CHF receives Charging Data Request[Update],with the change conditions
identified in Table 5.2.3.2.3.1, the charging information shall be added in
the PDU session charging CHF CDR, before the CDR is closed and a subsequent
CHF CDR shall be opened with an incremented Sequence Number, as the default
supported mechanism.
.
Table 5.2.3.2.3.1: Triggers for CHF CDR partial record closure
* * *
Trigger Conditions Change of Charging conditions UE time zone change PLMN
change RAT type change DNN-AMBR change Removal of UPF Management intervention
Limit per PDU session Expiry of data time limit per PDU session Expiry of data
volume limit per PDU session Expiry of data event limit per PDU session Expiry
of limit of number of charging condition changes
* * *
In case the \"Individual Partial record\" mechanism is enabled, the Table
5.2.3.2.3.1 is not applicable.
##### 5.2.3.2.4 Triggers for CHF CDR closure
When the CHF receives Charging Data Request[Termination], the charging
information shall be added in the PDU session charging CHF CDR and the CDR
shall be closed.
#### 5.2.3.3 Triggers for CHF CDR for roaming QBC
##### 5.2.3.3.1 General
A Roaming QBC CHF CDR is used to collect charging information related to
Roaming QBC in V-SMF, and the PDU session charging CHF CDR is used to collect
charging information related to Roaming QBC in H-SMF. QoS flow containers per
PDU session can be added in the CHF CDRs by the CHF, upon receiving a Charging
Data Request.
The charging information received from the CHF consists of a set of
containers, which are added as \"List Multiple QFI container\" parameter of
the CHF CDRs. Each container identifies the configured counts (volume
separated for uplink and downlink, elapsed time) per QoS Flow, associated with
the changed charging conditions.
A roaming CHF CDR shall be opened when the CHF receives Charging Data
Request[Initial] indicating \"in-bound roamer\".
##### 5.2.3.3.2 Triggers for CHF CDR charging information addition for roaming
QBC
When the CHF receives Charging Data Request[Update], with the change
conditions identified in Table 5.2.3.3.2.1 the charging information shall be
added in the CHFCDR, and the CDR shall remain open, as the default supported
mechanism.
Table 5.2.3.3.2.1: Triggers for CHF CDR charging information addition for
roaming QBC
* * *
Trigger Conditions Change of Charging conditions QoS change User Location
change Serving Node change Change of UE presence in Presence Reporting Area(s)
Change of 3GPP PS Data off Status Limit per QoS Flow Expiry of data time limit
per QoS Flow Expiry of data volume limit per QoS Flow Others End of QoS Flow
* * *
In case the \"Individual partial record\" mechanism is enabled, this sub-
clause is not applicable.
##### 5.2.3.3.3 Triggers for CHF CDR partial record closure for roaming QBC
When the CHF receives Charging Data Request[Update] with the change conditions
identified in Table 5.2.3.3.3.1, the charging information shall be added in
the CHF CDR, before the CDR is closed and a subsequent CHF CDR shall be opened
with an incremented Sequence Number, as the default supported mechanism.
Table 5.2.3.3.3.1: Triggers for CHF CDR partial record closure for roaming QBC
* * *
Trigger Conditions Change of Charging conditions UE time zone change PLMN
change RAT type change DNN-AMBR change Removal of UPF Management intervention
Limit per PDU session Expiry of data time limit per PDU session Expiry of data
volume limit per PDU session Expiry of data event limit per PDU session Expiry
of limit of number of charging condition changes
* * *
In case the \"Individual partial record\" mechanism is enabled, the Table
5.2.3.3.3.1 is not relevant: instead, the charging information shall be added
in the CHF CDR, before the CDR is closed and a subsequent CHF CDR shall be
opened with an incremented Sequence Number for each Charging Data
Request[Update] received by the CHF.
##### 5.2.3.3.4 Triggers for roaming QBC CHF CDR closure
When the CHF receives Charging Data Request[Termination], the charging
information shall be added in the roaming QBC CHF CDR and the CDR shall be
closed.
### 5.2.4 Ga record transfer flows
In 5G, both fully qualified partial CDRs (FQPC) and reduced partial CDRs
(RPC), as specified in TS 32.240 [1] may be supported on the Ga interface. In
line with TS 32.240 [13], the support of FQPCs is mandatory, the support of
RPCs is optional. For further details on the Ga protocol application refer to
TS 32.295 [54].
### 5.2.5 Bd CDR file transfer
In 5G, both fully qualified partial CDRs (FQPC) and reduced partial CDRs
(RPC), as specified in TS 32.240 [1] may be supported on the Bd interface. In
line with TS 32.240 [13], the support of FQPCs is mandatory, the support of
RPCs is optional. For further details on the Bd protocol application refer to
TS 32.297 [52].
# 6\. Definition of charging information
## 6.1 Data description for 5G data connectivity charging
### 6.1.1 Message contents
#### 6.1.1.1 General
The Charging Data Request and Charging Data Response are specified in TS
32.290 [57] and include charging information. The Charging Data Request can be
of type [Initial, Update, Termination].
Table 6.1.1.1.1 describes the use of these messages for converged charging.
Table 6.1.1.1.1: Converged charging messages reference table
* * *
**Message** **Source** **Destination** Charging Data Request SMF CHF Charging
Data Response CHF SMF
* * *
The following clauses describe the different fields used in the Charging Data
messages and the category in the tables is used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [1].
#### 6.1.1.2 Charging Data Request message
Table 6.1.1.2.1 illustrates the basic structure of a Charging Data Request
message from the SMF as used for 5G data connectivity converged charging.
Table 6.1.1.2.1: Charging Data Request message contents
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Session Identifier | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Subscriber Identifier | O~M~ | Described in TS 32.290 | | | | [57] | | | | | | | | In case SUPI is not | | | | present (for emergency | | | | service), the User | | | | Equipment Info in table | | | | 6.2.1.2.1. shall be | | | | present for identifying | | | | the user. | +--------------------------+--------------+--------------------------+ | NF Consumer | M | Described in TS 32.290 | | Identification | | [57] | +--------------------------+--------------+--------------------------+ | > NF Functionality | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > NF Name | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > NF Address | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > NF PLMN ID | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Timestamp | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Sequence | M | Described in TS 32.290 | | Number | | [57] | +--------------------------+--------------+--------------------------+ | Notify URI | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Service Specification | O~C~ | Described in TS 32.290 | | Information | | [57] | +--------------------------+--------------+--------------------------+ | Triggers | O~C~ | This field is described | | | | in TS 32.290 [57] and | | | | holds the 5G data | | | | connectivity specific | | | | triggers described in | | | | clause 5.2.1. | +--------------------------+--------------+--------------------------+ | Multiple Unit Usage | O~C~ | Described in TS 32.290 | | | | [57] | | | | | | | | This field is not | | | | applicable to QBC. | +--------------------------+--------------+--------------------------+ | > Rating Group | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Requested Unit | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Used Unit Container | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Triggers | O~C~ | This field is described | | | | in TS 32.290 [57] and | | | | holds the 5G data | | | | connectivity specific | | | | triggers described in | | | | clause 5.2.1. | +--------------------------+--------------+--------------------------+ | > PDU Container | O~C~ | This field holds the 5G | | > Information | | data connectivity PDU | | | | session container | | | | specific information | | | | described in clause 6.2. | +--------------------------+--------------+--------------------------+ | > UPF ID | O~C~ | This field holds the UPF | | | | identifier used to | | | | identify the UPF. | | | | | | | | These fields shall only | | | | be included when either | | | | quota is requested per | | | | UPF, or used units are | | | | reported per UPF | +--------------------------+--------------+--------------------------+ | PDU Session Charging | O~M~ | This field holds the 5G | | Information | | data connectivity | | | | specific information | | | | described in clause 6.2. | +--------------------------+--------------+--------------------------+ | Roaming QBC information | O~M~ | This field holds the | | | | roaming QBC specific | | | | information defined in | | | | clause 6.2.1.4 | | | | | | | | This field is not | | | | applicable to FBC. | +--------------------------+--------------+--------------------------+
#### 6.1.1.3 Charging data response message
Table 6.1.1.3.1 illustrates the basic structure of a Charging Data Response
message from the CHF as used for 5G data connectivity converged charging.
Table 6.1.1.3.1: Charging Data Response message contents
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Session Identifier | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Timestamp | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Result | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Invocation Result Code | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Failed Parameter | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Failure Handling | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Sequence | M | Described in TS 32.290 | | Number | | [57] | +--------------------------+--------------+--------------------------+ | Session Failover | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Multiple Unit | O~C~ | Described in TS 32.290 | | Information | | [57] | | | | | | | | This field is not | | | | applicable to QBC. | +--------------------------+--------------+--------------------------+ | Result Code | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Rating Group | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | UPF ID | O~C~ | This field holds the UPF | | | | identifier used for | | | | quota granted per UPF by | | | | CHF | +--------------------------+--------------+--------------------------+ | Granted Unit | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Validity Time | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Final Unit Indication | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Time Quota Threshold | OC | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Volume Quota Threshold | OC | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Unit Quota Threshold | OC | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Quota Holding Time | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Triggers | O~C~ | This field is described | | | | in TS 32.290 [57] and | | | | holds the 5G data | | | | connectivity specific | | | | triggers described in | | | | clause 5.2.1. | +--------------------------+--------------+--------------------------+ | Triggers | O~C~ | This field is described | | | | in TS 32.290 [57] and | | | | holds the 5G data | | | | connectivity specific | | | | triggers described in | | | | clause 5.2.1. | +--------------------------+--------------+--------------------------+ | PDU Session Charging | O~M~ | This field holds the 5G | | Information | | data connectivity | | | | specific information | | | | described in clause 6.2. | +--------------------------+--------------+--------------------------+ | Roaming QBC Information | O~M~ | This field holds the | | | | roaming QBC specific | | | | information defined in | | | | clause 6.2.1.4 | | | | | | | | This field is not | | | | applicable to FBC. | +--------------------------+--------------+--------------------------+
### 6.1.2 Ga message contents
### 6.1.3 CDR description on the B~d~ interface
#### 6.1.3.1 General
This clause describes the CDR content and format generated for 5G data
connectivity - PDU session charging.
The following tables provide a brief description of each CDR parameter. The
category in the tables is used according to the charging data configuration
defined in clause 5.4 of TS 32.240 [1]. Full definitions of the CDR
parameters, sorted by the name in alphabetical order, are provided in TS
32.298 [51].
#### 6.1.3.2 PDU session charging CHF CDR data
If enabled, CHF CDRs for PDU session charging shall be produced for each PDU
session. In roaming Home routed scenario, the PDU session charging CHF CDR
shall cover both Flow based Charging and Qos flow Based Charging (QBC) from
H-SMF.
The fields of PDU session charging CHF CDR are specified in table 6.1.3.2.1.
Table 6.1.3.2.1: PDU session charging CHF record data
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | CHF record. | +----------------------------+----------+----------------------------+ | Recording Network Function | OM | This field holds the name | | ID | | of the recording entity, | | | | i.e. the CHF id. | +----------------------------+----------+----------------------------+ | Subscriber Identifier | OM | This field holds the 5G | | | | Subscription Permanent | | | | Identifier (SUPI) of the | | | | served party. This fields | | | | should be present except | | | | for emergency session. | +----------------------------+----------+----------------------------+ | NF Consumer Information | M | This field holds the | | | | information of the SMF | | | | that used the charging | | | | service. | +----------------------------+----------+----------------------------+ | > NF Functionality | M | This field contains the | | | | function of the node (i.e. | | | | SMF) | +----------------------------+----------+----------------------------+ | > NF Name | OC | This field holds the name | | | | of the SMF used. | +----------------------------+----------+----------------------------+ | > NF Address | OC | This fields holds the IP | | | | Address of the SMF used. | +----------------------------+----------+----------------------------+ | > NF PLMN ID | Oc | This field holds the PLMN | | | | identifier (MCC MNC) of | | | | the SMF. | +----------------------------+----------+----------------------------+ | List of Multiple Unit | OM | This field holds a list of | | Usage | | changes in charging | | | | conditions for all service | | | | data flows within this PDU | | | | session.This list is | | | | categorized per rating | | | | group or per combination | | | | of rating group and | | | | service id or per | | | | combination of rating | | | | group, sponsor identity | | | | and application service | | | | provider identity. In | | | | addition, usage is | | | | differentiated between | | | | with and without quota | | | | management. Each change is | | | | time stamped. Charging | | | | conditions are used to | | | | categorize traffic | | | | volumes, elapsed time and | | | | number of events, such as | | | | per tariff period. | +----------------------------+----------+----------------------------+ | > Rating Group | OM | This filed holds the | | | | rating group. | +----------------------------+----------+----------------------------+ | > Used Unit Container | OC | This field holds the used | | | | units and information | | | | connected to the reported | | | | units. | +----------------------------+----------+----------------------------+ | > Service Identifier | OC | This field holds the | | | | Service Identifier. | +----------------------------+----------+----------------------------+ | > Quota management | OM | This field holds an | | > Indicator | | indicator on whether the | | | | used units are with or | | | | without quota management. | +----------------------------+----------+----------------------------+ | > Triggers | OC | This field holds the | | | | reason for closing the | | | | used unit container. | +----------------------------+----------+----------------------------+ | > Trigger Timestamp | OC | This field holds the | | | | timestamp of the trigger. | +----------------------------+----------+----------------------------+ | > Time | OC | This field holds the | | | | amount of used time. | +----------------------------+----------+----------------------------+ | > Total Volume | OC | This field holds the | | | | amount of used volume in | | | | both uplink and downlink | | | | directions. | +----------------------------+----------+----------------------------+ | > Uplink Volume | OC | This field holds the | | | | amount of used volume in | | | | uplink direction. | +----------------------------+----------+----------------------------+ | > Downlink Volume | OC | This field holds the | | | | amount of used volume in | | | | downlink direction. | +----------------------------+----------+----------------------------+ | > Service Specific Unit | OC | This field holds the | | | | amount of used service | | | | specific units. | +----------------------------+----------+----------------------------+ | > Event Time Stamps | OC | This field holds the | | | | timestamps of the event | | | | reported in the Service | | | | Specific Units, if the | | | | reported units are event | | | | based. | +----------------------------+----------+----------------------------+ | > Rating Indicator | O~C~ | This field indicates if | | | | the units have been rated | | | | or not. | +----------------------------+----------+----------------------------+ | > Local Sequence Number | M | This field holds the | | | | container sequence number. | +----------------------------+----------+----------------------------+ | > PDU Container | OC | This field holds the 5G | | > Information | | data connectivity specific | | | | information defined in | | | | clause 6.2.1.3. | +----------------------------+----------+----------------------------+ | > UPF ID | OC | This field holds the UPF | | | | identifier used to | | | | identify the UPF when | | | | reporting the usage for | | | | the UPF. | +----------------------------+----------+----------------------------+ | Record Opening Time | M | Time stamp when the PDU | | | | session is activated in | | | | the SMF or record opening | | | | time on subsequent partial | | | | records. | +----------------------------+----------+----------------------------+ | Duration | M | This field holds the | | | | duration of this record. | +----------------------------+----------+----------------------------+ | Record Sequence Number | C | Partial record sequence | | | | number, only present in | | | | case of partial records. | +----------------------------+----------+----------------------------+ | Cause for Record Closing | M | The reason for the release | | | | of the record. | +----------------------------+----------+----------------------------+ | Diagnostics | OM | This field holds a more | | | | detailed reason for the | | | | release of the PDU | | | | session, when a single | | | | cause is applicable. | +----------------------------+----------+----------------------------+ | Local Record Sequence | OM | Consecutive record number | | Number | | created by the CDF. The | | | | number is allocated | | | | sequentially including all | | | | CDR types. | +----------------------------+----------+----------------------------+ | Record Extensions | OC | A set of network | | | | operator/manufacturer | | | | specific extensions to the | | | | record. Conditioned upon | | | | the existence of an | | | | extension. | +----------------------------+----------+----------------------------+ | PDU Session Charging | O~M~ | This field holds the 5G | | Information | | data connectivity specific | | | | information defined in | | | | clause 6.2.1.2. | +----------------------------+----------+----------------------------+ | Roaming QBC information | OC | This field holds the | | | | roaming QBC specific | | | | information defined in | | | | clause 6.2.1.4, when | | | | applicable. | +----------------------------+----------+----------------------------+
#### 6.1.3.3 Roaming QBC CHF CDR data
If enabled, CHF CDRs for Roaming QBC shall be produced in VPLMN for each PDU
session established for an in-bound roamer. The fields of Roaming QBC CHF CDR
are specified in table 6.1.3.3.1.
Table 6.1.3.3.1: Roaming QBC CHF record data
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | CHF record. | +----------------------------+----------+----------------------------+ | Recording Network Function | OM | This field holds the name | | ID | | of the recording entity, | | | | i.e. the CHF id. | +----------------------------+----------+----------------------------+ | Subscriber Identifier | M | This field holds the 5G | | | | Subscription Permanent | | | | Identifier (SUPI) of the | | | | served party, if | | | | available. | +----------------------------+----------+----------------------------+ | NF Information | OC | This field holds the | | | | information of the V-SMF | | | | that used the charging | | | | service. | +----------------------------+----------+----------------------------+ | > NF Functionality | M | This field contains the | | | | function of the node. | +----------------------------+----------+----------------------------+ | > NF Name | OC | This field holds the name | | | | of the V-SMF used. | +----------------------------+----------+----------------------------+ | > NF Address | OC | This fields holds the IP | | | | Address of the V-SMF used. | +----------------------------+----------+----------------------------+ | > NF PLMN ID | Oc | This field holds the PLMN | | | | identifier (MCC MNC) of | | | | the V-SMF. | +----------------------------+----------+----------------------------+ | Record Opening Time | M | Time stamp when the PDU | | | | session is activated in | | | | the SMF or record opening | | | | time on subsequent partial | | | | records. | +----------------------------+----------+----------------------------+ | Duration | M | This field holds the | | | | duration of this record. | +----------------------------+----------+----------------------------+ | Record Sequence Number | C | Partial record sequence | | | | number, only present in | | | | case of partial records. | +----------------------------+----------+----------------------------+ | Cause for Record Closing | M | The reason for the release | | | | of the record. | +----------------------------+----------+----------------------------+ | Diagnostics | OM | This field holds a more | | | | detailed reason for the | | | | release of the PDU | | | | session, when a single | | | | cause is applicable. | +----------------------------+----------+----------------------------+ | Local Record Sequence | OM | Consecutive record number | | Number | | created by the CHF. The | | | | number is allocated | | | | sequentially including all | | | | CDR types. | +----------------------------+----------+----------------------------+ | Record Extensions | OC | A set of network | | | | operator/manufacturer | | | | specific extensions to the | | | | record. Conditioned upon | | | | the existence of an | | | | extension. | +----------------------------+----------+----------------------------+ | PDU Session Charging | O~M~ | This field holds the 5G | | Information | | data connectivity specific | | | | information defined in | | | | clause 6.2.1.2. | +----------------------------+----------+----------------------------+ | Roaming QBC Information | O~M~ | This field holds the 5G | | | | data connectivity Roaming | | | | QBC specific information | | | | defined in clause 6.2.1.4 | +----------------------------+----------+----------------------------+
## 6.2 5G data connectivity charging specific parameters
### 6.2.1 Definition of 5G data connectivity charging information
#### 6.2.1.1 General
The Charging Information parameter used for 5G data connectivity charging is
provided in the following sub-clauses.
#### 6.2.1.2 Definition of PDU session charging information
PDU session specific charging information used for 5G data connectivity
charging is provided within the PDU session charging Information.
The detailed structure of the PDU Session Charging Information can be found in
table 6.2.1.2.1.
Table 6.2.1.2.1: Structure of PDU Session Charging Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Charging Id | O~M~ | This field holds the | | | | Charging Id for PDU | | | | session. | +----------------------------+----------+----------------------------+ | User Information | O~M~ | Group of user information. | +----------------------------+----------+----------------------------+ | User Identifier | O~C~ | This field contains the | | | | identification of the user | | | | (i.e. GPSI). | +----------------------------+----------+----------------------------+ | User Equipment Info | O~C~ | This field holds the | | | | identification of the | | | | terminal (i.e. PEI, MAC | | | | Address) | | | | | | | | It is used for identifying | | | | the user in case SUPI is | | | | not present during | | | | emergency service. | +----------------------------+----------+----------------------------+ | unauthenticatedFlag | O~C~ | This field indicates the | | | | served SUPI is not | | | | authenticated. | +----------------------------+----------+----------------------------+ | > Roamer In Out | O~C~ | This field holds an | | | | indication if the roamer | | | | is in-bound or out-bound. | | | | This field is present only | | | | if UE is identified as a | | | | roamer. | +----------------------------+----------+----------------------------+ | User Location Info | O~C~ | This field indicates | | | | details of where the UE is | | | | currently located | | | | (access-specific user | | | | location information). | +----------------------------+----------+----------------------------+ | User Location Time | O~C~ | The NTP time at which the | | | | UE was last known to be in | | | | the location. | +----------------------------+----------+----------------------------+ | UE Time Zone | O~C~ | This field holds the Time | | | | Zone of where the UE is | | | | located, if available | | | | where the UE currently | | | | resides. | +----------------------------+----------+----------------------------+ | Presence Reporting Area | O~C~ | This field contains part | | Information | | of the Presence Reporting | | | | Area Information of UE as | | | | defined in TS | | | | 23.501[200], comprising | | | | the Presence Reporting | | | | Area identifier(s) and an | | | | indication on whether the | | | | UE is inside or outside | | | | the Presence Reporting | | | | Area, if available. | +----------------------------+----------+----------------------------+ | PDU Session Information | M | Group of PDU session | | | | information. | +----------------------------+----------+----------------------------+ | > PDU Session ID | M | This field holds | | | | identifier of PDU session. | +----------------------------+----------+----------------------------+ | > Network Slice Instance | O~M~ | This field holds network | | > Identifier | | slice information the PDU | | | | session belongs to. | +----------------------------+----------+----------------------------+ | PDU Type | O~M~ | This field holds the type | | | | of PDU session. | +----------------------------+----------+----------------------------+ | PDU Address | Oc | Group of UE IP address. It | | | | may have multiple | | | | occurrences. | +----------------------------+----------+----------------------------+ | > PDU IP Address | O~C~ | This field holds the IP | | | | Address of the served SUPI | | | | allocated for PDU session, | | | | i.e. IPv4 address or IPv6 | | | | prefix. | +----------------------------+----------+----------------------------+ | > PDU Address prefix | O~C~ | PDP/PDN Address prefix | | > length | | length of an IPv6 typed | | | | Served PDU Address. The | | | | field needs not available | | | | for prefix length of 64 | | | | bits. | +----------------------------+----------+----------------------------+ | > Dynamic Address Flag | O~C~ | This field indicates | | | | whether served PDP/PDN | | | | address is dynamically | | | | allocated. This field is | | | | missing if address is | | | | static. | +----------------------------+----------+----------------------------+ | > SSC Mode | O~C~ | This field holds SSC mode | | | | of PDU session. | +----------------------------+----------+----------------------------+ | > SUPI PLMN ID | O~C~ | This field holds PLMN ID | | | | of the SUPI. | +----------------------------+----------+----------------------------+ | > Serving Network Function | Oc | Group of serving Network | | > ID | | Function identifier | +----------------------------+----------+----------------------------+ | > Serving Network Function | M | This field holds the | | > Functionality | | functionality of the | | | | Serving Network Function: | | | | i.e. AMF, SMF. | | | | | | | | When this field holds | | | | \"AMF\" then it is related | | | | to AMF in the same PLMN as | | | | the SMF consuming the | | | | charging service. | | | | | | | | When this field holds | | | | \"SMF\" then it is related | | | | to V-SMF for home routed | | | | roaming. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | This field holds the name | | > Name | | of the serving Network | | | | Function (i.e. AMF). | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | This field holds the IP | | > Addresses | | Addresses of the Serving | | | | Network Function. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | This field holds the FQDN | | > FQDN | | the Serving Network | | | | Function. When the the | | | | Serving Network Function | | | | is an AMF, this FQDN is | | | | the AMF name as defined in | | | | subclause 5.9.5 of | | | | 3GPP TS 23.501 [200]. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | This field holds the PLMN | | > PLMN ID | | ID of the network the | | | | Serving Network Function | | | | belongs to. | +----------------------------+----------+----------------------------+ | > AMF Identifier | O~C~ | This field holds the AMF | | | | identifier. | +----------------------------+----------+----------------------------+ | Serving CN PLMN ID | Oc | This field holds the | | | | serving Core Network | | | | Operator PLMN ID selected | | | | by the UE if different | | | | from SMF PLMN ID. | +----------------------------+----------+----------------------------+ | RAT Type | O~C~ | This field holds the Radio | | | | Access Technology (RAT) | | | | currently serving the UE. | +----------------------------+----------+----------------------------+ | > Data Network Name | M | This field contains the | | > Identifier | | identifier of the DNN the | | | | user is connected to. | +----------------------------+----------+----------------------------+ | > DNN Selection Mode | O~C~ | This field indicates | | | | whether the requested DNN | | | | corresponds to an | | | | explicitly subscribed DNN | | | | or to the usage of a | | | | wildcard subscription. | +----------------------------+----------+----------------------------+ | Authorized QoS Information | O~C~ | This field holds the | | | | authorized QoS applied to | | | | PDU session. | +----------------------------+----------+----------------------------+ | Subscribed QoS Information | O~C~ | This field holds the | | | | subscribed default QoS for | | | | the PDU session. | +----------------------------+----------+----------------------------+ | Authorized Session-AMBR | O~C~ | This field holds the | | | | authorized Session-AMBR | | | | for the PDU session. | +----------------------------+----------+----------------------------+ | Subscribed Session-AMBR | O~C~ | This field holds the | | | | subscribed Session-AMBR | | | | for the PDU session. | +----------------------------+----------+----------------------------+ | PDU session start Time | O~C~ | This field holds the | | | | timestamp when PDU session | | | | starts. | +----------------------------+----------+----------------------------+ | PDU session stop Time | O~C~ | This field holds the | | | | timestamp when PDU session | | | | terminates. | +----------------------------+----------+----------------------------+ | Diagnostics | O~C~ | This field holds a more | | | | detailed reason for the | | | | release of the PDU session | | | | and complements the | | | | \"Change Condition\" | | | | information. | +----------------------------+----------+----------------------------+ | Charging Characteristics | O~C~ | This field holds the | | | | Charging Characteristics | | | | for this PDU session. | +----------------------------+----------+----------------------------+ | Charging Characteristics | O~C~ | This field holds | | | | information about how the | | Selection Mode | | \"Charging | | | | Characteristics\" was | | | | selected. | +----------------------------+----------+----------------------------+ | 3GPP PS Data Off Status | O~C~ | This field holds the 3GPP | | | | Data off Status when UE\'s | | | | 3GPP Data Off status is | | | | Activated or Deactivated. | +----------------------------+----------+----------------------------+ | Session Stop Indicator | O~C~ | This field indicates to | | | | the CHF that the PDU | | | | session has been | | | | terminated. | +----------------------------+----------+----------------------------+ | Unit Count Inactivity | O~C~ | This field holds the | | Timer | | threshold for the time | | | | period when no units has | | | | been counted by the SMF. | | | | It holds either the value | | | | configured in SMF, if it | | | | is supported, or the value | | | | to be used as received | | | | from the CHF. A value of | | | | zero indicates that this | | | | mechanism shall not be | | | | used. | | | | | | | | This field is not | | | | applicable to QBC. | +----------------------------+----------+----------------------------+ | RAN Secondary RAT Usage | O~C~ | This field holds the | | Report | | secondary RAT usage | | | | reported from NG-RAN. | +----------------------------+----------+----------------------------+ | > NG RAN Secondary RAT | O~C~ | This field holds the value | | > Type | | of Secondary RAT Type, as | | | | provided by the NG-RAN. | +----------------------------+----------+----------------------------+ | Qos Flows Usage Reports | O~C~ | This field holds a list of | | | | containers per QFI with | | | | volumes reported, each | | | | container is time stamped. | +----------------------------+----------+----------------------------+ | QoS Flow Id | O~M~ | This field holds the QoS | | | | flow Identifier (QFI) | +----------------------------+----------+----------------------------+ | Start Timestamp | O~C~ | This field holds the start | | | | timestamp of the collected | | | | usage. | +----------------------------+----------+----------------------------+ | End Timestamp | O~C~ | This field holds the end | | | | timestamp of the collected | | | | usage. | +----------------------------+----------+----------------------------+ | Downlink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | downlink direction. | +----------------------------+----------+----------------------------+ | Uplink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | uplink direction. | +----------------------------+----------+----------------------------+
#### 6.2.1.3 Definition of PDU Container information
Used Unit container specific charging information used for 5G data
connectivity charging is provided within the PDU Container Information
described in table 6.2.1.3.1.
Table 6.2.1.3.1: Structure of PDU Container Information
* * *
Information Element Category Description Time of First Usage OC This field
holds the Timestamp when the first transmitted IP packet of the service data
flow matching the current used unit container Time of Last Usage OC This field
holds the Timestamp when the last transmitted IP packet of the service data
flow matching the current used unit container QoS Information OC This field
holds the QoS applied **during the service data container interval** AF
Correlation Information OC An identifier, provided from the AF, correlating
the measurement for the Charging key/Service identifier values in this PCC
rule with application level reports. User Location Information OC This field
holds the user **location during the** used unit **container interval** UE
Time Zone O~C~ This field holds the Time Zone of where the UE is located,
**during the** used unit **container interval**. Presence Reporting Area
Information OC This field holds the Presence Reporting Area Information of UE
**during the** used unit **container interval**. Serving Network Function ID
Oc Serving Network Function identifier. RAT Type OC This field holds the RAT
type **during the** used unit **container interval** Sponsor Identity OC This
field holds the identifier of the sponsor when sponsored data connectivity is
used Application Service Provider Identity OC This field holds the identifier
of the application service provider that is delivering a service to the end
user. Charging Rule Base Name OC This field holds the reference to group of
PCC rules predefined at the SMF 3GPP PS Data Off Status OC This field holds
the 3GPP Data off Status **during the** used unit **container interval**
* * *
#### 6.2.1.4 Definition of roaming QBC information
Roaming QBC specific charging information used for 5G data connectivity
charging is provided within the Roaming QBC Information.
The detailed structure of the Roaming QBC Information can be found in table
6.2.1.4.1.
Table 6.2.1.4.1: Structure of Roaming QBC Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Multiple QFI container | OC | This field holds a list of | | | | QFI containers. It may | | | | have multiple occurrences | +----------------------------+----------+----------------------------+ | > Triggers | OC | This field holds the | | | | reason for closing the QFI | | | | unit container. | +----------------------------+----------+----------------------------+ | > Trigger Timestamp | OC | This field holds the | | | | timestamp of the trigger. | +----------------------------+----------+----------------------------+ | > Time | OC | This field holds the | | | | amount of used time. | +----------------------------+----------+----------------------------+ | > Total Volume | OC | This field holds the | | | | amount of used volume in | | | | both uplink and downlink | | | | directions. | +----------------------------+----------+----------------------------+ | > Uplink Volume | OC | This field holds the | | | | amount of used volume in | | | | uplink direction. | +----------------------------+----------+----------------------------+ | > Downlink Volume | OC | This field holds the | | | | amount of used volume in | | | | downlink direction. | +----------------------------+----------+----------------------------+ | > Local Sequence Number | M | This field holds a QFI | | | | data container sequence | | | | number | +----------------------------+----------+----------------------------+ | QFI Container information | OC | This field holds the QFI | | | | data container information | | | | defined in clause 6.2.1.5 | +----------------------------+----------+----------------------------+ | UPF ID | OC | This field holds the UPF | | | | identifier used to | | | | identify the UPF when | | | | reporting the usage for | | | | the UPF. | +----------------------------+----------+----------------------------+ | Roaming Charging Profile | OC | This field holds the | | | | Roaming Charging Profile | | | | associated to the PDU | | | | session for roaming QBC. | +----------------------------+----------+----------------------------+ | > Trigger | OC | This field holds the | | | | trigger applicable to | | | | QBC.\ | | | | This field has multiple | | | | occurrences | +----------------------------+----------+----------------------------+ | > Trigger type | OC | This field holds the | | | | chargeable event defined | | | | in table 5.2.1.6.1. | +----------------------------+----------+----------------------------+ | > Trigger category | OC | This field holds the | | | | trigger category (i.e. | | | | immediate or deferred | | | | reporting) | +----------------------------+----------+----------------------------+ | > Time Limit | OC | This field holds the limit | | | | value in seconds when the | | | | trigger type is \"Expiry | | | | of data time limit\" | +----------------------------+----------+----------------------------+ | > Volume Limit | OC | This field holds the limit | | | | value in octets when the | | | | trigger type is \"Expiry | | | | of data volume limit\" | +----------------------------+----------+----------------------------+ | > Max Number of charging | OC | This field holds the limit | | > condition changes | | value when the trigger | | | | type is \"Expiry of limit | | | | of number of charging | | | | condition changes\" | +----------------------------+----------+----------------------------+ | > Partial record method | OC | This field holds the | | | | method uses by the CHF for | | | | partial record closure: | | | | default or Individual. | +----------------------------+----------+----------------------------+
#### 6.2.1.5 Definition of QFI Container information
Multiple Unit Usage specific charging information used for 5G data
connectivity QBC charging is provided within the QFI Container Information
described in table 6.2.1.4.1.
Table 6.2.1.4.1: Structure of QFI Container Information
* * *
Information Element Category Description QoS Flow Id M This field holds the
QoS flow Identifier (QFI) Time of First Usage OC This field holds the
Timestamp when the first transmitted IP packet of the service data flow
matching the current QFI data container Time of Last Usage OC This field holds
the Timestamp when the last transmitted IP packet of the service data flow
matching the current QFI data container QoS Information OC This field holds
the QoS applied **during the** QFI **data container interval** User Location
Information OC This field holds the user **location during the** QFI **data
container interval** UE Time Zone O~C~ This field holds the Time Zone of where
the UE is located, **during the** QFI **data container interval** Presence
Reporting Area Information OC This field holds the Presence Reporting Area
Information of UE **during the** QFI **data container interval**. RAT Type OC
This field holds the RAT type **during the** QFI **data container interval**
Report Time OC This field holds the Timestamp when the QFI data container was
closed Serving Network Function ID Oc Group of serving Network Function
identifier. 3GPP PS Data Off Status OC This field holds the 3GPP Data off
Status **during the** QFI **data container interval**
* * *
### 6.2.2 Detailed message format for converged charging
The following clause specifies per Operation Type the charging data that are
sent by SMF for 5G data connectivity converged charging.
The Operation Types are listed in the following order: I (Initial)/U
(Update)/T (Termination)/E (Event). Therefore, when all Operation Types are
possible it is marked as IUTE. If only some Operation Types are allowed for a
node, only the appropriate letters are used (i.e. IUT or E) as indicated in
the table heading. The omission of an Operation Type for a particular field is
marked with \"-\" (i.e. IU-E). Also, when an entire field is not allowed in a
node the entire cell is marked as \"-\".
Table 6.2.2.1 defines the basic structure of the supported fields in the
_Charging Data_ Request message for 5G data connectivity converged charging.
Table 6.2.2.1: Supported fields in _Charging Data Request message_
+------------------+------------------+---------------+-------------+ | **Information |** Node Type**|** SMF (FBC)**|** SMF**| | Element** | | | | | | | | **(QBC)** | +------------------+------------------+---------------+-------------+ | | **Supported |** I/U/T/E**|** I/U/T/E**| | | Operation | | | | | Types** | | | +------------------+------------------+---------------+-------------+ | Session | -UT- | -UT- | | | Identifier | | | | +------------------+------------------+---------------+-------------+ | Subscriber | IUT- | IUT- | | | Identifier | | | | +------------------+------------------+---------------+-------------+ | NF Consumer | IUT- | IUT- | | | Identification | | | | +------------------+------------------+---------------+-------------+ | Invocation | IUT- | IUT- | | | Timestamp | | | | +------------------+------------------+---------------+-------------+ | Invocation | IUT- | IUT- | | | Sequence Number | | | | +------------------+------------------+---------------+-------------+ | Notify URI | IU- | IU- | | +------------------+------------------+---------------+-------------+ | Service | IUT- | IUT- | | | Specification | | | | | Information | | | | +------------------+------------------+---------------+-------------+ | Triggers | -UT- | -UT- | | +------------------+------------------+---------------+-------------+ | Multiple Unit | IUT- | - | | | Usage | | | | +------------------+------------------+---------------+-------------+ | > Rating Group | IUT- | - | | +------------------+------------------+---------------+-------------+ | > Requested Unit | IU-- | - | | +------------------+------------------+---------------+-------------+ | > Used Unit | -UT- | - | | | > Container | | | | +------------------+------------------+---------------+-------------+ | > Triggers | -UT- | - | | +------------------+------------------+---------------+-------------+ | > PDU Container | -UT- | - | | | > Information | | | | +------------------+------------------+---------------+-------------+ | > UPF ID | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | PDU Session | IUT- | IUT- | | | Charging | | | | | Information | | | | +------------------+------------------+---------------+-------------+ | Charging Id | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | User Information | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | User Location | IUT- | IUT- | | | Info | | | | +------------------+------------------+---------------+-------------+ | UE Time Zone | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | Presence | -UT- | -UT- | | | Reporting Area | | | | | Information | | | | +------------------+------------------+---------------+-------------+ | PDU Session | IUT- | IUT- | | | Information | | | | +------------------+------------------+---------------+-------------+ | > PDU Session ID | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | > Network Slice | IUT- | IUT- | | | > Instance | | | | | > Identifier | | | | +------------------+------------------+---------------+-------------+ | > PDU Type | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | > PDU Address | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | > SSC Mode | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | > SUPI PLMN ID | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | > Serving | IUT- | IUT- | | | > Network | | | | | > Function ID | | | | +------------------+------------------+---------------+-------------+ | > Serving CN | IUT- | IUT- | | | > PLMN ID | | | | +------------------+------------------+---------------+-------------+ | > RAT Type | IUT- | IUT- | | +------------------+------------------+---------------+-------------+ | > Data Network | IUT- | IUT- | | | > Name | | | | | > Identifier | | | | +------------------+------------------+---------------+-------------+ | > DNN Selection | IUT- | IUT- | | | > Mode | | | | +------------------+------------------+---------------+-------------+ | > Authorized QoS | IUT- | IUT- | | | > Information | | | | +------------------+------------------+---------------+-------------+ | > Subscribed QoS | IUT- | IUT- | | | > Information | | | | +------------------+------------------+---------------+-------------+ | > Authorized | IUT- | IUT- | | | > Session-AMBR | | | | +------------------+------------------+---------------+-------------+ | > Subscribed | IUT- | IUT- | | | > Session-AMBR | | | | +------------------+------------------+---------------+-------------+ | > PDU session | I--- | I--- | | | > start Time | | | | +------------------+------------------+---------------+-------------+ | > PDU session | --T- | --T- | | | > stop Time | | | | +------------------+------------------+---------------+-------------+ | > Diagnostics | --T- | --T- | | +------------------+------------------+---------------+-------------+ | > Charging | IUT- | IUT- | | | > | | | | | Characteristics | | | | +------------------+------------------+---------------+-------------+ | > Charging | IUT- | IUT- | | | > | | | | | Characteristics | | | | | > Selection Mode | | | | +------------------+------------------+---------------+-------------+ | > 3GPP PS Data | IUT- | IUT- | | | > Off Status | | | | +------------------+------------------+---------------+-------------+ | > Session Stop | --T- | --T- | | | > Indicator | | | | +------------------+------------------+---------------+-------------+ | Unit Count | IU-- | - | | | Inactivity Timer | | | | +------------------+------------------+---------------+-------------+ | RAN Secondary | -UT- | -UT- | | | RAT Usage Report | | | | +------------------+------------------+---------------+-------------+ | Roaming QBC | - | IUT- | | | information | | | | +------------------+------------------+---------------+-------------+ | Multiple QFI | - | IUT- | | | container | | | | +------------------+------------------+---------------+-------------+ | UPF ID | - | IUT- | | +------------------+------------------+---------------+-------------+ | Roaming Charging | - | IU-- | | | Profile | | | | +------------------+------------------+---------------+-------------+
Table 6.2.2.2 defines the basic structure of the supported fields in the
_Charging Data_ Response message for 5G data connectivity converged charging.
Table 6.2.2.1: Supported fields in _Charging Data Response message_
+-----------------+-----------------+---------------+---------------+ | **Information |** Node Type**|** SMF (FBC)**|** SMF (QBC)**| | Element** | | | | +-----------------+-----------------+---------------+---------------+ | | **Supported |** I/U/T/E**|** I/U/T/E**| | | Operation | | | | | Types** | | | +-----------------+-----------------+---------------+---------------+ | Session | I--- | I--- | | | Identifier | | | | +-----------------+-----------------+---------------+---------------+ | Invocation | IUT- | IUT- | | | Timestamp | | | | +-----------------+-----------------+---------------+---------------+ | Invocation | IUT- | IUT- | | | Result | | | | +-----------------+-----------------+---------------+---------------+ | Invocation | IUT- | IUT- | | | Sequence Number | | | | +-----------------+-----------------+---------------+---------------+ | Session | IU-- | IUT- | | | Failover | | | | +-----------------+-----------------+---------------+---------------+ | Triggers | IU-- | IU-- | | +-----------------+-----------------+---------------+---------------+ | Multiple Unit | IU-- | - | | | information | | | | +-----------------+-----------------+---------------+---------------+ | > Result Code | IU-- | - | | +-----------------+-----------------+---------------+---------------+ | > Rating Group | IU-- | - | | +-----------------+-----------------+---------------+---------------+ | > UPF ID | IU-- | - | | +-----------------+-----------------+---------------+---------------+ | > Granted Unit | IU-- | - | | +-----------------+-----------------+---------------+---------------+ | > Validity Time | IU-- | - | | +-----------------+-----------------+---------------+---------------+ | > Final Unit | IU-- | - | | | > Indication | | | | +-----------------+-----------------+---------------+---------------+ | > Time Quota | IU-- | - | | | > Threshold | | | | +-----------------+-----------------+---------------+---------------+ | > Volume Quota | IU-- | - | | | > Threshold | | | | +-----------------+-----------------+---------------+---------------+ | > Unit Quota | IU-- | - | | | > Threshold | | | | +-----------------+-----------------+---------------+---------------+ | > Quota Holding | IU-- | - | | | > Time | | | | +-----------------+-----------------+---------------+---------------+ | > Triggers | IU-- | - | | +-----------------+-----------------+---------------+---------------+ | PDU Session | IU-- | IU-- | | | Charging | | | | | Information | | | | +-----------------+-----------------+---------------+---------------+ | Charging Id | - | - | | +-----------------+-----------------+---------------+---------------+ | User | - | - | | | Information | | | | +-----------------+-----------------+---------------+---------------+ | User Location | - | - | | | Info | | | | +-----------------+-----------------+---------------+---------------+ | UE Time Zone | - | - | | +-----------------+-----------------+---------------+---------------+ | Presence | IU-- | IU-- | | | Reporting Area | | | | | Information | | | | +-----------------+-----------------+---------------+---------------+ | PDU Session | IU-- | IU-- | | | Information | | | | +-----------------+-----------------+---------------+---------------+ | > PDU Session | - | - | | | > ID | | | | +-----------------+-----------------+---------------+---------------+ | > Network Slice | - | - | | | > Instance | | | | | > Identifier | | | | +-----------------+-----------------+---------------+---------------+ | > PDU Type | - | - | | +-----------------+-----------------+---------------+---------------+ | > PDU Address | - | - | | +-----------------+-----------------+---------------+---------------+ | > SSC Mode | - | - | | +-----------------+-----------------+---------------+---------------+ | > SUPI PLMN ID | - | - | | +-----------------+-----------------+---------------+---------------+ | > Serving | - | - | | | > Network | | | | | > Function ID | | | | +-----------------+-----------------+---------------+---------------+ | > Serving CN | - | - | | | > PLMN ID | | | | +-----------------+-----------------+---------------+---------------+ | > RAT Type | - | - | | +-----------------+-----------------+---------------+---------------+ | > Data Network | - | - | | | > Name | | | | | > Identifier | | | | +-----------------+-----------------+---------------+---------------+ | > DNN Selection | - | - | | | > Mode | | | | +-----------------+-----------------+---------------+---------------+ | > Authorized | - | - | | | > QoS | | | | | > Information | | | | +-----------------+-----------------+---------------+---------------+ | > Subscribed | - | - | | | > QoS | | | | | > Information | | | | +-----------------+-----------------+---------------+---------------+ | > Authorized | - | - | | | > Session-AMBR | | | | +-----------------+-----------------+---------------+---------------+ | > Subscribed | - | - | | | > Session-AMBR | | | | +-----------------+-----------------+---------------+---------------+ | > PDU session | - | - | | | > start Time | | | | +-----------------+-----------------+---------------+---------------+ | > PDU session | - | - | | | > stop Time | | | | +-----------------+-----------------+---------------+---------------+ | > Diagnostics | - | - | | +-----------------+-----------------+---------------+---------------+ | > Charging | - | - | | | > | | | | | Characteristics | | | | +-----------------+-----------------+---------------+---------------+ | > Charging | - | - | | | > | | | | | Characteristics | | | | | > Selection | | | | | > Mode | | | | +-----------------+-----------------+---------------+---------------+ | > 3GPP PS Data | - | - | | | > Off Status | | | | +-----------------+-----------------+---------------+---------------+ | > Session Stop | - | - | | | > Indicator | | | | +-----------------+-----------------+---------------+---------------+ | Unit Count | IU-- | - | | | Inactivity | | | | | Timer | | | | +-----------------+-----------------+---------------+---------------+ | RAN Secondary | - | - | | | RAT Usage | | | | | Report | | | | +-----------------+-----------------+---------------+---------------+ | Roaming QBC | - | IU-- | | | information | | | | +-----------------+-----------------+---------------+---------------+ | Multiple QFI | - | - | | | container | | | | +-----------------+-----------------+---------------+---------------+ | UPF ID | - | - | | +-----------------+-----------------+---------------+---------------+ | Roaming | - | IU-- | | | Charging | | | | | Profile | | | | +-----------------+-----------------+---------------+---------------+
### 6.2.3 Formal 5G data connectivity charging parameter description
#### 6.2.3.1 5G data connectivity CHF CDR parameters
The detailed definitions, abstract syntax and encoding of the PDU session
charging and Roaming QBC CHF CDRs parameters are specified in TS 32.298 [51].
#### 6.2.3.2 5G data connectivity resources attributes
The detailed definitions of resources attributes used for 5G data connectivity
charging are specified in TS 32.291 [58].
###### ## Annex A (normative): Charging Characteristics
# A.1 General
A subscriber may have Charging Characteristics assigned to his subscription
and/or his subscribed DNNs. Default Charging Characteristics may also be pre-
provisioned on the SMF.
During UE PDU session establishment, when the SMF retrieves subscription data
from the UDM, if a subscribed Charging Characteristics for the requested DNN
is identified, it may override the SMF pre-provisioned Charging
Characteristics.
The Charging Characteristics parameter consists of a string of 16 bits
designated as Behaviours (B), freely defined by Operators, as shown in TS
32.298 [51]. Each bit corresponds to a specific charging behaviour which is
configured on a per operator basis, and pointed when bit is set to \"1\"
value.
A charging behaviour is defined as an association to a specific usage designed
according to following guidance:
One usage may consist of a set of trigger profiles associated to the PDU
session in converged charging as described in the Table A.1 example:
Table A.1: Example of Charging Characteristics behaviours for SMF
+-------+-------+-------+-------+-------+-------+-------+-------+------+ | | * | | | | | | | | | | _Conv | | | | | | | | | | erged | | | | | | | | | | charg | | | | | | | | | | ing_ * | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+------+ | Beha | De | Pr | A | Time | Vol | C | T | ... | | viour | fault | imary | ctive | | | hange | ariff | | | index | cha | and | | Limit | Limit | | times | | | | rging | Seco | | | | Cond. | | | | | m | ndary | | Per | Per | | | | | | ethod | CHF | | PDU | PDU | Per | | | | | | | | se | se | PDU | | | | | | addr | | ssion | ssion | se | | | | | | esses | | | | ssion | | | +-------+-------+-------+-------+-------+-------+-------+-------+------+ | 0 | O | URI 1 | Yes | 10 | 1Mb | 2 | 0-7, | ... | | | nline | | | min | | | | | | | | URI 2 | | | | | 7-12 | | +-------+-------+-------+-------+-------+-------+-------+-------+------+ | 1 | Of | URI 1 | Yes | 15 | 5Mb | 3 | 0-24 | ... | | | fline | | | | | | | | | | | URI 2 | | min | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+------+ | 2 | O | URI 1 | Yes | 30 | 2Mb | 2 | 0-7, | ... | | | nline | | | | | | | | | | | URI 2 | | min | | | 7-12 | | +-------+-------+-------+-------+-------+-------+-------+-------+------+ | 3 | Of | URI 1 | No | - | - | - | - | ... | | | fline | | | | | | | | | | | URI 2 | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+------+ | ... | ... | ... | ... | ... | ... | ... | ... | ... | +-------+-------+-------+-------+-------+-------+-------+-------+------+
Associated to the behaviour, the following may also be configured:
\- the CHF addresses to be used by the SMF;
\- the \"Default charging method\" (online or offline) to be used as the
default one for every PCC rules of the PDU Session.
The \"Default charging method\" and CHF addresses configured in the applicable
Charging Characteristics behaviour, are superseded by \"Default charging
method\" and CHF addresses supplied by the PCF if any, during SMF interaction
with the PCF at PDU session establishment, as described in TS 23.503 [202]
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is part of a series of Technical Specifications (TSs)
that specify charging functionality and charging management in 3GPP networks.
The 3GPP core network charging architecture and principles are specified in TS
32.240 [2], which provides an umbrella for other charging management TSs that
specify:
\- the content of the CDRs per domain / subsystem / service (offline
charging);
\- the content of real-time charging messages per domain / subsystem / service
(online charging);
\- the functionality of online and offline charging for those domains /
subsystems / services;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in TS 32.240 [2].
The present document specifies the Offline and Online Charging description for
the Short Message Service (SMS), based on the functional description in TS
23.040 [7], TS 23.204 [8] for SMS over IP, and TS 23.682 [17] for SMS
procedures using T4. The present document does not replace existing offline
SMS charging functionality defined for Circuit Switched in TS 32.250 [9] and
for Packet Switched in TS 32.251 [10], and therefore is in addition to those
specifications. This charging description includes the offline and online
charging architecture and scenarios specific to SMS, as well as the mapping of
the common 3GPP charging architecture specified in TS 32.240 [2] onto SMS. It
further specifies the structure and content of the CDRs for offline charging,
and the charging events for online charging. The present document is related
to other 3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [2];
\- The parameters, abstract syntax and encoding rules for the CDRs are
specified in TS 32.298 [3];
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in TS 32.295 [6];
\- The file based mechanism used to transfer the CDRs from the network to the
operator's billing domain (e.g. the billing system or a mediation device) is
specified in TS 32.297 [5];
\- The 3GPP Diameter application that is used for SMS offline and online
charging is specified in TS 32.299 [4].
\- The services, operations and procedures of charging, using Service Based
Interface are specified in TS 32.290 [19].
\- The charging service of 5G system is specified in TS 32.291 [20].
Furthermore, requirements that govern the charging work are specified in TS
22.115 [102].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[3] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[4] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[5] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[6] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[7] 3GPP TS 23.040: \"Technical realization of Short Message Service (SMS)\".
[8] 3GPP TS 23.204: \"Support of Short Message Service (SMS) over generic 3GPP
Internet Protocol (IP) access; Stage 2\".
[9] 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
[10] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[11] 3GPP TS 32.296: \"Telecommunication management; Charging management;
Online Charging System (OCS) applications and interfaces\".
[12] IETF RFC 4006: \"Diameter Credit-Control Application\".
[13] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[14] 3GPP TS 23.038: \"Alphabets and language-specific information\".
[15] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Services (IMS) charging\".
[16] 3GPP TS 22.142: \"Value Added Services (VAS) for Short Message Service
(SMS) requirements\".
[17] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
[18] 3GPP TS 29.337: \"Diameter-based T4 interface for communications with
packet data networks and applications\".
[19] 3GPP TS 32.290: \"Telecommunication management; Charging management; 5G
system; Services, operations and procedures of charging using Service Based
Interface (SBI)\".
[20] 3GPP TS 32.291: \" Telecommunication management; Charging management 5G
system; Charging service, stage 3\".
[21]-[99] Void.
[100]-[199] Void.
[200] 3GPP TS 29.338: \"Diameter based protocols to support Short Message
Service (SMS) capable Mobile Management Entities (MMEs)\".
[201] 3GPP TS 23.501:\"System Architecture for the 5G System\".
[202] 3GPP TS 23.502:\"Procedures for the 5G System\".
[203] 3GPP TS 29.061: \"Interworking between the Public Land Mobile Network
(PLMN) supporting packet based services and Packet Data Networks (PDN)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1], TS 32.240 [2] and the following apply. A term defined in the
present document takes precedence over the definition of the same term, if
any, in TR 21.905 [1] or TS 32.240 [2].
**SMS node** : An SMS node, in the present document, refers to either an SMS
router, IP-SM-GW, SMS-SC, SMSF or a combination of these nodes.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Bsm Reference point for the CDR file transfer from SMS CGF to the BD,
Ga Reference point for CDR transfer between a CDF and the CGF.
Rf Offline charging reference point between a 3G network element and the CDF.
Ro Online charging reference point between a 3G network element and the OCS.T4
Reference point used between MTC-IWF and the SMS-SC in the HPLMN.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], TS 32.240 [2] and the following apply:
5GS 5G System
NCGI NR Cell Global Identity
# 4 Architecture considerations
## 4.1 High level SMS architecture
The high level SMS architecture is as defined in TS 23.040 [7].\ Only the SMS
Router, SMS-SC, IP-SM-GW and the SMSF are within the scope of the present
document.\ The details for the other nodes in the SMS architecture are defined
in TS 32.250 [9] and TS 32.251 [10].
## 4.2 SMS offline charging architecture
The architecture for SMS offline charging is described in figure 4.2.1
Figure 4.2.1: SMS offline charging architecture
The SMS Nodes for which this architecture applies are the SMS-SC and IP-SM-GW.
Details on the interfaces and functions can be found in TS 32.240 [2] for the
general architecture components.\ The Rf interface is described in clause
6.1.1, Ga in clause 6.1.2, and Bsm in clause 6.1.3 of this document.
## 4.3 SMS online charging architecture
For online charging, the relevant SMS nodes utilise the Ro interface and
application towards the OCS as specified in TS 32.299 [4]. The Ro reference
point covers all online charging functionality required for SMS.
The SMS online charging architecture is depicted in figure 4.3.1
Figure 4.3.1: SMS online charging architecture
Details on the interfaces and functions can be found in TS 32.240 [2] for the
general architecture components,\ TS 32.296 [11] for the OCS, and TS 32.299
[4] for the Ro application.
## 4.4 SMS converged charging architecture
The architectural options for SMS converged charging are depicted in figure
4.4.1
Figure 4.4.1: SMS converged charging architecture
The SMS Node for which this architecture applies is the SMSF.
The general architecture components can be found in TS 32.240 [2].
Ga is described in clause 5.2.4 and Bsm in clause 5.2.5 of this document, and
Nchf is described in TS 32.290 [19].
# 5 SMS charging principles and scenarios
## 5.1 SMS charging principles
### 5.1.1 General principles
The Short Message Service (SMS) comprises 5 main operational scenarios:
\- **Person to Person:** The message is sent by a UE as originator and
received by a UE as destination.
\- **Person to Application:** The message is sent by a UE as originator and
received by a third party application as destination.
\- **Application to Person:** The message is sent by a third party application
as originator and received by a UE as destination.
\- **Application to Application:** The message is sent by a third party
application as originator and received by another third party application as
destination.
\- **Device Triggering** : the message is sent on behalf of an application as
originator and received by a device as destination.
\- **MSISDN-less UE to Application via T4** : the message is sent by a MSISDN-
less UE as originator and received by a third party application as destination
(e.g. SCS/AS) in MSISDN-less MO-SMS via T4 scenario.
In addition SMS nodes may apply services such as Value Added Services (VAS)
specified in TS 22.142 [16], services defined in industry standard protocols
for SM submission from applications in a fixed network (protocols such as
SMPP, UCP/EMI, OIS, CIMD, etc.) or vendor specific services as endorsed by TS
23.040 [7]. As such, the SMS node collects charging information such as:
\- the destination and source addresses applied for an SM;
\- an indication of origination or termination handling;
\- identification of the node(s) and connection(s) involved in the SM
transaction;
\- SM validity period;
\- in scenarios involving an application / VASP, the charging information
describes the identification of the application / VASP;
\- requested SM service type.
### 5.1.2 Segmentation and concatenation
Information about concatenated messages should be sent to the charging systems
in order to apply the appropriate charging models. The charging system may be
required to be stateful to process information about segmented messages.
### 5.1.3 Triggers for generation of charging information
The following service level events shall, based on operator configuration,
trigger the generation of charging information:
\- Simple submission, except for device triggering -- based on reception at
the SMS node.
\- Enhanced submission -- based on completion of the transaction handling at
the SMS node.
\- Origination retry -- based on the enhanced submission where the initial
handling fails and a redelivery attempt is initiated.
\- Delivery, except for device triggering -- based on delivery from the SMS
node.
\- Delivery report -- reports based on the delivery to Person.
\- Termination -- Application to Person scenario only.
\- Termination retry -- Application to Person scenario only -- reattempt
delivery of an SM to a terminating entity;
\- SM Service request.
\- SMS via T4 related events specified in clause 5.1.4.
Depending on the charging model applied, a \"refund\" may be necessary for
unsuccessful delivery in online charging.
See clause 5.2 and 5.3 for detailed procedures associated with the triggers
above for offline charging and online charging respectively.
### 5.1.4 SMS via T4
For the following TS 23.682 [17] procedures using T4 interface and relying on
SMS capability, online and offline charging functionalities are based on SMS-
SC reporting chargeable events associated with the corresponding
functionalities:
\- Device Triggering Function;
\- MSISDN-less MO-SMS via T4.
For Device Triggering functionality, following chargeable events are
considered:
\- Device Trigger submitted to the SMS-SC from MTC-IWF, for request, replace
and recall;
\- SMS Delivery from the SMS-SC for Device Triggering towards the UE - based
on delivery from the SMS node;
\- SMS Delivery from the SMS-SC for Device Triggering towards the UE - based
on completion of the transaction handling at the SMS node;
The protocol description for Device Triggering functionality is detailed in TS
29.337 [18].
For MSISDN-less MO-SMS via T4 functionality, allowing MSISDN-less UE to send
small data to an SCS/AS (i.e. destination SME) using SMS-MO, the completion of
the transaction at the SMS-SC is considered, since SMS-SC store and forward
capability for MO-SMS is not used. Instead, the SMS-MO received by the SMS-SC
through MO submission TS 23.040 [12]) procedures, is directly forwarded to the
MTC-IWF through appropriate protocol for further transfer to the recipient
SCS/AS. Also, the SMS-MO delivery answer status from MTC-IWF received by the
SMS-SC is directly conveyed back to the UE.
For MSISDN-less MO-SMS via T4 functionality, the chargeable event considered
is:
\- MO-SMS via T4 submission - based on Delivery response from the MTC-IWF.
The protocol description for MSISDN-less MO-SMS via T4 functionality is
detailed in TS 29.338 [200].
## 5.2 SMS offline charging scenarios
### 5.2.1 Basic principles
SMS offline charging functionality is based on SMS Nodes reporting chargeable
events associated with SM transactions.
The SMS offline charging applies to the SMS-SC and IP-SM-GW.
SMS offline charging uses the Diameter Offline Charging as specified in TS
32.299 [4].\ Event based charging applies, with reporting achieved by sending
_Charging Data Request_ [event] to the CDF.
SMS transactions are collected independently by the SMS Node , or on
completion handling at SMS Node (enhanced submission) .
### 5.2.2 Rf message flows
#### 5.2.2.0 Introduction
The different scenarios below focus on the different message exchanges from/to
the SMS Node and the corresponding message flows between the SMS Node and the
CDF.
The sequence of messages exchanged between the SMS Node and the other nodes
are described with generic names\ (i.e SMS submit, SMS deliver), to reflect
SMS reception or sending by/from the SMS Node, independently from the protocol
conveying the SMS.
Each message flow is applicable to different Network scenario, which are
referred-to by relevant TSs.
The SMS Nodes for which these message flows apply are the SMS-SC and IP-SM-GW.
#### 5.2.2.1 SMS Submission
Figure 5.2.2.1.1 describes the scenario where UE or a third party application
originates SMS-MO destined to a recipient UE:
Figure 5.2.2.1.1: Offline charging - SMS submission to SMS Node
0) Initial procedures: see applicable Network scenario.
1) The SMS Node receives a \"SMS Submit\" incoming message originated by a UE
or a third party application.
2) The SMS Node returns \"SMS Submit Answer\" with appropriate result
associated to the reception of the SM: successfully received by SMS-SC or
failed due to error at SMS Node.
3) The SMS Node triggers a _Charging Data Charging Data Request_ with
_Operation Type_ indicating EVENT_RECORD to record successful or unsuccessful
reception of the SM, with originator identified as UE or as a third party
application, depending on the scenario.
NOTE: In the scenario where a third party application is originator, sending
application identification to the CDF allows to apply accurate charging model
of Termination scenario, i.e. recipient UE to be charged for the delivered SM,
instead of originator or both parties.
4) The CDF creates a SMO CDR and acknowledges the reception of the data.
5) Forward SMS per applicable Network scenario.
The table 5.2.2.1.1 describes the correspondence between the message in this
scenario, and the message in the different Network scenario for which it is
applicable.
Table 5.2.2.1.1: Messages mapping
+----------------------+----------------------+----------------------+ | Message | Message in Network | Reference | | | scenario | | +----------------------+----------------------+----------------------+ | _1\. SMS submit_ | 10a. Message | TS 23.040[7] | | | Transfer | | | | | Figure 18a): | | | | Successful short | | | | message transfer | | | | attempt | +----------------------+----------------------+----------------------+ | | 3. Message | TS 23.204[8] | | | | | | | | Figure 6.3: | | | | Successful | | | | encapsulated Short | | | | Message origination | | | | procedure | +----------------------+----------------------+----------------------+ | | 3. Delivery report | TS 23.204[8] | | | | | | | | Figure 6.5: Delivery | | | | report procedure | +----------------------+----------------------+----------------------+ | _2\. SMS submit | 10b. Delivery report | TS 23.040[7] | | answer_ | | | | | | Figure 18a): | | | | Successful short | | | | message transfer | | | | attempt | +----------------------+----------------------+----------------------+ | | 4. Accepted | TS 23.204[8] | | | | | | | | Figure 6.3: | | | | Successful | | | | encapsulated Short | | | | Message origination | | | | procedure | +----------------------+----------------------+----------------------+ | | 4. Accepted | TS 23.204[8] | | | | | | | | Figure 6.5: Delivery | | | | report procedure | +----------------------+----------------------+----------------------+ | _5\. Forward SMS_ | Not applicable | TS 23.040[7] | | | | | | | | Figure 18a): | | | | Successful short | | | | message transfer | | | | attempt | +----------------------+----------------------+----------------------+ | | 6. Forward short | TS 23.204[8] | | | message | | | | | Figure 6.3: | | | | Successful | | | | encapsulated Short | | | | Message origination | | | | procedure | +----------------------+----------------------+----------------------+ | | 6. Delivery report | TS 23.204[8] | | | | | | | | Figure 6.5: Delivery | | | | report procedure | +----------------------+----------------------+----------------------+
#### 5.2.2.2 SMS Delivery
Figure 5.2.2.2.1 describes the scenario where SMS Node originates SM transfer
towards the receiving party.
Figure 5.2.2.2.1: Offline charging SMS Transfer from SMS Node
0) \"SMS to deliver\" optionally received by SMS Node in order to deliver a MT
SMS towards the UE: see applicable Network scenario.
1) The SMS Node decides to forward \"SMS Deliver\" message towards the
receiving party, as a first attempt (based on step 0) or due to internal
trigger for a retry delivery of a previously failed and stored SM.
2) The SMS Node forwards the \"SMS Deliver\" message towards the receiving
party.
3) The SMS Node receives \"SMS Deliver Answer\" message as the delivery
success or failure of the SM transfer attempt.
4) The SMS Node triggers a Charging Data Request[Event] to record successful
or unsuccessful result of SM delivery.
5) The CDF creates a SMT CDR and acknowledges the reception of the data.
The table 5.2.2.2.1 describes the correspondence between the message in this
scenario, and the message in the different Network scenario for which it is
applicable.
Table 5.2.2.2.1: Messages mapping
+----------------------+----------------------+----------------------+ | Message | Message in Network | Reference | | | scenario | | +----------------------+----------------------+----------------------+ | _1\. SMS to deliver_ | Not applicable | TS 23.040[7] | | | | | | | | Figure 15a): | | | | Successful short | | | | message transfer | | | | attempt via the MSC | | | | or the SGSN | +----------------------+----------------------+----------------------+ | | 4. Forward short | TS 23.204 [8] | | | message | | | | | Figure 6.4: | | | | Successful | | | | encapsulated Short | | | | Message termination | | | | procedure | +----------------------+----------------------+----------------------+ | | 9. Submit report | TS 23.204[8] | | | | | | | | Figure 6.3: | | | | Successful | | | | encapsulated Short | | | | Message origination | | | | procedure | +----------------------+----------------------+----------------------+ | _3\. SMS deliver_ | 1a. Message transfer | TS 23.040[7] | | | | | | | | Figure 15a): | | | | Successful short | | | | message transfer | | | | attempt via the MSC | | | | or the SGSN | +----------------------+----------------------+----------------------+ | | 6. Message | TS 23.204[8] | | | | | | | | Figure 6.4: | | | | Successful | | | | encapsulated Short | | | | Message termination | | | | procedure | +----------------------+----------------------+----------------------+ | | 10. Submit report | TS 23.204[8] | | | | | | | | Figure 6.3: | | | | Successful | | | | encapsulated Short | | | | Message origination | | | | procedure | +----------------------+----------------------+----------------------+ | _4\. SMS deliver | Not shown | TS 23.040[7] | | answer_ | | | | | | Figure 15a): | | | | Successful short | | | | message transfer | | | | attempt via the MSC | | | | or the SGSN | +----------------------+----------------------+----------------------+ | | 9. OK | TS 23.204 [8] | | | | | | | | Figure 6.4: | | | | Successful | | | | encapsulated Short | | | | Message termination | | | | procedure | +----------------------+----------------------+----------------------+ | | 13. OK | TS 23.204[8] | | | | | | | | Figure 6.3: | | | | Successful | | | | encapsulated Short | | | | Message origination | | | | procedure | +----------------------+----------------------+----------------------+
#### 5.2.2.3 Delivery Report
Delivery Report or Status Report (SC informing the originating UE of the
delivery outcome of a previously submitted short message) issued by the SMS
Node uses the same procedures as the \"SMS Delivery from the SMS Node\"
described within clause 5.2.2.2, as it is contained within a new SM.
#### 5.2.2.4 Device Triggering using T4
##### 5.2.2.4.1 SMS submission to SMS-SC for Device Triggering
Figure 5.2.2.4.1.1 describes the scenario where the MTC-IWF submits a request
to SMS-SC for SM transfer towards the UE for Device Triggering purpose.
Figure 5.2.2.4.1.1: Offline charging - SMS submission to SMS-SC for Device
Triggering
1) The SMS-SC receives an incoming \"Device Trigger Request\" from an MTC-IWF
over T~4~, destined to a UE recipient.
2) The SMS-SC returns \"Device Trigger Answer\" with appropriate result
associated to the reception of the trigger request: successfully received by
SMS-SC or failed due to error at SMS-SC.
3) The SMS-SC triggers a _Charging Data Request_ with _Operation Type_
indicating EVENT_RECORD to record successful or unsuccessful reception of the
SM from the MTC-IWF, with originator identified as SCS Identity.
4) The CDF creates a SC- DVT-T4 CDR and acknowledges the reception of the
data.
##### 5.2.2.4.2 SMS Delivery from SMS-SC for Device Triggering
Figure 5.2.2.4.2.1 describes the scenario where SMS-SC originates the SMS
Device Triggering transfer towards the UE.
Figure 5.2.2.4.2.1: Offline charging - SMS delivery for Device Triggering
1) The SMS-SC decides to forward \"SMS Deliver\" message towards the receiving
party, as a first attempt upon device trigger request received from MTC-IWF,
or due to internal trigger for a retry delivery of a previously failed and
stored SM for Device Triggering, or internal trigger for a first attempt of a
previously stored SM.
2) The SMS-SC forwards the \"SMS Deliver\" message towards the receiving
party.
3) The SMS-SC receives \"SMS Deliver Answer\" message as the delivery success
or failure of the SM transfer attempt.
4) The SMS-SC triggers a Charging Data Request[Event] to record successful or
unsuccessful result of SM delivery, including a value for \"Device Triggering
indication\".
5) The CDF creates a SC-SMT CDR and acknowledges the reception of the data.
6) The SMS-SC sends \"Delivery Report Request\" to MTC-IWF with appropriate
result associated to the successful delivery of the device trigger to the UE.
7) The MTC-IWF acknowledges by sending \"Delivery Report Answer\".
##### 5.2.2.4.3 SMS Device Triggering Delivery Report
The SMS Device Triggering Delivery Report corresponds to the SMS-SC reporting
the Delivery Report of Device Trigger to the MTC-IWF in the scenario described
in clause 5.2.2.4.2. The Delivery Report itself is not a trigger for a
charging event.
##### 5.2.2.4.4 SMS submission to SMS-SC for Device Triggering - Replace
procedure
Figure 5.2.2.4.4.1 describes the scenario where the MTC-IWF submits a request
to SMS-SC for a replace procedure of Device Triggering:
Figure 5.2.2.4.4.1: Offline charging - SMS submission to SMS-SC for replace
Device Triggering
1) The SMS-SC receives an incoming \"Device Trigger Request\" indicating
\"Replace\" from an MTC-IWF over T~4~.
2) If the SMS-SC determines the trigger message identified by the External
Identifier or MSISDN, SCS Identifier, and old trigger reference number in the
received Device Trigger Replace message, is pending at SMS-SC, the new trigger
message replaces the previous one. If no trigger message is pending this
corresponds to a failed replace procedure.
3) The SMS-SC returns \"Device Trigger Answer\" with appropriate result of the
successful or unsuccessful replace procedure.
4) The SMS-SC triggers a Charging Data Request[Event] to record successful or
unsuccessful result of the replace procedure.
5) The CDF creates a SC-DVT-T4 CDR and acknowledges the reception of the data.
6) In case of successful replace, the new SM to be delivered uses the same
procedure as per clause 5.2.2.4.2.1.
##### 5.2.2.4.5 SMS submission to SMS-SC for Device Triggering - Recall
procedure
Figure 5.2.2.4.5.1 describes the scenario where the MTC-IWF submits a request
to SMS-SC for a recall procedure for Device Triggering:
Figure 5.2.2.4.5.1: Offline charging - SMS submission to SMS-SC for recall
Device Triggering
1) The SMS-SC receives an incoming \"Device Trigger Request\" indicating
\"Recall\" from an MTC-IWF over T~4~.
2) The SMS-SC determines the trigger message identified by the External
Identifier or MSISDN, SCS Identifier, and old trigger reference number in the
received Device Trigger Recall message, is pending at SMS-SC. The stored
trigger message is deleted.
3) The SMS-SC returns \"Device Trigger Answer\" with appropriate result of the
recall procedure.
4) The SMS-SC triggers a Charging Data Request[Event] to record successful or
unsuccessful result of the recall procedure.
5) The CDF creates a SC-DVT-T4 CDR and acknowledges the reception of the data.
#### 5.2.2.5 Offline charging error cases - Diameter procedures
The Offline Charging error cases in Diameter (Accounting) related procedures
associated to _Charging Data Request /Response,_ from SMS node as network
element are specified in TS 32.299 [4] clause 6.1.3.
#### 5.2.2.6 MSISDN-less SMS MO via T4
##### 5.2.2.6.1 Introduction
The message flows associated to the MSISDN-less SMS MO via T4, illustrate the
triggers occurring in the SMS-SC Node. As specified in TS 23.682 [17], the SMS
delivery procedures to SMS-SC and SMS delivery report from SMS-SC are per TS
23.040 [12], therefore involving SMS-GMSC/SMS-IWMSC depending on the scenario.
However, per this TS 23.040 [12], the interface between the SMS-GMSC/SMS-IWMSC
and the SMS-SC is out of scope of 3GPP, therefore SMS-GMSC/SMS-IWMSC are
assumed as internal to SMS-SC for the charging flows with triggers
description.
##### 5.2.2.6.2 MSISDN-less SMS MO via T4 - successful case
Figure 5.2.2.6.2.1 describes the scenario where MSISDN-less UE originates SMS-
MO destined to a recipient SCS/AS using MSISDN-less SMS MO via T4 procedure:
Figure 5.2.2.6.2.1: Offline charging MSISDN-less SMS MO via T4 -- successful
case
1) The SMS-SC receives a \"SMS Submit\" incoming message originated by a
MSISDN-less UE to deliver small data to SCS/AS.
2) The SMS-SC sends the \"MO payload delivery Request\" message to the MTC-IWF
address (as pre-configured in the SMS-SC for this SCS/AS), with the SMS
payload and the destination SME address (long/short code of the SCS/AS).
3) The MTC-IWF retrieves the external ID from the HSS (based on the IMSI of
the UE and application port ID).
4-5) The MTC-IWF forwards the SMS to the SCS/AS (received destination SME),
and receives the successful or failure answer.
6) The MTC-IWF returns a success or failure delivery indication to SMS-SC,
along with the external identifier associated to this transaction.
7) The SMS-SC triggers a _Charging Data Charging Data Request_ with _Operation
Type_ indicating EVENT_RECORD to record successful or unsuccessful delivery of
the SM.
8) The CDF creates a SC-SMO-T4 CDR and acknowledges the reception of the data.
9) The SMS-SC indicates success/failure back to UE.
##### 5.2.2.6.3 MSISDN-less SMS MO via T4 - error cases
###### 5.2.2.6.3.1 MSISDN-less SMS MO via T4 - failure at submission to SMS-SC
Figure 5.2.2.6.3.1.1 describes the scenario where MSISDN-less UE originates
SMS-MO destined to a recipient SCS/AS using MSISDN-less SMS MO via T4
procedure, and failure at submission to SMS-SC:
Figure 5.2.2.6.3.1.1: Offline charging MSISDN-less SMS MO via T4 -- failure at
submission
1) The SMS-SC receives a \"SMS Submit\" incoming message originated by a
MSISDN-less UE to deliver small data to SCS/AS.
2) Failure in handling the submitted SMS-MO in the SMS-SC.
3) The SMS-SC triggers a _Charging Data Charging Data Request_ with _Operation
Type_ indicating EVENT_RECORD to record the unsuccessful delivery of the SM.
4) The CDF creates a SC-SMO-T4 CDR and acknowledges the reception of the data.
5) The SMS-SC indicates the failure back to UE.
###### 5.2.2.6.3.2 MSISDN-less SMS MO via T4 - failure at the MTC-IWF
Figure 5.2.2.6.3.2.1 describes the scenario where MSISDN-less UE originates
SMS-MO destined to a recipient SCS/AS using MSISDN-less SMS MO via T4
procedure, and failure at the MTC-IWF:
Figure 5.2.2.6.3.2.1; Offline charging MSISDN-less SMS MO via T4 - failure at
the MTC-IWF
1) The SMS-SC receives a \"SMS Submit\" incoming message originated by a
MSISDN-less UE to deliver small data to SCS/AS.
2) The SMS-SC sends the \"MO payload delivery Request\" message to the MTC-IWF
address (as pre-configured in the SMS-SC for this SCS/AS), with the SMS
payload and the destination SME address (long/short code of the SCS/AS).
3) Failure in handling the submitted SMS-MO in the MTC-IWF.
4) The MTC-IWF returns the failure delivery indication to SMS-SC.
5) The SMS-SC triggers a _Charging Data Charging Data Request_ with _Operation
Type_ indicating EVENT_RECORD to record the unsuccessful delivery of the SM.
6) The CDF creates a SC-SMO-T4 CDR and acknowledges the reception of the data.
7) The SMS-SC indicates the failure back to UE.
### 5.2.3 CDR generation
#### 5.2.3.0 Triggers for SMS CDR generation
SMS related CDRs (i.e. SC-SMO, SC-SMT, ISM-SMO, ISM-SMT, SC-SMO-T4 and SC-
DVT-T4 CDRs) are used to collect charging information related to individual
Charging Data Request [event]. A single CDR is generated by the CDF for each
event, and subsequently transfered to the Charging Gateway Function (CGF).
#### 5.2.3.1 Triggers for SMS CDR charging information collection
The triggers for CDR creation are described in clause 5.2.3.0.
#### 5.2.3.2 Triggers for SMS CDR charging information addition
The triggers for CDR creation are described in clause 5.2.3.0.
#### 5.2.3.3 Triggers for SMS CDR closure
The triggers for CDR creation are described in clause 5.2.3.0.
### 5.2.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [6].
### 5.2.5 B~sm~ CDR file transfer
Details of the Bsm protocol application are specified in TS 32.297 [5].
## 5.3 SMS online charging scenarios
### 5.3.1 Basic principles
SMS online charging uses the Credit-Control application as specified in TS
32.299 [4].
SMS charging may use the Immediate Event Charging (IEC) principle or the Event
Charging with Unit Reservation (ECUR) principle as specified in TS 32.299 [4].
The chargeable events for subscriber charging are associated with SM
transactions.
An implementation may use either IEC or ECUR for charging events based on
operator configuration.
The units used for quota shall be service specific and based on an SM.
The selection of the OCS is implementation specific as there is no guaranteed
means of providing the OCS address to the CTF.
In addition, SMS charging may use the Refund Account principle when the
operation has not been successfully completed after an IIEC.
NOTE: For SMSIP, the IP-SM-GW may receive information relevant for online
charging through signalling in IMS.
### 5.3.2 R~o~ message flows
#### 5.3.2.1 Simple submission
This clause contains message flows for the different operation models IEC
(figure 5.3.2.1.1) and ECUR (figure 5.3.2.1.2).
Figure 5.3.2.1.1: Online charging in simple submission for IEC
1) Depending on which SMS mechanism (i.e. SMS or SMSIP) is in operation, the
SMS node receives an incoming SM-Submit or a MAP-Forward-SM.
2) The SMS node triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the origination procedures.
Figure 5.3.2.1.2: Online charging in simple submission for ECUR
1) Depending on which SMS mechanism (i.e. SMS or SMSIP) is in operation, the
SMS node receives an incoming SM-Submit or a MAP-Forward-SM.
2) The SMS node triggers a Reserve Units Request [Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the origination procedures.
6) The SM transaction is successfully acknowledged.
7) The SMS node triggers a Reserve Units Request [Terminate] message to the
OCS reporting the successful event transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Reserve Units Response message to the SMS node.
#### 5.3.2.2 Enhanced submission
The enhanced submission procedures are similar to the simple submission
procedures using ECUR. However, the trigger for Reserve Units Request
(Terminate) may be based on unsuccessful handling, e.g. negative
acknowledgement and with or without successful storage of the message for
future redelivery attempts. See failure scenarios defined in clause 5.3.2.7.
#### 5.3.2.3 Delivery report
The origination of delivery reports use the same procedures as the simple
submission procedures as described within clause 5.3.2.1. The delivery report
itself is contained within a new SM.
#### 5.3.2.4 Origination retry
This clause contains message flows for the different operation models IEC
(figure 5.3.2.4.1) and ECUR (figure 5.3.2.4.2) for redelivery attempts in the
origination direction.
Figure 5.3.2.4.1: Online charging in origination redelivery attempt for IEC
1) An SMS node internal trigger occurs to attempt a redelivery of a previously
failed and stored SM.
2) The SMS node triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the origination procedures.
Figure 5.3.2.4.2: Online charging in origination redelivery attempt for ECUR
1) An SMS node internal trigger occurs to attempt a redelivery of a previously
failed and stored SM.
2) The SMS node triggers a Reserve Units Request[Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the origination or termination procedures.
6) The SM transaction is successfully acknowledged.
7) The SMS node triggers a Reserve Units Request[Terminate] message to the OCS
reporting the successful event transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Reserve Units Response message to the SMS node.
#### 5.3.2.5 Termination charge
Figure 5.3.2.5.1: Online charging in termination for IEC
1) The SMS node receives an incoming SM-SUBMIT from an application destined
for a mobile recipient.
NOTE: This scenario differs from simple submission charging as described in
clause 5.3.2.1 in that typically the mobile recipient (instead of originator
or both parties) will be charged for such a short message.
2) The SMS node triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the termination procedures.
Figure 5.3.2.5.2: Online charging in termination for ECUR
1) The SMS node receives an incoming SM-SUBMIT from an application destined
for a mobile recipient.
NOTE: This scenario differs from simple submission charging as described in
clause 5.3.2.1 in that typically the mobile recipient (instead of originator
or both parties) will be charged for such a short message.
2) The SMS node triggers a Reserve Units Request [Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the termination procedures.
6) The SM transaction is successfully acknowledged.
7) The SMS node triggers a Reserve Units Request [Terminate] message to the
OCS reporting the successful event transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Reserve Units Response message to the SMS node.
#### 5.3.2.6 Termination charge retry
Figure 5.3.2.6.1: Online charging in termination redelivery attempt for IEC
1) An SMS node internal trigger occurs to attempt a redelivery of a previously
failed and stored SM.
2) The SMS node triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the termination procedures.
Figure 5.3.2.6.2: Online charging in termination redelivery attempt for ECUR
1) An SMS node internal trigger occurs to attempt a redelivery of a previously
failed and stored SM.
2) The SMS node triggers a Reserve Units Request[Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the termination procedures.
6) The SM transaction is successfully acknowledged.
7) The SMS node triggers a Reserve Units Request[Terminate] message to the OCS
reporting the successful event transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Reserve Units Response message to the SMS node.
#### 5.3.2.7 Unsuccessful transaction
**Unsuccessful transaction after IEC**
Figure 5.3.2.7.1 only applies where a refund action is required for
unsuccessful delivery.
Figure 5.3.2.7.1: Unsuccessful transaction after IEC
1) The SMS node receives a trigger to attempt delivery of an SM. This may be
for origination, termination or redelivery attempt.
2) The SMS node triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
origination or termination procedures.
6) The SM transaction is acknowledged as an unsuccessful transaction (either
via explicit signalling or an internal trigger).
7) The SMS node triggers a Debit Units Request (Refund Account) message to the
OCS.
8) The OCS performs the appropriate refund processing based on the received
request.
9) The OCS responds with a Debit Units Response (Refund Account) message to
the SMS node.
**Unsuccessful transaction in ECUR**
Figure 5.3.2.7.2: Unsuccessful transaction for ECUR
1) The SMS node receives a trigger occurs to attempt delivery of an SM. This
may be for origination, termination or redelivery attempt.
2) The SMS node triggers a Reserve Units Request[Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS node.
5) If authorized, the SMS node continues the SM processing as appropriate for
the origination or termination procedures.
6) The SM transaction is acknowledged as an unsuccessful transaction (either
via explicit signalling or an internal trigger).
7) The SMS node triggers a Reserve Units Request[Terminate] message to the OCS
reporting the used unit for the service to zero. This characterizes the
unsuccessful event transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Reserve Units Response message to the SMS node.
#### 5.3.2.8 IMS/SMS Interworking Messages Charging
This clause contains message flows for the different operation models IEC
(figure 5.3.2.8.1) and ECUR (figure 5.3.2.8.2) for IMS/SMS Interworking
messages in the origination direction.
Figure 5.3.2.8.1: Online charging in origination IMS/SMS Interworking Messages
for IEC
1) The IP-SM-GW receives an incoming SIP MESSAGE.
2) The IP-SM-GW parses the SIP MESSAGE.
3) The IP-SM-GW triggers a Debit Units Request message to the OCS.
4) The OCS performs the appropriate credit processing based on the received
Debit Units Request.
5) The OCS responds with a Debit Units Response message to the IP-SM-GW.
6) IP-SM-GW converts the SIP MESSAGE to 1 or n (n>=1) short messages.
7) If authorized, the IP-SM-GW forwards the segmented short messages.
Figure 5.3.2.8.2: Online charging in origination IMS/SMS Interworking Messages
for ECUR
1) The IP-SM-GW receives an incoming SIP MESSAGE.
2) The IP-SM-GW parses the SIP MESSAGE.
3) The IP-SM-GW triggers a Reserve Units Request[Initial] message to the OCS.
4) The OCS performs the appropriate credit processing based on the received
Reserve Units Request.
5) The OCS responds with a Reserve Units Response message to the IP-SM-GW.
6) IP-SM-GW converts the SIP MESSAGE to 1 or n (n>=1) short messages.
7) If authorized, the IP-SM-GW forwards segmented short messages.
8) All the short messages transactions are successfully acknowledged.
9) The IP-SM-GW triggers a Reserve Units Request[Terminate] message to the OCS
reporting the successful event transaction.
10) The OCS performs the appropriate credit processing based on the received
request.
11) The OCS responds with a Reserve Units Response message to the IP-SM-GW.
#### 5.3.2.9 Simple Submission with SM service request
This clause contains message flows for operation models IEC (figure 5.3.2.9-1)
where application of a SM service is subject to charging independent from the
SM submission.
Editors Note: Simple SM submission with SM service request for operation model
ECUR is FFS.
Figure 5.3.2.9.1: Online charging in simple submission with SM service request
for IEC
1) Depending on which SMS mechanism (i.e. SMS or SMSIP) is in operation, the
SMS node receives an incoming SM-Submit or a MAP-Forward-SM which includes a
SM service request (such as forwarding or SM copy).
2) The SMS node triggers a Debit Units Request message to the OCS for the SM
submission.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message for the SM submission
to the SMS node.
5) If normal SM processing is authorized in step 4, the SMS Node analyzes the
SM and detects that a SM service shall be applied that is subject to charging.
6) If a SM service subject to charging is detected in step 5, the SMS node
triggers an additional Debit Units Request message to the OCS for the
requested SM service.
7) The OCS performs the appropriate credit processing based on the received
request.
8) The OCS responds with a Debit Units Response message for the requested SM
service to the SMS node.
9) If authorized in step 7, the SMS node applies the requested SM service.
NOTE 1: Depending on the nature of the requested SM service, \"service
application\" may involve creating additional messages (for example in case of
a SM copy service). This is deemed part of step 9 and not otherwise shown in
this diagram.
10) If authorized in step 4, the SMS node continues the SM processing as
appropriate for the origination procedures.
NOTE 2: Authorization of SM processing is independent of the authorization for
application of a SM service.\ I.e. if authorization is for SM processing is
granted in step 4 but authorization for SM service is refused in step 8 SM
processing appropriate for the originating service continues without applying
the requested SM service.
#### 5.3.2.10 Void
#### 5.3.2.11 Device Triggering using T4
##### 5.3.2.11.1 SMS submission to SMS-SC for Device Triggering
This clause contains the message flows for the scenario where the MTC-IWF
submits a request to SMS-SC for SM transfer towards the UE for Device
Triggering purpose, in IEC operation model (figure 5.3.2.11.1.1):
Figure 5.3.2.11.1.1: Online charging - SMS submission to SMS-SC for Device
Triggering - IEC
1) The SMS-SC receives an incoming \"Device Trigger Request\" from an MTC-IWF
over T~4~, destined to a UE recipient.
2) The SMS-SC triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Debit Units Response message to the SMS-SC.
5) The SMS-SC returns \"Device Trigger Answer\" with appropriate result
associated to the reception of the trigger request: successfully received by
SMS-SC or failed due to error at SMS-SC.
##### 5.3.2.11.2 SMS Delivery from SMS-SC for Device Triggering
This clause contains message flows for the different operation models IEC
(figure 5.3.2.11.2.1) and ECUR (figure 5.3.2.11.2.2) for delivery attempts
from SMS-SC for SM transfer towards the UE for Device Triggering.
Figure 5.3.2.11.2.1: Online charging SMS Delivery retry from SMS-SC for Device
Triggering -- IEC
1) The SMS-SC decides to forward \"SMS Deliver\" message towards the receiving
party, based on same trigger as step 1 of Figure 5.2.2.4.2.1.
2) The SMS-SC triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the internal
trigger.
4) The OCS responds with a Debit Units Response message to the SMS-SC.
5) If authorized, the SMS-SC continues the SM processing for delivering the
short message to the UE.
6) The SMS-SC receives \"SMS Deliver Answer\" message as the delivery success
of the SM transfer.
7) The SMS-SC sends \"Delivery Report Request\" to MTC-IWF with appropriate
result associated to the successful delivery of the device trigger to the UE.
8) The MTC-IWF acknowledges by sending \"Delivery Report Answer\".
Figure 5.3.2.11.2.2: Online charging SMS Delivery retry from SMS-SC for Device
Triggering - ECUR
1) The SMS-SC decides to forward \"SMS Deliver\" message towards the receiving
party, based on same trigger as step 1 of Figure 5.2.2.4.2.1.
2) The SMS-SC triggers a Reserve Units Request [Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS-SC.
5) If authorized, the SMS-SC continues the SM processing for delivering the
short message to the UE.
6) The SMS-SC receives \"SMS Deliver Answer\" message as the delivery success
of the SM transfer.
7) The SMS-SC triggers a Debit Units Request[Terminate] message to the OCS
reporting the successful transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Debit Units Response message to the SMS-SC.
10) The SMS-SC sends \"Delivery Report Request\" to MTC-IWF with appropriate
result associated to the successful delivery of the device trigger to the UE.
11) The MTC-IWF acknowledges by sending \"Delivery Report Answer\".
##### 5.3.2.11.3 Unsuccessful SMS Delivery from SMS-SC for Device Triggering
This clause contains message flows for the different operation models IEC
(figure 5.3.2.11.3.1) and ECUR (figure 5.3.2.11.3.2) for unsuccessful delivery
from SMS-SC of a SM towards the UE for Device Triggering.
Figure 5.3.2.11.3.1: Online charging unsuccessful SMS Delivery from SMS-SC for
Device Triggering after IEC
1) The SMS-SC decides to forward \"SMS Deliver\" message towards the receiving
party, based on same trigger as step 1 of Figure 5.2.2.4.2.1.
2) The SMS-SC triggers a Debit Units Request message to the OCS.
3) The OCS performs the appropriate credit processing based on the internal
trigger.
4) The OCS responds with a Debit Units Response message to the SMS-SC.
5) If authorized, the SMS-SC continues the SM processing for delivering the
short message to the UE.
6) The SMS-SC receives \"SMS Deliver Answer\" message as the delivery failure
of the SM transfer attempt, or an internal trigger indicating failure.
7) The SMS-SC triggers a Debit Units Request (Refund Account) message to the
OCS.
8) The OCS performs the appropriate refund processing based on the received
request.
9) The OCS responds with a Debit Units Response (Refund Account) message to
the SMS-SC.
Figure 5.3.2.11.3.2: Online charging Unsuccessful SMS Delivery from SMS-SC for
Device Triggering after ECUR
1) The SMS-SC decides to forward \"SMS Deliver\" message towards the receiving
party, based on same trigger as step 1 of Figure 5.2.2.4.2.1.
2) The SMS-SC triggers a Reserve Units Request [Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS-SC.
5) If authorized, the SMS-SC continues the SM processing for delivering the
short message to the UE.
6) The SMS-SC receives \"SMS Deliver Answer\" message as the delivery failure
of the SM transfer attempt, or an internal trigger indicating failure.
7) The SMS-SC triggers a Debit Units Request[Terminate] message to the OCS
reporting the used unit for the service to zero, as a failed transaction.
8) The OCS performs the appropriate credit processing based on the received
request.
9) The OCS responds with a Debit Units Response message to the SMS-SC.
##### 5.3.2.11.4 SMS submission to SMS-SC for Device Triggering - Replace
procedure
Figure 5.3.2.11.4.1 describes the scenario where the MTC-IWF submits a request
to SMS-SC for a replace procedure of Device Triggering, in IEC operation
model:
Figure 5.3.2.11.4.1: Online charging - SMS submission to SMS-SC for replace
Device Triggering
1) The SMS-SC receives an incoming \"Device Trigger Request\" indicating
\"Replace\" from an MTC-IWF over T~4~.
2) The SMS-SC determines the trigger message identified by the External
Identifier or MSISDN, SCS Identifier, and old trigger reference number in the
received Device Trigger Replace message, is pending at SMS-SC: the new trigger
message replaces the previous one.
3) The SMS-SC triggers a Debit Units Request message to the OCS.
4) The OCS performs the appropriate credit processing based on the received
replace request.
5) The OCS responds with a Debit Units Response message to the SMS-SC.
6) The SMS-SC returns \"Device Trigger Answer\" with appropriate result of the
successful or unsuccessful replace procedure.
7) In case of successful replace, the new SM to be delivered uses the same
procedure as per clause 5.3.2.x.2.
##### 5.3.2.11.5 SMS submission to SMS-SC for Device Triggering - Recall
procedure
Figure 5.3.2.11.5.1 describes the scenario where the MTC-IWF submits a request
to SMS-SC for a recall procedure for Device Triggering:
Figure 5.3.2.11.5.1: Online charging - SMS submission to SMS-SC for recall
Device Triggering
1) The SMS-SC receives an incoming \"Device Trigger Request\" indicating
\"Recall\" from an MTC-IWF over T~4~.
2) The SMS-SC determines the trigger message identified by the External
Identifier or MSISDN, SCS Identifier, and old trigger reference number in the
received Device Trigger Recall message, is pending at SMS-SC: the old trigger
message is deleted.
3) The SMS-SC triggers a Debit Units Request message to the OCS.
4) The OCS performs the appropriate credit processing based on the received
recall request.
5) The OCS responds with a Debit Units Response message to the SMS-SC.
6) The SMS-SC returns \"Device Trigger Answer\" with appropriate result of the
recall procedure. In case in step 2 there was no pending Device trigger
message, a failure is reported.
#### 5.3.2.12 MSISDN-less SMS MO via T4
##### 5.3.2.12.1 Introduction
The message flows associated to the MSISDN-less SMS MO via T4, describe the
triggers occurring in the SMS-SC Node. As specified in TS 23.682 [17], the SMS
delivery procedures to SMS-SC and SMS delivery report from SMS-SC are per TS
23.040 [12], therefore involving SMS-GMSC/SMS-IWMSC depending on the scenario.
However, per this TS 23.040 [12], the interface between the SMS-GMSC/SMS-IWMSC
and the SMS-SC is out of scope of 3GPP, therefore SMS-GMSC/SMS-IWMSC are
assumed as internal to SMS-SC for the charging flows with triggers
description.\ The network does not perform any storing and forwarding
functionality for MO-SMS.
Only ECUR operation model is applicable to MSISDN-less SMS MO via T4.
NOTE: As specified in TS 23.682 [17], the external identifier associated to
the transaction is not available before the when the MO payload delivery
response is received by the SMS-SC, therefore the IEC operation model is
considered as not relevant for successful scenario.
##### 5.3.2.12.2 MSISDN-less SMS MO via T4 - successful case
Figure 5.3.2.12.2.1 describes the scenario where MSISDN-less UE originates
SMS-MO destined to a recipient SCS/AS using MSISDN-less SMS MO via T4
procedure, in ECUR operation model:
Figure 5.3.2.12.2.1: Online charging MSISDN-less SMS MO via T4 -- successful
case
1) The SMS-SC receives a \"SMS Submit\" incoming message originated by a
MSISDN-less UE to deliver small data to SCS/AS.
2) The SMS-SC triggers a Reserve Units Request[Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response message to the SMS-SC.
5) If authorized, the SMS-SC sends the \"MO payload delivery Request\" message
to the MTC-IWF address (as pre-configured in the SMS-SC for this SCS/AS), with
the SMS payload and the destination SME address (long/short code of the
SCS/AS).
6) The MTC-IWF retrieves the external ID from the HSS (based on the IMSI of
the UE and application port ID).
7_8) The MTC-IWF forwards the SMS to the SCS/AS (received destination SME),
and receives the successful answer.
9) The MTC-IWF returns the success indication to SMS-SC, along with the
external identifier associated to this transaction.
10) The SMS-SC triggers a Debit Units Request[Terminate] message to the OCS.
11) The OCS performs the appropriate credit processing based on the received
request.
12) The OCS responds with a Debit Units Response message to the SMS-SC.
13) The SMS-SC indicates success back to UE.
##### 5.3.2.12.3 MSISDN-less SMS MO via T4 - error cases
###### 5.3.2.12.3.1 MSISDN-less SMS MO via T4 - failure at submission to SMS-
SC
Figure 5.3.2.12.3.1.1 describes the scenario where MSISDN-less UE originates
SMS-MO destined to a recipient SCS/AS using MSISDN-less SMS MO via T4
procedure, and failure at submission to SMS-SC:
{width="5.152777777777778in" height="2.602777777777778in"}
Figure 5.3.2.12.3.1.1: Online charging MSISDN-less SMS MO via T4 -- failure at
submission
1) The SMS-SC receives a \"SMS Submit\" incoming message originated by a
MSISDN-less UE to deliver small data to SCS/AS.
2) The SMS-SC triggers a Reserve Units Request[Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request and identified the transaction is not authorized.
4) The OCS responds with a Reserve Units Response [Initial, NOK] message to
the SMS-SC.
5) The SMS-SC indicates failure back to UE, and will not initiate any message
towards the MTC-IWF due to this failed attempt.
###### 5.3.2.12.3.2 MSISDN-less SMS MO via T4 - failure at the MTC-IWF
Figure 5.3.2.12.3.2.1 describes the scenario where MSISDN-less UE originates
SMS-MO destined to a recipient SCS/AS using MSISDN-less SMS MO via T4
procedure, and failure at the MTC-IWF:
Figure 5.3.2.12.3.2.1; Online charging MSISDN-less SMS MO via T4 - failure at
the MTC-IWF
1) The SMS-SC receives a \"SMS Submit\" incoming message originated by a
MSISDN-less UE to deliver small data to SCS/AS.
2) The SMS-SC triggers a Reserve Units Request[Initial] message to the OCS.
3) The OCS performs the appropriate credit processing based on the received
request.
4) The OCS responds with a Reserve Units Response [Initial] message to the
SMS-SC.
5) If authorized, the SMS-SC sends the \"MO payload delivery Request\" message
to the MTC-IWF address (as pre-configured in the SMS-SC for this SCS/AS), with
the SMS payload and the destination SME address (long/short code of the
SCS/AS).
6) Failure in handling the submitted SMS-MO in the MTC-IWF, including failure
submission to the SCS/AS step 7 and 8 in Figure 5.3.2.y.2.1.
7) The MTC-IWF returns the failure delivery indication to SMS-SC.
8) The SMS-SC triggers a Debit Units Request[Terminate] message to the OCS,
reporting the used unit for the service to zero.
9) The OCS performs the appropriate credit processing based on the received
request.
10) The OCS responds with a Debit Units Response message to the SMS-SC.
11) The SMS-SC indicates failure back to UE.
### 5.3.3 Credit-Control related
#### 5.3.3.1 Triggers for stopping for an SMS Credit-Control session
Used in ECUR only, a Debit / Reserve Units Request message to terminate the
Credit-Control session is sent to OCS when:
\- Validity time for granted quota expires;
\- Granted quota runs out (i.e. a successful event has occurred);
\- Abort-Session-Request is received from the OCS.
The expiration of the validity time for quota does not require the SMS
procedures to be terminated. The CTF shall be configurable as to whether on
expiration of validity time, the service should be aborted or not; i.e.
whether the stored message should be deleted and no further (re-)delivery
attempt should be made.
#### 5.3.3.2 Triggers for providing interim information for a SMS Credit-
Control session
The provision of interim information for Credit-Control is not used in this
release of the specification, due to the use of IEC and ECUR.
## 5.4 SMS converged online and offline charging scenarios
### 5.4.1 Basic principles
#### 5.4.1.1 General
Converged charging may be performed by the SMSF interacting with CHF using
Nchf specified in TS 32.290 [19] and TS 32.291 [20]. In order to provide the
data required for the management activities outlined in TS 32.240 [2] (Credit-
Control, accounting, billing, statistics etc.), the SMSF shall be able to
perform converged charging for each of the SMS transactions.
The SMSF shall be able to perform convergent charging by interacting with CHF,
for charging data related to SMS over NAS. The Charging Data Request and
Charging Data Response are exchanged between the SMSF and the CHF, based on
PEC, IEC or ECUR scenarios specified in TS 32.290 [19]. The Charging Data
Request is issued by the SMSF towards the CHF when certain conditions
(chargeable events) are met.
Converged charging uses centralized or decentralized unit determination and
centralized rating scenarios for convergent charging IEC and ECUR specified in
TS 32.290 [19].
The contents and purpose of each charging event that triggers interaction with
CHF, as well as the chargeable events that trigger them, are described in the
following sub-clauses.
A detailed formal description of the converged charging parameters defined in
the present document is to be found in TS 32.291 [20].
A detailed formal description of the CDR parameters defined in the present
document is to be found in TS 32.298 [3].
The chargeable events or messages exchanged between the SMSF and the other
nodes are described with generic names\ (i.e SMS submit, SMS deliver), to
reflect SMS reception or sending by/from the SMSF, independently from the
protocol conveying the SMS.
#### 5.4.1.2 Applicable Triggers in the SMSF
##### 5.4.1.2.1 General
When a charging event is issued towards the CHF, it includes details such as
Subscriber identifier (e.g. SUPI).
Each trigger condition (i.e. chargeable event) defined for the SMS over NAS
converged charging functionality, is specified with the associated behaviour
when they are met.
When a MO or MT SMS is sent through the SMSF, and the converged charging is
activated, the SMSF invokes a Charging Data Request [Initial] towards the CHF
to get authorization to start in ECUR mode. In IEC mode, the Charging Data
Request [Event] is sent towards the CHF.
Table 5.4.1.2.1 summarizes the set of default trigger conditions and their
category which shall be supported by the SMSF. For \"immediate report\"
category, the table also provides the corresponding Charging Data Request
[Initial, Event, Termination] message sent from SMSF towards the CHF.
Table 5.4.1.2.1: Default Trigger conditions in SMSF
+----------+----------+----------+----------+----------+----------+ | Trigger | Trigger | Default | CHF | CHF | Message | | Co | level | category | allowed | allowed | when | | nditions | | | to | to | \"i | | | | | change | enable | mmediate | | | | | category | and | rep | | | | | | disable | orting\" | | | | | | | category | +----------+----------+----------+----------+----------+----------+ | SMS | - | I | Not | Not | IEC: | | Submit | | mmediate | Ap | Ap | Charging | | | | | plicable | plicable | Data | | | | | | | Request | | | | | | | \ | | | | | | | [Event] | | | | | | | | | | | | | | ECUR: | | | | | | | Charging | | | | | | | Data | | | | | | | Request | | | | | | | [I | | | | | | | nitial] | +----------+----------+----------+----------+----------+----------+ | _SMS to | - | I | Not | Not | IEC: | | deliver_ | | mmediate | Ap | Ap | Charging | | | | | plicable | plicable | Data | | | | | | | Request | | | | | | | \ | | | | | | | [Event] | | | | | | | | | | | | | | ECUR: | | | | | | | Charging | | | | | | | Data | | | | | | | Request | | | | | | | [Termi | | | | | | | nation] | +----------+----------+----------+----------+----------+----------+ | SMS | - | I | Not | Not | PEC: | | Submit | | mmediate | Ap | Ap | Charging | | Answer | | | plicable | plicable | Data | | | | | | | Request | | | | | | | \ | | | | | | | [Event] | +----------+----------+----------+----------+----------+----------+ | SMS | - | I | Not | Not | PEC: | | Deliver | | mmediate | Ap | Ap | Charging | | Answer | | | plicable | plicable | Data | | | | | | | Request | | | | | | | \ | | | | | | | [Event] | +----------+----------+----------+----------+----------+----------+
For converged charging, the following details of chargeable events and
corresponding actions in the SMSF are defined in Table 5.4.1.2.2:
Table 5.4.1.2.2: Chargeable events and their related actions in SMSF
+--------------------+------------+----------------------------------+ | Chargeable event | Conditions | SMSF action | +--------------------+------------+----------------------------------+ | SMS Submit | | IEC: Charging Data Request | | | | [Event] ECUR: Charging Data | | | | Request [Initial] with a | | | | possible request quota for later | | | | use | +--------------------+------------+----------------------------------+ | SMS _to deliver_ | | IEC: Charging Data Request | | | | [Event] | | | | | | | | ECUR: Charging Data Request | | | | [Termination], indicating that | | | | charging session is terminated | +--------------------+------------+----------------------------------+ | SMS Submit Answer | | PEC: Charging Data Request | | | | [Event] | +--------------------+------------+----------------------------------+ | SMS Deliver Answer | | PEC: Charging Data Request | | | | [Event] | +--------------------+------------+----------------------------------+
The CDR generation mechanism processed by the CHF upon receiving Charging Data
Request [Event, Initial, Termination] issued by the SMSF for these chargeable
events, is specified in clause 5.4.3.
#### 5.4.1.3 CHF selection
The CHF to be used by the SMSF can be:
\- Discovered via NRF upon SMS activation from AMF to SMSF.
\- SMSF locally provisioned in charging characteristics.
The option depends on Operator\'s policies.
When CHF selection by SMSF is performed via NRF based discovery:
\- For UE determined by SMSF as served by the same PLMN as the SMSF (i.e. non-
roaming scenario), the CHF of the PLMN can be discovered based on the UE
identifier.
\- For UE determined by SMSF in V-PLMN as an in-bound roamer (i.e. roaming
scenario), the CHF of the V-PLMN can be discovered based on the PLMN Id of the
UE H-PLMN.
### 5.4.2 Message flows
#### 5.4.2.1 Introduction
The different scenarios below focus on the different messages from/to the SMS
Node and corresponding interaction with the CHF, based on scenarios specified
in TS 23.502 [202] clause 4.13.3.
#### 5.4.2.2 SMS Submission - IEC
Figure 5.4.2.2.1 describes the scenario where a SMS is submitted to the SMSF
for IEC mode
Figure 5.4.2.2.1: SMS submission to SMSF for IEC
1\. Initial procedures: see applicable flows.
2\. The SMSF receives a \"SMS Submit\" incoming message originated by a UE.
2ch-a. The SMSF sends Charging Data Request[Event] to CHF for the received MO
SMS.
2ch-b. The CHF creates a CDR for this MO SMS.
2ch-c. The CHF acknowledges by sending Charging Data Response[Event] to the
SMSF.
3\. The SMSF returns \"SMS Submit Answer\" with appropriate result successful
or unsuccessful reception of the SM by the SMSF.
4\. Forward SMS per applicable flows.
The table 5.4.2.2.1 describes the correspondence between the message in this
scenario, and the message in the different Network scenario for which it is
applicable.
Table 5.4.2.2.1: Messages mapping
+----------------------+----------------------+----------------------+ | Message | Message in Network | Reference | | | scenario | | +----------------------+----------------------+----------------------+ | _2\. SMS submit_ | 2b. | TS 23.502[202] | | | Nsmsf_ | | | | SMService_UplinkSMS | Figure 4.13.3.3-1: | | | (SMS body) | MO SMS over NAS | +----------------------+----------------------+----------------------+ | | 6b. | TS 23.502[202] | | | Nsmsf_ | | | | SMService_UplinkSMS | Figure 4.13.3.6-1: | | | (Delivery report) | MT SMS over NAS in | | | | CM_IDLE state via | | | | 3GPP access | +----------------------+----------------------+----------------------+ | _3\. SMS submit | 2c. | TS 23.502[202] | | answer_ | Namf_Communication\ | | | | _N1N2MessageTransfer | Figure 4.13.3.3-1: | | | (CP Ack) | MO SMS over NAS | +----------------------+----------------------+----------------------+ | | 6c. | TS 23.502[202] | | | Namf_Communication\ | | | | _N1N2MessageTransfer | Figure 4.13.3.6-1: | | | (CP Ack) | MT SMS over NAS in | | | | CM_IDLE state via | | | | 3GPP access | +----------------------+----------------------+----------------------+ | _4\. Forward SMS_ | 3. Forward MO | TS 23.502[202] | | | | | | | | Figure 4.13.3.3-1: | | | | MO SMS over NAS | +----------------------+----------------------+----------------------+ | | 7. Delivery report | TS 23.502[202] | | | | | | | | Figure 4.13.3.6-1: | | | | MT SMS over NAS in | | | | CM_IDLE state via | | | | 3GPP access | +----------------------+----------------------+----------------------+
#### 5.4.2.3 SMS Delivery - IEC
Figure 5.4.2.3.1 describes the scenario where a SMS is delivered from the SMSF
for IEC mode
Figure 5.4.2.3.1 SMS delivery from SMSF for IEC
1\. \"SMS to deliver\" received by SMSF in order to deliver a MT SMS over NAS
towards the UE: see applicable flows.
1ch-a. The SMSF sends Charging Data Request[Event] to CHF for the MT SMS
delivery.
1ch-b. The CHF creates a CDR for this MT SMS.
1ch-c. The CHF acknowledges by sending Charging Data Response[Event] to the
SMSF.
2\. UE reachability criteria met.
3\. The SMSF forwards the \"SMS Deliver\" message towards the UE.
4\. The SMSF receives \"SMS Deliver Answer\" message as the delivery success
or failure of the SM transfer attempt.
The table 5.4.2.3.1 describes the correspondence between the message in this
scenario, and the message in the different Network scenario for which it is
applicable.
Table 5.4.2.3.1: Messages mapping
+----------------------+----------------------+----------------------+ | Message | Message in Network | Reference | | | scenario | | +----------------------+----------------------+----------------------+ | _1\. SMS to deliver_ | 3. Forward MT SM | TS 23.502[202] | | | | | | | | Figure 4.13.3.6-1: | | | | MT SMS over NAS in | | | | CM_IDLE state via | | | | 3GPP access | +----------------------+----------------------+----------------------+ | | 5. Submit report | TS 23.502[202] | | | | | | | | Figure 4.13.3.3-1: | | | | MO SMS over NAS | +----------------------+----------------------+----------------------+ | _3\. SMS deliver_ | 5. | TS 23.502[202] | | | Namf_Communication\ | | | | _N1N2MessageTransfer | Figure 4.13.3.6-1: | | | (SMS body) | MT SMS over NAS in | | | | CM_IDLE state via | | | | 3GPP access | +----------------------+----------------------+----------------------+ | | 6a. | TS 23.502[202] | | | Namf_Communication\ | | | | _N1N2MessageTransfer | Figure 4.13.3.3-1: | | | (Submit Report) | MO SMS over NAS | +----------------------+----------------------+----------------------+ | _4\. SMS deliver | 5d. | TS 23.502[202] | | answer_ | Nsmsf_ | | | | SMService_UplinkSMS | Figure 4.13.3.6-1: | | | (CP Ack) | MT SMS over NAS in | | | | CM_IDLE state via | | | | 3GPP access | +----------------------+----------------------+----------------------+ | | 6d. | TS 23.502[202] | | | Nsmsf_ | | | | SMService_UplinkSMS | Figure 4.13.3.3-1: | | | (CP Ack) | MO SMS over NAS | +----------------------+----------------------+----------------------+
#### 5.4.2.4 SMS Submission - ECUR
Figure 5.4.2.4.1 describes the scenario where a SMS is submitted to the SMSF
for ECUR mode.
Figure 5.4.2.4.1: Converged charging SMS Submission using ECUR
1\. Initial procedures: see applicable flows.
2\. The SMSF receives a \"SMS Submit\" incoming message originated by a UE.
2ch-a. The SMSF sends Charging Data Request [Initial] to CHF for authorization
for the UE to submit the SMS message.
2ch-b. The CHF opens CDR for this SMS submission.
2ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
SMSF
3\. The SMSF returns \"SMS Submit Answer\" with appropriate result successful
or unsuccessful reception of the SM by the SMSF.
4\. Forward SMS per applicable flows.
5\. \"SMS to deliver\" received by SMSF: see applicable flows.
5ch-a. The SMSF sends Charging Data Request [Termination] to the CHF for
terminating the charging associated with SMS submission.
5ch-b. The CHF closes the CDR for this SMS submission.
5ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to
the SMSF.
6\. The SMSF forwards the \"SMS Deliver\" message towards the UE.
7\. The SMSF receives \"SMS Deliver Answer\" message as the delivery success
or failure of the SM transfer attempt.
8\. Termination procedures: see applicable flows
The correspondence between \"SMS Submit/SMS Submit Answer\" and \" SMS to
deliver/SMS Deliver/ SMS Deliver Answer\" messages in this scenario, and the
messages in the different Network scenario for which they are applicable, is
described in table 5.4.2.2.1 and table 5.4.2.3.1 respectively.
#### 5.4.2.5 SMS Submission - PEC
Figure 5.4.2.5.1 describes the scenario where a SMS is submitted to the SMSF
for PEC mode
Figure 5.4.2.5.1: SMS submission to SMSF - PEC
1\. Initial procedures: see applicable flows in table 5.4.2.2.1.
2\. The SMSF receives a \"SMS Submit\" incoming message originated by a UE.
3\. The SMSF returns \"SMS Submit Answer\" with appropriate result successful
or unsuccessful reception of the SM by the SMSF.
3ch-a. The SMSF sends Charging Data Request [Event] to CHF for the received MO
SMS.
3ch-b. The CHF creates a CDR for this MO SMS.
3ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
SMSF.
4\. Forward SMS per applicable flows table 5.4.2.2.1.
#### 5.4.2.6 SMS Delivery - PEC
Figure 5.4.2.6.1 describes the scenario where a SMS is delivered from the SMSF
for PEC mode
Figure 5.4.2.6.1 SMS delivery from SMSF - PEC
1\. \"SMS to deliver\" received by SMSF in order to deliver a MT SMS over NAS
towards the UE: see applicable flows in table 5.4.2.3.1.
2\. UE reachability criteria met.
3\. The SMSF forwards the \"SMS Deliver\" message towards the UE.
4\. The SMSF receives \"SMS Deliver Answer\" message as the delivery success
or failure of the SM transfer attempt.
4ch-a. The SMSF sends Charging Data Request [Event] to CHF for the MT SMS
delivery.
4ch-b. The CHF creates a CDR for this MT SMS.
4ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
SMSF.
### 5.4.3 CDR generation
#### 5.4.3.1 Introduction
The CHF CDRs for SMS charging are generated by the CHF to collect charging
information that they subsequently transfer to the Charging Gateway Function
(CGF).
The following clauses describe in details the conditions for generating,
opening and closing the CHF CDR, which shall be supported by the CHF.
#### 5.4.3.2 Triggers for CHF CDR
##### 5.4.3.2.1 General
A SMS charging CHF CDR is used to collect charging information related to SMS
chargeable events for PEC, IEC and ECUR.
##### 5.4.3.2.2 Triggers for CHF CDR generation
A CHF CDR is generated by the CHF for each received Charging Data
Request[Event].
##### 5.4.3.2.3 Triggers for CHF CDR opening
A CHF CDR shall be opened when the CHF receives Charging Data
Request[Initial].
##### 5.4.3.2.4 Triggers for CHF CDR closure
The CHF CDR shall be closed when the CHF receives Charging Data
Request[Termination].
### 5.4.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [6].
### 5.4.5 B~sm~ CDR file transfer
Details of the Bsm protocol application are specified in TS 32.297 [5].
# 6 Definition of charging information
## 6.1 Data description for SMS offline charging
### 6.1.1 R~f~ message contents
#### 6.1.1.1 Summary of offline charging message formats
The SMS Node generates accounting information that can be transferred from the
CTF to the CDF. For this purpose, SMS offline charging utilizes the _Charging
Data Transfer Operation_ that is specified in the 3GPP accounting application
described in TS 32.299 [4].
The _Charging Data Transfe_ r operation employs the _Charging Data Request_
and _Charging Data Response_ messages.\ Table 6.1.1.1.1 describes the use of
these messages for offline charging.
Table 6.1.1.1.1: Offline charging messages reference table
+--------------------------+--------+-------------+ | Command-Name | Source | Destination | +--------------------------+--------+-------------+ | _Charging Data Request_ | CTF | > CDF | +--------------------------+--------+-------------+ | _Charging Data Response_ | CDF | > CTF | +--------------------------+--------+-------------+
This clause describes the different fields used in the Charging Data messages
and the category in the tables are used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [2].
#### 6.1.1.2 Structure for the offline charging message formats
##### 6.1.1.2.1 Charging Data Request message
Table 6.1.1.2.1.1 illustrates the basic structure of a _Charging Data Request_
message as used for SMS offline charging.
Table 6.1.1.2.1.1: Charging Data Request message contents
* * *
Information Element Category Description
Session Identifier M Described in TS 32.299 [4]
Originator Host M Described in TS 32.299 [4]
Originator Domain M Described in TS 32.299 [4]
Destination Domain M Described in TS 32.299 [4]
Operation Type M This field contains event type transfer\ (immediate event
based charging).
Operation Number M Described in TS 32.299 [4]
Operation Identifier O~M~ Described in TS 32.299 [4]
User Name O~C~ This field contains the identification of the source node.
Origination Timestamp O~C~ Described in TS 32.299 [4]
Proxy Information O~C~ Described in TS 32.299 [4]
Route Information O~C~ Described in TS 32.299 [4]
Operation Token O~M~ This field contains the service context, i.e. SMS
charging.
Service Information O~M~ This field holds the 3GPP specific SMS parameter.\
Described in clause 6.3.
* * *
##### 6.1.1.2.2 Charging Data Response message
Table 6.1.1.2.2.1 illustrates the basic structure of a _Charging Data
Response_ message as used for SMS offline charging.
Table 6.1.1.2.2.1: Charging Data Response Message Contents
* * *
Information Element Category Description
Session Identifier M Described in TS 32.299 [4]
Operation Result M Described in TS 32.299 [4]
Originator Host M Described in TS 32.299 [4]
Originator Domain M Described in TS 32.299 [4]
Operation Type M This field contains event type transfer\ (immediate event
based charging).
Operation Number M Described in TS 32.299 [4]
Operation Identifier O~M~ Described in TS 32.299 [4]
User Name O~C~ This field contains the identification of the source node.
Destination Host O~C~ Described in TS 32.299 [4]
Error Reporting Host O~C~ Described in TS 32.299 [4]
Origination Timestamp O~C~ Described in TS 32.299 [4]
Proxy Information O~C~ Described in TS 32.299 [4]
* * *
### 6.1.2 G~a~ message contents
Refer to clause 5.2.4 for further information.
### 6.1.3 CDR description on the B~sm~ interface
#### 6.1.3.1 CDR field types
The following Standard CDR content and format are considered:
\- generated from SMS-SC:
\- SC-SMO CDR;
\- SC-SMT CDR;
\- SC-SMO-T4 CDR;
\- SC-DVT-T4 CDR.
\- generated from IP-SM-GW:
\- ISM-SMO CDR;
\- ISM-SMT CDR.
Thecontent of each CDR type is defined in the tables in clauses 6.1.3.3 to
6.1.3.8.
For each CDR type the field definition includes the field name, category and
description. The category in the tables are used according to the charging
data configuration defined in clause 5.4 of TS 32.240 [2].
The detailed specification of the CDR parameters and their encoding is
contained in TS 32.298 [3], while TS 32.297 [5] specifies the details of the
CDR file transfer to the Billing Domain (BD). Additional CDR formats and
contents may be available at the interface to the billing system to meet the
requirements of the Billing System (BS), these are outside of the scope of
3GPP standardization.
#### 6.1.3.2 CDR triggers
The generation of the SMS related CDRs is based on reception of Charging Data
Request[event] messages transferred from the SMS node to the CDF. One CDR is
created in the CDF for each Charging Data Request[event] message received.
#### 6.1.3.3 SC-SMO CDR content
The content of SC-SMO CDR is defined in the table 6.1.3.3.1.
Table 6.1.3.3.1: SC-SMO record
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | SMS-SC SMS originated. | +----------------------------+----------+----------------------------+ | SMS Node Address | M | This field holds the | | | | address (e.g. E.164) of | | | | the SMS-service centre | | | | sending the Charging Data | | | | Request used for producing | | | | the record. (SMSC Address) | +----------------------------+----------+----------------------------+ | Originator Info | O**~M~** | This field is a grouped | | | | field and holds | | | | information on originator | | | | of the SM. | +----------------------------+----------+----------------------------+ | > Originator IMSI | O**~M~** | This field holds the IMSI | | | | of the subscriber sending | | | | the short message, in case | | | | of Mobile Originating | | | | message, if available. | +----------------------------+----------+----------------------------+ | > Originator MSISDN | O**~C~** | This field holds the | | | | primary MSISDN of the | | | | subscriber sending the | | | | message, if available. | +----------------------------+----------+----------------------------+ | > Originator Other Address | O**~M~** | This field holds the | | | | address of the originator | | | | of the SM, when different | | | | from IMSI and MSISDN, if | | | | available: e.g. email, | | | | short code. Multiple | | | | addresses may be carried. | +----------------------------+----------+----------------------------+ | > Originator SCCP Address | O**~C~** | This field holds the SCCP | | | | calling address used to | | | | receive the SM at the SMS | | | | node, when applicable. | +----------------------------+----------+----------------------------+ | > Originator Received | O**~C~** | This field holds the | | > Address | | original, unmodified | | | | address of the originator | | | | of the SM, as received by | | | | the SMS node, in case | | | | address manipulation (such | | | | as number plan | | | | corrections) have been | | | | applied in the SMS node. | +----------------------------+----------+----------------------------+ | > SM Originator Interface | O**~M~** | This field contains | | | | information describing the | | | | interface on which the SM | | | | was received by the SMS | | | | node. | | | | | | | | In case the charging event | | | | is for application to | | | | person messaging or for | | | | application to application | | | | messaging (see clause | | | | 5.1.1) this field holds | | | | the identification of the | | | | application sending the | | | | SM. | +----------------------------+----------+----------------------------+ | > SM Originator Protocol | O**~C~** | This field holds the | | > Id | | TP-PROTOCOL-ID (TP-PID) as | | | | defined in TS 23.040 [7] | | | | describing the protocol | | | | used for the SM by | | | | originator. | +----------------------------+----------+----------------------------+ | Recipient Info | O**~M~** | This field is a grouped | | | | field and holds recipient | | | | information for the SM. | | | | | | | | Multiple occurrences of | | | | this field are allowed in | | | | case:\ | | | | - multiple recipients are | | | | associated with the | | | | charged event and | | | | | | | | - all other charging | | | | information is identical | | | | for all recipients. | +----------------------------+----------+----------------------------+ | > Recipient IMSI | O~C~ | This field holds the IMSI | | | | of the recipient of the | | | | SM, as received by the SMS | | | | Node, if available. | +----------------------------+----------+----------------------------+ | > Recipient MSISDN | O~C~ | This field holds the | | | | MSISDN of the recipient of | | | | the SM, as received by the | | | | SMS Node, if available. | +----------------------------+----------+----------------------------+ | > Recipient Other Address | O~C~ | This field holds the | | | | address of the recipient | | | | of the SM, as received by | | | | the SMS Node, when | | | | different from IMSI and | | | | MSISDN, if available: e.g. | | | | email, short code, | | | | external identifier. | | | | Multiple addresses may be | | | | carried. | +----------------------------+----------+----------------------------+ | > Recipient Received | O~C~ | This field holds the | | > Address | | original, unmodified | | | | address of the recipient | | | | of the SM, as received by | | | | the SMS node, in case | | | | address manipulation (such | | | | as number plan | | | | corrections) have been | | | | applied in the SMS node. | +----------------------------+----------+----------------------------+ | > SM Destination Interface | O~M~ | This is a structured field | | | | containing information | | | | describing the interface | | | | on which the SM is to be | | | | delivered (i.e. the next | | | | hop). | | | | | | | | In case the charging event | | | | is for person to | | | | application messaging or | | | | for application to | | | | application messaging (see | | | | clause 5.1.1) this field | | | | holds the identification | | | | of the application. | +----------------------------+----------+----------------------------+ | Served IMEI | O~C~ | The field holds IMEI or | | | | IMEISV of the UE, if | | | | available | +----------------------------+----------+----------------------------+ | Event Time stamp | M | This field holds the | | | | timestamp of when the | | | | submitted SM arrived at | | | | the SMS-SC. | +----------------------------+----------+----------------------------+ | Message Reference | M | This field holds the | | | | identity used to identify | | | | an SM in the SMS node | | | | associated with entity | | | | that submitted it, and | | | | corresponds to the | | | | TP-Message-Reference | | | | (TP-MR) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | SM Total Number | O~C~ | This field holds the total | | | | number of short messages | | | | when this SM is part of | | | | concatenated short | | | | message. This field is | | | | present only in case of | | | | concatenated short | | | | message. | +----------------------------+----------+----------------------------+ | SM sequence Number | O**~C~** | This field holds the | | | | sequence number of this SM | | | | within the concatenated | | | | short message when | | | | applicable. This field is | | | | present only in case of | | | | concatenated short | | | | message. | +----------------------------+----------+----------------------------+ | Message size | O**~C~** | This field holds the | | | | length of the user data | | | | part of the SM, and | | | | corresponds to the | | | | TP-User-Data-Length | | | | (TP-UDL) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | Message Class | O~M~ | Used as defined in TS | | | | 32.270 [13]. It is | | | | implementation dependent | | | | the value selected for a | | | | specific transaction. | +----------------------------+----------+----------------------------+ | SM Delivery Report | O**~C~** | This field holds | | Requested | | indication whether a | | | | delivery report is | | | | requested by the SM | | | | originator, and | | | | corresponds to the | | | | TP-Status-Report-Request | | | | (TP-SRR) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | SM Data Coding Scheme | O**~M~** | This field holds the data | | | | coding scheme used within | | | | the SM. The information to | | | | populate this field is | | | | obtained from TP-DCS | | | | header. | +----------------------------+----------+----------------------------+ | SM Message Type | O**~M~** | This field identifies the | | | | message that triggered the | | | | generation of charging | | | | information. | +----------------------------+----------+----------------------------+ | SM Reply Path Requested | O**~c~** | This field holds an | | | | indication of whether a | | | | reply SM to an original SM | | | | shall follow the same path | | | | as identified by the | | | | TP-Reply-Path (TP-RP) | | | | flag. | +----------------------------+----------+----------------------------+ | SM User Data Header | O**~c~** | This field carries the | | | | user data header extracted | | | | from the user data of the | | | | SM. The user data header | | | | (TP-UDH) is specified in | | | | TS 23.040 [7] | +----------------------------+----------+----------------------------+ | User Location Info | O**~c~** | This field holds the | | | | information about the | | | | location of the subscriber | | | | as defined in TS 29.061 | | | | [203] | | | | \"3GPP- | | | | User-Location-Info\"during | | | | the SMS transaction, in | | | | case of Mobile Originating | | | | message, if available. | | | | | | | | \"NCGI\", \"5GS TAI\", | | | | \"5GS TAI and NCGI\", | | | | \"NG-RAN Node ID\" and | | | | \"5GS TAI and NG-RAN Node | | | | ID\" values are | | | | applicable. | +----------------------------+----------+----------------------------+ | RAT Type | O**~c~** | This field holds the Radio | | | | Access Technology (RAT) | | | | type used for the SMS | | | | transaction, in case of | | | | Mobile Originating | | | | message, if available. | +----------------------------+----------+----------------------------+ | UE Time Zone | O**~c~** | This field indicates the | | | | offset between universal | | | | time and local time in | | | | steps of 15 minutes of | | | | where the UE currently | | | | resides, in case of Mobile | | | | Originating message, if | | | | available. | +----------------------------+----------+----------------------------+ | SMS Result | C | The field holds the result | | | | of the attempted SM | | | | submission, if | | | | unsuccessful. | +----------------------------+----------+----------------------------+ | Record extensions | O**~C~** | A set of network/ | | | | manufacturer specific | | | | extensions to the record, | | | | when available. | +----------------------------+----------+----------------------------+
#### 6.1.3.4 SC-SMT CDR content
The content of SC-SMT CDR is defined in table 6.1.3.4.1.
Table 6.1.3.4.1: SC-SMT record
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | SMS-SC SMS Terminated. | +----------------------------+----------+----------------------------+ | SMS Node Address | M | This field holds the | | | | address (e.g. E.164) of | | | | the SMS-service centre | | | | sending the Charging Data | | | | Request used for producing | | | | the record. (SMSC | | | | Address). | +----------------------------+----------+----------------------------+ | Recipient Info | O**~M~** | This field is a grouped | | | | field and holds | | | | information on the | | | | recipient for the SM. | +----------------------------+----------+----------------------------+ | > Recipient IMSI | O**~M~** | The IMSI of the subscriber | | | | the short message was | | | | delivered to, in case of | | | | Mobile Terminating | | | | message, if available. | +----------------------------+----------+----------------------------+ | > Recipient MSISDN | O**~C~** | The primary MSISDN of the | | | | subscriber the short | | | | message was delivered to, | | | | if available. | +----------------------------+----------+----------------------------+ | > Recipient Other Address | Oc | This field holds the | | | | address of the recipient | | | | of the SM, when different | | | | from IMSI and MSISDN, if | | | | available: e.g. email, | | | | short code. Multiple | | | | addresses may be carried. | | | | | | | | This field holds the | | | | external identifier of the | | | | recipient of the SM, when | | | | the SM is to be delivered | | | | for Device Trigger, if | | | | available. | +----------------------------+----------+----------------------------+ | > Recipient SCCP Address | O~C~ | This field holds the SCCP | | | | called address used by the | | | | SMS node to onward deliver | | | | the SM. | +----------------------------+----------+----------------------------+ | > Recipient Received | O~C~ | This field holds the | | > Address | | original, unmodified | | | | address of the recipient | | | | of the SM, as received by | | | | the SMS node, in case | | | | address manipulation (such | | | | as number plan | | | | corrections) have been | | | | applied in the SMS node. | +----------------------------+----------+----------------------------+ | > SM Destination Interface | O~M~ | This is a structured field | | | | containing information | | | | describing the interface | | | | on which the SM was | | | | requested to be delivered | | | | (i.e. the next hop). | | | | | | | | In case the charging event | | | | is for person to | | | | application messaging or | | | | for application to | | | | application messaging (see | | | | clause 5.1.1) this field | | | | holds the identification | | | | of the application. | | | | | | | | In case the SM is for | | | | Device Trigger, thisfield | | | | is not present . | +----------------------------+----------+----------------------------+ | > SM Recipient Protocol Id | O~C~ | This field holds the | | | | TP-PROTOCOL-ID (TP-PID) as | | | | defined in TS 23.040 | | | | [7]. | | | | | | | | In case the SM is for | | | | Device Trigger, this field | | | | holds the \"Device | | | | Triggering Short Message | | | | code\". | +----------------------------+----------+----------------------------+ | Originator Info | O**~M~** | This field is a grouped | | | | field and holds | | | | information on the | | | | originator of the SM, if | | | | available. | +----------------------------+----------+----------------------------+ | > Originator IMSI | O**~M~** | This field holds the IMSI | | | | of the subscriber | | | | originator of the SM, if | | | | available. | +----------------------------+----------+----------------------------+ | > Originator MSISDN | O**~C~** | This field holds the | | | | MSISDN of the subscriber | | | | originator of the SM, if | | | | available. | +----------------------------+----------+----------------------------+ | > Originator Other Address | O**~M~** | This field holds the | | | | address of the originator | | | | of the SM, when different | | | | from IMSI and MSISDN, if | | | | available: e.g. | | | | short-code. Multiple | | | | addresses may be carried. | | | | | | | | In case the SM is for | | | | Device Trigger, this field | | | | holds the SME address of | | | | the Service Capability | | | | Server that is requesting | | | | a device trigger to the UE | | | | as specified in TS 29.337 | | | | [18]. | +----------------------------+----------+----------------------------+ | > Originator Received | O~C~ | This field holds the | | > Address | | original, unmodified | | | | address of the originator | | | | of the SM, as received by | | | | the SMS node, in case | | | | address manipulation (such | | | | as number plan | | | | corrections) have been | | | | applied in the SMS node. | +----------------------------+----------+----------------------------+ | > SM Originator Interface | O~C~ | This field contains | | | | information describing the | | | | interface on which the SM | | | | was received by the SMS | | | | node. | | | | | | | | In case the charging event | | | | is for application to | | | | person messaging or for | | | | application to application | | | | messaging (see clause | | | | 5.1.1) this field holds | | | | the identification of the | | | | application sending the | | | | SM. | | | | | | | | In case the SM is for | | | | Device Trigger, thisfield | | | | is not present . | +----------------------------+----------+----------------------------+ | Served IMEI | OC | The field holds IMEI or | | | | IMEISV of the UE, if | | | | available. | +----------------------------+----------+----------------------------+ | Submission Time | O~C~ | This field holds the | | | | timestamp of when the | | | | submitted SM arrived at | | | | the originating SMS Node. | | | | The information to | | | | populate this field is | | | | obtained from the | | | | TP | | | | -Service-Center-Time-Stamp | | | | (TP-SCTS) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | Event Time stamp | M | This field holds the | | | | timestamp of result | | | | (successful or | | | | unsuccessful) of SM | | | | delivery: last result in | | | | case of multiple retries. | +----------------------------+----------+----------------------------+ | SM Priority | O**~c~** | This field holds any | | | | priority information | | | | associated with an SM, as | | | | defined in TS 23.040 | | | | [7]. | +----------------------------+----------+----------------------------+ | Message Reference | O**~M~** | This field holds the | | | | identity used to identify | | | | an SM in the SMS node | | | | associated with entity | | | | that submitted it, and | | | | corresponds to the | | | | TP-Message-Reference | | | | (TP-MR) as defined in TS | | | | 23.040 [7]. This | | | | information is only | | | | applicable to delivery | | | | report charging | | | | procedures. | +----------------------------+----------+----------------------------+ | SM Total Number | O**~c~** | This field holds the total | | | | number of short messages | | | | when this SM is part of | | | | concatenated short | | | | message. This field is | | | | present only in case of | | | | concatenated short | | | | message. | +----------------------------+----------+----------------------------+ | SM Sequence Number | O**~c~** | This field holds the | | | | sequence number of this SM | | | | within the concatenated | | | | short message when | | | | applicable. This field is | | | | present only in case of | | | | concatenated short | | | | message. | +----------------------------+----------+----------------------------+ | Message size | O**~c~** | This field holds the | | | | length of the user data | | | | part of the SM, and | | | | corresponds to the | | | | TP-User-Data-Length | | | | (TP-UDL) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | Message Class | O~M~ | Used as defined in TS | | | | 32.270 [13]. It is | | | | implementation dependent | | | | the value selected for a | | | | specific transaction. | +----------------------------+----------+----------------------------+ | SM Delivery Report | O**~c~** | This field holds | | Requested | | indication whether a | | | | delivery report was | | | | requested by the SM | | | | originator, and | | | | corresponds to the | | | | T | | | | P-Status-Report-Indication | | | | (TP-SRI) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | SM Data Coding Scheme | O**~M~** | This field holds the data | | | | coding scheme used within | | | | the SM. The information to | | | | populate this field is | | | | obtained from TP-DCS | | | | header. | +----------------------------+----------+----------------------------+ | SM Message Type | O**~M~** | This field identifies the | | | | message that triggered the | | | | generation of charging | | | | information. | +----------------------------+----------+----------------------------+ | SM Reply Path Requested | O**~c~** | This field holds an | | | | indication of whether a | | | | reply SM to an original SM | | | | was requested to follow | | | | the same path as | | | | identified by the | | | | TP-Reply-Path (TP-RP) | | | | flag. | +----------------------------+----------+----------------------------+ | SM User Data Header | O**~c~** | This field carries the | | | | user data header extracted | | | | from the user data of the | | | | SM. The user data header | | | | (TP-UDH) is specified in | | | | TS 23.040 [7]. | +----------------------------+----------+----------------------------+ | SM Status | O**~c~** | This field holds the | | | | information from the | | | | TP-Status field in a | | | | Status-Report TPDU. This | | | | information is only | | | | applicable to delivery | | | | report charging | | | | procedures. | +----------------------------+----------+----------------------------+ | SM Discharge Time | O**~c~** | This field holds the time | | | | associated with the event | | | | being reported in the SM | | | | Status field. This | | | | information is only | | | | applicable to delivery | | | | report charging | | | | procedures. | +----------------------------+----------+----------------------------+ | User Location Info | O**~c~** | This field holds the | | | | information about the | | | | location of the subscriber | | | | as defined in TS 29.061 | | | | [203] | | | | \"3GPP-U | | | | ser-Location-Info\",during | | | | the SMS transaction, in | | | | case of Mobile Terminating | | | | message, if available. | | | | | | | | \"NCGI\", \"5GS TAI\", | | | | \"5GS TAI and NCGI\", | | | | \"NG-RAN Node ID\" and | | | | \"5GS TAI and NG-RAN Node | | | | ID\" values are | | | | applicable. | +----------------------------+----------+----------------------------+ | RAT Type | O**~c~** | This field holds the Radio | | | | Access Technology (RAT) | | | | type as defined in TS | | | | 29.061 [203] | | | | \"3GPP-RAT-type\", used | | | | for the SMS transaction, | | | | in case of Mobile | | | | Terminating message, if | | | | available. | | | | | | | | \"NG-RAN\" value is | | | | applicable. | +----------------------------+----------+----------------------------+ | UE Time Zone | O**~c~** | This field indicates the | | | | offset between universal | | | | time and local time in | | | | steps of 15 minutes of | | | | where the UE currently | | | | resides, in case of Mobile | | | | Terminating message, if | | | | available. | +----------------------------+----------+----------------------------+ | SMS Result | C | The field holds the result | | | | of the attempted SM | | | | delivery, if unsuccessful. | +----------------------------+----------+----------------------------+ | SM Device Trigger | O**~c~** | This field holds the set | | information | | of information related to | | | | SMS submission to SMS-SC | | | | for Device Trigger. | +----------------------------+----------+----------------------------+ | > SM DT Reference Number | O**~c~** | This field holds the | | | | Reference Number related | | | | to the device trigger | | | | request, if available. | +----------------------------+----------+----------------------------+ | > SMS Application Port ID | O**~c~** | This field holds the | | | | Application Port ID of the | | | | triggering application for | | | | the device trigger | | | | request, if available. | +----------------------------+----------+----------------------------+ | Record extensions | O**~C~** | A set of network/ | | | | manufacturer specific | | | | extensions to the record, | | | | when available. | +----------------------------+----------+----------------------------+
#### 6.1.3.5 SC-DVT-T4 CDR content
The content of SC-DVT-T4 CDR is defined in the table 6.1.3.5.1.
Table 6.1.3.5.1: SC-DVT-T4 record
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | Device Trigger over T4. | +----------------------------+----------+----------------------------+ | SMS Node Address | M | This field holds the | | | | address (e.g. E.164) of | | | | the SMS-service centre | | | | sending the Charging Data | | | | Request used for producing | | | | the record. (SMSC Address) | +----------------------------+----------+----------------------------+ | Event Time stamp | M | This field holds the | | | | timestamp of when the | | | | Device Trigger request | | | | arrived at the SMS-SC. | +----------------------------+----------+----------------------------+ | Originator Info | O**~M~** | This field is a grouped | | | | field and holds | | | | information on originator | | | | of the Device Trigger. | +----------------------------+----------+----------------------------+ | > Originator Other Address | O**~M~** | This field holds the SME | | | | address of the Service | | | | Capability Server that is | | | | requesting a device | | | | trigger to the UE as | | | | specified in TS 29.337 | | | | [18], | +----------------------------+----------+----------------------------+ | Recipient Info | O**~M~** | This field is a grouped | | | | field and holds recipient | | | | information for the SM to | | | | be delivered. | +----------------------------+----------+----------------------------+ | > Recipient IMSI | O**~M~** | This field holds the IMSI | | | | of the recipient of the SM | | | | to be delivered for Device | | | | Trigger, as received in | | | | the User Identifier from | | | | MTC-IWF, specified in TS | | | | 29.337 [18]. | +----------------------------+----------+----------------------------+ | > Recipient MSISDN | O~C~ | This field holds the | | | | MSISDN of the recipient of | | | | the SM to be delivered for | | | | Device Trigger, as | | | | received in the User | | | | Identifier from MTC-IWF, | | | | specified in TS 29.337 | | | | [18], if available. | +----------------------------+----------+----------------------------+ | > Recipient Other Address | O~C~ | This field holds the the | | | | external identifier of the | | | | recipient of the SM to be | | | | delivered for Device | | | | Trigger, as received in | | | | the User Identifier from | | | | MTC-IWF, specified in TS | | | | 29.337 [18], if | | | | available. | +----------------------------+----------+----------------------------+ | SM Device Trigger | O**~c~** | This field holds | | Indicator | | indication on the device | | | | trigger submission to | | | | SMS-SC: trigger, replace | | | | or recall. | +----------------------------+----------+----------------------------+ | SM Device Trigger | O**~c~** | This field holds the set | | information | | of information related to | | | | Device Trigger submission | | | | to SMS-SC. | +----------------------------+----------+----------------------------+ | > MTC IWF Address | O**~c~** | This field holds the MTC | | | | IWF address from which | | | | device trigger is | | | | received. | +----------------------------+----------+----------------------------+ | > SM DT Reference Number | O**~c~** | This field holds the | | | | Reference Number related | | | | to the device trigger | | | | request, if available. | +----------------------------+----------+----------------------------+ | > SM Old DT Reference | O**~c~** | This field holds the | | > Number | | Reference Number related | | | | to the device trigger | | | | intended to be replaced or | | | | recalled in the request. | | | | This information element | | | | shall be present if SM | | | | Device Trigger Indicator | | | | is recall or replace. | +----------------------------+----------+----------------------------+ | > SM Serving Node | O**~c~** | This field holds the | | | | serving node identity, | | | | i.e. SGSN/MME/MSC identity | | | | serving the UE, as | | | | received from MTC-IWF, if | | | | available. | +----------------------------+----------+----------------------------+ | > SM DT Validity Period | O**~c~** | This field holds the | | | | validity period of the | | | | device trigger request, if | | | | available. | +----------------------------+----------+----------------------------+ | > SM DT Priority | O**~c~** | This field holds the | | > Indication | | priority of the device | | | | trigger request, if | | | | available. | +----------------------------+----------+----------------------------+ | > SMS Application Port ID | O**~c~** | This field holds the | | | | Application Port ID of the | | | | triggering application for | | | | the device trigger | | | | request, if available. | +----------------------------+----------+----------------------------+ | Result | M | This field holds the | | | | result of Device Trigger | | | | request to SMS-SC | +----------------------------+----------+----------------------------+ | Record extensions | O**~C~** | A set of network/ | | | | manufacturer specific | | | | extensions to the record, | | | | when available. | +----------------------------+----------+----------------------------+
#### 6.1.3.6 SC-SMO-T4 CDR content
The content of SC-SMO-T4 CDR is defined in the table 6.1.3.6.1.
Table 6.1.3.6.1: SC-SMO-T4 record
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | SMS originated via T4. | +----------------------------+----------+----------------------------+ | SMS Node Address | M | This field holds the | | | | address (e.g. E.164) of | | | | the SMS-service centre | | | | sending the Charging Data | | | | Request used for producing | | | | the record. (SMSC Address) | +----------------------------+----------+----------------------------+ | Originator Info | O**~M~** | This field is a grouped | | | | field and holds | | | | information on originator | | | | of the SM. | +----------------------------+----------+----------------------------+ | > Originator IMSI | O**~M~** | This field holds the IMSI | | | | of the subscriber sending | | | | the short message, if | | | | available. | +----------------------------+----------+----------------------------+ | > Originator SCCP Address | O**~C~** | This field holds the SCCP | | | | calling address used to | | | | receive the SM at the SMS | | | | node, when applicable. | +----------------------------+----------+----------------------------+ | > SM Originator Protocol | O**~C~** | This field holds the | | > Id | | TP-PROTOCOL-ID (TP-PID) as | | | | defined in TS 23.040 [7] | | | | describing the protocol | | | | used for the SM by | | | | originator. | +----------------------------+----------+----------------------------+ | Recipient Info | O**~M~** | This field is a grouped | | | | field and holds recipient | | | | information for the SM. | +----------------------------+----------+----------------------------+ | > Recipient Other Address | O~C~ | This field holds the SME | | | | address of the SCS/AS, | | | | recipient of the SM, as | | | | received by the SMS-SC. | +----------------------------+----------+----------------------------+ | Served IMEI | O~C~ | The field holds IMEI or | | | | IMEISV of the UE, if | | | | available | +----------------------------+----------+----------------------------+ | Event Time stamp | M | This field holds the | | | | timestamp of when the | | | | submitted SM arrived at | | | | the SMS-SC. | +----------------------------+----------+----------------------------+ | Message Reference | M | This field holds the | | | | identity used to identify | | | | an SM in the SMS node | | | | associated with entity | | | | that submitted it, and | | | | corresponds to the | | | | TP-Message-Reference | | | | (TP-MR) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | Message size | O**~C~** | This field holds the | | | | length of the user data | | | | part of the SM, and | | | | corresponds to the | | | | TP-User-Data-Length | | | | (TP-UDL) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | Message Class | O~M~ | Used as defined in TS | | | | 32.270 [13]. It is | | | | implementation dependent | | | | the value selected for a | | | | specific transaction. | +----------------------------+----------+----------------------------+ | SM Delivery Report | O**~C~** | This field holds | | Requested | | indication whether a | | | | delivery report is | | | | requested by the SM | | | | originator, and | | | | corresponds to the | | | | TP-Status-Report-Request | | | | (TP-SRR) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | SM Data Coding Scheme | O**~M~** | This field holds the data | | | | coding scheme used within | | | | the SM. The information to | | | | populate this field is | | | | obtained from TP-DCS | | | | header. | +----------------------------+----------+----------------------------+ | SM Message Type | O**~M~** | This field identifies the | | | | message that triggered the | | | | generation of charging | | | | information, indicating | | | | \"MO-SMS via T4 | | | | submission\" | +----------------------------+----------+----------------------------+ | SM Reply Path Requested | O**~c~** | This field holds an | | | | indication of whether a | | | | reply SM to an original SM | | | | shall follow the same path | | | | as identified by the | | | | TP-Reply-Path (TP-RP) | | | | flag. | +----------------------------+----------+----------------------------+ | SM User Data Header | O**~c~** | This field carries the | | | | user data header extracted | | | | from the user data of the | | | | SM. The user data header | | | | (TP-UDH) is specified in | | | | TS 23.040 [7] | +----------------------------+----------+----------------------------+ | User Location Info | O**~c~** | This field holds the | | | | information about the | | | | location of the subscriber | | | | during the SMS | | | | transaction, if available. | +----------------------------+----------+----------------------------+ | RAT Type | O**~c~** | This field holds the Radio | | | | Access Technology (RAT) | | | | type used for the SMS | | | | transaction, if available. | +----------------------------+----------+----------------------------+ | UE Time Zone | O**~c~** | This field indicates the | | | | offset between universal | | | | time and local time in | | | | steps of 15 minutes of | | | | where the UE currently | | | | resides, if available. | +----------------------------+----------+----------------------------+ | SMS Result | C | The field holds the result | | | | of the attempted SM | | | | submission, if | | | | unsuccessful. | +----------------------------+----------+----------------------------+ | MTC IWF Address | O**~c~** | This field holds the MTC | | | | IWF address used by the | | | | SMS-SC for the Mobile | | | | Originating message | | | | transfer to the SCS/AS. | +----------------------------+----------+----------------------------+ | SMS Application Port ID | O**~c~** | This field holds the | | | | Application Port ID of the | | | | Mobile Originating message | | | | handled by the SMS-SC. | +----------------------------+----------+----------------------------+ | External Identifier | O**~M~** | This field holds the | | | | External Identifier | | | | associated to the sender | | | | of the Mobile Originated | | | | short message, if | | | | available. | +----------------------------+----------+----------------------------+ | Record extensions | O**~C~** | A set of network/ | | | | manufacturer specific | | | | extensions to the record, | | | | when available. | +----------------------------+----------+----------------------------+
#### 6.1.3.7 ISM-SMO CDR content
The content of ISM-SMO CDR is defined in the table 6.1.3.7.1.
Table 6.1.3.7.1: ISM-SMO record
* * *
Field Category Description Record Type M IP-SM-GW SMS originated. SMS Node
Address M This field holds the address of the IP-SM-GW sending the Charging
Data Request used for producing the record. Originator Info O**~M~** This
field and sub-fields are described in table 6.1.3.3.1 Recipient Info O**~M~**
This field and sub-fields are described in table 6.1.3.3.1 Subscriber
Equipment Number O~C~ This field holds the subscriber equipment information.
Event Time stamp M Described in table 6.1.3.3.1 Message Reference M Described
in table 6.1.3.3.1 SM Total Number O~C~ Described in table 6.1.3.3.1 SM
sequence Number O**~C~** Described in table 6.1.3.3.1 Message size O**~C~**
Described in table 6.1.3.3.1 Message Class O~M~ Described in table 6.1.3.3.1
SM Delivery Report Requested O**~C~** Described in table 6.1.3.3.1 SM Data
Coding Scheme O**~M~** Described in table 6.1.3.3.1 SM Message Type O**~M~**
Described in table 6.1.3.3.1 SM Reply Path Requested O**~c~** Described in
table 6.1.3.3.1 SM User Data Header O**~c~** Described in table 6.1.3.3.1 SMS
Result C Described in table 6.1.3.3.1 User Location Info O**~c~** Described in
table 6.1.3.3.1 RAT Type O**~c~** Described in table 6.1.3.3.1 UE Time Zone
O**~c~** Described in table 6.1.3.3.1 PDP Address O**~c~** This field holds
the IP address used by the subscriber for the SMS transaction. User Session Id
O**~c~** This field holds the session identifier. For a SIP session the
Session-ID contains the SIP Call ID. Number Portability routing information
O**~c~** This field includes information on number portability after DNS/ENUM
request from S-CSCF in the sms originator user's home network. Carrier Select
routing information O**~c~** This field includes information on carrier select
after DNS/ENUM request from S-CSCF in the sms originator user's home network.
Record extensions O**~C~** A set of network/ manufacturer specific extensions
to the record, when available.
* * *
#### 6.1.3.8 ISM-SMT CDR content
The content of ISM-SMT CDR is defined in table 6.1.3.8.1.
Table 6.1.3.8.1: ISM-SMT record
* * *
Field Category Description Record Type M IP-SM-GW SMS Terminated. SMS Node
Address M This field holds the address of the IP-SM-GW sending the Charging
Data Request used for producing the record. Recipient Info O**~M~** This field
and sub-fields are described in table 6.1.3.4.1, except for Device trigger
which is not applicable. Originator Info O**~M~** This field and sub-fields
are described in table 6.1.3.4.1, except for Device trigger which is not
applicable. Subscriber Equipment Number O~C~ This field holds the subscriber
equipment information. Submission Time O~C~ Described in table 6.1.3.4.1 Event
Time stamp M Described in table 6.1.3.4.1 SM Priority O**~c~** Described in
table 6.1.3.4.1 Message Reference O**~M~** Described in table 6.1.3.4.1 SM
Total Number O**~c~** Described in table 6.1.3.4.1 SM Sequence Number O**~c~**
Described in table 6.1.3.4.1 Message size O**~c~** Described in table
6.1.3.4.1 Message Class O~M~ Described in table 6.1.3.4.1 SM Delivery Report
Requested O**~c~** Described in table 6.1.3.4.1 SM Data Coding Scheme O**~M~**
Described in table 6.1.3.4.1 SM Message Type O**~M~** Described in table
6.1.3.4.1 SM Reply Path Requested O**~c~** Described in table 6.1.3.4.1 SM
User Data Header O**~c~** Described in table 6.1.3.4.1 SM Status O**~c~**
Described in table 6.1.3.4.1 SM Discharge Time O**~c~** Described in table
6.1.3.4.1 SMS Result C Described in table 6.1.3.4.1 User Location Info
O**~c~** Described in table 6.1.3.4.1 RAT Type O**~c~** Described in table
6.1.3.4.1 UE Time Zone O**~c~** Described in table 6.1.3.4.1 PDP Address
O**~c~** This field holds the IP address used by the subscriber for the SMS
transaction. User Session Id O**~c~** This field holds the session identifier.
For a SIP session the Session-ID contains the SIP Call ID. Number Portability
routing information O**~c~** This field includes information on number
portability after DNS/ENUM request from S-CSCF in the sms recipient user's
home network. Carrier Select routing information O**~c~** This field includes
information on carrier select after DNS/ENUM request from S-CSCF in the sms
recipient user's home network. Record extensions O**~C~** A set of network/
manufacturer specific extensions to the record, when available.
* * *
## 6.2 Data description for SMS online charging
### 6.2.1 R~o~ message contents
#### 6.2.1.0 Introduction
The SMS node generates Debit / Reserve Units information that can be
transferred from the CTF to the OCF. For this purpose, SMS online charging
utilizes the _Debit Units and Reserve Units_ procedure that is specified in
the 3GPP Debit / Reserve Units operation in TS 32.299 [4].
The SMS node generates refund information that can be transferred from the CTF
to the OCF. For this purpose, it uses REFUND procedure defined in IETF RFC
4006 [12] with extended AVPs.
The _Debit / Reserve Units_ procedure employs the _Debit / Reserve Units
Request_ and _Debit / Reserve Units Response_ messages.
The Refund Account procedure employs the Debit Units Request (Refund Account)
request and response messages.
Table 6.2.1.0.1 describes the use of these messages for SMS online charging.
Table 6.2.1.0.1: SMS online charging messages contents
* * *
Command-Name Source Destination Debit / Reserve Units Request CTF OCS Debit /
Reserve Units Response OCS CTF
* * *
This clause describes the different fields used in the Debit / Reserve Units
Request and Debit / Reserve Units Reponse messages and the category in the
tables are used according to the charging data configuration defined in clause
5.4 of TS 32.240 [2].
Detailed descriptions of the fields are provided in TS 32.299 [4].
#### 6.2.1.1 Summary of message formats
#### 6.2.1.2 Structure for the Credit-Control message formats
##### 6.2.1.2.1 Debit/Reserve Units Request message
Table 6.2.1.2.1.1 illustrates the basic structure of a _Debit / Reserve Units
Request_ message from SMS node as used for SMS online charging.
Table 6.2.1.2.1.1: _Debit / Reserve Units Request_ message contents for SMS
* * *
Information Element Category Description Session Identifier M This field
identifies the operation session. Originator Host M This field contains the
identification of the source point of the operation. Originator Domain M This
field contains the realm of the operation originator. Destination Domain M
This field contains the realm of the operation destination. Operation
Identifier M This field is a unique operation identifier. Operation Token M
This field contains the service context, i.e. SMS charging. Operation Type M
This field defines the transfer type: event for immediate event based charging
and initial, terminate for ECUR based charging. Operation Number M This field
contains the sequence number of the transferred messages. Destination Host
O**~C~** This field contains the identification of the destination point of
the operation. User Name O**~C~** This field contains the identification of
the source node. Origination State O**~C~** Used for ECUR only. Origination
Timestamp O**~C~** This field contains the time when the operation is
requested. Subscriber Identifier O**~M~** This field contains the
identification of the subscriber (i.e. MSISDN) that uses the requested
service. Termination Cause O**~C~** This field contains information about the
cause for termination of a Credit-Control session. Used for terminating
Credit-Control sessions in ECUR only. Requested-Action O**~C~** This field
contains the requested action, used for IEC only. Multiple Operation O**~M~**
This field indicate the occurrence of multiple operations. Multiple Unit
Operation O**~C~** This field contains the parameter for the quota management.
Subscriber Equipment Number O**~C~** This field contains the identification of
the user equipment used to access service. Included if information is made
available to the node. Proxy Information O**~C~** This field contains the
parameter of the proxy. Route Information O**~C~** This field contains the
parameter of the route. Service Information O**~M~** This field holds the SMS
specific parameter and is described in clause 6.3.
* * *
##### 6.2.1.2.2 Debit / Reserve Units Response message
Table 6.2.1.2.2.1 illustrates the basic structure of a Debit / Reserve Units
Response message as used for SMS charging.\ This message is always used by the
OCS as specified below, independent of the receiving SMS node and the
operation type that is being replied to.
Table 6.2.1.2.2.1: Debit / Reserve Units Response message contents for SMS
* * *
Information Element Category Description Session Identifier M This field
identifies the operation session. Operation Result M This field identifies the
result of the operation. Originator Host M This field contains the
identification of the source point of the operation. Originator Domain M This
field contains the realm of the operation originator. Operation Identifier M
This field is a unique operation identifier. Operation Type M This field
defines the transfer type: event for event based charging and start, interim,
stop for session based charging. Operation Number M This field contains the
sequence number of the transferred messages. Operation Failover - Not used for
SMS in 3GPP. Multiple Unit Operation O**~C~** This field contains the
parameter for the quota management. Used in IEC for refund purpose and in
ECUR. Operation Failure Action O**~C~** This field defines the resulting
operation at the SMS node if a failure has occurred at the OCS for ECUR.
Operation Event Failure Action O~C~ This field defines the resulting operation
at the SMS node if a failure has occurred at the OCS for IEC. Redirection Host
O~C~  
Redirection Host Usage O~C~  
Redirection Cache Time O~C~  
Proxy Information O~C~ This field contains the parameter of the proxy. Route
Information O~C~ This field contains the parameter of the route. Failed
parameter O~C~ This field contains missing and/or unsupported parameter that
caused the failure. Service Information O~C~ This field contains SMS specific
information.
* * *
Editor\'s Note: The mechanism to carry refund information is For Future Study.
## 6.2a Data description for SMS converged charging
### 6.2a.1 Message contents
#### 6.2a.1.1 General
The Charging Data Request and Charging Data Response are specified in TS
32.290 [57] and include charging information. The Charging Data Request can be
of type [Event, Initial, Termination].
Table 6.2a.1.1.1 describes the use of these messages for converged charging.
Table 6.2a.1.1.1: Converged charging messages reference table
* * *
**Message** **Source** **Destination** Charging Data Request SMSF CHF Charging
Data Response CHF SMSF
* * *
The following clauses describe the different fields used in the Charging Data
messages and the category in the tables is used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [2].
#### 6.2a.1.2 Structure for the converged charging message formats
##### 6.2a.1.2.1 Charging Data Request message
Table 6.2a.1.2.1.1 illustrates the basic structure of a _Charging Data
Request_ message as used for SMS converged charging.
Table 6.2a.1.2.1.1: Charging Data Request message contents
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Session Identifier | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Subscriber Identifier | O~M~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | NF Consumer | M | Described in TS 32.290 | | Identification | | [57] | +--------------------------+--------------+--------------------------+ | > NF Functionality | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > NF Name | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > NF Address | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > NF PLMN ID | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Timestamp | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Invocation Sequence | M | Described in TS 32.290 | | Number | | [57] | +--------------------------+--------------+--------------------------+ | One-time Event | OC | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | One-time Event Type | OC | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | Service Specification | O~C~ | Described in TS 32.290 | | Information | | [57] | +--------------------------+--------------+--------------------------+ | Notify URI | O~C~ | This field is not | | | | applicable. | +--------------------------+--------------+--------------------------+ | Triggers | O~C~ | This field is described | | | | in TS 32.290 [57] and | | | | holds the SMS specific | | | | triggers described in | | | | clause 5.x | +--------------------------+--------------+--------------------------+ | Multiple Unit Usage | O~C~ | This field is present | | | | when the number of units | | | | is beyond one (i.e. more | | | | than one SMS) | +--------------------------+--------------+--------------------------+ | > Rating Group | M | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Requested Unit | O~C~ | Described in TS 32.290 | | | | [57] | +--------------------------+--------------+--------------------------+ | > Used Unit Container | O~C~ | This field holds SMS | | | | charging information | | | | when more than one SMS. | | | | It may have multiple | | | | occurrences. | +--------------------------+--------------+--------------------------+ | SMS Charging Information | O~M~ | This field holds the SMS | | | | specific information | | | | described in clause | | | | 6.5.2 | +--------------------------+--------------+--------------------------+
##### 6.2a.1.2.2 Charging Data Response message
Table 6.2a.1.2.2.1 illustrates the basic structure of a _Charging Data
Response_ message as used for SMS converged charging.
Table 6.2a.1.2.2.1: Charging Data Response Message Contents
+----------------------------+--------------+------------------------------------+ | **Information Element** | **Category** | **Description** | +----------------------------+--------------+------------------------------------+ | Session Identifier | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | Invocation Timestamp | M | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | Invocation Result | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | > Result code | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | > Failed parameter | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | > Failure Handling | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | Invocation Sequence Number | M | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | Session Failover | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | Triggers | O~C~ | This field is not applicable. | +----------------------------+--------------+------------------------------------+ | Multiple Unit information | O~C~ | This field is applicable for ECUR. | +----------------------------+--------------+------------------------------------+ | > Result Code | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | > Rating Group | O~M~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | > Granted Unit | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+ | > Validity Time | O~C~ | Described in TS 32.290 [57] | +----------------------------+--------------+------------------------------------+
### 6.2a.2 G~a~ message contents
Refer to clause 5.4.4.
### 6.2a.3 CDR description on the B~sm~ interface
#### 6.2a.3.1 General
This clause describes the CDR content and format generated for SMS converged
charging.
The following tables provide a brief description of each CDR parameter. The
category in the tables is used according to the charging data configuration
defined in clause 5.4 of TS 32.240 [2]. Full definitions of the CDR
parameters, sorted by the name in alphabetical order, are provided in TS
32.298 [3].
#### 6.2a.3.2 SMS charging CHF CDR data
If enabled, CHF CDRs for SMS charging shall be produced for SMS chargeable
events.
The fields of SMS charging CHF CDR are specified in table 6.2x.3.2.1.
Table 6.2a.3.2.1: SMS charging CHF record data
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | Described in TS 32.298 | | | | [3] | +----------------------------+----------+----------------------------+ | Recording Network Function | OM | Described in TS 32.298 | | ID | | [3] | +----------------------------+----------+----------------------------+ | Subscriber Identifier | M | This field holds the 5G | | | | Subscription Permanent | | | | Identifier (SUPI) of the | | | | served party. | +----------------------------+----------+----------------------------+ | NF Consumer Information | M | This field holds the | | | | information of the SMSF | | | | that used the charging | | | | service. | +----------------------------+----------+----------------------------+ | > NF Functionality | M | This field contains the | | | | function of the node (i.e. | | | | SMSF) | +----------------------------+----------+----------------------------+ | > NF Name | OC | This field holds the name | | | | of the SMSF used. | +----------------------------+----------+----------------------------+ | > NF Address | OC | This fields holds the IP | | | | Address of the SMSF used. | +----------------------------+----------+----------------------------+ | > NF PLMN ID | Oc | This field holds the PLMN | | | | identifier (MCC MNC) of | | | | the SMSF. | +----------------------------+----------+----------------------------+ | Triggers | OC | This field is described in | | | | TS 32.298 [3] and holds | | | | the SMS specific triggers | | | | described in clause 5.x | +----------------------------+----------+----------------------------+ | List of Multiple Unit | OM | This field is present when | | Usage | | the number of units is | | | | beyond one (i.e. more than | | | | one SMS) | +----------------------------+----------+----------------------------+ | Record Opening Time | OC | Described in TS 32.298 | | | | [3] | +----------------------------+----------+----------------------------+ | Duration | M | Described in TS 32.298 | | | | [3] | +----------------------------+----------+----------------------------+ | Record Sequence Number | C | Described in TS 32.298 | | | | [3] | +----------------------------+----------+----------------------------+ | Cause for Record Closing | M | Described in TS 32.298 | | | | [3] | +----------------------------+----------+----------------------------+ | Local Record Sequence | OM | Described in TS 32.298 | | Number | | [3] | +----------------------------+----------+----------------------------+ | Record Extensions | OC | Described in TS 32.298 | | | | [3] | +----------------------------+----------+----------------------------+ | SMS Charging Information | O~M~ | This field holds the SMS | | | | specific information | | | | defined in clause 6.x | +----------------------------+----------+----------------------------+
## 6.3 SMS charging specific parameters
### 6.3.1 Definition of the SMS charging information
#### 6.3.1.1 SMS charging information assignment for Service Information
The components in the Service-Information that are use for SMS charging can be
found in table 6.3.1.1.1
Table 6.3.1.1.1: Service-Information used for SMS Charging
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Service Information | O~M~ | This is a structured field | | | | and holds the 3GPP | | | | specific parameter as | | | | defined in TS 32.299 | | | | [4]. For SMS Charging | | | | the SMS-Information and | | | | selected parameters of MMS | | | | Information, | | | | PS-Information and IMS | | | | information are used. | +----------------------------+----------+----------------------------+ | SMS Information | O~M~ | This is a structured field | | | | and holds the SMS specific | | | | parameters. The details | | | | are defined in table | | | | 6.3.1.2. | +----------------------------+----------+----------------------------+ | MMS Information | O~M~ | This is a structure field | | | | and the following | | | | parameters are specific to | | | | SMS. The complete | | | | structure is defined in TS | | | | 32.270 [13] | +----------------------------+----------+----------------------------+ | > Originator Address | O~M~ | This field holds the | | | | address of the originator | | | | of the SM. This is | | | | typically an E.164 number | | | | or a short-code. Multiple | | | | addresses may be carried | | | | if additional information | | | | is available, e.g. IMSI | | | | and E.164 number. | | | | | | | | This field holds the SME | | | | address of the SCS | | | | requesting a device | | | | trigger to the UE as | | | | specified in TS 29.337 | | | | [18], in case of SM for | | | | Device Trigger. | +----------------------------+----------+----------------------------+ | > Submission Time | O~C~ | This field holds the | | | | timestamp of when the | | | | submitted SM arrived at | | | | the originating SMS Node. | | | | The information to | | | | populate this field is | | | | obtained from the | | | | TP | | | | -Service-Center-Time-Stamp | | | | (TP-SCTS) as defined in TS | | | | 23.040 [7]. If a refund | | | | or retransmission is | | | | required, the timestamp | | | | carries the timestamp | | | | associated with the | | | | original submitted SM. | +----------------------------+----------+----------------------------+ | > Priority | O~C~ | This field holds any | | | | priority information | | | | associated with an SM.\ | | | | Applicable to terminating | | | | procedures only. Priority | | | | handling is defined in TS | | | | 23.040 [7]. The value | | | | \"low\" is not applicable. | +----------------------------+----------+----------------------------+ | > Message Id | O~M~ | This field carries the | | | | identity used to identify | | | | an SM in the SMS node | | | | associated with entity | | | | that submitted it. The | | | | information to populate | | | | this field is obtained | | | | from the | | | | TP-Message-Reference | | | | (TP-MR) as defined in TS | | | | 23.040 [7]. | +----------------------------+----------+----------------------------+ | > Message Size | O~M~ | This field carries the | | | | length of the user data | | | | part of the SM. The | | | | information to populate | | | | this field is obtained | | | | from the | | | | TP-User-Data-Length | | | | (TP-UDL) as defined in TS | | | | 23.040 [7] | +----------------------------+----------+----------------------------+ | > Message Class | O~M~ | Used as defined in TS | | | | 32.270 [13]. It is | | | | implementation dependent | | | | the value selected for a | | | | specific transaction. | +----------------------------+----------+----------------------------+ | > Delivery Report | O~C~ | This field indicates | | > Requested | | whether a delivery report | | | | is requested by the SM | | | | originator. The | | | | information to populate | | | | this field is obtained | | | | from the | | | | TP-Status-Report-Request | | | | (TP-SRR) as defined in TS | | | | 23.040 [7] | +----------------------------+----------+----------------------------+ | > PS Information | O~C~ | This is a structured field | | | | and the following | | | | parameters are specific to | | | | SMS. The complete | | | | structure is defined in TS | | | | 32.251 [10]. | +----------------------------+----------+----------------------------+ | > PDP Address | O~C~ | This field holds the IP | | | | address used by the | | | | subscriber for the SMS | | | | transaction. Included if | | | | the SMS node is the | | | | IP-SM-GW. | +----------------------------+----------+----------------------------+ | > 3GPP User Location Info | O~C~ | This field holds the | | | | information about the | | | | location of the subscriber | | | | as defined in TS 29.061 | | | | [203] | | | | \" | | | | 3GPP-User-Location-Info\", | | | | during the SMS | | | | transaction. | | | | | | | | \"NCGI\", \"5GS TAI\", | | | | \"5GS TAI and NCGI\", | | | | \"NG-RAN Node ID\" and | | | | \"5GS TAI and NG-RAN Node | | | | ID\" values are | | | | applicable. | +----------------------------+----------+----------------------------+ | > 3GPP RAT Type | O~C~ | This field holds | | | | information about the | | | | radio access technology as | | | | defined in TS 29.061 | | | | [203] \"3GPP-RAT-type\", | | | | used for the SMS | | | | transaction. | | | | | | | | \"NG-RAN\" value is | | | | applicable. | +----------------------------+----------+----------------------------+ | > MS Time Zone | O~C~ | This field indicates the | | | | offset between universal | | | | time and local time in | | | | steps of 15 minutes of | | | | where the MS currently | | | | resides. | +----------------------------+----------+----------------------------+ | > User Equipment Info | O~C~ | This field holds the | | | | identification of the | | | | terminal (IMEI or | | | | IMEISV...) | +----------------------------+----------+----------------------------+ | > IMS Information | O~C~ | This is a structured field | | | | and the following | | | | parameters are specific to | | | | SMS. The complete | | | | structure is defined in TS | | | | 32.260 [15]. | +----------------------------+----------+----------------------------+ | > User Session Id | O~C~ | This field holds the | | | | session identifier. For a | | | | SIP session the Session-ID | | | | contains the SIP Call ID. | +----------------------------+----------+----------------------------+ | > **Number Portability | O~C~ | This field includes | | > routing information** | | information on number | | | | portability after DNS/ENUM | | | | request from S-CSCF in the | | | | calling user's home | | | | network. | +----------------------------+----------+----------------------------+ | > **Carrier Select routing | O~C~ | This field includes | | > information** | | information on carrier | | | | select after DNS/ENUM | | | | request from S-CSCF in the | | | | calling user's home | | | | network. | +----------------------------+----------+----------------------------+
#### 6.3.1.2 Definition of the SMS Information
The components in the SMS Information that are used for SMS charging can be
found in table 6.3.1.2.1
Table 6.3.1.2.1: SMS Information used for SMS Charging
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | SMS Node | O~M~ | Identifies the SMS Node as | | | | IP-SM-GW or SMS Router or | | | | a combined IP-SM-GW / SMS | | | | Router or as SMS-SC. | +----------------------------+----------+----------------------------+ | SM Client Address | O~M~ | This field holds the | | | | address of the SMS node to | | | | which the charging system | | | | is connected to. This may | | | | be the same as the SMSC | | | | Address field. | +----------------------------+----------+----------------------------+ | Originator SCCP Address | O~C~ | This field holds the SCCP | | | | calling address used to | | | | receive the SM at the SMS | | | | node. Only present if | | | | SMSIP is not used for the | | | | inward connection. | +----------------------------+----------+----------------------------+ | Originator Received | O~C~ | This field holds the | | Address | | original, unmodified | | | | address of the originator | | | | of the SM, as received by | | | | the SMS node, in case | | | | address manipulation (such | | | | as number plan | | | | corrections) have been | | | | applied in the SMS node. | | | | This is typically an E.164 | | | | number or a short-code. | | | | Multiple addresses may be | | | | carried if additional | | | | information is available, | | | | e.g. IMSI and E.164 | | | | number. | +----------------------------+----------+----------------------------+ | Recipient Info | O~C~ | This field holds recipient | | | | information for the SM. | | | | Each occurrence of this | | | | field denotes a different | | | | recipient. | | | | | | | | Multiple occurrences of | | | | this field are allowed in | | | | case:\ | | | | - multiple recipients are | | | | associated with the | | | | charged event and | | | | | | | | - all other charging | | | | information is identical | | | | for all recipients. | | | | | | | | In case the SM contains a | | | | Delivery Report, as | | | | described in clause | | | | 5.3.2.3, this field | | | | identifies the recipient | | | | of this Delivery Report. | | | | This recipient information | | | | shall correspond to the | | | | originator information of | | | | the message that triggered | | | | this Delivery Report. | | | | (Note 2) | +----------------------------+----------+----------------------------+ | > Recipient Address | O~C~ | This field holds the | | | | address of the recipient | | | | of the SM. This is | | | | typically an E.164 number | | | | or a short-code. Multiple | | | | addresses may be carried | | | | if additional information | | | | is available, e.g. | | | | short-code, IMSI, E.164 | | | | number, long/short code of | | | | the SCS/AS, or external | | | | identifier for Device | | | | Trigger. | +----------------------------+----------+----------------------------+ | > Recipient Received | O~C~ | This field holds the | | > Address | | original, unmodified | | | | address of the recipient | | | | of the SM, as received by | | | | the SMS node, in case | | | | address manipulation (such | | | | as number plan | | | | corrections) have been | | | | applied in the SMS node. | | | | This is typically an E.164 | | | | number or a short-code. | | | | Multiple addresses may be | | | | carried if additional | | | | information is available, | | | | e.g. short-code, IMSI, or | | | | E.164 number. | +----------------------------+----------+----------------------------+ | > Recipient SCCP Address | O~C~ | This field holds the SCCP | | | | called address used by the | | | | SMS node to onward deliver | | | | the SM. Only present if | | | | SMSIP is not used for the | | | | outward connection. | +----------------------------+----------+----------------------------+ | > SM Destination Interface | O~M~ | This is a structured field | | | | containing information | | | | describing the interface | | | | on which the SM is to be | | | | delivered (i.e. the next | | | | hop). | | | | | | | | In case the charging event | | | | is for person to | | | | application messaging or | | | | for application to | | | | application messaging (see | | | | clause 5.1.1) this field | | | | holds the identification | | | | of the application. (See | | | | also Note 3) | +----------------------------+----------+----------------------------+ | > SM Protocol Id | O~C~ | This field holds the | | | | TP-PROTOCOL-ID (TP-PID) as | | | | defined in TS 23.040 | | | | [7]. This field relates | | | | to the recipient when | | | | charging MT SMS messages | | | | as specified in TS 32.240 | | | | [2]. | +----------------------------+----------+----------------------------+ | SMSC Address | O~M~ | This field holds the | | | | address of the SMSC to | | | | which the originating or | | | | terminating SM is directed | | | | to. | +----------------------------+----------+----------------------------+ | SM Data Coding Scheme | O~M~ | This field holds the data | | | | coding scheme used within | | | | the SM. The information to | | | | populate this field is | | | | obtained from TP-DCS | | | | header. | +----------------------------+----------+----------------------------+ | SM Message Type | O~M~ | This field identifies the | | | | message that triggered the | | | | generation of charging | | | | information. | +----------------------------+----------+----------------------------+ | SM Originator Interface | O~M~ | This is a structured field | | | | containing information | | | | describing the interface | | | | on which the SM was | | | | received by the SMS node | | | | (i.e. the previous hop) | | | | | | | | In case the charging event | | | | is for application to | | | | person messaging or for | | | | application to application | | | | messaging (see clause | | | | 5.1.1) this field holds | | | | the identification of the | | | | application. (See also | | | | Note 3) | +----------------------------+----------+----------------------------+ | SM Protocol Id | O~C~ | This field holds the | | | | TP-PROTOCOL-ID (TP-PID) as | | | | defined in TS 23.040 | | | | [7]. This field relates | | | | to the originator when | | | | charging MO SMS messages | | | | as specified in TS 32.240 | | | | [2]. | +----------------------------+----------+----------------------------+ | SM Reply Path Requested | O~C~ | This field carries an | | | | indication of whether a | | | | reply SM to an original SM | | | | shall follow the same path | | | | as identified by the | | | | TP-Reply-Path (TP-RP) | | | | flag. | +----------------------------+----------+----------------------------+ | SM User Data Header | O~C~ | This field carries the | | | | user data header extracted | | | | from the user data of the | | | | SM. The user data header | | | | (TP-UDH) is specified in | | | | TS 23.040 [7] | +----------------------------+----------+----------------------------+ | SM Status | O~C~ | This field holds the | | | | information from the | | | | TP-Status field in a | | | | Status-Report TPDU. This | | | | information is only | | | | applicable to delivery | | | | report charging procedures | | | | or where ECUR is employed. | +----------------------------+----------+----------------------------+ | SM Discharge Time | O~C~ | This field holds the time | | | | associated with the event | | | | being reported in the SM | | | | Status field. This | | | | information is only | | | | applicable to delivery | | | | report charging | | | | procedures. | +----------------------------+----------+----------------------------+ | Number of Messages Sent | O~C~ | Indicates the number of | | | | SMSs sent by the IMS | | | | application or the total | | | | number of short messages | | | | when this SM is part of | | | | concatenated short | | | | message, if applicable. | +----------------------------+----------+----------------------------+ | SM Service Type | O~C~ | This field indicates the | | | | type of SM service that | | | | caused the charging | | | | interaction. It is only | | | | applicable for SM | | | | supplementary service | | | | procedures. | +----------------------------+----------+----------------------------+ | SM Sequence Number | O~C~ | This field holds the | | | | sequence number of this SM | | | | within the concatenated | | | | short message when | | | | applicable. This field is | | | | present only in case of | | | | concatenated short | | | | message.\ | | | | This field is only for | | | | offline charging. | +----------------------------+----------+----------------------------+ | SMS result | C | The field holds the result | | | | of the attempted SM | | | | transaction, if | | | | unsuccessful. | | | | | | | | This field is only for | | | | offline charging. | +----------------------------+----------+----------------------------+ | SM Device Trigger | O~C~ | This field holds | | Indicator | | indication on the device | | | | trigger submission to | | | | SMS-SC: request, replace | | | | or recall. | +----------------------------+----------+----------------------------+ | SM Device Trigger | O~C~ | This field holds the set | | information | | of information related to | | | | SMS transaction for Device | | | | Trigger. | +----------------------------+----------+----------------------------+ | > MTC IWF Address | O~C~ | This field holds the MTC | | | | IWF address which | | | | originated the device | | | | trigger. | +----------------------------+----------+----------------------------+ | > SM DT Reference Number | O~C~ | This field holds the | | | | Reference Number related | | | | to the device trigger | | | | request, if available. | +----------------------------+----------+----------------------------+ | > SM Serving Node | O~C~ | This field holds the | | | | serving node identity, | | | | i.e. SGSN/MME/MSC identity | | | | serving the UE, as | | | | received from MTC-IWF, if | | | | available. | +----------------------------+----------+----------------------------+ | > SM DT Validity Period | O~C~ | This field holds the | | | | validity period of the | | | | device trigger request, if | | | | available. | +----------------------------+----------+----------------------------+ | > SM DT Priority | O~C~ | This field holds the | | > Indication | | priority of the device | | | | trigger request, if | | | | available. | +----------------------------+----------+----------------------------+ | > SMS Application Port ID | O~C~ | This field holds the | | | | Application Port ID of the | | | | triggering application for | | | | the device trigger | | | | request, if available. | +----------------------------+----------+----------------------------+ | > MTC IWF Address | O~C~ | This field holds the MTC | | | | IWF address used by the | | | | SMS-SC for the Mobile | | | | Originating message | | | | transfer to the SCS/AS. | +----------------------------+----------+----------------------------+ | > SMS Application Port ID | O~C~ | This field holds the | | | | Application Port ID of the | | | | Mobile Originating message | | | | handled by the SMS-SC. | +----------------------------+----------+----------------------------+ | > External Identifier | O~M~ | This field holds the | | | | External Identifier | | | | associated to the sender | | | | of the Mobile Originated | | | | short message, if | | | | available. | +----------------------------+----------+----------------------------+
NOTE 1: The case of multi-destinations of SMS refers to SMS and Internet
Electronic Mail interworking as specified in clause 3.8 of TS 23.040 [7].
NOTE 2: Implementations vary as to the originator address that is presented to
an end user for a Delivery Report. Typically the originator address either
identifies the SMS node that generated the Delivery Report or the originator
address of a Delivery Report identifies the recipient of the original message
that triggered this Report. It is expected that the charging event contains
the information presented to the end user.
NOTE 3: There is a distinction between short numbers (as conveyed in
originator and/or recipient address fields) and the identification of SM
applications (as carried in SM Originator Interface and/or SM Destination
Interface). Short numbers are used by end users to address a service of an
applications. Multiple short numbers may map to one application capable of
multiple services. The identification of an application is how an application
is know to the operator.
### 6.3.1A Detailed message format for offline charging
This clause specifies the charging data that are sent by the SMS Node in the
Charging Data Request, with [event] Operation Type.
When a particular field is not supported, this field is marked with \"-\".
Table 6.3.1A.1 illustrates the basic structure of the supported fields in
Service Information of the _Charging Data Request_ message for SMS offline
charging.
Table 6.3.1A.1: Supported fields in _Charging Data Request message_
* * *
Information Element Node Type SMS-C IP-SM-GW  
CDR Type SC-SMO SC-SMT SC-DVT-T4 SC-SMO-T4 ISM-SMO ISM-SMT Supported Operation
Types E E E E E E Session Identifier E E E E E E  
Originator Host E E E E E E  
Originator Realm E E E E E E  
Destination Domain E E E E E E  
Operation Type E E E E E E  
Operation Number E E E E E E  
Operation Identifier E E E E E E  
User Name E E E E E E  
Destination Host E E E E E E  
Operation Interval - - - - - -  
Origination State E E E E E E  
Origination Timestamp E E E E E E  
Proxy Information E E E E E E  
Route Information E E E E E E  
Operation Token E E E E E E  
Service Information with MMS, PS, IMS and SMS Information  
SMS Node - - - E - -  
SM Client Address E E E E E E  
Originator SCCP Address E E - E E E  
Originator Received Address E E - E E E  
Recipient Info E E E E E E  
SMSC Address - - - - - -  
SM Data Coding Scheme E E - E E E  
SM Message Type E E E E E E  
SM Originator Interface - E - - - E  
SM Protocol Id E - - E E -  
SM Reply Path Requested E E - E E E  
SM User Data Header E E - E E E  
SM Status - E - E - E  
SM Discharge Time - E - - - E  
Number of Messages Sent E E - - E E  
SM Service Type - - - - - -  
SMS result E E E E E E  
SM Sequence Number E E - - E E  
SM Device Trigger Indicator - - E E - -  
SM Device Trigger information - E E E - E  
Originator Address E E E E E E  
Submission Time E E E E E E  
Priority - E - - - E  
Message Id E E - E E E  
Message Size E E - E E E  
Message Class E E - E E E  
Delivery Report Requested E E - E E E  
PDP Address - - - - E E  
3GPP User Location Info E E - E E E  
3GPP RAT Type E E - E E E  
MS Time Zone E E - E E E  
User Equipment Info E E - E E E  
User Session Id - - - - E E  
**Number Portability routing information** \- - - - E E  
**Carrier Select routing information** \- - - - E E  
MTC IWF Address - - - E - -  
SMS Application Port ID - - - E - -  
External Identifier - - - E - -
* * *
### 6.3.2 Formal parameter description
#### 6.3.2.1 SMS charging information for CDRs
The detailed definitions, abstract syntax and encoding of the SMS CDR
parameters are specified in TS 32.298 [3].
#### 6.3.2.2 SMS charging information for charging events
The detailed charging event parameter definitions are specified in TS 32.299
[50].
### 6.3.3 Detailed message format for online charging
The Operation types are listed in the following order: I [initial]/ T
[terminate]/E [event]. Therefore, when all Operation types are possible it is
marked as ITE. If only some Operation types are allowed for a node, only the
appropriate letters are used (i.e. IT or E) as indicated in the table heading.
The omission of an Operation type for a particular field is marked with \"-\"
(i.e. I-E). Also, when an entire field is not allowed in a node the entire
cell is marked as \"-\".
Table 6.3.3.1 illustrates the basic structure of the supported fields in the
Debit / Reserve Units Request for SMS, T4 Device Triggering, and for MO-SMS
via T4 submission, online charging.
Table 6.3.3.1: Supported fields in _Debit / Reserve Units Request_ message
* * *
Information Element Service Type SMS T4 Device Triggering MO-SMS T4 Supported
Operation Types I/T/E E I/T Session Identifier ITE E IT  
Originator Host ITE E IT  
Originator Domain ITE E IT  
Destination Domain ITE E IT  
Operation Identifier ITE E IT  
Operation Token ITE E IT  
Operation Type ITE E IT  
Operation Number ITE E IT  
Destination Host ITE E IT  
User Name ITE E IT  
Origination State ITE - IT  
Origination Timestamp ITE E IT  
Subscriber Identifier ITE E IT  
Termination Cause -T- - -T  
Requested Action --E E -  
Multiple Operation ITE E IT  
Multiple Unit Operation ITE E IT  
Subscriber Equipment Number ITE - IT  
Proxy Information ITE E IT  
Route Information ITE E IT  
Service Information ITE E IT  
**Service Information with MMS, PS, IMS and SMS Information**  
SMS Node ITE - IT  
SM Client Address ITE E IT  
Originator Info ITE E IT  
Recipient Info ITE E IT  
SMSC Address ITE - -  
SM Data Coding Scheme ITE - IT  
SM Message Type ITE E IT  
SM Originator Interface ITE - -  
SM Protocol Id ITE - IT  
SM Reply Path Requested ITE - IT  
SM User Data Header ITE - IT  
SM Status ITE - IT  
SM Discharge Time ITE - -  
Number of Messages Sent ITE - -  
SM Service Type ITE - -  
SMS result - E IT  
SM Sequence Number - - -  
SM Device Trigger Indicator ITE E -  
SM Device Trigger information ITE E -  
Originator Address ITE - IT  
Submission Time ITE E IT  
Priority ITE - IT  
Message Id ITE - IT  
Message Size ITE - IT  
Message Class ITE - IT  
Delivery Report Requested ITE - IT  
PDP Address ITE - -  
3GPP User Location Info ITE - IT  
3GPP RAT Type ITE - IT  
MS Time Zone ITE - IT  
User Equipment Info - - -  
User Session Id ITE - -  
**Number Portability routing information** ITE - -  
**Carrier Select routing information** ITE - -  
MTC IWF Address - - IT  
SMS Application Port ID - - IT  
External Identifier - - -T
* * *
## 6.4 Bindings for SMS charging
This clause describes the mapping between the Service Information fields, AVPs
and CDR parameters for SMS charging.
Table 6.4.1 describes the mapping of the Information Element, AVP and CDR
parameter of SC-SMO and\ SC-SMT CDRs in SMS charging.
Table 6.4.1: Bindings of CDR parameter, Information Element and AVP
+----------------------+----------------------+----------------------+ | **CDR parameter** | **Information |** AVP**| | | Element** | | +----------------------+----------------------+----------------------+ | | Service Information | Service-Information | +----------------------+----------------------+----------------------+ | | **SMS Information** | **SMS-Information** | +----------------------+----------------------+----------------------+ | - | SMS Node | SMS-Node | +----------------------+----------------------+----------------------+ | SMS Node Address | SM Client Address | Client-Address | +----------------------+----------------------+----------------------+ | Originator SCCP | Originator SCCP | Ori | | Address | Address | ginator-SCCP-Address | +----------------------+----------------------+----------------------+ | Originator Received | Originator Received | Origina | | Address | Address | tor-Received-Address | +----------------------+----------------------+----------------------+ | Recipient Info | Recipient Info | Recipient-Info | +----------------------+----------------------+----------------------+ | > Recipient IMSI | > Recipient Address | > Recipient-Address | +----------------------+----------------------+----------------------+ | > Recipient MSISDN | > Recipient Address | > Recipient-Address | +----------------------+----------------------+----------------------+ | > Recipient Other | > Recipient Address | > Recipient-Address | | > Address | | | +----------------------+----------------------+----------------------+ | > Recipient Received | > Recipient Received | > Recipi | | > Address | > Address | ent-Received-Address | +----------------------+----------------------+----------------------+ | > Recipient SCCP | > Recipient SCCP | > Re | | > Address | > Address | cipient-SCCP-Address | +----------------------+----------------------+----------------------+ | > SM Destination | > SM Destination | > D | | > Interface | > Interface | estination-Interface | +----------------------+----------------------+----------------------+ | > SM Recipient | > SM Protocol Id | > SM-Protocol-Id | | > Protocol Id | | | +----------------------+----------------------+----------------------+ | - | SMSC Address | SMSC-Address | +----------------------+----------------------+----------------------+ | SM Data Coding | SM Data Coding | Data-Coding-Scheme | | Scheme | Scheme | | +----------------------+----------------------+----------------------+ | SM Message Type | SM Message Type | SM-Message-Type | +----------------------+----------------------+----------------------+ | SM Originator | SM Originator | Originator-Interface | | Interface | Interface | | +----------------------+----------------------+----------------------+ | SM Originator | SM Protocol Id | SM-Protocol-Id | | Protocol Id | | | +----------------------+----------------------+----------------------+ | SM Reply Path | SM Reply Path | Reply-Path-Requested | | Requested | Requested | | +----------------------+----------------------+----------------------+ | SM User Data Header | SM User Data Header | SM-User-Data-Header | +----------------------+----------------------+----------------------+ | SM Status | SM Status | SM-Status | +----------------------+----------------------+----------------------+ | SM Discharge Time | SM Discharge Time | SM-Discharge-Time | +----------------------+----------------------+----------------------+ | SM Total Number | Number of Messages | Num | | | Sent | ber-of-Messages-Sent | +----------------------+----------------------+----------------------+ | - | SM Service Type | SM-Service-Type | +----------------------+----------------------+----------------------+ | SMS result | SMS result | SMS-result | +----------------------+----------------------+----------------------+ | SM Sequence Number | SM Sequence Number | SM-Sequence-Number | +----------------------+----------------------+----------------------+ | SM Device Trigger | SM Device Trigger | SM-Devi | | Indicator | Indicator | ce-Trigger-Indicator | +----------------------+----------------------+----------------------+ | SM Device Trigger | SM Device Trigger | SM-Device | | information | information | -Trigger-information | +----------------------+----------------------+----------------------+ | > MTC IWF Address | > MTC IWF Address | > MTC-IWF-Address | +----------------------+----------------------+----------------------+ | > SM DT Reference | > SM DT Reference | > Reference-Number | | > Number | > Number | | +----------------------+----------------------+----------------------+ | > SM Serving Node | > SM Serving Node | > Serving-Node | +----------------------+----------------------+----------------------+ | > SM DT Validity | > SM DT Validity | > Validity-Time | | > Period | > Period | | +----------------------+----------------------+----------------------+ | > SM DT Priority | > SM DT Priority | > | | > Indication | > Indication | Priority-Indication | +----------------------+----------------------+----------------------+ | > SMS Application | > SMS Application | > Applica | | > Port ID | > Port ID | tion-Port-Identifier | +----------------------+----------------------+----------------------+ | > MTC IWF Address | > MTC IWF Address | > MTC-IWF-Address | +----------------------+----------------------+----------------------+ | > SMS Application | > SMS Application | > Applica | | > Port ID | > Port ID | tion-Port-Identifier | +----------------------+----------------------+----------------------+ | > External | > External | > | | > Identifier | > Identifier | External-Identifier | +----------------------+----------------------+----------------------+ | > **-** | **MMS Information** | **MMS-Information** | +----------------------+----------------------+----------------------+ | Originator IMSI | Originator Address | Originator-Address | +----------------------+----------------------+----------------------+ | Originator MSISDN | Originator Address | Originator-Address | +----------------------+----------------------+----------------------+ | Originator Other | Originator Address | Originator-Address | | Address | | | +----------------------+----------------------+----------------------+ | Event Time stamp | Submission Time | Submission-Time | +----------------------+----------------------+----------------------+ | Submission Time | Submission Time | Submission-Time | +----------------------+----------------------+----------------------+ | SM Priority | Priority | Priority | +----------------------+----------------------+----------------------+ | Message Reference | Message Id | Message-ID | +----------------------+----------------------+----------------------+ | Message size | Message Size | Message-Size | +----------------------+----------------------+----------------------+ | Message Class | Message Class | Message-Class | +----------------------+----------------------+----------------------+ | SM Delivery Report | Delivery Report | Deliv | | Requested | Requested | ery-Report-Requested | +----------------------+----------------------+----------------------+ | **-** | **PS Information** | **PS-Information** | +----------------------+----------------------+----------------------+ | PDP Address | PDP Address | PDP-Address | +----------------------+----------------------+----------------------+ | User Location Info | 3GPP User Location | 3GP | | | Info | P-User-Location-Info | +----------------------+----------------------+----------------------+ | RAT Type | 3GPP RAT Type | 3GPP-RAT-Type | +----------------------+----------------------+----------------------+ | UE Time Zone | MS Time Zone | 3GPP-MS-Time-Zone | +----------------------+----------------------+----------------------+ | Served IMEI | User Equipment Info | User-Equipment-Info | +----------------------+----------------------+----------------------+ | Subscriber Equipment | User Equipment Info | User-Equipment-Info | | Number | | | +----------------------+----------------------+----------------------+ | **-** | **IMS Information** | **IMS-Information** | +----------------------+----------------------+----------------------+ | User Session Id | User Session Id | User-Session-Id | +----------------------+----------------------+----------------------+ | Number Portability | Number Portability | Number-Portability | | routing information | routing information | -routing-information | +----------------------+----------------------+----------------------+ | Carrier Select | Carrier Select | Carrier-Select | | routing information | routing information | -routing-information | +----------------------+----------------------+----------------------+
## 6.5 Definition of the SMS converged charging information
### 6.5.1 General
The Charging Information parameter used for SMS converged charging is provided
in the following sub-clauses.
### 6.5.2 Definition of SMS charging information
SMS specific charging information used for SMS converged charging is provided
within the SMS charging Information.
Table 6.5.2.1: Structure of SMS Charging information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Originator Info | O~M~ | This field is a grouped | | | | field and holds | | | | information on originator | | | | of the SMS | +----------------------------+----------+----------------------------+ | > Originator SUPI | O~M~ | This field holds the SUPI | | | | of the originator of the | | | | SMS, if available. This | | | | field is present if | | | | different from subscriber | | | | identifier field. | +----------------------------+----------+----------------------------+ | > Originator GPSI | O**~C~** | This field holds the GPSI | | | | of the originator of the | | | | SMS, if available. | +----------------------------+----------+----------------------------+ | > Originator Other Address | O~M~ | This field holds the | | | | address of the originator | | | | of the SMS, when different | | | | from SUPI and GPSI, if | | | | available: e.g. email, | | | | short code. | | | | | | | | This field may have | | | | multiple occurences. | +----------------------------+----------+----------------------------+ | > Originator Received | O**~C~** | Described in table | | > Address | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > Originator SCCP Address | O**~C~** | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > SM Originator Interface | O~M~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > SM Originator Protocol | O**~C~** | Described in table | | > Id | | 6.3.1.2.1: SM Protocol Id | | | | information element | +----------------------------+----------+----------------------------+ | Recipient Info | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > Recipient SUPI | O~M~ | This field holds the SUPI | | | | of the recipient of the | | | | SMS, if available. This | | | | field is present if | | | | different from subscriber | | | | identifier field. | +----------------------------+----------+----------------------------+ | > Recipient GPSI | O**~C~** | This field holds the GPSI | | | | of the recipient of the | | | | SMS, if available. | +----------------------------+----------+----------------------------+ | > Recipient Other Address | O~C~ | This field holds the | | | | address of the recipient | | | | of the SMS, when different | | | | from SUPI and GPSI, if | | | | available: e.g. email, | | | | short code. | | | | | | | | This field may have | | | | multiple occurences | +----------------------------+----------+----------------------------+ | > Recipient Received | O~C~ | Described in table | | > Address | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > Recipient SCCP Address | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > SM Destination Interface | O~M~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | > SM Recipient Protocol Id | O~C~ | Described in table | | | | 6.3.1.2.1: SM Protocol Id | | | | information element. | +----------------------------+----------+----------------------------+ | User Equipment Info | O~C~ | This field holds the | | | | identification of the | | | | terminal (i.e. PEI, MAC | | | | Address) used by the UE | | | | the SMS transaction, if | | | | available. | +----------------------------+----------+----------------------------+ | Roamer In Out | O~C~ | This field holds an | | | | indication of the UE is an | | | | in-bound roamer. This | | | | field is present only if | | | | UE is identified as a | | | | roamer. | +----------------------------+----------+----------------------------+ | User Location Info | O~C~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | UE Time Zone | O~C~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | RAT Type | O~C~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | SMSC Address | O~M~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Data Coding Scheme | O~M~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Message Type | O~M~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Reply Path Requested | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM User Data Header | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Status | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Discharge Time | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | Number of Messages Sent | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Service Type | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SM Sequence Number | O~C~ | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | SMS result | C | Described in table | | | | 6.3.1.2.1 | +----------------------------+----------+----------------------------+ | Submission Time | O~C~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | SM Priority | O~C~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | Message Reference | O~M~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | Message Size | O~M~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | Message Class | O~M~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+ | Delivery Report Requested | O~C~ | Described in table | | | | 6.3.1.1.1 | +----------------------------+----------+----------------------------+
### 6.5.3 Detailed message format for converged charging
The following clause specifies per Operation Type the charging data that are
sent by SMS Node for 5G SMS converged charging.
The Operation Types are listed in the following order: I (Initial)/T
(Termination)/E (Event). Therefore, when all Operation Types are possible it
is marked as ITE. If only some Operation Types are allowed for a node, only
the appropriate letters are used (i.e. IT or E) as indicated in the table
heading. The omission of an Operation Type for a particular field is marked
with \"-\" (i.e. I-E). Also, when an entire field is not allowed in a node the
entire cell is marked as \"-\".
Table 6.5.3.1 defines the basic structure of the supported fields in the
_Charging Data Request_ message for SMS converged charging.
Table 6.5.3.1: Supported fields in _Charging Data Request message_
+-----------------------------------+---------------------------+------+ | Information Element | Node Type | SMSF | +-----------------------------------+---------------------------+------+ | | Supported Operation Types | ITE | +-----------------------------------+---------------------------+------+ | Session Identifier | ITE | | +-----------------------------------+---------------------------+------+ | Subscriber Identifier | ITE | | +-----------------------------------+---------------------------+------+ | NF Consumer Identification | ITE | | +-----------------------------------+---------------------------+------+ | Invocation Timestamp | ITE | | +-----------------------------------+---------------------------+------+ | Invocation Sequence Number | ITE | | +-----------------------------------+---------------------------+------+ | One-time Event | --E | | +-----------------------------------+---------------------------+------+ | One-time Event Type | --E | | +-----------------------------------+---------------------------+------+ | Service Specification Information | ITE | | +-----------------------------------+---------------------------+------+ | Notify URI | - | | +-----------------------------------+---------------------------+------+ | Triggers | ITE | | +-----------------------------------+---------------------------+------+ | Multiple Unit Usage | ITE | | +-----------------------------------+---------------------------+------+ | > Rating Group | IT- | | +-----------------------------------+---------------------------+------+ | > Requested Unit | I-- | | +-----------------------------------+---------------------------+------+ | > Used Unit Container | IT- | | +-----------------------------------+---------------------------+------+ | SMS Charging Information | | | +-----------------------------------+---------------------------+------+ | Originator Info | ITE | | +-----------------------------------+---------------------------+------+ | Recipient Info | ITE | | +-----------------------------------+---------------------------+------+ | User Equipment Info | ITE | | +-----------------------------------+---------------------------+------+ | Roamer In Out | ITE | | +-----------------------------------+---------------------------+------+ | User Location Info | ITE | | +-----------------------------------+---------------------------+------+ | UE Time Zone | ITE | | +-----------------------------------+---------------------------+------+ | RAT Type | ITE | | +-----------------------------------+---------------------------+------+ | SMSC Address | ITE | | +-----------------------------------+---------------------------+------+ | SM Data Coding Scheme | ITE | | +-----------------------------------+---------------------------+------+ | SM Message Type | ITE | | +-----------------------------------+---------------------------+------+ | SM Reply Path Requested | ITE | | +-----------------------------------+---------------------------+------+ | SM User Data Header | ITE | | +-----------------------------------+---------------------------+------+ | SM Status | ITE | | +-----------------------------------+---------------------------+------+ | SM Discharge Time | ITE | | +-----------------------------------+---------------------------+------+ | Number of Messages Sent | ITE | | +-----------------------------------+---------------------------+------+ | SM Service Type | ITE | | +-----------------------------------+---------------------------+------+ | SM Sequence Number | ITE | | +-----------------------------------+---------------------------+------+ | SMS result | ITE | | +-----------------------------------+---------------------------+------+ | Submission Time | ITE | | +-----------------------------------+---------------------------+------+ | SMPriority | ITE | | +-----------------------------------+---------------------------+------+ | Message Reference | ITE | | +-----------------------------------+---------------------------+------+ | Message Size | ITE | | +-----------------------------------+---------------------------+------+ | Message Class | ITE | | +-----------------------------------+---------------------------+------+ | Delivery Report Requested | ITE | | +-----------------------------------+---------------------------+------+
Table 6.5.3.2 defines the basic structure of the supported fields in the
_Charging Data Response_ message for SMS converged charging.
Table 6.5.3.2: Supported fields in _Charging Data Response message_
+----------------------------+---------------------------+------+ | Information Element | Node Type | SMSF | +----------------------------+---------------------------+------+ | | Supported Operation Types | ITE | +----------------------------+---------------------------+------+ | Session Identifier | ITE | | +----------------------------+---------------------------+------+ | Invocation Timestamp | ITE | | +----------------------------+---------------------------+------+ | Invocation Result | ITE | | +----------------------------+---------------------------+------+ | Invocation Sequence Number | ITE | | +----------------------------+---------------------------+------+ | Session Failover | I-- | | +----------------------------+---------------------------+------+ | Triggers | - | | +----------------------------+---------------------------+------+ | Multiple Unit information | I-E | | +----------------------------+---------------------------+------+ | > Result Code | I-- | | +----------------------------+---------------------------+------+ | > Rating Group | I-- | | +----------------------------+---------------------------+------+ | > Granted Unit | I-- | | +----------------------------+---------------------------+------+ | > Validity Time | I-- | | +----------------------------+---------------------------+------+
### 6.5.4 Formal SMS converged charging parameter description
#### 6.5.4.1 SMS charging CHF CDR parameters
The detailed definitions, abstract syntax and encoding of the SMS charging CHF
CDR parameters are specified in TS 32.298 [51].
#### 6.5.4.2 SMS charging resources attributes
The detailed definitions of resources attributes used for SMS charging are
specified in TS 32.291 [58].
## 6.6 Bindings for SMS converged charging
This mapping between the Information Elements, resource attributes and CHF CDR
parameters for SMS converged charging is described in clause 7 of TS 32.291
[58].
###### ## Annex A (informative): Bibliography
This Annex is a placeholder for documents which are not explicitly cited in
this specification.
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies service, operations and procedures of 5G
charging for service based interface. This charging description includes the
charging architecture and scenarios as well as the mapping of the common
charging architecture specified in TS 32.240 [1]. The present document is
related to other 3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [1].
\- The protocol that are used for service based interface is specified in TS
32.291 [58].
The description is following the same methodology as used in TS 23.501 [201]
and TS 23.502 [202] for the 5G system.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] - [54] Void.
[55] - [57] Void.
[58] 3GPP TS 32.291: \"Telecommunication management; Charging management; 5G
system; Charging service, stage 3.
[59] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] - [200] Void.
[201] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[202] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[203] - [206] Void.
[207] - [299] Void.
[300] 3GPP TS 29.510: \" 5G System; Network function repository services;
Stage 3\".
[301] - [370] Void.
[371] - [399] Void.
[400] - [499] Void.
[500] - [599] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [100], TS 32.240 [1] and the following apply. A term defined in
the present document takes precedence over the definition of the same term, if
any, in either 3GPP TR 21.905 [100] or TS 32.240 [1].
**5G Access Network:** An access network comprising a NG-RAN and/or non-3GPP
AN connecting to a 5G Core Network.
**5G Core Network:** The core network specified in the present document. It
connects to a 5G Access Network.
**NF service:** a functionality exposed by a NF through a service based
interface and consumed by other authorized NFs.
**NF service operation:** An elementary unit a NF service is composed of.
**service based interface:** It represents how a set of services is
provided/exposed by a given NF.
**charging session:** The association between the CHF (NF Service Producer)
that provides the charging service and NF service consumer.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Nchf Service-based interface exhibited by Charging Function.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
5GC 5G Core Network
5GS 5G System
CCS Converged Charging System
CHF Charging Function
IEC Immediate Event Charging
NF Network Function
PCF Policy Control Function
SBI Service based Interface
SMSF Short Message Service Function
SMF Session Management Function
# 4 Architecture reference model
## 4.1 General
The present document describes the service based architecture for 5G Charging.
## 4.2 Reference architecture
The NFs with CTF interact with CHF using Nchf interface for converged online
and offline charging. The NF PCF interacts with CHF using Nchf interface for
Spending Limit Control. The Nchf is a service based interface for NF and CHF.
Figure 4.2.1 depicts the reference architecture for the Nchf Interface.
Figure 4.2.1: Reference Architecture for the Nchf Interface; SBI
representation
# 5 Charging function requirement
## 5.1 Offline charging scenario
### 5.1.1 Basic principles
Basic principles for offline charging are defined in TS 32.240 [1].
### 5.1.2 Charging scenarios
#### 5.1.2.1 Introduction
Two basic scenarios are used:
\- Event based charging;
\- Session based charging.
Both scenarios may generate CDR files, which may then be transferred to the
network operator\'s BD for the purpose of subscriber billing and/or inter-
operator accounting.
#### 5.1.2.2 Scenarios
##### 5.1.2.2.1 Event based charging
Figure 5.1.2.2.1.1 shows a scenario for Post Event Charging, (PEC) where the
NF (CTF) interacts with the CHF after the service delivery.
Figure 5.1.2.2.1.1: Post Event Charging
**1) Request for resource usage:** A request for session establishment is
received in the NF (CTF).
**2) Content/Service Delivery:** the NF (CTF) delivers the content/service.
**3) Charging Data Request [Event]:** The NF (CTF) the CTF generates charging
data related to the delivered service and sends the request for the CHF to
store related charging data for CDR generation purpose.
**4) Create CDR:** the CHF stores received information and creates a CDR
related to the service.
**5) Charging Data Response [Event]:** The CHF informs the NF (CTF) on the
result of the request.
##### 5.1.2.2.2 Session based charging
Figure 5.1.2.2.2.1 shows a scenario for Offline session based charging where
the NF (CTF) interacts with the CHF.
Figure 5.1.2.2.2.1: Offline charging
**1) Request for service delivery and start of service delivery:** A request
for session establishment is received in the NF (CTF).
**2) Charging Data Request [Initial]:** The NF (CTF) sends the request to
inform the CHF about the service to be started.
**3) Open CDR:** the CHF opens a CDR related to the service.
**4) Charging Data Response [Initial]:** The CHF informs the NF (CTF) on the
result of the request and optionnaly provides the usage reporting triggers
applicable to the service.
**5) Content/Service Delivery:** the NF (CTF) delivers the content/service.
**6) Usage Reporting Trigger:** the NF (CTF) generates charging data related
to service delivered, based on a trigger for usage reporting is met.
**7) Charging Data Request [Update]:** the NF (CTF) sends the request for
reporting the related charging data to the CHF.
**8) Update CDR:** the CHF updates the CDR with charging data related to the
service.
**9) Charging Data Response [Update]:** The CHF informs the NF (CTF) on the
result of the request.
**10) Content/Service Delivery:** the NF (CTF) delivers the content/service.
**11) Service release:** the service is released.
**12) Charging Data Request [Termination]:** the NF (CTF) sends the request to
the CHF, for charging data related to the service termination.
**13) Close CDR:** the CHF closes the CDR with charging data related to the
service termination.
**14) Charging Data Response [Termination]:** The CHF informs the NF (CTF) on
the result of the request.
## 5.2 Online charging scenario
### 5.2.1 Basic principles
Basic principles for online charging are defined in TS 32.240 [1].
### 5.2.2 Charging scenarios
#### 5.2.2.1 Introduction
The following basic scenarios are used:
1 Immediate Event Charging
a) Decentralized Unit Determination and Centralized Rating
b) Centralized Unit Determination and Centralized Rating
c) Decentralized Unit Determination and Decentralized Rating
2 Event charging with Unit Reservation
a) Decentralized Unit Determination and Centralized Rating
b) Centralized Unit Determination and Centralized Rating
c) Decentralized Unit Determination and Decentralized Rating
3 Session charging with Unit Reservation
a) Decentralized Unit Determination and Centralized Rating
b) Centralized Unit Determination and Centralized Rating
c) Decentralized Unit Determination and Decentralized Rating
The combination of Centralized Unit Determination with Decentralized Rating is
not possible.
#### 5.2.2.2 Scenarios
The scenarios described in TS 32.299 [50], clauses 5.2.2.1, 5.2.2.2 and
5.2.2.3, apply with the CHF acting as an OCF.
### 5.2.3 Void
## 5.3 Converged Charging scenario
### 5.3.1 Basic principles
When offline charging and online charging are both applicable to a service
delivery, the charging information of both offline charging and online
charging can be provided in a single command, upon any triggers of the offline
charging or online charging is occur.
### 5.3.2 Charging scenarios
#### 5.3.2.1 Introduction
Converged charging for both events and sessions between CTF and the CHF is
performed as defined in TS 32.240 [1].
Two basic scenarios are used:
\- Converged Event based charging;
\- Converged Session based charging.
#### 5.3.2.2 Event based charging
For Converged Event based Charging the following cases are supported:
\- Immediate Event Charging (IEC);
\- Post Event Charging (PEC).
The scenario for Event based charging supported by IEC is shown in figure
5.3.2.2.1 with: Decentralized and Centralized Unit Determination, Centralized
Rating configurationand user\'s account balance deduction before service
delivery, where the NF (CTF) may invoke converged charging service towards the
CHF, prior to service delivery if needed.
Figure 5.3.2.2.1: IEC- Event based charging with Decentralized and Centralized
Unit Determination, Centralized Rating
**1) Request for resource usage:** A request for session establishment is
received in the NF (CTF). The service is configured to be authorized by the
CHF to start.
**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.
**3) Charging Data Request [Event, Units]:** The NF (CTF) sends the request to
the CHF for the service to be granted authorization, and to allow the number
of units, if determined in item 2, to be rated and accounted.
**4) Account, Rating Control:** The CHF calculates the number of monetary
units that represents the price and makes deduction of the calculated amount
from user\'s account balance based on the number of units requested or on
internal unit determination, if the user\'s credit balance is sufficient.
**5) Create CDR:** based on policies, the CHF creates a CDR related to the
service.
**6) Charging Data Response [Event, Units]:** The CHF grants authorization to
NF (CTF) for the service to start, with a number of granted units.
**7) Granted Units Supervision:** The service starts and the NF (CTF) monitors
the consumption of the granted units.
**8) Content/Service Delivery:** the NF (CTF) delivers the content/service
based on the number of units.
The scenario for Event based charging supported by PEC is described in figure
5.1.2.2.1.1.
#### 5.3.2.3 Session based charging
For Converged Session based Charging, the following cases are supported:
\- SCUR
\- ECUR
Figure 5.3.2.3.1 shows a scenario for Session based charging (SCUR) with: Unit
Reservation, Decentralized and Centralized Unit Determination, Centralized
Rating configuration, user's account deduction, where the NF (CTF) invokes a
converged charging service towards the CHF.
{width="5.021527777777778in" height="8.671527777777778in"}
Figure 5.3.2.3.1: SCUR - Session based charging withDecentralized and
Centralized Unit Determination, Centralized Rating
**1) Request for resource usage:** A request for session establishment is
received in the NF (CTF). The service is configured to be authorized by the
CHF to start.
**2) Units Determination:** the NF (CTF)) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.
**3) Charging Data Request [Initial, Quota Requested]:** The NF (CTF) sends
the request to the CHF for the service to be granted authorization to start,
and to reserve the number of units if determined in item 2.
**4) Account, Rating, Reservation Control:** the CHF rates the requests either
based on the number of units requested or on internal unit determination,
checks if corresponding funds can be reserved on the user\'s account balance.
If the account has sufficient funds, the CHF performs the corresponding
reservations.
**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.
**6) Charging Data Response [Initial, Quota Granted]:** The CHF grants
authorization to NF (CTF) for the service to start, with the reserved number
of units.
**7) Granted Units Supervision:** The service starts and the NF (CTF) monitors
the consumption of the granted units.
**8) Content/Service Delivery:** the NF (CTF) delivers the content/service
based on the reserved number of units.
**9) Usage Reporting Trigger:** the NF (CTF) generates charging data related
to service delivered, based on a trigger for usage reporting is met.
**10) Charging Data Request [Update]:** the NF (CTF) sends the request for
reporting the related charging data to the CHF.
**11) Account, Rating Control:** The CHF performs the reported usage process
involving rating entity and user\'s account balance.
**12) Update CDR:** based on policies, the CHF updates the CDR with charging
data related to the service.
**13) Charging Data Response [Update]:** The CHF informs the NF (CTF) on the
result of the request.
**14) Quota management Trigger:** A Trigger associated to Quota management is
met. Units determination is performed when applicable.
**15) Charging Data Request [Update, Quota Requested]:** the NF (CTF) sends
the request to the CHF, to be granted with more unit for the service to
continue, and also for reporting the used units.
**16) Account, Rating, Reservation Control:** The CHF performs the process
related to the reported usage and the requested reservation, involving rating
entity and user\'s account balance.
**17) Update CDR:** based on policies, the CHF updates the CDR with charging
data related to the service.
**18) Charging Data Response [Update, Quota Granted]:** The CHF grants quota
to NF (CTF) for the service to continue, with the reserved number of units.
**19) Content/Service Delivery:** the NF (CTF) delivers the content/service
based on the granted quota.
**20) Session released:** the session is released.
**21) Charging Data Generation:** the NF (CTF) generates charging data related
to service released.
**22) Charging Data Request [Termination]:** the NF (CTF) sends the request to
the CHF, for charging data related to the service termination with the final
consumed units.
**23) Account, Rating Control:** The CHF performs the service termination
process involving rating entity and user\'s account balance.
**24) Close CDR:** based on policies, the CHF closes the CDR with charging
data related to the service termination and the last reported units.
**25) Charging Data Response [Termination]:** The CHF informs the NF (CTF) on
the result of the request.
Figure 5.3.2.3.2 shows a scenario for Session based charging ( SCUR) with:
Unit Reservation, Decentralized and Centralized Unit Determination,
Centralized Rating configuration , user's account deduction , where the NF
(CTF) invokes a converged charging service towards the CHF.
Figure 5.3.2.3.2: SCUR - Session based charging with Decentralized and
Centralized Unit Determination, Centralized Rating, immediate start of service
delivery (Non-blocking mode)
**1) Request for service delivery and start of service delivery:** A request
for session establishment is received in the NF (CTF). The NF (CTF) is
configured to allow the service to be delivered.
**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested, in \"Decentralized Units determination\"
scenario.
**3) Charging Data Request [Initial, Quota Requested]:** the NF (CTF) sends
the request to the CHF to reserve the number of units if determined in step 2.
**4) Account, Rating, Reservation Control:** the CHF rates the requests either
based on the number of units requested or on internal unit determination,
checks if corresponding funds can be reserved on the user\'s account balance.
If the account has sufficient funds, the CHF performs the corresponding
reservation.
**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.
**6) Charging Data Response [Initial, Quota Granted]:** the CHF grants the
reserved number of units to NF (CTF).
**7) Granted Units Supervision:** The NF (CTF) monitors the consumption of the
granted units.
**8) Service delivery ongoing:** the NF (CTF) continues to deliver the
service.
**9) Usage reporting trigger:** a trigger associated with service usage
reporting is met.
**10) Charging Data Request [Update]:** the NF (CTF) reports the charging data
related to service delivered to the CHF.
**11) Account, Rating Control:** the CHF uses the reported charging data to
rate the usage and deduct the funds corresponding to the usage on the account
balance.
**12) Update CDR:** based on policies, the CHF updates the CDR with charging
data related to the service.
**13) Charging Data Response [Update]:** The CHF informs the NF (CTF) on the
result of the request.
**14) Quota management Trigger:** A Trigger associated to Quota management is
met. Units determination is performed when applicable.
**15) Charging Data Request [Update, Quota Requested]:** the NF (CTF) sends
the request to the CHF, to be granted with more unit for the service to
continue, and also for reporting the used units.
**16) Account, Rating, Reservation Control:** same as step 4, with the option
to also deduct the funds corresponding to the usage on the account balance.
**17) Update CDR:** based on policies, the CHF updates the CDR with charging
data related to the service.
**18) Charging Data Response [Update, Quota Granted]:** The CHF grants quota
to NF (CTF) for the service, with the reserved number of units.
**19) Service delivery ongoing:** the NF (CTF) continues to deliver the
service.
**20) Service release:** the NF (CTF) is requested to end the service delivery
and does this.
**21) Charging Data Request [Termination]:** the NF (CTF) sends the request to
the CHF, for charging data related to the service termination with the final
consumed units.
**22) Account, Rating Control:** the CHF performs the service termination
process which involve using the reported charging data to rate the usage and
deduct the funds corresponding to the usage on the account balance.
**23) Close CDR:** based on policies, the CHF closes the CDR with charging
data related to the service termination and the last reported units.
**24) Charging Data Response [Termination]:** The CHF informs the NF (CTF)on
the result of the request.
Figure 5.3.2.3.3 shows a scenario for Session based charging ECUR in
Decentralized and Centralized Unit Determination ,Centralized Rating
configuration, where the NF (CTF) invokes a converged charging service towards
the CHF, prior to service delivery if needed.
Figure 5.3.2.3.3: ECUR - Session based charging with - Decentralized and
Centralized Unit Determination, Centralized Rating.
**1) Request for resource usage:** A request for session establishment is
received in the NF (CTF). The service is configured to be authorized by the
CHF to start.
**2) Units Determination:** the NF (CTF) determines the number of units
depending on the service requested by the UE in \"Decentralized Units
determination\" scenario.
**3) Charging Data Request [Initial, Quota Requested]:** The NF (CTF) sends
the request to the CHF for the service to be granted authorization to start,
and to reserve the number of units if determined in item 2.
**4) Account, Rating, Reservation Control:** the CHF rates the requests either
based on the number of units requested or on internal unit determination,
checks if corresponding funds can be reserved on the user\'s account balance.
If the account has sufficient funds, the CHF performs the corresponding
reservation.
**5) Open CDR:** based on policies, the CHF opens a CDR related to the
service.
**6) Charging Data Response [Initial, Quota Granted]:** The CHF grants
authorization to NF (CTF) for the service to start, with the reserved number
of units.
**7) Granted Units Supervision:** The service starts and the NF (CTF) monitors
the consumption of the granted units.
**8) Content/Service Delivery:** the NF (CTF) delivers the content/service
based on the reserved number of units.
**9) Charging Data Request [Termination]:** the NF (CTF) sends the request to
the CHF, for charging data related to the delivered service with the consumed
units.
**10) Account, Rating Control:** The CHF performs the process for the
delivered service involving rating entity and user\'s account balance.
**11) Close CDR:** based on policies, the CHF closes the CDR with charging
data related to the delivered service.
**12) Charging Data Response [Termination]:** The CHF informs the NF (CTF) on
the result of the request.
5.3.2.4 Charging notification
The CHF can in Converged Session based Charging provide notifications to the
NF (CTF), the NF (CTF) implicitly subscribes to these when it sends a Charging
Data Request [Initial], i.e. there is no separate subscription request from
the NF for notification.
Figure 5.3.2.4-1 shows a scenario for Session based charging with a
notification from the CHF triggering a Charging Data Request [Update].
Figure 5.3.2.x.1: Session based charging -- Notification with Re-authorization
**1) Session based charging ongoing:** there is a session based charging
ongoing and there have at least been a Charging Data Request [Initial] sent
from the NF (CTF) to the CHF, and the CHF have opened a CDR.
**2) Event triggering notification:** an event is detected in the CHF that
requires a notification to be sent to the NF (CTF). In this scenario a request
for triggering a Charging Data Request [Update, Quota Request] is sent, but
also requests for Charging Data Request [Update] (without request for quota)
is possible.
**3) Charging Notify Request [Re-authorization]:** the CHF sends the request
to the NF (CTF), for a triggering of a Charging Data Request [Update, Quota
Request] i.e. Re-authorization.
**4) Charging Notify Response:** the NF (CTF) acknowledges the request by
sending a response.
**5) Charging Data Request [Update, Quota Requested]:** the NF (CTF) sends the
request to the CHF, to be granted with more unit for the service to continue,
and also for reporting the used units.
**6) Account, Rating, Reservation Control:** the CHF performs the process
related to the reported usage and the requested reservation, involving rating
entity and user\'s account balance.
**7) Update CDR:** based on policies, the CHF updates the CDR with charging
data related to the service.
**8) Charging Data Response [Update, Quota Granted]:** the CHF grants quota to
NF (CTF) for the service to continue, with the reserved number of units.
Figure 5.3.2.4.2 shows a scenario for Session based charging with a
notification from the CHF triggering a Charging Data Request [Termination].
Figure 5.3.2.4.2: Session based charging -- Notification with termination
**1) Session based charging ongoing:** there is a session based charging
ongoing and there have at least been a Charging Data Request [Initial] sent
from the NF (CTF) to the CHF, and the CHF have opened a CDR.
**2) Event triggering notification:** an event is detected in the CHF that
requires a notification to be sent to the NF (CTF). In this scenario a request
for triggering a Charging Data Request [Termination] is sent.
**3) Charging Notify Request [Terminate]:** the CHF sends the request to the
NF (CTF), for a triggering of a Charging Data Request [Termination] i.e. the
termination of the charging session.
**4) Charging Notify Response:** the NF (CTF) acknowledges the request by
sending a response.
**5) Charging Data Request [Termination]:** the NF (CTF) sends the request to
the CHF, for charging data related to the service termination with the final
consumed units.
**6) Account, Rating Control:** the CHF performs the process related to the
reported usage, involving rating entity and user\'s account balance.
**7) Close CDR:** based on policies, the CHF **closes** the CDR with charging
data related to the service.
**8) Charging Data Response [Termination]:** The CHF informs the NF (CTF) on
the result of the request.
## 5.4 Other functionalities
### 5.4.1 Re-authorization
The CHF (NF Service Producer) may trigger a re-authorization request and the
NF Service Consumer shall report quota usage. The reason for the quota being
reported shall be notified to the CHF (NF Service Producer). This is described
under charging notification procedure in clause 5.3.2.4.
The NF Service Consumer may receive a Charging Notify Request while waiting
for a Charging Data Response from the CHF. In this case the NF Service
Consumer shall not send a new Charging Data Request.
The NF Service Consumer may receive a Charging Notify Request while not
waiting for any Charging Data Response from the CHF. In this case the NF
Service Consumer shall send a new Charging Data Request.
### 5.4.2 Threshold based re-authorization triggers
The CHF (NF Service Producer) may optionally include an indication to the NF
Service Consumer of the remaining quota threshold that shall trigger a quota
re-authorization.
### 5.4.3 Termination action
The CHF (NF Service Producer) may specify to the NF Service Consumer the
behaviour on consumption of the final granted units, or zero units granted in
the first place; this is known as termination action.
### 5.4.4 Service termination
The CHF (NF Service Producer) may determine that a service requires
termination. The NF Service Producer may perform this termination
synchronously if it has a request pending processing by returning response.
If the CHF (NF Service Producer) does not have a pending request
(asynchronous), the NF Service Producer may trigger an abort notification to
terminate the charging session. On reception of an abort notification, the NF
consumer shall terminate the associated charging session by sending a
Nchf_ConvergedCharging_Release. If the associated charging session is not
currently active or NF consumer does not terminate the charging session for
any other reason, the corresponding error response is returned.
### 5.4.5 Trigger Mechanism
There are a number of mid-session service events (triggers), which could
affect the rating of the current service usage, e.g. end user QoS changes or
location updates. The details for this service events are defined in the
service specific document (middle tier TS).
Some service events are allowed to be enabled/disabled by CHF. For such
events, when allocating resources in the CHF, the CHF may instruct the NF
consumer to update the unit upon a number of different session related
triggers that can affect the rating conditions. The CHF instruct the NF
consumer to monitor for such events by using the Triggers element containing
one or more trigger type in the response message.
One or more triggers may be armed by default at the NF consumer.The CHF may
arm one or more triggers using the Triggers element at the NF consumer, the
armed triggers at the NF consumer shall remain in effect until another
Triggers element is received from the CHF for the same service usage/Rating
Group, where the NF consumer shall arm all triggers present in the Triggers
element and reset all other triggers. The presence of the Triggers element
without any trigger type in a response message allows CHF to disable all the
triggers that were armed in a previous Triggers element of the same service
usage/Rating Group.
NOTE: This removes the need for the CHF to send trigger information in every
response message when they have not changed.
Two categories of chargeable events are identified:
\- immediate report: chargeable events for which, when occurring, the current
counts are closed and sent together with the charging data generated by the NF
consumer towards the CHF in a Request message. New counts are started by the
NF consumer.
> \- deferred report: chargeable events for which, when occurring, the current
> counts are closed and stored together with the charging data generated by
> the NF consumer. The stored counts will be sent to the CHF in next a Request
> message. New counts are started by the NF consumer.
CHF may change the category of one or more triggers by using the Triggers
element containing category information in the response message.
When one of the armed immediate triggers happen, a update request shall be
sent to the CHF including information related to the service event even if all
the granted service units have not been used. The quota is also being
reported.
If the Triggers element is used, then the NF consumer shall only update the
units for the service usage associated with events which were included in the
last received Triggers element.
If the server does not control the events for re-authorization using the
Triggers element, the NF consumer shall only monitor for default events
defined in the relevant service specific document (middle tier TS).
The rating group may contain different triggers that are additive and
complementary to the common set of triggers for the charging session.
## 5.5 Error handling
### 5.5.1 Failure handling
#### 5.5.1.1 CTF detected failure
The NF Consumer shall have a locally configured failure handling procedure, in
case a failure is detected for the Charging Data Request or Response. The
failure handling may be overridden by CHF using Failure Handling field in
Invocation Result, to indicate how the NF consumer (CTF) shall behave in case
of a failure. The latest value for Failure Handling received from CHF shall be
applicable until a new value is received.
The NF consumer (CTF) shall support three types of Failure Handling:
\- **Continue:** the charged session or event shall be allowed to continue
without charging, based on locally configured limits (e.g. time, volume). The
NF consumer (CTF) may retry the request;
\- **Terminate:** the charged session or event shall not be allowed to
continue, the NF consumer (CTF) shall try to send a Termination to the CHF in
the case the failed request was an Initial or Update;
\- **Retry and Terminate:** the request may be retried towards the CHF before
the NF consumer (CTF) follows the Terminate failure handling procedure.
#### 5.5.1.2 CHF detected failure
In the case a failure is detected for the Charging Data Request or Response
the CHF closes a CDR and all the reserved resources are freed for the charging
session.The charging session may be kept or released based on local
configuration.
A Charging Data Request [Initial] received by a CHF, which can be associated
to an existing charging session (i.e. resource in CHF), shall be handled as a
valid request and be answered with Charging Data Response [Initial] with the
charging session id.
A Charging Data Request [Update] received by a CHF, which cannot be associated
to any existing charging session (i.e. resource in CHF), shall be handled as a
valid request with the associated resource creation and quota usage handling.
A Charging Data Request [Termination] received by a CHF, which cannot be
associated to any existing charging session (i.e. resource in CHF), shall be
handled as a valid request with associated new resource creation, and optional
corresponding CDR creation.
In the case a failure is detected for the Charging Notify Request the Charging
session shall be kept, and the CHF may retry the notification.
### 5.5.2 Retry handling
The NF consumer (CTF) may retry the message, the number of retries and delay
between retries shall be locally configured in the NF consumer (CTF).
If the retried charging data request [Initial] is received by the same CHF,
the uniqueness checking may be based on the Charging Identifier included in
the charging data request. CHF shall respond to the retried charging data
request [Initial] with the original charging session identifier.
If the retried request is charging data request [Update] or charging data
request [Termination], the uniqueness checking may based on the inspection of
the Charging Session Identifier and Invocation Sequence Number pair.
If the retried message shall have the same Invocation Sequence Number as the
original of the retried message i.e. the Invocation Sequence Number shall not
be incremented when the message is retried. The NF consumer (CTF) may send the
retried message to an alternative CHF if the Session Failover indication is
received from the CHF.
In the case of a notification request time out the CHF may retry the message.
The number of retries and delay between retries shall be locally configured in
the CHF.
### 5.5.3 Response code handling
The Charging Data Response includes a response code (i.e. Invocation Result
Code in Invocation Result) which may indicate an error. The response codes
supported by Nchf_ConvergedCharging service operations are specified 3GPP TS
32.291 [58].
A NF Consumer (CTF) receiving a Charging Data Response [Initial] with a
response code indicating the Charging Data Request [Initial] was
unsuccessfully processed, shall perform the error handling applicable to the
response code and may send a Charging Data Request [Termination] to the CHF.
A NF Consumer (CTF) receiving a Charging Data Response [Termination] with a
response code indicating the Charging Data Request [Termination] was
unsuccessfully processed, shall perform the error handling applicable to the
response code.
A NF Consumer (CTF) receiving a Charging Data Response [Update] with a
response code indicating the Charging Data Request [Update] was unsuccessfully
processed, shall perform the error handling applicable to the response code
and may send a Charging Data Request [Termination] to the CHF.
The Charging Data Response may also include multiple \"Multiple Unit
Information\" Information Elements, each one indicated with a Result code
(i.e. applicable at Rating group level). The Result code values supported by
Nchf_ConvergedCharging service operations are specified 3GPP TS 32.291 [58].
Any Invocation Result Code value different than success takes precedence over
the set of \"Multiple Unit Information\" Result Codes.
# 6 Service Definition
## 6.1 NF Service Framework
5G Charging Function supports to interact with NRF, as specified in clause 7.1
of TS 23.501 [201] and clauses 4.17 and 5.2.7 of TS 23.502 [202]to enable
following functionalities:
\- CHF registration.
\- CHF update.
\- CHF deregistration.
\- CHF discovery by CHF service consumer.
The services specified in clause 7.2.6 TS 23.501 [201] may be used and the
interaction is described in TS 29.510 [300]:
\- Nnrf_NFManagement.
\- Nnrf_NFDiscovery.
\- Nnrf_AccessToken.
The Nnrf_NFManagement_NFRegister service invoked by CHF for CHF registration
may include in particular:
\- Range(s) of SUPIs.
\- Range(s) of GPSIs.
\- Range(s) of PLMNs.
These parameters may also be used by CHF service consumer(s) invoking the
Nnrf_NFDiscovery service for the CHF discovery.
## 6.2 Nchf_ConvergedCharging service
### 6.2.1 General
**Service description:** The ConvergedCharging service provides charging for
session and event based NF services. This ConvergedCharging service offers
charging :
\- With quota management (online; this includes support for both blocking mode
and non-blocking mode)
\- Without quota management (offline)
\- Charging information record generation
The following table shows the CHF Services and CHF Service Operations.
Table 6.2.1-1: NF services provided by the CHF
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +----------------+----------------+----------------+----------------+ | Nchf_Con | Create | Re | SMF, SMSF | | vergedCharging | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Update | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Release | Re | SMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | Notify | Notify | SMF | +----------------+----------------+----------------+----------------+
The input and output parameters described in the clauses below are common to
all NF Consumers. The usage of these common parameters and additional NF
Consumer specific parameters are specified in dedicated charging
specifications.
### 6.2.2 Nchf_ConvergedCharging_Create service operation
**Service operation name:** Nchf_ConvergedCharging_Create
**Description:** Provides charging capabilities before service delivery,
offers charging with and without quota management, as well as charging
information record generation. It is used for both session and event based
charging. Provides means for the NF Consumer to create the resource of the
charging session. If it is used for session based charging the operation also
makes an implicit subscribe to notification of events in CHF that requires re-
authorization or abort.
The service operation may be used to request quota authorisation for service
delivery and may open a CDR in the CHF, based on the information provided by
the NF Consumer.
**Known NF Consumers:** SMF, SMSF.
**Inputs, Required:** Subscriber identifier, either service identification or
rating group.
**Inputs, Optional:** Requested service units, one-time event, destination
address, provider, location information, time and date.
**Outputs, Required:** Result indication.
**Outputs, Optional:** Granted service units, validity time, triggers.
### 6.2.3 Nchf_ConvergedCharging_Update service operation
**Service operation name:** Nchf_ConvergedCharging_Update
**Description:** Provides charging capabilities during service delivery,
offers usage reporting and quota management, as well as charging information
record generation.
The service operation is used to report usage and may request further quota
authorisation, if the trigger conditions occurs, this operation may cause
update of the CDR or production of an interim CDR in the CHF.
**Known NF Consumers:** SMF.
**Inputs, Required:** Subscriber identifier (Optional for emergency session),
session identifier, reporting reason.
**Inputs, Optional:** Requested service units, used service units.
**Outputs, Required:** Result indication.
**Outputs, Optional:** Granted service units, validity time, triggers.
### 6.2.4 Nchf_ConvergedCharging_Release service operation
**Service operation name:** Nchf_ConvergedCharging_Release
**Description:** Provides charging capabilities after service delivery, offers
usage reporting and charging information record generation. Provides means for
the NF Consumer to release the resource of charging session information.
The charging delete request is used to report usage and close the CDR in the
CHF if it has been opened.
**Known NF Consumers:** SMF.
**Inputs, Required:** Subscriber identifier, session identifier, release
reason.
**Inputs, Optional:** Used service units.
**Outputs, Required:** Result indication.
**Outputs, Optional:** None.
### 6.2.5 Nchf_ConvergedCharging_Notify service operation
**Service operation name:** Nchf_ConvergedCharging_Notify
**Description:** Provides notification to NF consumers of the subscribed
events.
CHF provides the re-authorization type notificationthat would lead NF
consumers to send an Nchf_ConvergedCharging_Update reporting the current
usage.
CHF provides the abort type notification that would lead NF consumers to send
an Nchf_ConvergedCharging_ Release to terminate the charging session.
**Known NF Consumers:** SMF.
**Inputs, Required:** Subscriber identifier, notification type (re-
authorization or abort).
**Inputs, Optional:** rating group, service id.
**Outputs, Required:** Result indication.
**Outputs, Optional:** None
## 6.3 Nchf_SpendingLimitControl service
### 6.3.1 Overview
The \"Nchf_SpendingLimitControl\" service is defined in 23.502 [202] clause
5.2.17.2.
## 6.4 Void
# 7 Message contents
Converged charging is performed by NF (CTF) consuming service operations
exposed by CHF, achieved using Charging Data Request and Charging Data
Response.
The information structure used for these services operations is composed of
two parts:
\- Common structures specified in the present document.
\- NF (CTF) consumer specific structures specified in the middle tier TSs.
Table 7.1 describes the data structure which is common to operations in
request semantics.
Table 7.1: Common Data structure of Charging Data Request
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Session Identifier | O~C~ | This field identifies | | | | the charging session. | +--------------------------+--------------+--------------------------+ | Subscriber Identifier | O~M~ | This field contains the | | | | identification of the | | | | subscriber that uses the | | | | requested service. | +--------------------------+--------------+--------------------------+ | NF Consumer | M | This is a grouped field | | Identification | | which contains a set of | | | | information identifying | | | | the NF consumer of the | | | | charging service. | +--------------------------+--------------+--------------------------+ | > NF Functionality | M | This field contains the | | | | function of the node. | +--------------------------+--------------+--------------------------+ | > NF Name | O~C~ | This fields holds the | | | | name (i.e. UUID) of the | | | | NF consumer. At least | | | | one of the NF Address or | | | | NF Name shall be | | | | present. | +--------------------------+--------------+--------------------------+ | > NF Address | O~C~ | This field holds the | | | | address (i.e. IP address | | | | and/or FQDN) of NF | | | | consumer. At least one | | | | of the NF Address or NF | | | | Name shall be present. | +--------------------------+--------------+--------------------------+ | > NF PLMN ID | O~C~ | This field holds the | | | | PLMN ID of the network | | | | the NF consumer belongs | | | | to. | +--------------------------+--------------+--------------------------+ | Charging Identifier | O~M~ | This field contains the | | | | charging identifier | | | | allowing correlation of | | | | charging information. | | | | Only applicable if not | | | | provided in the NF (CTF) | | | | consumer specific | | | | structure. | +--------------------------+--------------+--------------------------+ | Invocation Timestamp | M | This field holds the | | | | timestamp of the | | | | charging service | | | | invocation by the NF | | | | consumer | +--------------------------+--------------+--------------------------+ | Invocation Sequence | M | This field contains the | | Number | | sequence number of the | | | | charging service | | | | invocation by the NF | | | | consumer in a charging | | | | session.. | +--------------------------+--------------+--------------------------+ | One-time Event | OC | This field indicates, if | | | | included, that this is | | | | event based charging and | | | | whether this is a | | | | one-time event in that | | | | there will be no update | | | | or termination. | +--------------------------+--------------+--------------------------+ | One-time Event Type | OC | This field indicated the | | | | type of the one time | | | | event, i.e. Immediate or | | | | Post event charging. | +--------------------------+--------------+--------------------------+ | Notify URI | O~C~ | This field contains URI | | | | to which notifications | | | | are sent by the CHF. The | | | | latest received value | | | | shall always be used at | | | | notifications. | +--------------------------+--------------+--------------------------+ | Service Specification | O~C~ | This field identifies | | Information | | the technical | | | | specification for the | | | | service (e.g. TS 32.255) | | | | and release version | | | | (e.g. Release 16) that | | | | applies to the request. | | | | It is for information. | +--------------------------+--------------+--------------------------+ | Triggers | O~C~ | This field identifies | | | | the event(s) triggering | | | | the request and is | | | | common to all Multiple | | | | Unit Usage occurrences. | +--------------------------+--------------+--------------------------+ | Multiple Unit Usage | O~C~ | This field contains the | | | | parameters for the quota | | | | management request | | | | and/or usage reporting. | | | | It may have multiple | | | | occurrences. | +--------------------------+--------------+--------------------------+ | > Rating Group | M | This field holds the | | | | identifier of a rating | | | | group. | +--------------------------+--------------+--------------------------+ | > Requested Unit | O~C~ | This field indicates, if | | | | included, that quota | | | | management is required. | | | | It may additionally | | | | contain the amount of | | | | requested service units | | | | for a particular | | | | category. | +--------------------------+--------------+--------------------------+ | > Time | O~C~ | This field holds the | | | | amount of requested | | | | time. | +--------------------------+--------------+--------------------------+ | > Total Volume | O~C~ | This field holds the | | | | amount of requested | | | | volume in both uplink | | | | and downlink directions. | +--------------------------+--------------+--------------------------+ | > Uplink Volume | O~C~ | This field holds the | | | | amount of requested | | | | volume in uplink | | | | direction. | +--------------------------+--------------+--------------------------+ | > Downlink Volume | O~C~ | This field holds the | | | | amount of requested | | | | volume in downlink | | | | direction. | +--------------------------+--------------+--------------------------+ | > Service Specific Units | O~C~ | This field holds the | | | | amount of requested | | | | service specific units. | +--------------------------+--------------+--------------------------+ | > Used Unit Container | O~C~ | This field contains the | | | | amount of used | | | | non-monetary service | | | | units measured. up to | | | | the triggers and trigger | | | | timestamp. It may have | | | | multiple occurrences. | +--------------------------+--------------+--------------------------+ | > Service Identifier | O~C~ | This field holds the | | | | Service Identifier. | +--------------------------+--------------+--------------------------+ | > Quota management | O~C~ | This field holds an | | > Indicator | | indicator on whether the | | | | reported used units are | | | | with or without quota | | | | management control. If | | | | the field is not | | | | present, it indicates | | | | the used unit is without | | | | quota management | | | | applied. | +--------------------------+--------------+--------------------------+ | > Triggers | O~C~ | This field holds reason | | | | for charging information | | | | reporting or closing for | | | | the used unit container. | +--------------------------+--------------+--------------------------+ | > Trigger Timestamp | O~C~ | This field holds the | | | | timestamp of the | | | | trigger. | +--------------------------+--------------+--------------------------+ | > Time | O~C~ | This field holds the | | | | amount of used time. | +--------------------------+--------------+--------------------------+ | > Total Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | both uplink and downlink | | | | directions. | +--------------------------+--------------+--------------------------+ | > Uplink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | uplink direction. | +--------------------------+--------------+--------------------------+ | > Downlink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | downlink direction. | +--------------------------+--------------+--------------------------+ | > Service Specific Unit | O~C~ | This field holds the | | | | amount of used service | | | | specific units. | +--------------------------+--------------+--------------------------+ | > Event Time Stamps | O~C~ | This field holds the | | | | timestamps of the event | | | | reported in the Service | | | | Specific Units, if the | | | | reported units are event | | | | based. | +--------------------------+--------------+--------------------------+ | > Local Sequence Number | O~M~ | This field holds the | | | | container sequence | | | | number. | +--------------------------+--------------+--------------------------+
Table 7.2 describes the data structure which is common to operations in
response semantics.
Table 7.2: Common Data structure of Charging Data Response
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Session Identifier | O~C~ | This field identifies | | | | the charging session. | +--------------------------+--------------+--------------------------+ | Invocation Timestamp | M | This field holds the | | | | timestamp of the | | | | charging service | | | | response from the CHF. | +--------------------------+--------------+--------------------------+ | Invocation Result | O~C~ | This field holds the | | | | failure handling and in | | | | case of unsuccessful | | | | result of the charging | | | | service invocation by | | | | the NF consumer the | | | | result code. | +--------------------------+--------------+--------------------------+ | > Invocation Result Code | O~C~ | This field contains the | | | | result code in case of | | | | failure. | +--------------------------+--------------+--------------------------+ | > Failed parameter | O~C~ | This field holds missing | | | | and/or unsupported | | | | parameter that caused | | | | the failure. | +--------------------------+--------------+--------------------------+ | > Failure Handling | O~C~ | This field holds the | | | | failure handling to be | | | | performed by the NF | | | | consumer when failure. | +--------------------------+--------------+--------------------------+ | Invocation Sequence | M | This field holds the | | Number | | sequence number of the | | | | charging service | | | | invocation by the NF | | | | consumer. | +--------------------------+--------------+--------------------------+ | Session Failover | O~C~ | This field indicates | | | | whether alternative CHF | | | | is supported for ongoing | | | | charging service | | | | failover handling by NF | | | | consumer. | +--------------------------+--------------+--------------------------+ | Triggers | O~C~ | This field holds the | | | | triggers supplied from | | | | the CHF for the charging | | | | session that are | | | | independent of rating | | | | group with or without | | | | quota management. | +--------------------------+--------------+--------------------------+ | Multiple Unit | O~C~ | This field holds the | | Information | | parameters for the quota | | | | management and/or usage | | | | reporting information. | | | | It may have multiple | | | | occurrences. | +--------------------------+--------------+--------------------------+ | > Result Code | O~C~ | This field contains the | | | | result of the Rating | | | | Group quota allocation. | +--------------------------+--------------+--------------------------+ | > Rating Group | O~M~ | The identifier of a | | | | rating group. | +--------------------------+--------------+--------------------------+ | > Granted Unit | O~C~ | This field holds the | | | | granted quota. | +--------------------------+--------------+--------------------------+ | > Tariff Time Change | O~C~ | This field contains the | | | | switch time when the | | | | tariff will be changed. | +--------------------------+--------------+--------------------------+ | > Time | O~C~ | This field holds the | | | | amount of granted time. | +--------------------------+--------------+--------------------------+ | > Total Volume | O~C~ | This field holds the | | | | amount of granted volume | | | | in both uplink and | | | | downlink directions. | +--------------------------+--------------+--------------------------+ | > Uplink Volume | O~C~ | This field holds the | | | | amount of granted volume | | | | in uplink direction. | +--------------------------+--------------+--------------------------+ | > Downlink Volume | O~C~ | This field holds the | | | | amount of granted volume | | | | in downlink direction. | +--------------------------+--------------+--------------------------+ | > Service Specific Units | O~C~ | This field holds the | | | | amount of granted | | | | requested service | | | | specific units. | +--------------------------+--------------+--------------------------+ | > Validity Time | O~C~ | This field defines the | | | | time in order to limit | | | | the validity of the | | | | granted quota for a | | | | given category instance. | +--------------------------+--------------+--------------------------+ | > Final Unit Indication | O~C~ | This field indicates the | | | | granted final units for | | | | the service. | +--------------------------+--------------+--------------------------+ | > Time Quota Threshold | OC | This field indicates the | | | | threshold in seconds | | | | when the granted quota | | | | is time | +--------------------------+--------------+--------------------------+ | > Volume Quota Threshold | OC | This field indicates the | | | | threshold in octets when | | | | the granted quota is | | | | volume | +--------------------------+--------------+--------------------------+ | > Unit Quota Threshold | OC | This field indicates the | | | | threshold in service | | | | specific units, that are | | | | defined in the service | | | | specific documents, when | | | | the granted quota is | | | | service specific | +--------------------------+--------------+--------------------------+ | > Quota Holding Time | O~C~ | This field holds the | | | | quota holding time in | | | | seconds. | +--------------------------+--------------+--------------------------+ | > Triggers | O~C~ | This field holds | | | | triggers for usage | | | | reporting associated to | | | | the rating group, which | | | | is supplied from the | | | | CHF. | +--------------------------+--------------+--------------------------+
The CTF NF consumer specific structures which are specified in the middle tier
TSs, are defined as extensions of:
\- common part structure of Charging Data Request and Charging Data Response.
\- structure of Multiple Unit Usage.
\- structure of Multiple Unit Information.
Table 7.3 describes the data structure which is common to Charging Notify
Request.
Table 7.3: Common Data structure of Charging Notify Request
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Notify URI | M | This field holds the URI | | | | previously supplied by the | | | | CHF for notifications | | | | associated to the charging | | | | session. | +----------------------------+----------+----------------------------+ | Notification type | M | This field holds the type | | | | of notification indicating | | | | re-authorization or | | | | termination. | +----------------------------+----------+----------------------------+ | Reauthorization Details | O~C~ | This field holds the | | | | details of | | | | re-authorization. | | | | | | | | It's only present when | | | | type of notification is | | | | re-authorization. If not | | | | present and type of | | | | notification is | | | | re-authorization, the | | | | re-authorization | | | | notification applies to | | | | all units. | +----------------------------+----------+----------------------------+ | > Service Identifier | O~C~ | This field holds the | | | | Service Identifier to | | | | which re-authorization | | | | notification applies. If | | | | present, the rating group | | | | shall also be present. If | | | | not present the | | | | re-authorization | | | | notification applies to | | | | all service identifiers. | +----------------------------+----------+----------------------------+ | > Rating Group | O~C~ | This field holds the | | | | rating group to which | | | | re-authorization | | | | notification applies. If | | | | not present the | | | | re-authorization | | | | notification applies to | | | | all rating groups. | +----------------------------+----------+----------------------------+ | > Quota management | O~C~ | This field holds an | | > Indicator | | indicator on whether the | | | | re-authorization | | | | notification is for quota | | | | management control or not. | | | | If not present the | | | | re-authorization | | | | notification applies to | | | | both units with and | | | | without quota management. | +----------------------------+----------+----------------------------+
Table 7.4 describes the data structure which is common to Charging Notify
Response.
Table 7.4: Common Data structure of Charging Notify Response
+--------------------------+----------+----------------------------+ | Information Element | Category | Description | +--------------------------+----------+----------------------------+ | Invocation Result | O~C~ | This field holds the | | | | result code in case of | | | | unsuccessful result of the | | | | charging notify request. | +--------------------------+----------+----------------------------+ | > Invocation Result Code | O~C~ | This field contains the | | | | result code in case of | | | | failure. | +--------------------------+----------+----------------------------+ | > Failed parameter | O~C~ | This field holds missing | | | | and/or unsupported | | | | parameter that caused the | | | | failure. | +--------------------------+----------+----------------------------+
#
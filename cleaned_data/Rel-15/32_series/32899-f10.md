# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document studies the charging architecture, principles and
functionalities for a 5G System Phase 1 specified in TS 23.501 [201] and TS
23.502 [202], based on the TR 23.799 [200] conclusions.
The stage 1 requirements from TS 22.115 [101] and TS 22.261 [102] are also
input for this study.
The charging architecture and functionalities are studied for the set of
features and capabilities supported by the 5G System Phase 1, and for
interworking scenarios between the 5G System and existing systems as well.
Evolution of charging mechanisms and charging models to support the Third
Parties are investigated.
The study provides a prioritisation between the different features, if
evaluated as necessary, to allow a potential phased approach for the normative
work.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles \".
[2] - [10] Void
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] - [13] Void.
[14] 3GPP TS 32.254: \"Northbound Application Program Interfaces (APIs) for
exposure function interworking charging\".
[15] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets; Stage 1\".
[103] - [199] Void.
[200] 3GPP TR 23.799: \"Study on Architecture for Next Generation System\".
[201] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[202] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[203] 3GPP TS 28.530 Telecommunication management; Management of network
slicing in mobile networks; Concepts, use cases and requirements
[204] 3GPP TS 23.503: \" Policy and Charging Control Framework for the 5G
System; Stage 2\".
[205] 3GPP TS 23.222: \"Functional architecture and information flows to
support Common API Framework for 3GPP Northbound APIs; Stage 2\".
[206] - [400] Void.
[401] IETF RFC 6733 (2012): \"Diameter Base Protocol\".
[402] IETF RFC 4006 (2005): \"Diameter Credit-Control Application\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [100].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
NSI Id An identifier, which is used to uniquely identify a Network Slice
Instance (NSI).
SD A Slice Differentiator (SD). which is optional information that complements
the Slice/Service type(s) to allow further differentiation for selecting an
Network Slice instance from the potentially multiple Network Slice instances
that all comply with the indicated Slice/Service type.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
AMF Access and Mobility Management Function
AF Application Function
AN Access Network
DN Data Network
DNN Data Network Name
NEF Network Exposure Function
NRF NF Repository Function
NSI Network Slice Instance
NSSAI Network Slice Selection Assistance Information
PCF Policy Control Function
PDU Protocol Data Unit
SM Session Management
SMF Session Management Function
S-NSSAI Single Network Slice Selection Assistance Information
SSC Service and Session Continuity
UDM Unified Data Management
UPF User Plane Function
# 4 High-level description and potential requirements
## 4.1 Potential high-level charging requirements
Most of the High-level charging requirements specified in TS 22.115 [101],
applicable to LTE, remain valid in 5G.
Some of them are summarized below so they can directly be used in the context
of this study. The following should be supported:
\- Volume, time, combined volume and time, and event based charging models;
\- Session based charging;
\- Application based charging model;
\- Usage real-time control;
\- capability for billing system support;
\- capability for inter-operator charging;
\- capability for Network operator to Third party providers charging.
A set of Charging requirements specific to 5G are specified in TS 22.261
[102], and copied below:
_\- \"The 5G core network shall support collection of charging information for
alternative authentication mechanisms._
_\- The 5G core network shall support collection of charging information
associated with each serving MNO when multi-network connectivity is used under
the control of the home operator._
_\- The 5G core network shall support charging for services/applications in an
operator\'s Service Hosting Environment._
_\- The 5G core network shall support charging for content delivered from a
content caching application._
_\- The 5G core network shall support collection of charging information based
on the access type (e.g., 3GPP, non-3GPP)._
_\- The 5G core network shall support collection of charging information based
on the slice that the UE accesses._
_\- The 5G core network shall support collection of charging information based
on the network performance metrics, when the information is available.\"_
Editor\'s Note: the requirements for 5G charging are still to be completed,
either at High-level by update of this clause, either under specific clauses
of the TR when they correspond to dedicated topics.
## 4.2 Reference 5G system architectures
### 4.2.1 Non-roaming 5G system architecture
The 5G System architecture reference is per TS 23.501 [201], Service-based
interfaces are used within the Control Plane.
Figure 4.2.1.1: 5G System architecture
Figure 4.2.1.2 depicts the 5G System architecture in the non-roaming case,
using the reference point representation showing how various network functions
interact with each other.
Figure 4.2.1.2: Non-Roaming 5G System Architecture in reference point
representation
Figure 4.2.1.3 represents the non-roaming architecture for interworking
between 5GS and EPC/E-UTRAN.
Figure 4.2.1.3: Non-roaming architecture for interworking between 5GS and
EPC/E-UTRAN
### 4.2.2 Roaming 5G system architecture
#### 4.2.2.1 Roaming 5G system architecture - LBO scenario
The 5G System architecture reference for Roaming -LBO is per TS 23.501 [201]:
{width="6.666666666666667in" height="3.984722222222222in"}
Figure 4.2.2.1.1: Roaming 5G System architecture - local breakout scenario
with AF in VPLMN in reference point representation
{width="6.666666666666667in" height="3.984722222222222in"}
Figure 4.2.2.1.2: Roaming 5G System architecture -local breakout scenario with
AF in the HPLMN in reference point representation
#### 4.2.2.2 Roaming 5G system architecture -- Home routed scenario
The 5G System architecture reference for Home Routed is per TS 23.501 [201]:
{width="6.64375in" height="4.269444444444445in"}
Figure 4.2.2.2.1: Roaming 5G System architecture-Home routed scenario in
reference point representation
## 4.3 Conventions
In the present document, when flows are introduced for a given solution, to
reflect the step in which the interaction between the 5G System Network
Element and the Charging domain occurs, this interaction is indicated as step
A in the following figure:
Figure 4.3.1: Flow example
Where step A is a direct interaction between the 5G System Network Element
(SMF) and the Charging domain.
Other steps (x, y) may not indicate direct interaction.
All the flows included in the present document when referring to TS 23.502
[202] flows, may have differences with the corresponding TS 23.502 [202]
flows: e.g. step numbering and names of the messages may differ.
# 5 Topics
## 5.1 Session management and service continuity
### 5.1.1 Description and assumptions
The PDU Connectivity Service towards different types of DNs (e.g. Internet,
IMS, corporate/private) is provided by a PDU Session, managed by the Session
Management functionality via procedures for establishing new PDU sessions and
modifying/terminating established PDU sessions.
Based on PDU session definition in TS 23.501 [201] (i.e. Association between
the UE and a Data Network that provides a PDU connectivity service), the PDU
session is per DNN, similar as for EPC the PDN connection was per
APN.Different PDU types (IP, Ethernet and non-IP PDU types) can be supported.
For PDU IP type, the UE IP address allocation & management is also part of the
Session Management.
This Session Management functionality is specified in TS 23.501 [201] clause
5.6.
The session and service continuity functionality enables various continuity
scenarios of different applications/services for the UE, via session and
service continuity (SSC) modes determined by the Session Management
functionality. The SSC mode associated with a PDU session anchor does not
change during the lifetime of a PDU session.
The session and service continuity functionality is specified in TS 23.501
[201] clause 5.6.9.
An unique identity number (i.e. the Charging Id) is assigned to the PDU
session by the SMF to identify the Charging session belongs to the same PDU
session.
### 5.1.2 Potential requirements
The following should be supported for the PDU connectivity service:
\- session based charging;
\- time based charging;
\- charging based on different properties of the connectivity: destination,
PDU type;
\- charging based on usage of the external data network identified by a DNN;
\- charging continuity for a PDU session in service continuity scenario, when
the PDU session is served by a given SMF.
### 5.1.3 Key issues
#### 5.1.3.1 Key issue #1.1: PDU session charging
This key issue is for investigating on how to support the session based and
time based charging models, for PDN connectivity service provided by a PDU
session, also considering the different properties of this PDU session.
This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain.
#### 5.1.3.2 Key issue #1.2: PDU session charging - SSC Mode 1
This key issue is for investigating on how to support the PDU session Charging
for an established PDU session during SSC Mode 1 scenario.
This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain.
#### 5.1.3.3 Key issue #1.3: PDU session charging - SSC Mode 2
This key issue is for investigating on how to support the PDU session Charging
for an established PDU session during PDU session anchor relocation in SSC
Mode 2. This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain,
#### 5.1.3.4 Key issue #1.4: PDU session charging - SSC Mode 3 -- parallel
traffic
This key issue is for investigating on how to support the PDU session Charging
for an established PDU session during PDU session anchor relocation in SSC
Mode 3. This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain;
\- usage collection of traffic running simultaneously in two UPFs, upon UE PDU
session anchor relocation in SSC mode 3 in a \"make before break\" model.
### 5.1.4 Solutions
#### 5.1.4.1 Solution#1.1: PDU session charging from SMF
##### 5.1.4.1.1 Architecture description
The charging information collection for the PDU session at \"session
management\" level can be achieved by charging domain interfacing the SMF, as
described in Figure 5.1.4.1.1.1.
Figure 5.1.4.1.1.1: Charging domain interfacing the SMF
##### 5.1.4.1.2 Procedure description
The following figure 5.1.4.1.2.1 describes a PDU session establishment, based
on clause 4.3.2.2.1 TS 23.502 [202] description, for a non-roaming case.
Figure 5.1.4.1.2.1: PDU session establishment
1\. The UE initiates a PDU Session establishment procedure (PDU Session ID,
PDU Type, SSC mode, User location information and Access Technology Type
Information).
[2 to 3]. SMF selection by AMF, and sending of SM Request (PDU Session
Establishment Request).
[4a-b]. Subscription Data Request to UDM, based on (Subscriber Permanent ID,
DNN): Default QoS profile.
5\. PDU session authentication/authorization.
[6a-b to 8]. If dynamic PCC is deployed, the SMF performs PCF selection, and
requests for PCC Rules, and SMF selection of UPF.
A. The SMF performs Charging domain selection, creates a Charging Id for the
PDU session, and seeks for authorization for the subscriber to start the PDU
session based on information associated to this PDU session.
[9a-b]. SMF UPF interaction for Packet detection, enforcement and reporting
rules installation.
10\. SMF to AMF: SM Request Ack.
B. Start of the PDU session is reported to charging domain.
[11 to 13]. AMF-(R)AN-UE interaction: N2 SM information, AN resource setup,
(R)AN tunnel information.
14\. AMF to SMF: SM Request (N2 SM information).
[15a-b]. SMF UPF interaction for Modification procedure.
16\. SM request Ack from SMF to AMF.
17\. In case of PDU Type IPv6, IPv6 Address Configuration.
C. Control of the PDU session by the charging domain.
There may be additional interaction with the charging domain after or before
step 15. This will be determined during the normative phase.
##### 5.1.4.1.3 Solution evaluation
Solution#1.1 is the basic solution for PDU session charging solves Key issue
#1.1. It is also the basis for solutions covering other clause 5.1.3 Key
issues on service continuity.
#### 5.1.4.2 Solution#1.2: PDU session charging SSC Mode 1 from SMF
##### 5.1.4.2.1 Architecture description
The charging information collection for the PDU session continuity in SSC Mode
1 can be achieved by charging domain interfacing the SMF, as described per
Figure 5.1.4.1.1.1, with the additional details of SSC mode 1 provided in
Figure 5.1.4.2.1.1.
Figure 5.1.4.2.1.1: Charging domain interfacing the SMF -- SSC Mode 1
##### 5.1.4.2.2 Procedure description
PDU session continuity in SSC Mode 1 per TS 23.501 [201] clause 5.6.9.2.1:
\- In case of a PDU session of IP type, IP continuity is supported regardless
of UE mobility events (IP @ is preserved).
\- UPF remains as the anchor.
The following figure 5.1.4.2.2.1 describes a PDU session anchor relocation in
SSC mode 1.
Figure 5.1.4.2.2.1: PDU session anchor relocation in SSC mode 1
A. Ongoing charging session associated with the established PDU session (UPF).
1\. A (R)AN relocation is performed.
2\. The SMF determines that the serving UPF needs to be maintained and
interacts with the UPF for the path switch to the new (R)AN access.
3\. the SMF acknowledges the path switch to the new (R)AN.
B. The Charging session is updated due to new User location information/
Access Technology Type Information.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.1.4.2.3 Solution evaluation
Solution#1.2 solves Key issue #1.2 (PDU session charging - SSC Mode 1) and is
aligned with existing principles of condition changes behaviour in charging.
#### 5.1.4.3 Solution#1.3: PDU session Charging SSC Mode 2 from SMF -- CH
session update
##### 5.1.4.3.1 Architecture description
The charging information collection for the PDU session anchor relocation in
SSC Mode 2 with CH session update, can be achieved by charging domain
interfacing the SMF, as described per Figure 5.1.4.1.1.1, with the additional
details of SSC mode 2 provided in Figure 5.1.4.3.1.1.
Figure 5.1.4.3.1.1: Charging domain interfacing the SMF -- SSC Mode 2
##### 5.1.4.3.2 Procedure description
Per TS 23.501 [201] clause 5.6.9.2.2, upon PDU session anchor relocation in
SSC mode 2 with single PDU session anchor, the UPF is relocated, and new IP
address/prefix is allocated for PDU session of IP Type. The SMF may be
reallocated as per TS 23.501 [201] clause 6.3.2.
The PDU session anchor relocation in SSC mode 2 procedure is based on a
\"break before make\" model.
The following figure 5.1.4.3.2.1 describes a PDU session anchor relocation in
SSC mode 2 with single PDU session anchor, based on clause 4.3.5.1 TS 23.502
[202], with Charging session update, assuming the same SMF is selected.
Figure 5.1.4.3.2.1: PDU session anchor relocation in SSC mode 2 with single
PDU session anchor -- CH session update
A. Ongoing charging session associated with the established PDU session (UPF1)
1\. The SMF determines that the serving UPF needs to be relocated due to
events that may benefit from UPF relocation.
2\. PDU session release procedure. The SMF sends a NAS message to the UE via
the AMF (contains the PDU Session ID that needs to be relocated and Cause
indicating that a PDU Session re-establishment to the same DN is required).
3\. PDU session establishment procedure (UPF2) with a new PDU Session ID
generated by the UE, resulting in new IP @ allocation.
B. The Charging session is updated due to:
\- the PDU session release (PDU session Id, UPF1), and UPF1 is removed from
the data path;
\- the PDU session establishment with the new PDU session Id, IP @, and new
UPF2 in the data path (potentially new User location information and Access
Technology Type Information).
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.1.4.4 Solution#1.4: PDU session Charging SSC Mode 2 from SMF -- new CH
session
##### 5.1.4.4.1 Architecture description
The same architecture as per clause 5.1.4.3.1 applies.
##### 5.1.4.4.2 Procedure description
Per TS 23.501 [201] clause 5.6.9.2.2, upon PDU session anchor relocation in
SSC mode 2 with single PDU session anchor, the UPF is relocated, and new IP
address/prefix is allocated for PDU session of IP Type. The SMF may be
reallocated as per TS 23.501 [201] clause 6.3.2.
The PDU session anchor relocation in SSC mode 2 procedure is based on a
\"break before make\" model.
The following figure 5.1.4.4.2.1 describes a PDU session anchor relocation in
SSC mode 2 with single PDU session anchor, based on clause 4.3.5.1 of TS
23.502 [202], with new Charging session creation, assuming the same SMF is
selected.
Figure 5.1.4.4.2.1: PDU session anchor relocation in SSC mode 2 with single
PDU session anchor -- new CH session
A. Ongoing charging session associated with the established PDU session (UPF1)
[1 to 2]. Same as step 1 to 2 in clause 5.1.4.3.2.
B. The Charging session with PDU session Id, UPF1 and corresponding IP @ is
terminated.
3\. Same as step 3 in clause 5.1.4.3.2.
C. New Charging session created with the Charging Id assigned to the previous
PDU session Id, UPF2 new PDU session Id and new IP @ allocated, and
potentially new User location information and Access Technology Type
Information.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.1.4.5 Solution#1.5: PDU session Charging SSC Mode 3 from SMF -- CH
session update
##### 5.1.4.5.1 Architecture description
The charging information collection for the PDU session anchor relocation in
SSC Mode 3 with CH session update, can be achieved by charging domain
interfacing the SMF, as described per Figure 5.1.4.1.1.1, with the additional
details of SSC mode 3 provided in Figure 5.1.4.5.1.1.
Figure 5.1.4.5.1.1: Charging domain interfacing the SMF -- SSC Mode 3
##### 5.1.4.5.2 Procedure description
Per TS 23.501 [201] clause 5.6.9.2.3, upon UE PDU session anchor relocation in
SSC mode 3, UPF is relocated, a new IP address/prefix is allocated for PDU
session of IP Type, and the old IP address/prefix is maintained during some
time.
The PDU session anchor relocation in SSC mode 3 procedure is based on a \"make
before break\" model.
The following figure 5.1.4.5.2.1 describes a PDU session anchor relocation in
SSC with mode 3 multiple PDU sessions, based on clause 4.3.5.2 of TS 23.502
[202] and no SMF reallocation, with Charging session update.
Figure 5.1.4.5.2.1: PDU session anchor relocation in SSC mode 3 with multiple
PDU sessions - CH session update
A. Ongoing charging session associated with the established PDU session
(UPF1).
1\. The SMF determines that the serving UPF needs to be relocated due to
events that may benefit from UPF relocation.
[2-3]. The SMF sends an NAS message to the UE via the AMF to notify that the
PDU session will be released upon a timer, and to allow the UE to establish a
new PDU Session to the same DN (PDU session ID, timer).
4\. UE initiates PDU session establishment procedure (new PDU session ID, old
PDU session ID). A new PDU session anchor (i.e. UPF2) is selected by the SMF
based on new PDU session Id. This step may not occur.
B. The Charging session is updated due to PDU session establishment with the
new UPF2 in the data path, if step 4 occurs.
5\. PDU session release procedure either by UE, either by SMF upon timer
expiry.
Between step 3 and step 4, both UPF1 (traffic associated to old IP
address/prefix), and UPF2 (traffic associated to new IP address/prefix)
traffic run is parallel.
C. The Charging session is updated due to the PDU session release (old PDU
session Id, UPF1), and UPF1 removed from the data path.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
In the scenario where there is a SMF reallocation, this solution is not
relevant.
#### 5.1.4.6 Solution#1.6: PDU session Charging SSC Mode 3 from SMF -- New CH
session
##### 5.1.4.6.1 Architecture description
The same architecture as per clause 5.1.4.5.1 applies.
##### 5.1.4.6.2 Procedure description
###### 5.1.4.6.2.1 Scenario - no SMF reallocation
Per TS 23.501 [201] clause 5.6.9.2.3, upon UE PDU session anchor relocation in
SSC mode 3, UPF is relocated, a new IP address/prefix is allocated for PDU
session of IP Type, and the old IP address/prefix is maintained during some
time.
The PDU session anchor relocation in SSC mode 3 procedure is based on a \"make
before break\" model.
The following figure 5.1.4.6.2.1 describes a PDU session anchor relocation in
SSC with mode 3 multiple PDU sessions, based on clause 4.3.5.2 TS 23.502 [202]
and no SMF reallocation, with new charging session creation.
Figure 5.1.4.6.2.1.1: PDU session anchor relocation in SSC mode 3 with
multiple PDU sessions - No SMF reallocation - New CH session
A. Ongoing charging session associated with the established PDU session
(UPF1).
[1 to 4]. Same as step 1 to 4 in clause 5.1.4.5.2.
In step 2 SMF not requested to be reallocated.
B. New Charging session created with the existing Charging Id assigned to the
PDU session, UPF2 and new IP @ allocated.
5\. Same as step 5 in clause 5.1.4.5.2.
C. The Charging session with UPF1 is released due to PDU session release (old
PDU session Id, UPF1), and UPF1 is removed from the data path.
Between step 3 and step 4, both UPF1 (traffic associated to old IP
address/prefix), and UPF2 (traffic associated to new IP address/prefix)
traffic run is parallel.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
###### 5.1.4.6.2.2 Scenario with SMF reallocation
The following figure 5.1.4.6.2.2.1 is based on scenario clause 4.3.5.2 TS
23.502 [202], with SMF reallocation.
Figure 5.1.4.6.2.2.1: PDU session anchor relocation in SSC mode 3 with
multiple PDU sessions -- SMF reallocation - New CH session
A. Ongoing charging session associated with the established PDU session
(UPF1).
1\. The SMF determines that the SMF need to be reallocated due to events that
may benefit from reallocation.
2-5. Same steps as 2-5 figure 4.3.5.2-1 of TS 23.502 [202], with the
following:
The Reallocation requested indication indicates the SMF is requested to be
reallocated in step2.
In step 4, UE initiates PDU session establishment procedure to SMF2 selected
by the AMF (new PDU session Id), and UPF2 is selected by the SMF2.
B. A charging session is established from SMF2, a new charging Id is created.
C. The Charging session is released due to the PDU session release (old PDU
session Id, UPF1, SMF1).
In which step(s) of the scenario the SMFs need to interact with the charging
domain will be determined during the normative phase.
#### 5.1.4.7 Solution#1.7: PDU session Charging SSC Mode 3 Multi Homed from
SMF -- CH session update
##### 5.1.4.7.1 Architecture description
The same architecture as per clause 5.1.4.5.1 applies.
##### 5.1.4.7.2 Procedure description
The following figure 5.1.4.7.2.1 describes a PDU session anchor relocation in
SSC with mode 3 that uses the multi-homed PDU Session, based on clause 4.3.5.3
of TS 23.502 [202], with Charging session update.
Figure 5.1.4.7.2.1: PDU session anchor relocation in SSC mode 3 with IPv6
Multi homed PDU Session - CH session update
A. Ongoing charging session associated with the established PDU session
(UPF1).
1\. The SMF to relocate the PDU Session with a new PDU Session Anchor UPF2.
[2a-b to 6a-b] The SMF exchange N4 messages to UPF2, BP UPF and UPF1 to insert
BP UPF in the path with Tunnel Info exchange. A new IPv6 prefix is allocated.
[7-8a-b] The SMF sends NAS message to the UE via the AMF to update the PDU
session with tunnel info.
[9a-b] The AMF sends the message from the R(AN) to the SMF.
B. The Charging session is updated due to the BP UPF is inserted and new IPv6
allocated.
[10-11] IPv6 configuration.
[12a-b to 14a-b] The SMF releases the UE\'s old IPv6 prefix (IP\@1), and
exchange N4 messages to release the path between BP UPF and UPF1.
[15-16a-b] The SMF sends NAS message to the UE via the AMF to update the PDU
session with tunnel info to release the BP in the path.
[17a-b] PDU session release
C. The Charging session is updated due to the BP UPF is removed from the path
and IPV6 prefix release.
[18a-b to 6a-b] N4 session release to release the BP UPF in the path.
In this scenario, the PDU session Id is maintained during the whole procedure.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.1.4.8 Solution#1.8: PDU session Charging SSC Mode 3 Multi Homed from
SMF -- New CH session
##### 5.1.4.8.1 Architecture description
The same architecture as per clause 5.1.4.5.1 applies.
##### 5.1.4.8.2 Procedure description
The procedure is the same as clause 5.1.4.8.2 except for the following steps:
B. A new Charging session is created due to the new IPv6 prefix is allocated.
C. The previous Charging session is release due to IPv6 prefix release.
A charging Id is transferred from the original CH session to the new CH
session.
### 5.1.5 Evaluation and conclusion
#### 5.1.5.1 Architecture
Item \"Determination of which entity/entities in the 5G architecture is
suitable to host the CTF(s)\" of Key issues:
\- Key issue #1.1 (PDU session charging)
\- Key issue #1.2 (PDU session charging - SSC Mode 1)
\- Key issue #1.3 (PDU session charging - SSC Mode 2)
\- Key issue #1.4 (PDU session charging - SSC Mode 3)
Is solved by the same architecture (Figure 5.1.4.1.1.1: Charging domain
interfacing the SMF), whatever the solutions in clause 5.1.4.
It is concluded on the SMF as the entity to host the CTF, i.e.:
Figure 5.1.5.1.1: CTF in SMF
#### 5.1.5.2 Evaluation
##### 5.1.5.2.1 Solutions evaluation for Key issue #1.3
Both solutions #1.3 and #1.4 address Key issue #1.3, with the difference the
CH session is updated in #1.3 and a new one is created in #1.4.
In this \"break before make\" scenario, a new PDU session (i.e. new PDU
session Id) is created from the UE.
The benefits of solution #1.3, by preserving the CH session, are:
\- it allows a single quota request instead of two quota requests;
\- it avoids complex correlation process, if potentially needed between these
two PDU sessions by post-processing systems (e.g. billing systems).
The solution #1.3 introduces a particular behavior of one CH session for
multiple PDU sessions (i.e. each PDU session identified by one PDU session
Id).
This solution #1.3 is not applicable in all circumstances of this scenario,
e.g. when a new SMF is selected, it is not applicable.
In the solution #1.4 there is one to one mapping between the CH session and
the PDU session, and the solution is always applicable in any SSC mode 2
scenarios.
The solution #1.4 allows correlation process, if potentially needed between
these two PDU sessions by post-processing systems (e.g. billing systems), via
the common \"Charging Id\".
The solution #1.4 is the best approach, compared to solution #1.3 which brings
small benefits.
##### 5.1.5.2.2 Solutions evaluation for Key issue #1.4
**SSC mode 3 with multiple sessions:**
Both solutions #1.5, and 1#6 solve Key issue #1.4, for SSC mode 3 with
multiple sessions with the difference the CH session is updated in #1.5 and a
new one is created in #1.6.
The benefits of solution #1.5 compared to #1.6, by preserving the CH session,
are the same as benefits of solution #1.3 compared to #1.4.
In this \"make before break\" model scenarios, solution #1.5 has additional
benefit to avoid two parallel CH sessions (during the make before break),
however this occurs during a limited period.
For SSC mode 3 with multiple sessions, the solution #1.6 is the best approach,
compared to solution #1.5 which brings small benefits.
**SSC mode 3 Multi Homed PDU session:**
Both solutions #1.7, and #1.8 solve Key issue #1.4, for SSC mode 3 Multi Homed
PDU session with the difference the CH session is updated in #1.7 and a new
one is created in #1.8.
The benefit of solution #1.7 compared to #1.8, by preserving the CH session,
is to avoid re-creating a new CH session for the same PDU session.
For SSC mode 3 Multi Homed PDU session, the solution #1.7 is the best
approach, compared to solution #1.8 which has no benefit.
#### 5.1.5.3 Conclusion
It is concluded on:
\- Solution#1.1 clause 5.1.4.1.2 procedure for Key issue #1.1 (PDU Session
charging);
\- Solution#1.2 clause 5.1.4.2.2 procedure for Key issue #1.2 (PDU session
charging - SSC Mode 1);
\- Solution #1.4 clause 5.1.4.4.2 procedure for Key issue #1.3 (PDU session
charging - SSC Mode 2);
\- Solution #1.6 clause 5.1.4.6.2 procedures for Key issue #1.4 (PDU session
charging - SSC Mode 3) in SSC mode 3 with multiple sessions;
\- Solution #1.7 clause 5.1.4.7.2 procedure for Key issue #1.4 (PDU session
charging - SSC Mode 3) in SSC mode 3 Multi Homed PDU session.
## 5.2 QoS
### 5.2.1 Description and assumptions
The 5G QoS model supports a QoS flow based framework. The QoS flow is the
finest granularity of QoS differentiation in the PDU session. A QoS Flow ID
(QFI) is used to identify a QoS flow in the 5G system which is unique within a
PDU session. A 5QI is a scalar that is used as a reference to 5G QoS
characteristics specified in TS 23.501 [201] clause 5.7.4.
### 5.2.2 Potential requirements
The following should be supported:
\- QoS flow based charging.
\- Aggregative QoS flow based charging for 5QI.
### 5.2.3 Key issues
#### 5.2.3.1 Key issue#2.1 : QoS flow based charging
This key issue is for investigating on how to support QoS flow based charging
requirement. The investigation covers the following:
\- Determination of reporting level for the charging information, to support
QoS flow based charging, including:
> \- per combination of the rating group and QoS flow identifier,
>
> \- per combination of the rating group and QoS flow identifier and Service
> ID,
>
> \- per combination of the rating group and QoS flow identifier and Sponsor
> Id/Application service provider identity.
\- Indication of whether separate usage reports should be generated for a
certain QoS flow.
### 5.2.4 Solutions
#### 5.2.4.1 Solution#2.1 QoS flow based charging - Reporting level per
combination of the rating group and QFI
##### 5.2.4.1.1 Architecture description
The same architecture as per clause 5.1.4.1.1 applies.
##### 5.2.4.1.2 Procedure description
In order to support QoS flow based charging, the QoS flow identifier level
reporting can be per combination of the rating group and QFI (QoS flow
identifier). Reporting level is defined per PCC rule.
The following figure 5.2.4.1.2.1 describes the high-level charging procedure
for QoS based charging.
Figure 5.2.4.1.2.1: The charging procedure for QoS flow based charging
1\. The UE requests to establish a PDU session towards the 5GC network.
A. The corresponding online charging session is established for this PDU
session.
2\. If dynamic PCC employed, the SMF performs the PCC request.
3\. The PCF responses to the SMF for the PCC request. If a QoS flow identifier
level reporting is defined in the PCC rule, QoS flow based charging provides
the volume count per combination of the rating group and QFI.
4\. SMF UPF interaction for Packet detection, enforcement and reporting rules
installation.
5\. The acknowledgement for the successful PDU session establishment.
6\. The transmission of the downlink/uplink PDUs with different QFI values in
the N3 encapsulation header.
7\. The chargeable events are triggered by the SMF/ UPF.
B. If step 7 occurs, the online charging sessions is updated. The charging
information for combination of Rating Group and QoS flow identifier is
reported to charging system.
8\. The PDU session releases.
C. The online charging session for this PDU session is terminated, the online
charging information for combination of Rating Group and QoS flow identifier
is reported to the charging system.
There may be additional interaction with the charging domain. This will be
determined during the normative phase.
#### 5.2.4.2 Solution#2.2 QoS flow based charging - Reporting level per
combination of the rating group and QoS flow identifier and Service ID
##### 5.2.4.2.1 Architecture description
The same architecture as per clause 5.1.4.1.1 applies.
##### 5.2.4.2.2 Procedure description
In order to support QoS flow based charging, the reporting level can be per
combination of the rating group and QFI (QoS flow identifier) and Service ID.
The steps are the same with the procedure in the clause 5.2.4.1.2, except the
reporting level when the charging session is updated and terminated.
#### 5.2.4.3 Solution#2.3 QoS flow based charging - Reporting level per
combination of the rating group and QoS flow identifier and Sponsor
Id/Application service provider identity
##### 5.2.4.3.1 Architecture description
The same architecture as per clause 5.1.4.1.1 applies.
##### 5.2.4.3.2 Procedure description
In order to support QoS flow based charging, the reporting level can be per
combination of the rating group and QFI (QoS flow identifier) and Sponsor
Id/Application service provider identity.
The steps are the same with the procedure in the clause 5.2.4.1.2, except the
reporting level when the charging session is updated and terminated.
### 5.2.5 Overall evaluation and conclusion
#### 5.2.5.1 Solution evaluation
\- Solution#2.1 for key issue #2.1(QoS flow based charging)
\- Solution 2.2 for key issue #2.1(QoS flow based charging)
\- Solution 2.3 for key issue #2.1(QoS flow based charging)
The finest granularity for QoS forwarding treatment in the 5G System. All
traffic mapped to the same 5G QoS Flow receive the same forwarding treatment
(e.g. scheduling policy, queue management policy, rate shaping policy, RLC
configuration, etc.).
#### 5.2.5.2 Conclusions
The QoS flow based charging should be supported and the reporting level of
combination of the rating group and QoS flow identifier specified in solution
2.1, solution 2.2 and solution 2.3 is to be determined in the normative work.
It is concluded on that there is no solution for the potential requirement of
Aggregative QoS flow based charging for 5QI and this is for further study.
The reflective QoS will be considered in the normative work.
## 5.3 Interaction between SMF and UPF
### 5.3.1 Description and assumptions
#### 5.3.1.0 General
The 5G System architecture separates the User Plane (UP) functions from the
Control Plane (CP) functions, allowing independent scalability, evolution and
flexible deployments e.g. centralized location or distributed (remote)
location.
The Session Management function (SMF) is a Control Plane (CP) function. The
SMF includes the following functionality. Some or all of the SMF
functionalities may be supported in a single instance of a SMF:
\- Session Management e.g. Session establishment, modify and release,
including tunnel maintain between UPF and AN node.
\- UE IP address allocation & management (including optional Authorization).
\- Selection and control of UP function.
\- Configures traffic steering at UPF to route traffic to proper destination.
\- Downlink Data Notification.
\- Initiator of AN specific SM information, sent via AMF over N2 to AN.
User Plane Function(s) (UPF(s)) handle the user plane path of PDU sessions. An
UPF that provides the interface to a Data Network supports the functionality
of a PDU session anchor. User Plane Function(s) capabilities are per TS 23.501
[201] clause 5.8.2.
UPF traffic detection capabilities may be used by the SMF in order to control
at least following features of the UPF:
\- Traffic reporting (e.g. allowing SMF support for charging).
\- QoS enforcement.
\- Traffic routing (e.g. as defined in clause 5.6.4. for UL CL or IPv6 multi-
homing).
The detailed functionalities of the SMF and UPF are specified in TS 23.501
[201] clause 6.2.2 and 6.2.3 respectively.
The SMF may control the data path of a PDU session so that the PDU session may
simultaneously correspond to multiple N6 interfaces: the single PDU session
with multiple PDU session anchors is detailed in TS 23.501 [201] clause 5.6.4.
#### 5.3.1.1 Traffic monitoring, diversion, and blocking
##### 5.3.1.1.1 Description and assumptions
There are several aspects of the interaction between SMF and UPF that will
impact the charging. Two main aspects are to which level it will be possible
to control and monitor traffic and the other is what information will be
available in the SMF for rating purposes.
For the Traffic control and monitoring the current description in TS 23.501
[201] of the UPF traffic detection capabilities is that it may be used by the
SMF to control at least following features of the UPF over N4:
\- Traffic reporting.
\- QoS enforcement.
\- Traffic routing.
Editor\'s Note: The information required for online and offline charging are
for further study.
#### 5.3.1.2 Type of units for rating
##### 5.3.1.2.1 Description and assumptions
There are several aspects of the interaction between SMF and UPF that will
impact the charging. Two main aspects are to with level it will be possible to
control and monitor traffic and the other is what information will be
available in the SMF for rating purposes.
The type of units to report traffic on supported by the SMF is currently
unspecified but most of the documents seem to assume that the traffic is
measured in bytes.
Editor\'s Note: Further studies on information required for online and offline
charging are needed.
### 5.3.2 Potential requirements
The following requirements may be consideration under the separation
architecture of SMF and UPF:
\- Online and offline charging.
\- Session based charging.
\- Volume, time, combined volume and time, and event based charging.
\- Data volumes on both the uplink and downlink directions are accounted
separately.
\- Quota management and consumption in SMF and UPF.
\- Unused Quota timer for online charging optimization.
\- The reporting mechanism from SMF and UPF.
\- Usage of the radio interface: amount of data transmitted in DL and UL
direction.
\- Usage of the external data networks: amount of data sent and received to
and from the external data network.
Editor\'s Note: Traffic monitoring, diversion, and blocking corresponding
potential requirements are for further study.
Editor\'s Note: The type of units for rating corresponding potential
requirement is for further study.
### 5.3.3 Key issues
#### 5.3.3.1 Key issue #3.1: Traffic monitoring
The Traffic reporting can be interpreted that it mostly will report based on
what has happened and it cannot be assumed that it will do monitoring of the
traffic. For offline charging this is not an issue and is what is expected,
i.e. that the traffic consumed is reported with high accuracy. For online it
is different since here in many cases the traffic is not allowed until the OCS
has granted the traffic, and here more than just reporting is needed if the
current behaviour is to be preserved.
There is a need to decide on the level of accuracy needed for online charging
and if it should be required that the traffic is buffered during the traffic
reporting. To have the behaviour that only traffic granted by the online
charging mechanism is allowed would mean that either the traffic would have to
in some manner be pre-granted, i.e. granting some quota before any request for
service has been performed, buffered during the reporting or introducing a new
mechanism between the SMF and UPF for monitoring.
#### 5.3.3.2 Key issue #3.2: Blocking and diversion
Online charging should be able to block or diverting the traffic in case the
quota is exhausted to tell the subscriber that there is a need to do some
action to continue using the service.
#### 5.3.3.3 Key issue #3.3: Support of duration
Today there is a possibility to measure data traffic as duration, i.e.
converting the bytes per second using the current Quota Consumption Time
mechanism. This requires a definition of when the system is considered idle
and a monitoring mechanism in the UPF.
#### 5.3.3.4 Key issue #3.4: Triggers and reporting in the separate SMF and
UPF
This key issue is for investigating on how to support the charging
requirements in the non-roaming 5G System architecture.
This investigation covers the following:
\- determination of which entity/entities in the separation architecture is
suitable to host the CTF(s)/CDF for offline charging;
\- determination of which entity/entities in the separation architecture is
suitable to host the CTF(s) for online charging;
\- determination of the reporting mechanism, including reporting conditions
and the charging information reporting from SMF and UPF in the separate
architecture.
#### 5.3.3.5 Key issue #3.5: Quota management in the separate SMF and UPF
This key issue covers the following:
\- determination of Quota management and consumption in the SMF and UPF in the
separate architecture.
#### 5.3.3.6 Key issue #3.6: PDU session Charging - Branching Point or UL
Classifier
This key issue is for investigating on how to support the PDU session Charging
in multiple PDU session anchors configuration with Branching Point or UL
Classifier. This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain.
This Key issue addresses both UPF capabilities insertion controlled by the
SMF, specified in TS 23.501 [201] clause 5.6.9.2:
\- UPF BP (Branching Point) for multi-homed PDU session;
\- UPF \"UL CL\" (Uplink classifier) in order to locally offload explicit set
of flows.
The following text in TS 23.501 [201] clause 5.7.1 is considered during
investigation for this Key issue:
_\"For UL Classifier PDU sessions, UL and DL Session-AMBR shall be enforced in
the UPF that supports the UL Classifier functionality. In addition, the DL
Session-AMBR shall be enforced separately in every UPF that terminates the N6
interface (i.e. without requiring interaction between the UPFs) (see clause
5.6.4)._
_For multi-homed PDU sessions, UL and DL Session-AMBR shall be enforced in the
UPF that supports the Branching Point functionality. In addition, the DL
Session-AMBR shall be enforced separately in every UPF that terminates the N6
interface (i.e. without requiring interaction between the UPFs) (see clause
5.6.4).\"_
> NOTE: The DL Session-AMBR is enforced in every UPF terminating the N6
> interface to reduce unnecessary transport of traffic which may be discarded
> by the UPF performing the UL Classifier/Branching Point functionality due to
> the amount of the downlink traffic for the PDU session exceeding the DL
> Session-AMBR.\"
#### 5.3.3.7 Key issue #3.7: Bytes counted as continuous and discrete time
The current method for counting discrete time is imprecise since it will count
time even when no bytes are transmitted and is therefore difficult for a UE to
control and to optimize the usage of the interface. This means that from a UE
perspective the counting may seem random at best this since how the bytes are
transmitted to a large extent will depend on how the application is designed
and the network is performing.
### 5.3.4 Solutions
#### 5.3.4.1 Solution#3.1: The reporting and quota management in the
separation SMF and UPF
##### 5.3.4.1.1 Architecture description
In the non-roaming 5G System separation architecture, the CTF is divided into
two functional blocks (AMC and ADF) as described in figure 5.3.4.1.1.1 and
figure 5.3.4.1.1.2. The PDU session and flow information remains at the SMF
function, and the UPF sends usage information collected, to SMF over the N4
reference point. The SMF interacts with OCS/OFCS based on information received
from other nodes, function internal to SMF, as well as user-plane information
received from the UPF.
For offline charging the SMF generates accounting metrics sets for CDR, as
described in Figure 5.3.4.1.1.1.
Figure 5.3.4.1.1.1: Offline charging architecture
Online charging architecture is depicted in Figure 5.3.4.1.1.2.
Figure 5.3.4.1.1.2: Online charging architecture
##### 5.3.4.1.2 Offline Charging
The distributed Charging Trigger Function(CTF) is located in the SMF (ADF) and
UPF (AMC). The SMF interacts with the UPF for collecting charging information,
and reports charging information to charging domain. SMF Reporting is based on
provisioned granularity, i.e. per charging key, per charging key and service
identifier combination, or per Sponsor Identity and Application Service
Provider Identity combination.
The policy from PCF, Charging characteristics from UDM and message received
from UPF are provided to the SMF as reporting conditions for Control Plan
triggers.
Time Limit and Volume Limit defined in the Charging characteristics are
provided to the UPF as reporting conditions for User plan triggers.
After activation of usage reporting in UPF:
\- Reporting triggered by reporting conditions.
\- Reporting triggered by on demand request from the SMF, e.g. control plane
triggers in the SMF are matched.
After activation of usage reporting in SMF:
\- Reporting triggered by reporting conditions of Control Plan triggers in the
SMF are matched.
\- Reporting triggered by the reporting from UPF, e.g. reporting conditions of
User Plan triggers in the UPF are matched.
SMF combines the charging information from the UPF and SMF when the usage
reporting in SMF is active.
##### 5.3.4.1.3 Online charging
The distributed Charging Trigger Function(CTF) is located in the SMF (ADF) and
UPF(AMC). The SMF is in charge of enforcing policy activated by PCF and
interaction with OCS for online charging based on the policy from PCF.
The SMF requests quota from the OCS according to policy activated by PCF. The
SMF can request quota at PDU session establishment or during a PDU session.
The Quota Management only operates on per charging key basis, i.e. the SMF
requests a quota for each charging key.
For quota management and usage reporting, the SMF generates rules information
for accounting and reporting, which indicates the flow sets counted for
reporting, and generates measurement threshold based on the provision from the
OCS.
The measurement threshold is created for each quota. The SMF associates the
packet detection information and measurement threshold. And the SMF is
responsible for the mapping between packet detection information and the
policy. The SMF provides the packet detection information, measurement
threshold and the association the UPF. Due to multiple policies from PCF may
share the same charging key for which one quota is assigned, whereas reporting
may be at higher granularity if serviced identifier level reporting is used,
one measurement threshold may be associated with several packet detection
information.
The following information is provided to the UPF with the measurement
threshold:
\- quota consumption time;
\- quota holding time;
\- quota threshold;
\- tariff time change.
The UPF consumes quota according to the measurement threshold and collects the
usage information. Data volumes on both the uplink and downlink directions can
be counted separately based on requirement from the SMF.
The SMF reports quota usage information to the OCS when triggers are matched.
The triggers provided by the OCS will be distributed between the SMF (Control
Plan triggers) and UPF (user plan triggers).
After activation of usage reporting in UPF:
\- Reporting triggered by the measurement threshold.
\- Reporting triggered by on demand request from the SMF, e.g. control plane
triggers are matched or re-authorization is triggered by the OCS.
After activation of usage reporting in SMF:
\- Reporting triggered by reporting conditions of Control Plan triggers in the
SMF are matched.
\- Reporting triggered by the reporting from UPF.
SMF combines the charging information from the UPF and SMF when the usage
reporting in SMF is active.
The SMF may provide the Unused Quota timer to the UPF for online charging
session optimization.
Reporting for online from the UPF may block traffic because of no quota,
otherwise, reporting for offline never block traffic. So, the SMF needs to
provide indicator for the UPF to distinguish reporting between online and
offline.
##### 5.3.4.1.4 Solution evaluation
Solution#3.1 provides details on interaction between SMF and UPF, based on
solution #1.1. It solves Key issue #3.4 and Key issue #3.5. It is also the
basis for solutions covering other clause 5.3 Key issues.
#### 5.3.4.2 Solution#3.2: PDU session charging -- counts in BP/UL CL UPF only
##### 5.3.4.2.1 Architecture description
The charging information collection for a PDU session with UPF Branching Point
or UL Classifier inserted in the data path, and this UPF enforced for the
whole traffic counts, can be achieved by charging domain interfacing the SMF,
as described per Figure 5.1.4.1.1.1, with the additional details in Figure
5.3.4.2.1.1.
Figure 5.3.4.2.1.1: Charging domain interfacing the SMF - multiple PDU session
anchors with BP or UL CL UPF
##### 5.3.4.2.2 Procedure description - Addition of additional PDU Session
Anchor and Branching Point or UL CL
The following figure 5.3.4.2.2.1 describes Branching Point (BP) or an Uplink
Classifier (UL CL) UPF to an existing PDU session with this UPF selected as
the single point of measurement for charging (i.e. counts for the whole
traffic for this PDU session). The message flow is based on clause 4.3.5.4 TS
23.502 [202].
Figure 5.3.4.2.2.1: PDU session with BP or UL CL UPF as single point of
traffic measurement
1\. UE has an established PDU Session with PDU session anchor UPF1.
A. A charging session is established for this PDU session, and the UL/DL usage
is collected from UPF1.
2\. The SMF decides to add a new PDU session anchors UPF2.
3\. The SMF selects a UPF and establishes the Branching Point or UL CL
functionalities in the data path. In case UL CL the SMF provides traffic
filters indicating what traffic should be forwarded towards UPF1 and UPF2
respectively. The SMF also decides this UPF as the single point of measurement
for charging (i.e. counts for the whole traffic for this PDU session).
4\. The SMF updates the UPF1 with UPF -UL CL CN Tunnel Info for the downlink
traffic.
5\. The SMF updates the UPF2 with UPF -UL CL CN Tunnel Info for the downlink
traffic. The data path for DL traffic is established between UPF2 and UPF
BP/CL UL, and the point of measurement for DL traffic in UPF2 is UPF BP/CL UL
as already indicated in step 3.
6\. The SMF updates (R)AN via AMF for AN resource setup, (R)AN and UPF BP/UL
CL tunnels information exchange.
[7-8] In case of IPv6 multi-homing: New UE IPv6 prefix assignment and SMF
reconfigures UE IPv6 prefix for UPF1.
9\. At any time a Re-authorization triggers occurs.
B. The Charging session is updated and the SMF reports the usage collected
from UPF BP/CL UL, for traffic to/from UPF1 and traffic to/from UPF2.
The last UL/DL counts collected from UPF1 are reported when the UPF1 is
released later on.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.3.4.2.3 Procedure description - Removal of additional PDU Session
Anchor and Branching Point or UL CL
In this solution (counts in BP/UL CL for whole traffic), the scenario
\"Removal of additional PDU Session Anchor and Branching Point or UL CL\"
copied below per TS 23.502 [202] clause 4.3.5.5:
Figure 5.3.4.2.3.1: Removal of additional PDU Session Anchor and Branching
Point or UL CL
The steps are per TS 23.502 [202] clause 4.3.5.5, and the following applies in
addition:
Step 4: The data path is switched from UPF BP/CL UL to UPF2 for UL traffic
from (R)AN towards UPF2, and UPF2 becomes the point of measurement for UL
traffic towards UPF2.
Step 5: The data path is established between UPF2 and (R)AN for DL traffic,
and UPF2 becomes the point of measurement for DL traffic in UPF2.
B: the CH session is updated to release UPF BP/CL UL and UPF1 from the path,
and report the last UL/DL counts collected from UPF1 and from UPF BP/CL UL for
traffic towards/from UPF2.
In case of IPv6 multi-homing, IPv6 prefix change (from the one corresponding
to PSA1 to the one corresponding to PSA2) is also reported to the CH domain.
If the scenario does not correspond to IPv6 multi-homing, the step B may not
be needed if \"UPF change Not awareness\": the SMF collects the usage from the
UPFs without any interaction with the CH domain.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.3.4.2.4 Procedure description - Additional PDU Session anchor
relocation for UL CL
In this solution (counts in BP/UL CL for whole traffic), the scenario
\"Additional PDU Session anchor relocation for UL CL\" copied below per TS
23.502 [202] clause 4.3.5.6:
Figure 5.3.4.2.4.1: Additional PSA relocation for a PDU Session in UL CL case
The steps are per TS 23.502 [202] clause 4.3.5.6, and the following apply in
addition:
After step 3a-b: the data path is switched from UPF1 to UPF BP/CL UL, for
UL/DL set of traffic flows moved from UPF1 to UPF2. The UPF BP/CL UL remains
the point of measurement for these moved traffic flows.
B: if 6a-b4 occurs, the CH session is updated due UPF1 release, and last UL/DL
counts are reported.
In case of IPv6 multi-homing PDU Session, a new IP prefix @ PSA2 is notified
at step 4, and in step 5 the SMF may re-configure the UE for the original IP
prefix @ PSA0.This IPv6 prefix change is also reported to the CH domain.
If the scenario does not correspond to IPv6 multi-homing, the step B may not
be needed if \"UPF change Not awareness\": the SMF collects the usage from the
UPFs without any interaction with the CH domain.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.3.4.2.5 Procedure description - Relocation of UL CL for a PDU Session
In this solution (counts in BP/UL CL for whole traffic), the scenario
\"Relocation of UL CL for a PDU Session\" copied below per TS 23.502 [202]
clause 4.3.5.7:
Figure 5.3.4.2.5.1: Relocation of UL CL for a PDU Session
UPF (PSA1) stands for UPF1, UPF (PSA2) for UPF2, and UPF (PSA3) for UPF3.
The steps are per TS 23.502 [202] clause 4.3.5.7, and the following applies in
addition:
A. A charging session is established for this PDU session, and the UL/DL whole
usage is collected from Source UL CL.
After step 4: the data path is switched from Source UL CL to Target UL CL, and
the new point of measurement is Target UL CL for whole usage.
B. The Charging session is updated and last UL/DL counts from Source UL CL for
whole traffic are reported.
#### 5.3.4.3 Solution#3.3: PDU session charging -- counts in two UPFs --
single CH session
##### 5.3.4.3.1 Architecture description
The same architecture as per clause 5.3.4.2.1 applies.
##### 5.3.4.3.2 Procedure description - Addition of additional PDU Session
Anchor and Branching Point or UL CL
The following figure 5.3.4.3.2.1 describes insertion by the SMF of additional
Branching Point (BP) or an Uplink Classifier (UL CL) UPF to an existing PDU
session, with two UPFs selected as points of measurement for charging: UPF
BP/UL CL for UL/DL traffic to/from UPF1, and UPF2 for UL/DL traffic to/from
UPF2. A single charging session is used for this scenario.
The message flow is based on clause 4.3.5.4 of TS 23.502 [202]:
Figure 5.3.4.3.2.1: PDU session establishment with two UPFs for traffic
measurement
1\. UE has an established a PDU Session with PDU session anchor UPF1.
A. A charging session is established for this PDU session.
[2 to 8]. Same as step 2 to 8 in clause 5.3.4.2.2, except that in step 4 the
SMF decides the UPF BP/UL as the point of measurement for charging for traffic
through UPF1, and the UPF2 as the point of measurement for charging for
traffic through UPF2.
Step 4. The data path for DL traffic is established between UPF1 and UPF BP/CL
UL and the new point of measurement for DL traffic in UPF1, is UPF BP/CL UL.
The point of measurement for UL/DL traffic in UPF2 is UPF2.
a. At any time a Re-authorization triggers occurs.
B. The Charging session is updated and the SMF reports the usage collected
from UPF BP/UL CL, for traffic to/from UPF1 and the usage collected from UPF2
for traffic to/from UPF2.The last UL/DL counts collected from UPF1 are
reported when the UPF1 is released later on.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.3.4.3.3 Procedure description - Removal of additional PDU Session
Anchor and Branching Point or UL CL
The same procedure as clause 5.3.4.2.3 applies, except:
After Step 4: the point of measurement for traffic via UPF2 remains in UPF2.
C. the CH session is updated to release UPF BP/CL UL and report the last UL/DL
counts collected from UPF BP/CL UL for traffic via UPF1.
##### 5.3.4.3.4 Procedure description - Additional PDU Session anchor
relocation for UL CL
With the assumption before this anchor relocation, Source UL CL was the point
of measurement for traffic via UPF1 and the UPF2 is the point of measurement
for traffic via UPF2 after relocation, the procedure in clause 5.3.4.2.4
applies as follows:
After step 3a-b: the data path is switched from UPF1 to UPF BP/CL UL, for
UL/DL set of traffic flows moved from UPF1 to UPF2. The UPF2 is the point of
measurement for these moved traffic flows.
##### 5.3.4.3.5 Procedure description - Relocation of UL CL for a PDU Session
With the assumption before this relocation, Source UL CL was the point of
measurement for traffic via UPF1 and the UPF2 was the point of measurement for
traffic via UPF2, the procedure in clause 5.3.4.2.5 applies as following
steps:
A. A charging session is established for this PDU session, UL/DL usage via
UPF1 is collected from Source UL CL, and UL/DL usage via UPF2 is collected
from UPF2.
After step 4: the data path is switched from Source UL CL to Target UL CL, and
the new point of measurement is Target UL CL for traffic via UPF (PSA1).
B. The Charging session is updated due to Source UL CL release, and last UL/DL
counts from Source UL CL for traffic via UPF (PSA1) are reported.
#### 5.3.4.4 Solution#3.4: The reporting and quota management SSC mode 2 -- CH
session update
##### 5.3.4.4.1 Architecture description
The same architecture as clause 5.1.4.3.1 applies.
##### 5.3.4.4.2 Procedure description
##### 5.3.4.4.2.0 General Description
The procedure of a PDU session anchor relocation in SSC mode 2 with single PDU
session anchor and charging session update applies as in clause 5.1.4.3.
This scenario assumes the same SMF is selected.
The following message flows are based on clause 4.3.5.1 of TS 23.502 [202]
adapted to reflect the trigger and quota management in two optional ways:
\- The Charging system is aware of the UPF change.
\- The Charging system is not aware of the UPF change.
###### 5.3.4.4.2.1 Solution 3.4.1: The Charging system is aware of the UPF
change
Figure 5.3.4.4.2.1: Quota management (UPF Change Awareness) -- CH session
update
> A) Ongoing charging session associated with the established PDU session
> (UPF1)
>
> [1 to 3]. Same as step 1 to 3 in clause 5.1.4.3.2.
B) The Charging session is updated as per step B in clause 5.1.4.3.2. SMF
triggers the reporting from UPF1 for consumed quota reporting to the charging
system and request the charging system to allocate the new granted quota for
UPF 2.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
###### 5.3.4.4.2.2 Solution 3.4.2: The Charging system is not aware of the UPF
change
Figure 5.3.4.4.2.2: Quota management (UPF Change not Awareness) -- CH session
update
[1 to 3]. Same as step 1 to 3 in clause 5.1.4.3.2.
A. Ongoing charging session associated with the established PDU session (UPF1)
B. SMF triggers the reporting from the UPF1 for the consumed quota and
allocates the remaining granted quota for UPF 2. When the granted quotas used
up, SMF will request the new quota to Charging system.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.3.4.5 Solution#3.5: The reporting and quota management -- in multiple
UPFs (parallel traffic)
##### 5.3.4.5.1 Architecture description
The charging information collection in multiple UPFs with UPF Branching Point
or UL Classifier inserted in the data path, and the quota allocation in the
SMF, as described in Figure 5.3.4.5.1.1 to Figure 5.3.4.5.1.2. The parallel
traffic is transferred in multiple UPFs at the same time.
Figure 5.3.4.5.1.1: Charging architecture for multi-homed PDU Session (Access
both a local service and a central service)
Figure 5.3.4.5.1.2: Charging architecture for usage of an UL Classifier
##### 5.3.4.5.2 Procedure description
##### 5.3.4.5.2.0 General Description
The following figure 5.3.4.5.2.1 describes a PDU session established with a
Branching Point (BP) or an Uplink Classifier (UL CL) UPF inserted by the SMF,
the charging information collection and reporting in the multiple UPFs at the
same time. The SMF is responsible for the allocation the quota granted by
charging system and reporting the quota usage to charging system.
When UE needs to access both a local service (e.g. local server) and a central
service (e.g. the internet), the traffic is transferred in UPF1 and UPF2 in
parallel. In the case, there are two optional ways to consider the quota
management and reporting for one charging session per PDU session:
\- Charging system granted quota shared by UPFs. SMF manages shared quota
consumption in UPF1 and UPF2 and report the total quota consumed to Charging
System.
\- Charging System grants the quota for each UPF. The UPFs manages and report
the quota consumption to SMF. SMF reports the usage of quota and/or requests
the further quotas to Charging System.
###### 5.3.4.5.2.1 Solution 3.5.1 Charging system granted quota shared by UPFs
The message flow is based on clause 4.3.5.4 of TS 23.502 [202] adapted to
reflect the quota management and reporting during the PDU session:
Figure 5.3.4.5.2.1: Shared Quota management for UPF1 and UPF2 (granted quota
sharing)
Step 1-8: Same as step 1 to 8 in clause 5.3.4.2.2.
A. A charging session is established for this PDU session with PDU session
anchor UPF1.The SMF has been granted quota by the OCS, this quota is shared by
UPFs.
a. At any time the SMF runs out of quota for UPFs.
B. The Charging session is updated: the SMF reports quota consumed by both
UPF1 and UPF2, and requests new Quota. The SMF manages the quota shared by
UPF1 and UPF2.
b. At any time a Re-authorization triggers occurs.
C. SMF report the charging information (quota consumption) for UPF1 and UPF2
to Charging system.
Note: During B and C, SMF negotiates the shared quota consumption between UPF1
and UPF2. When the granted quota from OCS is used up, the SMF reports total
usage of quota to OCS.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
###### 5.3.4.5.2.2 Solution 3.5.2 Charging System grants the quota for each
UPF
Figure 5.3.4.5.2.2: Separate Quota management for UPF1 and UPF2 (Granted Quota
per UPF)
Step 1-8: Same as step 1 to 8 in clause 5.3.4.2.2.
A. A charging session is established for this PDU session with PDU session
anchor UPF1. The SMF has been granted quota by the OCS, for UPF1.
B. The Charging session is updated due quota needs to be granted to the SMF
for UPF2 separately.
> C. When the granted quota for UPF 1 is used up, SMF reports the usage of
> quota to the charging system.
D. When the granted quota for UPF 2 is used up, SMF reports the usage of quota
to the charging system.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.3.4.6 Solution#3.6: Bytes counted as continuous time
##### 5.3.4.6.1 Architecture description
The same architecture as per clause 5.3.4.2.1 applies.
##### 5.3.4.6.2 Procedure description
A UE sends and receives data though the UPF to and from a DN, during this
procedure the UPF interacts with usage reports to the SMF which are used at
charging. In this case, the SMF monitors the granted units to be used for the
traffic. The UPF monitors data traffic and reports at interval based on the
SMF request. When there are no more granted units the SMF may request the UPF
to take the appropriate action, e.g. stop all or selected traffic to DN,
divert the traffic to another DN.
The flow will be the same as in clause 5.3.4.8 (Solution#3.8: Charging at SMF
and usage monitoring over N4), with the exception that the UPF will not be
requested to report when transmitted data equals the granted units.
Only allowing bytes counted as continuous time would limit the number of
charging possibilities but at the same time lower the complexity in both the
SMF and UPF interface as well as the inside the UPF.
##### 5.3.4.6.3 Solution evaluation.
This solution describes that only charging based on continuous time should be
applicable for reporting from the UPF and it would support the requirement to
be able to change based on active time for the byte transmission.
The drawback of this solution is that the discrete time measurement for byte
transmission will not be possible to support.
#### 5.3.4.7 Void
#### 5.3.4.8 Solution#3.8: Charging at SMF and usage monitoring over N4
##### 5.3.4.8.1 Architecture description
The same architecture as per clause 5.3.4.2.1 applies.
##### 5.3.4.8.2 Procedure description
A UE sends and receives data though the UPF to and from a DN, during this
procedure the UPF interacts with usage reports to the SMF which are used at
charging. In this case, the SMF monitors the granted units to be used for the
traffic. The UPF monitors data traffic and reports the usage based on the SMF
request. When there are no more granted units the SMF may request the UPF to
take the appropriate action, e.g. stop all or selected traffic to DN, divert
the traffic to another DN.
Figure 5.3.4.8.2.1: Charging at SMF and usage monitoring over N4
1a. SMF request units for the traffic from Charging.
1b. Charging responds with the granted units.
2\. SMF request a report from the UPF when the transmitted data equals (or is
close to, if the SMF decides to have some quota for the period during the
reporting to Charging) the granted units or after a certain time equal to
validity time from Charging.
3\. For UPF the counter of data has reached the level that matches the granted
units and reports this to SMF.
4a. SMF reports the usage from the UPF and requests more units.
4b. Charging responds with the granted units and an indication of last
available units, it may include an action to be taken when the granted units
are depleted.
5\. SMF requests a report from the UPF when the transmitted data equals (or is
close to, if the SMF decides to have some quota for the termination period)
the granted units from Charging.
6\. For UPF the counter of data has reached the level that matches the granted
units and reports this to SMF.
7\. SMF requests the UPF to modify the traffic, this may be based on the
action requested by Charging (e.g. terminate part of the traffic, all of
traffic, divert traffic).
8\. UPF reports the last counted transmitted traffic to SMF, if SMF has
requested the information.
9a. SMF reports the usage from the UPF.
9b. Charging responds with credit control closure for the specific service.
Charging may also respond with request to close the control session together
with the specific service.
This solution implies that the SMF coordinates measurements in relation to the
limit by the granted units from the Charging.
##### 5.3.4.8.3 Solution evaluation.
This solution describes that the N4 will be handling charging as report and
termination requests. This will keep the requirements on the UPF to a minimum
regarding charging, since the interaction between SMF and UPF will be based on
two basic operations. The requirement on the SMF will be increased since there
is a need for the SMF to have strategies to avoid having the UPF consuming
more quota than has been granted. This can be done in a number of ways and are
implementation specific, it should however be considered to have the Charging
domain support to receive more used quota than granted to mitigate any issue
should they arise.
#### 5.3.4.9 Solution#3.9: PDU session charging -- counts in UPFs -- single CH
session
##### 5.3.4.9.1 Architecture description
The same architecture as per clause 5.3.4.2.1 applies.
##### 5.3.4.9.2 Procedure description- Addition of additional PDU Session
Anchor and Branching Point or UL CL
The following figure 5.3.4.9.2.1 describes a PDU session establishment with a
Branching Point or an Uplink Classifier (UL CL) UPF inserted by SMF, with two
UPF anchors that terminate the N6 interfaces selected as points of measurement
for charging: UPF1 for UL/DL traffic to/from UPF1, and UPF2 for UL/DL traffic
to/from UPF2. A single charging session is used for this scenario.
The message flow is based on clause 4.3.5.4 of TS 23.502 [202] that describes
the procedure to add a PDU Session Anchor (PSA) and a Branching Point (BP) or
Uplink Classifier (UL CL) for an established PDU session.
**Figure 5.3.4.9.2.1: Charging procedure for a PDU session with two UPF
anchors that terminate the N6 interface**
1\. UE has an established PDU session with a UPF including the PDU Session
Anchor 1.
A. A charging session for the PDU session is established between the SMF and
the charging Domain.
2-3. Same as step 2 and step 3 described in clause 4.3.5.4 of TS 23.502 [202].
Besides, the SMF decides the PSA1 as the point of measurement for charging for
the traffic from/to UPF1, and the PSA2 as the point of measurement for
charging for the traffic from/to UPF2.
4\. The SMF update the PSA1 via N4 interface. It provides the BP or UL CL with
the CN Tunnel Info for downlink traffic.
B. The charging session is updated due to the data path for DL traffic from
PSA1 to BP/CL UL is established.
5-8. Same as step 5-8 described in clause 4.3.5.4 of TS 23.502 [202]. As a
result, the Uplink and Downlink traffic can be routed through the right PSA.
C. The charging session is updated due to the data path for UL traffic to PSA1
is established.
D. The Charging session is updated due to the data path for DL/UL traffic
through PSA2 is established.
In UPF1 counts associated to UL/DL traffic to/from PSA1, and in UPF2 counts
associated to UL/DL traffic to/from PSA2.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.3.4.9.3 Procedure description - Removal of additional PDU Session
Anchor and Branching Point or UL CL
The following figure 5.3.4.9.3.1 describes the charging procedure for removing
a PDU session Anchor and (optionally) removing Branching Point or UL CL for an
established PDU session. In this case, the chargeable events for PDU session
anchor removal or BP/UL CL removal are triggered and SMF sent the charging
information to the charging system, with the Charging session update.
The message flow is based on clause 4.3.5.5 of TS 23.502 [202] that describes
the procedure to remove a PDU Session Anchor (PSA) and optionally a Branching
Point (BP) or Uplink Classifier (UL CL) for an established PDU session.
Figure 5.3.4.9.3.1: Charging procedure for a PDU session with two UPF anchors
that terminate the N6 interface
1\. UE has an established PDU Session with UPFs including the Branching Point
or UL CL, the PDU Session Anchor 1 (PSA1 in Figure 5.3.4.9.3.1) and the PDU
Session Anchor 2 (PSA2 in Figure 5.3.4.9.3.1).
A. A charging session for the PDU session with BP/UL CL is established between
the SMF and the charging system. In PSA1 counts associated to UL/DL traffic
to/from UPF1, and in PSA2 counts associated to UL/DL traffic to/from UPF2.
At some point the SMF decides to remove the PDU Session Anchor 1 e.g. due to
UE mobility, flow terminated.
2-3. In case of IPv6 multi-homing, the SMF notifies the UE to stop using the
IPv6 prefix corresponding to PSA1. The UE starts using the IPv6 prefix
(corresponding to PSA2) for all the traffic.
4\. If the Branching Point or UL CL is to be released, the SMF updates the
(R)AN with the PSA2 CN Tunnel Info, and updates via N4 the PSA2 providing the
(R)AN Tunnel Info.
5\. If the Branching Point or UL CL is to be released, the SMF updates via N4
the PSA2 providing the (R)AN Tunnel Info.
6\. The SMF releases via N4 the PSA1.
B. The charging session between SMF and the charging system is updated due to
the chargeable event of the release of the PSA1.
7\. If step 4 and 5 were executed, the SMF releases the BP or UL CL.
C. If step 7 was executed, the charging session is updated for the chargeable
event of the release of BP/UL CL.
##### 5.3.4.9.4 Procedure description - Additional PDU Session anchor
relocation for UL CL
**Figure 5.3.4.9.4.1: Charging procedure for the PDU session anchor in UPFs**
The steps are per TS 23.502 [202] clause 4.3.5.6, and the following apply in
addition:
A: A charging session is established for this PDU session.
B: The CH session is updated due the addition of UPF2, as the PDU Session
anchor.
After step 3a-b: the data path is switched from UPF1 to UPF2, for UL/DL set of
traffic flows moved from UPF1 to UPF2. The UPF2 is the point of measurement
for these moved traffic flows.
C: if Step 4 occurs, the CH session is updated due UPF1 release, and last
UL/DL counts of UPF1 are reported.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
##### 5.3.4.9.5 Procedure description - Relocation of UL CL for a PDU Session
**Figure 5.3.4.9.5.1: Charging procedure for the PDU session anchor in UPFs**
The steps are per TS 23.502 [202] clause 4.3.5.7, and the following applies in
addition:
A. A charging session is established for this PDU session, UL/DL usage via
PSA1 is collected from Source UPF, and UL/DL usage via PSA2 is collected from
Remote UPF.
After step 4: the data path is switched from Source UL CL to Target UL CL, and
the new point of measurement is Target UPF for traffic via PSA3.
B. The Charging session is updated due to the data path from PSA3 to Target
UPF is established.
C. The Charging session is updated due to Source UPF release, and last UL/DL
counts from Source UPF for traffic via PSA1 are reported.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.3.4.10 Solution#3.10: The reporting and quota management SSC mode 2 --
New CH session
##### 5.3.4.10.1 Architecture description
The same architecture as clause 5.1.4.3.1 applies.
##### 5.3.4.10.2 Procedure description
The procedure of a PDU session anchor relocation in SSC mode 2 with single PDU
session anchor and new charging session applies as per clause 5.1.4.4.
The following message flow is based on clause 4.3.5.1 of TS 23.502 [202]
adapted to reflect the trigger and quota management, assuming the same SMF is
selected:
Figure 5.3.4.10.2.1: Quota management -- New CH session
> A) Ongoing charging session associated with the established PDU session
> (UPF1)
>
> [1 to 3]. Same as step 1 to 3 in clause 5.1.4.3.2.
B) same as step B in clause 5.1.4.4.2. The SMF triggers the reporting from
UPF1 for consumed quota reporting to the charging system.
C) same as step C in clause 5.1.4.4.2. The SMF requests quota for UPF2.
In which step(s) of the scenario the SMF needs to interact with the charging
domain will be determined during the normative phase.
An alternative with SMF re-allocation of remaining quota to UPF2 is not
possible for this scenario.
### 5.3.5 Overall evaluation and conclusion
#### 5.3.5.1 Evaluation
##### 5.3.5.1.1 Solutions evaluation for Key issue #3.1 and #3.2
See clause 5.3.4.8.3.
##### 5.3.5.1.2 Solutions evaluation for Key issue #3.3
See clause 5.3.4.6.3.
##### 5.3.5.1.3 Solutions evaluation for Key issue #3.4
The 3 solutions #3.2, #3.3 and #3.9 solve the Key issue #3.4 and are evaluated
under clause 5.3.5.1.4 and 5.3.5.1.5.
##### 5.3.5.1.4 Solutions evaluation for Key issue #3.5
**SSC mode 2:**
Solutions #3.4.1, #3.4.2 and #3.10 address the Key issue #3.5 in SSC mode 2,
with the difference the CH session is updated in #3.4.1, #3.4.2 and a new one
is created in #3.10.
In this \"break before make\" scenario, a new PDU session (i.e. new PDU
session Id) is created from the UE.
The benefit of solutions #3.4.1/#3.4.2, by preserving the CH session, is to
avoid:
\- two quota requests, by allowing a single quota request, especially in
solution /#3.4.2 (No extra reporting for UPF change).
The solutions #3.4.1/#3.4.2 introduce a particular behavior of one CH session
for multiple PDU sessions (i.e. each PDU session identified by one PDU session
Id). They are not applicable in all circumstances of this scenario, e.g. when
a new SMF is selected.
In the solution #3.10, there is one to one mapping between the CH session and
the PDU session, and the solution is always applicable in any SSC mode 2
scenarios.
In the solution #3.10, it is not possible to achieve quota sharing between two
UPFs as per \"UPF change not awareness\" of solution #3.4, however this does
not bring high benefit.
The solution #3.10 is considered as the best approach to rely on associating a
CH session to a PDU session, which is always applicable, compared to solutions
#3.4.1/#3.4.2.
**SSC mode 3 with multiple sessions:**
The solutions #1.5 and #1.6 addresses the interaction with the CH domain,
which includes the request for quota during this service continuity procedure.
The selected solution applies.
As the result of this service continuity procedure, only one PDU session
anchor (UPF) will remain: the solution#1.1 applies.
**SSC mode 3 Multi Homed PDU session:**
Both solutions #3.5.1 and #3.5.2 addressee Key issue #3.5 in scenarios with BP
and UL CL, which are used to achieve SSC mode 3 Multi Homed session. and are
possible solutions for Quota management in solution #3.3 and solution #3.9.
Solution 3.5.1 has the benefit to reduce the quota fragmentation and the
number of transactions towards the charging server compared to solution 3.5.2,
however there is no mean for the charging server to distinguish credit control
between multiple UPFs. Both variants can be applicable. These solutions are
based on a single CH session principle, which is the best approach, compared
to another alternative (not described) with new CH session, since the PDU
session (i.e. same PDU session Id) is maintained.
In solution #3.2, the Quota management is performed for the single BP/UL CL
UPF.
##### 5.3.5.1.5 Solutions evaluation for Key issue #3.6
The different solutions #3.2, #3.3, #3.9 are based on a single CH session
principle, which is the best approach, compared to another alternative (not
described) with new CH session, since the same PDU session (i.e. PDU session
Id) is used.
The difference between these three solutions is which UPF(s) is (are) the
one(s) used to count the traffic for charging purpose.
All solutions lead to the charging data collection point switch between two
UPFs (e.g. PSA1 and BP/UL CL) if addition or removal of a third UPF (e.g.
PSA2).
Based on the text in reference in clause 5.3.3.6, UL and DL Session-AMBR
enforcement is in the UPF that supports BP and UL CL functionalities:
therefore, the best approach is to select this UPF as the one to be used for
counting the traffic for charging purpose, which is the solution #3.2. This
will avoid counting packets dropped due to AMBR.
Although the solutions #3.3 and #3.9 imply complex coordination on the same
quota consumption between two UPFs, it could also be possible to allow these
solutions per Operator policy as optional variants.
#### 5.3.5.2 Conclusion
It is concluded on:
\- Solution#3.10 clause 5.3.4.10.2 procedure for Key issue #3.5 for SSC mode
2.
\- Solutions #3.4.1 and #3.4.2 for SSC mode 2 are not applicable.
\- Solutions #3.2, #3.3 and #3.9 are all possible solutions for Key issue #3.6
for Configurations with BP and UL CL. Which of them is to be selected as the
preferred one will be considered during the normative work.
\- Both solution #3.5.1 and solution #3.5.2 options for quota management in
solutions #3.3 and #3.9.
\- For the key issues #3.1 and #3.2 it is concluded to use the solution #3.8,
which is supported by Sx, together with the other currently supported
mechanisms over Sx.
\- For the key issue #3.3 the solution #3.6 would suffice as a first step, and
if there is more support needed this may be studied at a later step.
## 5.4 Network Slicing
### 5.4.1 Description and assumptions
A Network Slice is a logical network that provides specific network
capabilities and network characteristics. Service-specific demands can be
satisfied by mapping different services to separate Network Slices. A Network
Slice instance (NSI) is a set of Network Function instances and the required
resources (e.g. compute, storage and networking resources) which form a
deployed Network Slice.
A single UE can be simultaneously served by one or more Network Slice
instances via a 5G-AN. Some Network Function instances, e.g. the AMF instance,
can be common to and shared by one or more Network Slice instances serving a
UE. Some Network Function instances, e.g. the SMF instance, are tailored to a
specific Network Slice instance.
A PDU session can belong to one and only one specific Network Slice instance
per PLMN. Different Network Slice instances do not share a PDU session, though
different slices may have slice-specific PDU sessions using the same DNN.
NSSAI is a collection of S-NSSAIs (Single Network Slice Selection Assistance
Information). Each S-NSSAI identifies a Network Slice and assists the network
in selecting a particular Network Slice instance. The establishment of User
Plane connectivity to a Data Network via a Network Slice instance comprises
the following two steps:
\- Performing a Registration Management procedure to select a AMF that
supports the required Network Slices.
\- Establish one or more PDU sessions to the required Data Network via the
Network Slice Instance(s).
For more detail of Network Slicing refer to TS 23.501 [201] clause 5.15.
### 5.4.2 Potential requirements
The following requirements should be supported for Network Slicing:
\- Online and offline charging
\- Capability for correlation within one slice.
\- Charging for a single UE served by one or more Network Slice Instances
could be:
\- Session based
\- Volume based
\- Time based
\- Volume and time based
\- Event based
\- Charging for a CSP who utilizes a specific Network Slice Instance:
\- Connection based
\- Volume based
\- Time based
\- Volume and time based
\- Event based
### 5.4.3 Key issues
#### 5.4.3.1 Key issue #4.1: Charging for UE served by one or more Network
Slice instances
This key issue will look into solutions for charging for a UE served by one or
more Network Slice instances
This study covers the following:
\- Determination of the high-level common architecture to support charging for
a UE simultaneously served by multiple NSIs, including the offline and online
charging.
\- Determination of which entity/entities are suitable to host the
CTF(s)/CDF/CGF for offline charging.
\- Determination of which entity/entities are suitable to host the CTFs for
online charging.
#### 5.4.3.2 Key issue #4.2: Charging for the CSP who utilizes a specific
network slice instance
This key issue is for investigating on how to support the charging for the CSP
who utilizes a specific network slice instance.
The present document covers the following:
\- determination of chargeable party for tenant(CSP) based charging;
\- identification of the main interactions with the charging domain.
### 5.4.4 Solutions
#### 5.4.4.1 Solution#4.1: Charging for UE - different architecture options
##### 5.4.4.1.1 Offline charging
###### 5.4.4.1.1.1 Option #1: The offline charging system with CDF and CGF in
two separate physical elements
The Charging Trigger Function (CTF) may be hosted in the NE (e.g. SMF) in each
of the Network Slice Instance. The CTF(s) per PDU Session in each NSI are
collecting the information pertaining to the chargeable events, assembling
this information into matching charging events and sending these charging
events towards the CDF. The CDF receives the charging events from the CTF(s)
per PDU Session of each NSI via the Rf reference point. It then uses the
charging information in the charging events to construct CDRs. Then the CDRs
are forwarded to a billing domain for subsequent offline billing processes,
through the CGF acting as a gateway between the CDF and the billing domain.
Figure 5.4.4.1.1.1: The offline charging architecture among multiple Network
Slice instances-CTF Sliced
###### 5.4.4.1.1.2 Option #2: The offline charging system with CDF integrated
in the NE, CGF in a separate physical element
Both CTF(s) and CDF may be hosted in the NEs in each of the Network Slice
Instance.
**Figure 5.4.4.1.1.2: The offline charging architecture among multiple Network
Slice instances- CTF/CDF Sliced**
###### 5.4.4.1.1.3 Option #3: The offline charging system with CDF and CGF
integrated in the NE
The CTF(s) and CDF and CGF may be hosted in the NEs in each of the Network
Slice Instance.
**Figure 5.4.4.1.1.3: The offline charging architecture among multiple Network
Slice instances-CTF/CDF/CTF Sliced**
NOTE 1: The offline charging is performed separately on each NSI, i.e., the
collection and report of the charging information in one NSI is independent of
others.
NOTE 2: Charging for a UE served by only one NSI is a special case of a UE
served by multiple NSIs.
##### 5.4.4.1.2 Online charging
##### 5.4.4.1.2.0 General Description
In the online charging process, the charging information for the network
resource usage is collected concurrently with the resource usage in the same
fashion as in offline charging. However, authorization for the network
resource usage should be obtained by the network before the actual resource
usage takes place. In case of a UE served by multiple Network Slice Instances,
the credit management for each PDU session in different NSIs should be
performed independently.
###### 5.4.4.1.2.1 Option #1: The online charging system is shared by all the
Network Slice instances per PLMN
In this solution, the online charging system is shared by all the network
slice instances in a PLMN. Figure 5.4.4.1.2.1.1 depicts the high-level
overview of the common online charging system over multiple NSIs without
including the OCS in one of Network Slice instances. In this architecture,
besides collecting the charging information and forwarding the charging events
to the OCF, which is the same as the offline charging, the CTF also extends to
support the online charging functions described as TS 32.240 [1]. In each NSI,
there may be one or more CTFs for generating the charging information. The UE
identity such as SUPI, and the NSI identity such as S-NSSAI should be forward
to the OCS from CTF in the specific NSI.
Figure 5.4.4.1.2.1.1: The online charging system shared by all the Network
Slice instances per PLMN
###### 5.4.4.1.2.2 Option #2: online charging by instantiating a slice-
specific OCF/RF/CGF for each Network Slice instance
In this architecture, multiple OCF/RF/CGF are instantiated in each Network
Slice instance serving the UE. The OCF/RF/CGF is slice-specific and designed
based on the type of Network Slice. Figure 5.4.4.1.2.2.1 shows the general
deployment architecture for online charging among multiple NSIs by
implementing the OCF/RF/CGF in each NSI. The CTF(s) per PDU session are hosted
by the NEs (e.g. SMF) in each NSI and the credit management applies for online
charging operates on a per NSI basis. If the network operator provides the
multiple network slices, the ABMF should be deployed to manage the one UE\'s
account that shared among multiple NSIs, when the UE accesses the Network
Slice Instances.
Figure 5.4.4.1.2.2.1: The online charging by instantiating a slice-specific
OCF/RF/CGF for each Network Slice instance
##### 5.4.4.1.3 Solution evaluation
Solution#4.1 solves Key issue #4.1 (Charging for UE served by one or more
Network Slice instances) and is aligned with existing charging principles.
Compared to the option2 in clause 5.4.4.1.1.2 and option 3 in clause
5.4.4.1.1.3, the option 1 for offline charging in clause 5.4.4.1.1 is fully
distributed implementation where all reference points are be implemented as
physical interfaces on the NE, CDF and CGF, respectively, and re-use the
existing charging mechanism.
Compared to the option2 in clause 5.4.4.1.2.2 and option 3 in clause
5.4.4.1.2.3, the option 1 for online in clause 5.4.4.1.1.2 can reuse the
existing charging mechanism.
#### 5.4.4.2 Solution#4.2: Charging for creating and modifying a Network Slice
by a CSP
##### 5.4.4.2.1 Offline charging
For offline charging for the creation, activation, de-activation, modification
and termination of a Network Slice requires a trigger point in the management
of the Network Slice since this is the place that holds together and authorize
the creation etc. of the Network Slice. This would mean that the CTF could be
placed in the Network Slice Management Function (NSMF).
Figure 5.4.4.4.1.1 depicts the high-level offline architectural options that
exist for the above described option.
Editor\'s Notes: This solution is dependent on the Network Slice, NSMF and CSP
together with the operations possible, and should be refined after TS 28.530
[203] has been updated.
Figure 5.4.4.2.1.1: Network Slicing offline charging architecture options for
NSMF
##### 5.4.4.2.2 Online charging
For online charging for the creation, activation, de-activation, modification
and termination of a Network Slice requires a trigger point in the management
of the Network Slice since this is the place that holds together and authorize
the creation etc. of the Network Slice. This would mean that the CTF could be
placed in the Network Slice Management Function (NSMF). In the online charging
case, it means that there is an extra step added at the provisioning of a
Network Slice to be able to secure that there CSP has funds enough to cover
the cost of the change.
Figure 5.4.4.4.2.2 depicts the high-level architectural options that exist for
the above described option.
Editor\'s Notes: This solution is dependent on the Network Slice, NSMF and CSP
together with the operations possible, and should be refined after TS 28.530
[203] has been updated.
Figure 5.4.4.2.2.2: Network Slicing online charging architecture option for
NSMF
#### 5.4.4.3 Solution#4.3: Charging procedure for UE served by multiple
network slice instances
##### 5.4.4.3.1 Procedure description
According to TS 23.501 [200], a single UE can simultaneously be served by one
or more Network Slice instances via a 5G-AN. The following figure 5.4.4.13.1
describes the high-level charging procedure for UE served by two network slice
instances simultaneously as an example. For offline and online charging, the
SMF hosts the CTF in each NSI. The UE can establish one or more PDU sessions
in each NSI and a corresponding charging session is established for the each
established PDU session. Different Network Slice instances do not share a PDU
session, though different slices may have slice-specific PDU sessions using
the same DNN.
Figure 5.4.4.3.1 Charging procedure for UE served by multiple Network Slice
Instances
1a-1b. UE has one or more established PDU sessions in NSI 1 and NSI 2,
respectively.
A-B. If the establishment of a PDU session in a NSI succeeds, a corresponding
charging session between the SMF and the charging system is established for
this PDU session in this NSI. The S-NSSAI is sent to the charging domain.
C-D. if the chargeable events (from SMF or UPF) belonging to a PDU session is
encountered, the corresponding charging session of this PDU session is
updated.
##### 5.4.4.3.2 Solution evaluation
Solution#4.3 solves Key issue #4.1 (Charging for UE served by one or more
Network Slice instances) and is aligned with existing charging principles.
### 5.4.5 Conclusions
It is concluded on:
Solution#4.1 clause 5.4.4.1.1.1 option 1, for Key issue #4.1,
Solution#4.1 clause 5.4.4.1.2.1 option 1, for Key issue #4.1,
Solution # 4.3 clause 5.4.4.3 for Key issue #4.1 is selected. For the case of
one UE served by multiple network slice instances, the Nch should support the
charging per PDU session per network slice instance.
There is no solution for the potential requirement about charging for a CSP
who utilizes a specific Network Slice instance and key issues 4.2 and it is
for further study.
Solution#4.1 option 2 in clause 5.4.4.1.1.2 and option 3 in clause 5.4.4.1.1.3
are variants for later release consideration.
Solution#4.1 option 2 in clause 5.4.4.1.2.2 is a variant for later release
consideration.
## 5.5 Network Capability Exposure
### 5.5.1 Description and assumptions
The services and network capabilities provided by 3GPP can be exposed to the
external (e.g. 3^rd^ party) and internal network functions. NEF (Network
Exposure Function) is responsible for the network capability exposure and
information receiving from other network functions (based on exposed
capabilities of other network functions).
The functionalities of NEF are specified in TS 23.501 [201] clause 6.2.5:
\- It provides a means to securely expose the services and capabilities
provided by 3GPP network functions for e.g. 3^rd^ party, internal exposure/re-
exposure, Application Functions, Edge Computing. In addition, it provides a
means for the Application Functions to securely provide information to 3GPP
network, e.g. Mobility Pattern, communication pattern.
\- It translates between information exchanged with the AF and information
exchanged with the internal network function.
\- The Network Exposure Function receives information from other network
functions (based on exposed capabilities of other network functions). It may
implement a Front End (NEF FE) to store the received information as structured
data using a standardized interface to a Unified Data Repository (UDR).
The detailed description for the external exposure is specified in TS 23.501
[201] clause 5.20 and TS 23.502 [202] clause 4.15.
The NEF can start the charging for Event exposure, subscription/notification
of network exposure, and external network exposure, triggered by Application,
operator configuration and other network functions.
For Event exposure, the AMF service operations information flow, UDM service
operations information flow, NEF service operations information flow and
Exposure with bulk subscription are specified in TS 23.502 [200] clause
4.15.3.2.4.
For subscription/notification of network exposure for Analytics, is specified
in TS 23.502 [200] clause 4.15.5.
For external network exposure, the Monitoring capability, Provisioning
capability, and Policy/Charging capability exposure are specified in TS
23.502[200] clause 4.15.3.
### 5.5.2 Potential requirements
The following potential charging requirements should be supported for network
capability exposure:
> \- Online and offline charging.
>
> \- Charging based on the network capability invocation or subscription for
> the network capabilities exposure.
The following potential charging requirements should be supported for the
exposure of charging system:
> \- The external exposure of the charging system as the network capability.
>
> \- The internal exposure of the charging system as the network capability.
### 5.5.3 Key issues
#### 5.5.3.1 Key issue #5.1: Charging for network capability exposure
This key issue is for study on how to support the external exposure charging
for the 3rd parties.
Solutions for this key issue will study:
\- Which entity/entities in the 5G architecture is suitable to host the CTF(s)
for network capability exposure.
\- The suitable charging models, e.g. API based, event based or session based
charging models, for external network exposure and network internal exposure.
\- The interaction with charging system including online charging and offline
charging system.
#### 5.5.3.2 Key issue #5.2: Exposure of Charging System as network capability
This key issue is for study on how to support the external exposure charging
for the 3rd parties.
> Solutions for this key issue will study:
>
> \- The possible of exposure of charging system as the network capability.
>
> \- The suitable charging models for the exposure of charging system as the
> network capability.
### 5.5.4 Solutions
#### 5.5.4.1 Solution#5.1: Charging for network capability external exposure
-- Ro/Rf
##### 5.5.4.1.1 Architecture description
The charging information for the network capability external exposure can be
collected by NEF, interacting with the charging system, as described for one
option in Figure 5.5.4.1.1.1:
Figure 5.5.4.1.1.1: Architecture of Charging System interfacing the NEF
Other options for this architecture are described in TS 32.254 [14] clause
4.2, replacing the SCEF by NEF.
##### 5.5.4.1.2 Procedure description
The following figure 5.5.4.1.2.1 describes the charging procedure of
\"Application Trigger\" Service, based on clause 5.2.6.1 TS 23.502 [202]
description, for External exposure.
Figure 5.5.4.1.2.1: \"Application Trigger\" Service
1\. The NEF (Network Exposure Function) receives an Application Trigger
Request message and checks whether the Application is authorised to send the
Application Trigger based on the requester Identifier.
A. The NEF requests the Online charging domain for checking whether the
requester has enough quota or rate of trigger submission.
2\. The NEF invokes the \"Get Subscriber Serving NF (External Identifier or
MSISDN, NF type)\" service provided by the UDM.
3\. The NEF acting as SCEF performs device triggering procedure.
4\. The NEF sends the Application Trigger Response to the Application Server.
B. The NEF reports the charging information for the Application trigger to
charging domain.
#### 5.5.4.2 Solution#5.2: Exposure of Charging System as network capability
##### 5.5.4.2.1 Architecture description
The charging information for the exposure of Charging System can be collected
by NEF, interacting with the charging system by service interface Nch, as
described in Figure 5.5.4.2.1.1:
Figure 5.5.4.2.1.1: Architecture of Exposure of Charging System
#### 5.5.4.3 Solution#5.3: Charging for internal network capability exposure
##### 5.5.4.3.1 Architecture description
The same architecture as per clause 5.5.4.1.1 applies.
##### 5.5.4.3.2 Procedure description
As per the clause 5.3 TS 23.502 [202], The NEF can subscribe the mobility
statistics from AMF, session statistics from SMF and policy statistics from
PCF for Analytics.
No charging for the internal Network Exposure for Analytics.
#### 5.5.4.4 Solution#5.4: Charging for Event Exposure with bulk subscription
##### 5.5.4.4.1 Architecture description
The same architecture as per clause 5.5.4.1.1 applies.
##### 5.5.4.4.2 Procedure description
Figure 5.5.4.4.2.1: Charging for Exposure with bulk subscription
1\. NEF registers with the NRF for any newly registered NF along with its NF
services.
2\. When an NF instantiates, it registers itself along with the supported NF
services with the NRF.
3\. NRF acknowledges the registration.
4\. NRF notifies the NEF with the newly registered NF along with the supported
NF services.
5\. NEF evaluates the NF and NF services supported against the pre-configured
events within NEF. Based on that, NEF subscribes with the corresponding NF
either for a single UE, group of UE(s) (e.g. identifying a certain type of UEs
such as IoT UEs), any UE. NF acknowledges the subscription with the NEF.
6 - 7. When the event trigger happens, NF notifies the requested information
towards NEF. NEF may store the information in the UDR.
8\. Application registers with the NEF for a certain event identified by event
filters.
A. The NEF interacts with charging domain for the Nnef_EventExposure request
from Application.
9 - 10. When the event trigger happens, NF notifies the requested information
towards NEF. NEF may store the information in the UDR.
11a-b. NEF reads from UDR and notifies the application for the corresponding
subscribed events.
B. The NEF reports the charging information for the Nnef_notify, including the
notification is step 4, 6,7,8,9 to charging domain.
In which step(s) of the scenario the NEF needs to interact with the charging
domain will be determined during the normative phase.
#### 5.5.4.5 Solution#5.5: Charging for network capability external exposure
-- Nch
##### 5.5.4.5.1 Architecture description
The charging information for the network capability external exposure can be
collected by NEF, interacting with the charging system, as described in Figure
5.5.4.1.1.2.1:
Figure 5.5.4.5.1.1: Architecture of Charging System interfacing the NEF
##### 5.5.4.5.2 Procedure description
The procedure is similar as procedure in clause 5.5.4.1.2, except the
interaction with the Charging system is over Nch.
### 5.5.5 Evaluation and conclusion
#### 5.5.5.1 Evaluation
The key issue #5.1 related to \"Charging based on the network capability
invocation or subscription for the network capabilities exposure\" potential
requirements in clause 5.5.2, is addressed under:
\- solution #5.1, and solution#5.5. for \"Application Trigger\" Service with
alternative architectures;
\- solution #5.4 for \"Event Exposure with bulk subscription\".
Other network capabilities exposed by the NEF such as Monitoring capability,
Provisioning capability, and Policy/Charging capability exposure, are needed
to be studied, based on the progress of SA2 TS 23.501 [201], 23.502 [202] and
23.503 [203], in order to fully address the key issue #5.1.
The key issue #5.2 related to \"The external exposure of the charging system
as the network capability\" potential requirements in clause 5.5.2, is
addressed under the unique solution #5.2 alternative, which is not completely
described, and may need further cooperation with other SDOs (e.g. OMA...).
The solution#5.3 is to exclude the charging for the internal Network Exposure
for Analytics.
#### 5.5.5.2 Conclusion
Solutions for key issues #5.1 and #5.2 are still FFS.
## 5.6 Roaming
### 5.6.1 Description and assumption
#### 5.6.1.0 General
The architecture references for roaming are in clause 4.2.2.
The architecture references for the PCF in roaming is in TS 23.503 [204]
clause 5.2.2.
For Roaming scenario, the Session Management functionality is specified in TS
23.501 [201] clause 5.6.3.
The UE may have simultaneous PDU sessions in LBO or Home Routed modes, they
will be handled independently under the respective mode from charging\'s
perspective.
The AMF determines if a PDU session is to be established in LBO or Home
Routing mode per TS 23.501 [201] clause 6.3.2. (e.g. for this DNN per DN
subscription).
The interaction between the V-PCF and H-PCF for roaming scenarios is specified
in TS 23.503 [204] clause 5.3.4, with per informative Annex A.3.1.7:
_\"In the case of local breakout, an interface (N24) is supported between the
V-PCF and H-PCF for providing mobility policy rules from HPLMN to VPLMN._
_In the case of roaming, an interface (N24) is supported between the V-PCF and
H-PCF for providing UE Route Selection Policy rules from HPLMN to VPLMN.\"_
#### 5.6.1.1 PDU session -- roaming LBO
The User subscription is checked by the SMF in VPLMN at PDU session
establishment.
#### 5.6.1.2 PDU session - roaming Home Routed
In Home routed:
\- User subscription check by the H-SMF at PDU session establishment.
\- H-SMF checks whether VPLMN is allowed by HPLMN to locally offload traffic
(based on roaming agreements).
\- QoS requirements associated with a PDU session sent from H-SMF to V-SMF in
VPLMN at PDU session establishment or modification, are checked by V-SMF per
roaming agreements.
### 5.6.2 Potential requirements
The following should be supported:
\- real-time resource usage control (online charging) from the HPLMN;
\- CDRs generation by the VPLMN.
### 5.6.3 Key issues
#### 5.6.3.1 Key issue #6.1: Online charging from HPLMN
This key issue is for investigating on how to support online charging from
HPLMN.
### 5.6.4 Solutions
#### 5.6.4.1 Solution #6.1: PDU session charging from SMF in roaming LBO -- CH
in VPLMN
##### 5.6.4.1.1 Architecture description
Figure 5.6.4.1.1.1: Charging domain interfacing the SMF in roaming LBO \-- CH
in VPLMN
##### 5.6.4.1.2 Procedures description
Based on clause 4.3.2.2.1 in TS 23.502 [202] message flows, the procedure
described in figure 5.1.4.1.2.1 applies for PDU Session Establishment in
roaming LBO, with the following differences:
\- SMF in VPLMN interacts with UDM in HPLMN.
\- PCF is split between hPCF in HPLMN and vPCF in VPLMN.
\- the Charging Domain is in VPLMN.
##### 5.6.4.1.3 Charging mode and objective
Interaction between the SMF and Charging domain in VPLMN, is offline charging
only.
CDRs generated in VPLMN are used as basis for TAP files sent between the VPLMN
Billing System and the HPLMN Billing system, which can be used for end user
billing by the HPLMN or wholesale purpose.
##### 5.6.4.1.4 Charging architecture -- additional considerations
Any solution in clause 5.9 used in \"offline only\" mode, applies to the
Network Architecture Figure 5.6.4.1.1.1, to serve the charging mode and
objective in clause 5.6.4.1.3.
##### 5.6.4.1.5 Solution evaluation
The benefit of this solution is have common behaviors for offline end-user
charging, both \"roamer-in\" and HPLMN subscribers.
The drawback of this solution are:
\- the HPLMN does not have any control on their subscriber\'s usage when
roaming out.
\- online charging is not possible for roamer-out.
\- for offline charging, TAP files from VPLMN are needed by the HPLMN for
their subscribers billing.
In case this solution is retained, clause 5.9 solutions need to be evaluated
with additional considerations of clause 5.6.4.1.4.
#### 5.6.4.2 Solution #6.2: PDU session charging from SMF in roaming LBO -- CH
in HPLMN
##### 5.6.4.2.1 Architecture description
Figure 5.6.4.2.1.1: Charging domain interfacing the SMF in roaming LBO \-- CH
in HPLMN
##### 5.6.4.2.2 Procedures description
Based on clause 4.3.2.2.1 in TS 23.502 [202], the procedure described in
figure 5.1.4.1.2.1 applies for PDU Session Establishment for roaming LBO, with
the following differences:
\- SMF in VPLMN interacts with UDM in HPLMN
\- PCF is split between hPCF in HPLMN and vPCF in VPLMN
\- the Charging Domain is in HPLMN
##### 5.6.4.2.3 Charging mode and objective
Interaction between the SMF in VPLMN and Charging domain in HPLMN in offline
or online charging.
In this solution, since the PDU session charging is under the control of
HPLMN, CDRs generation in the VPLMN is not proposed.
##### 5.6.4.2.4 Charging architecture -- additional considerations
Any solution in clause 5.9 applied to the Network architecture in Figure
5.6.4.2.1.1 with the SMF in VPLMN and CH domain in HPLMN, to serve the
charging mode and objective in clause 5.6.4.2.3, needs additional
considerations to address CH inter-PLMN.
##### 5.6.4.2.5 Solution evaluation
This solution solves the Key issue #6.1.
The drawbacks of this solution are:
\- no CDRs generation in VPLMN (for wholesale).
\- CH inter-PLMN: Quota management crossing the PLMNs needs additional
considerations compared to intra-PLMN, as those considered for Gy inter-PLMN
introduced in 3GPP Rel-13 (e.g. dedicated roaming agreement between Operators,
additional parameters to be standardized by GSMA).
For the charging architecture, the recommendation is to adopt extension of
clause 5.9 solution, to incorporate additional considerations of clause
5.6.4.2.4.
#### 5.6.4.3 Solution #6.3: PDU session charging from SMFs in Home Routed
##### 5.6.4.3.1 Architecture description
Figure 5.6.4. 3.1.1: Charging domain interfacing the SMFs in Home Routing
##### 5.6.4.3.2 Procedures description
The following figure 5.6.4.3.2.1 describes a PDU session establishment for
roaming in Home routed scenario based on clause 4.3.2.2.2 TS 23.502 [202]
description:
Figure 5.6.4.3.2.1: PDU session establishment -- roaming Home Routed
All the steps are described in clause 4.3.2.2.2 TS 23.502 [202], and below
part of description relevant for roaming, with also some additions:
1-2. The H-SMF is selected by the AMF.
[7a-b]. Subscription Data Request to UDM, based on (Subscriber Permanent ID,
DNN, VPLMN): Default QoS profile.
[9a-b to 11]. If dynamic PCC is deployed, the SMF performs PCF selection, and
requests for PCC Rules, and SMF selection of UPF.
A. The H-SMF performs the selection of the CH-Charging domain, and seeks for
authorization for the subscriber to start the PDU session in the VPLMN.
B. Start of the PDU session is reported to charging domain in HPLMN.
> 13\. H-SMF to V-SMF: Create PDU Session Response (Authorized QoS Rule(s),
> SSC mode, indication if VPLMN authorized to offload traffic (insert UL CL or
> Branching Point)).
C. Start of the PDU session is reported to charging domain in VPLMN.
D. PDU session update reported to the charging domain in VPLMN.
E. Control of the PDU session by the charging domain in HPLMN.
There may be additional interaction with the charging domain after or before
step 15. This will be determined during the normative phase.
##### 5.6.4.3.3 Charging mode and objective
Interaction between the SMF in VPLMN and Charging domain in VPLMN in offline
charging: CDRs generated in VPLMN are used as basis for TAP files sent between
the VPLMN Billing system and the HPLMN Billing system, which can be used for
end user billing by the HPLMN or wholesale purpose.
Interaction between the SMF in HPLMN and Charging domain in HPLMN in offline
charging: CDRs generation for end user billing, and for wholesale (i.e. for
reconciliation with the TAP files received from VPLMN Billing system).
Interaction between the SMF in HPLMN and Charging domain in HPLMN in online
charging.
##### 5.6.4.3.4 Charging architecture -- additional considerations
###### 5.6.4.3.4.1 Description
In order to serve the Network architecture in Figure 5.6.4.3.1.1, charging
mode and objective in clause 5.6.4.3.3, it is needed to investigate further on
appropriate charging architecture.
Charging architecture to support interaction between the SMF in HPLMN and
Charging domain in HPLMN in offline charging for end user billing, and in
online charging, is addressed under the clause 5.9 \"Online and offline
charging evaluation\".
This clause is for investigating on following additional considerations:
\- Charging architecture to support interaction between the SMF in VPLMN and
Charging domain in VPLMN in offline charging.
\- Charging architecture to support interaction between the SMF in HPLMN and
Charging domain in HPLMN in offline charging for wholesale.
###### 5.6.4.3.4.2 Solution #6.3.1: solutions #9.1 (Combined online and
offline charging) for VPLMN
The architecture is per Figure 5.9.4.1.1.1 of solutions #9.1 with the V-SMF as
the 5G System Network Element.
The \"offline only\" mode is the unique mode needed with no quota management.
A dedicated behaviour needs to be defined compared to those generated for the
subscribers in HPLMN.
**Evaluation:**
This solution uses a sub-functionality of solution#9.1 (i.e. offline), which
in addition needs to be adapted to \"roamer-in\" scenario where the subscriber
is not owned by the VPLMN.
###### 5.6.4.3.4.3 Solution #6.3.2: solutions #9.2 (Partial combined online
and offline charging) for VPLMN
The architecture is per Figure 5.9.4.2.1.1 of solutions #9.2 with the V-SMF as
the 5G System Network Element.
The CTF always select Rf path.
A dedicated behaviour needs to be defined compared to those generated for the
subscribers in HPLMN.
**Evaluation:**
This solution is similar as Rf-based solution in EPC, except that an
additional module box is needed in the CH domain to route to the CDF (on/off
in the charging architecture per Figure 5.9.4.2.1.1).
###### 5.6.4.3.4.4 Solution #6.3.3: solutions #9.3 (Online charging with
unlimited quota for offline) for VPLMN
The architecture is per Figure 5.9.4.1.1.1 of solutions #9.1 with the V-SMF as
the 5G System Network Element.
A dedicated behaviour needs to be defined compared to those generated for the
subscribers in HPLMN.
**Evaluation:**
This solution implies use of Ro-like interface and quota management which is
over sized and not appropriate for this \"roamer-in\" scenario where the
subscriber is not owned by the VPLMN.
###### 5.6.4.3.4.5 Solution #6.3.4: Rf solution for VPLMN
The architecture is based on existing TS 32.240 [1] architecture for offline.
Figure 5.6.4.3.4.5.1: Offline charging architecture for 5G V-SMF
A dedicated behaviour needs to be defined compared to those generated for the
subscribers in HPLMN.
**Evaluation:**
This solution is similar as Rf-based solution in EPC.
##### 5.6.4.3.5 Solution evaluation
This solution solves the Key issue #6.1.
The benefits of this solution are:
\- both online and offline charging are possible.
\- CDRs generation in VPLMN for wholesale.
The charging architecture for \"interaction between the SMF in HPLMN and
Charging domain in HPLMN in offline charging for end user billing, and in
online charging\" is per clause 5.9 conclusion.
For \"interaction between the SMF in VPLMN and Charging domain in VPLMN in
offline charging\", the best approach is to re-use the solution in HPLMN, and
adapt it for additional roaming considerations of clause 5.6.4.3.4:
\- solution #6.3.1 in VPLMN, if solution #9.1 in HPLMN;
\- solution #6.3.2 in VPLMN, if solution #9.2 in HPLMN;
\- solution #6.3.3 in VPLMN, if solution #9.3 in HPLMN.
Since the solution #6.3.4 is independent from any clause 5.9 solutions in
HPLMN, it is not the best approach.
#### 5.6.4.4 Solution #6.4: PDU session charging from SMF in roaming LBO -- CH
in HPLMN and VPLMN
##### 5.6.4.4.1 Architecture description
Figure 5.6.4.4.1.1: Charging domain interfacing the SMF in roaming LBO \-- CH
in HPLMN and VPLMN
##### 5.6.4.4.2 Procedures description
The same procedure applies as for solution #6.2 in clause 5.6.4.2.2 between
SMF in VPLMN and CH domain in HPLMN.
The same procedure applies as for solution #6.3 in clause 5.6.4.3.2 between
SMF in VPLMN and CH domain in VPLMN.
##### 5.6.4.4.3 Charging mode and objective
Interaction between the SMF in VPLMN and Charging domain in HPLMN in offline
or online charging.
Interaction between the SMF in VPLMN and Charging domain in VPLMN, is offline
charging only.
CDRs generated in VPLMN are used as basis for TAP files sent between the VPLMN
Billing System and the HPLMN Billing system, which can be used for wholesale
purpose.
##### 5.6.4.4.4 Additional considerations
Any solution in clause 5.9 applied to the Network architecture in Figure
5.6.4.4.1.1 with the SMF in VPLMN and CH domain in HPLMN, for \"Interaction
between the SMF in VPLMN and Charging domain in HPLMN in offline or online
charging\" of clause 5.6.4.4.3, needs additional considerations to address CH
inter-PLMN.
Any solution in clause 5.6.4.3.4 applied to the Network architecture in Figure
5.6.4.4.1.1, for \"Interaction between the SMF in VPLMN and Charging domain in
VPLMN, is offline charging only\" of clause 5.6.4.4.3 is applicable.
##### 5.6.4.4.5 Solution evaluation
This solution solves the Key issue #6.1.
The benefits of this solution are:
\- both online and offline charging are possible;
\- CDRs generation in VPLMN for wholesale.
The drawbacks of the solution are:
\- CH inter-PLMN (see clause 5.6.4.2.5).
\- when \"offline charging\", two offline CH sessions as well as different
triggers/information in parallel from the same SMF.
For the charging architecture, the recommendation is to adopt extension of
clause 5.9 solution, to incorporate additional considerations of clause
5.6.4.4.4.
### 5.6.5 Overall evaluation and conclusion
#### 5.6.5.1 Overall evaluation
All solutions solve Key issue #6.1, except solution #6.1.
For roaming Home Routed the solution #6.3 has no drawback.
For roaming LBO:
> \- The solution #6.1 has the limitation to be \"offline charging\" only,
> with some drawbacks identified in clause 5.6.4.1.5.
\- Both solutions #6.2, and #6.4 have the benefit to allow both online and
offline charging, and following drawbacks:
\- solution #6.2: no CDRs generation in VPLMN (for wholesale).
\- solution #6.4: two offline CH sessions from the same SMF for the same PDU
session, and CH inter-PLMN in online which needs further resolutions as per
clause 5.6.4.2.5.
#### 5.6.5.2 Conclusion
It is concluded on solution #6.3 for roaming Home Routed, with charging
architecture as per 5.9 conclusion incorporating adaptation for VPLMN as well.
Solutions for Roaming LBO are FFS.
## 5.7 Service-based architecture
### 5.7.1 Description and assumptions
As per the description about the architecture for the 5G system in TS 23.501
[201] clause 4.2, the 5G architecture is defined as service-based and the
interaction between network functions is represented in two ways, including
the service-based representation and the reference point representation.
There is one single 5G system architecture, using service-based interface for
the interactions between the control plane functions (service-based). And the
reference-point diagrams represents the interaction relationship between the
CP NFs.
### 5.7.2 Potential requirements
The following should be supported for the service-based architecture:
\- Online charging and offline charging.
### 5.7.3 Key issues
#### 5.7.3.1 Key issue #7.1: The service interface for Charging Domain
This key issue is for investigating on how to support the service interface
for charging domain, also considering the possible different feature between
offline and online charging system.
This investigation covers the following:
\- identification of the main interactions with the charging domain, such as
SMF and charging domain;
\- determination of which interface e.g. diameter or service based interface
in the 5G architecture is suitable to charging system.
### 5.7.4 Solutions
#### 5.7.4.1 Solution#7.1: Service interface for SMF and Charging Domain
##### 5.7.4.1.1 Architecture description
Figure 5.7.4.1.1.1: The service interface from Charging Domain for SMF
Nch is the Service-based interface exhibited by Charging Domain.
##### 5.7.4.1.2 Service identification
The following scenarios and basic operations should be supported by
corresponding services:
Table 5.7.4.1.2.1: Offline Charging scenarios
+--------------------------------+------------------------+ | **Offline charging scenarios** | **Basic operations** | +--------------------------------+------------------------+ | Event based charging | Charging Data Request | | | | | | Charging Data Response | +--------------------------------+------------------------+ | Session based charging | Charging Data Request | | | | | | Charging Data Response | +--------------------------------+------------------------+
Table 5.7.4.1.2.2: Online Charging scenarios
+----------------------------------------+------------------------+ | **Online charging scenarios** | **Basic operations** | +----------------------------------------+------------------------+ | Immediate Event Charging | Debit Units Request | | | | | | Debit Units Response | +----------------------------------------+------------------------+ | Event charging with Unit Reservation | Reserve Units Request | | | | | | Reserve Units Response | | | | | | Debit Units Request | | | | | | Debit Units Response | +----------------------------------------+------------------------+ | Session charging with Unit Reservation | Reserve Units Request | | | | | | Reserve Units Response | | | | | | Debit Units Request | | | | | | Debit Units Response | +----------------------------------------+------------------------+ | Re-authorization | | +----------------------------------------+------------------------+
The following capability from the charging server to terminate the PDU session
should be supported by corresponding services:
\- Termination action
#### 5.7.4.2 Solution#7.2: Reference point representation for SMF and Charging
Domain
Figure 5.7.4.2.1: Reference point from Charging Domain for SMF
The interaction between the SMF and Charging Domain is Gy/Gz interface.
#### 5.7.4.3 Solution#7.3: Service interface for SMF and Charging Domain
Figure 5.7.4.3.1: Basing the service interface from Charging Domain on the ADF
Nch is the Service-based interface exhibited by Charging Domain. In this case,
instead of the Charging Domain exposing services required by a Charging
Triggering Functions (CTF) it would expose services provided by Account Data
Forwarding (ADF) function. This will allow the Charging Domain to receive
reports or collected metrics from other functions that only have an Accounting
Metrics Collection (AMC) function and that do not have a CTF.
#### 5.7.4.4 Solution evaluation
Solution#7.1solves Key issue #7.1( The service interface for Charging Domain);
Solution#7.2 solves Key issue #7.1(The diameter interface for Charging
Domain);
Solution#7.3 solves Key issue #7.1(The service interface for Charging Domain).
The following table 5.7.4.4.1 provide the benefits and drawback analysis for
solutions of SBA.
Table 5.7.4.4.1: Solution Evaluation for SBI
+----------------------+----------------------+----------------------+ | Options | benefits | drawback | +----------------------+----------------------+----------------------+ | Solution 7.1 Service | Unified interface | New concept to | | interface for SMF | for SMF | realize | | and Charging Domain | | | | | Benefit for the | | | | support of Industry | | | | services charging, | | | | e.g network slicing | | +----------------------+----------------------+----------------------+ | Solution 7.2 Gy/Gz | Leverage from the | Current complex | | for SMF and Charging | existing solution | mechanism on | | Domain | | Diameter protocol | | | | implementation. | | | | | | | | Support the two | | | | protocols in NFs of | | | | 5GS, e.g SMF | | | | | | | | Low Reusability, | | | | dedicated interface | | | | for the interaction | | | | between NFs and | | | | Charging System | | | | | | | | Lack of deployment | | | | flexibility, | | | | especially for the | | | | Network | | | | orchestration of | | | | slicing | +----------------------+----------------------+----------------------+ | Solution 7.3 Service | Unified interface | New concept to | | interface for SMF | for SMF | realize | | and Charging Domain | | | | (ADF) | Benefit for the | | | | support of Industry | | | | services charging, | | | | e.g network slicing | | +----------------------+----------------------+----------------------+
### 5.7.5 Conclusions
The solution #7.1 is preferred solution which should include the backward
compatibility consideration.
## 5.8 Interworking between 5G System and existing systems
### 5.8.1 Description and assumptions
In order to interwork with existing system EPC, the N26 interface is
introduced as an inter-CN interface between the MME and 5GS AMF in order to
enable interworking between EPC and the NG core. PCF + PCRF, PGW-C + SMF and
UPF + PGW-U are dedicated for interworking between 5GS and EPC, which are
optional and are based on UE and network capabilities in the clause 4.3 TS
23.501 [201].
### 5.8.2 Potential requirements
The following requirements may be considered:
\- Online and offline charging.
\- Session based charging.
\- Volume, time, combined volume and time, and event based charging.
\- Online charging session continuity.
### 5.8.3 Key issues
#### 5.8.3.1 Key issue #8.1: \
This key issue is for investigating on how to support the Charging for 5GS to
EPS handover using N26 interface. This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain;
\- charging information collection and correlation cause by the handover;
\- determination of the charging session change handover from the 5G to EPS;
\- the quota management and reporting mechanism caused by the handover.
#### 5.8.3.2 Key issue #8.2: \
This key issue is for investigating on how to support the Charging for EPS to
5GS handover using N26 interface. This investigation covers the following:
\- determination of which entity/entities in the 5G architecture is suitable
to host the CTF(s);
\- identification of the main interactions with the charging domain;
\- charging information collection and correlation cause by the handover;
\- determination of the charging session change handover from EPS to 5G;
\- the quota management and reporting mechanism caused by the handover.
### 5.8.4 Solutions
#### 5.8.4.1 Solution#8.1: 5GS to EPS handover using N26 interface
Figure 5.8.4.1.1: Charging procedure for 5GS to EPS handover
> A) Charging session create for PDU session.
1\. 5G RAN decides that the UE should be handed over to the E-UTRAN.
2\. The AMF requests the PGW-C+SMF to provide SM Context.
3\. The AMF selects an MME and sends a Relocation Request for selecting a new
SGW.
4\. The MME selects the Serving GW and sends a Create Session Request message
for each PDN connection to the Serving GW.
5\. The Serving GW allocates its local resources and returns them in a Create
Session Response message to the MME.
6\. The MME requests the target eNodeB to establish the bearer(s) by sending
the message Handover Request message.
7\. The target eNB allocates the requested resources.
8\. If the MME decides that indirect forwarding applies, it sends a Create
Indirect Data Forwarding Tunnel Request message to the Serving GW.
9\. The MME sends the message Relocation Response.
10\. If indirect forwarding applies, the AMF forwards to the PGW-C+SMF the
information related to data forwarding to the SGW. The PGW-C+SMF returns a
Create Indirect Data Forwarding Tunnel Response.
11\. The AMF sends the Handover Command to the source 5G RAN.
12\. When the UE has successfully accessed the target eNodeB.
13\. The target MME informs the Serving GW that the MME is responsible for all
the bearers the UE have established.
14-15. The Serving GW informs the PGW-C+SMF of the relocation for each PDN
connection.
B. Update the Charging session caused by handover. 16. The Serving GW
acknowledges the User Plane switch to the MME.
17\. The PGW-C+SMF initiates dedicated bearer activation procedure for non-GBR
QoS flows.
C. The interaction with the charging system caused by the dedicated bearer.
In which step(s) of the scenario the PGW-C+SMF needs to interact with the
charging domain will be determined during the normative phase.
#### 5.8.4.2 Solution#8.2: EPS to 5G handover using N26 interface
N26 interface is used to provide seamless session continuity for single
registration mode. Figure 5.8.4.2.1 and Figure 5.8.4.2.2 describes the
charging procedure for handover from EPS to 5GS when N26 is supported, based
on the Figure 4.11.2.2.2-1 and Figure 4.11.2.2.3-1 specified in TS 23.502
[202].
Figure 5.8.4.2.1: Charging procedure for EPS to 5G handover (Preparation
phase)
A. Charging session is established for UL and DL UP PDUs.
1\. The source E-UTRAN decides that the UE should be handed over to the NG-
RAN.
2\. The E-UTRAN sends a Handover Required to the MME.
3\. The MME selects the target AMF and sends a Forward Relocation Request to
the selected AMF.
4\. The AMF sends a PDU Handover Request to the selected SMF.
5\. If dynamic PCC is deployed, the SMF may initiate PDU Session Modification
towards the h-PCF + h-PCRF to obtain the 5GS PCC Rules for the PDU Session.
6\. The SMF+PGW-C modifies the PGW-U+UPF.
7\. The SMF + PGW-C sends a PDU Session Modification Response to the AMF.
8\. For home-routed roaming scenario only: The v-SMF selects a v-UPF and
initiates an N4 Session Establishment procedure with the selected v-UPF.
9\. The AMF sends a Handover Request to the NG-RAN.
10\. The NG-RAN sends a Handover Request Acknowledge to the AMF.
11\. The AMF sends an Modify PDU Session Request to the SMF for updating N3
tunnel information.
12\. SMF+PGW-C to AMF: _Modify PDU Response._
13\. If indirect forwarding applies, the MME sends the Create Indirect Data
Forwarding Tunnel Request/Response.
14\. The AMF sends the message Forward Relocation Response.
Figure 5.8.4.2.2: Charging procedure for EPS to 5G handover (Execution phase)
1\. The MME sends a Handover Command to the E-UTRAN.
2\. Towards the UE, the E-UTRAN commands handover to the NG-RAN.
3\. Handover Confirm: the UE confirms handover to the NG-RAN.
4\. Handover Notify: the NG-RAN notifies to the AMF that the UE is handed over
to the NG-RAN.
5\. Then the AMF knows that the UE has arrived to the target side and informs
the MME by sending a Forward Relocation Complete Notification message.
6\. The MME responds with a Forward Relocation Complete Notification Ack
message.
7\. AMF to PGW-C+SMF: Handover Complete (PDU Session ID).
8\. The SMF + PGW-C updates the UPF + PGW-U with the V-CN Tunnel Info.
9\. If PCC infrastructure is used, the SMF + PGW-C informs the h-PCF + h-PCRF
about the change of, for example, the RAT type and the 5GS PCC Rules (created
in step 6 of the preparation phase) should become active from this point.
A. Charging session is updated for the handover.
10\. PGW-C+SMF to AMF: Handover Complete Ack (PDU Session ID).
11\. For home-routed roaming scenario: The v-SMF provides to the v-UPF with
the N3 DL Tunnel Info and the N9 UL Tunnel Info.
12\. The UE registers in the target 5GS with \"mobility registration update\".
13\. Resources in the source system and resources for PDU forwarding are
released by the MME.
In which step(s) of the scenario the PGW-C+SMF needs to interact with the
charging domain will be determined during the normative phase.
### 5.8.5 Evaluation and conclusion
#### 5.8.5.1 Solution Evaluation
Solution#8.1 for key issue #8.1 for the charging of 5GS to EPS handover.
Solution #8.2 for key issue #8.2 for the charging of EPS to 5GS handover.
#### 5.8.5.2 Conclusions
Interaction between the SMF/PGW-C and charging domain is using the same
architecture as for interaction between SMF and the charging architecture.
## 5.9 Online and offline charging evaluation
### 5.9.1 Description and assumption
#### 5.9.1.1 Existing functionalities
Offline charging functionality is specified in TS 32.240 [1] clause 4.1.1, and
Online charging functionality in clause 4.1.2.
Both include resource usage collection mechanisms, with the difference that
online charging can affect, in real-time, the service rendered (and also
authorization is granted prior to resource usage), whereas offline charging
cannot.
For each domain, they are specified separately for online and offline:
charging information and chargeable event are not necessarily identical, less
set of Nodes for online than for offline.
Offline charging is supported by Rf reference point, and online charging by Ro
reference point, and the main differences between these 2 reference points
are:
\- Architecture: Rf from CTF to CDF, Ro from CTF to OCF (and further internal
interactions with ABMF/RF).
\- Both support \"session\" and \"event\" based scenario, but there are more
scenario for Ro in \"event\" based (IEC and ECUR).
\- Mechanism to support direct interaction with the control of network
resource usage (prior to or during the session) specific to online.
\- Quota management for online.
Rf and Ro are both specified as Diameter applications on top of the same
Diameter Base protocol: Rf is based on IETF RFC 6733 [401], and Ro on IETF RFC
4006 [402].
In PS domain TS 32.251 [11], any EPC Nodes specified with online charging
capability are specified with offline charging capability as well, they can
both be activated.
According to TS 32.251 [11], a \"tight interworking between online and offline
charging mechanism i.e. only the specified quota re-authorisation triggers
armed by OCS (including e.g. tariff time change, returned quotas, etc.) are
used to close the service data flow containers \" is specified for Nodes where
both online and offline are activated.
#### 5.9.1.2 Considerations for 5G
When both online (Ro) and offline (Rf) are activated, this implies two
parallel sessions are active simultaneously from Network elements, although a
set of common functionalities are invoked, and common charging information are
used.
This topic is to evaluate a new CTF combining both online and offline charging
functionalities and interfacing the charging domain via a single reference
point, applicable to entity/entities in the 5G architecture which will be
selected as suitable to host the CTF.
This topic addresses subscriber charging in HPLMN for both roaming and non
roaming scenario.
### 5.9.2 Potential requirements
The following should be supported:
\- Combined online and offline charging.
\- Offline charging only.
\- Single reference point from a CTF in 5G Architecture.
### 5.9.3 Key issues
#### 5.9.3.1 Key issue #9.1: CDRs generation for online
This key issue is for investigating on how to support CDRs generation when
online charging is activated.
#### 5.9.3.2 Key issue #9.2: Offline charging only
This key issue is for investigating on how to support Offline charging (CDRs
generation) only (i.e. no online charging).
### 5.9.4 Solutions
#### 5.9.4.1 Solution #9.1: Combined online and offline charging
##### 5.9.4.1.1 Architecture description
Figure 5.9.4.1.1.1: Combined online and offline Charging architecture
Ncg reference point similar as Ro and Rf reference points as per TS 32.240 [1]
clause 4.4.2.1 and 4.4.1.1, with enhancement to also address CDRs generation
for the Billing Domain.
##### 5.9.4.1.2 Procedures description
In this solution, the commands, chargeable events, and charging information
are specified commonly for online and offline charging for subscribers, and
CDRs are constructed by EBCF/SBCF employing the CDF, based on charging events
received over Ncg, and also additional internal information resulting from
potential EBCF/SBCF interaction with RF, ABMF.
Both online and offline charging can be activated for the different service
data flows in the same PDU session.
The existing \"CDR generation for online charged subscribers\" capability as
per TS 32.240 [1] clause 4.3.2.3 is used: the CDF is employed by the OCF to
construct CDRs.
The CDRs content is specified at similar level as for EPC CDRs, the internal
information resulting from EBCF/SBCF interaction with RF, ABMF remain non-
specified.
\"Offline only\" specified in Key issue#9.2 mode is supported through requests
from the SMF to the Charging server without quota management.
##### 5.9.4.1.3 Solution evaluation.
This solution allows support of a single interface to the Charging server for
all the subscribers, whether they need to be served by online charging, or
whether they need to be served by \"offline only\" charging, or whether both
online and offline charging are activated.
This solution solves Key issue #9.1 and Key issue #9.2.
The benefits of this solution are:
\- CDRs generated for subscribers in \"offline only\" have similar format as
CDRs generated for subscribers in \"online\".
\- quota management is avoided when \"offline only\" mode.
The drawback of this solution is the deviation from existing Ro/Rf specified
for EPC (i.e. Gy/Gz), and also from generic Ro/Rf (applicable to all domains)
online/offline charging TS 32.299 [50] functionalities.
#### 5.9.4.2 Solution #9.2: Partial combined online and offline charging
##### 5.9.4.2.1 Architecture description
Figure 5.9.4.2.1.1: Partial Combined online and offline charging architecture
Ncg reference point includes both Ro and Rf reference points functionalities
as per TS 32.240 [1] clauses 4.4.2.1 and 4.4.1.1 respectively.
At the session start, the CTF selects which of online functionality and
offline functionality to apply for the lifetime of the session.
##### 5.9.4.2.2 Procedures description
In this solution, a set of chargeable events, and charging information are
specified for online charging and offline charging for subscribers: part of
them are common between offline and online, and some are specific to online or
specific to offline. Online is based on Ro and offline based on Rf.
The CTF indicates when starting a charging session which mode is used: offline
(i.e. Rf) or online (i.e. Ro).
In offline mode, the CDRs are constructed similarly as for EPC CDRs by the
CDF.
In online mode the CDRs are constructed similarly as in Solution #9.1, i.e.
\"CDR generation for online charged subscribers\" capability as per TS 32.240
[1].
A common baseline CDRs format is defined for offline and online.
##### 5.9.4.2.3 Solution evaluation.
This solution allows support of a single interface to the Charging server for
all the subscribers served in online charging, i.e. Ro.
This solution allows support of a single interface to the Charging server for
all the subscribers served in offline charging, i.e. Rf.
This solution solves Key issue #9.1 and Key issue #9.2.
The benefit of this solution is the re-use of generic Ro and Rf, and it also
leverages from Ro/Rf as specified today for EPC.
The drawback for this solution is when \"online mode\" only, the \"offline
mode\" cannot run simultaneously for the same session.
#### 5.9.4.3 Solution #9.3: Online charging with unlimited quota for offline
##### 5.9.4.3.1 Architecture description
Same architecture as per clause 5.9.4.1.1.
Ncg reference point is equivalent to Ro reference point as per TS 32.240 [1]
clause 4.4.2.1.
##### 5.9.4.3.2 Procedures description
In this solution, the commands, chargeable events, and charging information
are specified as for online charging only, and CDRs are constructed as per
existing \"CDR generation for online charged subscribers\" capability TS
32.240 [1] clause 4.3.2.3.
The CDRs content is specified at similar level as for EPC CDRs, the internal
information resulting from potential EBCF/SBCF interaction with RF, ABMF
remain non-specified.
The offline charging mode is handled as per online charging with unlimited
quota.
##### 5.9.4.3.3 Solution evaluation.
This solution allows support of a single interface to the Charging server for
all the subscribers, whether they need to be served by online charging, or
whether they need to be \"offline only\" charging.
This solution solves Key issue #9.1 and Key issue #9.2
The benefit of this solution is re-use of Ro and leverage on how it is
specified today for EPC.
The drawback of this solution is the complexity introduced when \"offline
only\" mode is needed, due to the use of quota management, and missing
functionalities from Rf.
### 5.9.5 Overall evaluation and conclusion.
#### 5.9.5.1 Overall evaluation
The 3 solutions #9.1, #9.2, and #9.3, solve both Key issue #9.1 and Key issue
#9.2.
Table 5.9.5.1:Solutions evaluation for Online and offline charging
+----------------+----------------+----------------+----------------+ | Aspect | Solution #9.1 | Solution #9.2 | Solution #9.3 | +----------------+----------------+----------------+----------------+ | Support of | Yes | Cannot support | Yes | | online and | | the concurrent | | | offline | | online and | | | charging | | offline | | | scenario | | charging in | | | | | same PDU | | | | | Session | | +----------------+----------------+----------------+----------------+ | Complexity of | Medium | Medium | Low | | implementation | | | | | in SMF | | | | +----------------+----------------+----------------+----------------+ | Complexity of | Medium | Low | High | | implementation | | | | | in charging | | | Support of | | server | | | specific | | | | | processing for | | | | | unlimited | | | | | quota | | | | | management for | | | | | offline | | | | | charging which | | | | | is different | | | | | the | | | | | traditional | | | | | quota | | | | | management. | +----------------+----------------+----------------+----------------+ | Leverage from | No | Yes | Yes | | existing EPC | | | | | Ro/Rf | | | | +----------------+----------------+----------------+----------------+ | Allow | Yes | No | Yes | | consistent and | | | | | synchronized | | | | | reporting | | | | | between online | | | | | and offline | | | | +----------------+----------------+----------------+----------------+
Solutions #9.2 and #9.3 have the benefit to leverage from existing EPC Ro/Rf,
however:
\- solution #9.2 does not address \"Combined online and offline charging\"
clause 5.9.2 potential requirement.
\- solutions #9.3 is artificial use of quota management to address CDRs
generation.
Solution #9.1 benefits from a new unified reference point and CDR format,
combining Ro/Rf functionalities for 5G System.
#### 5.9.5.2 Conclusion
It is concluded on solution #9.1 for the combined online and offline solution.
This conclusion is dependent on the conclusion of clause 5.7 Service-based
Architecture.
The combined online and offline charging includes the OCF, RF, ABMF, CDF and
CGF.
The solution #9.3 is ffs.
## 5.10 Connection, registration and mobility management
### 5.10.1 Description and assumptions
The registration procedure is specified in TS 23.502 [202] clause 4.2.2.
### 5.10.2 Potential requirements
None.
### 5.10.3 Key issues
None.
### 5.10.4 Solutions
#### 5.10.4.1 Solution#10.1: No charging for registration
##### 5.10.4.1.1 Architecture description
The same architecture as per clause 5.3.4.2.1 applies.
##### 5.10.4.1.2 Procedure description
The Registration procedure is used when the UE needs to perform:
\- initial registration to the 5G system;
\- mobility registration update upon changing to a new Tracking area (TA)
outside the UE\'s registration area in idle mode;
\- when the UE performs a periodic registration update (due to a predefined
time period of inactivity);
\- and additionally, when the UE needs to update its capabilities or protocol
parameters that are negotiated in Registration procedure.
For more information on the registration procedure see TS 23.502 [202] clause
4.2.2.
A UE needs to register with the network to get authorised to receive services,
to enable mobility tracking and to enable reachability. Even if there is an
authorization of services there will not be any accounting or charging since
this does not provide any specific service only the availability.
##### 5.10.4.1.3 Solution evaluation.
This solution describes that no charging information will be generated for
registration. There is currently no requirement to have any charging done for
the registration and therefore generation of charging information is
redundant.
The drawback of this solution is that there will be no record of the
registration.
### 5.10.4 Conclusion
For the Connection, Registration and Mobility Management the solution #10.1
would suffice at as first step, and if there are more support needed this
could be added at a later step.
# 6\. Conclusions and recommendations
## 6.1 Conclusions
It is concluded on:
\- Session management and service continuity: solutions as per clause 5.1.5.3
conclusion;
\- QoS: solutions as per clause 5.2.5 conclusion;
\- Interaction between SMF and UPF: solutions as per clause 5.3.5.2
conclusions;
\- Network Slicing: solutions as per clause 5.4.5 conclusion;
\- Roaming: Home Routed as per 5.6.5 conclusion;
\- Service-based Architecture: as per 5.7.5 conclusion;
\- Interworking between 5G System and Existing Systems: as per 5.8.5
conclusion;
\- Online and offline charging evaluation: as per 5.9.5 conclusion.
## 6.2 Recommendations
The following are for further study:
\- QoS: per clause 5.9.5 conclusion, Aggregative QoS flow based charging for
5QI;
\- Network Slicing: per clause 5.4.5 conclusion:
\- solutions for key issues #4.2;
\- different options of Solution#4.1;
\- solution #4.2;
\- Network Capability Exposure: per clause 5.5.5.2 conclusion;
\- Roaming LBO as per 5.6.5 conclusion;
\- Connection, Registration and Mobility Management: as per clause 5.10.5
conclusion.
#
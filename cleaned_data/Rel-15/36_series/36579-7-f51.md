# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
The present document is part 7 of a multi-part deliverable covering
conformance test specification for Mission Critical Services over LTE
consisting of:
3GPP TS 36.579-1 [2]: \"Mission Critical (MC) services over LTE protocol
conformance testing; Part 1: Common test environment\"
3GPP TS 36.579-2 [24]: \" Mission Critical (MC) services over LTE; Part 2:
Mission Critical Push To Talk (MCPTT) User Equipment (UE) Protocol conformance
specification\";
3GPP TS 36.579-3 [3]: \" Mission Critical (MC) services over LTE; Part 3:
Mission Critical Push To Talk (MCPTT) Server Application test specification\";
3GPP TS 36.579-4 [4]: \" Mission Critical (MC) services over LTE; Part 4: Test
Applicability and Implementation Conformance Statement (ICS)\";
3GPP TS 36.579-5 [5]: \" Mission Critical (MC) services over LTE; Part 5:
Abstract test suite (ATS)\";
3GPP TS 36.579-6 [25]: \" Mission Critical (MC) services over LTE; Part 6:
Mission Critical Video (MCVideo) User Equipment (UE) Protocol conformance
specification\";
**3GPP** **TS** **36.579-7: \" Mission Critical (MC) services over LTE; Part
7: Mission Critical Data (MCData) User Equipment (UE) Protocol conformance
specification\" (the present document).**
# 1 Scope
The present document specifies the protocol conformance testing for testing a
MCData Client for compliance to the Mission Critical Video (MCData) over LTE
protocol requirements defined by 3GPP.
In particular the present document contains:
\- the overall test structure;
\- the test configurations;
\- the conformance requirement and reference to the core specifications;
\- the test purposes; and
\- a brief description of the test procedure, the specific test requirements
and short message exchange table.
The present document is valid for MCData Clients implemented according to 3GPP
releases starting from Release 13 up to the Release indicated on the cover
page of the present document.
The following information relevant to testing specified in the present
document could be found in accompanying specifications:
\- default setting of the test parameters TS 36.579-1 [2];
\- Implementation Conformance Statement (ICS) TS 36.579-4 [4] and
Implementation eXtra Information for Testing (IXIT) TS 36.579-5 [5];
\- the applicability of each test case TS 36.579-4 [4].
The test cases are expected to be executed through the 3GPP radio interface.
The present document does not specify the protocol conformance testing for the
EPS (LTE) bearers which carry the MCData data sent or received by the MCData
Client and which are required to be supported by the UE in which the MCData
Client is installed. This is defined in TS 36.523-1 [6].
According to 3GPP drafting rules, the references clause shall list only
documents that are explicitly mentioned in the deliverable. This reference is
not used within the document and thus shall be removed from references clause.
# 2 References {#references-1}
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 36.579-1: \"Mission Critical (MC) services over LTE; Part 1:
Common test environment\".
[3] 3GPP TS 36.579-3: \" Mission Critical (MC) services over LTE; Part 3:
Mission Critical Push To Talk (MCPTT) Server Application test specification\".
[4] 3GPP TS 36.579-4: \" Mission Critical (MC) services over LTE; Part 4: Test
Applicability and Implementation Conformance Statement (ICS).
[5] 3GPP TS 36.579-5: \"Mission Critical (MC) services over LTE; Part 5:
Abstract test suite (ATS)\".
[6] 3GPP TS 36.523-1: \"Evolved Universal Terrestrial Radio Access (E-UTRA)
and Evolved Packet Core (EPC); User Equipment (UE) conformance specification;
Part 1: Protocol conformance specification\".
[7] Void
[8] Void
[9] 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control;
Protocol specification\".
[10] Void
[11] 3GPP TS 24.481: \"Mission Critical Services (MCS) group management;
Protocol specification\".
[12] 3GPP TS 24.482: \"Mission Critical Services (MCS) identity management;
Protocol specification\".
[13] 3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object
(MO)\".
[14] 3GPP TS 24.484: \"Mission Critical Services (MCS) configuration
management; Protocol specification\".
[15] 3GPP TS 33.179: \" Security of Mission Critical Push To Talk (MCPTT) over
LTE \".
[16] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[17] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[18] Void
[19] 3GPP TS 36.509: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Special
conformance testing functions for User Equipment (UE)\".
[20] 3GPP TS 36.508: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access (E-UTRAN); Common Test Environments
for User Equipment (UE) Conformance Testing\".
[21] OpenID Connect 1.0: \"OpenID Connect Core 1.0 incorporating errata set
1\", http://openid.net/specs/openid-connect-core-1_0.html.
[22] 3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework
(AF)\".
[23] Void
[24] 3GPP TS 36.579-2: \"Mission Critical (MC) services over LTE; Part 2:
Mission Critical Push To Talk (MCPTT) User Equipment (UE) Protocol conformance
specification\".
[25] 3GPP TS 36.579-6: \"Mission Critical (MC) services over LTE; Part 6:
Mission Critical Video (MCVideo) User Equipment (UE) Protocol conformance
specification \".
[26] Void
[27] Void
[28] Void
[29] Void
[30] 3GPP TS 33.180: \"Security of the mission critical service\".
[31] 3GPP TS 24.282: \"Mission Critical Data (MCData) signalling control;
Protocol specification\".
[32] 3GPP TS 24.582: \"Mission Critical Data (MCData) media plane control;
Protocol specification\".
[33] 3GPP TS 23.282: \"Functional architecture and information flows to
support Mission Critical Data (MCData); Stage 2\".
[34] 3GPP TS 22.282: \"Mission Critical Data over LTE. Status: Under change
control\".
[35] Void
[36] IETF RFC 4826 (May 2007): \"Extensible Markup Language (XML) Formats for
Representing Resource Lists\".
[37] IETF RFC 4122 (July 2005): \"A Universally Unique IDentifier (UUID) URN
Namespace\".
[38] IETF RFC 2046: \"Multipurpose Internet Mail Extensions (MIME) Part Two:
Media Types\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in 3GPP TR 21.905 [1].
For the purpose of the present document, the following terms given in TS
23.282 [33] apply:
Auto-receive
Conversation identifier
Data stream
FD disposition
MCData client
MCData group
MCData group affiliation
MCData group communication
MCData group de-affiliation
MCData ID
MCData server
MCData service
MCData UE
MCData user
Reception control
Reply identifier
SDS data
SDS disposition
Standalone communication
Transaction identifier
Transmission control
For the purpose of the present document, the following terms given in TS
22.282 [34] apply:
Conversation
Conversation ID
MCData Conversation Hang Time
MCData System
For the purpose of the present document, the following terms given in 3GPP TS
33.180 [30] apply:
Client Server Key (CSK)
Private Call Key (PCK)
Signalling Protection Key (SPK)
XML Protection Key (XPK)
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
None.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
CSK Client-Server Key
DS Data Streaming
ECGI E-UTRAN Cell Global Identification
FD File Distribution
FFS For Further Study
ICS Implementation Conformance Statement
IOPS Isolated E-UTRAN Operation for Public Safety
IUT Implementation Under Test
IXIT Implementation eXtra Information for Testing
MBMS Multimedia Broadcast and Multicast Service
MBSFN Multimedia Broadcast multicast service Single Frequency Network
MC Mission Critical
MCData Mission Critical Data
MCData group ID MCData group Identity
MCPTT Mission Critical Push To Talk
MCS Mission Critical Service
MCVideo Mission Critical Video
MDEA MCData Emergency Alert
MIME Multipurpose Internet Mail Extensions
MONP MC service Off-Network Protocol
NAT Network Address Translation
PCC Policy and Charging Control
PCCB Private Call Call-Back
PCRF Policy and Charging Rules Function
PLMN Public Land Mobile Network
QCI QoS Class Identifier
RTP Real-time Transport Protocol
SAI Service Area Identifier
SDP Session Description Protocol
SDS Short Data Service
SIP Session Initiation Protocol
SPK Signalling Protection Key
SS System Simulator
SSRC Synchronization SouRCe
TGI Temporary MCVideo Group Identity
TMGI Temporary Mobile Group Identity
TP Transmission Point
TP Test Purpose
UE User Equipment
> UM Unacknowledged Mode
URI Uniform Resource Identifier
XPK XML Protection Key
# 4 General
## 4.1 Test methodology
### 4.1.1 Testing of optional functions and procedures
Any function or procedure which is optional, may be subject to a conformance
test if it is implemented in the MCData Client.
A declaration by the MCData Client supplier (to use the Implementation
Conformance Statement (ICS) proforma specified in TS 36.579-4 [4]) is used to
determine whether an optional function/procedure has been implemented.
### 4.1.2 Test interfaces and facilities
Detailed descriptions of the MCData
Client test interfaces and special facilities for testing are provided in 3GPP
TS 36.509 [19].
## 4.2 Implicit testing
For some 3GPP MCData protocol features conformance is not verified explicitly
in the present document. This does not imply that correct functioning of these
features is not essential, but that these are implicitly tested to a
sufficient degree in tests which are not explicitly dedicated to test the
feature.
## 4.3 Repetition of tests
As a general rule, the test cases specified in the present document are highly
reproducible and do not need to be repeated unless otherwise stated.
## 4.4 Handling of differences between conformance requirements in different
releases of cores specifications
The conformance requirements which determine the scope of each test case are
explicitly copy-pasted from relevant core specifications in the especially
dedicated for this clause of each test with the title \'Conformance
requirements\'.
NOTE: When in the copy/pasted text there are references to other
specifications the reference numbers will not match the reference numbers used
in the present document. This approach has been taken in order to allow easy
copy and then search for conformance requirements in those specifications.
When differences between conformance requirements in different releases of the
cores specifications have impact on the Pre-test conditions, Test procedure
sequence or/and the Specific message contents, the Conformance requirements
related to different releases are specified separately with clear indication
of the Release of the spec from which they were copied.
When there is no Release indicated for a conformance requirement text, this
should be understood either as the Conformance requirements in the latest
version of the spec with release = the TC Applicability release (which can be
found in TS 36.579-4 [4], Table 4-1: Applicability of tests and additional
information for testing, column \'Release\'), or, as the Conformance
requirements in the latest version of the spec of the release when the feature
was introduced to the core specs.
## 4.5 Reference conditions
The reference environments used by all signalling and protocol tests is
specified in TS 36.579-1 [2]. Where a test requires an environment that is
different, this will be specified in the test itself.
For all test cases in this document unless specified otherwise the condition
MCDATA applies for all message contents.
## 4.6 Generic setup procedures
A set of basic generic procedures for MCData Client-Server communication are
described in TS 36.579-1 [2]. These procedures will be used in numerous test
cases throughout the present document.
# 5 MCData Client Configuration
## 5.1 Configuration / Authentication / User Authorization / UE Configuration
/ User Profile / Key Generation
##### 5.1.1 Test Purpose (TP) {#test-purpose-tp .H6}
##### (1) {#section .H6}
**with** { UE (MCDATA Client) attached to EPS services }
**ensure that** {
**when** { the MCData User activates an MCData application and requests MCData
initialisation }
**then** { UE (MCDATA Client) performs MCData User Authentication }
}
##### (2) {#section-1 .H6}
**with** { UE (MCDATA Client) user authenticated }
**ensure that** {
**when** { the UE (MCDATA Client) has established a secure HTPP tunnel }
**then** { UE (MCDATA Client) performs key management authorization and
obtains identity management key material }
}
##### (3) {#section-2 .H6}
**with** { UE (MCDATA Client) has obtained identity management key material }
**ensure that** {
**when** { the UE (MCDATA Client) requests user service authorization }
**then** { UE (MCDATA Client) sends a user authorization request to the MCData
Server }
}
##### (4) {#section-3 .H6}
**with** { UE (MCDATA Client) authorized for user services }
**ensure that** {
**when** { the UE (MCDATA Client) requests configuration management
authorization}
**then** { UE (MCDATA Client) requests subscription to multiple documents
simultaneously **and** request the retrieval of the MCData UE Configuration
document, the MCData User Profile Configuration Document and the MCData
Service Configuration Document }
}
##### (5) {#section-4 .H6}
**with** { UE (MCDATA Client) having obtained user configuration data }
**ensure that** {
**when** { the UE (MCDATA Client) requests group management authorization }
**then** { UE (MCDATA Client) receives the group profile including group
traffic keys }
}
##### (6) {#section-5 .H6}
**with** { UE (MCDATA Client) having obtained all required configuration data
}
**ensure that** {
**when** { the UE (MCDATA Client) requires to refresh its service settings }
**then** { UE (MCDATA Client) sends a SIP PUBLISH request }
}
##### 5.1.2 Conformance requirements {#conformance-requirements .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.482 clause 6.2.1 and Annex A.2.1.2, TS 24.484 clauses
4.2.1, 4.2.2.1, 6.2.2, 6.3.1.1, 6.3.2.1, 6.3.2.2, 6.3.3.2.1, 6.3.3.2.2,
6.3.13.2.1 and 6.3.13.2.2, TS 24.481 clauses 6.2.2.2, 6.2.3, 6.3.3.2.1,
6.3.3.2.2 and 6.3.13.2.1, TS 24.282 clauses 7.2.1, 7.2.1A, 7.2.2 and 7.2.3, TS
33.180 clauses 5.1.3.1, 5.3.3, 6.1.2, and Annex D. The following represents a
copy/paste extraction of the requirements relevant to the test purpose; any
references within the copy/paste text should be understood within the scope of
the core spec they have been copied from. Unless otherwise stated these are
Rel-14 requirements.
[TS 24.482, clause 6.2.1]
Upon an indication from the MC service client to initiate MC service user
authentication, the IdM client shall perform the user authentication procedure
according to 3GPP TS 33.180 [17] with the following clarifications:
1) shall establish a TLS tunnel to the authorisation endpoint of the IdM
server as specified in 3GPP TS 33.180 [17] using the configured URL of the
authorisation endpoint of the IdM server as specified in the
\"/\/OnNetwork/AppServerInfo/IDMSAuthEndpoint\" leaf node defined in 3GPP
TS 24.483 [11] and the clarifications in annex A;
2) shall generate an OIDC Authentication Request message as specified in the
OpenID Connect 1.0 [6] and IETF RFC 6749 [5] with the following
clarifications:
a) shall generate an HTTP GET request method according to IETF RFC 2616 [4];
b) shall include the configured parameter IdM client id as the client_id
parameter specified in 3GPP TS 33.180 [17] in the query component of the
authorization endpoint\'s URI using the \"application/x-www-form-urlencoded\"
format as specified in W3C.REC-html401-19991224 [7]; and
NOTE 1: The configuration of client_id is specified in 3GPP TS 24.483 [11].
c) shall include the remaining required parameters as specified in 3GPP TS
33.180 [17] in the query component of the authorization endpoint\'s URI using
the \"application/x-www-form-urlencoded\" format as specified in W3C.REC-
html401-19991224 [7]; and
3) shall send the HTTP GET request method towards the IdM server.
NOTE 2: The OpenID Connect 1.0 [6] specification allows for an alternative
mechanism for sending the OIDC Authentication request message using an HTTP
POST request method which can be used in place of steps 1, 2, and 3 above.
Upon receipt of an HTTP 200 (OK) response from the IdM server, the IdM client:
1) shall prompt the MC service user for their username and password;
NOTE 3: Other types of authentication are supported and are not defined by the
OIDC specifications. 3GPP TS 33.180 [17] has defined username and password as
a mandatory authentication method to be supported, hence a procedure to
realize that method is included here.
2) shall generate an HTTP POST request method containing the MC service
user\'s username and password; and
3) shall send the HTTP POST request method towards the IdM server.
Upon receipt of an OIDC Authentication Response message, the IdM client:
1) shall establish a TLS tunnel to the token endpoint of the IdM server as
specified in 3GPP TS 33.180 [17] using the configured URL of the token
endpoint of the IdM server as specified in the
\"/\/OnNetwork/AppServerInfo/IDMSTokenEndpoint\" leaf node defined in 3GPP
TS 24.483 [11] and the clarifications in annex A;
2) shall generate an OIDC Token Request message as specified in OpenID Connect
1.0 [6] and IETF RFC 6749 [5] with the following clarifications:
a) shall generate an HTTP POST request method according to IETF RFC 2616 [4];
and
b) shall include the grant_type parameter set to a value of
\"authorization_code\" and the other required parameters in the entity body of
the HTTP POST request method using the using the \"application/x-www-form-
urlencoded\" format as specified in 3GPP TS 33.180 [17]; and
3) shall send the HTTP POST request method towards the IdM server.
Upon receipt of an OIDC Token Response message, the IdM client:
1) shall validate the id_token, access_token and refresh token in the received
OIDC Token Response message as specified in the OpenID Connect 1.0 [6]
specification; and
2) shall provide the id_token and access_token in the received OIDC Token
Response message to the MC service client.
NOTE 4: The method in which the IdM client provides the id_token and
access_token to the MC service client is implementation specific.
The MC UE may repeat the entire procedure in this clause as needed to obtain
the necessary authorisation tokens for the MC service clients, depending on
the scope parameter in the Authentication Request message as specified in 3GPP
TS 33.180 [17].
[TS 24.482, Annex A.2.1.2]
The HTTP client in the UE shall support the client role defined in IETF RFC
2818 [10].
The HTTP client in the UE shall support transport layer security (TLS) as
specified in 3GPP TS 33.180 [17].
The HTTP client in the UE is configured with the following parameters:
1) a home HTTP proxy FQDN;
2) a home HTTP proxy port;
3) a TLS tunnel authentication method. The TLS tunnel authentication method
parameter is set to one of the following:
a) one-way authentication of the HTTP proxy based on the server certificate;
b) mutual authentication based on certificates; and
c) mutual authentication based on pre-shared key;
as specified in 3GPP TS 33.180 [17];
4) if the TLS tunnel authentication method is the mutual authentication based
on certificates:
a) TLS tunnel authentication X.509 certificate; and
5) if the TLS tunnel authentication method is the mutual authentication based
on pre-shared key;
a) TLS tunnel authentication pre-shared key.
The HTTP client in the UE shall establish a TCP connection towards the home
HTTP proxy FQDN and the home HTTP proxy port, unless the specific TCP
connection is to be used for the IdM client to IdM server procedures described
in clause 6.2 and subclause 6.3 in the present document, in which case the
HTTP client shall establish a TCP connection towards the IdM server.
The HTTP client in the UE shall establish a TLS tunnel via the TCP connection
as specified in 3GPP TS 33.180 [17]. When establishing the TLS tunnel, the
HTTP client in the UE shall act as a TLS client and the UE shall perform the
TLS tunnel authentication using the TLS authentication method indicated by the
TLS tunnel authentication method parameter according to 3GPP TS 33.180 [17].
The UE shall use the configured TLS tunnel authentication X.509 certificate
and the configured TLS tunnel authentication pre-shared key when applicable
for the used TLS authentication method. In order to prevent man-in-the-middle
attacks, the HTTP client in the UE shall check the home HTTP proxy FQDN
against the server\'s identity as presented in the received server\'s
certificate message if the TCP connection terminates on the HTTP proxy. The
HTTP client in the UE shall not check the portion of dereferenced HTTP URL
against the server\'s identity as presented in the received server\'s
certificate message if the TCP connection terminates on the HTTP proxy, but
shall do so if the TCP connection terminates on the IdM server.
NOTE: The TLS tunnel can be terminated in the HTTP proxy (rather than in the
HTTP server providing the dereferenced HTTP URL).
The HTTP client in the UE shall send and receive all HTTP messages via the TLS
tunnel.
If the HTTP client in the UE has an access token of the \"bearer\" token type
as specified in IETF RFC 6750 [14], the HTTP client in the UE shall include an
Authorization header field with the \"Bearer\" authentication scheme as
specified in IETF RFC 6750 [14] in HTTP requests.
[TS 33.180, Annex D.1]
This annex specifies the key management procedures between the KMS and the key
management client that allows keys to be provisioned to the key management
client based on an identity. It describes the requests and responses for the
authorization following provisioning messages:
\- KMS Initialize.
\- KMS KeyProvision.
\- KMS CertCache.
All KMS communications are made via HTTPS. The key management client is
provisioned via XML content in the KMS\'s response. The XML content is
designed to be extendable to allow KMS/client providers to add further
information in the XML. Where the interface is extended, a different XML
namespace should be used (so that may be ignored by non-compatible clients).
It is assumed that transmissions between the KMS and the key management client
are secure and that the KMS has authenticated the identity of the key
management client.
Additionally, to allow the transmission of key material securely between a
secure element within the KMS and a secure element within the key management
client, a security extension is defined which allows messages to be signed and
key material to be encrypted using a shared Transport Key (TrK).
[TS 33.180, clause 5.1.3.1]
This clause expands on the MCX user service authorization step shown in figure
5.1.1-1 step C.
MCX User Service Authorization is the function that validates whether or not a
MCX user has the authority to access certain MCX services. In order to gain
access to MCX services, the MCX client in the UE presents an access token
(acquired during user authentication as described in subclause 5.1.2) to each
service of interest (i.e. Key Management, MCX server, Configuration
Management, Group Management, etc.). If the access token is valid, then the
user is granted the use of that service. Figure 5.1.3.1-1 shows the flow for
user authorization which covers key management authorization, MCX user service
authorization, configuration management authorization, and group management
authorization.
NOTE: All HTTP traffic between the UE and HTTP proxy, and all HTTP traffic
between the UE and KMS (if not going through the HTTP proxy) is protected
using HTTPS.
For key management authorization, the KM client in the UE presents an access
token to the KMS over HTTP. The KMS validates the access token and if
successful, provides one or more sets of user specific key material back to
the UE KM client based on the MC service ID(s) present in the access token
(MCPTT ID, MCVideo ID and/or MCData ID). User specific key material includes
identity based key information for media and signalling protection. This key
management authorisation may be repeated for each KM service the user is
authorised to use (MCPTT, MCVideo, MCData).
For MCPTT user service authorization, the MCPTT client in the UE presents an
access token to the MCPTT server over SIP. The MCPTT server validates the
access token and if successful, authorizes the user for full MCPTT services
and sends an acknowledgement back to the MCPTT client. The MCPTT server then
maps and maintains the IMPU to MCPTT ID association. The MCPTT ID to IMPU
association shall only be known to the application layer. The SIP message used
to convey the access token from the MCPTT client to the MCPTT server may be
either a SIP REGISTER or SIP PUBLISH message.
For MCVideo service authorization, the MCVideo client in the UE presents an
access token to the MCVideo server over SIP. The MCVideo server validates the
access token and if successful, authorizes the user for full MCVideo services
and sends an acknowledgement back to the MCVideo client. The MCVideo server
then maps and maintains the IMPU to MCVideo ID association. The MCVideo ID to
IMPU association shall only be known to the application layer. The SIP message
used to convey the access token from the MCVideo client to the MCVideo server
may be either a SIP REGISTER or SIP PUBLISH message.
For MCData user service authorization, the MCData client in the UE presents an
access token to the MCData server over SIP. The MCData server validates the
access token and if successful, authorizes the user for full MCData services
and sends an acknowledgement back to the MCData client. The MCData server then
maps and maintains the IMPU to MCData ID association. The MCData ID to IMPU
association shall only be known to the application layer. The SIP message used
to convey the access token from the MCData client to the MCData server may be
either a SIP REGISTER or SIP PUBLISH message.
The UE can now perform configuration management authorization and download the
user profile for the service(s) (MCPTT, MCVideo, MCData). Following the flow
described in subclause 10.1.4.3 of 3GPP TS 23.280 [36] \" MC service user
obtains the MC service user profile(s) from the network \", the Configuration
Management (CM) client in the UE sends an access token in the user profile
query to the Configuration Management server over HTTP. The CM server receives
the request and validates the access token, and if valid, the CM server uses
the identity from the access token (MCPTT ID, MCVideo ID, MCData ID) to obtain
the user profile from the MCX user database. The CM server then sends the user
profile back to the CM client over HTTP. This configuration management
authorisation may be repeated for each CM service the user is authorised to
use (MCPTT, MCVideo, MCData).
Upon receiving each user profile, the Group Management (GM) client in the UE
can now perform group management authorization. The GM client obtains the
user\'s group membership information from the user profile, and following the
flow shown in clause 10.1.5.2 of 3GPP TS 23.280 [36] \"Retrieve group
configurations at the group management client\", the Group Management (GM)
client in the UE sends an access token in the Get group configuration request
to the host GM server of the group membership over HTTP. The GM server
validates the access token, and if valid, completes the flow. As part of group
management authorization, group key information is provided as per subclause
5.7 of the present document. This group management authorisation may be
repeated for each GM service the user is authorised to use (MCPTT, MCVideo,
MCData).
Figure 5.1.3.1-1: MCX user service authorization
The user authorization procedure in Step C of Figure 5.1.1-1 is further
detailed into 5 sub steps that comprise the MCX user service authorization
process:
Step C-1: If not already done, establish a secure HTTP tunnel using HTTPS
between the MCX UE and MCX proxy server. Subsequent HTTP messaging makes use
of this tunnel (with the possible exception of the KMS client to KMS server
interface).
Step C-2: The KMS client in the UE presents an access token to the KMS over
HTTP. The KMS authorizes the user for key management services based upon the
MC service ID(s) provided and replies to the client with identity specific key
information. This step may be repeated to authorise the user with additional
KM services (MCPTT, MCVideo, MCData) as necessary.
Step C-3: The MCX client in the UE presents an access token to the MCX server
over SIP as defined in clause 5.1.3.2 of the present document. This step may
be repeated to authorise the user with additional MCX services (MCPTT,
MCVideo, MCData) as necessary.
Step C-4: The CM client in the UE follows the \"MCX user obtains the user
profile (UE initiated)\" flow from clause 10.1.4.3 of 3GPP TS 23.280 [36],
presenting an access token in the Get MCX user profile request over HTTP. If
the token is valid, then the CM server authorizes the user for configuration
management services. Completion of this step results in the CM server
providing the user\'s profile to the CM client. This step may be repeated as
necessary to obtain the user profile for additional services (MCPTT, MCVideo,
or MCData).
Step C-5: The GM client in the UE follows the \"Retrieve group configurations
at the group management client\" flow as shown in clause 10.1.5.2 of 3GPP TS
23.280 [36], presenting an access token in the Get group configuration request
over HTTP. If the token is valid, the GMS authorizes the user for group
management services. Completion of this step results in the GMS sending the
user\'s group policy information and group key information to the GM client.
This step may be repeated to authorise the user for additional group services
(MCPTT, MCVideo, MCData) as necessary.
[TS 33.180, clause 5.3.3]
The procedure for the provision of identity-specific key material when the
HTTP proxy is supported between the KMS and the KMS client is described in
figure 5.3.3-1. The procedure is the same whether the key management client in
the MC UE, an MCX Server or a Group Management Server is making the request.
Figure 5.3.3-1: Provisioning of key material via the HTTP proxy
The procedure in figure 5.3.3-1 is now described step-by-step.
0) The key management client establishes a connection to the KMS. As with
other elements in the Common Services Core, the connection is routed via, and
secured by, the HTTP Proxy. The message flow below is within this secure
connection.
NOTE: Additionally, the connection between the KMS and the HTTP Proxy is
secured according to clause 6.1.
1) The key management client makes a request for user key material from the
KMS. The request contains an access token to authenticate the user as defined
in clause 5.1. There are three types of request (as defined in Annex D):
a) KMSInit Request. This request is the first request sent to the KMS to setup
the user.
b) KMSKeyProv Request: This request is to obtain new key material from the
KMS. The request may contain details of a specific identity (e.g. MCPTT ID)
required for key management, and may contain a specific time for which the key
material is required.
c) KMSCertCache Request: This request is to obtain external KMS certificates
associated with external security domains (managed by another KMS). The
request may contain details of the latest version of the cache received by the
client.
2) The KMS provides a response based upon the authenticated user and the
user\'s request. For public safety use, the key material itself shall be
encrypted using a 256-bit transport key (TrK). The response may also be signed
by the TrK or the InK. The TrK and InK are initially distributed via an out-
of-band mechanism along with their 32-bit identifiers, the TrK-ID and InK-ID,
respectively. The responses are:
a) KMSInit Response. This response contains domain parameters and optionally,
a new TrK and/or a new InK.
b) KMSKeyProv Response: This response provides new key material to the user
and optionally, a new TrK.
c) KMSCertCache Response: This response contains new or updated home KMS
certificates and/or external KMS certificates required by the user for
communications with external security domains.
The procedure for the provisioning of identity-specific key material when the
HTTP proxy is not used between the KMS and the KMS client is as described in
Figure 5.3.3-2.
Figure 5.3.3-2: Provisioning of key material without a proxy
The procedure in Figure 5.3.3-2 is now described step-by-step:
0) The key management client establishes a direct HTTPS connection to the KMS.
The following message flow is within this secure connection.
1) The key management client makes a request to the KMS. The same requests can
be made as defined above with a proxy.
2) The KMS provides a response based upon the authenticated user and the
user\'s request. Optionally, the key material itself may also be encrypted
using a 256-bit transport key (TrK). The response may also be signed using the
TrK or the InK. The TrK and InK are initially distributed via an out-of-band
mechanism along with their 32-bit identifiers (TrK-ID and InK-ID
respectively).
As a result of this procedure, the key management client has securely obtained
key material for use within the MC system.
[TS 24.484, clause 4.2.1]
Upon start up the MC UE bootstraps the required information (e.g. FQDN or IP
address) to locate the configuration management server for configuration of
the MCS UE initial configuration management object (MO) and the default MCPTT
user profile configuration management object (MO).
In order to obtain access to MC services the UE needs to obtain configuration
data either online via the network or offline using some external device (e.g.
a laptop). As part of the bootstrap process the MC UE needs to discover
either:
1\. the online configuration management server in the network that configures
the MCS UE initial configuration MO and the default MCS user profile
configuration MO(s), then the MC UE:
a) using the URI of the configuration management server obtained from the MCS
UE initial configuration MO, obtains for each MCS that is enabled:
\- the appropriateMCS UE configuration document;
\- the appropriateMCS user profile configuration document; and
\- the appropriateMC service configuration document; and
b) using the URI of the group management server obtained from the MCS UE
initial configuration MO obtain the MCS group document; or
2\. the:
a) offline configuration management server on the external device that
configures the MC UE with the:
\- MCS UE initial configuration MO;
\- appropriate MCS UE configuration MO(s);
\- appropriate MCS user profile MO(s); and
\- appropriate MCS service configuration MO(s); and
b) offline group management server on the external device that configures the
MC UE with the MCS group MO.
The mechanism to discover the online or offline configuration management
server is dependent on the protocol used to manage and configure the MO and is
out of scope of the present document.
[TS 24.484, clause 4.2.2.1]
The format of the MCS UE initial configuration MO downloaded to the MC UE
during online configuration is defined in 3GPP TS 24.483 [4].
The format of the MCS group document downloaded to the MC UE during online
configuration is defined in 3GPP TS 24.481 [5].
Figure 4.2.2-1 shows the MCPTT UE online configuration time sequence.
Figure 4.2.2-1 MC UE online configuration time sequence
If the MCS UE initial configuration MO has changed from the version stored in
the MC UE, the updated MC UE initial configuration MO is downloaded to the
MCPTT UE.
If the MCS UE initial configuration MO contains a \
element and the identified default MCS user profile configuration MO(s) have
changed from the version stored in the MC UE, the updated default MCS user
profile configuration MO(s) are downloaded to the MC UE.
NOTE 1: The default MCS user profile configuration MO(s) define the default
identity(s) for the enabled mission critical service(s) and the profile of
services available to the user (e.g. emergency MCPTT services) prior to user
authentication.
The MC UE contacts the identity management server using the HTTPS URI stored
in the MCS UE initial configuration MO and performs MC User authentication as
specified in 3GPP TS 24.482 [6].
The MC UE, using the identities obtained during MC user authentication,
subscribes to the MCS UE configuration document, the MCS user profile
configuration document and the MCS service configuration document for each
enabled MCS using the procedure for subscribing to multiple documents
simultaneously using the subscription proxy function specified in subclause
6.3.13.2.2(i.e., the CMS acts as a Subscription Proxy) and subscribes to the
MCS group document using the procedure specified in 3GPP TS 24.481 [5]. If
these documents have been updated since the current version stored in the MC
UE, then the MC UE will receive a SIP NOTIFY request with an XCAP Diff
document (see IETF RFC 5875 [11]), in which case the CMC updates its local
document copies . Retrieval by the MC UE using the notified HTTPS URI of the
MCS group document is performed as specified in 3GPP TS 24.481 [5].
NOTE 2: The MC UE can be notified of changes to an configuration documents at
any time while using the MCS.
[TS 24.484, clause 6.2.2]
The CMC shall send the HTTP request over TLS connection as specified for the
HTTP client in the UE in annex A of 3GPP TS 24.482 [6].
[TS 24.484, clause 6.3.1.1]
A CMC shall support subclause 6.1.1 \"_Document Management_ \" of OMA OMA-TS-
XDM_Core-V2_1 [2] and subclause 6.3.13.2.2 for subscribing to configuration
management documents.
[TS 24.484, clause 6.3.3.2.1]
In order to retrieve a configuration management document, a GC shall send an
HTTP GET request with the Request URI that references the document to be
updated to the network according to procedures specified in IETF RFC 4825 [14]
\"_Retrieve a Document_ \".
[TS 24.484, clause 6.3.3.2.2]
In order to retrieve a configuration management document, a CMC shall perform
the procedures in subclause 6.3.3.2.1 specified for GC. The CMC shall set the
Request-URI of the HTTP GET request to the \"CMSXCAPRootURI\" configured as
per 3GPP TS 24.483 [4] and include the \"auid\" as per the appropriate
application usage in clause 7.
Subclause 7.5 specifies which configuration management documents can be
retrieved from the CMS over the CSC-4 reference point.
[TS 24.484, clause 6.3.13.2.1]
This procedure enables the CMC to subscribe to notification of changes of one
or more configuration management documents defined.
This procedure enables the MCS server to subscribe to notification of changes
of the MCPTT service configuration document.
[TS 24.484, clause 6.3.13.2.2]
In order to subscribe to Configuration management document, a CMC shall send
an initial SIP SUBSCRIBE request to the network according to the UE
originating procedures specified in 3GPP TS 24.229 [22] and IETF RFC 5875
[11]. In the initial SIP SUBSCRIBE request, the CMC:
...
b) if subscription to multiple documents simultaneously using the subscription
proxy function is used:
1) shall include an application/resource-lists+xml MIME body. In the
application/resource-lists+xml MIME body, the CMC shall include one \
element for each document or element to be subscribed to, such that the
\"uri\" attribute of the \ element contains a relative path reference:
A) with the base URI being equal to the \"CMSXCAPRootURI\" configured in the
CMC as per 3GPP TS 24.483 [4]; and
B) with the \"auid\" parameter set to the appropriate application usage
identifying a configuration management document;
2) shall set the Request-URI to the configured public service identity for
performing subscription proxy function of the CMS;
c) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to the value of the access token received
during authentication procedure as described in 3GPP TS 24.482 [6];
d) if identity hiding is required:
1) shall perform the confidentiality protection procedures and integrity
protection procedures defined in 3GPP TS 24.379 [9] for MCPTT client on the
application/vnd.3gpp.mcptt-info+xml MIME body and on the application/resource-
lists+xml MIME body; and
2) shall include an application/mikey MIME body with the CSK as specified in
3GPP TS 24.379 [9];
e) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [22]), in a P-Preferred-Service header
field according to IETF RFC 6050 [23]; and
f) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field.
Upon receiving a SIP NOTIFY request associated with a subscription created as
result of the sent initial SIP SUBSCRIBE request:
1) if identity hiding is required, the CMC shall perform the confidentiality
protection procedures and integrity protection procedures defined in 3GPP TS
24.379 [9] for MC client; and
2) shall handle the SIP NOTIFY request according to IETF RFC 5875 [11].
In order to re-subscribe to notification of changes of a modified list of one
or more configuration management documents; a CMC shall send a SIP re-
SUBSCRIBE request to the network according to the UE originating procedures
specified in 3GPP TS 24.229 [22] and IETF RFC 5875 [11]. In the SIP re-
SUBSCRIBE request, the CMC:
a) if direct subscription is used, shall set the Request URI to a SIP URI
containing:
1) the base URI being equal to the \"CMSXCAPRootURI\" configured in the CMC as
per 3GPP TS 24.483 [4]; and
2) the \"auid\" parameter set to the appropriate application usage identifying
a configuration management document as described in clause 7;
b) if subscription to multiple documents simultaneously using the subscription
proxy function is used:
1) shall include an application/resource-lists+xml MIME body. In the
application/resource-lists+xml MIME body, the CMC shall include one \
element for each document or element to be subscribed to, such that the
\"uri\" attribute of the \ element contains a relative path reference:
A) with the base URI being equal to the \"CMSXCAPRootURI\" configured in the
CMC as per 3GPP TS 24.483 [4]; and
B) with the \"auid\" parameter set to the appropriate application usage
identifying a configuration management document as described in clause 7;
c) if identity hiding is required, shall perform the confidentiality
protection procedures and integrity protection procedures defined in 3GPP TS
24.379 [9] for MC client on the application/vnd.3gpp.mcptt-info+xml MIME body
and on the application/resource-lists+xml MIME body using the CSK included in
the initial SIP SUBSCRIBE request; and
d) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field.
[TS 24.481, clauses 6.2.2.2]
In order to address an existing group document defining a group ID known by
GC, the GC shall set the Request-URI of an HTTP request to a XCAP URI
identifying a group document addressed by a group ID as described in subclause
7.2.10.2, where the group ID is set to the group ID known by GC and where the
XCAP root URI is the XCAP root URI configured in the GC.
[TS 24.481, clauses 6.2.3]
The GMC shall send the HTTP request over a TLS connection as specified for the
HTTP client in the UE in annex A of 3GPP TS 24.482 [10].
The GMC shall perform the procedures in subclause 6.2.2 specified for GC.
[TS 24.481, clauses 6.3.3.2.1]
In order to retrieve a group document, a GC shall send an HTTP GET request
with the Request URI that references the document to be retrieved to the
network according to procedures specified in IETF RFC 4825 [22] \"_Fetch a
Document_ \".
[TS 24.481, clauses 6.3.3.2.2]
In order to retrieve a group document, a GMC shall perform the procedures in
subclause 6.3.3.2.1 specified for GC.
[TS 24.481, clauses 6.3.13.2.1]
In order to subscribe to notification of changes of:
a) one or more MCData group documents of MCData groups identified by MCData
group IDs;
...
a GMC shall send an initial SIP SUBSCRIBE request to the network according to
the UE originating procedures specified in 3GPP TS 24.229 [12] and IETF RFC
5875 [13]. In the initial SIP SUBSCRIBE request, the GMC:
a) shall include an application/resource-lists+xml MIME body. In the
application/resource-lists+xml MIME body, the GMC shall include one \
element for each document or element to be subscribed to, such that the
\"uri\" attribute of the \ element:
1) contains a relative path reference:
A) with the base URI being equal to the XCAP root URI configured in the GMC;
and
B) identifying a group document addressed by a group ID as described in
subclause 7.2.10.2 where the group ID is set to the MCData group ID; or
...
b) shall set the Request-URI to the configured public service identity for
performing subscription proxy function of the GMS;
c) shall include an application/vnd.3gpp.mcptt-info+xml MIME body with the
\ element set to the value of the access token received
during authentication procedure as described in 3GPP TS 24.482 [49];
d) if identity hiding is required:
1) shall perform the confidentiality protection procedures and integrity
protection procedures defined in 3GPP TS 24.379 [5] for MCPTT client on the
application/vnd.3gpp.mcptt-info+xml MIME body and on the application/resource-
lists+xml MIME body; and
2) shall include an application/mikey MIME body with the CSK as specified in
3GPP TS 24.379 [5];
e) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcptt\"
(coded as specified in 3GPP TS 24.229 [12]), in a P-Preferred-Service header
field according to IETF RFC 6050 [14]; and
f) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcptt\" in the Contact header field.
Upon receiving a SIP NOTIFY request associated with a subscription created as
result of the sent initial SIP SUBSCRIBE request:
1) if identity hiding is required, the GMC shall perform the confidentiality
protection procedures and integrity protection procedures defined in 3GPP TS
24.379 [5] for MCPTT client; and
2) shall handle the SIP NOTIFY request according to IETF RFC 5875 [13].
[TS 24.282, clause 7.2.1]
When the MCData client performs SIP registration for service authorisation the
MCData client shall perform the registration procedures as specified in 3GPP
TS 24.229 [5].
The MCData client shall include the following media feature tags in the
Contact header field of the SIP REGISTER request:
1) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata\";
2) if SDS is supported then:
a) the g.3gpp.mcdata.sds media feature tag; and
b) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"; and
3) if FD service is supported then:
a) the g.3gpp.mcdata.fd media feature tag; and
b) the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\".
NOTE 1: If the MCData client logs off from the MCData service but the MCData
UE remains registered the MCData UE performs a re-registration as specified in
3GPP TS 24.229 [5] without the supported g.3gpp.mcdata media feature tags and
the g.3gpp.icsi-ref media feature tag containing the supported MCData service
ICSIs in the Contact header field of the SIP REGISTER request.
If the MCData client, upon performing SIP registration:
1) has successfully finished the user authentication procedure as described in
3GPP TS 24.482 [24];
2) has available an access-token;
3) based on implementation decides to use SIP REGISTER for service
authorization;
4) confidentiality protection is disabled as specified in subclause 6.5.2.3.1;
and
5) integrity protection is disabled as specified in subclause 6.5.3.3.1;
then the MCData client shall include an application/vnd.3gpp.mcdata-info+xml
MIME body as defined in Annex F.1 with the \ element set
to the value of the access token received during the user authentication
procedures, in the SIP REGISTER request.
NOTE 2: the access-token contains the MCData ID of the user.
If the MCData client, upon performing SIP registration:
1) has successfully finished the user authentication procedure as described in
3GPP TS 24.482 [24];
2) has an available access-token;
3) based on implementation decides to use SIP REGISTER for service
authorization; and
4) either confidentiality protection is enabled as specified in subclause
6.5.2.3.1 or integrity protection is enabled as specified in subclause
6.5.3.3.1;
then the MCData client:
1) shall include an application/mikey MIME body with the CSK as MIKEY-SAKKE
I_MESSAGE as specified in 3GPP TS 33.180 [26] in the body of the SIP REGISTER
request;
2) if confidentiality protection is enabled as specified in subclause
6.5.2.3.1, shall encrypt the received access-token using the CSK and shall
include in the body of the SIP REGISTER request, an
application/vnd.3gpp.mcdata-info+xml MIME body with the \
element set to the encrypted access-token, as specified in subclause
6.5.3.3.1;
3) if confidentiality protection is disabled as specified in subclause
6.5.2.3.1, shall include an application/vnd.3gpp.mcdata-info+xml MIME body as
defined in Annex F.1 with the \ element set to the value
of the access token received during the user authentication procedures; and
4) if integrity protection is enabled as specified in subclause 6.5.3.3.1,
shall use the CSK to integrity protect the application/vnd.3gpp.mcdata-
info+xml MIME body by following the procedures in subclause 6.6.3.3.3.
[TS 24.282, clause 7.2.1A]
This procedure is only referenced from other procedures.
When populating the SIP PUBLISH request, the MCData client shall:
1) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user;
2) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7];
3) shall set the Event header field to the \"poc-settings\" value; and
4) shall set the Expires header field according to IETF RFC 3903 [34], to
4294967295, if the MCData user is not removing the MCData service settings,
otherwise to remove the MCData service settings the MCData client shall set
the Expires header field to zero.
NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
for Expires header field in IETF RFC 3261 [4].
NOTE 2: The expiration timer of the MCData client service settings is only
applicable for the MCData client service settings from the MCData client that
matches the Instance Identifier URN. The expiration timer of MCData user
service settings is also updated in the MCData server if expiration timer of
MCData client service settings is updated in the MCData server.
NOTE 3: Removing the MCData service settings by setting the Expires header
field to zero, logs off the MCData client from the MCData service.
[TS 24.282, clause 7.2.2]
If based on implementation the MCData client decides to use SIP PUBLISH for
MCData server settings to also perform service authorization and
1) has successfully finished the user authentication procedure as described in
3GPP TS 24.482 [24]; and
2) has available an access-token;
then the MCData client:
1) shall perform the procedures in subclause 7.2.1A;
2) if confidentiality protection is disabled as specified in subclause
6.5.2.3.1 and integrity protection is disabled, shall include in the body of
the SIP PUBLISH request, an application/vnd.3gpp.mcdata-info+xml MIME body as
specified in Annex F.1 with the \ element set to the
value of the access token received during the user authentication procedures;
3) if either confidentiality protection is enabled as specified in subclause
6.5.2.3.1 or integrity protection is enabled as specified in subclause
6.5.3.3.1 shall include an application/mikey MIME body with the CSK as MIKEY-
SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [26] in the body of the SIP
PUBLISH request;
4) if confidentiality protection is enabled as specified in subclause
6.5.2.3.1, shall include in the body of the SIP PUBLISH request an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to the received access-token
encrypted using the CSK, as specified in subclause 6.5.2.3.3; and
b) the \ element set to the encrypted MCData client ID of
the originating MCData client, as specified in subclause 6.5.2.3.3;
5) if confidentiality protection is disabled as specified in subclause
6.5.2.3.1, shall include in the body of the SIP PUBLISH request, an
application/vnd.3gpp.mcdata-info+xml MIME body as specified in Annex F.1 with:
a) the \ element set to the value of the access token
received during the user authentication procedures in the body of the SIP
PUBLISH request; and
b) the \ element set to the value of the MCData client ID of
the originating MCData client;
6) shall include an application/poc-settings+xml MIME body as defined in 3GPP
TS 24.379 [10] containing:
a) the \ element set to the value contained in
the \"user-profile-index\" attribute of the selected MCData user profile as
defined in 3GPP TS 24.484 [12]; and
7) if integrity protection is enabled as specified in subclause 6.5.3.3.1,
shall use the CSK to integrity protect the application/vnd.3gpp.mcdata-
info+xml MIME body and application/poc-settings+xml MIME body by following the
procedures in subclause 6.5.3.3.3.
The MCData client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [5].
[TS 24.282, clause 7.2.3]
To set, update, remove or refresh the MCData service settings, the MCData
client shall generate a SIP PUBLISH request according 3GPP TS 24.229 [5], IETF
RFC 3903 [34] and IETF RFC 4354 [35]. In the SIP PUBLISH request, the MCData
client:
1) shall perform the procedures in subclause 7.2.1A;
2) if confidentiality protection is enabled as specified in subclause
6.5.2.3.1, shall include in the body of the SIP PUBLISH request, an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to the targeted MCData ID encrypted
using the CSK, as specified in subclause 6.5.2.3.3; and
b) the \ element set to the encrypted MCData client ID of
the originating MCData client, as specified in subclause 6.5.2.3.3;
3) if confidentiality protection is disabled as specified in subclause
6.5.2.3.1, shall include an application/vnd.3gpp.mcdata-info+xml MIME body as
specified in Annex F.1 with:
a) the \ set to the cleartext targeted MCData ID; and
b) the \ element set to the value of the MCData client ID of
the originating MCData client;
4) shall include an application/poc-settings+xml MIME body as defined in 3GPP
TS 24.379 [10] containing:
a) the \ element set to the value contained in
the \"user-profile-index\" attribute of the selected MCData user profile as
defined in 3GPP TS 24.484 [12]; and
5) if integrity protection is enabled as specified in subclause 6.5.3.3.1,
shall use the CSK to integrity protect the application/vnd.3gpp.mcdata-
info+xml MIME body and application/poc-settings+xml MIME body by following the
procedures in subclause 6.5.3.3.3.
The MCData client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [5].
On receiving the SIP 200 (OK) response to the SIP PUBLISH request the MCData
client may indicate to the MCData User the successful communication of the
MCData service settings to the MCData server.
[TS 33.180, clause 6.1.2]
The support of Transport Layer Security (TLS) on HTTP-1 is mandatory. The
profile for TLS implementation and usage shall follow the provisions given in
3GPP TS 33.310 [5], annex E.
If the PSK TLS based authentication mechanism is supported, the HTTP client in
the MC UE and the HTTP Proxy shall support the TLS version, PSK ciphersuites
and TLS Extensions as specified in the TLS profile given in 3GPP TS 33.310
[5], annex E. The usage of pre-shared key ciphersuites for TLS is specified in
the TLS profile given in 3GPP TS 33.310 [5], annex E.
##### 5.1.3 Test description {#test-description .H6}
##### 5.1.3.1 Pre-test conditions {#pre-test-conditions .H6}
Same pre-test conditions as for MCPTT test case 5.1 (TS 36.579-2 [24]) with
the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\".
##### 5.1.3.2 Test procedure sequence {#test-procedure-sequence .H6}
Same test procedure sequence as for MCPTT test case 5.1 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\".
##### 5.1.3.3 Specific message contents {#specific-message-contents .H6}
Same specific message contents as for MCPTT test case 5.1 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\".
\- Condition MCDATA is used for all messages.
5.2 Configuration / Group Creation / Group ReGroup Creation / Group ReGroup
Teardown
##### 5.2.1 Test Purpose (TP) {#test-purpose-tp-1 .H6}
##### (1) {#section-6 .H6}
**with** { UE (MCData Client) attached to EPS services }
ensure that {
**when** { the UE (MCData Client) requests formation of a new MCData group }
**then** { on successful group creation the UE (MCData Client) has access to
the new group }
}
##### (2) {#section-7 .H6}
**with** { UE (MCData Client) having access to at least two MCData groups }
ensure that {
**when** { the UE (MCData Client) requests the groups to be combined }
**then** { on successful group regrouping the UE (MCData Client) has access to
the temporary group }
}
##### (3) {#section-8 .H6}
**with** { UE (MCData Client) having access to a temporary group }
ensure that {
**when** { the UE (MCData Client) requests temporary group tear down }
**then** { on successful group tear down the UE (MCData Client) removes the
temporary group }
}
##### 5.2.2 Conformance requirements {#conformance-requirements-1 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.481 clauses 6.3.2.2.1, 6.3.2.2.2, 6.3.14.1, 6.3.14.2,
6.3.15.1 and 6.3.15.2; TS 33.180, clause 7.3.2. The following represents a
copy/paste extraction of the requirements relevant to the test purpose; any
references within the copy/paste text should be understood within the scope of
the core spec they have been copied from. Unless otherwise stated these are
Rel-14 requirements.
[TS 24.481, clause 6.3.2.2.1]
In order to create a group document, a GC shall create an XML document of the
application usage specified in subclause 7.2.1 and shall send the XML document
to the network according to procedures specified in IETF RFC 4825 [22]
\"_Create or Replace a Document_ \". The GC shall set the Request-URI of the
HTTP PUT request to an XCAP URI in users tree where the XUI is set to a group
creation XUI configuration parameter.
[TS 24.481, clause 6.3.2.2.2]
In order to create a group document, a GMC shall perform the procedures in
subclause 6.3.2.2.1 specified for GC.
[TS 24.481, clause 6.3.14.1]
This procedure enables a GMC to initiate creation of a temporary MCS group by
combining MCS groups.
> NOTE: The temporary MCS group formation procedure does not ensure that the
> MCSs of the temporary MCS group are the same as MCSs of each constituent MCS
> group of the temporary MCS group.
[TS 24.481, clause 6.3.14.2]
In order to form a temporary MCS group, a GMC shall send a HTTP POST request
according to procedures specified in IETF RFC 2616 [21] and subclause 6.2.3.
In the HTTP POST request, the GMC:
> a) shall set the Request-URI to an XCAP URI:
>
> 1) in users tree where the XUI is set to a group creation XUI configuration
> parameter; and
>
> 2) with the document selector identifying the temporary MCS group to be
> created; and
>
> b) shall include an application/vnd.3gpp.GMOP+xml MIME body containing a
> GMOP document requesting group regroup creation specified in subclause
> 7.3.4.3, with a \ element containing a group document for an MCS
> group. In the group document, the GMC shall include the \ temporary> element according to subclause 7.2. In the \ temporary> element, the GMC shall include \
> element according to subclause 7.2. In the \
> element, the GMC shall include one \ element
> according to subclause 7.2 for each MCS group to be combined.
Upon reception of an HTTP 2xx response to the sent HTTP POST request, the GMC
shall consider the temporary MCS group formation as successful.
Upon reception of an HTTP 409 (Conflict) response with at least one \ element in the \ error element, the GMC may repeat
procedures of the present subclause and identify the temporary MCS group being
formed with an MCS Group ID indicated in an \ element.
[TS 24.481, clause 6.3.15.1]
This procedure enables a GMC to initiate tear down of a temporary MCS group.
[TS 24.481, clause 6.3.15.2]
In order to tear down a temporary MCS group, the GMC shall send an HTTP DELETE
request with Request-URI with an XCAP URI identifying a group document of the
temporary MCS group according to procedures specified in IETF RFC 4825 [22]
\"_Delete an Element_ \".
[TS 33.180, clause 7.3.2]
The group creation procedure is described in clause 10.2.3 of 3GPP TS 23.280
[36] and applies to the MCPTT scenario of normal group creation by an MC
administrator and user regrouping operations by an authorized user/dispatcher.
To establish the security context for the group, the GMS follows the
procedures in clause 5.7 to create a new GMK and GMK-ID.
The encapsulated GMK and GUK-ID is sent to group members by the GMS within a
notification message (step 4 in clause 10.2.3 of 3GPP TS 23.280 [36]). The
procedure is equivalent to that described in clause 5.7 of this specification.
##### 5.2.3 Test description {#test-description-1 .H6}
##### 5.2.3.1 Pre-test conditions {#pre-test-conditions-1 .H6}
Same pre-test conditions as for MCPTT test case 5.2 (TS 36.579-2 [24]) with
the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
##### 5.2.3.2 Test procedure sequence {#test-procedure-sequence-1 .H6}
Same test procedure sequence as for MCPTT test case 5.2 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
##### 5.2.3.3 Specific message contents {#specific-message-contents-1 .H6}
Same specific message contents as for MCPTT test case 5.2 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
\- Condition MCDATA is used for all messages.
5.3 Configuration / Group Affiliation / Remote change / De-affiliation / Home
MCData system
##### 5.3.1 Test Purpose (TP) {#test-purpose-tp-2 .H6}
##### (1) {#section-9 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information, that the UE (MCData Client) is allowed
to be affiliated }
**ensure that** {\ **when** { MCData User requests for current affiliation
status and to subscribe to affiliation status changes for the MCData User }
**then** { UE (MCData Client) requests to subscribe to affiliation status
changes for the MCData User by sending the SS (MCData Server) a SIP SUBSCRIBE
message **and** starts informing the MCData User of any affiliation status
changes for the MCData User after the subscription is accepted }
}
##### (2) {#section-10 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information, that the UE (MCData Client) is allowed
to be affiliated }
**ensure that** {\ **when** { MCData User requests to affiliate to an MCData
group }
**then** { UE (MCData Client) requests to affiliate to a MCData group by
sending the SS (MCData Server) a SIP PUBLISH message }
}
##### (3) {#section-11 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information, that the UE (MCData Client) is allowed
to be affiliated }
**ensure that** {\ **when** { MCData User requests for current affiliation
status and to subscribe to affiliation status changes for a target user }
**then** { UE (MCData Client) requests to subscribe to affiliation status
changes for the target user by sending the SS (MCData Server) a SIP SUBSCRIBE
message **and** starts informing the MCData User of any affiliation status
changes for the target user after the subscription is accepted }
}
##### (4) {#section-12 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information that the UE (MCData Client) is allowed
to make affiliation changes for another user }
**ensure that** {\ **when** { MCData User requests that a target user be
affiliated to an MCData group via mandatory mode }
**then** { UE (MCData Client) requests that a target user be affiliated to an
MCData group via mandatory mode by sending the SS (MCData Server) a SIP
PUBLISH message }
}
##### (5) {#section-13 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information that the UE (MCData Client) is allowed
to make affiliation changes for another user }
**ensure that** {\ **when** { MCData User requests that a target user be de-
affiliated to an MCData group via mandatory mode }
**then** { UE (MCData Client) requests that a target user be de-affiliated to
an MCData group via mandatory mode by sending the SS (MCData Server) a SIP
PUBLISH message }
}
##### (6) {#section-14 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information that the UE (MCData Client) is allowed
to make affiliation changes for another user }
**ensure that** {\ **when** { MCData User requests that a target user be
affiliated to an MCData group via negotiated mode }
**then** { UE (MCData Client) requests that a target user be affiliated to an
MCData group via negotiated mode by sending the SS (MCData Server) a SIP
MESSAGE message }
}
##### (7) {#section-15 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information, that the UE (MCData Client) is allowed
to be affiliated }
**ensure that** {\ **when** { MCData User requests to de-subscribe to
affiliation status changes for a target user }
**then** { UE (MCData Client) requests to de-subscribe to affiliation status
changes for a target user by sending the SS (MCData Server) a SIP SUBSCRIBE
message }
}
##### (8) {#section-16 .H6}
**with** { UE (MCData Client) already affiliated with a MCData group }
**ensure that** {\ **when** { MCData User requests to de-affiliate from an
MCData group }
**then** { UE (MCData Client) requests to de-affiliate from an MCData group by
sending the SS (MCData Server) a SIP PUBLISH message }
}
##### (9) {#section-17 .H6}
**with** { UE (MCData Client) already provisioned with the group information
or a pointer to the group information, that the UE (MCData Client) is allowed
to be affiliated }
**ensure that** {\ **when** { MCData Server requests that the MCData User
choose to affiliate to an MCData group via negotiated mode by sending a SIP
MESSAGE message }
**then** { UE (MCData Client) accepts to affiliate to a MCData group by
sending the SS (MCData Server) a SIP PUBLISH message }
}
##### 5.3.2 Conformance requirements {#conformance-requirements-2 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 8.2.2, 8.2.3, 8.2.4, and 8.2.5. The following
represents a copy/paste extraction of the requirements relevant to the test
purpose; any references within the copy/paste text should be understood within
the scope of the core spec they have been copied from. Unless otherwise
stated, these are Rel-14 requirements.
[TS 24.282, clause 8.2.2]
In order:
> \- to indicate that an MCData user is interested in one or more MCData
> group(s) at an MCData client;
>
> \- to indicate that the MCData user is no longer interested in one or more
> MCData group(s) at the MCData client;
>
> \- to refresh indication of an MCData user interest in one or more MCData
> group(s) at an MCData client due to near expiration of the expiration time
> of an MCData group with the affiliation status set to the \"affiliated\"
> state received in a SIP NOTIFY request in subclause 8.2.3;
>
> \- to send an affiliation status change request in mandatory mode to another
> MCData user; or
>
> \- any combination of the above;
the MCData client shall generate a SIP PUBLISH request according to 3GPP TS
24.229 [5], IETF RFC 3903 [34], and IETF RFC 3856 [39].
In the SIP PUBLISH request, the MCData client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCData function serving the MCData user;
>
> 2) shall include an application/vnd.3gpp.mcdata-info+xml MIME body. In the
> application/vnd.3gpp.mcdata-info+xml MIME body, the MCData client shall
> include the \ element set to the MCData ID of the MCData
> user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
> (coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [7];
>
> 4) if the targeted MCData user is interested in at least one MCData group at
> the targeted MCData client, shall set the Expires header field according to
> IETF RFC 3903 [34], to 4294967295;
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [4].
>
> 5) if the targeted MCData user is no longer interested in any MCData group
> at the targeted MCData client, shall set the Expires header field according
> to IETF RFC 3903 [34], to zero; and
>
> 6) shall include an application/pidf+xml MIME body indicating per-user
> affiliation information according to subclause 8.4.1. In the MIME body, the
> MCData client:
>
> a) shall include all MCData groups where the targeted MCData user indicates
> its interest at the targeted MCData client;
>
> b) shall include the MCData client ID of the targeted MCData client;
>
> c) shall not include the \"status\" attribute and the \"expires\" attribute
> in the \ element; and
>
> d) shall set the \ child element of the \ root element to a
> globally unique value.
The MCData client shall send the SIP PUBLISH request according to 3GPP TS
24.229 [5].
[TS 24.282, clause 8.2.3]
> NOTE 1: The MCData UE also uses this procedure to determine which MCData
> groups the MCData user successfully affiliated to.
In order to discover MCData groups:
> 1) which the MCData user at an MCData client is affiliated to; or
>
> 2) which another MCData user is affiliated to;
the MCData client shall generate an initial SIP SUBSCRIBE request according to
3GPP TS 24.229 [5], IETF RFC 3856 [39], and IETF RFC 6665 [36].
In the SIP SUBSCRIBE request, the MCData client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCData function serving the MCData user;
>
> 2) shall include an application/vnd.3gpp.mcdata-info+xml MIME body. In the
> application/vnd.3gpp.mcdata-info+xml MIME body, the MCData client shall
> include the \ element set to the MCData ID of the
> targeted MCData user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
> (coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [7];
>
> 4) if the MCData client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [36], to 4294967295;
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [4].
>
> 5) if the MCData client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [36], to zero; and
>
> 6) shall include an Accept header field containing the application/pidf+xml
> MIME type; and
>
> 7) if requesting MCData groups where the MCData user is affiliated to at the
> MCData client, shall include an application/simple-filter+xml MIME body
> indicating per-client restrictions of presence event package notification
> information according to subclause 8.4.2, indicating the MCData client ID of
> the MCData client.
In order to re-subscribe or de-subscribe, the MCData client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [5], IETF RFC 3856
[39], and IETF RFC 6665 [36]. In the SIP SUBSCRIBE request, the MCData client:
> 1) if the MCData client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [36], to 4294967295;
>
> NOTE 3: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [4].
>
> 2) if the MCData client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [36], to zero; and
>
> 3) shall include an Accept header field containing the application/pidf+xml
> MIME type.
>
> Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [5], IETF
> RFC 3856 [39], and IETF RFC 6665 [36], if SIP NOTIFY request contains an
> application/pidf+xml MIME body indicating per-user affiliation information
> constructed according to subclause 8.4.1, then the MCData client shall
> determine affiliation status of the MCData user for each MCData group at the
> MCData client(s) in the MIME body. If the \ child element of the
> \ root element of the application/pidf+xml MIME body of the SIP
> NOTIFY request is included, the \ element value indicates the SIP
> PUBLISH request which triggered sending of the SIP NOTIFY request.
[TS 24.282, clause 8.2.4]
> NOTE: Procedure for sending affiliation status change request in negotiated
> mode to several target MCData users is not supported in this version of the
> specification.
Upon receiving a request from the MCData user to send an affiliation status
change request in negotiated mode to a target MCData user, the MCData client
shall generate a SIP MESSAGE request in accordance with 3GPP TS 24.229 [5] and
IETF RFC 3428 [6]. In the SIP MESSAGE request, the MCData client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCData function serving the MCData user;
>
> 2) shall include an application/vnd.3gpp.mcdata-info+xml MIME body. In the
> application/vnd.3gpp.mcdata-info+xml MIME body, the MCData client shall
> include the \ element set to the MCData ID of the target
> MCData user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
> (coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
>
> 4) shall include an application/vnd.3gpp.mcdata-affiliation-command+xml MIME
> body as specified in Annex D.3; and
>
> 5) shall send the SIP MESSAGE request according to rules and procedures of
> 3GPP TS 24.229 [5].
On receiving a SIP 2xx response to the SIP MESSAGE request, the MCData client
shall indicate to the user that the request has been delivered to an MCData
client of the target MCData user.
[TS 24.282, clause 8.2.5]
Upon receiving a SIP MESSAGE request containing:
> 1) the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\" (coded as
> specified in 3GPP TS 24.229 [5]), in a P-Asserted-Service header field
> according to IETF RFC 6050 [7]; and
>
> 2) an application/vnd.3gpp.mcdata-affiliation-command+xml MIME body with a
> list of MCData groups for affiliation under the \ element and a
> list of MCData groups for de-affiliation under the \ element;
then the MCData client:
> 1) shall send a 200 (OK) response to the SIP MESSAGE request;
>
> 2) shall seek confirmation of the list of MCData groups for affiliation and
> the list of MCData groups for de-affiliation, resulting in an accepted list
> of MCData groups for affiliation and an accepted list of MCData groups for
> de-affiliation; and
>
> 3) if the user accepts the request:
>
> a) shall perform affiliation for each entry in the accepted list of MCData
> groups for affiliation for which the MCData client is not affiliated, as
> specified in subclause 8.2.2; and
>
> b) shall perform de-affiliation for each entry in the accepted list of
> MCData groups for de-affiliation for which the MCData client is affiliated,
> as specified in subclause 8.2.2.
##### 5.3.3 Test description {#test-description-2 .H6}
##### 5.3.3.1 Pre-test conditions {#pre-test-conditions-2 .H6}
Same pre-test conditions as for MCPTT test case 5.3 (TS 36.579-2 [24]) with
the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
##### 5.3.3.2 Test procedure sequence {#test-procedure-sequence-2 .H6}
Same test procedure sequence as for MCPTT test case 5.3 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
##### 5.3.3.3 Specific message contents {#specific-message-contents-2 .H6}
Same specific message contents as for MCPTT test case 5.3 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
\- Condition MCDATA is used for all messages.
5.4 Configuration / Determination of MCData Service Settings / Current Active
MCData Settings / De-subscribe
##### 5.4.1 Test Purpose (TP) {#test-purpose-tp-3 .H6}
##### (1) {#section-18 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {\ **when** { MCData User requests to verify the currently
active MCData service settings or to discover MCData service settings }
**then** { UE (MCData Client) sends a SIP SUBSCRIBE message to find the MCData
service settings **and** responds to the SIP NOTIFY message with a SIP 200
(OK) message }
}
##### (2) {#section-19 .H6}
**with** { UE (MCDATA Client) having already subscribed to find the MCData
service settings }
**ensure that** {\ **when** { MCData User requests to re-subscribe for MCData
service settings }
**then** { UE (MCData Client) sends a SIP SUBSCRIBE message to re-subscribe
for the MCData service settings **and** responds to the SIP NOTIFY message
with a SIP 200 (OK) message }
}
##### (3) {#section-20 .H6}
**with** { UE (MCDATA Client) having already subscribed to find the MCData
service settings }
**ensure that** {\ **when** { MCData User requests to de-subscribe for MCData
service settings }
**then** { UE (MCData Client) sends a SIP SUBSCRIBE message to de-subscribe
for the MCData service settings **and** responds to the SIP NOTIFY message
with a SIP 200 (OK) message }
}
##### 5.4.2 Conformance requirements {#conformance-requirements-3 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.282 clause 7.2.4. The following represents a copy/paste
extraction of the requirements relevant to the test purpose; any references
within the copy/paste text should be understood within the scope of the core
spec they have been copied from. Unless otherwise stated these are Rel-14
requirements.
[TS 24.282, clause 7.2.4]
In order to discover MCData service settings of another MCData client of the
same MCData user or to verify the currently active MCData service settings of
this MCData client, the MCData client shall generate an initial SIP SUBSCRIBE
request according to 3GPP TS 24.229 [5], IETF RFC 6665 [36], and IETF RFC 4354
[35].
In the SIP SUBSCRIBE request, the MCData client:
> 1) shall set the Request-URI to the public service identity identifying the
> originating participating MCData function serving the MCData user;
>
> 2) shall include an application/vnd.3gpp.mcdata-info+xml MIME body. In the
> application/vnd.3gpp.mcdata-info+xml MIME body, the MCData client shall
> include the \ element set to the MCData ID of the MCData
> user;
>
> 3) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata\"
> (coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
> field according to IETF RFC 6050 [7];
>
> 4) shall set the Event header field to the \'poc-settings\' value;
>
> 5) shall include an Accept header field containing the \"application/poc-
> settings+xml\" MIME type;
>
> 6) if the MCData client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [36], to 4294967295; and
>
> NOTE 1: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [4].
>
> 7) if the MCData client wants to fetch the current state only, shall set the
> Expires header field according to IETF RFC 6665 [36], to zero.
In order to re-subscribe or de-subscribe, the MCData client shall generate an
in-dialog SIP SUBSCRIBE request according to 3GPP TS 24.229 [5], IETF RFC 6665
[36], IETF RFC 4354 [35]. In the SIP SUBSCRIBE request, the MCData client:
> 1) shall set the Event header field to the \'poc-settings\' value;
>
> 2) shall include an Accept header field containing the \"application/poc-
> settings+xml\" MIME type;
>
> 3) if the MCData client wants to receive the current status and later
> notification, shall set the Expires header field according to IETF RFC 6665
> [36], to 4294967295; and
>
> NOTE 2: 4294967295, which is equal to 2^32^-1, is the highest value defined
> for Expires header field in IETF RFC 3261 [4].
>
> 4) if the MCData client wants to de-subscribe, shall set the Expires header
> field according to IETF RFC 6665 [36], to zero.
Upon receiving a SIP NOTIFY request according to 3GPP TS 24.229 [5], IETF RFC
6665 [36] and IETF RFC 4354 [35], that contains an application/poc-
settings+xml MIME body the MCData client shall cache:
> 1) the \ element of the poc-settings+xml MIME body for each
> MCData client identified by the \"id\" attribute according to IETF RFC 4354
> [35] as the current Answer-mode indication of that MPCTT client; and
>
> 2) the \ element of the poc-settings+xml MIME
> body for each MCData client identified by the \"id\" attribute according to
> IETF RFC 4354 [35] as the active MCData user profile of that MCData client.
##### 5.4.3 Test description {#test-description-3 .H6}
##### 5.4.3.1 Pre-test conditions {#pre-test-conditions-3 .H6}
Same pre-test conditions as for MCPTT test case 5.5 (TS 36.579-2 [24]) with
the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
##### 5.4.3.2 Test procedure sequence {#test-procedure-sequence-3 .H6}
Same test procedure sequence as for MCPTT test case 5.5 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
##### 5.4.3.3 Specific message contents {#specific-message-contents-3 .H6}
Same specific message contents as for MCPTT test case 5.5 (TS 36.579-2 [24])
with the following exception(s):
\- The term \"MCPTT\" is replaced with \"MCData\"
\- Condition MCDATA is used for all messages.
# 6 On-Network Test Scenarios
6.1 Short Data Service
### 6.1.1 On-network / Short Data Service (SDS) / Standalone SDS Using
Signalling Control Plane / One-to-one Standalone SDS / Client Originated (CO)
##### 6.1.1.1 Test Purpose (TP) {#test-purpose-tp-4 .H6}
##### (1) {#section-21 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one SDS
message with a disposition of only Delivery }
**then** { UE (MCDATA Client) sends a standalone one-to-one SDS message with a
disposition of only Delivery via a SIP MESSAGE message }
}
##### (2) {#section-22 .H6}
**with** { UE (MCDATA Client) having sent a standalone one-to-one SDS message
}
**ensure that** {
**when** { UE (MCDATA Client receives a disposition response via a SIP MESSAGE
message from the SS (MCDATA Server) }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### (3) {#section-23 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one SDS
message with a disposition of only Read }
**then** { UE (MCDATA Client) sends a standalone one-to-one SDS message with a
disposition of only Read via a SIP MESSAGE message }
}
##### (4) {#section-24 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one SDS
message with a disposition of both Read and Delivery }
**then** { UE (MCDATA Client) sends a standalone one-to-one SDS message with a
disposition of both Read and Delivery via a SIP MESSAGE message }
}
##### 6.1.1.2 Conformance requirements {#conformance-requirements-4 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.2.2.1, 6.2.2.1, 6.2.4.1, 12.2.1.2. The
following represents a copy/paste extraction of the requirements relevant to
the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.2.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) if a one-to-one standalone SDS message is to be sent, shall insert in the
SIP MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [9];
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-sds\"; and
c) if end-to-end security is required and the security context does not exist
or if the existing security context has expired, an application/mikey MIME
body with the MIKEY-SAKKE I_MESSAGE as specified in 3GPP TS 33.180 [26]. The
MCData client:
i) if necessary, shall instruct the key management client to request keying
material from the key management server as described in 3GPP TS 33.180 [26];
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [26];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [26];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [26];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [26]; and
vi) shall add the MCData ID of the originating MCData to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCData user\'s
signing key provided in the keying material together with a time related
parameter; and
viii) shall include the MIKEY-SAKKE I_MESSAGE in an application/mikey MIME
body as specified in 3GPP TS 33.180 [26];
...
4) shall generate a standalone SDS message as specified in subclause 6.2.2.1;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.2.1]
In order to generate an SDS message, the MCData client:
1) shall generate an SDS SIGNALLING PAYLOAD message as specified in subclause
15.1.2;
2) shall generate a DATA PAYLOAD message as specified in subclause 15.1.4;
3) shall include in the SIP request, the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1; and
4) shall include in the SIP request, the DATA PAYLOAD message in an
application/vnd.3gpp.mcdata-payload MIME body as specified in subclause E.2.
When generating an SDS SIGNALLING PAYLOAD message as specified in subclause
15.1.2, the MCData client:
1) shall set the Date and time IE to the current time as specified in
subclause 15.2.8;
2) if the SDS message starts a new conversation, shall set the Conversation ID
IE to a newly generated Conversation ID value as specified in subclause
15.2.9;
3) if the SDS message continues an existing unfinished conversation, shall set
the Conversation ID IE to the Conversation ID value of the existing
conversation as specified in subclause 15.2.9;
4) shall set the Message ID IE to a newly generated Message ID value as
specified in subclause 15.2.10;
5) if the SDS message is in reply to a previously received SDS message, shall
include the InReplyTo message ID IE with the Message ID value in the
previously received SDS message;
6) if the SDS message is for user consumption, shall not include an
Application ID IE as specified in subclause 15.2.7;
7) if the SDS message is intended for an application on the terminating MCData
client, shall include an Application ID IE with an Application ID value
representing the intended application as specified in subclause 15.2.7;
NOTE: The value chosen for the Application ID value is decided by the mission
critical organisation.
8) if only a delivery disposition notification is required shall include a SDS
disposition request type IE set to \"DELIVERY\" as specified in subclause
15.2.3;
9) if only a read disposition notification is required shall include a SDS
disposition request type IE set to \"READ\" as specified in subclause 15.2.3;
and
10) if both a delivery and read disposition notification is required shall
include a SDS disposition request type IE set to \"DELIVERY AND READ\" as
specified in subclause 15.2.3.
When generating an DATA PAYLOAD message for SDS as specified in subclause
15.1.4, the MCData client:
1) shall set the Number of payloads IE to the number of Payload IEs that needs
to be encoded, as specified in subclause 15.2.12;
2) if end-to-end security is required for a one-to-one communication, shall
include the Security parameters and Payload IE with security parameters as
described in 3GPP TS 33.180 [26]. Otherwise, if end-to-end security is not
required for a one-to-one communication, shall include the Payload IE as
specified in subclause 15.1.4; and
3) for each Payload IE included:
a) if the payload is text, shall set the Payload content type as \"TEXT\" as
specified in subclause 15.2.13;
b) if the payload is binary data, shall set the Payload content type as
\"BINARY\" as specified in subclause 15.2.13;
c) if the payload is hyperlinks, shall set the Payload content type as
\"HYPERLINKS\" as specified in subclause 15.2.13;
d) if the payload is location, shall set the Payload content type as
\"LOCATION\" as specified in subclause 15.2.13; and
e) shall include the data to be sent in the Payload data.
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
...
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.1.1.3 Test description {#test-description-4 .H6}
##### 6.1.1.3.1 Pre-test conditions {#pre-test-conditions-4 .H6}
##### System Simulator: {#system-simulator .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble .H6}
\- The \ element shall not be present in
the MCData Service Configuration document so that according to TS 24.484 [24]
there is no size limit imposed for the use of C-plane procedures for the SDS
message.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.1.3.2 Test procedure sequence {#test-procedure-sequence-4 .H6}
Table 6.1.1.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"**DEL | | | | | | | IVERY** \". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2-2B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer** | | | | | | | using | | | | | | | signalling | | | | | | | plane\' | | | | | | | **as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 2A? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"_| | | | | | |_ READ**\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer**| | | | | | | using | | | | | | | signalling | | | | | | | plane\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | |** to send | | | | | | | a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \ | | | | | | | "READ\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication**| | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 8? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \" | | | | | | |** DELIVERY | | | | | | | AND | | | | | | | READ**\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer**| | | | | | | using | | | | | | | signalling | | | | | | | plane\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | |** to send | | | | | | | a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DELIVERY | | | | | | | AND | | | | | | | READ\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 15 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 16 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT**\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 14? | | | | | +------------+------------+------------+---------+---------+----+ | 17 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 18 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The RRC | | | | | | | connection | | | | | | | is not | | | | | | | released | | | | | | | at the end | | | | | | | of the | | | | | | | procedure. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.1.3.3 Specific message contents {#specific-message-contents-4 .H6}
Table 6.1.1.3.3-1: SIP MESSAGE from the UE (step 2A, Table 6.1.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MIKEY, MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.1.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.1.3.3-3  
MIME body part **MCData Data message**  
MIME-part-body DATA PAYLOAD as described in Table 6.1.1.3.3-4
Table 6.1.1.3.3-2: MCData-Info (Table 6.1.1.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_1to1
* * *
Table 6.1.1.3.3-3: SDS SIGNALLING PAYLOAD (Table 6.1.1.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.1.1.3.3-4: DATA PAYLOAD (Table 6.1.1.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-1
* * *
Table 6.1.1.3.3-5: SIP MESSAGE from the SS (step 4, Table 6.1.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.1.3.3-7
Table 6.1.1.3.3-6: Void
Table 6.1.1.3.3-7: SDS NOTIFICATION (Table 6.1.1.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.1.1.3.3-8: Void
Table 6.1.1.3.3-9: SIP MESSAGE from the UE (step 8, Table 6.1.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MIKEY, MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body As described in Table 6.1.1.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.1.3.3-10  
MIME body part **MCData Data message**  
MIME-part-body DATA PAYLOAD as described in Table 6.1.1.3.3-4
Table 6.1.1.3.3-10: SDS SIGNALLING PAYLOAD (Table 6.1.1.3.3-9)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1. condition READ
* * *
Table 6.1.1.3.3-11: SIP MESSAGE from the SS (step 10, Table 6.1.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.1.3.3-12
Table 6.1.1.3.3-12: SDS NOTIFICATION (Table 6.1.1.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition READ
* * *
Table 6.1.1.3.3-13: SIP MESSAGE from the UE (step 14, Table 6.1.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MIKEY, MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.1.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.1.3.3-14  
MIME body part **MCData Data message**  
MIME-part-body DATA PAYLOAD as described in Table 6.1.1.3.3-4
Table 6.1.1.3.3-14: SDS SIGNALLING PAYLOAD (Table 6.1.1.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED_READ
* * *
Table 6.1.1.3.3-15: SIP MESSAGE from the SS (step 16, Table 6.1.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION
described in Table 6.1.1.3.3-16
Table 6.1.1.3.3-16: SDS NOTIFICATION (Table 6.1.1.3.3-15)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED_READ
* * *
### 6.1.2 On-network / Short Data Service (SDS) / Standalone SDS Using
Signalling Control Plane / One-to-one Standalone SDS / Client Terminated (CT)
##### 6.1.2.1 Test Purpose (TP) {#test-purpose-tp-5 .H6}
##### (1) {#section-25 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a standalone one-to-one SDS message with a
disposition request of \"DELIVERY\" }
**then** { UE (MCDATA Client) confirms the reception of the SDS message by
sending a SIP 200 (OK) message, followed by a SIP MESSAGE with a disposition
notification of \"DELIVERED\" **and** renders the contents of the Payload IE
to the MCDATA User }
}
##### (2) {#section-26 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a standalone one-to-one SDS message with a
disposition request of \"READ\" }
**then** { UE (MCDATA Client) confirms the reception of the SDS message by
sending a SIP 200 (OK) message, **and,** renders the contents of the Payload
IE to the MCDATA User**,** **and,** then sends a SIP MESSAGE message with a
disposition notification of \"READ\" }
}
##### (3) {#section-27 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a standalone one-to-one SDS message with a
disposition request of \"DELIVERY AND READ\" with pre-set timer TDU1 (delivery
and read) }
**then** { UE (MCDATA Client) sends a delivered and read notification after
the message is rendered to the user if the timer TDU1 (delivery and read) has
not expired at this time, **or** , if the timer TDU1 (delivery and read)
expires before the message is rendered to the user sends first a delivered
notification and after the message is rendered to the user a read notification
}
}
##### 6.1.2.2 Conformance requirements {#conformance-requirements-5 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.2.2.2, 9.2.1.2, 9.2.1.3, 12.2.1.1,
6.2.3.1, 6.2.4.1. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.2.2.2]
Upon receipt of a \"SIP MESSAGE request for standalone SDS for terminating
MCData client\", the MCData client:
1) may reject the SIP MESSAGE request if there are not enough resources to
handle the SIP MESSAGE request;
2) if the SIP MESSAGE request is rejected in step 1), shall respond toward
participating MCData function with a SIP 480 (Temporarily unavailable)
response and skip the rest of the steps of this subclause;
3) if the SIP MESSAGE request contains an application/mikey MIME body
containing a MIKEY-SAKKE I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP MESSAGE request with a SIP 606 (Not Acceptable) response, and
include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE
failed\" in a Warning header field as specified in subclause 4.9 and not
continue with rest of the steps in this subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to exchange end-to-
end secure message.
4) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
5) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
6) shall handle the received message as specified in subclause 9.2.1.2.
[TS 24.282, clause 9.2.1.2]
When a MCData client has received a SIP request containing:
\- an application/vnd.3gpp.mcdata-signalling MIME body as specified in
subclause E.1; and
\- an application/vnd.3gpp.mcdata-payload MIME body as specified in subclause
E.2;
the MCData Client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body;
2) shall decode the contents of the application/vnd.3gpp.mcdata-payload MIME
body;
3) if the SDS SIGNALLING PAYLOAD message contains a new Conversation ID, shall
instantiate a new conversation with the Message ID in the SDS SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
4) if the SDS SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
a) if the SDS SIGNALLING PAYLOAD message does not contain an InReplyTo message
ID, shall use the Message ID in the SDS SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
b) if the SDS SIGNALLING PAYLOAD message contains an InReplyTo message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo message ID in the SDS SIGNALLING PAYLOAD, and
use the Message ID in the SDS SIGNALLING PAYLOAD to identify the new message;
5) shall identify the number of Payload IEs in the DATA PAYLOAD message from
the Number of payloads IE in the DATA PAYLOAD message;
6) if the SDS SIGNALLING PAYLOAD message does not contain an Application ID
IE:
a) shall determine that the payload contained in the DATA PAYLOAD message is
for user consumption
b) may notify the MCData user; and
c) shall render the contents of the Payload IE(s) to the MCData user;
7) if the SDS SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the DATA PAYLOAD message is
not for user consumption,
b) shall not notify the MCData user;
c) if the Application ID value is unknown, shall discard the SDS message; and
d) if the Application ID value is known, shall deliver the contents of the
Payload IE(s) to the identified application;
NOTE 1: If required, the MCData client decrypts the Payload IEs before
rendering the SDS message to the user or delivering the SDS message to the
application.
NOTE 2: The actions taken when the payload contains application data not meant
for user consumption or command instructions are based upon the contents of
the payload. If the payload content is addressed to a non-MCData application
that is not running, the MCData client starts the local non-MCData application
and delivers the payload to that application.
NOTE 3: User consent is not required before accepting the data.
8) may store the message payload in local storage along with the Conversation
ID, Message ID, InReplyTo message ID and Date and time; and
9) if the received SDS SIGNALLING PAYLOAD message contains an SDS disposition
request type IE shall follow the procedures in subclause 9.2.1.3.
[TS 24.282, clause 9.2.1.3]
To handle the disposition requests, the MCData client:
1) If the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a delivered notification as described in
subclause 12.2.1.1;
b) \"READ\", shall send a read notification as described in subclause
12.2.1.1, when a display indication is received; or
c) \"DELIVERY AND READ\" then, shall start timer TDU1 (delivery and read).
Upon receiving a display indication before timer TDU1 (delivery and read)
expires, the MCData client:
1) shall stop timer TDU1 (delivery and read); and
2) shall send a delivered and read notification as described in subclause
12.2.1.1.
Upon expiry of timer TDU1 (delivery and read), the MCData client:
1) shall send a delivered notification as described in subclause 12.2.1.1; and
2) upon receiving a display indication, send a read notification as described
in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.3.1]
In order to generate an SDS notification, the MCData client:
1) shall generate an SDS NOTIFICATION message as specified in subclause
15.1.5; and
2) shall include in the SIP request, the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an SDS NOTIFICATION message as specified in subclause 15.1.5,
the MCData client:
1) if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\" as specified in subclause 15.2.5;
2) if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\" as specified in subclause 15.2.5;
3) if sending a delivered and read notification, shall set the SDS disposition
notification type IE as \"DELIVERED AND READ\" as specified in subclause
15.2.5;
4) if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\" as specified in subclause 15.2.5;
5) shall set the Date and time IE to the current time to as specified in
subclause 15.2.8;
6) shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message as specified in subclause 15.2.9;
7) shall set the Message ID to the value of the Message ID that was received
in the SDS message as specified in subclause 15.2.10;
8) if the SDS message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
9) if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message as specified in subclause 15.2.3.
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
...
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
##### 6.1.2.3 Test description {#test-description-5 .H6}
##### 6.1.2.3.1 Pre-test conditions {#pre-test-conditions-5 .H6}
##### System Simulator: {#system-simulator-1 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-1 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-1 .H6}
\- The \ element shall not be present in
the MCData Service Configuration document so that according to TS 24.484 [24]
there is no size limit imposed for the use of C-plane procedures for the SDS
message.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.2.3.2 Test procedure sequence {#test-procedure-sequence-5 .H6}
Table 6.1.2.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-1B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | | | | | | | | | | (NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 2) | | | | | | | | | | | | | | The exact | | | | | | | expected | | | | | | | content | | | | | | | is\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5.5.3.10-2 | | | | | +------------+------------+------------+---------+---------+----+ | 6 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | close the | | | | | | | message | | | | | | | ap | | | | | | | plication. | | | | | | | | | | | | | | (NOTE 2, | | | | | | | NOTE 5) | | | | | +------------+------------+------------+---------+---------+----+ | 7-7B | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \ | | | | | | | "READ\"**? | | | | | | | | | | | | | | (NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | event | | | | | | | described | | | | | | | in step 9 | | | | | | | the events | | | | | | | described | | | | | | | in Table | | | | | | | 6 | | | | | | | .1.2.3.2-2 | | | | | | | take | | | | | | | place. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 2) | | | | | | | | | | | | | | The exact | | | | | | | expected | | | | | | | content | | | | | | | is\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.3.10-2. | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | close the | | | | | | | message | | | | | | | ap | | | | | | | plication. | | | | | | | | | | | | | | (NOTE 2, | | | | | | | NOTE 5) | | | | | +------------+------------+------------+---------+---------+----+ | 11-11B | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive a | | | | | | | standalone | | | | | | | one-to-one | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DELIVERY | | | | | | | AND | | | | | | | READ\"**? | | | | | | | | | | | | | | (NOTE 3, | | | | | | | 4) | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | event | | | | | | | described | | | | | | | in step 13 | | | | | | | the events | | | | | | | described | | | | | | | in Table | | | | | | | 6 | | | | | | | .1.2.3.2-3 | | | | | | | take | | | | | | | place. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user | | | | | | | before | | | | | | | expiry of | | | | | | | timer TDU1 | | | | | | | (delivery | | | | | | | and read)? | | | | | | | | | | | | | | (NOTE 2) | | | | | | | | | | | | | | The exact | | | | | | | expected | | | | | | | content | | | | | | | is\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2], | | | | | | | Table | | | | | | | 5 | | | | | | | .5.3.10-2. | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | close the | | | | | | | message | | | | | | | ap | | | | | | | plication. | | | | | | | | | | | | | | (NOTE 2, | | | | | | | NOTE 5) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | The | | | | | | | behaviour | | | | | | | is handled | | | | | | | through | | | | | | | parallel | | | | | | | actions to | | | | | | | allow for | | | | | | | imple | | | | | | | mentations | | | | | | | which | | | | | | | first | | | | | | | indicate | | | | | | | to the | | | | | | | user that | | | | | | | there is a | | | | | | | message | | | | | | | available, | | | | | | | but render | | | | | | | the | | | | | | | message to | | | | | | | the user | | | | | | | only after | | | | | | | the user | | | | | | | takes an | | | | | | | action to | | | | | | | open the | | | | | | | message. | | | | | | | | | | | | | | NOTE 2: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The RRC | | | | | | | connection | | | | | | | is not | | | | | | | released | | | | | | | at the end | | | | | | | of the | | | | | | | procedure. | | | | | | | | | | | | | | NOTE 4: | | | | | | | Timer TDU1 | | | | | | | (delivery | | | | | | | and read) | | | | | | | is started | | | | | | | upon | | | | | | | receipt of | | | | | | | the SIP | | | | | | | MESSAGE | | | | | | | message | | | | | | | that | | | | | | | contains a | | | | | | | \"DELIVERY | | | | | | | AND READ\" | | | | | | | d | | | | | | | isposition | | | | | | | request. | | | | | | | Timer TDU1 | | | | | | | (delivery | | | | | | | and | | | | | | | r | | | | | | | ead)=120ms | | | | | | | according | | | | | | | to the | | | | | | | default | | | | | | | value | | | | | | | defined in | | | | | | | TS 24.282 | | | | | | | [31]. | | | | | | | | | | | | | | NOTE 5; | | | | | | | The | | | | | | | message | | | | | | | a | | | | | | | pplication | | | | | | | shall be | | | | | | | closed to | | | | | | | avoid | | | | | | | unexpected | | | | | | | behaviour | | | | | | | at the UE | | | | | | | when | | | | | | | receiving | | | | | | | a next | | | | | | | message. | | | | | | +------------+------------+------------+---------+---------+----+
Table 6.1.2.3.2-2: Parallel Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                            U - S              Message
1 Check: Does the UE (MCData client) correctly perform procedure \'**CO SDS or
FD message transfer using signalling plane\' as described in TS 36.579-1** [2]
Table 5.3C.1.3-1 **to send a disposition notification of \"READ\"**? - - 2 P
Table 6.1.2.3.2-3: Parallel Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                                   U - S              Message
\- EXCEPTION: Steps 1a1-1b1 describe behaviour that depends on the UE
implementation in regard to how quick the UE (MCData client) will render the
contents of the Payload IE to the MCData user and the value of Timer TDU1. - -
- - 1a1-1a2 Check: Does the UE (MCData client) correctly perform steps 2-3 of
procedure \'**CO SDS or FD message transfer using signalling** plane\' as
described in TS 36.579-1 [2] Table 5.3C.1.3-1 **to send a disposition
notification of \"DELIVERED\"**? - - 3 P 1a3 Check: Does the UE (MCData
client) correctly perform procedure \'**CO SDS or FD message transfer using
signalling plane** \' as described in TS 36.579-1 [2] Table 5.3C.1.3-1 **to
send a disposition notification of \"READ\"**? - - 3 P 1b1 Check: Does the UE
(MCData client) correctly perform procedure \'**CO SDS or FD message transfer
using signalling plane** \' as described in TS 36.579-1 [2] Table 5.3C.1.3-1
**to send a disposition notification of \"DELIVERED AND READ\"**? - - 3 P
##### 6.1.2.3.3 Specific message contents {#specific-message-contents-5 .H6}
Table 6.1.2.3.3-1: SIP MESSAGE from the SS (step 1A, Table 6.1.2.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MIKEY, MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.2.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.2.3.3-3  
MIME body part **MCData Data message**  
MIME-part-body DATA PAYLOAD as described in Table 6.1.2.3.3-4
Table 6.1.2.3.3-2: MCData-Info (Table 6.1.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_1to1
* * *
Table 6.1.2.3.3-3: SDS SIGNALLING PAYLOAD (Table 6.1.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.1.2.3.3-4: DATA PAYLOAD (Table 6.1.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-2
* * *
Table 6.1.2.3.3-5: Void
Table 6.1.2.3.3-6: SIP MESSAGE from the UE (step 3, Table 6.1.2.3.2-1, step
1a1, Table 6.1.2.3.2-3;\ step 2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part _not present_ **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.2.3.3-7
Table 6.1.2.3.3-7: SDS NOTIFICATION (Table 6.1.2.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
Table 6.1.2.3.3-8: SIP MESSAGE from the SS (step 7A, Table 6.1.2.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MIKEY, MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.2.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.2.3.3-9  
MIME body part **MCData Data message**  
MIME-part-body DATA PAYLOAD as described in Table 6.1.2.3.3-4
Table 6.1.2.3.3-9: SDS SIGNALLING PAYLOAD (Table 6.1.2.3.3-8)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1. condition READ
* * *
Table 6.1.2.3.3-10: SIP MESSAGE from the UE (step 1, Table 6.1.2.3.2-2, step
1a3, Table 6.1.2.3.2-3;\ step 2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part _not present_ **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.2.3.3-11
Table 6.1.2.3.3-11: SDS NOTIFICATION (Table 6.1.2.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition READ
* * *
Table 6.1.2.3.3-12: SIP MESSAGE from the SS (step 11A, Table 6.1.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MIKEY, MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.2.3.3-2  
MIME body part **MCData Data signalling messag**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.2.3.3-13  
MIME body part **MCData Data message**  
MIME-part-body DATA PAYLOAD as described in Table 6.1.2.3.3-4
Table 6.1.2.3.3-13: SDS SIGNALLING PAYLOAD (Table 6.1.2.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED_READ
* * *
Table 6.1.2.3.3-14: SIP MESSAGE from the UE (step 1b1, Table 6.1.2.3.2-2;\
step 2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part _not present_ **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.2.3.3-15
Table 6.1.2.3.3-15: SDS NOTIFICATION (Table 6.1.2.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED_READ
* * *
### 6.1.3 On-network / Short Data Service (SDS) / Standalone SDS Using
Signalling Control Plane / Group Standalone SDS / Client Originated (CO)
##### 6.1.3.1 Test Purpose (TP) {#test-purpose-tp-6 .H6}
##### (1) {#section-28 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a group standalone SDS message
with a disposition of only Delivery }
**then** { UE (MCDATA Client) sends a group standalone SDS message with a
disposition of only Delivery via s SIP MESSAGE message }
}
##### (2) {#section-29 .H6}
**with** { UE (MCDATA Client) having sent a group standalone SDS message }
**ensure that** {
**when** { the UE (MCDATA Client) receives a disposition response via a SIP
MESSAGE message from the SS (MCDATA Server) }
**then** { UE (MCData Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.1.3.2 Conformance requirements {#conformance-requirements-6 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.2.2.1, 6.2.2.1, 6.2.4.1, 12.2.1.2. The
following represents a copy/paste extraction of the requirements relevant to
the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.2.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
...
3) if a group standalone SDS message is to be sent:
a) if the \"/_\ _/\/Common/MCData/AllowedSDS\" leaf node present in the
group document of the requested MCData group, configured on the group
management client as specified in 3GPP TS 24.483 [42] is set to \"false\",
shall reject the request to send SDS and not continue with the rest of the
steps in this subclause; and
b) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with:
i) the \ element set to a value of \"group-sds\";
ii) the \ element set to the MCData group identity; and
iii) the \ element set to the MCData client ID of the
originating MCData client;
4) shall generate a standalone SDS message as specified in subclause 6.2.2.1;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.2.1]
In order to generate an SDS message, the MCData client:
1) shall generate an SDS SIGNALLING PAYLOAD message as specified in subclause
15.1.2;
2) shall generate a DATA PAYLOAD message as specified in subclause 15.1.4;
3) shall include in the SIP request, the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1; and
4) shall include in the SIP request, the DATA PAYLOAD message in an
application/vnd.3gpp.mcdata-payload MIME body as specified in subclause E.2.
When generating an SDS SIGNALLING PAYLOAD message as specified in subclause
15.1.2, the MCData client:
1) shall set the Date and time IE to the current time as specified in
subclause 15.2.8;
2) if the SDS message starts a new conversation, shall set the Conversation ID
IE to a newly generated Conversation ID value as specified in subclause
15.2.9;
3) if the SDS message continues an existing unfinished conversation, shall set
the Conversation ID IE to the Conversation ID value of the existing
conversation as specified in subclause 15.2.9;
4) shall set the Message ID IE to a newly generated Message ID value as
specified in subclause 15.2.10;
5) if the SDS message is in reply to a previously received SDS message, shall
include the InReplyTo message ID IE with the Message ID value in the
previously received SDS message;
6) if the SDS message is for user consumption, shall not include an
Application ID IE as specified in subclause 15.2.7;
7) if the SDS message is intended for an application on the terminating MCData
client, shall include an Application ID IE with an Application ID value
representing the intended application as specified in subclause 15.2.7;
NOTE: The value chosen for the Application ID value is decided by the mission
critical organisation.
8) if only a delivery disposition notification is required shall include a SDS
disposition request type IE set to \"DELIVERY\" as specified in subclause
15.2.3;
9) if only a read disposition notification is required shall include a SDS
disposition request type IE set to \"READ\" as specified in subclause 15.2.3;
and
10) if both a delivery and read disposition notification is required shall
include a SDS disposition request type IE set to \"DELIVERY AND READ\" as
specified in subclause 15.2.3.
When generating an DATA PAYLOAD message for SDS as specified in subclause
15.1.4, the MCData client:
1) shall set the Number of payloads IE to the number of Payload IEs that needs
to be encoded, as specified in subclause 15.2.12;
2) if end-to-end security is required for a one-to-one communication, shall
include the Security parameters and Payload IE with security parameters as
described in 3GPP TS 33.180 [26]. Otherwise, if end-to-end security is not
required for a one-to-one communication, shall include the Payload IE as
specified in subclause 15.1.4; and
3) for each Payload IE included:
a) if the payload is text, shall set the Payload content type as \"TEXT\" as
specified in subclause 15.2.13;
b) if the payload is binary data, shall set the Payload content type as
\"BINARY\" as specified in subclause 15.2.13;
c) if the payload is hyperlinks, shall set the Payload content type as
\"HYPERLINKS\" as specified in subclause 15.2.13;
d) if the payload is location, shall set the Payload content type as
\"LOCATION\" as specified in subclause 15.2.13; and
e) shall include the data to be sent in the Payload data.
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
...
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.1.3.3 Test description {#test-description-6 .H6}
##### 6.1.3.3.1 Pre-test conditions {#pre-test-conditions-6 .H6}
##### System Simulator: {#system-simulator-2 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-2 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-2 .H6}
\- The \ element shall not be present in
the MCData Service Configuration document so that according to TS 24.484 [24]
there is no size limit imposed for the use of C-plane procedures for the SDS
message.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.3.3.2 Test procedure sequence {#test-procedure-sequence-6 .H6}
Table 6.1.3.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | group | | | | | | | standalone | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"D | | | | | | | ELIVERY\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2-2B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | standalone | | | | | | | group SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 2A? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The RRC | | | | | | | connection | | | | | | | is not | | | | | | | released | | | | | | | at the end | | | | | | | of the | | | | | | | procedure. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.3.3.3 Specific message contents {#specific-message-contents-6 .H6}
Table 6.1.3.3.3-1: SIP MESSAGE from the UE (step 2A, Table 6.1.3.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.3.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.3.3.3-2A  
MIME body part **MCData Data message**  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.3.3.3-3
Table 6.1.3.3.3-2: MCData-Info (Table 6.1.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
Table 6.1.3.3.3-2A: SDS SIGNALLING PAYLOAD (Table 6.1.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.1.3.3.3-3: DATA PAYLOAD (Table 6.1.3.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-1
* * *
Table 6.1.3.3.3-4: SIP MESSAGE from the SS (step 4, Table 6.1.3.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body As described in Table 6.1.3.3.3-5  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.3.3.3-6
Table 6.1.3.3.3-5: MCData-Info (Table 6.1.3.3.3-4)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.1.3.3.3-6: SDS NOTIFICATION (Table 6.1.3.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.1.3.3.3-7: Void
### 6.1.4 On-network / Short Data Service (SDS) / Standalone SDS Using
Signalling Control Plane / Group Standalone SDS / Client Terminated (CT)
##### 6.1.4.1 Test Purpose (TP) {#test-purpose-tp-7 .H6}
##### (1) {#section-30 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a standalone group SDS message with a
disposition request of \"DELIVERY\" }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message
**and** sends a SIP MESSAGE message with a disposition notification of
\"DELIVERED\" **and** renders the contents of the Payload IE to the MCDATA
User }
}
##### 6.1.4.2 Conformance requirements {#conformance-requirements-7 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.2.2.2, 9.2.1.2, 9.2.1.3, 12.2.1.1,
6.2.3.1, 6.2.4.1. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.2.2.2]
Upon receipt of a \"SIP MESSAGE request for standalone SDS for terminating
MCData client\", the MCData client:
...
3) if the SIP MESSAGE request contains an application/mikey MIME body
containing a MIKEY-SAKKE I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP MESSAGE request with a SIP 606 (Not Acceptable) response, and
include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE
failed\" in a Warning header field as specified in subclause 4.9 and not
continue with rest of the steps in this subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to exchange end-to-
end secure message.
4) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
5) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
6) shall handle the received message as specified in subclause 9.2.1.2.
[TS 24.282, clause 9.2.1.2]
When a MCData client has received a SIP request containing:
\- an application/vnd.3gpp.mcdata-signalling MIME body as specified in
subclause E.1; and
\- an application/vnd.3gpp.mcdata-payload MIME body as specified in subclause
E.2;
the MCData Client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body;
2) shall decode the contents of the application/vnd.3gpp.mcdata-payload MIME
body;
...
5) shall identify the number of Payload IEs in the DATA PAYLOAD message from
the Number of payloads IE in the DATA PAYLOAD message;
6) if the SDS SIGNALLING PAYLOAD message does not contain an Application ID
IE:
a) shall determine that the payload contained in the DATA PAYLOAD message is
for user consumption
b) may notify the MCData user; and
c) shall render the contents of the Payload IE(s) to the MCData user;
7) if the SDS SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the DATA PAYLOAD message is
not for user consumption,
b) shall not notify the MCData user;
c) if the Application ID value is unknown, shall discard the SDS message; and
d) if the Application ID value is known, shall deliver the contents of the
Payload IE(s) to the identified application;
NOTE 1: If required, the MCData client decrypts the Payload IEs before
rendering the SDS message to the user or delivering the SDS message to the
application.
...
NOTE 3: User consent is not required before accepting the data.
8) may store the message payload in local storage along with the Conversation
ID, Message ID, InReplyTo message ID and Date and time; and
9) if the received SDS SIGNALLING PAYLOAD message contains an SDS disposition
request type IE shall follow the procedures in subclause 9.2.1.3.
[TS 24.282, clause 9.2.1.3]
To handle the disposition requests, the MCData client:
1) If the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a delivered notification as described in
subclause 12.2.1.1;
b) \"READ\", shall send a read notification as described in subclause
12.2.1.1, when a display indication is received; or
c) \"DELIVERY AND READ\" then, shall start timer TDU1 (delivery and read).
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
...
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.3.1]
In order to generate an SDS notification, the MCData client:
1) shall generate an SDS NOTIFICATION message as specified in subclause
15.1.5; and
2) shall include in the SIP request, the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an SDS NOTIFICATION message as specified in subclause 15.1.5,
the MCData client:
1) if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\" as specified in subclause 15.2.5;
...
5) shall set the Date and time IE to the current time to as specified in
subclause 15.2.8;
6) shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message as specified in subclause 15.2.9;
7) shall set the Message ID to the value of the Message ID that was received
in the SDS message as specified in subclause 15.2.10;
8) if the SDS message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
...
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
##### 6.1.4.3 Test description {#test-description-7 .H6}
##### 6.1.4.3.1 Pre-test conditions {#pre-test-conditions-7 .H6}
##### System Simulator: {#system-simulator-3 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-3 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-3 .H6}
\- The \ element shall not be present in
the MCData Service Configuration document so that according to TS 24.484 [24]
there is no size limit imposed for the use of C-plane procedures for the SDS
message.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.4.3.2 Test procedure sequence {#test-procedure-sequence-7 .H6}
Table 6.1.4.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-1B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive a | | | | | | | standalone | | | | | | | group SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The RRC | | | | | | | connection | | | | | | | is not | | | | | | | released | | | | | | | at the end | | | | | | | of the | | | | | | | procedure. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.4.3.3 Specific message contents {#specific-message-contents-7 .H6}
Table 6.1.4.3.3-1: SIP MESSAGE from the SS (step 1A, Table 6.1.4.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.4.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.4.3.3-3  
MIME body part **MCData Data message**  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.4.3.3-3
Table 6.1.4.3.3-2: MCData-Info (Table 6.1.4.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_grp
* * *
Table 6.1.4.3.3-3: SDS SIGNALLING PAYLOAD (Table 6.1.4.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.1.4.3.3-4: DATA PAYLOAD (Table 6.1.4.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-2
* * *
Table 6.1.4.3.3-5: Void
Table 6.1.4.3.3-6: SIP MESSAGE from the UE (step 3, Table 6.1.4.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-headers MCData-Info as described in Table 6.1.4.3.3-7  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.4.3.3-8
Table 6.1.4.3.3-7: MCData-Info (Table 6.1.4.3.3-6)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI set to
px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table 5.5.3.2.1-3A
Table 6.1.4.3.3-8: SDS NOTIFICATION (Table 6.1.4.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
### 6.1.5 On-network / Short Data Service (SDS) / Standalone SDS Using Media
Plane / One-to-one Standalone SDS / Client Originated (CO)
##### 6.1.5.1 Test Purpose (TP) {#test-purpose-tp-8 .H6}
##### (1) {#section-31 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a one-to-one standalone SDS
message using the media plane}
**then** { UE (MCDATA Client) sends a request to establish an MSRP connection
via a SIP INVITE message **and** then responds to the SIP 200 (OK) message
with a SIP ACK message }
}
##### (2) {#section-32 .H6}
**with** { UE (MCDATA Client) having requested the establishment of a MSRP
connection }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP 200 (OK) message with the a=setup
attribute set to \"passive\" from the SS (MCDATA server) }
**then** { UE (MCDATA Client) sends a blank MSRP SEND message to bind the MSRP
connection **and** then sends the one-to-one standalone SDS message via a MSRP
SEND message with a disposition of \"DELIVERY\" }
}
##### (3) {#section-33 .H6}
**with** { UE (MCDATA Client) having sent a one-to-one standalone SDS message
using the media plane }
**ensure that** {
**when** { UE (MCDATA Client receives a MSRP 200 (OK) message in response to
the last MSRP SEND message indicating that the standalone SDS message has been
successfully transferred }
**then** { UE (MCDATA Client) sends a SIP BYE message }
}
##### (4) {#section-34 .H6}
**with** { UE (MCDATA Client) having sent a one-to-one standalone SDS message
using the media plane with a disposition of \"DELIVERY\" }
**ensure that** {
**when** { UE (MCDATA Client receives a disposition response via a SIP MESSAGE
message from the SS (MCDATA Server }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.1.5.2 Conformance requirements {#conformance-requirements-8 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.3.2.3, 9.2.3.2.1, 13.2.2.2.2.1, 12.2.1.2,
TS 24.582 clauses 6.1.1.2.1, 6.1.1.2.2, 6.1.1.2.3, 6.1.1.2.4. The following
represents a copy/paste extraction of the requirements relevant to the test
purpose; any references within the copy/paste text should be understood within
the scope of the core spec they have been copied from. Unless otherwise
stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.3.2.3]
The MCData client shall generate a SIP INVITE request in accordance with 3GPP
TS 24.229 [5] with the clarifications given below.
The MCData client:
1) shall include the g.3gpp.mcdata.sds media feature tag and the g.3gpp.icsi-
ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP INVITE request;
5) should include the \"timer\" option tag in the Supported header field;
6) should include the Session-Expires header field according to IETF RFC 4028
[38]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
7) if a one-to-one standalone SDS message is to be sent:
a) shall insert in the SIP INVITE request a MIME resource-lists body with the
MCData ID of the invited MCData user, according to rules and procedures of
IETF RFC 5366 [18];
b) shall contain an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"one-to-one-sds\"; and
c) if an end-to-end security context needs to be established and the security
context does not exist or if the existing security context has expired, then:
i) if necessary, shall instruct the key management client to request keying
material from the key management server as described in 3GPP TS 33.180 [26];
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [26];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [26];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [26];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [26];
vi) shall add the MCData ID of the originating MCData to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26]; and
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCData user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.180 [26];
...
9) shall set the Request-URI of the SIP INVITE request to the public service
identity identifying the participating MCData function serving the MCData
user;
NOTE 2: The MCData client is configured with public service identity
identifying the participating MCData function serving the MCData user.
10) may include a P-Preferred-Identity header field in the SIP INVITE request
containing a public user identity as specified in 3GPP TS 24.229 [5];
11) shall include an SDP offer according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.3.2.1; and
12) shall send the SIP INVITE request towards the MCData server according to
3GPP TS 24.229 [5].
On receipt of a SIP 2xx response to the SIP INVITE request, the MCData client:
1) shall send a SIP ACK request as specified in 3GPP TS 24.229 [5];
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [38]; and
3) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.1.2.
...
On receipt of an indication from the media plane indicating that the
standalone SDS message has been successfully transferred, the MCData client
shall:
1) shall generate a SIP BYE request according to 3GPP TS 24.229 [5] with:
a) Reason code set to \"SIP\";
b) cause set to \"200\"; and
c) text set to \"transmission succeeded\";
2) shall set the Request-URI to the MCData session identity to release; and
3) shall send a SIP BYE request towards MCData server according to 3GPP TS
24.229 [5].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCData
client shall interact with the media plane and indicate to terminate the
session, as specified in 3GPP TS 24.582 [15].
[TS 24.282, clause 9.2.3.2.1]
When composing an SDP offer according to 3GPP TS 24.229 [5], IETF RFC 4975
[17], IETF RFC 6135 [19] and IETF RFC 6714 [20] the MCData client:
1) shall include an \"m=message\" media-level section for the MCData media
stream consisting of:
a) the IP address and the port number;
b) a protocol field value of \"TCP/MSRP\", or \"TCP/TLS/MSRP\" for TLS;
c) a format list field set to \'*\';
d) an \"a=sendonly\" attribute;
e) an \"a=path\" attribute containing its own MSRP URI;
f) set the content type as \"a=accept-types:application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload\"; and
g) set the a=setup attribute as \"actpass\"; and
2) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\"
attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF
RFC 4567 [45].
[TS 24.282, clause 13.2.2.2.2.1]
When the MCData client wants to release a MCData communication established
over the media plane, the MCData client:
1) shall generate a SIP BYE request according to 3GPP TS 24.229 [5];
2) shall set the Request-URI to the MCData session identity to be released;
and
3) shall send the SIP BYE request towards MCData server according to 3GPP TS
24.229 [5].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCData
client shall release all media plane resources corresponding to the MCData
communication being released.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
[TS 24.582, clause 6.1.1.2.1]
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
If MSRP chunking is not used then on receipt of a 200 (OK) response, the
MCData client shall terminate the SIP session as specified in 3GPP TS 24.282
[8].
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the SDS message could not be sent; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
On receiving an indication to terminate the session from the signalling plane,
the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks and may indicate to MCData user that the SDS message
could not be sent.
[TS 24.582, clause 6.1.1.2.2]
In order to generate an SDS signalling payload, the MCData client:
1\. shall generate an SDS SIGNALLING PAYLOAD message as specified in 3GPP TS
24.282 [8]; and
2\. shall include the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8]; and
When generating a an SDS SIGNALLING PAYLOAD message, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD message as defined in 3GPP TS
24.282 [8]. In the SDS SIGNALLING PAYLOAD message, the MCData client:
a. may include and set the Disposition request type IE to:
i. \"DELIVERY\", if only delivery disposition is requested;
ii. \"READ\", if only read disposition is requested; or
iii. \"DELIVERY AND READ\", if both delivery and read dispositions are
requested;
b. shall set Date and time IE to current UTC time;
c. shall set Conversation ID IE to a universally unique message ID generated
as per IETF RFC 4122 [10];
d. shall set Message ID IE to a universally unique message ID generated as per
IETF RFC 4122 [10];
e. if indicated that the SDS message is in reply to another SDS message then,
shall include the Reply ID IE set to the message identifier of the indicated
SDS message; and
f. if indicated that the target recipient of the SDS message is an application
then, shall set Application Identifier IE to the application identifier.
[TS 24.582, clause 6.1.1.2.3]
In order to generate SDS data payload, the MCData client:
1\. shall generate a DATA PAYLOAD message as specified in 3GPP TS 24.282 [8];
and
2\. shall include the DATA PAYLOAD message in an application/vnd.3gpp.mcdata-
payload MIME body as specified in 3GPP TS 24.282 [8].
When generating a DATA PAYLOAD message, the MCData client:
1\. shall generate a SDS DATA PAYLOAD message as defined in 3GPP TS 24.282
[8]. In the SDS DATA PAYLOAD message, the MCData client:
a. shall set Number of payloads IE to the total number of payloads being sent;
and
b. for each payload, shall include Payload IE. In the Payload IE:
i. shall set Payload content type to \"TEXT\", or \"BINARY\", or
\"HYPERLINKS\", or \"LOCATION\" according to the payload type; and
ii. shall set Payload data IE to actual payload.
[TS 24.582, clause 6.1.1.2.4]
The MCData client shall take the procedures in subclause 6.4.1 into
consideration when generating MSRP SEND messages.
The MCData client shall generate MSRP SEND for SDS message requests according
to IETF RFC 4975 [11].
When generating an MSRP SEND for SDS message request containing an SDS
SIGNALLING PAYLOAD message and an SDS DATA PAYLOAD message, the MCData client
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the first content type as Content-Type =
\"application/vnd.3gpp.mcdata-signalling\";
3\. shall set the first body of the MSRP SEND request to the generated SDS
SIGNALLING PAYLOAD message;
4\. shall set the second Content-Type as \"application/vnd.3gpp.mcdata-
payload\"; and
5\. shall set the second body of the MSRP SEND request to the generated SDS
DATA PAYLOAD message.
When generating an MSRP SEND for SDS message request containing only an SDS
DATA PAYLOAD message, the MCData client:
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the Content-Type as \"application/vnd.3gpp.mcdata-payload\"; and
3\. shall set the body of the MSRP SEND request to the generated SDS DATA
PAYLOAD message.
When generating an MSRP SEND for SDS message request containing only an SDS
SIGNALLING PAYLOAD, the MCData client.
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the Content-Type as \"application/vnd.3gpp.mcdata-signalling\";
and
3\. shall set the body of the MSRP SEND request to the generated SDS
SIGNALLING PAYLOAD message.
##### 6.1.5.3 Test description {#test-description-8 .H6}
##### 6.1.5.3.1 Pre-test conditions {#pre-test-conditions-8 .H6}
##### System Simulator: {#system-simulator-4 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-4 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-4 .H6}
\- The \ element of the MCData Service
Configuration document shall be set to 0 to force the MCData client to send
the data using the media plane.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.5.3.2 Test procedure sequence {#test-procedure-sequence-8 .H6}
Table 6.1.5.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | one-to-one | | | | | | | standalone | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"**DEL | | | | | | | IVERY** \". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | Call | | | | | | | Establish | | | | | | | ment****\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.2.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'CO MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | to **send | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.6.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | - | - | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'MCX SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | to | | | | | | | **receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 7? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.5.3.3 Specific message contents {#specific-message-contents-8 .H6}
Table 6.1.5.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.5.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MCDATA_SDS,
MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body As described in Table 6.1.5.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.5.3.3-3
Table 6.1.5.3.3-2: SDP for SIP INVITE (Table 6.1.5.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_OFFER, MCD_1to1
* * *
Table 6.1.5.3.3-3: MCData-Info (Table 6.1.5.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_1to1
* * *
Table 6.1.5.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.1.5.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
SDP message As described in Table 6.1.5.3.3-5
Table 6.1.5.3.3-5: SDP for SIP 200 (OK) (Table 6.1.5.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_ANSWER
* * *
Table 6.1.5.3.3-6: MSRP SEND from the UE (step 7, Table 6.1.5.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message or chunk of message as specified in table 6.1.5.3.3-6A_
Table 6.1.5.3.3-6A: MIME Message (step 7, Table 6.1.5.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.5.3.3-6B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body DATA PAYLOAD as described in Table 6.1.5.3.3-7
Table 6.1.5.3.3-6B: SDS SIGNALLING PAYLOAD (Table 6.1.5.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.1.5.3.3-7: Data Payload (Table 6.1.5.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-1
* * *
Table 6.1.5.3.3-8..9: Void
Table 6.1.5.3.3-10: SIP BYE from the UE (step 8, Table 6.1.5.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason** RFC 3326 [125]  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.1.5.3.3-11: Void
Table 6.1.5.3.3-12: SIP MESSAGE from the SS (step 10, Table 6.1.5.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.5.3.3-14
Table 6.1.5.3.3-13: Void
Table 6.1.5.3.3-14: SDS NOTIFICATION (Table 6.1.5.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.1.5.3.3-15: Void
### 6.1.6 On-network / Short Data Service (SDS) / Standalone SDS Using Media
Plane / One-to-one Standalone SDS / Client Terminated (CT)
##### 6.1.6.1 Test Purpose (TP) {#test-purpose-tp-9 .H6}
##### (1) {#section-35 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a SIP INVITE to initiate a standalone one-
to-one SDS message using the media plane }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### (2) {#section-36 .H6}
**with** { UE (MCDATA Client) having responded to the SIP INVITE message that
initiated a standalone one-to-one SDS message using the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message from the SS
(MCDATA Server) }
**then** { UE (MCDATA Client) responds with an MSRP 200 (OK) message **and**
if the MSRP SEND message is not blank, renders the contents of the Payload IE
to the MCDATA User and sends a SIP MESSAGE message with a disposition
notification of \"DELIVERED\" }
}
##### (3) {#section-37 .H6}
**with** { UE (MCDATA Client) having responded to the MSRP SEND message from
the SS (MCDATA server) }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP BYE message to release
communications }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message }
}
##### 6.1.6.2 Conformance requirements {#conformance-requirements-9 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.3.2.4, 9.2.3.2.2, 13.2.2.2.2.2, 9.2.1.3,
12.2.1.1, 6.2.4.1, 6.2.3.1, TS 24.582 clauses 6.1.1.3.1, 6.1.1.3.2. The
following represents a copy/paste extraction of the requirements relevant to
the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.3.2.4]
Upon receipt of an initial SIP INVITE request, the MCData client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [5] with the clarifications below.
The MCData client:
1) may reject the SIP INVITE request if either of the following conditions are
met:
a) MCData client does not have enough resources to handle the call; or
b) any other reason outside the scope of this specification;
and skip the rest of the steps after step 2;
2) if the SIP INVITE request is rejected in step 1), shall respond toward
participating MCData function either with appropriate reject code as specified
in 3GPP TS 24.229 [5] and warning texts as specified in subclause 4.9 or with
SIP 480 (Temporarily unavailable) response not including warning texts if the
user is authorised to restrict the reason for failure and skip the rest of the
steps of this subclause;
3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as
specified in IETF RFC 4567 [45], and include warning text set to \"136
authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field
as specified in subclause 4.9 and not continue with rest of the steps in this
subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to create an end-to-
end secure session.
3) may display to the MCData user the MCData ID of the inviting MCData user
and the type of SDS request;
4) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [5];
5) shall include the option tag \"timer\" in a Require header field of the SIP
200 (OK) response;
6) shall include the Session-Expires header field in the SIP 200 (OK) response
and start the SIP session timer according to IETF RFC 4028 [38]. The
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\";
7) shall include the g.3gpp.mcdata.sds media feature tag in the Contact header
field of the SIP 200 (OK) response;
8) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in the Contact header field of
the SIP 200 (OK) response;
9) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.3.2.2; and
10) shall send the SIP 200 (OK) response towards the MCData server according
to rules and procedures of 3GPP TS 24.229 [5].
On receipt of an SIP ACK message to the sent SIP 200 (OK) message, the MCData
client shall:
1) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.1.3.
[TS 24.282, clause 9.2.3.2.2]
When the MCData client receives an initial SDP offer for an MCData standalone
SDS, the MCData client shall process the SDP offer and shall compose an SDP
answer according to 3GPP TS 24.229 [5] and IETF RFC 4975 [17].
When composing an SDP answer, the MCData client:
1) shall include an \"m=message\" media-level section for the accepted MCData
media stream consisting of:
a) the port number;
b) a protocol field value of \"TCP/MSRP\", or \"TCP/TLS/MSRP\" for TLS
according to the received SDP offer;
c) a format list field set to \'*\';
d) an \"a=recvonly\" attribute;
e) an \"a=path\" attribute containing its own MSRP URI;
f) set the content type as a=accept-types: application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload; and
g) set the a=setup attribute according to IETF RFC 6135 [19].
[TS 24.282, clause 13.2.2.2.2.2]
Upon receiving a SIP BYE request, the MCData client:
1) shall send SIP 200 (OK) response towards MCData server according to 3GPP TS
24.229 [5]; and
2) shall release all media plane resources corresponding to the MCData
communication being released.
NOTE: Partially received data can be stored and processed.
[TS 24.282, clause 9.2.1.3]
To handle the disposition requests, the MCData client:
1) If the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a delivered notification as described in
subclause 12.2.1.1;
b) \"READ\", shall send a read notification as described in subclause
12.2.1.1, when a display indication is received; or
c) \"DELIVERY AND READ\" then, shall start timer TDU1 (delivery and read).
Upon receiving a display indication before timer TDU1 (delivery and read)
expires, the MCData client:
1) shall stop timer TDU1 (delivery and read); and
2) shall send a delivered and read notification as described in subclause
12.2.1.1.
Upon expiry of timer TDU1 (delivery and read), the MCData client:
1) shall send a delivered notification as described in subclause 12.2.1.1; and
2) upon receiving a display indication, send a read notification as described
in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
2) when sending FD messages, FD disposition notifications or FD media storage
function discovery messages:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.fd media feature tag along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.fd\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
[TS 24.282, clause 6.2.3.1]
In order to generate an SDS notification, the MCData client:
1) shall generate an SDS NOTIFICATION message as specified in subclause
15.1.5; and
2) shall include in the SIP request, the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an SDS NOTIFICATION message as specified in subclause 15.1.5,
the MCData client:
1) if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\" as specified in subclause 15.2.5;
2) if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\" as specified in subclause 15.2.5;
3) if sending a delivered and read notification, shall set the SDS disposition
notification type IE as \"DELIVERED AND READ\" as specified in subclause
15.2.5;
4) if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\" as specified in subclause 15.2.5;
5) shall set the Date and time IE to the current time to as specified in
subclause 15.2.8;
6) shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message as specified in subclause 15.2.9;
7) shall set the Message ID to the value of the Message ID that was received
in the SDS message as specified in subclause 15.2.10;
8) if the SDS message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
9) if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message as specified in subclause 15.2.3.
[TS 24.582, clause 6.1.1.3.1]
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the terminating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP connection is established, the MCData client:
1\. on receipt of an MSRP request in an MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData standalone
message before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.1.3.2.
[TS 24.582, clause 6.1.1.3.2]
The MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body;
2\. shall decode the contents of the application/vnd.3gpp.mcdata-payload MIME
body;
3\. if the SDS SIGNALLING PAYLOAD message contains a new Conversation ID,
shall instantiate a new conversation with the Message ID in the SDS SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
4\. if the SDS SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
a. if the SDS SIGNALLING PAYLOAD message does not contain an InReplyTo Message
ID, shall use the Message ID in the SDS SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
b. if the SDS SIGNALLING PAYLOAD message contains an InReplyTo Message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo Message ID in the SDS SIGNALLING PAYLOAD and
use the Message ID in the SDS SIGNALLING PAYLOAD to identify the new message;
5\. shall identify the number of Payload IEs in the DATA PAYLOAD message from
the Number of Payloads IE in the DATA PAYLOAD message;
6\. if the SDS SIGNALLING PAYLOAD message does not contain an Application
identifier IE:
a. shall determine that the payload contained in the DATA PAYLOAD message is
for user consumption;
b. may notify the MCData user; and
c. shall render the contents of the Payload IE(s) to the MCData user;
7\. if the SDS SIGNALLING PAYLOAD message contains an Application identifier
IE:
a. shall determine that the payload contained in the DATA PAYLOAD message is
not for user consumption;
b. shall not notify the MCData user;
c. if the Application identifier value is unknown, shall discard the SDS
message; and
d. if the Application identifier value is known, shall deliver the contents of
the Payload IE(s) to the identified application; and
8\. if SDS Disposition request type IE is present in the SDS SIGNALLING
PAYLOAD message received in subclause 6.1.1.3.1 then, shall send a disposition
notification as described in 3GPP TS 24.282 [8] subclause 9.2.1.3.
##### 6.1.6.3 Test description {#test-description-9 .H6}
##### 6.1.6.3.1 Pre-test conditions {#pre-test-conditions-9 .H6}
##### System Simulator: {#system-simulator-5 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-5 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-5 .H6}
\- The \ element of the MCData Service
Configuration document shall be set to 0 to force the MCData client to send
the data using the media plane.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.6.3.2 Test procedure sequence {#test-procedure-sequence-9 .H6}
Table 6.1.6.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.3.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 2-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'CT MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | to | | | | | | | **receive | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.7.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9-10 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer** | | | | | | | using | | | | | | | signalling | | | | | | | plane\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | to **send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.6.3.3 Specific message contents {#specific-message-contents-9 .H6}
Table 6.1.6.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.6.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.1.6.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.6.3.3-3
Table 6.1.6.3.3-2: SDP for SIP INVITE (Table 6.1.6.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_OFFER, MCD_1to1
* * *
Table 6.1.6.3.3-3: MCData-Info (Table 6.1.6.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_1to1
* * *
Table 6.1.6.3.3-4: SIP 200 (OK) from the UE (step 1, Table 6.1.6.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
value \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.1.6.3.3-5
Table 6.1.6.3.3-5: SDP for SIP 200 (OK) (Table 6.1.6.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_ANSWER
* * *
Table 6.1.6.3.3-6: MSRP SEND from the SS (step 6, Table 6.1.6.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message as specified in table 6.1.6.3.3-6A_
Table 6.1.6.3.3-6A: MIME Message (step 6, Table 6.1.6.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.6.3.3-6B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body DATA PAYLOAD as described in Table 6.1.6.3.3-7
Table 6.1.6.3.3-6B: SDS SIGNALLING PAYLOAD (Table 6.1.6.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.1.6.3.3-7: Data Payload (Table 6.1.6.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-2
* * *
Table 6.1.6.3.3-8: SIP BYE from the SS (step 8, Table 6.1.6.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.7.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason** RFC 3326 [125]  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.1.6.3.3-9: Void
Table 6.1.6.3.3-10: SIP MESSAGE from the UE (step 11, Table 6.1.6.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part _not present_ **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.6.3.3-11
Table 6.1.6.3.3-11: SDS NOTIFICATION (Table 6.1.6.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
### 6.1.7 On-network / Short Data Service (SDS) / Standalone SDS Using Media
Plane / Group Standalone SDS / Client Originated (CO)
##### 6.1.7.1 Test Purpose (TP) {#test-purpose-tp-10 .H6}
##### (1) {#section-38 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a group standalone SDS message
using the media plane}
**then** { UE (MCDATA Client) sends a request to establish an MSRP connection
via a SIP INVITE message **and** then responds to the SIP 200 (OK) message
with a SIP ACK message }
}
##### (2) {#section-39 .H6}
**with** { UE (MCDATA Client) having requested the establishment of a MSRP
connection }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP 200 (OK) message with the a=setup
attribute set to \"passive\" }
**then** { UE (MCDATA Client) sends a blank MSRP SEND message to bind the MSRP
connection **and** then sends the group standalone SDS message via a MSRP SEND
message with a disposition of \"DELIVERY\" }
}
##### (3) {#section-40 .H6}
**with** { UE (MCDATA Client) having sent a group standalone SDS message using
the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives a MSRP 200 (OK) message in response to
the last MSRP SEND message indicating that the standalone SDS message has been
successfully transferred }
**then** { UE (MCDATA Client) sends a SIP BYE message }
}
##### (4) {#section-41 .H6}
**with** { UE (MCDATA Client) having sent a group standalone SDS message using
the media plane with a disposition of \"DELIVERY\" }
**ensure that** {
**when** { UE (MCDATA Client) receives a disposition response via a SIP
MESSAGE message }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.1.7.2 Conformance requirements {#conformance-requirements-10 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.3.2.3, 9.2.3.2.1, 13.2.2.2.2.1, 12.2.1.2,
TS 24.582 clauses 6.1.1.2.1, 6.1.1.2.2, 6.1.1.2.3, 6.1.1.2.4. The following
represents a copy/paste extraction of the requirements relevant to the test
purpose; any references within the copy/paste text should be understood within
the scope of the core spec they have been copied from. Unless otherwise
stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.3.2.3]
The MCData client shall generate a SIP INVITE request in accordance with 3GPP
TS 24.229 [5] with the clarifications given below.
The MCData client:
1) shall include the g.3gpp.mcdata.sds media feature tag and the g.3gpp.icsi-
ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP INVITE request;
5) should include the \"timer\" option tag in the Supported header field;
6) should include the Session-Expires header field according to IETF RFC 4028
[38]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
7) if a one-to-one standalone SDS message is to be sent:
a) shall insert in the SIP INVITE request a MIME resource-lists body with the
MCData ID of the invited MCData user, according to rules and procedures of
IETF RFC 5366 [18];
b) shall contain an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"one-to-one-sds\"; and
c) if an end-to-end security context needs to be established and the security
context does not exist or if the existing security context has expired, then:
i) if necessary, shall instruct the key management client to request keying
material from the key management server as described in 3GPP TS 33.180 [26];
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [26];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [26];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [26];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [26];
vi) shall add the MCData ID of the originating MCData to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26]; and
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCData user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.180 [26];
...
9) shall set the Request-URI of the SIP INVITE request to the public service
identity identifying the participating MCData function serving the MCData
user;
NOTE 2: The MCData client is configured with public service identity
identifying the participating MCData function serving the MCData user.
10) may include a P-Preferred-Identity header field in the SIP INVITE request
containing a public user identity as specified in 3GPP TS 24.229 [5];
11) shall include an SDP offer according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.3.2.1; and
12) shall send the SIP INVITE request towards the MCData server according to
3GPP TS 24.229 [5].
On receipt of a SIP 2xx response to the SIP INVITE request, the MCData client:
1) shall send a SIP ACK request as specified in 3GPP TS 24.229 [5];
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [38]; and
3) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.1.2.
...
On receipt of an indication from the media plane indicating that the
standalone SDS message has been successfully transferred, the MCData client
shall:
1) shall generate a SIP BYE request according to 3GPP TS 24.229 [5] with:
a) Reason code set to \"SIP\";
b) cause set to \"200\"; and
c) text set to \"transmission succeeded\";
2) shall set the Request-URI to the MCData session identity to release; and
3) shall send a SIP BYE request towards MCData server according to 3GPP TS
24.229 [5].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCData
client shall interact with the media plane and indicate to terminate the
session, as specified in 3GPP TS 24.582 [15].
[TS 24.282, clause 9.2.3.2.1]
When composing an SDP offer according to 3GPP TS 24.229 [5], IETF RFC 4975
[17], IETF RFC 6135 [19] and IETF RFC 6714 [20] the MCData client:
1) shall include an \"m=message\" media-level section for the MCData media
stream consisting of:
a) the IP address and the port number;
b) a protocol field value of \"TCP/MSRP\", or \"TCP/TLS/MSRP\" for TLS;
c) a format list field set to \'*\';
d) an \"a=sendonly\" attribute;
e) an \"a=path\" attribute containing its own MSRP URI;
f) set the content type as \"a=accept-types:application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload\"; and
g) set the a=setup attribute as \"actpass\"; and
2) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\"
attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF
RFC 4567 [45].
[TS 24.282, clause 13.2.2.2.2.1]
When the MCData client wants to release a MCData communication established
over the media plane, the MCData client:
1) shall generate a SIP BYE request according to 3GPP TS 24.229 [5];
2) shall set the Request-URI to the MCData session identity to be released;
and
3) shall send the SIP BYE request towards MCData server according to 3GPP TS
24.229 [5].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCData
client shall release all media plane resources corresponding to the MCData
communication being released.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
[TS 24.582, clause 6.1.1.2.1]
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
If MSRP chunking is not used then on receipt of a 200 (OK) response, the
MCData client shall terminate the SIP session as specified in 3GPP TS 24.282
[8].
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the SDS message could not be sent; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
On receiving an indication to terminate the session from the signalling plane,
the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks and may indicate to MCData user that the SDS message
could not be sent.
[TS 24.582, clause 6.1.1.2.2]
In order to generate an SDS signalling payload, the MCData client:
1\. shall generate an SDS SIGNALLING PAYLOAD message as specified in 3GPP TS
24.282 [8]; and
2\. shall include the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8]; and
When generating a an SDS SIGNALLING PAYLOAD message, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD message as defined in 3GPP TS
24.282 [8]. In the SDS SIGNALLING PAYLOAD message, the MCData client:
a. may include and set the Disposition request type IE to:
i. \"DELIVERY\", if only delivery disposition is requested;
ii. \"READ\", if only read disposition is requested; or
iii. \"DELIVERY AND READ\", if both delivery and read dispositions are
requested;
b. shall set Date and time IE to current UTC time;
c. shall set Conversation ID IE to a universally unique message ID generated
as per IETF RFC 4122 [10];
d. shall set Message ID IE to a universally unique message ID generated as per
IETF RFC 4122 [10];
e. if indicated that the SDS message is in reply to another SDS message then,
shall include the Reply ID IE set to the message identifier of the indicated
SDS message; and
f. if indicated that the target recipient of the SDS message is an application
then, shall set Application Identifier IE to the application identifier.
[TS 24.582, clause 6.1.1.2.3]
In order to generate SDS data payload, the MCData client:
1\. shall generate a DATA PAYLOAD message as specified in 3GPP TS 24.282 [8];
and
2\. shall include the DATA PAYLOAD message in an application/vnd.3gpp.mcdata-
payload MIME body as specified in 3GPP TS 24.282 [8].
When generating a DATA PAYLOAD message, the MCData client:
1\. shall generate a SDS DATA PAYLOAD message as defined in 3GPP TS 24.282
[8]. In the SDS DATA PAYLOAD message, the MCData client:
a. shall set Number of payloads IE to the total number of payloads being sent;
and
b. for each payload, shall include Payload IE. In the Payload IE:
i. shall set Payload content type to \"TEXT\", or \"BINARY\", or
\"HYPERLINKS\", or \"LOCATION\" according to the payload type; and
ii. shall set Payload data IE to actual payload.
[TS 24.582, clause 6.1.1.2.4]
The MCData client shall take the procedures in subclause 6.4.1 into
consideration when generating MSRP SEND messages.
The MCData client shall generate MSRP SEND for SDS message requests according
to IETF RFC 4975 [11].
When generating an MSRP SEND for SDS message request containing an SDS
SIGNALLING PAYLOAD message and an SDS DATA PAYLOAD message, the MCData client
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the first content type as Content-Type =
\"application/vnd.3gpp.mcdata-signalling\";
3\. shall set the first body of the MSRP SEND request to the generated SDS
SIGNALLING PAYLOAD message;
4\. shall set the second Content-Type as \"application/vnd.3gpp.mcdata-
payload\"; and
5\. shall set the second body of the MSRP SEND request to the generated SDS
DATA PAYLOAD message.
When generating an MSRP SEND for SDS message request containing only an SDS
DATA PAYLOAD message, the MCData client:
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the Content-Type as \"application/vnd.3gpp.mcdata-payload\"; and
3\. shall set the body of the MSRP SEND request to the generated SDS DATA
PAYLOAD message.
When generating an MSRP SEND for SDS message request containing only an SDS
SIGNALLING PAYLOAD, the MCData client.
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the Content-Type as \"application/vnd.3gpp.mcdata-signalling\";
and
3\. shall set the body of the MSRP SEND request to the generated SDS
SIGNALLING PAYLOAD message.
##### 6.1.7.3 Test description {#test-description-10 .H6}
##### 6.1.7.3.1 Pre-test conditions {#pre-test-conditions-10 .H6}
##### System Simulator: {#system-simulator-6 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-6 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-6 .H6}
\- The \ element of the MCData Service
Configuration document shall be set to 0 to force the MCData client to send
the data using the media plane.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.7.3.2 Test procedure sequence {#test-procedure-sequence-10 .H6}
Table 6.1.7.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | group | | | | | | | standalone | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"**DEL | | | | | | | IVERY** \". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | Call | | | | | | | Establi | | | | | | | shment** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.2.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.6.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 7? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.7.3.3 Specific message contents {#specific-message-contents-10 .H6}
Table 6.1.7.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.7.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body As described in Table 6.1.7.3.3-1A  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.7.3.3-2
Table 6.1.7.3.3-1A: SDP for SIP INVITE (Table 6.1.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_OFFER
* * *
Table 6.1.7.3.3-2: MCData-Info (Table 6.1.7.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
Table 6.1.7.3.3-3: SIP 200 (OK) from the SS (step 2, Table 6.1.7.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
SDP message As described in Table 6.1.7.3.3-4
Table 6.1.7.3.3-4: SDP for SIP 200 (OK) (Table 6.1.7.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_ANSWER
* * *
Table 6.1.7.3.3-5: MSRP SEND from the UE (step 7, Table 6.1.7.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message or chunk of message as specified in table 6.1.7.3.3-5A_
Table 6.1.7.3.3-5A: MIME Message (step 7, Table 6.1.7.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.7.3.3-5B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.7.3.3-6
Table 6.1.7.3.3-5B: SDS SIGNALLING PAYLOAD (Table 6.1.7.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.1.7.3.3-6: Data Payload (Table 6.1.7.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-1
* * *
Table 6.1.7.3.3-7..8: Void
Table 6.1.7.3.3-9: SIP BYE from the UE (step 8, Table 6.1.7.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason** RFC 3326 [125]  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.1.7.3.3-10: Void
Table 6.1.7.3.3-11: SIP MESSAGE from the SS (step 10, Table 6.1.7.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body As described in Table 6.1.7.3.3-12  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.7.3.3-13
Table 6.1.7.3.3-12: MCData-Info (Table 6.1.7.3.3-11)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.1.7.3.3-13: SDS NOTIFICATION (Table 6.1.7.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.1.7.3.3-14: Void
### 6.1.8 On-network / Short Data Service (SDS) / Standalone SDS Using Media
Plane / Group Standalone SDS / Client Terminated (CT)
##### 6.1.8.1 Test Purpose (TP) {#test-purpose-tp-11 .H6}
##### (1) {#section-42 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a SIP INVITE to initiate a standalone
group SDS message using the media plane }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
(2)
**with** { UE (MCDATA Client) having responded to the SIP INVITE message that
initiated a standalone group SDS message using the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message }
**then** { UE (MCDATA Client) responds with an MSRP 200 (OK) message **and**
if the MSRP SEND message is not blank, renders the contents of the Payload IE
to the MCDATA User and sends a SIP MESSAGE message with a disposition
notification of \"DELIVERED\" }
}
##### (3) {#section-43 .H6}
**with** { UE (MCDATA Client) having responded to the MSRP SEND message from
the SS (MCDATA server) }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP BYE message to release
communications }
**then** { UE (MCDATA Client) sends a SIP 200 (OK) message }
}
##### 6.1.8.2 Conformance requirements {#conformance-requirements-11 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.3.2.4, 9.2.3.2.2, 13.2.2.2.2.2, 9.2.1.3,
12.2.1.1, 6.2.4.1, 6.2.3.1, TS 24.582 clauses 6.1.1.3.1, 6.1.1.3.2. The
following represents a copy/paste extraction of the requirements relevant to
the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.3.2.4]
Upon receipt of an initial SIP INVITE request, the MCData client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [5] with the clarifications below.
The MCData client:
1) may reject the SIP INVITE request if either of the following conditions are
met:
a) MCData client does not have enough resources to handle the call; or
b) any other reason outside the scope of this specification;
and skip the rest of the steps after step 2;
2) if the SIP INVITE request is rejected in step 1), shall respond toward
participating MCData function either with appropriate reject code as specified
in 3GPP TS 24.229 [5] and warning texts as specified in subclause 4.9 or with
SIP 480 (Temporarily unavailable) response not including warning texts if the
user is authorised to restrict the reason for failure and skip the rest of the
steps of this subclause;
3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as
specified in IETF RFC 4567 [45], and include warning text set to \"136
authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field
as specified in subclause 4.9 and not continue with rest of the steps in this
subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to create an end-to-
end secure session.
3) may display to the MCData user the MCData ID of the inviting MCData user
and the type of SDS request;
4) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [5];
5) shall include the option tag \"timer\" in a Require header field of the SIP
200 (OK) response;
6) shall include the Session-Expires header field in the SIP 200 (OK) response
and start the SIP session timer according to IETF RFC 4028 [38]. The
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\";
7) shall include the g.3gpp.mcdata.sds media feature tag in the Contact header
field of the SIP 200 (OK) response;
8) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in the Contact header field of
the SIP 200 (OK) response;
9) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.3.2.2; and
10) shall send the SIP 200 (OK) response towards the MCData server according
to rules and procedures of 3GPP TS 24.229 [5].
On receipt of an SIP ACK message to the sent SIP 200 (OK) message, the MCData
client shall:
1) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.1.3.
[TS 24.282, clause 9.2.3.2.2]
When the MCData client receives an initial SDP offer for an MCData standalone
SDS, the MCData client shall process the SDP offer and shall compose an SDP
answer according to 3GPP TS 24.229 [5] and IETF RFC 4975 [17].
When composing an SDP answer, the MCData client:
1) shall include an \"m=message\" media-level section for the accepted MCData
media stream consisting of:
a) the port number;
b) a protocol field value of \"TCP/MSRP\", or \"TCP/TLS/MSRP\" for TLS
according to the received SDP offer;
c) a format list field set to \'*\';
d) an \"a=recvonly\" attribute;
e) an \"a=path\" attribute containing its own MSRP URI;
f) set the content type as a=accept-types: application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload; and
g) set the a=setup attribute according to IETF RFC 6135 [19].
[TS 24.282, clause 13.2.2.2.2.2]
Upon receiving a SIP BYE request, the MCData client:
1) shall send SIP 200 (OK) response towards MCData server according to 3GPP TS
24.229 [5]; and
2) shall release all media plane resources corresponding to the MCData
communication being released.
NOTE: Partially received data can be stored and processed.
[TS 24.282, clause 9.2.1.3]
To handle the disposition requests, the MCData client:
1) If the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a delivered notification as described in
subclause 12.2.1.1;
b) \"READ\", shall send a read notification as described in subclause
12.2.1.1, when a display indication is received; or
c) \"DELIVERY AND READ\" then, shall start timer TDU1 (delivery and read).
Upon receiving a display indication before timer TDU1 (delivery and read)
expires, the MCData client:
1) shall stop timer TDU1 (delivery and read); and
2) shall send a delivered and read notification as described in subclause
12.2.1.1.
Upon expiry of timer TDU1 (delivery and read), the MCData client:
1) shall send a delivered notification as described in subclause 12.2.1.1; and
2) upon receiving a display indication, send a read notification as described
in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
2) when sending FD messages, FD disposition notifications or FD media storage
function discovery messages:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.fd media feature tag along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.fd\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
[TS 24.282, clause 6.2.3.1]
In order to generate an SDS notification, the MCData client:
1) shall generate an SDS NOTIFICATION message as specified in subclause
15.1.5; and
2) shall include in the SIP request, the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an SDS NOTIFICATION message as specified in subclause 15.1.5,
the MCData client:
1) if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\" as specified in subclause 15.2.5;
2) if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\" as specified in subclause 15.2.5;
3) if sending a delivered and read notification, shall set the SDS disposition
notification type IE as \"DELIVERED AND READ\" as specified in subclause
15.2.5;
4) if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\" as specified in subclause 15.2.5;
5) shall set the Date and time IE to the current time to as specified in
subclause 15.2.8;
6) shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message as specified in subclause 15.2.9;
7) shall set the Message ID to the value of the Message ID that was received
in the SDS message as specified in subclause 15.2.10;
8) if the SDS message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
9) if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message as specified in subclause 15.2.3.
[TS 24.582, clause 6.1.1.3.1]
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the terminating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP connection is established, the MCData client:
1\. on receipt of an MSRP request in an MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData standalone
message before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.1.3.2.
[TS 24.582, clause 6.1.1.3.2]
The MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body;
2\. shall decode the contents of the application/vnd.3gpp.mcdata-payload MIME
body;
3\. if the SDS SIGNALLING PAYLOAD message contains a new Conversation ID,
shall instantiate a new conversation with the Message ID in the SDS SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
4\. if the SDS SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
a. if the SDS SIGNALLING PAYLOAD message does not contain an InReplyTo Message
ID, shall use the Message ID in the SDS SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
b. if the SDS SIGNALLING PAYLOAD message contains an InReplyTo Message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo Message ID in the SDS SIGNALLING PAYLOAD and
use the Message ID in the SDS SIGNALLING PAYLOAD to identify the new message;
5\. shall identify the number of Payload IEs in the DATA PAYLOAD message from
the Number of Payloads IE in the DATA PAYLOAD message;
6\. if the SDS SIGNALLING PAYLOAD message does not contain an Application
identifier IE:
a. shall determine that the payload contained in the DATA PAYLOAD message is
for user consumption;
b. may notify the MCData user; and
c. shall render the contents of the Payload IE(s) to the MCData user;
7\. if the SDS SIGNALLING PAYLOAD message contains an Application identifier
IE:
a. shall determine that the payload contained in the DATA PAYLOAD message is
not for user consumption;
b. shall not notify the MCData user;
c. if the Application identifier value is unknown, shall discard the SDS
message; and
d. if the Application identifier value is known, shall deliver the contents of
the Payload IE(s) to the identified application; and
8\. if SDS Disposition request type IE is present in the SDS SIGNALLING
PAYLOAD message received in subclause 6.1.1.3.1 then, shall send a disposition
notification as described in 3GPP TS 24.282 [8] subclause 9.2.1.3.
##### 6.1.8.3 Test description {#test-description-11 .H6}
##### 6.1.8.3.1 Pre-test conditions {#pre-test-conditions-11 .H6}
##### System Simulator: {#system-simulator-7 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-7 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-7 .H6}
\- The \ element of the MCData Service
Configuration document shall be set to 0 to force the MCData client to send
the data using the media plane.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.8.3.2 Test procedure sequence {#test-procedure-sequence-11 .H6}
Table 6.1.8.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.3.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 2-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | to | | | | | | | **receive | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.7.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9-10 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | to **send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.8.3.3 Specific message contents {#specific-message-contents-11 .H6}
Table 6.1.8.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.8.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.1.8.3.3-1A  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.8.3.3-2
Table 6.1.8.3.3-1A: SDP for SIP INVITE (Table 6.1.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_OFFER
* * *
Table 6.1.8.3.3-2: MCData-Info (Table 6.1.8.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_grp
* * *
Table 6.1.8.3.3-3: SIP 200 (OK) from the UE (step 1, Table 6.1.8.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
value \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.1.8.3.3-4
Table 6.1.8.3.3-4: SDP for SIP 200 (OK) (Table 6.1.8.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_ANSWER
* * *
Table 6.1.8.3.3-5: MSRP SEND from the SS (step 6, Table 6.1.8.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message as specified in table 6.1.8.3.3-5A_
Table 6.1.8.3.3-5A: MIME Message (step 6, Table 6.1.8.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.8.3.3-5B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.8.3.3-6
Table 6.1.8.3.3-5B: SDS SIGNALLING PAYLOAD (Table 6.1.8.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.1.8.3.3-6: Data Payload (Table 6.1.8.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-2
* * *
Table 6.1.8.3.3-7: SIP BYE from the SS (step 8, Table 6.1.8.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.7.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason** RFC 3326 [125]  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.1.8.3.3-8: Void
Table 6.1.8.3.3-9: SIP MESSAGE from the UE (step 11, Table 6.1.8.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.8.3.3-10  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.1.6.3.3-11
Table 6.1.8.3.3-10: MCData-Info (Table 6.1.8.3.3-9)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI set to
px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table 5.5.3.2.1-3A
Table 6.1.8.3.3-11: SDS NOTIFICATION (Table 6.1.8.3.3-9)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
### 6.1.9 On-network / Short Data Service (SDS) / SDS Session / One-to-one SDS
Session / Client Originated (CO)
##### 6.1.9.1 Test Purpose (TP) {#test-purpose-tp-12 .H6}
##### (1) {#section-44 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to initiate a one-to-one SDS session using
the media plane}
**then** { UE (MCDATA Client) sends a request to establish a one-to-one SDS
session and a MSRP connection via a SIP INVITE message **and** then responds
to the SIP 200 (OK) message with a SIP ACK message }
}
##### (2) {#section-45 .H6}
**with** { UE (MCDATA Client) having received a SIP 200 (OK) message with the
a=setup attribute set to \"passive\" in response to a SIP INVITE message}
**ensure that** {
**when** { UE (MCDATA Client) responds to the SIP 200 (OK) message with a SIP
ACK message }
**then** { UE (MCData Client) sends a blank MSRP SEND message to bind the MSRP
connection **and** then sends the one-to-one session SDS message via a MSRP
SEND message with a disposition of \"DELIVERY\" }
}
##### (3) {#section-46 .H6}
**with** { UE (MCDATA Client) having sent a one-to-one session SDS message
using the media plane with a disposition of \"DELIVERY\" }
**ensure that** {
**when** { UE (MCDATA Client) receives a disposition response via a MSRP SEND
message }
**then** { UE (MCDATA Client) responds to the MSRP SEND message by sending a
MSRP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### (4) {#section-47 .H6}
**with** { UE (MCDATA Client) having established a one-to-one SDS session and
a MSRP connection }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message with a disposition
of \"READ\" }
**then** { UE (MCDATA Client) responds with a MSRP 200 (OK) message **and**
then renders the contents of the Payload IE to the MCDATA User **and** then
sends a MSRP SEND message with a disposition notification of \"READ\" }
}
##### (5) {#section-48 .H6}
**with** { UE (MCDATA Client) having established a one-to-one SDS session }
**ensure that** {
**when** { the MCDATA User requests to release the one-to-one SDS session }
**then** { UE (MCDATA Client) sends a SIP BYE message }
}
##### 6.1.9.2 Conformance requirements {#conformance-requirements-12 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.4.2.3, 9.2.4.2.1, 13.2.2.2.2.1, TS 24.582
clauses 6.1.2.2.1, 6.1.2.4, 6.1.2.5.1, 6.1.2.5.2, 6.1.2.5.3, 6.1.2.6. The
following represents a copy/paste extraction of the requirements relevant to
the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.4.2.3]
The MCData client shall generate a SIP INVITE request in accordance with 3GPP
TS 24.229 [5] with the clarifications given below.
The MCData client:
1) shall include the g.3gpp.mcdata.sds media feature tag and the g.3gpp.icsi-
ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP INVITE request;
5) should include the \"timer\" option tag in the Supported header field;
6) should include the Session-Expires header field according to IETF RFC 4028
[38]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
7) if a one-to-one SDS session is requested:
a) shall insert in the SIP INVITE request a MIME resource-lists body with the
MCData ID of the invited MCData user, according to rules and procedures of
IETF RFC 5366 [18];
b) shall contain an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"one-to-one-sds-session\";
and
c) if an end-to-end security context needs to be established and the security
context does not exist or if the existing security context has expired, then:
i) if necessary, shall instruct the key management client to request keying
material from the key management server as described in 3GPP TS 33.180 [26];
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [26];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [26];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [26];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [26];
vi) shall add the MCData ID of the originating MCData to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26]; and
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCData user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.180 [26];
...
9) shall set the Request-URI of the SIP INVITE request to the public service
identity identifying the participating MCData function serving the MCData
user;
NOTE 2: The MCData client is configured with public service identity
identifying the participating MCData function serving the MCData user.
10) may include a P-Preferred-Identity header field in the SIP INVITE request
containing a public user identity as specified in 3GPP TS 24.229 [5];
11) shall include an SDP offer according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.4.2.1; and
12) shall send the SIP INVITE request towards the MCData server according to
3GPP TS 24.229 [5].
On receipt of a SIP 2xx response to the SIP INVITE request, the MCData client:
1) shall send a SIP ACK request as specified in 3GPP TS 24.229 [5];
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [38]; and
3) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.2.2.
[TS 24.282, clause 9.2.4.2.1]
When composing an SDP offer according to 3GPP TS 24.229 [5], IETF RFC 4975
[17], IETF RFC 6135 [19] and IETF RFC 6714 [20] the MCData client:
1) shall include an \"m=message\" media-level section for the MCData media
stream consisting of:
a) the port number;
b) a protocol field value of \"TCP/MSRP\" or \"TCP/TLS/MSRP\" for TLS;
c) an \"a=sendrecv\" attribute;
d) an \"a=path\" attribute containing its own MSRP URI;
e) set the content type as \"a=accept-types:application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload\"; and
f) set the a=setup attribute as \"actpass\"; and
2) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\"
attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF
RFC 4567 [45].
[TS 24.282, clause 13.2.2.2.2.1]
When the MCData client wants to release a MCData communication established
over the media plane, the MCData client:
1) shall generate a SIP BYE request according to 3GPP TS 24.229 [5];
2) shall set the Request-URI to the MCData session identity to be released;
and
3) shall send the SIP BYE request towards MCData server according to 3GPP TS
24.229 [5].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCData
client shall release all media plane resources corresponding to the MCData
communication being released.
[TS 24.582, clause 6.1.2.2.1]
Upon receiving an indication to establish MSRP connection for SDS session as
the originating MCData client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData SDS message
before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client can generate and send an SDS message as specified in subclause 6.1.2.4,
or can generate and send an SDS disposition notification for a received SDS
message as specified in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
[TS 24.582, clause 6.1.2.4]
An MCData client is allowed to send an one-to-one SDS message only if
1\. the \ element of an \ element is present
with a value \"true\" (see the MCData user profile document in 3GPP TS 24.484
[7]);
2\. the size of the SDS message is less than or equal to the value of the
\ element in the MCData service configuration
document as specified in 3GPP TS 24.484 [7]; and
3\. the size of the SDS message is less than or equal to the value of
\ element of the MCData user profile document (see the MCData
user profile document in 3GPP TS 24.484 [7]).
An MCData client is allowed to send a group SDS message only if
1\. the \ element of an \
element is present with a value \"true\" as defined in the MCData group
document for this MCData group as specified in 3GPP TS 24.481 [4];
2\. the size of the SDS message is less than or equal to the value contained
in the \ as defined in the MCData
group document for this MCData group as specified in 3GPP TS 24.481 [4]; and
3\. the size of the SDS message is less than or equal to the value contained
in the \ element of the \ element of
the MCData group document for this MCData group as specified in 3GPP TS 24.481
[11].
If the above mentioned conditions satisfy, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4, with the following
clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
[TS 24.582, clause 6.1.2.5.1]
To send an SDS disposition notification, the MCData client:
1\. shall generate a SDS NOTIFICATION as specified in subclause 6.1.2.5.2;
2\. shall include the SDS NOTIFICATION in an MSRP SEND request as specified in
subclause 6.1.2.5.3, with the following clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
3\. shall send the MSRP SEND request on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary.
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks; and
2\. shall indicate to MCData user that the SDS message or the SDS disposition
notification could not be sent.
[TS 24.582, clause 6.1.2.5.2]
In order to generate an SDS notification, the MCData client:
1\. shall generate an SDS NOTIFICATION message as specified in 3GPP TS 24.282
[8]; and
2\. shall include the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8].
When generating an SDS NOTIFICATION message, the MCData client:
1\. if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\";
2\. if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\";
3\. if sending a delivered and read notification, shall set the SDS
disposition notification type IE as \"DELIVERED AND READ\";
4\. if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\";
5\. shall set the Date and time IE to the current time;
6\. shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message;
7\. shall set the Message ID to the value of the Message ID that was received
in the SDS message;
8\. if the SDS message was destined for the user, shall not include an
Application ID IE; and
9\. if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message.
[TS 24.582, clause 6.1.2.5.3]
The MCData client shall generate MSRP SEND requests for SDS disposition
notification according to IETF RFC 4975 [11].
When generating an MSRP SEND request for SDS disposition notification
containing an SDS NOTIFICATION message, the MCData client
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the content type as Content-Type =
\"application/vnd.3gpp.mcdata-signalling\"; and
3\. shall set the body of the MSRP SEND request to the generated SDS
NOTIFICATION message.
[TS 24.582, clause 6.1.2.6]
Upon receiving an SDS message, the MCData client:
1\. shall follow the procedure defined in subclause 6.1.1.3.2, with the
following clarification:
a. if SDS Disposition request type IE is present in the received SDS
SIGNALLING PAYLOAD message then, shall send an SDS disposition notification as
described in subclause 6.1.2.5.
Upon receiving an SDS disposition notification, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2\. shall deliver the notification to the user or application.
##### 6.1.9.3 Test description {#test-description-12 .H6}
##### 6.1.9.3.1 Pre-test conditions {#pre-test-conditions-12 .H6}
##### System Simulator: {#system-simulator-8 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-8 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-8 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.9.3.2 Test procedure sequence {#test-procedure-sequence-12 .H6}
Table 6.1.9.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | one-to-one | | | | | | | session | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"**DEL | | | | | | | IVERY** \". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | Call | | | | | | | Establi | | | | | | | shment** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.2.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 7? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \ | | | | | | | "READ\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | event | | | | | | | described | | | | | | | in step 13 | | | | | | | the events | | | | | | | described | | | | | | | in Table | | | | | | | 6 | | | | | | | .1.9.3.2-2 | | | | | | | take | | | | | | | place. | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 14-15 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 16 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | release | | | | | | | the | | | | | | | one-to-one | | | | | | | session. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 17 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.6.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 18 | The SS | - | - | - | - | | | releases | | | | | | | the RRC | | | | | | | connection | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | behaviour | | | | | | | is handled | | | | | | | through | | | | | | | parallel | | | | | | | actions to | | | | | | | allow for | | | | | | | imple | | | | | | | mentations | | | | | | | which | | | | | | | first | | | | | | | indicate | | | | | | | to the | | | | | | | user that | | | | | | | there is a | | | | | | | message | | | | | | | available, | | | | | | | but render | | | | | | | the | | | | | | | message to | | | | | | | the user | | | | | | | only after | | | | | | | the user | | | | | | | takes an | | | | | | | action to | | | | | | | open the | | | | | | | message. | | | | | | +------------+------------+------------+---------+---------+----+
Table 6.1.9.3.2-2: Parallel Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                U - S              Message
1 Check: Does the UE (MCData client) correctly perform procedure \'**CO MSRP
message transfer** \' as described in TS 36.579-1 [2] Table 5.3C.4.3-1 **to
send a disposition notification of \"READ\"**? - - 2 P
##### 6.1.9.3.3 Specific message contents {#specific-message-contents-12 .H6}
Table 6.1.9.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.9.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MCDATA_SDS,
MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body As described in Table 6.1.9.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.9.3.3-3
Table 6.1.9.3.3-2: SDP for SIP INVITE (Table 6.1.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_OFFER, SDS_SESSION, MCD_1to1
* * *
Table 6.1.9.3.3-3: MCData-Info (Table 6.1.9.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-sds-session\"
Table 6.1.9.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.1.9.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
SDP message As described in Table 6.1.5.9.3-5
Table 6.1.9.3.3-5: SDP for SIP 200 (OK) (Table 6.1.9.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_ANSWER, SDS_SESSION
* * *
Table 6.1.9.3.3-6: MSRP SEND from the UE (step 7, Table 6.1.9.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message or chunk of message as specified in table 6.1.9.3.3-6A_
Table 6.1.9.3.3-6A: MIME Message (step 7, Table 6.1.9.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.9.3.3-6B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body DATA PAYLOAD as described in Table 6.1.9.3.3-7
Table 6.1.9.3.3-6B: SDS SIGNALLING PAYLOAD (Table 6.1.9.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.1.9.3.3-7: Data Payload (Table 6.1.9.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-1
* * *
Table 6.1.9.3.3-8..9: Void
Table 6.1.9.3.3-10: MSRP SEND from the SS (step 8, Table 6.1.9.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.9.3.3-11_
Table 6.1.9.3.3-11: SDS NOTIFICATION (Table 6.1.9.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.1.9.3.3-12: MSRP SEND from the SS (step 11, Table 6.1.9.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message as specified in table 6.1.9.3.3-12A_
Table 6.1.9.3.3-12A: MIME Message (step 11, Table 6.1.9.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.9.3.3-13  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body DATA PAYLOAD as described in Table 6.1.9.3.3-13A
Table 6.1.9.3.3-13: SDS SIGNALLING PAYLOAD (Table 6.1.9.3.3-12A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition READ
* * *
Table 6.1.9.3.3-13A: Data Payload (Table 6.1.9.3.3-12A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-2
* * *
Table 6.1.9.3.3-14: MSRP SEND from the UE (step 1, Table 6.1.9.3.2-2;\ step 3,
TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.9.3.3-15_
Table 6.1.9.3.3-15: SDS NOTIFICATION (Table 6.1.9.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition READ
* * *
Table 6.1.9.3.3-16..17: Void
### 6.1.10 On-network / Short Data Service (SDS) / SDS Session / One-to-one
SDS Session / Client Terminated (CT)
##### 6.1.10.1 Test Purpose (TP) {#test-purpose-tp-13 .H6}
##### (1) {#section-49 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a SIP INVITE to initiate a one-to-one SDS
session using the media plane }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### (2) {#section-50 .H6}
**with** { UE (MCDATA Client) having responded to the SIP INVITE message that
initiated a one-to-one SDS session using the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message }
**then** { UE (MCDATA Client) responds with an MSRP 200 (OK) message **and**
if the MSRP SEND message is not blank, renders the contents of the Payload IE
to the MCDATA User and sends a SIP MESSAGE message with a disposition
notification of \"DELIVERED\" }
}
##### (3) {#section-51 .H6}
**with** { UE (MCDATA Client) being in a one-to-one SDS session initiated by
the SS (MCDATA server) }
**ensure that** {
**when** { the MCDATA User requests to send a one-to-one SDS Session message
with a disposition of \"READ\" }
**then** { UE (MCDATA Client) sends a one-to-one session SDS message via a
MSRP SEND message with a disposition of \"DELIVERY\" }
}
##### (4) {#section-52 .H6}
**with** { UE (MCDATA Client) having sent a one-to-one SDS session message
using the media plane with a disposition of \"READ\" }
**ensure that** {
**when** { UE (MCDATA Client) receives a disposition response via a MSRP SEND
message }
**then** { UE (MCDATA Client) responds to the MSRP SEND message by sending a
MSRP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### (5) {#section-53 .H6}
**with** { UE (MCDATA Client) being in a one-to-one SDS session initiated by
the SS (MCDATA server) }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP BYE message }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### 6.1.10.2 Conformance requirements {#conformance-requirements-13 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.4.2.4, 9.2.4.2.2, 13.2.2.2.2.2, TS 24.582
clauses 6.1.2.3.1, 6.1.2.3.1, 6.1.2.4, 6.1.2.5.1, 6.1.2.5.2, 6.1.2.5.3,
6.1.2.6. The following represents a copy/paste extraction of the requirements
relevant to the test purpose; any references within the copy/paste text should
be understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.4.2.4]
Upon receipt of an initial SIP INVITE request, the MCData client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [5] with the clarifications below.
The MCData client:
1) may reject the SIP INVITE request if either of the following conditions are
met:
a) MCData client does not have enough resources to handle the call; or
b) any other reason outside the scope of this specification;
and skip the rest of the steps after step 2;
2) if the SIP INVITE request is rejected in step 1), shall respond toward
participating MCData function either with appropriate reject code as specified
in 3GPP TS 24.229 [5] and warning texts as specified in subclause 4.9 or with
SIP 480 (Temporarily unavailable) response not including warning texts if the
user is authorised to restrict the reason for failure and skip the rest of the
steps of this subclause;
3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as
specified in IETF RFC 4567 [45], and include warning text set to \"136
authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field
as specified in subclause 4.9 and not continue with rest of the steps in this
subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to create an end-to-
end secure session.
4) may display to the MCData user the MCData ID of the inviting MCData user
and the type of SDS request;
5) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [5];
6) shall include the option tag \"timer\" in a Require header field of the SIP
200 (OK) response;
7) shall include the Session-Expires header field in the SIP 200 (OK) response
and start the SIP session timer according to IETF RFC 4028 [38]. The
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\";
8) shall include the g.3gpp.mcdata.sds media feature tag in the Contact header
field of the SIP 200 (OK) response;
9) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in the Contact header field of
the SIP 200 (OK) response;
10) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.4.2.2; and
11) shall send the SIP 200 (OK) response towards the MCData server according
to rules and procedures of 3GPP TS 24.229 [5].
On receipt of an SIP ACK message to the sent SIP 200 (OK) message, the MCData
client shall:
1) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.2.3.
To send a disposition notification after the media plane is released, the
MCData client:
1) shall follow the procedures described in subclause 12.2.1.1.
[TS 24.282, clause 9.2.4.2.2]
When the MCData client receives an initial SDP offer for an MCData SDS
session, the MCData client shall process the SDP offer and shall compose an
SDP answer according to 3GPP TS 24.229 [5] and IETF RFC 4975 [17].
When composing an SDP answer, the MCData client:
1) shall include an \"m=message\" media-level section for the accepted MCData
media stream consisting of:
a) the port number;
b) a protocol field value of \"TCP/MSRP\" or \"TCP/TLS/MSRP\" for TLS
according to the received SDP offer;
c) an \"a=sendrecv\" attribute;
d) an \"a=path\" attribute containing its own MSRP URI;
e) set the content type as a=accept-types: application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload; and
f) set the a=setup attribute according to IETF RFC 6135 [19].
[TS 24.282, clause 13.2.2.2.2.2]
Upon receiving a SIP BYE request, the MCData client:
1) shall send SIP 200 (OK) response towards MCData server according to 3GPP TS
24.229 [5]; and
2) shall release all media plane resources corresponding to the MCData
communication being released.
NOTE: Partially received data can be stored and processed.
[TS 24.582, clause 6.1.2.3.1]
Upon receiving an indication to establish MSRP connection for SDS session as
the terminating MCData client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData SDS message
before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request sent as
\"active\" endpoint, or after sending MSRP 200 (OK) response to the first MSRP
SEND request received as \"passive\" endpoint, the MCData client can generate
and send an SDS message as specified in subclause 6.1.2.4, or can generate and
send an SDS disposition notification for a received SDS message as specified
in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
[TS 24.582, clause 6.1.2.4]
An MCData client is allowed to send an one-to-one SDS message only if
1\. the \ element of an \ element is present
with a value \"true\" (see the MCData user profile document in 3GPP TS 24.484
[7]);
2\. the size of the SDS message is less than or equal to the value of the
\ element in the MCData service configuration
document as specified in 3GPP TS 24.484 [7]; and
3\. the size of the SDS message is less than or equal to the value of
\ element of the MCData user profile document (see the MCData
user profile document in 3GPP TS 24.484 [7]).
An MCData client is allowed to send a group SDS message only if
1\. the \ element of an \
element is present with a value \"true\" as defined in the MCData group
document for this MCData group as specified in 3GPP TS 24.481 [4];
2\. the size of the SDS message is less than or equal to the value contained
in the \ as defined in the MCData
group document for this MCData group as specified in 3GPP TS 24.481 [4]; and
3\. the size of the SDS message is less than or equal to the value contained
in the \ element of the \ element of
the MCData group document for this MCData group as specified in 3GPP TS 24.481
[11].
If the above mentioned conditions satisfy, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4, with the following
clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
[TS 24.582, clause 6.1.2.5.1]
To send an SDS disposition notification, the MCData client:
1\. shall generate a SDS NOTIFICATION as specified in subclause 6.1.2.5.2;
2\. shall include the SDS NOTIFICATION in an MSRP SEND request as specified in
subclause 6.1.2.5.3, with the following clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
3\. shall send the MSRP SEND request on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary.
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks; and
2\. shall indicate to MCData user that the SDS message or the SDS disposition
notification could not be sent.
[TS 24.582, clause 6.1.2.5.2]
In order to generate an SDS notification, the MCData client:
1\. shall generate an SDS NOTIFICATION message as specified in 3GPP TS 24.282
[8]; and
2\. shall include the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8].
When generating an SDS NOTIFICATION message, the MCData client:
1\. if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\";
2\. if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\";
3\. if sending a delivered and read notification, shall set the SDS
disposition notification type IE as \"DELIVERED AND READ\";
4\. if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\";
5\. shall set the Date and time IE to the current time;
6\. shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message;
7\. shall set the Message ID to the value of the Message ID that was received
in the SDS message;
8\. if the SDS message was destined for the user, shall not include an
Application ID IE; and
9\. if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message.
[TS 24.582, clause 6.1.2.5.3]
The MCData client shall generate MSRP SEND requests for SDS disposition
notification according to IETF RFC 4975 [11].
When generating an MSRP SEND request for SDS disposition notification
containing an SDS NOTIFICATION message, the MCData client
1\. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
2\. shall set the content type as Content-Type =
\"application/vnd.3gpp.mcdata-signalling\"; and
3\. shall set the body of the MSRP SEND request to the generated SDS
NOTIFICATION message.
[TS 24.582, clause 6.1.2.6]
Upon receiving an SDS message, the MCData client:
1\. shall follow the procedure defined in subclause 6.1.1.3.2, with the
following clarification:
a. if SDS Disposition request type IE is present in the received SDS
SIGNALLING PAYLOAD message then, shall send an SDS disposition notification as
described in subclause 6.1.2.5.
Upon receiving an SDS disposition notification, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2\. shall deliver the notification to the user or application.
##### 6.1.10.3 Test description {#test-description-13 .H6}
##### 6.1.10.3.1 Pre-test conditions {#pre-test-conditions-13 .H6}
##### System Simulator: {#system-simulator-9 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-9 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-9 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.10.3.2 Test procedure sequence {#test-procedure-sequence-13 .H6}
Table 6.1.10.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.3.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 2-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | one-to-one | | | | | | | session | | | | | | | SDS | | | | | | | message | | | | | | | over the | | | | | | | media | | | | | | | plane with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"READ\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \ | | | | | | | "READ\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 12? | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 15 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 16 | Check: | - | - | 5 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.7.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 17 | The SS | - | - | - | - | | | releases | | | | | | | the RRC | | | | | | | connection | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.10.3.3 Specific message contents {#specific-message-contents-13 .H6}
Table 6.1.10.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.10.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.1.10.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.10.3.3-3
Table 6.1.10.3.3-2: SDP for SIP INVITE (Table 6.1.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_OFFER, MCD_1to1, SDS_SESSION
* * *
Table 6.1.10.3.3-3: MCData-Info (Table 6.1.10.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_1to1
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
request-type \"one-to-one-sds-session\"
Table 6.1.10.3.3-4: SIP 200 (OK) from the UE (step 1, Table 6.1.10.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
value \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.1.10.3.3-5
Table 6.1.10.3.3-5: SDP for SIP 200 (OK) (Table 6.1.10.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_ANSWER, SDS_SESSION
* * *
Table 6.1.10.3.3-6: MSRP SEND from the SS (step 6, Table 6.1.10.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message as specified in table 6.1.10.3.3-6A_
Table 6.1.10.3.3-6A: MIME Message (step 6, Table 6.1.10.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.10.3.3-6B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body DATA PAYLOAD as described in Table 6.1.10.3.3-7
Table 6.1.10.3.3-6B: SDS SIGNALLING PAYLOAD (Table 6.1.10.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.1.10.3.3-7: Data Payload (Table 6.1.10.3.3-6A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-2
* * *
Table 6.1.10.3.3-8: MSRP SEND from the UE (step 8, Table 6.1.10.3.2-1;\ step
3, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.10.3.3-9_
Table 6.1.10.3.3-9: SDS NOTIFICATION (Table 6.1.10.3.3-8)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
Table 6.1.10.3.3-10: MSRP SEND from the UE (step 12, Table 6.1.10.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message or chunk of message as specified in table 6.1.10.3.3-10A_
Table 6.1.10.3.3-10A: MIME Message (step 12, Table 6.1.10.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.10.3.3-11  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body DATA PAYLOAD as described in Table 6.1.10.3.3-12
Table 6.1.10.3.3-11: SDS SIGNALLING PAYLOAD (Table 6.1.10.3.3-10A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition READ
* * *
Table 6.1.10.3.3-12: Data Payload (Table 6.1.10.3.3-10A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.2-1
* * *
Table 6.1.10.3.3-13..14: Void
Table 6.1.10.3.3-15: MSRP SEND from the SS (step 13, Table 6.1.10.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.10.3.3-16_
Table 6.1.10.3.3-16: SDS NOTIFICATION (Table 6.1.10.3.3-15)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition READ
* * *
Table 6.1.10.3.3-17..18: Void
### 6.1.11 On-network / Short Data Service (SDS) / SDS Session / Group SDS
Session / Client Originated (CO)
##### 6.1.11.1 Test Purpose (TP) {#test-purpose-tp-14 .H6}
##### (1) {#section-54 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to initiate a group SDS session using the
media plane}
**then** { UE (MCDATA Client) sends a request to establish a group SDS session
and a MSRP connection via a SIP INVITE message **and** then responds to the
SIP 200 (OK) message with a SIP ACK message }
}
##### (2) {#section-55 .H6}
**with** { UE (MCDATA Client) having received a SIP 200 (OK) message with the
a=setup attribute set to \"passive\" }
**ensure that** {
**when** { UE (MCDATA Client) responds to the SIP 200 (OK) message with a SIP
ACK message }
**then** { UE (MCDATA Client) sends a blank MSRP SEND message to bind the MSRP
connection **and** then sends the group session SDS message via a MSRP SEND
message with a disposition of \"DELIVERY\" }
}
##### (3) {#section-56 .H6}
**with** { UE (MCDATA Client) having sent a group session SDS message using
the media plane with a disposition of \"DELIVERY\" }
**ensure that** {
**when** { UE (MCDATA Client) receives a disposition response via a MSRP SEND
message }
**then** { UE (MCDATA Client) responds to the MSRP SEND message by sending a
MSRP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### (4) {#section-57 .H6}
**with** { UE (MCDATA Client) having established a group SDS session and a
MSRP connection }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message with a disposition
of \"DELIVERY AND READ\" }
**then** { UE (MCDATA Client) responds with a MSRP 200 (OK) message }
}
##### (5) {#section-58 .H6}
**with** { UE (MCDATA Client) having responded with a MSRP 200(OK) message to
a group SDS session message with a disposition of \"DELIVERY AND READ\" and
timer TDU1 (delivery and read) not yet expired }
**ensure that** {
**when** { the UE (MCDATA Client) determines that the payload contained in the
DATA PAYLOAD message is for user consumption and before timer TDU1 (delivery
and read) expires }
**then** { the UE (MCDATA Client) renders the contents of the Payload IE to
the MCDATA User **and** then sends a MSRP SEND message with a disposition
notification of \"DELIVERED AND READ\" }
}
##### (6) {#section-59 .H6}
**with** { UE (MCDATA Client) having responded with a MSRP 200(OK) message to
a group SDS session message with a disposition of \"DELIVERY AND READ\" and
the UE (MCDATA Client) not yet rendering the contents of the Payload IE to the
MCDATA User }
**ensure that** {
**when** { timer TDU1 (delivery and read) expires }
**then** { UE (MCDATA Client) sends a MSRP SEND message with a disposition
notification of \"DELIVERED\" **and** then renders the contents of the Payload
IE to the MCDATA User **and** then sends a MSRP SEND message with a
disposition notification of \"READ\" }
}
##### (7) {#section-60 .H6}
**with** { UE (MCDATA Client) having established a group SDS session }
**ensure that** {
**when** { the MCDATA User requests to release the group SDS session }
**then** { UE (MCDATA Client) sends a SIP BYE message }
}
##### 6.1.11.2 Conformance requirements {#conformance-requirements-14 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.4.2.3, 9.2.4.2.1, 13.2.2.2.2.1, TS 24.582
clauses 6.1.2.2.1, 6.1.2.3.1, 6.1.2.4, 6.1.2.5.1, 6.1.2.5.2, 6.1.2.5.3,
6.1.2.6. The following represents a copy/paste extraction of the requirements
relevant to the test purpose; any references within the copy/paste text should
be understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.4.2.3]
The MCData client shall generate a SIP INVITE request in accordance with 3GPP
TS 24.229 [5] with the clarifications given below.
The MCData client:
1) shall include the g.3gpp.mcdata.sds media feature tag and the g.3gpp.icsi-
ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP INVITE request;
5) should include the \"timer\" option tag in the Supported header field;
6) should include the Session-Expires header field according to IETF RFC 4028
[38]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
...
8) if a group SDS session is requested:
a) if the \"/_\ _/\/Common/MCData/AllowedSDS\" leaf node present in the
group document of the requested MCData group, configured on the group
management client as specified in 3GPP TS 24.483 [42] is set to \"false\",
shall reject the request to send SDS and not continue with the rest of the
steps in this subclause; and
b) shall contain in an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"group-sds-session\";
ii) the \ element set to the MCData group identity; and
iii) the \ element set to the MCData client ID of the
originating MCData client;
NOTE 1: The MCData client does not include the MCData ID of the originating
MCData user in the body, as this will be inserted into the body of the SIP
INVITE request that is sent from the originating participating MCData
function.
9) shall set the Request-URI of the SIP INVITE request to the public service
identity identifying the participating MCData function serving the MCData
user;
NOTE 2: The MCData client is configured with public service identity
identifying the participating MCData function serving the MCData user.
10) may include a P-Preferred-Identity header field in the SIP INVITE request
containing a public user identity as specified in 3GPP TS 24.229 [5];
11) shall include an SDP offer according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 9.2.4.2.1; and
12) shall send the SIP INVITE request towards the MCData server according to
3GPP TS 24.229 [5].
On receipt of a SIP 2xx response to the SIP INVITE request, the MCData client:
1) shall send a SIP ACK request as specified in 3GPP TS 24.229 [5];
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [38]; and
3) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 6.1.2.2.
[TS 24.282, clause 9.2.4.2.1]
When composing an SDP offer according to 3GPP TS 24.229 [5], IETF RFC 4975
[17], IETF RFC 6135 [19] and IETF RFC 6714 [20] the MCData client:
1) shall include an \"m=message\" media-level section for the MCData media
stream consisting of:
a) the port number;
b) a protocol field value of \"TCP/MSRP\" or \"TCP/TLS/MSRP\" for TLS;
c) an \"a=sendrecv\" attribute;
d) an \"a=path\" attribute containing its own MSRP URI;
e) set the content type as \"a=accept-types:application/vnd.3gpp.mcdata-
signalling application/vnd.3gpp.mcdata-payload\"; and
f) set the a=setup attribute as \"actpass\"; and
2) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the MIKEY-SAKKE I_MESSAGE in an \"a=key-mgmt\"
attribute as a \"mikey\" attribute value in the SDP offer as specified in IETF
RFC 4567 [45].
[TS 24.282, clause 13.2.2.2.2.1]
When the MCData client wants to release a MCData communication established
over the media plane, the MCData client:
1) shall generate a SIP BYE request according to 3GPP TS 24.229 [5];
2) shall set the Request-URI to the MCData session identity to be released;
and
3) shall send the SIP BYE request towards MCData server according to 3GPP TS
24.229 [5].
Upon receiving a SIP 200 (OK) response to the SIP BYE request, the MCData
client shall release all media plane resources corresponding to the MCData
communication being released.
[TS 24.582, clause 6.1.2.2.1]
Upon receiving an indication to establish MSRP connection for SDS session as
the originating MCData client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData SDS message
before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client can generate and send an SDS message as specified in subclause 6.1.2.4,
or can generate and send an SDS disposition notification for a received SDS
message as specified in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
[TS 24.582, clause 6.1.2.3.1]
Upon receiving an indication to establish MSRP connection for SDS session as
the terminating MCData client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
> Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the MCData SDS message
before delivering the content to the application; and
3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request sent as
\"active\" endpoint, or after sending MSRP 200 (OK) response to the first MSRP
SEND request received as \"passive\" endpoint, the MCData client can generate
and send an SDS message as specified in subclause 6.1.2.4, or can generate and
send an SDS disposition notification for a received SDS message as specified
in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
[TS 24.582, clause 6.1.2.4]
An MCData client is allowed to send an one-to-one SDS message only if
1\. the \ element of an \ element is present
with a value \"true\" (see the MCData user profile document in 3GPP TS 24.484
[7]);
2\. the size of the SDS message is less than or equal to the value of the
\ element in the MCData service configuration
document as specified in 3GPP TS 24.484 [7]; and
3\. the size of the SDS message is less than or equal to the value of
\ element of the MCData user profile document (see the MCData
user profile document in 3GPP TS 24.484 [7]).
An MCData client is allowed to send a group SDS message only if
1\. the \ element of an \
element is present with a value \"true\" as defined in the MCData group
document for this MCData group as specified in 3GPP TS 24.481 [4];
2\. the size of the SDS message is less than or equal to the value contained
in the \ as defined in the MCData
group document for this MCData group as specified in 3GPP TS 24.481 [4]; and
3\. the size of the SDS message is less than or equal to the value contained
in the \ element of the \ element of
the MCData group document for this MCData group as specified in 3GPP TS 24.481
[11].
If the above mentioned conditions satisfy, the MCData client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4, with the following
clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
[TS 24.582, clause 6.1.2.5.1]
To send an SDS disposition notification, the MCData client:
1\. shall generate a SDS NOTIFICATION as specified in subclause 6.1.2.5.2;
2\. shall include the SDS NOTIFICATION in an MSRP SEND request as specified in
subclause 6.1.2.5.3, with the following clarification;
a. shall set To-Path header according to the MSRP URI in the received SDP; and
3\. shall send the MSRP SEND request on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary.
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks; and
2\. shall indicate to MCData user that the SDS message or the SDS disposition
notification could not be sent.
[TS 24.582, clause 6.1.2.5.2]
In order to generate an SDS notification, the MCData client:
1\. shall generate an SDS NOTIFICATION message as specified in 3GPP TS 24.282
[8]; and
2\. shall include the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
24.282 [8].
When generating an SDS NOTIFICATION message, the MCData client:
1\. if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\";
2\. if sending a read notification, shall set the SDS disposition notification
type IE as \"READ\";
3\. if sending a delivered and read notification, shall set the SDS
disposition notification type IE as \"DELIVERED AND READ\";
4\. if the SDS message could not be delivered to the user or application (e.g.
due to lack of storage), shall set the SDS disposition notification type IE as
\"UNDELIVERED\";
5\. shall set the Date and time IE to the current time;
6\. shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message;
7\. shall set the Message ID to the value of the Message ID that was received
in the SDS message;
8\. if the SDS message was destined for the user, shall not include an
Application ID IE; and
9\. if the SDS message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the SDS message.
[TS 24.582, clause 6.1.2.6]
Upon receiving an SDS message, the MCData client:
1\. shall follow the procedure defined in subclause 6.1.1.3.2, with the
following clarification:
a. if SDS Disposition request type IE is present in the received SDS
SIGNALLING PAYLOAD message then, shall send an SDS disposition notification as
described in subclause 6.1.2.5.
Upon receiving an SDS disposition notification, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2\. shall deliver the notification to the user or application.
##### 6.1.11.3 Test description {#test-description-14 .H6}
##### 6.1.11.3.1 Pre-test conditions {#pre-test-conditions-14 .H6}
##### System Simulator: {#system-simulator-10 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-10 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-10 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.11.3.2 Test procedure sequence {#test-procedure-sequence-14 .H6}
Table 6.1.11.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | group | | | | | | | session | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"**DEL | | | | | | | IVERY** \". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.2.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 7? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DELIVERY | | | | | | | AND | | | | | | | READ\"**? | | | | | | | | | | | | | | (NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | event | | | | | | | described | | | | | | | in step 13 | | | | | | | the events | | | | | | | described | | | | | | | in Table | | | | | | | 6. | | | | | | | 1.11.3.2-2 | | | | | | | take | | | | | | | place. | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | release | | | | | | | the group | | | | | | | session. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 15 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'CO | | | | | | | MCData | | | | | | | call | | | | | | | release\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.6.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 16 | The SS | - | - | - | - | | | releases | | | | | | | the RRC | | | | | | | connection | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | behaviour | | | | | | | is handled | | | | | | | through | | | | | | | parallel | | | | | | | actions to | | | | | | | allow for | | | | | | | imple | | | | | | | mentations | | | | | | | which | | | | | | | first | | | | | | | indicate | | | | | | | to the | | | | | | | user that | | | | | | | there is a | | | | | | | message | | | | | | | available, | | | | | | | but render | | | | | | | the | | | | | | | message to | | | | | | | the user | | | | | | | only after | | | | | | | the user | | | | | | | takes an | | | | | | | action to | | | | | | | open the | | | | | | | message. | | | | | | | | | | | | | | NOTE 3: | | | | | | | Timer TDU1 | | | | | | | (delivery | | | | | | | and read) | | | | | | | is started | | | | | | | upon | | | | | | | receipt of | | | | | | | the SIP | | | | | | | MESSAGE | | | | | | | message | | | | | | | that | | | | | | | contains a | | | | | | | \"DELIVERY | | | | | | | AND READ\" | | | | | | | d | | | | | | | isposition | | | | | | | request. | | | | | | | Timer TDU1 | | | | | | | (delivery | | | | | | | and | | | | | | | r | | | | | | | ead)=120ms | | | | | | | according | | | | | | | to the | | | | | | | default | | | | | | | value | | | | | | | defined in | | | | | | | TS 24.282 | | | | | | | [31]. | | | | | | +------------+------------+------------+---------+---------+----+
Table 6.1.11.3.2-2: Parallel Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                                                                                                                                   U - S              Message
\- EXCEPTION: Steps 1a1-1b2 describe behaviour that depends on the timing of
UE execution; the \"lower case letter\" identifies a step sequence that takes
place if the UE receives a display indication before (step 1a1) or after
(steps 1b1-1b2) timer TDU1 (delivery and read) expires. - - - - 1a1 Check:
Does the UE (MCData client) correctly perform procedure \'**CO MSRP message
transfer\' as described in TS 36.579-1** [2] Table 5.3C.4.3-1 **to send a
disposition notification of \"DELIVERED AND READ\"**? - - 3 P 1b1 Check: Does
the UE (MCData client) correctly perform procedure \'**CO MSRP message
transfer\' as described in TS 36.579-1** [2] Table 5.3C.4.3-1 **to send a
disposition notification of \"DELIVERED\"**? - - 3 P 1b2 Check: Does the UE
(MCData client) correctly perform procedure \'**CO MSRP message transfer\' as
described in TS 36.579-1** [2] Table 5.3C.4.3-1 **to send a disposition
notification of \"READ\"**? - - 3 P
##### 6.1.11.3.3 Specific message contents {#specific-message-contents-14 .H6}
Table 6.1.11.3.3-1: SIP INVITE from the UE (step 2, Table 6.1.11.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body As described in Table 6.1.11.3.3-1A  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.11.3.3-2
Table 6.1.11.3.3-1A: SDP for SIP INVITE (Table 6.1.11.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_OFFER, SDS_SESSION
* * *
Table 6.1.11.3.3-2: MCData-Info (Table 6.1.11.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-sds-session\"
Table 6.1.11.3.3-3: SIP 200 (OK) from the SS (step 2, Table 6.1.11.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
SDP message As described in Table 6.1.11.3.3-4
Table 6.1.11.3.3-4: SDP for SIP 200 (OK) (Table 6.1.11.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_ANSWER, SDS_SESSION
* * *
Table 6.1.11.3.3-5: MSRP SEND from the UE (step 7, Table 6.1.11.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message or chunk of message as specified in table 6.1.11.3.3-5A_
Table 6.1.11.3.3-5A: MIME Message (step 7, Table 6.1.11.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.11.3.3-5B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.11.3.3-6
Table 6.1.11.3.3-5B: SDS SIGNALLING PAYLOAD (Table 6.1.11.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.1.11.3.3-6: Data Payload (Table 6.1.11.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-1
* * *
Table 6.1.11.3.3-7..8: Void
Table 6.1.11.3.3-9: MSRP SEND from the SS (step 8, Table 6.1.11.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.11.3.3-10_
Table 6.1.11.3.3-10: SDS NOTIFICATION (Table 6.1.11.3.3-9)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.1.11.3.3-11: MSRP SEND from the SS (step 11, Table 6.1.11.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message as specified in table 6.1.11.3.3-11A_
Table 6.1.11.3.3-11A: MIME Message (step 11, Table 6.1.11.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.11.3.3-12  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.11.3.3-12A
Table 6.1.11.3.3-12: SDS SIGNALLING PAYLOAD (Table 6.1.11.3.3-11A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED_READ
* * *
Table 6.1.11.3.3-12A: Data Payload (Table 6.1.11.3.3-11A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-2
* * *
Table 6.1.11.3.3-13: MSRP SEND from the UE (step 1a1, Table 6.1.11.3.2-2;\
step 3, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.11.3.3-14_
Table 6.1.11.3.3-14: SDS NOTIFICATION (Table 6.1.11.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED_READ
* * *
Table 6.1.11.3.3-15: MSRP SEND from the UE (step 1b1, Table 6.1.11.3.2-2;\
step 3, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.11.3.3-16_
Table 6.1.11.3.3-16: SDS NOTIFICATION (Table 6.1.11.3.3-15)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
Table 6.1.11.3.3-17: MSRP SEND from the UE (step 1b2, Table 6.1.11.3.2-2;\
step 3, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.11.3.3-18_
Table 6.1.11.3.3-18: SDS NOTIFICATION (Table 6.1.11.3.3-17)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition READ
* * *
Table 6.1.11.3.3-19..20: Void
### 6.1.12 On-network / Short Data Service (SDS) / SDS Session / Group SDS
Session / Client Terminated (CT)
##### 6.1.12.1 Test Purpose (TP) {#test-purpose-tp-15 .H6}
##### (1) {#section-61 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a SIP INVITE to initiate a group SDS
session using the media plane }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### (2) {#section-62 .H6}
**with** { UE (MCDATA Client) having responded to the SIP INVITE message that
initiated a group SDS session using the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message }
**then** { UE (MCDATA Client) responds with a MSRP 200 (OK) message **and** if
the MSRP SEND message is not blank, renders the contents of the Payload IE to
the MCDATA User **and** sends a MSRP SEND message with a disposition
notification of \"DELIVERED\" }
}
##### (3) {#section-63 .H6}
**with** { UE (MCDATA Client) being in a group SDS session initiated by the SS
(MCDATA server) }
**ensure that** {
**when** { the MCDATA User requests to send a group SDS Session message with a
disposition of \"DELIVERY AND READ\" }
**then** { UE (MCDATA Client) sends a group session SDS message via a MSRP
SEND message with a disposition of \"DELIVERY AND READ\" }
}
##### (4) {#section-64 .H6}
**with** { UE (MCDATA Client) having sent a group SDS session message using
the media plane with a disposition of \"DELIVERY AND READ\" }
**ensure that** {
**when** { UE (MCDATA Client) receives a disposition response via a MSRP SEND
message }
**then** { UE (MCDATA Client) responds to the MSRP SEND message by sending a
MSRP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### (5) {#section-65 .H6}
**with** { UE (MCDATA Client) being in a group SDS session initiated by the SS
(MCDATA Server) }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP BYE message }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### 6.1.12.2 Conformance requirements {#conformance-requirements-15 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 9.2.4.2.4, 9.2.4.2.2, 13.2.2.2.2.2, TS 24.582
clauses 6.1.2.3.1, 6.1.2.3.1, 6.1.2.4, 6.1.2.5.1, 6.1.2.5.2, 6.1.2.5.3,
6.1.2.6. The following represents a copy/paste extraction of the requirements
relevant to the test purpose; any references within the copy/paste text should
be understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 9.2.4.2.4]
Upon receipt of an initial SIP INVITE request, the MCData client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [5] with the clarifications below.
The MCData client:
> 1) may reject the SIP INVITE request if either of the following conditions
> are met:
>
> a) MCData client does not have enough resources to handle the call; or
>
> b) any other reason outside the scope of this specification;
>
> and skip the rest of the steps after step 2;
>
> 2) if the SIP INVITE request is rejected in step 1), shall respond toward
> participating MCData function either with appropriate reject code as
> specified in 3GPP TS 24.229 [5] and warning texts as specified in subclause
> 4.9 or with SIP 480 (Temporarily unavailable) response not including warning
> texts if the user is authorised to restrict the reason for failure and skip
> the rest of the steps of this subclause;
>
> 3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
> attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
> I_MESSAGE:
>
> a) shall extract the MCData ID of the originating MCData user from the
> initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
>
> b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
>
> c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE
> as described in 3GPP TS 33.180 [26];
>
> d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
> reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response
> as specified in IETF RFC 4567 [45], and include warning text set to \"136
> authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header
> field as specified in subclause 4.9 and not continue with rest of the steps
> in this subclause; and
>
> e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
>
> i) shall extract and decrypt the encapsulated PCK using the terminating
> user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
>
> ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS
> 33.180 [26];
>
> NOTE: With the PCK successfully shared between the originating MCData client
> and the terminating MCData client, both clients are able to create an end-
> to-end secure session.
>
> 4) may display to the MCData user the MCData ID of the inviting MCData user
> and the type of SDS request;
>
> 5) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
> according to rules and procedures of 3GPP TS 24.229 [5];
>
> 6) shall include the option tag \"timer\" in a Require header field of the
> SIP 200 (OK) response;
>
> 7) shall include the Session-Expires header field in the SIP 200 (OK)
> response and start the SIP session timer according to IETF RFC 4028 [38].
> The \"refresher\" parameter in the Session-Expires header field shall be set
> to \"uas\";
>
> 8) shall include the g.3gpp.mcdata.sds media feature tag in the Contact
> header field of the SIP 200 (OK) response;
>
> 9) shall include the g.3gpp.icsi-ref media feature tag containing the value
> of \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\" in the Contact header
> field of the SIP 200 (OK) response;
>
> 10) shall include an SDP answer in the SIP 200 (OK) response to the SDP
> offer in the incoming SIP INVITE request according to 3GPP TS 24.229 [5]
> with the clarifications given in subclause 9.2.4.2.2; and
>
> 11) shall send the SIP 200 (OK) response towards the MCData server according
> to rules and procedures of 3GPP TS 24.229 [5].
>
> On receipt of an SIP ACK message to the sent SIP 200 (OK) message, the
> MCData client shall:
>
> 1) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
> subclause 6.1.2.3.
To send a disposition notification after the media plane is released, the
MCData client:
> 1) shall follow the procedures described in subclause 12.2.1.1.
[TS 24.282, clause 9.2.4.2.2]
When the MCData client receives an initial SDP offer for an MCData SDS
session, the MCData client shall process the SDP offer and shall compose an
SDP answer according to 3GPP TS 24.229 [5] and IETF RFC 4975 [17].
When composing an SDP answer, the MCData client:
> 1) shall include an \"m=message\" media-level section for the accepted
> MCData media stream consisting of:
>
> a) the port number;
>
> b) a protocol field value of \"TCP/MSRP\" or \"TCP/TLS/MSRP\" for TLS
> according to the received SDP offer;
>
> c) an \"a=sendrecv\" attribute;
>
> d) an \"a=path\" attribute containing its own MSRP URI;
>
> e) set the content type as a=accept-types: application/vnd.3gpp.mcdata-
> signalling application/vnd.3gpp.mcdata-payload; and
>
> f) set the a=setup attribute according to IETF RFC 6135 [19].
[TS 24.282, clause 13.2.2.2.2.2]
Upon receiving a SIP BYE request, the MCData client:
> 1) shall send SIP 200 (OK) response towards MCData server according to 3GPP
> TS 24.229 [5]; and
>
> 2) shall release all media plane resources corresponding to the MCData
> communication being released.
>
> NOTE: Partially received data can be stored and processed.
[TS 24.582, clause 6.1.2.3.1]
Upon receiving an indication to establish MSRP connection for SDS session as
the terminating MCData client, the MCData client:
> 1\. shall act as an MSRP client according to IETF RFC 6135 [12];
>
> 2\. shall act either as an active endpoint or as an passive endpoint to open
> the transport connection, according to IETF RFC 6135 [12];
>
> 3\. shall establish the MSRP connection according to the MSRP connection
> parameters in the SDP offer received in the SIP INVITE request according to
> IETF RFC 4975 [11];
>
> 4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND
> request to bind the MSRP connection to the MSRP session from the perspective
> of the passive endpoint according to the rules and procedures of IETF RFC
> 4975 [11] and IETF RFC 6135 [12];
>
> Once the MSRP session is established, the MCData client:
>
> 1\. on receipt of an MSRP request in the MSRP session, shall follow the
> rules and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714
> [13];
>
> 2\. If an MSRP SEND request indicates the use of chunking, shall wait until
> all further MSRP SEND requests for the remaining chunks have been received
> and shall reassemble the entire set of MSRP requests into the MCData SDS
> message before delivering the content to the application; and
>
> 3\. shall handle the received content as described in subclause 6.1.2.6.
On receiving MSRP 200 (OK) response to the first MSRP SEND request sent as
\"active\" endpoint, or after sending MSRP 200 (OK) response to the first MSRP
SEND request received as \"passive\" endpoint, the MCData client can generate
and send an SDS message as specified in subclause 6.1.2.4, or can generate and
send an SDS disposition notification for a received SDS message as specified
in subclause 6.1.2.5, if requested.
Received content and disposition requests shall be handled as specified in
subclause 6.1.2.6.
[TS 24.582, clause 6.1.2.4]
An MCData client is allowed to send an one-to-one SDS message only if
> 1\. the \ element of an \ element is present
> with a value \"true\" (see the MCData user profile document in 3GPP TS
> 24.484 [7]);
>
> 2\. the size of the SDS message is less than or equal to the value of the
> \ element in the MCData service configuration
> document as specified in 3GPP TS 24.484 [7]; and
>
> 3\. the size of the SDS message is less than or equal to the value of
> \ element of the MCData user profile document (see the MCData
> user profile document in 3GPP TS 24.484 [7]).
An MCData client is allowed to send a group SDS message only if
> 1\. the \ element of an \
> element is present with a value \"true\" as defined in the MCData group
> document for this MCData group as specified in 3GPP TS 24.481 [4];
>
> 2\. the size of the SDS message is less than or equal to the value contained
> in the \ as defined in the MCData
> group document for this MCData group as specified in 3GPP TS 24.481 [4]; and
>
> 3\. the size of the SDS message is less than or equal to the value contained
> in the \ element of the \ element
> of the MCData group document for this MCData group as specified in 3GPP TS
> 24.481 [11].
If the above mentioned conditions satisfy, the MCData client:
> 1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
> 6.1.1.2.2;
>
> 2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
>
> 3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
> SEND request as specified in subclause 6.1.1.2.4, with the following
> clarification;
>
> a. shall set To-Path header according to the MSRP URI in the received SDP;
> and
>
> 4\. shall send the MSRP SEND request on the established MSRP connection.
>
> NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
> lines in each MSRP SEND message conveying a chunk, as also specified in
> subclause 6.1.1.2.4.
[TS 24.582, clause 6.1.2.5.1]
To send an SDS disposition notification, the MCData client:
> 1\. shall generate a SDS NOTIFICATION as specified in subclause 6.1.2.5.2;
>
> 2\. shall include the SDS NOTIFICATION in an MSRP SEND request as specified
> in subclause 6.1.2.5.3, with the following clarification;
>
> a. shall set To-Path header according to the MSRP URI in the received SDP;
> and
>
> 3\. shall send the MSRP SEND request on the established MSRP connection.
If MSRP chunking is used, the MCData client:
> 1\. shall send further MSRP SEND requests as necessary.
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
> 1\. if there are further MSRP chunks to send, shall abort transmission of
> these further MSRP chunks; and
>
> 2\. shall indicate to MCData user that the SDS message or the SDS
> disposition notification could not be sent.
[TS 24.582, clause 6.1.2.5.2]
In order to generate an SDS notification, the MCData client:
> 1\. shall generate an SDS NOTIFICATION message as specified in 3GPP TS
> 24.282 [8]; and
>
> 2\. shall include the SDS NOTIFICATION message in an
> application/vnd.3gpp.mcdata-signalling MIME body as specified in 3GPP TS
> 24.282 [8].
When generating an SDS NOTIFICATION message, the MCData client:
> 1\. if sending a delivered notification, shall set the SDS disposition
> notification type IE as \"DELIVERED\";
>
> 2\. if sending a read notification, shall set the SDS disposition
> notification type IE as \"READ\";
>
> 3\. if sending a delivered and read notification, shall set the SDS
> disposition notification type IE as \"DELIVERED AND READ\";
>
> 4\. if the SDS message could not be delivered to the user or application
> (e.g. due to lack of storage), shall set the SDS disposition notification
> type IE as \"UNDELIVERED\";
>
> 5\. shall set the Date and time IE to the current time;
>
> 6\. shall set the Conversation ID to the value of the Conversation ID that
> was received in the SDS message;
>
> 7\. shall set the Message ID to the value of the Message ID that was
> received in the SDS message;
>
> 8\. if the SDS message was destined for the user, shall not include an
> Application ID IE; and
>
> 9\. if the SDS message was destined for an application, shall include an
> Application ID IE set to the value of the Application ID that was included
> in the SDS message.
[TS 24.582, clause 6.1.2.5.3]
The MCData client shall generate MSRP SEND requests for SDS disposition
notification according to IETF RFC 4975 [11].
When generating an MSRP SEND request for SDS disposition notification
containing an SDS NOTIFICATION message, the MCData client
> 1\. shall set To-Path header according to the MSRP URI(s) received in the
> answer SDP;
>
> 2\. shall set the content type as Content-Type =
> \"application/vnd.3gpp.mcdata-signalling\"; and
>
> 3\. shall set the body of the MSRP SEND request to the generated SDS
> NOTIFICATION message.
[TS 24.582, clause 6.1.2.6]
Upon receiving an SDS message, the MCData client:
> 1\. shall follow the procedure defined in subclause 6.1.1.3.2, with the
> following clarification:
>
> a. if SDS Disposition request type IE is present in the received SDS
> SIGNALLING PAYLOAD message then, shall send an SDS disposition notification
> as described in subclause 6.1.2.5.
Upon receiving an SDS disposition notification, the MCData client:
> 1\. shall decode the contents of the application/vnd.3gpp.mcdata-signalling
> MIME body; and
>
> 2\. shall deliver the notification to the user or application.
##### 6.1.12.3 Test description {#test-description-15 .H6}
##### 6.1.12.3.1 Pre-test conditions {#pre-test-conditions-15 .H6}
##### System Simulator: {#system-simulator-11 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-11 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
##### Preamble: {#preamble-11 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.1.12.3.2 Test procedure sequence {#test-procedure-sequence-15 .H6}
Table 6.1.12.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.3.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 2-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | contents | | | | | | | of the | | | | | | | Payload IE | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send a | | | | | | | group | | | | | | | session | | | | | | | SDS | | | | | | | message | | | | | | | over the | | | | | | | media | | | | | | | plane with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DELIVERY | | | | | | | AND | | | | | | | READ\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an SDS | | | | | | | message | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DELIVERY | | | | | | | AND | | | | | | | READ\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 12? | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 15 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 16 | Check: | - | - | 5 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.7.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 17 | The SS | - | - | - | - | | | releases | | | | | | | the RRC | | | | | | | connection | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.1.12.3.3 Specific message contents {#specific-message-contents-15 .H6}
Table 6.1.12.3.3-1: SIP INVITE from the SS (step 1, Table 6.1.12.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.1.12.3.3-1A  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.1.12.3.3-2
Table 6.1.12.3.3-1A: SDP for SIP INVITE (Table 6.1.12.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_SDS,
SDP_OFFER, SDS_SESSION
* * *
Table 6.1.12.3.3-2: MCData-Info (Table 6.1.12.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-sds-session\"
Table 6.1.12.3.3-3: SIP 200 (OK) from the UE (step 1, Table 6.1.12.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP,
MCDATA_SDS
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
value \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.1.12.3.3-4
Table 6.1.12.3.3-4: SDP for SIP 200 (OK) (Table 6.1.12.3.3-3)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_SDS,
SDP_ANSWER, SDS_SESSION
* * *
Table 6.1.12.3.3-5: MSRP SEND from the SS (step 6, Table 6.1.12.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message as specified in table 6.1.12.3.3-5A_
Table 6.1.12.3.3-5A: MIME Message (step 6, Table 6.1.12.3.2-1;\ step 1, TS
36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.12.3.3-5B  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.12.3.3-6
Table 6.1.12.3.3-5B: SDS SIGNALLING PAYLOAD (Table 6.1.12.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.1.12.3.3-6: Data Payload (Table 6.1.12.3.3-5A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-2
* * *
Table 6.1.12.3.3-7: MSRP SEND from the UE (step 8, Table 6.1.12.3.2-1;\ step
3, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.12.3.3-8_
Table 6.1.12.3.3-8: SDS NOTIFICATION (Table 6.1.12.3.3-7)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
Table 6.1.12.3.3-9: MSRP SEND from the UE (step 12, Table 6.1.12.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"multipart/mixed\"_  
**data** _Message or chunk of message as specified in table 6.1.12.3.3-9A_
Table 6.1.12.3.3-9A: MIME Message (step 12, Table 6.1.12.3.2-1;\ step 3, TS
36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: RFC 2046 [38]
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **MIME body part** **MCData Data signalling message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in table 6.1.12.3.3-10  
**MIME body part** **MCData Data message**  
MIME-part-headers  
Content-Type \"application/vnd.3gpp.mcdata-payload\"  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.1.12.3.3-11
Table 6.1.12.3.3-10: SDS SIGNALLING PAYLOAD (Table 6.1.12.3.3-9A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED_READ
* * *
Table 6.1.12.3.3-11: Data Payload (Table 6.1.12.3.3-9A)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-1
* * *
Table 6.1.12.3.3-12..13: Void
Table 6.1.12.3.3-14: MSRP SEND from the SS (step 13, Table 6.1.12.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"_ application/vnd.3gpp.mcdata-signalling _\"_  
**data** _MCData Protected Payload Message containing SDS NOTIFICATION as
specified in table 6.1.12.3.3-15_
Table 6.1.12.3.3-15: SDS NOTIFICATION (Table 6.1.12.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED_READ
* * *
Table 6.1.12.3.3-16..17: Void
## 6.2 File Distribution
### 6.2.1 On-network / File Distribution (FD) / FD Using HTTP / One-to-one
Standalone FD / Non-Mandatory Download / FILE DOWNLOAD REQUEST ACCEPTED / FILE
DOWNLOAD COMPLETED / FILE DOWNLOAD REQUEST REJECTED / FILE DOWNLOAD DEFERRED /
Client Originated (CO)
##### 6.2.1.1 Test Purpose (TP) {#test-purpose-tp-16 .H6}
##### (1) {#section-66 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { MCDATA User wants to send a file that is larger than \ via a standalone one-to-one FD message with a non-
mandatory download and with a disposition request of \"FILE DOWNLOAD COMPLETED
UPDATE\", **and,** the UE (MCDATA Client) is unaware of the URL of the Media
Storage Function }
**then** { UE (MCDATA Client) sends a SIP MESSAGE to find the URL of the Media
Storage Function **and** responds to a SIP MESSAGE that contains the URL of
the Media Storage Function with a SIP 200 (OK) message }
}
##### (2) {#section-67 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { MCDATA User wants to send a file that is larger than \ via a standalone one-to-one FD message with a non-
mandatory download and with a disposition request of \"FILE DOWNLOAD COMPLETED
UPDATE\", **and** , the UE (MCDATA Client) is aware of the URL of the Media
Storage Function }
**then** { UE (MCDATA Client) uploads the file to the Media Storage Function
via an HTTP POST message **and** then sends the URL of the file location to
the recipient via a SIP MESSAGE message }
}
##### (3) {#section-68 .H6}
**with** { MCDATA User having requesting the sending of a file that is larger
than \ via a standalone one-to-one FD message
with a non-mandatory download and with a disposition request of \"FILE
DOWNLOAD COMPLETED UPDATE\" and the UE (MCDATA Client) having sent the URL of
the file location to the recipient }
**ensure that** {
**when** { UE (MCDATA Client) receives a FD notification via a SIP MESSAGE
with disposition notification type of \"FILE DOWNLOAD REQUEST REJECTED\" }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE with a SIP 200 (OK)
message **and** delivers the notification that the remote Client has not
accepted the download to the MCDATA User }
}
##### (4) {#section-69 .H6}
**with** { MCDATA User having requesting the sending of a file that is larger
than \ via a standalone one-to-one FD message
with a non-mandatory download and with a disposition request of \"FILE
DOWNLOAD COMPLETED UPDATE\" and the UE (MCDATA Client) having sent the URL of
the file location to the recipient }
**ensure that** {
**when** { UE (MCDATA Client) receives a FD notification via a SIP MESSAGE
with disposition notification type of \"FILE DOWNLOAD DEFERRED\", followed by
a SIP MESSAGE with disposition notification type of \"FILE DOWNLOAD REQUEST
ACCEPTED\", followed by SIP MESSAGE with disposition notification type of
\"FILE DOWNLOAD COMPLETED\" }
**then** { UE (MCDATA Client) responds to each SIP MESSAGE with a SIP 200 (OK)
message **and** delivers suitable notification on the respective remote Client
action to the MCDATA User }
}
##### 6.2.1.2 Conformance requirements {#conformance-requirements-16 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.1.3.2, 10.2.2.1, 10.2.4.2.1, 12.2.1.2.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.1.3.2]
To discover the absolute URI of the media storage function, the MCData client
shall generate a SIP MESSAGE request towards the participating MCData
function, in accordance with 3GPP TS 24.229 [5] and IETF RFC 3428 [6] with the
clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with a \ element containing the value \"msf-
disc-req\";
4) if the upload of a file is for a group standalone FD request, shall include
in an application/vnd.3gpp.mcdata-info+xml MIME body, the \ element set to the required MCData group identity; and
NOTE 1: The absence of a group identity in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body implies that the
MCData client intends to upload a file for a one-to-one FD request. In this
case, the participating MCData function identifies the MCData ID of the user
from the binding between the public user identity and the MCData ID.
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
On receipt of a \"SIP MESSAGE request for absolute URI discovery response\",
the MCData client:
1) shall store the absolute URI found in the \ element;
2) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5]; and
3) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.2.1]
If the media storage client is not aware of the absolute URI of the media
storage function, the media storage client shall request the MCData client to
discover the absolute URI associated with the media storage function by
following the procedures in subclause 10.2.1.3.
The media storage client shall send HTTP requests over a TLS connection as
specified for the HTTP client in the UE in annex A of 3GPP TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To upload a file to media storage function, the media storage client:
1) shall generate an HTTP POST request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23];
2) shall set the Request-URI to the absolute URI identifying the resource on a
media storage function;
3) shall set the Host header field to a hostname identifying the media storage
function;
4) shall set the Content-Type header field to multipart/mixed and with a
boundary delimiter parameter set to any chosen value;
5) if the file upload is for one-to-one file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"one-to-one-fd\"; and
b) the \ element set to the originating MCData ID;
6) if the file upload is for group file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"group-fd\";
b) the \ element set to the MCData group identity; and
c) the \ element set to the originating MCData ID;
7) if end-to-end security is required for a one-to-one communication, the
MCData client protects the binary data representing the file and prefixes the
protected binary data with security parameters as described in 3GPP TS 33.180
[26];
8) if
i) end-to-end security is not required for a one-to-one communication, or
ii) the file upload is for group file distribution;
shall include the binary data representing the file with Content-Type field
set to application/octet-stream and Content-Length field set to the file size;
and
9) shall send the HTTP POST request towards the media storage function.
On receipt of a HTTP 201 Created containing a Location header field with a URL
identifying the location of the resource where the file has been stored on the
media storage function, then the media storage client shall store this
information.
[TS 24.282, clause 10.2.4.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) if a one-to-one standalone FD message is to be sent shall insert in the SIP
MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [9];
and
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-fd\";
...
4) shall generate a standalone FD message as specified in subclause 6.2.2.2;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.2.1.3 Test description {#test-description-16 .H6}
##### 6.2.1.3.1 Pre-test conditions {#pre-test-conditions-16 .H6}
##### System Simulator: {#system-simulator-12 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-12 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 and test File 2 for CO FD
as specified in aAnnex A.2.2 are available at the UE for upload.
##### Preamble: {#preamble-12 .H6}
\- In the \ element of the MCData Service Configuration document
the \ element of the \
element shall be set to 0 to indicate non-mandatory download independent from
the file size.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.1.3.2 Test procedure sequence {#test-procedure-sequence-16 .H6}
Table 6.2.1.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO | | | | | | | one-to-one | | | | | | | FD over | | | | | | | HTTP for | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | and with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 14 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'_| | | | | | |_ discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.8.3-1 | | | | | | | ? | | | | | +------------+------------+------------+---------+---------+----+ | 15 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP**\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 15A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 16-18 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 19 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | RE | | | | | | | JECTED\"**| | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 15? | | | | | +------------+------------+------------+---------+---------+----+ | 20 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 21 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | rejected | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 22 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 2 (TS | | | | | | | 36.579-7 | | | | | | | A.2.2) for | | | | | | | CO | | | | | | | one-to-one | | | | | | | FD over | | | | | | | HTTP for | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | and with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2, | | | | | | | NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 23a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends on | | | | | | | UE | | | | | | | imple | | | | | | | mentation. | | | | | +------------+------------+------------+---------+---------+----+ | 23a1 | IF the | - | - | - | - | | | client | | | | | | | needs to | | | | | | | discover | | | | | | | again the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | THEN the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'_| | | | | | |_ Discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.8.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | 23a2-23a4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 24 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 24A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.2? | | | | | +------------+------------+------------+---------+---------+----+ | 25-27 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 28 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | DE | | | | | | | FERRED\"** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 24? | | | | | +------------+------------+------------+---------+---------+----+ | 29 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 30 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | deferred | | | | | | | the | | | | | | | acceptance | | | | | | | of the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 31 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | AC | | | | | | | CEPTED\"** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 24? | | | | | +------------+------------+------------+---------+---------+----+ | 32 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 33 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | accepted | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 34 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COM | | | | | | | PLETED\"** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 24? | | | | | +------------+------------+------------+---------+---------+----+ | 35 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 36 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | completed | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: To | | | | | | | avoid | | | | | | | u | | | | | | | npredicted | | | | | | | behaviour | | | | | | | at the UE | | | | | | | side due | | | | | | | to the | | | | | | | file | | | | | | | upload in | | | | | | | the | | | | | | | previous | | | | | | | steps, the | | | | | | | UE shall | | | | | | | attempt to | | | | | | | upload a | | | | | | | different | | | | | | | file here. | | | | | | | | | | | | | | NOTE 3: | | | | | | | Test file | | | | | | | 1 and 2 | | | | | | | for CO FD | | | | | | | as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1 and | | | | | | | A.2.2. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.1.3.3 Specific message contents {#specific-message-contents-16 .H6}
Table 6.2.1.3.3-1..6: Void
Table 6.2.1.3.3-7: HTTP POST from the UE (steps 15, 24, Table 6.2.1.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.3-1, condition FD_HTTP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-8
Table 6.2.1.3.3-8: MCData-Info (Table 6.2.1.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"  
mcdata-calling-user-id px_MCData_ID_User_A NOTE: the element is not encrypted
Table 6.2.1.3.3-9..10: Void
Table 6.2.1.3.3-11: HTTP 201 Created from the SS (step 15, Table 6.2.1.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
Table 6.2.1.3.3-11A: HTTP 201 Created from the SS (step 24, Table
6.2.1.3.2-1;\ step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Location**  
uri tsc_MCData_MSF_URI & \"/file-location-2\"
Table 6.2.1.3.3-12: SIP MESSAGE from the UE (steps 15, 24, Table 6.2.1.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-13  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.1.3.3-13A
Table 6.2.1.3.3-13: MCData-Info (Table 6.2.1.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"
Table 6.2.1.3.3-13A: FD SIGNALLING PAYLOAD (Table 6.2.1.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_HTTP
* * *
Table 6.2.1.3.3-14: SIP MESSAGE from the SS (step 19, Table 6.2.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.1.3.3-16
Table 6.2.1.3.3-15: Void
Table 6.2.1.3.3-16: FD NOTIFICATION (Table 6.2.1.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_REJECTED
* * *
Table 6.2.1.3.3-17: SIP MESSAGE from the SS (step 28, Table 6.2.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.1.3.3-18
Table 6.2.1.3.3-18: FD NOTIFICATION (Table 6.2.1.3.3-17)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_DEFERRED
* * *
Table 6.2.1.3.3-19: SIP MESSAGE from the SS (step 31, Table 6.2.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.1.3.3-20
Table 6.2.1.3.3-20: FD NOTIFICATION (Table 6.2.1.3.3-19)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_ACCEPTED
* * *
Table 6.2.1.3.3-21: SIP MESSAGE from the SS (step 34, Table 6.2.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.1.3.3-22
Table 6.2.1.3.3-22: FD NOTIFICATION (Table 6.2.1.3.3-21)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_COMPLETED
* * *
### 6.2.2 On-network / File Distribution (FD) / FD Using HTTP / One-to-one
Standalone FD / Non-Mandatory Download / Before TDU2 Timers Expires / FILE
DOWNLOAD REQUEST ACCEPTED / FILE DOWNLOAD COMPLETED / FILE DOWNLOAD REQUEST
REJECTED / FILE DOWNLOAD DEFERRED / FD Client Terminated (CT)
##### 6.2.2.1 Test Purpose (TP) {#test-purpose-tp-17 .H6}
##### (1) {#section-70 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP MESSAGE message for a standalone
one-to-one FD message with a non-mandatory download and with a disposition of
\"FILE DOWNLOAD COMPLETE UPDATE\" }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message **and**
notifies the MCDATA User about the incoming FD request }
}
##### (2) {#section-71 .H6}
**with** { UE (MCDATA Client) having received a standalone one-to-one FD
message with a non-mandatory download and with a disposition of \"FILE
DOWNLOAD COMPLETE UPDATE\" }
**ensure that** {
**when** { the MCDATA User requests to accept the FD request }
**then** { UE (MCDATA Client) generates an FD NOTIFICATION indicating
acceptance of the FD request **and** attempts to download the file with an
HTTP GET message }
}
##### (3) {#section-72 .H6}
**with** { MCDATA User having accepted an FD request with a disposition of
\"FILE DOWNLOAD COMPLETE UPDATE\" }
**ensure that** {
**when** { UE (MCDATA Client) has successfully downloaded the file }
**then** { UE (MCDATA Client) notifies the MCDATA User that the file has
successfully downloaded **and** generates an FD NOTIFICATION indicating the
successful download of the file }
}
##### (4) {#section-73 .H6}
**with** { UE (MCDATA Client) having received a standalone one-to-one FD
message with a non-mandatory download and with a disposition of \"FILE
DOWNLOAD COMPLETE UPDATE\" }
**ensure that** {
**when** { the MCDATA User requests to reject the FD request }
**then** { UE (MCDATA Client) generates an FD NOTIFICATION indicating the
rejection of the FD request }
}
##### (5) {#section-74 .H6}
**with** { UE (MCDATA Client) having received a standalone one-to-one FD
message with a non-mandatory download and with a disposition of \"FILE
DOWNLOAD COMPLETE UPDATE\" }
**ensure that** {
**when** { the MCDATA User requests to defer the FD request before the
expiration of the TDU2 (FD non-mandatory download timer) timer }
**then** { UE (MCDATA Client) generates an FD NOTIFICATION indicating the
deferral of the FD request }
}
##### 6.2.2.2 Conformance requirements {#conformance-requirements-17 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.4.2.2, 10.2.1.2.3, 12.2.1.1, 10.2.3.1.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.4.2.2]
Upon receipt of a \"SIP MESSAGE request for FD using HTTP for terminating
MCData client\", the MCData client:
1) may reject the SIP MESSAGE request if there are not enough resources to
handle the SIP MESSAGE request;
2) if the SIP MESSAGE request is rejected in step 1), shall respond towards
the participating MCData function with a SIP 480 (Temporarily unavailable)
response and skip the rest of the steps of this subclause;
3) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
4) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
5) shall handle the received message as specified in subclause 10.2.1.2.
[TS 24.282, clause 10.2.1.2.3]
The MCData client:
1) if the FD SIGNALLING PAYLOAD message does not contain an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is for user consumption;
b) shall notify the user about the incoming FD request; and
c) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the user;
2) if the FD SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is not for user consumption;
b) if the Application ID value is unknown, shall discard the FD message and
exit this subclause;
c) if the Application ID value is known, shall notify the application of the
incoming FD request; and
NOTE 1: If FD request is addressed to a non-MCData application that is not
running, the MCData client starts the local non-MCData application.
d) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the application;
3) shall start a timer TDU2 (FD non-mandatory download timer) with the timer
value as specified in subclause F.2.3;
4) shall wait for the user or application to request to download the file
indicated by file URL in the Payload data in the Payload IE in the FD
SIGNALLING PAYLOAD message;
5) if the user or application accepts or rejects or decides to defer the FD
request, shall stop timer TDU2 (FD non-mandatory download timer);
6) if the user deferred the FD request while the timer TDU2 (FD non-mandatory
download timer) was running, shall generate an FD NOTIFICATION indicating
deferral of the FD request as specified in subclause 12.2.1.1;
NOTE 2: Once the timer TDU2 (FD non-mandatory download timer) has expired the
FD request can only be accepted or rejected with an appropriate action by the
MCData client.
NOTE 3: Once the timer TDU2 (FD non-mandatory download timer) has expired, no
action is taken by the MCData client if the FD request is deferred.
7) if the user or application rejects the FD request, shall generate an FD
NOTIFICATION indicating rejection of the FD request as specified in subclause
12.2.1.1 and shall exit this subclause; and
8) if the user accepts the FD request:
a) shall generate an FD NOTIFICATION indicating acceptance of the FD request
as specified in subclause 12.2.1.1;
b) if the FD SIGNALLING PAYLOAD message contains a new Conversation ID, shall
instantiate a new conversation with the Message ID in the FD SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
c) if the FD SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
i) if the FD SIGNALLING PAYLOAD message does not contain an InReplyTo message
ID, shall use the Message ID in the FD SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
ii) if the FD SIGNALLING PAYLOAD message contains an InReplyTo message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo message ID in the FD SIGNALLING PAYLOAD, and
use the Message ID in the FD SIGNALLING PAYLOAD to identify the new message;
d) may store the Conversation ID, Message ID, InReplyTo message ID and Date
and time in local storage;
e) shall attempt to download the file as identified by the file URL in the
Payload IE in the FD SIGNALLING PAYLOAD message, as specified in subclause
10.2.3.1; and
f) if the received FD SIGNALLING PAYLOAD message contains an FD disposition
request type IE requesting a file download completed update, then after the
file download has been successfully downloaded, shall generate an FD
NOTIFICATION by following the procedures in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) void;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.3.1]
The media storage client on the MCData client shall send HTTP requests over a
TLS connection as specified for the HTTP client in the UE, in annex A of 3GPP
TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To download a file from the media storage function on the controlling MCData
function, the media storage client on the MCData client:
1) shall generate an HTTP GET request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23] with a Request-URI set to an absolute URI identifying the
URL of the file being requested from the media storage function on the
controlling MCData function; and
2) shall send the HTTP GET request towards the media storage function on the
controlling MCData function.
On receipt of a HTTP 200 OK response containing the requested file, the MCData
client shall notify the user or application that the file has been
successfully downloaded.
##### 6.2.2.3 Test description {#test-description-17 .H6}
##### 6.2.2.3.1 Pre-test conditions {#pre-test-conditions-17 .H6}
##### System Simulator: {#system-simulator-13 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-13 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test files downloaded or received at previous test runs are deleted.
##### Preamble: {#preamble-13 .H6}
\- In the \ element of the MCData Service Configuration document
the \ element of the \
element shall be set to 0 to indicate non-mandatory download independent from
the file size.
\- TDU2 (FD non-mandatory download timer) is set to the default value of 60
seconds.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.2.3.2 Test procedure sequence {#test-procedure-sequence-17 .H6}
Table 6.2.2.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for | | | | | | | one-to-one | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | U | | | | | | | PDATE\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD | | | | | | | request? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | accept the | | | | | | | FD request | | | | | | | and | | | | | | | download | | | | | | | the file | | | | | | | before | | | | | | | timer TDU2 | | | | | | | expires. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2,3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | accept and | | | | | | | download | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.11.3-1 | | | | | | | to | | | | | | | download | | | | | | | test file | | | | | | | 1? | | | | | | | | | | | | | | (NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 6-8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the file | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9A | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 1 (TS | | | | | | | 36.579-7 | | | | | | | A.3.1)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10-11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for | | | | | | | one-to-one | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | U | | | | | | | PDATE\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 14 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD | | | | | | | request? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 15 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | reject the | | | | | | | FD request | | | | | | | before | | | | | | | timer TDU2 | | | | | | | expires. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 16 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | an FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | REJ | | | | | | | ECTED\"?** | | | | | +------------+------------+------------+---------+---------+----+ | 17 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 18 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for | | | | | | | one-to-one | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | U | | | | | | | PDATE\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 19 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 20 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD | | | | | | | request? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 21 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | defer the | | | | | | | FD request | | | | | | | before | | | | | | | timer TDU2 | | | | | | | expires. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 22 | Check: | - | - | 5 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | an FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | DEF | | | | | | | ERRED\"?** | | | | | +------------+------------+------------+---------+---------+----+ | 23 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 24 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | accept the | | | | | | | deferred | | | | | | | FD request | | | | | | | and | | | | | | | download | | | | | | | the file. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 25 | Check: | - | - | 2,3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | accept and | | | | | | | download | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.11.3-1 | | | | | | | to | | | | | | | download | | | | | | | test file | | | | | | | 2? | | | | | | | | | | | | | | (NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 26-28 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 29 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the file | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 29A | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 2 (TS | | | | | | | 36.579-7 | | | | | | | A.3.3)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 30-31 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Timer TDU2 | | | | | | | (FD | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | timer) | | | | | | | starts on | | | | | | | reception | | | | | | | of the FD | | | | | | | request | | | | | | | via the | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | request. | | | | | | | | | | | | | | NOTE 3: | | | | | | | Test file | | | | | | | 1 and 2 | | | | | | | for CT FD | | | | | | | as | | | | | | | specified | | | | | | | in annex | | | | | | | A.3.1 and | | | | | | | A.3.2. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.2.3.3 Specific message contents {#specific-message-contents-17 .H6}
Table 6.2.2.3.3-1: SIP MESSAGE from the SS (steps 1, 12, 18, Table
6.2.2.3.2-1;\ step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.2.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.2.3.3-2A
Table 6.2.2.3.3-2: **MCData-Info** (Table 6.2.2.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_1to1
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"
Table 6.2.2.3.3-2A: FD SIGNALLING PAYLOAD (Table 6.2.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.6-1, condition FD_HTTP
* * *
Table 6.2.2.3.3-3: Void
Table 6.2.2.3.3-4: SIP MESSAGE from the UE (steps 5, 25, Table 6.2.2.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.2.3.3-5
Table 6.2.2.3.3-5: FD NOTIFICATION (Table 6.2.2.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_ACCEPTED
* * *
Table 6.2.2.3.3-6: HTTP GET from the UE (steps 5, 25, Table 6.2.2.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.2-1, condition FD_HTTP
* * *
Table 6.2.2.3.3-7: HTTP 200 (OK) from the SS (steps 5, 25, Table 6.2.2.3.2-1;\
step 5, TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.6-1, condition FD_HTTP
* * *
Table 6.2.2.3.3-8..9: Void
Table 6.2.2.3.3-10: SIP MESSAGE from the UE (steps 5, 25, Table 6.2.2.3.2-1;\
step 6a1, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.2.3.3-11
Table 6.2.2.3.3-11: FD NOTIFICATION (Table 6.2.2.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_COMPLETED
* * *
Table 6.2.2.3.3-12: SIP MESSAGE from the UE (step 16, Table 6.2.2.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.2.3.3-13
Table 6.2.2.3.3-13: FD NOTIFICATION (Table 6.2.2.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_REJECTED
* * *
Table 6.2.2.3.3-14: SIP MESSAGE from the UE (step 22, Table 6.2.2.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.2.3.3-15
Table 6.2.2.3.3-15: FD NOTIFICATION (Table 6.2.2.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_DEFERRED
* * *
### 6.2.3 On-network / File Distribution (FD) / FD Using HTTP / Group
Standalone FD / Non-Mandatory Download / FILE DOWNLOAD REQUEST ACCEPTED / FILE
DOWNLOAD COMPLETED / FILE DOWNLOAD REQUEST REJECTED / Client Originated (CO)
##### 6.2.3.1 Test Purpose (TP) {#test-purpose-tp-18 .H6}
##### (1) {#section-75 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a Group Standalone FD message with
a non-mandatory download and with a disposition of \"FILE DOWNLOAD COMPLETE
UPDATE\" and the UE (MCDATA Client) is unaware of the URL of the Media Storage
Function }
**then** { UE (MCDATA Client) sends a SIP MESSAGE to find the URL of the Media
Storage Function **and** responds to a SIP MESSAGE that contains the URL of
the Media Storage Function with a SIP 200 (OK) message }
}
##### (2) {#section-76 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a Group Standalone FD message with
a non-mandatory download and with a disposition of \"FILE DOWNLOAD COMPLETE
UPDATE\" and the UE (MCDATA Client) is aware of the URL of the Media Storage
Function }
**then** { UE (MCDATA Client) uploads the file to the Media Storage Function
via an HTTP POST message **and** then sends the URL of the file location to
the recipient via a SIP MESSAGE message }
}
##### (3) {#section-77 .H6}
**with** { UE (MCDATA Client) having sent the URL of the file location to the
recipient }
**ensure that** {
**when** { UE (MCDATA Client) receives a FD notification via a SIP MESSAGE
message }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message with a SIP
200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.2.3.2 Conformance requirements {#conformance-requirements-18 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.1.3.2, 10.2.2.1, 10.2.4.2.1, 12.2.1.2.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.1.3.2]
To discover the absolute URI of the media storage function, the MCData client
shall generate a SIP MESSAGE request towards the participating MCData
function, in accordance with 3GPP TS 24.229 [5] and IETF RFC 3428 [6] with the
clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with a \ element containing the value \"msf-
disc-req\";
4) if the upload of a file is for a group standalone FD request, shall include
in an application/vnd.3gpp.mcdata-info+xml MIME body, the \ element set to the required MCData group identity; and
NOTE 1: The absence of a group identity in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body implies that the
MCData client intends to upload a file for a one-to-one FD request. In this
case, the participating MCData function identifies the MCData ID of the user
from the binding between the public user identity and the MCData ID.
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
On receipt of a \"SIP MESSAGE request for absolute URI discovery response\",
the MCData client:
1) shall store the absolute URI found in the \ element;
2) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5]; and
3) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.2.1]
If the media storage client is not aware of the absolute URI of the media
storage function, the media storage client shall request the MCData client to
discover the absolute URI associated with the media storage function by
following the procedures in subclause 10.2.1.3.
The media storage client shall send HTTP requests over a TLS connection as
specified for the HTTP client in the UE in annex A of 3GPP TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To upload a file to media storage function, the media storage client:
1) shall generate an HTTP POST request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23];
2) shall set the Request-URI to the absolute URI identifying the resource on a
media storage function;
3) shall set the Host header field to a hostname identifying the media storage
function;
4) shall set the Content-Type header field to multipart/mixed and with a
boundary delimiter parameter set to any chosen value;
5) if the file upload is for one-to-one file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"one-to-one-fd\"; and
b) the \ element set to the originating MCData ID;
6) if the file upload is for group file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"group-fd\";
b) the \ element set to the MCData group identity; and
c) the \ element set to the originating MCData ID;
7) if end-to-end security is required for a one-to-one communication, the
MCData client protects the binary data representing the file and prefixes the
protected binary data with security parameters as described in 3GPP TS 33.180
[26];
8) if
i) end-to-end security is not required for a one-to-one communication, or
ii) the file upload is for group file distribution;
shall include the binary data representing the file with Content-Type field
set to application/octet-stream and Content-Length field set to the file size;
and
9) shall send the HTTP POST request towards the media storage function.
On receipt of a HTTP 201 Created containing a Location header field with a URL
identifying the location of the resource where the file has been stored on the
media storage function, then the media storage client shall store this
information.
[TS 24.282, clause 10.2.4.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) if a one-to-one standalone FD message is to be sent shall insert in the SIP
MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [9];
and
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-fd\";
...
4) shall generate a standalone FD message as specified in subclause 6.2.2.2;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.2.3.3 Test description {#test-description-18 .H6}
##### 6.2.3.3.1 Pre-test conditions {#pre-test-conditions-18 .H6}
##### System Simulator: {#system-simulator-14 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-14 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 and test File 2 for CO FD
as specified in aAnnex A.2.2 are available at the UE for upload.
##### Preamble: {#preamble-14 .H6}
\- In the MCData Group Configuration document the \ shall be set to 0 to indicate non-mandatory download
independent from the file size.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.3.3.2 Test procedure sequence {#test-procedure-sequence-18 .H6}
Table 6.2.3.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO group | | | | | | | FD over | | | | | | | HTTP for | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | and with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'_| | | | | | |_ Discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.9.3-1 | | | | | | | ? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP**\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 4-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | AC | | | | | | | CEPTED\"**| | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 3? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | accepted | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COM | | | | | | | PLETED\"**| | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 3? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | completed | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 2 (TS | | | | | | | 36.579-7 | | | | | | | A.2.2) for | | | | | | | CO group | | | | | | | FD over | | | | | | | HTTP for | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | and with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | Step 14a1 | | | | | | | describes | | | | | | | behaviour | | | | | | | that | | | | | | | depends on | | | | | | | UE | | | | | | | imple | | | | | | | mentation. | | | | | +------------+------------+------------+---------+---------+----+ | 14a1 | IF the | - | - | - | - | | | client | | | | | | | needs to | | | | | | | discover | | | | | | | again the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | THEN the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | performs | | | | | | | procedure | | | | | | | \'_| | | | | | |_ Discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.9.3-1. | | | | | +------------+------------+------------+---------+---------+----+ | 14a2-14a4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 15 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 15A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.2? | | | | | +------------+------------+------------+---------+---------+----+ | 16-18 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 19 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | RE | | | | | | | JECTED\"** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 15? | | | | | +------------+------------+------------+---------+---------+----+ | 20 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 21 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | rejected | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 and 2 | | | | | | | for CO FD | | | | | | | as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1 and | | | | | | | A.2.2. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.3.3.3 Specific message contents {#specific-message-contents-18 .H6}
Table 6.2.1.3.3-1..6: Void
Table 6.2.3.3.3-7: HTTP POST from the UE (steps 3, 15, Table 6.2.3.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.3-1, condition FD_HTTP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.3.3.3-8
Table 6.2.3.3.3-8: MCData-Info (Table 6.2.3.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"  
mcdata-request-uri px_MCData_Group_A_ID NOTE: the element is not encrypted  
mcdata-calling-user-id px_MCData_ID_User_A NOTE: the element is not encrypted
Table 6.2.3.3.3-9: Void
Table 6.2.3.3.3-10: HTTP 201 Created from the SS (step 3, Table 6.2.3.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
Table 6.2.3.3.3-10A: HTTP 201 Created from the SS (step 15, Table
6.2.3.3.2-1;\ step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
Information Element Value/remark Comment Reference Condition **Location**  
absoluteURI tsc_MCData_MSF_URI & \"/file-location-2\"
Table 6.2.3.3.3-11: SIP MESSAGE from the UE (steps 3, 15, Table 6.2.3.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.3.3.3-12  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.3.3.3-12A
Table 6.2.3.3.3-12: MCData-Info (Table 6.2.3.3.3-11)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.3.3.3-12A: FD SIGNALLING PAYLOAD (Table 6.2.3.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_HTTP
* * *
Table 6.2.3.3.3-13: SIP MESSAGE from the SS (step 7, Table 6.2.3.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-14  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.3.3.3-15
Table 6.2.3.3.3-14: MCData-Info (Table 6.2.3.3.3-13)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.2.3.3.3-15: FD NOTIFICATION (Table 6.2.3.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_ACCEPTED
* * *
Table 6.2.3.3.3-16: SIP MESSAGE from the SS (step 10, Table 6.2.3.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-14  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.3.3.3-17
Table 6.2.3.3.3-17: FD NOTIFICATION (Table 6.2.3.3.3-16)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_COMPLETED
* * *
Table 6.2.3.3.3-18: SIP MESSAGE from the SS (step 19, Table 6.2.3.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-14  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.3.3.3-19
Table 6.2.3.3.3-19: FD NOTIFICATION (Table 6.2.3.3.3-18)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_REJECTED
* * *
### 6.2.4 On-network / File Distribution (FD) / FD Using HTTP / Group
Standalone FD / Non-Mandatory Download / After TDU2 Timers Expires / FILE
DOWNLOAD REQUEST ACCEPTED / FILE DOWNLOAD COMPLETED / FILE DOWNLOAD REQUEST
REJECTED / Client Terminated (CT)
##### 6.2.4.1 Test Purpose (TP) {#test-purpose-tp-19 .H6}
##### (1) {#section-78 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP MESSAGE message for a group
standalone FD message with a non-mandatory download and with a disposition of
\"FILE DOWNLOAD COMPLETE UPDATE\" }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message **and**
notifies the MCDATA User about the incoming FD request }
}
##### (2) {#section-79 .H6}
**with** { UE (MCDATA Client) having received a group standalone FD message
with a non-mandatory download and with a disposition of \"FILE DOWNLOAD
COMPLETE UPDATE\" }
**ensure that** {
**when** { the MCDATA User requests to accept the FD request }
**then** { UE (MCDATA Client) generates an FD NOTIFICATION indicating
acceptance of the FD request **and** attempts to download the file with an
HTTP GET message }
}
##### (3) {#section-80 .H6}
**with** { MCDATA User having accepted an FD request with a disposition of
\"FILE DOWNLOAD COMPLETE UPDATE\" }
**ensure that** {
**when** { UE (MCDATA Client) has successfully downloaded the file }
**then** { UE (MCDATA Client) notifies the MCDATA User that the file has
successfully downloaded **and** generates an FD NOTIFICATION indicating the
successful download of the file }
}
##### (4) {#section-81 .H6}
**with** { UE (MCDATA Client) having received a group standalone FD message
with a non-mandatory download and with a disposition of \"FILE DOWNLOAD
COMPLETE UPDATE\" }
**ensure that** {
**when** { the MCDATA User requests to reject the FD request }
**then** { UE (MCDATA Client) generates an FD NOTIFICATION indicating the
rejection of the FD request }
}
##### (5) {#section-82 .H6}
Void
##### 6.2.4.2 Conformance requirements {#conformance-requirements-19 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.4.2.2, 10.2.1.2.3, 12.2.1.1, 10.2.3.1.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.4.2.2]
Upon receipt of a \"SIP MESSAGE request for FD using HTTP for terminating
MCData client\", the MCData client:
1) may reject the SIP MESSAGE request if there are not enough resources to
handle the SIP MESSAGE request;
2) if the SIP MESSAGE request is rejected in step 1), shall respond towards
the participating MCData function with a SIP 480 (Temporarily unavailable)
response and skip the rest of the steps of this subclause;
3) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
4) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
5) shall handle the received message as specified in subclause 10.2.1.2.
[TS 24.282, clause 10.2.1.2.3]
The MCData client:
1) if the FD SIGNALLING PAYLOAD message does not contain an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is for user consumption;
b) shall notify the user about the incoming FD request; and
c) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the user;
2) if the FD SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is not for user consumption;
b) if the Application ID value is unknown, shall discard the FD message and
exit this subclause;
c) if the Application ID value is known, shall notify the application of the
incoming FD request; and
NOTE 1: If FD request is addressed to a non-MCData application that is not
running, the MCData client starts the local non-MCData application.
d) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the application;
3) shall start a timer TDU2 (FD non-mandatory download timer) with the timer
value as specified in subclause F.2.3;
4) shall wait for the user or application to request to download the file
indicated by file URL in the Payload data in the Payload IE in the FD
SIGNALLING PAYLOAD message;
5) if the user or application accepts or rejects or decides to defer the FD
request, shall stop timer TDU2 (FD non-mandatory download timer);
6) if the user deferred the FD request while the timer TDU2 (FD non-mandatory
download timer) was running, shall generate an FD NOTIFICATION indicating
deferral of the FD request as specified in subclause 12.2.1.1;
NOTE 2: Once the timer TDU2 (FD non-mandatory download timer) has expired the
FD request can only be accepted or rejected with an appropriate action by the
MCData client.
NOTE 3: Once the timer TDU2 (FD non-mandatory download timer) has expired, no
action is taken by the MCData client if the FD request is deferred.
7) if the user or application rejects the FD request, shall generate an FD
NOTIFICATION indicating rejection of the FD request as specified in subclause
12.2.1.1 and shall exit this subclause; and
8) if the user accepts the FD request:
a) shall generate an FD NOTIFICATION indicating acceptance of the FD request
as specified in subclause 12.2.1.1;
b) if the FD SIGNALLING PAYLOAD message contains a new Conversation ID, shall
instantiate a new conversation with the Message ID in the FD SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
c) if the FD SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
i) if the FD SIGNALLING PAYLOAD message does not contain an InReplyTo message
ID, shall use the Message ID in the FD SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
ii) if the FD SIGNALLING PAYLOAD message contains an InReplyTo message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo message ID in the FD SIGNALLING PAYLOAD, and
use the Message ID in the FD SIGNALLING PAYLOAD to identify the new message;
d) may store the Conversation ID, Message ID, InReplyTo message ID and Date
and time in local storage;
e) shall attempt to download the file as identified by the file URL in the
Payload IE in the FD SIGNALLING PAYLOAD message, as specified in subclause
10.2.3.1; and
f) if the received FD SIGNALLING PAYLOAD message contains an FD disposition
request type IE requesting a file download completed update, then after the
file download has been successfully downloaded, shall generate an FD
NOTIFICATION by following the procedures in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) void;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.3.1]
The media storage client on the MCData client shall send HTTP requests over a
TLS connection as specified for the HTTP client in the UE, in annex A of 3GPP
TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To download a file from the media storage function on the controlling MCData
function, the media storage client on the MCData client:
1) shall generate an HTTP GET request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23] with a Request-URI set to an absolute URI identifying the
URL of the file being requested from the media storage function on the
controlling MCData function; and
2) shall send the HTTP GET request towards the media storage function on the
controlling MCData function.
On receipt of a HTTP 200 OK response containing the requested file, the MCData
client shall notify the user or application that the file has been
successfully downloaded.
##### 6.2.4.3 Test description {#test-description-19 .H6}
##### 6.2.4.3.1 Pre-test conditions {#pre-test-conditions-19 .H6}
##### System Simulator: {#system-simulator-15 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-15 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test files downloaded or received at previous test runs are deleted.
##### Preamble: {#preamble-15 .H6}
\- In the MCData Group Configuration document the \ shall be set to 0 to indicate non-mandatory download
independent from the file size.
\- Timer TDU2 (FD non-mandatory download timer) is configured to be 15
seconds.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.4.3.2 Test procedure sequence {#test-procedure-sequence-19 .H6}
Table 6.2.4.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for group | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | U | | | | | | | PDATE\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD | | | | | | | request? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 4 | The SS | - | - | - | - | | | waits 15s | | | | | | | for expiry | | | | | | | of timer | | | | | | | TDU2. | | | | | +------------+------------+------------+---------+---------+----+ | 4A | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | accept the | | | | | | | FD request | | | | | | | and | | | | | | | download | | | | | | | the file. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 2,3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | accept and | | | | | | | download | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.11.3-1 | | | | | | | to | | | | | | | download | | | | | | | test file | | | | | | | 1? | | | | | | | | | | | | | | (NOTE 3) | | | | | +------------+------------+------------+---------+---------+----+ | 6-8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the file | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9A | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 1 (TS | | | | | | | 36.579-7 | | | | | | | A.3.1)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10-11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for group | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | U | | | | | | | PDATE\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 13 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 14 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD | | | | | | | request? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 15 | The SS | - | - | - | - | | | waits 15s | | | | | | | for expiry | | | | | | | of timer | | | | | | | TDU2. | | | | | +------------+------------+------------+---------+---------+----+ | 15A | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | reject the | | | | | | | FD | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 16 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | an FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | REJ | | | | | | | ECTED\"?** | | | | | +------------+------------+------------+---------+---------+----+ | 17 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Timer TDU2 | | | | | | | (FD | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | timer) | | | | | | | starts on | | | | | | | reception | | | | | | | of the FD | | | | | | | request | | | | | | | via the | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | request. | | | | | | | | | | | | | | NOTE 3: | | | | | | | Test file | | | | | | | 1 for CT | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.3.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.4.3.3 Specific message contents {#specific-message-contents-19 .H6}
Table 6.2.4.3.3-1: SIP MESSAGE from the SS (steps 1, 12, Table 6.2.4.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.4.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.4.3.3-2A
Table 6.2.4.3.3-2: MCData-Info (Table 6.2.4.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_grp
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.4.3.3-2A: FD SIGNALLING PAYLOAD (Table 6.2.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.6-1, condition FD_HTTP
* * *
Table 6.2.4.3.3-3: Void
Table 6.2.4.3.3-4: SIP MESSAGE from the UE (step 5, Table 6.2.4.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.4.3.3-5  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.4.3.3-6
Table 6.2.4.3.3-5: MCData-Info (Table 6.2.4.3.3-4)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI set to
px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table 5.5.3.2.1-3A
Table 6.2.4.3.3-6: FD NOTIFICATION (Table 6.2.4.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_ACCEPTED
* * *
Table 6.2.4.3.3-7: HTTP GET from the UE (step 5, Table 6.2.4.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.2-1, condition FD_HTTP
* * *
Table 6.2.4.3.3-8: HTTP 200 (OK) from the SS (step 5, Table 6.2.4.3.2-1;\ step
5, TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.6-1, condition FD_HTTP
* * *
Table 6.2.4.3.3-9: Void
Table 6.2.4.3.3-10: SIP MESSAGE from the UE (step 5, Table 6.2.4.3.2-1;\ step
6a1, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-headers MCData-Info as described in Table 6.2.4.3.3-5  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.4.3.3-11
Table 6.2.4.3.3-11: FD NOTIFICATION (Table 6.2.4.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_COMPLETED
* * *
Table 6.2.4.3.3-12: SIP MESSAGE from the UE (step 16, Table 6.2.4.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-headers MCData-Info as described in Table 6.2.4.3.3-5  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.4.3.3-13
Table 6.2.4.3.3-13: FD NOTIFICATION (Table 6.2.4.3.3-12)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_REJECTED
* * *
### 6.2.5 On-network / File Distribution (FD) / FD Using HTTP / One-to-one
Standalone FD / Mandatory Download / With Disposition Request / Client
Originated (CO)
##### 6.2.5.1 Test Purpose (TP) {#test-purpose-tp-20 .H6}
##### (1) {#section-83 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one FD message
with a mandatory download and with a disposition of \"FILE DOWNLOAD COMPLETE
UPDATE\" and the UE (MCDATA Client) is unaware of the URL of the Media Storage
Function }
**then** { UE (MCDATA Client) sends a SIP MESSAGE to find the URL of the Media
Storage Function **and** responds to a SIP MESSAGE that contains the URL of
the Media Storage Function with a SIP 200 (OK) message }
}
##### (2) {#section-84 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one FD message
with a mandatory download and with a disposition of \"FILE DOWNLOAD COMPLETE
UPDATE\" and the UE (MCDATA Client) is aware of the URL of the Media Storage
Function }
**then** { UE (MCDATA Client) uploads the file to the Media Storage Function
via an HTTP POST message **and** then sends the URL of the file location to
the recipient via a SIP MESSAGE message }
}
##### (3) {#section-85 .H6}
**with** { UE (MCDATA Client) having sent the URL of the file location to the
recipient }
**ensure that** {
**when** { UE (MCDATA Client) receives a FD notification via a SIP MESSAGE
message }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message with a SIP
200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.2.5.2 Conformance requirements {#conformance-requirements-20 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.1.3.2, 10.2.2.1, 10.2.4.2.1, 12.2.1.2.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.1.3.2]
To discover the absolute URI of the media storage function, the MCData client
shall generate a SIP MESSAGE request towards the participating MCData
function, in accordance with 3GPP TS 24.229 [5] and IETF RFC 3428 [6] with the
clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with a \ element containing the value \"msf-
disc-req\";
4) if the upload of a file is for a group standalone FD request, shall include
in an application/vnd.3gpp.mcdata-info+xml MIME body, the \ element set to the required MCData group identity; and
NOTE 1: The absence of a group identity in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body implies that the
MCData client intends to upload a file for a one-to-one FD request. In this
case, the participating MCData function identifies the MCData ID of the user
from the binding between the public user identity and the MCData ID.
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
On receipt of a \"SIP MESSAGE request for absolute URI discovery response\",
the MCData client:
1) shall store the absolute URI found in the \ element;
2) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5]; and
3) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.2.1]
If the media storage client is not aware of the absolute URI of the media
storage function, the media storage client shall request the MCData client to
discover the absolute URI associated with the media storage function by
following the procedures in subclause 10.2.1.3.
The media storage client shall send HTTP requests over a TLS connection as
specified for the HTTP client in the UE in annex A of 3GPP TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To upload a file to media storage function, the media storage client:
1) shall generate an HTTP POST request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23];
2) shall set the Request-URI to the absolute URI identifying the resource on a
media storage function;
3) shall set the Host header field to a hostname identifying the media storage
function;
4) shall set the Content-Type header field to multipart/mixed and with a
boundary delimiter parameter set to any chosen value;
5) if the file upload is for one-to-one file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"one-to-one-fd\"; and
b) the \ element set to the originating MCData ID;
6) if the file upload is for group file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"group-fd\";
b) the \ element set to the MCData group identity; and
c) the \ element set to the originating MCData ID;
7) if end-to-end security is required for a one-to-one communication, the
MCData client protects the binary data representing the file and prefixes the
protected binary data with security parameters as described in 3GPP TS 33.180
[26];
8) if
i) end-to-end security is not required for a one-to-one communication, or
ii) the file upload is for group file distribution;
shall include the binary data representing the file with Content-Type field
set to application/octet-stream and Content-Length field set to the file size;
and
9) shall send the HTTP POST request towards the media storage function.
On receipt of a HTTP 201 Created containing a Location header field with a URL
identifying the location of the resource where the file has been stored on the
media storage function, then the media storage client shall store this
information.
[TS 24.282, clause 10.2.4.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) if a one-to-one standalone FD message is to be sent shall insert in the SIP
MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [9];
and
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-fd\";
...
4) shall generate a standalone FD message as specified in subclause 6.2.2.2;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.2.5.3 Test description {#test-description-20 .H6}
##### 6.2.5.3.1 Pre-test conditions {#pre-test-conditions-20 .H6}
##### System Simulator: {#system-simulator-16 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-16 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 is available at the UE
for upload.
##### Preamble: {#preamble-16 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.5.3.2 Test procedure sequence {#test-procedure-sequence-20 .H6}
Table 6.2.5.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO | | | | | | | one-to-one | | | | | | | FD over | | | | | | | HTTP for | | | | | | | mandatory | | | | | | | download | | | | | | | and with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'_| | | | | | |_ Discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.8.3-1 | | | | | | | ? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP**\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 4-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | AC | | | | | | | CEPTED\"**| | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 3? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | accepted | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COM | | | | | | | PLETED\"** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 3? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | completed | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CO | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.5.3.3 Specific message contents {#specific-message-contents-20 .H6}
Table 6.2.5.3.3-1..6: Void
Table 6.2.5.3.3-7: HTTP POST from the UE (step 3, Table 6.2.5.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.3-1, condition FD_HTTP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-8
Table 6.2.5.3.3-8: MCData-Info (Table 6.2.5.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"  
mcdata-calling-user-id px_MCData_ID_User_A
Table 6.2.5.3.3-9..10: Void
Table 6.2.5.3.3-11: HTTP 201 Created from the SS (step 3, Table 6.2.5.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
Table 6.2.5.3.3-12: SIP MESSAGE from the UE (step 3, Table 6.2.5.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.5.3.3-13  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.5.3.3-14
Table 6.2.5.3.3-13: MCData-Info (Table 6.2.5.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"
Table 6.2.5.3.3-14: FD Signalling Payload (Table 6.2.5.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_HTTP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** Mandatory download \'0001\'B MANDATORY DOWNLOAD TS 24.282 [31]
clause 15.2.16
Table 6.2.5.3.3-15: SIP MESSAGE from the SS (step 7, Table 6.2.5.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION
from the SS as described in Table 6.2.5.3.3-17
Table 6.2.5.3.3-16: Void
Table 6.2.5.3.3-17: FD NOTIFICATION (Table 6.2.5.3.3-15)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_ACCEPTED
* * *
Table 6.2.5.3.3-18: SIP MESSAGE from the SS (step 10, Table 6.2.5.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION
from the SS as described in Table 6.2.5.3.3-19
Table 6.2.5.3.3-19: FD NOTIFICATION (Table 6.2.5.3.3-18)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_COMPLETED
* * *
### 6.2.6 On-network / File Distribution (FD) / FD Using HTTP / One-to-one
Standalone FD / Mandatory Download / With Disposition Request / Client
Terminated (CT)
##### 6.2.6.1 Test Purpose (TP) {#test-purpose-tp-21 .H6}
##### (1) {#section-86 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP MESSAGE message for a standalone
one-to-one FD message with a mandatory download and with a disposition of
\"FILE DOWNLOAD COMPLETE UPDATE\" }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message **and**
notifies the MCDATA User about the incoming FD request and that the file
identified by file URL in the Payload data in the Payload IE will be
downloaded automatically **and** generates an FD NOTIFICATION indicating
acceptance of the FD request **and** attempts to download the file with an
HTTP GET message }
}
##### (2) {#section-87 .H6}
**with** { UE (MCDATA Client) having started to download the file by sending
an HTTP GET message }
**ensure that** {
**when** { UE (MCDATA Client) has successfully downloaded the file }
**then** { UE (MCDATA Client) notifies the MCDATA User that the file has
successfully downloaded **and** generates an FD NOTIFICATION indicating the
successful download of the file }
}
##### 6.2.6.2 Conformance requirements {#conformance-requirements-21 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.4.2.2, 10.2.1.2.3, 12.2.1.1, 10.2.3.1.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.4.2.2]
Upon receipt of a \"SIP MESSAGE request for FD using HTTP for terminating
MCData client\", the MCData client:
1) may reject the SIP MESSAGE request if there are not enough resources to
handle the SIP MESSAGE request;
2) if the SIP MESSAGE request is rejected in step 1), shall respond towards
the participating MCData function with a SIP 480 (Temporarily unavailable)
response and skip the rest of the steps of this subclause;
3) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
4) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
5) shall handle the received message as specified in subclause 10.2.1.2.
[TS 24.282, clause 10.2.1.2.3]
The MCData client:
1) if the FD SIGNALLING PAYLOAD message does not contain an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is for user consumption;
b) shall notify the user about the incoming FD request; and
c) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the user;
2) if the FD SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is not for user consumption;
b) if the Application ID value is unknown, shall discard the FD message and
exit this subclause;
c) if the Application ID value is known, shall notify the application of the
incoming FD request; and
NOTE 1: If FD request is addressed to a non-MCData application that is not
running, the MCData client starts the local non-MCData application.
d) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the application;
3) shall start a timer TDU2 (FD non-mandatory download timer) with the timer
value as specified in subclause F.2.3;
4) shall wait for the user or application to request to download the file
indicated by file URL in the Payload data in the Payload IE in the FD
SIGNALLING PAYLOAD message;
5) if the user or application accepts or rejects or decides to defer the FD
request, shall stop timer TDU2 (FD non-mandatory download timer);
6) if the user deferred the FD request while the timer TDU2 (FD non-mandatory
download timer) was running, shall generate an FD NOTIFICATION indicating
deferral of the FD request as specified in subclause 12.2.1.1;
NOTE 2: Once the timer TDU2 (FD non-mandatory download timer) has expired the
FD request can only be accepted or rejected with an appropriate action by the
MCData client.
NOTE 3: Once the timer TDU2 (FD non-mandatory download timer) has expired, no
action is taken by the MCData client if the FD request is deferred.
7) if the user or application rejects the FD request, shall generate an FD
NOTIFICATION indicating rejection of the FD request as specified in subclause
12.2.1.1 and shall exit this subclause; and
8) if the user accepts the FD request:
a) shall generate an FD NOTIFICATION indicating acceptance of the FD request
as specified in subclause 12.2.1.1;
b) if the FD SIGNALLING PAYLOAD message contains a new Conversation ID, shall
instantiate a new conversation with the Message ID in the FD SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
c) if the FD SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
i) if the FD SIGNALLING PAYLOAD message does not contain an InReplyTo message
ID, shall use the Message ID in the FD SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
ii) if the FD SIGNALLING PAYLOAD message contains an InReplyTo message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo message ID in the FD SIGNALLING PAYLOAD, and
use the Message ID in the FD SIGNALLING PAYLOAD to identify the new message;
d) may store the Conversation ID, Message ID, InReplyTo message ID and Date
and time in local storage;
e) shall attempt to download the file as identified by the file URL in the
Payload IE in the FD SIGNALLING PAYLOAD message, as specified in subclause
10.2.3.1; and
f) if the received FD SIGNALLING PAYLOAD message contains an FD disposition
request type IE requesting a file download completed update, then after the
file download has been successfully downloaded, shall generate an FD
NOTIFICATION by following the procedures in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) void;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.3.1]
The media storage client on the MCData client shall send HTTP requests over a
TLS connection as specified for the HTTP client in the UE, in annex A of 3GPP
TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To download a file from the media storage function on the controlling MCData
function, the media storage client on the MCData client:
1) shall generate an HTTP GET request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23] with a Request-URI set to an absolute URI identifying the
URL of the file being requested from the media storage function on the
controlling MCData function; and
2) shall send the HTTP GET request towards the media storage function on the
controlling MCData function.
On receipt of a HTTP 200 OK response containing the requested file, the MCData
client shall notify the user or application that the file has been
successfully downloaded.
##### 6.2.6.3 Test description {#test-description-21 .H6}
##### 6.2.6.3.1 Pre-test conditions {#pre-test-conditions-21 .H6}
##### System Simulator: {#system-simulator-17 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-17 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test files downloaded or received at previous test runs are deleted.
##### Preamble: {#preamble-17 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.6.3.2 Test procedure sequence {#test-procedure-sequence-21 .H6}
Table 6.2.6.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-1B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for | | | | | | | one-to-one | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\" | | | | | | | and | | | | | | | Mandatory | | | | | | | Download | | | | | | | IE**? | | | | | +------------+------------+------------+---------+---------+----+ | 2-3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | accept and | | | | | | | download | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.11.3-1 | | | | | | | to | | | | | | | download | | | | | | | test file | | | | | | | 1? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 5-10 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD request | | | | | | | and the | | | | | | | file | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 1 (TS | | | | | | | 36.579-7 | | | | | | | A.3.1)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CT | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.3.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.6.3.3 Specific message contents {#specific-message-contents-21 .H6}
Table 6.2.6.3.3-1: SIP MESSAGE from the SS (step 1A, Table 6.2.6.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData Info**  
MIME-part-body MCData-Info as described in Table 6.2.6.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.6.3.3-3
Table 6.2.6.3.3-2: **MCData-Info** (Table 6.2.6.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_1to1
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"
Table 6.2.6.3.3-3: FD Signalling Payload (Table 6.2.6.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.6-1, condition FD_HTTP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** Mandatory download \'0001\'B MANDATORY DOWNLOAD TS 24.282 [31]
clause 15.2.16
Table 6.2.6.3.3-4: Void
Table 6.2.6.3.3-5: SIP MESSAGE from the UE (step 4, Table 6.2.6.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.6.3.3-6
Table 6.2.6.3.3-6: FD NOTIFICATION (Table 6.2.6.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_ACCEPTED
* * *
Table 6.2.6.3.3-7: HTTP GET from the UE (step 4, Table 6.2.6.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.2-1, condition FD_HTTP
* * *
Table 6.2.6.3.3-8: HTTP 200 (OK) from the SS (step 4, Table 6.2.6.3.2-1;\ step
5, TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.6-1, condition FD_HTTP
* * *
Table 6.2.6.3.3-9..10: Void
Table 6.2.6.3.3-11: SIP MESSAGE from the UE (step 4, Table 6.2.6.3.2-1;\ step
6a1, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.6.3.3-12
Table 6.2.6.3.3-12: FD NOTIFICATION (Table 6.2.6.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_COMPLETED
* * *
### 6.2.7 On-network / File Distribution (FD) / FD Using HTTP / Group
Standalone FD / Mandatory Download / Without Disposition Request / Client
Originated (CO)
##### 6.2.7.1 Test Purpose (TP) {#test-purpose-tp-22 .H6}
##### (1) {#section-88 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a Group Standalone FD message with
a mandatory download and without a disposition request and the UE (MCDATA
Client) is unaware of the URL of the Media Storage Function }
**then** { UE (MCDATA Client) sends a SIP MESSAGE to find the URL of the Media
Storage Function **and** responds to a SIP MESSAGE that contains the URL of
the Media Storage Function with a SIP 200 (OK) message }
}
##### (2) {#section-89 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a Group Standalone FD message with
a mandatory download and without a disposition request and the UE (MCDATA
Client) is aware of the URL of the Media Storage Function }
**then** { UE (MCDATA Client) uploads the file to the Media Storage Function
via an HTTP POST message **and** then sends the URL of the file location to
the recipient via a SIP MESSAGE message }
}
##### (3) {#section-90 .H6}
**with** { UE (MCDATA Client) having sent the URL of the file location to the
recipient }
**ensure that** {
**when** { UE (MCDATA Client) receives a FD notification via a SIP MESSAGE
message }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message with a SIP
200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.2.7.2 Conformance requirements {#conformance-requirements-22 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.1.3.2, 10.2.2.1, 10.2.4.2.1, 12.2.1.2.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.1.3.2]
To discover the absolute URI of the media storage function, the MCData client
shall generate a SIP MESSAGE request towards the participating MCData
function, in accordance with 3GPP TS 24.229 [5] and IETF RFC 3428 [6] with the
clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with a \ element containing the value \"msf-
disc-req\";
4) if the upload of a file is for a group standalone FD request, shall include
in an application/vnd.3gpp.mcdata-info+xml MIME body, the \ element set to the required MCData group identity; and
NOTE 1: The absence of a group identity in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body implies that the
MCData client intends to upload a file for a one-to-one FD request. In this
case, the participating MCData function identifies the MCData ID of the user
from the binding between the public user identity and the MCData ID.
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
On receipt of a \"SIP MESSAGE request for absolute URI discovery response\",
the MCData client:
1) shall store the absolute URI found in the \ element;
2) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5]; and
3) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.2.1]
If the media storage client is not aware of the absolute URI of the media
storage function, the media storage client shall request the MCData client to
discover the absolute URI associated with the media storage function by
following the procedures in subclause 10.2.1.3.
The media storage client shall send HTTP requests over a TLS connection as
specified for the HTTP client in the UE in annex A of 3GPP TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To upload a file to media storage function, the media storage client:
1) shall generate an HTTP POST request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23];
2) shall set the Request-URI to the absolute URI identifying the resource on a
media storage function;
3) shall set the Host header field to a hostname identifying the media storage
function;
4) shall set the Content-Type header field to multipart/mixed and with a
boundary delimiter parameter set to any chosen value;
5) if the file upload is for one-to-one file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"one-to-one-fd\"; and
b) the \ element set to the originating MCData ID;
6) if the file upload is for group file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"group-fd\";
b) the \ element set to the MCData group identity; and
c) the \ element set to the originating MCData ID;
7) if end-to-end security is required for a one-to-one communication, the
MCData client protects the binary data representing the file and prefixes the
protected binary data with security parameters as described in 3GPP TS 33.180
[26];
8) if
i) end-to-end security is not required for a one-to-one communication, or
ii) the file upload is for group file distribution;
shall include the binary data representing the file with Content-Type field
set to application/octet-stream and Content-Length field set to the file size;
and
9) shall send the HTTP POST request towards the media storage function.
On receipt of a HTTP 201 Created containing a Location header field with a URL
identifying the location of the resource where the file has been stored on the
media storage function, then the media storage client shall store this
information.
[TS 24.282, clause 10.2.4.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) if a one-to-one standalone FD message is to be sent shall insert in the SIP
MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [9];
and
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-fd\";
...
4) shall generate a standalone FD message as specified in subclause 6.2.2.2;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.2.7.3 Test description {#test-description-22 .H6}
##### 6.2.7.3.1 Pre-test conditions {#pre-test-conditions-22 .H6}
##### System Simulator: {#system-simulator-18 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-18 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 is available at the UE
for upload.
##### Preamble: {#preamble-18 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.7.3.2 Test procedure sequence {#test-procedure-sequence-22 .H6}
Table 6.2.7.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO group | | | | | | | FD over | | | | | | | HTTP for | | | | | | | mandatory | | | | | | | download | | | | | | | and | | | | | | | without | | | | | | | d | | | | | | | isposition | | | | | | | request. | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'_| | | | | | |_ Discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.9.3-1 | | | | | | | ? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP**\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 4-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | REQUEST | | | | | | | AC | | | | | | | CEPTED\"** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 3? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | client has | | | | | | | accepted | | | | | | | the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CO | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.7.3.3 Specific message contents {#specific-message-contents-22 .H6}
Table 6.2.7.3.3-1..6: Void
Table 6.2.7.3.3-7: HTTP POST from the UE (step 3, Table 6.2.7.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.3-1, condition FD_HTTP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.7.3.3-8
Table 6.2.7.3.3-8: MCData-Info (Table 6.2.7.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"  
mcdata-request-uri px_MCData_Group_A_ID NOTE: the element is not encrypted  
mcdata-calling-user-id px_MCData_ID_User_A NOTE: the element is not encrypted
Table 6.2.7.3.3-9: Void
Table 6.2.7.3.3-10: HTTP 201 Created from the SS (step 3, Table 6.2.7.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3C.10.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
Table 6.2.7.3.3-11: SIP MESSAGE from the UE (step 3, Table 6.2.7.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.7.3.3-12  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.7.3.3-13
Table 6.2.7.3.3-12: MCData-Info (Table 6.2.7.3.3-11)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.7.3.3-13: FD Signalling Payload (Table 6.2.5.3.3-12)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_HTTP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** FD disposition request type Not present no disposition request  
Mandatory download \'0001\'B MANDATORY DOWNLOAD TS 24.282 [31] clause 15.2.16
Table 6.2.7.3.3-14: SIP MESSAGE from the SS (step 7, Table 6.2.7.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-15  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION
from the SS as described in Table 6.2.3.3.3-17
Table 6.2.7.3.3-15: MCData-Info (Table 6.2.7.3.3-14)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.2.7.3.3-16: FD NOTIFICATION (Table 6.2.7.3.3-14)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_ACCEPTED
* * *
### 6.2.8 On-network / File Distribution (FD) / FD Using HTTP / Group
Standalone FD / Mandatory Download / Without Disposition Request / Client
Terminated (CT)
##### 6.2.8.1 Test Purpose (TP) {#test-purpose-tp-23 .H6}
##### (1) {#section-91 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP MESSAGE message for a group
standalone FD message with a mandatory download and without a disposition
request }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message **and**
notifies the MCDATA User about the incoming FD request and that the file
identified by file URL in the Payload data in the Payload IE will be
downloaded automatically **and** generates an FD NOTIFICATION indicating
acceptance of the FD request **and** attempts to download the file with an
HTTP GET message }
}
##### (2) {#section-92 .H6}
**with** { UE (MCDATA Client) having started to download the file by sending
an HTTP GET message }
**ensure that** {
**when** { UE (MCDATA Client) has successfully downloaded the file }
**then** { UE (MCDATA Client) notifies the MCDATA User that the file has
successfully downloaded }
}
##### 6.2.8.2 Conformance requirements {#conformance-requirements-23 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.4.2.2, 10.2.1.2.3, 12.2.1.1, 10.2.3.1.
The following represents a copy/paste extraction of the requirements relevant
to the test purpose; any references within the copy/paste text should be
understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.4.2.2]
Upon receipt of a \"SIP MESSAGE request for FD using HTTP for terminating
MCData client\", the MCData client:
1) may reject the SIP MESSAGE request if there are not enough resources to
handle the SIP MESSAGE request;
2) if the SIP MESSAGE request is rejected in step 1), shall respond towards
the participating MCData function with a SIP 480 (Temporarily unavailable)
response and skip the rest of the steps of this subclause;
3) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
4) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
5) shall handle the received message as specified in subclause 10.2.1.2.
[TS 24.282, clause 10.2.1.2.3]
The MCData client:
1) if the FD SIGNALLING PAYLOAD message does not contain an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is for user consumption;
b) shall notify the user about the incoming FD request; and
c) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the user;
2) if the FD SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the Payload IE in the FD
SIGNALLING PAYLOAD message is not for user consumption;
b) if the Application ID value is unknown, shall discard the FD message and
exit this subclause;
c) if the Application ID value is known, shall notify the application of the
incoming FD request; and
NOTE 1: If FD request is addressed to a non-MCData application that is not
running, the MCData client starts the local non-MCData application.
d) if the FD SIGNALLING PAYLOAD message contains a Metadata IE, shall deliver
the contents of the Metadata IE to the application;
3) shall start a timer TDU2 (FD non-mandatory download timer) with the timer
value as specified in subclause F.2.3;
4) shall wait for the user or application to request to download the file
indicated by file URL in the Payload data in the Payload IE in the FD
SIGNALLING PAYLOAD message;
5) if the user or application accepts or rejects or decides to defer the FD
request, shall stop timer TDU2 (FD non-mandatory download timer);
6) if the user deferred the FD request while the timer TDU2 (FD non-mandatory
download timer) was running, shall generate an FD NOTIFICATION indicating
deferral of the FD request as specified in subclause 12.2.1.1;
NOTE 2: Once the timer TDU2 (FD non-mandatory download timer) has expired the
FD request can only be accepted or rejected with an appropriate action by the
MCData client.
NOTE 3: Once the timer TDU2 (FD non-mandatory download timer) has expired, no
action is taken by the MCData client if the FD request is deferred.
7) if the user or application rejects the FD request, shall generate an FD
NOTIFICATION indicating rejection of the FD request as specified in subclause
12.2.1.1 and shall exit this subclause; and
8) if the user accepts the FD request:
a) shall generate an FD NOTIFICATION indicating acceptance of the FD request
as specified in subclause 12.2.1.1;
b) if the FD SIGNALLING PAYLOAD message contains a new Conversation ID, shall
instantiate a new conversation with the Message ID in the FD SIGNALLING
PAYLOAD identifying the first message in the conversation thread;
c) if the FD SIGNALLING PAYLOAD message contains an existing Conversation ID
and:
i) if the FD SIGNALLING PAYLOAD message does not contain an InReplyTo message
ID, shall use the Message ID in the FD SIGNALLING PAYLOAD to identify a new
message in the existing conversation thread; and
ii) if the FD SIGNALLING PAYLOAD message contains an InReplyTo message ID,
shall associate the message to an existing message in the conversation thread
as identified by the InReplyTo message ID in the FD SIGNALLING PAYLOAD, and
use the Message ID in the FD SIGNALLING PAYLOAD to identify the new message;
d) may store the Conversation ID, Message ID, InReplyTo message ID and Date
and time in local storage;
e) shall attempt to download the file as identified by the file URL in the
Payload IE in the FD SIGNALLING PAYLOAD message, as specified in subclause
10.2.3.1; and
f) if the received FD SIGNALLING PAYLOAD message contains an FD disposition
request type IE requesting a file download completed update, then after the
file download has been successfully downloaded, shall generate an FD
NOTIFICATION by following the procedures in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.8.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) void;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.3.1]
The media storage client on the MCData client shall send HTTP requests over a
TLS connection as specified for the HTTP client in the UE, in annex A of 3GPP
TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To download a file from the media storage function on the controlling MCData
function, the media storage client on the MCData client:
1) shall generate an HTTP GET request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23] with a Request-URI set to an absolute URI identifying the
URL of the file being requested from the media storage function on the
controlling MCData function; and
2) shall send the HTTP GET request towards the media storage function on the
controlling MCData function.
On receipt of a HTTP 200 OK response containing the requested file, the MCData
client shall notify the user or application that the file has been
successfully downloaded.
##### 6.2.8.3 Test description {#test-description-23 .H6}
##### 6.2.8.3.1 Pre-test conditions {#pre-test-conditions-23 .H6}
##### System Simulator: {#system-simulator-19 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-19 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test files downloaded or received at previous test runs are deleted.
##### Preamble: {#preamble-19 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.8.3.2 Test procedure sequence {#test-procedure-sequence-23 .H6}
Table 6.2.8.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-1B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | the | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | for group | | | | | | | file | | | | | | | di | | | | | | | stribution | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\" | | | | | | | and | | | | | | | Mandatory | | | | | | | Download | | | | | | | IE**? | | | | | +------------+------------+------------+---------+---------+----+ | 2-3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4-4C | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps 2-5 | | | | | | | of | | | | | | | procedure | | | | | | | \'**FD | | | | | | | file | | | | | | | accept and | | | | | | | download | | | | | | | using | | | | | | | HTTP** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.11.3-1 | | | | | | | to | | | | | | | download | | | | | | | test file | | | | | | | 1? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 5-7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | - | EXCEPTION: | - | - | - | - | | | In | | | | | | | parallel | | | | | | | to the | | | | | | | events | | | | | | | described | | | | | | | in step 8 | | | | | | | and step 9 | | | | | | | the events | | | | | | | described | | | | | | | in Table | | | | | | | 6 | | | | | | | .2.8.3.2-2 | | | | | | | take | | | | | | | place. | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user of | | | | | | | the | | | | | | | incoming | | | | | | | FD request | | | | | | | and the | | | | | | | file | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 1 (TS | | | | | | | 36.579-7 | | | | | | | A.3.1)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | The SS | - | - | - | - | | | releases | | | | | | | the RRC | | | | | | | connection | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CT | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.3.1. | | | | | | +------------+------------+------------+---------+---------+----+
Table 6.2.8.3.2-2: Parallel Behaviour
St Procedure Message Sequence TP Verdict
* * *
                                                                                                                                                                                               U - S              Message
1 Check: Does the UE (MCData client) send a SIP MESSAGE request for
notification of file download completed in parallel to step 8 and step 9 of
Table 6.2.8.3.22-1 or at least for 10s? --> SIP MESSAGE - F
##### 6.2.8.3.3 Specific message contents {#specific-message-contents-23 .H6}
Table 6.2.8.3.3-1: SIP MESSAGE from the SS (step 1A, Table 6.2.8.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.8.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.8.3.3-3
Table 6.2.8.3.3-2: MCData-Info (Table 6.2.8.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_grp
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.8.3.3-3: FD Signalling Payload (Table 6.2.6.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.6-1, condition FD_HTTP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** FD disposition request type Not present no disposition request  
Mandatory download \'0001\'B MANDATORY DOWNLOAD TS 24.282 [31] clause 15.2.16
Table 6.2.8.3.3-4: Void
Table 6.2.8.3.3-5: SIP MESSAGE from the UE (step 4, Table 6.2.8.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.11.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-headers MCData-Info as described in Table 6.2.8.3.3-6  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.8.3.3-7
Table 6.2.8.3.3-6: MCData-Info (Table 6.2.8.3.3-5)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI set to
px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table 5.5.3.2.1-3A
Table 6.2.8.3.3-7: FD NOTIFICATION (Table 6.2.8.3.3-5)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_ACCEPTED
* * *
Table 6.2.8.3.3-8: HTTP GET from the UE (step 4, Table 6.2.8.3.2-1;\ step 4,
TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.2-1, condition FD_HTTP
* * *
Table 6.2.8.3.3-9: HTTP 200 (OK) from the SS (step 4, Table 6.2.8.3.2-1;\ step
5, TS 36.579-1 [2] Table 5.3C.11.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.6-1, condition FD_HTTP
* * *
Table 6.2.8.3.3-10: Void
### 6.2.9 On-network / File Distribution (FD) / FD Using Media Plane / One-to-
one Standalone FD / Client Originated (CO)
##### 6.2.9.1 Test Purpose (TP) {#test-purpose-tp-24 .H6}
##### (1) {#section-93 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a one-to-one standalone FD message
using the media plane}
**then** { UE (MCDATA Client) sends a request to establish an MSRP connection
via a SIP INVITE message **and** then responds to the SIP 200 (OK) message
with a SIP ACK message }
}
##### (2) {#section-94 .H6}
**with** { UE (MCDATA Client) having requested the establishment of a MSRP
connection }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP 200 (OK) message with the a=setup
attribute set to \"passive\" from the SS (MCDATA server) }
**then** { UE (MCDATA Client) sends a blank MSRP SEND message to bind the MSRP
connection **and** then sends the one-to-one standalone FD message via a MSRP
SEND message }
}
##### (3) {#section-95 .H6}
**with** { UE (MCDATA Client) having sent a one-to-one standalone FD message
using the media plane }
**ensure that** {
**when** { UE (MCDATA Client receives a MSRP 200 (OK) message in response to
the last MSRP SEND message indicating that the standalone FD message has been
successfully transferred }
**then** { UE (MCDATA Client) sends a SIP BYE message }
}
##### (4) {#section-96 .H6}
**with** { UE (MCDATA Client) having sent a one-to-one standalone FD message
using the media plane with a disposition of \"FILE DOWNLOAD COMPLETED UPDATE\"
}
**ensure that** {
**when** { UE (MCDATA Client receives a disposition response via a SIP MESSAGE
message from the SS (MCDATA Server }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.2.9.2 Conformance requirements {#conformance-requirements-24 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.5.2.3, 6.2.2.3, 12.2.1.2, TS 24.582
clause 7.1.2.1. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.5.2.3]
The MCData client shall generate a SIP INVITE request in accordance with 3GPP
TS 24.229 [5] with the clarifications given below.
The MCData client:
1) shall include the g.3gpp.mcdata.fd media feature tag and the g.3gpp.icsi-
ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.fd\" in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.fd media feature tag along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.fd\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP INVITE request;
5) should include the \"timer\" option tag in the Supported header field;
6) should include the Session-Expires header field according to IETF RFC 4028
[38]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
7) shall generate and contain an application/vnd.3gpp.mcdata-signalling MIME
body with the FD SIGNALLING PAYLOAD as described in subclause 6.2.2.3;
8) if a one-to-one file distribution is requested:
a) shall insert in the SIP INVITE request a MIME resource-lists body with the
MCData ID of the invited MCData user, according to rules and procedures of
IETF RFC 5366 [18]; and
b) shall contain an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"one-to-one-fd\";
c) if an end-to-end security context needs to be established and the security
context does not exist or if the existing security context has expired, then:
i) if necessary, shall instruct the key management client to request keying
material from the key management server as described in 3GPP TS 33.180 [26];
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [26];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [26];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [26];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [26]; and
vi) shall add the MCData ID of the originating MCData to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26]; and
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCData user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.180 [26];
9) if a group file distribution is requested:
a) if the \"/_\ _/\/Common/MCData/AllowedFD\" leaf node present in the
group document of the requested MCData group, configured on the group
management client as specified in 3GPP TS 24.483 [42] is set to \"false\",
shall reject the request for FD and not continue with the rest of the steps in
this subclause; and
b) shall contain in an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"group-fd\";
ii) the \ element set to the MCData group identity; and
iii) the \ element set to the MCData client ID of the
originating MCData client;
NOTE 1: The MCData client does not include the MCData ID of the originating
MCData user in the body, as this will be inserted into the body of the SIP
INVITE request that is sent from the originating participating MCData
function.
10) shall set the Request-URI of the SIP INVITE request to the public service
identity identifying the participating MCData function serving the MCData
user;
NOTE 2: The MCData client is configured with public service identity
identifying the participating MCData function serving the MCData user.
11) may include a P-Preferred-Identity header field in the SIP INVITE request
containing a public user identity as specified in 3GPP TS 24.229 [5];
12) shall include an SDP offer according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 10.2.5.2.1; and
13) shall send the SIP INVITE request towards the MCData server according to
3GPP TS 24.229 [5].
On receipt of a SIP 2xx response to the SIP INVITE request, the MCData client:
1) shall send a SIP ACK request as specified in 3GPP TS 24.229 [5];
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [38]; and
3) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 10.2.5.1.1..
[TS 24.282, clause 6.2.2.3]
In order to generate an FD message, the MCData client:
1) shall generate an FD SIGNALLING PAYLOAD message as specified in subclause
15.1.3; and
2) shall include in the SIP request, the FD SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an FD SIGNALLING PAYLOAD message as specified in subclause
15.1.3, the MCData client:
1) shall set the Date and time IE to the current time as specified in
subclause 15.2.8;
2) if the filestarts a new conversation, shall set the Conversation ID IE to a
newly generated Conversation ID value as specified in subclause 15.2.9;
3) if the file continues an existing conversation, shall set the Conversation
ID IE to the Conversation ID value of the existing conversation as specified
in subclause 15.2.9;
4) shall set the Message ID IE to a newly generated Message ID value as
specified in subclause 15.2.10;
5) if the files in reply to a previously received SDS message or file, shall
include the InReplyTo message ID IE with the Message ID value in the
previously received SDS message or file;
6) if the file is for user consumption, shall not include an Application ID IE
as specified in subclause 15.2.7;
7) if the file is intended for an application on the terminating MCData
client, shall include an Application ID IE with an Application ID value
representing the intended application as specified in subclause 15.2.7;
NOTE: The value chosen for the Application ID value is decided by the mission
critical organisation.
8) if a file download complete notification is required shall include a FD
disposition request type IE set to \"FILE DOWNLOAD COMPLETED UPDATE\" as
specified in subclause 15.2.4; and
9) shall include and set the Mandatory download IE to \"MANDATORY DOWNLOAD\"
as described in subclause 15.2.16.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
[TS 24.582, clause 6.1.1.2.1]
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
If MSRP chunking is not used then on receipt of a 200 (OK) response, the
MCData client shall terminate the SIP session as specified in 3GPP TS 24.282
[8].
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the SDS message could not be sent; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
On receiving an indication to terminate the session from the signalling plane,
the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks and may indicate to MCData user that the SDS message
could not be sent.
[TS 24.582, clause 7.1.2.1]
Upon receiving an indication to establish MSRP connection for file
distribution as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client can send the file. To send the file, the MCData client:
1\. shall generate MSRP SEND for file distribution request according to IETF
RFC 4975 [11]. When generating an MSRP SEND, the MCData client:
a. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
b. shall set the first content type as Content-Type =
\"application/vnd.3gpp.mcdata-file\"; and
c. shall set the body of the MSRP SEND request with MSRP payload. MSRP payload
is set to the file or part of the file.
2\. shall send the MSRP SEND request(s) on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests containing the file as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the file could not be distributed; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
##### 6.2.9.3 Test description {#test-description-24 .H6}
##### 6.2.9.3.1 Pre-test conditions {#pre-test-conditions-24 .H6}
##### System Simulator: {#system-simulator-20 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-20 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 is available at the UE
for upload.
##### Preamble: {#preamble-20 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.9.3.2 Test procedure sequence {#test-procedure-sequence-24 .H6}
Table 6.2.9.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO | | | | | | | one-to-one | | | | | | | FD over | | | | | | | media | | | | | | | plane with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.2.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an FD | | | | | | | message | | | | | | | containing | | | | | | | test file | | | | | | | 1 for CO | | | | | | | FD**? | | | | | +------------+------------+------------+---------+---------+----+ | 7A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | t | | | | | | | ransferred | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.6.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 7? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CO | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.9.3.3 Specific message contents {#specific-message-contents-24 .H6}
Table 6.2.9.3.3-1: SIP INVITE from the UE (step 2, Table 6.2.9.3.2-1;\ step 2,
TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MCDATA_FD,
MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.9.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.9.3.3-3  
MIME body part **MCData Data signalling message**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.9.3.3-3A
Table 6.2.9.3.3-2: SDP for SIP INVITE (Table 6.2.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_FD,
SDP_OFFER, MCD_1to1
* * *
Table 6.2.9.3.3-3: MCData-Info (Table 6.2.9.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"
Table 6.2.9.3.3-3A: FD SIGNALLING PAYLOAD (Table 6.2.9.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_MSRP
* * *
Table 6.2.9.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.2.9.3.2-1;\ step
4, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
SDP message As described in Table 6.2.9.3.3-5
Table 6.2.9.3.3-5: SDP for SIP 200 (OK) (Table 6.2.9.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_FD,
SDP_ANSWER
* * *
Table 6.2.9.3.3-6: MSRP SEND from the UE (step 7, Table 6.2.9.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"application/vnd.3gpp.mcdata-file\"_  
**data** _As specified in table 6.2.9.3.3-8_
Table 6.2.9.3.3-7: Void
Table 6.2.9.3.3-8: MCData Protected Payload Message (Table 6.2.9.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.10-1, condition PROTECTED_FILE,
PCK
* * *
Table 6.2.9.3.3-9..10: Void
Table 6.2.9.3.3-11: SIP BYE from the UE (step 8, Table 6.2.9.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason** RFC 3326 [125]  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.2.9.3.3-12: Void
Table 6.2.9.3.3-13: SIP MESSAGE from the SS (step 10, Table 6.2.9.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.9.3.3-15
Table 6.2.9.3.3-14: Void
Table 6.2.9.3.3-15: FD NOTIFICATION (Table 6.2.9.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_COMPLETED
* * *
Table 6.2.9.3.3-16: Void
### 6.2.10 On-network / File Distribution (FD) / FD Using Media Plane / One-
to-one Standalone FD / Client Terminated (CT)
##### 6.2.10.1 Test Purpose (TP) {#test-purpose-tp-25 .H6}
##### (1) {#section-97 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a SIP INVITE to initiate a standalone one-
to-one FD message using the media plane }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### (2) {#section-98 .H6}
**with** { UE (MCDATA Client) having responded to the SIP INVITE message that
initiated a standalone one-to-one FD message using the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message from the SS
(MCDATA Server) }
**then** { UE (MCDATA Client) responds with an MSRP 200 (OK) message }
}
##### (3) {#section-99 .H6}
**with** { UE (MCDATA Client) having finished receiving the file from the SS
(MCDATA server) }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP BYE message to release
communications }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message **and**
then sends a \"FILE DOWNLOAD COMPLETED\" disposition via a SIP MESSAGE message
}
}
##### 6.2.10.2 Conformance requirements {#conformance-requirements-25 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.5.2.4, 12.2.1.1, 6.2.3.2, TS 24.582
clauses 7.1.3.1, 7.1.3.2. The following represents a copy/paste extraction of
the requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.5.2.4]
Upon receipt of an initial SIP INVITE request, the MCData client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [5] with the clarifications below.
The MCData client:
1) may reject the SIP INVITE request if either of the following conditions are
met:
a) MCData client does not have enough resources to handle the call; or
b) any other reason outside the scope of this specification;
and skip the rest of the steps after step 2;
2) if the SIP INVITE request is rejected in step 1), shall respond toward
participating MCData function either with appropriate reject code as specified
in 3GPP TS 24.229 [5] and warning texts as specified in subclause 4.9 or with
SIP 480 (Temporarily unavailable) response not including warning texts if the
user is authorised to restrict the reason for failure and skip the rest of the
steps of this subclause;
3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as
specified in IETF RFC 4567 [45], and include warning text set to \"136
authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field
as specified in subclause 4.9 and not continue with rest of the steps in this
subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to create an end-to-
end secure session.
4) may display to the MCData user the MCData ID of the inviting MCData user;
5) may display to the MCData user the file meta-data of the incoming file as
described by the SDP included in the received SIP INVITE request;
6) if the Mandatory indication IE of the FD SIGNALLING PAYLOAD contained in
the application/vnd.3gpp.mcdata-signalling MIME body received in the SIP
INVITE request is set to \"MANDATORY\", then:
i) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [5];
ii) shall include the option tag \"timer\" in a Require header field of the
SIP 200 (OK) response;
iii) shall include the Session-Expires header field in the SIP 200 (OK)
response and start the SIP session timer according to IETF RFC 4028 [38]. The
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\";
iv) shall include the g.3gpp.mcdata.fd media feature tag in the Contact header
field of the SIP 200 (OK) response;
v) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\" in the Contact header field of
the SIP 200 (OK) response;
vi) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 10.2.5.2.2; and
vii) shall send the SIP 200 (OK) response towards the MCData server according
to rules and procedures of 3GPP TS 24.229 [5].
On receipt of an SIP ACK message to the sent SIP 200 (OK) message, the MCData
client shall:
1) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 10.2.5.1.2.
On receipt of an indication from the media plane of the successful download of
the file and if the received FD SIGNALLING PAYLOAD message contained an FD
disposition request type IE requesting a file download completed update
indication, then, the MCData client:
1) shall follow the procedures described in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.3.2]
In order to generate an FD notification, the MCData client:
1) shall generate an FD NOTIFICATION message as specified in subclause 15.1.6;
and
2) shall include in the SIP request, the FD NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an FD NOTIFICATION message as specified in subclause 15.1.6,
the MCData client:
1) if sending a file download accept notification, shall set the FD
disposition notification type IE as \"FILE DOWNLOAD REQUEST ACCEPTED\" as
specified in subclause 15.2.6;
2) if sending a file download reject notification, shall set the FD
disposition notification type IE as \"FILE DOWNLOAD REQUEST REJECTED\" as
specified in subclause 15.2.6;
3) if sending a file download deferred notification, shall set the FD
disposition notification type IE as \"FILE DOWNLOAD REQUEST DEFERRED\" as
specified in subclause 15.2.6;
4) shall set the Conversation ID to the value of the Conversation ID that was
received in the FD message as specified in subclause 15.2.9;
5) shall set the Date and time IE to the current time as specified in
subclause 15.2.8; and
6) if sending a file download completed notification:
a) shall set the FD disposition notification type IE as \"FILE DOWNLOAD
COMPLETED\" as specified in subclause 15.2.6;
b) shall set the Message ID to the value of the Message ID that was received
in the FD message as specified in subclause 15.2.10;
c) if the FD message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
d) if the FD message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the FD message as specified in subclause 15.2.3.
[TS 24.582, clause 7.1.3.1]
Upon receiving an indication to establish MSRP connection for file
distribution as the terminating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the file before
delivering the content to the application; and
3\. shall handle the received content as described in subclause 7.1.3.2.
[TS 24.582, clause 7.1.3.2]
Upon receiving a file, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-file MIME
body; and
2\. once all the chunks of the file are successfully received, shall indicate
to the signalling plane that the file download is completed.
##### 6.2.10.3 Test description {#test-description-25 .H6}
##### 6.2.10.3.1 Pre-test conditions {#pre-test-conditions-25 .H6}
##### System Simulator: {#system-simulator-21 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-21 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test files downloaded or received at previous test runs are deleted.
##### Preamble: {#preamble-21 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.10.3.2 Test procedure sequence {#test-procedure-sequence-25 .H6}
Table 6.2.10.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.3.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 2-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | co | | | | | | | ntaining** | | | | | | | test file | | | | | | | 1? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.7.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9-10 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | to **send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | for the | | | | | | | file | | | | | | | received | | | | | | | at step | | | | | | | 6**? | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 13 | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 1 (TS | | | | | | | 36.579-7 | | | | | | | A.3.1)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CT | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.3.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.10.3.3 Specific message contents {#specific-message-contents-25 .H6}
Table 6.2.10.3.3-1: SIP INVITE from the SS (step 1, Table 6.2.10.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MCDATA_FD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.10.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.10.3.3-3  
MIME body part **MCData Data signalling message**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.10.3.3-3A
Table 6.2.10.3.3-2: SDP for SIP INVITE (Table 6.2.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_FD,
SDP_OFFER, MCD_1to1
* * *
Table 6.2.10.3.3-3: MCData-Info (Table 6.2.10.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_1to1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"one-to-one-fd\"
Table 6.2.10.3.3-3A: FD SIGNALLING PAYLOAD (Table 6.2.10.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.6-1, condition FD_MSRP
* * *
Table 6.2.10.3.3-4: SIP 200 (OK) from the UE (step 1, Table 6.2.10.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
value \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.2.10.3.3-5
Table 6.2.10.3.3-5: SDP for SIP 200 (OK) (Table 6.2.10.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_FD,
SDP_ANSWER
* * *
Table 6.2.10.3.3-6: MSRP SEND from the SS (step 6, Table 6.2.10.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"application/vnd.3gpp.mcdata-file\"_  
**data** _As specified in table 6.2.10.3.3-8_
Table 6.2.10.3.3-7: Void
Table 6.2.10.3.3-8: MCData Protected Payload Message (Table 6.2.9.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.10-2, condition PROTECTED_FILE,
PCK
* * *
Table 6.2.10.3.3-9: SIP BYE from the SS (step 8, Table 6.2.10.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.7.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason**  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.2.10.3.3-10: Void
Table 6.2.10.3.3-11: SIP MESSAGE from the UE (step 11, Table 6.2.10.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part not present **MCData-Info**  
MIME body part **MCData Data signalling message**  
MIME-part-body SDS NOTIFICATION as described in Table 6.2.10.3.3-12
Table 6.2.10.3.3-12: FD NOTIFICATION (Table 6.2.2.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_COMPLETED
* * *
### 6.2.11 On-network / File Distribution (FD) / FD Using Media Plane / Group
Standalone FD / Client Originated (CO)
##### 6.2.11.1 Test Purpose (TP) {#test-purpose-tp-26 .H6}
##### (1) {#section-100 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a group standalone FD message
using the media plane}
**then** { UE (MCDATA Client) sends a request to establish an MSRP connection
via a SIP INVITE message **and** then responds to the SIP 200 (OK) message
with a SIP ACK message }
}
##### (2) {#section-101 .H6}
**with** { UE (MCDATA Client) having requested the establishment of a MSRP
connection }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP 200 (OK) message with the a=setup
attribute set to \"passive\" from the SS (MCDATA server) }
**then** { UE (MCDATA Client) sends a blank MSRP SEND message to bind the MSRP
connection **and** then sends the group standalone FD message via a MSRP SEND
message }
}
##### (3) {#section-102 .H6}
**with** { UE (MCDATA Client) having sent a group standalone FD message using
the media plane }
**ensure that** {
**when** { UE (MCDATA Client receives a MSRP 200 (OK) message in response to
the last MSRP SEND message indicating that the standalone FD message has been
successfully transferred }
**then** { UE (MCDATA Client) sends a SIP BYE message }
}
##### (4) {#section-103 .H6}
**with** { UE (MCDATA Client) having sent a group standalone FD message using
the media plane with a disposition of \"FILE DOWNLOAD COMPLETED UPDATE\" }
**ensure that** {
**when** { UE (MCDATA Client receives a disposition response via a SIP MESSAGE
message from the SS (MCDATA Server }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.2.11.2 Conformance requirements {#conformance-requirements-26 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.5.2.3, 6.2.2.3, 12.2.1.2, TS 24.582
clause 7.1.2.1. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.5.2.3]
The MCData client shall generate a SIP INVITE request in accordance with 3GPP
TS 24.229 [5] with the clarifications given below.
The MCData client:
1) shall include the g.3gpp.mcdata.fd media feature tag and the g.3gpp.icsi-
ref media feature tag with the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.fd\" in the Contact header field of the SIP INVITE
request according to IETF RFC 3840 [16];
2) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.fd media feature tag along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
3) shall include an Accept-Contact header field with the g.3gpp.icsi-ref media
feature tag containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.fd\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8];
4) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP INVITE request;
5) should include the \"timer\" option tag in the Supported header field;
6) should include the Session-Expires header field according to IETF RFC 4028
[38]. It is recommended that the \"refresher\" header field parameter is
omitted. If included, the \"refresher\" header field parameter shall be set to
\"uac\";
7) shall generate and contain an application/vnd.3gpp.mcdata-signalling MIME
body with the FD SIGNALLING PAYLOAD as described in subclause 6.2.2.3;
8) if a one-to-one file distribution is requested:
a) shall insert in the SIP INVITE request a MIME resource-lists body with the
MCData ID of the invited MCData user, according to rules and procedures of
IETF RFC 5366 [18]; and
b) shall contain an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"one-to-one-fd\";
c) if an end-to-end security context needs to be established and the security
context does not exist or if the existing security context has expired, then:
i) if necessary, shall instruct the key management client to request keying
material from the key management server as described in 3GPP TS 33.180 [26];
ii) shall use the keying material to generate a PCK as described in 3GPP TS
33.180 [26];
iii) shall use the PCK to generate a PCK-ID with the four most significant
bits set to \"0001\" to indicate that the purpose of the PCK is to protect
one-to-one communications and with the remaining twenty eight bits being
randomly generated as described in 3GPP TS 33.180 [26];
iv) shall encrypt the PCK to a UID associated to the MCData client using the
MCData ID of the invited user and a time related parameter as described in
3GPP TS 33.180 [26];
v) shall generate a MIKEY-SAKKE I_MESSAGE using the encapsulated PCK and PCK-
ID as specified in 3GPP TS 33.180 [26]; and
vi) shall add the MCData ID of the originating MCData to the initiator field
(IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26]; and
vii) shall sign the MIKEY-SAKKE I_MESSAGE using the originating MCData user\'s
signing key provided in the keying material together with a time related
parameter, and add this to the MIKEY-SAKKE payload, as described in 3GPP TS
33.180 [26];
9) if a group file distribution is requested:
a) if the \"/_\ _/\/Common/MCData/AllowedFD\" leaf node present in the
group document of the requested MCData group, configured on the group
management client as specified in 3GPP TS 24.483 [42] is set to \"false\",
shall reject the request for FD and not continue with the rest of the steps in
this subclause; and
b) shall contain in an application/vnd.3gpp.mcdata-info+xml MIME body with the
\ element containing the \ element with:
i) the \ element set to a value of \"group-fd\";
ii) the \ element set to the MCData group identity; and
iii) the \ element set to the MCData client ID of the
originating MCData client;
NOTE 1: The MCData client does not include the MCData ID of the originating
MCData user in the body, as this will be inserted into the body of the SIP
INVITE request that is sent from the originating participating MCData
function.
10) shall set the Request-URI of the SIP INVITE request to the public service
identity identifying the participating MCData function serving the MCData
user;
NOTE 2: The MCData client is configured with public service identity
identifying the participating MCData function serving the MCData user.
11) may include a P-Preferred-Identity header field in the SIP INVITE request
containing a public user identity as specified in 3GPP TS 24.229 [5];
12) shall include an SDP offer according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 10.2.5.2.1; and
13) shall send the SIP INVITE request towards the MCData server according to
3GPP TS 24.229 [5].
On receipt of a SIP 2xx response to the SIP INVITE request, the MCData client:
1) shall send a SIP ACK request as specified in 3GPP TS 24.229 [5];
2) shall start the SIP Session timer according to rules and procedures of IETF
RFC 4028 [38]; and
3) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 10.2.5.1.1..
[TS 24.282, clause 6.2.2.3]
In order to generate an FD message, the MCData client:
1) shall generate an FD SIGNALLING PAYLOAD message as specified in subclause
15.1.3; and
2) shall include in the SIP request, the FD SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an FD SIGNALLING PAYLOAD message as specified in subclause
15.1.3, the MCData client:
1) shall set the Date and time IE to the current time as specified in
subclause 15.2.8;
2) if the filestarts a new conversation, shall set the Conversation ID IE to a
newly generated Conversation ID value as specified in subclause 15.2.9;
3) if the file continues an existing conversation, shall set the Conversation
ID IE to the Conversation ID value of the existing conversation as specified
in subclause 15.2.9;
4) shall set the Message ID IE to a newly generated Message ID value as
specified in subclause 15.2.10;
5) if the files in reply to a previously received SDS message or file, shall
include the InReplyTo message ID IE with the Message ID value in the
previously received SDS message or file;
6) if the file is for user consumption, shall not include an Application ID IE
as specified in subclause 15.2.7;
7) if the file is intended for an application on the terminating MCData
client, shall include an Application ID IE with an Application ID value
representing the intended application as specified in subclause 15.2.7;
NOTE: The value chosen for the Application ID value is decided by the mission
critical organisation.
8) if a file download complete notification is required shall include a FD
disposition request type IE set to \"FILE DOWNLOAD COMPLETED UPDATE\" as
specified in subclause 15.2.4; and
9) shall include and set the Mandatory download IE to \"MANDATORY DOWNLOAD\"
as described in subclause 15.2.16.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
[TS 24.582, clause 6.1.1.2.1]
Upon receiving an indication to establish MSRP connection for standalone SDS
using media plane as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client:
1\. shall generate a SDS SIGNALLING PAYLOAD as specified in subclause
6.1.1.2.2;
2\. shall generate a SDS DATA PAYLOAD as specified in subclause 6.1.1.2.3;
3\. shall include the SDS SIGNALLING PAYLOAD and SDS DATA PAYLOAD in an MSRP
SEND request as specified in subclause 6.1.1.2.4; and
4\. shall send the MSRP SEND request on the established MSRP connection.
NOTE: MSRP chunking, if needed, may affect the number of \"Content Type\"
lines in each MSRP SEND message conveying a chunk, as also specified in
subclause 6.1.1.2.4.
If MSRP chunking is not used then on receipt of a 200 (OK) response, the
MCData client shall terminate the SIP session as specified in 3GPP TS 24.282
[8].
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the SDS message could not be sent; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
On receiving an indication to terminate the session from the signalling plane,
the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks and may indicate to MCData user that the SDS message
could not be sent.
[TS 24.582, clause 7.1.2.1]
Upon receiving an indication to establish MSRP connection for file
distribution as the originating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act according to IETF RFC 6135 [12], as:
a. an \"active\" endpoint, if a=setup attribute in the received SDP answer is
set to \"passive\"; and
b. an \"passive\" endpoint, if a=setup attribute in the received SDP answer is
set to \"active\";
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP answer received in the SIP 200 (OK) response according
to IETF RFC 4975 [11]; and
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12].
On receiving MSRP 200 (OK) response to the first MSRP SEND request, the MCData
client can send the file. To send the file, the MCData client:
1\. shall generate MSRP SEND for file distribution request according to IETF
RFC 4975 [11]. When generating an MSRP SEND, the MCData client:
a. shall set To-Path header according to the MSRP URI(s) received in the
answer SDP;
b. shall set the first content type as Content-Type =
\"application/vnd.3gpp.mcdata-file\"; and
c. shall set the body of the MSRP SEND request with MSRP payload. MSRP payload
is set to the file or part of the file.
2\. shall send the MSRP SEND request(s) on the established MSRP connection.
If MSRP chunking is used, the MCData client:
1\. shall send further MSRP SEND requests containing the file as necessary;
2\. shall wait for a 200 (OK) response to each MSRP SEND request sent; and
3\. on receipt of the last 200 (OK) response shall terminate the SIP session
as specified in 3GPP TS 24.282 [8].
On receiving a non-200 MSRP response to the MSRP SEND request the MCData
client shall handle the error as specified in IETF RFC 4975 [11]. To terminate
the MSRP session, the MCData client:
1\. if there are further MSRP chunks to send, shall abort transmission of
these further MSRP chunks;
2\. shall indicate to MCData user that the file could not be distributed; and
3\. shall terminate the SIP session as specified in 3GPP TS 24.282 [8].
##### 6.2.11.3 Test description {#test-description-26 .H6}
##### 6.2.11.3.1 Pre-test conditions {#pre-test-conditions-26 .H6}
##### System Simulator: {#system-simulator-22 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-22 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 is available at the UE
for upload.
##### Preamble: {#preamble-22 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.11.3.2 Test procedure sequence {#test-procedure-sequence-26 .H6}
Table 6.2.11.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO group | | | | | | | FD over | | | | | | | media | | | | | | | plane with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.2.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MSRP | | | | | | | message | | | | | | | tr | | | | | | | ansfer** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.4.3-1 | | | | | | | **to send | | | | | | | an FD | | | | | | | message | | | | | | | containing | | | | | | | test file | | | | | | | 1 for CO | | | | | | | FD**? | | | | | +------------+------------+------------+---------+---------+----+ | 7A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | t | | | | | | | ransferred | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.6.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 10 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 7? | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 12 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CO | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.11.3.3 Specific message contents {#specific-message-contents-26 .H6}
Table 6.2.11.3.3-1: SIP INVITE from the UE (step 2, Table 6.2.11.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.1-1, condition MCDATA_FD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.11.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.11.3.3-3  
MIME body part **MCData Data signalling message**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.11.3.3-3A
Table 6.2.11.3.3-2: SDP for SIP INVITE (Table 6.2.11.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_FD,
SDP_OFFER
* * *
Table 6.2.11.3.3-3: MCData-Info (Table 6.2.11.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.11.3.3-3A: FD SIGNALLING PAYLOAD (Table 6.2.11.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_MSRP
* * *
Table 6.2.11.3.3-4: SIP 200 (OK) from the SS (step 2, Table 6.2.11.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.2.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.2-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
SDP message As described in Table 6.2.11.3.3-5
Table 6.2.11.3.3-5: SDP for SIP 200 (OK) (Table 6.2.11.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_FD,
SDP_ANSWER
* * *
Table 6.2.11.3.3-6: MSRP SEND from the UE (step 7, Table 6.2.11.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.4.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"application/vnd.3gpp.mcdata-file\"_  
**data** _As specified in table 6.2.11.3.3-7_
Table 6.2.11.3.3-7: MCData Protected Payload Message (Table 6.2.11.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.10-1, condition PROTECTED_FILE,
GMK
* * *
Table 6.2.11.3.3-8..9: Void
Table 6.2.11.3.3-10: SIP BYE from the UE (step 8, Table 6.2.11.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.6.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason** RFC 3326 [125]  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.2.11.3.3-11: Void
Table 6.2.11.3.3-13: SIP MESSAGE from the SS (step 10, Table 6.2.11.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body As described in Table 6.2.11.3.3-14  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.11.3.3-15
Table 6.2.11.3.3-14: MCData-Info (Table 6.2.11.3.3-13)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.2.11.3.3-15: FD NOTIFICATION (Table 6.2.11.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_COMPLETED
* * *
Table 6.2.11.3.3-16: Void
### 6.2.12 On-network / File Distribution (FD) / FD Using Media Plane / Group
Standalone FD / Client Terminated (CT)
##### 6.2.12.1 Test Purpose (TP) {#test-purpose-tp-27 .H6}
##### (1) {#section-104 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives a SIP INVITE to initiate a standalone
group FD message using the media plane }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message }
}
##### (2) {#section-105 .H6}
**with** { UE (MCDATA Client) having responded to the SIP INVITE message that
initiated a standalone group FD message using the media plane }
**ensure that** {
**when** { UE (MCDATA Client) receives an MSRP SEND message from the SS
(MCDATA Server) }
**then** { UE (MCDATA Client) responds with an MSRP 200 (OK) message }
}
##### (3) {#section-106 .H6}
**with** { UE (MCDATA Client) having finished receiving the file from the SS
(MCDATA server) }
**ensure that** {
**when** { UE (MCDATA Client) receives a SIP BYE message to release
communications }
**then** { UE (MCDATA Client) responds with a SIP 200 (OK) message **and**
then sends a \"FILE DOWNLOAD COMPLETED\" disposition via a SIP MESSAGE message
}
}
##### 6.2.12.2 Conformance requirements {#conformance-requirements-27 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.5.2.4, 12.2.1.1, 6.2.3.2, TS 24.582
clauses 7.1.3.1, 7.1.3.2. The following represents a copy/paste extraction of
the requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.5.2.4]
Upon receipt of an initial SIP INVITE request, the MCData client shall follow
the procedures for termination of multimedia sessions in the IM CN subsystem
as specified in 3GPP TS 24.229 [5] with the clarifications below.
The MCData client:
1) may reject the SIP INVITE request if either of the following conditions are
met:
a) MCData client does not have enough resources to handle the call; or
b) any other reason outside the scope of this specification;
and skip the rest of the steps after step 2;
2) if the SIP INVITE request is rejected in step 1), shall respond toward
participating MCData function either with appropriate reject code as specified
in 3GPP TS 24.229 [5] and warning texts as specified in subclause 4.9 or with
SIP 480 (Temporarily unavailable) response not including warning texts if the
user is authorised to restrict the reason for failure and skip the rest of the
steps of this subclause;
3) if the SDP offer of the SIP INVITE request contains an \"a=key-mgmt\"
attribute field with a \"mikey\" attribute value containing a MIKEY-SAKKE
I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP INVITE request with a SIP 488 (Not Acceptable Here) response as
specified in IETF RFC 4567 [45], and include warning text set to \"136
authentication of the MIKEY-SAKKE I_MESSAGE failed\" in a Warning header field
as specified in subclause 4.9 and not continue with rest of the steps in this
subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to create an end-to-
end secure session.
4) may display to the MCData user the MCData ID of the inviting MCData user;
5) may display to the MCData user the file meta-data of the incoming file as
described by the SDP included in the received SIP INVITE request;
6) if the Mandatory indication IE of the FD SIGNALLING PAYLOAD contained in
the application/vnd.3gpp.mcdata-signalling MIME body received in the SIP
INVITE request is set to \"MANDATORY\", then:
i) shall accept the SIP INVITE request and generate a SIP 200 (OK) response
according to rules and procedures of 3GPP TS 24.229 [5];
ii) shall include the option tag \"timer\" in a Require header field of the
SIP 200 (OK) response;
iii) shall include the Session-Expires header field in the SIP 200 (OK)
response and start the SIP session timer according to IETF RFC 4028 [38]. The
\"refresher\" parameter in the Session-Expires header field shall be set to
\"uas\";
iv) shall include the g.3gpp.mcdata.fd media feature tag in the Contact header
field of the SIP 200 (OK) response;
v) shall include the g.3gpp.icsi-ref media feature tag containing the value of
\"urn:urn-7:3gpp-service.ims.icsi.mcdata.fd\" in the Contact header field of
the SIP 200 (OK) response;
vi) shall include an SDP answer in the SIP 200 (OK) response to the SDP offer
in the incoming SIP INVITE request according to 3GPP TS 24.229 [5] with the
clarifications given in subclause 10.2.5.2.2; and
vii) shall send the SIP 200 (OK) response towards the MCData server according
to rules and procedures of 3GPP TS 24.229 [5].
On receipt of an SIP ACK message to the sent SIP 200 (OK) message, the MCData
client shall:
1) shall interact with the media plane as specified in 3GPP TS 24.582 [15]
subclause 10.2.5.1.2.
On receipt of an indication from the media plane of the successful download of
the file and if the received FD SIGNALLING PAYLOAD message contained an FD
disposition request type IE requesting a file download completed update
indication, then, the MCData client:
1) shall follow the procedures described in subclause 12.2.1.1.
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
7) if requiring to send an FD notification, shall generate an FD NOTIFICATION
message and include it in the SIP MESSAGE request as specified in subclause
6.2.3.2; and
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.3.2]
In order to generate an FD notification, the MCData client:
1) shall generate an FD NOTIFICATION message as specified in subclause 15.1.6;
and
2) shall include in the SIP request, the FD NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an FD NOTIFICATION message as specified in subclause 15.1.6,
the MCData client:
1) if sending a file download accept notification, shall set the FD
disposition notification type IE as \"FILE DOWNLOAD REQUEST ACCEPTED\" as
specified in subclause 15.2.6;
2) if sending a file download reject notification, shall set the FD
disposition notification type IE as \"FILE DOWNLOAD REQUEST REJECTED\" as
specified in subclause 15.2.6;
3) if sending a file download deferred notification, shall set the FD
disposition notification type IE as \"FILE DOWNLOAD REQUEST DEFERRED\" as
specified in subclause 15.2.6;
4) shall set the Conversation ID to the value of the Conversation ID that was
received in the FD message as specified in subclause 15.2.9;
5) shall set the Date and time IE to the current time as specified in
subclause 15.2.8; and
6) if sending a file download completed notification:
a) shall set the FD disposition notification type IE as \"FILE DOWNLOAD
COMPLETED\" as specified in subclause 15.2.6;
b) shall set the Message ID to the value of the Message ID that was received
in the FD message as specified in subclause 15.2.10;
c) if the FD message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
d) if the FD message was destined for an application, shall include an
Application ID IE set to the value of the Application ID that was included in
the FD message as specified in subclause 15.2.3.
[TS 24.582, clause 7.1.3.1]
Upon receiving an indication to establish MSRP connection for file
distribution as the terminating client, the MCData client:
1\. shall act as an MSRP client according to IETF RFC 6135 [12];
2\. shall act either as an active endpoint or as an passive endpoint to open
the transport connection, according to IETF RFC 6135 [12];
3\. shall establish the MSRP connection according to the MSRP connection
parameters in the SDP offer received in the SIP INVITE request according to
IETF RFC 4975 [11];
4\. if acting as an \"active\" endpoint, shall send an empty MSRP SEND request
to bind the MSRP connection to the MSRP session from the perspective of the
passive endpoint according to the rules and procedures of IETF RFC 4975 [11]
and IETF RFC 6135 [12];
Once the MSRP session is established, the MCData client:
1\. on receipt of an MSRP request in the MSRP session, shall follow the rules
and procedures defined in IETF RFC 4975 [11] and in IETF RFC 6714 [13];
2\. If an MSRP SEND request indicates the use of chunking, shall wait until
all further MSRP SEND requests for the remaining chunks have been received and
shall reassemble the entire set of MSRP requests into the file before
delivering the content to the application; and
3\. shall handle the received content as described in subclause 7.1.3.2.
[TS 24.582, clause 7.1.3.2]
Upon receiving a file, the MCData client:
1\. shall decode the contents of the application/vnd.3gpp.mcdata-file MIME
body; and
2\. once all the chunks of the file are successfully received, shall indicate
to the signalling plane that the file download is completed.
##### 6.2.12.3 Test description {#test-description-27 .H6}
##### 6.2.12.3.1 Pre-test conditions {#pre-test-conditions-27 .H6}
##### System Simulator: {#system-simulator-23 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-23 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test files downloaded or received at previous test runs are deleted.
##### Preamble: {#preamble-23 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.12.3.2 Test procedure sequence {#test-procedure-sequence-27 .H6}
Table 6.2.12.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Check: | - | - | 1,2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | Call | | | | | | | Estab | | | | | | | lishment\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.3.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 2-5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MSRP | | | | | | | message | | | | | | | transfer\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.5.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | FD message | | | | | | | co | | | | | | | ntaining** | | | | | | | test file | | | | | | | 1? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 7 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 8 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CT | | | | | | | MCData | | | | | | | call | | | | | | | r | | | | | | | elease** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5 | | | | | | | .3C.7.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 9-10 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | to **send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | for the | | | | | | | file | | | | | | | received | | | | | | | at step | | | | | | | 6**? | | | | | +------------+------------+------------+---------+---------+----+ | 12 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 13 | Check: Has | - | - | 2 | P | | | the UE | | | | | | | (MCData | | | | | | | client) | | | | | | | downloaded | | | | | | | test file | | | | | | | 1 (TS | | | | | | | 36.579-7 | | | | | | | A.3.1)? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CT | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.3.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.12.3.3 Specific message contents {#specific-message-contents-27 .H6}
Table 6.2.12.3.3-1: SIP INVITE from the SS (step 1, Table 6.2.12.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.5.2-1, condition MCDATA_FD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **SDP message**  
MIME-part-body SDP message as described in Table 6.2.12.3.3-2  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.12.3.3-3  
MIME body part **MCData Data signalling message**  
MIME-part-headers  
MIME-Content-Type \"application/vnd.3gpp.mcdata-signalling\"  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.12.3.3-3A
Table 6.2.12.3.3-2: SDP for SIP INVITE (Table 6.2.12.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.2-3, condition MCDATA_FD,
SDP_OFFER
* * *
Table 6.2.12.3.3-3: MCData-Info (Table 6.2.12.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.12.3.3-3A: FD SIGNALLING PAYLOAD (Table 6.2.12.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.6-1, condition FD_MSRP
* * *
Table 6.2.12.3.3-4: SIP 200 (OK) from the UE (step 1, Table 6.2.12.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3C.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.17.1.1-1, condition INVITE-RSP
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
value \"application/sdp\"  
**Message-body**  
SDP message As described in Table 6.2.12.3.3-5
Table 6.2.12.3.3-5: SDP for SIP 200 (OK) (Table 6.2.12.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.1.1-3, condition MCDATA_FD,
SDP_ANSWER
* * *
Table 6.2.12.3.3-6: MSRP SEND from the SS (step 6, Table 6.2.12.3.2-1;\ step
1, TS 36.579-1 [2] Table 5.3C.5.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.12.1.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"application/vnd.3gpp.mcdata-file\"_  
**data** _As specified in table 6.2.12.3.3-7_
Table 6.2.12.3.3-7: MCData Protected Payload Message (Table 6.2.12.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.10-2, condition PROTECTED_FILE,
GMK
* * *
Table 6.2.12.3.3-8: SIP BYE from the SS (step 8, Table 6.2.12.3.2-1;\ step 1,
TS 36.579-1 [2] Table 5.3C.7.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.2.2-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Reason**  
reason-value \"SIP\"  
protocol-cause \"cause=\"200\"\"  
reason-text \"text=\"transmission succeeded\"\"
Table 6.2.12.3.3-9: Void
Table 6.2.12.3.3-10: SIP MESSAGE from the UE (step 11, Table 6.2.12.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData Info**  
MIME-part-body MCData-Info as described in Table 6.2.12.3.3-10A  
MIME body part **MCData Data signalling message**  
MIME-part-body SDS NOTIFICATION as described in Table 6.2.12.3.3-11
Table 6.2.12.3.3-10A: MCData-Info (Table 6.2.12.3.3-10)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
Information Element Value/remark Comment Reference Condition mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI set to
px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table 5.5.3.2.1-3A
Table 6.2.12.3.3-11: FD NOTIFICATION (Table 6.2.2.3.3-10)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.7-1, condition FD_COMPLETED
* * *
### 6.2.13 On-network / File Distribution (FD) / Accessing list of deferred
data group communications / Client Originated (CO)
##### 6.2.13.1 Test Purpose (TP) {#test-purpose-tp-28 .H6}
##### (1) {#section-107 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a Group Standalone FD message with
a non-mandatory download and with a disposition of \"FILE DOWNLOAD COMPLETE
UPDATE\" and the UE (MCDATA Client) is unaware of the URL of the Media Storage
Function }
**then** { UE (MCDATA Client) sends a SIP MESSAGE to find the URL of the Media
Storage Function **and** responds to a SIP MESSAGE that contains the URL of
the Media Storage Function with a SIP 200 (OK) message }
}
##### (2) {#section-108 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send a Group Standalone FD message with
a non-mandatory download and with a disposition of \"FILE DOWNLOAD COMPLETE
UPDATE\" and the UE (MCDATA Client) is aware of the URL of the Media Storage
Function }
**then** { UE (MCDATA Client) uploads the file to the Media Storage Function
via an HTTP POST message **and** then sends the URL of the file location to
the recipient via a SIP MESSAGE message }
}
##### (3) {#section-109 .H6}
**with** { UE (MCDATA Client) having sent the URL of the file location to the
recipient }
**ensure that** {
**when** { UE (MCDATA Client) receives a FD notification via a SIP MESSAGE
message }
**then** { UE (MCDATA Client) responds to the SIP MESSAGE message with a SIP
200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### (4) {#section-110 .H6}
**with** { UE (MCDATA Client) having received a notification that a sent
message was deferred by the recipient }
**ensure that** {
**when** { MCData User requests to access the list of deferred group
communication }
**then** { UE (MCDATA Client) sends a SIP MESSAGE message requesting to access
the list of deferred communication **and** responds to a received SIP MESSAGE
message with a SIP 200 (OK message **and** delivers the notification to the
MCDATA User }
}
##### 6.2.13.2 Conformance requirements {#conformance-requirements-28 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 10.2.1.3.2, 10.2.2.1, 10.2.4.2.1, 12.2.1.2,
11.3.2.1, 11.3.2.2. The following represents a copy/paste extraction of the
requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-14 requirements.
[TS 24.282, clause 10.2.1.3.2]
To discover the absolute URI of the media storage function, the MCData client
shall generate a SIP MESSAGE request towards the participating MCData
function, in accordance with 3GPP TS 24.229 [5] and IETF RFC 3428 [6] with the
clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with a \ element containing the value \"msf-
disc-req\";
4) if the upload of a file is for a group standalone FD request, shall include
in an application/vnd.3gpp.mcdata-info+xml MIME body, the \ element set to the required MCData group identity; and
NOTE 1: The absence of a group identity in the \
element of the application/vnd.3gpp.mcdata-info+xml MIME body implies that the
MCData client intends to upload a file for a one-to-one FD request. In this
case, the participating MCData function identifies the MCData ID of the user
from the binding between the public user identity and the MCData ID.
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
On receipt of a \"SIP MESSAGE request for absolute URI discovery response\",
the MCData client:
1) shall store the absolute URI found in the \ element;
2) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5]; and
3) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5].
[TS 24.282, clause 10.2.2.1]
If the media storage client is not aware of the absolute URI of the media
storage function, the media storage client shall request the MCData client to
discover the absolute URI associated with the media storage function by
following the procedures in subclause 10.2.1.3.
The media storage client shall send HTTP requests over a TLS connection as
specified for the HTTP client in the UE in annex A of 3GPP TS 24.482 [24].
NOTE 1: The HTTP client encodes the MCData ID in the bearer access token of
the Authorization header field of an HTTP request as specified in 3GPP TS
24.482 [24].
NOTE 2: The HTTP client always sends the HTTP requests to an HTTP proxy. Annex
A of 3GPP TS 24.482 [24] indicates how the HTTP proxy forwards the HTTP
request to the HTTP server.
To upload a file to media storage function, the media storage client:
1) shall generate an HTTP POST request as specified in IETF RFC 7230 [22] and
IETF RFC 7231 [23];
2) shall set the Request-URI to the absolute URI identifying the resource on a
media storage function;
3) shall set the Host header field to a hostname identifying the media storage
function;
4) shall set the Content-Type header field to multipart/mixed and with a
boundary delimiter parameter set to any chosen value;
5) if the file upload is for one-to-one file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"one-to-one-fd\"; and
b) the \ element set to the originating MCData ID;
6) if the file upload is for group file distribution, shall insert an
application/vnd.3gpp.mcdata-info+xml MIME body with:
a) the \ element set to a value of \"group-fd\";
b) the \ element set to the MCData group identity; and
c) the \ element set to the originating MCData ID;
7) if end-to-end security is required for a one-to-one communication, the
MCData client protects the binary data representing the file and prefixes the
protected binary data with security parameters as described in 3GPP TS 33.180
[26];
8) if
i) end-to-end security is not required for a one-to-one communication, or
ii) the file upload is for group file distribution;
shall include the binary data representing the file with Content-Type field
set to application/octet-stream and Content-Length field set to the file size;
and
9) shall send the HTTP POST request towards the media storage function.
On receipt of a HTTP 201 Created containing a Location header field with a URL
identifying the location of the resource where the file has been stored on the
media storage function, then the media storage client shall store this
information.
[TS 24.282, clause 10.2.4.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) if a one-to-one standalone FD message is to be sent shall insert in the SIP
MESSAGE request:
a) an application/resource-lists+xml MIME body with the MCData ID of the
target MCData user, according to rules and procedures of IETF RFC 4826 [9];
and
b) an application/vnd.3gpp.mcdata-info+xml MIME body with a \
element set to a value of \"one-to-one-fd\";
...
4) shall generate a standalone FD message as specified in subclause 6.2.2.2;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
[TS 24.282, clause 11.3.2.1]
Upon receiving a request from the MCData user to access the list of deferred
data group communications, the MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall generate DEFERRED DATA REQUEST message as specified in subclause
15.1.11.1;
3) shall include in the SIP request, the DEFERRED DATA GROUP COMM message in
an application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1; and
4) shall send the SIP MESSAGE request towards the participating MCData
function according to rules and procedures of 3GPP TS 24.229 [5].
[TS 24.282, clause 11.3.2.2]
Upon receipt of a \"SIP MESSAGE response for the list of deferred group
communications request\", the MCData client:
1) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
2) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5];
3) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body:
a) if the application/vnd.3gpp.mcdata-signalling MIME body contains DEFERRED
DATA RESPONSE message as specified in subclause 15.1.12:
i) for each payload, if payload type is set to \"FILEURL\", shall store the
payload data; and
4) shall present to MCData user, the list of file URLs which were deferred.
##### 6.2.13.3 Test description {#test-description-28 .H6}
##### 6.2.13.3.1 Pre-test conditions {#pre-test-conditions-28 .H6}
##### System Simulator: {#system-simulator-24 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-24 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- Test File 1 for CO FD as specified in annex A.2.1 is available at the UE
for upload.
##### Preamble: {#preamble-24 .H6}
\- In the MCData Group Configuration document the \ shall be set to 0 to indicate non-mandatory download
independent from the file size.
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.2.13.3.2 Test procedure sequence {#test-procedure-sequence-28 .H6}
Table 6.2.13.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send test | | | | | | | file 1 (TS | | | | | | | 36.579-7 | | | | | | | A.2.1) for | | | | | | | CO group | | | | | | | FD over | | | | | | | HTTP for | | | | | | | non | | | | | | | -mandatory | | | | | | | download | | | | | | | and with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | COMPLETED | | | | | | | UPDATE\". | | | | | | | | | | | | | | (NOTE 1, | | | | | | | NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 2 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'_| | | | | | |_ Discovery | | | | | | | of the | | | | | | | absolute | | | | | | | URI of the | | | | | | | media | | | | | | | storage | | | | | | | function | | | | | | | ( | | | | | | | one-to-one | | | | | | | commun | | | | | | | ication)\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.9.3-1 | | | | | | | ? | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** FD | | | | | | | file | | | | | | | upload | | | | | | | using | | | | | | | HTTP**\' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5. | | | | | | | 3C.10.3-1? | | | | | +------------+------------+------------+---------+---------+----+ | 3A | Check: Is | - | - | 2 | P | | | the | | | | | | | content of | | | | | | | the | | | | | | | uploaded | | | | | | | file the | | | | | | | same as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1? | | | | | +------------+------------+------------+---------+---------+----+ | 4-6 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 7 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | |** to | | | | | | | receive an | | | | | | | FD | | | | | | | NO | | | | | | | TIFICATION | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | type | | | | | | | \"FILE | | | | | | | DOWNLOAD | | | | | | | DE | | | | | | | FERRED\"**| | | | | | | for the FD | | | | | | | message | | | | | | | sent at | | | | | | | step 3? | | | | | +------------+------------+------------+---------+---------+----+ | 8 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 9 | Check: | - | - | 3 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | notify the | | | | | | | user that | | | | | | | the remote | | | | | | | Client has | | | | | | | deferred | | | | | | | the | | | | | | | acceptance | | | | | | | of the | | | | | | | download? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 10 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | access the | | | | | | | list of | | | | | | | deferred | | | | | | | data group | | | | | | | commu | | | | | | | nications. | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 11 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'** MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | Request - | | | | | | | Accept | | | | | | | CO\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1**| | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.30.3-1 | | | | | | |** to | | | | | | | retrieve | | | | | | | the list | | | | | | | of | | | | | | | deferred | | | | | | | data group | | | | | | | commun | | | | | | | ication**? | | | | | +------------+------------+------------+---------+---------+----+ | 12-14 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 15 | Check: | - | - | 4 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the list | | | | | | | of file | | | | | | | URLs which | | | | | | | were | | | | | | | deferred | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | Test file | | | | | | | 1 for CO | | | | | | | FD as | | | | | | | specified | | | | | | | in annex | | | | | | | A.2.1. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.2.13.3.3 Specific message contents {#specific-message-contents-28 .H6}
Table 6.2.13.3.3-1..6: Void
Table 6.2.13.3.3-7: HTTP POST from the UE (step 3, Table 6.2.13.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.4.3-1, condition FD_HTTP
* * *
Information Element Value/remark Comment Reference Condition **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-8
Table 6.2.13.3.3-8: MCData-Info (Table 6.2.13.3.3-7)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"  
mcdata-request-uri px_MCData_Group_A_ID NOTE: the element is not encrypted  
mcdata-calling-user-id px_MCData_ID_User_A NOTE: the element is not encrypted
Table 6.2.13.3.3-9: Void
Table 6.2.13.3.3-10: HTTP 201 Created from the SS (step 3, Table
6.2.13.3.2-1;\ step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.4.7-1, condition FD_HTTP
* * *
Table 6.2.13.3.3-11: SIP MESSAGE from the UE (step 3, Table 6.2.13.3.2-1;\
step 3, TS 36.579-1 [2] Table 5.3C.10.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.13.3.3-12  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD SIGNALLING
PAYLOAD as described in Table 6.2.13.3.3-12A
Table 6.2.13.3.3-12: MCData-Info (Table 6.2.13.3.3-11)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
request-type \"group-fd\"
Table 6.2.13.3.3-12A: FD SIGNALLING PAYLOAD (Table 6.2.13.3.3-11)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.5-1, condition FD_HTTP
* * *
Table 6.2.13.3.3-13: SIP MESSAGE from the SS (step 7, Table 6.2.13.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_FD,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.2.1.3.3-14  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing FD NOTIFICATION as
described in Table 6.2.13.3.3-15
Table 6.2.13.3.3-14: MCData-Info (Table 6.2.13.3.3-13)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.2.13.3.3-15: FD NOTIFICATION (Table 6.2.13.3.3-13)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.8-1, condition FD_DEFERRED
* * *
Table 6.2.13.3.3-16: SIP MESSAGE from the UE (step 11, Table 6.2.13.3.2-1;\
step 2, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"application/vnd.3gpp.mcdata-signalling\"_  
**Message-body**  
MCData Signalling message _MCData Protected Payload Message containing
DEFERRED DATA REQUEST as described in Table 6.2.13.3.3-17_
Table 6.2.13.3.3-17: DEFERRED DATA REQUEST (Table 6.2.13.3.3-16)
Derivation Path: TS 24.282 [87], clause 15.1.11
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** Deferred data request message identity \'00001011\'B Deferred
List Access Request TS 24.282 [87] clause 15.2.2
Table 6.2.13.3.3-18: SIP MESSAGE from the SS (step 11, Table 6.2.13.3.2-1;\
step 4, TS 36.579-1 [2] Table 5.3.30.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Content-Type**  
media-type _\"application/vnd.3gpp.mcdata-signalling\"_  
**Message-body**  
MCData Signalling message _MCData Protected Payload Message containing
DEFERRED DATA RESPONSE as described in Table 6.2.13.3.3-19_
Table 6.2.13.3.3-19: DEFERRED DATA RESPONSE (Table 6.2.13.3.3-18)
Derivation Path: TS 24.282 [87], clause 15.1.12
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** Deferred data response message identity \'00001100\'B Deferred
List Access Response TS 24.282 [87] clause 15.2.2  
Number of payloads \"1\" TS 24.282 [87] clause 15.2.12  
Security parameters and Payload Not present  
Payload TS 24.282 [87] clauses 11.3.3.2 and 15.2.13  
Length of Payload contents Length of the payload contents  
Payload content type "00000100" FILEURL  
Payload contents same URI as assigned by the HTTP 201 (Created) at step 3  
MCData group ID Not present Rel-17 TS 24.282 [87] clause 15.2.14  
Deferred FD signalling payload Not present Rel-17 TS 24.282 [87] clause
15.2.27
## 6.3 Enhanced Status (ES)
### 6.3.1 On-network / Enhanced Status (ES) / Client Originated (CO)
##### 6.3.1.1 Test Purpose (TP) {#test-purpose-tp-29 .H6}
##### (1) {#section-111 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User requests to send an Enhanced Status with a
disposition of only Delivery }
**then** { UE (MCDATA Client) sends an Enhanced Status with a disposition
request of only Delivery via s SIP MESSAGE message }
}
##### (2) {#section-112 .H6}
**with** { UE (MCDATA Client) having sent an Enhanced Status with a
disposition request of DELIVERY }
**ensure that** {
**when** { the UE (MCDATA Client) receives a disposition response via a SIP
MESSAGE message from the SS (MCDATA Server) }
**then** { UE (MCData Client) responds to the SIP MESSAGE message by sending a
SIP 200 (OK) message **and** delivers the notification to the MCDATA User }
}
##### 6.3.1.2 Conformance requirements {#conformance-requirements-29 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 14.2.1.1, 9.2.2.2.1, 6.2.2.1, 6.2.4.1,
12.2.1.2. The following represents a copy/paste extraction of the requirements
relevant to the test purpose; any references within the copy/paste text should
be understood within the scope of the core spec they have been copied from.
Unless otherwise stated, these are Rel-15 requirements.
[TS 24.282, clause 14.2.1.1]
Upon receiving a request from the MCData user to send an enhanced status to an
MCData group and the \ element under the \ element as defined in 3GPP TS 24.481 [11] is set to \"true\", the
MCData client:
1) shall use the \"id\" attribute of the MCData user selected operation value
from \ element under \ element as defined in 3GPP TS 24.481 [11], to generate a group
standalone SDS message by following the procedure described in clause
9.2.2.2.1.
[TS 24.282, clause 9.2.2.2.1]
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
...
3) if a group standalone SDS message is to be sent:
a) if the \"/_\ _/\/Common/MCData/AllowedSDS\" leaf node present in the
group document of the requested MCData group, configured on the group
management client as specified in 3GPP TS 24.483 [42] is set to \"false\",
shall reject the request to send SDS and not continue with the rest of the
steps in this subclause; and
b) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with:
i) the \ element set to a value of \"group-sds\";
ii) the \ element set to the MCData group identity; and
iii) the \ element set to the MCData client ID of the
originating MCData client;
4) shall generate a standalone SDS message as specified in subclause 6.2.2.1;
and
5) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.2.1]
In order to generate an SDS message, the MCData client:
1) shall generate an SDS SIGNALLING PAYLOAD message as specified in clause
15.1.2;
2) shall generate a DATA PAYLOAD message as specified in clause 15.1.4;
3) shall include in the SIP request, the SDS SIGNALLING PAYLOAD message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in clause E.1;
and
4) shall include in the SIP request, the DATA PAYLOAD message in an
application/vnd.3gpp.mcdata-payload MIME body as specified in clause E.2.
When generating an SDS SIGNALLING PAYLOAD message as specified in clause
15.1.2, the MCData client:
1) shall set the Date and time IE to the current time as specified in clause
15.2.8;
2) if the SDS message starts a new conversation, shall set the Conversation ID
IE to a newly generated Conversation ID value as specified in clause 15.2.9;
3) if the SDS message continues an existing unfinished conversation, shall set
the Conversation ID IE to the Conversation ID value of the existing
conversation as specified in clause 15.2.9;
4) shall set the Message ID IE to a newly generated Message ID value as
specified in clause 15.2.10;
5) if the SDS message is in reply to a previously received SDS message, shall
include the InReplyTo message ID IE with the Message ID value in the
previously received SDS message;
6) if the SDS message is for user consumption, shall not include an
Application ID IE as specified in clause 15.2.7and shall not include an
Extended application ID IE as specified in clause 15.2.24;
7) if the SDS message is intended for an application on the terminating MCData
client, shall include:
a) an Application ID IE with a Application ID value representing the intended
application as specified in clause 15.2.7; or
b) an Extended application ID IE with an Extended application ID value
representing the intended application as specified in clause 15.2.24;
NOTE: The value chosen for the Application ID value is decided by the mission
critical organisation.
8) if only a delivery disposition notification is required shall include a SDS
disposition request type IE set to \"DELIVERY\" as specified in clause 15.2.3;
9) if only a read disposition notification is required shall include a SDS
disposition request type IE set to \"READ\" as specified in clause 15.2.3; and
10) if both a delivery and read disposition notification is required shall
include a SDS disposition request type IE set to \"DELIVERY AND READ\" as
specified in clause 15.2.3.
When generating an DATA PAYLOAD message for SDS as specified in clause 15.1.4,
the MCData client:
1) shall set the Number of payloads IE to the number of Payload IEs that needs
to be encoded, as specified in clause 15.2.12;
2) if end-to-end security is required for a one-to-one communication, shall
include the Security parameters and Payload IE with security parameters as
described in 3GPP TS 33.180 [26]. Otherwise, if end-to-end security is not
required for a one-to-one communication, shall include the Payload IE as
specified in clause 15.1.4; and
3) for each Payload IE included:
a) if the payload is text, shall set the Payload content type as \"TEXT\" as
specified in clause 15.2.13;
b) if the payload is binary data, shall set the Payload content type as
\"BINARY\" as specified in clause 15.2.13;
c) if the payload is hyperlinks, shall set the Payload content type as
\"HYPERLINKS\" as specified in clause 15.2.13;
d) if the payload is location, shall set the Payload content type as
\"LOCATION\" as specified in clause 15.2.13;
e) if payload is enhanced status for a group, shall set the Payload content
type as \"ENHANCED STATUS\" as specified in subclause 15.2.13; and
f) shall include the data to be sent in the Payload data.
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
...
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
[TS 24.282, clause 12.2.1.2]
Upon receipt of a:
\"SIP MESSAGE request for SDS disposition notification for terminating MCData
client\"; or
\"SIP MESSAGE request for FD disposition notification for terminating MCData
client\";
the MCData client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body; and
2) shall deliver the notification to the user or application.
##### 6.3.1.3 Test description {#test-description-29 .H6}
##### 6.3.1.3.1 Pre-test conditions {#pre-test-conditions-29 .H6}
##### System Simulator: {#system-simulator-25 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-25 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- The \ element in the MCData service
configuration document as specified in 3GPP TS 24.484 [12], shall be large
enough to allow the sending of the standalone SDS message using the signalling
plane.
##### Preamble: {#preamble-25 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.3.1.3.2 Test procedure sequence {#test-procedure-sequence-29 .H6}
Table 6.3.1.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1 | Make the | - | - | - | - | | | UE (MCData | | | | | | | client) | | | | | | | send an | | | | | | | enhanced | | | | | | | status to | | | | | | | Group A | | | | | | | using | | | | | | | Enhanced | | | | | | | Status Id | | | | | | | \"1\" with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"D | | | | | | | ELIVERY\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | 2-2B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | an | | | | | | | Enhanced | | | | | | | Status | | | | | | | with | | | | | | | Enhanced | | | | | | | Status Id | | | | | | | \"1\" and | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \"DEL | | | | | | | IVERY\"**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 4 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT\' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1** | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | noti | | | | | | | fication** | | | | | | | for the | | | | | | | SDS | | | | | | | message | | | | | | | sent at | | | | | | | step 2A? | | | | | +------------+------------+------------+---------+---------+----+ | 5 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 6 | Check: | - | - | 2 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | to the | | | | | | | user? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The RRC | | | | | | | connection | | | | | | | is not | | | | | | | released | | | | | | | at the end | | | | | | | of the | | | | | | | procedure. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.3.1.3.3 Specific message contents {#specific-message-contents-29 .H6}
Table 6.3.1.3.3-1: SIP MESSAGE from the UE (step 2A, Table 6.3.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
MCDATA_SIGNALLING, MCDATA_PAYLOAD
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.3.1.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.1.3.3.3-2A  
MIME body part **MCData Data message**  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in Table 6.3.1.3.3-3
Table 6.3.1.3.3-2: MCData-Info (Table 6.3.1.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3, condition MCD_grp
* * *
Table 6.3.1.3.3-2A: SDS SIGNALLING PAYLOAD (Table 6.3.1.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.1-1, condition DELIVERED
* * *
Table 6.3.1.3.3-3: DATA PAYLOAD (Table 6.3.1.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-1
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Payload**  
Payload content type \'00000110\'B ENHANCED STATUS TS 24.282 [31], Table
15.2.13-2  
Payload data \"1\" The id as defined in the MCData Group Configuration
Document TS 36.579-1 [2], Table 5.5.7.3-1
Table 6.3.1.3.3-4: SIP MESSAGE from the SS (step 4, Table 6.3.1.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA_SDS,
MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData Info**  
MIME-part-body As described in Table 6.3.1.3.3-5  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.3.1.3.3-6
Table 6.3.1.3.3-5: MCData-Info (Table 6.3.1.3.3-4)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI
set to px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table
5.5.3.2.2-3A
Table 6.3.1.3.3-6: SDS NOTIFICATION (Table 6.3.1.3.3-4)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.4-1, condition DELIVERED
* * *
Table 6.3.1.3.3-7: Void
### 6.3.2 On-network / Enhanced Status (ES) / Client Terminated (CT)
##### 6.3.2.1 Test Purpose (TP) {#test-purpose-tp-30 .H6}
##### (1) {#section-113 .H6}
**with** { UE (MCDATA Client) registered and authorised for MCDATA Service }
**ensure that** {
**when** { the MCDATA User receives an Enhanced Status with a disposition
request of \"DELIVERY\" }
**then** { UE (MCDATA Client) responds by sending a SIP 200 (OK) message
**and** sends a SIP MESSAGE message with a disposition notification of
\"DELIVERED\" **and** renders the operational value of the received Enhanced
Status ID as enhanced status to the MCDATA User }
}
##### 6.3.2.2 Conformance requirements {#conformance-requirements-30 .H6}
References: The conformance requirements covered in the current TC are
specified in: TS 24.282, clauses 14.2.1.2, 9.2.2.2.2, 9.2.1.2, 9.2.1.3,
12.2.1.1, 6.2.3.1, 6.2.4.1. The following represents a copy/paste extraction
of the requirements relevant to the test purpose; any references within the
copy/paste text should be understood within the scope of the core spec they
have been copied from. Unless otherwise stated, these are Rel-15 requirements.
[TS 24.282, clause 14.2.1.2]
Upon receiving a \"SIP MESSAGE request for standalone SDS for terminating
MCData client\", the MCData client:
1) shall follow the procedure defined in clause 9.2.2.2.2;
2) shall match the received value with an \"id\" attribute of the operational
values from the \ element of the
MCData group document as defined in 3GPP TS 24.481 [11]; and
3) if a match is found, shall render the operational value as enhanced status
to the MCData user. Otherwise shall discard the received message.
[TS 24.282, clause 9.2.2.2.2]
Upon receipt of a \"SIP MESSAGE request for standalone SDS for terminating
MCData client\", the MCData client:
...
3) if the SIP MESSAGE request contains an application/mikey MIME body
containing a MIKEY-SAKKE I_MESSAGE:
a) shall extract the MCData ID of the originating MCData user from the
initiator field (IDRi) of the I_MESSAGE as described in 3GPP TS 33.180 [26];
b) shall convert the MCData ID to a UID as described in 3GPP TS 33.180 [26];
c) shall use the UID to validate the signature of the MIKEY-SAKKE I_MESSAGE as
described in 3GPP TS 33.180 [26];
d) if authentication verification of the MIKEY-SAKKE I_MESSAGE fails, shall
reject the SIP MESSAGE request with a SIP 606 (Not Acceptable) response, and
include warning text set to \"136 authentication of the MIKEY-SAKKE I_MESSAGE
failed\" in a Warning header field as specified in subclause 4.9 and not
continue with rest of the steps in this subclause; and
e) if the signature of the MIKEY-SAKKE I_MESSAGE was successfully validated:
i) shall extract and decrypt the encapsulated PCK using the terminating
user\'s (KMS provisioned) UID key as described in 3GPP TS 33.180 [26]; and
ii) shall extract the PCK-ID, from the payload as specified in 3GPP TS 33.180
[26];
NOTE: With the PCK successfully shared between the originating MCData client
and the terminating MCData client, both clients are able to exchange end-to-
end secure message.
4) shall generate a SIP 200 (OK) response according to rules and procedures of
3GPP TS 24.229 [5];
5) shall send the SIP 200 (OK) response towards the MCData server according to
rules and procedures of 3GPP TS 24.229 [5]; and
6) shall handle the received message as specified in subclause 9.2.1.2.
[TS 24.282, clause 9.2.1.2]
When a MCData client has received a SIP request containing:
\- an application/vnd.3gpp.mcdata-signalling MIME body as specified in
subclause E.1; and
\- an application/vnd.3gpp.mcdata-payload MIME body as specified in subclause
E.2;
the MCData Client:
1) shall decode the contents of the application/vnd.3gpp.mcdata-signalling
MIME body;
2) shall decode the contents of the application/vnd.3gpp.mcdata-payload MIME
body;
...
5) shall identify the number of Payload IEs in the DATA PAYLOAD message from
the Number of payloads IE in the DATA PAYLOAD message;
6) if the SDS SIGNALLING PAYLOAD message does not contain an Application ID
IE:
a) shall determine that the payload contained in the DATA PAYLOAD message is
for user consumption
b) may notify the MCData user; and
c) shall render the contents of the Payload IE(s) to the MCData user;
7) if the SDS SIGNALLING PAYLOAD message contains an Application ID IE:
a) shall determine that the payload contained in the DATA PAYLOAD message is
not for user consumption,
b) shall not notify the MCData user;
c) if the Application ID value is unknown, shall discard the SDS message; and
d) if the Application ID value is known, shall deliver the contents of the
Payload IE(s) to the identified application;
NOTE 1: If required, the MCData client decrypts the Payload IEs before
rendering the SDS message to the user or delivering the SDS message to the
application.
...
NOTE 3: User consent is not required before accepting the data.
8) may store the message payload in local storage along with the Conversation
ID, Message ID, InReplyTo message ID and Date and time; and
9) if the received SDS SIGNALLING PAYLOAD message contains an SDS disposition
request type IE shall follow the procedures in subclause 9.2.1.3.
[TS 24.282, clause 9.2.1.3]
To handle the disposition requests, the MCData client:
1) If the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a delivered notification as described in
subclause 12.2.1.1;
b) \"READ\", shall send a read notification as described in subclause
12.2.1.1, when a display indication is received; or
c) \"DELIVERY AND READ\" then, shall start timer TDU1 (delivery and read).
[TS 24.282, clause 12.2.1.1]
The MCData client shall follow the procedures in this subclause to:
\- indicate to an MCData client that an SDS message was delivered, read or
delivered and read when the originating client requested a delivery, read or
delivery and read report;
\- indicate to the participating MCData function serving the MCData user that
an SDS message was undelivered. The participating MCData function can store
the message for later re-delivery;
\- indicate to an MCData client that a request for FD was accepted, deferred
or rejected; or
\- indicate to an MCData client that a file download has been completed;
Before sending a disposition notification the MCData client needs to
determine:
\- the controlling MCData function that sent the SDS or FD message request.
The MCData client determines the controlling MCData function from the contents
of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request;
\- the group identity related to an SDS or FD message request received as part
of a group communication. The MCData client determines the group identity from
the contents of the \ element contained in the
application/vnd.3gpp.mcdata-info+xml MIME body of the incoming SDS or FD
message request; and
\- the MCData user targeted for the disposition notification. The MCData
client determines the targeted MCData user from the contents of the \ element contained in the application/vnd.3gpp.mcdata-info+xml
MIME body of the incoming SDS or FD message request.
The MCData client shall generate a SIP MESSAGE request in accordance with 3GPP
TS 24.229 [5] and IETF RFC 3428 [6] with the clarifications given below.
The MCData client:
1) shall build the SIP MESSAGE request as specified in subclause 6.2.4.1;
2) shall follow the rules specified in subclause 6.4 for the handling of MIME
bodies in a SIP message when processing the remaining steps in this subclause;
3) shall insert in the SIP MESSAGE request an application/resource-lists+xml
MIME body containing the MCData ID of the targeted MCData user, according to
rules and procedures of IETF RFC 5366 [18];
4) shall insert in the SIP MESSAGE request an application/vnd.3gpp.mcdata-
info+xml MIME body with an \ element containing the PSI
of the controlling MCData function;
5) if sending a disposition notification in response to an MCData group data
request, shall include an \ element set to the MCData
group identity in the application/vnd.3gpp.mcdata-info+xml MIME body;
6) if requiring to send an SDS notification, shall generate an SDS
NOTIFICATION message and include it in the SIP MESSAGE request as specified in
subclause 6.2.3.1;
...
8) shall send the SIP MESSAGE request according to rules and procedures of
3GPP TS 24.229 [5].
[TS 24.282, clause 6.2.3.1]
In order to generate an SDS notification, the MCData client:
1) shall generate an SDS NOTIFICATION message as specified in subclause
15.1.5; and
2) shall include in the SIP request, the SDS NOTIFICATION message in an
application/vnd.3gpp.mcdata-signalling MIME body as specified in subclause
E.1.
When generating an SDS NOTIFICATION message as specified in subclause 15.1.5,
the MCData client:
1) if sending a delivered notification, shall set the SDS disposition
notification type IE as \"DELIVERED\" as specified in subclause 15.2.5;
...
5) shall set the Date and time IE to the current time to as specified in
subclause 15.2.8;
6) shall set the Conversation ID to the value of the Conversation ID that was
received in the SDS message as specified in subclause 15.2.9;
7) shall set the Message ID to the value of the Message ID that was received
in the SDS message as specified in subclause 15.2.10;
8) if the SDS message was destined for the user, shall not include an
Application ID IE as specified in subclause 15.2.7; and
[TS 24.282, clause 6.2.4.1]
This subclause is referenced from other procedures.
In a SIP MESSAGE request, the MCData client:
1) when sending SDS messages or SDS disposition notifications:
a) shall include an Accept-Contact header field containing the
g.3gpp.mcdata.sds media feature tag along with the \"require\" and
\"explicit\" header field parameters according to IETF RFC 3841 [8];
b) shall include an Accept-Contact header field with the media feature tag
g.3gpp.icsi-ref containing the value of \"urn:urn-7:3gpp-
service.ims.icsi.mcdata.sds\" along with the \"require\" and \"explicit\"
header field parameters according to IETF RFC 3841 [8]; and
c) shall include the ICSI value \"urn:urn-7:3gpp-service.ims.icsi.mcdata.sds\"
(coded as specified in 3GPP TS 24.229 [5]), in a P-Preferred-Service header
field according to IETF RFC 6050 [7] in the SIP MESSAGE request;
...
3) may include a P-Preferred-Identity header field in the SIP MESSAGE request
containing a public user identity as specified in 3GPP TS 24.229 [5]; and
4) shall set the Request-URI to the public service identity identifying the
participating MCData function serving the MCData user.
##### 6.3.2.3 Test description {#test-description-30 .H6}
##### 6.3.2.3.1 Pre-test conditions {#pre-test-conditions-30 .H6}
##### System Simulator: {#system-simulator-26 .H6}
\- SS (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCDATA
operation in the MCDATA configuration document).
##### IUT: {#iut-26 .H6}
\- UE (MCData client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- The \ element in the MCData service
configuration document as specified in 3GPP TS 24.484 [12], shall be large
enough to allow the sending of the standalone SDS message using the signalling
plane.
##### Preamble: {#preamble-26 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- UE States at the end of the preamble
\- The UE is in E-UTRA Registered, Idle Mode state.
\- The MCData Client Application has been activated and User has registered-in
as the MCDATA User with the Server as active user at the Client.
##### 6.3.2.3.2 Test procedure sequence {#test-procedure-sequence-30 .H6}
Table 6.3.2.3.2-1: Main Behaviour
+------------+------------+------------+---------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +============+============+============+=========+=========+====+ | | | U - S | Message | | | +------------+------------+------------+---------+---------+----+ | 1-1B | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | steps | | | | | | | 1a1-3 of | | | | | | | procedure | | | | | | | \'**MCX | | | | | | | SIP | | | | | | | MESSAGE | | | | | | | CT** \' as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3.33.3-1 | | | | | | | **to | | | | | | | receive an | | | | | | | Enhanced | | | | | | | Status | | | | | | | with | | | | | | | d | | | | | | | isposition | | | | | | | request | | | | | | | \" | | | | | | | DELIVERY\" | | | | | | | and an | | | | | | | enhanced | | | | | | | status | | | | | | | payload | | | | | | | with | | | | | | | id=0**? | | | | | | | | | | | | | | (NOTE 2) | | | | | +------------+------------+------------+---------+---------+----+ | 3 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | correctly | | | | | | | perform | | | | | | | procedure | | | | | | | \'**CO SDS | | | | | | | or FD | | | | | | | message | | | | | | | transfer | | | | | | | using | | | | | | | signalling | | | | | | | plane** \' | | | | | | | as | | | | | | | described | | | | | | | in TS | | | | | | | 36.579-1 | | | | | | | [2] | | | | | | | Table | | | | | | | 5.3C.1.3-1 | | | | | | | **to send | | | | | | | a | | | | | | | d | | | | | | | isposition | | | | | | | no | | | | | | | tification | | | | | | | of | | | | | | | \"DELI | | | | | | | VERED\"**? | | | | | +------------+------------+------------+---------+---------+----+ | 4 | Void | - | - | - | - | +------------+------------+------------+---------+---------+----+ | 5 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE (MCData | | | | | | | client) | | | | | | | provide | | | | | | | the | | | | | | | o | | | | | | | perational | | | | | | | value of | | | | | | | the | | | | | | | enhanced | | | | | | | status | | | | | | | with id=0 | | | | | | | to the | | | | | | | user | | | | | | | (\"going | | | | | | | to the | | | | | | | operation | | | | | | | site\")? | | | | | | | | | | | | | | (NOTE 1) | | | | | +------------+------------+------------+---------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be done | | | | | | | via a | | | | | | | suitable | | | | | | | impl | | | | | | | ementation | | | | | | | dependent | | | | | | | MMI. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The RRC | | | | | | | connection | | | | | | | is not | | | | | | | released | | | | | | | at the end | | | | | | | of the | | | | | | | procedure. | | | | | | +------------+------------+------------+---------+---------+----+
##### 6.3.2.3.3 Specific message contents {#specific-message-contents-30 .H6}
Table 6.3.2.3.3-1: SIP MESSAGE from the SS (step 1A, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3.33.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.2-1, condition MCDATA,
PRIVATE-CALL
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-body MCData-Info as described in Table 6.3.2.3.3-2  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS SIGNALLING
PAYLOAD as described in Table 6.3.2.3.3-3  
MIME body part **MCData Data message**  
MIME-part-body MCData Protected Payload Message containing DATA PAYLOAD as
described in TS 36.579-1 [2] Table 6.3.2.3.3-4
Table 6.3.2.3.3-2: MCData-Info (Table 6.3.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.2-3, condition MCD_grp
* * *
Table 6.3.2.3.3-3: SDS SIGNALLING PAYLOAD (Table 6.3.2.3.3-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.2-1, condition DELIVERED
* * *
Table 6.3.2.3.3-4: DATA PAYLOAD (Table 6.3.2.3.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.9.1-2
* * *
Information Element Value/remark Comment Reference Condition Payload  
Payload content type \'00000110\'B ENHANCED STATUS TS 24.282 [31], Table
15.2.13-2  
Payload data \"0\" The id as defined in the MCData Group Configuration
Document TS 36.579-1 [2], Table 5.5.7.3-1
Table 6.3.2.3.3-5: Void
Table 6.3.2.3.3-6: SIP MESSAGE from the UE (step 3, Table 6.3.2.3.2-1;\ step
2, TS 36.579-1 [2] Table 5.3C.1.3-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.2.7.1-1, condition MCDATA_SDS,
RESOURCE_LISTS, MCDATA_SIGNALLING
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** **Message-body**  
MIME body part **MCData-Info**  
MIME-part-headers MCData-Info described in Table 6.3.2.3.3-7  
MIME body part **MCData Data signalling message**  
MIME-part-body MCData Protected Payload Message containing SDS NOTIFICATION as
described in Table 6.3.2.3.3-8
Table 6.3.2.3.3-7: MCData-Info (Table 6.3.2.3.3-6)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.2.1-3
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** mcdata-info  
mcdata-Params  
mcdata-calling-group-id Encrypted \ with mcdataURI set to
px_MCData_Group_A_ID Encrypted according to TS 36.579-1 [2] Table 5.5.3.2.1-3A
Table 6.3.2.3.3-8: SDS NOTIFICATION (Table 6.3.2.3.3-6)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.3-1, condition DELIVERED
* * *
# 7 Off-Network Test Scenarios
## 7.1 Short Data Service (SDS)
### 7.1.1 Off-network / Short Data Service (SDS) / Standalone SDS using
signalling control plane / One-to-one SDS message / Client Originated (CO)
##### 7.1.1.1 Test Purpose (TP) {#test-purpose-tp-31 .H6}
##### (1) {#section-114 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one SDS
message with a disposition request type of DELIVERY }
**then** { UE (MCDATA Client) sends a SDS OFF-NETWORK MESSAGE message,
**and,** initiates counter CFS1 (SDS retransmission) to 1 and starts timer
TFS1 (SDS retransmission) }
}
##### (2) {#section-115 .H6}
**with** { UE (MCData Client) having sent a SDS OFF-NETWORK MESSAGE message
and started timer TFS1 (SDS retransmission) }
**ensure that** {
**when** { timer TFS1 (SDS retransmission) expires }
**then** { UE (MCData Client) retransmits the SDS OFF-NETWORK MESSAGE message
**and** , stops re-transmitting if the counter CFS1 (SDS retransmission) has
reached its maximum value and TFS1 (SDS retransmission) has expired }
}
##### (3) {#section-116 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one SDS
message with a disposition request type of READ }
**then** { UE (MCDATA Client) sends a SDS OFF-NETWORK MESSAGE message,
**and,** initiates counter CFS1 (SDS retransmission) to 1 and starts timer
TFS1 (SDS retransmission) }
}
##### (4) {#section-117 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send a standalone one-to-one SDS
message with a disposition request type of DELIVERY AND READ }
**then** { UE (MCDATA Client) sends a SDS OFF-NETWORK MESSAGE message,
**and,** initiates counter CFS1 (SDS retransmission) to 1 and starts timer
TFS1 (SDS retransmission) }
}
##### 7.1.1.2 Conformance requirements {#conformance-requirements-31 .H6}
References: The conformance requirements covered in the current TC are
specified in:
TS 24.282 clauses 9.3.2.2, 9.3.2.3. Unless otherwise stated these are Rel-15
requirements.
[TS 24.282, clause 9.3.2.2]
Upon receiving an indication to send an SDS message, the MCData client:
1) if the request to send the SDS message is for a MCData group, shall check
if the value of \"/_\ _/\/Common/MCData/AllowedSDS\" leaf node, present
in the group configuration as specified in 3GPP TS 24.483 [42], is set to
\"false\". It the value is set to \"false\", shall reject the request to send
the SDS message and not continue with the remaining procedures in this clause;
2) if:
a) a one-to-one SDS message is to be sent then, shall store the MCData user ID
of the intended recipient as the target MCData user ID; or
b) a group SDS message is to be sent then, shall store the MCData group ID as
the target MCData group ID;
3) may set the stored SDS disposition request type as:
a) \"DELIVERY\", if only delivery disposition is requested;
b) \"READ\", if only read disposition is requested; or
c) \"DELIVERY AND READ\", if both delivery and read dispositions are
requested;
4) if an existing conversation is indicated then, shall store the conversation
identifier of the indicated conversation as SDS conversation ID. Otherwise,
shall generate an UUID as described in IETF RFC 4122 [14] and store SDS
conversation ID;
5) shall generate an UUID as described in IETF RFC 4122 [14] and store as the
SDS message ID;
6) if indicated that the SDS message is in reply to another SDS message then,
shall store the message identifier of the indicated message as SDS reply ID;
7) if indicated that the target recipient of the SDS message is an application
then, shall store the application ID of the indicated application as the SDS
application ID or as the SDS extended application ID;
8) shall store the received payload as the SDS payload;
9) shall store the received payload type as the SDS payload type;
10) shall store the current UTC time as the SDS transmission time;
11) shall generate a SDS OFF-NETWORK MESSAGE message as specified in clause
15.1.7. In the SDS OFF-NETWORK MESSAGE message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID;
b) if:
i) a one-to-one SDS message is to be sent then shall set the Recipient MCData
user ID IE to the stored target MCData user ID as specified in clause 15.2.15;
or
ii) a group SDS message is to be sent then, shall set the MCData group ID IE
to the stored target MCData group ID as specified in clause 15.2.14;
c) may set the SDS disposition request type IE to the stored the SDS
disposition request type as specified in clause 15.2.3;
d) shall set the Conversation ID IE to the stored conversation ID as specified
in clause 15.2.9;
e) shall set the Message ID IE to the stored SDS message ID as specified in
clause 15.2.10;
f) shall set the Date and time IE to the stored SDS transmission time as
specified in clause 15.2.8;
g) may include the InReplyTo message ID IE set to the stored SDS reply ID as
specified in clause 15.2.11;
h) may include:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE set to the stored SDS extended application
ID as specified in clause 15.2.24;
i) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the Security parameters and Payload IE with security
parameters as described in 3GPP TS 33.180 [26];
j) if
i) end-to-end security is not required for a one-to-one communication, or
ii) sending the SDS OFF-NETWORK MESSAGE message to a MCData group;
may include the Payload IE as specified in clause 15.2.13 with:
i) the Payload content type to the stored SDS payload type; and
ii) the Payload data set to the stored SDS payload;
12) if:
a) a one-to-one SDS message is to be sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.1; or
b) a group SDS message is to be sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.2;
13) shall initialise the counter CFS1 (SDS retransmission) with the value set
to 1; and
14) shall start timer TFS1 (SDS retransmission).
[TS 24.282, clause 9.3.2.3]
Upon expiry of timer TFS1 (SDS retransmission), the MCData client:
1) shall generate a SDS OFF-NETWORK MESSAGE message as specified in clause
15.1.7. In the SDS OFF-NETWORK MESSAGE message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID;
b) if:
i) a one-to-one SDS message is to be sent then, shall set the Recipient MCData
user ID IE to the stored target MCData user ID; or
ii) a group SDS message is to be sent then, shall set the MCData group ID IE
to the stored target MCData group ID;
c) may set the SDS disposition request type IE to the stored the SDS
disposition request type as specified in clause 15.2.3;
d) shall set the Conversation ID IE to the stored conversation ID as specified
in clause 15.2.9;
e) shall set the Message ID IE to the stored SDS message ID as specified in
clause 15.2.10;
f) shall set the Date and time IE to the stored the SDS transmission time as
specified in clause 15.2.8;
g) may include the InReplyTo message ID IE set to the stored SDS reply ID as
specified in clause 15.2.11;
h) may include:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE set to the stored SDS extended application
ID as specified in clause 15.2.24;
i) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the Security parameters IE with security parameters as
described in 3GPP TS 33.180 [26]; and
j) if:
i) end-to-end security is not required for a one-to-one communication, or
ii) sending the SDS OFF-NETWORK MESSAGE message to a MCData group;
may include the Payload IE as specified in clause 15.2.13 with:
i) the Payload content type to the stored SDS payload type; and
ii) the Payload data set to the stored SDS payload;
2) if:
a) a one-to-one SDS message was sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.1; or
b) a group SDS message was sent then, shall send the SDS OFF-NETWORK MESSAGE
message as specified in clause 9.3.1.2;
3) shall increment the counter CFS1(SDS retransmission) by 1; and
4) shall start timer TFS1 (SDS retransmission) if the associated counter CFS1
(SDS retransmission) has not reached its upper limit.
##### 7.1.1.3 Test description {#test-description-31 .H6}
##### 7.1.1.3.1 Pre-test conditions {#pre-test-conditions-31 .H6}
##### System Simulator: {#system-simulator-27 .H6}
\- SS-UE1 (MCData Client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCData
operation in the MCData configuration document).
NOTE 2: The SS operation as NW (MCData server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-27 .H6}
\- UE (MCData Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
\- CFS1 (SDS retransmission) is set to the default value of 5.
\- TFS1 (SDS retransmission) is set to the default value of 40 ms.
##### Preamble: {#preamble-27 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.1.3.2 Test procedure sequence {#test-procedure-sequence-31 .H6}
Table 7.1.1.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Activate | - | - | - | - | | | the | | | | | | | MCData | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the | | | | | | | MCData | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCX_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | p | | | | | | | x_MCX_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | MCData | | | | | | | User | | | | | | | request | | | | | | | to send a | | | | | | | s | | | | | | | tandalone | | | | | | | o | | | | | | | ne-to-one | | | | | | | SDS | | | | | | | message | | | | | | | to a | | | | | | | single | | | | | | | user with | | | | | | | an SDS | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.5 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps 5-7 | | | | | | | are | | | | | | | repeated | | | | | | | CFS1=5 | | | | | | | times | | | | | | | (CFS1 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | --> | SDS | 1,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.6 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 8-10 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | SS-UE1 | \ | SDS | 3,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | READ? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.6 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 15-17 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | SS-UE1 | \ | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY | | | | | | | AND READ? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 21 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.6 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 15-17 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | SS-UE1 | \ 6) if present, shall store the value of the Extended application ID IE as
> the stored SDS extended application ID;
7) if present, shall store the value of MCData group ID IE to the stored
target MCData group ID; and
8) if the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a SDS OFF-NETWORK NOTIFICATION message as
described in clause 12.3.2;
b) \"READ\" then, shall send a SDS OFF-NETWORK NOTIFICATION message as
described in clause 12.3.3; or
c) \"DELIVERY AND READ\" then, shall start timer TFS3 (delivery and read).
NOTE: Duplicate messages (re-transmissions) that are received by the MCData
client should not be processed again.
[TS 24.282, clause 9.3.2.5]
Upon receiving a display indication before timer TFS3 (delivery and read)
expires, the MCData client:
1) shall generate and send a SDS OFF-NETWORK NOTIFICATION message as described
in clause 12.3.4.
[TS 24.282, clause 9.3.2.6]
Upon expiry of timer TFS3 (delivery and read), the MCData client:
1) shall generate and send a SDS OFF-NETWORK NOTIFICATION message as described
in clause 12.3.2; and
2) upon receiving a display indication, shall generate and send a SDS OFF-
NETWORK NOTIFICATION message as described in clause 12.3.3.
[TS 24.282, clause 12.3.2]
To send an off-network SDS delivery notification, the MCData client:
1) shall store \"DELIVERED\" as the disposition type;
2) shall generate a SDS OFF-NETWORK NOTIFICATION message as specified in
clause 15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the stored SDS notification time as
specified in clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
3) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored
notification target MCData user ID as specified in clause 9.3.1.1;
4) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
5) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.3]
Upon receiving a display indication for the payload to the user or processing
of the payload by the target application, the MCData client:
1) shall store \"READ\" as the disposition type;
2) shall store the current UTC time as the stored SDS notification time;
3) shall generate SDS OFF-NETWORK NOTIFICATION message as specified in clause
15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Data and time IE as the SDS notification time as specified in
clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
4) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
5) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
6) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.4]
Upon receiving a display indication for the payload to the user or processing
of the payload by the target application, the MCData client:
1) shall store \"DELIVERED AND READ\" as the disposition type and stop the
timer TFS3 (display and read);
2) shall store the current UTC time as the stored SDS notification time;
3) shall generate SDS OFF-NETWORK NOTIFICATION message. In the SDS OFF-NETWORK
NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the SDS notification time as specified in
clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
4) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
5) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
6) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.5]
Upon expiry of timer TFS2 (SDS notification retransmission), the MCData
client:
1) shall generate a SDS OFF-NETWORK NOTIFICATION message as specified in
clause 15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the stored SDS notification time as
specified in clause 15.2.8;
e) shall set the SDS disposition type IE to the stored disposition type as
specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
2) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
3) shall increment the counter CFS2 (SDS notification retransmission) by 1;
and
4) shall start timer TFS2 (SDS notification retransmission) if the associated
counter CFS2 (SDS notification retransmission) has not reached its upper
limit.
##### 7.1.2.3 Test description {#test-description-32 .H6}
##### 7.1.2.3.1 Pre-test conditions {#pre-test-conditions-32 .H6}
##### System Simulator: {#system-simulator-28 .H6}
\- SS-UE1 (MCData Client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCData
operation in the MCData configuration document).
NOTE 2: The SS operation as NW (MCData server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-28 .H6}
\- UE (MCData Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
\- CFS2 (SDS notification retransmission)is set to the default value of 5.
\- TFS2 (SDS notification retransmission)is set to the default value of 40 ms.
\- TFS3 (delivery and read)is set to the default value of 120 ms.
##### Preamble: {#preamble-28 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.2.3.2 Test procedure sequence {#test-procedure-sequence-32 .H6}
Table 7.1.2.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Activate | - | - | - | - | | | the | | | | | | | MCData | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the | | | | | | | MCData | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCX_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | p | | | | | | | x_MCX_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.6 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | SS-UE1 | \ | SDS | 1,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | D | | | | | | | ELIVERED? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.6 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | SS-UE1 | \ | SDS | 3,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | READ upon | | | | | | | receiving | | | | | | | a display | | | | | | | i | | | | | | | ndication | | | | | | | for the | | | | | | | payload | | | | | | | to the | | | | | | | MCData | | | | | | | User? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.6 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverag | | | | | | | e-establi | | | | | | | shment\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | SS-UE1 | \ | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | D | | | | | | | ELIVERED? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a2 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a3 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 13a4-13a6 | | | | | | | are | | | | | | | repeated | | | | | | | CFS2=5 | | | | | | | times | | | | | | | (CFS2 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a4 | Check: | --> | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | READ upon | | | | | | | receiving | | | | | | | a display | | | | | | | i | | | | | | | ndication | | | | | | | for the | | | | | | | payload | | | | | | | to the | | | | | | | MCData | | | | | | | User? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a5 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a6 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 13b1-13b3 | | | | | | | are | | | | | | | repeated | | | | | | | CFS1=5 | | | | | | | times | | | | | | | (CFS1 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13b1 | Check: | --> | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | DELIVERED | | | | | | | AND READ? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13b2 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13b3 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.2.3.3 Specific message contents {#specific-message-contents-32 .H6}
Table 7.1.2.3.3-1: SDS OFF-NETWORK MESSAGE (step 4, Table 7.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.9-1, condition DELIVERED,
MCD_1to1
* * *
Table 7.1.2.3.3-2: SDS OFF-NETWORK NOTIFICATION (steps 5, 13a1, Table
7.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.12-1, condition DELIVERED
* * *
Table 7.1.2.3.3-3: SDS OFF-NETWORK MESSAGE (step 8, Table 7.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.9-1, condition READ, MCD_1to1
* * *
Table 7.1.2.3.3-4: SDS OFF-NETWORK NOTIFICATION (steps 9, 13a4, Table
7.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.12-1, condition READ
* * *
Table 7.1.2.3.3-5: SDS OFF-NETWORK MESSAGE (step 8, Table 7.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.9-1, condition DELIVERED_READ,
MCD_1to1
* * *
Table 7.1.2.3.3-6: SDS OFF-NETWORK NOTIFICATION (step 13b1, Table 7.1.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.12-1, condition DELIVERED_READ
* * *
### 7.1.3 Off-network / Short Data Service (SDS) / Standalone SDS using
signalling control plane / Group SDS message / Client Originated (CO)
##### 7.1.3.1 Test Purpose (TP) {#test-purpose-tp-33 .H6}
##### (1) {#section-122 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send a standalone group SDS message
with a disposition request type of DELIVERY }
**then** { UE (MCDATA Client) sends a SDS OFF-NETWORK MESSAGE message,
**and,** initiates counter CFS1 (SDS retransmission) to 1 and starts timer
TFS1 (SDS retransmission) }
}
##### (2) {#section-123 .H6}
**with** { UE (MCData Client) having sent a SDS OFF-NETWORK MESSAGE message
and started timer TFS1 (SDS retransmission) }
**ensure that** {
**when** { timer TFS1 (SDS retransmission) expires }
**then** { UE (MCData Client) retransmits the SDS OFF-NETWORK MESSAGE message
**and** , stops re-transmitting if the counter CFS1 (SDS retransmission) has
reached its maximum value and TFS1 (SDS retransmission) has expired }
}
##### (3) {#section-124 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send a standalone group SDS message
with a disposition request type of READ }
**then** { UE (MCDATA Client) sends a SDS OFF-NETWORK MESSAGE message,
**and,** initiates counter CFS1 (SDS retransmission) to 1 and starts timer
TFS1 (SDS retransmission) }
}
##### (4) {#section-125 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send a standalone group SDS message
with a disposition request type of DELIVERY AND READ }
**then** { UE (MCDATA Client) sends a SDS OFF-NETWORK MESSAGE message,
**and,** initiates counter CFS1 (SDS retransmission) to 1 and starts timer
TFS1 (SDS retransmission) }
}
##### 7.1.3.2 Conformance requirements {#conformance-requirements-33 .H6}
References: The conformance requirements covered in the current TC are
specified in:
TS 24.282 clauses 9.3.2.2, 9.3.2.3. Unless otherwise stated these are Rel-15
requirements.
[TS 24.282, clause 9.3.2.2]
Upon receiving an indication to send an SDS message, the MCData client:
1) if the request to send the SDS message is for a MCData group, shall check
if the value of \"/_\ _/\/Common/MCData/AllowedSDS\" leaf node, present
in the group configuration as specified in 3GPP TS 24.483 [42], is set to
\"false\". It the value is set to \"false\", shall reject the request to send
the SDS message and not continue with the remaining procedures in this clause;
2) if:
a) a one-to-one SDS message is to be sent then, shall store the MCData user ID
of the intended recipient as the target MCData user ID; or
b) a group SDS message is to be sent then, shall store the MCData group ID as
the target MCData group ID;
3) may set the stored SDS disposition request type as:
a) \"DELIVERY\", if only delivery disposition is requested;
b) \"READ\", if only read disposition is requested; or
c) \"DELIVERY AND READ\", if both delivery and read dispositions are
requested;
4) if an existing conversation is indicated then, shall store the conversation
identifier of the indicated conversation as SDS conversation ID. Otherwise,
shall generate an UUID as described in IETF RFC 4122 [14] and store SDS
conversation ID;
5) shall generate an UUID as described in IETF RFC 4122 [14] and store as the
SDS message ID;
6) if indicated that the SDS message is in reply to another SDS message then,
shall store the message identifier of the indicated message as SDS reply ID;
7) if indicated that the target recipient of the SDS message is an application
then, shall store the application ID of the indicated application as the SDS
application ID or as the SDS extended application ID;
8) shall store the received payload as the SDS payload;
9) shall store the received payload type as the SDS payload type;
10) shall store the current UTC time as the SDS transmission time;
11) shall generate a SDS OFF-NETWORK MESSAGE message as specified in clause
15.1.7. In the SDS OFF-NETWORK MESSAGE message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID;
b) if:
i) a one-to-one SDS message is to be sent then shall set the Recipient MCData
user ID IE to the stored target MCData user ID as specified in clause 15.2.15;
or
ii) a group SDS message is to be sent then, shall set the MCData group ID IE
to the stored target MCData group ID as specified in clause 15.2.14;
c) may set the SDS disposition request type IE to the stored the SDS
disposition request type as specified in clause 15.2.3;
d) shall set the Conversation ID IE to the stored conversation ID as specified
in clause 15.2.9;
e) shall set the Message ID IE to the stored SDS message ID as specified in
clause 15.2.10;
f) shall set the Date and time IE to the stored SDS transmission time as
specified in clause 15.2.8;
g) may include the InReplyTo message ID IE set to the stored SDS reply ID as
specified in clause 15.2.11;
h) may include:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE set to the stored SDS extended application
ID as specified in clause 15.2.24;
i) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the Security parameters and Payload IE with security
parameters as described in 3GPP TS 33.180 [26];
j) if
i) end-to-end security is not required for a one-to-one communication, or
ii) sending the SDS OFF-NETWORK MESSAGE message to a MCData group;
may include the Payload IE as specified in clause 15.2.13 with:
i) the Payload content type to the stored SDS payload type; and
ii) the Payload data set to the stored SDS payload;
12) if:
a) a one-to-one SDS message is to be sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.1; or
b) a group SDS message is to be sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.2;
13) shall initialise the counter CFS1 (SDS retransmission) with the value set
to 1; and
14) shall start timer TFS1 (SDS retransmission).
[TS 24.282, clause 9.3.2.3]
Upon expiry of timer TFS1 (SDS retransmission), the MCData client:
1) shall generate a SDS OFF-NETWORK MESSAGE message as specified in clause
15.1.7. In the SDS OFF-NETWORK MESSAGE message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID;
b) if:
i) a one-to-one SDS message is to be sent then, shall set the Recipient MCData
user ID IE to the stored target MCData user ID; or
ii) a group SDS message is to be sent then, shall set the MCData group ID IE
to the stored target MCData group ID;
c) may set the SDS disposition request type IE to the stored the SDS
disposition request type as specified in clause 15.2.3;
d) shall set the Conversation ID IE to the stored conversation ID as specified
in clause 15.2.9;
e) shall set the Message ID IE to the stored SDS message ID as specified in
clause 15.2.10;
f) shall set the Date and time IE to the stored the SDS transmission time as
specified in clause 15.2.8;
g) may include the InReplyTo message ID IE set to the stored SDS reply ID as
specified in clause 15.2.11;
h) may include:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE set to the stored SDS extended application
ID as specified in clause 15.2.24;
i) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the Security parameters IE with security parameters as
described in 3GPP TS 33.180 [26]; and
j) if:
i) end-to-end security is not required for a one-to-one communication, or
ii) sending the SDS OFF-NETWORK MESSAGE message to a MCData group;
may include the Payload IE as specified in clause 15.2.13 with:
i) the Payload content type to the stored SDS payload type; and
ii) the Payload data set to the stored SDS payload;
2) if:
a) a one-to-one SDS message was sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.1; or
b) a group SDS message was sent then, shall send the SDS OFF-NETWORK MESSAGE
message as specified in clause 9.3.1.2;
3) shall increment the counter CFS1(SDS retransmission) by 1; and
4) shall start timer TFS1 (SDS retransmission) if the associated counter CFS1
(SDS retransmission) has not reached its upper limit.
##### 7.1.3.3 Test description {#test-description-33 .H6}
##### 7.1.3.3.1 Pre-test conditions {#pre-test-conditions-33 .H6}
##### System Simulator: {#system-simulator-29 .H6}
\- SS-UE1 (MCData Client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCData
operation in the MCData configuration document).
NOTE 2: The SS operation as NW (MCData server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-29 .H6}
\- UE (MCData Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
\- CFS1 (SDS retransmission) is set to the default value of 5.
\- TFS1 (SDS retransmission) is set to the default value of 40 ms.
##### Preamble: {#preamble-29 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.3.3.2 Test procedure sequence {#test-procedure-sequence-33 .H6}
Table 7.1.3.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Activate | - | - | - | - | | | the | | | | | | | MCData | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the | | | | | | | MCData | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCX_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | p | | | | | | | x_MCX_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | MCData | | | | | | | User | | | | | | | request | | | | | | | to send a | | | | | | | s | | | | | | | tandalone | | | | | | | group SDS | | | | | | | message | | | | | | | with an | | | | | | | SDS | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY. | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps 5-7 | | | | | | | are | | | | | | | repeated | | | | | | | CFS1=5 | | | | | | | times | | | | | | | (CFS1 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | --> | SDS | 1,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 8-10 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | SS-UE1 | \ | SDS | 3,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | READ? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 14 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 15-17 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 15 | SS-UE1 | \ | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY | | | | | | | AND READ? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 20 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 21 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 15-17 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 22 | SS-UE1 | \ 6) if present, shall store the value of the Extended application ID IE as
> the stored SDS extended application ID;
7) if present, shall store the value of MCData group ID IE to the stored
target MCData group ID; and
8) if the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a SDS OFF-NETWORK NOTIFICATION message as
described in clause 12.3.2;
b) \"READ\" then, shall send a SDS OFF-NETWORK NOTIFICATION message as
described in clause 12.3.3; or
c) \"DELIVERY AND READ\" then, shall start timer TFS3 (delivery and read).
NOTE: Duplicate messages (re-transmissions) that are received by the MCData
client should not be processed again.
[TS 24.282, clause 9.3.2.5]
Upon receiving a display indication before timer TFS3 (delivery and read)
expires, the MCData client:
1) shall generate and send a SDS OFF-NETWORK NOTIFICATION message as described
in clause 12.3.4.
[TS 24.282, clause 9.3.2.6]
Upon expiry of timer TFS3 (delivery and read), the MCData client:
1) shall generate and send a SDS OFF-NETWORK NOTIFICATION message as described
in clause 12.3.2; and
2) upon receiving a display indication, shall generate and send a SDS OFF-
NETWORK NOTIFICATION message as described in clause 12.3.3.
[TS 24.282, clause 12.3.2]
To send an off-network SDS delivery notification, the MCData client:
1) shall store \"DELIVERED\" as the disposition type;
2) shall generate a SDS OFF-NETWORK NOTIFICATION message as specified in
clause 15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the stored SDS notification time as
specified in clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
3) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored
notification target MCData user ID as specified in clause 9.3.1.1;
4) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
5) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.3]
Upon receiving a display indication for the payload to the user or processing
of the payload by the target application, the MCData client:
1) shall store \"READ\" as the disposition type;
2) shall store the current UTC time as the stored SDS notification time;
3) shall generate SDS OFF-NETWORK NOTIFICATION message as specified in clause
15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Data and time IE as the SDS notification time as specified in
clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
4) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
5) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
6) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.4]
Upon receiving a display indication for the payload to the user or processing
of the payload by the target application, the MCData client:
1) shall store \"DELIVERED AND READ\" as the disposition type and stop the
timer TFS3 (display and read);
2) shall store the current UTC time as the stored SDS notification time;
3) shall generate SDS OFF-NETWORK NOTIFICATION message. In the SDS OFF-NETWORK
NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the SDS notification time as specified in
clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
4) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
5) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
6) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.5]
Upon expiry of timer TFS2 (SDS notification retransmission), the MCData
client:
1) shall generate a SDS OFF-NETWORK NOTIFICATION message as specified in
clause 15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the stored SDS notification time as
specified in clause 15.2.8;
e) shall set the SDS disposition type IE to the stored disposition type as
specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
2) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
3) shall increment the counter CFS2 (SDS notification retransmission) by 1;
and
4) shall start timer TFS2 (SDS notification retransmission) if the associated
counter CFS2 (SDS notification retransmission) has not reached its upper
limit.
##### 7.1.4.3 Test description {#test-description-34 .H6}
##### 7.1.4.3.1 Pre-test conditions {#pre-test-conditions-34 .H6}
##### System Simulator: {#system-simulator-30 .H6}
\- SS-UE1 (MCData Client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCData
operation in the MCData configuration document).
NOTE 2: The SS operation as NW (MCData server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-30 .H6}
\- UE (MCData Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
\- CFS2 (SDS notification retransmission)is set to the default value of 5.
\- TFS2 (SDS notification retransmission)is set to the default value of 40 ms.
\- TFS3 (delivery and read)is set to the default value of 120 ms.
##### Preamble: {#preamble-30 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.1.4.3.2 Test procedure sequence {#test-procedure-sequence-34 .H6}
Table 7.1.4.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Activate | - | - | - | - | | | the | | | | | | | MCData | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the | | | | | | | MCData | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCX_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | p | | | | | | | x_MCX_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | SS-UE1 | \ | SDS | 1,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | D | | | | | | | ELIVERED? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | SS-UE1 | \ | SDS | 3,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | READ upon | | | | | | | receiving | | | | | | | a display | | | | | | | i | | | | | | | ndication | | | | | | | for the | | | | | | | payload | | | | | | | to the | | | | | | | MCData | | | | | | | User? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 11 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 12 | SS-UE1 | \ | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | D | | | | | | | ELIVERED? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a2 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a3 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 13a4-13a6 | | | | | | | are | | | | | | | repeated | | | | | | | CFS2=5 | | | | | | | times | | | | | | | (CFS2 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a4 | Check: | --> | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | READ upon | | | | | | | receiving | | | | | | | a display | | | | | | | i | | | | | | | ndication | | | | | | | for the | | | | | | | payload | | | | | | | to the | | | | | | | MCData | | | | | | | User? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a5 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13a6 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 13b1-13b3 | | | | | | | are | | | | | | | repeated | | | | | | | CFS1=5 | | | | | | | times | | | | | | | (CFS1 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13b1 | Check: | --> | SDS | 4,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | DELIVERED | | | | | | | AND READ? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13b2 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 13b3 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.1.4.3.3 Specific message contents {#specific-message-contents-34 .H6}
Table 7.1.4.3.3-1: SDS OFF-NETWORK MESSAGE (step 4, Table 7.1.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.9-1, condition DELIVERED,
MCD_grp
* * *
Table 7.1.4.3.3-2: SDS OFF-NETWORK NOTIFICATION (steps 5, 13a1, Table
7.1.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.12-1, condition DELIVERED
* * *
Table 7.1.4.3.3-3: SDS OFF-NETWORK MESSAGE (step 8, Table 7.1.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.9-1, condition READ, MCD_grp
* * *
Table 7.1.4.3.3-4: SDS OFF-NETWORK NOTIFICATION (steps 9, 13a4, Table
7.1.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.12-1, condition READ
* * *
Table 7.1.4.3.3-5: SDS OFF-NETWORK MESSAGE (step 8, Table 7.1.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.9-1, condition DELIVERED_READ,
MCD_grp
* * *
Table 7.1.4.3.3-6: SDS OFF-NETWORK NOTIFICATION (step 13b1, Table 7.1.4.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.12-1, condition DELIVERED_READ
* * *
## 7.2 Enhanced Status (ES)
### 7.2.1 Off-network / Enhanced Status (ES) / Client Originated (CO)
##### 7.2.1.1 Test Purpose (TP) {#test-purpose-tp-35 .H6}
##### (1) {#section-130 .H6}
**with** { UE (MCData Client) registered and authorized for MCData Service,
including authorized for MCData Service in off-network environment, and, the
UE is in an off-network environment }
**ensure that** {
**when** { the MCDATA User requests to send an Enhanced Status with a
disposition of only Delivery }
**then** { UE (MCDATA Client) sends an Enhanced Status with a disposition
request of only Delivery via the SDS OFF-NETWORK MESSAGE message, **and,**
initiates counter CFS1 (SDS retransmission) to 1 and starts timer TFS1 (SDS
retransmission) }
}
##### (2) {#section-131 .H6}
**with** { UE (MCData Client) having sent a SDS OFF-NETWORK MESSAGE message
and started timer TFS1 (SDS retransmission) }
**ensure that** {
**when** { timer TFS1 (SDS retransmission) expires }
**then** { UE (MCData Client) retransmits the SDS OFF-NETWORK MESSAGE message
**and** , stops re-transmitting if the counter CFS1 (SDS retransmission) has
reached its maximum value and TFS1 (SDS retransmission) has expired }
}
##### 7.2.1.2 Conformance requirements {#conformance-requirements-35 .H6}
References: The conformance requirements covered in the current TC are
specified in:
TS 24.282 clauses 14.3.1, 9.3.2.2, 9.3.2.3. Unless otherwise stated these are
Rel-15 requirements.
[TS 24.282, clause 14.3.1]
Upon receiving request from MCData user to share enhanced for selected group:
1) if the value of \"/\/\/Common/MCData/AllowedEnhSvc\" leaf node
present in the group configuration as specified in 3GPP TS 24.483 [4] is set
to \"true\" for the MCData group, the MCData client:
a) shall use \"/\/\/Common/MCData/EnhSvcOpValues/\/EnhSvcOpID\" leaf
node associated with user selected enhanced status operation value present in
the group configuration as specified in 3GPP TS 24.483 [4] to generate a group
standalone SDS message by following the procedure described in clause 9.3.2.2.
[TS 24.282, clause 9.3.2.2]
Upon receiving an indication to send an SDS message, the MCData client:
1) if the request to send the SDS message is for a MCData group, shall check
if the value of \"/_\ _/\/Common/MCData/AllowedSDS\" leaf node, present
in the group configuration as specified in 3GPP TS 24.483 [42], is set to
\"false\". It the value is set to \"false\", shall reject the request to send
the SDS message and not continue with the remaining procedures in this clause;
2) if:
a) a one-to-one SDS message is to be sent then, shall store the MCData user ID
of the intended recipient as the target MCData user ID; or
b) a group SDS message is to be sent then, shall store the MCData group ID as
the target MCData group ID;
3) may set the stored SDS disposition request type as:
a) \"DELIVERY\", if only delivery disposition is requested;
b) \"READ\", if only read disposition is requested; or
c) \"DELIVERY AND READ\", if both delivery and read dispositions are
requested;
4) if an existing conversation is indicated then, shall store the conversation
identifier of the indicated conversation as SDS conversation ID. Otherwise,
shall generate an UUID as described in IETF RFC 4122 [14] and store SDS
conversation ID;
5) shall generate an UUID as described in IETF RFC 4122 [14] and store as the
SDS message ID;
6) if indicated that the SDS message is in reply to another SDS message then,
shall store the message identifier of the indicated message as SDS reply ID;
7) if indicated that the target recipient of the SDS message is an application
then, shall store the application ID of the indicated application as the SDS
application ID or as the SDS extended application ID;
8) shall store the received payload as the SDS payload;
9) shall store the received payload type as the SDS payload type;
10) shall store the current UTC time as the SDS transmission time;
11) shall generate a SDS OFF-NETWORK MESSAGE message as specified in clause
15.1.7. In the SDS OFF-NETWORK MESSAGE message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID;
b) if:
i) a one-to-one SDS message is to be sent then shall set the Recipient MCData
user ID IE to the stored target MCData user ID as specified in clause 15.2.15;
or
ii) a group SDS message is to be sent then, shall set the MCData group ID IE
to the stored target MCData group ID as specified in clause 15.2.14;
c) may set the SDS disposition request type IE to the stored the SDS
disposition request type as specified in clause 15.2.3;
d) shall set the Conversation ID IE to the stored conversation ID as specified
in clause 15.2.9;
e) shall set the Message ID IE to the stored SDS message ID as specified in
clause 15.2.10;
f) shall set the Date and time IE to the stored SDS transmission time as
specified in clause 15.2.8;
g) may include the InReplyTo message ID IE set to the stored SDS reply ID as
specified in clause 15.2.11;
h) may include:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE set to the stored SDS extended application
ID as specified in clause 15.2.24;
i) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the Security parameters and Payload IE with security
parameters as described in 3GPP TS 33.180 [26];
j) if
i) end-to-end security is not required for a one-to-one communication, or
ii) sending the SDS OFF-NETWORK MESSAGE message to a MCData group;
may include the Payload IE as specified in clause 15.2.13 with:
i) the Payload content type to the stored SDS payload type; and
ii) the Payload data set to the stored SDS payload;
12) if:
a) a one-to-one SDS message is to be sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.1; or
b) a group SDS message is to be sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.2;
13) shall initialise the counter CFS1 (SDS retransmission) with the value set
to 1; and
14) shall start timer TFS1 (SDS retransmission).
[TS 24.282, clause 9.3.2.3]
Upon expiry of timer TFS1 (SDS retransmission), the MCData client:
1) shall generate a SDS OFF-NETWORK MESSAGE message as specified in clause
15.1.7. In the SDS OFF-NETWORK MESSAGE message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID;
b) if:
i) a one-to-one SDS message is to be sent then, shall set the Recipient MCData
user ID IE to the stored target MCData user ID; or
ii) a group SDS message is to be sent then, shall set the MCData group ID IE
to the stored target MCData group ID;
c) may set the SDS disposition request type IE to the stored the SDS
disposition request type as specified in clause 15.2.3;
d) shall set the Conversation ID IE to the stored conversation ID as specified
in clause 15.2.9;
e) shall set the Message ID IE to the stored SDS message ID as specified in
clause 15.2.10;
f) shall set the Date and time IE to the stored the SDS transmission time as
specified in clause 15.2.8;
g) may include the InReplyTo message ID IE set to the stored SDS reply ID as
specified in clause 15.2.11;
h) may include:
i) the Application ID IE set to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE set to the stored SDS extended application
ID as specified in clause 15.2.24;
i) if end-to-end security is required for a one-to-one communication and the
security context does not exist or if the existing security context has
expired, shall include the Security parameters IE with security parameters as
described in 3GPP TS 33.180 [26]; and
j) if:
i) end-to-end security is not required for a one-to-one communication, or
ii) sending the SDS OFF-NETWORK MESSAGE message to a MCData group;
may include the Payload IE as specified in clause 15.2.13 with:
i) the Payload content type to the stored SDS payload type; and
ii) the Payload data set to the stored SDS payload;
2) if:
a) a one-to-one SDS message was sent then, shall send the SDS OFF-NETWORK
MESSAGE message as specified in clause 9.3.1.1; or
b) a group SDS message was sent then, shall send the SDS OFF-NETWORK MESSAGE
message as specified in clause 9.3.1.2;
3) shall increment the counter CFS1(SDS retransmission) by 1; and
4) shall start timer TFS1 (SDS retransmission) if the associated counter CFS1
(SDS retransmission) has not reached its upper limit.
##### 7.2.1.3 Test description {#test-description-35 .H6}
##### 7.2.1.3.1 Pre-test conditions {#pre-test-conditions-35 .H6}
##### System Simulator: {#system-simulator-31 .H6}
\- SS-UE1 (MCData Client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCData
operation in the MCData configuration document).
NOTE 2: The SS operation as NW (MCData server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-31 .H6}
\- UE (MCData Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
\- CFS1 (SDS retransmission) is set to the default value of 5.
\- TFS1 (SDS retransmission) is set to the default value of 40 ms.
##### Preamble: {#preamble-31 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.2.1.3.2 Test procedure sequence {#test-procedure-sequence-35 .H6}
Table 7.2.1.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Activate | - | - | - | - | | | the | | | | | | | MCData | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the | | | | | | | MCData | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCX_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | p | | | | | | | x_MCX_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | Make the | - | - | - | - | | | MCDATA | | | | | | | User | | | | | | | request | | | | | | | to send | | | | | | | an | | | | | | | enhanced | | | | | | | status to | | | | | | | Group A | | | | | | | using | | | | | | | Enhanced | | | | | | | Status Id | | | | | | | \"1\" | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | \"DE | | | | | | | LIVERY\". | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.11 | | | | | | | \'MCX CO | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Mon | | | | | | | itoring/D | | | | | | | iscoverer | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | discovery | | | | | | | / | | | | | | | On | | | | | | | e-to-many | | | | | | | communi | | | | | | | cation\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps 5-7 | | | | | | | are | | | | | | | repeated | | | | | | | CFS1=5 | | | | | | | times | | | | | | | (CFS1 | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | G.3.1-1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5 | Check: | --> | SDS | 1,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | MESSAGE | | | | | Client) | | | | | | | send an | | | | | | | enhanced | | | | | | | status | | | | | | | via the | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with a | | | | | | | di | | | | | | | sposition | | | | | | | request | | | | | | | type of | | | | | | | DELIVERY? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 6 | Start | - | - | - | - | | | TFS1 (SDS | | | | | | | retran | | | | | | | smission) | | | | | | | 40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 7 | TFS1 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps | | | | | | | 8-10 are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | SS-UE1 | \/\/Common/MCData/EnhSvcOpValues/\/EnhSvcOpID\" leaf node present
in the group configuration as specified in 3GPP TS 24.483 [4]; and
3) if a match is found, shall render the associated operational value from
\"/\/\/Common/MCData/EnhSvcOpValues/\/EnhSvcOpValue\" leaf node as
enhanced status to the MCData user.
[TS 24.282, clause 9.3.2.4]
Upon receiving an SDS OFF-NETWORK MESSAGE message with a SDS disposition
request type IE, the MCData client:
1) shall store the value of Sender MCData user ID IE as the stored
notification target MCData user ID;
2) shall store the value of Conversation ID IE as the stored conversation ID;
3) shall store the value of Message ID IE as the stored SDS message ID;
4) shall store the current UTC time as the stored SDS notification time;
5) if present, shall store the value of Application ID IE as the stored SDS
application ID;
> 6) if present, shall store the value of the Extended application ID IE as
> the stored SDS extended application ID;
7) if present, shall store the value of MCData group ID IE to the stored
target MCData group ID; and
8) if the SDS disposition request type IE is set to:
a) \"DELIVERY\" then, shall send a SDS OFF-NETWORK NOTIFICATION message as
described in clause 12.3.2;
b) \"READ\" then, shall send a SDS OFF-NETWORK NOTIFICATION message as
described in clause 12.3.3; or
c) \"DELIVERY AND READ\" then, shall start timer TFS3 (delivery and read).
NOTE: Duplicate messages (re-transmissions) that are received by the MCData
client should not be processed again.
[TS 24.282, clause 12.3.2]
To send an off-network SDS delivery notification, the MCData client:
1) shall store \"DELIVERED\" as the disposition type;
2) shall generate a SDS OFF-NETWORK NOTIFICATION message as specified in
clause 15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the stored SDS notification time as
specified in clause 15.2.8;
e) shall set the SDS disposition notification type IE to the stored
disposition type as specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
3) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored
notification target MCData user ID as specified in clause 9.3.1.1;
4) shall initialise the counter CFS2 (SDS notification retransmission) with
the value set to 1; and
5) shall start timer TFS2 (SDS notification retransmission).
[TS 24.282, clause 12.3.5]
Upon expiry of timer TFS2 (SDS notification retransmission), the MCData
client:
1) shall generate a SDS OFF-NETWORK NOTIFICATION message as specified in
clause 15.1.8. In the SDS OFF-NETWORK NOTIFICATION message, the MCData client:
a) shall set the Sender MCData user ID IE to its own MCData user ID as
specified in clause 15.2.15;
b) shall set the Conversation ID IE as the stored conversation ID as specified
in clause 15.2.9;
c) shall set the Message ID IE as the stored SDS message ID as specified in
clause 15.2.10;
d) shall set the Date and time IE as the stored SDS notification time as
specified in clause 15.2.8;
e) shall set the SDS disposition type IE to the stored disposition type as
specified in clause 15.2.5; and
f) may set:
i) the Application ID IE to the stored SDS application ID as specified in
clause 15.2.7; or
ii) the Extended application ID IE to the stored extended SDS application ID
as specified in clause 15.2.24;
2) shall send the SDS OFF-NETWORK NOTIFICATION message to the stored sender
MCData user ID as specified in clause 9.3.1.1;
3) shall increment the counter CFS2 (SDS notification retransmission) by 1;
and
4) shall start timer TFS2 (SDS notification retransmission) if the associated
counter CFS2 (SDS notification retransmission) has not reached its upper
limit.
##### 7.2.2.3 Test description {#test-description-36 .H6}
##### 7.2.2.3.1 Pre-test conditions {#pre-test-conditions-36 .H6}
##### System Simulator: {#system-simulator-32 .H6}
\- SS-UE1 (MCData Client)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the SS is behaving as SS-UE1 as defined in TS 36.508 [24],
configured for and operating as ProSe Direct Communication transmitting and
receiving device.
\- GNSS simulator to simulate a location and provide a timing reference for
the assistance of E-UTRAN off-network testing.
NOTE 1: For operation in off-network environment, it needs be ensured that
after the UE is powered up it considers the Geographical area #1 that is
simulated by the GNSS simulator as being one of the geographical areas set in
the USIM for operation when UE is \"not served by E-UTRAN\".
\- SS-NW (MCData server)
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate Parameters are set to the default parameters for the basic E-UTRA
Single cell network scenarios, as defined in TS 36.508 [24] clause 4.4. The
simulated Cell 1 shall belong to PLMN1 (the PLMN specified for MCData
operation in the MCData configuration document).
NOTE 2: The SS operation as NW (MCData server) is needed only for the preamble
if the UE has to perform procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
##### IUT: {#iut-32 .H6}
\- UE (MCData Client)
\- The test USIM set as defined in TS 36.579-1 [2] clause 5.5.10 is inserted.
\- For the underlying \"transport bearer\" over which the SS and the UE will
communicate, the UE is behaving as a ProSe enabled UE as defined in TS 36.508
[24], configured for and operating as ProSe Direct Communication transmitting
and receiving device.
\- CFS2 (SDS notification retransmission)is set to the default value of 5.
\- TFS2 (SDS notification retransmission)is set to the default value of 40 ms.
##### Preamble: {#preamble-32 .H6}
\- The UE has performed procedure \'MCData UE registration\' as specified in
TS 36.579-1 [2] clause 5.4.2B.
\- The UE has performed procedure \'MCX Authorization/Configuration and Key
Generation\' as specified in TS 36.579-1 [2] clause 5.3.2.
\- The GNSS simulator is configured to simulate a location in the centre of
Geographical area #1 and provide a timing reference, as defined in TS 36.508
[24] Table 4.11.2-2 scenario #1.
\- The UE is switched-off.
\- UE States at the end of the preamble
\- The UE is in state \'switched-off\'.
##### 7.2.2.3.2 Test procedure sequence {#test-procedure-sequence-36 .H6}
Table 7.2.2.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | Power up | - | - | - | - | | | the UE. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 2 | Trigger | - | - | - | - | | | the UE to | | | | | | | reset UTC | | | | | | | time and | | | | | | | location. | | | | | | | | | | | | | | NOTE: The | | | | | | | UTC time | | | | | | | and | | | | | | | location | | | | | | | reset may | | | | | | | be | | | | | | | performed | | | | | | | by MMI or | | | | | | | AT | | | | | | | command | | | | | | | (+CUTCR). | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 3 | Activate | - | - | - | - | | | the | | | | | | | MCData | | | | | | | Client | | | | | | | Ap | | | | | | | plication | | | | | | | and | | | | | | | register | | | | | | | User A as | | | | | | | the | | | | | | | MCData | | | | | | | User (TS | | | | | | | 36.579-5 | | | | | | | [5], | | | | | | | px_MCX_ | | | | | | | User_A_ | | | | | | | username, | | | | | | | p | | | | | | | x_MCX_U | | | | | | | ser_A_p | | | | | | | assword). | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | esta | | | | | | | blishment | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.10 | | | | | | | \'MCX CT | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | on | | | | | | | e-to-many | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | / | | | | | | | Ann | | | | | | | ouncing/D | | | | | | | iscoveree | | | | | | | procedure | | | | | | | for group | | | | | | | member | | | | | | | dis | | | | | | | covery\'. | | | | | | | The test | | | | | | | sequence | | | | | | | below | | | | | | | shows | | | | | | | only the | | | | | | | MCData | | | | | | | relevant | | | | | | | messages | | | | | | | e | | | | | | | xchanged. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | Steps 4-6 | | | | | | | are | | | | | | | repeated | | | | | | | 5 times. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | SS-UE1 | \ | SDS | 1,2 | P | | | Does the | | OF | | | | | UE | | F-NETWORK | | | | | (MCData | | NOT | | | | | Client) | | IFICATION | | | | | send a | | | | | | | SDS | | | | | | | OF | | | | | | | F-NETWORK | | | | | | | MESSAGE | | | | | | | message | | | | | | | with | | | | | | | di | | | | | | | sposition | | | | | | | not | | | | | | | ification | | | | | | | type of | | | | | | | D | | | | | | | ELIVERED? | | | | | | | | | | | | | | NOTE: It | | | | | | | is | | | | | | | expected | | | | | | | that the | | | | | | | UE | | | | | | | | | | | | | | - shall | | | | | | | i | | | | | | | nitialize | | | | | | | the | | | | | | | counter | | | | | | | CFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | | | with the | | | | | | | value set | | | | | | | to 1 on | | | | | | | the first | | | | | | | tran | | | | | | | smission, | | | | | | | and, | | | | | | | increase | | | | | | | it by 1 | | | | | | | with each | | | | | | | re-tran | | | | | | | smission. | | | | | | | | | | | | | | - shall | | | | | | | start | | | | | | | timer | | | | | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retran | | | | | | | smission) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 8 | Start | - | - | - | - | | | TFS2 (SDS | | | | | | | not | | | | | | | ification | | | | | | | retransmi | | | | | | | ssion)=40 | | | | | | | mil | | | | | | | liseconds | | | | | | | as | | | | | | | defined | | | | | | | in 24.282 | | | | | | | [31] | | | | | | | Table | | | | | | | F.3.1-1. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 9 | TFS2 | - | - | - | - | | | expires. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | - | E | - | - | - | - | | | XCEPTION: | | | | | | | UE | | | | | | | releases | | | | | | | the | | | | | | | E-UTRA | | | | | | | co | | | | | | | nnection. | | | | | | | The | | | | | | | E | | | | | | | -UTRA/EPC | | | | | | | actions | | | | | | | which are | | | | | | | related | | | | | | | to the | | | | | | | MCData | | | | | | | call | | | | | | | release | | | | | | | are | | | | | | | described | | | | | | | in | | | | | | | TS 36.57 | | | | | | | 9-1 [2] | | | | | | | clause | | | | | | | 5.4.8, | | | | | | | \'MCX | | | | | | | comm | | | | | | | unication | | | | | | | over | | | | | | | ProSe | | | | | | | direct | | | | | | | o | | | | | | | ne-to-one | | | | | | | comm | | | | | | | unication | | | | | | | out of | | | | | | | E-UTRA | | | | | | | coverage | | | | | | | - release | | | | | | | by the | | | | | | | UE\'. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 10 | Check: | - | - | 1 | P | | | Does the | | | | | | | UE | | | | | | | (MCDATA | | | | | | | Client) | | | | | | | render | | | | | | | the | | | | | | | op | | | | | | | erational | | | | | | | value of | | | | | | | the | | | | | | | received | | | | | | | Enhanced | | | | | | | Status ID | | | | | | | as | | | | | | | enhanced | | | | | | | status to | | | | | | | the | | | | | | | MCDATA | | | | | | | User? | | | | | | | | | | | | | | (NOTE 1) | | | | | +-----------+-----------+-----------+-----------+---------+----+ | NOTE 1: | | | | | | | This is | | | | | | | expected | | | | | | | to be | | | | | | | done via | | | | | | | a | | | | | | | suitable | | | | | | | imple | | | | | | | mentation | | | | | | | dependent | | | | | | | MMI. | | | | | | +-----------+-----------+-----------+-----------+---------+----+
##### 7.2.2.3.3 Specific message contents {#specific-message-contents-36 .H6}
Table 7.2.2.3.3-1: SDS OFF-NETWORK MESSAGE (step 4, Table 7.2.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.10-1, condition DELIVERED,
MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** Payload Payload as described in Table 7.2.2.3.3-2
Table 7.2.2.3.3-2: Payload in the SDS OFF-NETWORK MESSAGE (step 4, Table
7.2.2.3.2-1)
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.10-3, condition DELIVERED,
MCD_grp
* * *
**Information Element** **Value/remark** **Comment** **Reference**
**Condition** Data payload message identity \'00000011\'B Data payload TS
24.282 [87] clause 15.2.2  
Number of payloads 1 1 payload TS 24.282 [87] clause 15.2.12  
Payload TS 24.282 [87] clause 15.2.13  
Payload IEI \'78\'O  
Length of Payload length of the content  
Payload content type \'00000110\'B ENHANCED STATUS  
Payload data \"0\" The id as defined in the MCData Group Configuration
Document TS 36.579-1 [2], Table 5.5.7.3-1
Table 7.2.2.3.3-3: SDS OFF-NETWORK NOTIFICATION (step 7, Table 7.2.2.3.2-1)
* * *
Derivation Path: TS 36.579-1 [2], Table 5.5.3.8.11-1, condition DELIVERED
* * *
###### ## Annex A (normative): Test Files
# A.1 Introduction
This annex specifies the test files to be used for the MCData FD test cases
specified in present document.
# A.2 Test files for client originated file distribution
## A.2.1 Test File 1 for CO FD
File type: text/plain
Content:
* * *
Test file 1 for MCData client originated file distribution
* * *
## A.2.2 Test File 2 for CO FD
File type: text/plain
Content:
* * *
Test file 2 for MCData client originated file distribution
* * *
# A.3 Test files for client terminated file distribution
## A.3.1 Test File 1 for CT FD
File type: text/plain
Content:
* * *
Test file 1 for MCData client terminated file distribution
* * *
## A.3.2 Test File 2 for CT FD
File type: text/plain
Content:
* * *
Test file 2 for MCData client terminated file distribution
* * *
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the non-access stratum (NAS) procedures in the
5G system (5GS) used by the protocols for:
\- mobility management between the user equipment (UE) and the access and
mobility management function (AMF) for both 3GPP access and non-3GPP access;
and
\- session management between the user equipment (UE) and the session
management function (SMF) for both 3GPP access and non-3GPP access.
The 5GS mobility management (5GMM) protocol defined in the present document
provides procedures for the control of mobility when the user equipment (UE)
is using the NG radio access network (NG-RAN) and/or non-3GPP access network.
The 5GMM protocol also provides control of security for the NAS protocols.
The 5GS session management (5GSM) protocol defined in the present document
provides procedures for the handling of 5GS PDU sessions. Together with the
bearer control provided by the access stratum, this protocol is used for the
control of user-plane resources.
For both NAS protocols the present document specifies procedures for the
support of inter-system mobility between the NG-RAN and the evolved universal
terrestrial radio access (E-UTRAN), between the NG-RAN and the non-3GPP access
network connected to the EPC, and between the non-3GPP access network
connected to the 5G core network (5GCN) and the E-UTRAN.
For both NAS protocols the present document specifies procedures for the
support of mobility between the NG-RAN and the non-3GPP access network
connected to the 5GCN.
In addition, the present document specifies the procedures in the 5GS for UE
policy delivery service between the UE and the policy control function (PCF)
for both 3GPP access and non-3GPP access.
The present document is applicable to the UE, the access and mobility
management function (AMF), the session management function (SMF), and the PCF
in the 5GS.
The clauses and subclauses in the present document are common for both 3GPP
access and non-3GPP access unless it is explicitly stated that they apply to
3GPP access only or non-3GPP access only.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[1A] 3GPP TS 22.011: \"Service accessibility\".
[2] 3GPP TS 22.101: \"Service aspects; Service principles\".
[3] 3GPP TS 22.261: \"Service requirements for the 5G system; Stage 1\".
[4] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[4A] 3GPP TS 23.040: \"Technical realization of Short Message Service (SMS)\".
[5] 3GPP TS 23.122: \"Non-Access-Stratum functions related to Mobile Station
(MS) in idle mode\".
[6] 3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".
[7] 3GPP TS 23.401: \"GPRS enhancements for E-UTRAN access\".
[8] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[9] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[10] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System; Stage 2\".
[11] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[12] 3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core
Network Protocols; Stage 3\".
[13] 3GPP TS 24.011: \"Point-to-Point Short Message Service (SMS) support on
mobile radio interface\".
[14] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[15] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[16] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3\"
[17] 3GPP TS 24.368: \"Non-Access Stratum (NAS) configuration Management
Object (MO)\".
[18] 3GPP TS 24.502: \"Access to the 3GPP 5G System (5GS) via non-3GPP access
networks; Stage 3\".
[19] 3GPP TS 24.526: \"UE policies for 5G System (5GS); Stage 3\".
[20] 3GPP TS 24.623: \"Extensive Markup Language (XML) Configuration Access
Protocol (XCAP) over the Ut interface for Manipulating Supplementary
Services\".
[20A] 3GPP TS 29.502: \"5G System; Session Management Services; Stage 3\".
[21] 3GPP TS 29.525: \"5G System; UE Policy Control Service; Stage 3\".
[22] 3GPP TS 31.102: \"Characteristics of the Universal Subscriber Identity
Module (USIM) application\".
[22A] 3GPP TS 31.111: \"USIM Application Toolkit (USAT)\".
[22B] 3GPP TS 31.115: \"Secured packet structure for (Universal) Subscriber
Identity Module (U)SIM Toolkit applications\".
[23] 3GPP TS 33.102: \"3G security; Security architecture\".
[23A] 3GPP TS 33.401: \"3GPP System Architecture Evolution; Security
architecture\".
[24] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[25] 3GPP TS 36.323: \"NR; Packet Data Convergence Protocol (PDCP)
specification\".
[25A] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC) protocol specification\".
[26] 3GPP TS 36.355: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
LTE Positioning Protocol (LPP)\".
[27] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
[28] 3GPP TS 38.304: \"New Generation Radio Access Network; User Equipment
(UE) procedures in Idle mode\".
[29] 3GPP TS 38.323: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Packet Data Convergence Protocol (PDCP) specification\".
[30] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
Specification\".
[31] 3GPP TS 38.413: \"NG Radio Access Network (NG-RAN); NG Application
Protocol (NGAP)\".
[32] IETF RFC 768: \"User Datagram Protocol\".
[33] IETF RFC 793: \"Transmission Control Protocol.\"
[34] IETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".
[35] IETF RFC 3736: \"Stateless Dynamic Host Configuration Protocol (DHCP)
Service for IPv6\"
[35A] IETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".
[36] IETF RFC 4191: \"Default Router Preferences and More-Specific Routes\".
[37] IETF RFC 7542: \"The Network Access Identifier\".
[38] IETF RFC 4303: \"IP Encapsulating Security Payload (ESP)\".
[39] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[40] IETF RFC 5448: \"Improved Extensible Authentication Protocol Method for
3rd Generation Authentication and Key Agreement (EAP-AKA\')\".
[41] IETF RFC 7296: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".
[42] ITU-T Recommendation E.212: \"The international identification plan for
public networks and subscriptions\", 2016-09-23.
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**5GMM-IDLE mode:** In this specification, if the term is used standalone, a
UE in 5GMM-IDLE mode means the UE can be either in 5GMM-IDLE mode over 3GPP
access or in 5GMM-IDLE mode over non-3GPP access.
**5GMM-CONNECTED mode:** In this specification, if the term is used
standalone, a UE in 5GMM-CONNECTED mode means the UE can be either in 5GMM-
CONNECTED mode over 3GPP access or in 5GMM-CONNECTED mode over non-3GPP
access.
**5GMM-IDLE mode over 3GPP access:** A UE is in 5GMM-IDLE mode over 3GPP
access when no N1 NAS signalling connection between the UE and network over
3GPP access exists. The term 5GMM-IDLE mode over 3GPP access used in the
present document corresponds to the term CM-IDLE state for 3GPP access used in
3GPP TS 23.501 [8].
**5GMM-CONNECTED mode over 3GPP access:** A UE is in 5GMM-CONNECTED mode over
3GPP access when an N1 NAS signalling connection between the UE and network
over 3GPP access exists. The term 5GMM-CONNECTED mode over 3GPP access used in
the present document corresponds to the term CM-CONNECTED state for 3GPP
access used in 3GPP TS 23.501 [8].
**5GMM-IDLE mode over non-3GPP access:** A UE is in 5GMM-IDLE mode over
non-3GPP access no N1 NAS signalling connection between the UE and network
over non-3GPP access exists. The term 5GMM-IDLE mode over non-3GPP access used
in the present document corresponds to the term CM-IDLE state for non-3GPP
access used in 3GPP TS 23.501 [8].
**5GMM-CONNECTED mode over non-3GPP access:** A UE is in 5GMM-CONNECTED mode
over non-3GPP access when it has N1 NAS signalling connection between the UE
and network over non-3GPP access exists. The term 5GMM-CONNECTED mode over
non-3GPP access used in the present document corresponds to the term CM-
CONNECTED state for non-3GPP access used in 3GPP TS 23.501 [8].
**5GS services:** Services provided by PS domain. Within the context of this
specification, 5GS services is used as a synonym for EPS services.
**5G-EA:** 5GS encryption algorithms. The term 5G-EA, 5G-EA0, 128-5G-EA1-3 and
5G-EA4-7 used in the present document corresponds to the term NEA, NEA0,
NEA1-3 and NEA4-7 defined in 3GPP TS 33.501 [24].
**5G-IA:** 5GS integrity algorithms. The term 5G-IA, 5G-IA0, 128-5G-IA1-3 and
5G-IA4-7 used in the present document corresponds to the term NIA, NIA0,
NIA1-3 and NIA4-7 defined in 3GPP TS 33.501 [24].
**Access stratum connection:** A peer to peer access stratum connection
between either the UE and the NG-RAN for 3GPP access or the UE and the N3IWF
for non-3GPP access. The access stratum connection for 3GPP access corresponds
to an RRC connection via the Uu reference point. The creation of the access
stratum connection for non-3GPP access corresponds to the completion of the
IKE_SA_INIT exchange (see IETF RFC 7296 [41]) via the NWu reference point.
**Aggregate maximum bit rate:** The maximum bit rate that limits the aggregate
bit rate of a set of non-GBR bearers of a UE. Definition derived from 3GPP TS
23.501 [8].
**Always-on PDU session:** A PDU session for which user-plane resources have
to be established during every transition from 5GMM-IDLE mode to 5GMM-
CONNECTED mode. A UE requests a PDU session to be established as an always-on
PDU session based on indication from upper layers and the network decides
whether a PDU session is established as an always-on PDU session.
NOTE 1: How the upper layers in the UE are configured to provide an indication
is out of scope of the specification.
**Cleartext IEs:** Information elements that can be sent without
confidentiality protection in initial NAS messages as specified in subclause
4.4.6.
**DNN based congestion control:** Type of congestion control at session
management level that is applied to reject session management requests from
UEs or release PDU sessions when the associated DNN is congested. DNN based
congestion control can be activated at the SMF over session management level
and also activated at the AMF over mobility management level.
**Emergency PDU session:** A PDU session which was established with the
request type \"initial emergency request\" or \"existing emergency PDU
session\".
**General NAS level congestion control:** Type of congestion control at
mobility management level that is applied at a general overload or congestion
situation in the network, e.g. lack of processing resources.
**Initial NAS message:** A NAS message is considered as an initial NAS
message, if this NAS message can trigger the establishment of an N1 NAS
signalling connection. For instance, the REGISTRATION REQUEST message is an
initial NAS message.
**Initial registration for emergency services:** A registration performed with
5GS registration type \"emergency registration\" in the REGISTRATION REQUEST
message.
**Last visited registered TAI:** A TAI which is contained in the registration
area that the UE registered to the network and which identifies the tracking
area last visited by the UE.
**Mapped S-NSSAI:** An S-NSSAI in the subscribed S-NSSAIs for the HPLMN, which
is mapped to an S-NSSAI of the registered PLMN in case of a roaming scenario.
**N1 mode:** A mode of a UE allowing access to the 5G core network via the 5G
access network.
**N1 NAS signalling connection:** A peer to peer N1 mode connection between UE
and AMF. An N1 NAS signalling connection is either the concatenation of an RRC
connection via the Uu reference point and an NG connection via the N2
reference point for 3GPP access, or the concatenation of an IPsec tunnel via
the NWu reference point and an NG connection via the N2 reference point for
non-3GPP access.
**Network slicing information:** information stored at the UE consisting of
one or more of the following:
a) default configured NSSAI;
b) configured NSSAI for a PLMN;
c) mapped S-NSSAI(s) for the configured NSSAI for a PLMN;
d) for each access type:
1) allowed NSSAI for a PLMN;
2) mapped S-NSSAI(s) for the allowed NSSAI for a PLMN.
**Non-cleartext IEs:** Information elements that are not cleartext IEs.
**Non-emergency PDU session:** Any PDU session which is not an emergency PDU
session.
**PDU address:** An IP address assigned to the UE by the packet data network.
**PDU session for LADN:** A PDU session with a DNN associated with a LADN.
**PDU session with suspended user-plane resources:** A PDU session for which
user-plane resources were established or re-established, and for which data
radio bearers were suspended when transiting to 5GMM-CONNECTED mode with RRC
inactive indication.
**Persistent PDU session:** either a non-emergency PDU session contains a GBR
QoS flow with QoS equivalent to QoS of teleservice 11 and where there is a
radio bearer associated with that PDU session, or an emergency PDU session
where there is a radio bearer associated with that PDU session.
NOTE 2: An example of a persistent PDU session is a non-emergency PDU session
with 5QI = 1 where there is a radio bearer associated with that context.
**Procedure transaction identity:** An identity which is dynamically allocated
by the UE for the UE-requested 5GSM procedures, or allocated by the UE or the
PCF for the UE policy delivery procedures. The procedure transaction identity
is released when the procedure is completed but it should not be released
immediately.
**RAT frequency selection priority index:** A parameter provided by the AMF to
the NG-RAN via the N2 reference point. The AMF selects an RFSP index for a
particular UE based on the subscribed RFSP index, the locally configured
operator\'s policies, the allowed NSSAI and the UE context information,
including the UE\'s usage setting, if received during the registration
procedure. Definition derived from 3GPP TS 23.501 [8].
**Registered for emergency services:** **A UE is considered as \"registered
for emergency services\"** when it has successfully completed initial
registration for emergency services .
**Registered PLMN** : The PLMN on which the UE is registered. The identity of
the registered PLMN (MCC and MNC) is provided to the UE within the GUAMI field
of the 5G-GUTI.
**Rejected NSSAI:** Rejected NSSAI for the current PLMN or rejected NSSAI for
the current registration area.
**Rejected NSSAI for the current PLMN:** A set of S-NSSAIs which was included
in the requested NSSAI by the UE and is sent by the AMF with the rejection
cause \"S-NSSAI not available in the current PLMN\".
**Rejected NSSAI for the current registration area:** A set of S-NSSAIs which
was included in the requested NSSAI by the UE and is sent by the AMF with the
rejection cause \"S-NSSAI not available in the current registration area\".
**Local release:** Release of a PDU session without peer-to-peer signalling
between the network and the UE,
NOTE 3: Local release can include communication among network entities.
**Removal of eCall only mode restriction:** All the limitations as described
in 3GPP TS 22.101 [2] for the eCall only mode do not apply any more.
**Routing indicator:** Routing Indicator is an identifier assigned by the
UE\'s home network operator to be used together with the Home Network
Identifier for routing network signalling. Routing Indicator is provisioned in
the USIM. The term Routing indicator used in the present document corresponds
to the term Routing ID used in 3GPP TS 23.501 [8].
**S-NSSAI-based congestion control:** Type of congestion control at session
management level that is applied to reject session management requests from
UEs or release PDU sessions when the associated S-NSSAI and optionally the
associated DNN are congested. . S-NSSAI based congestion control can be
activated at the SMF over session management level and also activated at the
AMF over mobility management level.
**Selected core network type information:** A type of core network (EPC or
5GCN) selected by the UE NAS layer in case of an E-UTRA cell connected to both
EPC and 5GCN.
**UE configured for high priority access in selected PLMN:** A UE configured
with one or more access identities equal to 1, 2, or 11-15 applicable in the
selected PLMN as specified in subclause 4.5.2. Definition derived from 3GPP TS
22.261 [3].
**User-plane resources:** Resources established between the UE and the UPF.
The user-plane resources consist of either user plane radio bearers via the Uu
reference point, a tunnel via the N3 reference point and a tunnel via the N9
reference point (if any) for 3GPP access, or IPsec tunnels via the NWu
reference point, a tunnel via the N3 reference point and a tunnel via the N9
reference point (if any) for non-3GPP access.
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.003 [4] apply:
**5G-GUTI**
**5G-S-TMSI**
**PEI**
**SUPI**
**SUCI**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.122 [5] apply:
**Country**
**EHPLMN**
**HPLMN**
**Selected PLMN**
**Shared network**
**Steering of Roaming (SOR)**
**Steering of Roaming information**
**Suitable cell**
**VPLMN**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.167 [6] apply:
**eCall over IMS**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.401 [7] apply:
**eCall only mode**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.501 [8] apply:
**5G access network**
**5G core network**
**5G QoS flow**
**5G QoS identifier**
**5G System**
**Allowed area**
**Allowed NSSAI**
**AMF region**
**AMF set**
**Configured NSSAI**
**Local area data network**
**Network slice**
**NG-RAN**
**Non-allowed area**
**PDU connectivity service**
**PDU session**
**PDU session type**
**Requested NSSAI**
**Routing ID**
**Service data flow**
**UE presence in LADN service area**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.503 [10] apply:
**UE local configuration**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.008 [12] apply:
**GMM**
**MM**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.301 [15] apply:
**EENLV**
**EMM**
**EPS**
**EPS security context**
**EPS services**
**Lower layer failure**
**Megabit**
**Message header**
**NAS signalling connection recovery**
**S1 mode**
**Non-EPS services**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 33.501 [24] apply:
**5G security context**
**5G NAS security context**
**ABBA**
**Current 5G security context**
**Full native 5G security context**
**K\'** ~AME~
**K** ~AMF~
**K** ~ASME~
**Mapped security context**
**Native 5G security context**
**NCC**
**Non-current 5G security context**
**Partial native 5G security context**
**RES***
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 38.413 [31] apply:
**NG connection**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
4G-GUTI 4G-Globally Unique Temporary Identifier
5GCN 5G Core Network
5G-GUTI 5G-Globally Unique Temporary Identifier
5GMM 5GS Mobility Management
5GS 5G System
5GSM 5GS Session Management
5G-S-TMSI 5G S-Temporary Mobile Subscription Identifier
5G-TMSI 5G Temporary Mobile Subscription Identifier
5QI 5G QoS Identifier
AKA Authentication and Key Agreement
AMBR Aggregate Maximum Bit Rate
AMF Access and Mobility Management Function
APN Access Point Name
DL Downlink
DN Data Network
DNN Data Network Name
E-UTRAN Evolved Universal Terrestrial Radio Access Network
EAP-AKA\' Improved Extensible Authentication Protocol method for 3rd
generation Authentication and Key Agreement
ECIES Elliptic Curve Integrated Encryption Scheme
EPD Extended Protocol Discriminator
EMM EPS Mobility Management
EPC Evolved Packet Core Network
EPS Evolved Packet System
ESM EPS Session Management
Gbps Gigabits per second
GFBR Guaranteed Flow Bit Rate
GUAMI Globally Unique AMF Identifier
IP-CAN IP-Connectivity Access Network
KSI Key Set Identifier
LADN Local Area Data Network
LMF Location Management Function
LPP LTE Positioning Protocol
MAC Message Authentication Code
Mbps Megabits per second
MFBR Maximum Flow Bit Rate
MICO Mobile Initiated Connection Only
N3IWF Non-3GPP Inter-Working Function
NAI Network Access Identifier
NITZ Network Identity and Time Zone
NR New Radio
ngKSI Key Set Identifier for Next Generation Radio Access Network
NSSAI Network Slice Selection Assistance Information
OS Operating System
OS Id OS Identity
PTI Procedure Transaction Identity
QFI QoS Flow Identifier
QoS Quality of Service
QRI QoS Rule Identifier
(R)AN (Radio) Access Network
RPLMN Registered PLMN
RQA Reflective QoS Attribute
RQI Reflective QoS Indication
RFSP RAT Frequency Selection Priority
S-NSSAI Single NSSAI
SA Security Association
SDF Service Data Flow
SNN Serving Network Name
SMF Session Management Function
SOR Steering of Roaming
TA Tracking Area
TAC Tracking Area Code
TAI Tracking Area Identity
Tbps Terabits per second
UL Uplink
UPF User Plane Function
UPSC UE Policy Section Code
UPSI UE Policy Section Identifier
URN Uniform Resource Name
URSP UE Route Selection Policy
# 4 General
## 4.1 Overview
The non-access stratum (NAS) described in the present document forms the
highest stratum of the control plane between UE and AMF (reference point
\"N1\" see 3GPP TS 23.501 [8]) for both 3GPP and non-3GPP access.
Main functions of the protocols that are part of the NAS are:
\- support of mobility of the user equipment (UE) including also common common
procedures such as authentication, identification, generic UE configuration
update and security control mode procedures;
\- support of session management procedures to establish and maintain data
connectivity between the UE and the data network; and
\- NAS transport procedure to provide a transport of SMS, LPP, UE policy
container, SOR transparent container and UE parameters update information
payload.
Principles for the handing of 5GS security contexts and for the activation of
ciphering and integrity protection, when a NAS signalling connection is
established, are provided in subclause 4.4.
For the support of the above functions, the following procedures are supplied
within this specification:
\- elementary procedures for 5GS mobility management in clause 5; and
\- elementary procedures for 5GS session management in clause 6.
Signalling procedures for the control of NAS security are described as part of
the 5GMM common procedures in subclause 5.4.
Complete NAS transactions consist of specific sequences of elementary
procedures. Examples of such specific sequences can be found in 3GPP TS 23.502
[9].
The NAS for 5GS follows the protocol architecture model for layer 3 as
described in 3GPP TS 24.007 [11].
## 4.2 Coordination between the protocols for 5GS mobility management and 5GS
session management
A 5GS session management (5GSM) message is piggybacked in specific 5GS
mobility management (5GMM) transport messages. To this purpose, the 5GSM
messages can be transmitted in an information element in the 5GMM transport
messages. In this case, the UE, the AMF and the SMF execute the 5GMM procedure
and the 5GSM procedure in parallel. The success of the 5GMM procedure is not
dependent on the success of the piggybacked 5GSM procedure.
The UE can only initiate the 5GSM procedure when there is a 5GMM context
established at the UE.
During 5GMM procedures, the UE and the AMF shall suspend the transmission of
5GSM messages, except when:
a) the 5GMM procedure is piggybacking 5GSM messages; or
b) the UE is in 5GMM-CONNECTED mode and a service request procedure for re-
establishing user-plane resources of PDU session(s) is initiated without
including PDU session status IE or Allowed PDU session status IE.
In these cases, the UE and the AMF need not suspend the transmission of 5GSM
messages related to other PDU session(s) than the one(s) for which the user-
plane resources re-establishment is requested.
A 5GMM message piggybacking a 5GSM message for a PDU session shall be
delivered via the access associated with the PDU session, if any, with the
following exceptions:
a) the AMF shall send, via 3GPP access, a DL NAS TRANSPORT message
piggybacking a downlink 5GSM message of a network-requested 5GSM procedure for
a PDU session associated with non-3GPP access if the conditions specified in
subclause 5.5.1.3.4 or subclause 5.6.1.4 are met;
b) the UE shall send an UL NAS TRANSPORT message piggybacking a response
message to the 5GSM message described in a) via either:
1) 3GPP access; or
2) non-3GPP access if the UE is in 5GMM-CONNECTED mode over non-3GPP access.
NOTE: The interaction between the 5GMM sublayer and the 5GSM sublayer to
enable the UE to send the UL NAS TRANSPORT message containing the response
message via 3GPP access is required. This is achieved via UE implementation.
c) the UE shall send, via the target access, an UL NAS TRANSPORT message
piggybacking a 5GSM message associated with a request type set to \"existing
PDU session\" or \"existing emergency PDU session\" for handover of an
existing PDU session between 3GPP access and non-3GPP access.
## 4.3 UE domain selection
### 4.3.1 UE\'s usage setting
The UE\'s usage setting defined in 3GPP TS 24.301 [15] applies to voice
capable UEs in 5GS and indicates whether the UE has preference for voice
services over data services or vice-versa, where:
a) voice services include IMS voice; and
b) data services include any kind of user data transfer without a voice media
component.
The UE\'s usage setting can be set to:
a) \"voice centric\"; or
b) \"data centric\".
If the UE is capable of S1 mode, there is a single UE\'s usage setting at the
UE which applies to both 5GS and EPS.
### 4.3.2 Domain selection for UE originating sessions / calls
The behaviour of the UE for domain selection is determined by:
a) the UE usage setting;
b) the availability of IMS voice; and
c) whether the UE operates in single-registration mode or dual-registration
mode (see 3GPP TS 23.501 [8]).
In the present document the condition \"the UE supports IMS voice over 3GPP
access\" evaluates to \"true\" if at least one of the following is fulfilled:
1) the UE supports IMS voice over NR connected to 5GCN;
2) the UE supports IMS voice over E-UTRA connected to 5GCN; or
3) the UE supports IMS voice in EPS.
In the present document the condition \"the UE does not support IMS voice over
3GPP access\" evaluates to \"true\" if the condition \"the UE supports IMS
voice over 3GPP access\" evaluates to \"false\".
In the present document the condition \"the UE supports IMS voice over
non-3GPP access\" evaluates to \"true\" if the UE supports IMS voice over
non-3GPP access connected to 5GCN.
In the present document the condition \"the UE does not support IMS voice over
non-3GPP access\" evaluates to \"true\" if the condition \"the UE supports IMS
voice over non-3GPP access\" evaluates to \"false\".
In the present document, \"IMS voice not available\" is determined per access
type independently, i.e. 3GPP access or non-3GPP access.
In the present document, \"IMS voice not available\" refers to one of the
following conditions:
a) the UE does not support IMS voice;
b) the UE supports IMS voice, but the network indicates in the REGISTRATION
ACCEPT message that IMS voice over PS sessions are not supported; or
c) the UE supports IMS voice, the network indicates in the REGISTRATION ACCEPT
message that IMS voice over PS sessions are supported, but the upper layers:
1) provide no indication that the UE is available for voice call in the IMS
within a manufacturer determined period of time; or
2) indicate that the UE is not available for voice calls in the IMS.
NOTE: If conditions a and b evaluate to false, the upper layers need time to
attempt IMS registration. In the event an indication from the upper layers
that the UE is available for voice calls in the IMS takes longer than the
manufacturer determined period of time (e.g. due to delay when attempting IMS
registration or due to delay in obtaining a QoS flow for SIP signalling), the
NAS layer assumes the UE is not available for voice calls in the IMS.
Other conditions may exist but these are implementation specific.
In the present document, \"IMS voice available\" applies when \"IMS voice not
available\" does not apply.
When IMS voice is not available over 3GPP access, if the UE\'s usage setting
is \"voice centric\", the UE operates in single-registration mode, and the UE:
a) does not have a persistent PDU session, and:
1) if the UE is only registered over 3GPP access, or if the UE is registered
over both 3GPP access and non-3GPP access and IMS voice is not available over
non-3GPP access, the UE shall disable the N1 mode capability for 3GPP access
and proceed as specified in subclause 4.9.2 with modifications described
below;. or
2) if the UE is registered over both 3GPP access and non-3GPP access and IMS
voice is available over non-3GPP access, the UE may disable the N1 mode
capability for 3GPP access and proceed as specified in subclause 4.9.2 with
modifications described below;; or
b) has a persistent PDU session, then the UE waits until the radio bearer
associated with the persistent PDU session has been released. When the radio
bearer associated with the persistent PDU session has been released , then:
1) if the UE is only registered over 3GPP access, or if the UE is registered
over both 3GPP access and non-3GPP access and IMS voice is not available over
non-3GPP access,the UE shall disable the N1 mode capability for 3GPP access
and proceed as specified in subclause 4.9.2 with modifications described
below; or
2) If the UE is registered over both 3GPP access and non-3GPP access and IMS
voice is available over non-3GPP access, the UE may disable the N1 mode
capability for 3GPP access and proceed as specified in subclause 4.9.2 with
modifications described below.
The following modifications are applied to the procedure in subclause 4.9.2
for disabling the N1 mode capability for 3GPP access, if the UE\'s usage
setting is \"voice centric\" and the UE operates in single-registration mode:
a) in item a) of subclause 4.9.2, the UE shall attempt to select an E-UTRA
cell connected to EPC. If such a cell is found, the UE shall then perform
voice domain selection procedures as defined in 3GPP TS 24.301 [15]; and
b) in item b) of subclause 4.9.2, if an E-UTRA cell connected to EPC cannot be
found, the UE shall attempt to select another supported radio access
technology which supports voice services.
When IMS voice is not available over non-3GPP access, if the UE\'s usage
setting is \"voice centric\" and the UE operates in single-registration mode,
then:
a) if the UE is only registered over non-3GPP access, the UE shall disable the
N1 mode capability for non-3GPP access (see subclause 4.9.3); or
b) if the UE is registered over both 3GPP access and non-3GPP access and IMS
voice is not available also over 3GPP access, the UE shall disable the N1 mode
capability for non-3GPP access (see subclause 4.9.3).
### 4.3.3 Change of UE\'s usage setting
If the UE operates in single-registration mode, whenever the UE\'s usage
setting changes, the UE shall execute procedures according to table 4.3.3.1:
Table 4.3.3.1: Change of UE\'s usage setting for a UE in single-registration
mode
+----------------------------------+----------------------------------+ | UE\'s usage setting change | Procedure to execute | +----------------------------------+----------------------------------+ | From \"data centric\" to \"voice | Disable the N1 mode capability | | centric\" and \"IMS voice not | for 3GPP access (see | | available\" over 3GPP access | subclause 4.9.2), if the UE is | | only | only registered over 3GPP access | +----------------------------------+----------------------------------+ | From \"data centric\" to \"voice | Disable the N1 mode capability | | centric\", and \"IMS voice not | for 3GPP access (see | | available\" over both 3GPP | subclause 4.9.2) and non-3GPP | | access and non-3GPP access | access (see subclause 4.9.3), if | | | the UE is registered over both | | | 3GPP access and non-3GPP access | | | | | | Disable the N1 mode capability | | | for 3GPP access (see subclause | | | 4.9.2), if the UE is registered | | | over 3GPP access only. | | | | | | Disable the N1 mode capability | | | for non-3GPP access (see | | | subclause 4.9.3), if the UE is | | | registered over non-3GPP access | | | only. | +----------------------------------+----------------------------------+ | From \"voice centric\" to \"data | Re-enable the N1 mode capability | | centric\" and the N1 mode | for 3GPP access (see | | capability for 3GPP access is | subclause 4.9.2) | | disabled at the UE due to \"IMS | | | voice not available\" | | +----------------------------------+----------------------------------+ | From \"data centric\" to \"voice | Disable the N1 mode capability | | centric\" and \"IMS voice not | for non-3GPP access (see | | available\" over non-3GPP access | subclause 4.9.3), if the UE is | | only | only registered over non-3GPP | | | access | +----------------------------------+----------------------------------+ | From \"voice centric\" to \"data | Re-enable the N1 mode capability | | centric\", and the N1 mode | for non-3GPP access (see | | capability for non-3GPP access | subclause 4.9.3) | | is disabled at the UE due to | | | \"IMS voice not available\" | | +----------------------------------+----------------------------------+
### 4.3.4 Change or determination of IMS voice availability
If the UE operates in single-registration mode, whenever the IMS voice
availability is determined or changes, the UE shall execute procedures
according to table 4.3.4.1:
Table 4.3.4.1: Change of IMS voice availability for a UE in single-
registration mode
+----------------------------------+----------------------------------+ | Change of IMS voice available | Procedure to execute | | condition | | +----------------------------------+----------------------------------+ | \"IMS voice not available\" over | Disable the N1 mode capability | | 3GPP access only and the UE\'s | for 3GPP access , if the UE is | | usage setting is \"voice | only registered over 3GPP | | centric\" | access(see subclause 4.9.2) | +----------------------------------+----------------------------------+ | \"IMS voice not available\" over | Disable the N1 mode capability | | non-3GPP access only and the | for non-3GPP access (see | | UE\'s usage setting is \"voice | subclause 4.9.3), if the UE is | | centric\" | only registered over non-3GPP | | | access | +----------------------------------+----------------------------------+ | \"IMS voice not available\" over | Disable the N1 mode capability | | both 3GPP access and non-3GPP | for 3GPP access (see | | access, and the UE\'s usage | subclause 4.9.2) and non-3GPP | | setting is \"voice centric\" | access (see subclause 4.9.3), if | | | the UE is registered over both | | | 3GPP access and non-3GPP access. | | | | | | Disable the N1 mode capability | | | for 3GPP access (see subclause | | | 4.9.2), if the UE is registered | | | over 3GPP access only | | | | | | Disable the N1 mode capability | | | for non-3GPP access (see | | | subclause 4.9.3), if the UE is | | | registered over non-3GPP access | | | only. | +----------------------------------+----------------------------------+
## 4.4 NAS security
### 4.4.1 General
This clause describes the principles for the handling of 5G NAS security
contexts in the UE and in the AMF and the procedures used for the security
protection of NAS messages between the UE and the AMF. Security protection
involves integrity protection and ciphering of the 5GMM messages. 5GSM
messages are security protected indirectly by being piggybacked by the
security protected 5GMM messages (i.e. UL NAS TRANSPORT message and the DL NAS
TRANSPORT message).
The signalling procedures for the control of NAS security are part of the 5GMM
protocol and are described in detail in clause 5.
NOTE: The use of ciphering in a network is an operator option. In this
subclause, for the ease of description, it is assumed that ciphering is used,
unless explicitly indicated otherwise. Operation of a network without
ciphering is achieved by configuring the AMF so that it always selects the
\"null ciphering algorithm\", 5G-EA0.
### 4.4.2 Handling of 5G NAS security contexts
#### 4.4.2.1 General
The security parameters for authentication, integrity protection and ciphering
are tied together in a 5G NAS security context and identified by a key set
identifier (ngKSI). The relationship between the security parameters is
defined in 3GPP TS 33.501 [24].
Before security can be activated, the AMF and the UE need to establish a 5G
NAS security context. Usually, the 5G NAS security context is created as the
result of a primary authentication and key agreement procedure between the AMF
and the UE. A new 5G NAS security context may also be created during an N1
mode to N1 mode handover. Alternatively, during inter-system change from S1
mode to N1 mode, the AMF not supporting interworking without N26 and the UE
operating in single-registration mode may derive a mapped 5G NAS security
context from an EPS security context that has been established while the UE
was in S1 mode.
The 5G NAS security context is taken into use by the UE and the AMF, when the
AMF initiates a security mode control procedure, during an N1 mode to N1 mode
handover, or during the inter-system change procedure from S1 mode to N1 mode.
The 5G NAS security context which has been taken into use by the network most
recently is called current 5G NAS security context. This current 5G NAS
security context can be of type native or mapped, i.e. originating from a
native 5G NAS security context or mapped 5G NAS security context.
The key set identifier ngKSI is assigned by the AMF either during the primary
authentication and key agreement procedure or, for the mapped 5G NAS security
context, during the inter-system change. The ngKSI consists of a value and a
type of security context parameter indicating whether a 5G NAS security
context is a native 5G NAS security context or a mapped 5G NAS security
context. When the 5G NAS security context is a native 5G NAS security context,
the ngKSI has the value of KSI~AMF~, and when the current 5G NAS security
context is of type mapped, the ngKSI has the value of KSI~ASME~.
The 5G NAS security context which is indicated by an ngKSI can be taken into
use to establish the secure exchange of NAS messages when a new N1 NAS
signalling connection is established without executing a new primary
authentication and key agreement procedure (see subclause 5.4.1) or when the
AMF initiates a security mode control procedure. For this purpose, the initial
NAS messages (i.e. REGISTRATION REQUEST, DEREGISTRATION REQUEST and SERVICE
REQUEST) and the SECURITY MODE COMMAND message contain an ngKSI in the NAS key
set identifier IE indicating the current 5G NAS security context used to
integrity protect the NAS message.
In the present document, when the UE is required to delete an ngKSI, the UE
shall set the ngKSI to the value \"no key is available\" and consider also the
associated keys K~AMF~ or K\'~AMF~, 5G NAS ciphering key and 5G NAS integrity
key invalid (i.e. the 5G NAS security context associated with the ngKSI as no
longer valid).
NOTE: In some specifications the term ciphering key sequence number might be
used instead of the term key set identifier (KSI).
As described in subclause 4.8 in order to interwork with E-UTRAN connected to
EPC, the UE supporting both S1 mode and N1 mode can operate in either single-
registration mode or dual-registration mode. A UE operating in dual-
registration mode shall independently maintain and use both EPS security
context (see 3GPP TS 24.301 [15]) and 5G NAS security context. When the UE
operating in dual-registration mode performs an EPS attach procedure, it shall
take into use an EPS security context and follow the handling of this security
context as specified in 3GPP TS 24.301 [15]. However, when the UE operating in
dual-registration mode performs an initial registration procedure, it shall
take into use a 5G NAS security context and follow the handling of this
security context as described in the present specification.
The UE and the AMF need to be able to maintain two 5G NAS security contexts
simultaneously, i.e. a current 5G NAS security context and a non-current 5G
NAS security context, since:
a) after a 5G re-authentication, the UE and the AMF can have both a current 5G
NAS security context and a non-current 5G NAS security context which has not
yet been taken into use (i.e. a partial native 5G NAS security context); and
b) after an inter-system change from S1 mode to N1 mode, the UE and the AMF
can have both a mapped 5G NAS security context, which is the current 5G NAS
security context, and a non-current native 5G NAS security context that was
created during a previous access in N1 mode.
The number of 5G NAS security contexts that need to be maintained
simultaneously by the UE and the AMF is limited by the following requirements:
a) after a successful 5G (re-)authentication, which creates a new partial
native 5G NAS security context, the AMF and the UE shall delete the non-
current 5G NAS security context, if any;
b) when a partial native 5G NAS security context is taken into use through a
security mode control procedure, the AMF and the UE shall delete the
previously current 5G NAS security context;
c) when the AMF and the UE create a 5G NAS security context using \"null
integrity protection algorithm\" and \"null ciphering algorithm\" during an
initial registration procedure for emergency services, or a registration
procedure for mobility and periodic registration update for a UE that has an
emergency PDU session (see subclause 5.4.2.2), the AMF and the UE shall delete
the previous current 5G NAS security context;
d) when a new mapped 5G NAS security context or 5G NAS security context
created using \"null integrity protection algorithm\" and \"null ciphering
algorithm\" is taken into use during the inter-system change from S1 mode to
N1 mode, the AMF and the UE shall not delete the previously current native 5G
NAS security context, if any. Instead, the previously current native 5G NAS
security context shall become a non-current native 5G NAS security context,
and the AMF and the UE shall delete any partial native 5G NAS security
context;
If no previously current native 5G NAS security context exists, the AMF and
the UE shall not delete the partial native 5G NAS security context, if any;
e) when the AMF and the UE derive a new mapped 5G NAS security context during
inter-system change from S1 mode to N1 mode, the AMF and the UE shall delete
any existing current mapped 5G NAS security context;
f) when a non-current full native 5G NAS security context is taken into use by
a security mode control procedure, then the AMF and the UE shall delete the
previously current mapped 5G NAS security context; and
g) when the UE or the AMF moves from 5GMM-REGISTERED to 5GMM-DEREGISTERED
state, if the current 5G NAS security context is a mapped 5G NAS security
context and a non-current full native 5G NAS security context exists, then the
non-current 5G NAS security context shall become the current 5G NAS security
context. Furthermore, the UE and the AMF shall delete any mapped 5G NAS
security context or partial native 5G NAS security context.
The UE shall mark the 5G NAS security context on the USIM or in the non-
volatile memory as invalid when the UE initiates an initial registration
procedure as described in subclause 5.5.1.2 or when the UE leaves state 5GMM-
DEREGISTERED for any other state except 5GMM-NULL.
The UE shall store the current native 5G NAS security context as specified in
annex C and mark it as valid only when the UE enters state 5GMM-DEREGISTERED
from any other state except 5GMM-NULL or when the UE aborts the initial
registration procedure without having left 5GMM-DEREGISTERED.
#### 4.4.2.2 Establishment of a mapped 5G NAS security context during inter-
system change from S1 mode to N1 mode in 5GMM-CONNECTED mode
In order for the UE operating in single-registration mode to derive a mapped
5G NAS security context for an inter-system change from S1 mode to N1 mode in
5GMM-CONNECTED mode, the AMF shall construct a mapped 5G NAS security context
from the EPS security context received from the source MME as indicated in
3GPP TS 33.501 [24]. The AMF shall select the 5G NAS security algorithms and
derive the 5G NAS keys (i.e. K~NASenc~ and K~NASint~). The AMF shall define an
ngKSI for the newly derived K\'~AMF~ key such that the value field is taken
from the eKSI of the K~ASME~ key and the type field is set to indicate a
mapped security context and associate this ngKSI with the newly created mapped
5G NAS security context. The AMF shall then include the message authentication
code, selected NAS algorithms, NCC, NAS sequence number, replayed UE security
capabilities and generated ngKSI in the S1 mode to N1 mode NAS transparent
container IE (see subclause 9.11.2.9).
When the UE operating in single-registration mode receives the command to
perform inter-system change to N1 mode in 5GMM-CONNECTED mode, the UE shall
derive a mapped K\'~AMF,~ as indicated in 3GPP TS 33.501 [24], using the
K\'~ASME~ from the EPS security context. Furthermore, the UE shall also derive
the 5G NAS keys from the mapped K\'~AMF~ using the selected NAS algorithm
identifiers included in the S1 mode to N1 mode NAS transparent container IE
and associate this mapped 5G NAS security context with the ngKSI value
received. The UE shall then verify the received NAS MAC.
When the UE operating in single-registration mode has a PDN connection for
emergency bearer services and has no current EPS security context, the AMF
shall set 5G-IA0 and 5G-EA0 as the selected 5G NAS security algorithms in the
S1 mode to N1 mode NAS transparent container IE. The AMF shall create a
locally generated K\'~AMF~. The AMF shall set the ngKSI value of the
associated security context to \"000\" and the type of security context flag
to \"mapped security context\" in the S1 mode to N1 mode NAS transparent
container IE.
When the UE operating in single-registration mode receives the command to
perform inter-system change to N1 mode in 5GMM-CONNECTED mode (see 3GPP TS
38.331 [30]) and has a PDN connection for emergency bearer services, if 5G-IA0
and 5G-EA0 as the selected 5G NAS security algorithms are included in the S1
mode to N1 mode NAS transparent container IE, the UE shall create a locally
generated K\'~AMF~. Furthermore, the UE shall set the ngKSI value of the
associated security context to the KSI value received.
After the new mapped 5G NAS security context is taken into use for the 3GPP
access following a successful inter system change from S1 mode to N1 mode in
5GMM-CONNECTED mode and the UE is registered with the same PLMN over the 3GPP
access and non-3GPP access:
a) if a native 5G NAS security context is used on the non-3GPP access and:
1) the UE is in 5GMM-IDLE mode over the non-3GPP access, then the AMF and the
UE shall activate and take into use the 5G NAS security context over the
non-3GPP access that is used on the 3GPP access as described in 3GPP TS 33.501
[24] after the AMF sends or the UE receives the REGISTRATION ACCEPT message
respectively. If the 5G NAS security context in use on both accesses is a
mapped context, the UE and AMF shall keep the native 5G NAS security context
over the non-3GPP access and make it a non-current native 5G NAS security
context. The non-current native 5G NAS security context may be re-activated
later using the security mode control procedure; or
2) the UE is in 5GMM-CONNECTED mode over the non-3GPP access, in order to
activate the native 5G NAS security context over the 3GPP access that is
active on the non-3GPP access the AMF shall send the SECURITY MODE COMMAND
message over the 3GPP access as described in 3GPP TS 33.501 [24]. The SECURITY
MODE COMMAND message shall include the same ngKSI to identify the naitive 5G
NAS security context that is used on the non-3GPP access; or
b) if a mapped 5G NAS security context is used on the non-3GPP access and:
1) the UE is in 5GMM-IDLE mode over the non-3GPP access, then the AMF and the
UE shall activate and take into use the new mapped 5G NAS security context
active on the 3GPP access over the non-3GPP access as described in 3GPP TS
33.501 [24] after the AMF sends or the UE receives the REGISTRATION ACCEPT
message respectively; or
2) the UE is in 5GMM-CONNECTED mode over the non-3GPP access, in order to
activate the same mapped 5G NAS security context over a target access that is
used on the other access the AMF shall send the SECURITY MODE COMMAND message
over one-access as described in 3GPP TS 33.501 [24]. The SECURITY MODE COMMAND
message shall include the same ngKSI to identify the mapped 5G NAS security
context that is used over the other access.
If the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode is
not completed successfully, the AMF and the UE operating in single-
registration mode shall delete the new mapped 5G NAS security context.
#### 4.4.2.3 Establishment of a 5G NAS security context during N1 mode to N1
mode handover
During an N1 mode to N1 mode handover, the target AMF may derive a new 5G NAS
security context for which the target AMF creates a new 5G NAS security
context as indicated in 3GPP TS 33.501 [24].
When a new 5G NAS security context is derived using the same K~AMF~, the
target AMF includes the 8 least significant bits of the downlink NAS COUNT in
the Intra N1 mode NAS transparent container, and indicates that a new K~AMF~
shall not be derived (see subclause 9.11.2.6). The AMF shall increment the
downlink NAS COUNT by one after creating the NAS security transparent
container.
When a new 5G NAS security context is created from a new K~AMF~, the target
AMF includes the 8 least significant bits of the downlink NAS COUNT in the
Intra N1 mode NAS transparent container and indicates that a new K~AMF~ shall
be derived (see subclause 9.11.2.6). The AMF shall then set both the uplink
and downlink NAS COUNT counters of this 5G NAS security context to zero. The
AMF shall increment the downlink NAS COUNT by one after creating the NAS
security transparent container.
The target AMF also includes the ngKSI with the same value as the ngKSI
currently being used with the UE, the message authentication code, and the
selected NAS algorithms in the Intra N1 mode NAS transparent container.
When the UE receives a command to perform handover to NG-RAN including an
Intra N1 mode NAS transparent container (see subclause 9.11.2.6), the UE
derives a new 5G NAS security context as described in 3GPP TS 33.501 [24].
When the Intra N1 mode NAS transparent container indicates that a new K~AMF~
needs to be derived, the UE shall set both the downlink NAS COUNT and uplink
NAS COUNT to zero after creating the new 5G NAS security context.
NOTE 1: During N1 mode to N1 mode handover, the Intra N1 mode NAS transparent
container (see subclause 9.11.2.6) is equivalent to sending a SECURITY MODE
COMMAND message to the UE in order to derive and use a new 5G NAS security
context, optionally created with a new K~AMF~.
After the new 5G NAS security context is taken into use for 3GPP access
following a successful N1 mode to N1 mode handover and the UE is registered
with the same PLMN over the 3GPP access and non-3GPP access:
a) the UE is in 5GMM-IDLE mode over the non-3GPP access, the AMF and the UE
shall activate and take into use the new 5G NAS security context over the
non-3GPP access as described in 3GPP TS 33.501 [24] after the AMF sends or the
UE receives the REGISTRATION ACCEPT message respectively. If the new 5G NAS
security context is created from a new K~AMF~, the AMF and the UE shall set
the downlink NAS COUNT and uplink NAS COUNT to zero also for the non-3GPP
access, otherwise the downlink NAS COUNT and uplink NAS COUNT for the non-3GPP
access are not changed; or
b) the UE is in 5GMM-CONNECTED mode over the non-3GPP access, in order to
activate the new 5G NAS security context over the non-3GPP access that has
been activated for the 3GPP access the AMF shall send the SECURITY MODE
COMMAND message over the non-3GPP access as described in 3GPP TS 33.501 [24].
The SECURITY MODE COMMAND message shall include the same ngKSI to identify the
new 5G NAS security context that was activated over the 3GPP access and shall
include the horizontal derivation parameter indicating \"K~AMF~ derivation is
not required\". Otherwise, if the new 5G NAS security context is created from
a new K~AMF~, the AMF and the UE shall set the downlink NAS COUNT and uplink
NAS COUNT to zero for the non-3GPP access.
NOTE 2: Explicit indication \"K~AMF~ derivation is not required\" for the
non-3GPP access is to align security contexts within the UE without a
subsequent derivation of a new K~AMF~ in the non-3GPP access.
#### 4.4.2.4 Establishment of an EPS security context during inter-system
change from N1 mode to S1 mode in 5GMM-CONNECTED mode
In order for the UE operating in single-registration mode to derive a mapped
EPS security context for an inter-system change from N1 mode to S1 mode in
5GMM-CONNECTED mode, the AMF shall prepare a mapped EPS security context for
the target MME as indicated in 3GPP TS 33.501 [24].
The AMF shall derive a K\'~ASME~ using the K~AMF~ key and the downlink NAS
COUNT of the current 5G NAS security context, include the corresponding NAS
sequence number in the N1 mode to S1 mode NAS transparent container (see
subclause 9.11.2.7) and then increments its stored downlink NAS COUNT value by
one. The AMF shall select the NAS algorithms identifiers to be used in the
target MME after the inter-system change from N1 mode to S1 mode in 5GMM-
CONNECTED mode, for encryption and integrity protection. The uplink and
downlink NAS COUNT associated with the newly derived K\'~ASME~ key are set to
the uplink and downlink NAS COUNT value, respectively, of the 5G NAS security
context. The eKSI for the newly derived K\'~ASME~ key shall be defined such as
the value field is taken from the ngKSI and the type field is set to indicate
a mapped security context.
When the UE operating in single-registration mode receives a command to
perform inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode
including the NAS security transparent container for handover to E-UTRAN (see
3GPP TS 24.301 [15]), the UE shall derive the mapped EPS security context,
i.e. derive K\'~ASME~ from K~AMF~ using a downlink NAS COUNT based on the NAS
sequence number received in the N1 mode to S1 mode NAS transparent container
(see subclause 9.11.2.7) as described in 3GPP TS 33.501 [24]. The UE shall set
the uplink and downlink NAS COUNT values associated with the newly derived
K\'~ASME~ key to the uplink and downlink NAS COUNT values of the current 5G
NAS security context respectively. The eKSI for the newly derived K\'~ASME~
key is defined such that the value field is taken from the ngKSI and the type
field is set to indicate a mapped security context. The UE shall also derive
the NAS keys as specified in 3GPP TS 33.401 [23A] using the EPS NAS security
algorithms identifiers that are stored in the UE\'s 5G NAS security context.
If the inter-system change from N1 mode to S1 mode in 5GMM-CONNECTED mode is
not completed successfully, the AMF and the UE shall delete the new mapped EPS
security context.
#### 4.4.2.5 Establishment of secure exchange of NAS messages
Secure exchange of NAS messages via a NAS signalling connection is usually
established by the AMF during the registration procedure by initiating a
security mode control procedure. After successful completion of the security
mode control procedure, all NAS messages exchanged between the UE and the AMF
are sent integrity protected using the current 5G security algorithms, and
except for the messages specified in subclause 4.4.5, all NAS messages
exchanged between the UE and the AMF are sent ciphered using the current 5G
security algorithms.
During inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode,
secure exchange of NAS messages is established between the AMF and the UE by:
a) the transmission of NAS security related parameters encapsulated in the AS
signalling from the AMF to the UE triggering the inter-system change in 5GMM-
CONNECTED mode (see 3GPP TS 33.501 [24]). The UE uses these parameters to
generate the mapped 5G NAS security context (see subclause 8.6.2 of 3GPP TS
33.501 [24]); and
b) after the inter-system change in 5GMM-CONNECTED mode, the transmission of a
REGISTRATION REQUEST message from the UE to the AMF. The UE shall send this
message integrity protected using the mapped 5G NAS security context and
further protect this message as specified in subclause 4.4.6 and subclause
5.5.1.3.2. From this time onward, all NAS messages exchanged between the UE
and the AMF are sent integrity protected using the mapped 5G NAS security
context, and except for the messages specified in subclause 4.4.5, all NAS
messages exchanged between the UE and the AMF are sent ciphered using the
mapped 5G NAS security context.
During inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, if the
UE is operating in single-registration mode and:
a) if the UE has a valid native 5G NAS security context, the UE shall transmit
a REGISTRATION REQUEST message integrity protected with the native 5G NAS
security context. The UE shall include the ngKSI indicating the native 5G NAS
security context value in the REGISTRATION REQUEST message.
After receiving the REGISTRATION REQUEST message including the ngKSI
indicating a native 5G NAS security context value, the AMF shall check whether
the ngKSI included in the REGISTRATION REQUEST message belongs to a 5G NAS
security context available in the AMF, and shall verify the MAC of the
REGISTRATION REQUEST message. If the verification is successful, the AMF
deletes the EPS security context received from the source MME if any, and the
AMF re-establishes the secure exchange of NAS messages by either:
1) replying with a REGISTRATION ACCEPT message that is integrity protected and
ciphered using the native 5G NAS security context. From this time onward, all
NAS messages exchanged between the UE and the AMF are sent integrity protected
and except for the messages specified in subclause 4.4.5, all NAS messages
exchanged between the UE and the AMF are sent ciphered; or
2) initiating a security mode control procedure. This can be used by the AMF
to take a non-current 5G NAS security context into use or to modify the
current 5G NAS security context by selecting new NAS security algorithms.
b) if the UE has no valid native 5G NAS security context, the UE shall send
the REGISTRATION REQUEST message without integrity protection and encryption.
After receiving the REGISTRATION REQUEST message without integrity protection
and encryption:
1) if N26 interface is supported:
i) if an EPS security context received from the source MME does not include
the NAS security algorithms set to EIA0 and EEA0, the AMF shall either create
a fresh mapped 5G NAS security context (see subclause 8.6.2 of 3GPP TS 33.501
[24]) or trigger a primary authentication and key agreement procedure to
create a fresh native 5G NAS security context; or
ii) if an EPS security context received from the source MME includes the NAS
security algorithms set to EIA0 and EEA0, the AMF shall trigger a primary
authentication and key agreement procedure to create a fresh native 5G NAS
security context; or
2) if N26 interface is not supported, the AMF shall trigger a primary
authentication and key agreement procedure.
The newly created 5G NAS security context is taken into use by initiating a
security mode control procedure and this context becomes the current 5G NAS
security context in both the UE and the AMF. This re-establishes the secure
exchange of NAS messages.
During an N1 mode to N1 mode handover, secure exchange of NAS messages is
established between the AMF and the UE by:
\- the transmission of NAS security related parameters encapsulated in the AS
signalling from the target AMF to the UE triggering the N1 mode to N1 mode
handover (see 3GPP TS 33.501 [24]). The UE uses these parameters to create a
new 5G NAS security context.
The secure exchange of NAS messages shall be continued after N1 mode to N1
mode handover. It is terminated after inter-system change from N1 mode to S1
mode in 5GMM-CONNECTED mode or when the NAS signalling connection is released.
When a UE in 5GMM-IDLE mode establishes a new NAS signalling connection and
has a valid current 5G NAS security context, the UE shall transmit the initial
NAS message integrity protected with the current 5G NAS security context and
further protect this message as specified in subclause 4.4.6. The UE shall
include the ngKSI indicating the current 5G NAS security context value in the
initial NAS message. The AMF shall check whether the ngKSI included in the
initial NAS message belongs to a 5G NAS security context available in the AMF,
and shall verify the MAC of the NAS message. If the verification is
successful, the AMF may re-establish the secure exchange of NAS messages:
a) by replying with a NAS message that is integrity protected and ciphered
using the current 5G NAS security context. From this time onward, all NAS
messages exchanged between the UE and the AMF are sent integrity protected and
except for the messages specified in subclause 4.4.5, all NAS messages
exchanged between the UE and the AMF are sent ciphered; or
b) by initiating a security mode control procedure. This can be used by the
AMF to take a non-current 5G NAS security context into use or to modify the
current 5G NAS security context by selecting new NAS security algorithms.
#### 4.4.2.6 Change of security keys
When the AMF initiates a re-authentication to create a new 5G NAS security
context, the messages exchanged during the authentication procedure are
integrity protected and ciphered using the current 5G NAS security context, if
any.
Both UE and AMF shall continue to use the current 5G NAS security context,
until the AMF initiates a security mode control procedure. The SECURITY MODE
COMMAND message sent by the AMF includes the ngKSI of the new 5G NAS security
context to be used. The AMF shall send the SECURITY MODE COMMAND message
integrity protected with the new 5G NAS security context, but unciphered. When
the UE responds with a SECURITY MODE COMPLETE message, it shall send the
message integrity protected and ciphered with the new 5G NAS security context.
The AMF can also modify the current 5G NAS security context or take the non-
current native 5G NAS security context, if any, into use, by sending a
SECURITY MODE COMMAND message including the ngKSI of the 5G NAS security
context to be modified and including a new set of selected NAS security
algorithms. In this case the AMF shall send the SECURITY MODE COMMAND message
integrity protected with the modified 5G NAS security context, but unciphered.
When the UE replies with a SECURITY MODE COMPLETE message, it shall send the
message integrity protected and ciphered with the modified 5G NAS security
context.
### 4.4.3 Handling of NAS COUNT and NAS sequence number
#### 4.4.3.1 General
Each 5G NAS security context shall be associated with two separate counters
NAS COUNT per access type in the same PLMN: one related to uplink NAS messages
and one related to downlink NAS messages. If the 5G NAS security context is
used for access via both 3GPP and non-3GPP access in the same PLMN, there are
two NAS COUNT counter pairs associated with the 5G NAS security context. The
NAS COUNT counters use 24 bit internal representation and are independently
maintained by UE and AMF. The NAS COUNT shall be constructed as a NAS sequence
number (8 least significant bits) concatenated with a NAS overflow counter (16
most significant bits).
When NAS COUNT is input to NAS ciphering or NAS integrity algorithms it shall
be considered to be a 32-bit entity which shall be constructed by padding the
24-bit internal representation with 8 zeros in the most significant bits.
The value of the uplink NAS COUNT that is stored or read out of the USIM or
non-volatile memory as described in annex C, is the value that shall be used
in the next NAS message.
The value of the downlink NAS COUNT that is stored or read out of the USIM or
non-volatile memory as described in annex C, is the largest downlink NAS COUNT
used in a successfully integrity checked NAS message.
The NAS sequence number part of the NAS COUNT shall be exchanged between the
UE and the AMF as part of the NAS signalling. After each new or retransmitted
outbound SECURITY PROTECTED 5GS NAS MESSAGE message, the sender shall increase
the NAS COUNT number by one, except for the initial NAS messages if the lower
layers indicated the failure to establish the RRC connection (see 3GPP TS
38.331 [30]). Specifically, on the sender side, the NAS sequence number shall
be increased by one, and if the result is zero (due to wrap around), the NAS
overflow counter shall also be incremented by one (see subclause 4.4.3.5). The
receiving side shall estimate the NAS COUNT used by the sending side.
Specifically, if the estimated NAS sequence number wraps around, the NAS
overflow counter shall be incremented by one.
During the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED mode,
when a mapped 5G NAS security context is derived and taken into use, the AMF
shall set both the uplink and downlink NAS COUNT counters of this 5G NAS
security context to zero. The UE shall set both the uplink and downlink NAS
COUNT counters to zero.
During inter-system change to N1 mode in 5GMM-CONNECTED mode, the AMF shall
increment downlink NAS COUNT by one after it has created a NAS transparent
container (see subclause 9.11.2.7).
During handover from NG-RAN to E-UTRAN, the AMF shall increment downlink NAS
COUNT by one after it has created an N1 mode to S1 mode NAS transparent
container (see subclause 9.11.2.7).
During N1 mode to N1 mode handover, if a new 5G NAS security context is
created, the AMF signals the 8 least significant bits of the current downlink
NAS COUNT value in an Intra N1 mode NAS transparent container (see subclause
9.11.2.6). The AMF increments downlink NAS COUNT by one after it has created
the NAS security transparent container.
If the 5G NAS security context is created with a new K~AMF~, the AMF signals
the 8 least significant bits of the current downlink NAS COUNT value in an
Intra N1 mode NAS transparent container (see subclause 9.11.2.6) and shall
then set both the uplink and downlink NAS COUNT counters of this 5G NAS
security context to zero. The AMF shall then increment the downlink NAS COUNT
by one. The UE shall also set both the uplink and downlink NAS COUNT counters
to zero.
NOTE: During the inter-system change from S1 mode to N1 mode in 5GMM-CONNECTED
mode, the NAS transparent container (see subclause 9.11.2.7) is treated as an
implicit SECURITY MODE COMMAND message for the UE and the AMF, and therefore
the AMF regards the sending of the NAS transparent container as the sending of
an initial SECURITY MODE COMMAND message in order to derive and take into use
a mapped 5G NAS security context for the purpose of the NAS COUNT handling.
#### 4.4.3.2 Replay protection
Replay protection shall be supported for received NAS messages both in the AMF
and the UE. However, since the realization of replay protection does not
affect the interoperability between nodes, no specific mechanism is required
for implementation.
Replay protection assures that one and the same NAS message is not accepted
twice by the receiver. Specifically, for a given 5G NAS security context, a
given NAS COUNT value shall be accepted at most one time and only if message
integrity verifies correctly.
Replay protection is not applicable when 5G-IA0 is used.
#### 4.4.3.3 Integrity protection and verification
The sender shall use its locally stored NAS COUNT as input to the integrity
protection algorithm.
The receiver shall use the NAS sequence number included in the received
message and an estimate for the NAS overflow counter as defined in subclause
4.4.3.1 to form the NAS COUNT input to the integrity verification algorithm.
The algorithm to calculate the integrity protection information is specified
in 3GPP TS 33.501 [24], and the integrity protection shall include octet 7 to
n of the SECURITY PROTECTED 5GS NAS MESSAGE message, i.e. the Sequence number
IE and the NAS message IE. In addition to the data that is to be integrity
protected, the BEARER ID, DIRECTION bit, NAS COUNT and 5G NAS are input to the
integrity protection algorithm. These parameters are described in 3GPP TS
33.501 [24].
After successful integrity protection validation, the receiver shall update
its corresponding locally stored NAS COUNT with the value of the estimated NAS
COUNT for this NAS message.
Integrity verification is not applicable when 5G-IA0 is used.
#### 4.4.3.4 Ciphering and deciphering
The sender shall use its locally stored NAS COUNT as input to the ciphering
algorithm.
The receiver shall use the NAS sequence number included in the received
message and an estimate for the NAS overflow counter as defined in subclause
4.4.3.1 to form the NAS COUNT input to the deciphering algorithm.
The input parameters to the NAS ciphering algorithm are the BEARER ID,
DIRECTION bit, NAS COUNT, NAS encryption key and the length of the key stream
to be generated by the encryption algorithm.
#### 4.4.3.5 NAS COUNT wrap around
If, when increasing the NAS COUNT as specified above, the AMF detects that
either its downlink NAS COUNT or the UE\'s uplink NAS COUNT is \"close\" to
wrap around, (close to 2^24^), the AMF shall take the following actions:
\- If there is no non-current native 5G NAS security context with sufficiently
low NAS COUNT values, the AMF shall initiate a new primary authentication and
key agreement procedure with the UE, leading to a new established 5G NAS
security context and the NAS COUNT being reset to 0 in both the UE and the AMF
when the new 5G NAS security context is activated;
\- Otherwise, the AMF can activate a non-current native 5G NAS security
context with sufficiently low NAS COUNT values or initiate a new primary
authentication and key agreement procedure as specified above.
If for some reason a new K~AMF~ has not been established using primary
authentication and key agreement procedure before the NAS COUNT wraps around,
the node (AMF or UE) in need of sending a NAS message shall instead release
the NAS signalling connection. Prior to sending the next uplink NAS message,
the UE shall delete the ngKSI indicating the current 5G NAS security context.
When the 5G-IA0 is used as the NAS integrity algorithm, the UE and the AMF
shall allow NAS COUNT wrap around. If NAS COUNT wrap around occurs, the
following requirements apply:
a) the UE and the AMF shall continue to use the current 5G NAS security
context;
b) the AMF shall not initiate the primary authentication and key agreement
procedure;
c) the AMF shall not release the NAS signalling connection; and
d) the UE shall not perform a local release of the NAS signalling connection.
### 4.4.4 Integrity protection of NAS signalling messages
#### 4.4.4.1 General
For the UE, integrity protected signalling is mandatory for the 5GMM NAS
messages once a valid 5G NAS security context exists and has been taken into
use. For the network, integrity protected signalling is mandatory for the 5GMM
NAS messages once a secure exchange of 5GS NAS messages has been established
for the NAS signalling connection. Integrity protection of all NAS signalling
messages is the responsibility of the NAS. It is the network which activates
integrity protection.
The use of \"null integrity protection algorithm\" 5G-IA0 (see subclause
9.11.3.32) in the current 5G NAS security context is only allowed for an
unauthenticated UE for which establishment of emergency services is allowed.
For setting the security header type in outbound NAS messages, the UE and the
AMF shall apply the same rules irrespective of whether the \"null integrity
protection algorithm\" or any other integrity protection algorithm is
indicated in the 5G NAS security context.
If the \"null integrity protection algorithm\"5G-IA0 has been selected as an
integrity protection algorithm, the receiver shall regard the NAS messages
with the security header indicating integrity protection as integrity
protected.
Details of the integrity protection and verification of NAS signalling
messages are specified in 3GPP TS 33.501 [24].
When a NAS message needs to be sent both ciphered and integrity protected, the
NAS message is first ciphered and then the ciphered NAS message and the NAS
sequence number are integrity protected by calculating the MAC.
NOTE: NAS messages that are ciphered with the \"null ciphering algorithm\"
5G-EA0 are regarded as ciphered (see subclause 4.4.5).
When a NAS message needs to be sent only integrity protected and unciphered,
the unciphered NAS message and the NAS sequence number are integrity protected
by calculating the MAC.
When a 5GSM message is piggybacked in a 5GMM message, there is only one
Sequence number IE and one Message authentication code IE for the 5GMM message
piggybacking the 5GSM message.
#### 4.4.4.2 Integrity checking of NAS signalling messages in the UE
Except the messages listed below, no NAS signalling messages shall be
processed by the receiving 5GMM entity in the UE or forwarded to the 5GSM
entity, unless the network has established secure exchange of 5GS NAS messages
for the NAS signalling connection:
a) IDENTITY REQUEST (if requested identification parameter is SUCI);
b) AUTHENTICATION REQUEST;
c) AUTHENTICATION RESULT;
d) AUTHENTICATION REJECT;
e) REGISTRATION REJECT;
f) DEREGISTRATION ACCEPT (for non switch off); and
g) SERVICE REJECT.
NOTE: These messages are accepted by the UE without integrity protection, as
in certain situations they are sent by the network before security can be
activated.
Integrity protection is never applied directly to 5GSM messages, but to the
5GMM message in which the 5GSM message is included.
The network can provide the SOR transparent container IE during the
registration procedure to the UE in the REGISTRATION ACCEPT message. The SOR
transparent container IE is integrity protected by the HPLMN as specified in
3GPP TS 33.501 [24].
Once the secure exchange of NAS messages has been established, the receiving
5GMM entity in the UE shall not process any NAS signalling messages unless
they have been successfully integrity checked by the NAS. If NAS signalling
messages, having not successfully passed the integrity check, are received,
then the NAS in the UE shall discard that message. The processing of the
SECURITY MODE COMMAND message that has not successfully passed the integrity
check is specified in subclause 5.4.2.5. If any NAS signalling message is
received as not integrity protected even though the secure exchange of NAS
messages has been established by the network, then the NAS shall discard this
message.
#### 4.4.4.3 Integrity checking of NAS signalling messages in the AMF
Except the messages listed below, no NAS signalling messages shall be
processed by the receiving 5GMM entity in the AMF or forwarded to the 5GSM
entity, unless the secure exchange of NAS messages has been established for
the NAS signalling connection:
a) REGISTRATION REQUEST;
b) IDENTITY RESPONSE (if requested identification parameter is SUCI);
c) AUTHENTICATION RESPONSE;
d) AUTHENTICATION FAILURE;
e) SECURITY MODE REJECT;
f) DEREGISTRATION REQUEST; and
g) DEREGISTRATION ACCEPT;
NOTE 1: The REGISTRATION REQUEST message is sent by the UE without integrity
protection, if the registration procedure is initiated due to an inter-system
change in 5GMM-IDLE mode and no current 5G NAS security context is available
in the UE. The other messages are accepted by the AMF without integrity
protection, as in certain situations they are sent by the UE before security
can be activated.
NOTE 2: The DEREGISTRATION REQUEST message can be sent by the UE without
integrity protection, e.g. if the UE is registered for emergency services and
there is no shared 5G NAS security context available, or if due to user
interaction a registration procedure is cancelled before the secure exchange
of NAS messages has been established. For these cases the network can attempt
to use additional criteria (e.g. whether the UE is subsequently still
performing periodic registration update or still responding to paging) before
marking the UE as 5GMM-DEREGISTERED.
Integrity protection is never applied directly to 5GSM messages, but to the
5GMM message in which the 5GSM message is included.
Once a current 5G NAS security context exists, until the secure exchange of
NAS messages has been established for the NAS signalling connection, the
receiving 5GMM entity in the AMF shall process the following NAS signalling
messages, even if the MAC included in the message fails the integrity check or
cannot be verified, as the 5G NAS security context is not available in the
network:
a) REGISTRATION REQUEST;
b) IDENTITY RESPONSE (if requested identification parameter is SUCI);
c) AUTHENTICATION RESPONSE;
d) AUTHENTICATION FAILURE;
e) SECURITY MODE REJECT;
f) DEREGISTRATION REQUEST;
g) DEREGISTRATION ACCEPT; and
h) SERVICE REQUEST;
NOTE 3: These messages are processed by the AMF even when the MAC that fails
the integrity check or cannot be verified, as in certain situations they can
be sent by the UE protected with a 5G NAS security context that is no longer
available in the network.
If a REGISTRATION REQUEST message fails the integrity check and it is not a
registration request for emergency services, the AMF shall authenticate the
subscriber before processing the registration request any further.
Additionally, the AMF shall initiate a security mode control procedure, and
include the Additional 5G security information IE with the RINMR bit set to
\"Retransmission of the initial NAS message requested\" in the SECURITY MODE
COMMAND message as specified in subclause 5.4.2.2. For the case when the
registration procedure is for emergency services see subclause 5.5.1.2.3 and
subclause 5.4.1.3.5.
If a DEREGISTRATION REQUEST message fails the integrity check, the AMF shall
proceed as follows:
\- If it is not a deregistration request due to switch off, and the AMF can
initiate an authentication procedure, the AMF should authenticate the
subscriber before processing the deregistration request any further.
\- If it is a deregistration request due to switch off, or the AMF does not
initiate an authentication procedure for any other reason, the AMF may ignore
the deregistration request and remain in state 5GMM-REGISTERED.
NOTE 4: The network can attempt to use additional criteria (e.g. whether the
UE is subsequently still performing periodic registration update or still
responding to paging) before marking the UE as 5GMM-DEREGISTERED.
If a REGISTRATION REQUEST message fails the integrity check and the UE
provided EPS NAS message container IE which was successfully verified by the
source MME, the AMF may create a mapped 5G NAS security context and initiate a
security mode control procedure to take the new mapped 5G NAS security context
into use; otherwise if the UE has only a non-emergency PDU session
established, the AMF shall initiate a primary authentication and key agreement
procedure to create a new native 5G NAS security context. Additionally, the
AMF shall initiate a security mode control procedure, and include the
Additional 5G security information IE with the RINMR bit set to
\"Retransmission of the initial NAS message requested\" in the SECURITY MODE
COMMAND message as specified in subclause 5.4.2.2. For the case when the UE
has an emergency PDU session see subclause 5.5.1.3.3 and subclause 5.4.1.3.5.
If a SERVICE REQUEST message fails the integrity check and the UE has only
non-emergency PDU sessions established, the AMF shall send the SERVICE REJECT
message with 5GMM cause #9 \"UE identity cannot be derived by the network\"
and keep the 5GMM-context and 5G NAS security context unchanged. For the case
when the UE has an emergency PDU session and integrity check fails, the AMF
may skip the authentication procedure even if no 5G NAS security context is
available and proceed directly to the execution of the security mode control
procedure as specified in subclause 5.4.2. Additionally, the AMF shall include
the Additional 5G security information IE with the RINMR bit set to
\"Retransmission of the initial NAS message requested\" in the SECURITY MODE
COMMAND message as specified in subclause 5.4.2.2. After successful completion
of the service request procedure, the network shall perform a local release of
all non-emergency PDU sessions. The emergency PDU sessions shall not be
released.
Once the secure exchange of NAS messages has been established for the NAS
signalling connection, the receiving 5GMM entity in the AMF shall not process
any NAS signalling messages unless they have been successfully integrity
checked by the NAS. If any NAS signalling message, having not successfully
passed the integrity check, is received, then the NAS in the AMF shall discard
that message. If any NAS signalling message is received, as not integrity
protected even though the secure exchange of NAS messages has been
established, then the NAS shall discard this message.
### 4.4.5 Ciphering of NAS signalling messages
The use of ciphering in a network is an operator option subject to AMF
configuration. When operation of the network without ciphering is configured,
the AMF shall indicate the use of \"null ciphering algorithm\" 5G-EA0 (see
subclause 9.11.3.32) in the current 5G NAS security context for all UEs. For
setting the security header type in outbound NAS messages, the UE and the AMF
shall apply the same rules irrespective of whether the \"null ciphering
algorithm\" or any other ciphering algorithm is indicated in the 5G NAS
security context.
When the UE establishes a new N1 NAS signalling connection, it shall apply
security protection to the initial NAS message as described in subclause
4.4.6.
The UE shall start the ciphering and deciphering of NAS messages when the
secure exchange of NAS messages has been established for an N1 NAS signalling
connection. From this time onward, unless explicitly defined, the UE shall
send all NAS messages ciphered until the N1 NAS signalling connection is
released, or the UE performs inter-system change to S1 mode.
The AMF shall start ciphering and deciphering of NAS messages as described in
subclause 4.4.2.5. From this time onward, except for the SECURITY MODE COMMAND
message, the AMF shall send all NAS messages ciphered until the N1 NAS
signalling connection is released, or the UE performs inter-system change to
S1 mode.
Ciphering is never applied directly to 5GSM messages, but to the 5GMM message
in which the 5GSM message is included.
Once the encryption of NAS messages has been started between the AMF and the
UE, the receiver shall discard the unciphered NAS messages which shall have
been ciphered according to the rules described in this specification.
If the \"null ciphering algorithm\" 5G-EA0 has been selected as a ciphering
algorithm, the NAS messages with the security header indicating ciphering are
regarded as ciphered.
Details of ciphering and deciphering of NAS signalling messages are specified
in 3GPP TS 33.501 [24].
### 4.4.6 Protection of initial NAS signalling messages
The 5GS supports protection of initial NAS messages as specified in 3GPP TS
33.501 [24]. The protection of initial NAS messages applies to the
REGISTRATION REQUEST and SERVICE REQUEST message, and is achieved as follows:
a) If the UE does not have a valid 5G NAS security context, the UE sends a
REGISTRATION REQUEST message including cleartext IEs only. After activating a
5G NAS security context resulting from a security mode control procedure:
1) if the UE needs to send non-cleartext IEs, the UE shall include the entire
REGISTRATION REQUEST message (i.e. containing both cleartext IEs and non-
cleartext IEs) in the NAS message container IE and shall include the NAS
message container IE in the SECURITY MODE COMPLETE message; or
2) if the UE does not need to send non-cleartext IEs, the UE shall include the
entire REGISTRATION REQUEST message (i.e. containing cleartext IEs only) in
the NAS message container IE and shall include the NAS message container IE in
the SECURITY MODE COMPLETE message.
b) If the UE has a valid 5G NAS security context and:
1) the UE needs to send non-cleartext IEs in a REGISTRATION REQUEST or SERVICE
REQUEST message, the UE includes the entire REGISTRATION REQUEST or SERVICE
REQUEST message (i.e. containing both cleartext IEs and non-cleartext IEs) in
the NAS message container IE and shall cipher the value part of the NAS
message container IE. The UE shall then send a REGISTRATION REQUEST or SERVICE
REQUEST message containing the cleartext IEs and the NAS message container IE;
or
2) the UE does not need to send non-cleartext IEs in a REGISTRATION REQUEST or
SERVICE REQUEST message, the UE sends the REGISTRATION REQUEST or SERVICE
REQUEST message without including the NAS message container IE.
When the initial NAS message is a REGISTRATION REQUEST message, the cleartext
IEs are:
\- Extended protocol discriminator;
\- Security header type;
\- Spare half octet;
\- Registration request message identity;
\- 5GS registration type;
\- ngKSI;
\- 5GS mobile identity;
\- UE security capability;
\- Additional GUTI;
\- UE status; and
\- EPS NAS message container.
When the initial NAS message is a SERVICE REQUEST message, the cleartext IEs
are:
\- Extended protocol discriminator;
\- Security header type;
\- Spare half octet;
\- ngKSI;
\- Service request message identity;
\- Service type; and
\- 5G-S-TMSI.
When the UE sends a REGISTRATION REQUEST or SERVICE REQUEST message that
includes a NAS message container IE, the UE shall set the security header type
of the initial NAS message to \"integrity protected\".
If the UE does not need to send non-cleartext IEs in the initial NAS message,
the UE shall send the initial NAS message i.e. REGISTRATION REQUEST or SERVICE
REQUEST message with cleartext IEs only i.e. without including the NAS message
container IE in the initial NAS message.
When the AMF receives an integrity protected initial NAS message which
includes a NAS message container IE, the AMF shall decipher the value part of
the NAS message container IE. The AMF shall consider the NAS message that is
obtained from the NAS message container IE as the initial NAS message that
triggered the procedure.
When the initial NAS message is a DEREGISTRATION REQUEST message, the UE
always sends the NAS message unciphered.
## 4.5 Unified access control
### 4.5.1 General
When the UE needs to access the 5GS, the UE first performs access control
checks to determine if the access is allowed. Access control checks shall be
perfomed for the access attempts defined by the following list of events:
a) the UE is in 5GMM-IDLE mode over 3GPP access and an event that requires a
transition to 5GMM-CONNECTED mode occurs; and
b) the UE is in 5GMM-CONNECTED mode over 3GPP access or 5GMM-CONNECTED mode
with RRC inactive indication and one of the following events occurs:
1) 5GMM receives an MO-MMTEL-voice-call-started indication, an MO-MMTEL-video-
call-started indication or an MO-SMSoIP-attempt-started indication from upper
layers;
2) 5GMM receives a request from upper layers to send a mobile originated SMS
over NAS unless the request triggered a service request procedure to
transition the UE from 5GMM-IDLE mode to 5GMM-CONNECTED mode;
3) 5GMM receives a request from upper layers to send an UL NAS TRANSPORT
message for the purpose of PDU session establishment unless the request
triggered a service request procedure to transition the UE from 5GMM-IDLE mode
to 5GMM-CONNECTED mode;
4) 5GMM receives a request from upper layers to send an UL NAS TRANSPORT
message for the purpose of PDU session modification unless the request
triggered a service request procedure to transition the UE from 5GMM-IDLE mode
to 5GMM-CONNECTED mode;
5) 5GMM receives a request to re-establish the user-plane resources for an
existing PDU session; and
6) 5GMM is notified that an uplink user data packet is to be sent for a PDU
session with suspended user-plane resources.
NOTE 1: 5GMM specific procedures initiated by NAS in 5GMM-CONNECTED mode are
not subject to access control, e.g. a registration procedure after PS handover
will not be prevented by access control (see subclause 5.5).
NOTE 2: In this version of the protocol, initiating a mobile originating
location request by sending an UL NAS TRANSPORT message (see subclause
5.4.5.2.1) is not supported, and therefore access control for this case has
not been specified. All LPP messages transported in the UL NAS TRANSPORT
message are sent in response to a mobile terminating or network induced
location request, and the corresponding access attempts are handled as MT
access.
NOTE 3: Initiating a mobile originated signalling transaction towards the PCF
by sending an UL NAS TRANSPORT message including a UE policy container (see
subclause 5.4.5.2.1) is not supported (see subclause D.2.2). Furthermore,
initiating a mobile originated signalling transaction towards the UDM by
sending an UL NAS TRANSPORT message including an SOR transparent container is
not supported. Therefore, access control for these cases has not been
specified.
When the NAS detects one of the above events, the NAS needs to perform the
mapping of the kind of request to one or more access identities and one access
category and lower layers will perform access barring checks for that request
based on the determined access identities and access category.
NOTE 4: The NAS is aware of the above events through indications provided by
upper layers or when determing the need to start 5GMM procedures through
normal NAS behaviour, or both.
To determine the access identities and the access category for a request, the
NAS checks the reason for access, types of service requested and profile of
the UE including UE configurations, against a set of access identities and
access categories defined in 3GPP TS 22.261 [3], namely:
a) a set of standardized access identities;
b) a set of standardized access categories; and
c) a set of operator-defined access categories, if available.
For the purpose of determining the applicable access identities from the set
of standardized access identities defined in 3GPP TS 22.261 [3], the NAS shall
follow the requirements set out in subclause 4.5.2 and the rules and actions
defined in table 4.5.2.1.
In order to enable access barring checks for access attempts identified by
lower layers in 5GMM-CONNECTED mode with RRC inactive indication, the UE
provides the applicable access identities to lower layers.
NOTE 5: When and how the NAS provides the applicable access identities to
lower layers is UE implementation specific.
For the purpose of determining the applicable access category from the set of
standardized access categories and operator-defined access categories defined
in 3GPP TS 22.261 [3], the NAS shall follow the requirements set out in
subclause 4.5.2 and the rules and actions defined in table 4.5.2.2.
### 4.5.2 Determination of the access identities and access category
associated with a request for access
When the UE needs to initiate an access attempt in one of the events listed in
subclause 4.5.1, the UE shall determine one or more access identities from the
set of standardized access identities, and one access category from the set of
standardized access categories and operator-defined access categories, to be
associated with that access attempt.
The set of the access identities applicable for the request is determined by
the UE in the following way:
a) for each of the access identities 1, 2, 11, 12, 13, 14 and 15 in table
4.5.2.1, the UE shall check whether the access identity is applicable in the
selected PLMN, if a new PLMN is selected, or otherwise if it is applicable in
the RPLMN or equivalent PLMN; and
b) if none of the above access identities is applicable, then access identity
0 is applicable.
Table 4.5.2.1: Access identities
+----------------------------------+----------------------------------+ | Access Identity number | UE configuration | +==================================+==================================+ | 0 | UE is not configured with any | | | parameters from this table | +----------------------------------+----------------------------------+ | 1 (NOTE 1) | UE is configured for multimedia | | | priority service (MPS). | +----------------------------------+----------------------------------+ | 2 (NOTE 2) | UE is configured for mission | | | critical service (MCS). | +----------------------------------+----------------------------------+ | 3-10 | Reserved for future use | +----------------------------------+----------------------------------+ | 11 (NOTE 3) | Access Class 11 is configured in | | | the UE. | +----------------------------------+----------------------------------+ | 12 (NOTE 3) | Access Class 12 is configured in | | | the UE. | +----------------------------------+----------------------------------+ | 13 (NOTE 3) | Access Class 13 is configured in | | | the UE. | +----------------------------------+----------------------------------+ | 14 (NOTE 3) | Access Class 14 is configured in | | | the UE. | +----------------------------------+----------------------------------+ | 15 (NOTE 3) | Access Class 15 is configured in | | | the UE. | +----------------------------------+----------------------------------+ | NOTE 1: Access identity 1 is | | | valid when:\ | | | - the USIM file EFUAC_AIC | | | indicates the UE is configured | | | for access identity 1 and the | | | RPLMN is the HPLMN (if the | | | EHPLMN list is not present or is | | | empty) or EHPLMN (if the EHPLMN | | | list is present), or a visited | | | PLMN of the home country (see | | | the definition of home country | | | in 3GPP TS 24.301 [15]); or\ | | | - the UE receives the 5GS | | | network feature support IE with | | | the MPS indicator bit set to | | | \"Access identity 1 valid in | | | RPLMN or equivalent PLMN\" from | | | the RPLMN as described in | | | subclause 5.5.1.2.4 and | | | subclause 5.5.1.3.4. | | | | | | NOTE 2: Access identity 2 is | | | used by UEs configured for MCS | | | and is valid when:\ | | | - the USIM file EFUAC_AIC | | | indicates the UE is configured | | | for access identity 2 and the | | | RPLMN is the HPLMN (if the | | | EHPLMN list is not present or is | | | empty) or EHPLMN (if the EHPLMN | | | list is present), or a visited | | | PLMN of the home country (see | | | 3GPP TS 23.122 [5]); or\ | | | - the UE receives the 5GS | | | network feature support IE with | | | the MCS indicator bit set to | | | \"Access identity 2 valid in | | | RPLMN or equivalent PLMN\" from | | | the RPLMN as described in | | | subclause 5.5.1.2.4 and | | | subclause 5.5.1.3.4. | | | | | | NOTE 3: Access identities 11 and | | | 15 are valid in HPLMN (if the | | | EHPLMN list is not present or is | | | empty) or EHPLMN (if the EHPLMN | | | list is present). Access | | | Identities 12, 13 and 14 are | | | valid in HPLMN and visited PLMNs | | | of home country only (see the | | | definition of home country in | | | 3GPP TS 24.301 [15]). | | +----------------------------------+----------------------------------+
The UE uses the MPS indicator bit of the 5GS network feature support IE to
determine if access identity 1 is valid. Processing of the MPS indicator bit
of the 5GS network feature support IE in the REGISTRATION ACCEPT message is
described in subclause 5.5.1.2.4 and subclause 5.5.1.3.4. The UE shall not
consider access identity 1 to be valid when the UE is not in the country of
its HPLMN prior to receiving the MPS indicator bit of the 5GS network feature
support IE in the REGISTRATION ACCEPT message being set to \"Access identity 1
valid in RPLMN or equivalent PLMN\".
When the UE is in the country of its HPLMN, the contents of the USIM files
EF~UAC_AIC~ and EF~ACC~ as specified in 3GPP TS 31.102 [22] and the rules
specified in table 4.5.2.1 are used to determine the applicability of access
identity 1 and access classes 11 - 15. When the UE is in the country of its
HPLMN, and the USIM file EF~UAC_AIC~ does not indicate the UE is configured
for access identity 1, the UE uses the MPS indicator bit of the 5GS network
feature support IE in the REGISTRATION ACCEPT message to determine if access
identity 1 is valid. When the UE is in the country of its HPLMN, and the USIM
file EF~UAC_AIC~ indicates the UE is configured for access identity 1, the MPS
indicator bit of the 5GS network feature support IE is not applicable. When
the UE is not in the country of its HPLMN, the contents of the USIM files
EF~UAC_AIC~ and EF~ACC~ are not applicable.
The UE uses the MCS indicator bit of the 5GS network feature support IE to
determine if access identity 2 is valid. Processing of the MCS indicator bit
of the 5GS network feature support IE in the REGISTRATION ACCEPT message is
described in subclause 5.5.1.2.4 and subclause 5.5.1.3.4. The UE shall not
consider access identity 2 to be valid when the UE is not in the country of
its HPLMN prior to receiving the MCS indicator bit of the 5GS network feature
support IE in the REGISTRATION ACCEPT message being set to \"Access identity 2
valid in RPLMN or equivalent PLMN\".
When the UE is in the country of its HPLMN, the contents of the USIM files
EF~UAC_AIC~ and EF~ACC~ as specified in 3GPP TS 31.102 [22] and the rules
specified in table 4.5.2.1 are used to determine the applicability of access
identity 2 and access classes 11 - 15. When the UE is in the country of its
HPLMN, and the USIM file EF~UAC_AIC~ does not indicate the UE is configured
for access identity 2, the UE uses the MCS indicator bit of the 5GS network
feature support IE in the REGISTRATION ACCEPT message to determine if access
identity 2 is valid. When the UE is in the country of its HPLMN, and the USIM
file EF~UAC_AIC~ indicates the UE is configured for access identity 2, the MCS
indicator bit of the 5GS network feature support IE is not applicable. When
the UE is not in the country of its HPLMN, the contents of the USIM files
EF~UAC_AIC~ and EF~ACC~ are not applicable.
In order to determine the access category applicable for the access attempt,
the NAS shall check the rules in table 4.5.2.2, and use the access category
for which there is a match for barring check. If the access attempt matches
more than one rule, the access category of the lowest rule number shall be
selected. If the access attempt matches more than one operator-defined access
category definition, the UE shall select the access category from the
operator-defined access category definition with the lowest precedence value
(see subclause 4.5.3).
NOTE: The case when an access attempt matches more than one rule includes the
case when multiple events trigger an access attempt at the same time.
Table 4.5.2.2: Mapping table for access categories
+----------------+----------------+----------------+----------------+ | Rule # | Type of access | Requirements | Access | | | attempt | to be met | Category | +----------------+----------------+----------------+----------------+ | 1 | Response to | Access attempt | 0 (= MT_acc) | | | paging or | is for MT | | | | NOTIFICATION | access | | | | over non-3GPP | | | | | access; | | | | | | | | | | 5GMM | | | | | connection | | | | | management | | | | | procedure | | | | | initiated for | | | | | the purpose of | | | | | transporting | | | | | an LPP message | | | +----------------+----------------+----------------+----------------+ | 2 | Emergency | UE is | 2 (= | | | | attempting | emergency) | | | | access for an | | | | | emergency | | | | | session | | | | | (NOTE 1, | | | | | NOTE 2) | | +----------------+----------------+----------------+----------------+ | 3 | Access attempt | UE stores | 32-63\ | | | for | op | (= based on | | | op | erator-defined | operator | | | erator-defined | access | c | | | access | category | lassification) | | | category | definitions | | | | | valid in the | | | | | current PLMN | | | | | as specified | | | | | in | | | | | su | | | | | bclause 4.5.3, | | | | | and access | | | | | attempt is | | | | | matching | | | | | criteria of an | | | | | op | | | | | erator-defined | | | | | access | | | | | category | | | | | definition | | +----------------+----------------+----------------+----------------+ | 4 | Access attempt | (a) UE is | 1 (= delay | | | for delay | configured for | tolerant) | | | tolerant | NAS signalling | | | | service | low priority | | | | | or UE | | | | | supporting S1 | | | | | mode is | | | | | configured for | | | | | EAB (see the | | | | | \"ExtendedA | | | | | ccessBarring\" | | | | | leaf of NAS | | | | | configuration | | | | | MO in | | | | | 3GPP TS | | | | | 24.368 [17] | | | | | or | | | | | 3GPP TS | | | | | 31.102 [22]) | | | | | where \"EAB | | | | | override\" | | | | | does not | | | | | apply, and | | | | | | | | | | (b). the UE | | | | | received one | | | | | of the | | | | | categories a, | | | | | b or c as part | | | | | of the | | | | | parameters for | | | | | unified access | | | | | control in the | | | | | broadcast | | | | | system | | | | | information, | | | | | and the UE is | | | | | a member of | | | | | the | | | | | broadcasted | | | | | category in | | | | | the selected | | | | | PLMN or | | | | | RP | | | | | LMN/equivalent | | | | | PLMN | | | | | | | | | | (NOTE 3, | | | | | NOTE 5, | | | | | NOTE 6, | | | | | NOTE 7, | | | | | NOTE 8) | | +----------------+----------------+----------------+----------------+ | 5 | MO MMTel voice | Access attempt | 4 (= MO MMTel | | | call | is for MO | voice) | | | | MMTel voice | | | | | call | | | | | | | | | | or for NAS | | | | | signalling | | | | | connection | | | | | recovery | | | | | during ongoing | | | | | MO MMTel voice | | | | | call (NOTE 2) | | +----------------+----------------+----------------+----------------+ | 6 | MO MMTel video | Access attempt | 5 (= MO MMTel | | | call | is for MO | video) | | | | MMTel video | | | | | call | | | | | | | | | | or for NAS | | | | | signalling | | | | | connection | | | | | recovery | | | | | during ongoing | | | | | MO MMTel video | | | | | call (NOTE 2) | | +----------------+----------------+----------------+----------------+ | 7 | MO SMS over | Access attempt | 6 (= MO SMS | | | NAS or MO | is for MO SMS | and SMSoIP) | | | SMSoIP | over NAS | | | | | (NOTE 4) or MO | | | | | SMS over | | | | | SMSoIP | | | | | transfer | | | | | | | | | | or for NAS | | | | | signalling | | | | | connection | | | | | recovery | | | | | during ongoing | | | | | MO SMS or | | | | | SMSoIP | | | | | transfer | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | 8 | UE NAS | Access attempt | 3 (= MO_sig) | | | initiated 5GMM | is for MO | | | | specific | signalling | | | | procedures | | | +----------------+----------------+----------------+----------------+ | 9 | UE NAS | Access attempt | 7 (= MO_data) | | | initiated 5GMM | is for MO data | | | | connection | | | | | management | | | | | procedure or | | | | | 5GMM NAS | | | | | transport | | | | | procedure | | | +----------------+----------------+----------------+----------------+ | 10 | An uplink user | No further | 7 (= MO_data) | | | data packet is | requirement is | | | | to be sent for | to be met | | | | a PDU session | | | | | with suspended | | | | | user-plane | | | | | resources | | | +----------------+----------------+----------------+----------------+ | NOTE 1: This | | | | | includes 5GMM | | | | | specific | | | | | procedures | | | | | while the | | | | | service is | | | | | ongoing and | | | | | 5GMM | | | | | connection | | | | | management | | | | | procedures | | | | | required to | | | | | establish a | | | | | PDU session | | | | | with request | | | | | type = | | | | | \"initial | | | | | emergency | | | | | request\" or | | | | | \"existing | | | | | emergency PDU | | | | | session\", or | | | | | to | | | | | re-establish | | | | | user-plane | | | | | resources for | | | | | such a PDU | | | | | session. This | | | | | further | | | | | includes the | | | | | service | | | | | request | | | | | procedure | | | | | initiated with | | | | | a SERVICE | | | | | REQUEST | | | | | message with | | | | | the Service | | | | | type IE set to | | | | | \"emergency | | | | | services | | | | | fallback\".\< | | | | | | | | | | NOTE 2: Access | | | | | for the | | | | | purpose of NAS | | | | | signalling | | | | | connection | | | | | recovery | | | | | during an | | | | | ongoing | | | | | service, or | | | | | for the | | | | | purpose of NAS | | | | | signalling | | | | | connection | | | | | establishment | | | | | following | | | | | fallback | | | | | indication | | | | | from lower | | | | | layers during | | | | | an ongoing | | | | | service, is | | | | | mapped to the | | | | | access | | | | | category of | | | | | the ongoing | | | | | service in | | | | | order to | | | | | derive an RRC | | | | | establishment | | | | | cause, but | | | | | barring checks | | | | | will be | | | | | skipped for | | | | | this access | | | | | attempt. | | | | | | | | | | NOTE 3: If the | | | | | UE selects a | | | | | new PLMN, then | | | | | the selected | | | | | PLMN is used | | | | | to check the | | | | | membership; | | | | | otherwise the | | | | | UE uses the | | | | | RLPMN or a | | | | | PLMN | | | | | equivalent to | | | | | the RPLMN. | | | | | | | | | | NOTE 4: This | | | | | includes the | | | | | 5GMM | | | | | connection | | | | | management | | | | | procedures | | | | | triggered by | | | | | the | | | | | UE-initiated | | | | | NAS transport | | | | | procedure for | | | | | transporting | | | | | the MO SMS. | | | | | | | | | | NOTE 5: The UE | | | | | configured for | | | | | NAS signalling | | | | | low priority | | | | | is not | | | | | supported in | | | | | this release | | | | | of | | | | | specification. | | | | | If a UE | | | | | supporting | | | | | both S1 mode | | | | | and N1 mode is | | | | | configured for | | | | | NAS signalling | | | | | low priority | | | | | in S1 mode as | | | | | specified in | | | | | 3GPP TS | | | | | 24.368 [17] | | | | | or | | | | | 3GPP TS | | | | | 31.102 [22], | | | | | the UE shall | | | | | ignore the | | | | | configuration | | | | | for NAS | | | | | signalling low | | | | | priority when | | | | | in N1 mode. | | | | | | | | | | NOTE 6: If the | | | | | access | | | | | category | | | | | applicable for | | | | | the access | | | | | attempt is 1, | | | | | then the UE | | | | | shall | | | | | additionally | | | | | determine a | | | | | second access | | | | | category from | | | | | the range 3 to | | | | | 7. If more | | | | | than one | | | | | access | | | | | category | | | | | matches, the | | | | | access | | | | | category of | | | | | the lowest | | | | | rule number | | | | | shall be | | | | | chosen. The UE | | | | | shall use the | | | | | second access | | | | | category only | | | | | to derive an | | | | | RRC | | | | | establishment | | | | | cause for the | | | | | access | | | | | attempt. | | | | | | | | | | NOTE 7: \"EAB | | | | | override\" | | | | | does not | | | | | apply, if the | | | | | UE is not | | | | | configured to | | | | | allow | | | | | overriding EAB | | | | | (see the | | | | | \"Overr | | | | | ide_ExtendedA | | | | | ccessBarring\" | | | | | leaf of NAS | | | | | configuration | | | | | MO in | | | | | 3GPP TS | | | | | 24.368 [17] | | | | | or | | | | | 3GPP TS 3 | | | | | 1.102 [22]), | | | | | or if NAS has | | | | | not received | | | | | an indication | | | | | from the upper | | | | | layers to | | | | | override EAB | | | | | and the UE | | | | | does not have | | | | | a PDU session | | | | | that was | | | | | established | | | | | with EAB | | | | | override. | | | | | | | | | | NOTE 8: For | | | | | the definition | | | | | of categories | | | | | a, b and c | | | | | associated | | | | | with access | | | | | category 1, | | | | | see | | | | | 3GPP TS | | | | | 22.261 [3]. | | | | | The categories | | | | | associated | | | | | with access | | | | | category 1 are | | | | | distinct from | | | | | the categories | | | | | a, b and c | | | | | associated | | | | | with EAB (see | | | | | 3GPP TS 2 | | | | | 2.011 [1A]). | | | | +----------------+----------------+----------------+----------------+
### 4.5.3 Operator-defined access categories
Operator-defined access category definitions can be signalled to the UE using
NAS signalling. Each operator-defined access category definition consists of
the following parameters:
a) a precedence value which indicates in which order the UE shall evaluate the
operator-defined category definition for a match;
b) an operator-defined access category number, i.e. access category number in
the 32-63 range that uniquely identifies the access category in the PLMN in
which the access categories are being sent to the UE;
c) criteria consisting of one or more access category criteria type and
associated access category criteria type values. The access category criteria
type can be set to one of the following:
1) DNN;
2) OS Id + OS App Id of application triggering the access attempt; or
3) S-NSSAI; and
NOTE 1: An access category criteria type can be associated with more than one
access category criteria values.
d) optionally, a standardized access category. This standardized access
category is used in combination with the access identities of the UE to
determine the RRC establishment cause as specified in subclause 4.5.6.
An access attempt matches the criteria of an operator-defined access category
definition, if the access attempt matches all access category criteria types
included in the criteria with any of the associated access criteria type
values.
Each operator-defined access category definition has a different precedence
value.
Several operator-defined access category definitions can have the same
operator-defined access category number.
If:
\- an access category in bullet d) is not provided;
\- an access category in bullet d) is provided and is not a standardized
access category; or
\- an access category in bullet d) is provided, is a standardized access
category and is not recognized by the UE;
the UE shall use instead:
\- access category 3 (MO_sig) if the access attempt is triggered by uplink
signalling; or
\- access category 7 (MO_data) if the access attempt is triggered by uplink
data
in combination with the access identities of the UE to determine the RRC
establishment cause as specified in subclause 4.5.6.
The operator-defined access category definitions are valid in the PLMN which
provided them and in a PLMN equivalent to the PLMN which provided them, as
specified in annex C.
If the UE stores operator-defined access category definitions valid in the
selected PLMN or the RPLMN, then access control in 5GMM-IDLE mode will only be
performed for the event a) defined in subclause 4.5.1. If the transition from
5GMM-IDLE mode over 3GPP access to 5GMM-CONNECTED mode is due to a UE NAS
initiated 5GMM specific procedure, then this access attempt shall be mapped to
one of the standardized access categories in the range \< 32, see subclause
4.5.2. I.e. for this case the UE shall skip the checking of operator-defined
access category definitions.
If the UE is stores operator-defined access category definitions valid in the
selected PLMN or the RPLMN, then access control in 5GMM-CONNECTED mode and in
5GMM-CONNECTED mode with RRC inactive indication will only be performed for
the events 1) to 6) defined in subclause 4.5.1.
The UE shall handle the operator-defined access category definitions stored
for the RPLMN as specified in subclause 5.4.4.3, subclause 5.5.1.2.4, and
subclause 5.5.1.3.4.
When the UE is switched off, the UE shall keep the operator-defined access
category definitions so that the operator-defined access category definitions
can be used after switch on.
When the UE selects a new PLMN which is not equivalent to the previously
selected PLMN, the UE shall stop using the operator-defined access category
definitions stored for the previously selected PLMN and should keep the
operator-defined access category definitions stored for the previously
selected PLMN.
NOTE 2: When the UE selects a new PLMN which is not equivalent to the
previously selected PLMN, the UE can delete the operator-defined access
category definitions stored for the previously selected PLMN e.g. if there is
no storage space in the UE.
### 4.5.4 Access control and checking
#### 4.5.4.1 Access control and checking in 5GMM-IDLE mode
When the UE is in 5GMM-IDLE mode, upon receiving a request from the upper
layers for an access attempt, the NAS shall categorize the access attempt into
access identities and an access category following subclause 4.5.2, table
4.5.2.1 and table 4.5.2.2, and subclause 4.5.3, and provide the applicable
access identities and the access category to the lower layers for the purpose
of access control checking. In this request to the lower layer the NAS can
also provide to the lower layer the RRC establishment cause determined as
specified in subclause 4.5.6 of this specification.
NOTE 1: The access barring check is performed by the lower layers.
NOTE 2: As an implementation option, the NAS can provide the RRC establishment
cause to the lower layers after being informed by the lower layers that the
access attempt is allowed.
If the UE has uplink user data pending for one or more PDU sessions when it
builds a REGISTRATION REQUEST or SERVICE REQUEST message as initial NAS
message, the UE shall indicate the respective PDU sessions in the Uplink data
status IE as specified in subclause 5.5.1.3.2 and 5.6.1.2, regardless of the
access category for which the access barring check is performed.
NOTE 3: The UE indicates pending user data for all the respective PDU
sessions, even if barring timers are running for some of the corresponding
access categories.
If the lower layers indicate that the access attempt is allowed, the NAS shall
initiate the procedure to send the initial NAS message for the access attempt.
If the lower layers indicate that the access attempt is barred, the NAS shall
not initiate the procedure to send the initial NAS message for the access
attempt. Additionally:
a) if the event which triggered the access attempt was an MO-MMTEL-voice-call-
started indication or an MO-MMTEL-video-call-started indication:
1) if the UE is operating in the single-registration mode and the UE\'s usage
setting is \"voice centric\", the UE may attempt to select an E-UTRA cell
connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, it
then proceeds with the appropriate EMM specific procedures and, if necessary,
ESM procedures to make a PDN connection providing access to IMS available; see
subclause 4.8.2 and 3GPP TS 24.301 [15];
2) if the UE is operating in the dual-registration mode, the UE may proceed in
S1 mode with the appropriate EMM specific procedures and ESM procedures to
make a PDN connection providing access to IMS available; see subclause 4.8.3
and 3GPP TS 24.301 [15];
3) otherwise, the NAS shall notify the upper layers that the access attempt is
barred. In this case, upon receiving an indication from the lower layers that
the barring is alleviated for the access category with which the access
attempt was associated, the NAS shall notify the upper layers that the barring
is alleviated for the access category and may initiate the procedure to send
the initial NAS message, if still needed; and
b) if the event which triggered the access attempt was an MO-SMSoIP-attempt-
started indication:
1) if the UE is operating in the single-registration mode, the UE may attempt
to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA
cell connected to EPC, it then proceeds with the appropriate EMM specific
procedures and, if necessary, ESM procedures to make a PDN connection
providing access to IMS available; see subclause 4.8.2 and 3GPP TS 24.301
[15];
2) if the UE is operating in the dual-registration mode, the UE may proceed in
S1 mode with the appropriate EMM specific procedures and ESM procedures to
make a PDN connection providing access to IMS available; see subclause 4.8.3
and 3GPP TS 24.301 [15];
3) otherwise, the NAS layer shall notify the upper layers that the access
attempt is barred. In this case, upon receiving an indication from the lower
layers that the barring is alleviated for the access category with which the
access attempt was associated, the NAS shall notify the upper layers that the
barring is alleviated for the access category and may initiate the procedure
to send the initial NAS message, if still needed.
NOTE 4: Barring timers, on a per access category basis, are run by the lower
layers. At expiry of barring timers, the indication of alleviation of access
barring is indicated to the NAS on a per access category basis.
#### 4.5.4.2 Access control and checking in 5GMM-CONNECTED mode and in 5GMM-
CONNECTED mode with RRC inactive indication
When the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC inactive
indication, upon detecting one of events 1) through 6) listed in subclause
4.5.1, the NAS shall categorize the corresponding access attempt into access
identities and an access category following subclause 4.5.2, table 4.5.2.1 and
table 4.5.2.2, and subclause 4.5.2.3, and provide the access identities and
the access category to the lower layers for the purpose of access control
checking. In this request to the lower layer the NAS can also provide to the
lower layer the RRC establishment cause determined as specified in subclause
4.5.6 of this specification.
NOTE 1: As an implementation option, the NAS can provide the RRC establishment
cause to the lower layers after being informed by the lower layers that the
access attempt is allowed.
If the UE has uplink user data pending for one or more PDU sessions when it
builds a REGISTRATION REQUEST or SERVICE REQUEST message for the access
attempt, the UE shall indicate the respective PDU sessions in the Uplink data
status IE as specified in subclause 5.5.1.3.2 and 5.6.1.2, regardless of the
access category for which the access barring check is performed.
NOTE 2: The UE indicates pending user data for all the respective PDU
sessions, even if barring timers are running for some of the corresponding
access categories.
If the lower layers indicate that the access attempt is allowed, the NAS shall
take the following action depending on the event which triggered the access
attempt:
a) if the event which triggered the access attempt was an MO-MMTEL-voice-call-
started indication, an MO-MMTEL-video-call-started indication or an MO-SMSoIP-
attempt-started indication, the NAS shall notify the upper layers that the
access attempt is allowed;
b) if the event which triggered the access attempt was a request from upper
layers to send a mobile originated SMS over NAS, 5GMM shall initiate the NAS
transport procedure as specified in subclause 5.4.5 to send the SMS in an UL
NAS TRANSPORT message;
c) if the event which triggered the access attempt was a request from upper
layers to establish a new PDU session, 5GMM shall initiate the NAS transport
procedure as specified in subclause 5.4.5 to send the PDU SESSION
ESTABLISHMENT REQUEST message;
d) if the event which triggered the access attempt was a request from upper
layers to modify an existing PDU session, 5GMM shall initiate the NAS
transport procedure as specified in subclause 5.4.5 to send the PDU SESSION
MODIFICATION REQUEST message;
e) if the event which triggered the access attempt was a request to re-
establish the user-plane resources for an existing PDU session, 5GMM shall
initiate the service request procedure as specified in subclause 5.6.1; and
f) if the event which triggered the access attempt was an uplink user data
packet to be sent for a PDU session with suspended user-plane resources, 5GMM
shall consider that the uplink user data packet is allowed to be sent.
If the lower layers indicate that the access attempt is barred, the NAS shall
take the following action depending on the event which triggered the access
attempt:
a) if the event which triggered the access attempt was an MO-MMTEL-voice-call-
started indication, an MO-MMTEL-video-call-started indication or an MO-SMSoIP-
attempt-started indication:
1) if the UE is operating in the dual-registration mode, the UE may proceed in
S1 mode with the appropriate EMM specific procedures and ESM procedures to
make a PDN connection providing access to IMS available; see subclause 4.8.3
and 3GPP TS 24.301 [15];
2) otherwise, the NAS shall notify the upper layers that the access attempt is
barred. In this case, upon receiving an indication from the lower layers that
the barring is alleviated for the access category with which the access
attempt was associated, the NAS shall notify the upper layers that the barring
is alleviated for the access category;
NOTE 3: In this case prohibiting the initiation of the MMTEL voice session,
MMTEL video session or prohibiting sending of the SMS over IP is performed by
the upper layers.
b) if the event which triggered the access attempt was a request from upper
layers to send a mobile originated SMS over NAS, 5GMM shall not initiate the
NAS transport procedure as specified in subclause 5.4.5 to send the SMS in an
UL NAS TRANSPORT message. Upon receiving an indication from the lower layers
that the barring is alleviated for the access category with which the access
attempt was associated, 5GMM may initiate the NAS transport procedure as
specified in subclause 5.4.5 to send the SMS in an UL NAS TRANSPORT message,
if still needed;
c) if the event which triggered the access attempt was a request from upper
layers to establish a new PDU session, 5GMM shall not initiate the NAS
transport procedure to send the PDU SESSION ESTABLISHMENT REQUEST message.
Upon receiving an indication from the lower layers that the barring is
alleviated for the access category with which the access attempt was
associated, the NAS may initiate the NAS transport procedure as specified in
subclause 5.4.5, if still needed;
d) if the event which triggered the access attempt was a request from upper
layers to modify an existing PDU session modification, 5GMM shall not initiate
the NAS transport procedure to send the PDU SESSION MODIFICATION REQUEST
message. Upon receiving an indication from the lower layers that the barring
is alleviated for the access category with which the access attempt was
associated, the NAS may initiate the NAS transport procedure as specified in
subclause 5.4.5, if still needed;
e)- if the event which triggered the access attempt was a request to re-
establish the user-plane resources for an existing PDU session, the NAS shall
not initiate the service request procedure as specified in subclause 5.6.1.
Upon receiving an indication from the lower layers that the barring is
alleviated for the access category with which the access attempt was
associated, the NAS may initiate the service request procedure as specified in
subclause 5.6.1, if still needed; and
f) if the event which triggered the access attempt was an uplink user data
packet to be sent for a PDU session with suspended user-plane resources, 5GMM
shall consider that the uplink user data packet is not allowed to be sent.
Upon receiving an indication from the lower layers that the barring is
alleviated for the access category with which the access attempt was
associated, the NAS shall consider that the barring is alleviated for the
access category.
### 4.5.5 Exception handling and avoiding double barring
Access attempts are allowed to proceed without further access control checking
in order to avoid double barring for any service request or registration
procedure initiated for the purpose of NAS signalling connection recovery or
following a fallback indication from the lower layers (see subclauses 5.3.1.2
and 5.3.1.4). For any service request or registration procedure of this kind
the UE determines an access category as specified in subclause 4.5.1 and
4.5.2, unless a different access category is specified in the rest of the
present subclause.
NOTE 1: Although the access control checking is skipped, the access category
is determined for the specific access attempt in order to derive an RRC
establishment cause.
There are several services for which the NAS needs to be informed when the
service starts and stops,
\- because, while the service is ongoing, the mapping of other access attempts
to a specific access category can be affected; and
\- in order to avoid double barring at the start of these services.
These services are:
a) emergency service;
b) MMTEL voice;
c) MMTEL video;
d) SMSoIP; and
e) SMS over NAS.
The UE considers an emergency service a) as started when 5GMM receives a
request from upper layers to register for emergency services or to establish a
PDU session with request type = \"initial emergency request\" or \"existing
emergency PDU session\". It considers the emergency service as stopped when
this PDU session is released.
In addition, the UE considers an emergency service a) as started when the 5GMM
receives a request for emergency services fallback from the upper layer and
performs emergency services fallback as specified in subclause 4.13.4.2 of
3GPP TS 23.502 [9]. In this case, the UE considers the emergency service as
stopped when:
\- the emergency PDU session established during the emergency services
fallback is released if the UE has moved to an E-UTRA cell connected to 5GCN;
or
\- the service request procedure involved in the emergency services fallback
is completed otherwise.
While an emergency service a) is ongoing, any access attempt triggered by the
initiation of a registration, de-registration or service request procedure or
by an uplink user data packet to be sent for a PDU session with suspended
user-plane resources is mapped to access category 2 = emergency.
Once the emergency service has successfully passed access control, then as
long as the service is ongoing, the following access attempts are allowed to
proceed without further access control checking in order to avoid double
barring:
\- any service request procedure related to the PDU session associated with
request type = \"initial emergency request\" or \"existing emergency PDU
session\"; and
\- any uplink user data packet to be sent for a PDU session with suspended
user-plane resources associated with request type = \"initial emergency
request\" or \"existing emergency PDU session\".
NOTE 2: Although the access control checking is skipped, the mapping is
performed in order to derive an RRC establishment cause.
For services b) to e) the 5GMM receives explicit start and stop indications
from the upper layers.
Once the service has successfully passed access control, then as long as the
service is ongoing, the following access attempts are allowed to proceed
without further access control checking in order to avoid double barring:
\- for services b), c) and d):
1) any service request procedure related to the PDU session established for
DNN = \"IMS\" except between receiving from the lower layers an indication
that access barring is applicable for all access categories except categories
0 and 2 and receiving from the lower layers an indication that the barring is
alleviated for the access category determined for the access attempt; and
2) any uplink user data packet to be sent for a PDU session with suspended
user-plane resources established for DNN = \"IMS\" except between receiving
from the lower layers an indication that access barring is applicable for all
access categories except categories 0 and 2 and receiving from the lower
layers an indication that the barring is alleviated for the access category
determined for the access attempt;
\- for service d), if the upper layers have indicated a DNN used for SMSoIP
and the indicated DNN used for SMSoIP is different from \"IMS\":
1) any service request procedure related to the PDU session established for
the DNN used for SMSoIP except between receiving from the lower layers an
indication that access barring is applicable for all access categories except
categories 0 and 2 and receiving from the lower layers an indication that the
barring is alleviated for access category 6; and
2) any uplink user data packet to be sent for a PDU session with suspended
user-plane resources established for the DNN used for SMSoIP except between
receiving from the lower layers an indication that access barring is
applicable for all access categories except categories 0 and 2 and receiving
from the lower layers an indication that the barring is alleviated for access
category 6.
While an MMTEL voice call is ongoing:
\- any service request procedure related to the PDU session established for
DNN = \"IMS\" is mapped to access category 4;
\- any uplink user data packet to be sent for a PDU session with suspended
user-plane resources established for DNN = \"IMS\" is mapped to access
category 4; and
\- any:
1) service request procedure; or
2) registration procedure;
initiated in 5GMM-IDLE mode for the purpose of NAS signalling connection
recovery or following a fallback indication from the lower layers (see
subclause 5.3.1.2 and 5.3.1.4) is mapped to access category 4.
While an MMTEL video call is ongoing and no MMTEL voice call is ongoing:
\- any service request procedure related to the PDU session established for
DNN = \"IMS\" is mapped to access category 5;
\- any uplink user data packet to be sent for a PDU session with suspended
user-plane resources established for DNN = \"IMS\" is mapped to access
category 5; and
\- any:
1) service request procedure; or
2) registration procedure;
initiated in 5GMM-IDLE mode for the purpose of NAS signalling connection
recovery or following a fallback indication from the lower layers (see
subclause 5.3.1.2 and 5.3.1.4) is mapped to access category 5.
While an SMSoIP is ongoing, no MMTEL video call is ongoing and no MMTEL voice
call is ongoing:
\- any service request procedure related to the PDU session established:
1) for DNN = \"IMS\"; or
2) for the DNN used for SMSoIP, if the upper layers have indicated a DNN used
for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\";
is mapped to access category 6; and
\- any uplink user data packet to be sent for a PDU session with suspended
user-plane resources established:
1) for DNN = \"IMS\"; or
2) for the DNN used for SMSoIP, if the upper layers have indicated a DNN used
for SMSoIP and the indicated DNN used for SMSoIP is different from \"IMS\";
is mapped to access category 6; and
\- any:
1) service request procedure; or
2) registration procedure;
initiated in 5GMM-IDLE mode for the purpose of NAS signalling connection
recovery or following a fallback indication from the lower layers (see
subclause 5.3.1.2 and 5.3.1.4) is mapped to access category 6.
While an SMS over NAS is ongoing, no SMSoIP is ongoing, no MMTEL video call is
ongoing and no MMTEL voice call is ongoing:
\- any:
1) service request procedure; or
2) registration procedure;
initiated in 5GMM-IDLE mode for the purpose of NAS signalling connection
recovery or following a fallback indication from the lower layers (see
subclause 5.3.1.2 and 5.3.1.4) is mapped to access category 6.
NOTE 3: Although the access control checking is skipped, the mapping is
performed in order to derive an RRC establishment cause.
If an access category is determined and the access control checking is
skipped, the NAS shall determine the RRC establishment cause from one or more
determined access identities and the access category as specified in subclause
4.5.6, the NAS shall initiate the procedure to send the initial NAS message
for the access attempt and shall provide the RRC establishment cause to lower
layers.
If the UE receives from the lower layers an indication that access barring is
applicable for all access categories except categories 0 and 2:
a) if an MMTEL voice call or MMTEL video call is ongoing:
1) if the UE is operating in the single-registration mode and the UE\'s usage
setting is \"voice centric\", the UE may attempt to select an E-UTRA cell
connected to EPC. If the UE finds a suitable E-UTRA cell connected to EPC, it
then proceeds with the appropriate EMM specific procedures and, if necessary,
ESM procedures to make a PDN connection providing access to IMS available; see
subclause 4.8.2 and 3GPP TS 24.301 [15]; and
2) if the UE is operating in the dual-registration mode, the UE may proceed in
S1 mode with the appropriate EMM specific procedures and ESM procedures to
make a PDN connection providing access to IMS available; see subclause 4.8.3
and 3GPP TS 24.301 [15]; and
b) if SMSoIP is ongoing:
1) if the UE is operating in the single-registration mode, the UE may attempt
to select an E-UTRA cell connected to EPC. If the UE finds a suitable E-UTRA
cell connected to EPC, it then proceeds with the appropriate EMM specific
procedures and, if necessary, ESM procedures to make a PDN connection
providing access to IMS available; see subclause 4.8.2 and 3GPP TS 24.301
[15]; and
2) if the UE is operating in the dual-registration mode, the UE may proceed in
S1 mode with the appropriate EMM specific procedures and ESM procedures to
make a PDN connection providing access to IMS available; see subclause 4.8.3
and 3GPP TS 24.301 [15].
### 4.5.6 Mapping between access categories/access identities and RRC
establishment cause
When 5GMM requests the establishment of a NAS-signalling connection, the RRC
establishment cause used by the UE shall be selected according to one or more
access identities (see subclause 4.5.2) and the determined access category by
checking the rules specified in table 4.5.6.1 and table 4.5.6.2. If the access
attempt matches more than one rule, the RRC establishment cause of the lowest
rule number shall be used. If the determined access category is an operator-
defined access category, then the RRC establishment cause used by the UE shall
be selected according to table 4.5.6.1 and table 4.5.6.2 based on one or more
access identities (see subclause 4.5.2) and the standardized access category
determined for the operator-defined access category as described in subclause
4.5.3.
Table 4.5.6.1: Mapping table for access identities/access categories and RRC
establishment cause when establishing N1 NAS signalling connection via NR
connected to 5GCN
+----------------+----------------+----------------+----------------+ | Rule # | Access | Access | RRC | | | identities | categories | establishment | | | | | cause is set | | | | | to | +================+================+================+================+ | 1 | 1 | Any category | mps- | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 2 | 2 | Any category | mcs- | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 3 | 11, 15 | Any category | high | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 4 | 12,13,14, | Any category | high | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 5 | 0 | 0 (= MT_acc) | mt-Access | +----------------+----------------+----------------+----------------+ | | | 1 (= delay | Not applicable | | | | tolerant) | (NOTE 1) | +----------------+----------------+----------------+----------------+ | | | 2 (= | emergency | | | | emergency) | | +----------------+----------------+----------------+----------------+ | | | 3 (= MO_sig) | mo-Signalling | +----------------+----------------+----------------+----------------+ | | | 4 (= MO MMTel | mo-VoiceCall | | | | voice) | | +----------------+----------------+----------------+----------------+ | | | 5 (= MO MMTel | mo-VideoCall | | | | video) | | +----------------+----------------+----------------+----------------+ | | | 6 (= MO SMS | mo-SMS | | | | and SMSoIP) | | +----------------+----------------+----------------+----------------+ | | | 7 (= MO_data) | mo-Data | +----------------+----------------+----------------+----------------+ | NOTE 1: A UE | | | | | using access | | | | | category 1 for | | | | | the access | | | | | barring check | | | | | will determine | | | | | a second | | | | | access | | | | | category in | | | | | the range 3 to | | | | | 7 that is to | | | | | be used for | | | | | determination | | | | | of the RRC | | | | | establishment | | | | | cause. See | | | | | su | | | | | bclause 4.5.2, | | | | | table 4.5.2.2, | | | | | NOTE 6. | | | | | | | | | | NOTE 2: See | | | | | su | | | | | bclause 4.5.2, | | | | | table 4.5.2.1 | | | | | for use of the | | | | | access | | | | | identities of | | | | | 0, 1, 2, and | | | | | 11-15. | | | | +----------------+----------------+----------------+----------------+
Table 4.5.6.2: Mapping table for access identities/access categories and RRC
establishment cause when establishing N1 NAS signalling connection via E-UTRA
connected to 5GCN
+----------------+----------------+----------------+----------------+ | Rule # | Access | Access | RRC | | | identities | categories | establishment | | | | | cause is set | | | | | to | +================+================+================+================+ | 1 | 1 | Any category | high | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 2 | 2 | Any category | high | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 3 | 11, 15 | Any category | high | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 4 | 12,13,14, | Any category | high | | | | | PriorityAccess | +----------------+----------------+----------------+----------------+ | 5 | 0 | 0 (= MT_acc) | mt-Access | +----------------+----------------+----------------+----------------+ | | | 1 (= delay | Not applicable | | | | tolerant) | (NOTE 1) | +----------------+----------------+----------------+----------------+ | | | 2 (= | emergency | | | | emergency) | | +----------------+----------------+----------------+----------------+ | | | 3 (= MO_sig) | mo-Signalling | +----------------+----------------+----------------+----------------+ | | | 4 (= MO MMTel | mo-VoiceCall | | | | voice) | | +----------------+----------------+----------------+----------------+ | | | 5 (= MO MMTel | mo-VoiceCall | | | | video) | | +----------------+----------------+----------------+----------------+ | | | 6 (= MO SMS | mo-Data | | | | and SMSoIP) | | +----------------+----------------+----------------+----------------+ | | | 7 (= MO_data) | mo-Data | +----------------+----------------+----------------+----------------+ | NOTE 1: A UE | | | | | using access | | | | | category 1 for | | | | | the access | | | | | barring check | | | | | will determine | | | | | a second | | | | | access | | | | | category in | | | | | the range 3 to | | | | | 7 that is to | | | | | be used for | | | | | determination | | | | | of the RRC | | | | | establishment | | | | | cause. See | | | | | su | | | | | bclause 4.5.2, | | | | | table 4.5.2.2, | | | | | NOTE 6. | | | | | | | | | | NOTE 2: See | | | | | su | | | | | bclause 4.5.2, | | | | | table 4.5.2.1 | | | | | for use of the | | | | | access | | | | | identities of | | | | | 0, 1, 2, and | | | | | 11-15. | | | | +----------------+----------------+----------------+----------------+
## 4.6 Network slicing
### 4.6.1 General
The 5GS supports network slicing as described in 3GPP TS 23.501 [8]. Within a
PLMN, a network slice is identified by an S-NSSAI, which is comprised of a
slice/service type (SST) and a slice differentiator (SD). Inclusion of an SD
in an S-NSSAI is optional. A set of one or more S-NSSAIs is called the NSSAI.
The following NSSAIs are defined in 3GPP TS 23.501 [8]:
a) configured NSSAI;
b) requested NSSAI;
c) allowed NSSAI; and
d) subscribed S-NSSAIs;
The following NSSAIs are defined in the present document:
a) rejected NSSAI for the current PLMN; and
b) rejected NSSAI for the current registration area.
A serving PLMN may configure a UE with the configured NSSAI per PLMN. In
addition, the HPLMN may configure a UE with a single default configured NSSAI,
and consider the default configured NSSAI as valid in a PLMN for which the UE
has neither a configured NSSAI nor an allowed NSSAI.
The allowed NSSAI and rejected NSSAI for the current registration area are
managed per access type independently, i.e. 3GPP access or non-3GPP access,
and is applicable for the registration area. If the registration area contains
TAIs belonging to different PLMNs, which are equivalent PLMNs, the allowed
NSSAI and the rejected NSSAI for the current registration area are applicable
to these PLMNs in this registration area.
The rejected NSSAI for the current PLMN is applicable for the whole registered
PLMN, where the registration area shall only contain TAIs belonging to the
registered PLMN.
### 4.6.2 Mobility management aspects
#### 4.6.2.1 General
Upon registration to a PLMN, the UE shall send to the AMF the requested NSSAI
which includes one or more S-NSSAIs of the allowed NSSAI for the PLMN or the
configured NSSAI and corresponds to the network slice(s) to which the UE
intends to register with, if:
a) the UE has a configured NSSAI for the current PLMN;
b) the UE has an allowed NSSAI for the current PLMN; or
c) the UE has neither allowed NSSAI for the current PLMN nor configured NSSAI
for the current PLMN and has a default configured NSSAI. In this case the UE
indicates to the AMF that the requested NSSAI is created from the default
configured NSSAI;
If the UE has neither a configured NSSAI nor an allowed NSSAI valid for a PLMN
and does not have any default configured NSSAI, the UE does not send a
requested NSSAI when requesting registration towards the PLMN. In roaming
scenarios, the UE shall also provide the mapped S-NSSAI(s) for the requested
NSSAI, if available. The AMF verifies if the requested NSSAI is permitted
based on the subscribed S-NSSAIs in the UE subscription and optionally the
mapped S-NSSAI(s) provided by the UE, and if so then the AMF shall provide the
UE with the allowed NSSAI for the PLMN, and shall also provide the UE with the
mapped S-NSSAI(s) for the allowed NSSAI for the PLMN if available. The AMF
shall ensure that there are no two or more S-NSSAIs of the allowed NSSAI which
are mapped to the same S-NSSAI of the HPLMN. The AMF may also query the NSSF
to determine the allowed NSSAI for a given registration area as defined in
3GPP TS 23.501 [8].
The set of network slice(s) for a UE can be changed at any time while the UE
is registered to a PLMN, and the change may be initiated by the network, or
the UE. In this case, the allowed NSSAI and associated registration area may
be changed during the registration procedure. The network may notify the UE of
the change of the supported network slice(s) in order to trigger the
registration procedure. Change in the allowed NSSAI may lead to AMF relocation
subject to operator policy. See subclause 5.4.4 describing the generic UE
configuration update procedure for further details.
#### 4.6.2.2 NSSAI storage
If available, the configured NSSAI(s) shall be stored in a non-volatile memory
in the ME as specified in annex C.
Each of the configured NSSAI stored in the UE is a set composed of at most 16
S-NSSAIs. Each of the allowed NSSAI stored in the UE is a set composed of at
most 8 S-NSSAIs and is associated with a PLMN identity and an access type.
Each of the configured NSSAI except the default configured NSSAI, and the
rejected NSSAI is associated with a PLMN identity. The S-NSSAI(s) in the
rejected NSSAI for the current registration area are further associated with a
registration area where the rejected S-NSSAI(s) is not available. The
S-NSSAI(s) in the rejected NSSAI for the current PLMN shall be considered
rejected for the current PLMN regardless of the access type. There shall be no
duplicated PLMN identities in each of the list of configured NSSAI(s), allowed
NSSAI(s), rejected NSSAI(s) for the current PLMN, and rejected NSSAI(s) for
the current registration area.
The UE stores NSSAIs as follows:
a) The configured NSSAI shall be stored until a new configured NSSAI is
received for a given PLMN. The network may provide to the UE the mapped
S-NSSAI(s) for the new configured NSSAI which shall also be stored in the UE.
When the UE is provisioned with a new configured NSSAI for a PLMN, the UE
shall:
1) replace any stored configured NSSAI for this PLMN with the new configured
NSSAI for this PLMN;
2) delete any stored mapped S-NSSAI(s) for the configured NSSAI and, if
available, store the mapped S-NSSAI(s) for the new configured NSSAI;
3) delete any stored allowed NSSAI for this PLMN and, if available, the stored
mapped S-NSSAI(s) for the allowed NSSAI, if the UE received the new configured
NSSAI for this PLMN and the \"registration requested\" indication in the same
CONFIGURATION UPDATE COMMAND message but without any new allowed NSSAI for
this PLMN included; and
4) delete any rejected NSSAI for the current PLMN, and rejected NSSAI for the
current registration area.
If the UE receives an S-NSSAI associated with a PLMN ID from the network
during the PDN connection establishment procedure in EPS as specified in 3GPP
TS 24.301 [15], the UE may store the received S-NSSAI in the configured NSSAI
for the PLMN identified by the PLMN ID associated with the S-NSSAI, if not
already in the configured NSSAI;
The UE may continue storing a received configured NSSAI for a PLMN and
associated mapped S-NSSAI(s), if available, when the UE registers in another
PLMN.
NOTE 1: The maximum number of configured NSSAIs and associated mapped S-NSSAIs
for PLMNs other than the HPLMN that need to be stored in the UE, and how to
handle the stored entries, are up to UE implementation.
b) The allowed NSSAI shall be stored until a new allowed NSSAI is received for
a given PLMN. The network may provide to the UE the mapped S-NSSAI(s) for the
new allowed NSSAI (see subclauses 5.5.1.2 and 5.5.1.3) which shall also be
stored in the UE. When a new allowed NSSAI for a PLMN is received, the UE
shall:
1) replace any stored allowed NSSAI for this PLMN with the new allowed NSSAI
for this PLMN;
2) delete any stored mapped S-NSSAI(s) for the allowed NSSAI and, if
available, store the mapped S-NSSAI(s) for the new allowed NSSAI; and
3) remove from the stored rejected NSSAI, the rejected S-NSSAI(s), if any,
included in the new allowed NSSAI for the current PLMN;
If the UE receives the CONFIGURATION UPDATE COMMAND message indicating
\"registration requested\" and contains no other parameters (see subclauses
5.4.4.2 and 5.4.4.3), the UE shall delete any stored allowed NSSAI for this
PLMN, and delete any stored mapped S-NSSAI(s) for the allowed NSSAI, if
available;
NOTE 2: Whether the UE stores the allowed NSSAI and the mapped S-NSSAI(s) for
the allowed NSSAI also when the UE is switched off is implementation specific.
c) When the UE receives the S-NSSAI(s) included in rejected NSSAI in the
REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE COMMAND message,
the UE shall:
1) store the S-NSSAI(s) into the rejected NSSAI based on the associated
rejection cause(s);
2) remove from the stored allowed NSSAI for the current PLMN, the rejected
S-NSSAI(s), if any, included in the:
i) rejected NSSAI for the current PLMN, for each and every access type; and
ii) rejected NSSAI for the current registration area, associated with the same
access type;
Once the UE is deregistered over all access types, the rejected NSSAI for the
current PLMN shall be deleted. Once the UE is deregistered over an access
type, the rejected NSSAI for the current registration area corresponding to
the access type shall be deleted. The UE shall delete, if any, the stored
rejected NSSAI for the current registration area if the UE moves out of the
registration area; and
d) When the UE receives the Network slicing indication IE with the Network
slicing subscription change indication set to \"Network slicing subscription
changed\" in the REGISTRATION ACCEPT message or in the CONFIGURATION UPDATE
COMMAND message, the UE shall delete the network slicing information for each
of the PLMNs that the UE has slicing information stored for (excluding the
current PLMN). The UE shall not delete the default configured NSSAI.
Additionally, the UE shall update the network slicing information for the
current PLMN (if received) as specified above in bullets a), b) and c):
#### 4.6.2.3 Provision of NSSAI to lower layers in 5GMM-IDLE mode
The UE NAS layer may provide the lower layers with an NSSAI (either requested
NSSAI or allowed NSSAI) when the UE in 5GMM-IDLE mode sends an initial NAS
message.
The AMF may indicate, via the NSSAI inclusion mode IE of a REGISTRATION ACCEPT
message, an NSSAI inclusion mode in which the UE shall operate over the
current access within the current PLMN, if any (see subclauses 5.5.1.2.4 and
5.5.1.3.4), where the NSSAI inclusion mode is chosen among the following NSSAI
inclusion modes described in table 4.6.2.3.1.
Table 4.6.2.3.1: NSSAI inclusion modes and NSSAI which shall be provided to
the lower layers
+-------------+-------------+-------------+-------------+-------------+ | Initial NAS | NSSAI | NSSAI | NSSAI | NSSAI | | message | inclusion | inclusion | inclusion | inclusion | | | mode A | mode B | mode C | mode D | +=============+=============+=============+=============+=============+ | R | Requested | Requested | Requested | No NSSAI | | EGISTRATION | NSSAI | NSSAI | NSSAI | | | REQUEST | | | | | | message:\ | | | | | | i) | | | | | | including | | | | | | the 5GS | | | | | | r | | | | | | egistration | | | | | | type IE set | | | | | | to | | | | | | \"initial | | | | | | reg | | | | | | istration\" | | | | | +-------------+-------------+-------------+-------------+-------------+ | R | Requested | Requested | Requested | No NSSAI | | EGISTRATION | NSSAI | NSSAI | NSSAI | | | REQUEST | | | | | | message:\ | | | | | | i) | | | | | | including | | | | | | the 5GS | | | | | | r | | | | | | egistration | | | | | | type IE set | | | | | | to | | | | | | \"mobility | | | | | | r | | | | | | egistration | | | | | | updating\"; | | | | | | and\ | | | | | | ii) | | | | | | initiated | | | | | | by case | | | | | | other | | | | | | than case | | | | | | g) or n) in | | | | | | subclaus | | | | | | e 5.5.1.3.2 | | | | | +-------------+-------------+-------------+-------------+-------------+ | R | Allowed | Allowed | No NSSAI | No NSSAI | | EGISTRATION | NSSAI | NSSAI | | | | REQUEST | | | | | | message:\ | | | | | | i) | | | | | | including | | | | | | the 5GS | | | | | | r | | | | | | egistration | | | | | | type IE set | | | | | | to | | | | | | \"mobility | | | | | | r | | | | | | egistration | | | | | | updating\"; | | | | | | and\ | | | | | | ii) | | | | | | initiated | | | | | | by case g) | | | | | | or n) in | | | | | | subclaus | | | | | | e 5.5.1.3.2 | | | | | +-------------+-------------+-------------+-------------+-------------+ | R | Allowed | Allowed | No NSSAI | No NSSAI | | EGISTRATION | NSSAI | NSSAI | | | | REQUEST | | | | | | message:\ | | | | | | i) | | | | | | including | | | | | | the 5GS | | | | | | r | | | | | | egistration | | | | | | type IE set | | | | | | to | | | | | | \"periodic | | | | | | r | | | | | | egistration | | | | | | updating\" | | | | | +-------------+-------------+-------------+-------------+-------------+ | SERVICE | Allowed | See NOTE 1 | No NSSAI | No NSSAI | | REQUEST | NSSAI | | | | | message | | | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: All | | | | | | the | | | | | | S-NSSAIs of | | | | | | the PDU | | | | | | sessions | | | | | | that have | | | | | | the | | | | | | user-plane | | | | | | resources | | | | | | requested | | | | | | to be | | | | | | re- | | | | | | established | | | | | | by the | | | | | | service | | | | | | request | | | | | | procedure | | | | | | or the | | | | | | S-NSSAIs of | | | | | | a control | | | | | | plane | | | | | | interaction | | | | | | triggering | | | | | | the service | | | | | | request is | | | | | | related to | | | | | | (see | | | | | | 3GPP TS 23 | | | | | | .501 [8]) | | | | | | | | | | | | NOTE 2: For | | | | | | a | | | | | | R | | | | | | EGISTRATION | | | | | | REQUEST | | | | | | message | | | | | | including | | | | | | the 5GS | | | | | | r | | | | | | egistration | | | | | | type IE set | | | | | | to | | | | | | \"emergency | | | | | | reg | | | | | | istration\" | | | | | | and a | | | | | | DER | | | | | | EGISTRATION | | | | | | REQUEST | | | | | | message, no | | | | | | NSSAI is | | | | | | provided to | | | | | | the lower | | | | | | layers. | | | | | | | | | | | | NOTE 3: The | | | | | | mapped | | | | | | configured | | | | | | S-NSSAI(s) | | | | | | from the | | | | | | S-NSSAI(s) | | | | | | of the | | | | | | HPLMN are | | | | | | not | | | | | | included as | | | | | | part of the | | | | | | S-NSSAIs in | | | | | | the | | | | | | requested | | | | | | NSSAI or | | | | | | the allowed | | | | | | NSSAI when | | | | | | it is | | | | | | provided to | | | | | | the lower | | | | | | layers. | | | | | +-------------+-------------+-------------+-------------+-------------+
The UE shall store the NSSAI inclusion mode:
a) indicated by the AMF, if the AMF included the NSSAI inclusion mode IE in
the REGISTRATION ACCEPT message; or
b) decided by the UE, if the AMF did not include the NSSAI inclusion mode IE
in the REGISTRATION ACCEPT message;
together with the identity of the current PLMN and access type in a non-
volatile memory in the ME as specified in annex C.
The UE shall apply the NSSAI inclusion mode received in the REGISTRATION
ACCEPT message over the current access within the current PLMN and its
equivalent PLMN(s), if any, in the current registration area.
When a UE performs a registration procedure to a PLMN which is not a PLMN in
the current registration area, if the UE has no NSSAI inclusion mode for the
PLMN stored in a non-volatile memory in the ME, the UE shall provide the lower
layers with:
a) no NSSAI if the UE is performing the registration procedure over 3GPP
access; or
b) requested NSSAI if the UE is performing the registration procedure over
non-3GPP access.
When a UE performs a registration procedure after an inter-system change from
S1 mode to N1 mode, if the UE has no NSSAI inclusion mode for the PLMN stored
in a non-volatile memory in the ME and the registration procedure is performed
over 3GPP access, the UE shall not provide the lower layers with any NSSAI
over the 3GPP access.
### 4.6.3 Session management aspects
In order to enable PDU transmission in a network slice, the UE may request
establishment of a PDU session in a network slice towards a data network (DN)
which is associated with an S-NSSAI and a data network name (DNN) if there is
no established PDU session adequate for the PDU transmission. The S-NSSAI
included is part of allowed NSSAI of the serving PLMN, which is an S-NSSAI
value valid in the serving PLMN, and in roaming scenarios the mapped S-NSSAI
is also included for the PDU session if available. See subclause 6.4.1 for
further details. The UE determines whether to establish a new PDU session or
use one of the established PDU session(s) based on the URSP rules which
include S-NSSAIs, if any (see subclause 6.2.9), or based on UE local
configuration, as described in subclause 4.2.2 of 3GPP TS 24.526 [19].
## 4.7 NAS over non-3GPP access
### 4.7.1 General
From the UE\'s NAS perspective, in general the procedures and messages defined
for 5GMM and 5GSM are used over non-3GPP access as over 3GPP access. However,
a number of aspects are different as described in the following subclauses.
### 4.7.2 5GS mobility management aspects
#### 4.7.2.1 General
The mobility management procedures defined over 3GPP access are re-used over
non-3GPP access with the following exceptions:
a) the registration status, and the 5GMM parameters of the UE\'s 3GPP access
and non-3GPP access 5GMM state machine instances are independent in each of
these accesses and can be different;
b) single-registration mode and dual-registration mode do not apply for 5GMM
over non-3GPP access;
c) the RPLMN over non-3GPP access can be different from the RPLMN over 3GPP
access. The MCC of the RPLMN over 3GPP access and the MCC of the RPLMN over
the non-3GPP access can also be different;
d) the registration for 3GPP access and for non-3GPP access are performed
separately. Like for 3GPP access, an access stratum connection exists before
the UE can perform the registration procedure for non-3GPP access. As over
non-3GPP access the 5GS operates one single common registration area for an
entire PLMN, which is associated with the operator-specific N3GPP TAI for the
PLMN, list management of registration areas is not required, and registration
updating due to registration area change with the registered PLMN is not
performed. Furthermore, the periodic registration update procedure is also not
performed. New registration at change of PLMN is required;
e) the 5GMM over non-3GPP access in the UE considers that the N1 NAS
signalling connection is established when the lower layers indicate that the
access stratum connection is established succcessfully;
f) the UE-initiated service request procedure via non-3GPP access is
supported. Upon indication from the lower layers of non-3GPP access, that the
access stratum connection is established between the UE and the network, the
UE in 5GMM-REGISTERED state and in 5GMM-IDLE mode over non-3GPP access shall
initiate the service request procedure via non-3GPP access. The UE may
indicate with the service request message the PDU session(s) associated with
non-3GPP access to re-establish user-plane resources for which the UE has
pending user data to be sent;
g) paging procedure is not performed via non-3GPP access;
h) service area restrictions do not apply for non-3GPP access;
i) the establishment cause for non-3GPP access is determined according to
subclause 4.7.2.2;
j) eCall inactivity procedure is not performed via non-3GPP access;
k) local area data network (LADN) do not apply for non-3GPP access;
l) Allowed PDU session IE shall not be included in REGISTRATION REQUEST
message or SERVICE REQUEST message sent over non-3GPP access;
m) DRX parameters does not apply for non-3GPP access; and
n) Mobile initiated connection only mode (MICO) does not apply for non-3GPP
access.
#### 4.7.2.2 Establishment cause for non-3GPP access
When establishment of an N1 NAS signalling connection over non-3GPP access is
initiated, the UE shall determine one or more access identities to be
associated with the establishment of the N1 NAS signalling connection as
specified in subclause 4.5.2 and table 4.5.2.1, shall select the establishment
cause for non-3GPP access from the determined one or more access identities
and the event which triggered initiation of the N1 NAS signalling connection
over non-3GPP access by checking the rules specified in table 4.7.2.2.1 and
shall provide the selected establishment cause for non-3GPP access to the
lower layers. If the access attempt matches more than one rule, the
establishment cause for non-3GPP access of the lowest rule number shall be
used.
Table 4.7.2.2.1: Mapping table for determination of establishment cause for
non-3GPP access
+-------------+-------------+-------------+-------------+-------------+ | Rule # | Access | Type of | R | Es | | | identities | access | equirements | tablishment | | | | attempt | to be met | cause for | | | | | | non-3GPP | | | | | | access | +=============+=============+=============+=============+=============+ | 1 | 1 | Any | Any | mps-Pri | | | | | | orityAccess | +-------------+-------------+-------------+-------------+-------------+ | 2 | 2 | Any | Any | mcs-Pri | | | | | | orityAccess | +-------------+-------------+-------------+-------------+-------------+ | 3 | 11, 15 | Any | Any | highPri | | | | | | orityAccess | +-------------+-------------+-------------+-------------+-------------+ | 4 | 12,13,14, | Any | Any | highPri | | | | | | orityAccess | +-------------+-------------+-------------+-------------+-------------+ | 5 | 0 | Emergency | UE is | emergency | | | | | attempting | | | | | | access for | | | | | | an | | | | | | emergency | | | | | | session | | | | | | (NOTE 1) | | +-------------+-------------+-------------+-------------+-------------+ | | | UE NAS | Access | mo | | | | initiated | attempt is | -Signalling | | | | 5GMM | for MO | | | | | specific | signalling | | | | | procedures | | | +-------------+-------------+-------------+-------------+-------------+ | | | UE NAS | Access | mo-Data | | | | initiated | attempt is | | | | | 5GMM | for MO data | | | | | connection | | | | | | management | | | | | | procedures | | | | | | or 5GMM NAS | | | | | | transport | | | | | | procedure | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | This | | | | | | includes | | | | | | 5GMM | | | | | | specific | | | | | | procedures | | | | | | while the | | | | | | service is | | | | | | ongoing and | | | | | | 5GMM | | | | | | connection | | | | | | management | | | | | | procedures | | | | | | required to | | | | | | establish a | | | | | | PDU session | | | | | | with | | | | | | request | | | | | | type = | | | | | | \"initial | | | | | | emergency | | | | | | request\" | | | | | | or | | | | | | \"existing | | | | | | emergency | | | | | | PDU | | | | | | session\", | | | | | | or to | | | | | | r | | | | | | e-establish | | | | | | user-plane | | | | | | resources | | | | | | for such a | | | | | | PDU | | | | | | session. | | | | | | | | | | | | NOTE 2: See | | | | | | subcl | | | | | | ause 4.5.2, | | | | | | ta | | | | | | ble 4.5.2.1 | | | | | | for use of | | | | | | the access | | | | | | identities | | | | | | of 0, 1, 2, | | | | | | and 11-15. | | | | | +-------------+-------------+-------------+-------------+-------------+
### 4.7.3 5GS session management aspects
The session management procedures defined over 3GPP access are re-used over
non-3GPP access.
### 4.7.4 Limited service state over non-3GPP access
There are a number of situations in which the UE is unable to obtain normal
service from a PLMN over non-3GPP access and the UE enters the limited service
state over non-3GPP access. These include:
a) no USIM in the ME;
b) an \"illegal UE\" or \"illegal ME\" response is received when registration
or service request is performed (any USIM in the ME is then considered
\"invalid\");
c) a \"5GS services not allowed\" response is received when a registration or
service request is performed;
d) a \"PLMN not allowed\" response is received when registration or service
request is performed;
e) a \"Tracking area not allowed\" response is received when a registration or
service request is performed;
f) a \"Roaming not allowed in this tracking area\" response is received when a
registration or service request is performed; or
g) a \"No suitable cells in tracking area\" response is received when a
registration or service request is performed.
In limited service state with a valid USIM in the UE, the network selection is
performed as defined in 3GPP TS 24.502 [18].
With the exception of performing initial registration for emergency services,
no registration requests are made until a valid USIM is present. For
registration for emergency services, the PLMN of the current N3IWF is
considered as the selected PLMN for the duration the UE is registered for
emergency services.
## 4.8 Interworking with E-UTRAN connected to EPC
### 4.8.1 General
In order to interwork with E-UTRAN connected to EPC, the UE supporting both S1
mode and N1 mode can operate in single-registration mode or dual-registration
mode (see 3GPP TS 23.501 [8]). Support of single-registration mode is
mandatory for UEs supporting both S1 mode and N1 mode.
During the EPS attach procedure (see 3GPP TS 24.301 [15]) or initial
registration procedure (see subclause 5.5.1.2), the mode for interworking is
selected if the UE supports both S1 mode and N1 mode, and the network supports
interworking. The mode for interworking may also be selected during the EPS
tracking area updating procedure (see 3GPP TS 24.301 [15]) or registration
procedure for mobility and periodic registration update (see subclause
5.5.1.3).
For interworking between E-UTRAN connected to EPC and N3IWF connected to 5GCN,
the UE shall operate as specified in either subclause 4.8.2.3 or subclause
4.8.3. Which subclause the UE follows is chosen by the UE irrespective of the
interworking without N26 interface indicator.
### 4.8.2 Single-registration mode
#### 4.8.2.1 General
If the UE receives the indication that \"interworking without N26 interface
not supported\" (see 3GPP TS 24.301 [15]), the UE operates as described in
subclause 4.8.2.2.
If the UE receives the indication that \"interworking without N26 interface
supported\" and
a) the UE does not support dual-registration mode; or
b) the UE supporting dual-registration mode determines to operate in single-
registration mode,
the UE operates as described in subclause 4.8.2.3.
#### 4.8.2.2 Single-registration mode with N26 interface
See subclause 5.1.4.2 for coordination between 5GMM and EMM and subclause
6.1.4.1 for coordination between 5GSM and ESM.
#### 4.8.2.3 Single-registration mode without N26 interface
##### 4.8.2.3.1 Interworking between NG-RAN and E-UTRAN
At inter-system change from N1 mode to S1 mode in EMM-IDLE mode when:
a) the UE supports non-IP PDN type and at least one PDU session is active; or
b) the UE does not support non-IP PDN type and at least one PDU session of
IPv4, IPv6 or IPv4v6 PDU session type is active,
the UE shall proceed as follows:
a) if the UE supports sending an ATTACH REQUEST message containing a PDN
CONNECTIVITY REQUEST message with request type set to \"handover\" to transfer
a PDU session from N1 mode to S1 mode and the UE has received an
\"interworking without N26 interface supported\" indication from the network,
the UE shall:
1) enter substates EMM-DEREGISTERED.NORMAL-SERVICE and 5GMM-REGISTERED.NO-
CELL-AVAILABLE;
2) map the PDU session(s) which the UE intends to transfer to EPS to the
default EPS bearer context of the corresponding PDN connection(s) as specified
in subclause 6.1.4.2; and
3) initiate an EPS attach procedure and include a PDN CONNECTIVITY REQUEST
message with request type set to \"handover\" in the ATTACH REQUEST message to
activate a default EPS bearer context for one of the active PDU sessions which
the UE intends to transfer to EPS.
After successful completion of the EPS attach procedure, the UE shall reset
the registration attempt counter and the attach attempt counter (see 3GPP TS
24.301 [15]) and attempt to activate each of the other default EPS bearer
contexts, if any, by initiating a stand-alone PDN connectivity procedure with
request type set to \"handover\" in the PDN CONNECTIVITY REQUEST message; and
b) otherwise, enter substates EMM-REGISTERED.NORMAL-SERVICE and 5GMM-
REGISTERED.NO-CELL-AVAILABLE and initiate a tracking area update procedure
(see 3GPP TS 24.301 [15]).
At inter-system change from N1 mode to S1 mode in EMM-IDLE mode when:
a) the UE supports non-IP PDN type and no PDU session is active; or
b) the UE does not support non-IP PDN type and no PDU session of IPv4, IPv6 or
IPv4v6 PDU session type is active,
the UE shall enter substates EMM-DEREGISTERED.NORMAL-SERVICE and 5GMM-
DEREGISTERED.NO-CELL-AVAILABLE, and initiate an attach procedure.
At inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE
shall:
a) enter substate 5GMM-REGISTERED.NORMAL-SERVICE and substate EMM-
REGISTERED.NO-CELL-AVAILABLE;
b) map the default EPS bearer context(s) of the PDN connection(s) which the UE
intends to transfer to 5GS, if any, to the corresponding PDU session(s) as
specified in subclause 6.1.4.2; and
c) initiate the registration procedure for mobility and periodic registration
update indicating \"mobility registration updating\" in the 5GS registration
type IE of the REGISTRATION REQUEST message (see subclause 5.5.1.3).
After having successfully registered in N1 mode the UE shall reset the
registration attempt counter and the attach attempt counter (see 3GPP TS
24.301 [15]) and:
a) if the UE supports the PDU session establishment procedure with request
type set to \"existing PDU session\" to transfer a PDN connection from S1 mode
to N1 mode and the UE has received an \"interworking without N26 interface
supported\" indication from the network, attempt to transfer the PDN
connection(s) which the UE intends to transfer to 5GS, if any, from S1 mode to
N1 mode by initiating the PDU session establishment procedure with request
type set to \"existing PDU session\"; and
b) otherwise, establish PDU session(s) corresponding to the PDN connection(s)
which the UE intends to transfer to 5GS, if any, by initiating the PDU session
establishment procedure with request type set to \"initial request\".
See subclause 5.1.4.3 for coordination between 5GMM and EMM and subclause
6.1.4.2 for coordination between 5GSM and ESM.
##### 4.8.2.3.2 Interworking between N3IWF connected to 5GCN and E-UTRAN
If:
a) the UE has registered in neither N1 mode over 3GPP access nor S1 mode yet;
and
b) the UE has at least one active PDU session associated with non-3GPP access
which the UE intends to transfer to EPS,
the UE shall initiate an EPS attach procedure and include a PDN CONNECTIVITY
REQUEST message with request type set to \"handover\" in the ATTACH REQUEST
message to activate a default EPS bearer context for one of the active PDU
sessions which the UE intends to transfer to EPS (see 3GPP TS 24.301 [15]).
NOTE 1: It is necessary for the UE to support sending an ATTACH REQUEST
message containing a PDN CONNECTIVITY REQUEST message with request type set to
\"handover\" to transfer a PDU session from N1 mode to S1 mode for
interworking bewteen N3IWF connected to 5GCN and E-UTRAN.
After successful completion of the EPS attach procedure, the UE shall initiate
a UE requested PDN connectivity procedure with request type set to
\"handover\" in the PDN CONNECTIVITY REQUEST message to transfer each of the
other PDU sessions which the UE intends to transfer to EPS, if any.
If:
a) the UE has not registered in N1 mode over non-3GPP access yet; and
b) the UE has at least one active PDN connection which the UE intends to
transfer to N3IWF connected to 5GCN,
the UE shall initiate an initial registration procedure over non-3GPP access
(see subclause 5.5.1.2).
After successful completion of the 5GS initial registration in N1 mode over
non-3GPP access, the UE shall initiate a UE-requested PDU session
establishment procedure with request type set to \"existing PDU session\" to
transfer each of the PDN connections which the UE intends to transfer to N3IWF
connected to 5GCN, if any.
NOTE 2: If the UE has no active PDU session associated with non-3GPP access
which the UE in N1 mode intends to transfer to EPS or no active PDN connection
associated with 3GPP access which the UE in S1 mode intends to transfer to
N3IWF connected to 5GCN, the interworking between N3IWF connected to 5GCN and
E-UTRAN is not supported.
See subclause 6.1.4.2 for coordination between 5GSM and ESM.
### 4.8.3 Dual-registration mode
If both 5GMM and EMM are enabled, a UE, operating in the dual-registration
mode shall maintain independent contexts for 5GMM and EMM and this includes
independent lists of equivalent PLMNs. Coordination between 5GMM and EMM is
not needed, except as specified in the present subclause.
a) A UE operating in the dual-registration mode may register to N1 mode only,
S1 mode only, or to both N1 mode and S1 mode.
b) When the UE decides to operate in dual-registration mode (see subclause
5.5.1.2.4), NAS informs the lower layers about this.
c) If a UE is registered in N1 mode only, then for registration in S1 mode it
shall use the same PLMN to which it is registered in N1 mode or an equivalent
PLMN.
d) If a UE is registered in S1 mode only, then for registration in N1 mode it
shall use the same PLMN to which it is registered in S1 mode or an equivalent
PLMN.
NOTE 1: It is up to UE implementation how to handle the case when the UE is
registered in both N1 mode and S1 mode and the PLMNs to which the UE is
registered, are not equivalent, e.g. search for a PLMN which is the same or
equivalent to any of the registered ones.
When no PDU session is active and the UE has not registered to S1 mode yet,
the UE may initiate the EPS attach procedure with PDN connection establishment
if EMM-REGISTERED without PDN connection is not supported by the MME. If EMM-
REGISTERED without PDN connection is supported by the MME, the UE may initiate
either the EPS attach procedure without PDN connection establishment or the
attach procedure with PDN connection establishment.
When at least one PDU session is active and the UE has not registered to S1
mode yet, the UE may initiate the EPS attach procedure. If necessary, the UE
may transfer an active PDU session from N1 mode to S1 mode by initiating the
EPS attach procedure with request type set to \"handover\" in the PDN
CONNECTIVITY REQUEST message. After successfully attached in S1 mode, if
necessary, the UE may transfer other active PDU sessions from N1 mode to S1
mode by initiating the PDN connectivity procedure with request type set to
\"handover\" in the PDN CONNECTIVITY REQUEST message.
NOTE 2: It is up to UE implementation to determine which active PDU session is
transferred from N1 mode to S1 mode.
When the UE has not registered to N1 mode, the UE may initiate the initial
registration procedure. After successfully registered in N1 mode, if
necessary, the UE may transfer one or more active PDN connections from S1 mode
to N1 mode by initiating the PDU session establishment procedure with request
type set to \"existing PDU session\".
NOTE 3: It is up to UE implementation to determine which active PDN connection
is transferred from S1 mode to N1 mode.
If the MME supports EMM-REGISTERED without PDN connection, the UE that
transferred all PDN connections to the 5GS, may stay in state EMM-REGISTERED.
Otherwise, the UE shall enter state EMM-DEREGISTERED upon transferring all PDN
connection to the 5GS.
NOTE 4: When the UE has registered in both N1 mode and S1 mode, it is up to UE
implementation to maintain the registration update to date in both N1 mode and
S1 mode.
See subclause 6.1.4 for coordination between 5GSM and ESM.
See subclause 4.8.2.3.2 for interworking between N3IWF connected to 5GCN and
E-UTRAN.
### 4.8.4 Core Network selection
If the UE is capable of both N1 mode and S1 mode, when the UE needs to use one
or more functionalities not supported in 5GS but supported in EPS and the UE
is in 5GMM-IDLE mode, the UE may disable the N1 mode capability for 3GPP
access (see subclause 4.9.2).
If the UE is capable of both N1 mode and S1 mode and lower layers provide an
indication that the current E-UTRA cell is connected to both EPC and 5GCN
without also providing an indication that a target core network type was
received from the NG-RAN, the UE shall select a core network type (EPC or
5GCN) based on the PLMN selection procedures as specified in 3GPP TS 23.122
[5] and provide the selected core network type information to the lower layer
during the initial registration procedure.
If the UE is capable of both N1 mode and S1 mode and the lower layers have
provided an indication that the current E-UTRA cell is connected to both EPC
and 5GCN and an indication of whether the network supports IMS emergency
services via either EPC or 5GCN or both (see 3GPP TS 36.331 [25A]), the UE
selects a core network type (EPC or 5GCN) as specified in 3GPP TS 23.167 [6]
annex H.2 for initiating emergency calls when in the state 5GMM-
DEREGISTERED.LIMITED-SERVICE or EMM-DEREGISTERED.LIMITED-SERVICE.
NOTE 1: If the PLMN selection information provisioned in the USIM does not
contain any prioritization between E-UTRAN and NG-RAN for a PLMN, which core
network type to select for that PLMN is up to UE implementation.
If the UE is capable of both N1 mode and S1 mode and lower layers provide an
indication that the current E-UTRA cell is connected to both EPC and 5GCN
with:
1) an indication that target core network type EPC was received from the NG-
RAN, the UE shall select the EPC and proceed with the appropriate EMM
procedure as specified in 3GPP TS 24.301 [15]; or
2) an indication that target core network type 5GCN was received from the NG-
RAN, the UE shall select the 5GCN and proceed with the appropriate 5GMM
procedure.
NOTE 2: The NG-RAN can provide a target core network type to the UE during RRC
connection release with redirection (see 3GPP TS 36.331 [25A] and 3GPP TS
38.331 [30]).
## 4.9 Disabling and re-enabling of UE\'s N1 mode capability
### 4.9.1 General
The UE shall re-enable the N1 mode capability when the UE powers off and
powers on again or the USIM is removed.
As an implementation option, the UE may start a timer for re-enabling N1 mode
capability, after the N1 mode capability was disabled. On the expiry of this
timer, the UE should re-enable the N1 mode capability.
### 4.9.2 Disabling and re-enabling of UE\'s N1 mode capability for 3GPP
access
When the UE is disabling the N1 mode capability for 3GPP access, it should
proceed as follows:
a) select an E-UTRA cell connected to EPC of the registered PLMN or a PLMN
from the list of equivalent PLMNs, if the UE supports S1 mode;
b) if an E-UTRA cell connected to EPC of the registered PLMN or a PLMN from
the list of equivalent PLMNs cannot be found or the UE does not support S1
mode, the UE may select another RAT of the registered PLMN or a PLMN from the
list of equivalent PLMNs that the UE supports;
c) if another RAT of the registered PLMN or a PLMN from the list of equivalent
PLMNs cannot be found, or the UE does not have a registered PLMN, then enter
the state 5GMM-DEREGISTERED.PLMN-SEARCH and perform PLMN selection as
specified in 3GPP TS 23.122 [5]. As an implementation option, if the UE does
not have a registered PLMN, instead of performing PLMN selection, the UE may
select another RAT of the selected PLMN if the UE has chosen a PLMN and the
RAT is supported by the UE; or
d) if no other allowed PLMN and RAT combinations are available, then the UE
may re-enable the N1 mode capability for 3GPP access and remain camped in NG-
RAN of the registered PLMN, and may periodically scan for another PLMN and RAT
combination which can provide EPS services or non-EPS services (if the UE
supports EPS services or non-EPS services). The UE enters the state 5GMM-
DEREGISTERED.
When the UE supporting both N1 mode and S1 mode needs to stay in E-UTRA
connected to EPC (e.g. due to the domain selection for UE originating sessions
as specified in subclause 4.3.2), in order to prevent unintentional handover
or cell reselection from E-UTRA connected to EPC to NG-RAN connected to 5GCN,
the UE operating in single-registration mode shall disable the N1 mode
capability for 3GPP access and:
a) shall set the N1mode bit to \"N1 mode not supported\" in the UE network
capability IE (see 3GPP TS 24.301 [15]) of the ATTACH REQUEST message and the
TRACKING AREA UPDATE REQUEST message in EPC; and
b) the UE NAS layer shall indicate the access stratum layer(s) of disabling of
the N1 mode capability for 3GPP access.
NOTE 1: The UE can only disable the N1 mode capability for 3GPP access when in
5GMM-IDLE mode.
The UE shall re-enable the N1 mode capability for 3GPP access when the UE
performs PLMN selection over 3GPP access.
If the disabling of N1 mode capability for 3GPP access was due to IMS voice is
not available over 3GPP access and the UE\'s usage setting is \"voice
centric\", the UE shall re-enable the N1 mode capability for 3GPP access when
the UE\'s usage setting is changed from \"voice centric\" to \"data centric\",
as specified in subclauses 4.3.3.
The UE should memorize the identity of the PLMN where N1 mode capability for
3GPP access was disabled and should use that stored information in subsequent
PLMN selections as specified in 3GPP TS 23.122 [5].
If the UE attempts to establish an emergency PDU session in a PLMN where N1
mode capability was disabled due to the UE\'s registration attempt counter
have reached 5, the UE may enable N1 mode capability for that PLMN memorized
by the UE.
NOTE 2: If N1 mode capability is disabled due to the UE\'s registration
attempt counter reaches 5, the value of the timer for re-enabling N1 mode
capability is recommended to be the same as the value of T3502 which follows
the handling specified in subclause 5.3.8.
### 4.9.3 Disabling and re-enabling of UE\'s N1 mode capability for non-3GPP
access
When the UE disables the N1 mode capability for non-3GPP access, the UE NAS
layer shall not initiate any 5GS NAS procedures towards the network over
non-3GPP access.
When the UE supporting both N1 mode and S1 mode needs to stay in non-3GPP
access connected to EPC (e.g. due to the domain selection for UE originating
sessions as specified in subclause 4.3.2), in order to prevent unintentional
selection of a non-3GPP access network connected to 5GCN, the UE operating in
single-registration mode shall not transfer any PDN connection to a non-3GPP
access network connected to the 5GCN.
If the disabling of N1 mode capability for non-3GPP access was due to IMS
voice is not available over non-3GPP access in 5GS and the UE\'s usage setting
is \"voice centric\", the UE shall re-enable the N1 mode capability for
non-3GPP access when the UE\'s usage setting is changed from \"voice centric\"
to \"data centric\" as specified in subclauses 4.3.3.
The UE shall re-enable the N1 mode capability for non-3GPP access when a new
PLMN is selected over non-3GPP access.
## 4.10 Interworking with ePDG connected to EPC
In order to interwork with ePDG connected to EPC, the UE shall operate as
specified in either subclause 4.8.2.3 or subclause 4.8.3. Which subclause the
UE follows is chosen by the UE irrespective of the interworking without N26
interface indicator.
The UE shall not attempt to transfer PDU sessions with PDU session type
\"Ethernet\" or \"Unstructured\" to an ePDG connected to EPC.
NOTE: PDU sessions with PDU session type \"Ethernet\" or \"Unstructured\"
cannot be transferred to an ePDG connected to EPC because PDN connections with
PDN type \"non-IP\" are not supported over ePDG connected to EPC.
## 4.11 UE configuration parameter updates
The 5GS supports updating UE parameters via NAS signalling. The feature
enables the HPLMN to securely and dynamically re-configure the UE
configuration parameters stored on the USIM and the ME.
In this release of the specification, updates of the following USIM
configuration parameters are supported:
\- routing indicator.
In this release of specification, updates of the following ME configuration
parameters are supported:
\- default configured NSSAI.
The update of UE configuration parameters is initiated by the network using
the network-initiated downlink NAS transport procedure as described in
subclause 5.4.5.3. The ME acknowledgement of successful reception of the
updated UE configuration parameter information is sent back to the network
using the UE-initiated uplink NAS transport procedure as described in
subclause 5.4.5.2.
# 5 Elementary procedures for 5GS mobility management
## 5.1 Overview
### 5.1.1 General
The main function of the 5GS mobility management (5GMM) sublayer is to support
the identification, security, mobility of a UE as well as generic message
transport.
A further function of the 5GMM sublayer is to provide connection management
services to the other sublayer(s).
### 5.1.2 Types of 5GMM procedures
Depending on how they can be initiated, three types of 5GMM procedures can be
distinguished:
a) 5GMM common procedures
5GMM common procedure can always be initiated when the UE is in 5GMM-CONNECTED
mode. The procedures belonging to this type are:
1) Initiated by the network:
i) network-initiated NAS transport.
ii) primary authentication and key agreement procedure
iii) security mode control;
iv) generic UE configuration update
v) identification
2) Initiated by the UE:
UE-initiated NAS transport.
3) Initiated by the UE or the network and used to report certain error
conditions detected upon receipt of 5GMM protocol data:
5GMM status.
b) 5GMM specific procedures:
At any time only one UE initiated 5GMM specific procedure can be running for
each of the access network(s) that the UE is camping in. The procedures
belonging to this type are:
1) Initiated by the UE and used e.g. to register to the network for 5GS
services and establish a 5GMM context, to update the location/parameter(s) of
the UE:
registration.
2) Initiated by the UE or the network and used to deregister from the network
for 5GS services and to release a 5GMM context:
de-registration.
3) Initiated by the UE and used to deregister from the network for 5GS
services and to release a 5GMM context:
eCall inactivity procedure.
c) 5GMM connection management procedures:
1) Initiated by the UE and used to establish a secure connection to the
network or to request the resource reservation for sending data, or both:
service request.
The service request procedure can only be initiated if no UE initiated 5GMM
specific procedure is ongoing for each of the access network(s) that the UE is
camping in.
2) Initiated by the network and used to request the establishment of an N1 NAS
signalling connection or to request re-establishment of user-plane resources
for the PDU session(s) associated with 3GPP access or to request re-
establishment of user-plane resources of the PDU session(s) associated with
non-3GPP access over 3GPP access; not applicable for the non-3GPP access
network:
paging.
3) Initiated by the network and used to request re-establishment of user-plane
resources of the PDU session(s) associated with non-3GPP access over 3GPP
access when the UE is in 5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE
mode over non-3GPP access; or
Initiated by the network and used to request re-establishment of user-plane
resources of the PDU session(s) associated with 3GPP access over 3GPP access
when the UE is in 5GMM-CONNECTED mode over non-3GPP access and in 5GMM-IDLE
mode over 3GPP access:
notification.
### 5.1.3 5GMM sublayer states
#### 5.1.3.1 General
In the following subclauses, the 5GS mobility management (5GMM) sublayer of
the UE and the network is described by means of different state machines. The
5GMM sublayer states is managed per access type independently, i.e. 3GPP
access or non-3GPP access. In subclause 5.1.3.2, the states of the 5GMM
sublayer are introduced.
#### 5.1.3.2 5GMM sublayer states
##### 5.1.3.2.1 5GMM sublayer states in the UE
###### 5.1.3.2.1.1 General
In the following subclauses, the possible 5GMM sublayer states of the UE are
described and shown in Figure 5.1.3.2.1.1.1.
NOTE: Not all possible transitions are shown in this figure.
Figure 5.1.3.2.1.1.1: 5GMM main states in the UE
###### 5.1.3.2.1.2 Main states
###### # 5.1.3.2.1.2.1 5GMM-NULL
5GS services are disabled in the UE. No 5GS mobility management function shall
be performed in this state.
###### # 5.1.3.2.1.2.2 5GMM-DEREGISTERED
In the state 5GMM-DEREGISTERED, no 5GMM context has been established and the
UE location is unknown to the network and hence it is unreachable by a
network. In order to establish a 5GMM context, the UE shall start the initial
registration procedure.
###### # 5.1.3.2.1.2.3 5GMM-REGISTERED-INITIATED
A UE enters the state 5GMM-REGISTERED-INITIATED after it has started the
initial registration procedure or the non-initial registration procedure, and
is waiting for a response from the network.
###### # 5.1.3.2.1.2.4 5GMM-REGISTERED
In the state 5GMM-REGISTERED, a 5GMM context has been established.
Additionally, one or more PDU session(s) may be established at the UE. The UE
may initiate the non-initial registration procedure (including the normal
registration update and periodic registration update) and the service request
procedure. The UE in the state 5GMM-REGISTERED over non-3GPP access shall not
initiate the periodic registration update procedure.
###### # 5.1.3.2.1.2.5 5GMM-DEREGISTERED-INITIATED
A UE enters the state 5GMM-DEREGISTERED-INITIATED after it has requested
release of the 5GMM context by starting the de-registration procedure and is
waiting for a response from the network.
###### # 5.1.3.2.1.2.6 5GMM-SERVICE-REQUEST-INITIATED
A UE enters the state 5GMM-SERVICE-REQUEST-INITIATED after it has started the
service request procedure and is waiting for a response from the network.
###### 5.1.3.2.1.3 Substates of state 5GMM-DEREGISTERED
###### # 5.1.3.2.1.3.1 General
The state 5GMM-DEREGISTERED is subdivided into a number of substates as
described in this subclause. The following substates are not applicable to
non-3GPP access:
a) 5GMM-DEREGISTERED.PLMN-SEARCH:
b) 5GMM-DEREGISTERED.NO-CELL-AVAILABLE; and
c) 5GMM-DEREGISTERED.eCALL-INACTIVE.
Valid subscriber data are available for the UE before it enters the substates,
except for the substate 5GMM-DEREGISTERED.NO-SUPI.
###### # 5.1.3.2.1.3.2 5GMM-DEREGISTERED.NORMAL-SERVICE
The substate 5GMM-DEREGISTERED.NORMAL-SERVICE is chosen in the UE when a
suitable cell has been found and the PLMN or tracking area is not in the
forbidden list.
###### # 5.1.3.2.1.3.3 5GMM-DEREGISTERED.LIMITED-SERVICE
The substate 5GMM-DEREGISTERED.LIMITED-SERVICE is chosen in the UE, when it is
known that a selected cell for 3GPP access or TA for non-3GPP access is unable
to provide normal service (e.g. the selected cell over 3GPP access is in a
forbidden PLMN or is in a forbidden tracking area or TA for non-3GPP access is
forbidden).
###### # 5.1.3.2.1.3.4 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION
The substate 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION is chosen in the UE if
the initial registration procedure failed due to a missing response from the
network or due to the circumstances described in subclauses 5.5.1.1,
5.5.1.2.4, 5.5.1.2.5 and 5.5.1.3.4.
###### # 5.1.3.2.1.3.5 5GMM-DEREGISTERED.PLMN-SEARCH
The substate 5GMM-DEREGISTERED.PLMN-SEARCH is chosen in the UE, if the UE is
searching for PLMNs. This substate is left either when a cell has been
selected (the new substate is NORMAL-SERVICE or LIMITED-SERVICE) or when it
has been concluded that no cell is available at the moment (the new substate
is NO-CELL-AVAILABLE).
This substate is not applicable to non-3GPP access.
###### # 5.1.3.2.1.3.6 5GMM-DEREGISTERED.NO-SUPI
The substate 5GMM-DEREGISTERED.NO-SUPI is chosen in the UE, if the N1 mode is
enabled and the UE has no valid subscriber data available (SIM/USIM not
available, the SIM/USIM is considered invalid by the UE).
###### # 5.1.3.2.1.3.7 5GMM-DEREGISTERED.NO-CELL-AVAILABLE
No 5G cell can be selected. This substate is entered after a first intensive
search failed when in substate 5GMM-DEREGISTERED.PLMN-SEARCH. Cells are
searched for at a low rhythm. No 5GS services are offered.
This substate is not applicable to non-3GPP access.
###### # 5.1.3.2.1.3.8 5GMM-DEREGISTERED.eCALL-INACTIVE
The substate 5GMM-DEREGISTERED.eCALL-INACTIVE is chosen in the UE when:
a) the UE is configured for eCall only mode as specified in 3GPP TS 31.102
[22];
b) timer T3444 and timer T3445 have expired or are not running;
c) a PLMN has been selected as specified in 3GPP TS 23.122 [5];
d) the UE does not need to perform an eCall over IMS; and
e) the UE does not need to perform a call to a non-emergency MSISDN or URI for
test or terminal reconfiguration service.
In this substate, the UE shall not initiate any signalling towards the
network, except to originate an eCall over IMS, or a call to a non-emergency
MSISDN or URI for test or terminal reconfiguration service.
This substate is not applicable to non-3GPP access.
###### # 5.1.3.2.1.3.9 5GMM-DEREGISTERED.INITIAL-REGISTRATION-NEEDED
Valid subscriber data are available for the UE and for some reason a
registration procedure for initial registration has to be performed as soon as
possible. This substate can be entered if the access is barred due to unified
access control, (see subclause 4.5.4) or if the network rejects the N1 NAS
signalling connection establishment.
###### 5.1.3.2.1.4 Substates of state 5GMM-REGISTERED
###### # 5.1.3.2.1.4.1 General
The state 5GMM-REGISTERED is subdivided into a number of substates as
described in this subclause. The following substates are not applicable to
non-3GPP access:
a) 5GMM-REGISTERED.PLMN-SEARCH:
b) 5GMM-REGISTERED.NON-ALLOWED-SERVICE; and
c) 5GMM-REGISTERED.NO-CELL-AVAILABLE.
###### # 5.1.3.2.1.4.2 5GMM-REGISTERED.NORMAL-SERVICE
The substate 5GMM-REGISTERED.NORMAL-SERVICE is chosen by the UE as the primary
substate when the UE enters the state 5GMM-REGISTERED, and for 3GPP access,
the cell the UE selected is known to be in an allowed area.
###### # 5.1.3.2.1.4.3 5GMM-REGISTERED.NON-ALLOWED-SERVICE
The substate 5GMM-REGISTERED.NON-ALLOWED-SERVICE is chosen in the UE, if the
cell the UE selected is known to be in a non-allowed area.
This substate is not applicable to non-3GPP access.
###### # 5.1.3.2.1.4.4 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE
The substate 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE is chosen by the
UE if the registration procedure for mobility and periodic registration update
failed due to a missing response from the network, or due to the circumstances
described in subclauses 5.3.9 and 5.5.1.3.5. No 5GMM procedure except
registration procedure for mobility and periodic registration update (i.e. the
5GS registration type IE set to \"mobility registration updating\" in the
REGISTRATION REQUEST message) shall be initiated by the UE in this substate.
No data shall be sent or received.
NOTE: The registration procedure for mobility and periodic registration update
over non-3GPP access can be triggered by, e.g. the change of S1 UE network
capability or renegotiating some parameters.
###### # 5.1.3.2.1.4.5 5GMM-REGISTERED.LIMITED-SERVICE
The substate 5GMM-REGISTERED.LIMITED-SERVICE is chosen in the UE, if the cell
the UE selected is known not to be able to provide normal service.
###### # 5.1.3.2.1.4.6 5GMM-REGISTERED.PLMN-SEARCH
The substate 5GMM-REGISTERED.PLMN-SEARCH is chosen in the UE, while the UE is
searching for PLMNs.
This substate is not applicable to non-3GPP access.
###### # 5.1.3.2.1.4.7 5GMM-REGISTERED.NO-CELL-AVAILABLE
5G coverage has been lost or MICO mode is active in the UE. If MICO mode is
active, the UE can deactivate MICO mode at any time by activating the AS layer
when the UE needs to send mobile originated signalling or user data.
Otherwise, the UE shall not initiate any 5GMM procedure except for cell and
PLMN reselection.
This substate is not applicable to non-3GPP access.
###### # 5.1.3.2.1.4.8 5GMM-REGISTERED.UPDATE-NEEDED
This state can be entered if the access is barred due to unified access
control when in 3GPP access, if the network rejects the N1 NAS signalling
connection establishment when in 3GPP access or in non-3GPP access or if the
UE in 5GMM-CONNECTED mode with RRC inactive indication receives an indication
from the lower layers that the resumption of the RRC connection has failed
(see subclause 5.3.1.4). For 3GPP access, the UE has to perform a registration
procedure for mobility and periodic registration update, but access to the
current cell is barred.
No 5GMM procedure except:
\- registration procedure for mobility and periodic registration update;
\- service request procedure as a response to paging or notification
shall be initiated by the UE in this substate.
##### 5.1.3.2.2 5GS update status in the UE
In order to describe the detailed UE behaviour, the 5GS update (5U) status
pertaining to a specific subscriber is defined.
The 5GS update status is stored in a non-volatile memory in the USIM if the
corresponding file is present in the USIM, else in the non-volatile memory in
the ME, as described in annex C.
The 5GS update status value is changed only after the execution of a
registration, network-initiated de-registration, 5GS based primary
authentication and key agreement, service request or paging procedure.
5U1: UPDATED
The last registration attempt was successful.
5U2: NOT UPDATED
The last registration attempt failed procedurally, e.g. no response or reject
message was received from the AMF.
5U3: ROAMING NOT ALLOWED
The last registration, service request, or registration for mobility or
periodic registration update attempt was correctly performed, but the answer
from the AMF was negative (because of roaming or subscription restrictions).
##### 5.1.3.2.3 5GMM sublayer states in the network side
###### 5.1.3.2.3.1 General
In the following subclauses, the possible 5GMM sublayer states of the network
are described and shown in Figure 5.1.3.2.3.1.1.
NOTE: Not all possible transitions are shown in this figure.
Figure 5.1.3.2.3.1.1: 5GMM main states in the network
###### 5.1.3.2.3.2 5GMM-DEREGISTERED
In the state 5GMM-DEREGISTERED, no 5GMM context has been established or the
5GMM context is marked as deregistered. The UE is deregistered. The network
may answer to an initial registration procedure initiated by the UE. The
network may also answer to a de-registration procedure initiated by the UE.
###### 5.1.3.2.3.3 5GMM-COMMON-PROCEDURE-INITIATED
The network enters the state 5GMM-COMMON-PROCEDURE-INITIATED, after it has
started a common 5GMM procedure and is waiting for a response from the UE.
###### 5.1.3.2.3.4 5GMM-REGISTERED
In the state 5GMM-REGISTERED, a 5GMM context has been established.
Additionally, one or more PDU session(s) may be established at the network.
###### 5.1.3.2.3.5 5GMM-DEREGISTERED-INITIATED
The network enters the state 5GMM-DEREGISTERED-INITIATED after it has started
a de-registration procedure and is waiting for a response from the UE.
### 5.1.4 Coordination between 5GMM and EMM
#### 5.1.4.1 General
If both 5GMM and EMM are enabled, a UE, operating in single-registration mode,
shall maintain one common registration for 5GMM and EMM.
Coordination between 5GMM and EMM for a UE, which is capable of N1 mode and S1
mode and operates in dual-registration mode, is not needed, except as
specified in subclause 4.8.3.
The coordination between 5GMM and EMM in subclauses 5.1.4.2 and 5.1.4.3 only
applies to the UEs operating in single-registration mode.
#### 5.1.4.2 Coordination between 5GMM and EMM with N26 interface
A UE that is not registered shall be in state EMM-DEREGISTERED and state 5GMM-
DEREGISTERED.
In N1 mode, upon successful completion of a registration procedure, the UE
operating in single-registration mode shall enter substates 5GMM-
REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE. The UE shall
reset the registration attempt counter and the attach attempt counter (see
3GPP TS 24.301 [15]).
At inter-system change from S1 mode to N1 mode, the UE shall enter substates
5GMM-REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE and
initiate a registration procedure for mobility and peirodic registration
update indicating \"mobility registration updating\" in the 5GS registration
type IE of the REGISTRATION REQUEST message (see subclause 5.5.1.3).
In S1 mode, upon successful completion of an attach or tracking area updating
procedure, the UE operating in single-registration mode shall enter substates
5GMM-REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE. The UE
shall reset the registration attempt counter and the attach attempt counter
(see 3GPP TS 24.301 [15]).
At inter-system change from N1 mode to S1 mode when there is no active PDU
session for which interworking with EPS is supported as specified in subclause
6.1.4.1, and EMM-REGISTERED without PDN connection is not supported by the UE
or the MME, the UE shall enter state 5GMM-DEREGISTERED and state EMM-
DEREGISTERED and then initiate the EPS attach procedure. If EMM-REGISTERED
without PDN connection is supported by the UE and the MME, the UE shall enter
substates EMM-REGISTERED.NORMAL-SERVICE and 5GMM-REGISTERED.NO-CELL-AVAILABLE
and initiate a tracking area updating procedure.
At inter-system change from N1 mode to S1 mode when there is at least one
active PDU session for which interworking with EPS is supported as specified
in subclause 6.1.4.1, the UE shall enter substates EMM-REGISTERED.NORMAL-
SERVICE and 5GMM-REGISTERED.NO-CELL-AVAILABLE and initiate a tracking area
updating procedure (see 3GPP TS 24.301 [15]).
#### 5.1.4.3 Coordination between 5GMM and EMM without N26 interface
A UE operating in the single-registration mode that is not registered shall be
in state EMM-DEREGISTERED and in state 5GMM-DEREGISTERED.
In N1 mode, upon successful completion of a registration procedure, the UE
operating in the single-registration mode shall enter substates 5GMM-
REGISTERED.NORMAL-SERVICE and EMM-REGISTERED.NO-CELL-AVAILABLE.
At inter-system change from N1 mode to S1 mode in 5GMM-IDLE mode, the UE shall
behave as specified in subclause 4.8.2.3.
In S1 mode, upon successful completion of an attach or tracking area updating
procedure, the UE operating in the single-registration mode shall enter
substates 5GMM-REGISTERED.NO-CELL-AVAILABLE and EMM-REGISTERED.NORMAL-SERVICE.
At inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE
operating in the single-registration mode shall enter substates EMM-
REGISTERED.NO-CELL-AVAILABLE and 5GMM- REGISTERED.NORMAL-SERVICE and then
initiate the registration procedure for mobility and periodic registration
update indicating \"mobility registration updating\" in the 5GS registration
type IE of the REGISTRATION REQUEST message (see subclause 5.5.1.3).
## 5.2 Behaviour of the UE in state 5GMM-DEREGISTERED and state 5GMM-
REGISTERED
### 5.2.1 General
In this subclause, the detailed behaviour of the UE in the states 5GMM-
DEREGISTERED and 5GMM-REGISTERED is described.
### 5.2.2 UE behaviour in state 5GMM-DEREGISTERED
#### 5.2.2.1 General
The state 5GMM-DEREGISTERED is entered in the UE, when:
a) the de-registration is performed either by the UE or by the network (see
subclause 5.5.2);
b) the registration request is rejected by the AMF (see subclause 5.5.1.2.5
and 5.5.1.3.5);
c) the service request is rejected by the AMF (see subclause 5.6.1); or
d) the UE is switched on.
In state 5GMM-DEREGISTERED, the UE shall behave according to the substate as
explained in subclause 5.2.2.3.
#### 5.2.2.2 Primary substate selection
##### 5.2.2.2.1 Selection of the substate after power on
For a UE configured for eCall only mode as specified in 3GPP TS 31.102 [22],
timers T3444 and T3445 are considered to have expired at power on. When the UE
is switched on, the substate shall be PLMN-SEARCH if the USIM is available and
valid. See 3GPP TS 23.122 [5] for further details.
The substate chosen after PLMN-SEARCH, following power on is:
a) if no cell can be selected, the substate shall be NO-CELL-AVAILABLE;
b) if no USIM is present, the substate shall be NO-SUPI;
c) if a suitable cell has been found, the PLMN identity of the cell is not in
one of the forbidden PLMN lists, and the tracking area is not in one of the
lists of 5GS forbidden tracking areas, then the substate shall be NORMAL-
SERVICE;
d) if the selected cell is known not to be able to provide normal service,
then the UE shall enter the substate LIMITED-SERVICE;
e) if the UE is in manual network selection mode and no cell of the selected
PLMN has been found, the UE shall enter the substate NO-CELL-AVAILABLE; and
f) if the UE is configured for eCall only mode as specified in 3GPP TS 31.102
[22], the substate shall be eCALL-INACTIVE.
#### 5.2.2.3 Detailed description of UE behaviour in state 5GMM-DEREGISTERED
##### 5.2.2.3.1 NORMAL-SERVICE
The UE shall initiate an initial registration procedure if the timer T3346 is
not running. If timer T3346 is running, the UE shall initiate an initial
registration procedure on the expiry of timer T3346.
##### 5.2.2.3.2 LIMITED-SERVICE
The UE shall initiate an initial registration procedure when entering a cell
which provides normal service.
The UE may initiate initial registration for emergency services.
##### 5.2.2.3.3 ATTEMPTING-REGISTRATION
The UE in 3GPP access:
a) shall initiate an initial registration procedure on the expiry of timers
T3502, T3511 or T3346;
b) may initiate an initial registration procedure for emergency services even
if timer T3346 is running;
c) shall initiate an initial registration procedure when entering a new PLMN,
if timer T3346 is running and the new PLMN is not equivalent to the PLMN where
the UE started timer T3346, the PLMN identity of the new cell is not in the
forbidden PLMN lists and the tracking area is not in one of the lists of 5GS
forbidden tracking areas;
d) shall initiate an initial registration procedure when the tracking area of
the serving cell has changed, if timer T3346 is not running, the PLMN identity
of the new cell is not in one of the forbidden PLMN lists and the tracking
area of the new cell is not in one of the lists of 5GS forbidden tracking
areas; and
e) shall initiate an initial registration procedure if the 5GS update status
is set to 5U2 NOT UPDATED, and timers T3511, T3502 and T3346 are not running.
The UE in non-3GPP access:
a) shall initiate an initial registration procedure on the expiry of timers
T3502, T3511 or T3346;
b) may initiate an initial registration procedure for emergency services even
if timer T3346 is running;
c) shall initiate an initial registration procedure when entering a new PLMN,
if timer T3346 is running and the new PLMN is not equivalent to the PLMN where
the UE started timer T3346; and
d) shall initiate an initial registration procedure if the 5GS update status
is set to 5U2 NOT UPDATED, and timers T3511, T3502 and T3346 are not running.
##### 5.2.2.3.4 PLMN-SEARCH
The UE shall perform PLMN selection. If a new PLMN is selected, the UE shall
reset the registration attempt counter and initiate the registration procedure
for initial registration (see subclause 5.5.1.2.2).
If the selected cell is known not to be able to provide normal service, the UE
may initiate the registration procedure for initial registration for emergency
services.
##### 5.2.2.3.5 NO-SUPI
The UE may initiate the registration procedure for initial registration for
emergency services.
##### 5.2.2.3.6 NO-CELL-AVAILABLE
The UE shall perform cell selection and choose an appropriate substate when a
cell is found.
##### 5.2.2.3.7 eCALL-INACTIVE
The UE camps on a suitable cell or an acceptable cell in a PLMN selected as
specified in 3GPP TS 23.122 [5] but initiates no 5GMM signalling with the
network and ignores any paging requests.
The UE shall leave substate EMM-DEREGISTERED.eCALL-INACTIVE state only when
one of the following events occur:
a) if the USIM is removed, the UE enters substate 5GMM-DEREGISTERED.NO-SUPI;
b) if coverage is lost, the UE enters substate 5GMM-DEREGISTERED.PLMN-SEARCH;
c) if the UE is deactivated (e.g. powered off) by the user, the UE enters
state 5GMM-NULL;
d) if the UE receives a request from upper layers to establish an eCall over
IMS, the UE enters state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION. The UE
then uses the relevant 5GMM and 5GSM procedures to establish the eCall over
IMS at the earliest opportunity; or
e) if the UE receives a request from upper layers to establish a call to an
HPLMN designated non-emergency MSISDN or URI for test or terminal
reconfiguration service, the UE enters state 5GMM-DEREGISTERED.ATTEMPTING-
REGISTRATION. Once the registration procedure is completed, the UE uses the
relevant 5GMM and 5GSM procedures to establish the non-emergency call.
#### 5.2.2.4 Substate when back to state 5GMM-DEREGISTERED from another 5GMM
state
When returning to state 5GMM-DEREGISTERED, the UE shall select a cell as
specified in 3GPP TS 38.304 [28].
The substate depends on the result of the cell selection procedure, the
outcome of the previously performed 5GMM specific procedures, on the 5GS
update status of the UE, on the tracking area data stored in the UE, on the
presence of the USIM, on the UE configuration and on the reason for moving to
5GMM-DEREGISTERED:
a) If no cell has been found, the substate is NO-CELL-AVAILABLE, until a cell
is found;
b) If no USIM is present or if the inserted USIM is considered invalid by the
UE, the substate shall be NO-SUPI;
c) If a suitable cell has been found and the PLMN or tracking area is not in
one of the lists of 5GS forbidden tracking areas, the substate shall be
NORMAL-SERVICE;
d) If a registration shall be performed (e.g. network-requested re-
registration), the substate shall be ATTEMPTING-REGISTRATION;
e) If a PLMN reselection (according to 3GPP TS 23.122 [5]) is needed, the
substate shall be PLMN-SEARCH;
f) If the selected cell is known not to be able to provide normal service, the
substate shall be LIMITED-SERVICE; and
g) If the UE is configured for eCall only mode as specified in 3GPP TS 31.102
[22], T3444 and T3445 have expired or are not running, and substate PLMN-
SEARCH is not required, the substate shall be eCALL-INACTIVE.
### 5.2.3 UE behaviour in state 5GMM-REGISTERED
#### 5.2.3.1 General
The state 5GMM-REGISTERED is entered at the UE, when:
the initial registration procedure is performed by the UE (see subclause
5.5.1.2.2).
In state 5GMM-REGISTERED, the UE shall behave according to the substate as
explained in subclause 5.2.3.2.
#### 5.2.3.2 Detailed description of UE behaviour in state 5GMM-REGISTERED
##### 5.2.3.2.1 NORMAL-SERVICE
The UE:
a) shall initiate the mobility or the periodic registration update procedure
(according to conditions given in subclause 5.5.1.3.2), except that the
periodic registration update procedure shall not be initiated over non-3GPP
access;
b) shall initiate the service request procedure (according to conditions given
in subclause 5.6.1);
c) shall respond to paging; and
d) if configured for eCall only mode as specified in 3GPP TS 31.102 [22],
shall perform the eCall inactivity procedure at expiry of timer T3444 or timer
T3445 (see subclause 5.5.3).
NOTE: Paging is not supported over non-3GPP access.
##### 5.2.3.2.2 NON-ALLOWED-SERVICE
The UE shall behave as specified in subclause 5.3.5.
##### 5.2.3.2.3 ATTEMPTING-REGISTRATION-UPDATE
The UE in 3GPP access:
a) shall not send any user data;
b) shall initiate a registration procedure for mobility and periodic
registration update on the expiry of timers T3502, T3511 or T3346;
c) shall initiate a registration procedure for mobility and periodic
registration update when entering a new PLMN, if timer T3346 is running and
the new PLMN is not equivalent to the PLMN where the UE started timer T3346,
the PLMN identity of the new cell is not in the forbidden PLMN lists, and the
tracking area is not in one of the lists of 5GS forbidden tracking areas;
d) shall initiate a registration procedure for mobility and periodic
registration update when the tracking area of the serving cell has changed, if
timer T3346 is not running, the PLMN identity of the new cell is not in one of
the forbidden PLMN lists and the tracking area is not in one of the lists of
5GS forbidden tracking areas;
e) may initiate a registration procedure for mobility and periodic
registration update upon request of the upper layers to establish an emergency
PDU session;
f) may perform de-registration locally and initiate a registration procedure
for initial registration for emergency services even if timer T3346 is
running;
g) shall initiate registration procedure for mobility and periodic
registration update upon reception of paging, or upon reception of
NOTIFICATION message with access type indicating 3GPP access;
h) may initiate a registration procedure for mobility and periodic
registration update upon request for an MMTEL voice call or MMTEL video call
from the upper layers, if timer T3346 is not running;
i) shall initiate a registration procedure for mobility and periodic
registration update if the 5GS update status is set to 5U2 NOT UPDATED, and
timers T3511, T3502 and T3346 are not running;
j) if configured for eCall only mode as specified in 3GPP TS 31.102 [22],
shall perform the eCall inactivity procedure at expiry of timer T3444 or timer
T3445 (see subclause 5.5.3); and
k) shall not initiate de-registration procedure unless timer T3346 is running
and the current TAI is part of the TAI list.
The UE in non-3GPP access:
a) shall not send any user data;
b) shall initiate the registration procedure for mobility and periodic
registration update on the expiry of timers T3502, T3511 or T3346;
c) may initiate a registration procedure for mobility registration update upon
request of the upper layers to establish an emergency PDU session;
d) may perform de-registration locally and initiate a registration procedure
for initial registration for emergency services even if timer T3346 is
running;
e) may initiate a registration procedure for mobility and periodic
registration update upon request for an MMTEL voice call or MMTEL video call
from the upper layers, if timer T3346 is not running;
f) shall initiate a registration procedure for mobility and periodic
registration update if the 5GS update status is set to 5U2 NOT UPDATED, and
timers T3511, T3502 and T3346 are not running; and
g) shall not initiate de-registration procedure unless timer T3346 is running.
##### 5.2.3.2.4 LIMITED-SERVICE
The UE:
a) shall perform cell selection/reselection;
b) may initiate an initial registration for emergency services; and
c) if configured for eCall only mode as specified in 3GPP TS 31.102 [22],
shall perform the eCall inactivity procedure at expiry of timer T3444 or timer
T3445 (see subclause 5.5.3).
##### 5.2.3.2.5 PLMN-SEARCH
The UE shall perform PLMN selection. If a new PLMN is selected, the UE shall
reset the registration attempt counter and initiate the initial registration
procedure (see subclause 5.5.1.2).
If the selected cell is known not to be able to provide normal service, the UE
may initiate an initial registration for emergency services.
##### 5.2.3.2.6 NO-CELL-AVAILABLE
The UE shall perform cell selection and choose an appropriate substate when a
cell is found.
## 5.3 General on elementary 5GMM procedures
### 5.3.1 5GMM modes and N1 NAS signalling connection
#### 5.3.1.1 Establishment of the N1 NAS signalling connection
When the UE is in 5GMM-IDLE mode over 3GPP access and needs to transmit an
initial NAS message, the UE shall request the lower layer to establish an RRC
connection. Upon indication from the lower layers that the RRC connection has
been established, the UE shall consider that the N1 NAS signalling connection
over 3GPP access is established and enter 5GMM-CONNECTED mode over 3GPP
access.
When the UE is in 5GMM-IDLE mode over non-3GPP access, and the UE receives an
indication from the lower layers of access stratum connection establishment,
the UE shall consider the N1 NAS signalling connection established enter 5GMM-
CONNECTED mode over non-3GPP access and send an initial NAS message.
Initial NAS messages are:
a) REGISTRATION REQUEST message;
b) DEREGISTRATION REQUEST message; and
c) SERVICE REQUEST message.
If the UE is capable of both N1 mode and S1 mode and lower layers provide an
indication that the current E-UTRA cell is connected to both EPC and 5GCN, for
the routing of the REGISTRATION REQUEST message during the initial
registration procedure to the appropriate core network (EPC or 5GCN), the UE
NAS provides the lower layers with the selected core network type information.
For the routing of the initial NAS message to the appropriate AMF, if the UE
holds a 5G-GUTI or 4G-GUTI, the UE NAS provides the lower layers with either
the 5G-S-TMSI or the registered GUAMI, or neither the 5G-S-TMSI nor registered
GUAMI according to the following rules:
a) if the registration procedure for mobility and periodic update was
triggered due to the last CONFIGURATION UPDATE COMMAND message that indicates
\"registration requested\" including:
1) no other parameters;
2) one or both of the Allowed NSSAI IE and the Configured NSSAI IE; or
3) the Network slicing indication IE with the Network slicing subscription
change indication set to \"Network slicing subscription changed\"
the UE NAS shall not provide the lower layers with the 5G-S-TMSI or the
registered GUAMI;
b) if the service request procedure was initiated over non-3GPP access, the UE
NAS shall provide the lower layers with the registered GUAMI, but shall not
provide the lower layers with the 5G-S-TMSI;
c) if the initial NAS message other than the SERVICE REQUEST message was
initiated over non-3GPP access, the UE NAS shall provide the lower layers with
the GUAMI of the 5G-GUTI that the UE NAS has selected as specified in the
subclause 5.5.1.2.2 and 5.5.1.3.2, but shall not provide the lower layers with
the 5G-S-TMSI;
d) if the UE does not hold a 5G-GUTI that was previously assigned by the same
PLMN with which the UE is performing the registration procedure and if :
1) the UE operating in the single-registration mode performs a registration
procedure for mobility and periodic update indicating \"mobility registration
updating\" following an inter-system change from S1 mode to N1 mode; or
2) the UE which was previously registered in S1 mode before entering state
EMM-DEREGISTERED, performs an initial registration procedure, the UE has
received the interworking without N26 interface indicator set to
\"interworking without N26 interface not supported\" from the network, and the
UE holds a 4G-GUTI;
then the UE NAS provides the lower layers with a GUAMI part of the 5G-GUTI
mapped from 4G-GUTI as specified in 3GPP TS 23.003 [4] with an indication that
the GUAMI is mapped from EPS; or
e) otherwise:
1) if the tracking area of the current cell is in the registration area, the
UE NAS shall provide the lower layers with the 5G-S-TMSI, but shall not
provide the registered GUAMI to the lower layers; or
2) if the tracking area of the current cell is not in the registration area,
the UE NAS shall provide the lower layers with the GUAMI of the 5G-GUTI that
the UE NAS has selected as specified in the subclause 5.5.1.2.2 and 5.5.1.3.2,
but shall not provide the lower layers with the 5G-S-TMSI.
If the UE does not hold a 5G-GUTI and the UE does not hold a 4G-GUTI, the UE
NAS does not provide the lower layers with the 5G-S-TMSI or the registered
GUAMI.
The UE NAS also provides the lower layers with the identity of the selected
PLMN (see 3GPP TS 38.331 [30]). In a shared network, the UE shall choose one
of the PLMN identities as specified in 3GPP TS 23.122 [5].
#### 5.3.1.2 Re-establishment of the N1 NAS signalling connection
When the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback
indication from lower layers, and the UE has no pending NAS procedure and no
pending uplink user data for PDU session(s) with user-plane resources already
established, the UE shall:
a) enter 5GMM-IDLE mode; and
b) initiate the registration procedure for mobility and periodic registration
update and include the Uplink data status IE in the REGISTRATION REQUEST
message indicating the PDU session(s) for which user-plane resources were
active prior to receiving the fallback indication, if any (see subclause
5.5.1.3 for further details).
When the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback
indication from lower layers, and the UE has pending uplink user data for PDU
session(s) with user-plane resources already established but no pending NAS
procedure, the UE shall:
a) enter 5GMM-IDLE mode; and
b) initiate the service request procedure and include the Uplink data status
IE in the SERVICE REQUEST message indicating the PDU session(s) for which
user-plane resources were active prior to receiving the fallback indication
(see subclause 5.6.1 for further details).
When the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback
indication from lower layers, and the UE has a pending registration procedure,
a service request procedure, or a de-registration procedure, the UE shall:
a) enter 5GMM-IDLE mode;
b) proceed with the pending procedure; and
c) if the pending procedure is a service request or registration procedure,
the UE shall include the Uplink data status IE in the SERVICE REQUEST message,
or in the REGISTRATION REQUEST message, indicating the PDU session(s) for
which user-plane resources were not active prior to receiving a fallback
indication from the lower layers and the UE has pending user data to be sent
over 3GPP access, if any, and the PDU session(s) for which user-plane
resources were active prior to receiving the fallback indication, if any (see
subclauses 5.5.1.3 and 5.6.1 for further details).
When the UE in 5GMM-CONNECTED mode over 3GPP access receives a fallback
indication from lower layers, and the UE has a pending NAS procedure other
than a registration procedure, a service request procedure, or a de-
registration procedure, the UE shall:
a) enter 5GMM-IDLE mode;
b) initiate the service request procedure and include the Uplink data status
IE in the SERVICE REQUEST message indicating the PDU session(s) for which
user-plane resources were active prior to receiving the fallback indication,
if any (see subclause 5.6.1 for further details); and
c) upon successful service request procedure completion, proceed with any
pending procedure.
The cases above apply when the UE is in an allowed area or when the UE is not
in a non-allowed area.
When the UE:
a) is in a non-allowed area or is not in an allowed area;
b) is in 5GMM-CONNECTED mode over 3GPP access;
c) receives a fallback indication from lower layers; and
d) does not have signalling pending,
the UE shall:
a) enter 5GMM-IDLE mode; and
b) initiate the registration procedure for mobility and periodic registration
update. The UE shall not include the Uplink data status IE in the REGISTRATION
REQUEST message except if the PDU session for which user-plane resources were
active is an emergency PDU session, or if the UE is configured for high
priority access in the selected PLMN.
In the above cases when the UE receives a fallback indication from lower
layers, if the UE is in non-allowed area or not in allowed area, the UE shall
behave as specified in subclause 5.3.5.
#### 5.3.1.3 Release of the N1 NAS signalling connection
The signalling procedure for the release of the N1 NAS signalling connection
is initiated by the network.
In N1 mode, upon indication from lower layers that the access stratum
connection has been released, the UE shall enter 5GMM-IDLE mode and consider
the N1 NAS signalling connection released.
If the UE in 3GPP access is configured for eCall only mode as specified in
3GPP TS 31.102 [22] then:
\- if the N1 NAS signalling connection that was released had been established
for eCall over IMS, the UE shall start timer T3444; and
\- if the N1 NAS signalling connection that was released had been established
for a call to an HPLMN designated non-emergency MSISDN or URI for test or
terminal reconfiguration service, the UE shall start timer T3445.
To allow the network to release the N1 NAS signalling connection, the UE:
a) shall start the timer T3540 if the UE receives any of the 5GMM cause values
#7, #11, #12, #13, #15, #27, or #72;
b) shall start the timer T3540 for a UE in 3GPP access if:
1) the UE receives a REGISTRATION ACCEPT message;
2) the UE has set the Follow-on request indicator to 0 in the REGISTRATION
REQUEST message;
3) the UE has not included the Uplink data status IE in the REGISTRATION
REQUEST message, or the UE has included the Uplink data status IE in the
REGISTRATION REQUEST message but the REGISTRATION ACCEPT message indicates
that no user-plane resources of any PDU sessions are to be re-established;
4) the UE has not included the Allowed PDU session status IE or has included
the Allowed PDU session status IE indicating there is no PDU session(s) for
which the UE allowed the user-plane resource to be re-established over 3GPP
access in the REGISTRATION REQUEST message, or the UE has included the Allowed
PDU session status IE in the REGISTRATION REQUEST message but the REGISTRATION
ACCEPT message does not indicate that any user-plane resources of any PDU
sessions are to be re-established;
5) the registration procedure has been initiated in 5GMM-IDLE mode; and
6) the user-plane resources for PDU sessions have not been set up;
NOTE 1: The lower layers indicate when the user-plane resources for PDU
sessions are successfully established or released.
c) shall start the timer T3540 if the UE receives a REGISTRATION REJECT
message indicating:
the 5GMM cause value #9 or #10;
d) shall start the timer T3540 if the UE receives a SERVICE REJECT message
indicating:
the 5GMM cause value #9 or #10;
e) shall start the timer T3540 if:
1) the UE receives a CONFIGURATION UPDATE COMMAND message indicating
registration requested with:
i) either new allowed NSSAI information or new configured NSSAI information or
both included;
ii) the network slicing indication; or
iii) no other parameters;
2) the user-plane resources for PDU sessions have not been set up; and
3) no emergency PDU session has been established; or
f) shall start the timer T3540 if:
1) the UE receives a SERVICE ACCEPT message;
2) the UE has not included the Uplink data status IE in the SERVICE REQUEST
message, or the UE has included the Uplink data status IE in the SERVICE
REQUEST message but the SERVICE ACCEPT message indicates that no user-plane
resources of any PDU sessions are to be re-established;
3) the UE has not included the Allowed PDU session status IE or has included
the Allowed PDU session status IE indicating there is no PDU session(s) for
which the UE allowed the user-plane resource to be re-established over 3GPP
access in the SERVICE ACCEPT message, or the UE has included the Uplink data
status IE in the SERVICE REQUEST message but the SERVICE ACCEPT message does
not indicate that any user-plane resources of any PDU sessions are to be re-
established;
4) the service request procedure has been initiated in 5GMM-IDLE mode; and
5) the user-plane resources for PDU sessions have not been set up.
NOTE 2: The lower layers indicate when the user-plane resources for PDU
sessions are successfully established or released.
Upon expiry of T3540,
\- in cases a), b) and f), the UE shall locally release the established N1 NAS
signalling connection;
\- in cases c) and d) the UE shall locally release the established N1 NAS
signalling connection and the UE shall initiate the registration procedure as
described in subclause 5.5.1.3.5 or 5.6.1.5; or
\- in case e), the UE shall locally release the established N1 NAS signalling
connection and perform a new registration procedure as specified in subclause
5.5.1.3.2.
In case a),
\- upon receiving a request from upper layers to send NAS signalling
associated with emergency services fallback only for a UE in 3GPP access or
establishing an emergency PDU session, the UE shall stop timer T3540 and shall
locally release the N1 NAS signalling connection, before proceeding as
specified in subclause 5.5.1.
In case b) and f),
\- upon an indication from the lower layers that the user-plane resources for
PDU sessions are set up, the UE shall stop timer T3540 and may send uplink
signalling via the existing N1 NAS signalling connection or user data via user
plane. If the uplink signalling is associated with emergency services fallback
only for a UE in 3GPP access or establishing an emergency PDU session, the UE
shall stop timer T3540 and send the uplink signalling via the existing N1 NAS
signalling connection;
\- upon receipt of a DEREGISTRATION REQUEST message, the UE shall stop timer
T3540 and respond to the network-initiated de-registration request as
specified in subclause 5.5.2.3;
\- upon receiving a request from upper layers to send NAS signalling
associated with emergency services fallback only for a UE in 3GPP access or
establishing an emergency PDU session, the UE shall stop timer T3540 and shall
locally release the N1 NAS signalling connection, before proceeding as
specified in subclause 5.6.1; or
\- upon receiving a request from upper layers to send NAS signalling not
associated with emergency services fallback only for a UE in 3GPP access or
establishing an emergency PDU session, the UE shall wait for the local release
of the established N1 NAS signalling connection upon expiry of timer T3540 or
wait for timer T3540 being stopped, before initiating NAS signalling.
In case c) and d),
\- upon an indication from the lower layers that the access stratum connection
has been released, the UE shall stop timer T3540 and perform a new
registration procedure as specified in subclause 5.5.1.3.5 or 5.6.1.5.
\- upon receiving a request from upper layers to send NAS signalling
associated with emergency services fallback only for a UE in 3GPP access or
establishing an emergency PDU session, the UE shall stop timer T3540 and shall
locally release the N1 NAS signalling connection, before proceeding as
specified in subclause 5.5.1.
In case e),
\- upon an indication from the lower layers that the access stratum connection
has been released, the UE shall stop timer T3540 and perform a new
registration procedure as specified in subclause 5.5.1.3.2.
\- upon an indication from the lower layers that the user-plane resources for
PDU sessions are set up, the UE shall stop timer T3540 and may send user data
via user plane.
\- upon receiving a request from upper layers to send NAS signalling
associated with emergency services fallback only for a UE in 3GPP access or
establishing an emergency PDU session, the UE shall stop timer T3540 and shall
locally release the N1 NAS signalling connection, before proceeding as
specified in subclause 5.6.1.
#### 5.3.1.4 5GMM-CONNECTED mode with RRC inactive indication
This subclause is only applicable for UE\'s 5GMM mode over 3GPP access.
The UE is in 5GMM-CONNECTED mode with RRC inactive indication when the UE is
in:
a) 5GMM-CONNECTED mode over 3GPP access at the NAS layer; and
b) RRC_INACTIVE state at the AS layer (see 3GPP TS 38.300 [27]).
Unless stated otherwise, the UE behaviour in 5GMM-CONNECTED mode with RRC
inactive indication follows the UE behaviour in 5GMM-CONNECTED over 3GPP
access, except that:
a) the UE shall apply the mobility restrictions; and
b) the UE shall perform the PLMN selection procedures
as in 5GMM-IDLE mode over 3GPP access.
The UE shall transition from 5GMM-CONNECTED mode over 3GPP access to 5GMM-
CONNECTED mode with RRC inactive indication upon receiving an indication from
the lower layers that the RRC connection has been suspended.
If the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an
indication from the lower layers that the RRC connection has been suspended,
the UE shall stay in 5GMM-CONNECTED mode with RRC inactive indication.
Upon:
\- a trigger of a procedure which requires sending of a NAS message different
from a REGISTRATION REQUEST message with the NG-RAN-RCU bit of the 5GS update
type IE set to \"NG-RAN radio capability update needed\"; or
\- an uplink user data packet to be sent for a PDU session with suspended
user-plane resources;
the UE in 5GMM-CONNECTED mode with RRC inactive indication over 3GPP access
shall request the lower layers to transition to RRC_CONNECTED state (see 3GPP
TS 38.300 [27]).
Upon a trigger to send a REGISTRATION REQUEST message with the NG-RAN-RCU bit
of the 5GS update type IE set to \"NG-RAN radio capability update needed\",
the UE in 5GMM-CONNECTED mode with RRC inactive indication shall move to 5GMM-
IDLE mode over 3GPP access and proceed with the registration procedure for
mobility and periodic registration as specified in subclause 5.5.1.3.2.
The UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication
to 5GMM-CONNECTED mode over 3GPP access upon receiving an indication from the
lower layers that the UE has transitioned to RRC_CONNECTED state (see 3GPP TS
38.300 [27]).
NOTE 1: The AMF can be aware of the transition between 5GMM-CONNECTED mode and
5GMM-CONNECTED mode with RRC inactive indication for a UE (see 3GPP TS 23.502
[9]).
The UE shall trigger a transition from 5GMM-CONNECTED mode with RRC inactive
indication to 5GMM-IDLE mode upon selection of a PLMN that is not an
equivalent PLMN to the registered PLMN. The UE shall not trigger a transition
from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE mode upon
entering a new PLMN which is in the list of equivalent PLMNs.
When the UE in 5GMM-CONNECTED mode with RRC indication receives a fallback
indication from lower layers, and the UE has no pending NAS procedure and no
pending uplink user data for PDU session(s) with user-plane resources already
established, the UE shall:
a) enter 5GMM-IDLE mode; and
b) initiate the registration procedure for mobility and periodic registration
update and include the Uplink data status IE in the REGISTRATION REQUEST
message indicating the PDU session(s) for which user-plane resources were
active prior to receiving the fallback indication, if any (see subclause
5.5.1.3 for further details).
If the UE requests the lower layers to transition to RRC_CONNECTED state at
initiation of a registration procedure, a service request procedure or a de-
registration procedure, upon fallback indication from lower layers, the UE
shall:
\- enter 5GMM-IDLE mode;
\- proceed with the pending procedure; and
\- if the pending procedure is a service request or registration request
procedure, the UE shall include the Uplink data status IE in the SERVICE
REQUEST message, or in the REGISTRATION REQUEST message, indicating the PDU
session(s) without active user-plane resources for which the UE has pending
user data to be sent, if any, and the PDU session(s) for which user-plane
resources were active prior to receiving the fallback indication, if any (see
subclauses 5.5.1.3 and 5.6.1 for further details).
If the UE requests the lower layers to transition to RRC_CONNECTED state for
other reason than initiation of a registration procedure, or for other reason
than a service request procedure, or for other reason than a de-registration
procedure, upon fallback indication from lower layers, the UE shall:
\- enter 5GMM-IDLE mode;
\- initiate service request procedure and include the Uplink data status IE in
the SERVICE REQUEST message indicating the PDU session(s) for which user-plane
resources were active prior to receiving the fallback indication, if any (see
subclause 5.6.1 for further details); and
\- upon successful service request procedure completion, proceed with any
pending procedure.
If the UE in 5GMM-CONNECTED mode with RRC inactive indication receives a
fallback indication from lower layers, and the UE has pending uplink user data
for PDU session(s) with user-plane resources already established but no
pending NAS procedure, the UE shall:
\- enter 5GMM-IDLE mode; and
\- initiate the service request procedure and include the Uplink data status
IE in the SERVICE REQUEST message indicating the PDU session(s) for which
user-plane resources were active prior to receiving the fallback indication
(see subclause 5.6.1 for further details).
In the above cases when the UE receives a fallback indication from lower
layers, if the UE is in non-allowed area or not in allowed area, the UE shall
behave as specified in subclause 5.3.5.
If the UE in 5GMM-CONNECTED mode with RRC inactive indication receives an
indication from the lower layers that the resumption of the RRC connection has
failed, and:
a) if the lower layers indicate that access barring is applicable for all
access categories except categories 0 and 2, the UE shall:
1) stay in 5GMM-CONNECTED mode with RRC inactive indication;
b) else, the UE shall:
1) enter 5GMM-IDLE mode; and
2) initiate the registration procedure for mobility and periodic registration
update used for mobility (i.e. the 5GS registration type IE set to \"mobility
registration updating\" in the REGISTRATION REQUEST message) for N1 NAS
signalling connection recovery as specified in subclause 5.5.1.3.2.
NOTE 2: An indication from the lower layer that the RRC connection has been
released with cause \"RRC resume failure\" can be considered as an indication
that the resumption of the RRC connection has failed.
The UE shall transition from 5GMM-CONNECTED mode with RRC inactive indication
to 5GMM-IDLE mode over 3GPP access upon receiving from the lower layers:
a) indication of transition from RRC_INACTIVE state to RRC_IDLE state; or
b) indication of cell selection to E-UTRAN or another RAT that the UE
supports.
Upon receiving AMF paging indication from the lower layers, the UE shall
transition from 5GMM-CONNECTED mode with RRC inactive indication to 5GMM-IDLE
mode over 3GPP access and handle the AMF paging same as the paging request
received in the 5GMM-IDLE mode over 3GPP access as specified in subclause
5.6.1.
### 5.3.2 Permanent identifiers
A globally unique permanent identity, the 5G subscription permanent identifier
(SUPI), is allocated to each subscriber for 5GS-based services. The IMSI and
network specific identifier are valid SUPI types. When the SUPI contains a
network specific identifier, it shall take the form of a network access
identifier (NAI). The structure of the SUPI and its derivatives are specified
in 3GPP TS 23.003 [4].
The UE provides the SUPI to the network in concealed form. The SUCI is a
privacy preserving identifier containing the concealed SUPI. When the SUPI
contains a network specific identifier, the SUCI shall take the form of an NAI
as specified in 3GPP TS 23.003 [4].
A UE supporting N1 mode includes a SUCI:
a) in the REGISTRATION REQUEST message when the UE is attempting initial
registration procedure and a valid 5G-GUTI is not available; or
b) in the IDENTITY RESPONSE message, if the SUCI is requested by the network
during the identification procedure.
NOTE: If the home network has not provisioned the public key needed to
generate a SUCI, the UE uses \"null-scheme\" as specified in 3GPP TS 33.501
[24] to generate a SUCI which equals to the SUPI.
The UE shall use the \"null-scheme\" as specified in 3GPP TS 33.501 [24] to
generate the SUCI, if the following applies:
a) the UE performs a registration procedure for emergency services or
initiates a de-registration procedure before the registration procedure for
emergency services was completed successfully; and
b) the UE does not have a valid 5G-GUTI for the selected PLMN or it receives
an identity request for SUCI during any of the procedures of item a).
Each UE supporting NG-RAN contains a permanent equipment identifier (PEI) for
accessing 5GS-based services. In this release of the specification, the IMEI
and the IMEISV are the only PEI formats supported by 5GS. The structure of the
PEI and its formats are specified in 3GPP TS 23.003 [4].
A UE supporting NG-RAN includes a PEI:
a) when neither SUPI nor valid 5G-GUTI is available to use for emergency
services in the REGISTRATION REQUEST message with 5GS registration type IE set
to \"emergency registration\"; and
b) when the network requests the PEI by using the identification procedure, in
the IDENTITY RESPONSE message.
The AMF can request the PEI at any time by using the identification procedure.
### 5.3.3 Temporary identities
A globally unique temporary user identity for 5GS-based services, the 5G
globally unique temporary identity (5G-GUTI), is used for identification
within the signalling procedures. When the UE is registered to the same PLMN
over 3GPP and non-3GPP access, the UE and the AMF maintain one 5G-GUTI that is
common to both 3GPP and non-3GPP access. When the UE is registered to
different PLMNs over 3GPP access and non-3GPP access, the UE maintains two
5G-GUTIs, a 5G-GUTI for the registration with a PLMN over the 3GPP access and
another 5G-GUTI for the registration with another PLMN over the non-3GPP
access. In the paging and service request procedures, a shortened form of the
5G-GUTI, the 5G S-temporary mobile subscriber identity (5G-S-TMSI), is used to
enable more efficient radio signalling. The purpose of the 5G-GUTI and 5G-S-
TMSI is to provide identity confidentiality, i.e., to protect a user from
being identified and located by an intruder. The structure of the 5G-GUTI and
its derivatives are specified in 3GPP TS 23.003 [4]. The 5G-GUTI has two main
components (see 3GPP TS 23.501 [8]):
a) the GUAMI; and
b) the 5G-TMSI that provides an unambiguous identity of the UE within the
AMF(s) identified by the GUAMI.
The 5G-S-TMSI has three main components:
a) the AMF set ID that uniquely identifies the AMF set within the AMF region;
b) the AMF pointer that identifies one or more AMFs within the AMF set; and
c) the 5G-TMSI.
A UE supporting N1 mode includes a valid 5G-GUTI, if any is available, in the
REGISTRATION REQUEST and DEREGISTRATION REQUEST messages. In the SERVICE
REQUEST message, the UE includes a valid 5G-S-TMSI as user identity. The AMF
shall assign a new 5G-GUTI for a particular UE:
a) during a successful initial registration procedure;
b) during a successful registration procedure for mobility registration
update; and
c) after a successful service request procedure invoked as a response to a
paging request from the network and before the release of the N1 NAS
signalling connection as specified in subclause 5.4.4.1.
The AMF should assign a new 5G-GUTI for a particular UE during a successful
registration procedure for periodic registration update. The AMF may assign a
new 5G-GUTI at any time for a particular UE by performing the generic UE
configuration update procedure.
If a new 5G-GUTI is assigned by the AMF, the UE and the AMF handle the 5G-GUTI
as follows:
a) Upon receipt of a 5GMM message containing a new 5G-GUTI, the UE considers
the new 5G-GUTI as valid and the old 5G-GUTI as invalid, stops timer T3519 if
running, and deletes any stored SUCI. The new 5G-GUTI is stored in a non-
volatile memory in the USIM if the corresponding file is present in the USIM,
else in the non-volatile memory in the ME, as described in annex C.
b) The AMF considers the old 5G-GUTI as invalid as soon as an acknowledgement
for a registration or generic UE configuration update procedure is received.
### 5.3.4 Registration areas
Within the 5GS, the registration area is managed independently per access
type, i.e., 3GPP access or non-3GPP access. The AMF assigns a registration
area to the UE during the registration procedure. A registration area is
defined as a set of tracking areas and each of these tracking areas consists
of one or more cells that cover a geographical area. Tracking areas cannot
overlap each other. Within the 5GS, the concept of \"registration to multiple
tracking areas\" applies:
a) A tracking area is identified by a TAI which is broadcast in the cells of
the tracking area. The TAI is constructed from a TAC and a PLMN identifier. In
case of a shared network, one or more TAC and multiple PLMN identifiers are
broadcast.
b) In order to reduce the tracking area update signalling within the 5GS, the
AMF can assign several tracking areas to the UE. These tracking areas
construct a list of tracking areas which is identified by a TAI list. When
generating the TAI list, the AMF shall include only TAIs that are applicable
on the access where the TAI list is sent. The AMF shall be able to allocate a
TAI List over different NG-RAN access technologies.
c) The UE considers itself registered to a list of tracking areas and does not
need to trigger the registration procedure for mobility and periodic
registration update used for mobility (i.e. the 5GS registration type IE set
to \"mobility registration updating\" in the REGISTRATION REQUEST message) as
long as the UE stays in one of the tracking areas of the list of tracking
areas received from the AMF.
d) The UE will consider the TAI list as valid, until it receives a new TAI
list in the next registration procedure for mobility and periodic registration
update or generic UE configuration update procedure, or the UE is commanded by
the network to delete the TAI list by a reject message or it is deregistered
from the 5GS. If the registration request is accepted or the TAI list is
reallocated by the AMF, the AMF shall provide at least one entry in the TAI
list. If the new and the old TAI list are identical, the AMF does not need to
provide the new TAI list to the UE during mobility registration update or
periodic registration update.
e) The TAI list can be reallocated by the AMF.
f)- When the UE is deregistered from the 5GS, the TAI list in the UE is
invalid.
g) The AMF allocates one 5G-GUTI, which is common between 3GPP access and
non-3GPP access, to the UE when the UE is registered to the same PLMN over
both accesses.
h) The UE includes the last visited registered TAI, if available, to the AMF.
The last visited registered TAI is stored in a non-volatile memory in the USIM
if the corresponding file is present in the USIM, else in the non-volatile
memory in the ME, as described in annex C.
### 5.3.5 Service area restrictions
Service area restrictions are applicable only to 3GPP access.
The service area restrictions consist of tracking areas forming either an
allowed area, or a non-allowed area. The tracking areas belong to either the
registered PLMN or its equivalent PLMNs in the registration area. The allowed
area can contain up to 16 tracking areas or include all tracking areas in the
registered PLMN and its equivalent PLMN(s) in the registration area. The non-
allowed area can contain up to 16 tracking areas. The network conveys the
service area restrictions to the UE by including either an allowed area, or a
non-allowed area, but not both, in the Service area list IE of a REGISTRATION
ACCEPT message or a CONFIGURATION UPDATE COMMAND message.
If the network does not convey the service area restrictions to the UE in the
Service area list IE of a REGISTRATION ACCEPT message, the UE shall treat all
tracking areas in the registered PLMN and its equivalent PLMN(s) in the
registration area as allowed area and delete the stored list of \"allowed
tracking areas\" or the stored list of \"non-allowed tracking areas\"
When the UE receives a Service area list IE with an allowed area indication
during a registration procedure or a generic UE configuration update
procedure:
a) if the \"Type of list\" included in the Service area list IE does not
indicate \"all TAIs belonging to all PLMNs in the registration area are
allowed area\", the UE shall delete the old list of \"allowed tracking areas\"
and store the tracking areas in the allowed area as the list of \"allowed
tracking areas\". If the UE has a stored list of \"non-allowed tracking
areas\", the UE shall delete that list; or
b) if the \"Type of list\" included in the Service area list IE indicates
\"all TAIs belonging to all PLMNs in the registration area are allowed area\",
the UE shall treat all tracking areas in the registered PLMN and its
equivalent PLMN(s) as allowed area and delete the stored list of \"allowed
tracking areas\" or the stored list of \"non-allowed tracking areas\".
When the UE receives a Service area list IE with a non-allowed area indication
during a registration procedure or a generic UE configuration update
procedure, the UE shall delete the old list of \"non-allowed tracking areas\"
and store the tracking areas in the non-allowed area as the list of \"non-
allowed tracking areas\". If the UE has a stored list of \"allowed tracking
areas\", the UE shall delete that list.
If the UE is successfully registered to a PLMN and has a stored list of
\"allowed tracking areas\":
a) while camped on a cell whose TAI is in the list of \"allowed tracking
areas\", the UE shall stay or enter the state 5GMM-REGISTERED.NORMAL-SERVICE
and is allowed to initiate any 5GMM and 5GSM procedures; and
b) while camped on a cell which is in the registered PLMN or a PLMN from the
list of equivalent PLMNs and whose TAI is in the registration area and is not
in the list of \"allowed tracking areas\", the UE shall enter the state 5GMM-
REGISTERED.NON-ALLOWED-SERVICE, and:
1) if the UE is in 5GMM-IDLE mode over 3GPP access, the UE:
i) shall not perform the registration procedure for mobility and periodic
registration update with Uplink data status IE except for emergency services
or for high priority access; and
ii) shall not initiate a service request procedure except for emergency
services, high priority access, responding to paging or notification or
indicating a change of 3GPP PS data off UE status; and
2) if the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC
inactive indication over 3GPP access, the UE:
i) shall not perform the registration procedure for mobility and periodic
registration update with Uplink data status IE except for emergency services
or for high priority access; and
ii) shall not initiate a service request procedure except for emergency
services, high priority access or for responding to paging or notification
over non-3GPP access; and
iii) shall not initiate a 5GSM procedure except for emergency services, high
priority access or indicating a change of 3GPP PS data off UE status.
If the UE is successfully registered to a PLMN and has a stored list of \"non-
allowed tracking areas\":
a) while camped on a cell which is in the registered PLMN or a PLMN from the
list of equivalent PLMNs and whose TAI is not in the list of \"non-allowed
tracking areas\", the UE shall stay or enter the state 5GMM-REGISTERED.NORMAL-
SERVICE and is allowed to initiate any 5GMM and 5GSM procedures; and
b) while camped on a cell whose TAI is in the list of \"non-allowed tracking
areas\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE,
and:
1) if the UE is in 5GMM-IDLE mode over 3GPP access, the UE:
i) shall not perform the registration procedure for mobility and periodic
registration update with Uplink data status IE except for emergency services
or for high priority access; and
ii) shall not initiate a service request procedure except for emergency
services, high priority access, responding to paging or notification or
indicating a change of 3GPP PS data off UE status; and
2) if the UE is in 5GMM-CONNECTED mode or 5GMM-CONNECTED mode with RRC
inactive indication over 3GPP access, the UE:
i) shall not perform the registration procedure for mobility and registration
update with the Uplink data status IE except for emergency services or for
high priority access; and
ii) shall not initiate a service request procedure except for emergency
services, high priority access or for responding to paging or notification
over non-3GPP access; and
iii) shall not initiate a 5GSM procedure except for emergency services, high
priority access or indicating a change of 3GPP PS data off UE status.
The list of \"allowed tracking areas\", as well as the list of \"non-allowed
tracking areas\" shall be erased when:
a) the UE is switched off; and
b) the UICC containing the USIM is removed.
When a tracking area is added to the list of \"5GS forbidden tracking areas
for roaming\" or to the list of \"5GS forbidden tracking areas for regional
provision of service\" as specified in the subclauses 5.5.1.2.5 or 5.5.1.3.5,
the tracking area shall be removed from the list of \"allowed tracking areas\"
if the tracking area is already present in the list of \"allowed tracking
areas\" and from the list of \"non-allowed tracking areas\" if the tracking
area is already present in the list of \"non-allowed tracking areas\".
### 5.3.6 Mobile initiated connection only mode
The UE can request the use of mobile initiated connection only (MICO) mode
during the registration procedure (see 3GPP TS 23.501 [8] and 3GPP TS 23.502
[9]). The UE shall not request use of MICO mode over non-3GPP access.
Furthermore, the UE in 3GPP access shall not request the use of MICO mode
during:
a) a registration procedure for initial registration for emergency services
(see subclause 5.5.1.2);
b) a registration procedure for initial registration for initiating an
emergency PDU session (see subclause 5.5.1.2);
c) a registration procedure for mobility and periodic registration update (see
subclause 5.5.1.3) for initiating an emergency PDU session if the UE is in the
state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE; or
d) a registration procedure for mobility and periodic registration update (see
subclause 5.5.1.3) when the UE has an emergency PDU session established.
If the UE requests the use of MICO mode, the network can accept the use of
MICO mode by providing a MICO indication when accepting the registration
procedure. The UE may use MICO mode only if the network has provided the MICO
indication IE during the last registration procedure.
If the network accepts the use of MICO mode, the AMF may include an \"all PLMN
registration area allocated\" indication in the MICO indication IE to the UE.
If the network accepts the use of MICO mode, the UE may deactivate the AS
layer and activate MICO mode by entering the state 5GMM-REGISTERED.NO-CELL-
AVAILABLE if:
a) the UE is in 5GMM-IDLE mode for 3GPP access; and
b) in the 5GMM-REGISTERED.NORMAL-SERVICE state for 3GPP access.
When MICO mode is activated all NAS timers are stopped and associated
procedures aborted except for timers T3512, T3346, T3396, T3584, T3585, any
back-off timers, and the timer T controlling the periodic search for HPLMN or
EHPLMN or higher prioritized PLMNs (see 3GPP TS 23.122 [5]).
NOTE: When MICO mode is activated and if the UE is also registered over the
non-3GPP access, the AMF will not send a NOTIFICATION message with access type
indicating 3GPP access over the non-3GPP access for PDU sessions associated
with 3GPP access.
The UE may deactivate MICO mode and activate the AS layer at any time. Upon
deactivating MICO mode, the UE may initiate 5GMM procedures (e.g. for the
transfer of mobile originated signalling or user data).
When an emergency PDU session is successfully established after the MICO mode
was enabled, the UE and the AMF shall locally disable MICO mode. The UE and
the AMF shall not enable MICO mode until the AMF accepts the use of MICO mode
in the next registration procedure. To enable an emergency call back, the UE
should wait for a UE implementation-specific duration of time before
requesting the use of MICO mode after the release of the emergency PDU session
If the AMF accepts the use of MICO mode, the AMF starts the implicit de-
registration timer for 3GPP access when entering 5GMM-IDLE mode for 3GPP
access.
Upon successful completion of an attach procedure or tracking area updating
procedure after inter-system change from N1 mode to S1 mode (see 3GPP TS
24.301 [15]), the UE operating in single-registration mode shall locally
disable MICO mode. After inter-system change from S1 mode to N1 mode, the UE
operating in single-registration mode may re-negotiate MICO mode with the
network during the registration procedure for mobility and periodic
registration update.
### 5.3.7 Handling of the periodic registration update timer and mobile
reachable timer
The periodic registration update procedure is used over 3GPP access to
periodically notify the availability of the UE to the network. The procedure
is controlled in the UE by the periodic registration update timer, T3512.
If the UE is registered over the 3GPP access, the AMF maintains an implicit
de-registration timer to control when the UE is considered implicitly de-
registered over the 3GPP access. If the UE is registered over the non-3GPP
access, the AMF also maintains a non-3GPP implicit de-registration timer to
control when the UE is considered implicitly de-registered over the non-3GPP
access. The UE registered over the non-3GPP access maintains a non-3GPP de-
registration timer to control when the UE is considered implicitly de-
registered for the non-3GPP access.
The AMF shall start a non-3GPP implicit de-registration timer for the UE
registered over non-3GPP access when the N1 NAS signalling connection over
non-3GPP access is released.
The UE registered over non-3GPP access shall reset and start a non-3GPP de-
registration timer when the N1 NAS signalling connection over non-3GPP access
is released. The non-3GPP de-registration timer is stopped when the UE enters
5GMM-CONNECTED mode over non-3GPP access or the 5GMM-DEREGISTERED state over
non-3GPP access.
The non-3GPP implicit de-registration timer shall be longer than the non-3GPP
de-registration timer.
The value of timer T3512 is sent by the network to the UE in the REGISTRATION
ACCEPT message. The UE shall apply this value in all tracking areas of the
list of tracking areas assigned to the UE until a new value is received. The
periodic registration update timer only applies to the UE registered to the
5GS services over 3GPP access.
If timer T3512 received by the UE in a REGISTRATION ACCEPT message contains an
indication that the timer is deactivated or the timer value is zero, then
timer T3512 is deactivated and the UE shall not perform the periodic
registration update procedure.
NOTE: The UE does not perform the periodic registration update procedure for
non-3GPP access.
Timer T3512 is reset and started with its initial value, when the UE changes
from 5GMM-CONNECTED over 3GPP access to 5GMM-IDLE mode over 3GPP access. Timer
T3512 is stopped when the UE enters 5GMM-CONNECTED mode over 3GPP access or
the 5GMM-DEREGISTERED state over 3GPP access.
If the UE is registered for emergency services, and timer T3512 expires, the
UE shall not initiate a periodic registration update procedure, but shall
locally de-register from the network. When the UE is camping on a suitable
cell, it may re-register to regain normal service.
When a UE is not registered for emergency services, and timer T3512 expires,
the periodic registration update procedure shall be started.
If the UE is not registered for emergency services, and is in a state other
than 5GMM-REGISTERED.NORMAL-SERVICE over 3GPP access when timer T3512 expires,
the periodic registration update procedure is delayed until the UE returns to
5GMM-REGISTERED.NORMAL-SERVICE over 3GPP access.
The network supervises the periodic registration update procedure of the UE by
means of the mobile reachable timer.
If the UE is not registered for emergency services, the mobile reachable timer
shall be longer than the value of timer T3512. In this case, by default, the
mobile reachable timer is 4 minutes greater than the value of timer T3512.
The network behaviour upon expiry of the mobile reachable timer is network
dependent, but typically the network stops sending paging messages to the UE
on the first expiry, and may take other appropriate actions.
If the UE is registered for emergency services, the AMF shall set the mobile
reachable timer with a value equal to timer T3512. When the mobile reachable
timer expires, the AMF shall locally de-register the UE.
The mobile reachable timer shall be reset and started with the value as
indicated above, when the AMF releases the NAS signalling connection for the
UE. The mobile reachable timer shall be stopped when a NAS signalling
connection is established for the UE.
Upon expiry of the mobile reachable timer the network shall start the implicit
de-registration timer over 3GPP access. The value of the implicit de-
registration timer over 3GPP access is network dependent. If MICO is
activated, the default value of the implicit de-registration timer over 3GPP
access is 4 minutes greater than the value of timer T3512.
If the implicit de-registration timer expires before the UE contacts the
network, the network shall implicitly de-register the UE. The implicit de-
registration timer shall be stopped when a NAS signalling connection is
established for the UE.
If the non-3GPP implicit de-registration timer expires before the UE contacts
the network over the non-3GPP access, the network shall implicitly de-register
the UE and enter the state 5GMM-DEREGISTERED over non-3GPP access for the UE.
The non-3GPP implicit de-registration timer shall be stopped when a NAS
signalling connection over non-3GPP access is established for the UE.
If the non-3GPP de-registration timer expires before the UE contacts the
network over the non-3GPP access, the UE shall enter the state 5GMM-
DEREGISTERED over non-3GPP access. The non-3GPP de-registration timer shall be
stopped when a NAS signalling connection over non-3GPP access is established
for the UE.
If the AMF provides T3346 value IE in the DEREGISTRATION REQUEST message with
Access type set to \"Non-3GPP access\" in Deregistration type IE, REGISTRATION
REJECT message during a registration procedure for mobility and periodic
registration update or SERVICE REJECT message and the value of timer T3346is
greater than the value of timer T3512, the AMF sets the mobile reachable timer
and the implicit de-registration timer such that the sum of the timer values
is greater than the value of timer T3346.
If the AMF provides T3346 value IE in the DEREGISTRATION REQUEST message with
Access type set to \"3GPP access\" in Deregistration type IE, REGISTRATION
REJECT message during a registration procedure for mobility and periodic
registration update or SERVICE REJECT message and the value of timer T3346 is
greater than the value of the non-3GPP de-registration timer, the AMF sets the
non-3GPP implicit de-registration timer value to be 8 minutes greater than the
value of timer T3346.
If the UE receives T3346 value IE in the DEREGISTRATION REQUEST message with
Access type set to \"3GPP access\" in Deregistration type IE, REGISTRATION
REJECT message during a registration procedure for mobility and periodic
registration update or SERVICE REJECT message and the value of timer T3346 is
greater than the value of the non-3GPP de-registration timer, the UE sets the
non-3GPP de-registration timer value to be 4 minutes greater than the value of
timer T3346.
### 5.3.8 Handling of timer T3502
The value of timer T3502 can be sent by the network to the UE in the
REGISTRATION ACCEPT message. The UE shall apply this value in all tracking
areas of the registration area assigned to the UE, until a new value is
received.
The value of timer T3502 can be sent by the network to the UE in the
REGISTRATION REJECT message during the initial registration. If a REGISTRATION
REJECT message including timer T3502 value was received integrity protected,
the UE shall apply this value until a new value is received with integrity
protection or a new PLMN is selected. Otherwise, the default value of this
timer is used.
The default value of this timer is also used by the UE in the following cases:
a) REGISTRATION ACCEPT message is received without a value specified;
b) the UE does not have a stored value for this timer; or
c) a new PLMN which is not in the list of equivalent PLMNs has been entered,
the registration procedure fails, the registration attempt counter is equal to
5 and no REGISTRATION REJECT message was received from the new PLMN.
### 5.3.9 Handling of NAS level mobility management congestion control
The AMF may detect 5GMM signalling congestion and perform general NAS level
congestion control. Under the 5GMM signalling congestion conditions the AMF
may reject 5GMM signalling requests from UEs as specified in 3GPP TS 23.501
[8]. The AMF should not reject the following request:
a) requests for emergency services;
b) requests for emergency services fallback;
c) requests from UEs configured for high priority access in selected PLMN; and
d) DEREGISTRATION REQUEST message.
When general NAS level congestion control is active, the AMF may include a
value for the mobility management back-off timer T3346 in the reject messages.
The UE starts the timer T3346 with the value received in the 5GMM reject
messages. To avoid that large numbers of UEs simultaneously initiate deferred
requests, the AMF should select the value for the timer T3346 for the rejected
UEs so that timeouts are not synchronised.
If the UE is registered in the same PLMN over the 3GPP access and non-3GPP
access, and the UE receives the timer T3346 from the AMF, the timer T3346
shall apply to both 3GPP access and non-3GPP access.
If the timer T3346 is running when the UE enters state 5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then the
timer T3346 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3346 is running, the UE shall behave
as follows when the UE is switched on and the USIM in the UE remains the same:
let t1 be the time remaining for T3346 timeout at switch off and let t be the
time elapsed between switch off and switch on. If t1 is greater than t, then
the timer shall be restarted with the value t1 -- t. If t1 is equal to or less
than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If the UE enters a new PLMN while timer T3346 is running, and the new PLMN is
not equivalent to the PLMN where the UE started timer T3346, the UE shall stop
timer T3346 when initiating 5GMM procedures in the new PLMN.
After a change in registration area, if the timer T3346 is running and 5GS
update status is 5U1 UPDATED then the UE shall set the 5GS update status to
5U2 NOT UPDATED and enter state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-
UPDATE.
If timer T3346 is running or is deactivated, and the UE is a UE configured for
high priority access in selected PLMN, or the UE needs to initiate signalling
for emergency services or emergency services fallback, then the UE is allowed
to initiate 5GMM procedures.
### 5.3.10 Handling of DNN based congestion control
The AMF may detect and start performing DNN based congestion control when one
or more DNN congestion criteria as specified in 3GPP TS 23.501 [8] are met.
The AMF may store a DNN congestion back-off timer on a per UE and congested
DNN basis. If the UE does not provide a DNN for a non-emergency PDU session,
then the AMF uses the selected DNN or the DNN associated with the PDU session
corresponding to the 5GSM procedure.
When DNN based congestion control is activated at the AMF, the AMF performs
the congestion control as specified in subclause 5.4.5 and the UE performs the
congestion control as specified in subclause 5.4.5 and subclause 6.2.7.
### 5.3.11 Handling of S-NSSAI based congestion control
The AMF may detect and start performing S-NSSAI based congestion control when
one or more S-NSSAI congestion criteria as specified in 3GPP TS 23.501 [8] are
met. The AMF may store an S-NSSAI congestion back-off timer on a per UE,
congested S-NSSAI, and optionally DNN basis. If the UE does not provide a DNN
for a non-emergency PDU session, then the AMF uses the selected DNN or the DNN
associated with the PDU session corresponding to the 5GSM procedure. If the UE
does not provide an S-NSSAI for a non-emergency PDU session, then the AMF uses
the selected S-NSSAI or the S-NSSAI associated with the PDU session
corresponding to the 5GSM procedure.
When S-NSSAI based congestion control is activated at the AMF, the AMF
performs the congestion control as specified in subclause 5.4.5 and the UE
performs the congestion control as specified in subclause 5.4.5 and subclause
6.2.8.
### 5.3.12 Handling of local emergency numbers
The additional requirements in subclause 5.3.12A apply to a UE supporting
registration or attach procedures via 3GPP access and registration procedures
via non-3GPP access.
The network may send a local emergency numbers list or an extended local
emergency numbers list or both, in the REGISTRATION ACCEPT message, by
including the Emergency number list IE and the Extended emergency number list
IE, respectively. The Local emergency numbers list can be updated as described
in 3GPP TS 24.301 [15], subclause 5.3.7.
The user equipment shall store the local emergency numbers list and the
extended local emergency numbers list, as provided by the network. The local
emergency numbers list stored in the user equipment shall be replaced on each
receipt of the Emergency number list IE. The extended local emergency numbers
list stored in the user equipment shall be replaced on each receipt of the
Extended emergency number list IE. The received local emergency numbers list
or the received extended local emergency numbers list or both shall be
provided to the upper layers.
If a REGISTRATION ACCEPT message is received via non-3GPP access from a PLMN
in a country different from the current country of the UE, the UE shall keep
the stored local emergency numbers list and the extended local emergency
numbers list, if available.
The emergency number(s) received in the Emergency number list IE are valid
only in networks in the same country as the PLMN from which this IE is
received. If no Emergency number list IE is contained in the REGISTRATION
ACCEPT message, then the stored local emergency numbers list in the user
equipment shall be kept, except if the user equipment has successfully
registered to a PLMN in a country different from that of the PLMN that sent
the list.
The emergency number(s) received in the Extended emergency number list IE are
valid only in:
\- networks in the same country as the PLMN from which this IE is received, if
the Extended Emergency Number List Validity (EENLV) field within the Extended
emergency number list IE indicates \"Extended Local Emergency Numbers List is
valid in the country of the PLMN from which this IE is received\"; and
\- the PLMN from which this IE is received, if the EENLV field within the
Extended emergency number list IE indicates \"Extended Local Emergency Numbers
List is valid only in the PLMN from which this IE is received\".
If no Extended Local Emergency Numbers List is contained in the REGISTRATION
ACCEPT message, and the registered PLMN has not changed, then the stored
Extended Local Emergency Numbers List in the user equipment shall be kept. If
no Extended Local Emergency Numbers List is contained in the REGISTRATION
ACCEPT message, but the registered PLMN has changed, then:
\- if the last received indication in the EENLV field within the Extended
emergency number list IE indicates \"Extended Local Emergency Numbers List is
valid only in the PLMN from which this IE is received\", the stored Extended
Local Emergency Numbers List in the user equipment shall be deleted; and
\- if the last received indication in the EENLV field within the Extended
emergency number list IE indicates \"Extended Local Emergency Numbers List is
valid in the country of the PLMN from which this IE is received\" the list
shall be kept except if the user equipment has successfully registered to a
PLMN in a country different from that of the PLMN that sent the stored list.
NOTE: To prevent the misrouting of emergency calls, all operators within a
country need to follow the regulation or agree on the setting of the Extended
emergency number list IE in accordance to national agreement -- either to
indicate validity within a country or to indicate validity only within the
PLMN.
The local emergency numbers list and the extended local emergency numbers list
shall be deleted at switch off or removal of the USIM. The user equipment
shall be able to store up to ten entries in the local emergency numbers list
and up to twenty entries in the Extended local emergency numbers list,
received from the network.
For the use of the local emergency numbers list and the extended local
emergency numbers list by the UE see 3GPP TS 24.301 [15], subclause 5.3.7.
### 5.3.12A Handling of local emergency numbers received via 3GPP access and
non-3GPP access
#### 5.3.12A.1 General
The requirements in subclause 5.3.12 with the clarifications and additional
conditions in subclause 5.3.12A apply to a UE supporting:
\- attach procedures (see 3GPP TS 24.301 [15]) or registration procedures via
3GPP access; and
\- registration procedures via non-3GPP access.
The UE shall ignore the presence or absence of local emergency numbers list,
extended local emergency numbers list or both, in a REGISTRATION ACCEPT
message received via non-3GPP access, unless conditions in subclause 5.3.12A.2
are met.
For the purposes of subclause 5.3.12A, the UE is considered neither registered
nor attached over 3GPP access if:
1) the UE supports 3GPP access to EPC, the UE does not support 3GPP access to
5GC, and:
a) the EMM sublayer is in the EMM-NULL state, EMM-DEREGISTERED state or EMM-
DEREGISTERED-INITIATED state; or
2) the UE supports 3GPP access to 5GC, the UE does not support 3GPP access to
EPC, and:
a) the 5GMM sublayer is is in the 5GMM-NULL state, 5GMM-DEREGISTERED state or
5GMM-DEREGISTERED-INITIATED state; or
3) supports both 3GPP access to EPC and 3GPP access to 5GC, and:
a) the EMM sublayer is in the EMM-NULL state, EMM-DEREGISTERED state or EMM-
DEREGISTERED-INITIATED state; and
a) the 5GMM sublayer is is in the 5GMM-NULL state, 5GMM-DEREGISTERED state or
5GMM-DEREGISTERED-INITIATED state.
#### 5.3.12A.2 Receiving a REGISTRATION ACCEPT message via non-3GPP access
If the UE can determine the current country and after switch on or after
removal of the USIM, has not been registered or has not been attached via 3GPP
access in the current country, then the UE shall store the local emergency
numbers list or the extended local emergency numbers list or both, as provided
by the network with an MCC matching the current country via non-3GPP access.
NOTE: The UE determines, as the current country, the country in which it is
located in accordance with 3GPP TS 24.502 [18].
The UE shall replace a previously stored local emergency numbers list or a
previously stored extended local emergency numbers list or both with a local
emergency numbers list or an extended local emergency numbers list or both
received in a REGISTRATION ACCEPT message via non-3GPP access, if the
previously stored local emergency numbers list was also received via non-3GPP
access or the previously stored extended local emergency numbers list was also
received via non-3GPP access.
The UE shall replace a previously stored extended local emergency numbers list
with an extended local emergency numbers list received in a REGISTRATION
ACCEPT message via non-3GPP access, if:
\- the UE is neither registered nor attached over 3GPP access;
\- the REGISTRATION ACCEPT message is received from a PLMN different from
which the stored list was received; and
\- the stored indication in the EENLV field within the Extended emergency
number list IE indicates \"Extended Local Emergency Numbers List is valid only
in the PLMN from which this IE is received\".
If no extended local emergency numbers list is contained in a REGISTRATION
ACCEPT message received via non-3GPP access and the UE is neither registered
nor attached over 3GPP access, the stored extended local emergency numbers
list in the UE shall be discarded if:
\- the UE can determine the current country and the UE has successfully
registered to a PLMN in the country and that country is different from that of
the PLMN that sent the stored list via 3GPP access; or
\- the REGISTRATION ACCEPT message is received from a PLMN different from
which the stored list was received, and the stored indication in the EENLV
field within the Extended emergency number list IE indicates \"Extended Local
Emergency Numbers List is valid only in the PLMN from which this IE is
received\".
### 5.3.13 Lists of 5GS forbidden tracking areas
The UE shall store a list of \"5GS forbidden tracking areas for roaming\", as
well as a list of \"5GS forbidden tracking areas for regional provision of
service\". Within the 5GS, these lists are managed independently per access
type, i.e., 3GPP access or non-3GPP access. These lists shall be erased when
a) the UE is switched off or the UICC containing the USIM is removed; and
b) periodically (with a period in the range 12 to 24 hours).
Over 3GPP access, when the lists are erased, the UE performs cell selection
according to 3GPP TS 38.304 [28]. A tracking area shall be removed from the
list of \"5GS forbidden tracking areas for roaming\", as well as the list of
\"5GS forbidden tracking areas for regional provision of service\", if the UE
receives the tracking area in the TAI list or the Service area list of
\"allowed tracking areas\" in REGISTRATION ACCEPT message or a CONFIGURATION
UPDATE COMMAND message. The UE shall not remove the tracking area from \"5GS
forbidden tracking areas for roaming\" or \"5GS forbidden tracking areas for
regional provision of service\" if the UE is registered for emergency
services.
In N1 mode, the UE shall update the suitable list whenever a REGISTRATION
REJECT, SERVICE REJECT or DEREGISTRATION REQUEST message is received with the
5GMM cause #12 \"tracking area not allowed\", #13 \"roaming not allowed in
this tracking area\", or #15 \"no suitable cells in tracking area\".
Each list shall accommodate 40 or more TAIs. When the list is full and a new
entry has to be inserted, the oldest entry shall be deleted.
### 5.3.14 List of equivalent PLMNs
The UE shall store a list of equivalent PLMNs. These PLMNs shall be regarded
by the UE as equivalent to each other for PLMN selection and cell
selection/re-selection. The same list is used by 5GMM, EMM, GMM and MM (see
3GPP TS 24.301 [15] and 3GPP TS 24.008 [12]) except for the case when the UE
operates in dual-registration mode (see subclause 4.8.3).
The UE shall update or delete this list at the end of each registration
procedure. The stored list consists of a list of equivalent PLMNs as
downloaded by the network plus the PLMN code of the registered PLMN that
downloaded the list. When the UE is switched off, the UE shall keep the stored
list so that it can be used for PLMN selection after switch on. The UE shall
delete the stored list if the USIM is removed or when the UE registered for
emergency services enters the state 5GMM-DEREGISTERED. The maximum number of
possible entries in the stored list is 16.
### 5.3.15 Transmission failure abnormal case in the UE
The abnormal case 5GMM uplink message transmission failure indication by lower
layers can be identified for 5GMM procedures:
When it is specified in the relevant procedure that it is up to the UE
implementation to re-run the ongoing procedure that triggered that procedure,
the procedure can typically be re-initiated using a retransmission mechanism
of the uplink message (i.e. the one that has previously failed to be
transmitted) with new sequence number and message authentication code
information thus avoiding to re-start the whole procedure.
## 5.4 5GMM common procedures
### 5.4.1 Primary authentication and key agreement procedure
#### 5.4.1.1 General
The purpose of the primary authentication and key agreement procedure is to
enable mutual authentication between the UE and the network and to provide
keying material that can be used between the UE and network in subsequent
security procedures, as specified in 3GPP TS 33.501 [24].
Two methods are defined:
a) EAP based primary authentication and key agreement procedure.
b) 5G AKA based primary authentication and key agreement procedure.
The UE and the AMF shall support the EAP based primary authentication and key
agreement procedure and the 5G AKA based primary authentication and key
agreement procedure.
#### 5.4.1.2 EAP based primary authentication and key agreement procedure
##### 5.4.1.2.1 General
The purpose of the EAP based primary authentication and key agreement
procedure is to provide mutual authentication between the UE and the network
and to agree on the keys K~AUSF~, K~SEAF~ and K~AMF~ (see 3GPP TS 33.501
[24]).
Extensible authentication protocol (EAP) as specified in IETF RFC 3748 [34]
enables authentication using various EAP methods.
EAP defines four types of EAP messages:
a) an EAP-request message;
b) an EAP-response message;
c) an EAP-success message; and
d) an EAP-failure message.
Several rounds of exchanges of an EAP-request message and a related EAP-
response message can be required to achieve the authentication (see example in
figure 5.4.1.2.1.1).
The EAP based primary authentication and key agreement procedure is always
initiated and controlled by the network.
The EAP-request message, the ngKSI and the ABBA are transported from the
network to the UE using the AUTHENTICATION REQUEST message of the EAP message
reliable transport procedure.
The EAP-response message is transported from the UE to the network using the
AUTHENTICATION RESPONSE message of the EAP message reliable transport
procedure.
If the authentication of the UE completes successfully, the serving AMF
intends to initiate a security mode control procedure after the EAP based
primary authentication and key agreement procedure and the security mode
control procedure intends to bring into use the partial native 5G NAS security
context created by the EAP based primary authentication and key agreement
procedure, then the EAP-success message and the ngKSI are transported from the
network to the UE using the SECURITY MODE COMMAND message of the security mode
control procedure (see subclause 5.4.2).
If the authentication of the UE completes successfully and the serving AMF
does not intend to initiate a security mode control procedure bringing into
use the partial native 5G NAS security context created by the EAP based
primary authentication and key agreement procedure, then the EAP-success
message, and the ngKSI are transported from the network to the UE using the
AUTHENTICATION RESULT message of the EAP result message transport procedure.
NOTE 1: The serving AMF will not initiate a security mode control procedure
after the EAP based primary authentication and key agreement procedure e.g. in
case of AMF relocation during registration procedure.
If the authentication of the UE completes unsuccessfully, the EAP-failure
message is transported from the network to the UE using the AUTHENTICATION
RESULT message or the AUTHENTICATION REJECT message of the EAP result message
transport procedure or in a response of the initial 5GMM procedure as part of
which the EAP based primary authentication and key agreement procedure is
performed.
The AMF shall set the authenticator retransmission timer specified in IETF RFC
3748 [34] subclause 4.3 to infinite value.
NOTE 2: The EAP message reliable transport procedure provides a reliable
transport of EAP messages and therefore retransmissions at the EAP layer do
not occur.
The AUSF and the AMF support exchange of EAP messages using N12.
The UE shall detect and handle any duplication of EAP message as specified in
IETF RFC 3748 [34].
Figure 5.4.1.2.1.1: EAP based primary authentication and key agreement
procedure
##### 5.4.1.2.2 EAP-AKA\' related procedures
###### 5.4.1.2.2.1 General
The UE shall support acting as EAP-AKA\' peer as specified in IETF RFC 5448
[40]. The AUSF may support acting as EAP-AKA\' server as specified in IETF RFC
5448 [40].
The EAP-AKA\' enables mutual authentication of the UE and the network.
The UE can reject the EAP-request/AKA\'-challenge message sent by the network.
The UE shall proceed with an EAP-request/AKA\'-challenge message only if a
USIM is present.
During a successful EAP based primary authentication and key agreement
procedure, the CK and IK are computed by the USIM. CK and IK are then used by
the ME as key material to generate an EMSK.
###### 5.4.1.2.2.2 Initiation
In order to initiate the EAP based primary authentication and key agreement
procedure using EAP-AKA\', the AUSF shall send an EAP-request/AKA\'-challenge
message as specified in IETF RFC 5448 [40]. The AUSF shall set the
AT_KDF_INPUT attribute of the EAP-request/AKA\'-challenge message to the SNN.
The SNN is in format described in subclause 9.12.1. The AUSF may include
AT_RESULT_IND attribute in the EAP-request/AKA\'-challenge message.
The network shall select an ngKSI value. If an ngKSI is contained in an
initial NAS message during a 5GMM procedure, the network shall select a
different ngKSI value. The network shall send the selected ngKSI value to the
UE along with each EAP message. The network shall send the ABBA value as
described in subclause 9.11.3.10 to the UE along with the EAP request message
and EAP-success message.
Upon receiving an EAP-request/AKA\'-challenge message, the UE shall check
whether the UE has a USIM, shall check the key derivation function indicated
in AT_KDF attributes as specified in IETF RFC 5448 [40], and if the value of
the Key derivation function field within the received AT_KDF attribute, is of
value 1, shall check:
a) whether the network name field of the AT_KDF_INPUT attribute is the SNN
constructed according to subclause 9.12.1; and
b) whether the network name field of the AT_KDF_INPUT attribute matches the
PLMN identity saved in the UE.
The PLMN identity the UE uses for the above network name check is as follows:
a) when the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode, until the
first handover, the UE shall use the PLMN identity of the selected PLMN; and
b) after handover or inter-system change to N1 mode in 5GMM-CONNECTED mode:
1) if the target cell is not a shared network cell, the UE shall use the PLMN
identity received as part of the broadcast system information;
2) if the target cell is a shared network cell and the UE has a valid 5G-GUTI,
the UE shall use the PLMN identity that is part of the 5G-GUTI; and
3) if the target cell is a shared network cell and the UE has a valid 4G-GUTI
and TAI, but not a valid 5G-GUTI, the UE shall use the PLMN identity that is
part of the TAI.
###### 5.4.1.2.2.3 UE successfully authenticates network
If a USIM is present and the SNN check is successful, the UE shall handle the
EAP-request/AKA\'-challenge message as specified in IETF RFC 5448 [40]. The
USIM shall derive CK and IK and compute the authentication response (RES)
using the 5G authentication challenge data received from the ME, and pass RES
to the ME. The ME shall derive CK\' and IK\' from CK and IK, and EMSK from
CK\' and IK\'. Furthermore, the ME may generate K~AUSF~ from the EMSK, the
K~SEAF~ from the K~AUSF~, and the K~AMF~ from the ABBA received together with
the EAP-request/AKA\'-challenge message, and the K~SEAF~ as described in 3GPP
TS 33.501 [24], and create a partial native 5G NAS security context identified
by the ngKSI value received together with the EAP-request/AKA\'-challenge
message in subclause 5.4.1.2.4.2 in the volatile memory of the ME. If the
K~AMF~ and the partial native 5G NAS security context are created, the ME
shall store the K~AMF~ in the created partial native 5G NAS security context,
and shall send an EAP-response/AKA\'-challenge message as specified in IETF
RFC 5448 [40].
If the EAP-request/AKA\'-challenge message contains AT_RESULT_IND attribute,
the UE may include AT_RESULT_IND attribute in the EAP-response/AKA\'-challenge
message as specified in IETF RFC 5448 [40].
###### 5.4.1.2.2.4 Errors when handling EAP-request/AKA\'-challenge message
If a USIM is present, the SNN check fails or the UE does not accept AUTN
during handling of the EAP-request/AKA\'-challenge message as specified in
IETF RFC 5448 [40], the UE shall send an EAP-response/AKA\'-authentication-
reject message as specified in IETF RFC 5448 [40].
If a USIM is present, the SNN check is successful but the UE detects that the
sequence number in AUTN is not correct during handling of the EAP-
request/AKA\'-challenge message as specified in IETF RFC 5448 [40], the UE
shall send an EAP-response/AKA\'-synchronization-failure message as specified
in IETF RFC 5448 [40].
If a USIM is present, the SNN check is successful, the sequence number in AUTN
is correct and the UE detects another error during handling of the EAP-
request/AKA\'-challenge message as specified in IETF RFC 5448 [40], the UE
shall send an EAP-response/AKA\'-client-error message as specified in IETF RFC
5448 [40].
If a USIM is not present, the UE shall send an EAP-response/AKA\'-client-error
message as specified in IETF RFC 5448 [40].
For any of the above, the UE shall start timer T3520 when the AUTHENTICATION
RESPONSE message containing the EAP-response message is sent. Furthermore, the
UE shall stop any of the retransmission timers that are running (e.g. T3510,
T3517 or T3521). Upon receiving an AUTHENTICATION REQUEST message with the EAP
message IE containing an EAP-request/AKA\'-challenge from the network, the UE
shall stop timer T3520, if running, and then process the EAP-
request/AKA\'-challenge information as normal.
###### 5.4.1.2.2.5 Network successfully authenticates UE
Upon reception of the EAP-response/AKA\'-challenge message, if procedures for
handling an EAP-response/AKA\'-challenge message as specified in IETF RFC 5448
[40] are successful, the AUSF shall generate EMSK, the K~AUSF~ from the EMSK,
and the K~SEAF~ from the K~AUSF~ as described in 3GPP TS 33.501 [24], and the
AUSF shall check whether the AT_RESULT_IND attribute is included in the EAP-
response/AKA\'-challenge message and:
a) if the AT_RESULT_IND attribute is included in the EAP-
response/AKA\'-challenge message, the AUSF shall send an EAP-
request/AKA\'-notification message as specified in IETF RFC 5448 [40]; and
b) if the AT_RESULT_IND attribute is not included in the EAP-
response/AKA\'-challenge message, the AUSF shall send an EAP-success message
as specified in IETF RFC 5448 [40] and shall consider the procedure complete.
NOTE: The AUSF provides the K~SEAF~ to the SEAF. Upon reception of the
K~SEAF~, the SEAF generates the K~AMF~ based on the ABBA and the K~SEAF~ as
described in 3GPP TS 33.501 [24], and provides ngKSI and the K~AMF~ to the
AMF. Upon reception of the ngKSI and the K~AMF~, the AMF creates a partial
native 5G NAS security context identified by the ngKSI, and stores the K~AMF~
in the created partial native 5G NAS security context.
###### 5.4.1.2.2.6 UE handling EAP-AKA\' notification message
Upon receiving an EAP-request/AKA\'-notification message, the UE shall send an
EAP-response/AKA\'-notification message as specified in IETF RFC 5448 [40].
###### 5.4.1.2.2.6A EAP based Identification initiation by the network
If AUSF decides to initiate the EAP based identification procedure, the AUSF
shall send an EAP-Request/Identity or EAP-Request/AKA\'-Identity message as
specified in IETF RFC 5448 [40].
The AMF shall encapsulate the EAP-Request/Identity or EAP-
Request/AKA\'-Identity message in the AUTHENTICATION REQUEST message and send
it to the UE.
###### 5.4.1.2.2.6B EAP based Identification response by the UE
Upon receipt of the AUTHENTICATION REQUEST message with EAP-Request/Identity
message the UE shall send an AUTHENTICATION RESPONSE message with EAP-
Response/Identity to the network. In the EAP-Response/Identity message, the UE
shall provide the requested identity according to 3GPP TS 33.501 [24] annex
F.2, in the UE identity in the EAP-Response/Identity message as specified in
IETF RFC 5448 [40].
Upon receipt of the AUTHENTICATION REQUEST message with EAP-
Request/AKA\'-Identity message the UE shall send an AUTHENTICATION RESPONSE
message with EAP-Response/AKA\'-Identity to the network. Based on the
attribute received in the EAP-Request/AKA\'-Identity, the UE shall provide the
requested identity according to 3GPP TS 33.501 [24] annex F.2, in the EAP-
Response/AKA\'-Identity message, as specified in IETF RFC 5448 [40].
If the EAP-Request/AKA\'-Identity carries the AT_PERMANENT_REQ, the UE shall
respond with EAP-Response/AKA\'-Client-Error with the error code \"unable to
process packet\".
###### 5.4.1.2.2.7 Network sending EAP-success message
Upon reception of the EAP-response/AKA\'-notification message, if earlier
procedures for handling an EAP-request/AKA\'-challenge message as specified in
IETF RFC 5448 [40] were successful, the AUSF shall send an EAP-success message
as specified in IETF RFC 5448 [40] and shall consider the procedure complete.
NOTE: The AUSF provides the K~SEAF~ to the SEAF. Upon reception of the
K~SEAF~, the SEAF generates the K~AMF~ based on the ABBA and the K~SEAF~ as
described in 3GPP TS 33.501 [24], and provides ngKSI and the K~AMF~ to the
AMF. Upon reception of the ngKSI and the K~AMF~, the AMF creates a partial
native 5G NAS security context identified by the ngKSI, and stores the K~AMF~
in the created partial native 5G NAS security context.
###### 5.4.1.2.2.8 UE handling EAP-success message
Upon receiving an EAP-success message, if the ME has not generated a partial
native 5G NAS security context as described in subclause 5.4.1.2.2.3, the ME
shall:
a) generate the K~AUSF~ from the EMSK, the K~SEAF~ from the K~AUSF~, and the
K~AMF~ from the ABBA that was received with the EAP-success message, and the
K~SEAF~ as described in 3GPP TS 33.501 [24];
b) create a partial native 5G NAS security context identified by the ngKSI
value in the volatile memory of the ME; and
c) store the K~AMF~ in the created partial native 5G NAS security context.
The UE shall consider the procedure complete.
###### 5.4.1.2.2.9 Network not successfully authenticates UE
Upon reception of the EAP-response/AKA\'-challenge message, if procedures for
handling an EAP-response/AKA\'-challenge message as specified in IETF RFC 5448
[40] are not successful, the AUSF shall send an EAP-request/AKA\'-notification
message that implies failure as specified in IETF RFC 5448 [40].
###### 5.4.1.2.2.10 Network sending EAP-failure message
Upon reception of the EAP-response/AKA\'-notification message, if earlier
procedures for handling an EAP-request/AKA\'-challenge message as specified in
IETF RFC 5448 [40] were not successful, the AUSF shall send an EAP-failure
message as specified in IETF RFC 5448 [40] and shall consider the procedure
complete.
If the authentication response (RES) returned by the UE in the AT_RES
attribute of the EAP-response/AKA\'-challenge message is not valid, the
network handling depends upon the type of identity used by the UE in the
initial NAS message, that is:
\- if the 5G-GUTI was used; or
\- if the SUCI was used.
If the 5G-GUTI was used, the network should transport the EAP-failure message
in the AUTHENTICATION RESULT message of the EAP result message transport
procedure, initiate an identification procedure to retrieve SUCI from the UE
and restart the EAP based primary authentication and key agreement procedure
with the received SUCI.
If the SUCI was used for identification in the initial NAS message or in a
restarted EAP based primary authentication and key agreement procedure, or the
network decides not to initiate the identification procedure to retrieve SUCI
from the UE after an unsuccessful EAP based primary authentication and key
agreement procedure, the network should transport the EAP-failure message in
an AUTHENTICATION REJECT message of the EAP result message transport
procedure.
Depending on local requirements or operator preference for emergency services,
if the UE initiates a registration procedure with 5GS registration type IE set
to \"emergency registration\" and the AMF is configured to allow emergency
registration without user identity, the AMF needs not follow the procedures
specified for transporting the EAP-failure message in the AUTHENTICATION
REJECT message of the EAP result message transport procedure in the present
subclause. The AMF may include the EAP-failure message in a response of the
current 5GMM specific procedure or in the AUTHENTICATION RESULT of the EAP
result message transport procedure.
###### 5.4.1.2.2.11 UE handling EAP-failure message
Upon receiving an EAP-failure message, the UE shall delete the partial native
5G NAS security context if any was created as described in subclause
5.4.1.2.2.3.
The UE shall consider the procedure complete.
If the EAP-failure message is received in an AUTHENTICATION REJECT message:
\- the UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the
stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The USIM
shall be considered invalid until switching off the UE or the UICC containing
the USIM is removed; and
\- if the UE is operating in single-registration mode, the UE shall handle
4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 [15] for the case
when the authentication procedure is not accepted by the network. The USIM
shall be considered as invalid also for non-EPS services until switching off
or the UICC containing the USIM is removed.
If the AUTHENTICATION REJECT message is received by the UE, the UE shall abort
any 5GMM signalling procedure, stop any of the timers T3510, T3517 or T3521
(if they were running) and enter state 5GMM-DEREGISTERED.
###### 5.4.1.2.2.12 Abnormal cases in the UE
The following abnormal cases can be identified:
a) EAP-request/AKA\'-challenge message with the key derivation function
indicated in AT_KDF attributes set to a value other than 1.
The UE shall act as specified in IETF RFC 5448 [40] subclause 3.2 for the case
when the AUTN had been incorrect.
##### 5.4.1.2.3 EAP-TLS related procedures
###### 5.4.1.2.3.1 General
The UE may support acting as EAP-TLS peer as specified in 3GPP TS 33.501 [24].
The AUSF may support acting as EAP-TLS server as specified in 3GPP TS 33.501
[24].
The EAP-TLS enables mutual authentication of the UE and the network.
When initiating an EAP based primary authentication and key agreement
procedure using EAP-TLS, the network shall select an ngKSI value. If an ngKSI
is contained in an initial NAS message during a 5GMM procedure, the network
shall select a different ngKSI value. The network shall send the selected
ngKSI value to the UE along with each EAP message. The network shall send the
ABBA value as described in subclause 9.11.3.10 to the UE along with the EAP-
request message and EAP-success message.
When the EAP based primary authentication and key agreement procedure uses
EAP-TLS, the ME and the AUSF shall generate EMSK as described in 3GPP TS
33.501 [24].
When handling of an EAP-request message results into generation of EMSK, the
ME may generate the K~AUSF~ from the EMSK, the K~SEAF~ from the K~AUSF~, and
the K~AMF~ from the ABBA received together with the EAP-request message, and
the K~SEAF~ as described in 3GPP TS 33.501 [24], and create a partial native
5G NAS security context identified by the ngKSI value received together with
the EAP-request message in subclause 5.4.1.2.4.2, in the volatile memory of
the ME. If the K~AMF~ and the partial native 5G NAS security context are
created, the ME shall store the K~AMF~ in the created partial native 5G NAS
security context.
When handling of an EAP response message results into generation of EMSK, the
AUSF shall generate the K~AUSF~ from the EMSK, and the K~SEAF~ from the
K~AUSF~ as described in 3GPP TS 33.501 [24].
NOTE: The AUSF provides the K~SEAF~ to the SEAF. Upon reception of the
K~SEAF~, the SEAF generates the K~AMF~ based on the ABBA and the K~SEAF~ as
described in 3GPP TS 33.501 [24], and provides ngKSI and the K~AMF~ to the
AMF. Upon reception of the ngKSI and the K~AMF~, the AMF creates a partial
native 5G NAS security context identified by the ngKSI, and stores the K~AMF~
in the created partial native 5G NAS security context.
If the UE does not accept the server certificate of the network, the UE shall
start timer T3520 when the AUTHENTICATION RESPONSE message containing the EAP-
response message is sent. Furthermore, the UE shall stop any of the
retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon
receiving an AUTHENTICATION REQUEST message with the EAP message IE containing
an EAP-request message from the network, the UE shall stop timer T3520, if
running, and then process the EAP-request message as normally.
If the network does not accept the client certificate of the UE, the network
handling depends upon the type of identity used by the UE in the initial NAS
message, that is:
\- if the 5G-GUTI was used; or
\- if the SUCI was used.
If the 5G-GUTI was used, the network should transport the EAP-failure message
in the AUTHENTICATION RESULT message of the EAP result message transport
procedure, initiate an identification procedure to retrieve SUCI from the UE
and restart the EAP based primary authentication and key agreement procedure
with the received SUCI.
If the SUCI was used for identification in the initial NAS message or in a
restarted EAP based primary authentication and key agreement procedure, or the
network decides not to initiate the identification procedure to retrieve SUCI
from the UE after an unsuccessful the EAP based primary authentication and key
agreement procedure, the network should transport the EAP-failure message in
an AUTHENTICATION REJECT message of the EAP result message transport
procedure.
Depending on local requirements or operator preference for emergency services,
if the UE initiates a registration procedure with 5GS registration type IE set
to \"emergency registration\" and the AMF is configured to allow emergency
registration without user identity, the AMF needs not follow the procedures
specified for transporting the EAP-failure message in the AUTHENTICATION
REJECT message of the EAP result message transport procedure in the present
subclause. The AMF may include the EAP-failure message in a response of the
current 5GMM specific procedure or in the AUTHENTICATION RESULT of the EAP
result message transport procedure.
If the EAP-failure message is received in an AUTHENTICATION REJECT message:
\- the UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the
stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The USIM
shall be considered invalid until switching off the UE or the UICC containing
the USIM is removed; and
\- if the UE is operating in single-registration mode, the UE shall handle
4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 [15] for the case
when the authentication procedure is not accepted by the network. The USIM
shall be considered as invalid also for non-EPS services until switching off
or the UICC containing the USIM is removed.
If the AUTHENTICATION REJECT message is received by the UE, the UE shall abort
any 5GMM signalling procedure, stop any of the timers T3510, T3517 or T3521
(if they were running) and enter state 5GMM-DEREGISTERED.
Upon receiving an EAP-success message, if the ME has not generated a partial
native 5G NAS security context when handling the EAP-request message which
resulted into generation of EMSK as described above , the ME shall generate
the K~AUSF~ from the EMSK, the K~SEAF~ from the K~AUSF~, and the K~AMF~ from
the ABBA that was received with the EAP-success message, and the K~SEAF~ as
described in 3GPP TS 33.501 [24], shall create a partial native 5G NAS
security context identified by the ngKSI value in the volatile memory of the
ME, and shall store the K~AMF~ in the created partial native 5G NAS security
context.
The UE shall consider the procedure complete.
Upon receiving an EAP-failure message, the UE shall delete the partial native
5G NAS security context if any was created when handling the EAP-request
message which resulted into generation of EMSK as described above .
The UE shall consider the procedure complete.
##### 5.4.1.2.4 EAP message reliable transport procedure
###### 5.4.1.2.4.1 General
The purpose of the EAP message reliable transport procedure is to provide a
reliable transport of an EAP-request message, the ngKSI and the ABBA from the
network to the UE and of an EAP-response message from the UE to the network.
The EAP message reliable transport procedure is initiated by an AUTHENTICATION
REQUEST message with the EAP message IE.
###### 5.4.1.2.4.2 EAP message reliable transport procedure initiation by the
network
In order to initiate the EAP message reliable transport procedure, the AMF
shall create an AUTHENTICATION REQUEST message.
The AMF shall set the EAP message IE of the AUTHENTICATION REQUEST message to
the EAP-request message to be sent to the UE. The AMF shall set the ngKSI IE
of the AUTHENTICATION REQUEST message to the ngKSI value selected in subclause
5.4.1.2.2.2 or subclause 5.4.1.2.3.1. In this release of specification, the
AMF shall set the ABBA IE of the AUTHENTICATION REQUEST message with the
length of ABBA IE to 2 and the ABBA contents to be 2 octets in length with
value 0000H as described in subclause 9.11.3.10.
The AMF shall send the AUTHENTICATION REQUEST message to the UE, and the AMF
shall start timer T3560 (see example in figure 5.4.1.2.4.2.1).
Figure 5.4.1.2.4.2.1: EAP message reliable transport procedure
Upon receipt of an AUTHENTICATION REQUEST message with the EAP message IE, the
UE handles the EAP message received in the EAP message IE and the ABBA of the
AUTHENTICATION REQUEST message.
###### 5.4.1.2.4.3 EAP message reliable transport procedure accepted by the UE
The UE shall create an AUTHENTICATION RESPONSE message.
If the received EAP message is an EAP-request message, the UE shall set the
EAP message IE of the AUTHENTICATION RESPONSE message to the EAP-response
message responding to the received EAP-request message.
The UE shall send the AUTHENTICATION RESPONSE message to the AMF.
Upon receipt of an AUTHENTICATION RESPONSE message, the AMF shall stop timer
T3560. If the EAP message IE is included in the AUTHENTICATION RESPONSE
message, the AMF handles the EAP message received in the EAP message IE of the
AUTHENTICATION RESPONSE message.
###### 5.4.1.2.4.4 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Expiry of timer T3560.
The AMF shall, on the first expiry of the timer T3560, retransmit the
AUTHENTICATION REQUEST message and shall reset and start timer T3560. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3560, the AMF shall abort the EAP based primary authentication and key
agreement procedure and any ongoing 5GMM specific procedure, and release the
N1 NAS signalling connection.
b) Lower layers indication of non-delivered NAS PDU due to handover.
If the AUTHENTICATION REQUEST message could not be delivered due to an intra
AMF handover and the target TA is included in the TAI list, then upon
successful completion of the intra AMF handover the AMF shall retransmit the
AUTHENTICATION REQUEST message. If a failure of handover procedure is reported
by the lower layer and the N1 NAS signalling connection exists, the AMF shall
retransmit the AUTHENTICATION REQUEST message.
###### 5.4.1.2.4.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Authentication failure (5GMM cause #71 \"ngKSI already in use\").
The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #71
\"ngKSI already in use\", to the network and start the timer T3520 (see
example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any of the
retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the
first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause
#71 \"ngKSI already in use\", the network performs necessary actions to select
a new ngKSI and send the same EAP-request message to the UE.
NOTE 1: Upon receipt of an AUTHENTICATION FAILURE message from the UE with
5GMM cause #71 \"ngKSI already in use\", the network can also re-initiate the
EAP based primary authentication and key agreement procedure (see subclause
5.4.1.2.2.2).
Upon receiving a new AUTHENTICATION REQUEST message with the EAP message IE
containing an EAP-request message from the network, the UE shall stop timer
T3520, if running, process the EAP-request message as normal.
If the network is validated successfully (an AUTHENTICATION REQUEST message
that contains a valid ngKSI and EAP-request message is received), the UE shall
send the AUTHENTICATION RESPONSE message to the network and shall start any
retransmission timers (e.g. T3510, T3517 or T3521) if they were running and
stopped when the UE received the first failed AUTHENTICATION REQUEST message.
b) Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION
FAILURE message indication from lower layers (if the EAP based primary
authentication and key agreement procedure is triggered by a registration
procedure for mobility and periodic registration update).
The UE shall stop the timer T3520, if running, and re-initiate the
registration procedure for mobility and periodic registration update.
c) Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION
FAILURE message indication with TAI change from lower layers (if the EAP based
primary authentication and key agreement procedure is triggered by a service
request procedure).
The UE shall stop the timer T3520, if running.
If the current TAI is not in the TAI list, the EAP based primary
authentication and key agreement procedure shall be aborted and a registration
procedure for mobility and periodic registration update shall be initiated.
If the current TAI is still part of the TAI list, it is up to the UE
implementation how to re-run the ongoing procedure that triggered the EAP
based primary authentication and key agreement procedure.
d) Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION
FAILURE message indication without TAI change from lower layers (if the
authentication procedure is triggered by a service request procedure).
The UE shall stop the timer T3520, if running. It is up to the UE
implementation how to re-run the ongoing procedure that triggered the EAP
based primary authentication and key agreement procedure.
e) Network failing the authentication check.
If the UE deems that the network has failed the authentication check, then it
shall request RRC to locally release the RRC connection and treat the active
cell as barred (see 3GPP TS 38.304 [28]). The UE shall start any
retransmission timers (e.g. T3510, T3517 or T3521), if they were running and
stopped when the UE received the first AUTHENTICATION REQUEST message
containing an ngKSI that was already in use.
For item e, whether or not the UE is registered for emergency services:
The UE shall stop timer T3520, if the timer is running and the UE enters 5GMM-
IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS
signalling connection, or as the result of an inter-system change in 5GMM-
CONNECTED mode from N1 mode to S1 mode.
The UE shall deem that the network has failed the authentication check or
assume that the authentication is not genuine and proceed as described in item
e above if any of the following occurs:
\- the timer T3520 expires;
\- the UE detects any combination of the EAP-based authentication failures:
transmission of AUTHENTICATION FAILURE message with 5GMM cause #71 \"ngKSI
already in use\", transmission of AUTHENTICATION RESPONSE message with an EAP-
response message after detecting an error as described in subclause
5.4.1.2.2.4 or with an EAP-response message after not accepting of the server
certificate as described in subclause 5.4.1.2.3.1, during three consecutive
authentication challenges. The EAP-request/AKA\'-challenge challenges shall be
considered as consecutive only, if the EAP-request/AKA\'-challenge challenges
causing the second and third EAP-based authentication failure are received by
the UE, while the timer T3520 started after the previous EAP-based
authentication failure is running. Not accepting of the server certificate
shall be considered as consecutive only, if the EAP-request messages causing
the second and third not accepting of the server certificate are received by
the UE, while the timer T3520 started after the previous EAP request message
causing the previous not accepting of the server certificate is running.
NOTE 2: Reception of an EAP-failure message is not considered when determining
the three consecutive authentication challenges or three consecutive not
accepting of the server certificate.
For item e:
If a UE has an emergency PDU session established or is establishing an
emergency PDU session, and sends an AUTHENTICATION FAILURE message to the AMF
with the 5GMM cause appropriate for this cases (i.e. #71) or an AUTHENTICATION
RESPONSE message containing an EAP-response message as described in subclause
5.4.1.2.2.4 or containing an EAP-response message after not accepting of the
server certificate as described in subclause 5.4.1.2.3.1, and receives the
SECURITY MODE COMMAND message before the timeout of timer T3520, the UE shall
deem that the network has passed the authentication check successfully, stop
timer T3520, respectively, and execute the security mode control procedure.
If a UE has an emergency PDU session established or is establishing an
emergency PDU session when timer T3520 expires, the UE shall not deem that the
network has failed the authentication check and not behave as described in
item e. Instead the UE shall continue using the current security context, if
any, release all non-emergency PDU sessions, if any, by initiating UE-
requested PDU session release procedure. If there is an ongoing PDU session
establishment procedure, the UE shall release all non-emergency PDU sessions
upon completion of the PDU session establishment procedure. The UE shall start
any retransmission timers (e.g. T3510, T3517 or T3521) if:
\- they were running and stopped when the UE received the AUTHENTICATION
REQUEST message and detected an authentication failure;
\- the procedures associated with these timers have not yet been completed.
The UE shall consider itself to be registered for emergency services.
##### 5.4.1.2.5 EAP result message transport procedure
###### 5.4.1.2.5.1 General
The purpose of the EAP result message transport procedure is to provide an
EAP-success message or an EAP-failure message, and ngKSI from the network to
the UE, when the EAP message cannot be piggybacked by another NAS message.
The EAP result message transport procedure is initiated:
\- by an AUTHENTICATION RESULT message with the EAP message IE carrying the
EAP-success message or the EAP-failure message; or
\- by an AUTHENTICATION REJECT message with the EAP message IE carrying the
EAP-failure message.
###### 5.4.1.2.5.2 EAP result message transport procedure initiation by the
network
In order to initiate the EAP result message transport procedure, the AMF shall
create an AUTHENTICATION RESULT message or an AUTHENTICATION REJECT message.
The AMF shall set the EAP message IE of the AUTHENTICATION RESULT message to
an EAP-success message or an EAP-failure message to be sent to the UE. The AMF
shall set the EAP message IE of the AUTHENTICATION REJECT message to an EAP-
failure message to be sent to the UE. The AMF shall set the ngKSI IE of the
AUTHENTICATION RESULT message or the AUTHENTICATION REJECT message to the
ngKSI value selected in subclause 5.4.1.2.2.2 or subclause 5.4.1.2.3.1.
The AMF shall send the AUTHENTICATION RESULT message or the AUTHENTICATION
REJECT message to the UE (see example in figure 5.4.1.2.5.2.1).
Figure 5.4.1.2.5.2.1: EAP result message transport procedure
Upon receipt of an AUTHENTICATION RESULT message or an AUTHENTICATION REJECT
message with the EAP message IE, the UE handles the EAP message received in
the EAP message IE and the ABBA if received of the AUTHENTICATION RESULT
message or in the AUTHENTICATION REJECT message.
#### 5.4.1.3 5G AKA based primary authentication and key agreement procedure
##### 5.4.1.3.1 General
The purpose of the 5G AKA based primary authentication and key agreement
procedure is to provide mutual authentication between the UE and the network
and to agree on the keys K~AUSF~, K~SEAF~ and K~AMF~ (see 3GPP TS 33.501
[24]). The cases when the 5G AKA based primary authentication and key
agreement procedure is used are defined in 3GPP TS 33.501 [24].
The network initiates the 5G AKA based primary authentication and key
agreement procedure by sending an AUTHENTICATION REQUEST message to the UE
without the EAP message IE. The network shall include the ngKSI and the ABBA
in AUTHENTICATION REQUEST message.
The 5G AKA based primary authentication and key agreement procedure is always
initiated and controlled by the network. However, the UE can reject the 5G
authentication challenge sent by the network.
The UE shall proceed with a 5G authentication challenge only if a USIM is
present.
A partial native 5G NAS security context is established in the UE and the
network when a 5G authentication is successfully performed. During a
successful 5G AKA based primary authentication and key agreement procedure,
the CK and IK are computed by the USIM. CK and IK are then used by the ME as
key material to compute a new key, K~AMF~. K~AMF~ is stored in the 5G NAS
security contexts (see 3GPP TS 33.501 [24]) of both the network and in the
volatile memory of the ME while registered to the network, and is the root for
the 5GS integrity protection and ciphering key hierarchy.
The 5G AKA based primary authentication and key agreement procedure is
initiated by an AUTHENTICATION REQUEST message without the EAP message IE.
##### 5.4.1.3.2 Authentication initiation by the network
The network may initiate a 5G AKA based primary authentication and key
agreement procedure for a UE in 5GMM-CONNECTED mode at any time. For
restrictions applicable after handover or inter-system change to N1 mode in
5GMM-CONNECTED mode, see subclause 5.4.1.2.3.
The network initiates the 5G AKA based primary authentication and key
agreement procedure by sending an AUTHENTICATION REQUEST message to the UE and
starting the timer T3560 (see example in figure 5.4.1.3.2.1). The
AUTHENTICATION REQUEST message shall contain the parameters necessary to
calculate the authentication response (see 3GPP TS 33.501 [24]). This message
shall include the ngKSI that will be used by the UE and AMF to identify the
K~AMF~ and the partial native security context that is created if the
authentication is successful. This message shall also include the ABBA
parameter. In this release of specification, the network shall set the length
of ABBA IE to 2 and the ABBA contents to be 2 octets in length with value
0000H as described in subclause 9.11.3.10.
If an ngKSI is contained in an initial NAS message during a 5GMM procedure,
the network shall include a different ngKSI value in the AUTHENTICATION
REQUEST message when it initiates a 5G AKA based primary authentication and
key agreement procedure.
Figure 5.4.1.3.2.1: 5G AKA based primary authentication and key agreement
procedure
##### 5.4.1.3.3 Authentication response by the UE
The UE shall respond to an AUTHENTICATION REQUEST message. With the exception
of the cases described in subclause 5.4.1.3.5, the UE shall process the 5G
authentication challenge data and respond with an AUTHENTICATION RESPONSE
message to the network.
Upon a successful 5G authentication challenge, the UE shall determine the PLMN
identity to be used for the calculation of the new K~AMF~ from the 5G
authentication challenge data according to the following rules:
a) When the UE moves from 5GMM-IDLE mode to 5GMM-CONNECTED mode, until the
first handover, the UE shall use the PLMN identity of the selected PLMN; and
b) After handover or inter-system change to N1 mode in 5GMM-CONNECTED mode,
1) if the target cell is not a shared network cell, the UE shall use the PLMN
identity received as part of the broadcast system information;
2) if the target cell is a shared network cell and the UE has a valid 5G-GUTI,
the UE shall use the PLMN identity that is part of the 5G-GUTI; and
3) if the target cell is a shared network cell and the UE has a valid 4G-GUTI
and TAI, but not a valid 5G-GUTI, the UE shall use the PLMN identity that is
part of the TAI.
Upon a successful 5G authentication challenge, the new K~AMF~ calculated from
the 5G authentication challenge data shall be stored in a new 5G NAS security
context in the volatile memory of the ME.
The USIM will compute the authentication response (RES) using the 5G
authentication challenge data received from the ME, and pass RES to the ME.
From the RES, RES* is then generated according to Annex A of 3GPP TS 33.501
[24].
In order to avoid a synchronisation failure, when the UE receives an
AUTHENTICATION REQUEST message, the UE shall store the received RAND together
with the RES*, in the volatile memory of the ME. When the UE receives a
subsequent AUTHENTICATION REQUEST message, if the stored RAND value is equal
to the new received value in the AUTHENTICATION REQUEST message, then the ME
shall not pass the RAND to the USIM, but shall send the AUTHENTICATION
RESPONSE message with the stored RES*. If there is no valid stored RAND in the
ME or the stored RAND is different from the new received value in the
AUTHENTICATION REQUEST message, the ME shall pass the RAND to the USIM, shall
override any previously stored RAND and RES* with the new ones and start, or
reset and restart timer T3516.
The RAND and RES* values stored in the ME shall be deleted and timer T3516, if
running, shall be stopped:
a) upon receipt of a
1) SECURITY MODE COMMAND message,
2) SERVICE REJECT message,
3) REGISTRATION REJECT message,
4) REGISTRATION ACCEPT message, or
5) AUTHENTICATION REJECT message;
b) upon expiry of timer T3516;
c) if the UE enters the 5GMM state 5GMM-DEREGISTERED or 5GMM-NULL; or
d) if the UE enters 5GMM-IDLE mode.
##### 5.4.1.3.4 Authentication completion by the network
Upon receipt of an AUTHENTICATION RESPONSE message, the network stops the
timer T3560 and checks the correctness of RES* (see 3GPP TS 33.501 [24]).
If the 5G AKA based primary authentication and key agreement procedure has
been completed successfully and the related ngKSI is stored in the 5G NAS
security context of the network, the network shall include a different ngKSI
value in the AUTHENTICATION REQUEST message when it initiates a new 5G AKA
based primary authentication and key agreement procedure.
Upon receipt of an AUTHENTICATION FAILURE message, the network stops the timer
T3560. In the case where the 5GMM cause #21 \"synch failure\" is received, the
core network may renegotiate with the UDM/AUSF and provide the UE with new
authentication parameters.
##### 5.4.1.3.5 Authentication not accepted by the network
If the authentication response (RES) returned by the UE is not valid, the
network response depends upon the type of identity used by the UE in the
initial NAS message, that is:
\- if the 5G-GUTI was used; or
\- if the SUCI was used.
If the 5G-GUTI was used, the network should initiate an identification
procedure to retrieve SUCI from the UE and restart the 5G AKA based primary
authentication and key agreement procedure with the received SUCI.
If the SUCI was used for identification in the initial NAS message or in a
restarted 5G AKA based primary authentication and key agreement procedure, or
the network decides not to initiate the identification procedure to retrieve
SUCI from the UE after an unsuccessful 5G AKA based primary authentication
authentication and key agreement procedure, the network should send an
AUTHENTICATION REJECT message to the UE.
Upon receipt of an AUTHENTICATION REJECT message,
\- the UE shall set the update status to 5U3 ROAMING NOT ALLOWED, delete the
stored 5G-GUTI, TAI list, last visited registered TAI and ngKSI. The USIM
shall be considered invalid until switching off the UE or the UICC containing
the USIM is removed; and
\- if the UE is operating in single-registration mode, the UE shall handle
4G-GUTI, TAI list and eKSI as specified in 3GPP TS 24.301 [15] for the case
when the authentication procedure is not accepted by the network. The USIM
shall be considered as invalid also for non-EPS services until switching off
or the UICC containing the USIM is removed.
If the AUTHENTICATION REJECT message is received by the UE, the UE shall abort
any 5GMM signalling procedure, stop any of the timers T3510, T3516, T3517,
T3519 or T3521 (if they were running) and enter state 5GMM-DEREGISTERED.
Depending on local requirements or operator preference for emergency services,
if the UE initiates a registration procedure with 5GS registration type IE set
to \"emergency registration\" and the AMF is configured to allow emergency
registration without user identity, the AMF needs not follow the procedures
specified for the authentication failure in the present subclause. The AMF may
continue a current 5GMM specific procedure.
##### 5.4.1.3.6 Authentication not accepted by the UE
In the 5G authentication challenge, the UE shall check the 5G authentication
challenge data (RAND, AUTN and ngKSI) received in the AUTHENTICATION REQUEST
message to verify authenticity of the 5G core network.
The ME shall check that ngKSI received in the AUTHENTICATION REQUEST message
is not already in use. The ME shall forward the RAND and AUTN to the USIM to
check.
The UE may reject the core network due to an incorrect AUTN or ngKSI
parameter. If the UE has to reject the 5G authentication challenge, the UE
shall return AUTHENTICATION FAILURE message to the network with a cause value
indicating the reason for the failure (see 3GPP TS 33.501 [24]).
Incorrect 5G authentication challenge data contains four possible causes for
authentication failure:
a) MAC code failure:
If the UE finds the MAC code (supplied by the core network in the AUTN
parameter) to be invalid, the UE shall send an AUTHENTICATION FAILURE message
to the network, with the 5GMM cause #20 \"MAC failure\". The UE shall then
follow the procedure described in subclause 5.4.1.3.7, item c.
b) Non-5G authentication unacceptable:
If the UE finds that the \"separation bit\" in the AMF field of AUTN supplied
by the core network is set to 0, the UE shall send an AUTHENTICATION FAILURE
message to the network, with the 5GMM cause #26 \"non-5G authentication
unacceptable\" (see subclause 6.1.3 in 3GPP TS 33.501 [24]). The UE shall then
follow the procedure described in subclause 5.4.1.3.7, item d.
c) ngKSI already in use:
If the UE detects that ngKSI received in the AUTHENTICATION REQUEST message is
already in use in the UE shall send an AUTHENTICATION FAILURE message to the
network, with the 5GMM cause #71 \"ngKSI already in use\". The UE shall then
follow the procedure described in subclause 5.4.1.3.7, item e.
d) SQN failure:
If the UE finds the sequence number SQN (supplied by the core network in the
AUTN parameter) to be out of range, the UE shall send an AUTHENTICATION
FAILURE message to the network, with the 5GMM cause #21 \"synch failure\" and
a re-synchronization token AUTS provided by the USIM (see 3GPP TS 33.102
[23]). The UE shall then follow the procedure described in subclause
5.4.1.3.7, item f.
If the UE returns an AUTHENTICATION FAILURE message to the network, the UE
shall delete any previously stored RAND and RES* and shall stop timer T3516,
if running.
If the UE has an emergency PDU session established or is establishing such a
PDU session, additional UE requirements are specified in subclause 5.4.1.3.7,
under \"for items c, d, e and f\".
##### 5.4.1.3.7 Abnormal cases
a) Lower layer failure.
Upon detection of lower layer failure before the AUTHENTICATION RESPONSE
message is received, the network shall abort the procedure.
b) Expiry of timer T3560.
The network shall, on the first expiry of the timer T3560, retransmit the
AUTHENTICATION REQUEST message and shall reset and start timer T3560. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3560, the network shall abort the 5G AKA based primary authentication and key
agreement procedure and any ongoing 5GMM specific procedure and release the N1
NAS signalling connection.
c) Authentication failure (5GMM cause #20 \"MAC failure\").
The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #20 \"MAC
failure\" according to subclause 5.4.1.3.6, to the network and start timer
T3520 (see example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any
of the retransmission timers that are running (e.g. T3510, T3517 or T3521).
Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with
5GMM cause #20 \"MAC failure\", the network may initiate the identification
procedure described in subclause 5.4.3. This is to allow the network to obtain
the SUCI from the UE. The network may then check that the 5G-GUTI originally
used in the 5G authentication challenge corresponded to the correct SUPI. Upon
receipt of the IDENTITY REQUEST message from the network, the UE shall proceed
as specified in subclause 5.4.3.3.
NOTE 1: Upon receipt of an AUTHENTICATION FAILURE message from the UE with
5GMM cause #20 \"MAC failure\", the network may also terminate the 5G AKA
based primary authentication and key agreement procedure (see subclause
5.4.1.3.5).
If the mapping of 5G-GUTI to SUPI in the network was incorrect, the network
should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon
receiving the new AUTHENTICATION REQUEST message from the network, the UE
shall stop the timer T3520, if running, and then process the 5G challenge
information as normal. If the mapping of 5G-GUTI to SUPI in the network was
correct, the network should terminate the 5G AKA based primary authentication
and key agreement procedure by sending an AUTHENTICATION REJECT message (see
subclause 5.4.1.3.5).
If the network is validated successfully (an AUTHENTICATION REQUEST message
that contains a valid SQN and MAC is received), the UE shall send the
AUTHENTICATION RESPONSE message to the network and shall start any
retransmission timers (e.g. T3510, T3517 or T3521) if they were running and
stopped when the UE received the first failed AUTHENTICATION REQUEST message.
If the UE receives the second AUTHENTICATION REQUEST message, and the MAC
value cannot be resolved, the UE shall follow the procedure specified in this
subclause, item c, starting again from the beginning, or if the message
contains a UMTS authentication challenge, the UE shall follow the procedure
specified in item d. If the SQN is invalid, the UE shall proceed as specified
in item f.
Figure 5.4.1.3.7.1: Authentication failure during 5G AKA based primary
authentication and key agreement procedure
d) Authentication failure (5GMM cause #26 \"non-5G authentication
unacceptable\").
The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #26
\"non-5G authentication unacceptable\", to the network and start the timer
T3520 (see example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any
of the retransmission timers that are running (e.g. T3510, T3517 or T3521).
Upon the first receipt of an AUTHENTICATION FAILURE message from the UE with
5GMM cause #26 \"non-5G authentication unacceptable\", the network may
initiate the identification procedure described in subclause 5.4.3. This is to
allow the network to obtain the SUCI from the UE. The network may then check
that the 5G-GUTI originally used in the 5G authentication challenge
corresponded to the correct SUPI. Upon receipt of the IDENTITY REQUEST message
from the network, the UE shall proceed as specified in subclause 5.4.3.3.
NOTE 2: Upon receipt of an AUTHENTICATION FAILURE message from the UE with
5GMM cause #26 \"non-5G authentication unacceptable\", the network may also
terminate the 5G AKA based primary authentication and key agreement procedure
(see subclause 5.4.1.3.5).
If the mapping of 5G-GUTI to SUPI in the network was incorrect, the network
should respond by sending a new AUTHENTICATION REQUEST message to the UE. Upon
receiving the new AUTHENTICATION REQUEST message from the network, the UE
shall stop the timer T3520, if running, and then process the 5G challenge
information as normal. If the mapping of 5G-GUTI to SUPI in the network was
correct, the network should terminate the 5G AKA based primary authentication
and key agreement authentication procedure by sending an AUTHENTICATION REJECT
message (see subclause 5.4.1.3.5).
If the network is validated successfully (an AUTHENTICATION REQUEST message
that contains a valid 5G authentication challenge is received), the UE shall
send the AUTHENTICATION RESPONSE message to the network and shall start any
retransmission timers (e.g. T3510, T3517 or T3521) if they were running and
stopped when the UE received the first failed AUTHENTICATION REQUEST message.
e) Authentication failure (5GMM cause #71 \"ngKSI already in use\").
The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #71
\"ngKSI already in use\", to the network and start the timer T3520 (see
example in figure 5.4.1.3.7.1). Furthermore, the UE shall stop any of the
retransmission timers that are running (e.g. T3510, T3517 or T3521). Upon the
first receipt of an AUTHENTICATION FAILURE message from the UE with 5GMM cause
#71 \"ngKSI already in use\", the network performs necessary actions to select
a new ngKSI and send the same 5G authentication challenge to the UE.
NOTE 3: Upon receipt of an AUTHENTICATION FAILURE message from the UE with
5GMM cause #71 \"ngKSI already in use\", the network may also re-initiate the
5G AKA based primary authentication and key agreement procedure (see subclause
5.4.1.3.2).
Upon receiving the new AUTHENTICATION REQUEST message from the network, the UE
shall stop the timer T3520, if running, and then process the 5G challenge
information as normal.
If the network is validated successfully (an AUTHENTICATION REQUEST message
that contains a valid ngKSI, SQN and MAC is received), the UE shall send the
AUTHENTICATION RESPONSE message to the network and shall start any
retransmission timers (e.g. T3510, T3517 or T3521) if they were running and
stopped when the UE received the first failed AUTHENTICATION REQUEST message.
f) Authentication failure (5GMM cause #21 \"synch failure\").
The UE shall send an AUTHENTICATION FAILURE message, with 5GMM cause #21
\"synch failure\", to the network and start the timer T3520 (see example in
figure 5.4.1.3.7.1). Furthermore, the UE shall stop any of the retransmission
timers that are running (e.g. T3510, T3517 or T3521). Upon the first receipt
of an AUTHENTICATION FAILURE message from the UE with the 5GMM cause #21
\"synch failure\", the network shall use the returned AUTS parameter from the
authentication failure parameter IE in the AUTHENTICATION FAILURE message, to
re-synchronise. The re-synchronisation procedure requires the AMF to delete
all unused authentication vectors for that SUPI and obtain new vectors from
the UDM/AUSF. When re-synchronisation is complete, the network shall initiate
the 5G AKA based primary authentication and key agreement procedure. Upon
receipt of the AUTHENTICATION REQUEST message, the UE shall stop the timer
T3520, if running.
NOTE 4: Upon receipt of two consecutive AUTHENTICATION FAILURE messages from
the UE with 5GMM cause #21 \"synch failure\", the network may terminate the 5G
AKA based primary authentication and key agreement procedure by sending an
AUTHENTICATION REJECT message.
If the network is validated successfully (a new AUTHENTICATION REQUEST message
is received which contains a valid SQN and MAC) while T3520 is running, the UE
shall send the AUTHENTICATION RESPONSE message to the network and shall start
any retransmission timers (e.g. T3510, T3517 or T3521), if they were running
and stopped when the UE received the first failed AUTHENTICATION REQUEST
message.
Upon receipt of an AUTHENTICATION REJECT message, the UE shall perform the
actions as specified in subclause 5.4.1.3.5.
g) Network failing the authentication check.
If the UE deems that the network has failed the authentication check, then it
shall request RRC to locally release the RRC connection and treat the active
cell as barred (see 3GPP TS 38.304 [28]). The UE shall start any
retransmission timers (e.g. T3510, T3517 or T3521), if they were running and
stopped when the UE received the first AUTHENTICATION REQUEST message
containing an incorrect authentication challenge data causing authentication
failure.
h) Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION
FAILURE message indication from lower layers (if the 5G AKA based primary
authentication and key agreement procedure is triggered by a registration
procedure for mobility and periodic registration update).
The UE shall stop the timer T3520, if running, and re-initiate the
registration procedure for mobility and periodic registration update.
i) Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION
FAILURE message indication with TAI change from lower layers (if the 5G AKA
based primary authentication and key agreement procedure is triggered by a
service request procedure).
The UE shall stop the timer T3520, if running.
If the current TAI is not in the TAI list, the 5G AKA based primary
authentication and key agreement procedure shall be aborted and a registration
procedure for mobility and periodic registration update shall be initiated.
If the current TAI is still part of the TAI list, it is up to the UE
implementation how to re-run the ongoing procedure that triggered the 5G AKA
based primary authentication and key agreement procedure.
j) Transmission failure of AUTHENTICATION RESPONSE message or AUTHENTICATION
FAILURE message indication without TAI change from lower layers (if the
authentication procedure is triggered by a service request procedure).
The UE shall stop the timer T3520, if running. It is up to the UE
implementation how to re-run the ongoing procedure that triggered the 5G AKA
based primary authentication and key agreement procedure.
k) Lower layers indication of non-delivered NAS PDU due to handover.
If the AUTHENTICATION REQUEST message could not be delivered due to an intra
AMF handover and the target TA is included in the TAI list, then upon
successful completion of the intra AMF handover the AMF shall retransmit the
AUTHENTICATION REQUEST message. If a failure of handover procedure is reported
by the lower layer and the N1 NAS signalling connection exists, the AMF shall
retransmit the AUTHENTICATION REQUEST message.
For items c, d, e, and f whether or not the UE is registered for emergency
services:
The UE shall stop timer T3520, if the timer is running and the UE enters 5GMM-
IDLE mode, e.g. upon detection of a lower layer failure, release of the N1 NAS
signalling connection, or as the result of an inter-system change in 5GMM-
CONNECTED mode from N1 mode to S1 mode.
The UE shall deem that the network has failed the authentication check or
assume that the authentication is not genuine and proceed as described in item
g above if any of the following occurs:
\- the timer T3520 expires;
\- the UE detects any combination of the 5G authentication failures: 5GMM
causes #20 \"MAC failure\", #21 \"synch failure\", #26 \"non-5G authentication
unacceptable\" or #71 \"ngKSI already in use\", during three consecutive
authentication challenges. The 5G authentication challenges shall be
considered as consecutive only, if the 5G authentication challenges causing
the second and third 5G authentication failure are received by the UE, while
the timer T3520 started after the previous 5G authentication failure is
running.
For items c, d, e, and f:
Depending on local requirements or operator preference for emergency services,
if the UE has an emergency PDU session established or is establishing an
emergency PDU session, the AMF need not follow the procedures specified for
the authentication failure specified in the present subclause. The AMF may
respond to the AUTHENTICATION FAILURE message by initiating the security mode
control procedure selecting the \"null integrity protection algorithm\"
5G-IA0, \"null ciphering algorithm\" 5G-EA0 or may abort the 5G AKA based
primary authentication and key agreement procedure and continue using the
current security context, if any. The AMF shall release all non-emergency PDU
sessions, if any, by initiating a PDU session release procedure. If there is
an ongoing PDU session establishment procedure, the AMF shall release all non-
emergency PDU sessions upon completion of the PDU session establishment
procedure. The network shall behave as if the UE is registered for emergency
services.
If a UE has an emergency PDU session established or is establishing an
emergency PDU session and sends an AUTHENTICATION FAILURE message to the AMF
with the 5GMM cause appropriate for these cases (#20, #21, #26, or #71
respectively) and receives the SECURITY MODE COMMAND message before the
timeout of timer T3520, the UE shall deem that the network has passed the
authentication check successfully, stop timer T3520, respectively, and execute
the security mode control procedure.
If a UE has an emergency PDU session established or is establishing an
emergency PDU session when timer T3520 expires, the UE shall not deem that the
network has failed the authentication check and not behave as described in
item g. Instead the UE shall continue using the current security context, if
any, release all non-emergency PDU sessions, if any, by initiating UE-
requested PDU session release procedure. If there is an ongoing PDU session
establishment procedure, the UE shall release all non-emergency PDU sessions
upon completion of the PDU session establishment procedure. The UE shall start
any retransmission timers (e.g. T3510, T3517 or T3521) if:
\- they were running and stopped when the UE received the AUTHENTICATION
REQUEST message and detected an authentication failure;
\- the procedures associated with these timers have not yet been completed.
The UE shall behave as if the UE is registered for emergency services.
### 5.4.2 Security mode control procedure
#### 5.4.2.1 General
The purpose of the NAS security mode control procedure is to take a 5G NAS
security context into use, and initialise and start NAS signalling security
between the UE and the AMF with the corresponding 5G NAS keys and 5G NAS
security algorithms.
Furthermore, the network may also initiate the security mode control procedure
in the following cases:
a)- in order to change the 5G NAS security algorithms for a current 5G NAS
security context already in use;
b) in order to change the value of uplink NAS COUNT used in the latest
SECURITY MODE COMPLETE message as described in 3GPP TS 33.501 [24], subclause
6.9.4.4; and
c) in order to provide the Selected EPS NAS security algorithms to the UE.
For restrictions concerning the concurrent running of a security mode control
procedure with other security related procedures in the AS or inside the core
network see 3GPP TS 33.501 [24], subclause 6.9.5.
#### 5.4.2.2 NAS security mode control initiation by the network
The AMF initiates the NAS security mode control procedure by sending a
SECURITY MODE COMMAND message to the UE and starting timer T3560 (see example
in figure 5.4.2.2).
The AMF shall reset the downlink NAS COUNT counter and use it to integrity
protect the initial SECURITY MODE COMMAND message if the security mode control
procedure is initiated:
a) to take into use the security context created after a successful execution
of the 5G AKA based primary authentication and key agreement procedure or the
EAP based primary authentication and key agreement procedure; or
b) upon receipt of REGISTRATION REQUEST message, if the AMF needs to create a
mapped 5G NAS security context (i.e. the type of security context flag is set
to \"mapped security context\" in the NAS key set identifier IE included in
the SECURITY MODE COMMAND message).
The AMF shall send the SECURITY MODE COMMAND message unciphered, but shall
integrity protect the message with the 5G NAS integrity key based on K~AMF~ or
mapped K\'~AMF~ indicated by the ngKSI included in the message. The AMF shall
set the security header type of the message to \"integrity protected with new
5G NAS security context\".
The AMF shall create a locally generated K~AMF~ and send the SECURITY MODE
COMMAND message including an ngKSI value in the NAS key set identifier IE set
to \"000\" and 5G-IA0 and 5G-EA0 as the selected NAS security algorithms only
when the security mode control procedure is initiated:
a) during an initial registration procedure for emergency services if no
shared 5G NAS security context is available;
b) during a registration procedure for mobility and periodic registration
update for a UE that has an emergency PDU session if no shared 5G NAS security
context is available;
c) during a service request procedure for a UE that has an emergency PDU
session if no shared 5G NAS security context is available; or
d) after a failed primary authentication and key agreement procedure procedure
for a UE that has an emergency PDU session or is establishing an emergency PDU
session, if continued usage of a shared 5G NAS security context is not
possible.
The UE shall process a SECURITY MODE COMMAND message including an ngKSI value
in the NAS key set identifier IE set to \"000\" and 5G-IA0 and 5G-EA0 as the
selected NAS security algorithms and, if accepted, create a locally generated
K~AMF~ when the security mode control procedure is initiated:
a) during an initial registration procedure for emergency services;
b) during a registration procedure for mobility and periodic registration
update for a UE that has an emergency PDU session;
c) during a service request procedure for a UE that has an emergency PDU
session; or
d) after a primary authentication and key agreement procedure procedure for a
UE that has an emergency PDU session or is establishing an emergency PDU
session.
NOTE 1: The process for creation of the locally generated K~AMF~ by the AMF
and the UE is implementation dependent. The K~AMF~ is specified in 3GPP TS
33.501 [24].
Upon receipt of a REGISTRATION REQUEST message, if the AMF does not have the
valid current 5G NAS security context indicated by the UE, the AMF shall
either:
a) indicate the use of the new mapped 5G NAS security context to the UE by
setting the type of security context flag in the NAS key set identifier IE to
\"mapped security context\" and the KSI value related to the security context
of the source system; or
b) set the ngKSI value \"000\" in the NAS key set identifier IE if the AMF
sets 5G-IA0 and 5G-EA0 as the selected NAS security algorithms for a UE that
has an emergency PDU session.
While having a current mapped 5G NAS security context with the UE, if the AMF
needs to take the native 5G NAS security context into use, the AMF shall
include the ngKSI that indicates the native 5G NAS security context in the
SECURITY MODE COMMAND message.
The AMF shall include the replayed security capabilities of the UE (including
the security capabilities with regard to NAS, RRC and UP (user plane)
ciphering as well as NAS and RRC integrity, and other possible target network
security capabilities, i.e. E-UTRAN if the UE included them in the message to
network), the selected 5GS ciphering and integrity algorithms and the ngKSI.
If a UE is already registered over one access to a PLMN and the AMF decides to
skip primary authentication and key agreement procedure when the UE attempts
to register over the other access to the same PLMN, the AMF shall take into
use the UE\'s current 5G NAS security context over the other access that the
UE is registering. In this case, SECURITY MODE COMMAND message is not sent to
the UE.
If the UE is registered to the same AMF and the same PLMN over both 3GPP
access and non-3GPP access, and the UE is in 5GMM-CONNECTED mode over both the
3GPP and non-3GPP accesses, then at any time the primary authentication and
key agreement procedure has successfully completed over:
a) the 3GPP access, the AMF includes the ngKSI in the SECURITY MODE COMMAND
message over the 3GPP access. When the AMF sends the SECURITY MODE COMMAND
message to UE over the non-3GPP access to take into use the new 5G NAS
security context, the AMF shall include the same ngKSI in the SECURITY MODE
COMMAND message to identify the new 5G NAS security context; or
b) the non 3GPP access, the AMF includes the ngKSI in the SECURITY MODE
COMMAND message over the non-3GPP access. When the AMF sends the SECURITY MODE
COMMAND message to UE over the 3GPP access to take into use the new 5G NAS
security context, the AMF shall include the same ngKSI in the SECURITY MODE
COMMAND message to identify the new 5G NAS security context.
The AMF may initiate a SECURITY MODE COMMAND in order to change the 5G
security algorithms for a current 5G NAS security context already in use. The
AMF re-derives the 5G NAS keys from K~AMF~ with the new 5G algorithm
identities as input and provides the new 5GS algorithm identities within the
SECURITY MODE COMMAND message. The AMF shall set the security header type of
the message to \"integrity protected with new 5G NAS security context\".
If, during an ongoing registration procedure, the AMF is initiating a SECURITY
MODE COMMAND (i.e. after receiving the REGISTRATION REQUEST message, but
before sending a response to that message) and the REGISTRATION REQUEST
message does not successfully pass the integrity check at the AMF, the AMF
shall include the Additional 5G security information IE with the RINMR bit set
to \"Retransmission of the initial NAS message requested\" in the SECURITY
MODE COMMAND message requesting the UE to send the entire REGISTRATION REQUEST
message in the SECURITY MODE COMPLETE message as described in 3GPP TS 33.501
[24].
If, during an ongoing service request procedure for a UE with an emergency PDU
session, the AMF is initiating a SECURITY MODE COMMAND (i.e. after receiving
the SERVICE REQUEST message, but before sending a response to that message)
and the SERVICE REQUEST message does not successfully pass the integrity check
at the AMF, the AMF shall include the Additional 5G security information IE
with the RINMR bit set to \"Retransmission of the initial NAS message
requested\" in the SECURITY MODE COMMAND message requesting the UE to send the
entire SERVICE REQUEST message in the SECURITY MODE COMPLETE message as
described in 3GPP TS 33.501 [24].
Additionally, the AMF may request the UE to include its IMEISV in the SECURITY
MODE COMPLETE message.
If the AMF supports N26 interface and the UE set the S1 mode bit to \"S1 mode
supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message, the
AMF shall select ciphering and integrity algorithms to be used in the EPS and
indicate them to the UE via the Selected EPS NAS security algorithms IE in the
SECURITY MODE COMMAND message.
NOTE 2: The AS and NAS security capabilities are the same, i.e. if the UE
supports one algorithm for NAS, the same algorithm is also supported for AS.
If the AMF performs horizontal key derivation e.g. during the mobility and
periodic registration update or when the UE is already registered in the PLMN
with another access type as described in 3GPP TS 33.501 [24], the AMF shall
include horizontal derivation parameter in the SECURITY MODE COMMAND message.
If the security mode control procedure is initiated after successful EAP based
primary authentication and key agreement procedure and the security mode
control procedure intends to bring into use the partial native 5G NAS security
context created by the EAP based primary authentication and key agreement
procedure, the AMF shall set the EAP message IE of the SECURITY MODE COMMAND
message to an EAP-success message to be sent to the UE.
Figure 5.4.2.2: Security mode control procedure
#### 5.4.2.3 NAS security mode command accepted by the UE
Upon receipt of the SECURITY MODE COMMAND message, the UE shall check whether
the security mode command can be accepted or not. This is done by performing
the integrity check of the message, and by checking that the received Replayed
UE security capabilities IE has not been altered compared to the latest values
that the UE sent to the network.
When the SECURITY MODE COMMAND message includes an EAP-success message the UE
handles the EAP-success message and the ABBA as described in subclause
5.4.1.2.2.8.
If the UE is registered for emergency services, performing initial
registration for emergency services or establishing an emergency PDU session
and the SECURITY MODE COMMAND message is received with ngKSI value \"000\" and
5G-IA0 and 5G-EA0 as selected 5G NAS security algorithms, the UE shall locally
derive and take in use 5G NAS security context. The UE shall delete existing
current 5G NAS security context.
The UE shall accept a SECURITY MODE COMMAND message indicating the \"null
integrity protection algorithm\" 5G-EA0 as the selected 5G NAS integrity
algorithm only if the message is received when the UE is registered for
emergency services, performing initial registration for emergency services or
establishing an emergency PDU session.
If the type of security context flag included in the SECURITY MODE COMMAND
message is set to \"native security context\" and if the ngKSI matches a valid
non-current native 5G NAS security context held in the UE while the UE has a
mapped 5G NAS security context as the current 5G NAS security context, the UE
shall take the non-current native 5G NAS security context into use which then
becomes the current native 5G NAS security context and delete the mapped 5G
NAS security context.
The UE shall ignore the Replayed S1 UE security capabilities IE if this IE is
included in the SECURITY MODE COMMAND message.
If the SECURITY MODE COMMAND message can be accepted, the UE shall take the 5G
NAS security context indicated in the message into use. The UE shall in
addition reset the uplink NAS COUNT counter if:
a) the SECURITY MODE COMMAND message is received in order to take a 5G NAS
security context into use created after a successful execution of the 5G AKA
based primary authentication and key agreement procedure or the EAP based
primary authentication and key agreement procedure; or
b) the SECURITY MODE COMMAND message received includes the type of security
context flag set to \"mapped security context\" in the NAS key set identifier
IE the ngKSI does not match the current 5G NAS security context, if it is a
mapped 5G NAS security context.
If the SECURITY MODE COMMAND message can be accepted and a new 5G NAS security
context is taken into use and SECURITY MODE COMMAND message does not indicate
the \"null integrity protection algorithm\" 5G-IA0 as the selected NAS
integrity algorithm, the UE shall:
\- if the SECURITY MODE COMMAND message has been successfully integrity
checked using an estimated downlink NAS COUNT equal to 0, then the UE shall
set the downlink NAS COUNT of this new 5G NAS security context to 0;
\- otherwise the UE shall set the downlink NAS COUNT of this new 5G NAS
security context to the downlink NAS COUNT that has been used for the
successful integrity checking of the SECURITY MODE COMMAND message.
If the SECURITY MODE COMMAND message includes the horizontal derivation
parameter indicating \"K~AMF~ derivation is required\", the UE shall derive a
new K\'~AMF~, as specified in 3GPP TS 33.501 [24] for K~AMF~ to K\'~AMF~
derivation in mobility, and set both uplink and downlink NAS COUNTs to zero.
When the new 5G NAS security context is taken into use for current access and
the UE is registered with the same PLMN over the 3GPP access and the non-3GPP
access:
a) the UE is in 5GMM-IDLE mode over the non-current access, the AMF and the UE
shall activate the new 5G NAS security context over the non-current access as
described in 3GPP TS 33.501 [24]. The AMF and the UE shall set the downlink
NAS COUNT and uplink NAS COUNT to zero for the non-current access; or
b) the UE is in 5GMM-CONNECTED mode over the non-current access, the AMF shall
send the SECURITY MODE COMMAND message over the non-current access to activate
the new 5G NAS security context that was activated over the current access as
described in 3GPP TS 33.501 [24]. The AMF shall include the same ngKSI in the
SECURITY MODE COMMAND message to identify the new 5G NAS security context.
If the SECURITY MODE COMMAND message includes the horizontal derivation
parameter indicating \"K~AMF~ derivation is not required\" or the Additional
5G security parameters IE is not included in the message, the UE is registered
with the same PLMN over the 3GPP access and non-3GPP access, then after the
completion of a security mode control procedure over the current access:
a) the UE is in 5GMM-IDLE mode over the non-current access, the AMF and the UE
shall activate the new 5G NAS security context for the non-current access. If
a primary authentication and key agreement procedure was completed before the
security mode control procedure, the AMF and the UE shall set the downlink NAS
COUNT and uplink NAS COUNT to zero for the non-current access, otherwise the
downlink NAS COUNT and uplink NAS COUNT for the non-3GPP access are not
changed; or
b) the UE is in 5GMM-CONNECTED mode over the non-current access, the AMF shall
send the SECURITY MODE COMMAND message over the non-current access to activate
the new 5G NAS security context that was activated over the current access as
described in 3GPP TS 33.501 [24]. The AMF shall include the same ngKSI in the
SECURITY MODE COMMAND message to identify the new 5G NAS security context.
If the SECURITY MODE COMMAND message can be accepted, the UE shall send a
SECURITY MODE COMPLETE message integrity protected with the selected 5GS
integrity algorithm and the 5G NAS integrity key based on the K~AMF~ or mapped
K\'~AMF~ if the type of security context flag is set to \"mapped security
context\" indicated by the ngKSI. When the SECURITY MODE COMMAND message
includes the type of security context flag set to \"mapped security context\"
in the NAS key set identifier IE, then the UE shall check whether the SECURITY
MODE COMMAND message indicates the ngKSI of the current 5GS security context,
if it is a mapped 5G NAS security context, in order not to re-generate the
K\'~AMF~.
Furthermore, if the SECURITY MODE COMMAND message can be accepted, the UE
shall cipher the SECURITY MODE COMPLETE message with the selected 5GS
ciphering algorithm and the 5GS NAS ciphering key based on the K~AMF~ or
mapped K\'~AMF~ indicated by the ngKSI. The UE shall set the security header
type of the message to \"integrity protected and ciphered with new 5G NAS
security context\".
From this time onward the UE shall cipher and integrity protect all NAS
signalling messages with the selected 5GS integrity and ciphering algorithms.
If the AMF indicated in the SECURITY MODE COMMAND message that the IMEISV is
requested, the UE shall include its IMEISV in the SECURITY MODE COMPLETE
message.
If, during an ongoing registration procedure or service request procedure, the
SECURITY MODE COMMAND message includes the Additional 5G security information
IE with the RINMR bit set to \"Retransmission of the initial NAS message
requested\", the UE shall include the entire unciphered REGISTRATION REQUEST
message or SERVICE REQUEST message, which the UE had previously included in
the NAS message container IE of the initial NAS message (i.e. REGISTRATION
REQUEST message or SERVICE REQUEST message, respectively), in the NAS message
container IE of the SECURITY MODE COMPLETE message.
If, prior to receiving the SECURITY MODE COMMAND message, the UE without a
valid 5GS NAS security context had sent a REGISTRATION REQUEST message the UE
shall include the entire REGISTRATION REQUEST message in the NAS message
container IE of the SECURITY MODE COMPLETE message as described in subclause
4.4.6.
If the UE operating in the single-registration mode receives the Selected EPS
NAS security algorithms IE, the UE shall use the IE according to 3GPP TS
33.501 [24].
For a UE operating in single-registration mode with N26 interface supported in
the network, after an inter-system change from S1 mode to N1 mode in 5GMM-
CONNECTED mode, the UE shall set the value of the Selected EPS NAS security
algorithms IE in the 5G NAS security context to the NAS security algorithms
that were received from the source MME when the UE was in S1 mode.
#### 5.4.2.4 NAS security mode control completion by the network
The AMF shall, upon receipt of the SECURITY MODE COMPLETE message, stop timer
T3560. From this time onward the AMF shall integrity protect and encipher all
signalling messages with the selected 5GS integrity and ciphering algorithms.
If the SECURITY MODE COMPLETE message contains a NAS message container IE with
a REGISTRATION REQUEST message, the AMF shall complete the ongoing
registration procedure by considering the REGISTRATION REQUEST message
contained in the NAS message container IE as the message that triggered the
procedure.
If the SECURITY MODE COMPLETE message contains a NAS message container IE with
a SERVICE REQUEST message, the AMF shall complete the ongoing service request
procedure by considering the SERVICE REQUEST message contained in the NAS
message container IE as the message that triggered the procedure.
#### 5.4.2.5 NAS security mode command not accepted by the UE
If the security mode command cannot be accepted, the UE shall send a SECURITY
MODE REJECT message. The SECURITY MODE REJECT message contains a 5GMM cause
that typically indicates one of the following cause values:
#23 UE security capabilities mismatch.
#24 security mode rejected, unspecified.
If the UE detects that the received Replayed UE security capabilities IE has
been altered compared to the latest values that the UE sent to the network,
the UE shall set the cause value to #23 \"UE security capabilities mismatch\".
Upon receipt of the SECURITY MODE REJECT message, the AMF shall stop timer
T3560. The AMF shall also abort the ongoing procedure that triggered the
initiation of the NAS security mode control procedure.
Both the UE and the AMF shall apply the 5G NAS security context in use before
the initiation of the security mode control procedure, if any, to protect the
SECURITY MODE REJECT message and any other subsequent messages according to
the rules in subclause 4.4.4 and 4.4.5.
#### 5.4.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE
REJECT message indication from lower layers (if the security mode control
procedure is triggered by a registration procedure).
The UE shall abort the security mode control procedure and re-initiate the
registration procedure.
b) Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE
REJECT message indication with TAI change from lower layers (if the security
mode control procedure is triggered by a service request procedure).
If the current TAI is not in the TAI list, the security mode control procedure
shall be aborted and a registration procedure shall be initiated.
If the current TAI is still part of the TAI list, the security mode control
procedure shall be aborted and it is up to the UE implementation how to re-run
the ongoing procedure that triggered the security mode control procedure.
c) Transmission failure of SECURITY MODE COMPLETE message or SECURITY MODE
REJECT message indication without TAI change from lower layers (if the
security mode control procedure is triggered by a service request procedure).
The security mode control procedure shall be aborted and it is up to the UE
implementation how to re-run the ongoing procedure that triggered the security
mode control procedure.
#### 5.4.2.7 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Lower layer failure before the SECURITY MODE COMPLETE or SECURITY MODE
REJECT message is received.
The network shall abort the security mode control procedure.
b) Expiry of timer T3560.
The network shall, on the first expiry of the timer T3560, retransmit the
SECURITY MODE COMMAND message and shall reset and start timer T3560. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3560, the procedure shall be aborted.
c) Collision between security mode control procedure and registration, service
request or de-registration procedure not indicating switch off.
The network shall abort the security mode control procedure and proceed with
the UE initiated procedure.
d) Collision between security mode control procedure and other 5GMM procedures
than in item c.
The network shall progress both procedures.
e) Lower layers indication of non-delivered NAS PDU due to handover:
If the SECURITY MODE COMMAND message could not be delivered due to an intra
AMF handover and the target TA is included in the TAI list, then upon
successful completion of the intra AMF handover the AMF shall retransmit the
SECURITY MODE COMMAND message. If a failure of the handover procedure is
reported by the lower layer and the N1 signalling connection exists, the AMF
shall retransmit the SECURITY MODE COMMAND message.
### 5.4.3 Identification procedure
#### 5.4.3.1 General
The purpose of this procedure is to request a particular UE to provide
specific identification parameters, e.g. the SUCI or the IMEI. The SUCI is a
privacy preserving identifier containing the concealed SUPI and IMEI is a
format of PEI.
#### 5.4.3.2 Identification initiation by the network
The AMF initiates the identification procedure by sending an IDENTITY REQUEST
message to the UE and starting timer T3570 (see example in figure 5.4.3.2.1).
The IDENTITY REQUEST message specifies the requested identification parameters
in the Identity type information element.
Figure 5.4.3.2.1: Identification procedure
#### 5.4.3.3 Identification response by the UE
A UE shall be ready to respond to an IDENTITY REQUEST message at any time
whilst in 5GMM-CONNECTED mode.
Upon receipt of the IDENTITY REQUEST message:
a) if the Identity type IE in the IDENTITY REQUEST message is not set to
\"SUCI\", the UE shall send an IDENTITY RESPONSE message to the network. The
IDENTITY RESPONSE message shall contain the identification parameters as
requested by the network; and
b) if the Identity type IE in the IDENTITY REQUEST message is set to \"SUCI\",
the UE shall:
1) if timer T3519 is not running, generate a fresh SUCI as specified in 3GPP
TS 33.501 [24], send an IDENTITY RESPONSE message with the SUCI, start timer
T3519 and store the value of the SUCI sent in the IDENTITY RESPONSE message;
and
2) if timer T3519 is running, send an IDENTITY RESPONSE message with the
stored SUCI.
#### 5.4.3.4 Identification completion by the network
Upon receipt of the IDENTITY RESPONSE the network shall stop the timer T3570.
#### 5.4.3.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Transmission failure of the IDENTITY RESPONSE message (if the
identification procedure is triggered by a registration procedure).
The UE shall re-initiate the registration procedure.
b) Requested identity is not available
If the UE cannot encode the requested identity in the IDENTITY RESPONSE
message, e.g. because no valid USIM is available, then it shall encode the
identity type as \"No identity\".
#### 5.4.3.6 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Lower layer failure.
Upon detection of a lower layer failure before the IDENTITY RESPONSE is
received, the network shall abort any ongoing 5GMM procedure.
b) Expiry of timer T3570.
The network shall, on the first expiry of the timer T3570, retransmit the
IDENTITY REQUEST message and reset and restart the timer T3570. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3570, the network shall abort the identification procedure and any ongoing
5GMM procedure.
c) Collision of an identification procedure with a registration procedure for
initial registration.
If the network receives a REGISTRATION REQUEST message indicating either
\"initial registration\" or \"emergency registration\" in the 5GS registration
type IE before the ongoing identification procedure has been completed and no
registration procedure is pending on the network (i.e. no REGISTRATION
ACCEPT/REJECT message has still to be sent as an answer to a REGISTRATION
REQUEST message), the network shall proceed with the registration procedure
for initial registration.
d) Collision of an identification procedure with a registration procedure for
initial registration when the identification procedure has been caused by a
registration procedure for initial registration.
If the network receives a REGISTRATION REQUEST message indicating either
\"initial registration\" or \"emergency registration\" in the 5GS registration
type IE before the ongoing identification procedure has been completed and a
registration procedure for initial registration is pending (i.e. a
REGISTRATION ACCEPT/REJECT message has to be sent as an answer to an earlier
REGISTRATION REQUEST message), then:
\- If one or more of the information elements in the REGISTRATION REQUEST
message differ from the ones received within the previous REGISTRATION REQUEST
message, the network shall proceed with the new registration procedure for
initial registration; or
\- If the information elements do not differ, then the network shall not treat
any further this new REGISTRATION REQUEST message.
e) Collision of an identification procedure with a registration procedure for
mobility and periodic registration update.
If the network receives a REGISTRATION REQUEST message indicating either
\"mobility registration updating\" or \"periodic registration updating\" in
the 5GS registration type IE before the ongoing identification procedure has
been completed, the network shall progress both procedures.
f) Collision of an identification procedure with a UE initiated de-
registration procedure.
If the network receives a DEREGISTRATION REQUEST message with \"switch off\"
indication in the De-registration type IE before the ongoing identification
procedure has been completed, the network shall abort the identification
procedure and shall progress the UE-initiated de-registration procedure;
Else the network shall complete the identification procedure and shall respond
to the UE-initiated de-registration procedure as described in subclause
5.5.2.2.
### 5.4.4 Generic UE configuration update procedure
#### 5.4.4.1 General
The purpose of this procedure is to:
a) allow the AMF to update the UE configuration for access and mobility
management-related parameters decided and provided by the AMF by providing new
parameter information within the command; or
b) request the UE to perform a registration procedure for mobility and
periodic registration update towards the network to update access and mobility
management-related parameters decided and provided by the AMF (see subclause
5.5.1.3).
This procedure is initiated by the network and can only be used when the UE
has an established 5GMM context, and the UE is in 5GMM-CONNECTED mode. When
the UE is in 5GMM-IDLE mode, the AMF may use the paging or notification
procedure to initiate the generic UE configuration update procedure. The AMF
can request a confirmation response in order to ensure that the parameter has
been updated by the UE.
This procedure shall be initiated by the network to assign a new 5G-GUTI to
the UE after a successful service request procedure invoked as a response to a
paging request from the network and before the release of the N1 NAS
signalling connection. If the service request procedure was triggered due to
5GSM downlink signalling pending, the procedure for assigning a new 5G-GUTI
can be initiated by the network after the transport of the 5GSM downlink
signalling.
The following parameters are supported by the generic UE configuration update
procedure without the need to request the UE to perform the registration
procedure for mobility and periodic registration update:
a) 5G-GUTI;
b) TAI list;
c) Service area list;
d) Network identity and time zone information (Full name for network, short
name for network, local time zone, universal time and local time zone, network
daylight saving time);
e) LADN information;
f) Rejected NSSAI;
g) Network slicing indication;
h) Operator-defined access category definitions; and
i) SMS indication.
The following parameters can be sent to the UE with or without a request to
perform the registration procedure for mobility and periodic registration
update:
a) Allowed NSSAI; or
b) Configured NSSAI.
The following parameter is sent to the UE with a request to perform the
registration procedure for mobility and periodic registration update:
a) MICO indication.
The following parameters are sent over 3GPP access only:
a) LADN information;
b) MICO indication;
c) TAI list; and
d) Service area list.
The following parameters are managed and sent per access type i.e.,
independently over 3GPP access or non 3GPP access:
a) Allowed NSSAI; and
b) Rejected NSSAI (when the NSSAI is rejected for the current registration
area).
The following parameters are managed commonly and sent over 3GPP access or non
3GPP access:
a) 5G-GUTI;
b) Network identity and time zone information;
c) Rejected NSSAI (when the NSSAI is rejected for the current PLMN);
d) Configured NSSAI; and
e) SMS indication.
Figure 5.4.4.1.1: Generic UE configuration update procedure
#### 5.4.4.2 Generic UE configuration update procedure initiated by the
network
The AMF shall initiate the generic UE configuration update procedure by
sending the CONFIGURATION UPDATE COMMAND message to the UE.
The AMF shall in the CONFIGURATION UPDATE COMMAND message either:
a) include one or more of the following parameters: 5G-GUTI, TAI list, allowed
NSSAI that may include the mapped S-NSSAI(s), LADN information, service area
list, MICO indication NITZ information, configured NSSAI that may include the
mapped S-NSSAI(s), rejected NSSAI, network slicing indication, operator-
defined access category definitions or SMS indication;
b) include the registration requested parameter; or
c) include a combination of both a) and b).
If an acknowledgement from the UE is requested, the AMF shall indicate
acknowledgement requested in the Configuration update indication IE in the
CONFIGURATION UPDATE COMMAND message and shall start timer T3555.
Acknowledgement shall be requested for all parameters except when only NITZ is
included.
To initiate parameter re-negotiation between the UE and network, the AMF shall
indicate \"registration requested\" in the Configuration update indication IE
in the CONFIGURATION UPDATE COMMAND message.
If a new allowed NSSAI information or AMF re-configuration of supported
S-NSSAIs requires an AMF relocation, the AMF shall indicate \"registration
requested\" in the Configuration update indication IE and include the Allowed
NSSAI IE in the CONFIGURATION UPDATE COMMAND message.
If the AMF includes a new configured NSSAI in the CONFIGURATION UPDATE COMMAND
message and the new configured NSSAI requires an AMF relocation as specified
in 3GPP TS 23.501 [8], the AMF shall indicate \"registration requested\" in
the Configuration update indication IE in the message.
If the AMF indicates \"registration requested\" in the Configuration update
indication IE, acknowledgement shall be requested.
If changes to the allowed NSSAI require the UE to initiate a registration
procedure, but the AMF is unable to determine an allowed NSSAI for the UE as
specified in 3GPP TS 23.501 [8], the CONFIGURATION UPDATE COMMAND message
shall indicate \"registration requested\" and shall not contain any other
parameters.
If the AMF needs to update the LADN information, the AMF shall include the
LADN information in the LADN information IE of the CONFIGURATION UPDATE
COMMAND message.
During an established 5GMM context, the network may send none, one, or more
CONFIGURATION UPDATE COMMAND messages to the UE. If more than one
CONFIGURATION UPDATE COMMAND message is sent, the messages need not have the
same content.
#### 5.4.4.3 Generic UE configuration update accepted by the UE
Upon receiving the CONFIGURATION UPDATE COMMAND message, the UE shall stop
timer T3346 if running and use the contents to update appropriate information
stored within the UE.
If acknowledgement requested is indicated in the Configuration update
indication IE in the CONFIGURATION UPDATE COMMAND message, the UE shall send a
CONFIGURATION UPDATE COMPLETE message.
If the UE receives a new 5G-GUTI in the CONFIGURATION UPDATE COMMAND message,
the UE shall consider the new 5G-GUTI as valid, the old 5G-GUTI as invalid,
stop timer T3519 if running, and delete any stored SUCI; otherwise, the UE
shall consider the old 5G-GUTI as valid. The UE shall provide the 5G-GUTI to
the lower layer of 3GPP access if the CONFIGURATION UPDATE COMMAND message is
sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in both 3GPP
access and non-3GPP access in the same PLMN.
If the UE receives a new TAI list in the CONFIGURATION UPDATE COMMAND message,
the UE shall consider the new TAI list as valid and the old TAI list as
invalid; otherwise, the UE shall consider the old TAI list as valid.
If the UE receives a new service area list in the CONFIGURATION UPDATE COMMAND
message, the UE shall consider the new service area list as valid and the old
service area list as invalid; otherwise, the UE shall consider the old service
area list, if any, as valid.
If the UE receives new NITZ information in the CONFIGURATION UPDATE COMMAND
message, the UE considers the new NITZ information as valid and the old NITZ
information as invalid; otherwise, the UE shall consider the old NITZ
information as valid.
If the UE receives a LADN information IE in the CONFIGURATION UPDATE COMMAND
message, the UE shall consider the old LADN information as invalid and the new
LADN information as valid, if any; otherwise, the UE shall consider the old
LADN information as valid.
If the UE receives a new allowed NSSAI for the associated access type in the
CONFIGURATION UPDATE COMMAND message, the UE shall consider the new allowed
NSSAI as valid for the associated access type, store the allowed NSSAI for the
associated access type as specified in subclause 4.6.2.2 and consider the old
allowed NSSAI for the associated access type as invalid; otherwise, the UE
shall consider the old Allowed NSSAI as valid for the associated access type.
If the UE receives a new configured NSSAI in the CONFIGURATION UPDATE COMMAND
message, the UE shall consider the new configured NSSAI for the registered
PLMN as valid and the old configured NSSAI for the registered PLMN as invalid;
otherwise, the UE shall consider the old configured NSSAI for the registered
PLMN as valid The UE shall store the new configured NSSAI as specified in
subclause 4.6.2.2.
If the UE receives the Network slicing indication IE in the CONFIGURATION
UPDATE COMMAND message with the Network slicing subscription change indication
set to \"Network slicing subscription changed\", the UE shall delete the
network slicing information for each and every PLMN except for the current
PLMN as specified in subclause 4.6.2.2.
If the UE receives Operator-defined access category definitions IE in the
CONFIGURATION UPDATE COMMAND message and the Operator-defined access category
definitions IE contains one or more operator-defined access category
definitions, the UE shall delete any operator-defined access category
definitions stored for the RPLMN and shall store the received operator-defined
access category definitions for the RPLMN. If the UE receives the Operator-
defined access category definitions IE in the CONFIGURATION UPDATE COMMAND
message and the Operator-defined access category definitions IE contains no
operator-defined access category definitions, the UE shall delete any
operator-defined access category definitions stored for the RPLMN. If the
CONFIGURATION UPDATE COMMAND message does not contain the Operator-defined
access category definitions IE, the UE shall not delete the operator-defined
access category definitions stored for the RPLMN.
If the UE receives the SMS indication IE in the CONFIGURATION UPDATE COMMAND
message with the SMS availability indication set to:
a) \"SMS over NAS not available\", the UE shall consider that SMS over NAS
transport is not allowed by the network; and
b) \"SMS over NAS available\", the UE may request the use of SMS over NAS
transport by performing a registration procedure for mobility and periodic
registration update as specified in subclause 5.5.1.3, after the completion of
the generic UE configuration update procedure.
If the CONFIGURATION UPDATE COMMAND message indicates \"registration
requested\" in the Configuration update indication IE and:
a) contains no other parameters or contains at least one of the following
parameters: a new allowed NSSAI, a new configured NSSAI or the Network slicing
subscription change indication, and:
1) an emergency PDU session exists, the UE shall, after the completion of the
generic UE configuration update procedure and after the emergency PDU session
is released, release the existing N1 NAS signalling connection, and start a
registration procedure for mobility and periodic registration update as
specified in subclause 5.5.1.3; or
2) no emergency PDU Session exists, the UE shall, after the completion of the
generic UE configuration update procedure, and the release of the existing N1
NAS signalling connection, start a registration procedure for mobility and
periodic registration update as specified in subclause 5.5.1.3; or
b) an MICO indication is included without a new allowed NSSAI or a new
configured NSSAI, the UE shall, after the completion of the generic UE
configuration update procedure, start a registration procedure for mobility
and registration update as specified in subclause 5.5.1.3 to re-negotiate MICO
mode with the network.
The UE receiving the rejected NSSAI in the CONFIGURATION UPDATE COMMAND
message takes the following actions based on the rejection cause in the
rejected NSSAI:
\"S-NSSAI not available in the current PLMN\"
The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current
PLMN as specified in subclause 4.6.2.2 and not attempt to use this S-NSSAI in
the current PLMN until switching off the UE or the UICC containing the USIM is
removed.
\"S-NSSAI not available in the current registration area\"
The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current
registration area as specified in subclause 4.6.2.2 and not attempt to use
this S-NSSAI in the current registration area until switching off the UE, the
UE moving out of the current registration area or the UICC containing the USIM
is removed.
#### 5.4.4.4 Generic UE configuration update completion by the network
Upon receipt of the CONFIGURATION UPDATE COMPLETE message, the AMF shall stop
the timer T3555.
If a new 5G-GUTI was included in the CONFIGURATION UPDATE COMMAND message, the
AMF shall consider the new 5G-GUTI as valid and the old 5G-GUTI as invalid.
If a new TAI list was included in the CONFIGURATION UPDATE COMMAND message,
the AMF shall consider the new TAI list as valid and the old TAI list as
invalid.
If a new service area list was included in the CONFIGURATION UPDATE COMMAND
message, the AMF shall consider the new service area list as valid and the old
service area list as invalid.
If new allowed NSSAI information was included in the CONFIGURATION UPDATE
COMMAND message, the AMF shall consider the new allowed NSSAI information as
valid and the old allowed NSSAI information as invalid. If new configured
NSSAI information was included in the CONFIGURATION UPDATE COMMAND message,
the AMF shall consider the new configured NSSAI information as valid and the
old configured information as invalid. If there are active PDU sessions
associated with S-NSSAI(s) not included in the new allowed NSSAI, the AMF
shall notify the SMF(s) associated with these PDU sessions to initiate the
network-requested PDU session release procedure according to subclause 6.3.3
in the present specification and subclause 5.15.5.2.2 in 3GPP TS 23.501 [8].
If registration requested was indicated in the CONFIGURATION UPDATE COMMAND
message and:
a) the CONFIGURATION UPDATE COMMAND message contained:
1) an allowed NSSAI, a configured NSSAI or both;
2) the Network slicing indication IE with the Network slicing subscription
change indication set to \"Network slicing subscription changed\"; or
3) no other parameters; and
b) no emergency PDU session has been established for the UE;
then the AMF shall initiate the release of the N1 NAS signalling connection.
If a LADN information IE was included in the CONFIGURATION UPDATE COMMAND
message, the AMF shall consider the old LADN information as invalid and the
new LADN information as valid, if any. In this case, if the tracking area
identity list received in the new LADN information does not include the
current TA, the AMF shall indicate the SMF to release the PDU session for LADN
or release the user-plane resources for the PDU session for LADN (see 3GPP TS
23.501 [8] and 3GPP TS 23.502 [9]).
#### 5.4.4.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Transmission failure of the CONFIGURATION UPDATE COMPLETE message with TAI
change from lower layers
If the current TAI is not in the TAI list, the generic UE configuration update
procedure shall be aborted and a registration procedure for mobility and
periodic registration update shall be initiated.
If the current TAI is still part of the TAI list, it is up to the UE
implementation how to re-run the ongoing procedure that triggered the generic
UE configuration update procedure.
b) Transmission failure of CONFIGURATION UPDATE COMPLETE message indication
without TAI change from lower layers
It is up to the UE implementation how to re-run the ongoing procedure that
triggered the generic UE configuration update procedure.
c) Generic UE configuration update and de-registration procedure collision
If the UE receives CONFIGURATION UPDATE COMMAND message after sending a
DEREGISTRATION REQUEST message and the access type included in the
DEREGISTRATION REQEUST message is same as the access in which the
CONFIGURATION UPDATE COMMAND message is received, then the UE shall ignore the
CONFIGURATION UPDATE COMMAND message and proceed with the de-registration
procedure. Otherwise, the UE shall proceed with both the procedures.
d) Void
e) Generic UE configuration update and service request procedure collision
If the UE receives a CONFIGURATION UPDATE COMMAND message before the ongoing
service request procedure has been completed, the UE shall proceed with both
the procedures.
#### 5.4.4.6 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Expiry of timer T3555.
The network shall, on the first expiry of the timer T3555, retransmit the
CONFIGURATION UPDATE COMMAND message and shall reset and start timer T3555.
This retransmission is repeated four times, i.e. on the fifth expiry of timer
T3555, the procedure shall be aborted. In addition, if the CONFIGURATION
UPDATE COMMAND message includes the 5G-GUTI IE, the network shall behave as
described in case b)-1) below.
b) Lower layer failure.
If a lower layer failure is detected before the CONFIGURATION UPDATE COMPLETE
message is received and:
1) if the CONFIGURATION UPDATE COMMAND message includes the 5G-GUTI IE, the
old and the new 5G-GUTI shall be considered as valid until the old 5G-GUTI can
be considered as invalid by the AMF. If a new TAI list was provided in the
CONFIGURATION UPDATE COMMAND message, the old and new TAI list shall also be
considered as valid until the old TAI list can be considered as invalid by the
AMF.
During this period the AMF:
i) may first use the old 5G-S-TMSI from the old 5G-GUTI for paging within the
area defined by the old TAI list for an implementation dependent number of
paging attempts for network originated transactions. If a new TAI list was
provided with old 5G-GUTI in the CONFIGURATION UPDATE COMMAND message, the new
TAI list should also be used for paging. Upon response from the UE, the AMF
may re-initiate the CONFIGURATION UPDATE COMMAND. If the response is received
from a tracking area within the old and new TAI list, the network shall re-
initiate the CONFIGURATION UPDATE COMMAND message. If no response is received
to the paging attempts, the network may use the new 5G-S-TMSI from the new
5G-GUTI for paging for an implementation dependent number of paging attempts.
In this case, if a new TAI list was provided with new 5G-GUTI in the
CONFIGURATION UPDATE COMMAND message, the new TAI list shall be used instead
of the old TAI list. Upon response from the UE the AMF shall consider the new
5G-GUTI as valid and the old 5G-GUTI as invalid.
ii) shall consider the new 5G-GUTI as valid if it is used by the UE and,
additionally, the new TAI list as valid if it was provided with this 5G-GUTI
in the CONFIGURATION UPDATE COMMAND message; and
iii) may use the identification procedure followed by a new generic UE
configuration update procedure if the UE uses the old 5G-GUTI; or
2) if the CONFIGURATION UPDATE COMMAND message does not include the 5G-GUTI
IE, the network shall abort the procedure.
c) Generic UE configuration update and UE initiated de-registration procedure
collision.
If the network receives a DEREGISTRATION REQUEST message before the ongoing
generic UE configuration update procedure has been completed, the network
shall abort the generic UE configuration update procedure and shall progress
the de-registration procedure.
d) Generic UE configuration update and registration procedure for mobility and
periodic registration update collision
If the network receives a REGISTRATION REQUEST message before the ongoing
generic UE configuration update procedure has been completed, the network
shall abort the generic UE configuration update procedure and shall progress
the registration procedure for mobility and periodic registration update
procedure.
e) Generic UE configuration update and service request procedure collision
If the network receives a SERVICE REQUEST message before the ongoing generic
UE configuration update procedure has been completed, both the procedures
shall be progressed.
### 5.4.5 NAS transport procedure(s)
#### 5.4.5.1 General
The purpose of the NAS transport procedures is to provide a transport of
payload between the UE and the AMF. The type of the payload is identified by
the Payload container type IE and includes one of the following:
a) a single 5GSM message;
b) SMS;
c) an LPP message (see 3GPP TS 36.355 [26]);
d) an SOR transparent container;
e) a UE policy container;
f) a UE parameters update transparent container; or
g) Multiple payloads.
For payload type a) to e), along with the payload, the NAS transport procedure
may transport the associated information (e.g. PDU session information for
5GSM message payload).
For payload type g), the Payload container IE consists a list of payload
container entries, where each of payload container entry contains the payload
and optional associated information (e.g. PDU session information for 5GSM
message payload).
NOTE: Payload type can be set to \"Multiple payloads\" if there are more than
one payloads to be transported using the NAS transport procedures.
#### 5.4.5.2 UE-initiated NAS transport procedure
##### 5.4.5.2.1 General
The purpose of the UE-initiated NAS transport procedure is to provide a
transport of:
a) a single 5GSM message as defined in subclause 8.3;
b) SMS (see 3GPP TS 24.011 [13]);
c) an LPP message;
d) an SOR transparent container;
e) a UE policy container; or
f) a UE parameters update transparent container; or
g) multiple of the above types.
and:
\- for a) to e), optional associated payload routing information from the UE
to the AMF in a 5GMM message; and
\- for g), the Payload container IE consists a list of payload container
entries, where each of the payload container entry contains the payload and
optional associated payload routing information (e.g. PDU session information
for 5GSM message payload).
##### 5.4.5.2.2 UE-initiated NAS transport procedure initiation
In the connected mode, the UE initiates the NAS transport procedure by sending
the UL NAS TRANSPORT message, as shown in figure 5.4.5.2.2.1.
In case a) in subclause 5.4.5.2.1, the UE shall:
a) include the PDU session information (PDU session ID, old PDU session ID,
S-NSSAI, mapped S-NSSAI (if available in roaming scenarios), DNN, request
type), if available:
b) set the Payload container type IE to \"N1 SM information\"; and
c) set the Payload container IE to the 5GSM message.
The UE shall set the PDU session ID IE to the PDU session ID. If an old PDU
session ID is to be included, the UE shall set the Old PDU session ID IE to
the old PDU session ID.
If an S-NSSAI is to be included, the UE shall set the S-NSSAI IE to the
S-NSSAI selected for the PDU session from the allowed NSSAI for the serving
PLMN, associated with the mapped S-NSSAI (if available in roaming scenarios).
If a DNN is to be included, the UE shall set the DNN IE to the DNN. 5GSM
procedures specified in clause 9 describe conditions for inclusion of the
S-NSSAI, mapped S-NSSAI (if available in roaming scenarios), and the DNN.
If a request type is to be included, the UE shall set the Request type IE to
the request type. The request type is not provided along 5GSM messages other
than the PDU SESSION ESTABLISHMENT REQUEST message and the PDU SESSION
MODIFICATION REQUEST message.
The UE shall send the UL NAS TRANSPORT message to the AMF (see example in
figure 5.4.5.2.2.1).
In case b) in subclause 5.4.5.2.1, the UE shall:
\- set the Payload container type IE to \"SMS\"; and
\- set the Payload container IE to the SMS payload.
Based on the UE preferences regarding access selection for mobile originated
(MO) transmission of SMS over NAS as described in 3GPP TS 23.501 [8]:
a) when SMS over NAS is preferred to be sent over 3GPP access: the UE attempts
to deliver MO SMS over NAS via the 3GPP access if the UE is registered over
both 3GPP access and non-3GPP access. If the delivery of SMS over NAS via the
3GPP access is not available, the UE attempts to deliver MO SMS over NAS via
the non-3GPP access; and
b) when SMS over NAS is preferred to be sent over non-3GPP access: the UE
attempts to deliver MO SMS over NAS via the non-3GPP access if the UE is
registered over both 3GPP access and non-3GPP access. If the delivery of SMS
over NAS via the non-3GPP access is not available, the UE attempts to deliver
MO SMS over NAS via the 3GPP access.
In case c) in subclause 5.4.5.2.1, the UE shall:
\- set the Payload container type IE to \"LTE Positioning Protocol (LPP)
message container\";
\- set the Payload container IE to the LPP message payload; and
\- set the Additional information IE to the routing information provided by
the upper layer location services application.
In case d) in subclause 5.4.5.2.1, the UE shall:
\- set the Payload container type IE to \"SOR transparent container\"; and
\- set the Payload container IE to the UE acknowledgement due to successful
reception of steering of roaming information (see 3GPP TS 23.122 [5]).
In case e) in subclause 5.4.5.2.1, the UE shall:
\- set the Payload container type IE to \"UE policy container\"; and
\- set the contents of the Payload container IE as specified in Annex D.
In case f) in subclause 5.4.5.2.1, the UE shall:
\- set the Payload container type IE to \"UE parameters update transparent
container\"; and
\- set the contents of the Payload container IE to the UE acknowledgement due
to successful reception of UE parameters update data (see 3GPP TS 23.502 [9]).
In case g) in subclause 5.4.5.2.1, the UE shall:
\- set the Payload container type IE to \"Multiple payloads\"; and
\- set the contents of each payload container entry of the Payload container
IE (see subclause 9.11.3.39), as follows:
i) set the payload container type field to a payload container type value set
in the Payload container type IE as specified in cases a) to f) above;
ii) set the payload container contents field of the payload container entry to
the payload contents set in the Payload container IE as specified in cases a)
to f) above, and
iii) set the optional IE fields, if any, to the optional associated payload
routing information as specified in cases a) to f) above.
Figure 5.4.5.2.2.1: UE-initiated NAS transport procedure
##### 5.4.5.2.3 UE-initiated NAS transport of messages accepted by the network
Upon reception of a UL NAS TRANSPORT message, if the Payload container type IE
is set to:
a) \"N1 SM information\", the AMF looks up a PDU session routing context for:
1) the UE and the PDU session ID IE in case the Old PDU session ID IE is not
included, and:
NOTE 1: If the Old PDU session ID IE is not included in the UL NAS TRANSPORT
message and the AMF has received a reallocation requested indication from the
SMF, the AMF needs to ignore the reallocation requested indication.
i) if the AMF has a PDU session routing context for the PDU session ID and the
UE, and the Request type IE is either not included or is included but set to
other value than \"initial request\", \"existing PDU session\", \"initial
emergency request\" and \"existing emergency PDU session\", the AMF shall
forward the 5GSM message, and the PDU session ID IE towards the SMF identified
by the SMF ID of the PDU session routing context;
ii) if the AMF has a PDU session routing context for the PDU session ID and
the UE, the PDU session routing context indicates that the PDU session is not
an emergency PDU session, the Request type IE is included and is set to
\"existing PDU session\", and the S-NSSAI associated with the PDU session
identified by the PDU session ID is allowed for the target access type, the
AMF shall forward the 5GSM message, the PDU session ID, the S-NSSAI, the
mapped S-NSSAI (if available in roaming scenarios), the DNN (if received) and
the request type towards the SMF identified by the SMF ID of the PDU session
routing context;
iii) if the AMF does not have a PDU session routing context for the PDU
session ID and the UE, and the Request type IE is included and is set to
\"initial request\":
A) the AMF shall select an SMF with following handlings:
If the S-NSSAI IE is not included and the user\'s subscription context
obtained from UDM:
\- contains one default S-NSSAI, the AMF shall use the default S-NSSAI as the
S-NSSAI;
\- contains two or more default S-NSSAIs, the AMF shall use one of the default
S-NSSAIs selected by operator policy as the S-NSSAI; and
\- does not contain a default S-NSSAI, the AMF shall use an S-NSSAI selected
based on operator policy as the S-NSSAI.
If the DNN IE is not included, and the user\'s subscription context obtained
from UDM:
\- contains the default DNN for the S-NSSAI, the AMF shall use the default DNN
as the DNN; and
\- does not contain the default DNN for the S-NSSAI, the AMF shall use a
locally configured DNN as the DNN; and
If the DNN is a LADN DNN, the AMF shall determine the UE presence in LADN
service area; and
NOTE 2: SMF selection is out of scope of CT1.
B) if the SMF selection is successful:
\- the AMF shall store a PDU session routing context for the PDU session ID
and the UE, shall set the SMF ID in the stored PDU session routing context to
the SMF ID corresponding to the DNN in the user\'s subscription context
obtained from the UDM; and
\- the AMF shall forward the 5GSM message, the PDU session ID, the S-NSSAI,
the mapped S-NSSAI (if available in roaming scenarios), the DNN, the request
type and UE presence in LADN service area (if DNN received corresponds to an
LADN DNN) towards the SMF identified by the SMF ID of the PDU session routing
context;
iv) if the AMF does not have a PDU session routing context for the PDU session
ID and the UE, the Request type IE is included and is set to \"existing PDU
session\", and the user\'s subscription context obtained from the UDM contains
an SMF ID associated with:
A) the PDU session ID matching the PDU session ID received from the UE, if
any; or
B) the DNN matching the DNN received from the UE, otherwise;
such that the SMF ID includes a PLMN identity corresponding to the UE\'s HPLMN
or the current PLMN, then:
A) the AMF shall store a PDU session routing context for the PDU session ID
and the UE, shall set the SMF ID in the stored PDU session routing context to
the SMF ID contained in the user\'s subscription context obtained from the
UDM; and
B) the AMF shall forward the 5GSM message, the PDU session ID, the S-NSSAI,
the mapped S-NSSAI (if available in roaming scenarios), the DNN (if received)
and the request type towards the SMF identified by the SMF ID of the PDU
session routing context;
v) if the AMF does not have a PDU session routing context for the PDU session
ID and the UE, the Request type IE is included and is set to \"initial
emergency request\", and the AMF does not have a PDU session routing context
for another PDU session ID of the UE indicating that the PDU session is an
emergency PDU session:
A) the AMF shall select an SMF. The AMF shall use the emergency DNN from the
AMF emergency configuration data as the DNN, if configured. The AMF shall
derive the SMF from the emergency DNN or use the statically configured SMF
from the AMF emergency configuration data, if configured; and
B) if the SMF selection is successful:
\- the AMF shall store a PDU session routing context for the PDU session ID
and the UE, shall set the SMF ID in the stored PDU session routing context to
the SMF ID of the selected SMF, and shall store an indication that the PDU
session is an emergency PDU session in the stored PDU session routing context;
and
\- the AMF shall forward the 5GSM message, the PDU session ID, the S-NSSAI (if
configured in the AMF emergency configuration data), the DNN (if configured in
the AMF emergency configuration data), and the request type towards the SMF
identified by the SMF ID of the PDU session routing context; and
vi) if the AMF does not have a PDU session routing context for the PDU session
ID and the UE, the Request type IE is included and is set to \"initial
emergency request\", and the AMF has a PDU session routing context indicating
that the PDU session is an emergency PDU session for another PDU session ID of
the UE:
A) the AMF shall store a PDU session routing context for the PDU session ID
and the UE and shall set the SMF ID in the stored PDU session routing context
to the SMF ID of the PDU session routing context for the other PDU session ID
of the UE; and
B) the AMF shall forward the 5GSM message, the PDU session ID, the S-NSSAI (if
configured in the AMF emergency configuration data), the DNN (if configured in
the AMF emergency configuration data) and the request type towards the SMF
identified by the SMF ID of the PDU session routing context; or
vii) if the AMF has a PDU session routing context for the PDU session ID and
the UE, the PDU session routing context indicates that the PDU session is an
emergency PDU session, and the Request type IE is included and is set to
\"existing emergency PDU session\", the AMF shall forward the 5GSM message,
the PDU session ID, the S-NSSAI (if configured in the AMF emergency
configuration data), the DNN (if configured in the AMF emergency configuration
data), and the request type towards the SMF identified by the SMF ID of the
PDU session routing context; and
viii) if the AMF does not have a PDU session routing context for the PDU
session ID and the UE, the Request type IE is included and is set to
\"existing emergency PDU session\", and the user\'s subscription context
obtained from the UDM contains an SMF ID for the DNN matching the DNN received
from the UE such that the SMF ID includes a PLMN identity corresponding to the
current PLMN, then:
A) the AMF shall store a PDU session routing context for the PDU session ID
and the UE, shall set the SMF ID in the stored PDU session routing context to
the SMF ID contained in the user\'s subscription context obtained from the
UDM; and
B) the AMF shall forward the 5GSM message, the PDU session ID, the S-NSSAI (if
configured in the AMF emergency configuration data), the DNN (if configured in
the AMF emergency configuration data), and the request type towards the SMF
identified by the SMF ID of the PDU session routing context; or
2) the UE and the Old PDU session ID IE in case the Old PDU session ID IE is
included, and:
i) the AMF has a PDU session routing context for the old PDU session ID and
the UE and does not have a PDU session routing context for the PDU session ID
and the UE, the Request type IE is included and is set to \"initial request\",
and the AMF received a reallocation requested indication from the SMF
indicating that the SMF is to be reused, the AMF shall store a PDU session
routing context for the PDU session ID and the UE, set the SMF ID in the
stored PDU session routing context to the SMF ID of the PDU session routing
context for the old PDU session ID and the UE. If the DNN is a LADN DNN, the
AMF shall determine the UE presence in LADN service area. The AMF shall
forward the 5GSM message, the PDU session ID, the old PDU session ID, the
S-NSSAI (if received), the mapped S-NSSAI (if available in roaming scenarios),
the DNN, the request type and UE presence in LADN service area (if DNN
received corresponds to an LADN DNN) towards the SMF identified by the SMF ID
of the PDU session routing context;
ii) the AMF has a PDU session routing context for the old PDU session ID and
the UE and does not have a PDU session routing context for the PDU session ID
and the UE, the Request type IE is included and is set to \"initial request\",
and the AMF received a reallocation requested indication from the SMF
indicating that the SMF is to be reallocated:
A) the AMF shall select an SMF with the following handling;
If the S-NSSAI IE is not included and the user\'s subscription context
obtained from UDM:
\- contains one default S-NSSAI, the AMF shall use the default S-NSSAI as the
S-NSSAI;
\- contains two or more default S-NSSAIs, the AMF shall use one of the default
S-NSSAIs selected by operator policy as the S-NSSAI; and
\- does not contain a default S-NSSAI, the AMF shall use an S-NSSAI selected
based on operator policy as the S-NSSAI.
If the DNN is a LADN DNN, the AMF shall determine the UE presence in LADN
service area.
B) if the SMF selection is successful:
\- the AMF shall store a PDU session routing context for the PDU session ID
and the UE and set the SMF ID of the PDU session routing context to the SMF ID
of the selected SMF; and
\- the AMF shall forward the 5GSM message, the PDU session ID, the old PDU
session ID, the S-NSSAI, the mapped S-NSSAI (if available in roaming
scenarios), the DNN, the request type and UE presence in LADN service area (if
DNN received corresponds to an LADN DNN) towards the SMF identified by the SMF
ID of the PDU session routing context for the PDU session ID and the UE;
b) \"SMS\", the AMF shall forward the content of the Payload container IE to
the SMSF associated with the UE;
c) \"LTE Positioning Protocol (LPP) message container\", the AMF shall forward
the content of the Payload container IE to the LMF associated with the routing
information included in the Additional information IE of the UL NAS TRANSPORT
message;
d) \"SOR transparent container\", the AMF shall forward the content of the
Payload container IE to the UDM;
e) \"UE policy container\", the AMF shall forward the content of the Payload
container IE to the PCF.
f) \"UE parameters update transparent container\", the AMF shall forward the
content of the Payload container IE to the UDM.
g) \"Multiple payloads\", the AMF shall first decode the content of the
Payload container IE (see subclause 9.11.3.39) to obtain the number of payload
container entries and for each payload container entry, the AMF shall:
i) decode the payload container type field;
ii) decode the optional IE fieldsand the payload container contents field in
the payload container entry; and
iii) handle the content of each payload container entry the same as the
content of the Payload container IE and the associated optional IEs as
specified in bullets a) to f) above according to the payload container type
field.
##### 5.4.5.2.4 UE-initiated NAS transport of messages not accepted by the
network
Upon reception of an UL NAS TRANSPORT message, if the Payload container type
IE is set to \"N1 SM information\", the Request type IE is set to \"initial
request\", \"existing PDU session\" or \"modification request\", the UE is not
configured for high priority access in selected PLMN and:
a) DNN based congestion control is activated for the DNN included in the UL
NAS TRANSPORT message, or DNN based congestion control is activated for the
selected DNN in case of no DNN included in the UL NAS TRANSPORT message, e.g.
configured by operation and maintenance, the AMF shall send back to the UE the
5GSM message which was not forwarded, a back-off timer value and 5GMM cause
#22 \"congestion\" as specified in subclause 5.4.5.3.1 case f);
b) S-NSSAI and DNN based congestion control is activated for the S-NSSAI and
DNN included in the UL NAS TRANSPORT message, or S-NSSAI and DNN based
congestion control is activated for the S-NSSAI included in the UL NAS
TRANSPORT message and the selected DNN in case of no DNN included in the UL
NAS TRANSPORT message, or S-NSSAI and DNN based congestion control is
activated for the selected S-NSSAI in case of no S-NSSAI included in the UL
NAS TRANSPORT message and the DNN included in the UL NAS TRANSPORT message, or
S-NSSAI and DNN based congestion control is activated for the selected S-NSSAI
and the selected DNN in case of no S-NSSAI and no DNN included in the UL NAS
TRANSPORT message, e.g. configured by operation and maintenance, the AMF shall
send back to the UE the 5GSM message which was not forwarded, a back-off timer
value and 5GMM cause #67 \"insufficient resources for specific slice and DNN\"
as specified in subclause 5.4.5.3.1 case f); or
c) S-NSSAI only based congestion control is activated for the S-NSSAI included
in the UL NAS TRANSPORT message, or S-NSSAI based congestion control is
activated for the selected S-NSSAI in case of no S-NSSAI included in the UL
NAS TRANSPORT message, e.g. configured by operation and maintenance, the AMF
shall send back to the UE the 5GSM message which was not forwarded, a back-off
timer value and 5GMM cause #69 \"insufficient resources for specific slice\"
as specified in subclause 5.4.5.3.1 case f).
Upon reception of a UL NAS TRANSPORT message, if the Payload container type IE
is set to \"N1 SM information\", the Request type IE is set to \"initial
request\" or \"existing PDU session\", and the AMF determines that the PLMN\'s
maximum number of PDU sessions has already been reached for the UE, the AMF
shall send back to the UE the 5GSM message which was not forwarded and 5GMM
cause #65 \"maximum number of PDU sessions reached\" as specified in subclause
5.4.5.3.1 case h).
##### 5.4.5.2.5 Abnormal cases on the network side
The following abnormal cases in AMF are identified:
a) if the Payload container type IE is set to \"N1 SM information\" and:
1) if the Old PDU session ID IE is not included in the UL NAS TRANSPORT
message, the AMF does not have a PDU session routing context for the PDU
session ID and the UE, the Request type IE is set to \"initial request\", and
the SMF selection fails, then the AMF shall send back to the UE the 5GSM
message which was not forwarded as specified in subclause 5.4.5.3.1 case e);
2) if the Old PDU session ID IE is included in the UL NAS TRANSPORT message,
the AMF has a PDU session routing context for the old PDU session ID and the
UE and does not have a PDU session routing context for the PDU session ID and
the UE, the Request type IE is set to \"initial request\", the AMF received a
reallocation requested indication from the SMF indicating that the SMF is to
be reallocated, and the SMF selection fails, then the AMF shall send back to
the UE the 5GSM message which was not forwarded as specified in subclause
5.4.5.3.1 case e);
3) if the AMF does not have a PDU session routing context for the PDU session
ID and the UE, the Request type IE is set to \"existing PDU session\", and the
user\'s subscription context obtained from the UDM does not contain an SMF ID
for the PDU session ID matching the PDU session ID received from the UE or for
the DNN matching the DNN received from the UE such that the SMF ID includes a
PLMN identity corresponding to the UE\'s HPLMN or the current PLMN, then the
AMF may send back to the UE the 5GSM message which was not forwarded as
specified in subclause 5.4.5.3.1 case e).
4) if the Old PDU session ID IE is included in the UL NAS TRANSPORT message,
and the AMF has a PDU session routing context for the old PDU session ID and
the UE and does not have a PDU session routing context for the PDU session ID
and the UE, the Request type IE is set to \"initial request\" and the AMF has
not received a reallocation requested indication, the AMF should select an SMF
with following handlings:
If the S-NSSAI IE is not included and the user\'s subscription context
obtained from UDM:
i) contains one default S-NSSAI, the AMF shall use the default S-NSSAI as the
S-NSSAI;
ii) contains two or more default S-NSSAIs, the AMF shall use one of the
default S-NSSAIs selected by operator policy as the S-NSSAI; and
iii) does not contain a default S-NSSAI, the AMF shall use an S-NSSAI selected
based on operator policy as the S-NSSAI.
If the DNN IE is not included, and the user\'s subscription context obtained
from UDM:
i) contains the default DNN for the S-NSSAI, the AMF shall use the default DNN
as the DNN; and
ii) does not contain the default DNN for the S-NSSAI, the AMF shall use a
locally configured DNN as the DNN; and
If the DNN is a LADN DNN, the AMF shall determine the UE presence in LADN
service area.
If the SMF selection is successful, the AMF should store a PDU session routing
context for the PDU session ID and the UE, set the SMF ID in the stored PDU
session routing context to the selected SMF ID, and forward the 5GSM message,
the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI
(if available in roaming scenarios), the DNN, the request type and UE presence
in LADN service area (if DNN received corresponds to an LADN DNN) towards the
SMF ID of the PDU session routing context.
If the SMF selection fails then the AMF shall send back to the UE the 5GSM
message which was not forwarded as specified in subclause 5.4.5.3.1 case e).
5) if the AMF has a PDU session routing context for the PDU session ID and the
UE, the PDU session routing context indicates that the PDU session is an
emergency PDU session, the Request type IE is set to \"initial emergency
request\", the AMF should forward the 5GSM message, the PDU session ID, the
S-NSSAI (if configured in the AMF emergency configuration data), the DNN (if
configured in the AMF emergency configuration data) and the request type
towards the SMF ID of the PDU session routing context.
6) if the Request type IE is set to \"initial emergency request\" and the
S-NSSAI or the DNN is received, the AMF ignores the received S-NSSAI or the
DNN and uses the emergency DNN from the AMF emergency configuration data, if
any.
7) if the AMF does not have a PDU session routing context for the PDU session
ID and the UE, and the Request type IE of the UL NAS TRANSPORT message is
either not provided or is provided but set to other value then \"initial
request\", \"existing PDU session\", \"initial emergency request\" and
\"existing emergency PDU session\", then the AMF may send back to the UE the
5GSM message which was not forwarded as specified in subclause 5.4.5.3.1 case
e).
8) if the AMF unsuccessfully attempted to forward the 5GSM message, the PDU
session ID, the S-NSSAI, the mapped S-NSSAI (if available in roaming
scenarios), the DNN and the request type (if received) towards a SMF ID, then
the AMF may send back to the UE the 5GSM message which was not forwarded as
specified in subclause 5.4.5.3.1 case e).
9) the Old PDU session ID IE is included in the UL NAS TRANSPORT message, the
AMF does not have a PDU session routing context for the old PDU session ID and
the UE, the AMF does not have a PDU session routing context for the PDU
session ID and the UE, the Request type IE is set to \"initial request\", the
AMF should select an SMF with following handlings
If the S-NSSAI IE is not included and the user\'s subscription context
obtained from UDM:
i) contains one default S-NSSAI, the AMF shall use the default S-NSSAI as the
S-NSSAI;
ii) contains two or more default S-NSSAIs, the AMF shall use one of the
default S-NSSAIs selected by operator policy as the S-NSSAI; and
iii) does not contain a default S-NSSAI, the AMF shall use an S-NSSAI selected
based on operator policy as the S-NSSAI.
If the DNN IE is not included, and the user\'s subscription context obtained
from UDM:
i) contains the default DNN for the S-NSSAI, the AMF shall use the default DNN
as the DNN; and
ii) does not contain the default DNN for the S-NSSAI, the AMF shall use a
locally configured DNN as the DNN; and
If the DNN is a LADN DNN, the AMF shall determine the UE presence in LADN
service area.
If the SMF selection is successful, the AMF should store a PDU session routing
context for the PDU session ID and the UE, set the SMF ID in the stored PDU
session routing context to the selected SMF ID, and forward the 5GSM message,
the PDU session ID, the old PDU session ID, the S-NSSAI, the mapped S-NSSAI
(if available in roaming scenarios), the DNN, the request type and UE presence
in LADN service area (if DNN received corresponds to an LADN DNN) towards the
SMF ID of the PDU session routing context.
If the SMF selection fails then the AMF shall send back to the UE the 5GSM
message which was not forwarded as specified in subclause 5.4.5.3.1 case e).
10) if the AMF has a PDU session routing context for the PDU session ID and
the UE, the PDU session routing context indicates that the PDU session is not
an emergency PDU session, and the Request type IE is included and is set to
\"existing emergency PDU session\", the AMF may send back to the UE the 5GSM
message which was not forwarded as specified in subclause 5.4.5.3.1 case e).
11) if the AMF has a PDU session routing context for the PDU session ID and
the UE, the PDU session routing context indicates that the PDU session is an
emergency PDU session, and the Request type IE is included and is set to
\"existing PDU session\", the AMF may forward the 5GSM message, the PDU
session ID, the S-NSSAI (if configured in the AMF emergency configuration
data), the DNN (if configured in the AMF emergency configuration data), and
the request type towards the SMF identified by the SMF ID of the PDU session
routing context.
12) if the AMF has a PDU session routing context for the PDU session ID and
the UE, the Request type IE is set to \"initial request\", then the AMF shall
perform a local release of the PDU session identified by the PDU session ID
and shall request the SMF to perform a local release of the PDU session, and
proceed as specified in subclause 5.4.5.2.3.
13) if the Payload container type IE is set to \"N1 SM information\", the
Request type IE is set to \"initial request\" and the S-NSSAI IE contains an
S-NSSAI that is not allowed by the network, then the AMF shall send back to
the UE the 5GSM message which was not forwarded as specified in subclause
5.4.5.3.1 case e).
14) if the Payload container type IE is set to \"N1 SM information\", the
Request type IE is set to \"existing PDU session\", the AMF has a PDU session
routing context for the PDU session ID and the UE, the PDU session routing
context indicates that the PDU session is not an emergency PDU session, and
the S-NSSAI associated with the PDU session identified by the PDU session ID
is not allowed for the target access type, the AMF shall send back to the UE
the 5GSM message which was not forwarded as specified in subclause 5.4.5.3.1
case e).
15) if the AMF receives an UL NAS TRANSPORT message with the Payload container
type IE set to \"N1 SM information\" and the Request type IE set to \"initial
request\", \"existing PDU session\" or \"modification request\", the UE is not
configured for high priority access in selected PLMN and the UE is in non-
allowed area or is not in allowed area, the AMF shall send back to the UE the
5GSM message which was not forwarded, and 5GMM cause #28 \"Restricted service
area\" as specified in subclause 5.4.5.3.1 case i).
16) if the Request type IE is set to \"initial request\", the AMF is pending
the receipt of a REGISTRATION REQUEST message indicating \"mobility
registration updating\" in the 5GS registration type IE, and an emergency PDU
session exists for the UE (see subclause 5.4.4.3), the AMF shall send back to
the UE the 5GSM message which was not forwarded as specified in subclause
5.4.5.3.1 case e).
b) If the Payload container type IE is set to \"SMS\" and the AMF does not
have an SMSF address associated with the UE or the AMF cannot forward the
content of the Payload container IE to the SMSF associated with the SMSF
address available in the AMF, the AMF shall abort the procedure.
c) If the Payload container type IE is set to \"LTE Positioning Protocol (LPP)
message container\" and if the Additional information IE is not included in
the UL NAS TRANSPORT message or the AMF cannot forward the content of the
Payload container IE to the LMF associated with the routing information
included in the Additional information IE, the AMF shall abort the procedure.
d) If the Payload container type IE is set to \"UE policy container\" and the
AMF does not have a PCF address associated with the UE or the AMF cannot
forward the content of the Payload container IE to the PCF associated with the
PCF address available in the AMF, the AMF shall abort the procedure.
##### 5.4.5.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) The lower layers indicate that the access attempt is barred.
The UE shall not start the UE-initiated NAS transport procedure. The UE stays
in the current serving cell and applies the normal cell reselection process.
If the access category for the access attempt is 6 due to a request from upper
layers to send a mobile originated SMS over NAS and the UE is registered to
the network via both 3GPP access and non-3GPP access, the UE may transmit the
UL NAS TRANSPORT message via non-3GPP access, if the AMF set the SMS allowed
bit of the 5GS registration result IE to \"SMS over NAS allowed\" in the
REGISTRATION ACCEPT message.
Otherwise, the UE-initiated NAS transport procedure is started, if still
needed, when the lower layers indicate that the barring is alleviated for the
access category with which the access attempt was associated.
aa) The lower layers indicate that access barring is applicable for all access
categories except categories 0 and 2 and the access category with which the
access attempt was associated is other than 0 and 2.
The UE shall proceed as specified for case a. For additional UE requirements
see subclause 4.5.5.
b) If the Payload container type IE is set to \"N1 SM information\", the
Request type IE is set to \"initial request\" and registration procedure for
mobility and periodic registration update is pending due to receipt by the UE
of new network slicing information via the generic UE configuration update
procedure with re-registration request; and an emergency PDU session exists
then:
1) The UE shall not send the UL NAS TRANSPORT message; and
2) The UL NAS TRANSPORT message can be sent, if still necessary, after a
successful procedure for mobility and periodic registration update.
c) Transmission failure of the UL NAS TRANSPORT message with TAI change from
lower layers.
If the current TAI is not in the TAI list, the UE-initiated NAS transport
procedure shall be aborted and a registration procedure for mobility and
periodic registration update shall be initiated. The UL NAS TRANSPORT message
can be sent, if still necessary, after a successful procedure for mobility and
periodic registration update.
If the current TAI is still part of the TAI list, it is up to the UE
implementation how to re-run the ongoing procedure that triggered the UE-
initiated NAS transport procedure.
d) Transmission failure of the UL NAS TRANSPORT message indication without TAI
change from lower layers.
It is up to the UE implementation how to re-run the ongoing procedure that
triggered the UE-initiated NAS transport procedure.
e) The UE shall not send the UL NAS TRANSPORT message when the UE is in non-
allowed area or is not in allowed area and:
1) the Payload container type IE is set to \"N1 SM information\", the Request
type IE is set to \"initial request\", \"existing PDU session\" or
\"modification request\" and the UE is not configured for high priority access
in selected PLMN; or
2) the Payload container type IE is set to \"SMS\" and the UE is not
configured for high priority access in selected PLMN.
The UL NAS TRANSPORT message can be sent, if still necessary, when the UE
moves out of the non-allowed area or enters the allowed area.
#### 5.4.5.3 Network-initiated NAS transport procedure
##### 5.4.5.3.1 General
The purpose of the network-initiated NAS transport procedure is to provide a
transport of:
a) a single 5GSM message;
b) SMS;
c) an LPP message;
d) an SOR transparent container;
e) a single uplink 5GSM message which was not forwarded due to routing
failure;
f) a single uplink 5GSM message which was not forwarded due to congestion
control;
g) a UE policy container;
h) a single uplink 5GSM message which was not forwarded, because the PLMN\'s
maximum number of PDU sessions has been reached;
i) a single uplink 5GSM message which was not forwarded due to service area
restrictions;
j) a UE parameters update transparent container; or
k) multiple of the above types.
from the AMF to the UE in a 5GMM message.
##### 5.4.5.3.2 Network-initiated NAS transport procedure initiation
In 5GMM-CONNECTED mode, the AMF initiates the NAS transport procedure by
sending the DL NAS TRANSPORT message, as shown in figure 5.4.5.3.2.1.
In case a) in subclause 5.4.5.3.1, i.e. upon reception from an SMF of a 5GSM
message without an N1 SM delivery skip allowed indication for a UE or a 5GSM
message with an N1 SM delivery skip allowed indication for a UE in the 5GMM-
CONNECTED mode, the AMF shall:
a) include the PDU session information (PDU session ID) in the PDU session ID
IE;
b) set the Payload container type IE to \"N1 SM information\"; and
c) set the Payload container IE to the 5GSM message.
In case b) in subclause 5.4.5.3.1, i.e. upon reception from an SMSF of an SMS
payload, the AMF shall:
a) set the Payload container type IE to \"SMS\";
b) set the Payload container IE to the SMS payload; and
c) select the access type to deliver the DL NAS TRANSPORT message as follows
in case the access type selection is required:
1) if the UE to receive the DL NAS TRANSPORT message is registered to the
network via both 3GPP access and non-3GPP access, the 5GMM context of the UE
indicates that SMS over NAS is allowed, the UE is in MICO mode, and the UE is
in 5GMM-IDLE mode for 3GPP access and in 5GMM-CONNECTED mode for non-3GPP
access, then the AMF selects non-3GPP access. Otherwise, the AMF selects
either 3GPP access or non-3GPP access.
If the delivery of the DL NAS TRANSPORT message over 3GPP access has failed,
the AMF may re-send the DL NAS TRANSPORT message over the non-3GPP access.
If the delivery of the DL NAS TRANSPORT message over non-3GPP access has
failed, the AMF may re-send the DL NAS TRANSPORT message over the 3GPP access;
and
2) otherwise, the AMF selects 3GPP access.
NOTE: The AMF selects an access type between 3GPP access and non-3GPP access
based on operator policy.
In case c) in subclause 5.4.5.3.1 i.e. upon reception from an LMF of an LPP
message payload, the AMF shall:
a) set the Payload container type IE to \"LTE Positioning Protocol (LPP)
message container\";
b) set the Payload container IE to the LPP message payload received from the
LMF; and
c) set the Additional information IE to the routing information associated
with the LMF from which the LPP message was received.
In case d) in subclause 5.4.5.3.1 i.e. upon reception of a steering of roaming
information (see 3GPP TS 23.122 [5]) from the UDM to be forwarded to the UE,
the AMF shall:
a) set the Payload container type IE to \"SOR transparent container\"; and
b) set the Payload container IE to the steering of roaming information (see
3GPP TS 23.122 [5]) received from the UDM.
In case e) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM
message which was not forwarded due to routing failure, the AMF shall:
a) include the PDU session ID in the PDU session ID IE;
b) set the Payload container type IE to \"N1 SM information\";
c) set the Payload container IE to the 5GSM message which was not forwarded;
and
d) set the 5GMM cause IE to the 5GMM cause #90 \"payload was not forwarded\"
or 5GMM cause #91 \"DNN not supported or not subscribed in the slice\". The
AMF sets the 5GMM cause IE to the 5GMM cause #91 \"DNN not supported or not
subscribed in the slice\", if the 5GSM message could not be forwarded since
SMF selection fails due to:
1) the DNN is not supported in the slice identified by the S-NSSAI used by the
AMF; or
2) neither the DNN provided by the UE nor the wildcard DNN are in the
subscribed DNN list of the UE for the S-NSSAI used by the AMF.
Otherwise, the AMF sets the 5GMM cause IE to the 5GMM cause #90 \"payload was
not forwarded\".
In case f) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM
message which was not forwarded due to congestion control, the AMF shall:
a) include the PDU session ID in the PDU session ID IE;
b) set the Payload container type IE to \"N1 SM information\";
c) set the Payload container IE to the 5GSM message which was not forwarded;
d) set the 5GMM cause IE to the 5GMM cause #22 \"Congestion\", the 5GMM cause
#67 \"insufficient resources for specific slice and DNN\" or the 5GMM cause
#69 \"insufficient resources for specific slice\"; and
e) include the Back-off timer value IE.
In case g) in subclause 5.4.5.3.1, i.e. upon reception of a UE policy
container from the PCF to be forwarded to the UE, the AMF shall:
a) set the Payload container type IE to \"UE policy container\"; and
b) set the Payload container IE to the UE policy container received from the
PCF.
In case h) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM
message which was not forwarded, because the PLMN\'s maximum number of PDU
sessions has been reached, the AMF shall:
a) include the PDU session ID in the PDU session ID IE;
b) set the Payload container type IE to \"N1 SM information\";
c) set the Payload container IE to the 5GSM message which was not forwarded;
and
d) set the 5GMM cause IE to the 5GMM cause #65 \"maximum number of PDU
sessions reached\".
In case i) in subclause 5.4.5.3.1, i.e. upon sending a single uplink 5GSM
message which was not forwarded due to service area restrictions, the AMF
shall:
a) include the PDU session ID in the PDU session ID IE;
b) set the Payload container type IE to \"N1 SM information\";
c) set the Payload container IE to the 5GSM message which was not forwarded;
and
d) set the 5GMM cause IE to the 5GMM cause #28 \"Restricted service area\".
In case j) in subclause 5.4.5.3.1 i.e. upon reception of UE parameters update
data (see 3GPP TS 23.502 [9]) from the UDM to be forwarded to the UE, the AMF
shall:
a) set the Payload container type IE to \"UE parameters update transparent
container\"; and
b) set the contents of the Payload container IE to the UE parameters update
data (see 3GPP TS 23.502 [9]) received from the UDM.
In case k) in subclause 5.4.5.3.1, the AMF shall:
a) set the Payload container type IE to \"Multiple payloads\";
b) set each payload container entry of the Payload container IE (see subclause
9.11.3.39) as follows:
i) set the payload container type field of the payload container entry to a
payload container type value set in the Payload container type IE as specified
for cases a) to j) above;
ii) set the payload container contents field of the payload container entry to
the payload contents set in the Payload container type IE as specified for
cases a) to j) above;
iii) set the optional IE fields, if any, to the optional associated
information as specified for cases a) to j) above.
Figure 5.4.5.3.2.1: Network-initiated NAS transport procedure
##### 5.4.5.3.3 Network-initiated NAS transport of messages
Upon reception of a DL NAS TRANSPORT message, the UE shall stop the timer
T3346 if running.
Upon reception of a DL NAS TRANSPORT message, if the Payload container type IE
is set to:
a) \"N1 SM information\" and the 5GMM cause IE is not included in the DL NAS
TRANSPORT message, the 5GSM message in the Payload container IE and the PDU
session ID are handled in the 5GSM procedures specified in clause 6;
b) \"SMS\", the UE shall forward the content of the Payload container IE to
the SMS stack entity;
c) \"LTE Positioning Protocol (LPP) message container\", the UE shall forward
the content of the Payload container IE and the routing information included
in the Additional information IE to the upper layer location services
application;
d) \"SOR transparent container\" and if the Payload container IE:
1) successfully passes the integrity check (see 3GPP TS 33.501 [24]),
indicates a list of preferred PLMN/access technology combinations is provided
and the list type indicates:
i) \"PLMN ID and access technology list\", then the ME shall replace the
highest priority entries in the \"Operator Controlled PLMN Selector with
Access Technology\" list stored in the ME and shall proceed with the behaviour
as specified in 3GPP TS 23.122 [5] annex C; or
ii) \"secured packet\", then the ME shall behave as if a SMS is received with
protocol identifier set to SIM data download, data coding scheme set to class
2 message and SMS payload as secured packet contents of SOR transparent
container IE. The SMS payload is forwarded to UICC as specified in 3GPP TS
23.040 [4A] and the ME shall proceed with the behaviour as specified in 3GPP
TS 23.122 [5] annex C; or
2) does not successfully pass the integrity check (see 3GPP TS 33.501 [24])
then the UE shall proceed with the behaviour as specified in 3GPP TS 23.122
[5] annex C.
e) \"N1 SM information\" and the 5GMM cause IE is set to the 5GMM cause #90
\"payload was not forwarded\" in the DL NAS TRANSPORT message, the UE passes
to the 5GSM sublayer an indication that the 5GSM message was not forwarded due
to routing failure along with the 5GSM message from the Payload container IE
of the DL NAS TRANSPORT message;
f) \"N1 SM information\" and the 5GMM cause IE is set to the 5GMM cause #91
\"DNN not supported or not subscribed in the slice\" in the DL NAS TRANSPORT
message, the UE passes to the 5GSM sublayer an indication that the 5GSM
message was not forwarded due to the DNN is not supported or not subscribed in
a slice along with the 5GSM message from the Payload container IE of the DL
NAS TRANSPORT message;
g) \"N1 SM information\" and:
\- the 5GMM cause IE is set to the 5GMM cause #22 \"Congestion\", the UE
passes to the 5GSM sublayer an indication that the 5GSM message was not
forwarded due to DNN based congestion control along with the 5GSM message from
the Payload container IE of the DL NAS TRANSPORT message, and the time value
from the Back-off timer value IE;
\- the 5GMM cause IE is set to the 5GMM cause #28 \"Restricted service area\",
the UE passes to the 5GSM sublayer an indication that the 5GSM message was not
forwarded due to service area restrictions along with the 5GSM message from
the Payload container IE of the DL NAS TRANSPORT message, enters the state
5GMM-REGISTERED.NON-ALLOWED-SERVICE, and performs the registration procedure
for mobility and periodic registration update (see subclause 5.3.5 and
5.5.1.3);
\- the 5GMM cause IE is set to the 5GMM cause #65 \"maximum number of PDU
sessions reached\", the UE passes to the 5GSM sublayer an indication that the
5GSM message was not forwarded because the PLMN\'s maximum number of PDU
sessions has been reached, along with the 5GSM message from the Payload
container IE of the DL NAS TRANSPORT message;
\- the 5GMM cause IE is set to the 5GMM cause #67 \"insufficient resources for
specific slice and DNN\", the UE passes to the 5GSM sublayer an indication
that the 5GSM message was not forwarded due to S-NSSAI and DNN based
congestion control along with the 5GSM message from the Payload container IE
of the DL NAS TRANSPORT message, and the time value from the Back-off timer
value IE; or
\- the 5GMM cause IE is set to the 5GMM cause #69 \"insufficient resources for
specific slice\", the UE passes to the 5GSM sublayer an indication that the
5GSM message was not forwarded due to S-NSSAI only based congestion control
along with the 5GSM message from the Payload container IE of the DL NAS
TRANSPORT message, and the time value from the Back-off timer value IE;
h) \"UE policy container\", the UE policy container in the Payload container
IE is handled in the UE policy delivery procedures specified in Annex D;
i) \"UE parameters update transparent container\" and if the Payload container
IE
1) successfully passes the integrity check (see 3GPP TS 33.501 [24]):
i) if the UE parameters update list includes a UE parameters update data set
with UE parameters update data set type indicating \"Routing indicator update
data\",
A) the ME shall behave as if an SMS is received with protocol identifier set
to SIM data download, data coding scheme set to class 2 message and SMS
payload as secured packet contents of UE parameters update transparent
container IE. The SMS payload is forwarded to UICC as specified in 3GPP TS
23.040 [4A]; and
B) if the ACK bit of the UE parameters update header in the UE parameters
update transparent container is set to \"acknowledgment requested\" and if the
ME receives status bytes from the UICC indicating that the UICC has received
the secured packet successfully, the ME shall send an acknowledgement in the
Payload container IE of an UL NAS TRANSPORT message with Payload type IE set
to \"UE parameters update transparent container\" as specified in subclause
5.4.5.2.2; and
C) if the ME receives a REFRESH command from the UICC as specified in 3GPP TS
31.111 [22A] and if the REG bit of the UE parameters update header in the UE
parameters update transparent container IE is set to \"re-registration
requested\", and:
C1) the UE is registered over 3GPP access, then the UE shall wait until it
enters 5GMM-IDLE mode over 3GPP access, and then perform a de-registration
procedure, delete its 5G-GUTI and initiate a registration procedure for
initial registration as specified in subclause 5.5.1.2;
C2) the UE is registered over non-3GPP access and does not have emergency
services ongoing over non-3GPP access, then the UE shall locally release the
N1 NAS signalling connection and enter 5GMM-IDLE mode over non-3GPP access,
perform a de-registration procedure, delete its 5G-GUTI if the UE is
registered to different PLMN on 3GPP access or the UE is not registered over
3GPP access, and then initiate a registration procedure for initial
registration as specified in subclause 5.5.1.2; and
C3) the UE is registered over non-3GPP access and has an emergency services
ongoing over non-3GPP access, then the UE shall wait until the emergency
services are completed before locally releasing the N1 NAS signalling
connection and enter 5GMM-IDLE mode over non-3GPP access, perform a de-
registration procedure, delete its 5G-GUTI if the UE is registered to
different PLMN on 3GPP access or if the UE is not registered over 3GPP access,
and then initiate a registration procedure for initial registration as
specified in subclause 5.5.1.2.
ii) if the UE parameters update list includes a UE parameters update data set
with UE parameters update data set type indicating \"Default configured NSSAI
update data\",
A) if the ACK bit of the UE parameters update header in the UE parameters
update transparent container is set to \"acknowledgment requested\" and if the
UE parameters update list does not include a UE parameters update data set
with UE parameters update data set type indicating \"Routing indicator update
data\", the ME shall send an acknowledgement in the Payload container IE of an
UL NAS TRANSPORT message with Payload type IE set to \"UE parameters update
transparent container\" as specified in subclause 5.4.5.2.2
B) the ME shall replace the stored default configured NSSAI with the default
configured NSSAI included in the default configured NSSAI update data; and
C) if the UE parameters update list does not include a UE parameters update
data set with UE parameters update data set type indicating \"Routing
indicator update data\", the UE used the old default configured NSSAI to
create the requested NSSAI in a REGISTRATION REQUEST message, the UE does not
have a configured NSSAI for the current PLMN and the UE has an allowed NSSAI
for the current PLMN which contains one or more S-NSSAIs that are not included
in the new default configured NSSAI, the UE shall wait until it enters 5GMM-
IDLE mode and then the UE shall initiate a registration procedure for mobility
and periodic registration update as specified in subclause 5.5.1.3; and
2) does not successfully pass the integrity check (see 3GPP TS 33.501 [24])
then the UE shall discard the content of the payload container IE; and
j) \"Multiple payloads\", the UE shall first decode the content of the Payload
container IE (see subclause 9.11.3.39) to obtain the number of payload
container entries and for each payload container entry, the UE shall:
i) decode the payload container type field;
ii) decode the optional IE fields and the payload container contents field in
the payload container entry; and
iii) handle the content of each payload container entry the same as the
content of the Payload container IE and the associated optional IEs as
specified in bullets a) to i) above according to the payload container type
field.
### 5.4.6 5GMM status procedure
#### 5.4.6.1 General
The purpose of the 5GMM status procedure is to report at any time in the 5GMM
STATUS message certain error conditions detected upon receipt of 5GMM protocol
data in the AMF or in the UE. The 5GMM STATUS message can be sent by both the
AMF and the UE (see example in figure 5.4.6.1).
Figure 5.4.6.1: 5GMM status procedure
#### 5.4.6.2 5GMM status received in the UE
On receipt of a 5GMM STATUS message, no state transition and no specific
action shall be taken as seen from the radio interface, i.e. local actions are
possible. The local actions to be taken by UE on receipt of a 5GMM STATUS
message are implementation dependent.
#### 5.4.6.3 5GMM status received in the network
On receipt of a 5GMM STATUS message in the AMF, no state transition and no
specific action shall be taken as seen from the radio interface, i.e. local
actions are possible. The local actions to be taken by the AMF on receipt of a
5GMM STATUS message are implementation dependent.
## 5.5 5GMM specific procedures
### 5.5.1 Registration procedure
#### 5.5.1.1 General
The registration procedure is always initiated by the UE and used for initial
registration as specified in subclause 5.5.1.2.2 or mobility and periodic
registration update as specified in subclause 5.5.1.3.2.
When the UE needs to initiate registration over both 3GPP access and non-3GPP
access in the same PLMN (e.g. the 3GPP access and the selected N3IWF are
located in the same PLMN), the UE:
a) in 5GMM-REGISTERED-INITIATED over 3GPP access shall not initiate
registration over non-3GPP access; or
b) in 5GMM-REGISTERED-INITIATED over non-3GPP access shall not initiate
registration over 3GPP access.
NOTE: To which access (i.e. 3GPP access or non-3GPP access) the UE initiates
registration first is up to UE implementation.
When the UE is registered with a PLMN over a non-3GPP access, the AMF and the
UE maintain:
a) registration state and state machine over non-3GPP access;
b) 5G NAS security context;
c) 5G-GUTI;
d) registration area for non-3GPP access, which is associated with a fixed
well-known N3GPP TAI; and
e) non-3GPP de-registration timer in the UE and non-3GPP implicit de-
registration timer in the AMF.
A registration attempt counter is used to limit the number of subsequently
rejected registration attempts. The registration attempt counter shall be
incremented as specified in subclause 5.5.1.2.7 or subclause 5.5.1.3.7.
Depending on the value of the registration attempt counter, specific actions
shall be performed. The registration attempt counter shall be reset when:
\- the UE is powered on;
\- a USIM is inserted;
\- a registration procedure is successfully completed;
\- an EPS attach or combined EPS attach procedure is successfully completed in
S1 mode and the UE is operating in single-registration mode;
\- a registration procedure is rejected with cause #11, #12, #13, #27 and #73;
\- a network initiated deregistration procedure is completed with cause #11,
#12, #13 and #27; or
\- a new PLMN is selected.
Additionally, the registration attempt counter shall be reset when the UE is
in substate 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION or 5GMM-
REGISTERED.ATTEMPTING-REGISTRATION-UPDATE, and:
\- a new tracking area is entered;
\- timer T3502 expires; or
\- timer T3346 is started.
When the registration attempt counter is reset, the UE shall stop timer T3519
if running, and delete any stored SUCI.
The lower layers indicate to NAS whether the network supports emergency
services for the UE in limited service state (see 3GPP TS 38.331 [30]). This
information is taken into account when deciding whether to initiate an initial
registration for emergency services.
#### 5.5.1.2 Registration procedure for initial registration
##### 5.5.1.2.1 General
This procedure can be used by a UE for initial registration for 5GS services.
When the UE initiates the registration procedure for initial registration, the
UE shall indicate \"initial registration\" in the 5GS registration type IE.
When the UE initiates the registration procedure for emergency services, the
UE shall indicate \"emergency registration\" in the 5GS registration type IE.
##### 5.5.1.2.2 Initial registration initiation
The UE in state 5GMM-DEREGISTERED shall initiate the registration procedure
for initial registration by sending a REGISTRATION REQUEST message to the AMF,
a) when the UE performs initial registration for 5GS services;
b) when the UE performs initial registration for emergency services;
c) when the UE performs initial registration for SMS over NAS; and
d) when the UE moves from GERAN to NG-RAN coverage or the UE moves from a
UTRAN to NG-RAN coverage.
with the following clarifications to initial registration for emergency
services:
a) the UE shall not initiate an initial registration for emergency services
over the current access, if the UE is already registered for emergency
services over the non-current access, unless the initial registration has to
be initiated to perform handover of an existing emergency PDU session from the
non-current access to the current access; and
NOTE 1: Transfer of an existing emergency PDU session between 3GPP access and
non-3GPP access is needed e.g. if the UE determines that the current access is
no longer available.
b) the UE can only initiate an initial registration for emergency services
over non-3GPP access if it can not register for emergency services over 3GPP
access.
The UE initiates the registration procedure for initial registration by
sending a REGISTRATION REQUEST message to the AMF, starting timer T3510. If
timer T3502 is currently running, the UE shall stop timer T3502. If timer
T3511 is currently running, the UE shall stop timer T3511.
During initial registration the UE handles the 5GS mobile identity IE in the
following order:
a) Voidb) if the UE holds a valid 5G-GUTI that was previously assigned, over
3GPP access or non-3GPP access, by the same PLMN with which the UE is
performing the registration, the UE shall indicate the 5G-GUTI in the 5GS
mobile identity IE;
c) if the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP
access or non-3GPP access, by an equivalent PLMN, the UE shall indicate the
5G-GUTI in the 5GS mobile identity IE;
d) if the UE holds a valid 5G-GUTI that was previously assigned, over 3GPP
access or non-3GPP, by any other PLMN, the UE shall indicate the 5G-GUTI in
the 5GS mobile identity IE;
e) if a SUCI is available the UE shall include the SUCI in the 5GS mobile
identity IE; and
f) if the UE does not hold a valid 5G-GUTI or SUCI, and is initiating the
registration procedure for emergency services, the PEI shall be included in
the 5GS mobile identity IE.
If the SUCI is included in the 5GS mobile identity IE and the timer T3519 is
not running, the UE shall start timer T3519 and store the value of the SUCI
sent in the REGISTRATION REQUEST message. The UE shall include the stored SUCI
in the REGISTRATION REQUEST message while timer T3519 is running.
If the UE is operating in the dual-registration mode and it is in EMM state
EMM-REGISTERED, the UE shall include the UE status IE with the EMM
registration status set to \"UE is in EMM-REGISTERED state\".
NOTE 2: Inclusion of the UE status IE with this setting corresponds to the
indication that the UE is \"moving from EPC\" as specified in 3GPP TS 23.502
[9].
If the last visited registered TAI is available, the UE shall include the last
visited registered TAI in the REGISTRATION REQUEST message.
If the UE requests the use of SMS over NAS, the UE shall include the 5GS
update type IE in the REGISTRATION REQUEST message with the SMS requested bit
set to \"SMS over NAS supported\". When the 5GS update type IE is included in
the REGISTRATION REQUEST for reasons other than requesting the use of SMS over
NAS, and the UE does not need to register for SMS over NAS, the UE shall set
the SMS requested bit of the 5GS update type IE to \"SMS over NAS not
supported\" in the REGISTRATION REQUEST message.
If the UE supports MICO mode and requests the use of MICO mode, then the UE
shall include the MICO indication IE in the REGISTRATION REQUEST message.
If the UE needs to use the UE specific DRX parameters, the UE shall include
the Requested DRX parameters IE in the REGISTRATION REQUEST message.
If the UE needs to request LADN information for specific LADN DNN(s) or
indicates a request for LADN information as specified in 3GPP TS 23.501 [8],
the UE shall include the LADN indication IE in the REGISTRATION REQUEST
message and:
\- request specific LADN DNNs by including a LADN DNN value in the LADN
indication IE for each LADN DNN for which the UE requests LADN information; or
\- to indicate a request for LADN information by not including any LADN DNN
value in the LADN indication IE.
The UE shall include the requested NSSAI containing the S-NSSAI(s)
corresponding to the slice(s) to which the UE intends to register with and
shall include the mapped S-NSSAI(s) for the requested NSSAI, if available, in
the REGISTRATION REQUEST message. If the UE has allowed NSSAI or configured
NSSAI for the current PLMN, the requested NSSAI shall be either:
a) the configured NSSAI for the current PLMN, or a subset thereof as described
below, if the UE has no allowed NSSAI for the current PLMN;
b) the allowed NSSAI for the current PLMN, or a subset thereof as described
below, if the UE has an allowed NSSAI for the current PLMN; or
c) the allowed NSSAI for the current PLMN, or a subset thereof as described
below, plus one or more S-NSSAIs from the configured NSSAI for which no
corresponding S-NSSAI is present in the allowed NSSAI and those are neither in
the rejected NSSAI for the current PLMN nor in the rejected NSSAI for the
current registration area.
If the UE has neither allowed NSSAI for the current PLMN nor configured NSSAI
for the current PLMN and has a default configured NSSAI, the UE shall:
a) include the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION
REQUEST message using the default configured NSSAI; and
b) include the Network slicing indication IE with the Default configured NSSAI
indication bit set to \"Requested NSSAI created from default configured
NSSAI\" in the REGISTRATION REQUEST message.
If the UE has no allowed NSSAI for the current PLMN, no configured NSSAI for
the current PLMN, and no default configured NSSAI, the UE shall not include a
requested NSSAI in the REGISTRATION message.
The subset of configured NSSAI provided in the requested NSSAI consists of one
or more S-NSSAIs in the configured NSSAI applicable to the current PLMN, if
the S-NSSAI is neither in the rejected NSSAI for the current PLMN nor in the
rejected NSSAI for the current registration area.
The subset of allowed NSSAI provided in the requested NSSAI consists of one or
more S-NSSAIs in the allowed NSSAI for the current PLMN.
NOTE 3: How the UE selects the subset of configured NSSAI or allowed NSSAI to
be provided in the requested NSSAI is implementation specific. The UE can take
preferences indicated by the upper layers (e.g. policies, applications) into
account.
NOTE 4: The number of S-NSSAI(s) included in the requested NSSAI cannot exceed
eight.
If the UE initiates an initial registration for emergency services or needs to
prolong the established NAS signalling connection after the completion of the
initial registration procedure (e.g. due to uplink signalling pending), the UE
shall set the Follow-on request indicator to 1.
If the UE supports S1 mode, the UE shall:
\- set the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of
the REGISTRATION REQUEST message;
\- include the S1 UE network capability IE in the REGISTRATION REQUEST
message; and
\- if the UE supports sending an ATTACH REQUEST message containing a PDN
CONNECTIVITY REQUEST message with request type set to \"handover\" to transfer
a PDU session from N1 mode to S1 mode, set the HO attach bit to \"attach
request message containing PDN connectivity request with request type set to
handover to transfer PDU session from N1 mode to S1 mode supported\" in the
5GMM capability IE of the REGISTRATION REQUEST message.
If the UE supports the LTE positioning protocol (LPP) in N1 mode as specified
in 3GPP TS 36.355 [26], the UE shall set the LPP bit to \"LPP in N1 mode
supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.
If the UE has one or more stored UE policy sections identified by a UPSI with
the PLMN ID part indicating the HPLMN or the selected PLMN, the UE shall
include the UE STATE INDICATION message (see annex D) in the Payload container
IE of the REGISTRATION REQUEST message.
If the UE does not have a valid 5G NAS security context, the UE shall send the
REGISTRATION REQUEST message without including the NAS message container IE.
The UE shall set the Payload container type IE to \"UE policy container\" and
include the entire REGISTRATION REQUEST message (i.e. containing cleartext IEs
and non-cleartext IEs, if any) in the NAS message container IE that is sent as
part of the SECURITY MODE COMPLETE message as described in subclauses 4.4.6
and 5.4.2.3.
NOTE 1: In this version of the protocol, the UE can only include the Payload
container IE in the REGISTRATION REQUEST message to carry a payload of type
\"UE policy container\".
If the UE has a valid 5G NAS security context and the UE needs to send non-
cleartext IEs, the UE shall send a REGISTRATION REQUEST message including the
NAS message container IE as described in subclause 4.4.6. If the UE does not
need to send non-cleartext IEs, the UE shall send a REGISTRATION REQUEST
message without including the NAS message container IE.
If the REGISTRATION REQUEST message includes a NAS message container IE, the
AMF shall process the REGISTRATION REQUEST message that is obtained from the
NAS message container IE as described in subclause 4.4.6.
Figure 5.5.1.2.2.1: Registration procedure for initial registration
##### 5.5.1.2.3 5GMM common procedure initiation
The network may initiate 5GMM common procedures, e.g. the identification,
authentication and security procedures during the registration procedure,
depending on the information received in the REGISTRATION REQUEST message.
During a registration procedure with 5GS registration type IE set to
\"emergency registration\", if the AMF is configured to support emergency
registration for unauthenticated SUCIs, the AMF may choose to skip the
authentication procedure even if no 5G NAS security context is available and
proceed directly to the execution of the security mode control procedure.
##### 5.5.1.2.4 Initial registration accepted by the network
During a registration procedure with 5GS registration type IE set to
\"emergency registration\", the AMF shall not check for mobility and access
restrictions, regional restrictions or subscription restrictions, when
processing the REGISTRATION REQUEST message.
If the initial registration request is accepted by the network, the AMF shall
send a REGISTRATION ACCEPT message to the UE.
For each of the information elements: 5GMM capability, S1 UE network
capability, and UE security capability, the AMF shall store all octets
received from the UE in the REGISTRATION REQUEST message, up to the maximum
length defined for the respective information element.
NOTE 1: This information is forwarded to the new AMF during inter-AMF handover
or to the new MME during inter-system handover to S1 mode.
The AMF shall assign and include a TAI list as a registration area the UE is
registered to in the REGISTRATION ACCEPT message. The UE, upon receiving a
REGISTRATION ACCEPT message, shall delete its old TAI list and store the
received TAI list. If the REGISTRATION REQUEST message was received over
non-3GPP access, the AMF shall include only the N3GPP TAI in the TAI list.
NOTE 2: The N3GPP TAI is operator-specific.
The AMF may include service area restrictions in the Service area list IE in
the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION ACCEPT
message with the service area restrictions shall act as described in subclause
5.3.5.
The AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT
message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall
store the list as provided by the network, and if the initial registration
procedure is not for emergency services, the UE shall remove from the list any
PLMN code that is already in the list of \"forbidden PLMNs\". In addition, the
UE shall add to the stored list the PLMN code of the registered PLMN that sent
the list. The UE shall replace the stored list on each receipt of the
REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does not
contain a list, then the UE shall delete the stored list.
If the initial registration procedure is not for emergency services, and if
the PLMN identity of the registered PLMN is a member of the list of
\"forbidden PLMNs\", any such PLMN identity shall be deleted from the
corresponding list(s).
If the Service area list IE is not included in the REGISTRATION ACCEPT
message, any tracking area in the registered PLMN and its equivalent PLMN(s)
in the registration area is considered as an allowed tracking area as
described in subclause 5.3.5.
If the REGISTRATION REQUEST message contains the LADN indication IE, based on
the LADN indication IE, UE subscription information, UE location and local
configuration about LADN and:
\- if the LADN indication IE includes requested LADN DNNs, the UE subscribed
DNN list includes the requested LADN DNNs or the wildcard DNN, and the LADN
service area of the requested LADN DNN has an intersection with the current
registration area, the AMF shall determine the requested LADN DNNs included in
the LADN indication IE as LADN DNNs for the UE;
\- if no requested LADN DNNs included in the LADN indication IE and the
wildcard DNN is included in the UE subscribed DNN list, the AMF shall
determine the LADN DNN(s) configured in the AMF whose LADN service area has an
intersection with the current registration area as LADN DNNs for the UE; or
\- if no requested LADN DNNs included in the LADN indication IE and the
wildcard DNN is not included in the UE subscribed DNN list, the AMF shall
determine the LADN DNN(s) included in the UE subscribed DNN list whose LADN
service area has an intersection with the current registration area as LADN
DNNs for the UE.
If the LADN indication IE is not included in the REGISTRATION REQUEST message,
the AMF shall determine the LADN DNN(s) included in the UE subscribed DNN list
whose service area has an intersection with the current registration area as
LADN DNNs for the UE, except for the wildcard DNN included in the UE
subscribed DNN list.
The AMF shall include the LADN information which consists of the determined
LADN DNNs for the UE and LADN service area(s) available in the current
registration area in the LADN information IE of the REGISTRATION ACCEPT
message.
The UE, upon receiving the REGISTRATION ACCEPT message with the LADN
information, shall store the received LADN information. If there exists one or
more LADN DNNs which are included in the LADN indication IE of the
REGISTRATION REQUEST message and are not included in the LADN information IE
of the REGISTRATION ACCEPT message, the UE considers such LADN DNNs as not
available in the current registration area.
The 5G-GUTI reallocation shall be part of the initial registration procedure.
During the initial registration procedure, if the AMF has not allocated a new
5G-GUTI by the generic UE configuration update procedure, the AMF shall
include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI together
with the assigned TAI list.
If a 5G-GUTI or the SOR transparent container IE is included in the
REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state
5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3.
If the Operator-defined access category definitions IE or the Extended
emergency number list IE is included in the REGISTRATION ACCCEPT message, the
AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as
described in subclause 5.1.3.2.3.3.
The AMF shall include the MICO indication IE in the REGISTRATION ACCEPT
message only if the MICO indication IE was included in the REGISTRATION
REQUEST message, the AMF supports and accepts the use of MICO mode. If the AMF
supports and accepts the use of MICO mode, the AMF may indicate \"all PLMN
registration area allocated\" in the MICO indication IE in the REGISTRATION
ACCEPT message. If \"all PLMN registration area allocated\" is indicated in
the MICO indication IE, the AMF shall not assign and include the TAI list in
the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message included
an MICO indication IE indicating \"all PLMN registration area allocated\", the
UE shall treat all TAIs in the current PLMN as a registration area and delete
its old TAI list.
The AMF shall include the T3512 value IE in the REGISTRATION ACCEPT message
only if the REGISTRATION REQUEST message was sent over the 3GPP access.
The AMF shall include the non-3GPP de-registration timer value IE in the
REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent
for the non-3GPP access.
Upon receipt of the REGISTRATION ACCEPT message, the UE shall reset the
registration attempt counter, enter state 5GMM-REGISTERED and set the 5GS
update status to 5U1 UPDATED.
If the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use
the value in the T3512 value IE as periodic registration update timer (T3512).
If the REGISTRATION ACCEPT message included a non-3GPP de-registration timer
value IE, the UE shall use the value in non-3GPP de-registration timer value
IE as non-3GPP de-registration timer.
If the REGISTRATION ACCEPT message contained a 5G-GUTI, the UE shall return a
REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI,
stop timer T3519 if running, and delete any stored SUCI. The UE shall provide
the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT
message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in
both 3GPP access and non-3GPP access in the same PLMN.
If the REGISTRATION ACCEPT message contains the Network slicing indication IE
with the Network slicing subscription change indication set to \"Network
slicing subscription changed\", or contains a configured NSSAI IE with a new
configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for
the configured NSSAI for the current PLMN, the UE shall return a REGISTRATION
COMPLETE message to the AMF to acknowledge the successful update of the
network slicing information.
If the REGISTRATION ACCEPT message contains the Operator-defined access
category definitions IE or the Extended emergency number list IE or both, the
UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge
reception of the operator-defined access category definitions or the extended
local emergency numbers list or both.
Upon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550
and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION
ACCEPT message, shall be considered as valid.
If the 5GS update type IE was included in the REGISTRATION REQUEST message
with the SMS requested bit set to \"SMS over NAS supported\", and SMSF
selection is successful, then the AMF shall send the REGISTRATION ACCEPT
message after the SMSF has confirmed that the activation of the SMS service
was successful. When sending the REGISTRATION ACCEPT message, the AMF shall:
a) set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS
allowed\" in the REGISTRATION ACCEPT message, if the UE has set the SMS
requested bit of the 5GS registration type IE to \"SMS over NAS supported\" in
the REGISTRATION REQUEST message and the network allows the use of SMS over
NAS for the UE; and
b) store the SMSF address and the value of the SMS allowed bit of the 5GS
registration result IE in the UE 5GMM context, and consider the UE available
for SMS over NAS.
If:
a) the SMSF selection in the AMF is not successful;
b) the SMS activation via the SMSF is not successful;
c) the AMF does not allow the use of SMS over NAS;
d) the SMS requested bit of the 5GS update type IE was set to \"SMS over NAS
not supported\" in the REGISTRATION REQUEST message; or
e) the 5GS update type IE was not included in the REGISTRATION REQUEST
message;
then the AMF shall set the SMS allowed bit of the 5GS registration result IE
to \"SMS over NAS not allowed\" in the REGISTRATION ACCEPT message.
When the UE receives the REGISTRATION ACCEPT message, if the UE is also
registered over another access to the same PLMN, the UE considers the value
indicated by the SMS allowed bit of the 5GS registration result IE as
applicable for both accesses over which the UE is registered.
The AMF shall include the 5GS registration result IE in the REGISTRATION
ACCEPT message. If the 5GS registration result IE value indicates:
a) \"3GPP access\", the UE:
\- shall consider itself as being registered to 3GPP access only; and
\- if in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as
3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over
non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP
access;
b) \"Non-3GPP access\", the UE:
\- shall consider itself as being registered to non-3GPP access only; and
\- if in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN as
non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-
REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED
over 3GPP access; or
c) \"3GPP access and Non-3GPP access\", the UE shall consider itself as being
registered to both 3GPP access and non-3GPP access.
The AMF shall include the allowed NSSAI for the current PLMN and shall include
the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI
from the UE if available, in the REGISTRATION ACCEPT message if the UE
included the requested NSSAI in the REGISTRATION REQUEST message and the AMF
allows one or more S-NSSAIs in the requested NSSAI. The AMF may also include
rejected NSSAI in the REGISTRATION ACCEPT message. Rejected NSSAI contains
S-NSSAI(s) which was included in the requested NSSAI but rejected by the
network associated with rejection cause(s).
The AMF may include a new configured NSSAI for the current PLMN in the
REGISTRATION ACCEPT message if:
a) the REGISTRATION REQUEST message did not include the requested NSSAI;
b) the REGISTRATION REQUEST message included the requested NSSAI containing an
S-NSSAI that is not valid in the serving PLMN;
c) the REGISTRATION REQUEST message included the requested NSSAI containing
S-NSSAI(s) with incorrect mapped S-NSSAI(s); or
d) the REGISTRATION REQUEST message included the Network slicing indication IE
with the Default configured NSSAI indication bit set to \"Requested NSSAI
created from default configured NSSAI\".
If a new configured NSSAI for the current PLMN is included in the REGISTRATION
ACCEPT message, the AMF shall also include the mapped S-NSSAI(s) for the
configured NSSAI for the current PLMN if available in the REGISTRATION ACCEPT
message. In this case the AMF shall start timer T3550 and enter state 5GMM-
COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3.
The AMF shall include the Network slicing indication IE with the Network
slicing subscription change indication set to \"Network slicing subscription
changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the
subscription data for network slicing has changed. In this case the AMF shall
start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described
in subclause 5.1.3.2.3.3.
The UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes
the following actions based on the rejection cause in the rejected NSSAI:
\"S-NSSAI not available in the current PLMN\"
The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current
PLMN as specified in subclause 4.6.2.2 and not attempt to use this S-NSSAI in
the current PLMN until switching off the UE or the UICC containing the USIM is
removed.
\"S-NSSAI not available in the current registration area\"
The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current
registration area as specified in subclause 4.6.2.2 and not attempt to use
this S-NSSAI in the current registration area until switching off the UE, the
UE moving out of the current registration area or the UICC containing the USIM
is removed.
If the UE did not include the requested NSSAI in the REGISTRATION REQUEST
message or none of the requested NSSAI are present in the subscribed S-NSSAIs,
and one or more subscribed S-NSSAIs (containing one or more S-NSSAIs each of
which may be associated with a new S-NSSAI) marked as default are available,
the AMF shall put the subscribed S-NSSAIs marked as default in the allowed
NSSAI of the REGISTRATION ACCEPT message. The AMF shall determine a
registration area such that all S-NSSAIs of the allowed NSSAI are available in
the registration area.
If the REGISTRATION ACCEPT message contains the Network slicing indication IE
with the Network slicing subscription change indication set to \"Network
slicing subscription changed\", the UE shall delete the network slicing
information for each and every PLMN except for the current PLMN as specified
in subclause 4.6.2.2.
If the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE
shall store the included allowed NSSAI together with the PLMN identity of the
registered PLMN and the registration area as specified in subclause 4.6.2.2.
If the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new
configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for
the configured NSSAI for the current PLMN, the UE shall store the contents of
the configured NSSAI IE as specified in subclause 4.6.2.2.
If the UE included S1 mode supported indication in the REGISTRATION REQUEST
message, the AMF supporting interworking with EPS shall set the IWK N26 bit to
either:
a) \"interworking without N26 interface not supported\" if the AMF supports
N26 interface ; or
b) \"interworking without N26 interface supported\" if the AMF does not
support N26 interface
in the 5GS network feature support IE in the REGISTRATION ACCEPT message.
The UE supporting S1 mode shall operate in the mode for interworking with EPS
as follows:
a) if the IWK N26 bit in the 5GS network feature support IE is set to
\"interworking without N26 interface not supported\", the UE shall operate in
single-registration mode;
b) if the IWK N26 bit in the 5GS network feature support IE is set to
\"interworking without N26 interface supported\" and the UE supports dual-
registration mode, the UE may operate in dual-registration mode; or
NOTE 3: The registration mode used by the UE is implementation dependent.
c) if the IWK N26 bit in the 5GS network feature support IE is set to
\"interworking without N26 interface supported\" and the UE only supports
single-registration mode, the UE shall operate in single-registration mode.
The UE shall treat the received interworking without N26 interface indicator
for interworking with EPS as valid in the entire PLMN and its equivalent
PLMN(s).
The network informs the UE about the support of specific features, such as IMS
voice over PS session, emergency services or emergency services fallback, in
the 5GS network feature support information element. In a UE with IMS voice
over PS session capability, the IMS voice over PS session indicator, the
Emergency services support indicator, and the Emergency services fallback
indicator shall be provided to the upper layers. The upper layers take the IMS
voice over PS session indicator into account when selecting the access domain
for voice sessions or calls. When initiating an emergency call, the upper
layers also take the IMS voice over PS session indicator, the Emergency
services support indicator, and the Emergency services fallback indicator into
account for the access domain selection.
The AMF shall set the EMF bit in the 5GS network feature support IE to:
a) \"Emergency services fallback supported in NR connected to 5GCN and E-UTRA
connected to 5GCN\" if the network supports the emergency services fallback
procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell
connected to 5GCN;
b) \"Emergency services fallback supported in NR connected to 5GCN only\" if
the network supports the emergency services fallback procedure when the UE is
in an NR cell connected to 5GCN and does not support the emergency services
fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;
c) \"Emergency services fallback supported in E-UTRA connected to 5GCN only\"
if the network supports the emergency services fallback procedure when the UE
is in an E-UTRA cell connected to 5GCN and does not support the emergency
services fallback procedure when the UE is in an NR cell connected to 5GCN; or
d) \"Emergency services fallback not supported\" if network does not support
the emergency services fallback procedure when the UE is in any cell connected
to 5GCN.
NOTE 4: If the emergency services are supported in neither the EPS nor the 5GS
homogeneously, based on operator policy, the AMF will set the EMF bit in the
5GS network feature support IE to \"Emergency services fallback not
supported\".
NOTE 5: Even though the AMF\'s support of emergency services fallback is
indicated per RAT, the UE\'s support of emergency services fallback is not per
RAT, i.e. the UE\'s support of emergency services fallback is the same for
both NR connected to 5GCN and E-UTRA connected to 5GCN.
The network informs the UE that the use of access identity 1 is valid in the
RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network
feature support IE to \"Access identity 1 valid in RPLMN or equivalent PLMN\",
in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the
MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority
information in the user\'s subscription context obtained from the UDM.
Upon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to
\"Access identity 1 valid in RPLMN or equivalent PLMN\", the UE shall act as a
UE with access identity 1 configured for MPS as described in subclause 4.5.2,
in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS
indicator bit in the 5GS network feature support IE provided in the
REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION
ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid
in RPLMN or equivalent PLMN\" or until the UE selects a non-equivalent PLMN.
Access identity 1 is only applicable while the UE is in N1 mode.
The network informs the UE that the use of access identity 2 is valid in the
RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network
feature support IE to \"Access identity 2 valid in RPLMN or equivalent PLMN\",
in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the
MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority
information in the user\'s subscription context obtained from the UDM.
Upon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to
\"Access identity 2 valid in RPLMN or equivalent PLMN\", the UE shall act as a
UE with access identity 2 configured for MCS as described in subclause 4.5.2,
in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS
indicator bit in the 5GS network feature support IE provided in the
REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION
ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid
in RPLMN or equivalent PLMN\" or until the UE selects a non-equivalent PLMN.
Access identity 2 is only applicable while the UE is in N1 mode.
If the UE has set the Follow-on request indication to 1 in the REGISTRATION
REQUEST message, or the network has downlink signalling pending, the AMF shall
not immediately release the NAS signalling connection after the completion of
the registration procedure.
If the Requested DRX parameters IE was included in the REGISTRATION REQUEST
message, the AMF shall include the Negotiated DRX parameters IE in the
REGISTRATION ACCEPT message. The AMF may set the Negotiated DRX parameters IE
based on the received Requested DRX parameters IE and operator policy if
available.
If:
a) the UE\'s USIM is configured with indication that the UE is to receive the
SOR transparent container IE, the SOR transparent container IE is not included
in the REGISTRATION ACCEPT message or the SOR transparent container IE does
not successfully pass the integrity check (see 3GPP TS 33.501 [24]); and
b) if the UE attempts obtaining service on another PLMNs as specified in 3GPP
TS 23.122 [5] annex C;
then the UE shall locally release the established N1 NAS signalling connection
after sending a REGISTRATION COMPLETE message.
If the REGISTRATION ACCEPT message includes the SOR transparent container IE
and the SOR transparent container IE successfully passes the integrity check
(see 3GPP TS 33.501 [24]):
a) the UE shall proceed with the behaviour as specified in 3GPP TS 23.122 [5]
annex C; and
b) if the registration procedure is performed over 3GPP access and the UE
attempts obtaining service on another PLMNs as specified in 3GPP TS 23.122 [5]
annex C, then the UE may locally release the established N1 NAS signalling
connection after sending a REGISTRATION COMPLETE message. Otherwise the UE
shall send a REGISTRATION COMPLETE message and not release the current N1 NAS
signalling connection locally. If an acknowledgement is requested in the SOR
transparent container IE of the REGISTRATION ACCEPT message, the UE
acknowledgement is included in the SOR transparent container IE of the
REGISTRATION COMPLETE message.
If the SOR transparent container IE successfully passes the integrity check
(see 3GPP TS 33.501 [24]), indicates list of preferred PLMN/access technology
combinations is provided and the list type indicates:
a) \"PLMN ID and access technology list\", then the ME shall replace the
highest priority entries in the \"Operator Controlled PLMN Selector with
Access Technology\" list stored in the ME and shall proceed with the behaviour
as specified in 3GPP TS 23.122 [5] annex C; or
b) \"secured packet\", then the ME shall behave as if a SMS is received with
protocol identifier set to SIM data download, data coding scheme set to class
2 message and SMS payload as secured packet contents of SOR transparent
container IE. The SMS payload is forwarded to UICC as specified in 3GPP TS
23.040 [4A] and the ME shall proceed with the behaviour as specified in 3GPP
TS 23.122 [5] annex C.
If required by operator policy, the AMF shall include the NSSAI inclusion mode
IE in the REGISTRATION ACCEPT message (see table 4.6.2.3.1 of subclause
4.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:
a) if the message includes the NSSAI inclusion mode IE, the UE shall operate
in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the
current access within the current PLMN and its equivalent PLMN(s), if any, in
the current registration area; or
b) otherwise if:
1) the UE has NSSAI inclusion mode for the current PLMN and access type stored
in the UE, the UE shall operate in the stored NSSAI inclusion mode; or
2) the UE does not have NSSAI inclusion mode for the current PLMN and the
access type stored in the UE and if the UE is performing the registration
procedure over:
i) 3GPP access, the UE shall operate in NSSAI inclusion mode D over in the
current PLMN and the current access type; or
ii) non-3GPP access, the UE shall operate in NSSAI inclusion mode C over
non-3GPP access in the current PLMN and the current access type.
The AMF may include operator-defined access category definitions in the
REGISTRATION ACCEPT message.
If the UE receives Operator-defined access category definitions IE in the
REGISTRATION ACCEPT message and the Operator-defined access category
definitions IE contains one or more operator-defined access category
definitions, the UE shall delete any operator-defined access category
definitions stored for the RPLMN and shall store the received operator-defined
access category definitions for the RPLMN. If the UE receives the Operator-
defined access category definitions IE in the REGISTRATION ACCEPT message and
the Operator-defined access category definitions IE contains no operator-
defined access category definitions, the UE shall delete any operator-defined
access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT
message does not contain the Operator-defined access category definitions IE,
the UE shall not delete the operator-defined access category definitions
stored for the RPLMN.
##### 5.5.1.2.5 Initial registration not accepted by the network
If the initial registration request cannot be accepted by the network, the AMF
shall send a REGISTRATION REJECT message to the UE including an appropriate
5GMM cause value.
If the initial registration request is rejected due to general NAS level
mobility management congestion control, the network shall set the 5GMM cause
value to #22 \"congestion\" and assign a back-off timer T3346.
The UE shall take the following actions depending on the 5GMM cause value
received in the REGISTRATION REJECT message.
#3 (Illegal UE); or
#6 (Illegal ME).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall delete the list of equivalent PLMNs and enter the
state 5GMM-DEREGISTERED.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the EPS attach request
procedure is rejected with the EMM cause with the same value. The USIM shall
be considered as invalid also for non-EPS services until switching off or the
UICC containing the USIM is removed.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#7 (5GS services not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall enter the state 5GMM-DEREGISTERED.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the EPS attach request
procedure is rejected with the EMM cause with the same value.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#11 (PLMN not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall delete the list of
equivalent PLMNs and reset the registration attempt counter and store the PLMN
identity in the \"forbidden PLMN list\". The UE shall enter state 5GMM-
DEREGISTERED.PLMN-SEARCH and perform a PLMN selection according to 3GPP TS
23.122 [5].
If the UE is operating in single-registration mode, the UE shall in addition
handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list,
eKSI and attach attempt counter as specified in 3GPP TS 24.301 [15] for the
case when the EPS attach request procedure is rejected with the EMM cause with
the same value.
If the REGISTRATION REJECT message is integrity protected and the UE also
supports the registration procedure over the other access to the same PLMN,
the UE shall in addition handle 5GMM parameters and 5GMM state for this
access, as described for this 5GMM cause value.
#12 (Tracking area not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset
the registration attempt counter.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for regional provision of service\" and enter the state 5GMM-
DEREGISTERED.LIMITED-SERVICE.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when
the EPS attach request procedure is rejected with the EMM cause with the same
value.
#13 (Roaming not allowed in this tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall delete
the list of equivalent PLMNs and reset the registration attempt counter.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE or
optionally 5GMM-DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN
selection according to 3GPP TS 23.122 [5].
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when
the EPS attach request procedure is rejected with the EMM cause with the same
value.
#15 (No suitable cells in tracking area);
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset
the registration attempt counter.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\" and enter the state 5GMM-DEREGISTERED.LIMITED-SERVICE. The
UE shall search for a suitable cell in another tracking area according to 3GPP
TS 38.304 [28].
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when
the EPS attach request procedure is rejected with the EMM cause with the same
value.
#22 (Congestion).
If the T3346 value IE is present in the REGISTRATION REJECT message and the
value indicates that this timer is neither zero nor deactivated, the UE shall
proceed as described below; otherwise it shall be considered as an abnormal
case and the behaviour of the UE for this case is specified in subclause
5.5.1.2.7.
The UE shall abort the initial registration procedure, set the 5GS update
status to 5U2 NOT UPDATED and enter state 5GMM-DEREGISTERED.ATTEMPTING-
REGISTRATION.
The UE shall stop timer T3346 if it is running.
If the REGISTRATION REJECT message is integrity protected, the UE shall start
timer T3346 with the value provided in the T3346 value IE.
If the REGISTRATION REJECT message is not integrity protected, the UE shall
start timer T3346 with a random value from the default range specified in 3GPP
TS 24.008 [12].
The UE stays in the current serving cell and applies the normal cell
reselection process. The initial registration procedure is started if still
needed when timer T3346 expires or is stopped.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, and attach attempt counter as
specified in 3GPP TS 24.301 [15] for the case when the EPS attach request
procedure is rejected with the EMM cause with the same value.
#27 (N1 mode not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset
the registration attempt counter and shall enter the state 5GMM-NULL.
The UE shall disable the N1 mode capability for both 3GPP access and non-3GPP
access (see subclause 4.9).
#72 (Non-3GPP access to 5GCN not allowed).
When received over non-3GPP access the UE shall set the 5GS update status to
5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2)
and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI.
Additionally, the UE shall reset the registration attempt counter and enter
the state 5GMM-DEREGISTERED.
NOTE: The 5GMM sublayer states, the 5GMM parameters and the registration
status are managed per access type independently, i.e. 3GPP access or non-3GPP
access (see subclauses 4.7.2 and 5.1.3).
The UE shall disable the N1 mode capability for non-3GPP access (see subclause
4.9.3).
As an implementation option, the UE may enter the state 5GMM-
DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to
3GPP TS 23.122 [5].
If received over 3GPP access the cause shall be considered as an abnormal case
and the behaviour of the UE for this case is specified in subclause 5.5.1.2.7.
#73 (Serving network not authorized).
The UE shall set the 5GS update status to 5U2 NOT UPDATED, reset the
registration attempt counter, store the PLMN identity in the \"forbidden PLMN
list\" and enter state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a
PLMN selection according to 3GPP TS 23.122 [5].
Other values are considered as abnormal cases. The behaviour of the UE in
those cases is specified in subclause 5.5.1.2.7.
##### 5.5.1.2.6 Initial registration for emergency services not accepted by
the network
Upon receiving the REGISTRATION REJECT message including 5GMM cause #5 \"PEI
not accepted\", the UE shall enter the state 5GMM-DEREGISTERED.NO-SUPI.
Upon receiving the REGISTRATION REJECT message including 5GMM cause value
which is not #5 \"PEI not accepted\", the UE shall perform the actions as
described in subclause 5.5.1.2.5 with the following addition: the UE shall
inform the upper layers of the failure of the procedure.
NOTE 1: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
If the initial registration request for emergency services fails due to
abnormal cases, the UE shall perform the actions as described in subclause
5.5.1.2.7 and inform the upper layers of the failure to access the network or
the failure of the procedure.
NOTE 2: This can result in the upper layers requesting other implementation
specific mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can
result in the emergency call being attempted to another IP-CAN.
In a shared network, upon receiving the REGISTRATION REJECT message, the UE
shall perform the actions as described in subclause 5.5.1.2.5, and shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 3: The upper layers may request implementation specific mechanisms, e.g.
procedures specified in 3GPP TS 24.229 [14] that can result in the emergency
call being attempted to another IP-CAN.
b) attempt to perform a PLMN selection in the shared network and initiate an
initial registration for emergency services to the selected PLMN.
In a shared network, if the initial registration request for emergency
services fails due to abnormal cases, the UE shall perform the actions as
described in subclause 5.5.1.2.7 and shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 4: The upper layers may request implementation specific mechanisms, e.g.
procedures specified in 3GPP TS 24.229 [14] that can result in the emergency
call being attempted to another IP-CAN.
b) attempt the initial registration for emergency services to another PLMN in
the shared network.
##### 5.5.1.2.6A Initial registration for initiating a PDU session for
emergency services not accepted by the network
If the network cannot accept initial registration request for initiating a PDU
session for emergency services with 5GS registration type IE set to \"initial
registration\", the UE shall perform the procedures as described in subclause
5.5.1.2.5. Then if the UE is in the same selected PLMN where the last initial
registration request was attempted, the UE shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 1: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
b) attempt initial registration for emergency services.
If the initial registration request for initiating a PDU session for emergency
services with 5GS registration type IE set to \"initial registration\" fails
due to abnormal case b) in subclause 5.5.1.2.7, the UE shall perform the
actions as described in subclause 5.5.1.2.7 and inform the upper layers of the
failure to access the network.
NOTE 2: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
If the initial registration request for initiating a PDU session for emergency
services with 5GS registration type IE set to \"initial registration\" fails
due to abnormal cases c), d) or e) in subclause 5.5.1.2.7, the UE shall
perform the actions as described in subclause 5.5.1.2.7. Then if the UE is in
the same selected PLMN where the last initial registration request was
attempted, the UE shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 3: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
b) attempt initial registration for emergency services.
##### 5.5.1.2.7 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Timer T3346 is running.
The UE shall not start the registration procedure for initial registration
unless:
1) the UE is a UE configured for high priority access in selected PLMN;
2) the UE needs to perform the registration procedure for initial registration
for emergency services; or
3) the UE receives a DEREGISTRATION REQUEST message with the \"re-registration
required\" indication.
The UE stays in the current serving cell and applies the normal cell
reselection process.
NOTE 1: It is considered an abnormal case if the UE needs to initiate a
registration procedure for initial registration while timer T3346 is running
independent on whether timer T3346 was started due to an abnormal case or a
non-successful case.
b) The lower layers indicate that the access attempt is barred.
The UE shall not start the initial registration procedure. The UE stays in the
current serving cell and applies the normal cell reselection process.
The initial registration procedure is started, if still needed, when the lower
layers indicate that the barring is alleviated for the access category with
which the access attempt was associated.
ba) The lower layers indicate that access barring is applicable for all access
categories except categories 0 and 2 and the access category with which the
access attempt was associated is other than 0 and 2.
If the REGISTRATION REQUEST message has not been sent, the UE shall proceed as
specified for case b. If the REGISTRATION REQUEST message has been sent, the
UE shall proceed as specified for case e and, additionally, the registration
procedure for initial registration is started, if still needed, when the lower
layers indicate that the barring is alleviated for the access category with
which the access attempt was associated.
c) T3510 timeout.
The UE shall abort the registration procedure for initial registration and the
NAS signalling connection, if any, shall be released locally if the initial
registration request is not for emergency services. The UE shall proceed as
described below.
d) REGISTRATION REJECT message, other 5GMM cause values than those treated in
subclause 5.5.1.2.5, and cases of 5GMM cause value #22 and #72, if considered
as abnormal cases according to subclause 5.5.1.2.5.
If the registration request is not an initial registration request for
emergency services, upon reception of the 5GMM causes #95, #96, #97, #99 and
#111 the UE should set the registration attempt counter to 5.
The UE shall proceed as described below.
e) Lower layer failure or release of the NAS signalling connection received
from lower layers before the REGISTRATION ACCEPT or REGISTRATION REJECT
message is received.
The UE shall abort the registration procedure for initial registration and
proceed as described below.
f) UE initiated de-registration required.
The registration procedure for initial registration shall be aborted, and the
UE initiated de-registration procedure shall be performed.
g) De-registration procedure collision.
If the UE receives a DEREGISTRATION REQUEST message from the network in state
5GMM-REGISTERED-INITIATED and the de-registration type indicates \"re-
registration not required\", the de-registration procedure shall be progressed
and the registration procedure shall be aborted. If the UE receives a
DEREGISTRATION REQUEST message from the network in state 5GMM-REGISTERED-
INITIATED and the de-registration type indicates \"re-registration required\",
the de-registration procedure shall be progressed and the UE shall locally
release the NAS signalling connection, before re-initiating the registration
procedure.
h) Change of cell into a new tracking area.
If a cell change into a new tracking area occurs before the registration
procedure for initial registration is completed, the registration procedure
for initial registration shall be aborted and re-initiated immediately. If a
tracking area border is crossed when the REGISTRATION ACCEPT message has been
received but before a REGISTRATION COMPLETE message is sent, the registration
procedure for initial registration shall be re-initiated. If a 5G-GUTI was
allocated during the registration procedure, this 5G-GUTI shall be used in the
registration procedure.
i) Transmission failure of REGISTRATION COMPLETE message indication with TAI
change from lower layers.
If the current TAI is not in the TAI list, the registration procedure for
initial registration shall be aborted and re-initiated immediately.
If the current TAI is still part of the TAI list, it is up to the UE
implementation how to re-run the ongoing procedure.
j) Transmission failure of REGISTRATION COMPLETE message indication without
TAI change from lower layers.
It is up to the UE implementation how to re-run the ongoing procedure.
For the cases c, d and e, the UE shall proceed as follows:
Timer T3510 shall be stopped if still running.
If the registration procedure is neither an initial registration for emergency
services nor for establishing an emergency PDU session with registration type
not set to \"emergency registration\", the registration attempt counter shall
be incremented, unless it was already set to 5.
If the registration attempt counter is less than 5:
\- if the initial registration request is not for emergency services, timer
T3511 is started and the state is changed to 5GMM-DEREGISTERED.ATTEMPTING-
REGISTRATION. When timer T3511 expires the registration procedure for initial
registration shall be restarted, if still required.
If the registration attempt counter is equal to 5
\- the UE shall delete 5G-GUTI, TAI list, last visited TAI, list of equivalent
PLMNs and ngKSI, start timer T3502 and shall set the 5GS update status to 5U2
NOT UPDATED. The state is changed to 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION
or optionally to 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN
selection according to 3GPP TS 23.122 [5].
\- if the UE is operating in single registration mode:
\- the UE shall in addition handle the EPS update status, EMM parameters, EMM
state as specified in 3GPP TS 24.301 [15] for the abnormal cases when an EPS
attach procedure fails and the tracking area attempt counter is equal to 5;
and
\- the UE shall attempt to select E-UTRAN radio access technology and proceed
with appropriate EMM specific procedures. Additionally, The UE may disable N1
mode capability as specified in subclause 4.9.
##### 5.5.1.2.8 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Lower layer failure
If a lower layer failure occurs before the REGISTRATION COMPLETE message has
been received from the UE, the AMF shall locally abort the registration
procedure for initial registration, enter 5GMM-IDLE mode and shall not resend
the REGISTRATION ACCEPT message. If a new 5G-GUTI was assigned to the UE in
the registration procedure for initial registration, the AMF shall consider
both the old and the new 5G-GUTI as valid until the old 5G-GUTI can be
considered as invalid by the AMF or the 5GMM context which has been marked as
deregistered in the AMF is released. During this period the network may use
the identification procedure followed by a generic UE configuration update
procedure if the old 5G-GUTI is used by the UE in a subsequent message.
b) Protocol error
If the REGISTRATION REQUEST message is received with a protocol error, the AMF
shall return a REGISTRATION REJECT message with one of the following 5GMM
cause values:
#96 invalid mandatory information;
#99 information element non-existent or not implemented;
#100 conditional IE error; or
#111 protocol error, unspecified.
c) T3550 time-out
On the first expiry of the timer, the AMF shall retransmit the REGISTRATION
ACCEPT message and shall reset and restart timer T3550.
This retransmission is repeated four times, i.e. on the fifth expiry of timer
T3550, the registration procedure for initial registration shall be aborted
and the AMF enters state 5GMM-REGISTERED. If a new 5G-GUTI was allocated in
the REGISTRATION ACCEPT message, the AMF shall consider both the old and the
new 5G-GUTIs as valid until the old 5G-GUTI can be considered as invalid by
the AMF or the 5GMM context which has been marked as de-registered in the AMF
is released. During this period, if the old 5G-GUTI is used by the UE in a
subsequent message, the AMF acts as specified for case a) above.
d) REGISTRATION REQUEST message received after the REGISTRATION ACCEPT message
has been sent and before the REGISTRATION COMPLETE message is received.
1) If one or more of the information elements in the REGISTRATION REQUEST
message differ from the ones received within the previous REGISTRATION REQUEST
message, the previously initiated the registration procedure for initial
registration shall be aborted if the REGISTRATION COMPLETE message has not
been received and the new registration procedure for initial registration
shall be progressed; or
2) if the information elements do not differ, then the REGISTRATION ACCEPT
message shall be resent and the timer T3550 shall be restarted if a
REGISTRATION COMPLETE message is expected. In that case, the retransmission
counter related to T3550 is not incremented.
e) More than one REGISTRATION REQUEST message with 5GS registration type IE
set to \"initial registration\" received and no REGISTRATION ACCEPT or
REGISTRATION REJECT message has been sent.
1) If one or more of the information elements in the REGISTRATION REQUEST
message with 5GS registration type IE set to \"initial registration\" differs
from the ones received within the previous REGISTRATION REQUEST message with
5GS registration type IE set to \"initial registration\", the previously
initiated the registration procedure for initial registration shall be aborted
and the new the registration procedure for initial registration shall be
executed;
2) if the information elements do not differ, then the network shall continue
with the previous the registration procedure for initial registration and
shall ignore the second REGISTRATION REQUEST message.
f) REGISTRATION REQUEST message with 5GS registration type IE set to \"initial
registration\" received in state 5GMM-REGISTERED.
If a REGISTRATION REQUEST message with 5GS registration type IE set to
\"initial registration\" is received in state 5GMM-REGISTERED the network may
initiate the 5GMM common procedures; if it turned out that the REGISTRATION
REQUEST message was sent by a UE that has already been registered, the 5GMM
context, if any, are deleted and the new REGISTRATION REQUEST is progressed.
g) REGISTRATION REQUEST message with 5GS registration type IE set to
\"mobility registration updating\" or \"periodic registration updating\"
received before REGISTRATION COMPLETE message.
Timer T3550 shall be stopped. The allocated 5G-GUTI in the registration
procedure for initial registration shall be considered as valid and the
registration procedure for mobility and periodic update shall be rejected with
the 5GMM cause #10 \"implicitly de-registered\" as described in subclause
5.5.1.3.5.
h) DEREGISTRATION REQUEST message received before REGISTRATION COMPLETE
message.
The AMF shall abort the registration procedure for initial registration and
shall progress the de-registration procedure as described in subclause
5.5.2.2.
i) UE security capabilities invalid or unacceptable
If the REGISTRATION REQUEST message is received with invalid or unacceptable
UE security capabilities (e.g. no 5GS encryption algorithms (all bits zero),
no 5GS integrity algorithms (all bits zero), mandatory 5GS encryption
algorithms not supported or mandatory 5GS integrity algorithms not supported,
etc.), the AMF shall return a REGISTRATION REJECT message.
NOTE: 5GMM cause value to be used in REGISTRATION REJECT message is up to the
network implementation.
#### 5.5.1.3 Registration procedure for mobility and periodic registration
update
##### 5.5.1.3.1 General
This procedure is used by a UE for both mobility and periodic registration
update of 5GS services. This procedure, when used for periodic registration
update of 5GS services, is performed only in 3GPP access.
This procedure used for periodic registration update of 5GS services is
controlled in the UE by timer T3512. When timer T3512 expires, the
registration procedure for mobility and periodic registration area updating is
started. Start and reset of timer T3512 is described in subclause 10.2.
##### 5.5.1.3.2 Mobility and periodic registration update initiation
The UE in state 5GMM-REGISTERED shall initiate the registration procedure for
mobility and periodic registration update by sending a REGISTRATION REQUEST
message to the AMF,
a) when the UE detects entering a tracking area that is not in the list of
tracking areas that the UE previously registered in the AMF;
b) when the periodic registration updating timer T3512 expires;
c) when the UE receives a CONFIGRURATION UPDATE COMMAND message indicating
\"registration requested\" in the Configuration update indication IE as
specified in subclauses 5.4.4.3;
d) when the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE either
receives a paging or the UE receives a NOTIFICATION message with access type
indicating 3GPP access over the non-3GPP access for PDU sessions associated
with 3GPP access;
e) upon inter-system change from S1 mode to N1 mode;
f) when the UE receives an indication of \"RRC Connection failure\" from the
lower layers and does not have signalling pending (i.e. when the lower layer
requests NAS signalling connection recovery) except for the case specified in
subclause 5.3.1.4;
g) when the UE changes the 5GMM capability or the S1 UE network capability or
both;
h) when the UE\'s usage setting changes;
i) when the UE needs to change the slice(s) it is currently registered to;
j) when the UE changes the UE specific DRX parameters;
k) when the UE in state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE
receives a request from the upper layers to establish an emergency PDU session
or perform emergency services fallback;
l) when the UE needs to register for SMS over NAS, indicate a change in the
requirements to use SMS over NAS, or de-register from SMS over NAS;
m) when the UE needs to indicate PDU session status to the network after
performing a local release of PDU session(s) as specified in subclauses
6.4.1.5 and 6.4.3.5;
n) when the UE in 5GMM-IDLE mode changes the radio capability for NG-RAN;
o) when the UE receives a fallback indication from the lower layers and does
not have signalling pending (i.e. when the lower layer requests NAS signalling
connection recovery, see subclauses 5.3.1.4 and 5.3.1.2);
p) void;
q) when the UE needs to request new LADN information;
r) when the UE needs to request the use of MICO mode or needs to stop the use
of MICO mode;
s) when the UE in 5GMM-CONNECTED mode with RRC inactive indication enters a
cell in the current registration area belonging to an equivalent PLMN of the
registered PLMN and not belonging to the registered PLMN; or
t) when the UE receives a SERVICE REJECT message with the 5GMM cause value set
to #28 \"Restricted service area\".
If case b) is the only reason for initiating the registration procedure for
mobility and periodic registration update, the UE shall indicate \"periodic
registration updating\" in the 5GS registration type IE; otherwise the UE
shall indicate \"mobility registration updating\".
If the UE indicates \"mobility registration updating\" in the 5GS registration
type IE and the UE supports S1 mode, the UE shall:
\- set the S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of
the REGISTRATION REQUEST message;
\- include the S1 UE network capability IE in the REGISTRATION REQUEST
message; and
\- if the UE supports sending an ATTACH REQUEST message containing a PDN
CONNECTIVITY REQUEST message with request type set to \"handover\" to transfer
a PDU session from N1 mode to S1 mode, set the HO attach bit to \"attach
request message containing PDN connectivity request with request type set to
handover to transfer PDU session from N1 mode to S1 mode supported\" in the
5GMM capability IE of the REGISTRATION REQUEST message.
If the UE supports the LTE positioning protocol (LPP) in N1 mode as specified
in 3GPP TS 36.355 [26], the UE shall set the LPP bit to \"LPP in N1 mode
supported\" in the 5GMM capability IE of the REGISTRATION REQUEST message.
If the UE operating in the single-registration mode performs inter-system
change from S1 mode to N1 mode and has one or more stored UE policy sections
identified by a UPSI with the PLMN ID part indicating the HPLMN or the
selected PLMN, the UE shall set the Payload container type IE to \"UE policy
container\" and include the UE STATE INDICATION message (see annex D) in the
Payload container IE of the REGISTRATION REQUEST message.
NOTE 1: In this version of the protocol, the UE can only include the Payload
container IE in the REGISTRATION REQUEST message to carry a payload of type
\"UE policy container\".
The UE in state 5GMM-REGISTERED shall initiate the registration procedure for
mobility and periodic update by sending a REGISTRATION REQUEST message to the
AMF when the UE needs to request the use of SMS over NAS transport or the
current requirements to use SMS over NAS transport change in the UE. The UE
shall set the SMS requested bit of the 5GS update type IE in the REGISTRATION
REQUEST message as specified in subclause 5.5.1.2.2.
When initiating a registration procedure for mobility and periodic
registration update and the UE needs to send the 5GS update type IE for a
reason different than indicating a change in requirement to use SMS over NAS,
the UE shall set the SMS requested bit of the 5GS update type IE in the
REGISTRATION REQUEST message to the same value as indicated by the UE in the
last REGISTRATION REQUEST message.
If the UE no longer requires the use of SMS over NAS, then the UE shall
include the 5GS update type IE in the REGISTRATION REQUEST message with the
SMS requested bit set to \"SMS over NAS not supported\".
After sending the REGISTRATION REQUEST message to the AMF the UE shall start
timer T3510. If timer T3502 is currently running, the UE shall stop timer
T3502. If timer T3511 is currently running, the UE shall stop timer T3511.
If the last visited registered TAI is available, the UE shall include the last
visited registered TAI in the REGISTRATION REQUEST message.
The UE shall handle the 5GS mobile identity IE in the REGISTRATION REQUEST
message as follows:
a) if the UE is operating in the single-registration mode, performs inter-
system change from S1 mode to N1 mode, and the UE holds a valid 4G-GUTI, the
UE shall include the 5G-GUTI mapped from the 4G-GUTI as specified in 3GPP TS
23.003 [4] in the 5GS mobile identity IE. Additionally, if the UE holds a
valid 5Gâ€‘GUTI, the UE shall include the 5G-GUTI in the Additional GUTI IE in
the REGISTRATION REQUEST message in the following order:
1) a valid 5G-GUTI that was previously assigned by the same PLMN with which
the UE is performing the registration, if available;
2) a valid 5G-GUTI that was previously assigned by an equivalent PLMN, if
available; and
3) a valid 5G-GUTI that was previously assigned by any other PLMN, if
available; and
b) for all other cases, if the UE holds a valid 5G-GUTI, the UE shall indicate
the 5G-GUTI in the 5GS mobile identity IE.
If the UE supports MICO mode and requests the use of MICO mode, then the UE
shall include the MICO indication IE in the REGISTRATION REQUEST message.
If the UE needs to change the UE specific DRX parameters, the UE shall include
the Requested DRX parameters IE in the REGISTRATION REQUEST message.
If the UE needs to request LADN information for specific LADN DNN(s) or
indicates a request for LADN information as specified in 3GPP TS 23.501 [8],
the UE shall include the LADN indication IE in the REGISTRATION REQUEST
message and:
\- request specific LADN DNNs by including a LADN DNN value in the LADN
indication IE for each LADN DNN for which the UE requests LADN information; or
\- to indicate a request for LADN information by not including any LADN DNN
value in the LADN indication IE.
If the UE is initiating the registration procedure for mobility and periodic
registration update, the UE may include the Uplink data status IE to indicate
which PDU session(s) associated with the access type the REGISTRATION REQUEST
message is sent over have pending user data to be sent. If the UE has one or
more active always-on PDU sessions associated with the access type over which
the REGISTRATION REQUEST message is sent and the user-plane resources for
these PDU sessions are not established, the UE shall include the Uplink data
status IE and indicate that the UE has pending user data to be sent for those
PDU sessions. If the UE is located outside the LADN service area, the UE shall
not include the PDU session for LADN in the Uplink data status IE. If the UE
is in a non-allowed area or is not in an allowed area as specified in
subclause 5.3.5, the UE shall not include the Uplink data status IE except for
emergency services or for high priority access.
If the UE has one or more active PDU sessions which are not accepted by the
network as always-on PDU sessions and no uplink user data pending to be sent
for those PDU sessions, the UE shall not include those PDU sessions in the
Uplink data status IE in the REGISTRATION REQUEST message.
When the registration procedure for mobility and periodic registration update
is initiated in 5GMM-IDLE mode, the UE may include a PDU session status IE in
the REGISTRATION REQUEST message, indicating which PDU sessions associated
with the access type the REGISTRATION REQUEST message is sent over are active
in the UE.
If the UE received a paging message with the access type indicating non-3GPP
access, the UE shall include the Allowed PDU session status IE in the
REGISTRATION REQUEST message indicating the PDU session(s) for which the UE
allows to re-establish the user-plane resources over 3GPP access.
When the Allowed PDU session status IE is included in the REGISTRATION REQUEST
message, the UE shall indicate that a PDU session is not allowed to be
transferred to the 3GPP access if the 3GPP PS data off UE status is
\"activated\" for the corresponding PDU session and the UE is not using the
PDU session to send uplink IP packets for any of the 3GPP PS data off exempt
services (see subclause 6.2.10).
If the UE operating in the single-registration mode performs inter-system
change from S1 mode to N1 mode, the UE:
a) shall include the UE status IE with the EMM registration status set to \"UE
is in EMM-REGISTERED state\" in the REGISTRATION REQUEST message;
NOTE 2: Inclusion of the UE status IE with this setting corresponds to the
indication that the UE is \"moving from EPC\" as specified in 3GPP TS 23.502
[9], subclause 4.11.1.3.3 and 4.11.2.3.
b) may include the PDU session status IE in the REGISTRATION REQUEST message
indicating the status of the PDU session(s) mapped during the inter-system
change from S1 mode to N1 mode from the PDN connection(s) for which the EPS
indicated that interworking to 5GS is supported, if any (see subclause
6.1.4.1);
c) shall include a TRACKING AREA UPDATE REQUEST message as specified in 3GPP
TS 24.301 [15] in the EPS NAS message container IE in the REGISTRATION REQUEST
message; and
d) shall include an EPS bearer context status IE in the REGISTRATION REQUEST
message indicating which EPS bearer contexts are active in the UE, if the UE
has locally deactivated EPS bearer context(s) for which interworking to 5GS is
supported while the UE was in S1 mode without notifying the network.
If the UE operating in the single-registration mode performs inter-system
change from S1 mode to N1 mode and the UE has at least one PDN connection with
active EPS bearer context(s), the UE shall include in the Requested NSSAI IE
of the REGISTRATION REQUEST message:
a) the S-NSSAI(s) which:
1) are associated with the established PDN connection(s); and
2) are applicable in the serving PLMN; and
b) the mapped S-NSSAI(s) for these S-NSSAI(s) if available at the UE.
For a REGISTRATION REQUEST message with a 5GS registration type IE indicating
\"mobility registration updating\", UE shall include the requested NSSAI
containing the S-NSSAI(s) corresponding to the slices to which the UE intends
to register with and shall include the mapped S-NSSAI(s) for the requested
NSSAI, if available, in the REGISTRATION REQUEST message. If the UE has
allowed NSSAI or configured NSSAI for the current PLMN, the requested NSSAI
shall be either:
a) the configured NSSAI for the current PLMN, or a subset thereof as described
below, if the UE has no allowed NSSAI for the current PLMN;
b) the allowed NSSAI for the current PLMN, or a subset thereof as described
below, if the UE has an allowed NSSAI for the current PLMN; or
c) the allowed NSSAI for the current PLMN, or a subset thereof as described
below, plus one or more S-NSSAIs from the configured NSSAI for which no
corresponding S-NSSAI is present in the allowed NSSAI and those are neither in
the rejected NSSAI for the current PLMN nor in the rejected NSSAI for the
current registration area.
If the UE has neither allowed NSSAI for the current PLMN nor configured NSSAI
for the current PLMN and has a default configured NSSAI, the UE shall:
a) include the S-NSSAI(s) in the Requested NSSAI IE of the REGISTRATION
REQUEST message using the default configured NSSAI; and
b) include the Network slicing indication IE with the Default configured NSSAI
indication bit set to \"Requested NSSAI created from default configured
NSSAI\" in the REGISTRATION REQUEST message.
If the UE has no allowed NSSAI for the current PLMN, no configured NSSAI for
the current PLMN, and no default configured NSSAI, the UE shall not include a
requested NSSAI in the REGISTRATION REQUEST message.
The subset of configured NSSAI provided in the requested NSSAI consists of one
or more S-NSSAIs in the configured NSSAI applicable to this PLMN, if the
S-NSSAI is neither in the rejected NSSAIs for the current PLMN nor in the
rejected NSSAI for the current registration area.
The subset of allowed NSSAI provided in the requested NSSAI consists of one or
more S-NSSAIs in the allowed NSSAI for this PLMN.
NOTE 3: How the UE selects the subset of configured NSSAI or allowed NSSAI to
be provided in the requested NSSAI is implementation specific. The UE can take
preferences indicated by the upper layers (e.g. policies, applications) into
account.
NOTE 4: The number of S-NSSAI(s) included in the requested NSSAI cannot exceed
eight.
The UE shall set the Follow-on request indicator to 1, if the UE:
a) initiates the mobility and periodic registration updating procedure upon
request of the upper layers to establish an emergency PDU session;
b) initiates the mobility and periodic registration updating procedure upon
receiving a request from the upper layers to send NAS signalling associated
with emergency services fallback; or
c) needs to prolong the established NAS signalling connection after the
completion of the registration procedure for mobility and periodic
registration update (e.g. due to uplink signalling pending but no user data
pending).
For case n), the UE shall include the 5GS update type IE in the REGISTRATION
REQUEST message with the NG-RAN-RCU bit set to \"NG-RAN radio capability
update needed\".
For case o), the UE shall include the Uplink data status IE in the
REGISTRATION REQUEST message indicating the PDU session(s) without active
user-plane resources for which the UE has pending user data to be sent, if
any, and the PDU session(s) for which user-plane resources were active prior
to receiving the fallback indication, if any. If the UE is in a non-allowed
area or if the UE is not in allowed area, the UE shall not include the Uplink
data status IE in REGISTRATION REQUEST message, except if the PDU session for
which user-plane resources were active prior to receiving the fallback
indication is an emergency PDU session, or if the UE is configured for high
priority access in the selected PLMN as specified in subclause 5.3.5.
For case f), the UE shall include the Uplink data status IE in the
REGISTRATION REQUEST message indicating the PDU session(s) for which user-
plane resources were active prior to receiving \"RRC Connection failure\"
indication from the lower layers, if any. If the UE is in non-allowed area or
not in allowed area, the UE shall not include the Uplink data status IE in
REGISTRATION REQUEST message, except that the PDU session(s) for which user-
plane resources were active prior to receiving the fallback indication is
emergency PDU session(s), or that the UE is configured for high priority
access in selected PLMN, as specified in subclause 5.3.5.
If the UE does not have a valid 5G NAS security context and the UE is sending
the REGISTRATION REQUEST message after an inter-system change from S1 mode to
N1 mode in 5GMM-IDLE mode, the UE shall send the REGISTRATION REQUEST message
without including the NAS message container IE. The UE shall include the
entire REGISTRATION REQUEST message (i.e. containing cleartext IEs and non-
cleartext IEs, if any) in the NAS message container IE that is sent as part of
the SECURITY MODE COMPLETE message as described in subclauses 4.4.6 and
5.4.2.3.
The UE shall send the REGISTRATION REQUEST message including the NAS message
container IE as described in subclause 4.4.6:
a) when the UE is sending the message from 5GMM-IDLE mode, the UE has a valid
5G NAS security context, and needs to send non-cleartext IEs; and
b) when the UE is sending the message after an inter-system change from S1
mode to N1 mode in 5GMM-IDLE mode and the UE has a valid 5G NAS security
context and needs to send non-cleartext IEs.
The UE with a valid 5G NAS security context shall send the REGISTRATION
REQUEST message without including the NAS message container IE when the UE
does not need to send non-cleartext IEs and the UE is sending the message:
a) from 5GMM-IDLE mode; and
b) after an inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode.
If the UE is sending the REGISTRATION REQUEST message after an inter-system
change from S1 mode to N1 mode in 5GMM-CONNECTED mode and the UE needs to send
non-cleartext IEs, the UE shall cipher the NAS message container IE using the
mapped 5G NAS security context and send the REGISTRATION REQUEST message
including the NAS message container IE as described in subclause 4.4.6. If the
UE does not need to send non-cleartext IEs, the UE shall send the REGISTRATION
REQUEST message without including the NAS message container IE.
If the REGISTRATION REQUEST message includes a NAS message container IE, the
AMF shall process the REGISTRATION REQUEST message that is obtained from the
NAS message container IE as described in subclause 4.4.6.
Figure 5.5.1.3.2.1: Registration procedure for mobility and periodic
registration update
##### 5.5.1.3.3 5GMM common procedure initiation
The AMF may initiate 5GMM common procedures, e.g. the identification,
authentication and security procedures during the registration procedure,
depending on the information received in the REGISTRATION REQUEST message.
The AMF may be configured to skip the authentication procedure even if no 5GS
security context is available and proceed directly to the execution of the
security mode control procedure as specified in subclause 5.4.2, during the
registration procedure for mobility and periodic registration update for a UE
that has only an emergency PDU session.
The AMF shall not initiate a 5GMM authentication procedure before completion
of the registration procedure for mobility and periodic registration update,
if the following conditions apply:
a) the UE initiated the registration procedure for mobility and periodic
registration update after handover or inter-system change to N1 mode in 5GMM-
CONNECTED mode;
b) the target cell is a shared network cell; and
c.1) the UE has provided its 5G-GUTI in the 5GS mobile identity IE or the
Additional GUTI IE in the REGISTRATION REQUEST message, and the PLMN identity
included in the 5G-GUTI is different from the selected PLMN identity of the
target cell; or
c.2) the UE has included the 5G-GUTI mapped from the 4G-GUTI in the 5GS mobile
identity IE and not included an Additional GUTI IE in the REGISTRATION REQUEST
message, and the PLMN identity included in the 5G-GUTI is different from the
selected PLMN identity of the target cell.
##### 5.5.1.3.4 Mobility and periodic registration update accepted by the
network
If the registration update request has been accepted by the network, the AMF
shall send a REGISTRATION ACCEPT message to the UE.
If timer T3513 is running in the AMF, the AMF shall stop timer T3513 if a
paging request was sent with the access type indicating non-3GPP and the
REGISTRATION REQUEST message includes the Allowed PDU session status IE.
If timer T3565 is running in the AMF, the AMF shall stop timer T3565 when a
REGISTRATION REQUEST message is received.
For each of the information elements: 5GMM capability, S1 UE network
capability, and UE security capability, the AMF shall store all octets
received from the UE in the REGISTRATION REQUEST message, up to the maximum
length defined for the respective information element.
NOTE 1: This information is forwarded to the new AMF during inter-AMF handover
or to the new MME during inter-system handover to S1 mode.
The 5G-GUTI reallocation shall be part of the registration procedure for
mobility registration update. The 5G-GUTI reallocation should be part of the
registration procedure for periodic registration update. During the
registration procedure for mobility registration update, if the AMF has not
allocated a new 5G-GUTI by the generic UE configuration update procedure, the
AMF shall include in the REGISTRATION ACCEPT message the new assigned 5G-GUTI.
If a 5G-GUTI or the SOR transparent container IE is included in the
REGISTRATION ACCCEPT message, the AMF shall start timer T3550 and enter state
5GMM-COMMON-PROCEDURE-INITIATED as described in subclause 5.1.3.2.3.3.
If the Operator-defined access category definitions IE or the Extended
emergency number list IE is included in the REGISTRATION ACCCEPT message, the
AMF shall start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as
described in subclause 5.1.3.2.3.3.
The AMF may include a new TAI list for the UE in the REGISTRATION ACCEPT
message. The UE, upon receiving a REGISTRATION ACCEPT message, shall delete
its old TAI list and store the received TAI list. If there is no TAI list
received, the UE shall consider the old TAI list as valid.
The AMF may also include a list of equivalent PLMNs in the REGISTRATION ACCEPT
message. Each entry in the list contains a PLMN code (MCC+MNC). The UE shall
store the list as provided by the network, and if there is no emergency PDU
session established, the UE shall remove from the list any PLMN code that is
already in the list of \"forbidden PLMNs\". If the UE is not registered for
emergency services and there is an emergency PDU session established, the UE
shall remove from the list of equivalent PLMNs any PLMN code present in the
\"forbidden PLMNs list\" when the emergency PDU session is released. In
addition, the UE shall add to the stored list the PLMN code of the registered
PLMN that sent the list. The UE shall replace the stored list on each receipt
of the REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message does
not contain a list, then the UE shall delete the stored list.
If the UE is not registered for emergency services, and if the PLMN identity
of the registered PLMN is a member of the list of \"forbidden PLMNs\", any
such PLMN identity shall be deleted from the corresponding list(s).
The AMF may include new service area restrictions in the Service area list IE
in the REGISTRATION ACCEPT message. The UE, upon receiving a REGISTRATION
ACCEPT message with new service area restrictions shall act as described in
subclause 5.3.5.
If the Service area list IE is not included in the REGISTRATION ACCEPT
message, any tracking area in the registered PLMN and its equivalent PLMN(s)
in the registration area is considered as an allowed tracking area as
described in subclause 5.3.5.
The AMF shall include the MICO indication IE in the REGISTRATION ACCEPT only
if the MICO indication IE was included in the REGISTRATION REQUEST message,
the AMF supports and accepts the use of MICO mode. If the AMF supports and
accepts the use of MICO mode, the AMF may indicate \"all PLMN registration
area allocated\" in the MICO indication IE in the REGISTRATION ACCEPT message.
If \"all PLMN registration area allocated\" is indicated in the MICO
indication IE, the AMF shall not assign and include the TAI list in the
REGISTRATION ACCEPT message. If the REGISTRATION ACCEPT message includes an
MICO indication IE indicating \"all PLMN registration area allocated\", the UE
shall treat all TAIs in the current PLMN as a registration area and delete its
old TAI list.
The AMF may include the T3512 value IE in the REGISTRATION ACCEPT message only
if the REGISTRATION REQUEST message was sent over the 3GPP access.
The AMF may include the non-3GPP de-registration timer value IE in the
REGISTRATION ACCEPT message only if the REGISTRATION REQUEST message was sent
for the non-3GPP access.
Upon receipt of the REGISTRATION ACCEPT message, the UE shall reset the
registration attempt counter and service request attempt counter, enter state
5GMM-REGISTERED and set the 5GS update status to 5U1 UPDATED.
If the REGISTRATION ACCEPT message included a T3512 value IE, the UE shall use
the value in T3512 value IE as periodic registration update timer (T3512). If
the T3512 value IE is not included, the UE shall use the value currently
stored, e.g. from a prior REGISTRATION ACCEPT message.
If the REGISTRATION ACCEPT message included a non-3GPP de-registration timer
value IE, the UE shall use the value in non-3GPP de-registration timer value
IE as non-3GPP de-registration timer. If non-3GPP de-registration timer value
IE is not included, the UE shall use the value currently stored, e.g. from a
prior REGISTRATION ACCEPT message. If non-3GPP de-registration timer value IE
is not included and there is no stored non-3GPP de-registration timer value in
the UE, the UE shall use the default value of the non-3GPP de-registration
timer.
If the REGISTRATION ACCEPT message contains a 5G-GUTI, the UE shall return a
REGISTRATION COMPLETE message to the AMF to acknowledge the received 5G-GUTI,
stop timer T3519 if running, and delete any stored SUCI. The UE shall provide
the 5G-GUTI to the lower layer of 3GPP access if the REGISTRATION ACCEPT
message is sent over the non-3GPP access, and the UE is in 5GMM-REGISTERED in
both 3GPP access and non-3GPP access in the same PLMN.
If the REGISTRATION ACCEPT message contains the Network slicing indication IE
with the Network slicing subscription change indication set to \"Network
slicing subscription changed\", or contains a configured NSSAI IE with a new
configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for
the configured NSSAI for the current PLMN, the UE shall return a REGISTRATION
COMPLETE message to the AMF to acknowledge the successful update of the
network slicing information.
If the REGISTRATION ACCEPT message contains the Operator-defined access
category definitions IE or the Extended emergency number list IE or both, the
UE shall return a REGISTRATION COMPLETE message to the AMF to acknowledge
reception of the operator-defined access category definitions or the extended
local emergency numbers list or both.
Upon receiving a REGISTRATION COMPLETE message, the AMF shall stop timer T3550
and change to state 5GMM-REGISTERED. The 5G-GUTI, if sent in the REGISTRATION
ACCEPT message, shall be considered as valid.
If the 5GS update type IE was included in the REGISTRATION REQUEST message
with the SMS requested bit set to \"SMS over NAS supported\" and:
a) the SMSF address is stored in the UE 5GMM context and:
1) the UE is considered available for SMS over NAS; or
2) the UE is considered not available for SMS over NAS and the SMSF has
confirmed that the activation of the SMS service is successful; or
b) the SMSF address is not stored in the UE 5GMM context, the SMSF selection
is successful and the SMSF has confirmed that the activation of the SMS
service is successful;
then the AMF shall set the SMS allowed bit of the 5GS registration result IE
in the REGISTRATION ACCEPT message as specified in subclause 5.5.1.2.4. If the
UE 5GMM context does not contain an SMSF address or the UE is not considered
available for SMS over NAS, then the AMF shall:
a) store the SMSF address in the UE 5GMM context if not stored already; and
b) store the value of the SMS allowed bit of the 5GS registration result IE in
the UE 5GMM context and consider the UE available for SMS over NAS.
If SMSF selection in the AMF or SMS activation via the SMSF is not successful,
or the AMF does not allow the use of SMS over NAS, then the AMF shall set the
SMS allowed bit of the 5GS registration result IE to \"SMS over NAS not
allowed\" in the REGISTRATION ACCEPT message.
If the 5GS update type IE was included in the REGISTRATION REQUEST message
with the SMS requested bit set to \"SMS over NAS not supported\" or the 5GS
update type IE was not included in the REGISTRATION REQUEST message, then the
AMF shall:
a) mark the 5GMM context to indicate that the UE is not available for SMS over
NAS; and
NOTE 2: The AMF can notify the SMSF that the UE is deregistered from SMS over
NAS based on local configuration.
b) set the SMS allowed bit of the 5GS registration result IE to \"SMS over NAS
not allowed\" in the REGISTRATION ACCEPT message.
When the UE receives the REGISTRATION ACCEPT message, if the UE is also
registered over another access to the same PLMN, the UE considers the value
indicated by the SMS allowed bit of the 5GS registration result IE as
applicable for both accesses over which the UE is registered.
If the 5GS update type IE was included in the REGISTRATION REQUEST message
with the NG-RAN-RCU bit set to \"NG-RAN radio capability update needed\", the
AMF shall delete any stored UE radio capability information for NG-RAN.
The AMF shall include the 5GS registration result IE in the REGISTRATION
ACCEPT message. If the 5GS registration result IE value indicates:
a) \"3GPP access\", the UE:
\- shall consider itself as being registered to 3GPP access only; and
\- if in 5GMM-REGISTERED state over non-3GPP access and on the same PLMN as
3GPP access, shall enter state 5GMM-DEREGISTERED.ATTEMPTING-REGISTRATION over
non-3GPP access and set the 5GS update status to 5U2 NOT UPDATED over non-3GPP
access;
b) \"Non-3GPP access\", the UE:
\- shall consider itself as being registered to non-3GPP access only; and
\- if in the 5GMM-REGISTERED state over 3GPP access and is on the same PLMN as
non-3GPP access, shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-
REGISTRATION over 3GPP access and set the 5GS update status to 5U2 NOT UPDATED
over 3GPP access; or
c) \"3GPP access and Non-3GPP access\", the UE shall consider itself as being
registered to both 3GPP access and non-3GPP access.
The AMF shall include the allowed NSSAI for the current PLMN and shall include
the mapped S-NSSAI(s) for the allowed NSSAI contained in the requested NSSAI
from the UE if available, in the REGISTRATION ACCEPT message if the UE
included the requested NSSAI in the REGISTRATION REQUEST message and the AMF
allows one or more S-NSSAIs in the requested NSSAI. The S-NSSAI associated
with each of the active PDN connections for which interworking to 5GS is
supported, shall be included in the allowed NSSAI if the UE included the UE
status IE with the EMM registration status set to \"UE is in EMM-REGISTERED
state\" in the REGISTRATION REQUEST message and the AMF supports N26
interface.
The AMF may also include rejected NSSAI in the REGISTRATION ACCEPT message.
Rejected NSSAI contains S-NSSAI(s) which was included in the requested NSSAI
but rejected by the network associated with rejection cause(s).
The AMF may include a new configured NSSAI for the current PLMN in the
REGISTRATION ACCEPT message if:
a) the REGISTRATION REQUEST message did not include the requested NSSAI;
b) the REGISTRATION REQUEST message included the requested NSSAI containing an
S-NSSAI that is not valid in the serving PLMN;
c) the REGISTRATION REQUEST message included the requested NSSAI containing an
S-NSSAI with incorrect mapping information to an S-NSSAI of the HPLMN; or
d) the REGISTRATION REQUEST message included the Network slicing indication IE
with the Default configured NSSAI indication bit set to \"Requested NSSAI
created from default configured NSSAI\".
If a new configured NSSAI for the current PLMN is included, the AMF shall also
include the mapped S-NSSAI(s) for the configured NSSAI for the current PLMN if
available in the REGISTRATION ACCEPT message. In this case the AMF shall start
timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described in
subclause 5.1.3.2.3.3.
The AMF shall include the Network slicing indication IE with the Network
slicing subscription change indication set to \"Network slicing subscription
changed\" in the REGISTRATION ACCEPT message if the UDM has indicated that the
subscription data for network slicing has changed. In this case the AMF shall
start timer T3550 and enter state 5GMM-COMMON-PROCEDURE-INITIATED as described
in subclause 5.1.3.2.3.3.
If the S-NSSAI(s) associated with the existing PDU session(s) of the UE is not
included in the requested NSSAI of the REGISTRATION REQUEST message, the AMF
shall perform a local release of the PDU session(s) associated with the
S-NSSAI(s) and shall request the SMF to perform a local release of those PDU
session(s).
The UE receiving the rejected NSSAI in the REGISTRATION ACCEPT message takes
the following actions based on the rejection cause in the rejected NSSAI:
\"S-NSSAI not available in the current PLMN\"
The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current
PLMN as specified in subclause 4.6.2.2 and not attempt to use this S-NSSAI in
the current PLMN until switching off the UE or the UICC containing the USIM is
removed.
\"S-NSSAI not available in the current registration area\"
The UE shall add the rejected S-NSSAI(s) in the rejected NSSAI for the current
registration area as specified in subclause 4.6.2.2 and not attempt to use
this S-NSSAI in the current registration area until switching off the UE, the
UE moving out of the current registration area or the UICC containing the USIM
is removed.
For a REGISTRATION REQUEST message with a 5GS registration type IE indicating
\"mobility registration updating\", if the UE did not include the requested
NSSAI in the REGISTRATION REQUEST message or none of the requested NSSAI are
present in the subscribed S-NSSAIs, and one or more subscribed S-NSSAIs marked
as default are available, the AMF shall put the subscribed S-NSSAIs marked as
default in the allowed NSSAI of the REGISTRATION ACCEPT message. The AMF shall
determine a registration area such that all S-NSSAIs of the allowed NSSAI are
available in the registration area.
During a periodic registration update procedure, the AMF may provide a new
allowed NSSAI to the UE in the REGISTRATION ACCEPT message.
If the REGISTRATION ACCEPT message contains the Network slicing indication IE
with the Network slicing subscription change indication set to \"Network
slicing subscription changed\", the UE shall delete the network slicing
information for each and every PLMN except for the current PLMN as specified
in subclause 4.6.2.2.
If the REGISTRATION ACCEPT message contains the allowed NSSAI, then the UE
shall store the included allowed NSSAI together with the PLMN identity of the
registered PLMN and the registration area as specified in subclause 4.6.2.2.
If the UE has one or more PDU sessions associated with S-NSSAI(s) not included
in the received allowed NSSAI, the UE shall perform a local release of all
such PDU sessions except for the persistent PDU session(s).
If the REGISTRATION ACCEPT message contains a configured NSSAI IE with a new
configured NSSAI for the current PLMN and optionally the mapped S-NSSAI(s) for
the configured NSSAI for the current PLMN, the UE shall store the contents of
the configured NSSAI IE as specified in subclause 4.6.2.2.
During a periodic registration update procedure, if the REGISTRATION ACCEPT
message does not contain an allowed NSSAI, the UE considers the previously
received allowed NSSAI as valid.
If the Uplink data status IE is included in the REGISTRATION REQUEST message:
a) if the AMF determines that the UE is in non-allowed area or is not in
allowed area, and the PDU session(s) indicated by the Uplink data status IE is
non-emergency PDU session(s) or the UE is not configured for high priority
access in selected PLMN, the AMF shall include the PDU session reactivation
result IE in the REGISTRATION ACCEPT message indicating that user-plane
resources for the corresponding PDU session(s) cannot be re-established, and
shall include the PDU session reactivation result error cause IE with the 5GMM
cause set to #28 \"Restricted service area\";
b) otherwise, the AMF shall:
1) indicate the SMF to re-establish the user-plane resources for the
corresponding PDU session;
2) include PDU session reactivation result IE in the REGISTRATION ACCEPT
message to indicate the user-plane resources re-establishment result of the
PDU sessions for which the UE requested to re-establish the user-plane
resources; and
3) determine the UE presence in LADN service area and forward the UE presence
in LADN service area towards the SMF, if the corresponding PDU session is a
PDU session for LADN.
If the Uplink data status IE is not included in the REGISTRATION REQUEST
message and the REGISTRATION REQUEST message is sent for the trigger d) in
subclause 5.5.1.3.2, the AMF may indicate the SMF to re-establish the user-
plane resources for the PDU sessions.
If a PDU session status IE is included in the REGISTRATION REQUEST message,
the AMF shall:
a) perform a local release of all those PDU session which are in 5GSM state
PDU SESSION ACTIVE on the AMF side associated with the access type the
REGISTRATION REQUEST message is sent over, but are indicated by the UE as
being in 5GSM state PDU SESSION INACTIVE; and
b) include a PDU session status IE in the REGISTRATION ACCEPT message to
indicate which PDU sessions associated with the access type the REGISTRATION
REQUEST message is sent over are active in the AMF.
If the Allowed PDU session status IE is included in the REGISTRATION REQUEST
message, the AMF shall:
a) for a 5GSM message from each SMF that has indicated pending downlink
signalling only, forward the received 5GSM message via 3GPP access to the UE
after the REGISTRATION ACCEPT message is sent;
b) for each SMF that has indicated pending downlink data only:
1) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access cannot be
performed if the corresponding PDU session ID(s) are not indicated in the
Allowed PDU session status IE; and
2) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access can be performed
if the corresponding PDU session ID(s) are indicated in the Allowed PDU
session status IE.
c) for each SMF that have indicated pending downlink signalling and data:
1) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access cannot be
performed if the corresponding PDU session ID(s) are not indicated in the
Allowed PDU session status IE;
2) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access can be performed
if the corresponding PDU session ID(s) are indicated in the Allowed PDU
session status IE; and
3) discard the received 5GSM message for PDU session(s) associated with
non-3GPP access; and
d) include the PDU session reactivation result IE in the REGISTRATION ACCEPT
message to indicate the successfully re-established user-plane resources for
the corresponding PDU sessions, if any.
If the PDU session reactivation result IE is included in the REGISTRATION
ACCEPT message indicating that the user-plane resources have been successfully
reactivated for a PDU session that was requested by the UE in the Allowed PDU
session status IE, the UE considers the corresponding PDU session to be
associated with the 3GPP access. If the user-plane resources of a PDU session
have been successfully reactivated over the 3GPP access, the AMF and SMF
update the associated access type of the corresponding PDU session.
If the AMF has included the PDU session reactivation result IE in the
REGISTRATION ACCEPT message and there exist one or more PDU sessions for which
the user-plane resources cannot be re-established, then the AMF may include
the PDU session reactivation result error cause IE to indicate the cause of
failure to re-establish the user-plane resources.
If an EPS bearer context status IE is included in the REGISTRATION REQUEST
message, the AMF handles the received EPS bearer context status IE as
specified in 3GPP TS 23.502 [9].
If the user-plane resources cannot be established for a PDU session, the AMF
shall include the PDU session reactivation result IE in the REGISTRATION
ACCEPT message indicating that user-plane resources for the corresponding PDU
session cannot be re-established, and shall include the PDU session
reactivation result error cause IE with the 5GMM cause set to:
a) #43 \"LADN not available\" if the user-plane resources cannot be
established because the SMF indicated to the AMF that the UE is located out of
the LADN service area (see 3GPP TS 29.502 [20A]);
b) #28 \"restricted service area\" if the user-plane resources cannot be
established because the SMF indicated to the AMF that only prioritized
services are allowed (see 3GPP TS 29.502 [20A]); or
c) #92 \"insufficient user-plane resources for the PDU session\" if the user-
plane resources cannot be established because the SMF indicated to the AMF
that the resource is not available in the UPF (see 3GPP TS 29.502 [20A]).
NOTE 3: It is up to UE implementation when to re-send a request for user-plane
re-establishment for the associated PDU session after receiving a PDU session
reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient
user-plane resources for the PDU session\".
If the AMF needs to initiate PDU session status synchronization the AMF shall
include a PDU session status IE in the REGISTRATION ACCEPT message to indicate
the UE which PDU sessions are active in the AMF.
If the EPS bearer context status information is generated for the UE during
the inter-system change from S1 mode to N1 mode as specified in 3GPP TS 23.502
[9] and the AMF supports N26 interface, the AMF shall include an EPS bearer
context status IE in the REGISTRATION ACCEPT message to indicate the UE which
mapped EPS bearer contexts are active in the network.
The AMF may include the LADN information IE in the REGISTRATION ACCEPT message
as described in subclause 5.5.1.2.4. The UE, upon receiving the REGISTRATION
ACCEPT message with the LADN information IE, shall delete its old LADN
information (if any) and store the received new LADN information.
If the AMF does not include the LADN information IE in the REGISTATION ACCEPT
message during registration procedure for mobility and registration update,
the UE shall delete its old LADN information.
If the PDU session status IE is included in the REGISTRATION ACCEPT message,
the UE shall perform a local release of all those PDU sessions associated with
the access type the REGISTRATION ACCEPT message is sent over which are in 5GSM
state PDU SESSION ACTIVE on the UE side, but are indicated by the AMF as being
in 5GSM state PDU SESSION INACTIVE.
If:
a) the UE included a PDU session status IE in the REGISTRATION REQUEST
message;
b) the UE is operating in the single-registration mode;
c) the UE is performing inter-system change from S1 mode to N1 mode in 5GMM-
IDLE mode; and
d) the UE has received the IWK N26 bit set to \"interworking without N26
interface supported\";
the UE shall ignore the PDU session status IE if received in the REGISTRATION
ACCEPT message.
If the EPS bearer context status IE is included in the REGISTRATION ACCEPT
message, the UE shall locally delete all those QoS flow descriptions and all
associated QoS rules, if any, which are associated with inactive EPS bearer
contexts as indicated by the AMF in the EPS bearer context status IE.
If the UE included S1 mode supported indication in the REGISTRATION REQUEST
message, the AMF supporting inter-system change with EPS shall set the IWK N26
bit to either:
a) \"interworking without N26 not supported\" if the AMF supports N26
interface; or
b) \"interworking without N26 supported\" if the AMF does not support N26
interface
in the 5GS network feature support IE in the REGISTRATION ACCEPT message.
The UE supporting S1 mode shall operate in the mode for inter-system
interworking with EPS as follows:
a) if the IWK N26 bit in the 5GS network feature support IE is set to
\"interworking without N26 interface not supported\", the UE shall operate in
single-registration mode;
b) if the IWK N26 bit in the 5GS network feature support IE is set to
\"interworking without N26 interface supported\" and the UE supports dual-
registration mode, the UE may operate in dual-registration mode; or
NOTE 4: The registration mode used by the UE is implementation dependent.
c) if the IWK N26 bit in the 5GS network feature support IE is set to
\"interworking without N26 interface supported\" and the UE only supports
single-registration mode, the UE shall operate in single-registration mode.
The UE shall treat the received interworking without N26 interface indicator
for inter-system change with EPS as valid in the entire PLMN and its
equivalent PLMN(s).
The network informs the UE about the support of specific features, such as IMS
voice over PS session, emergency services or emergency services fallback, in
the 5GS network feature support information element. In a UE with IMS voice
over PS session capability, the IMS voice over PS session indicator, Emergency
services support indicator and Emergency services fallback indicator shall be
provided to the upper layers. The upper layers take the IMS voice over PS
session indicator into account when selecting the access domain for voice
sessions or calls. When initiating an emergency call, the upper layers take
the IMS voice over PS session indicator, Emergency services support indicator
and Emergency services fallback indicator into account for the access domain
selection. When the UE determines via the IMS voice over PS session indicator
that the network does not support IMS voice over PS sessions in N1 mode, then
the UE shall not perform a local release of any persistent PDU session if the
AMF does not indicate that the PDU session is in 5GSM state PDU SESSION
INACTIVE via the PDU session status IE. When the UE determines via the
Emergency services support indicator that the network does not support
emergency services in N1 mode, then the UE shall not perform a local release
of any emergency PDU session if user-plane resources associated with that
emergency PDU session are established if the AMF does not indicate that the
PDU session is in 5GSM state PDU SESSION INACTIVE via the PDU session status
IE.
The AMF shall set the EMF bit in the 5GS network feature support IE to:
a) \"Emergency services fallback supported in NR connected to 5GCN and E-UTRA
connected to 5GCN\" if the network supports the emergency services fallback
procedure when the UE is in an NR cell connected to 5GCN or an E-UTRA cell
connected to 5GCN;
b) \"Emergency services fallback supported in NR connected to 5GCN only\" if
the network supports the emergency services fallback procedure when the UE is
in an NR cell connected to 5GCN and does not support the emergency services
fallback procedure when the UE is in an E-UTRA cell connected to 5GCN;
c) \"Emergency services fallback supported in E-UTRA connected to 5GCN only\"
if the network supports the emergency services fallback procedure when the UE
is in an E-UTRA cell connected to 5GCN and does not support the emergency
services fallback procedure when the UE is in an NR cell connected to 5GCN; or
d) \"Emergency services fallback not supported\" if network does not support
the emergency services fallback procedure when the UE is in any cell connected
to 5GCN.
NOTE 5: If the emergency services are supported in neither the EPS nor the 5GS
homogeneously, based on operator policy, the AMF will set the EMF bit in the
5GS network feature support IE to \"Emergency services fallback not
supported\".
NOTE 6: Even though the AMF\'s support of emergency services fallback is
indicated per RAT, the UE\'s support of emergency services fallback is not per
RAT, i.e. the UE\'s support of emergency services fallback is the same for
both NR connected to 5GCN and E-UTRA connected to 5GCN.
The network informs the UE that the use of access identity 1 is valid in the
RPLMN or equivalent PLMN by setting the MPS indicator bit of the 5GS network
feature support IE to \"Access identity 1 valid in RPLMN or equivalent PLMN\",
in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the
MPS indicator bit in the REGISTRATION ACCEPT message based on the MPS priority
information in the user\'s subscription context obtained from the UDM.
Upon receiving a REGISTRATION ACCEPT message with the MPS indicator bit set to
\"Access identity 1 valid in RPLMN or equivalent PLMN\", the UE shall act as a
UE with access identity 1 configured for MPS as described in subclause 4.5.2,
in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MPS
indicator bit in the 5GS network feature support IE provided in the
REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION
ACCEPT message with the MPS indicator bit set to \"Access identity 1 not valid
in RPLMN or equivalent PLMN\" or until the UE selects a non-equivalent PLMN.
Access identity 1 is only applicable while the UE is in N1 mode.
During ongoing active PDU sessions that were set up relying on the MPS
indicator bit being set to \"Access identity 1 valid in RPLMN or equivalent
PLMN\", if the network indicates in a registration update that the MPS
indicator bit is reset to \"Access identity 1 not valid in RPLMN or equivalent
PLMN\", then the UE shall no longer act as a UE with access identity 1
configured for MPS as described in subclause 4.5.2 unless the USIM contains a
valid configuration for access identity 1 in RPLMN or equivalent PLMN. In the
UE, the ongoing active PDU sessions are not affected by the change of the MPS
indicator bit.
The network informs the UE that the use of access identity 2 is valid in the
RPLMN or equivalent PLMN by setting the MCS indicator bit of the 5GS network
feature support IE to \"Access identity 2 valid in RPLMN or equivalent PLMN\",
in the REGISTRATION ACCEPT message. Based on operator policy, the AMF sets the
MCS indicator bit in the REGISTRATION ACCEPT message based on the MCS priority
information in the user\'s subscription context obtained from the UDM.
Upon receiving a REGISTRATION ACCEPT message with the MCS indicator bit set to
\"Access identity 2 valid in RPLMN or equivalent PLMN\", the UE shall act as a
UE with access identity 2 configured for MCS as described in subclause 4.5.2,
in all NG-RAN of the registered PLMN and its equivalent PLMNs. The MCS
indicator bit in the 5GS network feature support IE provided in the
REGISTRATION ACCEPT message is valid until the UE receives a REGISTRATION
ACCEPT message with the MCS indicator bit set to \"Access identity 2 not valid
in RPLMN or equivalent PLMN\" or until the UE selects a non-equivalent PLMN.
Access identity 2 is only applicable while the UE is in N1 mode.
During ongoing active PDU sessions that were set up relying on the MCS
indicator bit being set to \"Access identity 2 valid in RPLMN or equivalent
PLMN\", if the network indicates in a registration update that the MCS
indicator bit is reset to \"Access identity 2 not valid in RPLMN or equivalent
PLMN\", then the UE shall no longer act as a UE with access identity 2
configured for MCS as described in subclause 4.5.2 unless the USIM contains a
valid configuration for access identity 2 in RPLMN or equivalent PLMN. In the
UE, the ongoing active PDU sessions are not affected by the change of the MCS
indicator bit.
If the UE has set the Follow-on request indication to 1 in the REGISTRATION
REQUEST message, or the network has downlink signalling pending, the AMF shall
not immediately release the NAS signalling connection after the completion of
the registration procedure.
If the Requested DRX parameters IE was included in the REGISTRATION REQUEST
message, the AMF shall include the Negotiated DRX parameters IE in the
REGISTRATION ACCEPT message. The AMF may set the Negotiated DRX parameters IE
based on the received Requested DRX parameters IE and operator policy if
available.
If the UE included in the REGISTRATION REQUEST message the UE status
information IE with the EMM registration status set to \"UE is in EMM-
REGISTERED state\" and the AMF does not support N26 interface, the AMF shall
operate as described in subclause 5.5.1.2.4.
If due to regional subscription restrictions or access restrictions the UE is
not allowed to access the TA, but the UE has an emergency PDU session
established, the AMF may accept the REGISTRATION REQUEST message and indicate
to the SMF to release all non-emergency PDU sessions when the registration
procedure is initiated in 5GMM-CONNECTED mode. When the registration procedure
is initiated in 5GMM-IDLE mode, the AMF indicates to the SMF to release all
non-emergency PDU sessions and informs the UE via the PDU session status IE in
the REGISTRATION ACCEPT message. The AMF shall not indicate to the SMF to
release the emergency PDU session. The network shall behave as if the UE is
registered for emergency services.
If the REGISTRATION ACCEPT message includes the PDU session reactivation
result error cause IE with the 5GMM cause set to #28 \"Restricted service
area\", the UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, and
behave as specified in subclause 5.3.5.
If the REGISTRATION ACCEPT message includes the SOR transparent container IE
and:
a) the SOR transparent container IE does not successfully pass the integrity
check (see 3GPP TS 33.501 [24]); and
b) if the UE attempts obtaining service on another PLMNs as specified in 3GPP
TS 23.122 [5] annex C;
then the UE shall release locally the established NAS signalling connection
after sending a REGISTRATION COMPLETE message.
If the REGISTRATION ACCEPT message includes the SOR transparent container IE
and the SOR transparent container IE successfully passes the integrity check
(see 3GPP TS 33.501 [24]):
a) the UE shall proceed with the behaviour as specified in 3GPP TS 23.122 [5]
annex C; and
b) if the registration procedure is performed over 3GPP access and the UE
attempts obtaining service on another PLMNs as specified in 3GPP TS 23.122 [5]
annex C then the UE may release locally the established NAS signalling
connection after sending a REGISTRATION COMPLETE message. Otherwise the UE
shall send a REGISTRATION COMPLETE message and not release the current N1 NAS
signalling connection locally. If an acknowledgement is requested in the SOR
transparent container IE of the REGISTRATION ACCEPT message, the UE
acknowledgement is included in the SOR transparent container IE of the
REGISTRATION COMPLETE message.
If the SOR transparent container IE successfully passes the integrity check
(see 3GPP TS 33.501 [24]), indicates list of preferred PLMN/access technology
combinations is provided and the list type indicates:
a) \"PLMN ID and access technology list\", then the ME shall replace the
highest priority entries in the \"Operator Controlled PLMN Selector with
Access Technology\" list stored in the ME and shall proceed with the behaviour
as specified in 3GPP TS 23.122 [5] annex C; or
b) \"secured packet\", then the ME shall behave as if a SMS is received with
protocol identifier set to SIM data download, data coding scheme set to class
2 message and SMS payload as secured packet contents of SOR transparent
container IE. The SMS payload is forwarded to UICC as specified in 3GPP TS
23.040 [4A] and the ME shall proceed with the behaviour as specified in 3GPP
TS 23.122 [5] annex C.
If required by operator policy, the AMF shall include the NSSAI inclusion mode
IE in the REGISTRATION ACCEPT message (see table 4.6.2.3.1 of subclause
4.6.2.3). Upon receipt of the REGISTRATION ACCEPT message:
a) if the message includes the NSSAI inclusion mode IE, the UE shall operate
in the NSSAI inclusion mode indicated in the NSSAI inclusion mode IE over the
current access within the current PLMN and its equivalent PLMN(s), if any, in
the current registration area; or
b) otherwise if:
1) the UE has NSSAI inclusion mode for the current PLMN and access type stored
in the UE, the UE shall operate in the stored NSSAI inclusion mode; or
2) the UE does not have NSSAI inclusion mode for the current PLMN and the
access type stored in the UE and if the UE is performing the registration
procedure over:
i) 3GPP access, the UE shall operate in NSSAI inclusion mode D in the current
PLMN and the current access type; or
ii) non-3GPP access, the UE shall operate in NSSAI inclusion mode C in the
current PLMN and the current access type.
The AMF may include operator-defined access category definitions in the
REGISTRATION ACCEPT message.
If the UE receives Operator-defined access category definitions IE in the
REGISTRATION ACCEPT message and the Operator-defined access category
definitions IE contains one or more operator-defined access category
definitions, the UE shall delete any operator-defined access category
definitions stored for the RPLMN and shall store the received operator-defined
access category definitions for the RPLMN. If the UE receives the Operator-
defined access category definitions IE in the REGISTRATION ACCEPT message and
the Operator-defined access category definitions IE contains no operator-
defined access category definitions, the UE shall delete any operator-defined
access category definitions stored for the RPLMN. If the REGISTRATION ACCEPT
message does not contain the Operator-defined access category definitions IE,
the UE shall not delete the operator-defined access category definitions
stored for the RPLMN.
##### 5.5.1.3.5 Mobility and periodic registration update not accepted by the
network
If the mobility and periodic registration update request cannot be accepted by
the network, the AMF shall send a REGISTRATION REJECT message to the UE
including an appropriate 5GMM cause value.
When the UE performs inter-system change from S1 mode to N1 mode, if the AMF
is informed that verification of the integrity protection of the TRACKING AREA
UPDATE REQUEST message included by the UE in the EPS NAS message container IE
of the REGISTRATION REQUEST message has failed in the MME, the AMF should send
REGISTRATION REJECT message including 5GMM cause #9 \"UE identity cannot be
derived by the network\".
The UE shall take the following actions depending on the 5GMM cause value
received in the REGISTRATION REJECT message.
#3 (Illegal UE); or
#6 (Illegal ME).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall delete the list of equivalent PLMNs and shall move to
5GMM-DEREGISTERED state.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the normal tracking area
updating procedure is rejected with the EMM cause with the same value. The
USIM shall be considered as invalid also for non-EPS services until switching
off or the UICC containing the USIM is removed. If the UE is in EMM-REGISTERED
state, the UE shall move to EMM-DEREGISTERED state.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#7 (5GS services not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall move to 5GMM-DEREGISTERED state.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the normal tracking area
updating procedure is rejected with the EMM cause with the same value.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#9 (UE identity cannot be derived by the network).
The UE shall set the 5GS update status to 5U2 NOT UPDATED (and shall store it
according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last visited
registered TAI, TAI list and ngKSI. The UE shall enter the state 5GMM-
DEREGISTERED.
If the rejected request was not for initiating an emergency PDU session, the
UE shall subsequently, automatically initiate the initial registration
procedure.
NOTE 1: User interaction is necessary in some cases when the UE cannot re-
establish the PDU session(s) automatically.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered
TAI, TAI list and eKSI as specified in 3GPP TS 24.301 [15] for the case when
the normal tracking area updating procedure is rejected with the EMM cause
with the same value.
If the UE also supports the registration procedure over the other access to
the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state
for this access, as described for this 5GMM cause value.
#10 (implicitly de-registered).
The UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. The UE shall
delete any mapped 5G NAS security context or partial native 5G NAS security
context.
If the registration rejected request was not for initiating an emergency PDU
session, the UE shall perform a new registration procedure for initial
registration.
NOTE 2: User interaction is necessary in some cases when the UE cannot re-
establish the PDU session(s) automatically.
If the UE is operating in single-registration mode, the UE shall handle the
EMM state as specified in 3GPP TS 24.301 [15] for the case when the normal
tracking area updating procedure is rejected with the EMM cause with the same
value.
#11 (PLMN not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall store the PLMN
identity in the \"forbidden PLMN list\", delete the list of equivalent PLMNs,
reset the registration attempt counter and enter the state 5GMM-
DEREGISTERED.PLMN-SEARCH. The UE shall perform a PLMN selection according to
3GPP TS 23.122 [5].
If the UE is operating in single-registration mode, the UE shall in addition
handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list,
eKSI and tracking area updating attempt counter as specified in 3GPP TS 24.301
[15] for the case when the normal tracking area updating procedure is rejected
with the EMM cause with the same value.
If the UE also supports the registration procedure over the other access to
the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state
for this access, as described for this 5GMM cause value.
#12 (Tracking area not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset
the registration attempt counter.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for regional provision of service\" and enter the state 5GMM-
DEREGISTERED.LIMITED-SERVICE.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
tracking area updating attempt counter as specified in 3GPP TS 24.301 [15] for
the case when the normal tracking area updating procedure is rejected with the
EMM cause with the same value.
#13 (Roaming not allowed in this tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete the list of
equivalent PLMNs. The UE shall reset the registration attempt counter and
shall change to state 5GMM-REGISTERED.PLMN-SEARCH.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\" and shall remove the current TAI from the stored TAI list
if present.
The UE shall perform a PLMN selection according to 3GPP TS 23.122 [5].
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status and tracking area updating attempt
counter as specified in 3GPP TS 24.301 [15] for the case when the normal
tracking area updating procedure is rejected with the EMM cause with the same
value.
#15 (No suitable cells in tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2). The UE shall reset the
registration attempt counter and shall enter the state 5GMM-
REGISTERED.LIMITED-SERVICE. The UE shall search for a suitable cell in another
tracking area according to 3GPP TS 38.304 [28].
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\" and shall remove the current TAI from the stored TAI list,
if present.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status and tracking area updating attempt
counter as specified in 3GPP TS 24.301 [15] for the case when the normal
tracking area updating procedure is rejected with the EMM cause with the same
value.
#22 (Congestion).
If the T3346 value IE is present in the REGISTRATION REJECT message and the
value indicates that this timer is neither zero nor deactivated, the UE shall
proceed as described below, otherwise it shall be considered as an abnormal
case and the behaviour of the UE for this case is specified in subclause
5.5.1.3.7.
The UE shall abort the registration procedure for mobility and periodic
registration update. If the rejected request was not for initiating an
emergency PDU session, the UE shall set the 5GS update status to 5U2 NOT
UPDATED and change to state 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE.
The UE shall stop timer T3346 if it is running.
If the REGISTRATION REJECT message is integrity protected, the UE shall start
timer T3346 with the value provided in the T3346 value IE.
If the REGISTRATION REJECT message is not integrity protected, the UE shall
start timer T3346 with a random value from the default range specified in 3GPP
TS 24.008 [12].
The UE stays in the current serving cell and applies the normal cell
reselection process. The registration procedure for mobility and periodic
registration update is started, if still necessary, when timer T3346 expires
or is stopped.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status and tracking area updating attempt
counter as specified in 3GPP TS 24.301 [15] for the case when the normal
tracking area updating procedure is rejected with the EMM cause with the same
value.
#27 (N1 mode not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset
the registration attempt counter and shall enter the state 5GMM-NULL.
The UE shall disable the N1 mode capability for both 3GPP access and non-3GPP
access (see subclause 4.9).
#72 (Non-3GPP access to 5GCN not allowed).
When received over non-3GPP access the UE shall set the 5GS update status to
5U3 ROAMING NOT ALLOWED (and shall store it according to subclause 5.1.3.2.2)
and shall delete 5G-GUTI, last visited registered TAI, TAI list and ngKSI.
Additionally, the UE shall reset the registration attempt counter and enter
the state 5GMM-DEREGISTERED.
NOTE: The 5GMM sublayer states, the 5GMM parameters and the registration
status are managed per access type independently, i.e. 3GPP access or non-3GPP
access (see subclauses 4.7.2 and 5.1.3).
The UE shall disable the N1 mode capability for non-3GPP access (see subclause
4.9.3).
As an implementation option, the UE may enter the state 5GMM-
DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to
3GPP TS 23.122 [5].
If received over 3GPP access the cause shall be considered as an abnormal case
and the behaviour of the UE for this case is specified in subclause 5.5.1.3.7.
#73 (Serving network not authorized).
The UE shall set the 5GS update status to 5U2 NOT UPDATED, reset the
registration attempt counter, store the PLMN identity in the \"forbidden PLMN
list\" and enter state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a
PLMN selection according to 3GPP TS 23.122 [5].
Other values are considered as abnormal cases. The behaviour of the UE in
those cases is specified in subclause 5.5.1.3.7.
##### 5.5.1.3.6 Mobility and periodic registration update for initiating an
emergency PDU session not accepted by the network
If the mobility and periodic registration update request for initiating an
emergency PDU session cannot be accepted by the network, the UE shall perform
the procedures as described in subclause 5.5.1.3.5. Then if the UE is in the
same selected PLMN where the last mobility and periodic registration update
request was attempted, the UE shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 1: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
b) perform de-registration locally, if not de-registered already, and attempt
initial registration for emergency services.
If the mobility and periodic registration update request for initiating an
emergency PDU session fails due to abnormal case b) in subclause 5.5.1.3.7,
the UE shall perform the actions as described in subclause 5.5.1.3.7 and
inform the upper layers of the failure to access the network.
NOTE 2: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
If the mobility and periodic registration update request for initiating an
emergency PDU session fails due to abnormal cases c) or d) in subclause
5.5.1.3.7, the UE shall perform the procedures as described in subclause
5.5.1.3.7. Then if the UE is in the same selected PLMN where the last mobility
and periodic registration update request was attempted, the UE shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 3: This can result in the upper layers requesting implementation specific
mechanisms, e.g. procedures specified in 3GPP TS 24.229 [14] can result in the
emergency call being attempted to another IP-CAN.
b) perform de-registration locally, if not de-registered already, and attempt
initial registration for emergency services.
##### 5.5.1.3.7 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Timer T3346 is running.
The UE shall not start the registration procedure for mobility and periodic
registration update unless:
1) the UE is in 5GMM-CONNECTED mode;
2) the UE received a paging;
3) the UE receives a NOTIFICATION message over non-3GPP access when the UE is
in 5GMM-CONNECTED mode over non-3GPP access and in 5GMM-IDLE mode over 3GPP
access;
4) the UE is a UE configured for high priority access in selected PLMN;
5) the UE has an emergency PDU session established or is establishing an
emergency PDU session;
6) the UE receives a request from the upper layers to send NAS signalling
associated with emergency services fallback; or
7) the UE receives the CONFIGURATION UPDATE COMMAND message as specified in
subclause 5.4.4.3.
The UE stays in the current serving cell and applies the normal cell
reselection process.
NOTE 1: It is considered an abnormal case if the UE needs to initiate a
registration procedure for mobility and periodic registration update while
timer T3346 is running independent on whether timer T3346 was started due to
an abnormal case or a non-successful case.
b) The lower layers indicate that the access attempt is barred.
The UE shall not start the registration procedure for mobility and periodic
registration update. The UE stays in the current serving cell and applies the
normal cell reselection process.
The registration procedure for mobility and periodic registration update is
started, if still needed, when the lower layers indicate that the barring is
alleviated for the access category with which the access attempt was
associated.
ba) The lower layers indicate that access barring is applicable for all access
categories except categories 0 and 2 and the access category with which the
access attempt was associated is other than 0 and 2.
If the REGISTRATION REQUEST message has not been sent, the UE shall proceed as
specified for case b. If the REGISTRATION REQUEST message has been sent, the
UE shall proceed as specified for case e and, additionally, the registration
procedure for mobility and periodic registration update is started, if still
needed, when the lower layers indicate that the barring is alleviated for the
access category with which the access attempt was associated. For additional
UE requirements for both cases see subclause 4.5.5.
c) T3510 timeout.
The UE shall abort the registration update procedure and the NAS signalling
connection, if any, shall be released locally. The UE shall proceed as
described below.
d) REGISTRATION REJECT message, other 5GMM cause values than those treated in
subclause 5.5.1.3.5, and cases of 5GMM cause value #22 and #72, if considered
as abnormal cases according to subclause 5.5.1.3.5.
Upon reception of the 5GMM causes #95, #96, #97, #99 and #111 the UE should
set the registration attempt counter to 5.
The UE shall proceed as described below.
e) Lower layer failure or release of the NAS signalling connection received
from lower layers before the REGISTRATION ACCEPT or REGISTRATION REJECT
message is received.
The UE shall abort the registration procedure and proceed as described below.
f) Change of cell into a new tracking area.
If a cell change into a new tracking area occurs before the registration
procedure for mobility and periodic registration update is completed, the
registration procedure for mobility and periodic registration update shall be
aborted and re-initiated immediately. The UE shall set the 5GS update status
to 5U2 NOT UPDATED.
g) Registration procedure for mobility and periodic registration update and
de-registration procedure collision.
If the UE receives a DEREGISTRATION REQUEST message before the registration
procedure for mobility and periodic registration update has been completed,
the registration procedure for mobility and periodic registration update shall
be aborted and the de-registration procedure shall be progressed.
NOTE 2: The registration procedure for mobility and periodic registration
update shall be aborted only if the DEREGISTRATION REQUEST message indicates
in the access type that the access in which the registration procedure for
mobility and periodic registration update was attempted shall be de-
registered. Otherwise both the procedures shall be progressed.
h) Void
i) Transmission failure of REGISTRATION REQUEST message indication from the
lower layers.
The registration procedure for mobility and periodic registration update shall
be aborted and re-initiated immediately. The UE shall set the 5GS update
status to 5U2 NOT UPDATED.
j) Transmission failure of REGISTRATION COMPLETE message indication with TAI
change from lower layers.
If the current TAI is not in the TAI list, the registration procedure for
mobility and periodic registration update shall be aborted and re-initiated
immediately. The UE shall set the 5GS update status to 5U2 NOT UPDATED.
If the current TAI is still part of the TAI list, it is up to the UE
implementation how to re-run the ongoing procedure.
k) Transmission failure of REGISTRATION COMPLETE message indication without
TAI change from lower layers.
It is up to the UE implementation how to re-run the ongoing procedure.
l) UE-initiated de-registration required.
De-registration due to removal of USIM or due to switch off:
The registration procedure for mobility and periodic registration update shall
be aborted, and the UE initiated de-registration procedure shall be performed.
De-registration not due to removal of USIM and not due to switch off:
the UE initiated de-registration procedure shall be initiated after successful
completion of the registration procedure for mobility and periodic
registration update.
For the cases c, d and e the UE shall proceed as follows:
Timer T3510 shall be stopped if still running.
The registration attempt counter shall be incremented, unless it was already
set to 5.
If the registration attempt counter is less than 5:
\- if the TAI of the current serving cell is not included in the TAI list or
the 5GS update status is different to 5U1 UPDATED, the UE shall start timer
T3511, shall set the 5GS update status to 5U2 NOT UPDATED and change to state
5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. When timer T3511 expires and
the registration update procedure is triggered again.
\- if the TAI of the current serving cell is included in the TAI list, the 5GS
update status is equal to 5U1 UPDATED, and the UE is not performing the
registration procedure after an inter-system change from S1 mode to N1 mode,
the UE shall keep the 5GS update status to 5U1 UPDATED and enter state 5GMM-
REGISTERED.NORMAL-SERVICE. The UE shall start timer T3511. If in addition the
REGISTRATION REQUEST message indicated \"periodic registration updating\" or
if the registration procedure was initiated to recover the NAS signalling
connection due to \"RRC Connection failure\" from the lower layers, none of
the other reasons for initiating the registration updating procedure listed in
subclause 5.5.1.3.2 was applicable, and the REGISTRATION REQUEST message did
not include the MICO indication IE, the timer T3511 may be stopped when the UE
enters 5GMM-CONNECTED mode.
\- if the TAI of the current serving cell is included in the TAI list, the 5GS
update status is equal to 5U1 UPDATED and the UE is performing the
registration procedure after an inter-system change from S1 mode to N1 mode,
the UE shall change the 5GS update status to 5U2 NOT UPDATED and enter state
5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE. The UE shall start timer
T3511.
\- If the UE is operating in single registration mode, the UE shall in
addition handle the EPS update status as specified in 3GPP TS 24.301 [15] for
the abnormal cases when a normal or periodic tracking area updating procedure
fails and the tracking area attempt counter is less than 5 and the EPS update
status is different from EU1 UPDATED.
If the registration attempt counter is equal to 5
\- the UE shall start timer T3502, shall set the 5GS update status to 5U2 NOT
UPDATED.
\- the UE shall delete the list of equivalent PLMNs and shall change to state
5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE UPDATE or optionally to 5GMM-
REGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to 3GPP
TS 23.122 [5].
\- if the UE is operating in single registration mode:
\- the UE shall in addition handle the EPS update status as specified in 3GPP
TS 24.301 [15] for the abnormal cases when a normal or periodic tracking area
updating procedure fails and the tracking area attempt counter is equal to 5;
and
\- if the UE does not change to state 5GMM-REGISTERED.PLMN-SEARCH, the UE
shall attempt to select E-UTRAN radio access technology. The UE may disable N1
mode capability as specified in subclause 4.9.
##### 5.5.1.3.8 Abnormal cases on the network side
The following abnormal cases can be identified:
a) If a lower layer failure occurs before the message REGISTRATION COMPLETE
has been received from the UE and a 5G-GUTI has been assigned, the AMF shall
abort the procedure, enter 5GMM-IDLE mode and shall consider both, the old and
new 5G-GUTI as valid until the old 5G-GUTI can be considered as invalid by the
AMF (see subclause 5.4.4.3). During this period the AMF may use the
identification procedure followed by a generic UE configuration update
procedure if the old 5G-GUTI is used by the UE in a subsequent message.
b) Protocol error.
If the REGISTRATION REQUEST message has been received with a protocol error,
the AMF shall return a REGISTRATION REJECT message with one of the following
5GMM cause values:
#96 invalid mandatory information;
#99 information element non-existent or not implemented;
#100 conditional IE error; or
#111 protocol error, unspecified.
c) T3550 time out.
On the first expiry of the timer, the AMF shall retransmit the REGISTRATION
ACCEPT message and shall reset and restart timer T3550. The retransmission is
performed four times, i.e. on the fifth expiry of timer T3550, the
registration procedure for mobility and periodic update procedure is aborted.
Both, the old and new 5G-GUTI shall be considered as valid until the old
5G-GUTI can be considered as invalid by the AMF (see subclause 5.4.4.3).
During this period the AMF acts as described for case a) above.
d) REGISTRATION REQUEST with 5GS registration type IE set to \"mobility
registration updating\" or \"periodic registration updating\" received after
the REGISTRATION ACCEPT message has been sent and before the REGISTRATION
COMPLETE message is received.
1) If one or more of the information elements in the REGISTRATION REQUEST
message differ from the ones received within the previous REGISTRATION REQUEST
message, the previously initiated registration procedure for mobility and
periodic registration update shall be aborted if the REGISTRATION COMPLETE
message has not been received and the new registration procedure for mobility
and periodic registration update shall be progressed; or
2) if the information elements do not differ, then the REGISTRATION ACCEPT
message shall be resent and timer T3550 shall be restarted if an REGISTRATION
COMPLETE message is expected. In that case, the retransmission counter related
to timer T3550 is not incremented.
e) More than one REGISTRATION REQUEST with 5GS registration type IE set to
\"mobility registration updating\" or \"periodic registration updating\"
received and no REGISTRATION ACCEPT or REGISTRATION REJECT message has been
sent.
1) If one or more of the information elements in the REGISTRATION REQUEST
message differs from the ones received within the previous REGISTRATION
REQUEST message, the previously initiated registration procedure for mobility
and periodic registration update shall be aborted and the new registration
procedure for mobility and periodic registration update shall be progressed;
or
2) if the information elements do not differ, then the network shall continue
with the previous registration procedure for mobility and periodic
registration update and shall not treat any further this REGISTRATION REQUEST
message.
f) Lower layers indication of non-delivered NAS PDU due to handover.
If the REGISTRATION ACCEPT message or REGISTRATION REJECT message could not be
delivered due to an intra AMF handover and the target TA is included in the
TAI list, then upon successful completion of the intra AMF handover the AMF
shall retransmit the REGISTRATION ACCEPT message or REGISTRATION REJECT
message. If a failure of the handover procedure is reported by the lower layer
and the N1 NAS signalling connection exists, the AMF shall retransmit the
REGISTRATION ACCEPT message or REGISTRATION REJECT message.
g) DEREGISTRATION REQUEST message received before REGISTRATION COMPLETE
message is received.
If the De-registration type IE is set to \"switch off\":
The AMF shall abort the signalling for the registration procedure for mobility
and periodic update towards the UE and shall progress the de-registration
procedure as described in subclause 5.5.2.2.
NOTE: Internally in the AMF, before processing the de-registration request,
the AMF can perform the necessary signalling procedures for the registration
procedure for mobility and periodic update before progressing the de-
registration procedure.
If the De-registration type IE is set to other type than\"switch off\":
The AMF shall proceed with registration procedure for mobility and periodic
update and shall progress the de-registration procedure after successful
completion of the registration procedure for mobility and periodic update.
h) If the REGISTRATION REQUEST message with 5GS registration type IE
indicating \"periodic registration updating\" is received by the new AMF which
does not have the 5GMM context data related to the subscription, the new AMF
may send the REGISTRATION REJECT message with 5GMM cause #10 \"implicitly de-
registered\".
### 5.5.2 De-registration procedure
#### 5.5.2.1 General
The de-registration procedure is used:
a) by the UE to de-register for 5GS services over 3GPP access when the UE is
registered over 3GPP access;
b) by the UE to de-register for 5GS services over non-3GPP access when the UE
is registered over non-3GPP access;
c) by the UE to de-register for 5GS services over both 3GPP access and
non-3GPP access when the UE is registered in the same PLMN over both accesses;
d) by the network to inform the UE that it is deregistered for 5GS services
over 3GPP access when the UE is registered over 3GPP access;
e) by the network to inform the UE that it is deregistered for 5GS services
over non-3GPP access when the UE is registered over non-3GPP access;
f) by the network to inform the UE that it is deregistered for 5GS services
over both 3GPP access and non-3GPP access when the UE is registered in the
same PLMN over both accesses; and
g) by the network to inform the UE to re-register to the network.
The de-registration procedure with appropriate de-registration type shall be
invoked by the UE:
a) if the UE is switched off; and
b) as part of the eCall inactivity procedure defined in subclause 5.5.3.
The de-registration procedure with appropriate de-registration type shall be
invoked by the network:
a) if the network informs whether the UE should re-register to the network.
The de-registration procedure with appropriate access type shall be invoked by
the UE:
a) if the UE needs to de-register for 5GS services over 3GPP access when the
UE is registered over 3GPP access;
b) if the UE needs to de-register for 5GS services over non-3GPP access when
the UE is registered over non-3GPP access; or
c) the UE needs to de-register for 5GS services over both 3GPP access and
non-3GPP access when the UE is registered in the same PLMN over both accesses.
The de-registration procedure with appropriate access type shall be invoked by
the network:
a) if the network needs to inform the UE that it is deregistered over 3GPP
access when the UE is registered over 3GPP access;
b) if the network needs to inform the UE that it is deregistered over non-3GPP
access when the UE is registered over non-3GPP access; or
c) if the network needs to inform the UE that it is deregistered over both
3GPP access and non-3GPP access when the UE is registered in the same PLMN
over both accesses.
If the de-registration procedure is triggered due to USIM removal, the UE
shall indicate \"switch off\" in the de-registration type IE.
If the de-registration procedure is requested by the network for a UE that has
an emergency PDU session, the AMF shall not send a DEREGISTRATION REQUEST
message to the UE and indicate to the SMF to release all non-emergency PDU
sessions as specified in 3GPP TS 23.502 [9].
If the de-registration procedure for 5GS services is performed, a local
release of the PDU sessions, if any, for this particular UE is performed.
The UE is allowed to initiate the de-registration procedure even if the timer
T3346 is running.
NOTE: When the UE has no PDU sessions over non-3GPP access, or the UE moves
all the PDU sessions over a non-3GPP access to a 3GPP access, the UE and the
AMF need not initiate de-registration over the non-3GPP access.
The AMF shall provide the UE with a non-3GPP de-registration timer.
#### 5.5.2.2 UE-initiated de-registration procedure
##### 5.5.2.2.1 UE-initiated de-registration procedure initiation
The de-registration procedure is initiated by the UE by sending a
DEREGISTRATION REQUEST message (see example in figure 5.5.2.2.1). The De-
registration type IE included in the message indicates whether the de-
registration procedure is due to a \"switch off\" or not. The access type
included in the message indicates whether the de-registration procedure is:
a) for 5GS services over 3GPP access when the UE is registered over 3GPP
access;
b) for 5GS services over non-3GPP access when the UE is registered over
non-3GPP access; or
c) for both 3GPP access and non-3GPP access when the UE is registered in the
same PLMN over both accesses.
If the UE has a valid 5G-GUTI, the UE shall populate the 5GS mobile identity
IE with the valid 5G-GUTI. If the UE does not have a valid 5G-GUTI, the UE
shall populate the 5GS mobile identity IE with its SUCI as follows:
a) if timer T3519 is not running, generate a fresh SUCI as specified in 3GPP
TS 33.501 [24], send a DEREGISTRATION REQUEST message with the SUCI, start
timer T3519 and store the value of the SUCI sent in the DEREGISTRATION REQUEST
message; and
b) if timer T3519 is running, send a DEREGISTRATION REQUEST message with the
stored SUCI.
If the UE does not have a valid 5G-GUTI and it does not have a valid SUCI,
then the UE shall populate the5GS mobile identity IE with its PEI.
If the de-registration request is not due to switch off and the UE is in the
state 5GMM-REGISTERED or 5GMM-REGISTERED-INITIATED, timer T3521 shall be
started in the UE after the DEREGISTRATION REQUEST message has been sent. The
UE shall enter the state 5GMM-DEREGISTERED-INITIATED.
If the UE is to be switched off, the UE shall try for a period of 5 seconds to
send the DEREGISTRATION REQUEST message. During this period, the UE may be
switched off as soon as the DEREGISTRATION REQUEST message has been sent.
Figure 5.5.2.2.1.1: UE-initiated de-registration procedure
##### 5.5.2.2.2 UE-initiated de-registration procedure completion
When the DEREGISTRATION REQUEST message is received by the AMF, the AMF shall
send a DEREGISTRATION ACCEPT message to the UE, if the De-registration type IE
does not indicate \"switch off\". Otherwise, the procedure is completed when
the AMF receives the DEREGISTRATION REQUEST message.
The UE, when receiving the DEREGISTRATION ACCEPT message, shall stop timer
T3521, stop timer T3519 if running, and delete any stored SUCI.
##### 5.5.2.2.3 UE-initiated de-registration procedure completion for 5GS
services over 3GPP access
If the access type in the DEREGISTRATION REQUEST message indicates that the
de-registration procedure is for 3GPP access, the AMF shall trigger the SMF to
perform a local release of the PDU session(s) established over 3GPP access, if
any, for this UE. The UE shall perform a local release of the PDU session(s)
established over 3GPP access, if any. The UE is marked as inactive in the AMF
for 5GS services for 3GPP access. The AMF shall enter the state 5GMM-
DEREGISTERED for 3GPP access.
If the UE supports N1 mode only and the de-registration request is not due to
switch off, then:
a) if the de-registration procedure was performed due to disabling of 5GS
services, then the UE shall enter the 5GMM-NULL state for 3GPP access;
b) otherwise, the UE shall enter the 5GMM-DEREGISTERED state for 3GPP access.
NOTE: Case b) is applicable when the UE is also registered over non-3GPP
access.
If the UE is operating in single-registration mode, it shall additionally
proceed as specified in 3GPP TS 24.301 [15], subclause 5.5.2.2.2, for the case
when the UE receives an EMM message DETACH ACCEPT.
##### 5.5.2.2.4 UE-initiated de-registration procedure completion for 5GS
services non-3GPP access
If the access type in the DEREGISTRATION REQUEST indicates that the de-
registration procedure is for non-3GPP access, the AMF shall trigger SMF to
perform a local release of the PDU session(s) established over non-3GPP
access, if any, for this UE. The UE shall perform a local release of the PDU
session(s) established over non-3GPP access, if any. The UE is marked as
inactive in the AMF for 5GS services for non-3GPP access. The AMF shall enter
the state 5GMM-DEREGISTERED over non-3GPP access.
If the de-registration request is not due to switch off, the UE shall:
a) if the de-registration procedure was performed due to disabling of 5GS
services, enter the 5GMM-NULL state for non-3GPP access;
b) otherwise, enter the 5GMM-DEREGISTERED state for non-3GPP access.
NOTE: Case b) is applicable when the UE is also registered over 3GPP access.
##### 5.5.2.2.5 UE-initiated de-registration procedure completion for 5GS
services over both 3GPP access and non-3GPP access
If the access type in the DEREGISTRATION REQUEST indicates that the de-
registration procedure is for both 3GPP access and non-3GPP access when the UE
is registered in the same PLMN over both accesses, the descriptions for UE-
initiated de-registration procedure completion for 5GS services over 3GPP
access and over non-3GPP access, as specified in subclauses 5.5.2.2.3 and
5.5.2.2.4, shall be followed.
##### 5.5.2.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Lower layer failure or release of the N1 NAS signalling connection before
reception of DEREGISTRATION ACCEPT message.
The de-registration procedure shall be aborted and the UE proceeds as follows:
1) if the de-registration procedure was performed due to disabling of 5GS
services, the UE shall enter the 5GMM-NULL state; or
2) if the de-registration type \"normal de-registration\" was requested for
reasons other than disabling of 5GS services, the UE shall enter the 5GMM-
DEREGISTERED state.
b) The lower layers indicate that the access attempt is barred.
The UE shall not start the de-registration procedure. The UE stays in the
current serving cell and applies the normal cell reselection process.
The UE may perform a local de-registration either immediately or after an
implementation-dependent time.
The de-registration procedure is started, if still needed, when the lower
layers indicate that the barring is alleviated for the access category with
which the access attempt was associated.
ba) The lower layers indicate that access barring is applicable for all access
categories except categories 0 and 2 and the access category with which the
access attempt was associated is other than \'0\' and \'2\'.
If the DEREGISTRATION REQUEST message has not been sent, the UE shall proceed
as specified for case b. If the DEREGISTRATION REQUEST message has been sent,
the UE shall proceed as specified for case a.
c) T3521 timeout.
On the first four expiries of the timer, the UE shall retransmit the
DEREGISTRATION REQUEST message and shall reset and restart timer T3521. On the
fifth expiry of timer T3521, the de-registration procedure shall be aborted
and the UE proceeds as follows:
1) if the de-registration procedure was performed due to disabling of 5GS
services, the UE shall enter the 5GMM-NULL state; or
2) if the de-registration type \"normal de-registration\" was requested for
reasons other than disabling of 5GS services, the UE shall enter the 5GMM-
DEREGISTERED state.
d) De-registration procedure collision.
De-registration containing de-registration type \"switch off\":
\- If the UE receives a DEREGISTRATION REQUEST message before the UE-initiated
de-registration procedure has been completed, this message shall be ignored
and the UE-initiated de-registration procedure shall continue.
Otherwise:
\- If the UE receives a DEREGISTRATION REQUEST message before the UE-initiated
de-registration procedure has been completed, it shall treat the message as
specified in subclause 5.5.2.3.2 with the following modification:
\- If the DEREGISTRATION REQUEST message received by the UE contains de-
registration type \"re-registration required\", and the UE-initiated de-
registration procedure is with de-registration type \"normal de-
registration\", the UE need not initiate the registration procedure for
initial registration.
e) De-registration and 5GMM common procedure collision.
De-registration containing de-registration type \"switch off\":
\- If the UE receives a message used in a 5GMM common procedure before the de-
registration procedure has been completed, this message shall be ignored and
the de-registration procedure shall continue.
Otherwise:
\- If the UE receives a message used in a 5GMM common procedure before the de-
registration procedure has been completed, both the 5GMM common procedure and
the de-registration procedure shall continue.
f) Change of cell into a new tracking area.
If a cell change into a new tracking area that is not in the stored TAI list
occurs before the UE-initiated de-registration procedure is completed, the de-
registration procedure shall be aborted and re-initiated after successfully
performing a registration procedure for mobility or periodic update used for
mobility (i.e. the 5GS registration type IE set to \"mobility registration
updating\" in the REGISTRATION REQUEST message). If the de-registration
procedure was initiated due to removal of the USIM or the UE is to be switched
off, the UE shall abort the de-registration procedure and enter the state
5GMM-DEREGISTERED.
g) Transmission failure of DEREGISTRATION REQUEST message indication with TAI
change from lower layers.
If the current TAI is not in the TAI list, the de-registration procedure shall
be aborted and re-initiated after successfully performing a registration
procedure for mobility or periodic update. If the de-registration procedure
was initiated due to removal of the USIM or the UE is to be switched off, the
UE shall abort the de-registration procedure and enter the state 5GMM-
DEREGISTERED.
If the current TAI is still part of the TAI list, the UE shall restart the de-
registration procedure.
h) Transmission failure of DEREGISTRATION REQUEST message indication without
TAI change from lower layers.
The UE shall restart the de-registration procedure.
##### 5.5.2.2.7 Abnormal cases in the network side
Apart from the case described in subclauses 5.5.2.2.2 and 5.5.2.2.3, no
abnormal cases have been identified.
#### 5.5.2.3 Network-initiated de-registration procedure
##### 5.5.2.3.1 Network-initiated de-registration procedure initiation
The network initiates the de-registration procedure by sending a
DEREGISTRATION REQUEST message to the UE (see example in figure 5.5.2.3.1.1).
NOTE: If the AMF performs a local de-registration, it will inform the UE with
a 5GMM messages (e.g. SERVICE REJECT message or REGISTRATION REJECT message)
with 5GMM cause #10 \"implicitly de-registered\" only when the UE initiates a
5GMM procedure.
The network may include a 5GMM cause IE to specify the reason for the
DEREGISTRATION REQUEST message. The network shall start timer T3522. The
network shall indicate whether re-registration is needed or not in the De-
registration type IE. The network shall also indicate via the access type
whether the de-registration procedure is:
a) for 3GPP access only;
b) for non-3GPP access only; or
c) for both 3GPP access and non-3GPP access when the UE is registered in the
same PLMN for both accesses.
The AMF shall trigger the SMF to release locally the PDU session(s) over the
indicated access(es), if any, for the UE and enter state 5GMM-DEREGISTERED-
INITIATED.
Figure 5.5.2.3.1.1: Network-initiated de-registration procedure
##### 5.5.2.3.2 Network-initiated de-registration procedure completion by the
UE
Upon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION
REQUEST message indicates \"re-registration required\" and the de-registration
request is for 3GPP access, the UE shall perform a local release of the PDU
sessions over 3GPP access, if any. The UE shall stop the timer(s) T3346,
T3396, T3584 and T3585, if it is running for the current PLMN. The UE shall
send a DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-
DEREGISTERED for 3GPP access. Furthermore, the UE shall, after the completion
of the de-registration procedure, and the release of the existing NAS
signalling connection, initiate an initial registration. The UE should also
re-establish any previously established PDU sessions over 3GPP access.
Upon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION
REQUEST message indicates \"re-registration required\" and the de-registration
request is for non-3GPP access, the UE shall perform a local release of the
PDU sessions over non-3GPP access, if any. The UE shall stop the timer(s)
T3346, T3396, T3584 and T3585, if it is running for the current PLMN. The UE
shall send a DEREGISTRATION ACCEPT message to the network and enter the state
5GMM-DEREGISTERED for non-3GPP access. Furthermore, the UE shall, after the
completion of the de-registration procedure, and the release of the existing
NAS signalling connection, initiate an initial registration over non-3GPP. The
UE should also re-establish any previously established PDU sessions over
non-3GPP access.
Upon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION
REQUEST message indicates \"re-registration required\" and the de-registration
request is for both 3GPP access and non-3GPP access when the UE is registered
in the same PLMN for both accesses, the UE shall perform a local release of
the PDU sessions over both 3GPP access and non-3GPP access, if any. The UE
shall stop the timer(s) T3346, T3396, T3584 and T3585, if it is running for
the current PLMN. The UE shall send a DEREGISTRATION ACCEPT message to the
network and enter the state 5GMM-DEREGISTERED for both 3GPP access and
non-3GPP access. Furthermore, the UE shall, after the completion of the de-
registration procedure, and the release of the existing NAS signalling
connection, initiate an initial registration over both 3GPP access and
non-3GPP access. The UE should also re-establish any previously established
PDU sessions over both 3GPP access and non-3GPP access.
NOTE 1: When the de-registration type indicates \"re-registration required\",
user interaction is necessary in some cases when the UE cannot re-establish
the PDU session (s), if any, automatically.
Upon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION
REQUEST message indicates \"re-registration not required\" and the de-
registration request is for 3GPP access, the UE shall perform a local release
of the PDU sessions over 3GPP access, if any. The UE shall send a
DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-
DEREGISTERED for 3GPP access.
Upon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION
REQUEST message indicates \"re-registration not required\" and the de-
registration request is for non-3GPP access, the UE shall perform a local
release of the PDU sessions over non-3GPP access, if any. The UE shall send a
DEREGISTRATION ACCEPT message to the network and enter the state 5GMM-
DEREGISTERED for non-3GPP access.
Upon receiving the DEREGISTRATION REQUEST message, if the DEREGISTRATION
REQUEST message indicates \"re-registration not required\" and the de-
registration request is for both 3GPP access and non-3GPP access when the UE
is registered in the same PLMN for both accesses, the UE shall perform a local
release of the PDU sessions over both 3GPP access and non-3GPP access, if any.
The UE shall send a DEREGISTRATION ACCEPT message to the network and enter the
state 5GMM-DEREGISTERED for both 3GPP access and non-3GPP access.
Upon sending a DEREGISTRATION ACCEPT message, the UE shall delete the rejected
NSSAI as specified in subclause 4.6.2.2.
If the de-registration type indicates \"re-registration required\", then the
UE shall ignore the 5GMM cause IE if received.
If the de-registration type indicates \"re-registration not required\", the UE
shall take the actions depending on the received 5GMM cause value:
#3 (Illegal UE); or
#6 (Illegal ME).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall delete the list of equivalent PLMNs and shall enter
the state 5GMM-DEREGISTERED.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when a DETACH REQUEST is
received with the EMM cause with the same value and with detach type set to
\"re-attach not required\". The USIM shall be considered as invalid also for
non-EPS services until switching off or the UICC containing the USIM is
removed.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#7 (5GS services not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall delete the list of equivalent PLMNs and shall enter
the state 5GMM-DEREGISTERED.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, last visited registered
TAI, TAI list and eKSI as specified in 3GPP TS 24.301 [15] for the case when a
DETACH REQUEST is received with the EMM cause with the same value and with
detach type set to \"re-attach not required\".
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#11 (PLMN not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall delete the list of
equivalent PLMNs, shall reset the registration attempt counter and enter the
state 5GMM-DEREGISTERED.PLMN-SEARCH.
The UE shall store the PLMN identity in the \"forbidden PLMN list\".
The UE shall perform a PLMN selection according to 3GPP TS 23.122 [5].
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when a
DETACH REQUEST is received with the EMM cause with the same value and with
detach type set to \"re-attach not required\".
If the UE also supports the registration procedure over the other access to
the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state
for this access, as described for this 5GMM cause value.
#12 (Tracking area not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall reset the
registration attempt counter and shall enter the state 5GMM-
DEREGISTERED.LIMITED-SERVICE.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for regional provision of service\".
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters, EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when a
DETACH REQUEST is received with the EMM cause with the same value and with
detach type set to \"re-attach not required\".
#13 (Roaming not allowed in this tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall delete the list of
equivalent PLMNs, reset the registration attempt counter and shall change to
state 5GMM-DEREGISTERED.PLMN-SEARCH.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\".
The UE shall perform a PLMN selection according to 3GPP TS 23.122 [5]
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when a
DETACH REQUEST is received with the EMM cause with the same value and with
detach type set to \"re-attach not required\".
#15 (No suitable cells in tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall reset the
registration attempt counter and shall enter the state 5GMM-
DEREGISTERED.LIMITED-SERVICE.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\".
The UE shall search for a suitable cell in another tracking area according to
3GPP TS 38.304 [28].
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list, eKSI and
attach attempt counter as specified in 3GPP TS 24.301 [15] for the case when a
DETACH REQUEST is received with the EMM cause with the same value and with
detach type set to \"re-attach not required\".
#22 (Congestion).
The UE shall stop timer T3346 if it is running and shall set the 5GS update
status to 5U2 NOT UPDATED and shall enter the state 5GMM-
DEREGISTERED.ATTEMPTING-REGISTRATION.
If the T3346 value IE is present in the DEREGISTRATION REQUEST message and the
value indicates that this timer is neither zero nor deactivated, the UE shall
start timer T3346 with the value provided in the T3346 value IE.
#27 (N1 mode not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. Additionally, the UE shall reset
the registration attempt counter and shall enter the state 5GMM-NULL.
The UE shall disable the N1 mode capability for both 3GPP access and non-3GPP
access (see subclause 4.9).
#72 (Non-3GPP access to 5GCN not allowed).
If received over non-3GPP access when the UE is registered over non-3GPP
access, the UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and
shall store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI,
last visited registered TAI, TAI list and ngKSI for non-3GPP access.
Additionally, the UE shall reset the registration attempt counter and enter
the state 5GMM-DEREGISTERED for non-3GPP access.
NOTE 2: The 5GMM sublayer states, the 5GMM parameters and the registration
status are managed per access type independently, i.e. 3GPP access or non-3GPP
access (see subclauses 4.7.2 and 5.1.3).
The UE shall disable the N1 mode capability for non-3GPP access (see subclause
4.9.3).
As an implementation option, if the UE is not currently registered over 3GPP
access, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to
perform a PLMN selection according to 3GPP TS 23.122 [5].
If received over 3GPP access the cause shall be considered as an abnormal case
and the behaviour of the UE for this case is specified in subclause 5.5.2.3.4.
##### 5.5.2.3.3 Network-initiated de-registration procedure completion by the
network
The network shall stop timer T3522 upon receipt of the DEREGISTRATION ACCEPT
message. The network shall enter state 5GMM-DEREGISTERED for 3GPP access if
the de-registration request is for 3GPP access. The network shall enter state
5GMM-DEREGISTERED for non-3GPP access if the de-registration request is for
non-3GPP access. The network shall enter state 5GMM-DEREGISTERED for both 3GPP
access and non-3GPP access if the de-registration request is for both 3GPP
access and non-3GPP access.
##### 5.5.2.3.4 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Transmission failure of DEREGISTRATION ACCEPT message indication from lower
layers.
The de-registration procedure shall be progressed and the UE shall send the
DEREGISTRATION ACCEPT message.
b) DEREGISTRATION REQUEST, other 5GMM cause values than those treated in
subclause 5.5.2.3.2, cases of 5GMM cause value #72 that are considered as
abnormal cases according to subclause 5.5.2.3.2 or no 5GMM cause IE is
included, and the De-registration type IE indicates \"re-registration not
required\".
The UE shall delete 5G-GUTI, TAI list, last visited registered TAI, list of
equivalent PLMNs, ngKSI, shall set the 5GS update status to 5U2 NOT UPDATED
and shall start timer T3502.
A UE not supporting S1 mode may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH
in order to perform a PLMN selection according to 3GPP TS 23.122 [5];
otherwise the UE shall enter the state 5GMM-DEREGISTERED.ATTEMPTING-
REGISTRATION.
A UE operating in single-registration mode shall:
\- enter the state 5GMM-DEREGISTERED and attempt to select E-UTRAN radio
access technology and proceed with the appropriate EMM specific procedures. In
this case, the UE may disable N1 mode capability (see subclause 4.9); or
\- enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to perform a PLMN
selection according to 3GPP TS 23.122 [5].
A UE operating in single-registration mode shall set the EPS update status to
EU2 NOT UPDATED and shall delete the EMM parameters 4G-GUTI, TAI list and eKSI
and shall enter the state EMM-DEREGISTERED.
##### 5.5.2.3.5 Abnormal cases in the network side
The following abnormal cases can be identified:
a) T3522 time-out
On the first expiry of the timer, the network shall retransmit the
DEREGISTRATION REQUEST message and shall start timer T3522. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3522, the de-registration procedure shall be aborted. The network shall
change to the state 5GMM-DEREGISTERED for the access type which the de-
registration procedure is intended for.
b) Lower layer failure
The de-registration procedure is aborted. The network shall change to the
state 5GMM-DEREGISTERED for the access type which the de-registration
procedure is intended for.
c) De-registration procedure collision
If the network receives a DEREGISTRATION REQUEST message with \"switch off\"
indication, before the network-initiated de-registration procedure has been
completed, both procedures shall be considered completed.
If the network receives a DEREGISTRATION REQUEST message without \"switch
off\" indication, before the network-initiated de-registration procedure has
been completed, the network shall send a DEREGISTRATION ACCEPT message to the
UE.
d) De-registration and registration procedure for initial registration
collision
If the network receives a REGISTRATION REQUEST message indicating either
\"initial registration\" or \"emergency registration\" in the 5GS registration
type IE before the network-initiated de-registration procedure has been
completed, the network shall aborted the de-registration procedure and the
registration procedure shall be progressed after the PDU sessions associated
with the access type the REGISTRATION REQUEST message is sent over have been
deleted.
e) De-registration and registration procedure for mobility and periodic
registration update collision
If the network sent a DEREGISTRATION REQUEST message and the network receives
a REGISTRATION REQUEST message indicating either \"mobility registration
updating\" or \"periodic registration updating\" in the 5GS registration type
IE before the network-initiated de-registration procedure has been completed,
the de-registration procedure shall be progressed, i.e. the REGISTRATION
REQUEST message shall be ignored.
f) De-registration and service request procedure collision
If the network receives a SERVICE REQUEST message before the network-initiated
de-registration procedure has been completed (e.g. the DEREGISTRATION REQUEST
message is pending to be sent to the UE), the network shall progress the de-
registration procedure.
### 5.5.3 eCall inactivity procedure
The eCall inactivity procedure is performed only in 3GPP access and applicable
only to a UE configured for eCall only mode as specified in 3GPP TS 31.102
[22]. The procedure shall be started when:
a) the UE is in any 5GMM-REGISTERED substate except substates 5GMM-
REGISTERED.PLMN-SEARCH or 5GMM-REGISTERED.NO-CELL-AVAILABLE;
b) the UE is in 5GMM-IDLE mode; and
c) one of the following conditions applies:
1) timer T3444 expires or is found to have already expired and timer T3445 is
not running;
2) timer T3445 expires or is found to have already expired and timer T3444 is
not running; or
3) timers T3444 and T3445 expire or are found to have already expired.
The UE shall then perform the following actions:
a) stop other running timers (e.g. T3511, T3512);
b) if the UE is currently registered to the network for 5GS services, perform
a de-registration procedure;
c) delete any 5G-GUTI, TAI list, last visited registered TAI, list of
equivalent PLMNs, and ngKSI; and
d) enter 5GMM-DEREGISTERED.eCALL-INACTIVE state.
## 5.6 5GMM connection management procedures
### 5.6.1 Service request procedure
#### 5.6.1.1 General
The purpose of the service request procedure is to change the 5GMM mode from
5GMM-IDLE to 5GMM-CONNECTED mode, and/or to request the establishment of user-
plane resources for PDU sessions which are established without user-plane
resources. In latter case, the 5GMM mode can be the 5GMM-IDLE mode or the
5GMM-CONNECTED mode if the UE requires to establish user-plane resources for
PDU sessions.
NOTE 1: The lower layer indicates when the user-plane resources for PDU
sessions are successfully established or released.
This procedure is used when:
\- the network has downlink signalling pending over 3GPP access and the UE is
in 5GMM-IDLE mode over 3GPP access;
\- the network has downlink signalling pending over non-3GPP access, the UE is
in 5GMM-IDLE mode over non-3GPP access and in 5GMM-IDLE or 5GMM-CONNECTED mode
over 3GPP access;
\- the UE has uplink signalling pending over 3GPP access and the UE is in
5GMM-IDLE mode over 3GPP access;
\- the network has downlink user data pending over 3GPP access and the UE is
in 5GMM-IDLE mode over 3GPP access;
\- the network has downlink user data pending over non-3GPP access, the UE is
in 5GMM-IDLE mode over non-3GPP access and in 5GMM-IDLE or 5GMM-CONNECTED mode
over 3GPP access;
\- the UE has user data pending over 3GPP access and the UE is in 5GMM-IDLE or
5GMM-CONNECTED mode over 3GPP access;
\- the UE has user data pending over non-3GPP access and the UE is in 5GMM-
CONNECTED mode over non-3GPP access;
\- the UE in 5GMM-IDLE mode over non-3GPP access, receives an indication from
the lower layers of non-3GPP access, that the access stratum connection is
established between UE and network; or
\- the UE in 5GMM-IDLE or 5GMM-CONNECTED mode over 3GPP access receives a
request for emergency services fallback from the upper layer and performs
emergency services fallback as specified in subclause 4.13.4.2 of 3GPP TS
23.502 [9].
This procedure shall not be used for initiating user data transfer or PDU
session management related signalling other than for performing UE-requested
PDU session release procedure related to a PDU session for LADN when the UE is
located outside the LADN service area.
The service request procedure is initiated by the UE, however, it can be
triggered by the network by means of:
\- the paging procedure (see subclause 5.6.2) for the transfer of downlink
signalling or user data pending over 3GPP access to a UE in 5GMM-IDLE mode
over 3GPP access;
\- the paging procedure (see subclause 5.6.2) for the transfer of downlink
signalling or user data pending over non-3GPP access to a UE in 5GMM-IDLE mode
over 3GPP access and in 5GMM-IDLE mode over non-3GPP access;
\- the notification procedure (see subclause 5.6.3) for the transfer of
downlink signalling or user data pending over non-3GPP access to a UE in 5GMM-
CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP access; or
\- the notification procedure (see subclause 5.6.3) for the transfer of
downlink signalling or user data pending over 3GPP access to a UE in 5GMM-IDLE
mode over 3GPP access and in 5GMM-CONNECTED mode over non-3GPP access.
NOTE 2: In case the UE is in 5GMM-IDLE mode over 3GPP access and in 5GMM-
CONNECTED mode over non-3GPP access and downlink signalling or user data
pending over 3GPP access needs to be transferred, the AMF can trigger either
the notification procedure or the paging procedure based on implementation.
The UE shall invoke the service request procedure when:
a) the UE, in 5GMM-IDLE mode over 3GPP access, receives a paging request from
the network;
b) the UE, in 5GMM-CONNECTED mode over 3GPP access, receives a notification
from the network with access type indicating non-3GPP access;
c) the UE, in 5GMM-IDLE mode over 3GPP access, has uplink signalling pending;
d) the UE, in 5GMM-IDLE mode over 3GPP access, has uplink user data pending;
e) the UE, in 5GMM-CONNECTED mode or in 5GMM-CONNECTED mode with RRC inactive
indication, has user data pending due to no user-plane resources established
for PDU session(s) used for user data transport;
f) the UE in 5GMM-IDLE mode over non-3GPP access, receives an indication from
the lower layers of non-3GPP access, that the access stratum connection is
established between UE and network;
g) the UE, in 5GMM-IDLE mode over 3GPP access, receives a notification from
the network with access type indicating 3GPP access when the UE is in 5GMM-
CONNECTED mode over non-3GPP access;
h) the UE, in 5GMM-IDLE, 5GMM-CONNECTED mode over 3GPP access, or 5GMM-
CONNECTED mode with RRC inactive indication, receives a request for emergency
services fallback from the upper layer and performs emergency services
fallback as specified in subclause 4.13.4.2 of 3GPP TS 23.502 [9]; or
i) the UE, in 5GMM-CONNECTED mode over 3GPP access or in 5GMM-CONNECTED mode
with RRC inactive indication, receives a fallback indication from the lower
layers (see subclauses 5.3.1.2 and 5.3.1.4) and or the UE has a pending NAS
procedure other than a registration, service request, or de-registration
procedure.
If one of the above criteria to invoke the service request procedure is
fulfilled, then the service request procedure shall only be initiated by the
UE when the following conditions are fulfilled:
\- its 5GS update status is 5U1 UPDATED, and the TAI of the current serving
cell is included in the TAI list; and
\- no 5GMM specific procedure is ongoing.
The UE shall not invoke the service request procedure when the UE is in the
state 5GMM-SERVICE-REQUEST-INITIATED.
Figure 5.6.1.1.1: Service Request procedure
A service request attempt counter is used to limit the number of service
request attempts and no response from the network. The service request attempt
counter shall be incremented as specified in subclause 5.6.1.7.
The service request attempt counter shall be reset when:
\- a registration procedure for mobility and periodic registration update is
successfully completed;
\- a service request procedure is successfully completed; or
\- a service request procedure is rejected as specified in subclause 5.6.1.5.
#### 5.6.1.2 Service request procedure initiation
The UE initiates the service request procedure by sending a SERVICE REQUEST
message to the AMF and starts timer T3517.
If the UE is sending the SERVICE REQUEST message from 5GMM-IDLE mode and the
UE needs to send non-cleartext IEs, the UE shall send the SERVICE REQUEST
message including the NAS message container IE as described in subclause
4.4.6.
For cases a), b), and g) in subclause 5.6.1.1, the service type IE in the
SERVICE REQUEST message shall be set to \"mobile terminated services\".
For cases c), d), e), f), and i) in subclause 5.6.1.1, if the UE is a UE
configured for high priority access in selected PLMN, the service type IE in
the SERVICE REQUEST message shall be set to \"high priority access\".
For case a) in subclause 5.6.1.1:
a) if the paging request includes an indication for non-3GPP access type, the
Allowed PDU session status IE shall be included in the SERVICE REQUEST
message. If the UE has established the PDU session(s) associated with the
S-NSSAI(s) which are included in the allowed NSSAI for 3GPP access, the UE
shall indicate the PDU session(s) for which the UE allows the user-plane
resources to be re-established over 3GPP access in the Allowed PDU session
status IE. Otherwise, the UE shall not indicate any PDU session(s) in the
Allowed PDU session status IE;
b) if the UE has uplink user data pending to be sent over 3GPP access, the
Uplink data status IE shall be included in the SERVICE REQUEST message to
indicate the PDU session(s) for which the UE has pending user data to be sent;
or
c) otherwise, the Uplink data status IE shall not be included in the SERVICE
REQUEST message.
For case b) in subclause 5.6.1.1:
a) the Allowed PDU session status IE shall be included in the SERVICE REQUEST
message. If the UE has the PDU session(s) associated with the S-NSSAI(s) which
are included in the allowed NSSAI for 3GPP access, the UE shall indicate the
PDU session(s) for which the UE allows the user-plane resources to be re-
established over 3GPP access in the Allowed PDU session status IE. Otherwise,
the UE shall not indicate any PDU session(s) in the Allowed PDU session status
IE;
b) if the UE has uplink user data pending to be sent over 3GPP access, the
Uplink data status IE shall be included in the SERVICE REQUEST message to
indicate the PDU session(s) for which the UE has pending user data to be sent;
c) otherwise, the Uplink data status IE shall not be included in the SERVICE
REQUEST message.
When the Allowed PDU session status IE is included in the SERVICE REQUEST
message, the UE shall indicate that a PDU session is not allowed to be
transferred to the 3GPP access if the 3GPP PS data off UE status is
\"activated\" for the corresponding PDU session and the UE is not using the
PDU session to send uplink IP packets for any of the 3GPP PS data off exempt
services (see subclause 6.2.10).
For case c) in subclause 5.6.1.1, the Uplink data status IE shall not be
included in the SERVICE REQUEST message except if the UE has one or more
active always-on PDU sessions associated with the access type over which the
SERVICE REQUEST message is sent. If the UE is not a UE configured for high
priority access in selected PLMN and:
a) if the SERVICE REQUEST message is triggered by a request for emergency
services from the upper layer, the UE shall set the service type IE in the
SERVICE REQUEST message to \"emergency services\"; or
b) otherwise, the UE shall set the service type IE to \"signalling\".
When the UE is in a non-allowed area or is not in an allowed area as specified
in subclause 5.3.5 and:
a) if the uplink signalling pending is to indicate a change of 3GPP PS data
off UE status for a PDU session, the UE shall set the service type IE in the
SERVICE REQUEST message to \"elevated signalling\", and shall not include the
Uplink data status IE in the SERVICE REQUEST message even if the UE has one or
more active always-on PDU sessions associated with the access type over which
the SERVICE REQUEST message is sent; or
b) otherwise, the UE shall not initiate service request procedure except for
emergency services, high priority access or responding to paging or
notification.
For cases d) and e) in subclause 5.6.1.1, the Uplink data status IE shall be
included in the SERVICE REQUEST message to indicate the PDU session(s) the UE
has pending user data to be sent. If the UE is not a UE configured for high
priority access in selected PLMN:
a) if there exists an emergency PDU session which is indicated in the Uplink
data status IE the service type IE in the SERVICE REQUEST message shall be set
to \"emergency services\"; or
b) otherwise, the service type IE in the SERVICE REQUEST message shall be set
to \"data\".
For case f) in subclause 5.6.1.1:
a) if the UE has uplink user data pending to be sent, the Uplink data status
IE shall be included in the SERVICE REQUEST message to indicate the PDU
session(s) the UE has pending user data to be sent. If the UE is not a UE
configured for high priority access in selected PLMN, the service type IE in
the SERVICE REQUEST message shall be set to \"data\";
b) otherwise, if the UE is not a UE configured for high priority access in
selected PLMN, the service type IE in the SERVICE REQUEST message shall be set
to \"signalling\".
For case g) in subclause 5.6.1.1, if the UE has uplink user data pending to be
sent, the Uplink data status IE shall be included in the SERVICE REQUEST
message to indicate the PDU session(s) the UE has pending user data to be
sent.
For case h) in subclause 5.6.1.1, the UE shall send a SERVICE REQUEST message
with service type set to \"emergency services fallback\".
For case i) in subclause 5.6.1.1, if the UE is not configured for high
priority access in selected PLMN, the UE shall set the Service type IE in the
SERVICE REQUEST message as follows:
a) if the pending message is an UL NAS TRANSPORT message with the Request type
IE set to \"initial emergency request\" or \"existing emergency PDU session\",
the UE shall set the Service type IE in the SERVICE REQUEST message to
\"emergency services\"; or
b) otherwise, the UE shall set the Service type IE in the SERVICE REQUEST
message to \"signalling\".
The UE shall include a valid 5G-S-TMSI in the 5G-S-TMSI IE of the SERVICE
REQUEST message.
If the UE has one or more active always-on PDU sessions associated with the
access type over which the SERVICE REQUEST message is sent and the user-plane
resources for these PDU sessions are not established, the UE shall include the
Uplink data status IE in the SERVICE REQUEST message and indicate that the UE
has pending user data to be sent for those PDU sessions.
If the UE has one or more active PDU sessions which are not accepted by the
network as always-on PDU sessions and no uplink user data pending to be sent
for those PDU sessions, the UE shall not include those PDU sessions in the
Uplink data status IE in the SERVICE REQUEST message.
The Uplink data status IE may be included in the SERVICE REQUEST message to
indicate which PDU session(s) associated with the access type the SERVICE
REQUEST message is sent over have pending user data to be sent.
The PDU session status information element may be included in the SERVICE
REQUEST message to indicate the PDU session(s) available in the UE associated
with the access type the SERVICE REQUEST message is sent over.
If the SERVICE REQUEST message includes a NAS message container IE, the AMF
shall process the SERVICE REQUEST message that is obtained from the NAS
message container IE as described in subclause 4.4.6.
If the PDU session status information element is included in the SERVICE
REQUEST message, then the AMF shall perform a local release of all those PDU
sessions which are in active on the AMF side associated with the access type
the SERVICE REQUEST message is sent over, but are indicated by the UE as being
inactive, and shall request the SMF to perform a local release of all those
PDU sessions.
If the UE has an emergency PDU session over the non-current access, it shall
not initiate the SERVICE REQUEST message with the service type IE set to
\"emergency services\" over the current access, unless the SERVICE REQUEST
message has to be initiated to perform handover of an existing emergency PDU
session from the non-current access to the current access.
NOTE: Transfer of an existing emergency PDU session between 3GPP access and
non-3GPP access is needed e.g. if the UE determines that the current access is
no longer available.
#### 5.6.1.3 Common procedure initiation
Upon receipt of the SERVICE REQUEST message, the AMF may initiate the common
procedures e.g. the 5G AKA based primary authentication and key agreement
procedure or the EAP based primary authentication and key agreement procedure.
#### 5.6.1.4 Service request procedure accepted by the network
For cases other than h) in subclause 5.6.1.1, the UE shall treat the reception
of the SERVICE ACCEPT message as successful completion of the procedure. The
UE shall reset the service request attempt counter, stop timer T3517 and enter
the state 5GMM-REGISTERED.
For case h) in subclause 5.6.1.1, the UE shall treat the indication from the
lower layers when the UE has changed to S1 mode or E-UTRA connected to 5GCN
(see 3GPP TS 23.502 [9]) as successful completion of the procedure and stop
timer T3517.
If the AMF needs to initiate PDU session status synchronization or a PDU
session status IE was included in the SERVICE REQUEST message, the AMF shall
include a PDU session status IE in the SERVICE ACCEPT message to indicate
which PDU sessions associated with the access type the SERVICE ACCEPT message
is sent over are active in the AMF. If the PDU session status information
element is included in the SERVICE ACCEPT message, then the UE shall perform a
local release of all those PDU sessions which are in active on the UE side
associated with the access type the SERVICE ACCEPT message is sent over, but
are indicated by the AMF as being inactive.
If the Uplink data status IE is included in the SERVICE REQUEST message, the
AMF shall:
a) indicate the SMF to re-establish the user-plane resources for the
corresponding PDU sessions;
b) include the PDU session reactivation result IE in the SERVICE ACCEPT
message to indicate the user-plane resources re-establishment result of the
PDU sessions for which the UE requested to re-establish the user-plane
resources; and
c) determine the UE presence in LADN service area and forward the UE presence
in LADN service area towards the SMF, if the corresponding PDU session is a
PDU session for LADN.
If the Allowed PDU session status IE is included in the SERVICE REQUEST
message, the AMF shall:
a) for a 5GSM message from each SMF that has indicated pending downlink
signalling only, forward the received 5GSM message via 3GPP access to the UE
after the SERVICE ACCEPT message is sent;
b) for each SMF that has indicated pending downlink data only:
1) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access cannot be
performed if the corresponding PDU session ID(s) are not indicated in the
Allowed PDU session status IE; and
2) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access can be performed
if the corresponding PDU session ID(s) are indicated in the Allowed PDU
session status IE.
c) for each SMF that have indicated pending downlink signalling and data:
1) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access cannot be
performed if the corresponding PDU session ID(s) are not indicated in the
Allowed PDU session status IE;
2) notify the SMF that reactivation of the user-plane resources for the
corresponding PDU session(s) associated with non-3GPP access can be performed
if the corresponding PDU session ID(s) are indicated in the Allowed PDU
session status IE; and
3) discard the received 5GSM message for PDU session(s) associated with
non-3GPP access; and
d) include the PDU session reactivation result IE in the SERVICE ACCEPT
message to indicate the successfully re-established user-plane resources for
the corresponding PDU sessions, if any.
If the PDU session reactivation result IE is included in the SERVICE ACCEPT
message indicating that the user-plane resources have been successfully
reactivated for a PDU session that was requested by the UE in the Allowed PDU
session status IE, the UE considers the corresponding PDU session to be
associated with the 3GPP access. If the user-plane resources of a PDU session
have been successfully reactivated over the 3GPP access, the AMF and SMF
update the associated access type of the corresponding PDU session.
If the AMF has included the PDU session reactivation result IE in the SERVICE
ACCEPT message and there exist one or more PDU sessions for which the user-
plane resources cannot be re-established, then the AMF may include the PDU
session reactivation result error cause IE to indicate the cause of failure to
re-establish the user-plane resources.
If the user-plane resources cannot be established for a PDU session, the AMF
shall include the PDU session reactivation result IE in the SERVICE ACCEPT
message indicating that user-plane resources for the corresponding PDU session
cannot be re-established, and shall include the PDU session reactivation
result error cause IE with the 5GMM cause set to:
a) #43 \"LADN not available\" if the user-plane resources cannot be
established because the SMF indicated to the AMF that the UE is located out of
the LADN service area (see 3GPP TS 29.502 [20A]);
b) #28 \"restricted service area\" if the user-plane resources cannot be
established because the SMF indicated to the AMF that only prioritized
services are allowed (see 3GPP TS 29.502 [20A]); or
c) #92 \"insufficient user-plane resources for the PDU session\" if the user-
plane resources cannot be established because the SMF indicated to the AMF
that the resource is not available in the UPF (see 3GPP TS 29.502 [20A]).
NOTE: It is up to UE implementation when to re-send a request for user-plane
re-establishment for the associated PDU session after receiving a PDU session
reactivation result error cause IE with a 5GMM cause set to #92 \"insufficient
user-plane resources for the PDU session\".
If the SERVICE REQUEST message is for emergency services fallback, the AMF
triggers the emergency services fallback procedure as specified in subclause
4.13.4.2 of 3GPP TS 23.502 [9].
#### 5.6.1.5 Service request procedure not accepted by the network
If the service request cannot be accepted, the network shall return a SERVICE
REJECT message to the UE including an appropriate 5GMM cause value and stop
timer T3517.
If the AMF needs to initiate PDU session status synchronisation or a PDU
session status IE was included in the SERVICE REQUEST message, the AMF shall
include a PDU session status IE in the SERVICE REJECT message to indicate
which PDU sessions associated with the access type the SERVICE REJECT message
is sent over are active in the AMF. If the PDU session status IE is included
in the SERVICE REJECT message and if the message is integrity protected, then
the UE shall perform a local release of all those PDU sessions which are
active on the UE side associated with the access type the SERVICE REJECT
message is sent over, but are indicated by the AMF as being inactive.
If the service request for mobile originated services is rejected due to
general NAS level mobility management congestion control, the network shall
set the 5GMM cause value to #22 \"congestion\" and assign a value for back-off
timer T3346.
If the AMF determines that the UE is in a non-allowed area or is not in an
allowed area as specified in subclause 5.3.5, then:
a) if the service type IE in the SERVICE REQUEST message is set to
\"signalling\" or \"data\", the AMF shall send a SERVICE REJECT message with
the 5GMM cause value set to #28 \"Restricted service area\";
b) otherwise, if the service type IE in the SERVICE REQUEST message is set to
\"mobile terminated services\", \"emergency services\", \"emergency services
fallback\", \"high priority access\" or \"elevated signalling\", the AMF shall
continue the process as specified in subclause 5.6.1.4 unless for other
reasons the service request cannot be accepted.
On receipt of the SERVICE REJECT message, if the UE is in state 5GMM-SERVICE-
REQUEST-INITIATED and the message is integrity protected, the UE shall reset
the service request attempt counter and stop timer T3517 if running.
The UE shall take the following actions depending on the 5GMM cause value
received in the SERVICE REJECT message.
#3 (Illegal UE);
#6 (Illegal ME);
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall enter the state 5GMM-DEREGISTERED.
If the UE is operating in the single-registration mode, the UE shall handle
the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the service request
procedure is rejected with the EMM cause with the same value. The USIM shall
be considered as invalid also for non-EPS services until switching off or the
UICC containing the USIM is removed.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
#7 (5GS services not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall consider the USIM as
invalid for 5GS services until switching off or the UICC containing the USIM
is removed. The UE shall enter the state 5GMM-DEREGISTERED.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the service request
procedure is rejected with the EMM cause with the same value.
If the UE also supports the registration procedure over the other access, the
UE shall in addition handle 5GMM parameters and 5GMM state for this access, as
described for this 5GMM cause value.
NOTE 1: The possibility to configure a UE so that the radio transceiver for a
specific radio access technology is not active, although it is implemented in
the UE, is out of scope of the present specification.
#9 (UE identity cannot be derived by the network).
The UE shall set the 5GS update status to 5U2 NOT UPDATED (and shall store it
according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last visited
registered TAI, TAI list and ngKSI. The UE shall enter the state 5GMM-
DEREGISTERED.
If the service request was initiated for emergency services fallback, the UE
shall attempt to select an E-UTRA cell connected to EPC or 5GCN according to
the domain priority and selection rules specified in 3GPP TS 23.167 [6]. If
the UE finds a suitable E-UTRA cell, it then proceeds with the appropriate EMM
or 5GMM procedures.
If the service request was initiated for any reason other than emergency
services fallback or initiating an emergency PDU session, the UE shall perform
a new initial registration procedure.
NOTE 2: User interaction is necessary in some cases when the UE cannot re-
establish the PDU session(s) automatically.
If the UE is operating in the single-registration mode, the UE shall handle
the EMM parameters EMM state, EPS update status, 4G-GUTI, last visited
registered TAI, TAI list and eKSI as specified in 3GPP TS 24.301 [15] for the
case when the service request procedure is rejected with the EMM cause with
the same value.
If the UE also supports the registration procedure over the other access to
the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state
for this access, as described for this 5GMM cause value.
#10 (Implicitly de-registered).
The UE shall enter the state 5GMM-DEREGISTERED.NORMAL-SERVICE. The UE shall
delete any mapped 5G NAS security context or partial native 5G NAS security
context.
If the rejected request was not for initiating an emergency PDU session, the
UE shall perform a new initial registration procedure.
NOTE 3: User interaction is necessary in some cases when the UE cannot re-
establish the PDU session(s) automatically.
If the UE is operating in the single-registration mode, the UE shall handle
the EMM state as specified in 3GPP TS 24.301 [15] for the case when the
service request procedure is rejected with the EMM cause with the same value.
#11 (PLMN not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI. The UE shall delete the list of
equivalent PLMNs and store the PLMN identity in the \"forbidden PLMN list\".
The UE shall enter the state 5GMM-DEREGISTERED and perform a PLMN selection
according to 3GPP TS 23.122 [5].
If the UE is operating in single-registration mode, the UE shall in addition
handle the EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and
eKSI as specified in 3GPP TS 24.301 [15] for the case when the service request
procedure is rejected with the EMM cause with the same value.
If the UE also supports the registration procedure over the other access to
the same PLMN, the UE shall in addition handle 5GMM parameters and 5GMM state
for this access, as described for this 5GMM cause value.
#12 (Tracking area not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last
visited registered TAI, TAI list and ngKSI.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for regional provision of service\" and enter the state 5GMM-
DEREGISTERED.LIMITED-SERVICE.
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state, EPS update status, 4G-GUTI, TAI list and eKSI as
specified in 3GPP TS 24.301 [15] for the case when the service request
procedure is rejected with the EMM cause with the same value.
#13 (Roaming not allowed in this tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2). The UE shall enter the state 5GMM-
REGISTERED.PLMN-SEARCH.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\" and remove the current TAI from the stored TAI list if
present.
The UE shall perform a PLMN selection according to 3GPP TS 23.122 [5].
If the UE is operating in single-registration mode, the UE shall handle the
EMM parameters EMM state and EPS update status as specified in 3GPP TS 24.301
[15] for the case when the service request procedure is rejected with the EMM
cause with the same value.
#15 (No suitable cells in tracking area).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2). The UE shall enter the state 5GMM-
REGISTERED.LIMITED-SERVICE.
The UE shall store the current TAI in the list of \"5GS forbidden tracking
areas for roaming\" and remove the current TAI from the stored TAI list if
present.
If the UE initiated service request for emergency services fallback, the UE
shall attempt to select an E-UTRA cell connected to EPC or 5GC according to
the emergency services support indicator. If the UE finds a suitable E-UTRA
cell, it then proceeds with the appropriate EMM or 5GMM procedures.
If the service request was not initiated for emergency services fallback, the
UE shall search for a suitable cell in another tracking area according to 3GPP
TS 38.304 [28].
If the UE is operating in the single-registration mode, the UE shall handle
the EMM parameters EMM state and EPS update status as specified in 3GPP TS
24.301 [15] for the case when the service request procedure is rejected with
the EMM cause with the same value.
#22 (Congestion).
If the T3346 value IE is present in the SERVICE REJECT message and the value
indicates that this timer is neither zero nor deactivated, the UE shall
proceed as described below, otherwise it shall be considered as an abnormal
case and the behaviour of the UE for this case is specified in subclause
5.6.1.7.
If the rejected request was not for initiating an emergency PDU session, the
UE shall abort the service request procedure and enter state 5GMM-REGISTERED,
and stop timer T3517 if still running.
The UE shall stop timer T3346 if it is running.
If the SERVICE REJECT message is integrity protected, the UE shall start timer
T3346 with the value provided in the T3346 value IE.
If the SERVICE REJECT message is not integrity protected, the UE shall start
timer T3346 with a random value from the default range specified in 3GPP TS
24.008 [12].
For all other cases the UE stays in the current serving cell and applies
normal cell reselection process. The service request procedure is started, if
still necessary, when timer T3346 expires or is stopped.
If the UE is operating in the single-registration mode, the UE shall handle
the EMM parameters EMM state and EPS update status as specified in 3GPP TS
24.301 [15] for the case when the service request procedure is rejected with
the EMM cause with the same value.
#27 (N1 mode not allowed).
The UE shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall
store it according to subclause 5.1.3.2.2) and shall delete any 5G-GUTI, last
visited registered TAI, TAI list and ngKSI and shall enter the state 5GMM-
NULL.
The UE shall disable the N1 mode capability for both 3GPP access and non-3GPP
access (see subclause 4.9).
#28 (Restricted service area).
The UE shall enter the state 5GMM-REGISTERED.NON-ALLOWED-SERVICE, and perform
the registration procedure for mobility and periodic registration update
unless the service type IE in the SERVICE REQUEST message was set to
\"elevated signalling\" (see subclause 5.3.5 and 5.5.1.3).
If the service type IE in the SERVICE REQUEST message was set to \"elevated
signalling\", the UE shall not re-initiate service request procedure until the
UE enters an allowed area or leaves a non-allowed area, except for emergency
services, high priority access or responding to paging or notification.
#72 (Non-3GPP access to 5GCN not allowed).
If the UE initiated the service request procedure over non-3GPP access, the UE
shall set the 5GS update status to 5U3 ROAMING NOT ALLOWED (and shall store it
according to subclause 5.1.3.2.2) and shall delete 5G-GUTI, last visited
registered TAI, TAI list and ngKSI for non-3GPP access. Additionally, the UE
shall reset the registration attempt counter and enter the state 5GMM-
DEREGISTERED for non-3GPP access.
NOTE 4: The 5GMM sublayer states, the 5GMM parameters and the registration
status are managed per access type independently, i.e. 3GPP access or non-3GPP
access (see subclauses 4.7.2 and 5.1.3).
The UE shall disable the N1 mode capability for non-3GPP access (see subclause
4.9.3).
As an implementation option, if the UE is not currently registered over 3GPP
access, the UE may enter the state 5GMM-DEREGISTERED.PLMN-SEARCH in order to
perform a PLMN selection according to 3GPP TS 23.122 [5].
If received over 3GPP access the cause shall be considered as an abnormal case
and the behaviour of the UE for this case is specified in subclause 5.6.1.7.
#73 (Serving network not authorized).
The UE shall set the 5GS update status to 5U2 NOT UPDATED, store the PLMN
identity in the \"forbidden PLMN list\" and enter state 5GMM-
DEREGISTERED.PLMN-SEARCH in order to perform a PLMN selection according to
3GPP TS 23.122 [5].
#### 5.6.1.6 Service request procedure for initiating an emergency PDU session
not accepted by the network
If the service request for initiating an emergency PDU session cannot be
accepted by the network, the UE shall perform the procedures as described in
subclause 5.6.1.5. Then if the UE is in the same selected PLMN where the last
service request was attempted, the UE shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 1: This can result in the upper layers requesting another emergency call
attempt using domain selection as specified in 3GPP TS 23.167 [6].
b) de-register locally, if not de-registered already, attempt initial
registration for emergency services.
If the service request for initiating an emergency PDU session fails due to
abnormal cases a) in subclause 5.6.1.7, the UE shall perform the procedures as
described in subclause 5.6.1.5. Then if the UE is in the same selected PLMN
where the last SERVICE REQUEST message was attempted, the UE shall:
a) inform the upper layers of the failure of the procedure; or
NOTE 2: This can result in the upper layers requesting another emergency call
attempt using domain selection as specified in 3GPP TS 23.167 [6] and 3GPP TS
24.229 [14].
b) de-register locally, if not de-registered already, attempt initial
registration for emergency services.
#### 5.6.1.7 Abnormal cases in the UE
The following abnormal cases can be identified:
a) T3517 expired.
The UE shall enter the state 5GMM-REGISTERED.
If the UE triggered the service request procedure in 5GMM-IDLE mode and the
service type of the SERVICE REQUEST message was not set to \"emergency
services fallback\", then the 5GMM sublayer shall increment the service
request attempt counter, abort the procedure and release locally any resources
allocated for the service request procedure. The service request attempt
counter shall not be incremented, if:
1) the service request procedure is initiated to establish an emergency PDU
session;
2) the UE has an emergency PDU session established;
3) the UE is a UE configured for high priority access in selected PLMN; or
4) the service request is initiated in response to paging or notification from
the network.
If the service request attempt counter is greater than or equal to 5, the UE
shall start timer T3525. Additionally, if the service request was initiated
for an MO MMTEL voice call, a notification that the service request was not
accepted due to the UE having started timer T3525 shall be provided to the
upper layers.
NOTE 1: This can result in the upper layers requesting implementation specific
mechanisms, e.g. the MMTEL voice call being attempted to another IP-CAN, or
establishment of a CS voice call (if supported and not already attempted in
the CS domain).
The UE shall not attempt service request until expiry of timer T3525 unless:
1) the service request is initiated in response to paging or notification from
the network;
2 the UE is a UE configured for high priority access in selected PLMN;
3) the service request is initiated to establish an emergency PDU session;
4) the UE has an emergency PDU session established; or
5) the UE is registered in a new PLMN.
NOTE 2: The NAS signalling connection can also be released if the UE deems
that the network has failed the authentication check as specified in subclause
5.4.1.3.7.
If the UE triggered the service request procedure in 5MM-CONNECTED mode and
the service type of the SERVICE REQUEST message was not set to \"emergency
services fallback\", the 5GMM sublayer shall abort the procedure, and stay in
5GMM-CONNECTED mode.
If the service type of the SERVICE REQUEST message was set to \"emergency
services fallback\" and:
1) the service request procedure was triggered in 5GMM-IDLE mode, the 5GMM
sublayer shall abort the procedure, release locally any resources allocated
for the service request procedure, and inform the upper layers of the failure
of the service request procedure (see 3GPP TS 24.229 [14]); or
2) the service request procedure was triggered in 5GMM-CONNECTED mode, the
5GMM sublayer shall abort the procedure, stay in 5GMM-CONNECTED mode, and
inform the upper layers of the failure of the service request procedure (see
3GPP TS 24.229 [14]).
b) The lower layers indicate that the access attempt is barred.
The UE shall not start the service request procedure. The UE stays in the
current serving cell and applies the normal cell reselection process.
The service request procedure is started, if still needed, when the lower
layers indicate that the barring is alleviated for the access category with
which the access attempt was associated.
ba) The lower layers indicate that access barring is applicable for all access
categories except categories 0 and 2 and the access category with which the
access attempt was associated is other than 0 and 2.
If the SERVICE REQUEST message has not been sent, the UE shall proceed as
specified for case b.
If the SERVICE REQUEST message has been sent:
1) the UE shall abort the service request procedure and stop timer T3517. The
UE stays in the current serving cell and applies the normal cell reselection
process; and
2) the service request procedure is started, if still needed, when the lower
layers indicate that the barring is alleviated for the access category with
which the access attempt was associated.
For additional UE requirements for both cases see subclause 4.5.5.
c) Timer T3346 is running.
The UE shall not start the service request procedure unless:
1) the UE receives a paging;
2) the UE receives a NOTIFICATION message over non-3GPP access when the UE is
in 5GMM-CONNECTED mode over non-3GPP access and in 5GMM-IDLE mode over 3GPP
access;
3) the UE receives a NOTIFICATION message over 3GPP access when the UE is in
5GMM-CONNECTED mode over 3GPP access and in 5GMM-IDLE mode over non-3GPP
access;
4) the UE is a UE configured for high priority access in selected PLMN;
5) the UE has an emergency PDU session established or is establishing an
emergency PDU session; or
6) the service request is initiated for emergency services fallback.
If the UE is in 5GMM-IDLE mode, the UE stays in the current serving cell and
applies normal cell reselection process. The service request procedure is
started, if still necessary, when timer T3346 expires or is stopped.
d) Registration procedure for mobility and periodic registration update is
triggered.
The UE shall abort the service request procedure, stop timer T3517, if running
and perform the registration procedure for mobility and periodic registration
update. The Follow-on request indicator shall be set to 1 in the REGISTRATION
REQUEST message.
e) Switch off.
If the UE is in state 5GMM-SERVICE-REQUEST-INITIATED at switch off, the de-
registration procedure shall be performed.
f) De-registration procedure collision.
If the UE receives a DEREGISTRATION REQUEST message from the network in state
5GMM-SERVICE-REQUEST-INITIATED, the UE shall progress the DEREGISTRATION
REQUEST message and the service request procedure shall be aborted.
g) Transmission failure of SERVICE REQUEST message indication with TAI change
from lower layers.
If the current TAI is not in the TAI list, UE shall abort the service request
procedure to perform the registration procedure for mobility and periodic
registration update and shall include Uplink data status IE in the
REGISTRATION REQUEST message. If the current TAI is part of the TAI list, the
UE shall restart the service request procedure.
h) Transmission failure of SERVICE REQUEST message indication without TAI
change from lower layers.
The UE shall restart the service request procedure.
i) SERVICE REJECT message received with other 5GMM cause values than those
treated in subclause 5.6.1.5, and cases of 5GMM cause value #22 and #72 that
are considered as abnormal cases according to subclause 5.6.1.5.
The UE shall enter state 5GMM-REGISTERED.
The UE shall abort the service request procedure, stop timer T3517 and locally
release any resources allocated for the service request procedure.
#### 5.6.1.8 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Lower layer failure.
If a lower layer failure occurs before a SERVICE REJECT message has been sent
to the UE or the service request procedure has been completed by the AMF, the
AMF enters/stays in 5GMM-IDLE.
b) Protocol error.
If the SERVICE REQUEST message is received with a protocol error, the AMF
shall return a SERVICE REJECT message with one of the following 5GMM cause
values:
#96 invalid mandatory information;
#99 information element non-existent or not implemented;
#100 conditional IE error; or
#111 protocol error, unspecified.
The AMF stays in the current 5GMM mode.
c) More than one SERVICE REQUEST message received before the procedure has
been completed (i.e., before SERVICE REJECT message has been sent or service
request procedure has been completed).
\- If one or more of the information elements in the SERVICE REQUEST message
differs from the ones received within the previous SERVICE REQUEST message,
the previously initiated service request procedure shall be aborted and the
new service request procedure shall be progressed;
\- If the information elements do not differ, then the AMF shall continue with
the previous service request procedure and shall not treat any further this
SERVICE REQUEST message.
d) REGISTRATION REQUEST message received with \"initial registration\" or
\"emergency registration\" in the 5GS registration type IE before a SERVICE
REJECT message has been sent or the service request procedure has been
completed.
If a REGISTRATION REQUEST message with \"initial registration\" or \"emergency
registration\" in the 5GS registration type IE is received and the service
request procedure has not been completed or a SERVICE REJECT message has not
been sent, the AMF may initiate the 5GMM common procedures, e.g. the primary
authentication and key agreement procedure. The AMF may e.g. after a
successful primary authentication and key agreement procedure execution, abort
the service request procedure, delete the 5GMM context, indicate towards the
SMF that the 5GMM context has been deleted and progress the new REGISTRATION
REQUEST message.
e) REGISTRATION REQUEST message received with \"mobility registration
updating\" or \"periodic registration updating\" in the 5GS registration type
IE received before the service request procedure has been completed or a
SERVICE REJECT message has been sent.
If a REGISTRATION REQUEST message with \"mobility registration updating\" or
\"periodic registration updating\" in the 5GS registration type IE is received
and the service request procedure has not been completed or a SERVICE REJECT
message has not been sent, the AMF may initiate the 5GMM common procedures,
e.g. the primary authentication and key agreement procedure. The AMF may e.g.
after a successful primary authentication and key agreement procedure
execution, abort the service request procedure and progress the new
REGISTRATION REQUEST message.
### 5.6.2 Paging procedure
#### 5.6.2.1 General
The paging procedure is performed only in 3GPP access and used by the network
to request the establishment of a NAS signalling connection to the UE. The
paging procedure is also used by the network to request the UE to re-establish
the user-plane resources of PDU sessions for downlink user data transport.
Another purpose of the paging procedure is to request the UE to re-establish
the user-plane resources of PDU session(s) associated with non-3GPP access
over 3GPP access.
Additionally, the network can use the paging procedure to initiate the mobile
terminating SMS.
#### 5.6.2.2 Paging for 5GS services
##### 5.6.2.2.1 General
The network shall initiate the paging procedure for 5GS services when NAS
signalling messages or user data is pending to be sent to the UE in 5GMM-IDLE
mode over 3GPP access (see example in figure 5.6.2.2.1.1).
Figure 5.6.2.2.1.1: Paging procedure
To initiate the procedure the 5GMM entity in the AMF requests the lower layer
to start paging and shall start timer T3513.
If downlink signalling or user data is pending to be sent over non-3GPP
access, the 5GMM entity in the AMF shall indicate to the lower layer that the
paging is associated to non-3GPP access.
Upon reception of a paging indication, the UE shall stop the timer T3346, if
running, and shall initiate:
\- a service request procedure over 3GPP access to respond to the paging as
specified in subclauses 5.6.1; or
\- a registration procedure for mobility and periodic registration update over
3GPP access to respond to the paging as specified in subclauses 5.5.1.3.
The network shall stop timer T3513 for the paging procedure when an integrity-
protected response is received from the UE and successfully integrity checked
by the network. If the response received is not integrity protected, or the
integrity check is unsuccessful, timer T3513 for the paging procedure shall be
kept running.
Upon expiry of timer T3513, the network may reinitiate paging.
If the network, while waiting for a response to the paging sent without paging
priority, receives downlink signalling or downlink data associated with
priority user-plane resources for PDU sessions, the network shall stop timer
T3513, and then initiate the paging procedure with paging priority.
##### 5.6.2.2.2 Abnormal cases on the network side
The following abnormal case can be identified:
a) Void.
##### 5.6.2.2.3 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Paging message received with access type set to non-3GPP access while the
UE is in 5GMM-CONNECTED mode over non-3GPP access.
The UE shall not respond to paging message.
b) Paging message received with access type set to 3GPP access when UE-
initiated 5GMM specific procedure or service request procedure is ongoging.
The UE shall ignore the paging.
### 5.6.3 Notification procedure
#### 5.6.3.1 General
The notification procedure is used by the network:
a) to request the UE, by sending the NOTIFICATION message over 3GPP access, to
re-establish the user-plane resources of PDU session(s) associated with
non-3GPP access over 3GPP access or to deliver 5GSM downlink signalling
messages associated with non-3GPP access over 3GPP access when the UE is in
5GMM-IDLE mode over non-3GPP access and in 5GMM-CONNECTED mode over 3GPP
access; or
b) to request the UE, by sending the NOTIFICATION message over non-3GPP
access, to re-establish user-plane resources of the PDU session(s) or to
deliver downlink signalling associated with 3GPP access over 3GPP access when
the UE is in 5GMM-CONNECTED mode over non-3GPP access and in 5GMM-IDLE mode
over 3GPP access when the UE is not in MICO mode.
#### 5.6.3.2 Notification procedure initiation
The network shall initiate the notification procedure by sending the
NOTIFICATION message to the UE and start timer T3565 (see example in figure
5.6.3.2.1).
For case a) in subclause 5.6.3.1, the NOTIFICATION message is sent from the
network to the UE via 3GPP access with access type indicating non-3GPP access.
For case b) in subclause 5.6.3.1, the NOTIFICATION message is sent from the
network to the UE via non-3GPP access with access type indicating 3GPP access
when the UE is not in MICO mode.
Figure 5.6.3.2.1: Notification procedure
For case a) in subclause 5.6.3.1, upon reception of NOTIFICATION message, the
UE shall initiate a service request procedure over 3GPP access as specified in
subclauses 5.6.1.
For case b) in subclause 5.6.3.1, upon reception of NOTIFICATION message:
a) if the UE is in 5GMM-REGISTERED.NORMAL-SERVICE state, the UE shall initiate
a service request procedure over 3GPP access as specified in subclauses 5.6.1;
b) if the UE is in 5GMM-REGISTERED.ATTEMPTING-REGISTRATION-UPDATE state, the
UE shall initiate a registration procedure for mobility and periodic
registration update over 3GPP access as specified in subclauses 5.5.1.3; or
c) if the UE is in 5GMM-REGISTERED.NO-CELL-AVAILABLE state or 5GMM-
REGISTERED.PLMN-SEARCH state, the UE shall respond with NOTIFICATION RESPONSE
message indicating failure to re-establish the user-plane resources of PDU
sessions and may include the PDU session status information element to
indicate the PDU session(s) available in the UE associated with the 3GPP
access type.
Upon reception of NOTIFICATION message:
For case b) in subclause 5.6.3.1, if the UE is in 5GMM-REGISTERED.NO-CELL-
AVAILABLE state or 5GMM-REGISTERED.PLMN-SEARCH state and a local release was
performed in the UE for the PDU sessions associated with the 3GPP access;
then the UE shall respond with NOTIFICATION RESPONSE message indicating with
the PDU session status information element that the local release of its PDU
sessions was performed.
Upon reception of a NOTIFICATION message, the UE shall stop the timer T3346,
if running.
#### 5.6.3.3 Notification procedure completion
Upon reception of SERVICE REQUEST message or REGISTRATION REQUEST message, the
AMF shall stop T3565 and proceed service request procedure as specified in
subclauses 5.6.3.1 or registration procedure for mobility and periodic
registration update as specified in subclauses 5.5.1.3. If no user-plane
resources of PDU session(s) need to be re-established, the AMF should notify
the SMF that the UE was reachable but did not accept to re-establish the user-
plane resources of PDU session(s).
Upon reception of NOTIFICATION RESPONSE message, the AMF shall stop timer
T3565 and should notify the SMF that the UE is unreachable.
If the NOTIFICATION RESPONSE message includes the PDU session status
information element, then the AMF shall perform a local release of all those
PDU sessions which are active on the AMF side associated with 3GPP access, but
are indicated by the UE in the PDU session status information element in the
NOTIFICATION RESPONSE message as being inactive, and shall request the SMF to
perform a local release of all those PDU sessions.
#### 5.6.3.4 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Expiry of timer T3565.
The network shall, on the first expiry of the timer T3565, retransmit the
NOTIFICATION message and shall reset and start timer T3565. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3565, the procedure shall be aborted. In addition, upon the fifth expiry of
timer T3565:
For case a) in subclause 5.6.3.1, the AMF should notify the SMF that the UE is
unreachable. The AMF may enter 5GMM-IDLE mode over 3GPP access.
For case b) in subclause 5.6.3.1, the AMF may either:
1) perform the paging procedure over the 3GPP access; or
2) notify the SMF that the UE is unreachable.
NOTE: Whether the AMF performs the paging procedure or notifies the SMF is up
to operator\'s policies.
#### 5.6.3.5 Abnormal cases on the UE side
The following abnormal cases can be identified:
a) NOTIFICATION message received via non-3GPP access with access type
indicating 3GPP access when UE-initiated 5GMM specific procedure or service
request procedure over 3GPP access is ongoging.
The UE shall ignore the NOTIFICATION message.
# 6 Elementary procedures for 5GS session management
## 6.1 Overview
### 6.1.1 General
This clause describes the procedures used for 5GS session management (5GSM)
performed over an N1 NAS signalling connection.
The main function of the 5GSM sublayer is to support the PDU session handling
in the UE and in the SMF (transferred via the AMF).
The 5GSM comprises procedures for:
\- the authentication and authorization, establishment, modification and
release of PDU sessions; and
\- request for performing handover of an existing PDU session between 3GPP
access and non-3GPP access, or to transfer an existing PDN connection in the
EPS to the 5GS.
Each PDU session represents a PDU session established between the UE and an
SMF. PDU sessions can remain established even if the radio and network
resources constituting the corresponding PDU session between the UE and the
SMF are temporarily released.
5GSM procedures can be performed only if a 5GMM context has been established
between the UE and the AMF, and the secure exchange of NAS messages has been
initiated by the AMF by use of the 5GMM procedures described in clause 5. Once
the UE is successfully registered to a PLMN, a PDU session can be established.
If no 5GMM context has been established, the 5GMM sublayer has to initiate the
establishment of a 5GMM context by use of the 5GMM procedures as described in
clause 5.
The UE can request the network to modify or release PDU sessions. The network
can fulfil such a request from the UE by modifying a PDU session or releasing
a PDU session using network-requested procedures (see subclause 6.3).
### 6.1.2 Types of 5GSM procedures
Three types of 5GSM procedures can be distinguished:
a) Procedures related to PDU sessions:
These procedures are initiated by the network and are used for authentication
and authorization or manipulation of PDU sessions:
1) PDU authentication and authorization;
2) network-initiated PDU session modification; and
3) network-initiated PDU session release.
This procedure is initiated by the UE and to request for establishment of PDU
sessions or to perform handover of an existing PDU session between 3GPP access
and non-3GPP access, or to transfer an existing PDN connection in the EPS to
the 5GS:
UE-requested PDU session establishment.
b) Transaction related procedures:
These procedures are initiated by the UE to request for handling of PDU
sessions, i.e. to modify a PDU session, or to release a PDU session:
1) UE-requested PDU session modification; and
2) UE-requested PDU session release.
A successful transaction related procedure initiated by the UE triggers the
network to execute one of the following procedures related to PDU session;
network-initiated PDU session modification procedure or network-initiated PDU
session release procedure. The UE treats the start of the procedure related to
the PDU session as completion of the transaction related procedure.
c) Common procedure:
The following 5GSM procedure can be related to a PDU session or to a procedure
transaction:
5GSM status procedure.
### 6.1.3 5GSM sublayer states
#### 6.1.3.1 General
In the following subclauses, the possible states of a PDU session in the UE
and the network side are described.
#### 6.1.3.2 5GSM sublayer states in the UE
##### 6.1.3.2.1 Overview
In the following subclauses, the possible 5GSM sublayer states of the UE are
described and shown in figure 6.1.3.2.1.1.
NOTE: Not all possible transitions are shown in this figure.
Figure 6.1.3.2.1.1: The 5GSM sublayer states for PDU session handling in the
UE (overview)
##### 6.1.3.2.2 PDU SESSION INACTIVE
No PDU session exists.
##### 6.1.3.2.3 PDU SESSION ACTIVE PENDING
The UE has initiated a PDU session establishment procedure towards the network
and is waiting for a response from the network.
##### 6.1.3.2.4 PDU SESSION ACTIVE
The PDU session is active in the UE.
##### 6.1.3.2.5 PDU SESSION INACTIVE PENDING
The UE has initiated a PDU session release procedure towards the network and
is waiting for a response from the network.
##### 6.1.3.2.6 PDU SESSION MODIFICATION PENDING
The UE has initiated a PDU session modification procedure towards the network
and is waiting for a response from the network.
##### 6.1.3.2.7 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
##### 6.1.3.2.8 PROCEDURE TRANSACTION PENDING
The UE has initiated a procedure transaction towards the network.
Figure 6.1.3.2.8.1: The procedure transaction states in the UE (overview)
#### 6.1.3.3 5GSM sublayer states in the network side
##### 6.1.3.3.1 Overview
In the following subclauses, the possible 5GSM sublayer states of the network
are described and shown in Figure 6.1.3.3.1.1.
NOTE: Not all possible transitions are shown in this figure.
Figure 6.1.3.3.1.1: The 5GSM sublayer states for PDU session handling in the
network (overview)
##### 6.1.3.3.2 PDU SESSION INACTIVE
No PDU session exists.
##### 6.1.3.3.3 PDU SESSION ACTIVE
The PDU session is active in the network.
##### 6.1.3.3.4 PDU SESSION INACTIVE PENDING
The network has initiated a PDU session release procedure towards the UE and
is waiting for a response from the UE.
##### 6.1.3.3.5 PDU SESSION MODIFICATION PENDING
The network has initiated a PDU session modification procedure towards the UE
and is waiting for a response from the UE.
##### 6.1.3.3.6 PROCEDURE TRANSACTION INACTIVE
No procedure transaction exists.
##### 6.1.3.3.7 PROCEDURE TRANSACTION PENDING
The network has initiated a procedure transaction towards the UE.
Figure 6.1.3.3.7.1: The procedure transaction states in the network (overview)
### 6.1.4 Coordination between 5GSM and ESM
#### 6.1.4.1 Coordination between 5GSM and ESM with N26 interface
Interworking with EPS is supported for a PDU session, if the PDU session
includes the mapped EPS bearer(s) or has association(s) between QoS flow and
mapped EPS bearer after inter-system change from S1 mode to N1 mode. The SMF
shall not include any mapped EPS bearer contexts associated with a PDU session
for LADN and with a PDU session which is a multi-homed IPv6 PDU session. See
coding of the Mapped EPS bearer contexts IE in subclause 9.11.4.8.
Upon inter-system change from N1 mode to S1 mode, the UE shall create the
default EPS bearer context and the dedicated EPS bearer context(s) based on
the parameters of the mapped EPS bearer contexts or the associations between
QoS flow and mapped EPS bearer in the PDU session, if available. The EPS
bearer identity assigned for the QoS flow of the default QoS rule becomes the
EPS bearer identity of the default bearer in the corresponding PDN connection.
If there is no EPS bearer identity assigned to the QoS flow of the default QoS
rule, the UE shall perform a local release of the PDU session. If there is no
EPS bearer identity assigned to the QoS flow(s) which is not associated with
the default QoS rule, the UE shall locally delete the QoS rules and the QoS
flow description(s). The UE uses the parameters from each PDU session for
which interworking with EPS is supported to create corresponding default EPS
bearer context and optionally dedicated EPS bearer context(s) as follows:
a) the PDU session type of the PDU session shall be mapped to the PDN type of
the default EPS bearer context as follows:
1) the PDN type shall be set to \"non-IP\" if the PDU session type is
\"Ethernet\" or \"Unstructured\";
2) the PDN type shall be set to \"IPv4\" if the PDU session type is \"IPv4\";
3) the PDN type shall be set to \"IPv6\" if the PDU session type is \"IPv6\";
and
4) the PDN type shall be set to \"IPv4v6\" if the PDU session type is
\"IPv4v6\";
b) the PDU address of the PDU session shall be mapped to the PDN address of
the default EPS bearer context as follows:
1) the PDN address of the default EPS bearer context is set to the PDU address
of the PDU session, if the PDU session type is \"IPv4\", \"IPv6\" or
\"IPv4v6\"; and
2) the PDN address of the default EPS bearer context is set to zero, if the
PDU session type is \"Ethernet\" or \"Unstructured\";
c) the DNN of the PDU session shall be mapped to the APN of the default EPS
bearer context;
d) the APN-AMBR and extended APN-AMBR received in the parameters of the
default EPS bearer context of the mapped EPS bearer contexts shall be mapped
to the APN-AMBR and extended APN-AMBR of the default EPS bearer context;
e) for each PDU session in state PDU SESSION ACTIVE, PDU SESSION MODIFICATION
PENDING or PDU SESSION INACTIVE PENDING the UE shall set the state of the
mapped EPS bearer context(s) to BEARER CONTEXT ACTIVE; and
f) for any other PDU session the UE shall set the state of the mapped EPS
bearer context(s) to BEARER CONTEXT INACTIVE.
Additionally, for each mapped EPS bearer context or the association between
QoS flow and mapped EPS bearer in the PDU session:
a) the EPS bearer identity shall be set to the EPS bearer identity received in
the mapped EPS bearer context, or the EPS bearer identity associated with the
QoS flow;
b) the EPS QoS parameters shall be set to the mapped EPS QoS parameters of the
EPS bearer received in the mapped EPS bearer context, or the EPS QoS
parameters associated with the QoS flow;
c) the extended EPS QoS parameters shall be set to the mapped extended EPS QoS
parameters of the EPS bearer received in the mapped EPS bearer context, or the
extended EPS QoS parameters associated with the QoS flow; and
d) the traffic flow template shall be set to the mapped traffic flow template
of the EPS bearer received in the mapped EPS bearer context, or the stored
traffic flow template associated with the QoS flow, if available.
After inter-system change from N1 mode to S1 mode, the UE shall associate the
PDU session identity, the S-NSSAI, and the session-AMBR with the default EPS
bearer context, and for each EPS bearer context mapped from one or more QoS
flows, associate the QoS rule(s) for the QoS flow(s) and the QoS flow
description(s) for the QoS flow(s) with the EPS bearer context.
After inter-system change from N1 mode to S1 mode, the UE and the SMF shall
maintain the PDU session type of the PDU session until the PDN connection
corresponding to the PDU session is released if the UE supports non-IP PDN
type and the PDU session type is \"Ethernet\" or \"Unstructured\".
After inter-system change from N1 mode to S1 mode, the UE and the SMF shall
maintain the following 5GSM attributions and capabilities associated with the
PDU session until the PDN connection corresponding to the PDU session is
released:
\- the always-on PDU session indication;
\- the maximum number of supported packet filters;
\- the support of reflective QoS;
\- the maximum data rate per UE for user-plane integrity protection supported
by the UE for uplink and the maximum data rate per UE for user-plane integrity
protection supported by the UE for downlink; and
\- the support of multi-homed IPv6 PDU session.
If there is a QoS flow used for IMS signalling, after inter-system change from
N1 mode to S1 mode, the EPS bearer associated with the QoS flow for IMS
signalling becomes the EPS bearer for IMS signalling.
When the UE is provided with a new session-AMBR in the Protocol configuration
options IE or Extended protocol configuration options IE in the MODIFY EPS
BEARER CONTEXT REQUEST message, the UE shall discard the corresponding
association(s) and associate the new value(s) with the EPS bearer context.
When the UE is provided with one or more QoS flow descriptions or the EPS
bearer identity of an existing QoS flow description is modified in the
Protocol configuration options IE or Extended protocol configuration options
IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the UE shall check
whether the EPS bearer identity included in the QoS flow description
corresponds to an active EPS bearer context of the PDN connection associated
with the EPS bearer context being modified. If the EPS bearer identity
included in the QoS flow description does not correspond to any active EPS
bearer context of the PDN connection associated with the EPS bearer context
being modified, the UE shall locally delete the QoS flow description and all
the associated QoS rules, if any, and include a Protocol configuration options
IE or Extended protocol configuration options IE with a 5GSM cause parameter
set to 5GSM cause #84 \"syntactical error in the QoS operation\" in the MODIFY
EPS BEARER CONTEXT ACCEPT message.
When the UE is provided with one or more QoS rules, or one or more QoS flow
descriptions in the Protocol configuration options IE or Extended protocol
configuration options IE in the MODIFY EPS BEARER CONTEXT REQUEST message, the
UE shall process the QoS rules sequentially starting with the first QoS rule.
The UE shall check the QoS rules and QoS flow descriptions for different types
of errors as follows:
a) Semantic errors in QoS operations:
1) When the rule operation is \"Modify existing QoS rule and add packet
filters\", \"Modify existing QoS rule and replace all packet filters\",
\"Modify existing QoS rule and delete packet filters\" or \"Modify existing
QoS rule without modifying packet filters\" on the default QoS rule and the
DQR bit is set to \"the QoS rule is not the default QoS rule\".
2) When the rule operation is \"Modify existing QoS rule and add packet
filters\", \"Modify existing QoS rule and replace all packet filters\",
\"Modify existing QoS rule and delete packet filters\" or \"Modify existing
QoS rule without modifying packet filters\" on a QoS rule which is not the
default QoS rule and the DQR bit is set to \"the QoS rule is the default QoS
rule\".
3) When the rule operation is \"Create new QoS rule\" and the DQR bit is set
to \"the QoS rule is the default QoS rule\" when there\'s already a default
QoS rule.
4) When the rule operation is \"Delete existing QoS rule\" on the default QoS
rule.
5) When the rule operation is \"Create new QoS rule\", \"Modify existing QoS
rule and add packet filters\", \"Modify existing QoS rule and replace all
packet filters\", \"Modify existing QoS rule and delete packet filters\", or
\"Modify existing QoS rule without modifying packet filters\" and two or more
QoS rules associated with this PDU session would have identical precedence
values.
6) When the rule operation is \"Modify existing QoS rule and delete packet
filters\", the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6
or Ethernet PDU session type, and the packet filter list in the resultant QoS
rule is empty.
7) When the rule operation is \"Create new QoS rule\" and there is already an
existing QoS rule with the same QoS rule identifier.
8) When the rule operation is \"Modify existing QoS rule and add packet
filters\", \"Modify existing QoS rule and replace all packet filters\",
\"Modify existing QoS rule and delete packet filters\", \"Modify existing QoS
rule without modifying packet filters\" or \"Delete existing QoS rule\" and
there is no existing QoS rule with the same QoS rule identifier.
9) When the rule operation is \"Delete existing QoS rule\" and there is no
existing QoS rule with the same QoS rule identifier.
10) When the flow description operation is \"Create new QoS flow description\"
and there is already an existing QoS flow description with the same QoS flow
identifier.
11) When the flow description operation is \"Modify existing QoS flow
description\" and there is no existing QoS flow description with the same QoS
flow identifier.
12) When the flow description operation is \"Delete existing QoS flow
description\" and there is no existing QoS flow description with the same QoS
flow identifier.
13) When the UE determines that:
i) the default EPS bearer context is associated with one or more QoS rules and
all of them are non-default QoS rules.
ii) a dedicated EPS bearer context is associated with the default QoS rule.
iii) at least one dedicated EPS bearer is associated with at least one QoS
flow, but the default EPS bearer is not associated with the default QoS rule.
In case 4, the UE shall include a Protocol configuration options IE or
Extended protocol configuration options IE with a 5GSM cause parameter set to
5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS
BEARER CONTEXT ACCEPT message.
In case 5, if the old QoS rule is not the default QoS rule, the UE shall not
diagnose an error, shall further process the new request and, if it was
processed successfully, shall delete the old QoS rule which has identical
precedence value. If the QoS rule is the default QoS rule, the UE shall
include a Protocol configuration options IE or Extended protocol configuration
options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error
in the QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.
In case 6, if the QoS rule is not the default QoS rule, the UE shall delete
the QoS rule. If the QoS rule is the default QoS rule, the UE shall include a
Protocol configuration options IE or Extended protocol configuration options
IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error in the
QoS operation\" in the MODIFY EPS BEARER CONTEXT ACCEPT message.
In case 7, if the QoS rule is not the default QoS rule, the UE shall not
diagnose an error, further process the create request and, if it was processed
successfully, delete the old QoS rule. If the QoS rule is the default QoS
rule, the UE shall include a Protocol configuration options IE or Extended
protocol configuration options IE with a 5GSM cause parameter set to 5GSM
cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS BEARER
CONTEXT ACCEPT message.
In case 9, the UE shall not diagnose an error, further process the delete
request and, if it was processed successfully, consider the respective QoS
rule as successfully deleted.
In case 10, the UE shall not diagnose an error, further process the create
request and, if it was processed successfully, delete the old QoS flow
description.
In case 12, the UE shall not diagnose an error, further process the delete
request and, if it was processed successfully, consider the respective QoS
flow description as successfully deleted.
Otherwise, the UE shall include a Protocol configuration options IE or
Extended protocol configuration options IE with a 5GSM cause parameter set to
5GSM cause #83 \"semantic error in the QoS operation\" in the MODIFY EPS
BEARER CONTEXT ACCEPT message.
b) Syntactical errors in QoS operations:
1) When the rule operation is \"Create new QoS rule\", \"Modify existing QoS
rule and add packet filters\", \"Modify existing QoS rule and replace packet
filters\" or \"Modify existing QoS rule and delete packet filters\" and the
packet filter list in the QoS rule is empty.
2) When the rule operation is \"Delete existing QoS rule\" or \"Modify
existing QoS rule without modifying packet filters\" with a non-empty packet
filter list in the QoS rule.
3) When the rule operation is \"Modify existing QoS rule and delete packet
filters\" and the packet filter to be deleted does not exist in the original
QoS rule.
4) When the rule operation is \"Modify existing QoS rule and delete packet
filters\" with a packet filter list also including packet filters in addition
to the packet filter identifiers.
5) When there are other types of syntactical errors in the coding of the QoS
rules IE or the QoS flow descriptions IE, such as a mismatch between the
number of packet filters subfield, and the number of packet filters in the
packet filter list.
In case 3 the UE shall not diagnose an error, further process the deletion
request and, if no error according to items c and d was detected, consider the
respective packet filter as successfully deleted.
Otherwise the UE shall include a Protocol configuration options IE or Extended
protocol configuration options IE with a 5GSM cause parameter set to 5GSM
cause #84 \"syntactical error in the QoS operation\" in the MODIFY EPS BEARER
CONTEXT ACCEPT message.
c) Semantic errors in packet filters:
1) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
The UE shall include a Protocol configuration options IE or Extended protocol
configuration options IE with a 5GSM cause parameter set to 5GSM cause #44
\"semantic errors in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT
ACCEPT message.
d) Syntactical errors in packet filters:
1) When the rule operation is \"Create new QoS rule\", \"Modify existing QoS
rule and add packet filters\" or \"Modify existing QoS rule and replace all
packet filters\", and two or more packet filters in the resultant QoS rule
would have identical packet filter identifiers.
2) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
In case 1, if two or more packet filters with identical packet filter
identifiers are contained in the MODIFY EPS BEARER CONTEXT REQUEST message,
the UE shall include a Protocol configuration options IE or Extended protocol
configuration options IE with a 5GSM cause parameter set to 5GSM cause #45
\"syntactical error in packet filter(s)\" in the MODIFY EPS BEARER CONTEXT
ACCEPT message. Otherwise, the UE shall not diagnose an error, further process
the MODIFY EPS BEARER CONTEXT REQUEST message and, if it was processed
successfully, delete the old packet filters which have the identical packet
filter identifiers.
Otherwise the UE shall include a Protocol configuration options IE or Extended
protocol configuration options IE with a 5GSM cause parameter set to 5GSM
cause #45 \"syntactical error in packet filter(s)\" in the MODIFY EPS BEARER
CONTEXT ACCEPT message.
Upon successful completion of an EPS attach procedure or tracking area
updating procedure after inter-system change from N1 mode to S1 mode (see 3GPP
TS 24.301 [15]), the UE shall delete any UE derived QoS rules. The UE and the
SMF shall perform a local release of the PDU session(s) and QoS flow(s) which
have not been transferred to EPS.
For PDU session(s) associated with non-3GPP access in 5GS, if present, the UE
may:
a) keep some or all of these PDU sessions still associated with non-3GPP
access in 5GS, if supported;
b) release some or all of these PDU sessions explicitly by initiating the UE
requested PDU session release procedure(s); or
c) attempt to transfer some or all of these PDU sessions from N1 mode to S1
mode by initiating the UE requested PDN connectivity procedure(s) with the PDN
CONNECTIVITY REQUEST message created as specified in subclause 6.1.4.2.
Interworking to 5GS is supported for a PDN connection, if the corresponding
default EPS bearer context includes a PDU session identity, session AMBR and
one or more QoS flow descriptions received in the Protocol configuration
options IE or Extended protocol configuration options IE (see 3GPP TS 24.301
[15]), or the default EPS bearer context has association with the PDU session
identity, the S-NSSAI, the session-AMBR and one or more QoS flow descriptions
after inter-system change from N1 mode to S1 mode.
For a PDN connection established in S1 mode, the SMF assigning the QoS rules
shall consider that the UE supports 16 packet filters for the corresponding
PDU session until the UE indicates a higher number (as specified in subclause
6.4.2.2).
When the UE is provided with one or more QoS flow descriptions or the EPS
bearer identity of an existing QoS flow description is modified in the
Protocol configuration options IE or Extended protocol configuration options
IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or ACTIVATE DEDICATED
EPS BEARER CONTEXT REQUEST message, the UE shall check whether the EPS bearer
identity included in the QoS flow description corresponds to an active EPS
bearer context of the PDN connection associated with the EPS bearer context
being activated. If the EPS bearer identity included in the QoS flow
description does not correspond to any active EPS bearer context of the PDN
connection associated with the EPS bearer context being activated, the UE
shall locally delete the QoS flow description and all the associated QoS
rules, if any, and include a Protocol configuration options IE or Extended
protocol configuration options IE with a 5GSM cause parameter set to 5GSM
cause #84 \"syntactical error in the QoS operation\" in the ACTIVATE DEFAULT
EPS BEARER CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT
message.
When the UE is provided with one or more QoS rules, or one or more QoS flow
descriptions in the Protocol configuration options IE or Extended protocol
configuration options IE of the ACTIVATE DEFAULT EPS BEARER CONTEXT REQUEST or
ACTIVATE DEDICATED EPS BEARER CONTEXT REQUEST message, the UE shall check QoS
rules and QoS flow descriptions for different types of errors as follows:
a) Semantic errors in QoS operations:
1) When the rule operation is \"Create new QoS rule\" and the DQR bit is set
to \"the QoS rule is the default QoS rule\" when there\'s already a default
QoS rule.
2) When the rule operation is \"Create new QoS rule\", and there is no rule
with the DQR bit set to \"the QoS rule is the default QoS rule\".
3) When the rule operation is \"Create new QoS rule\" and two or more QoS
rules associated with this PDU session would have identical precedence values.
4) When the rule operation is an operation other than \"Create a new QoS
rule\".
5) When the flow description operation is an operation other than \"Create new
QoS flow description\".
6) When the UE determines that:
i) the default EPS bearer context is associated with one or more QoS rules and
all of them are non-default QoS rules.
ii) a dedicated EPS bearer context is associated with the default QoS rule.
iii) at least one dedicated EPS bearer is associated with at least one QoS
flow, but the default EPS bearer is not associated with the default QoS rule.
In case 4, if the rule operation is for a non-default QoS rule, the UE shall
delete the QoS rule. If the QoS rule is the default QoS rule, the UE shall
include a Protocol configuration options IE or Extended protocol configuration
options IE with a 5GSM cause parameter set to 5GSM cause #83 \"semantic error
in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or
ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.
Otherwise for all the cases above, the UE shall include a Protocol
configuration options IE or Extended protocol configuration options IE with a
5GSM cause parameter set to 5GSM cause #83 \"semantic error in the QoS
operation\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE
DEDICATED EPS BEARER CONTEXT ACCEPT message.
b) Syntactical errors in QoS operations:
1) When the rule operation is \"Create new QoS rule\" and the packet filter
list in the QoS rule is empty.
2) When the rule operation is \"Modify existing QoS rule and delete packet
filters \", and the packet filter list in the resultant QoS rule is empty.
3) When there are other types of syntactical errors in the coding of the QoS
rules IE, such as a mismatch between the number of packet filters subfield,
and the number of packet filters in the packet filter list.
In case 1, case 2 or case 3, if the QoS rule is not the default QoS rule, the
UE shall delete the QoS rule. If the QoS rule is the default QoS rule, the UE
shall include a Protocol configuration options IE or Extended protocol
configuration options IE with a 5GSM cause parameter set to 5GSM cause #84
\"syntactical error in the QoS operation\" in the ACTIVATE DEFAULT EPS BEARER
CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.
c) Semantic errors in packet filters:
1) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
The UE shall include a Protocol configuration options IE or Extended protocol
configuration options IE with a 5GSM cause parameter set to 5GSM cause #44
\"semantic errors in packet filter(s)\" in the ACTIVATE DEFAULT EPS BEARER
CONTEXT ACCEPT or ACTIVATE DEDICATED EPS BEARER CONTEXT ACCEPT message.
d) Syntactical errors in packet filters:
1) When the rule operation is \"Create new QoS rule\" and two or more packet
filters in the resultant QoS rule would have identical packet filter
identifiers.
2) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
If the QoS rule is not the default QoS rule, the UE shall delete the QoS rule.
If the QoS rule is the default QoS rule, the UE shall include a Protocol
configuration options IE or Extended protocol configuration options IE with a
5GSM cause parameter set to 5GSM cause #45 \"syntactical error in packet
filter(s)\" in the ACTIVATE DEFAULT EPS BEARER CONTEXT ACCEPT or ACTIVATE
DEDICATED EPS BEARER CONTEXT ACCEPT message.
Upon inter-system change from S1 mode to N1 mode, the UE uses the parameters
from the default EPS bearer context of each PDN connection for which
interworking to 5GS is supported to create a corresponding PDU session as
follows:
a) the PDN type of the default EPS bearer context shall be mapped to the PDU
session type of the PDU session as follows:
1) if the PDN type is \"non-IP\":
\- the PDU session type is set to the locally available information associated
with the PDN connection (either \"Ethernet\" or \"Unstructured\"), if
available; or
\- otherwise, the PDU session type is set to \"Unstructured\";
2) if the PDN type is \"IPv4\" the PDU session type is set to \"IPv4\";
3) if the PDN type is \"IPv6\", the PDU session type is set to \"IPv6\"; and
4) the PDN type shall be set to \"IPv4v6\" if the PDU session type is
\"IPv4v6\";
b) the PDN address of the default EPS bearer context shall be mapped to PDU
address of the PDU session, if the PDN type is \"IPv4\", \"IPv6\" or
\"IPv4v6\";
c) the APN of the default EPS bearer context shall be mapped to the DNN of the
PDU session;
d) for each default EPS bearer context in state BEARER CONTEXT ACTIVE the UE
shall set the state of the mapped PDU session to PDU SESSION ACTIVE; and
e) for any other default EPS bearer context the UE shall set the state of the
mapped PDU session to PDU SESSION INACTIVE.
Additionally, the UE shall set:
a) the PDU session identity of the PDU session to the PDU session identity
included by the UE in the Protocol configuration options IE or Extended
protocol configuration options IE in the PDN CONNECTIVITY REQUEST message, or
the PDU session identity associated with the default EPS bearer context;
b) the S-NSSAI of the PDU session to the S-NSSAI included by the network in
the Protocol configuration options IE or Extended protocol configuration
options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message, the S-NSSAI
included by the network in the N1_MODE_INFORMATION Notify payload of the
IKE_AUTH response message, or the S-NSSAI associated with the default EPS
bearer context;
c) the session-AMBR of the PDU session to the session-AMBR included by the
network in the Protocol configuration options IE or Extended protocol
configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message or
the MODIFY EPS BEARER CONTEXT REQUEST message, or the session-AMBR associated
with the default EPS bearer context;
d) the SSC mode of the PDU session to \"SSC mode 1\"; and
e) the always-on PDU session indication to the always-on PDU session
indication maintained in the UE, if any.
Additionally, for each EPS bearer context of the PDN connection, the UE shall
create QoS flow(s) each of which is associated with the QoS flow description
received in the Protocol configuration options IE or Extended protocol
configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message,
ACTIVATE DEDICATED EPS BEARER REQUEST message, and/or MODIFY EPS BEARER
REQUEST message (see 3GPP TS 24.301 [15]), or the QoS flow description
associated with EPS bearer context.
Additionally, for each EPS bearer context of the PDN connection, the UE shall
create QoS rules(s), if any, each of which is associated with the QoS rule
received in the Protocol configuration options IE or Extended protocol
configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message,
ACTIVATE DEDICATED EPS BEARER REQUEST message, or MODIFY EPS BEARER CONTEXT
REQUEST message (see 3GPP TS 24.301 [15]), or the QoS rules associated with
EPS bearer context.
The UE and the network shall locally release the PDN connection(s) and EPS
bearer(s) associated with the 3GPP access which have not been transferred to
5GS.
After inter-system change from S1 mode to N1 mode, for each QoS flow mapped
from a EPS bearer context the UE shall associate the EPS bearer identity, the
EPS QoS parameters, the extended EPS QoS parameters, and the traffic flow
template, if available, of the EPS bearer context with the QoS flow.
If there is an EPS bearer used for IMS signalling, after inter-system change
from S1 mode to N1 mode, the QoS flow of the default QoS rule in the
corresponding PDU session is used for IMS signalling.
For a PDN connection established when in S1 mode, upon the first inter-system
change from S1 mode to N1 mode, the SMF shall determine the PDU session
indication as specified in subclause 6.3.2.2.
When the UE is provided with a new EPS bearer identity, a new EPS QoS
parameters, or a new extended EPS QoS parameters in the Mapped EPS bearer
context IE of the PDU SESSION MODIFICATION COMMAND message for a QoS flow, the
UE shall discard the corresponding association(s) and associate the new
value(s) with the QoS flow.
When the UE is provided with a new traffic flow template in the Mapped EPS
bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message for a QoS
flow, the UE shall check the traffic flow template for different types of TFT
IE errors as specified in subclause 6.3.2.3.
When a QoS flow is deleted, the associated EPS bearer context information that
are mapped from the deleted QoS flow shall be deleted from the UE and the
network if there is no other existing QoS flow associated with this EPS bearer
context. When the EPS bearer identity of a QoS flow is deleted, the associated
EPS bearer context information that are mapped from the deleted EPS bearer
identity shall be deleted from the UE and the network if there is no other
existing QoS flow associated with this EPS bearer context. When an EPS bearer
is released, all the associated QoS flow descriptions and QoS rules that are
mapped from the released EPS bearer shall be deleted from the UE and the
network.
NOTE: If T3584 is running or deactivated for the S-NSSAI and optionally the
DNN combination, the UE is allowed to initate ESM procedures in EPS with or
without APN corresponding to that DNN, and if the APN is congested in EPS, the
MME can send a back-off timer for the APN to the UE as specified in 3GPP TS
24.301 [15].
For PDN connection(s) associated with non-3GPP access in EPS, if present, the
UE may:
a) keep some or all of these PDN connections still associated with non-3GPP
access in EPS, if supported;
b) release some or all of these PDN connections explicitly by initiating the
UE requested PDN disconnect procedure(s) as specified in 3GPP TS 24.301; or
c) attempt to transfer some or all of these PDN connections from S1 mode to N1
mode by initiating the PDU session establishment procedure(s) with the PDU
SESSION ESTABLISHMENT REQUEST message created as specified in subclause
6.1.4.2.
After handover of an existing PDU session from 3GPP access to non-3GPP access,
the network and the UE shall locally delete EPS bearer identities for the PDU
session, if any.
#### 6.1.4.2 Coordination between 5GSM and ESM without N26 interface
When the network does not support N26 interface, the SMF does not provide the
UE with the mapped EPS bearer context for a PDU session.
NOTE 1: Since the SMF does not provide the UE with the mapped EPS bearer
context for a PDU session, the UE does not know whether interworking with EPS
is supported for a PDU session before attempting to transfer the PDU session
from N1 mode to S1 mode.
NOTE 2: It is up to UE implementation to decide which PDU session(s) to be
attempted to transfer from N1 mode to S1 mode, e.g. based on UE policy or user
preference.
Upon inter-system change from N1 mode to S1 mode in EMM-IDLE mode, the UE
shall use the parameters from each PDU session which the UE intends to
transfer to EPS to create the contents of a PDN CONNECTIVITY REQUEST message
as follows:
a) if the PDU session is an emergency PDU session, the request type shall be
set to \"handover of emergency bearer services\". Otherwise the request type
shall be set to \"handover\";
b) the PDU session type of the PDU session shall be mapped to the PDN type of
the default EPS bearer context as follows:
1) the PDN type shall be set to \"non-IP\" if the PDU session type is
\"Ethernet\" or \"Unstructured\";
2) the PDN type shall be set to \"IPv4\" if the PDU session type is \"IPv4\";
3) the PDN type shall be set to \"IPv6\" if the PDU session type is \"IPv6\";
and
4) the PDN type shall be set to \"IPv4v6\" if the PDU session type is
\"IPv4v6\";
c) the DNN of the PDU session shall be mapped to the APN of the default EPS
bearer context; and
d) the PDU session ID parameter in the PCO IE shall be set to the PDU session
identity of the PDU session.
After inter-system change from N1 mode to S1 mode, the UE shall associate the
PDU session identity with the default EPS bearer context.
Upon successful completion of an EPS attach procedure after inter-system
change from N1 mode to S1 mode (see 3GPP TS 24.301 [15]), the UE shall delete
any UE derived QoS rules.
The UE shall perform a local release of the PDU session(s) and QoS flow(s)
associated with the 3GPP access which have not been transferred to EPS.
For PDU session(s) associated with non-3GPP access in 5GS, if present, the UE
may:
a) keep some or all of these PDU sessions still associated with non-3GPP
access in 5GS, if supported;
b) release some or all of these PDU sessions explicitly by initiating the UE
requested PDU session release procedure(s); or
c) attempt to transfer some or all of these PDU sessions from N1 mode to S1
mode by initiating the UE requested PDN connectivity procedure(s) with the PDN
CONNECTIVITY REQUEST message created as above.
When the network does not support N26 interface, the MME does not provide the
UE with the mapped PDU session for a PDN connection but provides the UE with
an S-NSSAI. When establishing a new PDN connection in S1 mode, to enable the
UE to attempt to transfer the PDN connection from S1 mode to N1 mode in case
of inter-system change, the UE shall allocate a PDU session identity, indicate
the allocated PDU session identity in the PDU session ID parameter in the
Protocol configuration options IE of the PDN CONNECTIVITY REQUEST message and
associate the allocated PDU session identity with the default EPS bearer
context of the PDN connection. The network provides the UE with an S-NSSAI in
the Protocol configuration options IE or Extended protocol configuration
options IE of the ACTIVATE DEFAULT EPS BEARER REQUEST message, or in the
N1_MODE_INFORMATION Notify payload of the IKE_AUTH response message.
NOTE 3: Since the MME does not provide the UE with the mapped PDU session for
a PDN connection, the UE does not know whether interworking to 5GS is
supported for a PDN connection for which the UE assigned a PDU Session
identity before attempting to transfer the PDN connection from S1 mode to N1
mode.
NOTE 4: It is up to UE implementation to decide which PDN connection(s) to be
attempted to transfer from S1 mode to N1 mode, e.g. based on UE policy or user
preference.
Upon inter-system change from S1 mode to N1 mode in 5GMM-IDLE mode, the UE
uses the parameters from the default EPS bearer context of each PDN connection
which the UE intends to transfer to 5GS and for which the UE has allocated a
PDU session identity to create a PDU SESSION ESTABLISHMENT REQUEST message as
follows:
a) if the PDN connection is for emergency bearer services, the request type
shall be set to \"existing emergency PDU session\". Otherwise the request type
shall be set to \"existing PDU session\";
b) the PDN type of the default EPS bearer context shall be mapped to the PDU
session type of the PDU session as follows:
1) if the PDN type is \"non-IP\":
\- the PDU session type is set to the locally available information associated
with the PDN connection (either \"Ethernet\" or \"Unstructured\"), if
available; or
\- otherwise, the PDU session type is set to \"Unstructured\";
2) if the PDN type is \"IPv4\" the PDU session type is set to \"IPv4\";
3) if the PDN type is \"IPv6\", the PDU session type is set to \"IPv6\"; and
4) the PDN type shall be set to \"IPv4v6\" if the PDU session type is
\"IPv4v6\";
c) the APN of the default EPS bearer context shall be mapped to the DNN of the
PDU session;
d) the PDU session ID shall be set to the PDU session identity included by the
UE in the Protocol configuration options IE or Extended protocol configuration
options IE in the PDN CONNECTIVITY REQUEST message, or to the PDU session ID
associated with the default EPS bearer context; and
e) the S-NSSAI of the PDU session shall be set to the S-NSSAI included by the
network in the Protocol configuration options IE or Extended protocol
configuration options IE in the ACTIVATE DEFAULT EPS BEARER REQUEST message,
if provided by the network, or the S-NSSAI associated with the default EPS
bearer context, if available.
NOTE 5: If T3584 is running or deactivated for the S-NSSAI and optionally the
DNN combination, the UE is allowed to initiate ESM procedures in EPS with or
without APN corresponding to that DNN, and if the APN is congested in EPS, the
MME can send a back-off timer for the APN to the UE as specified in 3GPP TS
24.301 [15].
The UE shall locally release the PDN connection(s) and EPS bearer(s)
associated with the 3GPP access which have not been transferred to 5GS.
For PDN connection(s) associated with non-3GPP access in EPS, if present, the
UE may:
a) keep some or all of these PDN connections still associated with non-3GPP
access in EPS, if supported;
b) release some or all of these PDN connections explicitly by initiating the
UE requested PDN disconnect procedure(s) as specified in 3GPP TS 24.301; or
c) attempt to transfer some or all of these PDN connections from S1 mode to N1
mode by initiating the PDU session establishment procedure(s) with the PDU
SESSION ESTABLISHMENT REQUEST message created as above.
## 6.2 General on elementary 5GSM procedures
### 6.2.1 Principles of PTI handling for 5GSM procedures
When the UE or the network initiates a transaction related procedure (i.e. a
procedure consisting of more than one message and the messages are related),
it shall include a valid PTI value in the message header of the request
message or of the command message.
If a response message is sent as result of a received request message or a
received command message, the sending entity shall include in the response
message the PTI value received within the request message or within the
command message (see examples in figure 6.2.1.1, figure 6.2.1.2, and figure
6.2.1.3).
If a command message is sent as result of a received request message, the
sending entity shall include in the command message the PTI value received
with the request message (see examples in figure 6.2.1.3).
If a command message is not sent as result of a received request message, the
sending entity shall include in the command message the PTI value set to \"no
procedure transaction identity assigned\" (see examples in figure 6.2.1.4).
Figure 6.2.1.1: UE-requested transaction related procedure accepted by the
network
Figure 6.2.1.2: UE-requested transaction related procedure rejected by the
network
Figure 6.2.1.3: UE-requested transaction related procedure triggering a
network-requested transaction related procedure
Figure 6.2.1.4: network-requested transaction related procedure not triggered
by a UE-requested transaction related procedure
### 6.2.2 PDU session types
The following PDU Session types are supported:
a) IPv4;
b) IPv6;
c) IPv4v6;
d) Ethernet (EtherType as defined in IEEE 802.3); and
e) Unstructured.
IP address allocation for IPv4, IPv6 and IPv4v6 PDU session types is described
in subclause 6.2.4.
Neither a MAC nor an IP address is allocated by the 5GCN to the UE for
Ethernet PDU session type.
### 6.2.3 PDU session management
The SMF is responsible for the session management functions to provide the PDU
connectivity service to the UE via the SM signalling between UE and SMF. The
session management procedures includes:
a) the UE-requested PDU session establishment procedure;
b) the PDU session authentication and authorization procedure;
c) the UE-requested PDU session modification procedure;
d) the network-requested PDU session modification procedure;
e) the UE-requested PDU session release procedure; and
f) the network-requested PDU session release procedure.
A UE may establish multiple PDU sessions, to the same data network or to
different data networks, via 3GPP and via and Non-3GPP access networks at the
same time.
The session management messages between UE and SMF are transferred via AMF as
specified in subclause 8.3.
### 6.2.4 IP address allocation
#### 6.2.4.1 General
This clause specifies IP address allocation for the PDU session.
In this release of specification, PDU session can be initiated with one IP
version, i.e. IPv4 PDU session type or IPv6 PDU session type, or with both IP
versions, i.e. IPv4v6 PDU session type.
IP address allocation to the UE shall be performed by SMF based on one or both
the selected IP versions and operator policies. If IPv4 PDU session type is
selected, an IPv4 address is allocated to the UE. If IPv6 PDU session type is
selected, an IPv6 prefix and an interface identifier for the IPv6 link local
address are allocated to the UE. If IPv4v6 PDU session type is selected, an
IPv4 address, an IPv6 prefix and an interface identifier for the IPv6 link
local address are allocated to the UE.
For IPv4 PDU session type and for IPv4v6 PDU session type, the UE:
a) shall obtain an IPv4 address via:
1) NAS signalling as specified in subclause 6.2.4.2; or
2) DHCPv4; and
b) may obtain IPv4 configuration parameters (e.g. DNS server address) via
DHCPv4.
For IPv6 PDU session type and for IPv4v6 PDU session type, the UE:
a) shall build an IPv6 link local address based on the allocated interface
identifier for the IPv6 link local address;
b) shall obtain /64 IPv6 prefix via IPv6 stateless address autoconfiguration
as specified in 3GPP TS 23.501 [8] and IETF RFC 4862 [39]; and
c) may obtain IPv6 configuration parameters via stateless DHCPv6 as specified
in IETF RFC 3736 [35].
#### 6.2.4.2 IP address allocation via NAS signalling
The UE shall set the PDU session type IE in the PDU SESSION ESTABLISHMENT
REQUEST message, based on its IP stack capabilities if the UE requests IP
connectivity as follows:
a) A UE:
1) which is IPv6 and IPv4 capable, shall set the PDU session type IE to IPv4,
IPv6 or IPv4v6 according to UE configuration or received policy.
2) which is only IPv6 capable, shall set the PDU session type IE to IPv6.
3) which is only IPv4 capable, shall set the PDN type IE to IPv4.
b) When the IP version capability of the UE is unknown in the UE (as in the
case when the MT and TE are separated and the capability of the TE is not
known in the MT), the UE shall set the PDU session type IE to IPv4v6.
If the UE wants to use DHCPv4 for IPv4 address assignment, it shall indicate
that to the network within the Extended protocol configuration options IE in
the PDU SESSION ESTABLISHMENT REQUEST.
On receipt of the PDU SESSION ESTABLISHMENT REQUEST message sent by the UE,
the network when allocating an IP address shall take into account the PDU
session type IE, the operator\'s policies of the network, and the user\'s
subscription data and:
a) if the network sets the PDU session type IE to IPv4, the network shall
include an IPv4 address in the PDU address IE;
b) if the network sets the PDU session type IE to IPv6, the network shall
include an interface identifier for the IPv6 link local address in the PDU
address IE; and
c) if the network sets the PDU session type IE to IPv4v6, the network shall
include an IPv4 address and an interface identifier for the IPv6 link local
address in the PDU address IE.
### 6.2.5 Quality of service
#### 6.2.5.1 General
##### 6.2.5.1.1 QoS rules
###### 6.2.5.1.1.1 General
In a PDU session of IPv4, IPv6, IPv4v6 and Ethernet PDU session type, the NAS
protocol enables different forwarding treatments of UL user data packets in
one or more QoS flows based on signalled QoS rules, derived QoS rules or any
combination of them.
In a PDU session of Unstructured PDU session type, all UL user data packets
are associated with the same QoS flow.
###### 6.2.5.1.1.2 Signalled QoS rules
The NAS protocol enables the network to provide the UE with signalled QoS
rules associated with a PDU session.
The network can provide the UE with one or more signalled QoS rules associated
with a PDU session at the PDU session establishment or at the PDU session
modification.
Each signalled QoS rule contains:
a) an indication of whether the QoS rule is the default QoS rule;
b) a QoS rule identifier (QRI);
c) a QoS flow identifier (QFI);
d) optionally, a set of packet filters; and
e) a precedence value.
NOTE: The default QoS rule indication (DQR) of a signalled QoS rule cannot be
changed.
For case d) above:
1) If the QoS rule is the default rule of a PDU session of IPv4, IPv6, IPv4v6
or Ethernet PDU session type, the set of packet filters contains zero or more
packet filters for DL direction, and may additionaly contain one of the
following:
A) a match-all packet filter for UL direction;
B) a match-all packet filter for UL and DL directions;
C) zero or more packet filters for UL direction (other than the match-all
packet filter for UL direction);
D) zero or more packet filters for UL and DL directions (other than the match-
all packet filter for UL and DL directions); or
E) one or more packet filters for UL direction (other than the match-all
packet filter for UL direction) and one or more packet filters for UL and DL
directions (other than the match-all packet filter for UL and DL directions).
The set of packet filters for the default rule shall not be empty. If the
default QoS rule contains a match-all packet filter, then the highest
precedence value shall be used for the default QoS rule.
2) If the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6 or
Ethernet PDU session type and is not the default QoS rule, the set of packet
filters contains zero or more packet filters for the DL direction, and may
additionally contain one of the following:
A) zero or more packet filters for UL direction (other than the match-all
packet filter for UL direction); and
B) zero or more packet filters for both UL and DL directions (other than the
match-all packet filter for UL and DL directions).
The set of packet filters for a QoS rule which is not the default QoS rule
shall not be empty.
3) For PDU session of unstructured PDU session type, there is only one QoS
rule associated with it and the set of packet filters of that QoS rule is
empty.
If the UE requests a new QoS rule, it shall assign a precedence value for the
signalled QoS rule which is not in the range from 70 to 99 (decimal).
Within a PDU session:
a) each signalled QoS rule has a unique QRI;
b) there is at least one signalled QoS rule;
c) one signalled QoS rule is the default QoS rule; and
d) there can be zero, one or more signalled QoS rules associated with a given
QFI.
###### 6.2.5.1.1.3 Derived QoS rules
Derived QoS rules are applicable only for PDU session of IPv4, IPv6, IPv4v6 or
Ethernet PDU session type.
The reflective QoS in the UE creates derived QoS rules associated with a PDU
session based on DL user data packets received via the PDU session.
Each derived QoS rule contains:
a) a QoS flow identifier (QFI);
b) a packet filter for UL direction; and
c) a precedence value of 80 (decimal).
NOTE: On the network side, the corresponding QoS rule can be associated with a
different precedence value in the range from 70 to 99 (decimal).
Within a PDU session:
a) there can be zero, one or more derived QoS rules associated with a given
QFI; and
b) there can be up to one derived QoS rule associated with a given packet
filter for UL direction.
In the UE, a timer T3583 runs for each derived QoS rule.
###### 6.2.5.1.1.4 QoS flow descriptions
The network can also provide the UE with one or more QoS flow descriptions
associated with a PDU session at the PDU session establishment or at the PDU
session modification.
Each QoS flow description contains:
a) a QoS flow identifier (QFI);
b) if the flow is a GBR QoS flow:
1) Guaranteed flow bit rate (GFBR) for UL;
2) Guaranteed flow bit rate (GFBR) for DL;
3) Maximum flow bit rate (MFBR) for UL;
4) Maximum flow bit rate (MFBR) for DL; and
5) optionally averaging window, applicable for both UL and DL;
c) 5QI, if the QFI is not the same as the 5QI of the QoS flow identified by
the QFI; and
d) optionally, an EPS bearer identity (EBI) if the QoS flow can be mapped to
an EPS bearer as specified in subclause 4.11.2 of 3GPP TS 23.502 [9].
If the averaging window is not included in a QoS flow description for a GBR
QoS flow with a 5QI indicated in 3GPP TS 23.501 [8] table 5.7.4-1, the
averaging window associated with the 5QI in 3GPP TS 23.501 [8] table 5.7.4-1
applies for the averaging window.
If the averaging window is not included in a QoS flow description for a GBR
QoS flow with a 5QI not indicated in 3GPP TS 23.501 [8] table 5.7.4-1, the
standardized value of two seconds is used as the averaging window.
##### 6.2.5.1.2 Session-AMBR
The NAS protocol enables the network to provide the UE with the session-AMBR
associated with a PDU session.
The standardized value of two seconds is used as the averaging window for the
UE\'s enforcement of the UL rate limitation indicated by the session-AMBR.
##### 6.2.5.1.3 UL user data packet matching
For PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU session type, upon
receiving an UL user data packet from the upper layers for transmission via a
PDU session, the UE shall attempt to associate the UL user data packet with:
a) the QFI of a signalled QoS rule associated with the PDU session which has a
set of packet filters containing a packet filter for UL direction matching the
UL user data packet or containing a packet filter for both UL and DL
directions matching the UL user data packet; or
b) the QFI of a derived QoS rule associated with the PDU session which has the
packet filter for UL direction matching the UL user data packet;
by evaluating the QoS rules in increasing order of their precedence values
until the UL user data packet is associated with a QFI or all QoS rules are
evaluated.
For PDU session of unstructured PDU session type, upon receiving an UL user
data packet from the upper layers for transmission via a PDU session, the UE
shall associate the UL user data packet with the QFI of the default QoS rule
associated with the PDU session.
If the UL user data packet is associated with a QFI, the UE shall pass the QFI
along the UL user data packet to the lower layers for transmission.
NOTE: Marking of the UL user data packet with the QFI is performed by the
lower layers.
If all QoS rules are evaluated and the UL user data packet is not associated
with a QFI, the UE shall discard the UL user data packet.
##### 6.2.5.1.4 Reflective QoS
###### 6.2.5.1.4.1 General
The UE may support reflective QoS.
If the UE supports the reflective QoS, the UE shall support the procedures in
the following subclauses.
The reflective QoS is applicable in a PDU session of IPv4, IPv6, IPv4v6 and
Ethernet PDU session type. The reflective QoS is not applicable in a PDU
session of Unstructured PDU session type.
The UE may request to revoke the usage of reflective QoS for an existing PDU
session for which the UE had previously indicated support for reflective QoS.
###### 6.2.5.1.4.2 Derivation of packet filter for UL direction from DL user
data packet
If the UE needs to derive a packet filter for UL direction from the DL user
data packet (see subclause 6.2.5.1.4.3 and 6.2.5.1.4.4), the UE shall proceed
as follows:
a) if the received DL user data packet belongs to a PDU session of IPv4 or
IPv4v6 PDU session type and is an IPv4 packet and:
1) the protocol field of the received DL user data packet indicates TCP as
specified in IETF RFC 793 [33];
2) the protocol field of the received DL user data packet indicates UDP as
specified in IETF RFC 768 [32]; or
3) the protocol field of the received DL user data packet indicates ESP as
specified in IETF RFC 4303 [38] and an uplink IPSec SA corresponding to a
downlink IPSec SA indicated in the security parameters index field of the
received DL user data packet exists;
then the packet filter for UL direction contains the following packet filter
components:
1) an IPv4 remote address component set to the value of the source address
field of the received DL user data packet;
2) an IPv4 local address component set to the value of the destination address
field of the received DL user data packet;
3) a protocol identifier/next header type component set to the value of the
protocol field of the received DL user data packet;
4) if the protocol field of the received DL user data packet indicates TCP as
specified in IETF RFC 793 [33] or UDP as specified in IETF RFC 768 [32]:
i) a single local port type component set to the value of the destination port
field of the received DL user data packet; and
ii) a single remote port type component set to the value of the source port
field of the received DL user data packet; and
5) if the protocol field of the received DL user data packet indicates ESP as
specified in IETF RFC 4303 [38]:
i) a security parameter index type component set to the security parameters
index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated
in the security parameters index field of the received DL user data packet;
otherwise it is not possible to derive a packet filter for UL direction from
the DL user data packet;
b) if the received DL user data packet belongs to a PDU session of IPv6 or
IPv4v6 PDU session type and is an IPv6 packet and:
1) the last next header field of the received DL user data packet indicates
TCP as specified in IETF RFC 793 [33];
2) the last next header field of the received DL user data packet indicates
UDP as specified in IETF RFC 768 [32]; or
3) the last next header field of the received DL user data packet indicates
ESP as specified in IETF RFC 4303 [38] and an uplink IPSec SA corresponding to
a downlink IPSec SA indicated in the security parameters index field of the
received DL user data packet exists;
then the packet filter for UL direction contains the following packet filter
components:
1) an IPv6 remote address/prefix length component set to the value of the
source address field of the received DL user data packet;
2) an IPv6 local address/prefix length component set to the value of the
destination address field of the received DL user data packet;
3) a protocol identifier/next header type component set to the value of the
last next header field of the received DL user data packet;
4) if the last next header field of the received DL user data packet indicates
TCP as specified in IETF RFC 793 [33] or UDP as specified in IETF RFC 768
[32]:
i) a single local port type component set to the value of the destination port
field of the received DL user data packet; and
ii) a single remote port type component set to the value of the source port
field of the received DL user data packet; and
5) if the last next header field of the received DL user data packet indicates
ESP as specified in IETF RFC 4303 [38]:
i) a security parameter index type component set to the security parameters
index of the uplink IPSec SA corresponding to the downlink IPSec SA indicated
in the security parameters index field of the received DL user data packet;
otherwise it is not possible to derive a packet filter for UL direction from
the DL user data packet;
c) if the received DL user data packet belongs to a PDU session of Ethernet
PDU session type, the packet filter for UL direction contains the following
packet filter components:
1) a destination MAC address component set to the source MAC address of the
received DL user data packet;
2) a source MAC address component set to the destination MAC address of the
received DL user data packet;
3) if an 802.1Q C-TAG is included in the received DL user data packet, an
802.1Q C-TAG VID component set to the 802.1Q C-TAG VID of the received DL user
data packet and an 802.1Q C-TAG PCP/DEI component set to the 802.1Q C-TAG
PCP/DEI of the received DL user data packet;
4) if an 802.1Q S-TAG is included in the received DL user data packet, an
802.1Q S-TAG VID component set to the 802.1Q S-TAG VID of the received DL user
data packet and an 802.1Q S-TAG PCP/DEI component set to the 802.1Q S-TAG
PCP/DEI of the received DL user data packet;
5) If the Ethertype field of the received DL user data packet is set to a
value of 1536 or above, an Ethertype component set to the Ethertype of the
received DL user data packet;
6) if the Ethertype field of the Ethernet frame header indicates that the data
carried in the Ethernet frame is IPv4 data, the UE shall also add to the
packet filter for UL direction the IP-specific components based on the
contents of the IP header of the received DL user data packet as described in
bullet a) above; and
7) if the Ethertype field of the Ethernet frame header indicates that the data
carried in the Ethernet frame is IPv6 data, the UE shall also add to the
packet filter for UL direction the IP-specific components based on the
contents of the IP header of the received DL user data packet as described in
bullet b) above; and
d) if the received DL user data packet belongs to a PDU session of PDU session
type other than Ethernet, IPv4, IPv6 and IPv4v6, it is not possible to derive
a packet filter for UL direction from the DL user data packet.
###### 6.2.5.1.4.3 Creating a derived QoS rule by reflective QoS in the UE
If the UE receives a DL user data packet marked with a QFI and an RQI, the DL
user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet
PDU session type, and the UE does not have a derived QoS rule with the same
packet filter for UL direction as the packet filter for UL direction derived
from the DL user data packet as specified in subclause 6.2.5.1.4.2, then the
UE shall create a new derived QoS rule as follows:
a) the QFI of the derived QoS rule is set to the received QFI;
b) the precedence value of the derived QoS rule is set to 80 (decimal); and
c) the packet filter for UL direction of the derived QoS rule is set to the
derived packet filter for UL direction;
and the UE shall start the timer T3583 associated with the derived QoS rule
with the RQ timer value last received during the UE-requested PDU session
establishment procedure of the PDU session (see subclause 6.4.1) or the
network-requested PDU session modification procedure of the PDU session (see
subclause 6.4.2). If the RQ timer value was received neither in the UE-
requested PDU session establishment procedure of the PDU session nor in any
network-requested PDU session modification procedure of the PDU session, the
default standardized RQ timer value is used.
###### 6.2.5.1.4.4 Updating a derived QoS rule by reflective QoS in the UE
If the UE receives a DL user data packet associated with a QFI and an RQI, the
DL user data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet
PDU session type, and the UE has a derived QoS rule with the same packet
filter for UL direction as the packet filter for UL direction derived from the
DL user data packet as specified in subclause 6.2.5.1.4.2:
a) the UE shall re-start the timer T3583 associated with the derived QoS rule
with the RQ timer value last received during the UE-requested PDU session
establishment procedure of the PDU session (see subclause 6.4.1) or the
network-requested PDU session modification procedure of the PDU session (see
subclause 6.4.2). If the RQ timer value was received neither in the UE-
requested PDU session establishment procedure of the PDU session nor in any
network-requested PDU session modification procedure of the PDU session, the
default standardized RQ timer value is used; and
b) if the QFI value associated with the DL user data packet is different from
the QFI value stored for the derived QoS rule, the UE shall replace the QFI
value stored for the derived QoS rule with the new QFI value for the derived
QoS rule.
###### 6.2.5.1.4.5 Deleting a derived QoS rule in the UE
Upon expiration of timer T3583 associated with a derived QoS rule, the UE
shall remove the derived QoS rule.
Upon release of the PDU session, the UE shall remove the derived QoS rule(s)
associated with the PDU session.
If the network accepts the request from the UE to revoke the usage of
reflective QoS and sets the value of the RQ timer to \"deactivated\" or zero,
the UE shall remove the derived QoS rule(s) associated with the PDU session.
When a derived QoS rule is deleted, the timer T3583 associated with the
derived QoS rule shall be stopped.
###### 6.2.5.1.4.6 Ignoring RQI in the UE
If the UE receives a DL user data packet marked with a QFI and an RQI and it
is not possible to derive a packet filter for UL direction from the DL user
data packet as specified in subclause 6.2.5.1.4.2, the UE shall ignore the RQI
and shall handle the received DL user data packet.
### 6.2.6 Local area data network (LADN)
The UE can receive the local area data network (LADN) information consisting
of LADN DNNs and LADN service area information (a set of tracking areas that
belong to the current registration area) during the registration procedure or
the generic UE configuration update procedure (see subclause 5.5.1 and
subclause 5.4.4).
The UE shall consider itself to be located inside the LADN service area based
on the LADN service area information. If the UE does not have a LADN service
area information for the LADN DNN, the UE shall consider itself to be located
outside the LADN service area.
When the UE is located in the LADN service area, the UE may initiate:
\- the UE-requested PDU session establishment procedure with a LADN DNN to
establish a PDU session for LADN;
\- the UE-requested PDU session modification procedure to modify the PDU
session for LADN; and
\- the service request procedure to re-establish the user-plane resources for
the PDU session for LADN.
When the UE is located outside the LADN service area, the UE is allowed:
to initiate the UE-requested PDU session release procedure to release a PDU
session for LADN; or
\- to initiate the UE-requested PDU session modification procedure to indicate
a change of 3GPP PS data off UE status.
If the UE has moved out of the LADN service area, the SMF shall:
a) release the PDU session for LADN; or
b) release the user-plane resources for the PDU session for LADN and maintain
the PDU session for LADN;
according to operator\'s policy.
In case b):
\- if the UE has returned to the LADN service area, and the network has
downlink user data pending, the network re-establishes the user-plane
resources for the PDU session for LADN; and.
\- if the UE has not returned to the LADN service area after a period of time
according to operator\'s policy, the SMF may release the PDU session for LADN.
When the UE moves to 5GMM-DEREGISTERED state, the UE shall delete the stored
LADN information, if any.
NOTE: In this release, LADNs apply only to 3GPP access.
### 6.2.7 Handling of DNN based congestion control
The network may detect and start performing DNN based congestion control when
one or more DNN congestion criteria as specified in 3GPP TS 23.501 [8] are
met. The network may store a DNN congestion back-off timer on a per UE and
congested DNN basis. If the UE does not provide a DNN for a non-emergency PDU
session, then the network uses the selected DNN.
In the UE, 5GS session management timers T3396 for DNN based congestion
control are started and stopped on a per DNN basis except for an LADN DNN. For
an LADN DNN, 5GS session management timers T3396 for DNN based congestion
control is applied to the registered PLMN and its equivalent PLMNs.
The DNN associated with T3396 is the DNN provided by the UE during the PDU
session establishment. If no DNN is provided by the UE along the PDU SESSION
ESTABLISHMENT REQUEST, then T3396 is associated with no DNN. For this purpose
the UE shall memorize the DNN provided to the network during the PDU session
establishment. The timer T3396 associated with no DNN will never be started
due to any 5GSM procedure related to an emergency PDU session. If the timer
T3396 associated with no DNN is running, it does not affect the ability of the
UE to request an emergency PDU session.
If T3396 is running or is deactivated, then the UE is neither allowed to
initiate the PDU session establishment procedure nor the PDU session
modification procedure for the respective DNN or without a DNN unless the UE
is a UE configured for high priority access in selected PLMN or to report a
change of 3GPP PS data off UE status.
### 6.2.8 Handling of S-NSSAI based congestion control
The network may detect and start performing S-NSSAI based congestion control
when one or more S-NSSAI congestion criteria as specified in 3GPP TS 23.501
[8] are met. The network may store an S-NSSAI congestion back-off timer on a
per UE, S-NSSAI, and optionally DNN basis. If the UE does not provide a DNN
for a non-emergency PDU session, then the network uses the selected DNN. If
the UE does not provide an S-NSSAI for a non-emergency PDU session, then the
network uses the selected S-NSSAI.
In the UE, 5GS session management timers T3584 for the S-NSSAI based
congestion control are started and stopped on a per S-NSSAI, DNN and PLMN
basis. If the 5GSM congestion re-attempt indicator IE set to \"The back-off
timer is applied in all PLMNs\" is included in the 5GSM message with the 5GSM
cause value #67 \"insufficient resources for specific slice and DNN\", then
the UE applies the timer T3584 for all the PLMNs.
In the UE, 5GS session management timers T3585 for the S-NSSAI based
congestion control are started and stopped on a per S-NSSAI and PLMN basis. If
the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the 5GSM message with the 5GSM cause
value #69 \"insufficient resources for specific slice\", then the UE applies
the timer T3585 for all the PLMNs.
The S-NSSAI associated with T3584 is the S-NSSAI provided by the UE during the
PDU session establishment. The DNN associated with T3584 is the DNN provided
by the UE during the PDU session establishment. If no S-NSSAI but DNN is
provided by the UE along the PDU SESSION ESTABLISHMENT REQUEST message, then
T3584 is associated with no S-NSSAI and a DNN provided to the network during
the PDU session establishment. If no DNN but S-NSSAI is provided by the UE
along the PDU SESSION ESTABLISHMENT REQUEST message, then T3584 is associated
with no DNN and an S-NSSAI provided to the network during the PDU session
establishment. If no DNN and no S-NSSAI is provided by the UE along the PDU
SESSION ESTABLISHMENT REQUEST message, then T3584 is associated with no DNN
and no S-NSSAI. For this purpose, the UE shall memorize the DNN and S-NSSAI
provided to the network during the PDU session establishment. The timer T3584
associated with no DNN and an S-NSSAI will never be started due to any 5GSM
procedure related to an emergency PDU session. If the timer T3584 associated
with no DNN and an S-NSSAI is running, it does not affect the ability of the
UE to request an emergency PDU session.
The S-NSSAI associated with T3585 is the S-NSSAI provided by the UE during the
PDU session establishment. If no S-NSSAI is provided by the UE along the PDU
SESSION ESTABLISHMENT REQUEST message, then T3585 is associated with no
S-NSSAI.
If T3584 is running or is deactivated, then the UE is neither allowed to
initiate the PDU session establishment procedure nor the PDU session
modification procedure for the respective [S-NSSAI, no DNN] or [S-NSSAI, DNN]
combination unless the UE is a UE configured for high priority access in
selected PLMN or to report a change of 3GPP PS data off UE status.
If the timer T3584 is running or is deactivated for all the PLMNs, then
a) the UE is neither allowed to initiate the PDU session establishment
procedure nor the PDU session modification procedure for the respective
[S-NSSAI, no DNN] or [S-NSSAI, DNN] combination in all the PLMNs unless the UE
is a UE configured for high priority access in selected PLMN or to report a
change of 3GPP PS data off UE status; and
b) the UE is neither allowed to initiate the PDU session establishment
procedure nor the PDU session modification procedure for the mapped S-NSSAI of
the respective [S-NSSAI, no DNN] or [S-NSSAI, DNN] combination in all visited
PLMNs unless the UE is a UE configured for high priority access in selected
PLMN or to report a change of 3GPP PS data off UE status.
If the timer T3584 is running or is deactivated for all the PLMNs and is
associated with [no S-NSSAI, no DNN] or [no S-NSSAI, DNN] combination, then
the UE is neither allowed to initiate the PDU session establishment procedure
nor the PDU session modification procedure for [no S-NSSAI, no DNN] or [no
S-NSSAI, DNN] combination in any PLMN unless the UE is a UE configured for
high priority access in selected PLMN or to report a change of 3GPP PS data
off UE status.
If T3585 is running or is deactivated, then the UE is neither allowed to
initiate the PDU session establishment procedure nor the PDU session
modification procedure for the respective S-NSSAI unless the UE is a UE
configured for high priority access in selected PLMN or to report a change of
3GPP PS data off UE status.
If the timer T3585 is running or is deactivated for all the PLMNs, then
a) the UE is neither allowed to initiate the PDU session establishment
procedure nor the PDU session modification procedure for the respective
S-NSSAI in all the PLMNs unless the UE is a UE configured for high priority
access in selected PLMNs or to report a change of 3GPP PS data off UE status;
and
b) the UE is neither allowed to initiate the PDU session establishment
procedure nor the PDU session modification procedure for the mapped S-NSSAI of
the respective S-NSSAI in all visited PLMNs unless the UE is a UE configured
for high priority access in selected PLMN or to report a change of 3GPP PS
data off UE status.
If the timer T3585 is running or is deactivated for all the PLMNs and is
associated with no S-NSSAI, then the UE is neither allowed to initiate the PDU
session establishment procedure nor the PDU session modification procedure for
no S-NSSAI in any PLMN unless the UE is a UE configured for high priority
access in selected PLMN or to report a change of 3GPP PS data off UE status.
### 6.2.9 Interaction with upper layers
#### 6.2.9.1 General
A 5GSM entity may interact with upper layers. Subclause 6.2.9.2 describes how
the 5GSM entity interacts with upper layers with respect to the URSP.
#### 6.2.9.2 URSP
The URSP requires interaction between upper layers and the 5GSM entities in
the UE (see 3GPP TS 24.526 [19] for further details). Each of the 5GSM
entities in the UE shall indicate attributes (e.g. PDU session identity, SSC
mode, S-NSSAI, DNN, PDU session type, access type, PDU address) of a newly
established PDU session to the upper layers. If a PDU session is released, the
5GSM entity handling the PDU session shall inform the PDU session identity of
the released PDU session to the upper layers. The upper layers may request a
5GSM entity:
a) to establish a PDU session indicating one or more PDU session attributes;
b) to release an existing PDU session; or
c) to establish a PDU session indicating one or more PDU session attributes,
and to release an existing PDU session.
### 6.2.10 Handling of 3GPP PS data off
A UE, which supports 3GPP PS data off (see 3GPP TS 23.501 [8]), can be
configured with up to two lists of 3GPP PS data off exempt services as
specified in 3GPP TS 24.368 [17] or in the EF~3GPPPSDATAOFF~ USIM file as
specified in 3GPP TS 31.102 [22]:
a) a list of 3GPP PS data off exempt services to be used in the HPLMN or
EHPLMN; and
b) a list of 3GPP PS data off exempt services to be used in the VPLMN.
If only the list of 3GPP PS data off exempt services to be used in the HPLMN
or EHPLMN is configured at the UE, this list shall be also used in the VPLMN.
If the UE supports 3GPP PS data off, the UE shall provide the 3GPP PS data off
UE status in the extended protocol configuration options IE during UE-
requested PDU session establishment procedure, and UE-requested PDU session
modification procedure (see subclause 6.4.1 and subclause 6.4.2).
The network shall support of 3GPP PS data off.
The UE shall indicate change of the 3GPP PS data off UE status for the PDU
session by using the UE-requested PDU session modification procedure as
specified in subclause 6.4.2.
When the 3GPP PS data off UE status is \"activated\":
a) the UE does not send uplink IP packets via 3GPP access except:
1) for those services indicated in the list of 3GPP PS data off exempt
services to be used in the HPLMN or EHPLMN as specified in 3GPP TS 24.368 [17]
when the UE is in its HPLMN or EHPLMN;
2) for those services indicated in the list of 3GPP PS data off exempt
services to be used in the HPLMN or EHPLMN when the UE is in the VPLMN, if
only the list of 3GPP PS data off exempt services to be used in the HPLMN or
EHPLMN is configured to the UE as specified in 3GPP TS 24.368 [17];
3) for those services indicated in the list of 3GPP PS data off exempt
services to be used in the VPLMN when the UE is in the VPLMN, if the list of
3GPP PS data off exempt services to be used in the VPLMN is configured to the
UE as specified in 3GPP TS 24.368 [17];
4) for those services indicated in the EF3GPPPSDATAOFF USIM file as specified
in 3GPP TS 31.102 [22];
5) any uplink traffic due to procedures specified in 3GPP TS 24.229 [14]; and
6) any uplink traffic due to procedures specified in 3GPP TS 24.623 [20];
b) the UE does not send uplink Ethernet user data packets via 3GPP access; and
c) the UE does not send uplink Unstructured user data packets via 3GPP access.
Otherwise the UE sends uplink user data packets without restriction.
NOTE: If the UE supports 3GPP PS data off, uplink IP packets are filtered as
specified in 3GPP TS 24.229 [14] in U.3.1.5.
3GPP PS data off does not restrict sending of uplink user data packets via
non-3GPP access.
### 6.2.11 Multi-homed IPv6 PDU session
The UE supporting IPv6 may support multi-homed IPv6 PDU session.
If the UE supports the multi-homed IPv6 PDU session:
a) the UE shall support acting as a type C host as specified in IETF RFC 4191
[36]; and
b) the UE indicates support of the multi-homed IPv6 PDU session:
1) during the UE-requested PDU session establishment of a PDU session of
\"IPv6\" or \"IPv4v6\" PDU session type; and
2) during the UE-requested PDU session modification performed after the first
inter-system change from S1 mode to N1 mode, for a PDU session associated with
a PDN connection established when in S1 mode, if the UE is operating in
single-registration mode in the network supporting N26 interface, and the PDU
session is of \"IPv6\" or \"IPv4v6\" PDU session type.
## 6.3 Network-requested 5GSM procedures
### 6.3.1 PDU session authentication and authorization procedure
#### 6.3.1.1 General
The purpose of the PDU session authentication and authorization procedure is
to enable the DN:
a) to authenticate the upper layers of the UE, when establishing the PDU
session;
b) to authorize the upper layers of the UE, when establishing the PDU session;
c) both of the above; or
d) to re-authenticate the upper layers of the UE after establishment of the
PDU session.
The PDU session authentication and authorization procedure can be performed
only during or after the UE-requested PDU session procedure establishing a
non-emergency PDU session. The PDU session authentication and authorization
procedure shall not be performed during or after the UE-requested PDU session
establishment procedure establishing an emergency PDU session.
The network authenticates the UE using the Extensible Authentication Protocol
(EAP) as specified in IETF RFC 3748 [32].
EAP has defined four types of EAP messages:
a) an EAP-request message;
b) an EAP-response message;
c) an EAP-success message; and
d) an EAP-failure message.
The EAP-request message is transported from the network to the UE using the
PDU SESSION AUTHENTICATION COMMAND message of the PDU EAP message reliable
transport procedure.
The EAP-response message to the EAP-request message is transported from the UE
to the network using the PDU SESSION AUTHENTICATION COMPLETE message of the
PDU EAP message reliable transport procedure.
If the PDU session authentication and authorization procedure is performed
during the UE-requested PDU session establishment procedure:
a) and the DN authentication of the UE completes successfully, the EAP-success
message is transported from the network to the UE as part of the UE-requested
PDU session establishment procedure in the PDU SESSION ESTABLISHMENT ACCEPT
message.
b) and the DN authentication of the UE completes unsuccessfully, the EAP-
failure message is transported from the network to the UE as part of the UE-
requested PDU session establishment procedure in the PDU SESSION ESTABLISHMENT
REJECT message.
If the PDU session authentication and authorization procedure is performed
after the UE-requested PDU session establishment procedure:
a) and the DN authentication of the UE completes successfully, the EAP-success
message is transported from the network to the UE using the PDU SESSION
AUTHENTICATION RESULT message of the PDU EAP result message transport
procedure.
b) and the DN authentication of the UE completes unsuccessfully, the EAP-
failure message is transported from the network to the UE using the PDU
SESSION RELEASE COMMAND message of the network-requested PDU session release
procedure.
There can be several rounds of exchange of an EAP-request message and a
related EAP-response message for the DN to complete the authentication and
authorization of the request for a PDU session (see example in figure
6.3.1.1).
The SMF shall set the authenticator retransmission timer specified in IETF RFC
3748 [34] subclause 4.3 to infinite value.
NOTE: The PDU session authentication and authorization procedure provides a
reliable transport of EAP messages and therefore retransmissions at the EAP
layer of the SMF do not occur.
Figure 6.3.1.1: PDU session authentication and authorization procedure
#### 6.3.1.2 PDU EAP message reliable transport procedure
##### 6.3.1.2.1 PDU EAP message reliable transport procedure initiation
In order to initiate the PDU EAP message reliable transport procedure, the SMF
shall create a PDU SESSION AUTHENTICATION COMMAND message.
The SMF shall set the PTI IE of the PDU SESSION AUTHENTICATION COMMAND message
to \"No procedure transaction identity assigned\".
The SMF shall set the EAP message IE of the PDU SESSION AUTHENTICATION COMMAND
message to the EAP-request message provided by the DN or generated locally.
The SMF shall send the PDU SESSION AUTHENTICATION COMMAND message, and the SMF
shall start timer T3590 (see example in figure 6.3.1.1).
Upon receipt of a PDU SESSION AUTHENTICATION COMMAND message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, the UE
passes to the upper layers the EAP message received in the EAP message IE of
the PDU SESSION AUTHENTICATION COMMAND message. Apart from this action, the
authentication and authorization procedure initiated by the DN is transparent
to the 5GSM layer of the UE.
##### 6.3.1.2.2 PDU EAP message reliable transport procedure accepted by the
UE
When the upper layers provide an EAP-response message responding to the
received EAP-request message, the UE shall create a PDU SESSION AUTHENTICATION
COMPLETE message.
The UE shall set the EAP message IE of the PDU SESSION AUTHENTICATION COMPLETE
message to the EAP-response message.
The UE shall transport the PDU SESSION AUTHENTICATION COMPLETE message and the
PDU session ID, using the NAS transport procedure as specified in subclause
5.4.5. Apart from this action, the authentication and authorization procedure
initiated by the DN is transparent to the 5GSM layer of the UE.
Upon receipt of a PDU SESSION AUTHENTICATION COMPLETE message, the SMF shall
stop timer T3590 and provides the EAP message received in the EAP message IE
of the PDU SESSION AUTHENTICATION COMPLETE message to the DN or handles it
locally.
##### 6.3.1.2.3 Abnormal cases on the network side
The following abnormal cases can be identified:
a) T3590 expired.
The SMF shall, on the first expiry of the timer T3590, retransmit the PDU
SESSION AUTHENTICATION COMMAND message and shall reset and start timer T3590.
This retransmission is repeated four times, i.e. on the fifth expiry of timer
T3590, the SMF shall abort the procedure.
##### 6.3.1.2.4 Abnormal cases in the UE
The following abnormal cases can be identified:
a) PDU session inactive for the received PDU session ID.
If the PDU session ID in the PDU SESSION AUTHENTICATION COMMAND message
belongs to any PDU session in state PDU SESSION INACTIVE in the UE, the UE
shall send a 5GSM STATUS message with the 5GSM cause IE set to #43 \"Invalid
PDU session identity\".
b) Collision of UE-requested PDU session release procedure and a PDU session
authentication and authorization procedure.
When the UE receives a PDU SESSION AUTHENTICATION COMMAND message during the
UE-requested PDU session release procedure, and the PDU session indicated in
PDU SESSION AUTHENTICATION COMMAND message is the PDU session that the UE had
requested to release, the UE shall ignore the PDU SESSION AUTHENTICATION
COMMAND message and proceed with the UE-requested PDU session release
procedure.
#### 6.3.1.3 PDU EAP result message transport procedure
##### 6.3.1.3.1 PDU EAP result message transport procedure initiation
In order to initiate the PDU EAP result message transport procedure, the SMF
shall create a PDU SESSION AUTHENTICATION RESULT message.
The SMF shall set the PTI IE of the PDU SESSION AUTHENTICATION RESULT message
to \"No procedure transaction identity assigned\".
The SMF shall set the EAP message IE of the PDU SESSION AUTHENTICATION RESULT
message to the EAP-success message provided by the DN.
The SMF shall send the PDU SESSION AUTHENTICATION RESULT message.
Upon receipt of a PDU SESSION AUTHENTICATION RESULT message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, the UE
passes to the upper layers the EAP message received in the EAP message IE of
the PDU SESSION AUTHENTICATION RESULT message. Apart from this action, the
authentication and authorization procedure initiated by the DN is transparent
to the 5GSM layer of the UE.
### 6.3.2 Network-requested PDU session modification procedure
#### 6.3.2.1 General
The purpose of the network-requested PDU session modification procedure is to
enable the network to modify a PDU session.
#### 6.3.2.2 Network-requested PDU session modification procedure initiation
In order to initiate the network-requested PDU session modification procedure,
the SMF shall create a PDU SESSION MODIFICATION COMMAND message.
If the authorized QoS rules of the PDU session is modified, the SMF shall set
the authorized QoS rules IE of the PDU SESSION MODIFICATION COMMAND message to
the authorized QoS rules of the PDU session. The SMF shall ensure that the
number of the packet filters used in the authorized QoS rules of the PDU
Session does not exceed the maximum number of packet filters supported by the
UE for the PDU session. The SMF may bind service data flows for which the UE
has requested traffic segregation to a dedicated QoS flow for the PDU session,
if possible. Otherwise the SMF may bind the service data flows to an existing
QoS flow. The SMF shall use only one dedicated QoS flow for traffic
segregation. If the UE has requested traffic segregation for multiple service
data flows with different QoS handling, the SMF shall bind all these service
data flows to a single QoS flow. If the SMF allows traffic segregation for
service data flows in a QoS rule, then the SMF shall create a new authorized
QoS rule for these service data flows and shall delete packet filters
corresponding to these service data flows from the other authorized QoS rules.
If the authorized QoS flow descriptions of the PDU session is modified, the
SMF shall set the authorized QoS flow descriptions IE of the PDU SESSION
MODIFICATION COMMAND message to the authorized QoS flow descriptions of the
PDU session.
If SMF creates a new authorized QoS rule for a new QoS flow, then SMF shall
include the authorized QoS flow description for that QoS flow in the
authorized QoS flow descriptions IE of the PDU SESSION MODIFICATION COMMAND
message, if:
a) the newly created authorized QoS rules is for a new GBR QoS flow;
b) the QFI of the new QoS flow is not the same as the 5QI of the QoS flow
identified by the QFI; or
c) the new QoS flow can be mapped to an EPS bearer as specified in subclause
4.11.2 of 3GPP TS 23.502 [9].
If the session-AMBR of the PDU session is modified, the SMF shall set the
selected Session-AMBR IE of the PDU SESSION MODIFICATION COMMAND message to
the session-AMBR of the PDU session.
If interworking with EPS is supported for the PDU session and if the mapped
EPS bearer contexts of the PDU session is modified, the SMF shall set the
mapped EPS bearer contexts IE of the PDU SESSION MODIFICATION COMMAND message
to the mapped EPS bearer contexts of the PDU session. If the association
between a QoS flow and the mapped EPS bearer context is changed, the SMF shall
set the EPS bearer identity parameter in authorized QoS flow descriptions IE
of the PDU SESSION MODIFICATION COMMAND message to the new EPS bearer identity
associated with the QoS flow.
If the network-requested PDU session modification procedure is triggered by a
UE-requested PDU session modification procedure and the PDU SESSION
MODIFICATION REQUEST message includes a 5GSM capability IE, the SMF shall:
a) if the RQoS bit is set to:
1) \"Reflective QoS supported\", consider that the UE supports reflective QoS
for this PDU session; or
2) \"Reflective QoS not supported\", consider that the UE does not support
reflective QoS for this PDU session; and;
b) if the MH6-PDU bit is set to:
1) \"Multi-homed IPv6 PDU session supported\", consider that this PDU session
is supported to use multiple IPv6 prefixes; or
2) \"Multi-homed IPv6 PDU session not supported\", consider that this PDU
session is not supported to use multiple IPv6 prefixes.
If the SMF considers that reflective QoS is supported for QoS flows belonging
to this PDU session, the SMF may include the RQ timer IE set to an RQ timer
value in the PDU SESSION MODIFICATION COMMAND message.
If the network-requested PDU session modification procedure is triggered by a
UE-requested PDU session modification procedure, the PDU session type is
\"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" and the PDU SESSION
MODIFICATION REQUEST message includes a Maximum number of supported packet
filters IE, the SMF shall consider this number as the maximum number of packet
filters that can be supported by the UE for this PDU session. Otherwise the
SMF considers that the UE supports 16 packet filters for this PDU session.
For a PDN connection established when in S1 mode, upon the first inter-system
change from S1 mode to N1 mode, if the network-requested PDU session
modification procedure is triggered by a UE-requested PDU session modification
procedure, the SMF shall consider that the maximum data rate per UE for user-
plane integrity protection supported by the UE for uplink and the maximum data
rate per UE for user-plane integrity protection supported by the UE for
downlink are valid for the lifetime of the PDU session.
For a PDN connection established when in S1 mode, upon the first inter-system
change from S1 mode to N1 mode, if the network-requested PDU session
modification procedure is triggered by a UE-requested PDU session modification
procedure and the SMF determines, based on local policies or configurations in
the SMF and the Always-on PDU session requested IE in the PDU SESSION
MODIFICATION REQUEST message (if available), that either:
a) the requested PDU session needs to be an always-on PDU session, the SMF
shall include the Always-on PDU session indication IE in the PDU SESSION
MODIFICATION COMMAND message and shall set the value to \"Always-on PDU
session required\"; or
b) the requested PDU session shall not be an always-on PDU session and:
i) if the UE included the Always-on PDU session requested IE, the SMF shall
include the Always-on PDU session indication IE in the PDU SESSION
MODIFICATION COMMAND message and shall set the value to \"Always-on PDU
session not allowed\"; or
ii) if the UE did not include the Always-on PDU session requested IE, the SMF
shall not include the Always-on PDU session indication IE in the PDU SESSION
MODIFICATION COMMAND message.
If the value of the RQ timer is set to \"deactivated\" or has a value of zero,
the UE considers that RQoS is not applied for this PDU session and remove the
derived QoS rule(s) associated with the PDU session, if any.
If the network-requested PDU session modification procedure is triggered by a
UE-requested PDU session modification procedure, the SMF shall set the PTI IE
of the PDU SESSION MODIFICATION COMMAND message to the PTI of the PDU SESSION
MODIFICATION REQUEST message received as part of the UE-requested PDU session
modification procedure.
If the network-requested PDU session modification procedure is not triggered
by a UE-requested PDU session modification procedure, the SMF shall set the
PTI IE of the PDU SESSION MODIFICATION COMMAND message to \"No procedure
transaction identity assigned\".
If the selected SSC mode of the PDU session is \"SSC mode 3\" and the SMF
requests the relocation of SSC mode 3 PDU session anchor with multiple PDU
sessions as specified in 3GPP TS 23.502 [9], the SMF shall include 5GSM cause
#39 \"reactivation requested\" , in the PDU SESSION MODIFICATION COMMAND
message, and may include the PDU session address lifetime in a PDU session
address lifetime PCO parameter in the Extended protocol configuration options
IE of the PDU SESSION MODIFICATION COMMAND message.
The SMF shall send the PDU SESSION MODIFICATION COMMAND message, and the SMF
shall start timer T3591 (see example in figure 6.3.2.2.1).
NOTE: If the SMF requests the relocation of SSC mode 3 PDU session anchor with
multiple PDU sessions as specified in 3GPP TS 23.502 [9], the reallocation
requested indication indicating whether the SMF is to be reallocated or the
SMF is to be reused is provided to the AMF.
Figure 6.3.2.2.1: Network-requested PDU session modification procedure
#### 6.3.2.3 Network-requested PDU session modification procedure accepted by
the UE
Upon receipt of the PDU SESSION MODIFICATION COMMAND message, if the UE
provided a DNN during the PDU session establishment, the UE shall stop timer
T3396, if it is running for the DNN provided by the UE. If the UE did not
provide a DNN during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop the timer T3396 associated with no
DNN if it is running. If the PDU SESSION MODIFICATION COMMAND message was
received for an emergency PDU session, the UE shall not stop the timer T3396
associated with no DNN if it is running.
Upon receipt of the PDU SESSION MODIFICATION COMMAND message, if the UE
provided an S-NSSAI and a DNN during the PDU session establishment, the UE
shall stop timer T3584, if it is running for the same [S-NSSAI, DNN]
combination provided by the UE. If the UE did not provide an S-NSSAI during
the PDU session establishment, the UE shall stop timer T3584, if it is running
for the same [no S-NSSAI, DNN] combination provided by the UE. If the UE
provided neither a DNN nor an S-NSSAI during the PDU session establishment,
the UE shall stop timer T3584, if it is running for the same [no S-NSSAI, no
DNN] combination provided by the UE.
Upon receipt of the PDU SESSION MODIFICATION COMMAND message, if the UE
provided an S-NSSAI during the PDU session establishment, the UE shall stop
timer T3585, if it is running for the S-NSSAI provided by the UE. If the UE
did not provide an S-NSSAI during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", the UE shall stop the timer T3585
associated with no S-NSSAI if it is running. If the PDU SESSION MODIFICATION
COMMAND message was received for an emergency PDU session, the UE shall not
stop the timer T3585 associated with no S-NSSAI if it is running.
NOTE 1: Upon receipt of the PDU SESSION MODIFICATION COMMAND message for a PDU
session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI)
when the PDU session is established, timer T3396 associated with the DNN (or
no DNN, if no DNN was provided by the UE) is running, and timer T3584
associated with the DNN (or no DNN, if no DNN was provided by the UE) and the
S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, then
the UE stops both the timer T3396 and the timer T3584.
NOTE 2: Upon receipt of the PDU SESSION MODIFICATION COMMAND message for a PDU
session, if the UE provided a DNN (or no DNN) and an S-NSSAI (or no S-NSSAI)
when the PDU session is established, timer T3585 associated with the S-NSSAI
(or no S-NSSAI, if no S-NSSAI was provided by the UE) is running, and timer
T3584 associated with the DNN (or no DNN, if no DNN was provided by the UE)
and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided by the UE) is
running, then the UE stops both the timer T3585 and the timer T3584.
If the PDU SESSION MODIFICATION COMMAND message includes the Authorized QoS
rules IE, the UE shall process the QoS rules sequentially starting with the
first QoS rule.
The UE shall replace the stored authorized QoS rules, authorized QoS flow
descriptions and session-AMBR of the PDU session with the received value(s),
if any, in the PDU SESSION MODIFICATION COMMAND message.
If the PDU SESSION MODIFICATION COMMAND message includes a Mapped EPS bearer
contexts IE, the UE shall check each mapped EPS bearer context for different
types of errors as follows:
NOTE 3: An error detected in a mapped EPS bearer context does not cause the UE
to discard the Authorized QoS rules IE and Authorized QoS flow descriptions IE
included in the PDU SESSION MODICATION COMMAND message, if any.
a) Semantic error in the mapped EPS bearer operation:
1) operation code = \"Create new EPS bearer\" and there is already an existing
mapped EPS bearer context with the same EPS bearer identity associated with
any PDU session.
2) operation code = \"Delete existing EPS bearer\" and there is no existing
mapped EPS bearer context with the same EPS bearer identity associated with
the PDU session that is being modified.
3) operation code = \"Modify existing EPS bearer\" and there is no existing
mapped EPS bearer context with the same EPS bearer identity associated with
the PDU session that is being modified.
In case 1, if the existing mapped EPS bearer context is associated with the
PDU session that is being modified, the UE shall not diagnose an error,
further process the create request and, if it was process successfully, delete
the old EPS bearer context.
In case 2, the UE shall not diagnose an error, further process the delete
request and, if it was processed successfully, consider the mapped EPS bearer
context as successfully deleted.
Otherwise, after sending the PDU SESSSION MODIFICATION COMPLETE for the
ongoing PDU session modification procedure, the UE shall initiate a PDU
session modification procedure by sending a PDU SESSION MODIFICATION REQUEST
message to delete the mapped EPS bearer context with 5GSM cause #85 \"Invalid
mapped EPS bearer identity\".
b) if the mapped EPS bearer context includes a traffic flow template, the UE
shall check the traffic flow template for different types of TFT IE errors as
follows:
2) Semantic errors in TFT operations:
i) TFT operation = \"Create a new TFT\" when there is already an existing TFT
for the EPS bearer context.
ii) When the TFT operation is an operation other than \"Create a new TFT\" and
there is no TFT for the EPS bearer context.
iii) TFT operation = \"Delete packet filters from existing TFT\" when it would
render the TFT empty.
iv) TFT operation = \"Delete existing TFT\" for a dedicated EPS bearer
context.
In case iv, after sending the PDU SESSSION MODIFICATION COMPLETE for the
ongoing PDU session modification procedure, the UE shall initiate a PDU
session modification procedure by sending a PDU SESSION MODIFICATION REQUEST
message to delete the mapped EPS bearer context with 5GSM cause #41 \"semantic
error in the TFT operation\".
In the other cases the UE shall not diagnose an error and perform the
following actions to resolve the inconsistency:
In case i, the UE shall further process the new activation request and, if it
was processed successfully, delete the old TFT.
In case ii, the UE shall:
\- process the new request and if the TFT operation is \"Delete existing TFT\"
or \"Delete packet filters from existing TFT\", and if no error according to
items b, c, and d was detected, consider the TFT as successfully deleted;
\- process the new request as an activation request, if the TFT operation is
\"Add packet filters in existing TFT\" or \"Replace packet filters in existing
TFT\".
In case iii, if the packet filters belong to a dedicated EPS bearer context,
the UE shall process the new deletion request and, if no error according to
items b, c, and d was detected, after sending the PDU SESSSION MODIFICATION
COMPLETE for the ongoing PDU session modification procedure, the UE shall
initiate a PDU session modification procedure by sending a PDU SESSION
MODIFICATION REQUEST message to delete the mapped EPS bearer context with 5GSM
cause #41 \"semantic error in the TFT operation\".
In case iii, if the packet filters belong to the default EPS bearer context,
the UE shall process the new deletion request and if no error according to
items b, c, and d was detected then delete the existing TFT, this corresponds
to using match-all packet filter for the default EPS bearer context.
2) Syntactical errors in TFT operations:
i) When the TFT operation = \"Create a new TFT\", \"Add packet filters in
existing TFT\", \"Replace packet filters in existing TFT\" or \"Delete packet
filters from existing TFT\" and the packet filter list in the TFT IE is empty.
ii) TFT operation = \"Delete existing TFT\" or \"No TFT operation\" with a
non-empty packet filter list in the TFT IE.
iii) TFT operation = \"Replace packet filters in existing TFT\" when the
packet filter to be replaced does not exist in the original TFT.
iv) TFT operation = \"Delete packet filters from existing TFT\" when the
packet filter to be deleted does not exist in the original TFT.
v) TFT operation = \"Delete packet filters from existing TFT\" with a packet
filter list also including packet filters in addition to the packet filter
identifiers.
vi) When there are other types of syntactical errors in the coding of the TFT
IE, such as a mismatch between the number of packet filters subfield, and the
number of packet filters in the packet filter list.
In case iii, the UE shall not diagnose an error, further process the replace
request and, if no error according to items c and d was detected, include the
packet filters received to the existing TFT.
In case iv, the UE shall not diagnose an error, further process the deletion
request and, if no error according to items c and d was detected, consider the
respective packet filter as successfully deleted.
Otherwise, after sending the PDU SESSSION MODIFICATION COMPLETE for the
ongoing PDU session modification procedure, the UE shall initiate a PDU
session modification procedure by sending a PDU SESSION MODIFICATION REQUEST
message to delete the mapped EPS bearer context with 5GSM cause #42
\"syntactical error in the TFT operation\".
3) Semantic errors in packet filters:
i) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
ii) When the resulting TFT, which is assigned to a dedicated EPS bearer
context, does not contain any packet filter applicable for the uplink
direction among the packet filters created on request from the network.
After sending the PDU SESSSION MODIFICATION COMPLETE for the ongoing PDU
session modification procedure, the UE shall initiate a PDU session
modification procedure by sending a PDU SESSION MODIFICATION REQUEST message
to delete the mapped EPS bearer context with 5GSM cause #44 \"semantic errors
in packet filter(s)\".
4) Syntactical errors in packet filters:
i) When the TFT operation = \"Create a new TFT\", \"Add packet filters to
existing TFT\", and two or more packet filters in the resultant TFT would have
identical packet filter identifiers.
ii) When the TFT operation = \"Create a new TFT\", \"Add packet filters to
existing TFT\" or \"Replace packet filters in existing TFT\", and two or more
packet filters among all TFTs associated with this PDN connection would have
identical packet filter precedence values.
iii) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
In case i, if two or more packet filters with identical packet filter
identifiers are contained in the new request, after sending the PDU SESSSION
MODIFICATION COMPLETE for the ongoing PDU session modification procedure, the
UE shall initiate a PDU session modification procedure by sending a PDU
SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context
with 5GSM cause #45 \"syntactical error in packet filter(s)\". Otherwise, the
UE shall not diagnose an error, further process the new request and, if it was
processed successfully, delete the old packet filters which have the identical
packet filter identifiers.
In case ii, if the old packet filters do not belong to the default EPS bearer
context, the UE shall not diagnose an error, shall further process the new
request and, if it was processed successfully, shall delete the old packet
filters which have identical filter precedence values.
In case ii, if one or more old packet filters belong to the default EPS bearer
context, after sending the PDU SESSSION MODIFICATION COMPLETE for the ongoing
PDU session modification procedure, the UE shall initiate a PDU session
modification procedure by sending a PDU SESSION MODIFICATION REQUEST message
to delete the mapped EPS bearer context with 5GSM cause #45 \"syntactical
errors in packet filter(s)\".
Otherwise, after sending the PDU SESSSION MODIFICATION COMPLETE for the
ongoing PDU session modification procedure, the UE shall initiate a PDU
session modification procedure by sending a PDU SESSION MODIFICATION REQUEST
message to delete the mapped EPS bearer context with 5GSM cause #45
\"syntactical error in packet filter(s)\".
And if a new EPS bearer identity parameter in authorized QoS flow descriptions
IE is received for a QoS flow which can be transferred to EPS, the UE shall
update the association between the QoS flow and the mapped EPS bearer context,
based on the new EPS bearer identity and the mapped EPS bearer contexts. If
the \"Delete existing EPS bearer\" operation code in the Mapped EPS bearer
contexts IE was received, the UE shall discard the association between the QoS
flow and the corresponding mapped EPS bearer context.
Upon receipt of a PDU SESSION MODIFICATION COMMAND message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, if the
UE accepts the PDU SESSION MODIFICATION COMMAND message, the UE considers the
PDU session as modified and the UE shall create a PDU SESSION MODIFICATION
COMPLETE message.
If the PDU SESSION MODIFICATION COMMAND message contains the PTI value
allocated in the UE-requested PDU session modification procedure, the UE shall
stop the timer T3581. The UE should ensure that the PTI value assigned to this
procedure is not released immediately.
NOTE 4: The way to achieve this is implementation dependent. For example, the
UE can ensure that the PTI value assigned to this procedure is not released
during the time equal to or greater than the default value of timer T3591.
While the PTI value is not released, the UE regards any received PDU SESSION
MODIFICATION COMMAND message with the same PTI value as a network
retransmission (see subclause 7.3.1).
If the selected SSC mode of the PDU session is \"SSC mode 3\" and the PDU
SESSION MODIFICATION COMMAND message includes 5GSM cause #39 \"reactivation
requested\", the UE can provide to the upper layers the PDU session address
lifetime if received in the PDU session address lifetime PCO parameter of the
Extended protocol configuration options IE of the PDU SESSION MODIFICATION
COMMAND message. After the completion of the network-requested PDU session
modification procedure, the UE should re-initiate the UE-requested PDU session
establishment procedure with a new PDU session ID as specified in subclause
6.4.1 for:
a) the PDU session type associated with the present PDU session;
b) the SSC mode associated with the present PDU session;
c) the DNN associated with the present PDU session; and
d) the S-NSSAI associated with (if available in roaming scenarios) a mapped
S-NSSAI if provided in the UE-requested PDU session establishment procedure of
the present PDU session.
The UE shall include the PDU session ID of the old PDU session which is about
to get released in the old PDU session ID IE of the UL NAS TRANSPORT message
that transports the PDU SESSION ESTABLISHMENT REQUEST message.
NOTE 5: The UE is expected to maintain the PDU session for which the PDU
SESSION MODIFICATION COMMAND message including 5GSM cause #39 \"reactivation
requested\" is received during the time indicated by the PDU session address
lifetime value or until receiving an indication from upper layers (e.g. that
the old PDU session is no more needed).
If the selected PDU session type of the PDU session is \"Unstructured\" or
\"Ethernet\", the UE supports inter-system change from N1 mode to S1 mode, the
UE does not support establishment of a PDN connection for the PDN type set to
\"non-IP\" in S1 mode, and the parameters list field of one or more authorized
QoS flow descriptions received in the authorized QoS flow descriptions IE of
the PDU SESSION MODIFICATION COMMAND message contains an EPS bearer identity
(EBI) then the UE shall locally remove the EPS bearer identity (EBI) from the
parameters list field of such one or more authorized QoS flow descriptions.
If the Always-on PDU session indication IE is included in the PDU SESSION
MODIFICATION COMMAND message and:
a) the value of the IE is set to \"Always-on PDU session required\", the UE
shall consider the established PDU session as an always-on PDU session; or
b) the value of the IE is set to \"Always-on PDU session not allowed\", the UE
shall not consider the established PDU session as an always-on PDU session.
If the UE does not receive the Always-on PDU session indication IE in the PDU
SESSION MODIFICATION COMMAND message:
a) if the network-requested PDU session modification procedure is triggered by
a UE-requested PDU session modification procedure upon the first inter-system
change from S1 mode to N1 mode for a PDN connection established when in S1
mode, the UE shall not consider the modified PDU session as an always-on PDU
session; or
b) otherwise:
1) if the UE has received the Always-on PDU session indication IE with the
value set to \"Always-on PDU session required\" for this PDU session, the UE
shall consider the PDU session as an always-on PDU session; or
2) otherwise the UE shall not consider the PDU session as an always-on PDU
session.
The UE shall transport the PDU SESSION MODIFICATION COMPLETE message and the
PDU session ID, using the NAS transport procedure as specified in subclause
5.4.5.
After sending the PDU SESSION MODIFICATION COMPLETE message, if the \"Create
new EPS bearer\" operation code in the mapped EPS bearer contexts IE was
received in the PDU SESSION MODIFICATION COMMAND message and there is neither
a corresponding authorized QoS flow descriptions IE in the PDU SESSION
MODIFICATION COMMAND message nor an existing QoS flow description
corresponding to the EPS bearer identity included in the mapped EPS bearer
context, the UE shall send a PDU SESSION MODIFICATION REQUEST message
including a mapped EPS bearer contexts IE to delete the mapped EPS bearer
context.
Upon receipt of a PDU SESSION MODIFICATION COMPLETE message, the SMF shall
stop timer T3591 and shall consider the PDU session as modified. If the
selected SSC mode of the PDU session is \"SSC mode 3\" and the PDU SESSION
MODIFICATION COMMAND message included 5GSM cause #39 \"reactivation
requested\", the SMF shall start timer T3593. If the PDU Session Address
Lifetime value is sent to the UE in the PDU SESSION MODIFICATION COMMAND
message then timer T3593 shall be started with the same value, otherwise it
shall use a default value.
#### 6.3.2.4 Network-requested PDU session modification procedure not accepted
by the UE
Upon receipt of a PDU SESSION MODIFICATION COMMAND message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, if the
UE rejects the PDU SESSION MODIFICATION COMMAND message, the UE shall create a
PDU SESSION MODIFICATION COMMAND REJECT message.
If the PDU SESSION MODIFICATION COMMAND message contains the PTI value
allocated in the UE-requested PDU session modification procedure, the UE shall
stop the timer T3581. The UE should ensure that the PTI value assigned to this
procedure is not released immediately.
NOTE 1: The way to achieve this is implementation dependent. For example, the
UE can ensure that the PTI value assigned to this procedure is not released
during the time equal to or greater than the default value of timer T3591.
While the PTI value is not released, the UE regards any received PDU SESSION
MODIFICATION COMMAND message with the same PTI value as a network
retransmission (see subclause 7.3.1).
The UE shall set the 5GSM cause IE of the PDU SESSION MODIFICATION COMMAND
REJECT message to indicate the reason for rejecting the PDU session
modification.
The 5GSM cause IE typically indicates one of the following 5GSM cause values:
#26 insufficient resources;
#43 invalid PDU session identity;
#44 semantic error in packet filter(s);
#45 syntactical error in packet filter(s);
#83 semantic error in the QoS operation; or
#84 syntactical error in the QoS operation.
If the selected SSC mode of the PDU session is \"SSC mode 3\" and the PDU
SESSION MODIFICATION COMMAND messages includes 5GSM cause #39 \"reactivation
requested\", while the UE does not have sufficient resources for initiating
the PDU session establishment procedure as specified in subclause 6.4.1 then
the UE shall set cause IE to #26 \"insufficient resources\".
If the PDU SESSION MODIFICATION COMMAND message includes a request to add a
new authorized QoS rule, or a request to modify the authorized QoS rules, or
both, and the UE decides to reject the request due to e.g. the supported
number of authorized QoS rules or number of packet filters associated with a
PDU session having reached the maximum number, then the UE shall set the 5GSM
cause IE to #26 \"insufficient resources\".
NOTE 2: The maximum number of supported authorized QoS rules or packet filters
associated with a PDU session is implementation specific.
If the PDU SESSION MODIFICATION COMMAND message includes a request to add a
new authorized QoS flow description, or a request to modify the authorized QoS
flow descriptions, or both and the UE decides to reject the request due to
e.g. the supported number of authorized QoS flow descriptions, then the UE
shall set the 5GSM cause IE to #26 \"insufficient resources\".
NOTE 3: The maximum number of supported authorized QoS flow descriptions
associated with a PDU session is implementation specific.
If the PDU SESSION MODIFICATION COMMAND message includes the Authorized QoS
rules IE, the UE shall process the QoS rules sequentially starting with the
first QoS rule. The UE shall check the QoS rule and the QoS flow description
provided in the PDU SESSION MODIFICATION COMMAND message for different types
of errors as follows:
a) Semantic errors in QoS operations:
1) When the rule operation is \"Modify existing QoS rule and add packet
filters\", \"Modify existing QoS rule and replace all packet filters\",
\"Modify existing QoS rule and delete packet filters\" or \"Modify existing
QoS rule without modifying packet filters\" on the default QoS rule and the
DQR bit is set to \"the QoS rule is not the default QoS rule\".
2) When the rule operation is \"Modify existing QoS rule and add packet
filters\", \"Modify existing QoS rule and replace all packet filters\",
\"Modify existing QoS rule and delete packet filters\" or \"Modify existing
QoS rule without modifying packet filters\" on a QoS rule which is not the
default QoS rule and the DQR bit is set to \"the QoS rule is the default QoS
rule\".
3) When the rule operation is \"Create new QoS rule\" and the DQR bit is set
to \"the QoS rule is the default QoS rule\" when there\'s already a default
QoS rule.
4) When the rule operation is \"Delete existing QoS rule\" on the default QoS
rule.
5) When the rule operation is \"Create new QoS rule\", \"Modify existing QoS
rule and add packet filters\", \"Modify existing QoS rule and replace all
packet filters\", \"Modify existing QoS rule and delete packet filters \", or
\"Modify existing QoS rule without modifying packet filters\" and two or more
QoS rules associated with this PDU session would have identical precedence
values.
6) When the rule operation is \"Modify existing QoS rule and delete packet
filters\", the QoS rule is a QoS rule of a PDU session of IPv4, IPv6, IPv4v6
or Ethernet PDU session type, and the packet filter list in the resultant QoS
rule is empty.
7) When the rule operation is \"Create new QoS rule\" and there is already an
existing QoS rule with the same QoS rule identifier.
8) When the rule operation is \"Modify existing QoS rule and add packet
filters\", \"Modify existing QoS rule and replace all packet filters\",
\"Modify existing QoS rule and delete packet filters\" or \"Modify existing
QoS rule without modifying packet filters\" and the associated QoS rule does
not exist.
9) When the rule operation is \"Delete existing QoS rule\" and there is no
existing QoS rule with the same QoS rule identifier.
10) When the flow description operation is \"Create new QoS flow description\"
and there is already an existing QoS flow description with the same QoS flow
identifier.
11) When the flow description operation is \"Modify existing QoS flow
description\" and the associated QoS flow description does not exist.
12) When the flow description operation is \"Delete existing QoS flow
description\" and there is no existing QoS flow description with the same QoS
flow identifier. In case 4, the UE shall initiate a PDU session release
procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83
\"semantic error in the QoS operation\".
In case 5, if the old QoS rule is not the default QoS rule, the UE shall not
diagnose an error, shall further process the new request and, if it was
processed successfully, shall delete the old QoS rule which has identical
precedence value. Furthermore, the UE shall send a PDU SESSION MODIFICATION
REQUEST message with 5GSM cause #83 \"semantic error in the QoS operation\" to
delete the QoS rule.
In case 5, if the QoS rule is the default QoS rule, the UE shall initiate a
PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message
with 5GSM cause #83 \"semantic error in the QoS operation\".
In case 6, if the QoS rule is not the default QoS rule, the UE shall send a
PDU SESSION MODIFICATION REQUEST message with 5GSM cause #83 \"semantic error
in the QoS operation\" to delete the QoS rule.
In case 6, if the QoS rule is the default QoS rule, the UE shall initiate a
PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message
with 5GSM cause #83 \"semantic error in the QoS operation\".
In case 7, if the QoS rule is not the default QoS rule, the UE shall not
diagnose an error, further process the create request and, if it was processed
successfully, delete the old QoS rule.
In case 9, the UE shall not diagnose an error, further process the delete
request and, if it was processed successfully, consider the respective QoS
rule as successfully deleted.
In case 10, the UE shall not diagnose an error, further process the create
request and, if it was processed successfully, delete the old QoS flow
description.
In case 12, the UE shall not diagnose an error, further process the delete
request and, if it was processed successfully, consider the respective QoS
flow description as successfully deleted.
Otherwise, the UE shall reject the PDU SESSION MODIFICATION COMMAND message
with 5GSM cause #83 \"semantic error in the QoS operation\".
b) Syntactical errors in QoS operations:
1) When the rule operation is \"Create new QoS rule\", \"Modify existing QoS
rule and add packet filters\", \"Modify existing QoS rule and replace packet
filters\" or \"Modify existing QoS rule and delete packet filters\" and the
packet filter list in the QoS rule is empty.
2) When the rule operation is \"Delete existing QoS rule\" or \"Modify
existing QoS rule without modifying packet filters\" with a non-empty packet
filter list in the QoS rule.
3) When the rule operation is \"Modify existing QoS rule and delete packet
filters\" and the packet filter to be deleted does not exist in the original
QoS rule.
4) When the rule operation is \"Modify existing QoS rule and delete packet
filters\" with a packet filter list also including packet filters in addition
to the packet filter identifiers.
5) When there are other types of syntactical errors in the coding of the QoS
rules IE, such as a mismatch between the number of packet filters subfield,
and the number of packet filters in the packet filter list.
6) When, the
A) rule operation is \"Create new QoS rule\", the UE determines that there is
a resulting QoS rule for a GBR QoS flow (as described in 3GPP TS 23.501 [8]
table 5.7.4-1), and there is no QoS flow description with a QFI corresponding
to the QFI of the resulting QoS rule.
B) flow description operation is \"Delete existing QoS flow description\", and
the UE determines that there is a resulting QoS rule for a GBR QoS flow (as
described in 3GPP TS 23.501 [8] table 5.7.4-1) with a QFI corresponding to the
QFI of the QoS flow description that is deleted (i.e. there is no associated
QoS flow description with the same QFI).
In case 3 the UE shall not diagnose an error, further process the deletion
request and, if no error according to items c and d was detected, consider the
respective packet filter as successfully deleted.
In case 6, if the QoS rules IE contains at least one other valid QoS rule, the
UE shall not diagnose an error and shall further process the request, if no
error according to items c and d was detected. After completion of the PDU
session modification procedure, the UE shall delete the QoS rule for which no
corresponding QoS flow description is available and initiate UE requested PDU
session modification procedure to delete the QoS rule for which it has
deleted.
Otherwise the UE shall reject the PDU SESSION MODIFICATION COMMAND message
with 5GSM cause #84 \"syntactical error in the QoS operation\".
c) Semantic errors in packet filters:
1) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
The UE shall reject the PDU SESSION MODIFICATION COMMAND message with 5GSM
cause #44 \"semantic error in packet filter(s)\".
d) Syntactical errors in packet filters:
1) When the rule operation is \"Create new QoS rule\", \"Modify existing QoS
rule and add packet filters\" or \"Modify existing QoS rule and replace all
packet filters\", and two or more packet filters in the resultant QoS rule
would have identical packet filter identifiers.
2) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
In case 1, if two or more packet filters with identical packet filter
identifiers are contained in the PDU SESSION MODIFICATION COMMAND message, the
UE shall reject the PDU SESSION MODIFICATION COMMAND with 5GSM cause #45
\"syntactical errors in packet filter(s)\". Otherwise, the UE shall not
diagnose an error, further process the PDU SESSION MODIFICATION COMMAND
message and, if it was processed successfully, replace the old packet filter
with the new packet filter which have the identical packet filter identifiers.
Otherwise the UE shall reject the PDU SESSION MODIFICATION COMMAND message
with 5GSM cause #45 \"syntactical errors in packet filter(s)\".
The UE shall transport the PDU SESSION MODIFICATION COMMAND REJECT message and
the PDU session ID, using the NAS transport procedure as specified in
subclause 5.4.5.
Upon receipt of a PDU SESSION MODIFICATION COMMAND REJECT message with 5GSM
cause value other than #43 \"invalid PDU session identity\" in state PDU
SESSION MODIFICATION PENDING, the SMF shall stop timer T3591, enter the state
PDU SESSION ACTIVE and abort the PDU session modification procedure.
#### 6.3.2.5 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Expiry of timer T3591.
On the first expiry of the timer T3591, the SMF shall resend the PDU SESSION
MODIFICATION COMMAND message and shall reset and restart timer T3591. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3591, the SMF shall abort the procedure and enter the state PDU SESSION
ACTIVE.
The SMF may continue to use the previous configuration of the PDU session or
initiate the network-requested PDU session release procedure.
b) Invalid PDU session identity.
Upon receipt of the PDU SESSION MODIFICATION COMMAND REJECT message including
5GSM cause #43 \"invalid PDU session identity\", the SMF shall release locally
the existing PDU session.
c) Collision of UE-requested PDU session release procedure and network-
requested PDU session modification procedure.
If the SMF receives a PDU SESSION RELEASE REQUEST message during the network-
requested PDU session modification procedure, and the PDU session indicated in
the PDU SESSION RELEASE REQUEST message is the PDU session that the SMF had
requested to modify, the SMF shall abort the PDU session modification
procedure and proceed with the UE-requested PDU session release procedure.
d) Collision of UE-requested PDU session modification procedure and network-
requested PDU session modification procedure.
If the network receives a PDU SESSION MODIFICATION REQUEST message during the
network-requested PDU session modification procedure, and the PDU session
indicated in the PDU SESSION MODIFICATION REQUEST message is the PDU session
that the network had requested to modify, the network shall ignore the PDU
SESSION MODIFICATION REQUEST message received in the state PDU SESSION
MODIFICATION PENDING. The network shall proceed with the network-requested PDU
session modification procedure as if no PDU SESSION MODIFICATION REQUEST
message was received from the UE.
#### 6.3.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) PDU session inactive for the received PDU session ID.
If the PDU session ID in the PDU SESSION MODIFICATION COMMAND message belongs
to any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall set
the 5GSM cause IE to #43 \"Invalid PDU session identity\" in the 5GSM STATUS
message, and set the PDU session ID to the received PDU session ID in the UL
NAS TRANSPORT message as specified in subclause 5.4.5.
b) Collision of network-requested PDU session modification procedure and UE-
requested PDU session modification procedure.
If the UE receives a PDU SESSION MODIFICATION COMMAND message during the UE-
requested PDU session modification procedure, the PTI IE of the PDU SESSION
MODIFICATION COMMAND message is set to \"No procedure transaction identity
assigned\", and the PDU session indicated in the PDU SESSION MODIFICATION
COMMAND message is the PDU session that the UE had requested to modify, the UE
shall abort internally the UE-requested PDU session modification procedure,
enter the state PDU SESSION ACTIVE and proceed with the network-requested PDU
session modification procedure.
### 6.3.3 Network-requested PDU session release procedure
#### 6.3.3.1 General
The purpose of the network-requested PDU session release procedure is to
enable the network to release a PDU session.
#### 6.3.3.2 Network-requested PDU session release procedure initiation
In order to initiate the network-requested PDU session release procedure, the
SMF shall create a PDU SESSION RELEASE COMMAND message.
The SMF shall set the 5GSM cause IE of the PDU SESSION RELEASE COMMAND message
to indicate the reason for releasing the PDU session.
The 5GSM cause IE typically indicates one of the following 5GSM cause values:
#8 operator determined barring;
#26 insufficient resources;
#29 user authentication or authorization failed;
#36 regular deactivation;
#38 network failure;
#39 reactivation requested;
#46 out of LADN service area;
#67 insufficient resources for specific slice and DNN;
#69 insufficient resources for specific slice.
If the selected SSC mode of the PDU session is \"SSC mode 2\" and the SMF
requests the relocation of SSC mode 2 PDU session anchor with different PDU
sessions as specified in 3GPP TS 23.502 [9], the SMF shall include 5GSM cause
#39 \"reactivation requested\".
If the network-requested PDU session release procedure is triggered by a UE-
requested PDU session release procedure, the SMF shall set the PTI IE of the
PDU SESSION RELEASE COMMAND message to the PTI of the PDU SESSION RELEASE
REQUEST message received as part of the UE-requested PDU session release
procedure.
If the network-requested PDU session release procedure is not triggered by a
UE-requested PDU session release procedure, the SMF shall set the PTI IE of
the PDU SESSION RELEASE COMMAND message to \"No procedure transaction identity
assigned\".
If the SMF receives an event notification from the AMF that the UE is out of
the LADN service area and the SMF decides to release the PDU session, the SMF
shall include the 5GSM cause value #46 \"out of LADN service area\" in the
5GSM cause IE of the PDU SESSION RELEASE COMMAND message. Upon receipt of the
5GSM cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the
PDU SESSION RELEASE COMMAND message, the UE shall release the PDU session.
The SMF may include a Back-off timer value IE in the PDU SESSION RELEASE
COMMAND message when the 5GSM cause value #26 \"insufficient resources\" is
included in the PDU SESSION RELEASE COMMAND message. If the 5GSM cause value
is #26 \"insufficient resources\" and the PDU SESSION RELEASE COMMAND message
is sent to a UE configured for high priority access in selected PLMN or the
request type was set to \"initial emergency request\" or \"existing emergency
PDU session\" for the establishment of the PDU session, the network shall not
include a Back-off timer value IE.
The SMF may include a Back-off timer value IE in the PDU SESSION RELEASE
COMMAND message when the 5GSM cause value #67 \"insufficient resources for
specific slice and DNN\" is included in the PDU SESSION RELEASE COMMAND
message. If the 5GSM cause value is #67 \"insufficient resources for specific
slice and DNN\" and the PDU SESSION RELEASE COMMAND message is sent to a UE
configured for high priority access in selected PLMN or the request type was
set to \"initial emergency request\" or \"existing emergency PDU session\" for
the establishment of the PDU session, the network shall not include a Back-off
timer value IE.
The SMF may include a Back-off timer value IE in the PDU SESSION RELEASE
COMMAND message when the 5GSM cause #69 \"insufficient resources for specific
slice\" is included in the PDU SESSION RELEASE COMMAND message. If the 5GSM
cause value is #69 \"insufficient resources for specific slice\" and the PDU
SESSION RELEASE COMMAND message is sent to a UE configured for high priority
access in selected PLMN or the request type was set to \"initial emergency
request\" or \"existing emergency PDU session\" for the establishment of the
PDU session, the network shall not include a Back-off timer value IE.
The SMF shall send:
a) the PDU SESSION RELEASE COMMAND message; and
b) if the SMF allows the AMF to skip sending of the N1 SM container to the UE
and the 5GSM cause IE is not set to #39 \"reactivation requested\", the N1 SM
delivery skip allowed indication;
towards the AMF, and the SMF shall start timer T3592 (see example in figure
6.3.3.2.1).
Figure 6.3.3.2.1: Network-requested PDU session release procedure
#### 6.3.3.3 Network-requested PDU session release procedure accepted by the
UE
Upon receipt of a PDU SESSION RELEASE COMMAND message and a PDU session ID,
using the NAS transport procedure as specified in subclause 5.4.5, the UE
considers the PDU session as released and the UE shall create a PDU SESSION
RELEASE COMPLETE message.
If the PDU SESSION RELEASE COMMAND message contains the PTI value allocated in
the UE-requested PDU session release procedure, the UE shall stop the timer
T3582. The UE should ensure that the PTI value assigned to this procedure is
not released immediately.
NOTE 1: The way to achieve this is implementation dependent. For example, the
UE can ensure that the PTI value assigned to this procedure is not released
during the time equal to or greater than the default value of timer T3592.
While the PTI value is not released, the UE regards any received PDU SESSION
RELEASE COMMAND message with the same PTI value as a network retransmission
(see subclause 7.3.1).
If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39
\"reactivation requested\", then after completion of the network-requested PDU
session release procedure, the UE should re-initiate the UE-requested PDU
session establishment procedure as specified in subclause 6.4.1 for:
a) the PDU session type associated with the released PDU session;
b) the SSC mode associated with the released PDU session;
c) the DNN associated with the released PDU session; and
d) the S-NSSAI associated with (if available in roaming scenarios) a mapped
S-NSSAI if provided in the UE-requested PDU session establishment procedure of
the released PDU session.
If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39
\"reactivation requested\" and the UE provided an S-NSSAI during the PDU
session establishment, the UE shall stop timer T3585 if it is running for the
S-NSSAI provided by the UE. The UE should then re-initiate the UE requested
PDU session establishment procedure for the same S-NSSAI. If the UE did not
provide an S-NSSAI during the PDU session establishment and the request type
was different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop the timer T3585 associated with no
S-NSSAI if it is running, and should re-initiate the UE requested PDU session
establishment procedure without including an S-NSSAI. If the PDU SESSION
RELEASE COMMAND message was received for an emergency PDU session, the UE
shall not stop the timer T3585 associated with no S-NSSAI if it is running.
If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39
\"reactivation requested\" and the UE provided a DNN during the PDU session
establishment, the UE shall stop timer T3396 if it is running for the DNN
provided by the UE. The UE should then re-initiate the UE requested PDU
session establishment procedure for the same DNN. If the UE did not provide a
DNN during the PDU session establishment and the request type was different
from \"initial emergency request\" and different from \"existing emergency PDU
session\", the UE shall stop the timer T3396 associated with no DNN if it is
running, and should re-initiate the UE requested PDU session establishment
procedure without including a DNN. If the PDU SESSION RELEASE COMMAND message
was received for an emergency PDU session, the UE shall not stop the timer
T3396 associated with no DNN if it is running.
If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39
\"reactivation requested\" and the UE provided an S-NSSAI and a DNN during the
PDU session establishment, the UE shall stop timer T3584 if it is running for
the same [S-NSSAI, DNN] combination provided by the UE. The UE should then re-
initiate the UE requested PDU session establishment procedure for the same
[S-NSSAI, DNN] combination. If the UE did not provide an S-NSSAI during the
PDU session establishment, the UE shall stop the timer T3584 associated with
[no S-NSSAI, DNN] if it is running, and should re-initiate the UE requested
PDU session establishment procedure with the same DNN but without an S-NSSAI.
If the UE did not provide a DNN during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", the UE shall stop the timer T3584
associated with [S-NSSAI, no DNN] if it is running, and should re-initiate the
UE requested PDU session establishment procedure with the same S-NSSAI but
without a DNN. If the PDU SESSION RELEASE COMMAND message was received for an
emergency PDU session, the UE shall not stop the timer T3584 associated with
[S-NSSAI, no DNN] if it is running. If the UE provided neither a DNN nor an
S-NSSAI during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop the timer T3584 associated with [no
S-NSSAI, no DNN] if it is running, and should re-initiate the UE requested PDU
session establishment procedure without an S-NSSAI and a DNN. If the PDU
SESSION RELEASE COMMAND message was received for an emergency PDU session, the
UE shall not stop the timer T3584 associated with [no S-NSSAI, no DNN] if it
is running.
NOTE 2: User interaction is necessary in some cases when the UE cannot re-
initiate the UE-requested PDU session establishment procedure automatically.
NOTE 3: If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39
\"reactivation requested\" for a PDU session, the UE provided a DNN (or no
DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer
T3396 associated with the DNN (or no DNN, if no DNN was provided by the UE) is
running, and timer T3584 associated with the DNN (or no DNN, if no DNN was
provided by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided
by the UE) is running, then the UE stops both the timer T3396 and the timer
T3584.
NOTE 4: If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #39
\"reactivation requested\" for a PDU session, the UE provided a DNN (or no
DNN) and an S-NSSAI (or no S-NSSAI) when the PDU session is established, timer
T3585 associated with the S-NSSAI (or no S-NSSAI, if no S-NSSAI was provided
by the UE) is running, and timer T3584 associated with the DNN (or no DNN, if
no DNN was provided by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI
was provided by the UE) is running, then the UE stops both the timer T3585 and
the timer T3584.
If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #26
\"insufficient resources\" and the Back-off timer value IE, the UE shall
ignore the 5GSM congestion re-attempt indicator IE provided by the network, if
any, and the UE shall take different actions depending on the timer value
received for timer T3396 in the Back-off timer value:
a) If the timer value indicates neither zero nor deactivated and a DNN was
provided during the PDU session establishment, the UE shall stop timer T3396
associated with the corresponding DNN, if it is running. If the timer value
indicates neither zero nor deactivated and no DNN was provided during the PDU
session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\", the
UE shall stop timer T3396 associated with no DNN if it is running. The UE
shall then start timer T3396 with the value provided in the Back-off timer
value IE and:
1) shall not send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for the same DNN that was sent by the UE, until timer T3396 expires
or timer T3396 is stopped; and
2) shall not send a PDU SESSION ESTABLISHMENT REQUEST message without an DNN
and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or a PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an DNN provided
by the UE, if no DNN was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", until timer T3396 expires or timer
T3396 is stopped.
The UE shall not stop timer T3396 upon a PLMN change or inter-system change;
b) if the timer value indicates that this timer is deactivated and a DNN was
provided during the PDU session establishment, the UE shall stop timer T3396
associated with the corresponding DNN, if it is running. If the timer value
indicates that this timer is deactivated and no DNN was provided during the
PDU session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\", the
UE shall stop timer T3396 associated with no DNN if it is running. The UE:
1) shall not send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for the same DNN until the UE is switched off or the USIM is removed,
or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same DNN
from the network or a PDU SESSION RELEASE COMMAND message including 5GSM cause
#39 \"reactivation requested\" for the same DNN from the network; and
2) shall not send a PDU SESSION ESTABLISHMENT REQUEST message without an DNN
and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or a PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an DNN provided
by the UE, if no DNN was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", until the UE is switched off or the
USIM is removed, or the UE receives a PDU SESSION MODIFICATION COMMAND message
for a non-emergency PDU session established without an DNN provided by the UE,
or a PDU SESSION RELEASE COMMAND message including 5GSM cause IE set to 5GSM
cause #39 \"reactivation requested\" for a non-emergency PDU session
established without an DNN provided by the UE.
The timer T3396 remains deactivated upon a PLMN change or inter-system change;
and
c) if the timer value indicates zero, the UE:
1) shall stop timer T3396 associated with the corresponding DNN, if running,
and may send a PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION
MODIFICATION REQUEST message for the same DNN; and
2) if no DNN was provided during the PDU session establishment and the request
type was different from \"initial emergency request\" and different from
\"existing emergency PDU session\", the UE shall stop timer T3396 associated
with no DNN, if running, and may send a PDU SESSION ESTABLISHMENT REQUEST
message without a DNN, or a PDU SESSION MODIFICATION REQUEST message without
an DNN provided by the UE.
If the PDU SESSION RELEASE COMMAND message includes 5GSM cause #26
\"insufficient resources\" and the Back-off timer value IE is not included,
then the UE may send a PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST message for the same DNN or without a DNN.
When the timer T3396 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3396 is running when the UE enters state 5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3396 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3396 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3396 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If the 5GSM cause value is #67 \"insufficient resources for specific slice and
DNN\" and the Back-off timer value IE is included, the UE shall take different
actions depending on the timer value received for timer T3584 in the Back-off
timer value:
a) If the timer value indicates neither zero nor deactivated, the UE shall
stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that
the UE provided when the PDU session is established, if it is running. The UE
shall then start timer T3584 with the value provided in the Back-off timer
value IE.
The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or PDU SESSION MODIFICATION REQUEST
message with exception of those identified in subclause 6.4.2.1, for the same
[S-NSSAI, DNN] combination that was sent by the UE, until timer T3584 expires
or timer T3584 is stopped;
The UE shall not stop timer T3584 upon a PLMN change or inter-system change;
b) if the timer value indicates that this timer is deactivated, the UE shall
stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that
the UE provided when the PDU session is established, if it is running.
The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or PDU SESSION MODIFICATION REQUEST
message with exception of those identified in subclause 6.4.2.1, for the same
[S-NSSAI, DNN] combination that was sent by the UE, until the UE is switched
off or the USIM is removed, or the UE receives a PDU SESSION MODIFICATION
REQUEST message for the same [S-NSSAI, DNN] combination from the network or a
PDU SESSION RELEASE COMMAND message including 5GSM cause #39 \"reactivation
requested\" for the same [S-NSSAI, DNN] combination from the network; and
The timer T3584 remains deactivated upon a PLMN change or inter-system change;
and
c) if the timer value indicates zero, the UE shall stop timer T3584 associated
with the same [S-NSSAI, DNN] combination that was sent by the UE, if running,
and may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION
MODIFICATION REQUEST message for the same [S-NSSAI, DNN] combination.
If the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the PDU SESSION RELEASE COMMAND message
with the 5GSM cause value #67 \"insufficient resources for specific slice and
DNN\", then the UE shall apply the timer T3584 for all the PLMNs. Otherwise,
the UE shall apply the timer T3584 for the registered PLMN.
If the 5GSM cause value is #67 \"insufficient resources for specific slice and
DNN\" and the Back-off timer value IE is not included, then the UE may send
another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION
REQUEST message for the same [S-NSSAI, DNN] combination.
When the timer T3584 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3584 is running when the UE enters state 5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3584 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3584 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3584 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If the 5GSM cause value is #69 \"insufficient resources for specific slice\"
and the Back-off timer value IE is included, the UE shall take different
actions depending on the timer value received for timer T3585 in the Back-off
timer value:
a) If the timer value indicates neither zero nor deactivated and an S-NSSAI
was provided during the PDU session establishment, the UE shall stop timer
T3585 associated with the corresponding S-NSSAI, if it is running. If the
timer value indicates neither zero nor deactivated and no S-NSSAI was provided
during the PDU session establishment and the request type was different from
\"initial emergency request\" and different from \"existing emergency PDU
session\", the UE shall stop timer T3585 associated with no S-NSSAI if it is
running. The UE shall then start timer T3585 with the value provided in the
Back-off timer value IE and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU
SESSION MODIFICATION REQUEST message with exception of those identified in
subclause 6.4.2.1, for the same S-NSSAI that was sent by the UE, until timer
T3585 expires or timer T3585 is stopped; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an
S-NSSAI and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an S-NSSAI
provided by the UE, if no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", until timer
T3585 expires or timer T3585 is stopped.
The UE shall not stop timer T3585 upon a PLMN change or inter-system change;
b) if the timer value indicates that this timer is deactivated and an S-NSSAI
was provided during the PDU session establishment, the UE shall stop timer
T3585 associated with the corresponding S-NSSAI, if it is running. If the
timer value indicates that this timer is deactivated and no S-NSSAI was
provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3585 associated with no
S-NSSAI if it is running. The UE:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST, or PDU SESSION
MODIFICATION REQUEST with exception of those identified in subclause 6.4.2.1,
for the same S-NSSAI until the UE is switched off or the USIM is removed, or a
PDU SESSION RELEASE COMMAND message including 5GSM cause #39 \"reactivation
requested\" for the same S-NSSAI from the network; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an
S-NSSAI and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an S-NSSAI
provided by the UE, if no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", until the UE
is switched off or the USIM is removed, or a PDU SESSION RELEASE COMMAND
messages including 5GSM cause IE set to 5GSM cause #39 \"reactivation
requested\" for a non-emergency PDU session established without an S-NSSAI
provided by the UE.
The timer T3585 remains deactivated upon a PLMN change or inter-system change;
and
c) if the timer value indicates zero, the UE:
1) shall stop timer T3585 associated with the corresponding S-NSSAI, if
running, and may send another PDU SESSION ESTABLISHMENT REQUEST, or PDU
SESSION MODIFICATION REQUEST message for the same S-NSSAI; and
2) if no S-NSSAI was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", the UE shall stop timer T3585
associated with no S-NSSAI, if running, and may send another PDU SESSION
ESTABLISHMENT REQUEST message without an S-NSSAI, or another PDU SESSION
MODIFICATION REQUEST message without an S-NSSAI provided by the UE.
If the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the PDU SESSION RELEASE COMMAND message
with the 5GSM cause value #69 \"insufficient resources for specific slice\",
then the UE shall apply the timer T3585 for all the PLMNs. Otherwise, the UE
shall apply the timer T3585 for the registered PLMN.
If the 5GSM cause value is #69 \"insufficient resources for specific slice\"
and the Back-off timer value IE is not included, then the UE may send another
PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST
message for the same S-NSSAI or without an S-NSSAI.
When the timer T3585 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3585 is running when the UE enters state 5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3585 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3585 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3585 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
NOTE 5: As described in this subclause, upon PLMN change or inter-system
change, the UE does not stop the timer T3584 or T3585. This means the timer
T3584 or T3585 can still be running or be deactivated for the given 5GSM
procedure, the PLMN, the S-NSSAI and optionally the DNN combination when the
UE returns to the PLMN or when it performs inter-system change back from S1
mode to N1 mode. Thus the UE can still be prevented from sending another PDU
SESSION ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION REQUEST message in
the PLMN for the same S-NSSAI and optionally the same DNN.
Upon PLMN change, if T3584 is running or is deactivated for an S-NSSAI, a DNN,
and old PLMN, but T3584 is not running and is not deactivated for the S-NSSAI,
the DNN, and new PLMN, then the UE is allowed to send a PDU SESSION
ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new
PLMN.
Upon PLMN change, if T3585 is running or is deactivated for an S-NSSAI and old
PLMN, but T3585 is not running and is not deactivated for the S-NSSAI and new
PLMN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST
message for the same S-NSSAI in the new PLMN.
The UE shall transport the PDU SESSION RELEASE COMPLETE message and the PDU
session ID, using the NAS transport procedure as specified in subclause 5.4.5.
Upon receipt of a PDU SESSION RELEASE COMPLETE message, the SMF shall stop
timer T3592 and shall consider the PDU session as released.
#### 6.3.3.4 N1 SM delivery skipped
If the PDU SESSION RELEASE COMMAND message was sent along the N1 SM delivery
skip allowed indication towards AMF, then upon receipt of an indication that
N1 SM delivery was skipped, the SMF shall stop timer T3592 and shall consider
the PDU session as released.
#### 6.3.3.5 Abnormal cases on the network side
The following abnormal cases can be identified:
a) Expiry of timer T3592.
The SMF shall, on the first expiry of the timer T3592, retransmit the PDU
SESSION RELEASE COMMAND message and shall reset and start timer T3592. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3592, the SMF shall abort the procedure.
b) Collision of network-requested PDU session release procedure and UE-
requested PDU session modification procedure.
When the SMF receives a PDU SESSION MODIFICATION REQUEST message during the
network-requested PDU session release procedure, and the PDU session indicated
in PDU SESSION MODIFICATION REQUEST message is the PDU session that the SMF
had requested to release, the SMF shall ignore the PDU SESSION MODIFICATION
REQUEST message and proceed with the PDU session release procedure.
c) Collision of network-requested PDU session release procedure and UE-
requested PDU session release procedure.
If the SMF receives a PDU SESSION RELEASE REQUEST message after sending a PDU
SESSION RELEASE COMMAND message to the UE, and the PDU session ID in the PDU
SESSION RELEASE REQUEST message is the same as the PDU session ID in the PDU
SESSION RELEASE COMMAND message, the SMF shall ignore the PDU SESSION RELEASE
REQUEST message and proceed with the network-requested PDU session release
procedure.
#### 6.3.3.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) PDU session inactive for the received PDU session ID.
If the PDU session ID in the PDU SESSION RELEASE COMMAND message belongs to
any PDU session in state PDU SESSION INACTIVE in the UE, the UE shall include
the 5GSM cause #43 \"Invalid PDU session identity\" in the 5GSM STATUS
message, and set the PDU session ID to the received PDU session ID in the UL
NAS TRANSPORT message as specified in subclause 5.4.5.
## 6.4 UE-requested 5GSM procedures
### 6.4.1 UE-requested PDU session establishment procedure
#### 6.4.1.1 General
The purpose of the UE-requested PDU session establishment procedure is to
establish a new PDU session with a DN, to perform handover of an existing PDU
session between 3GPP access and non-3GPP access, to transfer an existing PDN
connection in the EPS to the 5GS, or to transfer an existing PDN connection in
an untrusted non-3GPP access connected to the EPC to the 5GS. If accepted by
the network, the PDU session enables exchange of PDUs between the UE and the
DN.
The UE shall not request a PDU session establishment:
a) for an LADN when the UE is located outside the LADN service area; or
b) to transfer a PDU session from non-3GPP access to 3GPP access when the 3GPP
PS data off UE status is \"activated\" and the UE is not using the PDU session
to send uplink IP packets for any of the 3GPP PS data off exempt services (see
subclause 6.2.10).
#### 6.4.1.2 UE-requested PDU session establishment procedure initiation
In order to initiate the UE-requested PDU session establishment procedure, the
UE shall create a PDU SESSION ESTABLISHMENT REQUEST message.
NOTE 0: When IMS voice is available over either 3GPP access or non-3GPP
access, the \"voice centric\" UE in 5GMM-REGISTERED state will receive a
request from upper layers to establish the PDU session for IMS signalling, if
the conditions for performing an initial registration with IMS indicated in
3GPP TS 24.229 [14] subclause U.3.1.2 are satisfied.
If the UE requests to establish a new PDU session, the UE shall allocate a PDU
session ID which is not currently being used by another PDU session over
either 3GPP access or non-3GPP access.
The UE shall allocate a PTI value currently not used and shall set the PTI IE
of the PDU SESSION ESTABLISHMENT REQUEST message to the allocated PTI value.
If the UE is registered for emergency services over the current access, the UE
shall not request establishing a non-emergency PDU session over the current
access. If the UE is registered for emergency services over the current access
it shall not request establishing an emergency PDU session over the non-
current access except if the request is for transferring the emergency PDU
session to the non-current access.
NOTE 1: Transfer of an existing emergency PDU session between 3GPP access and
non-3GPP access is needed e.g. if the UE determines that the current access is
no longer available.
If the UE requests to establish a new non-emergency PDU session with a DN and
requests a PDU session type, the UE shall set the PDU session type IE of the
PDU SESSION ESTABLISHMENT REQUEST message to one of the following values: the
IP version capability as specified in subclause 6.2.4.2, \"Ethernet\" or
\"Unstructured\".
NOTE 2: When the UE initiates the UE-requested PDU session establishment
procedure to transfer an existing non-IP PDN connection in the EPS to the 5GS,
the UE can use locally available information associated with the PDN
connection to select the PDU session type between \"Ethernet\" and
\"Unstructured\".
If the UE requests to establish a new non-emergency PDU session with a DN and
the UE requests an SSC mode, the UE shall set the SSC mode IE of the PDU
SESSION ESTABLISHMENT REQUEST message to the SSC mode. If the UE requests to
establish a PDU session of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDU session type,
the UE shall either omit the SSC mode IE or set the SSC mode IE to \"SSC mode
1\", \"SSC mode 2\", or \"SSC mode 3\". If the UE requests to establish a PDU
session of \"Ethernet\" or \"Unstructured\" PDU session type, the UE shall
either omit the SSC mode IE or set the SSC mode IE to \"SSC mode 1\" or \"SSC
mode 2\". If the UE requests transfer of an existing PDN connection in the EPS
to the 5GS or the UE requests transfer of an existing PDN connection in an
untrusted non-3GPP access connected to the EPC to the 5GS, the UE shall set
the SSC mode IE to \"SSC mode 1\".
A UE supporting PDU connectivity service shall support SSC mode 1 and may
support SSC mode 2 and SSC mode 3 as specified in 3GPP TS 23.501 [8].
If the UE requests to establish a new emergency PDU session, the UE shall set
the SSC mode IE of the PDU SESSION ESTABLISHMENT REQUEST message to \"SSC mode
1\".
If the UE requests to establish a new PDU session with a DN, the UE may
include the SM PDU DN request container IE with a DN-specific identity of the
UE complying with network access identifier (NAI) format as specified in IETF
RFC 7542 [37].
The UE should set the RQoS bit to \"Reflective QoS supported\" in the 5GSM
capability IE of the PDU SESSION ESTABLISHMENT REQUEST message if the UE
supports reflective QoS and:
a) the UE requests to establish a new PDU session of \"IPv4\", \"IPv6\",
\"IPv4v6\" or \"Ethernet\" PDU session type;
b) the UE requests to transfer an existing PDN connection in the EPS of
\"IPv4\", \"IPv6\", \"IPv4v6\" or \"Non-IP\" PDN type mapping to \"Ethernet\"
PDU session type to the 5GS; or
c) the UE requests to transfer an existing PDN connection in an untrusted
non-3GPP access connected to the EPC of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDN
type to the 5GS.
NOTE 3: The determination to not request the usage of reflective QoS by the UE
for a PDU session is implementation dependent.
The UE shall indicate the maximum number of packet filters that can be
supported for the PDU session in the Maximum number of supported packet
filters IE of the PDU SESSION ESTABLISHMENT REQUEST message if:
a) the UE requests to establish a new PDU session of \"IPv4\", \"IPv6\",
\"IPv4v6\", or \"Ethernet\" PDU session type, and the UE can support more than
16 packet filters for this PDU session;
b) the UE requests to transfer an existing PDN connection in the EPS of
\"IPv4\", \"IPv6\", \"IPv4v6\" or \"Non-IP\" PDN type mapping to \"Ethernet\"
PDU session type to the 5GS and the UE can support more than 16 packet filters
for this PDU session; or
c) the UE requests to transfer an existing PDN connection in an untrusted
non-3GPP access connected to the EPC of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDN
type to the 5GS and the UE can support more than 16 packet filters for this
PDU session.
The UE shall include the Integrity protection maximum data rate IE in the PDU
SESSION ESTABLISHMENT REQUEST message to indicate the maximum data rate per UE
for user-plane integrity protection supported by the UE for uplink and the
maximum data rate per UE for user-plane integrity protection supported by the
UE for downlink.
The UE shall set the MH6-PDU bit to \"Multi-homed IPv6 PDU session supported\"
in the 5GSM capability IE of the PDU SESSION ESTABLISHMENT REQUEST message if
the UE supports multi-homed IPv6 PDU session and:
a) the UE requests to establish a new PDU session of \"IPv6\" or \"IPv4v6\"
PDU session type; or.
b) the UE requests to transfer an existing PDN connection of \"IPv6\" or
\"IPv4v6\" PDN type in the EPS or in an untrusted non-3GPP access connected to
the EPC to the 5GS.
If the UE requests to establish a new PDU session as an always-on PDU session,
the UE shall include the Always-on PDU session requested IE and set the value
of the IE to \"Always-on PDU session requested\" in the PDU SESSION
ESTABLISHMENT REQUEST message.
If the UE has an emergency PDU session, the UE shall not perform the UE-
requested PDU session establishment procedure to establish another emergency
PDU session. The UE may perform the UE-requested PDU session establishment
procedure to transfer an existing emergency PDU session or an existing PDN
connection for emergency services.
If:
a) the UE requests to perform handover of an existing PDU session between 3GPP
access and non-3GPP access;
b) the UE requests to perform transfer an existing PDN connection in the EPS
to the 5GS; or
c) the UE requests to perform transfer an existing PDN connection in an
untrusted non-3GPP access connected to the EPC to the 5GS;
the UE shall:
a) set the PDU session ID in the PDU SESSION ESTABLISHMENT REQUEST message and
in the UL NAS TRANSPORT message to the stored PDU session ID corresponding to
the PDN connection; and
b) set the S-NSSAI in the UL NAS TRANSPORT message to the stored S-NSSAI
associated with the PDU session ID only if the S-NSSAI is included in the
allowed NSSAI.
If the UE supports 3GPP PS data off, the UE shall include the extended
protocol configuration options IE in the PDU SESSION ESTABLISHMENT REQUEST
message and include the 3GPP PS data off UE status. The UE behaves as
described in subclause 6.2.10.
The UE shall transport:
a) the PDU SESSION ESTABLISHMENT REQUEST message;
b) the PDU session ID of the PDU session being established, or being handed
over or being transferred;
c) if the request type is set to:
1) \"initial request\" and the UE determined to establish a new PDU session
based on either a URSP rule including one or more S-NSSAIs in the URSP (see
subclause 6.2.9) or UE local configuration, according to subclause 4.2.2 of
3GPP TS 24.526 [19]:
i) in case of a non-roaming scenario, an S-NSSAI in the allowed NSSAI which
corresponds to one of the S-NSSAI(s) in the matching URSP rule, if anyto the
S-NSSAI(s) in the UE local configuration or in the default URSP rule,
according to the conditions given in subclause 4.2.2 of 3GPP TS 24.526 [19];
or
ii) in case of a roaming scenario:
A) one of the mapped S-NSSAI(s) which corresponds to one of the S-NSSAI(s) in
the matching URSP rule, if any, or else to the S-NSSAI(s) in the UE local
configuration or in the default URSP rule, according to the conditions given
in subclause 4.2.2 of 3GPP TS 24.526 [19]; and
B) the S-NSSAI in the allowed NSSAI associated with the S-NSSAI in A);
2) \"existing PDU session\", an S-NSSAI, which is an S-NSSAI associated with
the PDU session and (if available in roaming scenarios) a mapped S-NSSAI;
d) the requested DNN, if the request type is set to \"initial request\" or
\"existing PDU session\", and the UE requests a connectivity to a DNN other
than the default DNN;
e) the request type which is set to:
1) \"initial request\", if the UE is not registered for emergency services and
the UE requests to establish a new non-emergency PDU session;
2) \"existing PDU session\", if the UE is not registered for emergency
services and the UE requests:
i) handover of an existing non-emergency PDU session between 3GPP access and
non-3GPP access;
ii) transfer of an existing PDN connection for non-emergency bearer services
in the EPS to the 5GS; or
iii) transfer of an existing PDN connection for non-emergency bearer services
in an untrusted non-3GPP access connected to the EPC to the 5GS; or
3) \"initial emergency request\", if the UE requests to establish a new
emergency PDU session; and
4) \"existing emergency PDU session\", if the UE requests:
i) handover of an existing emergency PDU session between 3GPP access and
non-3GPP access;
ii) transfer of an existing PDN connection for emergency bearer services in
the EPS to the 5GS; or
iii) transfer of an existing PDN connection for emergency bearer services in
an untrusted non-3GPP access connected to the EPC to the 5GS; and
f) the old PDU session ID which is the PDU session ID of the existing PDU
session, if the UE initiates the UE-requested PDU session establishment
procedure upon receiving the PDU SESSION MODIFICATION COMMAND messages with
the 5GSM cause IE set to #39 \"reactivation requested\";
using the NAS transport procedure as specified in subclause 5.4.5, and the UE
shall start timer T3580 (see example in figure 6.4.1.2.1).
For bullet c), if the matching URSP rule does not have an associated S-NSSAI,
or if the UE does not have any matching URSP rule and there is no S-NSSAI in
the UE local configuration or in the default URSP rule, the UE shall not
provide any S-NSSAI in a PDU session establishment procedure.
If the request type is set to \"initial emergency request\" or \"existing
emergency PDU session\", neither DNN nor S-NSSAI is transported by the UE
using the NAS transport procedure as specified in subclause 5.4.5.
Figure 6.4.1.2.1: UE-requested PDU session establishment procedure
Upon receipt of a PDU SESSION ESTABLISHMENT REQUEST message, a PDU session ID,
optionally an S-NSSAI associated with (if available in roaming scenarios) a
mapped S-NSSAI, optionally a DNN, the request type, and optionally an old PDU
session ID, the SMF checks whether connectivity with the requested DN can be
established. If the requested DNN is not included, the SMF shall use the
default DNN.
If the PDU session being established is a non-emergency PDU session, the
request type is not set to \"existing PDU session\" and the PDU session
authentication and authorization by the external DN is required due to local
policy, the SMF shall check whether the PDU SESSION ESTABLISHMENT REQUEST
message includes the SM PDU DN request container IE.
If the PDU session being established is a non-emergency PDU session, the
request type is not set to \"existing PDU session\", the SM PDU DN request
container IE is included in the PDU SESSION ESTABLISHMENT REQUEST message and
the PDU session authentication and authorization by the external DN is
required due to local policy and user\'s subscription data, the SMF shall:
a) if the information for the PDU session authentication and authorization by
the external DN in the SM PDU DN request container IE is compliant with the
local policy and user\'s subscription data, proceed with the EAP
Authentication procedure specified in 3GPP TS 33.501 [24] and refrain from
accepting or rejecting the PDU SESSION ESTABLISHMENT REQUEST message until the
EAP Authentication procedure finalizes; and
b) if the information for the PDU session authentication and authorization by
the external DN in the SM PDU DN request container IE is not compliant with
the local policy, reject the PDU session establishment request including the
5GSM cause #29 \"user authentication or authorization failed\", in the PDU
SESSION ESTABLISHMENT REJECT message.
If the PDU session being established is a non-emergency PDU session, the
request type is not set to \"existing PDU session\", the SM PDU DN request
container IE is not included in the PDU SESSION ESTABLISHMENT REQUEST message
and the PDU session authentication and authorization by the external DN is
required due to local policy and user\'s subscription data, the SMF shall
proceed with the EAP Authentication procedure specified in 3GPP TS 33.501 [24]
and refrain from accepting or rejecting the PDU SESSION ESTABLISHMENT REQUEST
message until the EAP Authentication procedure finalizes.
If the SMF receives the old PDU session ID from the AMF and a PDU session
exists for the old PDU session ID, the SMF shall consider that the request for
the relocation of SSC mode 3 PDU session anchor with multiple PDU sessions as
specified in 3GPP TS 23.502 [9] is accepted by the UE.
#### 6.4.1.3 UE-requested PDU session establishment procedure accepted by the
network
If the connectivity with the requested DN is accepted by the network, the SMF
shall create a PDU SESSION ESTABLISHMENT ACCEPT message.
If the UE requests establishing an emergency PDU session, the network shall
not check for service area restrictions or subscription restrictions when
processing the PDU SESSION ESTABLISHMENT REQUEST message.
The SMF shall set the authorized QoS rules IE of the PDU SESSION ESTABLISHMENT
ACCEPT message to the authorized QoS rules of the PDU session and may include
the authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT
ACCEPT message set to the authorized QoS flow descriptions of the PDU session.
The SMF shall ensure that the number of the packet filters used in the
authorized QoS rules of the PDU Session does not exceed the maximum number of
packet filters supported by the UE for the PDU session. If the received
request type is \"initial emergency request\", the SMF shall set the
authorized QoS flow descriptions IE according to the initial QoS parameters
used for establishing emergency services configured in the SMF emergency
configuration data.
SMF shall set the authorized QoS flow descriptions IE to the authorized QoS
flow descriptions of the PDU session, if:
a) the authorized QoS rules IE contains at least one GBR QoS flow;
b) the QFI is not the same as the 5QI of the QoS flow identified by the QFI;
or
c) the QoS flow can be mapped to an EPS bearer as specified in subclause
4.11.2 of 3GPP TS 23.502 [9].
If interworking with EPS is supported for the PDU session, the SMF shall set
in the PDU SESSION ESTABLISHMENT ACCEPT message:
a) the Mapped EPS bearer contexts IE to the EPS bearer contexts mapped from
one or more QoS flows of the PDU session; and
b) the EPS bearer identity parameter in the authorized QoS flow descriptions
IE to the EPS bearer identity corresponding to the QoS flow, for each QoS flow
which can be transferred to EPS.
If the \"Create new EPS bearer\" operation code in the mapped EPS bearer
contexts IE was received, and there is no corresponding authorized QoS flow
descriptions IE in the PDU SESSION ESTABLISHMENT ACCEPT message, the UE shall
send a PDU SESSION MODIFICATION REQUEST message including a mapped EPS bearer
contexts IE to delete the mapped EPS bearer context.
Furthermore, the SMF shall store the association between the QoS flow and the
mapped EPS bearer context, for each QoS flow which can be transferred to EPS.
The SMF shall set the selected SSC mode IE of the PDU SESSION ESTABLISHMENT
ACCEPT message to:
a) the received SSC mode in the SSC mode IE included in the PDU SESSION
ESTABLISHMENT REQUEST message based on one or more of the PDU session type,
the subscription and the SMF configuration;
b) either the default SSC mode for the data network listed in the subscription
or the SSC mode associated with the SMF configuration, if the SSC mode IE is
not included in the PDU SESSION ESTABLISHMENT REQUEST message.
NOTE 1: For bullet b), to avoid issues for UEs not supporting all SSC modes,
the network operator can, in the subscription data and local configuration,
include at least SSC mode 1 in the allowed SSC modes, and set the default SSC
mode to \"SSC mode 1\" as per 3GPP TS 23.501 [8].
If the PDU session is an emergency PDU session, the SMF shall set the Selected
SSC mode IE of the PDU SESSION ESTABLISHMENT ACCEPT message to \"SSC mode 1\".
If the PDU session is a non-emergency PDU session of \"Ethernet\" or
\"Unstructured\" PDU session type, the SMF shall set the Selected SSC mode IE
to \"SSC mode 1\" or \"SSC mode 2\". If the PDU session is a non-emergency PDU
session of \"IPv4\", \"IPv6\" or \"IPv4v6\" PDU session type, the SMF shall
set the selected SSC mode IE to \"SSC mode 1\", \"SSC mode 2\", or \"SSC mode
3\".
If the PDU session is a non-emergency PDU session, the SMF shall set the
S-NSSAI IE of the PDU SESSION ESTABLISHMENT ACCEPT message to:
a) the S-NSSAI of the PDU session; and
b) the mapped S-NSSAI (if available in roaming scenarios).
The SMF shall set the selected PDU session type IE of the PDU SESSION
ESTABLISHMENT ACCEPT message to the PDU session type of the PDU session.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"IPv4v6\", the SMF shall select \"IPv4\", \"IPv6\" or \"IPv4v6\" as
the selected PDU session type IE of the PDU session. If the subscription, the
SMF configuration, or both, are limited to IPv4 only or IPv6 only for the
requested DNN, the SMF shall include the 5GSM cause value #50 \"PDU session
type IPv4 only allowed\", or #51 \"PDU session type IPv6 only allowed\",
respectively, in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT ACCEPT
message.
If the selected PDU session type is \"IPv4\", the SMF shall include the PDU
address IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the
PDU address IE to an IPv4 address is allocated to the UE in the PDU session.
If the selected PDU session type is \"IPv6\", the SMF shall include the PDU
address IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the
PDU address IE to an interface identifier for the IPv6 link local address
allocated to the UE in the PDU session.
If the selected PDU session type is \"IPv4v6\", the SMF shall include the PDU
address IE in the PDU SESSION ESTABLISHMENT ACCEPT message and shall set the
PDU address IE to an IPv4 address and an interface identifier for the IPv6
link local address, allocated to the UE in the PDU session.
If the PDU session is a non-emergency PDU session, the SMF shall set the DNN
IE of the PDU SESSION ESTABLISHMENT ACCEPT message to the DNN of the PDU
session.
The SMF shall set the Session-AMBR IE of the PDU SESSION ESTABLISHMENT ACCEPT
message to the Session-AMBR of the PDU session.
If the selected PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or
\"Ethernet\" and if the PDU SESSION ESTABLISHMENT REQUEST message includes a
5GSM capability IE with the RQoS bit set to \"Reflective QoS supported\", the
SMF shall consider that reflective QoS is supported for QoS flows belonging to
this PDU session and may include the RQ timer IE set to an RQ timer value in
the PDU SESSION ESTABLISHMENT ACCEPT message.
If the selected PDU session type is \"IPv4\", \"IPv6\", \"IPv4v6\" or
\"Ethernet\" and if the PDU SESSION ESTABLISHMENT REQUEST message includes a
Maximum number of supported packet filters IE, the SMF shall consider this
number as the maximum number of packet filters that can be supported by the UE
for this PDU session. Otherwise the SMF considers that the UE supports 16
packet filters for this PDU session.
The SMF shall consider that the maximum data rate per UE for user-plane
integrity protection supported by the UE for uplink and the maximum data rate
per UE for user-plane integrity protection supported by the UE for downlink
are valid for the lifetime of the PDU session.
If the value of the RQ timer is set to \"deactivated\" or has a value of zero,
the UE considers that RQoS is not applied for this PDU session.
NOTE 2: If the 5G core network determines that reflective QoS is to be used
for a QoS flow, the SMF sends reflective QoS indication (RQI) to UPF to
activate reflective QoS. If the QoS flow is established over 3GPP access, the
SMF also includes reflective QoS Attribute (RQA) in QoS profile of the QoS
flow during QoS flow establishment.
If the selected PDU session type is \"IPv6\" or \"IPv4v6\" and if the PDU
SESSION ESTABLISHMENT REQUEST message includes a 5GSM capability IE with the
MH6-PDU bit set to \"Multi-homed IPv6 PDU session supported\", the SMF shall
consider that this PDU session is supported to use multiple IPv6 prefixes.
If the DN authentication of the UE was performed and completed successfully,
the SMF shall set the EAP message IE of the PDU SESSION ESTABLISHMENT ACCEPT
message to an EAP-success message as specified in IETF RFC 3748 [34], provided
by the DN.
Based on local policies or configurations in the SMF and the Always-on PDU
session requested IE in the PDU SESSION ESTABLISHMENT REQUEST message (if
available), if the SMF determines that either:
a) the requested PDU session needs to be established as an always-on PDU
session, the SMF shall include the Always-on PDU session indication IE in the
PDU SESSION ESTABLISHMENT ACCEPT message and shall set the value to \"Always-
on PDU session required\"; or
b) the requested PDU session shall not be established as an always-on PDU
session and:
i) if the UE included the Always-on PDU session requested IE, the SMF shall
include the Always-on PDU session indication IE in the PDU SESSION
ESTABLISHMENT ACCEPT message and shall set the value to \"Always-on PDU
session not allowed\"; or
ii) if the UE did not include the Always-on PDU session requested IE, the SMF
shall not include the Always-on PDU session indication IE in the PDU SESSION
ESTABLISHMENT ACCEPT message.
The SMF shall send the PDU SESSION ESTABLISHMENT ACCEPT message.
Upon receipt of a PDU SESSION ESTABLISHMENT ACCEPT message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, the UE
shall stop timer T3580, shall release the allocated PTI value and shall
consider that the PDU session was established.
The UE shall store the authorized QoS rules, and the session-AMBR received in
the PDU SESSION ESTABLISHMENT ACCEPT message for the PDU session. The UE shall
also store the authorized QoS flow descriptions if it is included in the
authorized QoS flow descriptions IE of the PDU SESSION ESTABLISHMENT ACCEPT
message for the PDU session.
For a PDU session that is being established with the request type set to
\"initial request\" or \"initial emergency request\", or a PDU session that is
being transferred from EPS to 5GS and established with the request type set to
\"existing PDU session\" or \"existing emergency PDU session\" or a PDU
session that is being handed over between non-3GPP access and 3GPP access and
established with the request type set to \"existing PDU session\" or
\"existing emergency PDU session \", the UE shall verify the authorized QoS
rules and the authorized QoS flow descriptions provided in the PDU SESSION
ESTABLISHMENT ACCEPT message for different types of errors as follows:
a) Semantic errors in QoS operations:
1) When the rule operation is \"Create new QoS rule\", and the DQR bit is set
to \"the QoS rule is the default QoS rule\" when there\'s already a default
QoS rule.
2) When the rule operation is \"Create new QoS rule\", and there is no rule
with the DQR bit set to \"the QoS rule is the default QoS rule\".
3) When the rule operation is \"Create new QoS rule\" and two or more QoS
rules associated with this PDU session would have identical precedence values.
4) When the rule operation is an operation other than \"Create new QoS rule\",
and the request type is \"initial request\" or \"initial emergency request\".
5) When the rule operation is \"Create new QoS rule\" and two or more QoS
rules associated with this PDU session would have identical QoS rule
identifier values.
6) When the flow description operation is an operation other than \"Create new
QoS flow description\", and the request type is \"initial request\" or
\"initial emergency request\".
In case 4, if the rule operation is for a non-default QoS rule, the UE shall
send a PDU SESSION MODIFICATION REQUEST message to delete the QoS rule with
5GSM cause #83 \"semantic error in the QoS operation\".
In case 6, the UE shall send a PDU SESSION MODIFICATION REQUEST message to
delete the QoS flow description with 5GSM cause #83 \"semantic error in the
QoS operation\".
Otherwise for all the cases above, the UE shall initiate a PDU session release
procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM cause #83
\"semantic error in the QoS operation\".
b) Syntactical errors in QoS operations:
1) When the rule operation is \"Create new QoS rule\" and the packet filter
list in the QoS rule is empty.
2) When there are other types of syntactical errors in the coding of the QoS
rules IE, such as a mismatch between the number of packet filters subfield,
and the number of packet filters in the packet filter list.
3) When, the
A) rule operation is \"Create new QoS rule\", the UE determines that there is
a resulting QoS rule for a GBR QoS flow (as described in 3GPP TS 23.501 [8]
table 5.7.4-1), and there is no QoS flow description with a QFI corresponding
to the QFI of the resulting QoS rule.
B) request type is \"existing PDU session\" or \"existing emergency PDU
session\", the flow description operation is \"Delete existing QoS flow
description\", and the UE determines that there is a resulting QoS rule for a
GBR QoS flow (as described in 3GPP TS 23.501 [8] table 5.7.4-1) with a QFI
corresponding to the QFI of the QoS flow description that is deleted (i.e.
there is no associated QoS flow description with the same QFI).
In case 1, case 2 or case 3, if the QoS rule is not the default QoS rule, the
UE shall send a PDU SESSION MODIFICATION REQUEST message including a requested
QoS rule IE to delete the QoS rule with 5GSM cause #84 \"syntactical error in
the QoS operation\". Otherwise, if the QoS rule is the default QoS rule, the
UE shall initiate a PDU session release procedure by sending a PDU SESSION
RELEASE REQUEST message with 5GSM cause #84 \"syntactical error in the QoS
operation\".
In case 3, if the QoS rule is the default QoS rule, the UE initiate a PDU
session release procedure by sending a PDU SESSION RELEASE REQUEST message
with 5GSM cause #84 \"syntactical error in the QoS operation\". Otherwise, the
UE shall send a PDU SESSION MODIFICATION REQUEST message including a requested
QoS rule IE to delete the QoS rule with 5GSM cause #84 \"syntactical error in
the QoS operation\".
c) Semantic errors in packet filters:
1) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
If the QoS rule is the default QoS rule, the UE shall initiate a PDU session
release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM
cause #44 \"semantic error in packet filter(s)\". Otherwise, the UE shall send
a PDU SESSION MODIFICATION REQUEST message to delete the QoS rule with 5GSM
cause #44 \"semantic error in packet filter(s)\".
d) Syntactical errors in packet filters:
1) When the rule operation is \"Create new QoS rule\" and two or more packet
filters in the resultant QoS rule would have identical packet filter
identifiers.
2) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
If the QoS rule is the default QoS rule, the UE shall initiate a PDU session
release procedure by sending a PDU SESSION RELEASE REQUEST message with 5GSM
cause #45 \"syntactical errors in packet filter(s)\". Otherwise, the UE shall
send a PDU SESSION MODIFICATION REQUEST message to delete the QoS rule with
5GSM cause #45 \"syntactical errors in packet filter(s)\".
If the Always-on PDU session indication IE is included in the PDU SESSION
ESTABLISHMENT ACCEPT message and:
a) the value of the IE is set to \"Always-on PDU session required\", the UE
shall consider the established PDU session as an always-on PDU session; or
b) the value of the IE is set to \"Always-on PDU session not allowed\", the UE
shall not consider the established PDU session as an always-on PDU session.
The UE shall not consider the established PDU session as an always-on PDU
session if the UE does not receive the Always-on PDU session indication IE in
the PDU SESSION ESTABLISHMENT ACCEPT message.
The UE shall store the mapped EPS bearer contexts, if received in the PDU
SESSION ESTABLISHMENT ACCEPT message. Furthermore, the UE shall also store the
association between the QoS flow and the mapped EPS bearer context, for each
QoS flow which can be transferred to EPS, based on the received EPS bearer
identity parameter in authorized QoS flow descriptions IE and the mapped EPS
bearer contexts. The UE shall check each mapped EPS bearer context for
different types of errors as follows:
NOTE 3: An error detected in a mapped EPS bearer context does not cause the UE
to discard the Authorized QoS rules IE and Authorized QoS flow descriptions IE
included in the PDU SESSION ESTABLISHMENT ACCEPT, if any.
a) Semantic error in the mapped EPS bearer operation:
1) When the operation code is an operation code other than \"Create new EPS
bearer\" and the PDU session is being established with the request type set to
\"initial request\" or \"initial emergency request\".
2) When the operation code is \"Create new EPS bearer\" and there is already
an existing mapped EPS bearer context with the same EPS bearer identity
associated with any PDU session.
In case 2, if the existing mapped EPS bearer context is associated with the
PDU session that is being established, the UE shall not diagnose an error,
further process the create request and, if it was process successfully, delete
the old EPS bearer context.
Otherwise, the UE shall initate a PDU session modification procedure by
sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS
bearer context with 5GSM cause #85 \"Invalid mapped EPS bearer identity\".
b) if the mapped EPS bearer context includes a traffic flow template, the UE
shall check the traffic flow template for different types of TFT IE errors as
follows:
1) Semantic errors in TFT operations:
i) When the TFT operation is an operation other than \"Create a new TFT\"
The UE shall initate a PDU session modification procedure by sending a PDU
SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context
with 5GSM cause #41 \"semantic error in the TFT operation\".
2) Syntactical errors in TFT operations:
i) When the TFT operation = \"Create a new TFT\" and the packet filter list in
the TFT IE is empty.
ii) When there are other types of syntactical errors in the coding of the TFT
IE, such as a mismatch between the number of packet filters subfield, and the
number of packet filters in the packet filter list.
The UE shall initate a PDU session modification procedure by sending a PDU
SESSION MODIFICATION REQUEST message with to delete the mapped EPS bearer
context 5GSM cause #42 \"syntactical error in the TFT operation\".
3) Semantic errors in packet filters:
i) When a packet filter consists of conflicting packet filter components which
would render the packet filter ineffective, i.e. no IP packet will ever fit
this packet filter. How the UE determines a semantic error in a packet filter
is outside the scope of the present document.
ii) When the resulting TFT does not contain any packet filter which applicable
for the uplink direction.
The UE shall initate a PDU session modification procedure by sending a PDU
SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer context
with 5GSM cause #44 \"semantic errors in packet filter(s)\".
4) Syntactical errors in packet filters:
i) When the TFT operation = \"Create a new TFT\" and two or more packet
filters in the resultant TFT would have identical packet filter identifiers.
ii) When the TFT operation = \"Create a new TFT\" and two or more packet
filters in all TFTs associated with this PDN connection would have identical
packet filter precedence values.
iii) When there are other types of syntactical errors in the coding of packet
filters, such as the use of a reserved value for a packet filter component
identifier.
In case ii, if the old packet filters do not belong to the default EPS bearer
context, the UE shall not diagnose an error and shall delete the old packet
filters which have identical filter precedence values.
In case ii, if one or more old packet filters belong to the default EPS bearer
context, the UE shall initate a PDU session modification procedure by sending
a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS bearer
context with 5GSM cause #45 \"syntactical errors in packet filter(s)\".
In cases i and iii the UE shall initate a PDU session modification procedure
by sending a PDU SESSION MODIFICATION REQUEST message to delete the mapped EPS
bearer context with 5GSM cause #45 \"syntactical error in packet filter(s)\".
If the UE requests the PDU session type \"IPv4v6\" and:
a) the UE receives the selected PDU session type set to \"IPv4\" and does not
receive the 5GSM cause value #50 \"PDU session type IPv4 only allowed\"; or
b) the UE receives the selected PDU session type set to \"IPv6\" and does not
receive the 5GSM cause value #51 \"PDU session type IPv6 only allowed\";
the UE may subsequently request another PDU session for the other IP version
using the UE-requested PDU session establishment procedure to the same DNN (or
no DNN, if no DNN was indicated by the UE) and the same S-NSSAI associated
with (if available in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if
no S-NSSAI was indicated by the UE) with a single address PDN type (IPv4 or
IPv6) other than the one already activated.
If the UE requests the PDU session type \"IPv4v6\", receives the selected PDU
session type set to \"IPv4\" and the 5GSM cause value #50 \"PDU session type
IPv4 only allowed\", the UE shall not subsequently request another PDU session
for \"IPv6\" using the UE-requested PDU session establishment procedure to the
same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI
associated with (if available in roaming scenarios) a mapped S-NSSAI (or no
S-NSSAI, if no S-NSSAI was indicated by the UE) and the PDU session type
\"IPv6\" until:
\- the UE is registered to a new PLMN which is not in the list of equivalent
PLMNs;
\- the PDU type which is used to access the DNN (or no DNN, if no DNN was
indicated by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was
indicated by the UE) is changed;
\- the UE is switched off, or
\- the USIM is removed.
If the UE requests the PDU session type \"IPv4v6\", receives the selected PDU
session type set to \"IPv6\" and the 5GSM cause value #51 \"PDU session type
IPv6 only allowed\", the UE shall not subsequently request another PDU session
for \"IPv4\" using the UE-requested PDU session establishment procedure to the
same DNN (or no DNN, if no DNN was indicated by the UE) and the same S-NSSAI
associated with (if available in roaming scenarios) a mapped S-NSSAI (or no
S-NSSAI, if no S-NSSAI was indicated by the UE) and the PDU session type
\"IPv4\" until:
\- the UE is registered to a new PLMN which is not in the list of equivalent
PLMNs;
\- the PDU type which is used to access the DNN (or no DNN, if no DNN was
indicated by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was
indicated by the UE) is changed;
\- the UE is switched off, or
\- the USIM is removed.
If the selected PDU session type of the PDU session is \"Unstructured\" or
\"Ethernet\", the UE supports inter-system change from N1 mode to S1 mode, the
UE does not support establishment of a PDN connection for the PDN type set to
\"non-IP\" in S1 mode, and the parameters list field of one or more authorized
QoS flow descriptions received in the authorized QoS flow descriptions IE of
the PDU SESSION ESTABLISHMENT ACCEPT message contains an EPS bearer identity
(EBI) then the UE shall locally remove the EPS bearer identity (EBI) from the
parameters list field of such one or more authorized QoS flow descriptions.
If the UE receives an IPv4 Link MTU parameter, an Ethernet Frame Payload MTU
parameter, or an Unstructured Link MTU parameter in the Extended protocol
configuration options IE of the PDU SESSION ESTABLISHMENT ACCEPT message, the
UE shall pass to the upper layer the received IPv4 link MTU size, the received
Ethernet frame payload MTU size, or the unstructured link MTU size.
NOTE 4: The IPv4 link MTU size corresponds to the maximum length of user data
packet that can be sent via N3 interface for a PDU session of the \"IPv4\" PDU
session types.
NOTE 5: The Ethernet frame payload MTU size corresponds to the maximum length
of a payload of an Ethernet frame that can be sent via N3 interface for a PDU
session of the \"Ethernet\" PDU session type.
NOTE 6: The unstructured link MTU size correspond to the maximum length of
user data packet that can be sent via N3 interface for a PDU session of the
\"Unstructured\" PDU session types.
#### 6.4.1.4 UE requested PDU session establishment procedure not accepted by
the network
If the connectivity with the requested DN is rejected by the network, the SMF
shall create a SM PDU SESSION ESTABLISHMENT REJECT message.
The SMF shall set the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT
message to indicate the reason for rejecting the PDU session establishment.
The 5GSM cause IE typically indicates one of the following SM cause values:
#8 operator determined barring;
#26 insufficient resources;
#27 missing or unknown DNN;
#28 unknown PDU session type;
#29 user authentication or authorization failed;
#31 request rejected, unspecified;
#32 service option not supported;
#33 requested service option not subscribed;
#35 PTI already in use;
#38 network failure;
#46 out of LADN service area;
#50 PDU session type IPv4 only allowed;
#51 PDU session type IPv6 only allowed;
#54 PDU session does not exist;
#67 insufficient resources for specific slice and DNN;
#68 not supported SSC mode;
#69 insufficient resources for specific slice;
#70 missing or unknown DNN in a slice;
#82 maximum data rate per UE for user-plane integrity protection is too low;
or
#95 -- 111 protocol errors.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"IPv6\", and the subscription, the SMF configuration, or both, are
limited to IPv4 only for the requested DNN, the SMF shall include the 5GSM
cause value #50 \"PDU session type IPv4 only allowed\" in the 5GSM cause IE of
the PDU SESSION ESTABLISHMENT REJECT message.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"IPv6\", and the subscription, the SMF configuration, or both,
support none of \"IPv4\" and \"IPv6\" PDU session types for the requested DNN,
the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in
the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"IPv4\", and the subscription, the SMF configuration, or both, are
limited to IPv6 only for the requested DNN, the SMF shall include the 5GSM
cause value #51 \"PDU session type IPv6 only allowed\" in the 5GSM cause IE of
the PDU SESSION ESTABLISHMENT REJECT message.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"IPv4\", and the subscription, the SMF configuration, or both,
support none of \"IPv4\" and \"IPv6\" PDU session types for the requested DNN,
the SMF shall include the 5GSM cause value #28 \"unknown PDU session type\" in
the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"IPv4v6\", and the subscription, the SMF configuration, or both,
support none of \"IPv4v6\", \"IPv4\" and \"IPv6\" PDU session types for the
requested DNN, the SMF shall include the 5GSM cause value #28 \"unknown PDU
session type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT
message.
If the PDU SESSION ESTABLISHMENT REQUEST message includes a PDU session type
IE set to \"Unstructured\" or \"Ethernet\", and the subscription, the SMF
configuration, or both, do not support the PDU session type for the requested
DNN, the SMF shall include the 5GSM cause value #28 \"unknown PDU session
type\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.
If the PDU SESSION ESTABLISHMENT REQUEST message contains the SSC mode IE
indicating an SSC mode not supported by the subscription, the SMF
configuration, or both of them, and the SMF decides to rejects the PDU session
establishment, the SMF shall include the 5GSM cause value #68 \"not supported
SSC mode\" in the 5GSM cause IE and the SSC modes allowed by SMF in the
Allowed SSC mode IE of the PDU SESSION ESTABLISHMENT REJECT message.
In 3GPP access, if the operator\'s configuration requires user-plane integrity
protection for the PDU session and, the maximum data rate per UE for user-
plane integrity protection supported by the UE for uplink or the maximum data
rate per UE for user-plane integrity protection supported by the UE for
downlink, or both, are lower than required by the operator\'s configuration,
the SMF shall include the 5GSM cause value #82 \"maximum data rate per UE for
user-plane integrity protection is too low\" in the 5GSM cause IE of the PDU
SESSION ESTABLISHMENT REJECT message.
If the UE requests a PDU session establishment for an LADN when the UE is
located outside of the LADN service area, the SMF shall include the 5GSM cause
value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION
ESTABLISHMENT REJECT message.
If the DN authentication of the UE was performed and completed unsuccessfully,
the SMF shall include the 5GSM cause value #29 \"user authentication or
authorization failed\" in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT
REJECT message and shall set the EAP message IE of the PDU SESSION
ESTABLISHMENT REJECT message to an EAP-failure message as specified in IETF
RFC 3748 [34], provided by the DN.
The SMF may include a Back-off timer value IE in the PDU SESSION ESTABLISHMENT
REJECT message when the 5GSM cause value #26\"insufficient resources\" is
included in the PDU SESSION ESTABLISHMENT REJECT message. If the 5GSM cause
value is #26\"insufficient resources\" and the PDU SESSION ESTABLISHMENT
REQUEST message was received from a UE configured for high priority access in
selected PLMN or the request type is set to \"initial emergency request\" or
\"existing emergency PDU session\", the network shall not include a Back-off
timer value IE.
The SMF may include a Back-off timer value IE in the PDU SESSION ESTABLISHMENT
REJECT message when the 5GSM cause value #67 \"insufficient resources for
specific slice and DNN\" is included in the PDU SESSION ESTABLISHMENT REJECT
message. If the 5GSM cause value is #67 \"insufficient resources for specific
slice and DNN\" and the PDU SESSION ESTABLISHMENT REQUEST message was received
from a UE configured for high priority access in selected PLMN or the request
type is \"initial emergency request\" or \"existing emergency PDU session\",
the network shall not include a Back-off timer value IE.
The SMF may include a Back-off timer value IE in the PDU SESSION ESTABLISHMENT
REJECT message when the 5GSM cause #69 \"insufficient resources for specific
slice\" is included in the PDU SESSION ESTABLISHMENT REJECT message. If the
5GSM cause value is #69 \"insufficient resources for specific slice\" and the
PDU SESSION ESTABLISHMENT REQUEST message was received from a UE configured
for high priority access in selected PLMN or the request type is \"initial
emergency request\" or \"existing emergency PDU session\", the network shall
not include a Back-off timer value IE.
If the PDU session cannot be established due to resource unavailability in the
UPF, the SMF shall include the 5GSM cause value #26 \"insufficient resources\"
in the 5GSM cause IE of the PDU SESSION ESTABLISHMENT REJECT message.
The SMF shall send the SM PDU SESSION ESTABLISHMENT REJECT message.
Upon receipt of a PDU SESSION ESTABLISHMENT REJECT message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, the UE
shall stop timer T3580 shall release the allocated PTI value and shall
consider that the PDU session was not established.
If the PDU SESSION ESTABLISHMENT REQUEST message was sent with request type
set to \"initial emergency request\" or \"existing emergency PDU session\" and
the UE receives a PDU SESSION ESTABLISHMENT REJECT message, then the UE may:
a) inform the upper layers of the failure of the procedure; or
NOTE 1: This can result in the upper layers requesting another emergency call
attempt using domain selection as specified in 3GPP TS 23.167 [6].
b) de-register locally, if not de-registered already, attempt initial
registration for emergency services.
If:
\- the 5GSM cause value #26 \"insufficient resources\" and the Back-off timer
value IE are included in the PDU SESSION ESTABLISHMENT REJECT message; or
\- an indication that the 5GSM message was not forwarded due to DNN based
congestion control is received along a Back-off timer value and a PDU SESSION
ESTABLISHMENT REQUEST message with the PDU session ID IE set to the PDU
session ID of the PDU session;
the UE shall ignore the 5GSM congestion re-attempt indicator IE provided by
the network, if any, and the UE shall take different actions depending on the
timer value received for timer T3396 in the Back-off timer value IE (if the UE
is a UE configured for high priority access in selected PLMN, exceptions are
specified in subclause 6.2.7):
a) If the timer value indicates neither zero nor deactivated and a DNN was
provided during the PDU session establishment, the UE shall stop timer T3396
associated with the corresponding DNN, if it is running. If the timer value
indicates neither zero nor deactivated and no DNN was provided during the PDU
session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\", the
UE shall stop timer T3396 associated with no DNN if it is running. The UE
shall then start timer T3396 with the value provided in the Back-off timer
value IE and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST message with exception of those identified in
subclause 6.4.2.1, for the same DNN that was sent by the UE, until timer T3396
expires or timer T3396 is stopped; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without a
DNN and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without a DNN provided by
the UE, if no DNN was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", until timer T3396 expires or timer
T3396 is stopped.
The UE shall not stop timer T3396 upon a PLMN change or inter-system change;
b) if the timer value indicates that this timer is deactivated and a DNN was
provided during the PDU session establishment, the UE shall stop timer T3396
associated with the corresponding DNN, if it is running. If the timer value
indicates that this timer is deactivated and no DNN was provided during the
PDU session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\", the
UE shall stop timer T3396 associated with no DNN if it is running. The UE:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST message with exception of those identified in
subclause 6.4.2.1, for the same DNN until the UE is switched off or the USIM
is removed, or the UE receives a PDU SESSION MODIFICATION COMMAND message for
the same DNN from the network or a PDU SESSION RELEASE COMMAND message
including 5GSM cause #39 \"reactivation requested\" for the same DNN from the
network; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without a
DNN and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without a DNN provided by
the UE, if no DNN was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", until the UE is switched off or the
USIM is removed, or the UE receives a PDU SESSION MODIFICATION COMMAND message
for a non-emergency PDU session established without a DNN provided by the UE,
or a PDU SESSION RELEASE COMMAND messages including 5GSM cause IE set to 5GSM
cause #39 \"reactivation requested\" for a non-emergency PDU session
established without a DNN provided by the UE.
The timer T3396 remains deactivated upon a PLMN change or inter-system change;
and
c) if the timer value indicates zero, the UE:
1) shall stop timer T3396 associated with the corresponding DNN, if running,
and may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION
MODIFICATION REQUEST message for the same DNN; and
2) if no DNN was provided during the PDU session establishment and the request
type was different from \"initial emergency request\" and different from
\"existing emergency PDU session\", the UE shall stop timer T3396 associated
with no DNN, if running, and may send another PDU SESSION ESTABLISHMENT
REQUEST message without a DNN, or another PDU SESSION MODIFICATION REQUEST
message without a DNN provided by the UE.
If the Back-off timer value IE is not included or no Back-off timer value is
received from the 5GMM sublayer, then the UE may send another PDU SESSION
ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for
the same DNN or without a DNN.
When the timer T3396 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3396 is running when the UE enters state5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3396 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3396 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3396 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If:
\- the 5GSM cause value #67 \"insufficient resources for specific slice and
DNN\" and the Back-off timer value IE are included in the PDU SESSION
ESTABLISHMENT REJECT message; or
\- an indication that the 5GSM message was not forwarded due to S-NSSAI and
DNN based congestion control is received along a Back-off timer value and a
PDU SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to
the PDU session ID of the PDU session;
the UE shall take different actions depending on the timer value received for
timer T3584 in the Back-off timer value IE (if the UE is a UE configured for
high priority access in selected PLMN, exceptions are specified in subclause
6.2.8):
a) If the timer value indicates neither zero nor deactivated, the UE shall
stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that
the UE provided during the PDU session establishment, if it is running. If the
timer value indicates neither zero nor deactivated and no DNN was provided
during the PDU session establishment and the request type was different from
\"initial emergency request\" and different from \"existing emergency PDU
session\", the UE shall stop timer T3584 associated with [S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. If the timer value indicates neither zero nor deactivated and
no S-NSSAI was provided during the PDU session establishment, the UE shall
stop timer T3584 associated with [no S-NSSAI, DNN] combination as that the UE
provided during the PDU session establishment, if it is running. If the timer
value indicates neither zero nor deactivated and neither S-NSSAI nor DNN was
provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3584 associated with [no
S-NSSAI, no DNN] combination as that the UE provided during the PDU session
establishment, if it is running. The UE shall then start timer T3584 with the
value provided in the Back-off timer value IE and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU
SESSION MODIFICATION REQUEST message with exception of those identified in
subclause 6.4.2.1, for the same [S-NSSAI, DNN] combination that was sent by
the UE, until timer T3584 expires or timer T3584 is stopped;
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST with exception of those identified in subclause 6.4.2.1, message for
the same [S-NSSAI, no DNN] combination that was sent by the UE, if no DNN was
provided during the PDU session establishment, until timer T3584 expires or
timer T3584 is stopped;
3) shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or
another PDU SESSION MODIFICATION REQUEST message with exception of those
identified in subclause 6.4.2.1, for the same [no S-NSSAI, DNN] combination
that was sent by the UE, if no S-NSSAI was provided during the PDU session
establishment, until timer T3584 expires or timer T3584 is stopped; and
4) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST message with exception of those identified in subclause 6.4.2.1, for
the same [no S-NSSAI, no DNN] combination that was sent by the UE, if neither
S-NSSAI nor DNN was provided during the PDU session establishment, until timer
T3584 expires or timer T3584 is stopped.
The UE shall not stop timer T3584 upon a PLMN change or inter-system change;
b) if the timer value indicates that this timer is deactivated, the UE:
1) shall stop timer T3584 associated with the same [S-NSSAI, DNN] combination
as that the UE provided during the PDU session establishment, if it is
running. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST
message, or PDU SESSION MODIFICATION REQUEST message with exception of those
identified in subclause 6.4.2.1, for the same [S-NSSAI, DNN] combination that
was sent by the UE, until the UE is switched off or the USIM is removed, or
the UE receives a PDU SESSION MODIFICATION COMMAND message for the same
[S-NSSAI, DNN] combination from the network or a PDU SESSION RELEASE COMMAND
message including 5GSM cause #39 \"reactivation requested\" for the same
[S-NSSAI, DNN] combination from the network;
2) shall stop timer T3584 associated with the same [S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE shall not send a PDU SESSION ESTABLISHMENT REQUEST
message with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or a PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for the same [S-NSSAI, no DNN] combination that was sent by the UE,
if no DNN was provided during the PDU session establishment, until the UE is
switched off or the USIM is removed, or the UE receives an PDU SESSION
MODIFICATION COMMAND message for a non-emergency PDU session established for
the same [S-NSSAI, no DNN] combination from the network or a PDU SESSION
RELEASE COMMAND message including 5GSM cause #39 \"reactivation requested\"
for a non-emergency PDU session established for the same [S-NSSAI, no DNN]
combination from the network;
3) shall stop timer T3584 associated with the same [no S-NSSAI, DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE shall not send a PDU SESSION ESTABLISHMENT REQUEST
message, or a PDU SESSION MODIFICATION REQUEST message with exception of those
identified in subclause 6.4.2.1, for the same [no S-NSSAI, DNN] combination
that was sent by the UE, if no S-NSSAI was provided during the PDU session
establishment, until the UE is switched off or the USIM is removed, or the UE
receives an PDU SESSION MODIFICATION COMMAND message for the same [no S-NSSAI,
DNN] combination from the network or a PDU SESSION RELEASE COMMAND message
including 5GSM cause #39 \"reactivation requested\" for the same [no S-NSSAI,
DNN] combination from the network; and
4) shall stop timer T3584 associated with the same [no S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE shall not send a PDU SESSION ESTABLISHMENT REQUEST
message with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or a PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for the same [no S-NSSAI, no DNN] combination that was sent by the
UE, if neither S-NSSAI nor DNN was provided during the PDU session
establishment, until the UE is switched off or the USIM is removed, or the UE
receives an PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU
session established for the same [no S-NSSAI, no DNN] combination from the
network or a PDU SESSION RELEASE COMMAND message including 5GSM cause #39
\"reactivation requested\" for a non-emergency PDU session established for the
same [no S-NSSAI, no DNN] combination from the network.
The timer T3584 remains deactivated upon a PLMN change or inter-system change;
and
c) if the timer value indicates zero, the UE:
1) shall stop timer T3584 associated with the same [S-NSSAI, DNN] combination
as that the UE provided during the PDU session establishment, if it is
running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST message or
PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, DNN]
combination;
2) shall stop timer T3584 associated with the same [S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST
message or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, no
DNN] combination if no DNN was provided during the PDU session establishment
and the request type was different from \"initial emergency request\" and
different from \"existing emergency PDU session\";
3) shall stop timer T3584 associated with the same [no S-NSSAI, DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST
message, or PDU SESSION MODIFICATION REQUEST message for the same [no S-NSSAI,
DNN] combination if no NSSAI was provided during the PDU session
establishment; and
4) shall stop timer T3584 associated with the same [no S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST
message, or PDU SESSION MODIFICATION REQUEST message for the same [no S-NSSAI,
no DNN] combination if neither S-NSSAI nor DNN was provided during the PDU
session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\".
If the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the PDU SESSION ESTABLISHMENT REJECT
message with the 5GSM cause value #67 \"insufficient resources for specific
slice and DNN\", then the UE shall apply the timer T3584 for all the PLMNs.
Otherwise, the UE shall apply the timer T3584 for the registered PLMN.
If the Back-off timer value IE is not included or no Back-off timer value is
received from the 5GMM sublayer, then the UE may send another PDU SESSION
ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for
the same [S-NSSAI, DNN] combination, or for the same [S-NSSAI, no DNN]
combination, or for the same [no S-NSSAI, DNN] combination, or for the same
[no S-NSSAI, no DNN] combination.
When the timer T3584 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3584 is running when the UE enters state5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3584 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3584 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3584 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If:
\- the 5GSM cause value #69 \"insufficient resources for specific slice\" and
the Back-off timer value IE are included in the PDU SESSION ESTABLISHMENT
REJECT message; or
\- an indication that the 5GSM message was not forwarded due to S-NSSAI only
based congestion control is received along a Back-off timer value and a PDU
SESSION ESTABLISHMENT REQUEST message with the PDU session ID IE set to the
PDU session ID of the PDU session;
the UE shall take different actions depending on the timer value received for
timer T3585 in the Back-off timer value IE (if the UE is a UE configured for
high priority access in selected PLMN, exceptions are specified in subclause
6.2.8):
a) If the timer value indicates neither zero nor deactivated and an S-NSSAI
was provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3585 associated with the
corresponding S-NSSAI, if it is running. If the timer value indicates neither
zero nor deactivated and no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", the UE shall
stop timer T3585 associated with no S-NSSAI if it is running. The UE shall
then start timer T3585 with the value provided in the Back-off timer value IE
and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST message with exception of those identified in subclause 6.4.2.1, for a
non-emergency PDU session for the same S-NSSAI that was sent by the UE, until
timer T3585 expires or timer T3585 is stopped; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an
S-NSSAI and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an S-NSSAI
provided by the UE, if no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", until timer
T3585 expires or timer T3585 is stopped.
The UE shall not stop timer T3585 upon a PLMN change or inter-system change;
b) if the timer value indicates that this timer is deactivated and an S-NSSAI
was provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3585 associated with the
corresponding S-NSSAI, if it is running. If the timer value indicates that
this timer is deactivated and no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", the UE shall
stop timer T3585 associated with no S-NSSAI if it is running. The UE:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST with exception of those identified in subclause 6.4.2.1, for a non-
emergency PDU session for the same S-NSSAI until the UE is switched off or the
USIM is removed, or the UE receives a PDU SESSION MODIFICATION COMMAND message
for a non-emergency PDU session for the same S-NSSAI from the network or a PDU
SESSION RELEASE COMMAND message including 5GSM cause #39 \"reactivation
requested\" for the same S-NSSAI from the network; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an
S-NSSAI and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an S-NSSAI
provided by the UE, if no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", until the UE
is switched off or the USIM is removed, or the UE receives a PDU SESSION
MODIFICATION COMMAND message for a non-emergency PDU session established
without an S-NSSAI provided by the UE, or a PDU SESSION RELEASE COMMAND
messages including 5GSM cause IE set to 5GSM cause #39 \"reactivation
requested\" for a non-emergency PDU session established without an S-NSSAI
provided by the UE.
The timer T3585 remains deactivated upon a PLMN change or inter-system change;
and
c) if the timer value indicates zero, the UE:
1) shall stop timer T3585 associated with the corresponding S-NSSAI, if
running, and may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST message for the same S-NSSAI; and
2) if no S-NSSAI was provided during the PDU session establishment and the
request type was different from \"initial emergency request \" and different
from \"existing emergency PDU session\", the UE shall stop timer T3585
associated with no S-NSSAI, if running, and may send another PDU SESSION
ESTABLISHMENT REQUEST message without an S-NSSAI, or another PDU SESSION
MODIFICATION REQUEST message without an S-NSSAI provided by the UE.
If the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the PDU SESSION ESTABLISHMENT REJECT
message with the 5GSM cause value #69 \"insufficient resources for specific
slice\", then the UE shall apply the timer T3585 for all the PLMNs. Otherwise,
the UE shall apply the timer T3585 for the registered PLMN.
If the Back-off timer value IE is not included or no Back-off timer value is
received from the 5GMM sublayer, then the UE may send another PDU SESSION
ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST message for
the same S-NSSAI or without an S-NSSAI.
When the timer T3585 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3585 is running when the UE enters state5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3585 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3585 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
let t1 be the time remaining for T3585 timeout at switch off and let t be the
time elapsed between switch off and switch on. If t1 is greater than t, then
the timer shall be restarted with the value t1 -- t. If t1 is equal to or less
than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
NOTE 2: As described in this subclause, upon PLMN change or inter-system
change, the UE does not stop the timer T3584 or T3585. This means the timer
T3584 or T3585 can still be running or be deactivated for the given 5GSM
procedure, the PLMN, the S-NSSAI and optionally the DNN combination when the
UE returns to the PLMN or when it performs inter-system change back from S1
mode to N1 mode. Thus the UE can still be prevented from sending another PDU
SESSION ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION REQUEST message in
the PLMN for the same S-NSSAI and optionally the same DNN.
Upon PLMN change, if T3584 is running or is deactivated for an S-NSSAI, a DNN,
and old PLMN, but T3584 is not running and is not deactivated for the S-NSSAI,
the DNN, and new PLMN, then the UE is allowed to send a PDU SESSION
ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new
PLMN.
Upon PLMN change, if T3585 is running or is deactivated for an S-NSSAI and old
PLMN, but T3585 is not running and is not deactivated for the S-NSSAI and new
PLMN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST
message for the same S-NSSAI in the new PLMN.
If the 5GSM cause value is #27 \"missing or unknown DNN\", the UE shall not
send another PDU SESSION ESTABLISHMENT REQUEST message in the PLMN for the
same DNN that was sent by the UE, until the UE is switched off, the USIM is
removed, or the DNN is included in the LADN information and the network
updates the LADN information during the registration procedure or the generic
UE configuration update procedure.
If the 5GSM cause value is #28 \"unknown PDU session type\" and the PDU
SESSION ESTABLISHMENT REQUEST message contained a PDU session type IE
indicating a PDU session type, the UE may send another PDU SESSION
ESTABLISHMENT REQUEST with the PDU session type IE indicating another PDU
session type or without the PDU session type IE.
If the 5GSM cause value is #50 \"PDU session type IPv4 only allowed\" or #51
\"PDU session type IPv6 only allowed\", the UE shall not subsequently initiate
another UE requested PDU session establishment procedure to the same DNN (or
no DNN, if no DNN was indicated by the UE) and the same S-NSSAI associated
with (if available in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if
no S-NSSAI was indicated by the UE) using the same PDU session type until any
of the following conditions is fulfilled:
a) the UE is registered to a new PLMN which was not in the list of equivalent
PLMNs at the time when the PDU SESSION ESTABLISHMENT REJECT message was
received;
b) the PDU session type which is used to access to the DNN (or no DNN, if no
DNN was indicated by the UE) and the S-NSSAI (or no S-NSSAI, if no S-NSSAI was
indicated by the UE) are changed by the UE which subsequently requests another
PDU session type;
c) the UE is switched off; or
d) the USIM is removed.
In this case, the UE is not prohibited from initiating a UE requested PDN
connectivity procedure to the same DNN (or no DNN, if no DNN was indicated by
the UE) in S1 mode.
If the 5GSM cause value is #54 \"PDU session does not exist\", the UE may
initiate another UE requested PDU session establishment procedure with the
request type set to \"initial request\" in the subsequent PDU SESSION
ESTABLISHMENT REQUEST message to establish a PDU session with the same DNN (or
no DNN, if no DNN was indicated by the UE) and the same S-NSSAI associated
with (if available in roaming scenarios) a mapped S-NSSAI (or no S-NSSAI, if
no S-NSSAI was indicated by the UE).
NOTE 3: User interaction is necessary in some cases when the UE cannot re-
establish the PDU session(s) automatically.
If the 5GSM cause value is #68 \"not supported SSC mode\", UE may send PDU
SESSION ESTABLISHMENT REQUEST with the SSC mode included in the Allowed SSC
mode IE of the PDU SESSION ESTABLISHMENT REJECT message or evaluate other URSP
rules if available as specified in 3GPP TS 24.526 [19].
If the 5GSM cause value is #70 \"missing or unknown DNN in a slice\", the UE
shall not send another PDU SESSION ESTABLISHMENT REQUEST message in the PLMN
for the same DNN and the same S-NSSAI associated with (if available in roaming
scenarios) a mapped S-NSSAI that were sent by the UE, or for the same DNN and
no S-NSSAI if S-NSSAI was not sent by the UE, until the UE is switched off,
the USIM is removed, or the DNN is included in the LADN information and the
network updates the LADN information during the registration procedure or the
generic UE configuration update procedure.
Upon receiving an indication that the 5GSM message was not forwarded due to
the DNN is not supported in a slice along with a PDU SESSION ESTABLISHMENT
REQUEST message with the PDU session ID IE set to the PDU session ID of the
PDU session, the UE:
a) shall stop timer T3580;
b) shall abort the procedure; and
c) shall not send another PDU SESSION ESTABLISHMENT REQUEST message in the
PLMN for the same DNN and the same S-NSSAI that were sent by the UE, or for
the same DNN and no S-NSSAI if S-NSSAI that was not sent by the UE, until:
1) the UE is switched off,
2) the USIM is removed, or
3) the DNN is included in the LADN information and the network updates the
LADN information during the registration procedure or the generic UE
configuration update procedure.
If the 5GSM cause value is #46 \"out of LADN service area\", the UE shall not
send another PDU SESSION ESTABLISHMENT REQUEST message for the LADN DNN
provided by the UE during the PDU session establishment procedure until the
LADN information for the specific LADN DNN is updated as described in
subclause 5.4.4 and subclause 5.5.1.
#### 6.4.1.5 Handling the maximum number of established PDU sessions
The maximum number of PDU sessions which a UE can establish in a PLMN is
limited by whichever is the lowest of: the maximum number of PDU session IDs
allowed by the protocol (as specified in 3GPP TS 24.007 [11] subclause
11.2.3.1b), the PLMN\'s maximum number of PDU sessions and the UE\'s
implementation-specific maximum number of PDU sessions.
If during a UE-requested PDU session establishment procedure the 5GSM sublayer
in the UE receives an indication that the 5GSM message was not forwarded
because the PLMN\'s maximum number of PDU sessions has been reached, then the
UE determines the PLMN\'s maximum number of PDU sessions as the number of
active PDU sessions it has.
NOTE 1: In some situations, when attempting to establish multiple PDU
sessions, the number of active PDU sessions that the UE has when 5GMM cause
#65 is received is not equal to the maximum number of PDU sessions reached in
the network.
NOTE 2: When the network supports emergency services, it is not expected that
5GSM cause #65 is returned by the network when the UE requests an emergency
PDU session.
NOTE 3: There is only one maximum number of PDU sessions for a PLMN regardless
of which access the PDU session exists in.
The PLMN\'s maximum number of PDU sessions applies to the PLMN in which the
5GMM cause #65 \"maximum number of PDU sessions reached\" is received. When
the UE is switched off or when the USIM is removed, the UE shall clear all
previous determinations representing PLMN\'s maximum number of PDU sessions.
Upon successful registration with a new PLMN, the UE may clear previous
determinations representing any PLMN\'s maximum number(s) of PDU sessions.
If the maximum number of established PDU sessions is reached at the UE and the
upper layers of the UE request connectivity to a DNN the UE shall not send a
PDU SESSION ESTABLISHMENT message unless an established PDU session is
released. If the UE needs to release an established PDU session, choosing
which PDU session to release is implementation specific, however the UE shall
not release the emergency PDU session.
If the UE needs to release a PDU session in order to request an emergency PDU
session, it shall either perform a local release of a PDU session or release a
PDU session via explicit signalling. If the UE performs a local release, the
UE shall perform a registration procedure for mobility and periodic
registration update to indicate PDU session status to the network.
#### 6.4.1.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Expiry of timer T3580
The UE shall, on the first expiry of the timer T3580, retransmit the PDU
SESSION ESTABLISHMENT REQUEST message and the PDU session information which
was transported together with the initial transmission of the PDU SESSION
ESTABLISHMENT REQUEST message and shall reset and start timer T3580, if still
needed. This retransmission can be repeated up to four times, i.e. on the
fifth expiry of timer T3580, the UE shall abort the procedure, release the
allocated PTI and enter the state PROCEDURE TRANSACTION INACTIVE.
b) Upon receiving an indication that the 5GSM message was not forwarded due to
routing failure along with a PDU SESSION ESTABLISHMENT REQUEST message with
the PDU session ID IE set to the PDU session ID of the PDU session, the UE
shall stop timer T3580 and shall abort the procedure. If the UE sent the PDU
SESSION ESTABLISHMENT REQUEST message in order for the handover of an existing
non-emergency PDU session between 3GPP access and non-3GPP access, the UE
shall consider that the PDU session is associated with the source access type.
c) Collision of UE-requested PDU session establishment procedure and network-
requested PDU session release procedure.
If the UE receives a PDU SESSION RELEASE COMMAND message after sending a PDU
SESSION ESTABLISHMENT REQUEST message to the network, and the PDU session ID
in the PDU SESSION RELEASE COMMAND message is the same as the PDU session ID
in the PDU SESSION ESTABLISHMENT REQUEST message, the UE shall ignore the PDU
SESSION RELEASE COMMAND message and proceed with the UE-requested PDU session
establishment procedure.
#### 6.4.1.7 Abnormal cases on the network side
The following abnormal cases can be identified:
a) If the received request type is \"initial emergency request\" and there is
already another emergency PDU session for the UE, the SMF shall reject the PDU
SESSION ESTABLISHMENT REQUEST message with 5GSM cause #31 \"request rejected,
unspecified\" or release locally the existing emergency PDU session and
proceed the new PDU SESSION ESTABLISHMENT REQUEST message
b) The information for the PDU session authentication and authorization by the
external DN in PDU DN request container is not compliant with local policy and
user\'s subscription data
If the PDU session being established is a non-emergency PDU session, the PDU
session authentication and authorization by the external DN is required due to
local policy and user\'s subscription data and the information for the PDU
session authentication and authorization by the external DN in PDU DN request
container is not compliant with local policy and user\'s subscription data,
the SMF shall reject the PDU session establishment request including the 5GSM
cause #29 \"user authentication or authorization failed\", in the PDU SESSION
ESTABLISHMENT REJECT message.
c) UE-requested PDU session establishment with request type set to \"initial
request\" or \"initial emergency request\" for an existing PDU session:
If the SMF receives a PDU SESSION ESTABLISHMENT REQUEST message with a PDU
session ID identical to the PDU session ID of an existing PDU session and with
request type set to \"initial request\" or \"initial emergency request\", the
SMF shall release locally the existing PDU session and proceed with the PDU
session establishment procedure.
d) UE-requested PDU session establishment with request type \"existing PDU
session\" or \"existing emergency PDU session\" for a PDU session that does
not exist:
If the SMF receives a PDU SESSION ESTABLISHMENT REQUEST message with request
type set to \"existing PDU session\" or \"existing emergency PDU session\",
and the SMF does not have any information about that PDU session, then the SMF
shall reject the PDU session establishment procedure with the 5GSM cause set
to #54 \"PDU session does not exist\" in the PDU SESSION ESTABLISHMENT REJECT
message.
e) 5G access network cannot forward the message:
If the SMF determines based on content of the n2SmInfo attribute specified in
3GPP TS 29.502 [20A] that the DL NAS TRANSPORT message carrying the PDU
SESSION ESTABLISHMENT ACCEPT was not forwarded to the UE by the 5G access
network, then the SMF shall reject the PDU session establishment procedure
with the 5GSM cause set to #26 \"insufficient resources\" in the PDU SESSION
ESTABLISHMENT REJECT message.
### 6.4.2 UE-requested PDU session modification procedure
#### 6.4.2.1 General
The purpose of the UE-requested PDU session modification procedure is:
a) to enable the UE to request modification of a PDU session;
b) to indicate a change of 3GPP PS data off UE status for a PDU session;
c) to revoke the previously indicated support for reflective QoS;
d) to request specific QoS handling and segregation of service data flows;
e) to indicate to the network the relevant 5GSM parameters and capabilities
(e.g. the UE\'s 5GSM capabilities, whether the UE supports more than 16 packet
filters, the maximum data rate per UE for user-plane integrity protection
supported by the UE for uplink, the maximum data rate per UE for user-plane
integrity protection supported by the UE for downlink and whether the UE
requests the PDU session to be an always-on PDU session in the 5GS) for a PDN
connection established when in S1 mode, after the first inter-system change
from S1 mode to N1 mode, if the UE is operating in single-registration mode in
the network supporting N26 interface; or
f) to delete one or more mapped EPS bearer contexts.
When the UE-requested PDU session modification procedure is used to indicate a
change of 3GPP PS data off UE status for a PDU session (see subclause 6.2.10),
the UE shall initiate the UE-requested PDU session modification procedure even
if the UE is outside the LADN service area or the timer T3396, T3584, or T3585
is running or is deactivated.
If the UE needs to revoke the previously indicated support for reflective QoS
for a PDU session and timer T3396, T3584, or T3585 is running or is
deactivated, the UE shall not initiate the UE-requested PDU session
modification procedure and shall instead initiate the UE-requested PDU session
release procedure.
If the UE needs to initiate the UE-requested PDU session modification
procedure to indicate to the network the relevant 5GSM parameters and
capabilities (e.g. the UE\'s 5GSM capabilities, whether the UE supports more
than 16 packet filters, the maximum data rate per UE for user-plane integrity
protection supported by the UE for uplink, the maximum data rate per UE for
user-plane integrity protection supported by the UE for downlink and whether
the UE requests the PDU session to be an always-on PDU session in the 5GS) for
a PDN connection established when in S1 mode, after the first inter-system
change from S1 mode to N1 mode, the UE is operating in single-registration
mode in the network supporting N26 interface and timer T3396 is running, the
UE shall initiate the UE-requested PDU session modification procedure after
expiry of timer T3396.
#### 6.4.2.2 UE-requested PDU session modification procedure initiation
In order to initiate the UE-requested PDU session modification procedure, the
UE shall create a PDU SESSION MODIFICATION REQUEST message.
The UE shall allocate a PTI value currently not used and shall set the PTI IE
of the PDU SESSION MODIFICATION REQUEST message to the allocated PTI value.
The UE shall not perform the UE-requested PDU session modification procedure
for an emergency PDU session except for the error cases described in subclause
6.4.1.3.
The UE shall not perform the UE-requested PDU session modification procedure
for a PDU session for LADN when the UE is located outside the LADN service
area except for indicating a change of 3GPP PS data off UE status.
If the UE requests a specific QoS handling, the UE shall include the requested
QoS rules IE indicating requested QoS rules or the requested QoS flow
descriptions IE indicating requested QoS flow descriptions or both for the
specific QoS handling. The QoS rules IE includes the packet filters which
describe the service data flows requested by the UE. The specific QoS
parameters requested by the UE is specified in the QoS flow descriptions IE.
If the UE requests the network to bind specific service data flows to a
dedicated QoS flow, the UE shall create a new QoS rule by setting the rule
operation code to \"Create new QoS rule\" and shall set the segregation bit to
\"Segregation requested\" for the corresponding QoS rule in the QoS rules IE.
The UE shall set the QRI values to \"no QoS rule identifier assigned\" in the
requested QoS rules IE, if the QoS rules are newly created; otherwise, the UE
shall set the QRI values to those of the existing QoS rules for which the
specific QoS handling applies. The UE shall set the QFI values to \"no QoS
flow identifier assigned\" in the requested QoS flow descriptions IE, if the
QoS flow descriptions are newly created; otherwise, the UE shall set the QFI
values to the QFIs of the existing QoS flow descriptions for which the
specific QoS handling applies. The UE shall not request to create more than
one QoS flow in a UE-requested PDU session modification procedure.
For a PDN connection established when in S1 mode, after the first inter-system
change from S1 mode to N1 mode, if the UE is operating in single-registration
mode in the network supporting N26 interface, the PDU session is of \"IPv4\",
\"IPv6\", \"IPv4v6\", or \"Ethernet\" PDU session type, and:
a) the UE is performing the PDU session modification procedure to indicate the
support of reflective QoS, the UE shall set the RQoS bit to \"Reflective QoS
supported\" in the 5GSM capability IE of the PDU SESSION MODIFICATION REQUEST
message; or
b) the UE is performing the PDU session modification procedure to indicate
that reflective QoS is not supported, the UE shall set the RQoS bit to
\"Reflective QoS not supported\" in the 5GSM capability IE of the PDU SESSION
MODIFICATION REQUEST message.
If the UE is performing the PDU session modification procedure to revoke the
previously indicated support of reflective QoS, the UE shall set the RQoS bit
to \"Reflective QoS not supported\" in the 5GSM capability IE of the PDU
SESSION MODIFICATION REQUEST message. The UE shall not indicate support for
reflective QoS for this PDU Session for the remaining lifetime of the PDU
Session.
NOTE: The determination to revoke the usage of reflective QoS by the UE for a
PDU session is implementation dependent.
For a PDN connection established when in S1 mode, after the first inter-system
change from S1 mode to N1 mode, if the UE is operating in single-registration
mode in the network supporting N26 interface, the PDU session is of \"IPv6\"
or \"IPv4v6\" PDU session type, and:
a) the UE is performing the PDU session modification procedure to indicate the
support of Multi-homed IPv6 PDU session, the UE shall set the MH6-PDU bit to
\"Multi-homed IPv6 PDU session supported\" in the 5GSM capability IE of the
PDU SESSION MODIFICATION REQUEST message; or
b) the UE is performing the PDU session modification procedure to indicate
that Multi-homed IPv6 PDU session is not supported, the UE shall set the
MH6-PDU bit to \"Multi-homed IPv6 PDU session not supported\" in the 5GSM
capability IE of the PDU SESSION MODIFICATION REQUEST message.
For a PDN connection established when in S1 mode, after the first inter-system
change from S1 mode to N1 mode, if the UE is operating in single-registration
mode in the network supporting N26 interface, the PDU session is of \"IPv4\",
\"IPv6\", \"IPv4v6\", or \"Ethernet\" PDU session type, and the UE supports
more than 16 packet filters for this PDU session, the UE shall indicate the
maximum number of packet filters supported for the PDU session in the Maximum
number of supported packet filters IE of the PDU SESSION MODIFICATION REQUEST
message.
For a PDN connection established when in S1 mode, after the first inter-system
change from S1 mode to N1 mode, if the UE is operating in single-registration
mode in the network supporting N26 interface, the UE shall include the
Integrity protection maximum data rate IE in the PDU SESSION MODIFICATION
REQUEST message.
If the UE is performing the PDU session modification procedure to request the
deletion of a non-default QoS rule due to errors in QoS operations or packet
filters, the UE shall include the 5GSM cause IE in the PDU SESSION
MODIFICATION REQUEST message as described in subclause 6.4.1.3.
When the UE-requested PDU session modification procedure is used to indicate a
change of 3GPP PS data off UE status for a PDU session, the UE shall include
the extended protocol configuration options IE in the PDU SESSION MODIFICATION
REQUEST message and setting the 3GPP PS data off UE status.
For a PDN connection established when in S1 mode, after the first inter-system
change from S1 mode to N1 mode, if the UE is operating in single-registration
mode in the network supporting N26 interface and the UE requests the PDU
session to be an always-on PDU session in the 5GS, the UE shall include the
Always-on PDU session requested IE and set the value of the IE to \"Always-on
PDU session requested\" in the PDU SESSION MODIFICATION REQUEST message.
The UE shall transport:
a) the PDU SESSION MODIFICATION REQUEST message;
b) the PDU session ID; and
c) if the UE-requested PDU session modification:
1) is not initiated to indicate a change of 3GPP PS data off UE status
associated to a PDU session, then the request type set to \"modification
request\"; and
2) is initiated to indicate a change of 3GPP PS data off UE status associated
to a PDU session, then without transporting the request type;
using the NAS transport procedure as specified in subclause 5.4.5, and the UE
shall start timer T3581 (see example in figure 6.4.2.2.1).
Figure 6.4.2.2.1: UE-requested PDU session modification procedure
#### 6.4.2.3 UE-requested PDU session modification procedure accepted by the
network
Upon receipt of a PDU SESSION MODIFICATION REQUEST message, if the SMF accepts
the request to modify the PDU session, the SMF shall perform the network-
requested PDU session modification procedure as specified in subclause 6.3.2.
#### 6.4.2.4 UE-requested PDU session modification procedure not accepted by
the network
Upon receipt of a PDU SESSION MODIFICATION REQUEST message, if the SMF does
not accepts the request to modify the PDU session, the SMF shall create a PDU
SESSION MODIFICATION REJECT message.
The SMF shall set the 5GSM cause IE of the PDU SESSION MODIFICATION REJECT
message to indicate the reason for rejecting the PDU session modification.
The 5GSM cause IE typically indicates one of the following SM cause values:
#26 insufficient resources;
#29 user authentication or authorization failed;
#31 request rejected, unspecified;
#32 service option not supported;
#33 requested service option not subscribed;
#35 PTI already in use;
#43 Invalid PDU session identity;
#46 out of LADN service area;
#67 insufficient resources for specific slice and DNN;
#69 insufficient resources for specific slice; or
#95 -- 111 protocol errors.
If the UE requests a PDU session modification for an LADN when the UE is
located outside of the LADN service area, the SMF shall include the 5GSM cause
value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU SESSION
MODIFICATION REJECT message.
If the Extended protocol configuration options IE of the PDU SESSION
MODIFICATION REQUEST message indicates 3GPP PS data off UE status and the SMF
detects the change of the 3GPP PS data off UE status, the SMF shall not
include the 5GSM cause value #26 \"insufficient resources\", the 5GSM cause
value #67 \"insufficient resources for specific slice and DNN\", the 5GSM
cause value #69 \"insufficient resources for specific slice\" and the 5GSM
cause value #46 \"out of LADN service area\" in the 5GSM cause IE of the PDU
SESSION MODIFICATION REJECT message.
The SMF may include a Back-off timer value IE in the PDU SESSION MODIFICATION
REJECT message when the 5GSM cause value #26 \"insufficient resources\" is
included in the PDU SESSION MODIFICATION REJECT message. If the 5GSM cause
value is #26 \"insufficient resources\" and the PDU SESSION MODIFICATION
REQUEST message was received from a UE configured for high priority access in
selected PLMN or the request type was set to \"initial emergency request\" or
\"existing emergency PDU session\" for the establishment of the PDU session,
the network shall not include a Back-off timer value IE.
The SMF may include a Back-off timer value IE in the PDU SESSION MODIFICATION
REJECT message when the 5GSM cause value #67 \"insufficient resources for
specific slice and DNN\" is included in the PDU SESSION MODIFICATION REJECT
message. If the 5GSM cause value is #67 \"insufficient resources for specific
slice and DNN\" and the PDU SESSION MODIFICATION REQUEST message was received
from a UE configured for high priority access in selected PLMN or the request
type was set to \"initial emergency request\" or \"existing emergency PDU
session\" for the establishment of the PDU session, the network shall not
include a Back-off timer value IE.
The SMF may include a Back-off timer value IE in the PDU SESSION MODIFICATION
REJECT message when the 5GSM cause #69 \"insufficient resources for specific
slice\" is included in the PDU SESSION MODIFICATION REJECT message. If the
5GSM cause value is #69 \"insufficient resources for specific slice\" and the
PDU SESSION MODIFICATION REQUEST message was received from a UE configured for
high priority access in selected PLMN or the request type is set to \"initial
emergency request\" for the establishment of the PDU session, the network
shall not include a Back-off timer value IE.
The SMF shall send the PDU SESSION MODIFICATION REJECT message.
Upon receipt of a PDU SESSION MODIFICATION REJECT message and a PDU session
ID, using the NAS transport procedure as specified in subclause 5.4.5, the UE
shall stop timer T3581, release the allocated PTI value, and enter the state
PROCEDURE TRANSACTION INACTIVE.
If:
\- the 5GSM cause value #26 \"insufficient resources\" and the Back-off timer
value IE are included in the PDU SESSION MODIFICATION REJECT message; or
\- an indication that the 5GSM message was not forwarded due to DNN based
congestion control is received along a Back-off timer value and a PDU SESSION
MODIFICATION REQUEST message with the PDU session ID IE set to the PDU session
ID of the PDU session;
the UE shall ignore the 5GSM congestion re-attempt indicator IE provided by
the network, if any, and the UE shall take different actions depending on the
timer value received for timer T3396 in the Back-off timer value IE (if the UE
is a UE configured for high priority access in selected PLMN, exceptions are
specified in subclause 6.2.7):
a) If the timer value indicates neither zero nor deactivated and a DNN was
provided during the PDU session establishment, the UE shall stop timer T3396
associated with the corresponding DNN, if it is running. If the timer value
indicates neither zero nor deactivated and no DNN was provided during the PDU
session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\", the
UE shall stop timer T3396 associated with no DNN if it is running. The UE
shall then start timer T3396 with the value provided in the Back-off timer
value IE and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or PDU
SESSION MODIFICATION REQUEST message with exception of those identified in
subclause 6.4.2.1, for the same DNN that was sent by the UE, until timer T3396
expires or timer T3396 is stopped; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without a
DNN and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without a DNN provided by
the UE, if no DNN was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", until timer T3396 expires or timer
T3396 is stopped.
The UE shall not stop timer T3396 upon a PLMN change or inter-system change.
b) if the timer value indicates that this timer is deactivated and a DNN was
provided during the PDU session establishment, the UE shall stop timer T3396
associated with the corresponding DNN, if it is running. If the timer value
indicates that this timer is deactivated and no DNN was provided during the
PDU session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\", the
UE shall stop timer T3396 associated with no DNN if it is running. The UE:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST with exception of those identified in subclause
6.4.2.1, for the same DNN until the UE is switched off or the USIM is removed,
or the UE receives a PDU SESSION MODIFICATION COMMAND message for the same DNN
from the network or a PDU SESSION RELEASE COMMAND message including 5GSM cause
#39 \"reactivation requested\" for the same DNN from the network; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without a
DNN and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without a DNN provided by
the UE, if no DNN was provided during the PDU session establishment and the
request type was different from \"initial emergency request\" and different
from \"existing emergency PDU session\", until the UE is switched off or the
USIM is removed, or the UE receives a PDU SESSION MODIFICATION COMMAND message
for a non-emergency PDU session established without a DNN provided by the UE,
or a PDU SESSION RELEASE COMMAND messages including 5GSM cause IE set to 5GSM
cause #39 \"reactivation requested\" for a non-emergency PDU session
established without a DNN provided by the UE.
The timer T3396 remains deactivated upon a PLMN change or inter-system change.
c) if the timer value indicates zero, the UE:
1) shall stop timer T3396 associated with the corresponding DNN, if running,
and may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION
MODIFICATION REQUEST message for the same DNN; and
2) if no DNN was provided during the PDU session establishment and the request
type was different from \"initial emergency request\" and different from
\"existing emergency PDU session\", the UE shall stop timer T3396 associated
with no DNN, if running, and may send another PDU SESSION ESTABLISHMENT
REQUEST message without a DNN, or another PDU SESSION MODIFICATION REQUEST
message without a DNN provided by the UE.
If the Back-off timer value IE is not included, then the UE may send another
PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST
message for the same DNN or without a DNN.
If the timer T3396 is running when the UE enters state5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3396 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3396 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3396 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If the UE is operating in single-registration mode in the network supporting
N26 interface and the PDU SESSION MODIFICATION REQUEST message was sent for a
PDN connection established when in S1 mode after the first inter-system change
from S1 mode to N1 mode, then the UE shall re-initiate the UE-requested PDU
session modification procedure after expiry of timer T3396.
If:
\- the 5GSM cause value #67 \"insufficient resources for specific slice and
DNN\" and the Back-off timer value IE are included in the PDU SESSION
MODIFICATION REJECT message; or
\- an indication that the 5GSM message was not forwarded due to S-NSSAI and
DNN based congestion control is received along a Back-off timer value and a
PDU SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the
PDU session ID of the PDU session;
the UE shall take different actions depending on the timer value received for
timer T3584 in the Back-off timer value IE (if the UE is a UE configured for
high priority access in selected PLMN, exceptions are specified in subclause
6.2.8):
a) If the timer value indicates neither zero nor deactivated, the UE shall
stop timer T3584 associated with the same [S-NSSAI, DNN] combination as that
the UE provided during the PDU session establishment, if it is running. If the
timer value indicates neither zero nor deactivated and no DNN was provided
during the PDU session establishment and the request type was different from
\"initial emergency request\" and different from \"existing emergency PDU
session\", the UE shall stop timer T3584 associated with [S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. If the timer value indicates neither zero nor deactivated and
no S-NSSAI was provided during the PDU session establishment, the UE shall
stop timer T3584 associated with [no S-NSSAI, DNN] combination as that the UE
provided during the PDU session establishment, if it is running. If the timer
value indicates neither zero nor deactivated and neither S-NSSAI nor DNN was
provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3584 associated with [no
S-NSSAI, no DNN] combination as that the UE provided during the PDU session
establishment, if it is running. The UE shall then start timer T3584 with the
value provided in the Back-off timer value IE and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST message with exception of those identified in
subclause 6.4.2.1, for the same [S-NSSAI, DNN] combination that was sent by
the UE, until timer T3584 expires or timer T3584 is stopped;
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST message with exception of those identified in subclause 6.4.2.1, for
the same [S-NSSAI, no DNN] combination that was sent by the UE, if no DNN was
provided during the PDU session establishment, until timer T3584 expires or
timer T3584 is stopped;
3) shall not send another PDU SESSION ESTABLISHMENT REQUEST message, or
another PDU SESSION MODIFICATION REQUEST message with exception of those
identified in subclause 6.4.2.1, for the same [no S-NSSAI, DNN] combination
that was sent by the UE, if no S-NSSAI was provided during the PDU session
establishment, until timer T3584 expires or timer T3584 is stopped; and
4) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST message with exception of those identified in subclause 6.4.2.1, for
the same [no S-NSSAI, no DNN] combination that was sent by the UE, if neither
S-NSSAI nor DNN was provided during the PDU session establishment, until timer
T3584 expires or timer T3584 is stopped.
The UE shall not stop timer T3584 upon a PLMN change or inter-system change.
b) if the timer value indicates that this timer is deactivated, the UE:
1) shall stop timer T3584 associated with the same [S-NSSAI, DNN] combination
as that the UE provided during the PDU session establishment, if it is
running. The UE shall not send another PDU SESSION ESTABLISHMENT REQUEST
message or PDU SESSION MODIFICATION REQUEST message with exception of those
identified in subclause 6.4.2.1, for the same [S-NSSAI, DNN] combination that
was sent by the UE, until the UE is switched off or the USIM is removed, or
the UE receives a PDU SESSION MODIFICATION COMMAND message for the same
[S-NSSAI, DNN] combination from the network or a PDU SESSION RELEASE COMMAND
message including 5GSM cause #39 \"reactivation requested\" for the same
[S-NSSAI, DNN] combination from the network;
2) shall stop timer T3584 associated with the same [S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE shall not send a PDU SESSION ESTABLISHMENT REQUEST
message with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or a PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for the same [S-NSSAI, no DNN] combination that was sent by the UE,
if no DNN was provided during the PDU session establishment, until the UE is
switched off or the USIM is removed, or the UE receives an PDU SESSION
MODIFICATION COMMAND message for a non-emergency PDU session established for
the same [S-NSSAI, no DNN] combination from the network or a PDU SESSION
RELEASE COMMAND message including 5GSM cause #39 \"reactivation requested\"
for a non-emergency PDU session established for the same [S-NSSAI, no DNN]
combination from the network;
3) shall stop timer T3584 associated with the same [no S-NSSAI, DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE shall not send a PDU SESSION ESTABLISHMENT REQUEST
message, or a PDU SESSION MODIFICATION REQUEST message with exception of those
identified in subclause 6.4.2.1, for the same [no S-NSSAI, DNN] combination
that was sent by the UE, if no S-NSSAI was provided during the PDU session
establishment, until the UE is switched off or the USIM is removed, or the UE
receives an PDU SESSION MODIFICATION COMMAND message for the same [no S-NSSAI,
DNN] combination from the network or a PDU SESSION RELEASE COMMAND message
including 5GSM cause #39 \"reactivation requested\" for the same [no S-NSSAI,
DNN] combination from the network; and
4) shall stop timer T3584 associated with the same [no S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE shall not send a PDU SESSION ESTABLISHMENT REQUEST
message with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or a PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for the same [no S-NSSAI, no DNN] combination that was sent by the
UE, if neither S-NSSAI nor DNN was provided during the PDU session
establishment, until the UE is switched off or the USIM is removed, or the UE
receives an PDU SESSION MODIFICATION COMMAND message for a non-emergency PDU
session established for the same [no S-NSSAI, no DNN] combination from the
network or a PDU SESSION RELEASE COMMAND message including 5GSM cause #39
\"reactivation requested\" for a non-emergency PDU session established for the
same [no S-NSSAI, no DNN] combination from the network.
The timer T3584 remains deactivated upon a PLMN change or inter-system change.
c) if the timer value indicates zero, the UE:
1) shall stop timer T3584 associated with the same [S-NSSAI, DNN] combination
as that the UE provided during the PDU session establishment, if it is
running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST message or
PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, DNN]
combination;
2) shall stop timer T3584 associated with the same [S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST
message, or PDU SESSION MODIFICATION REQUEST message for the same [S-NSSAI, no
DNN] combination if no DNN was provided during the PDU session establishment
and the request type was different from \"initial emergency request\" and
different from \"existing emergency PDU session\";
3) shall stop timer T3584 associated with the same [no S-NSSAI, DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST
message, or PDU SESSION MODIFICATION REQUEST message for the same [no S-NSSAI,
DNN] combination if no NSSAI was provided during the PDU session
establishment; and
4) shall stop timer T3584 associated with the same [no S-NSSAI, no DNN]
combination as that the UE provided during the PDU session establishment, if
it is running. The UE may send another PDU SESSION ESTABLISHMENT REQUEST
message, or PDU SESSION MODIFICATION REQUEST message for the same [no S-NSSAI,
no DNN] combination if neither S-NSSAI nor DNN was provided during the PDU
session establishment and the request type was different from \"initial
emergency request\" and different from \"existing emergency PDU session\".
If the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the PDU SESSION MODIFICATION REJECT
message with the 5GSM cause value #67 \"insufficient resources for specific
slice and DNN\", then the UE shall apply the timer T3584 for all the PLMNs.
Otherwise, the UE shall apply the timer T3584 for the registered PLMN.
If the Back-off timer value IE is not included, then the UE may send another
PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST
message for the same [S-NSSAI, DNN] combination, or for the same [S-NSSAI, no
DNN] combination, or for the same [no S-NSSAI, DNN] combination, or for the
same [no S-NSSAI, no DNN] combination.
When the timer T3584 is running or the timer is deactivated, the UE is allowed
to initiate a PDU session establishment procedure for emergency services.
If the timer T3584 is running when the UE enters state5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3584 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3584 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3584 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If the UE is operating in single-registration mode in the network supporting
N26 interface and the PDU SESSION MODIFICATION REQUEST message was sent for a
PDN connection established when in S1 mode after the first inter-system change
from S1 mode to N1 mode, then the UE shall re-initiate the UE-requested PDU
session modification procedure after expiry of timer T3584.
If:
\- the 5GSM cause value #69 \"insufficient resources for specific slice\" and
the Back-off timer value IE are included in the PDU SESSION MODIFICATION
REJECT message; or
\- an indication that the 5GSM message was not forwarded due to S-NSSAI only
based congestion control is received along a Back-off timer value and a PDU
SESSION MODIFICATION REQUEST message with the PDU session ID IE set to the PDU
session ID of the PDU session;
the UE shall take different actions depending on the timer value received for
timer T3585 in the Back-off timer value IE (if the UE is a UE configured for
high priority access in selected PLMN, exceptions are specified in subclause
6.2.8):
a) If the timer value indicates neither zero nor deactivated and an S-NSSAI
was provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3585 associated with the
corresponding S-NSSAI, if it is running. If the timer value indicates neither
zero nor deactivated and no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", the UE shall
stop timer T3585 associated with no S-NSSAI if it is running. The UE shall
then start timer T3585 with the value provided in the Back-off timer value IE
and:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST message with exception of those identified in subclause 6.4.2.1, for a
non-emergency PDU session for the same S-NSSAI that was sent by the UE, until
timer T3585 expires or timer T3585 is stopped; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an
S-NSSAI and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an S-NSSAI
provided by the UE, if no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", until timer
T3585 expires or timer T3585 is stopped.
The UE shall not stop timer T3585 upon a PLMN change or inter-system change.
b) if the timer value indicates that this timer is deactivated and an S-NSSAI
was provided during the PDU session establishment and the request type was
different from \"initial emergency request\" and different from \"existing
emergency PDU session\", the UE shall stop timer T3585 associated with the
corresponding S-NSSAI, if it is running. If the timer value indicates that
this timer is deactivated and no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", the UE shall
stop timer T3585 associated with no S-NSSAI if it is running. The UE:
1) shall not send another PDU SESSION ESTABLISHMENT REQUEST message with
request type different from \"initial emergency request\" and different from
\"existing emergency PDU session\", or another PDU SESSION MODIFICATION
REQUEST with exception of those identified in subclause 6.4.2.1, for a non-
emergency PDU session for the same S-NSSAI until the UE is switched off or the
USIM is removed, or the UE receives a PDU SESSION MODIFICATION COMMAND message
for a non-emergency PDU session for the same S-NSSAI from the network or a PDU
SESSION RELEASE COMMAND message including 5GSM cause #39 \"reactivation
requested\" for the same S-NSSAI from the network; and
2) shall not send another PDU SESSION ESTABLISHMENT REQUEST message without an
S-NSSAI and with request type different from \"initial emergency request\" and
different from \"existing emergency PDU session\", or another PDU SESSION
MODIFICATION REQUEST message with exception of those identified in subclause
6.4.2.1, for a non-emergency PDU session established without an S-NSSAI
provided by the UE, if no S-NSSAI was provided during the PDU session
establishment and the request type was different from \"initial emergency
request\" and different from \"existing emergency PDU session\", until the UE
is switched off or the USIM is removed, or the UE receives a PDU SESSION
MODIFICATION COMMAND message for a non-emergency PDU session established
without an S-NSSAI provided by the UE, or a PDU SESSION RELEASE COMMAND
messages including 5GSM cause IE set to 5GSM cause #39 \"reactivation
requested\" for a non-emergency PDU session established without an S-NSSAI
provided by the UE.
The timer T3585 remains deactivated upon a PLMN change or inter-system change.
c) if the timer value indicates zero, the UE:
1) shall stop timer T3585 associated with the corresponding S-NSSAI, if
running, and may send another PDU SESSION ESTABLISHMENT REQUEST message or PDU
SESSION MODIFICATION REQUEST message for the same S-NSSAI; and
2) if no S-NSSAI was provided during the PDU session establishment and the
request type was different from \"initial emergency request \" and different
from \"existing emergency PDU session\", the UE shall stop timer T3585
associated with no S-NSSAI, if running, and may send another PDU SESSION
ESTABLISHMENT REQUEST message without an S-NSSAI, or another PDU SESSION
MODIFICATION REQUEST message without an S-NSSAI provided by the UE.
If the 5GSM congestion re-attempt indicator IE set to \"The back-off timer is
applied in all PLMNs\" is included in the PDU SESSION MODIFICATION REJECT
message with the 5GSM cause value #69 \"insufficient resources for specific
slice\", then the UE shall apply the timer T3585 for all the PLMNs. Otherwise,
the UE shall apply the timer T3585 for the registered PLMN.
If the Back-off timer value IE is not included, then the UE may send another
PDU SESSION ESTABLISHMENT REQUEST message or PDU SESSION MODIFICATION REQUEST
message for the same S-NSSAI or without an S-NSSAI.
If the timer T3585 is running when the UE enters state5GMM-DEREGISTERED, the
UE remains switched on, and the USIM in the UE remains the same, then timer
T3585 is kept running until it expires or it is stopped.
If the UE is switched off when the timer T3585 is running, and if the USIM in
the UE remains the same when the UE is switched on, the UE shall behave as
follows:
\- let t1 be the time remaining for T3585 timeout at switch off and let t be
the time elapsed between switch off and switch on. If t1 is greater than t,
then the timer shall be restarted with the value t1 -- t. If t1 is equal to or
less than t, then the timer need not be restarted. If the UE is not capable of
determining t, then the UE shall restart the timer with the value t1.
If the UE is operating in single-registration mode in the network supporting
N26 interface and the PDU SESSION MODIFICATION REQUEST message was sent for a
PDN connection established when in S1 mode after the first inter-system change
from S1 mode to N1 mode, then the UE shall re-initiate the UE-requested PDU
session modification procedure after expiry of timer T3585.
NOTE: As described in this subclause, upon PLMN change or inter-system change,
the UE does not stop the timer T3584 or T3585. This means the timer T3584 or
T3585 can still be running or be deactivated for the given 5GSM procedure, the
PLMN, the S-NSSAI and optionally the DNN combination when the UE returns to
the PLMN or when it performs inter-system change back from S1 mode to N1 mode.
Thus the UE can still be prevented from sending another PDU SESSION
ESTABLISHMENT REQUEST or PDU SESSION MODIFICATION REQUEST message in the PLMN
for the same S-NSSAI and optionally the same DNN.
Upon PLMN change, if T3584 is running or is deactivated for an S-NSSAI, a DNN,
and old PLMN, but T3584 is not running and is not deactivated for the S-NSSAI,
the DNN, and new PLMN, then the UE is allowed to send a PDU SESSION
ESTABLISHMENT REQUEST message for the same S-NSSAI and the same DNN in the new
PLMN.
Upon PLMN change, if T3585 is running or is deactivated for an S-NSSAI and old
PLMN, but T3585 is not running and is not deactivated for the S-NSSAI and new
PLMN, then the UE is allowed to send a PDU SESSION ESTABLISHMENT REQUEST
message for the same S-NSSAI in the new PLMN.
If the 5GSM cause value is #46 \"out of LADN service area\", the UE shall not
send another PDU SESSION MODIFICATION REQUEST message for the LADN DNN
provided by the UE during the PDU session establishment procedure until the
LADN information for the specific LADN DNN is updated as described in
subclause 5.4.4 and subclause 5.5.1.
#### 6.4.2.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Expiry of timer T3581.
The UE shall, on the first expiry of the timer T3581, retransmit the PDU
SESSION MODIFICATION REQUEST message and the PDU session information which was
transported together with the initial transmission of the PDU SESSION
MODIFICATION REQUEST message and shall reset and start timer T3581. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3581, the UE shall abort the procedure and shall release the allocated PTI.
b) Invalid PDU session identity.
Upon receipt of the PDU SESSION MODIFICATION REJECT message including 5GSM
cause #43 \"invalid PDU session identity\", the UE shall perform a local
release of the existing PDU session.
c) Collision of network-requested PDU session release procedure and UE-
requested PDU session modification procedure.
If the UE receives a PDU SESSION RELEASE COMMAND message during the UE-
requested PDU session modification procedure, and the PDU session indicated in
the PDU SESSION RELEASE COMMAND message is the PDU session that the UE had
requested to modify, the UE shall abort the PDU session modification procedure
and proceed with the network-requested PDU session release procedure.
d) Handling DL user data packets marked with RQI when UE has already revoked
the usage of reflective QoS
If the UE receives a DL user data packet marked with a RQI and the DL user
data packet belongs to a PDU session of IPv4, IPv6, IPv4v6 or Ethernet PDU
session type for which the UE has already revoked the usage of reflective QoS,
then the UE shall ignore the RQI and shall handle the received DL user data
packet.
e) Collision of network-requested PDU session modification procedure and UE-
requested PDU session modification procedure.
The handling of the same abnormal case as described in subclause 6.3.2.6
applies.
#### 6.4.2.6 Abnormal cases on the network side
The following abnormal cases can be identified:
a) If the PDU session is an emergency PDU session, the SMF shall reject the
PDU SESSION MODIFICATION REQUEST message with 5GSM cause #31 \"request
rejected, unspecified\".
b) PDU session inactive for the received PDU session identity.
If the PDU session ID in the PDU SESSION MODIFICATION REQUEST message belongs
to any PDU session in state PDU SESSION INACTIVE in the SMF, the SMF shall set
the 5GSM cause IE to #43 \"Invalid PDU session identity\" in the PDU SESSION
MODIFICATION REJECT message.
e) Collision of network-requested PDU session modification procedure and UE-
requested PDU session modification procedure.
The handling of the same abnormal case as described in subclause 6.3.2.5
applies.
### 6.4.3 UE-requested PDU session release procedure
#### 6.4.3.1 General
The purpose of the UE-requested PDU session release procedure is to enable by
the UE to request a release of a PDU session.
The UE is allowed to initiate the PDU session release procedure even if the
timer T3396 is running.
The UE is allowed to initiate the PDU session release procedure even if the
timer T3584 is running.
The UE is allowed to initiate the PDU session release procedure even if the
timer T3585 is running.
The UE is allowed to initiate the PDU session release procedure even if the UE
is outside the LADN service area.
#### 6.4.3.2 UE-requested PDU session release procedure initiation
In order to initiate the UE-requested PDU session release procedure, the UE
shall create a PDU SESSION RELEASE REQUEST message.
The UE may set the 5GSM cause IE of the PDU SESSION RELEASE REQUEST message to
indicate the reason for releasing the PDU session.
The 5GSM cause IE typically indicates one of the following 5GSM cause values:
#36 regular deactivation;
#41 Semantic error in the TFT operation;
#42 Syntactical error in the TFT operation;
#44 Semantic errors in packet filter(s);
#45 Syntactical error in packet filter(s).
The UE shall allocate a PTI value currently not used and shall set the PTI IE
of the PDU SESSION RELEASE REQUEST message to the allocated PTI value.
The UE shall transport the PDU SESSION RELEASE REQUEST message and the PDU
session ID, using the NAS transport procedure as specified in subclause 5.4.5,
and the UE shall start timer T3582 (see example in figure 6.4.3.2.1).
If the UE is releasing the PDU session due to errors in QoS operations or
packet filters for the default QoS rule, the UE shall include the 5GSM cause
IE in the PDU SESSION RELEASE REQUEST message as described in subclauses
6.4.1.3.
Figure 6.4.3.2.1: UE-requested PDU session release procedure
#### 6.4.3.3 UE-requested PDU session release procedure accepted by the
network
Upon receipt of a PDU SESSION RELEASE REQUEST message and a PDU session ID, if
the SMF accepts the request to release the PDU session, and shall perform the
network-requested PDU session release procedure as specified in subclause
6.3.3.
#### 6.4.3.4 UE-requested PDU session release procedure not accepted by the
network
Upon receipt of a PDU SESSION RELEASE REQUEST message, if the SMF does not
accept the request to release the PDU session, the SMF shall create a PDU
SESSION RELEASE REJECT message.
The SMF shall set the 5GSM cause IE of the PDU SESSION RELEASE REJECT message
to indicate the reason for rejecting the PDU session release.
The 5GSM cause IE typically indicates one of the following SM cause values:
#35 PTI already in use; or
#43 Invalid PDU session identity; or
#95 -- 111: protocol errors.
The SMF shall send the PDU SESSION RELEASE REJECT message.
Upon receipt of a PDU SESSION RELEASE REJECT message and a PDU session ID,
using the NAS transport procedure as specified in subclause 5.4.5, the UE
shall stop timer T3582 and release the allocated PTI value.
If the PDU SESSION RELEASE REJECT message includes a 5GSM cause IE with a
value different from #43 \"invalid PDU session identity\" or #35 \"PTI already
in use\", the UE shall consider that the PDU session is not released.
#### 6.4.3.5 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Expiry of timer T3582.
The UE shall, on the first expiry of the timer T3582, retransmit the PDU
SESSION RELEASE REQUEST message and the PDU session information which was
transported together with the initial transmission of the PDU SESSION RELEASE
REQUEST message and shall reset and start timer T3582. This retransmission is
repeated four times, i.e. on the fifth expiry of timer T3582, the UE shall
abort the procedure, release the allocated PTI, perform a local release of the
PDU session, and perform the registration procedure for mobility and periodic
registration update with a REGISTRATION REQUEST message including the PDU
session status IE.
b) Collision of UE-requested PDU session release procedure and network-
requested PDU session modification procedure.
When the UE receives a PDU SESSION MODIFICATION COMMAND message during the UE-
requested PDU session release procedure, and the PDU session indicated in PDU
SESSION MODIFICATION COMMAND message is the PDU session that the UE had
requested to release, the UE shall ignore the PDU SESSION MODIFICATION COMMAND
message and proceed with the PDU session release procedure.
c) Collision of UE-requested PDU session release procedure and network-
requested PDU session release procedure.
When the UE receives a PDU SESSION RELEASE COMMAND message with the PTI IE set
to \"No procedure transaction identity assigned\" during the UE-requested PDU
session release procedure, and the PDU session indicated in the PDU SESSION
RELEASE COMMAND message is the same as the PDU session that the UE requests to
release, the UE shall abort the UE-requested PDU session release procedure and
proceed with the network-requested PDU session release procedure.
d) Invalid PDU session identity.
Upon receipt of a PDU SESSION RELEASE REJECT message with a 5GSM cause IE set
to #43 \"invalid PDU session identity\", the UE shall perform a local release
of the PDU session.
e) PTI already in use.
Upon receipt of a PDU SESSION RELEASE REJECT message with a 5GSM cause IE set
to #35 \"PTI already in use\", the UE shall perform a local release of the PDU
session.
#### 6.4.3.6 Abnormal cases on the network side
The following abnormal cases can be identified:
a) PDU session inactive for the received PDU session identity.
If the PDU session ID in the PDU SESSION RELEASE REQUEST message belongs to
any PDU session in state PDU SESSION INACTIVE in the SMF, the SMF shall send
the PDU SESSION RELEASE REJECT message to the UE with the 5GSM cause #43
\"Invalid PDU session identity\".
## 6.5 5GSM status procedure
### 6.5.1 General
The purpose of the sending of the 5GSM STATUS message is to report at any time
certain error conditions detected upon receipt of 5GSM protocol data. The 5GSM
STATUS message can be sent by both the network and the UE (see example in
figure 6.5.1.1).
Figure 6.5.1.1: 5GSM status procedure
### 6.5.2 5GSM status received in the UE
If the 5GSM entity of the UE receives a 5GSM STATUS message the UE shall take
different actions depending on the received 5GSM cause value:
#81 invalid PTI value.
The UE shall abort any ongoing 5GSM procedure related to the received PTI
value and stop any related timer.
#97 Message type non-existent or not implemented.
The UE shall abort any ongoing 5GSM procedure related to the PTI or PDU
session Id and stop any related timer.
On receipt of a 5GSM STATUS message with any other 5GSM cause value no state
transition and no specific action shall be taken as seen from the radio
interface, i.e. local actions are possible.
### 6.5.3 5GSM status received in the SMF
If the SMF receives a 5GSM STATUS message the SMF shall take different actions
depending on the received 5GSM cause value:
#43 invalid PDU session identity.
The SMF shall abort any ongoing 5GSM procedure related to the PTI or PDU
session ID, stop any related timer and locally release the PDU session
indicated in the 5GSM STATUS message.
#47 PTI mismatch.
The SMF shall abort any ongoing 5GSM procedure related to the received PTI
value and stop any related timer.
If the PTI indicated in the 5GSM STATUS message is related to a PDU SESSION
ESTABLISHMENT ACCEPT message, the SMF shall perform a local release of the PDU
session indicated in the PDU SESSION ESTABLISHMENT ACCEPT message.
#81 invalid PTI value.
The SMF shall abort any ongoing 5GSM procedure related to the received PTI
value and stop any related timer.
#96 invalid mandatory information.
The SMF shall abort any ongoing 5GSM procedure related to the PTI or PDU
session ID and stop any related timer.
#97 message type non-existent or not implemented.
The SMF shall abort any ongoing 5GSM procedure related to the PTI or PDU
session ID and stop any related timer.
The local actions to be taken by the SMF on receipt of a 5GSM STATUS message
with any other 5GSM cause value are implementation dependent.
## 6.6 Miscellaneous procedures
### 6.6.1 Exchange of extended protocol configuration options
The UE and the SMF can exchange protocol configuration options via 5GSM
procedures.
The protocol configuration options shall be exchanged via the Extended
protocol configuration options IE.
# 7 Handling of unknown, unforeseen, and erroneous protocol data
## 7.1 General
The procedures specified in the present document apply to those messages which
pass the checks described in this subclause.
This subclause also specifies procedures for the handling of unknown,
unforeseen, and erroneous protocol data by the receiving entity. These
procedures are called \"error handling procedures\", but in addition to
providing recovery mechanisms for error situations they define a compatibility
mechanism for future extensions of the protocols.
Subclauses 7.1 to 7.8 shall be applied in order of precedence.
Detailed error handling procedures in the network are implementation dependent
and may vary from PLMN to PLMN. However, when extensions of this protocol are
developed, networks are assumed to have the error handling which is indicated
in this subclause as mandatory (\"shall\") and that is indicated as strongly
recommended (\"should\").
Also, the error handling of the network is only considered as mandatory or
strongly recommended when certain thresholds for errors are not reached during
a dedicated connection.
For definition of semantical and syntactical errors see 3GPP TS 24.007 [11],
subclause 11.4.2.
## 7.2 Message too short or too long
### 7.2.1 Message too short
When a message is received that is too short to contain a complete message
type information element, that message shall be ignored, cf. 3GPP TS 24.007
[11].
### 7.2.2 Message too long
The maximum size of a NAS message for NR connected to 5GCN is specified in
3GPP TS 38.323 [29].
The maximum size of a NAS message for E-UTRA connected to 5GCN is specified
3GPP TS 36.323 [25].
The maximum size of a NAS message for non-3GPP access connected to 5GCN is
specified in 3GPP TS 24.502 [18]
## 7.3 Unknown or unforeseen procedure transaction identity or PDU Session
identity
### 7.3.1 Procedure transaction identity
The following UE-requested 5GSM procedures shall apply for handling an
unknown, erroneous, or unforeseen PTI received in a 5GSM message:
a) In case the UE receives a PDU SESSION MODIFICATION COMMAND message or a PDU
SESSION MODIFICATION REJECT message in which the PTI value is an assigned
value that does not match any PTI in use:
1) if the UE detects that this PDU SESSION MODIFICATION COMMAND message is a
network retransmission of an already accepted request (see subclause 6.3.2.3),
the UE shall respond with a PDU SESSION MODIFICATION COMPLETE message;
2) if the UE detects that this PDU SESSION MODIFICATION COMMAND message is a
network retransmission of an already rejected request (see subclause 6.3.2.4),
the UE shall respond with a PDU SESSION MODIFICATION COMAND REJECT message;
or3) otherwise, the UE shall respond with a 5GSM STATUS message including 5GSM
cause #47 \"PTI mismatch\".
b) In case the UE receives a PDU SESSION RELEASE COMMAND message or a PDU
SESSION RELEASE REJECT message in which the PTI value is an assigned value
that does not match any PTI in use:
1) if the UE detects that this PDU SESSION RELEASE COMMAND message is a
network retransmission of an already accepted request (see subclause 6.3.3.3),
the UE shall respond with a PDU SESSION RELEASE COMPLETE message; or
2) otherwise, the UE shall respond with a 5GSM STATUS message including 5GSM
cause #47 \"PTI mismatch\".
c) In case the UE receives a PDU SESSION ESTABLISHMENT ACCEPT message or a PDU
SESSION ESTABLISHMENT REJECT message in which the PTI value is an assigned
value that does not match any PTI in use:
1) the UE shall respond with a 5GSM STATUS message including 5GSM cause #47
\"PTI mismatch\".
### 7.3.2 PDU Session identity
The following network procedures shall apply for handling an unknown,
erroneous, or unforeseen PDU session identity received in the header of a 5GSM
message (specified as the header of a standard L3 message, see 3GPP TS 24.007
[11]):
a) If the network receives a PDU SESSION MODIFICATION REQUEST message which
includes an unassigned or reserved PDU session identity value, the network
shall respond with a PDU SESSION MODIFICATION REJECT message including 5GSM
cause #43 \"invalid PDU session identity\".
b) If the network receives PDU SESSION RELEASE REQUEST message which includes
an unassigned or reserved PDU session identity value, the network shall
respond with a PDU SESSION RELEASE REJECT message including 5GSM cause #43
\"invalid PDU session identity\".
c) Upon receipt of an UL NAS TRANSPORT message, the network takes the
following actions:
1) If the Request type IE is set to \"initial request\" or \"initial emergency
request\" and the message includes a reserved PDU session identity value, the
network shall respond with a DL NAS TRANSPORT message with 5GMM cause #90
\"payload was not forwarded\";
2) otherwise, if the message includes an unassigned or reserved PDU session
identity value, the network shall respond with a DL NAS TRANSPORT message with
5GMM cause #90 \"payload was not forwarded\".
d) If the network receives a 5GSM message other than those listed in items a)
through c) above in which the message includes a reserved PDU session identity
value or an assigned value that does not match an existing PDU session, the
network shall ignore the message.
The following UE procedures shall apply for handling an unknown, erroneous, or
unforeseen PDU session identity received in the header of a 5GSM message:
a) If the UE receives a 5GSM message which includes an unassigned or reserved
PDU session identity value, the UE shall ignore the message.
b) If the UE receives a 5GSM message which includes a PDU session identity
belonging to any PDU session in state PDU SESSION INACTIVE in the UE, the UE
shall respond with a 5GSM STATUS message including 5GSM cause #43 \"invalid
PDU session identity\".
## 7.4 Unknown or unforeseen message type
If UE receives a 5GMM message or 5GSM message with message type not defined
for the extended protocol discriminator (EPD) or not implemented by the
receiver, it shall return a status message (5GMM STATUS or 5GSM STATUS
depending on the EPD) with cause #97 \"message type non-existent or not
implemented\".
If the network receives a 5GMM or 5GSM message with message type not defined
for the EPD or not implemented by the receiver in a protocol state where
reception of an unsolicited message with the given EPD from the UE is not
foreseen in the protocol, the network actions are implementation dependent.
Otherwise, if the network receives a message with message type not defined for
the EPD or not implemented by the receiver, it shall ignore the message except
that it should return a status message (5GMM STATUS or 5GSM STATUS depending
on the EPD) with cause #97 \"message type non-existent or not implemented\".
NOTE: A message type not defined for the EPD in the given direction is
regarded by the receiver as a message type not defined for the EPD, see 3GPP
TS 24.007 [11].
If the UE receives a message not compatible with the protocol state, the UE
shall return a status message (5GMM STATUS or 5GSM STATUS depending on the
EPD) with cause #98 \"message type not compatible with protocol state\".
If the network receives a message not compatible with the protocol state, the
network actions are implementation dependent.
## 7.5 Non-semantical mandatory information element errors
### 7.5.1 Common procedures
When on receipt of a message,
a) an \"imperative message part\" error; or
b) a \"missing mandatory IE\" error
is diagnosed or when a message containing:
a) a syntactically incorrect mandatory IE;
b) an IE unknown in the message, but encoded as \"comprehension required\"
(see 3GPP TS 24.007 [11]); or
c) an out of sequence IE encoded as \"comprehension required\" (see 3GPP TS
24.007 [11]) is received,
the UE shall proceed as follows:
If the message is not one of the messages listed in the UE procedures in
subclause 7.5.3, item a), b) or c), the UE shall return a status message (5GMM
STATUS or 5GSM STATUS depending on the EPD) with cause #96 \"invalid mandatory
information\";
the network shall proceed as follows:
If the message is not one of the messages listed in the network procedures in
subclause 7.5.3, item a), b) or c), the network shall either:
1) try to treat the message (the exact further actions are implementation
dependent); or
2) ignore the message except that it should return a status message (5GMM
STATUS or 5GSM STATUS depending on the EPD) with cause #96 \"invalid mandatory
information\".
### 7.5.2 5GS mobility management
No exceptional cases are described for 5GS mobility management messages.
No semantical or syntactical diagnosis other than presence and length shall be
performed on the EPS NAS message container information element in the
REGISTRATION REQUEST message.
### 7.5.3 5GS session management
The following UE procedures shall apply for handling an error encountered with
a mandatory information element in a 5GSM message:
a) If the message is a PDU SESSION ESTABLISHMENT ACCEPT, the UE shall initiate
PDU session release procedure by sending a PDU SESSION RELEASE REQUEST message
with 5GSM cause #96 \"invalid mandatory information\".
b) If the message is a PDU SESSION MODIFICATION COMMAND, a PDU SESSION
MODIFICATION COMMAND REJECT message with 5GSM cause #96 \"invalid mandatory
information\" shall be returned.
c) If the message is a PDU SESSION RELEASE COMMAND, a PDU SESSION RELEASE
COMPLETE message with 5GSM cause #96 \"invalid mandatory information\" shall
be returned.
The following network procedures shall apply for handling an error encountered
with a mandatory information element in a 5GSM message:
a) If the message is a PDU SESSION ESTABLISHMENT REQUEST, a PDU SESSION
ESTABLISHMENT REJECT message with 5GSM cause #96 \"invalid mandatory
information\" shall be returned.
b) If the message is a PDU SESSION MODIFICATION REQUEST, a PDU SESSION
MODIFICATION REJECT message with 5GSM cause #96 \"invalid mandatory
information\" shall be returned.
c) If the message is a PDU SESSION RELEASE REQUEST, a PDU SESSION RELEASE
REJECT message with 5GSM cause #96 \"invalid mandatory information\" shall be
returned.
## 7.6 Unknown and unforeseen IEs in the non-imperative message part
### 7.6.1 IEIs unknown in the message
The UE shall ignore all IEs unknown in a message which are not encoded as
\"comprehension required\" (see 3GPP TS 24.007 [11]).
The network shall take the same approach.
### 7.6.2 Out of sequence IEs
The UE shall ignore all out of sequence IEs in a message which are not encoded
as \"comprehension required\" (see 3GPP TS 24.007 [11]).
The network should take the same approach.
### 7.6.3 Repeated IEs
If an information element with format T, TV, TLV, or TLV-E is repeated in a
message in which repetition of the information element is not specified in
clause 8 and clause 9 of the present document, the UE shall handle only the
contents of the information element appearing first and shall ignore all
subsequent repetitions of the information element. When repetition of
information elements is specified, the UE shall handle only the contents of
specified repeated information elements. If the limit on repetition of
information elements is exceeded, the UE shall handle the contents of
information elements appearing first up to the limit of repetitions and shall
ignore all subsequent repetitions of the information element.
The network should follow the same procedures.
## 7.7 Non-imperative message part errors
This category includes:
a) syntactically incorrect optional IEs; and
b) conditional IE errors.
### 7.7.1 Syntactically incorrect optional IEs
The UE shall treat all optional IEs that are syntactically incorrect in a
message as not present in the message.
The network shall take the same approach.
### 7.7.2 Conditional IE errors
When upon receipt of a 5GMM or 5GSM message the UE diagnoses a \"missing
conditional IE\" error or an \"unexpected conditional IE\" error, or when it
receives a 5GMM or 5GSM message containing at least one syntactically
incorrect conditional IE, the UE shall ignore the message and shall return a
status message (5GMM STATUS or 5GSM STATUS depending on the EPD) with cause
#100 \"conditional IE error\".
When the network receives a message and diagnoses a \"missing conditional IE\"
error or an \"unexpected conditional IE\" error or when it receives a message
containing at least one syntactically incorrect conditional IE, the network
shall either:
a) try to treat the message (the exact further actions are implementation
dependent); or
b) ignore the message except that it should return a status message (5GMM
STATUS or 5GSM STATUS depending on the EPD) with cause #100 \"conditional IE
error\".
## 7.8 Messages with semantically incorrect contents
When a message with semantically incorrect contents is received, the UE shall
perform the foreseen reactions of the procedural part of the present document
(i.e. of clauses 8, 9). If, however no such reactions are specified, the UE
shall ignore the message except that it shall return a status message (5GMM
STATUS or 5GSM STATUS depending on the EPD) with cause #95 \"semantically
incorrect message\".
The network should follow the same procedure except that a status message is
not normally transmitted.
# 8 Message functional definitions and contents
## 8.1 Overview
## 8.2 5GS mobility management messages
### 8.2.1 Authentication request
#### 8.2.1.1 Message definition
The AUTHENTICATION REQUEST message is sent by the AMF to the UE to initiate
authentication of the UE identity. See table 8.2.1.1.1.
Message type: AUTHENTICATION REQUEST
Significance: dual
Direction: network to UE
Table 8.2.1.1.1: AUTHENTICATION REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Aut | Message | M | V | 1 | | | hentication | type | | | | | | request | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | ngKSI | NAS key set | M | V | 1/2 | | | | identifier | | | | | | | | | | | | | | 9.11.3.32 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | ABBA | ABBA | M | LV | 3-n | | | | | | | | | | | 9.11.3.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | 21 | Aut | Aut | O | TV | 17 | | | hentication | hentication | | | | | | parameter | parameter | | | | | | RAND (5G | RAND | | | | | | aut | | | | | | | hentication | 9.11.3.16 | | | | | | challenge) | | | | | +-----+-------------+-------------+----------+--------+--------+ | 20 | Aut | Aut | O | TLV | 18 | | | hentication | hentication | | | | | | parameter | parameter | | | | | | AUTN (5G | AUTN | | | | | | aut | | | | | | | hentication | 9.11.3.15 | | | | | | challenge) | | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.1.2 Authentication parameter RAND
Authentication parameter RAND IE is included if the AUTHENTICATION REQUEST
message is used in a 5G AKA authentication procedure.
#### 8.2.1.3 Authentication parameter AUTN
Authentication parameter AUTN IE is included if the AUTHENTICATION REQUEST
message is used in a 5G AKA authentication procedure.
#### 8.2.1.4 Void
#### 8.2.1.5 EAP message
EAP message IE is included if the AUTHENTICATION REQUEST message is used in an
EAP based primary authentication and key agreement procedure.
### 8.2.2 Authentication response
#### 8.2.2.1 Message definition
The AUTHENTICATION RESPONSE message is sent by the UE to the AMF to deliver a
calculated authentication response to the network. See table 8.2.2.1.1.
Message type: AUTHENTICATION RESPONSE
Significance: dual
Direction: UE to network
Table 8.2.2.1.1: AUTHENTICATION RESPONSE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Aut | Message | M | V | 1 | | | hentication | type | | | | | | response | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | 2D | Aut | Aut | O | TLV | 18 | | | hentication | hentication | | | | | | response | response | | | | | | parameter | parameter | | | | | | | | | | | | | | 9.11.3.17 | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.2.2 Authentication response parameter
This IE is included if the message is sent in a 5G AKA based primary
authentication and key agreement procedure.
#### 8.2.2.3 EAP message
EAP message IE is included if the EAP message received in a related
AUTHENTICATION REQUEST message was an EAP-request.
### 8.2.3 Authentication result
#### 8.2.3.1 Message definition
The AUTHENTICATION RESULT message is sent by the AMF to the UE to provide
result of EAP authentication of the UE identity. See table 8.2.3.1.1.
Message type: AUTHENTICATION RESULT
Significance: dual
Direction: network to UE
Table 8.2.3.1.1: AUTHENTICATION RESULT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Aut | Message | M | V | 1 | | | hentication | type | | | | | | result | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | ngKSI | NAS key set | M | V | 1/2 | | | | identifier | | | | | | | | | | | | | | 9.11.3.32 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | EAP message | EAP message | M | LV-E | 6-1502 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 38 | ABBA | ABBA | O | TLV | 4-n | | | | | | | | | | | 9.11.3.10 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.3.2 ABBA
This IE shall be included if the message contains an EAP message IE with an
EAP-success message.
### 8.2.4 Authentication failure
#### 8.2.4.1 Message definition
The AUTHENTICATION FAILURE message is sent by the UE to the AMF to indicate
that authentication of the network has failed. See table 8.2.4.1.1.
Message type: AUTHENTICATION FAILURE
Significance: dual
Direction: UE to network
Table 8.2.4.1.1: AUTHENTICATION FAILURE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Aut | Message | M | V | 1 | | | hentication | type | | | | | | failure | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GMM cause | 5GMM cause | M | V | 1 | | | | | | | | | | | 9.11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 30 | Aut | Aut | O | TLV | 16 | | | hentication | hentication | | | | | | failure | failure | | | | | | parameter | parameter | | | | | | | | | | | | | | 9.11.3.14 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.4.2 Authentication failure parameter
This IE shall be included in a 5G AKA based primary authentication and key
agreement procedure if and only if the 5GMM cause was #21 \"synch failure\".
It shall include the response to the authentication challenge from the USIM,
which is made up of the AUTS parameter (see 3GPP TS 33.501 [24]).
### 8.2.5 Authentication reject
#### 8.2.5.1 Message definition
The AUTHENTICATION REJECT message is sent by the AMF to the UE to indicate
that the authentication procedure has failed and that the UE shall abort all
activities. See table 8.2.5.1.1.
Message type: AUTHENTICATION REJECT
Significance: dual
Direction: network to UE
Table 8.2.5.1.1: AUTHENTICATION REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Aut | Message | M | V | 1 | | | hentication | type | | | | | | reject | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.5.2 EAP message
EAP message IE is included if the AUTHENTICATION REJECT message is used to
convey EAP-failure message.
### 8.2.6 Registration request
#### 8.2.6.1 Message definition
The REGISTRATION REQUEST message is sent by the UE to the AMF. See table
8.2.6.1.1.
Message type: REGISTRATION REQUEST
Significance: dual
Direction: UE to network
Table 8.2.6.1.1: REGISTRATION REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | Protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Security | Security | M | V | 1/2 | | | header | header | | | | | | type | type | | | | | | | | | | | | | | 9.3 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | Re | Message | M | V | 1 | | | gistration | type | | | | | | request | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GS | 5GS | M | V | 1/2 | | | re | re | | | | | | gistration | gistration | | | | | | type | type | | | | | | | | | | | | | | 9.11.3.7 | | | | +-----+------------+------------+----------+--------+---------+ | | ngKSI | NAS key | M | V | 1/2 | | | | set | | | | | | | identifier | | | | | | | | | | | | | | 9.11.3.32 | | | | +-----+------------+------------+----------+--------+---------+ | | 5GS mobile | 5GS mobile | M | LV-E | 6-n | | | identity | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+------------+------------+----------+--------+---------+ | C- | N | NAS key | O | TV | 1 | | | on-current | set | | | | | | native NAS | identifier | | | | | | key set | | | | | | | identifier | 9.11.3.32 | | | | +-----+------------+------------+----------+--------+---------+ | 10 | 5GMM | 5GMM | O | TLV | 3-15 | | | capability | capability | | | | | | | | | | | | | | 9.11.3.1 | | | | +-----+------------+------------+----------+--------+---------+ | 2E | UE | UE | O | TLV | 4-10 | | | security | security | | | | | | capability | capability | | | | | | | | | | | | | | 9.11.3.54 | | | | +-----+------------+------------+----------+--------+---------+ | 2F | Requested | NSSAI | O | TLV | 4-74 | | | NSSAI | | | | | | | | 9.11.3.37 | | | | +-----+------------+------------+----------+--------+---------+ | 52 | Last | 5GS | O | TV | 7 | | | visited | tracking | | | | | | registered | area | | | | | | TAI | identity | | | | | | | | | | | | | | 9.11.3.8 | | | | +-----+------------+------------+----------+--------+---------+ | 17 | S1 UE | S1 UE | O | TLV | 4-15 | | | network | network | | | | | | capability | capability | | | | | | | | | | | | | | 9.11.3.48 | | | | +-----+------------+------------+----------+--------+---------+ | 40 | Uplink | Uplink | O | TLV | 4-34 | | | data | data | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.57 | | | | +-----+------------+------------+----------+--------+---------+ | 50 | PDU | PDU | O | TLV | 4-34 | | | session | session | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.44 | | | | +-----+------------+------------+----------+--------+---------+ | B- | MICO | MICO | O | TV | 1 | | | indication | indication | | | | | | | | | | | | | | 9.11.3.31 | | | | +-----+------------+------------+----------+--------+---------+ | 2B | UE status | UE status | O | TLV | 3 | | | | | | | | | | | 9.11.3.56 | | | | +-----+------------+------------+----------+--------+---------+ | 77 | Additional | 5GS mobile | O | TLV-E | 14 | | | GUTI | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+------------+------------+----------+--------+---------+ | 25 | Allowed | Allowed | O | TLV | 4-34 | | | PDU | PDU | | | | | | session | session | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.13 | | | | +-----+------------+------------+----------+--------+---------+ | 18 | UE\'s | UE\'s | O | TLV | 3 | | | usage | usage | | | | | | setting | setting | | | | | | | | | | | | | | 9.11.3.55 | | | | +-----+------------+------------+----------+--------+---------+ | 51 | Requested | 5GS DRX | O | TLV | 3 | | | DRX | parameters | | | | | | parameters | | | | | | | | 9.11.3.2A | | | | +-----+------------+------------+----------+--------+---------+ | 70 | EPS NAS | EPS NAS | O | TLV-E | 4-n | | | message | message | | | | | | container | container | | | | | | | | | | | | | | 9.11.3.24 | | | | +-----+------------+------------+----------+--------+---------+ | 74 | LADN | LADN | O | TLV-E | 3-811 | | | indication | indication | | | | | | | | | | | | | | 9.11.3.29 | | | | +-----+------------+------------+----------+--------+---------+ | 8- | Payload | Payload | O | TV | 1 | | | container | container | | | | | | type | type | | | | | | | | | | | | | | 9.11.3.40 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Payload | Payload | O | TLV-E | 4-65538 | | | container | container | | | | | | | | | | | | | | 9.11.3.39 | | | | +-----+------------+------------+----------+--------+---------+ | 9- | Network | Network | O | TV | 1 | | | slicing | slicing | | | | | | indication | indication | | | | | | | | | | | | | | 9.11.3.36 | | | | +-----+------------+------------+----------+--------+---------+ | 53 | 5GS update | 5GS update | O | TLV | 3 | | | type | type | | | | | | | | | | | | | | 9.11.3.9A | | | | +-----+------------+------------+----------+--------+---------+ | 71 | NAS | NAS | O | TLV-E | 4-n | | | message | message | | | | | | container | container | | | | | | | | | | | | | | 9.11.3.33 | | | | +-----+------------+------------+----------+--------+---------+ | 60 | EPS bearer | EPS bearer | O | TLV | 4 | | | context | context | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.23A | | | | +-----+------------+------------+----------+--------+---------+
#### 8.2.6.2 Non-current native NAS key set identifier
The UE shall include this IE if the UE has a valid non-current native 5G NAS
security context when the UE performs a inter-system change from S1 mode to N1
mode in 5GMM-CONNECTED mode and the UE uses a mapped 5G NAS security context
to protect the REGISTRATION REQUEST message.
#### 8.2.6.3 5GMM capability
The UE shall include this IE, unless the UE performs a periodic registration
updating procedure.
#### 8.2.6.4 UE security capability
The UE shall include this IE, unless the UE performs a periodic registration
updating procedure.
#### 8.2.6.5 Requested NSSAI
This IE shall be included by the UE when performing the registration procedure
if the 5GS registration type IE:
a) indicates \"initial registration\" or \"mobility registration updating\",
and:
1) the UE has a configured NSSAI for the current PLMN;
2) the UE has an allowed NSSAI for the current PLMN; or
3) the UE has neither allowed NSSAI for the current PLMN nor configured NSSAI
for the current PLMN and has a default configured NSSAI.
#### 8.2.6.6 Last visited registered TAI
This IE shall be included if the UE holds a valid last visited registered TAI.
#### 8.2.6.7 S1 UE network capability
A UE supporting S1 mode shall include this IE, unless the UE performs a
periodic registration updating procedure.
#### 8.2.6.8 Uplink data status
This IE shall be included if the UE has uplink user data pending to be sent.
#### 8.2.6.9 PDU session status
This IE shall be included when the UE needs to indicate the PDU sessions that
are associated with the access type that the message is sent over, that are
active within the UE.
#### 8.2.6.10 MICO indication
The UE may include this IE to request the use of MICO mode.
#### 8.2.6.11 UE status
This IE shall be included if the UE in single-registration mode performs the
registration procedure due to inter-system change from S1 mode to N1 mode or
if the UE in dual-registration mode and EMM state EMM-REGISTERED performs
initial registration.
#### 8.2.6.12 Additional GUTI
This IE shall be included if the UE performs the registration procedure due to
inter-system change from S1 mode to N1 mode, the UE operates in single-
registration mode and the UE has a 5G-GUTI.
#### 8.2.6.13 Allowed PDU session status
This IE shall be included if the REGISTRATION REQUEST message is sent as a
response to paging with the access type indicating non-3GPP access and the UE
wants to indicate the user-plane resources of PDU session(s) associated with
non-3GPP access allowed to be re-established over 3GPP access.
#### 8.2.6.14 UE\'s usage setting
This IE shall be included if the UE supports IMS voice.
#### 8.2.6.15 Requested DRX parameters
If the UE wants to use or change the UE specific DRX parameters, the UE shall
include the Requested DRX parameters IE in the REGISTRATION REQUEST message.
#### 8.2.6.16 EPS NAS message container
The UE operating in the single-registration mode shall include this
information element if the UE performs mobility from S1 mode to N1 mode. The
content of this message container is the complete integrity protected TRACKING
AREA UPATE REQUEST message, using EPS NAS security context.
#### 8.2.6.17 LADN indication
The UE shall include this information element when the UE needs to request
LADN information for specific LADN DNN(s) or to indicate a request for LADN
information.
#### 8.2.6.17A Payload container type
This IE shall be included if the UE includes the Payload container IE.
NOTE: In this version of the protocol, the Payload container type IE in the
REGISTRATION REQUEST message is set to \"UE policy container\" as described in
subclauses 5.5.1.2.2 and 5.5.1.3.2.
#### 8.2.6.18 Payload container
This IE shall be included if the UE has one or more stored UE policy sections
identified by a UPSI with the PLMN ID part indicating the HPLMN or the
selected PLMN for the registration procedure for mobility and periodic
registration update due to inter-system change from S1 mode to N1 mode of a UE
operating in the single-registration mode or for the registration procedure
for initial registration.
#### 8.2.6.19 Network slicing indication
This IE shall be included when a requested NSSAI is included in the
REGISTRATION REQUEST message and the requested NSSAI is created from the
default configured NSSAI.
#### 8.2.6.20 5GS update type
This IE shall be included when the UE is performing the registration procedure
to indicate any of the following:
a) the UE requests the use of SMS over NAS or there is a change in the UE\'s
requirements to use SMS over NAS; or
b) a change in the UE\'s radio capability for NG-RAN.
#### 8.2.6.21 NAS message container
This IE shall be included if the UE is sending a REGISTRATION REQUEST message
as an initial NAS message, the UE has a valid 5G NAS security context and the
UE needs to send non-cleartext IEs.
#### 8.2.6.22 EPS bearer context status
The UE shall include this IE if the UE operating in the single-registration
mode performs inter-system change from S1 mode to N1 mode and the UE has
locally deactivated EPS bearer context(s) for which interworking to 5GS is
supported while the UE was in S1 mode without notifying the network.
### 8.2.7 Registration accept
#### 8.2.7.1 Message definition
The REGISTRATION ACCEPT message is sent by the AMF to the UE. See table
8.2.7.1.1.
Message type: REGISTRATION ACCEPT
Significance: dual
Direction: network to UE
Table 8.2.7.1.1: REGISTRATION ACCEPT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Security | Security | M | V | 1/2 | | | header | header | | | | | | type | type | | | | | | | | | | | | | | 9.3 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | Re | Message | M | V | 1 | | | gistration | type | | | | | | accept | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GS | 5GS | M | LV | 2 | | | re | re | | | | | | gistration | gistration | | | | | | result | result | | | | | | | | | | | | | | 9.11.3.6 | | | | +-----+------------+------------+----------+--------+---------+ | 77 | 5G-GUTI | 5GS mobile | O | TLV-E | 14 | | | | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+------------+------------+----------+--------+---------+ | 4A | Equivalent | PLMN list | O | TLV | 5-47 | | | PLMNs | | | | | | | | 9.11.3.45 | | | | +-----+------------+------------+----------+--------+---------+ | 54 | TAI list | 5GS | O | TLV | 9-114 | | | | tracking | | | | | | | area | | | | | | | identity | | | | | | | list | | | | | | | | | | | | | | 9.11.3.9 | | | | +-----+------------+------------+----------+--------+---------+ | 15 | Allowed | NSSAI | O | TLV | 4-74 | | | NSSAI | | | | | | | | 9.11.3.37 | | | | +-----+------------+------------+----------+--------+---------+ | 11 | Rejected | Rejected | O | TLV | 4-42 | | | NSSAI | NSSAI | | | | | | | | | | | | | | 9.11.3.46 | | | | +-----+------------+------------+----------+--------+---------+ | 31 | Configured | NSSAI | O | TLV | 4-146 | | | NSSAI | | | | | | | | 9.11.3.37 | | | | +-----+------------+------------+----------+--------+---------+ | 21 | 5GS | 5GS | O | TLV | 3-5 | | | network | network | | | | | | feature | feature | | | | | | support | support | | | | | | | | | | | | | | 9.11.3.5 | | | | +-----+------------+------------+----------+--------+---------+ | 50 | PDU | PDU | O | TLV | 4-34 | | | session | session | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.44 | | | | +-----+------------+------------+----------+--------+---------+ | 26 | PDU | PDU | O | TLV | 4-34 | | | session | session | | | | | | re | re | | | | | | activation | activation | | | | | | result | result | | | | | | | | | | | | | | 9.11.3.42 | | | | +-----+------------+------------+----------+--------+---------+ | 72 | PDU | PDU | O | TLV-E | 5-515 | | | session | session | | | | | | re | re | | | | | | activation | activation | | | | | | result | result | | | | | | error | error | | | | | | cause | cause | | | | | | | | | | | | | | 9.11.3.43 | | | | +-----+------------+------------+----------+--------+---------+ | 79 | LADN | LADN | O | TLV-E | 12-1715 | | | i | i | | | | | | nformation | nformation | | | | | | | | | | | | | | 9.11.3.30 | | | | +-----+------------+------------+----------+--------+---------+ | B- | MICO | MICO | O | TV | 1 | | | indication | indication | | | | | | | | | | | | | | 9.11.3.31 | | | | +-----+------------+------------+----------+--------+---------+ | 9- | Network | Network | O | TV | 1 | | | slicing | slicing | | | | | | indication | indication | | | | | | | | | | | | | | 9.11.3.36 | | | | +-----+------------+------------+----------+--------+---------+ | 27 | Service | Service | O | TLV | 6-114 | | | area list | area list | | | | | | | | | | | | | | 9.11.3.49 | | | | +-----+------------+------------+----------+--------+---------+ | 5E | T3512 | GPRS timer | O | TLV | 3 | | | value | 3 | | | | | | | | | | | | | | 9.11.2.5 | | | | +-----+------------+------------+----------+--------+---------+ | 5D | Non-3GPP | GPRS timer | O | TLV | 3 | | | de-re | 2 | | | | | | gistration | | | | | | | timer | 9.11.2.4 | | | | | | value | | | | | +-----+------------+------------+----------+--------+---------+ | 16 | T3502 | GPRS timer | O | TLV | 3 | | | value | 2 | | | | | | | | | | | | | | 9.11.2.4 | | | | +-----+------------+------------+----------+--------+---------+ | 34 | Emergency | Emergency | O | TLV | 5-50 | | | number | number | | | | | | list | list | | | | | | | | | | | | | | 9.11.3.23 | | | | +-----+------------+------------+----------+--------+---------+ | 7A | Extended | Extended | O | TLV-E | 7-65538 | | | emergency | emergency | | | | | | number | number | | | | | | list | list | | | | | | | | | | | | | | 9.11.3.26 | | | | +-----+------------+------------+----------+--------+---------+ | 73 | SOR | SOR | O | TLV-E | 20-2048 | | | t | t | | | | | | ransparent | ransparent | | | | | | container | container | | | | | | | | | | | | | | 9.11.3.51 | | | | +-----+------------+------------+----------+--------+---------+ | 78 | EAP | EAP | O | TLV-E | 7-1503 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+------------+------------+----------+--------+---------+ | A- | NSSAI | NSSAI | O | TV | 1 | | | inclusion | inclusion | | | | | | mode | mode | | | | | | | | | | | | | | 9.11.3.37A | | | | +-----+------------+------------+----------+--------+---------+ | 76 | Operat | Operat | O | TLV-E | 3-n | | | or-defined | or-defined | | | | | | access | access | | | | | | category | category | | | | | | d | d | | | | | | efinitions | efinitions | | | | | | | | | | | | | | 9.11.3.38 | | | | +-----+------------+------------+----------+--------+---------+ | 51 | Negotiated | 5GS DRX | O | TLV | 3 | | | DRX | parameters | | | | | | parameters | | | | | | | | 9.11.3.2A | | | | +-----+------------+------------+----------+--------+---------+ | D- | Non-3GPP | Non-3GPP | O | TV | 1 | | | NW | NW | | | | | | policies | provided | | | | | | | policies | | | | | | | | | | | | | | 9.11.3.36A | | | | +-----+------------+------------+----------+--------+---------+ | 60 | EPS bearer | EPS bearer | O | TLV | 4 | | | context | context | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.23A | | | | +-----+------------+------------+----------+--------+---------+
#### 8.2.7.2 5G-GUTI
This IE may be included to assign a 5G-GUTI to a UE.
#### 8.2.7.3 Equivalent PLMNs
This IE may be included in order to assign a new equivalent PLMNs list to a
UE.
#### 8.2.7.4 TAI list
This IE may be included to assign a TAI list to a UE.
#### 8.2.7.5 Allowed NSSAI
This IE shall be included:
a) if the network allows one or more S-NSSAIs received in the requested NSSAI
of the REGISTRATION REQUEST message; or
b) if the requested NSSAI was not included in the REGISTRATION REQUEST message
or none of the requested NSSAI are present in the subscribed S-NSSAIs and the
network has one or more subscribed S-NSSAIs marked as default that are
available.
#### 8.2.7.6 Rejected NSSAI
The network may include this IE to inform the UE of the S-NSSAIs that were
included in the requested NSSAI in the REGISTRATION REQUEST message but were
rejected by the network.
#### 8.2.7.7 Configured NSSAI
The network may include this IE if the network needs to provide the UE with a
new configured NSSAI for the current PLMN.
#### 8.2.7.8 5GS network feature support
The network may include this IE to inform the UE of the support of certain
features. If this IE is not included then the UE shall interpret this as a
receipt of an information element with all bits of the value part coded as
zero.
#### 8.2.7.9 PDU session status
This IE shall be included when the network needs to indicate the PDU sessions
that are associated with the access type the message is sent over, that are
active in the network.
#### 8.2.7.10 PDU session reactivation result
This IE shall be included:
\- if the Uplink data status IE is included in the REGISTRATION REQUEST
message;
\- if the Allowed PDU session status IE is included in the REGISTRATION
REQUEST message and there is at least one PDU session indicated in the Allowed
PDU session status IE for which the user-plane resources can be re-established
over 3GPP access.
#### 8.2.7.11 PDU session reactivation result error cause
This IE may be included, if the PDU session reactivation result IE is included
and there exist one or more PDU sessions for which the user-plane resources
cannot be re-established, to indicate the cause of failure to re-establish the
user-plane resources
#### 8.2.7.12 LADN information
The network shall include this IE if there are valid LADN service area(s) for
the subscribed DNN(s) of the UE in the current registration area.
#### 8.2.7.13 MICO indication
The network shall include the MICO indication IE if:
a)- the UE included the MICO indication IE in the REGISTRATION REQUEST
message; and
b) the network supports and accepts the use of MICO mode.
#### 8.2.7.14 Network slicing indication
This IE shall be included if the user\'s network slicing subscription has
changed in the UDM.
#### 8.2.7.15 Service area list
This IE may be included to assign new service area restrictions to the UE.
#### 8.2.7.16 T3512 value
The AMF shall include this IE during a registration procedure over 3GPP access
when the 5GS registration type IE does not indicate \"periodic registration
updating\". The AMF may include this IE during the mobility and periodic
registration update procedure over 3GPP access when the 5GS registration type
IE indicates \"periodic registration updating\".
#### 8.2.7.17 Non-3GPP de-registration timer value
This IE may be included if the network needs to indicate to the UE registered
over non-3GPP access the value of a non-3GPP de-registration timer value.
#### 8.2.7.18 T3502 value
This IE may be included to indicate a value for timer T3502.
#### 8.2.7.19 Emergency number list
This IE may be sent by the network. If this IE is sent, the contents of this
IE indicates a list of emergency numbers valid within the same country as in
the PLMN from which this IE is received.
#### 8.2.7.20 Extended emergency number list
This IE may be sent by the network. If this IE is sent, the contents of this
IE indicates a list of emergency numbers (with URN information) valid within
the same country as in the PLMN from which this IE is received or valid only
in the PLMN from which this IE is received.
#### 8.2.7.21 SOR transparent container
This IE may be sent by the network. If this IE is sent, the contents of this
IE includes the list of preferred PLMN/access technology combinations (or
HPLMN indication that \'no change of the \"Operator Controlled PLMN Selector
with Access Technology\" list stored in the UE is needed and thus no list of
preferred PLMN/access technology combinations is provided\') (see 3GPP TS
23.122 [5] annex C) and optional acknowledgement request.
#### 8.2.7.22 EAP message
EAP message IE is included if the REGISTRATION ACCEPT message is sent as part
of registration for emergency services and is used to convey EAP-failure
message.
#### 8.2.7.23 NSSAI inclusion mode
This IE shall be included if required by operatory policy.
#### 8.2.7.24 Operator-defined access category definitions
This IE may be included to assign new operator-defined access category
definitions to the UE or delete the operator-defined access category
definitions at the UE side.
#### 8.2.7.25 Negotiated DRX parameters
The network shall include this IE if the Requested DRX parameters IE was
included in the REGISTRATION REQUEST message.
#### 8.2.7.26 Non-3GPP NW provided policies
The AMF shall not include this IE during a registration procedure over
non-3GPP access.
This IE is included if the network needs to indicate whether emergency numbers
provided via non-3GPP access can be used to initiate UE detected emergency
calls (see 3GPP TS 24.302 [16]). If this IE is not included then the UE shall
interpret this as a receipt of an information element with all bits of the
value part coded as zero.
NOTE: In this version of the specification, this IE is applicable in case the
UE is connected to a PLMN using an ePDG as specified in 3GPP TS 24.302 [16].
#### 8.2.7.27 EPS bearer context status
This IE shall be included when the network generated an EPS bearer context
status information for the UE during the inter-system change from S1 mode to
N1 mode and the network supports N26 interface.
### 8.2.8 Registration complete
#### 8.2.8.1 Message definition
The REGISTRATION COMPLETE message is sent by the UE to the AMF. See table
8.2.8.1.1.
Message type: REGISTRATION COMPLETE
Significance: dual
Direction: UE to network
Table 8.2.8.1.1: REGISTRATION COMPLETE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Security | Security | M | V | 1/2 | | | header | header | | | | | | type | type | | | | | | | | | | | | | | 9.3 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | Re | Message | M | V | 1 | | | gistration | type | | | | | | complete | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 73 | SOR | SOR | O | TLV-E | 20-2048 | | | t | t | | | | | | ransparent | ransparent | | | | | | container | container | | | | | | | | | | | | | | 9.11.3.51 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.2.8.2 SOR transparent container
This IE may be sent by the UE. If this IE is sent, the contents of this IE
indicates the UE acknowledgement of successful reception of the SOR
transparent container IE in the REGISTRATION ACCEPT message.
### 8.2.9 Registration reject
#### 8.2.9.1 Message definition
The REGISTRATION REJECT message is sent by the AMF to the UE. See table
8.2.9.1.1.
Message type: REGISTRATION REJECT
Significance: dual
Direction: network to UE
Table 8.2.9.1.1: REGISTRATION REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | R | Message | M | V | 1 | | | egistration | type | | | | | | reject | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GMM cause | 5GMM cause | M | V | 1 | | | | | | | | | | | 9.11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5F | T3346 value | GPRS timer | O | TLV | 3 | | | | 2 | | | | | | | | | | | | | | 9.11.2.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 16 | T3502 value | GPRS timer | O | TLV | 3 | | | | 2 | | | | | | | | | | | | | | 9.11.2.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.9.2 T3346 value
The AMF may include this IE when the general NAS level mobility management
congestion control is active
#### 8.2.9.3 T3502 value
This IE may be included to indicate a value for timer T3502 during the initial
registration.
#### 8.2.9.4 EAP message
EAP message IE is included if the REGISTRATION REJECT message is used to
convey EAP-failure message.
### 8.2.10 UL NAS transport
#### 8.2.10.1 Message definition
The UL NAS TRANSPORT message transports message payload and associated
information to the AMF. See table 8.2.10.1.1.
Message type: UL NAS TRANSPORT
Significance: dual
Direction: UE to network
Table 8.2.10.1.1: UL NAS TRANSPORT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Security | Security | M | V | 1/2 | | | header | header | | | | | | type | type | | | | | | | | | | | | | | 9.3 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | UL NAS | Message | M | V | 1 | | | TRANSPORT | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+------------+------------+----------+--------+---------+ | | Payload | Payload | M | V | 1/2 | | | container | container | | | | | | type | type | | | | | | | | | | | | | | 9.11.3.40 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | Payload | Payload | M | LV-E | 3-65537 | | | container | container | | | | | | | | | | | | | | 9.11.3.39 | | | | +-----+------------+------------+----------+--------+---------+ | 12 | PDU | PDU | C | TV | 2 | | | session ID | session | | | | | | | identity 2 | | | | | | | | | | | | | | 9.11.3.41 | | | | +-----+------------+------------+----------+--------+---------+ | 59 | Old PDU | PDU | O | TV | 2 | | | session ID | session | | | | | | | identity 2 | | | | | | | | | | | | | | 9.11.3.41 | | | | +-----+------------+------------+----------+--------+---------+ | 8 | Request | Request | O | TV | 1 | | | type | type | | | | | | | | | | | | | | 9.11.3.47 | | | | +-----+------------+------------+----------+--------+---------+ | 22 | S-NSSAI | S-NSSAI | O | TLV | 3-10 | | | | | | | | | | | 9.11.2.8 | | | | +-----+------------+------------+----------+--------+---------+ | 25 | DNN | DNN | O | TLV | 3-102 | | | | | | | | | | | 9.11.2.1A | | | | +-----+------------+------------+----------+--------+---------+ | 24 | Additional | Additional | O | TLV | 3-n | | | i | i | | | | | | nformation | nformation | | | | | | | | | | | | | | 9.11.2.1 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.2.10.2 PDU session ID
The UE shall include this IE when the Payload container type IE is set to \"N1
SM information\".
#### 8.2.10.3 Old PDU session ID
The UE shall include this IE if the UL NAS TRANSPORT message transports a PDU
SESSION ESTABLISHMENT REQUEST message upon receiving the PDU SESSION
MODIFICATION COMMAND message with the 5GSM cause IE set to #39 \"reactivation
requested\" and the Payload container type IE is set to \"N1 SM information\".
#### 8.2.10.4 Request type
The UE shall include this IE when the PDU session ID IE is included and the
Payload container IE contains the PDU SESSION ESTABLISHMENT REQUEST message or
the PDU SESSION MODIFICATION REQUEST which is not initiated to indicate a
change of 3GPP PS data off UE status associated to a PDU session.
#### 8.2.10.5 S-NSSAI
The UE may include this IE when the Request type IE is set to \"initial
request\" or \"existing PDU session\" and the Payload container type IE is set
to \"N1 SM information\".
#### 8.2.10.6 DNN
The UE may include this IE when the Request type IE is set to \"initial
request\" or \"existing PDU session\" and the Payload container type IE is set
to \"N1 SM information\".
#### 8.2.10.7 Additional information
The UE may include this IE when the Payload container type IE is set to \"LTE
Positioning Protocol (LPP) message container\".
### 8.2.11 DL NAS transport
#### 8.2.11.1 Message definition
The DL NAS TRANSPORT message transports message payload and associated
information to the UE. See table 8.2.11.1.1.
Message type: DL NAS TRANSPORT
Significance: dual
Direction: network to UE
Table 8.2.11.1.1: DL NAS TRANSPORT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Security | Security | M | V | 1/2 | | | header | header | | | | | | type | type | | | | | | | | | | | | | | 9.3 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | DL NAS | Message | M | V | 1 | | | TRANSPORT | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+------------+------------+----------+--------+---------+ | | Payload | Payload | M | V | 1/2 | | | container | container | | | | | | type | type | | | | | | | | | | | | | | 9.11.3.40 | | | | +-----+------------+------------+----------+--------+---------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+------------+------------+----------+--------+---------+ | | Payload | Payload | M | LV-E | 3-65537 | | | container | container | | | | | | | | | | | | | | 9.11.3.39 | | | | +-----+------------+------------+----------+--------+---------+ | 12 | PDU | PDU | C | TV | 2 | | | session ID | session | | | | | | | identity 2 | | | | | | | | | | | | | | 9.11.3.41 | | | | +-----+------------+------------+----------+--------+---------+ | 24 | Additional | Additional | O | TLV | 3-n | | | i | i | | | | | | nformation | nformation | | | | | | | | | | | | | | 9.11.2.1 | | | | +-----+------------+------------+----------+--------+---------+ | 58 | 5GMM cause | 5GMM cause | O | TV | 2 | | | | | | | | | | | 9.11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | 37 | Back-off | GPRS timer | O | TLV | 3 | | | timer | 3 | | | | | | value | | | | | | | | 9.11.2.5 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.2.11.2 PDU session ID
The AMF shall include this IE when the Payload container type IE is set to
\"N1 SM information\".
#### 8.2.11.3 Additional information
The AMF may include this IE when the Payload container type IE is set to \"LTE
Positioning Protocol (LPP) message container\".
#### 8.2.11.4 5GMM cause
The AMF shall include this IE when the Payload container IE contains an uplink
payload which was not forwarded and the Payload container type IE is not set
to \"Multiple payloads\".
#### 8.2.11.5 Back-off timer value
The AMF shall include this IE when the Payload container IE contains an uplink
5GSM message which was not forwarded due to DNN based congestion control,
S-NSSAI and DNN based congestion control or S-NSSAI only based congestion
control and the Payload container type IE is not set to \"Multiple payloads\".
### 8.2.12 De-registration request (UE originating de-registration)
#### 8.2.12.1 Message definition
The DEREGISTRATION REQUEST message is sent by the UE to the AMF. See table
8.2.12.1.1.
Message type: DEREGISTRATION REQUEST
Significance: dual
Direction: UE to network
Table 8.2.12.1.1: DEREGISTRATION REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | De-r | Message | M | V | 1 | | | egistration | type | | | | | | request | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | De-r | De-r | M | V | 1/2 | | | egistration | egistration | | | | | | type | type | | | | | | | | | | | | | | 9.11.3.20 | | | | +-----+-------------+-------------+----------+--------+--------+ | | ngKSI | NAS key set | M | V | 1/2 | | | | identifier | | | | | | | | | | | | | | 9.11.3.32 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GS mobile | 5GS mobile | M | LV-E | 6-n | | | identity | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.13 De-registration accept (UE originating de-registration)
#### 8.2.13.1 Message definition
The DEREGISTRATION ACCEPT message is sent by the AMF to the UE. See table
8.2.13.1.1.
Message type: DEREGISTRATION ACCEPT
Significance: dual
Direction: network to UE
Table 8.2.13.1.1: DEREGISTRATION ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | De-r | Message | M | V | 1 | | | egistration | type | | | | | | accept | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.14 De-registration request (UE terminated de-registration)
#### 8.2.14.1 Message definition
The DEREGISTRATION REQUEST message is sent by the AMF to the UE. See table
8.2.14.1.1.
Message type: DEREGISTRATION REQUEST
Significance: dual
Direction: network to UE
Table 8.2.14.1.1: DEREGISTRATION REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | De-r | Message | M | V | 1 | | | egistration | type | | | | | | request | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | De-r | De-r | M | V | 1/2 | | | egistration | egistration | | | | | | type | type | | | | | | | | | | | | | | 9.11.3.20 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | 58 | 5GMM cause | 5GMM cause | O | TV | 2 | | | | | | | | | | | 9.11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5F | T3346 value | GPRS timer | O | TLV | 3 | | | | 2 | | | | | | | | | | | | | | 9.11.2.4 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.14.2 5GMM cause
This information element is included if a 5GMM cause is provided.
#### 8.2.14.3 T3346 value
The AMF may include this IE when the general NAS level mobility management
congestion control is active.
### 8.2.15 De-registration accept (UE terminated de-registration)
#### 8.2.15.1 Message definition
The DEREGISTRATION ACCEPT message is sent by the UE to the AMF. See table
8.2.15.1.1.
Message type: DEREGISTRATION ACCEPT
Significance: dual
Direction: UE to network
Table 8.2.15.1.1.1: DEREGISTRATION ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | De-r | Message | M | V | 1 | | | egistration | type | | | | | | accept | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.16 Service request
#### 8.2.16.1 Message definition
The SERVICE REQUEST message is sent by the UE to the AMF in order to request
the establishment of an N1 NAS signalling connection and/or to request the
establishment of user-plane resources for PDU sessions which are established
without user-plane resources. See table 8.2.16.1.1.
Message type: SERVICE REQUEST
Significance: dual
Direction: UE to network
Table 8.2.16.1.1: SERVICE REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Service | Message | M | V | 1 | | | request | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | ngKSI | NAS key set | M | V | 1/2 | | | | identifier | | | | | | | | | | | | | | 9.11.3.32 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Service | Service | M | V | 1/2 | | | type | type | | | | | | | | | | | | | | 9.11.3.50 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5G-S-TMSI | 5GS mobile | M | LV-E | 9 | | | | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 40 | Uplink data | Uplink data | O | TLV | 4-34 | | | status | status | | | | | | | | | | | | | | 9.11.3.57 | | | | +-----+-------------+-------------+----------+--------+--------+ | 50 | PDU session | PDU session | O | TLV | 4-34 | | | status | status | | | | | | | | | | | | | | 9.11.3.44 | | | | +-----+-------------+-------------+----------+--------+--------+ | 25 | Allowed PDU | Allowed PDU | O | TLV | 4-34 | | | session | session | | | | | | status | status | | | | | | | | | | | | | | 9.11.3.13 | | | | +-----+-------------+-------------+----------+--------+--------+ | 71 | NAS message | NAS message | O | TLV-E | 4-n | | | container | container | | | | | | | | | | | | | | 9.11.3.33 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.16.2 Uplink data status
This IE shall be included if the UE has uplink user data pending to be sent.
#### 8.2.16.3 PDU session status
This IE shall be included when the UE needs to indicate the PDU sessions that
are associated with the access type that the message is sent over, that are
active within the UE.
#### 8.2.16.4 Allowed PDU session status
This IE shall be included if the SERVICE REQUEST message is sent as a response
to paging or notification via 3GPP access for PDU session(s) associated with
non-3GPP access and the UE needs to indicate the user-plane resources of PDU
session(s) associated with non-3GPP access allowed to be re-established over
3GPP access or if there is no PDU session(s) for which the UE allows the user-
plane resources to be re-established over 3GPP access.
#### 8.2.16.5 NAS message container
This IE shall be included if the UE is sending a SERVICE REQUEST message as an
initial NAS message and the UE needs to send non-cleartext IEs.
### 8.2.17 Service accept
#### 8.2.17.1 Message definition
The SERVICE ACCEPT message is sent by the AMF to the UE in order to accept the
service request procedure. See table 8.2.17.1.1.
Message type: SERVICE ACCEPT
Significance: dual
Direction: network to UE
Table 8.2.17.1.1: SERVICE ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Service | Message | M | V | 1 | | | accept | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 50 | PDU session | PDU session | O | TLV | 4-34 | | | status | status | | | | | | | | | | | | | | 9.11.3.44 | | | | +-----+-------------+-------------+----------+--------+--------+ | 26 | PDU session | PDU session | O | TLV | 4-34 | | | r | r | | | | | | eactivation | eactivation | | | | | | result | result | | | | | | | | | | | | | | 9.11.3.42 | | | | +-----+-------------+-------------+----------+--------+--------+ | 72 | PDU session | PDU session | O | TLV-E | 5-515 | | | r | r | | | | | | eactivation | eactivation | | | | | | result | result | | | | | | error cause | error cause | | | | | | | | | | | | | | 9.11.3.43 | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.17.2 PDU session status
This IE shall be included when the network needsto indicate the PDU sessions
that are associated with the access type that the message is sent over that
are active within the network.
#### 8.2.17.3 PDU session reactivation result
This IE shall be included:
\- if the Uplink data status IE is included in the SERVICE REQUEST message;
\- if the Allowed PDU session status IE is included in the SERVICE REQUEST
message and there is at least one PDU session indicated in the Allowed PDU
session status IE for which user-plane resources can be re-established over
3GPP access.
#### 8.2.17.4 PDU session reactivation result error cause
This IE may be included if the PDU session reactivation result IE is included
and there exist one or more PDU sessions for which the user-plane resources
cannot be re-established, to indicate the cause of failure to re-establish the
user-plane resources.
#### 8.2.17.5 EAP message
EAP message IE is included if the SERVICE ACCEPT message is sent to a UE
registered for emergency services and is used to convey EAP-failure message.
### 8.2.18 Service reject
#### 8.2.18.1 Message definition
The SERVICE REJECT message is sent by the AMF to the UE in order to reject the
service request procedure. See table 8.2.18.1.1.
Message type: SERVICE REJECT
Significance: dual
Direction: network to UE
Table 8.2.18.1.1: SERVICE REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Service | Message | M | V | 1 | | | reject | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GMM cause | 5GMM cause | M | V | 1 | | | | | | | | | | | 9.11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 50 | PDU session | PDU session | O | TLV | 4-34 | | | status | status | | | | | | | | | | | | | | 9.11.3.44 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5F | T3346 value | GPRS timer | O | TLV | 3 | | | | 2 | | | | | | | | | | | | | | 9.11.2.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.18.2 PDU session status
This IE shall be included when the network needs to indicate the PDU sessions
that are associated with the access type that the message is sent over, that
are active within the network.
#### 8.2.18.3 T3346 value
The AMF may include this IE when the general NAS level mobility management
congestion control is active.
#### 8.2.18.4 EAP message
EAP message IE is included if the SERVICE REJECT message is used to convey
EAP-failure message.
### 8.2.19 Configuration update command
#### 8.2.19.1 Message definition
The CONFIGURATION UPDATE COMMAND message is sent by the AMF to the UE. See
table 8.2.19.1.1.
Message type: CONFIGURATION UPDATE COMMAND
Significance: dual
Direction: network to UE
Table 8.2.19.1.1: CONFIGURATION UPDATE COMMAND message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Co | Message | M | V | 1 | | | nfiguration | type | | | | | | update | | | | | | | command | 9.7 | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | D- | Co | Co | O | TV | 1 | | | nfiguration | nfiguration | | | | | | update | update | | | | | | indication | indication | | | | | | | | | | | | | | 9.11.3.18 | | | | +-----+-------------+-------------+----------+--------+--------+ | 77 | 5G-GUTI | 5GS mobile | O | TLV-E | 14 | | | | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 54 | TAI list | 5GS | O | TLV | 9-114 | | | | tracking | | | | | | | area | | | | | | | identity | | | | | | | list | | | | | | | | | | | | | | 9.11.3.9 | | | | +-----+-------------+-------------+----------+--------+--------+ | 15 | Allowed | NSSAI | O | TLV | 4-74 | | | NSSAI | | | | | | | | 9.11.3.37 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Service | Service | O | TLV | 6-114 | | | area list | area list | | | | | | | | | | | | | | 9.11.3.49 | | | | +-----+-------------+-------------+----------+--------+--------+ | 43 | Full name | Network | O | TLV | 3-n | | | for network | name | | | | | | | | | | | | | | 9.11.3.35 | | | | +-----+-------------+-------------+----------+--------+--------+ | 45 | Short name | Network | O | TLV | 3-n | | | for network | name | | | | | | | | | | | | | | 9.11.3.35 | | | | +-----+-------------+-------------+----------+--------+--------+ | 46 | Local time | Time zone | O | TV | 2 | | | zone | | | | | | | | 9.11.3.52 | | | | +-----+-------------+-------------+----------+--------+--------+ | 47 | Universal | Time zone | O | TV | 8 | | | time and | and time | | | | | | local time | | | | | | | zone | 9.11.3.53 | | | | +-----+-------------+-------------+----------+--------+--------+ | 49 | Network | Daylight | O | TLV | 3 | | | daylight | saving time | | | | | | saving time | | | | | | | | 9.11.3.19 | | | | +-----+-------------+-------------+----------+--------+--------+ | 79 | LADN | LADN | O | TLV-E | 3-1715 | | | information | information | | | | | | | | | | | | | | 9.11.3.30 | | | | +-----+-------------+-------------+----------+--------+--------+ | B- | MICO | MICO | O | TV | 1 | | | indication | indication | | | | | | | | | | | | | | 9.11.3.31 | | | | +-----+-------------+-------------+----------+--------+--------+ | 9- | Network | Network | O | TV | 1 | | | slicing | slicing | | | | | | indication | indication | | | | | | | | | | | | | | 9.11.3.36 | | | | +-----+-------------+-------------+----------+--------+--------+ | 31 | Configured | NSSAI | O | TLV | 4-146 | | | NSSAI | | | | | | | | 9.11.3.37 | | | | +-----+-------------+-------------+----------+--------+--------+ | 11 | Rejected | Rejected | O | TLV | 4-42 | | | NSSAI | NSSAI | | | | | | | | | | | | | | 9.11.3.46 | | | | +-----+-------------+-------------+----------+--------+--------+ | 76 | Opera | Opera | O | TLV-E | 3-n | | | tor-defined | tor-defined | | | | | | access | access | | | | | | category | category | | | | | | definitions | definitions | | | | | | | | | | | | | | 9.11.3.38 | | | | +-----+-------------+-------------+----------+--------+--------+ | F- | SMS | SMS | O | TV | 1 | | | indication | indication | | | | | | | | | | | | | | 9.11.3.50A | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.19.2 Configuration update indication
The AMF shall include this IE if the AMF needs to request an acknowledgement
or a registration procedure from the UE.
#### 8.2.19.3 5G-GUTI
This IE may be included to assign a new 5G GUTI to the UE.
#### 8.2.19.4 TAI list
This IE may be included to assign a new TAI list to the UE.
#### 8.2.19.5 Allowed NSSAI
This IE may be included to assign a new allowed NSSAI to the UE.
#### 8.2.19.6 Service area list
This IE may be included to assign a new service area list to the UE.
#### 8.2.19.7 Full name for network
This IE may be included to assign a new full name for network to the UE.
#### 8.2.19.8 Short name for network
This IE may be included to assign a new short name for network to the UE.
#### 8.2.19.9 Local time zone
This IE may be included to assign a new local time zone to the UE.
#### 8.2.19.10 Universal time and local time zone
This IE may be included to assign new universal time and local time zone to
the UE.
#### 8.2.19.11 Network daylight saving time
This IE may be included to assign new network daylight saving time to the UE.
#### 8.2.19.12 LADN information
This IE may be included to assign new LADN information to the UE or delete the
LADN information at the UE side.
#### 8.2.19.13 MICO indication
This IE may be included to request the UE to re-negotiate MICO mode.
#### 8.2.19.14 Network slicing indication
This IE shall be included if the user\'s network slicing subscription has
changed in the UDM.
#### 8.2.19.15 Configured NSSAI
The AMF shall include this IE when the AMF needs to provide the UE with a new
configured NSSAI for the current PLMN.
#### 8.2.19.16 Rejected NSSAI
The network may include this IE to inform the UE of the S-NSSAIs that were
previously sent to the UE in the allowed NSSAI, but are now considered to be
rejected by the network.
#### 8.2.19.17 Operator-defined access category definitions
This IE may be included to assign new operator-defined access category
definitions to the UE or delete the operator-defined access category
definitions at the UE side.
#### 8.2.19.18 SMS indication
This IE may be included to indicate that the ability for the UE to use SMS
over NAS has changed.
### 8.2.20 Configuration update complete
#### 8.2.20.1 Message definition
The CONFIGURATION UPDATE COMPLETE message is sent by the UE to the AMF. See
table 8.2.20.1.1.
Message type: CONFIGURATION UPDATE COMPLETE
Significance: dual
Direction: UE to network
Table 8.2.20.1.1: CONFIGURATION UPDATE COMPLETE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Co | Message | M | V | 1 | | | nfiguration | type | | | | | | update | | | | | | | complete | 9.7 | | | | | | message | | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.21 Identity request
#### 8.2.21.1 Message definition
The IDENTITY REQUEST message is sent by the AMF to the UE to request the UE to
provide specified identity. See table 8.2.21.1.1
Message type: IDENTITY REQUEST
Significance: dual
Direction: AMF to UE
Table 8.2.21.1.1: IDENTITY REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Identity | Message | M | V | 1 | | | request | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Identity | 5GS | M | V | 1/2 | | | type | identity | | | | | | | type | | | | | | | | | | | | | | 9.11.3.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.22 Identity response
#### 8.2.22.1 Message definition
The IDENTITY RESPONSE message is sent by the UE to the AMF to provide the
requested identity. See table 8.2.22.1.
Message type: IDENTITY RESPONSE
Significance: dual
Direction: UE to AMF
Table 8.2.22.1.1: IDENTITY RESPONSE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Identity | Message | M | V | 1 | | | response | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Mobile | 5GS mobile | M | LV-E | 3-n | | | identity | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.23 Notification
#### 8.2.23.1 Message definition
The NOTIFICATION message is sent by the AMF to the UE to notify the UE to
initiate a service request procedure. See table 8.2.23.1.1.
Message type: NOTIFICATION
Significance: dual
Direction: network to UE
Table 8.2.23.1.1: NOTIFICATION message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | N | Message | M | V | 1 | | | otification | type | | | | | | message | | | | | | | identity | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Access type | Access type | M | V | 1/2 | | | | | | | | | | | 9.11.3.11 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.24 Notification response
#### 8.2.24.1 Message definition
The NOTIFICATION RESPONSE message is sent by the UE to the AMF to notify the
failure to initiate the service request procedure as a response of
notification. See table 8.2.24.1.1.
Message type: NOTIFICATION RESPONSE
Significance: dual
Direction: UE to network
Table 8.2.2341.1: NOTIFICATION RESPONSE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | N | Message | M | V | 1 | | | otification | type | | | | | | response | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | 50 | PDU session | PDU session | O | TLV | 4-34 | | | status | status | | | | | | | | | | | | | | 9.11.3.44 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.24.2 PDU session status
This information element shall be included when the UE needs to indicate over
non-3GPP access the type of the PDU sessions that are associated with the 3GPP
access type that are active within the UE.
### 8.2.25 Security mode command
#### 8.2.25.1 Message definition
The SECURITY MODE COMMAND message is sent by the AMF to the UE to establish
NAS signalling security. See table 8.2.25.1.1.
Message type: SECURITY MODE COMMAND
Significance: dual
Direction: network to UE
Table 8.2.25.1.1: SECURITY MODE COMMAND message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Message | M | V | 1 | | | mode | type | | | | | | command | | | | | | | message | 9.7 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Selected | NAS | M | V | 1 | | | NAS | security | | | | | | security | algorithms | | | | | | algorithms | | | | | | | | 9.11.3.34 | | | | +-----+-------------+-------------+----------+--------+--------+ | | ngKSI | NAS key set | M | V | 1/2 | | | | identifier | | | | | | | | | | | | | | 9.11.3.32 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Replayed UE | UE security | M | LV | 3-9 | | | security | capability | | | | | | c | | | | | | | apabilities | 9.11.3.54 | | | | +-----+-------------+-------------+----------+--------+--------+ | E- | IMEISV | IMEISV | O | TV | 1 | | | request | request | | | | | | | | | | | | | | 9.11.3.28 | | | | +-----+-------------+-------------+----------+--------+--------+ | 57 | Selected | EPS NAS | O | TV | 2 | | | EPS NAS | security | | | | | | security | algorithms | | | | | | algorithms | | | | | | | | 9.11.3.25 | | | | +-----+-------------+-------------+----------+--------+--------+ | 36 | Additional | Additional | O | TLV | 3 | | | 5G security | 5G security | | | | | | information | information | | | | | | | | | | | | | | 9.11.3.12 | | | | +-----+-------------+-------------+----------+--------+--------+ | 78 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 9.11.2.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 38 | ABBA | ABBA | O | TLV | 4-n | | | | | | | | | | | 9.11.3.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | 19 | Replayed S1 | S1 UE | O | TLV | 4-7 | | | UE security | security | | | | | | c | capability | | | | | | apabilities | | | | | | | | 9.11.3.48A | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.25.2 IMEISV request
The AMF may include this information element to request the UE to send its
IMEISV with the corresponding SECURITY MODE COMPLETE message.
#### 8.2.25.3 Void
#### 8.2.25.4 Selected EPS NAS security algorithms
This IE shall be included if the AMF supports N26 interface and the UE set the
S1 mode bit to \"S1 mode supported\" in the 5GMM capability IE of the
REGISTRATION REQUEST message.
#### 8.2.25.5 Additional 5G security information
The network shall include this IE if:
a) the network needs to provide the UE with horizontal derivation parameter;
or
b) the initial NAS message (i.e. REGISTRATION REQUEST or SERVICE REQUEST) does
not successfully pass the integrity check at the AMF (see subclause 5.4.2.2).
#### 8.2.25.6 EAP message
This IE is included when the EAP Success message is sent as part of the EAP
based primary authentication and key agreement procedure, as specified in
subclause 5.4.1.2.
#### 8.2.25.7 ABBA
This IE shall be included if the message contains an EAP message IE with an
EAP-success message.
#### 8.2.25.8 Replayed S1 UE security capabilities
This IE shall be included if the Selected EPS NAS security algorithms
information element is included.
### 8.2.26 Security mode complete
#### 8.2.26.1 Message definition
The SECURITY MODE COMPLETE message is sent by the UE to the AMF in response to
a SECURITY MODE COMMAND message. See table 8.2.26.1.1.
Message type: SECURITY MODE COMPLETE
Significance: dual
Direction: UE to network
Table 8.2.26.1.1: SECURITY MODE COMPLETE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Message | M | V | 1 | | | mode | type | | | | | | complete | | | | | | | message | 9.6 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | 77 | IMEISV | 5G mobile | O | TLV-E | 12 | | | | identity | | | | | | | | | | | | | | 9.11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 71 | NAS message | NAS message | O | TLV-E | 4-n | | | container | container | | | | | | | | | | | | | | 9.11.3.33 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 8.2.26.2 IMEISV
The UE shall include this information element, if the IMEISV was requested
within the corresponding SECURITY MODE COMMAND message.
#### 8.2.26.3 NAS message container
The UE shall include this information element:
a) if during an ongoing registration procedure or service request procedure,
the AMF included the Additional 5G security information with the RINMR bit set
to \"Retransmission of the initial NAS message requested\" in the SECURITY
MODE COMMAND message as described in 3GPP TS 33.501 [24]; and
b) if during an ongoing registration procedure, the UE does not have a valid
5G NAS security context.
### 8.2.27 Security mode reject
#### 8.6.27.1 Message definition
The SECURITY MODE REJECT message is sent by the UE to the AMF to indicate that
the corresponding security mode command has been rejected. See table
8.2.27.1.1.
Message type: SECURITY MODE REJECT
Significance: dual
Direction: UE to network
Table 8.2.27.1.1: SECURITY MODE REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Message | M | V | 1 | | | mode reject | type | | | | | | message | | | | | | | identity | 9.6 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GMM cause | 5GMM cause | M | V | 1 | | | | | | | | | | | 9.11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.28 Security protected 5GS NAS message
#### 8.2.28.1 Message definition
This message is sent by the UE or the network to transfer a plain 5GS NAS
message together with the sequence number and the message authentication code
protecting the message. See table 8.2.28.1.1.
Message type: SECURITY PROTECTED 5GS NAS MESSAGE
Significance: dual
Direction: both
Table 8.2.28.1.1: SECURITY PROTECTED 5GS NAS MESSAGE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +-----+-------------+-------------+----------+--------+--------+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Message | Message | M | V | 4 | | | aut | aut | | | | | | hentication | hentication | | | | | | code | code | | | | | | | | | | | | | | 9.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 9.10 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Plain 5GS | Plain 5GS | M | V | 3-n | | | NAS message | NAS message | | | | | | | | | | | | | | 9.9 | | | | +-----+-------------+-------------+----------+--------+--------+
### 8.2.29 5GMM status
#### 8.2.29.1 Message definition
The 5GMM STATUS message is sent by the UE or by the AMF at any time to report
certain error conditions. See table 8.2.28.1.1.
Message type: 5GMM STATUS
Significance: local
Direction: both
Table 8.2.29.1.1: 5GMM STATUS message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Security | Security | M | V | 1/2 | | | header type | header type | | | | | | | | | | | | | | 9.3 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Spare half | Spare half | M | V | 1/2 | | | octet | octet | | | | | | | | | | | | | | 9.5 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GMM STATUS | Message | M | V | 1 | | | message | type | | | | | | identity | | | | | | | | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GMM cause | 5GMM cause | M | V | 1 | | | | | | | | | | | 9.11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+
## 8.3 5GS session management messages
### 8.3.1 PDU session establishment request
#### 8.3.1.1 Message definition
The PDU SESSION ESTABLISHMENT REQUEST message is sent by the UE to the SMF to
initiate establishment of a PDU session. See table 8.3.1.1.1.
Message type: PDU SESSION ESTABLISHMENT REQUEST
Significance: dual
Direction: UE to network
Table 8.3.1.1.1: PDU SESSION ESTABLISHMENT REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | EST | | | | | | | ABLISHMENT | 9.7 | | | | | | REQUEST | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Integrity | Integrity | M | V | 2 | | | protection | protection | | | | | | maximum | maximum | | | | | | data rate | data rate | | | | | | | | | | | | | | 9.11.4.7 | | | | +-----+------------+------------+----------+--------+---------+ | 9- | PDU | PDU | O | TV | 1 | | | session | session | | | | | | type | type | | | | | | | | | | | | | | 9.11.4.11 | | | | +-----+------------+------------+----------+--------+---------+ | A- | SSC mode | SSC mode | O | TV | 1 | | | | | | | | | | | 9.11.4.16 | | | | +-----+------------+------------+----------+--------+---------+ | 28 | 5GSM | 5GSM | O | TLV | 3-15 | | | capability | capability | | | | | | | | | | | | | | 9.11.4.1 | | | | +-----+------------+------------+----------+--------+---------+ | 55 | Maximum | Maximum | O | TV | 3 | | | number of | number of | | | | | | supported | supported | | | | | | packet | packet | | | | | | filters | filters | | | | | | | | | | | | | | 9.11.4.9 | | | | +-----+------------+------------+----------+--------+---------+ | B- | Always-on | Always-on | O | TV | 1 | | | PDU | PDU | | | | | | session | session | | | | | | requested | requested | | | | | | | | | | | | | | 9.11.4.4 | | | | +-----+------------+------------+----------+--------+---------+ | 39 | SM PDU DN | SM PDU DN | O | TLV | 3-255 | | | request | request | | | | | | container | container | | | | | | | | | | | | | | 9.11.4.15 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.1.2 PDU session type
This IE is included in the message when the UE requests to establish a new PDU
session with a DN and requests a PDU session type.
#### 8.3.1.3 SSC mode
This IE is included in the message when the UE requests to establish a new PDU
session with a DN and requests an SSC mode.
#### 8.3.1.4 Maximum number of supported packet filters
This IE shall be included in the message when the selected PDU session type is
\"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" and the UE can support more
than 16 packet filters for this PDU session.
#### 8.3.1.5 5GSM capability
This IE is included in the message when:
a) the UE requests to establish a new PDU session of \"IPv4\", \"IPv6\",
\"IPv4v6\" or \"Ethernet\" PDU session type and the UE supports Reflective
QoS;
b) the UE requests to establish a new PDU session of \"IPv6\" or \"IPv4v6\"
PDU session type and the UE supports multi-homed IPv6 PDU session;
c) the UE requests to transfer an existing PDN connection of \"IPv4\",
\"IPv6\", \"IPv4v6\" or \"non-IP\" PDN type mapping to \"Ethernet\" PDU
session type in the EPS to the 5GS and the UE supports Reflective QoS;
d) the UE requests to transfer an existing PDN connection of \"IPv4\",
\"IPv6\" or \"IPv4v6\" PDN type in an untrusted non-3GPP access connected to
the EPC to the 5GS and the UE supports Reflective QoS; or
e) the UE requests to transfer an existing PDN connection of \"IPv6\" or
\"IPv4v6\" PDN type in the EPS or in an untrusted non-3GPP access connected to
the EPC to the 5GS and the UE supports multi-homed IPv6 PDU session.
#### 8.3.1.6 Void
#### 8.3.1.7 Always-on PDU session requested
The UE shall include this IE if the UE requests to establish a PDU session as
an always-on PDU session.
#### 8.3.1.8 SM PDU DN request container
This IE is included in the message when the UE requests to establish a new PDU
session with a DN and needs to provide information for the PDU session
authentication and authorization by the external DN.
#### 8.3.1.9 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
### 8.3.2 PDU session establishment accept
#### 8.3.2.1 Message definition
The PDU SESSION ESTABLISHMENT ACCEPT message is sent by the SMF to the UE in
response to PDU SESSION ESTABLISHMENT REQUEST message and indicates successful
establishment of a PDU session. See table 8.3.2.1.1.
Message type: PDU SESSION ESTABLISHMENT ACCEPT
Significance: dual
Direction: network to UE
Table 8.3.2.1.1: PDU SESSION ESTABLISHMENT ACCEPT message content
+-----+-----------+-----------+----------+--------+-----------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +=====+===========+===========+==========+========+===========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | disc | disc | | | | | | riminator | riminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-----------+-----------+----------+--------+-----------+ | | PDU | PDU | M | V | 1 | | | session | session | | | | | | ID | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+-----------+-----------+----------+--------+-----------+ | | PTI | Procedure | M | V | 1 | | | | tr | | | | | | | ansaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+-----------+-----------+----------+--------+-----------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | ESTA | | | | | | | BLISHMENT | 9.7 | | | | | | ACCEPT | | | | | | | message | | | | | | | identity | | | | | +-----+-----------+-----------+----------+--------+-----------+ | | Selected | PDU | M | V | 1/2 | | | PDU | session | | | | | | session | type | | | | | | type | | | | | | | | 9.11.4.11 | | | | +-----+-----------+-----------+----------+--------+-----------+ | | Selected | SSC mode | M | V | 1/2 | | | SSC mode | | | | | | | | 9.11.4.16 | | | | +-----+-----------+-----------+----------+--------+-----------+ | | A | QoS rules | M | LV-E | 6-65538 | | | uthorized | | | | | | | QoS rules | 9.11.4.13 | | | | +-----+-----------+-----------+----------+--------+-----------+ | | Session | Ses | M | LV | 7 | | | AMBR | sion-AMBR | | | | | | | | | | | | | | 9.11.4.14 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 59 | 5GSM | 5GSM | O | TV | 2 | | | cause | cause | | | | | | | | | | | | | | 9.11.4.2 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 29 | PDU | PDU | O | TLV | 7, 11 or | | | address | address | | | 15 | | | | | | | | | | | 9.11.4.10 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 56 | RQ timer | GPRS | O | TV | 2 | | | value | timer | | | | | | | | | | | | | | 9.11.2.3 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 22 | S-NSSAI | S-NSSAI | O | TLV | 3-10 | | | | | | | | | | | 9.11.2.8 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 8- | Always-on | Always-on | O | TV | 1 | | | PDU | PDU | | | | | | session | session | | | | | | i | i | | | | | | ndication | ndication | | | | | | | | | | | | | | 9.11.4.3 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 75 | Mapped | Mapped | O | TLV-E | 7-65538 | | | EPS | EPS | | | | | | bearer | bearer | | | | | | contexts | contexts | | | | | | | | | | | | | | 9.11.4.8 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 78 | EAP | EAP | O | TLV-E | 7-1503 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 79 | A | QoS flow | O | TLV-E | 6-65538 | | | uthorized | des | | | | | | QoS flow | criptions | | | | | | des | | | | | | | criptions | 9.11.4.12 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | conf | conf | | | | | | iguration | iguration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+-----------+-----------+----------+--------+-----------+ | 25 | DNN | DNN | O | TLV | 3-102 | | | | | | | | | | | 9.11.2.1A | | | | +-----+-----------+-----------+----------+--------+-----------+
#### 8.3.2.2 5GSM cause
This IE is included when the selected PDU session type is different from the
PDU session type requested by the UE.
#### 8.3.2.3 PDU address
This IE is included when the selected PDU session type is \"IPv4\", \"IPv6\"
or \"IPv4v6\".
#### 8.3.2.4 RQ timer value
This IE is included when the network needs to provide the RQ timer value.
#### 8.3.2.5 S-NSSAI
This IE shall be included in the message when the SMF received from the AMF an
S-NSSAI together with the PDU SESSION ESTABLISHMENT REQUEST message, and the
PDU session is a non-emergency PDU session.
#### 8.3.2.6 Always-on PDU session indication
The network shall include this IE if the network decides to inform the UE
whether the PDU session is established as an always-on PDU session.
#### 8.3.2.7 Mapped EPS bearer contexts
This IE is included when interworking with EPS is supported for the PDU
session.
#### 8.3.2.8 EAP message
This IE is included when the external DN successfully performed authentication
and authorization of the UE using EAP.
#### 8.3.2.9 Authorized QoS flow descriptions
This IE is included when the network needs to provide authorized QoS flow
descriptions.
#### 8.3.2.10 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
#### 8.3.2.11 DNN
The IE shall be included in the message when the SMF received from the AMF a
DNN together with the PDU SESSION ESTABLISHMENT REQUEST message, and the PDU
session is a non-emergency PDU session.
### 8.3.3 PDU session establishment reject
#### 8.3.3.1 Message definition
The PDU SESSION ESTABLISHMENT REJECT message is sent by the SMF to the UE in
response to PDU SESSION ESTABLISHMENT REQUEST message and indicates
unsuccessful establishment of a PDU session. See table 8.3.3.1.1.
Message type: PDU SESSION ESTABLISHMENT REJECT
Significance: dual
Direction: network to UE
Table 8.3.3.1.1: PDU SESSION ESTABLISHMENT REJECT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | EST | | | | | | | ABLISHMENT | 9.7 | | | | | | REJECT | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GSM cause | 5GSM cause | M | V | 1 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 37 | Back-off | GPRS timer | O | TLV | 3 | | | timer | 3 | | | | | | value | | | | | | | | 9.11.2.5 | | | | +-----+------------+------------+----------+--------+---------+ | F- | Allowed | Allowed | O | TV | 1 | | | SSC mode | SSC mode | | | | | | | | | | | | | | 9.11.4.5 | | | | +-----+------------+------------+----------+--------+---------+ | 78 | EAP | EAP | O | TLV-E | 7-1503 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+------------+------------+----------+--------+---------+ | 61 | 5GSM | 5GSM | O | TLV | 3 | | | congestion | congestion | | | | | | re-attempt | re-attempt | | | | | | indicator | indicator | | | | | | | | | | | | | | 9.11.4.2A | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.3.2 Back-off timer value
The network may include this IE to request a minimum time interval before
procedure retry is allowed.
#### 8.3.3.3 Allowed SSC mode
This IE is included when the network rejects the PDU SESSION ESTABLISHMENT
REQUEST with cause #68 \"not supported SSC mode.
#### 8.3.3.4 EAP message
This IE is included when the external DN unsuccessfully performed
authentication and authorization of the UE using EAP.
#### 8.3.3.5 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
#### 8.3.3.6 5GSM congestion re-attempt indicator
The network may include this IE only if it includes the Back-off timer value
IE and the 5GSM cause value is either #67 \"insufficient resources for
specific slice and DNN\" or #69 \"insufficient resources for specific slice\".
### 8.3.4 PDU session authentication command
#### 8.3.4.1 Message definition
The PDU SESSION AUTHENTICATION COMMAND message is sent by the SMF to the UE
for authentication of the UE establishing the PDU session or of the UE
participating in the PDU session. See table 8.3.4.1.1.
Message type: PDU SESSION AUTHENTICATION COMMAND
Significance: dual
Direction: network to UE
Table 8.3.4.1.1: PDU SESSION AUTHENTICATION COMMAND message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | AUTH | | | | | | | ENTICATION | 9.7 | | | | | | COMMAND | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | EAP | EAP | M | LV-E | 6-1502 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.4.2 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
NOTE: How the Extended protocol configuration options IE is used by the
network and the UE during the PDU session authentication and authorization
procedure is not specified in this release of the specification.
### 8.3.5 PDU session authentication complete
#### 8.3.5.1 Message definition
The PDU SESSION AUTHENTICATION COMPLETE message is sent by the UE to the SMF
in response to the PDU SESSION AUTHENTICATION COMMAND message and indicates
acceptance of the PDU SESSION AUTHENTICATION COMMAND message. See table
8.3.5.1.1.
Message type: PDU SESSION AUTHENTICATION COMPLETE
Significance: dual
Direction: UE to network
Table 8.3.5.1.1: PDU SESSION AUTHENTICATION COMPLETE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | AUTH | | | | | | | ENTICATION | 9.7 | | | | | | COMPLETE | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | EAP | EAP | M | LV-E | 6-1502 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.5.2 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
NOTE: How the Extended protocol configuration options IE is used by the
network and the UE during the PDU session authentication and authorization
procedure is not specified in this release of the specification.
### 8.3.6 PDU session authentication result
#### 8.3.6.1 Message definition
The PDU SESSION AUTHENTICATION RESULT message is sent by the SMF to the UE for
indication of successful result of authentication of the UE participating in
the PDU session. See table 8.3.6.1.1.
Message type: PDU SESSION AUTHENTICATION RESULT
Significance: dual
Direction: network to UE
Table 8.3.6.1.1: PDU SESSION AUTHENTICATION RESULT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | AUTH | | | | | | | ENTICATION | 9.7 | | | | | | RESULT | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 78 | EAP | EAP | O | TLV-E | 7-1503 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.6.2 EAP message
This IE shall be included when the external DN performs authentication and
authorization of the UE using EAP and it completes successfully.
#### 8.3.6.3 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
NOTE: How the Extended protocol configuration options IE is used by the
network and the UE during the PDU session authentication and authorization
procedure is not specified in this release of the specification.
### 8.3.7 PDU session modification request
#### 8.3.7.1 Message definition
The PDU SESSION MODIFICATION REQUEST message is sent by the UE to the SMF to
request a modification of a PDU session. See table 8.3.7.1.1.
Message type: PDU SESSION MODIFICATION REQUEST
Significance: dual
Direction: UE to network
Table 8.3.7.1.1: PDU SESSION MODIFICATION REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | MO | | | | | | | DIFICATION | 9.7 | | | | | | REQUEST | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 28 | 5GSM | 5GSM | O | TLV | 3-15 | | | capability | capability | | | | | | | | | | | | | | 9.11.4.1 | | | | +-----+------------+------------+----------+--------+---------+ | 59 | 5GSM cause | 5GSM cause | O | TV | 2 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 55 | Maximum | Maximum | O | TV | 3 | | | number of | number of | | | | | | supported | supported | | | | | | packet | packet | | | | | | filters | filters | | | | | | | | | | | | | | 9.11.4.9 | | | | +-----+------------+------------+----------+--------+---------+ | B- | Always-on | Always-on | O | TV | 1 | | | PDU | PDU | | | | | | session | session | | | | | | requested | requested | | | | | | | | | | | | | | 9.11.4.4 | | | | +-----+------------+------------+----------+--------+---------+ | 13 | Integrity | Integrity | O | TV | 3 | | | protection | protection | | | | | | maximum | maximum | | | | | | data rate | data rate | | | | | | | | | | | | | | 9.11.4.7 | | | | +-----+------------+------------+----------+--------+---------+ | 7A | Requested | QoS rules | O | TLV-E | 7-65538 | | | QoS rules | | | | | | | | 9.11.4.13 | | | | +-----+------------+------------+----------+--------+---------+ | 79 | Requested | QoS flow | O | TLV-E | 6-65538 | | | QoS flow | de | | | | | | de | scriptions | | | | | | scriptions | | | | | | | | 9.11.4.12 | | | | +-----+------------+------------+----------+--------+---------+ | 75 | Mapped EPS | Mapped EPS | O | TLV-E | 7-65538 | | | bearer | bearer | | | | | | contexts | contexts | | | | | | | | | | | | | | 9.11.4.8 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
NOTE: It is possible for UEs compliant with earlier versions of this
specification to send the Mapped EPS bearer contexts IE with IEI of value
\"7F\" for this message.
#### 8.3.7.2 5GSM capability
This IE is included in the message after inter-system change from S1 mode to
N1 mode:
a) if the PDU session is of \"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\" PDU
session type, and the UE supports reflective QoS or revokes the previously
indicated support of reflective QoS; or
b) if the PDU session is of \"IPv6\" or \"IPv4v6\" PDU session type, and the
UE supports multi-homed IPv6 PDU session.
#### 8.3.7.3 5GSM cause
This IE is included in the message when the UE releases the PDU session due to
semantic or syntactical errors in QoS operations, or due to semantic or
syntactical errors in packet filters.
#### 8.3.7.4 Maximum number of supported packet filters
This IE shall be included in the message when the selected PDU session type is
\"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\", the UE can support more than
16 packet filters for this PDU session, and the UE is sending the message
after an inter-system change from S1 mode to N1 mode.
#### 8.3.7.5 Always-on PDU session requested
The UE shall include this IE if the UE requests to establish a PDU session as
an always-on PDU session.
#### 8.3.7.6 Integrity protection maximum data rate
This IE shall be included in the message for a PDN connection established when
in S1 mode, after the first inter-system change from S1 mode to N1 mode, if
the UE is operating in single-registration mode in the network supporting N26
interface.
#### 8.3.7.7 Requested QoS rules
This IE is included in the message when the UE requests a specific QoS
handling.
#### 8.3.7.8 Requested QoS flow descriptions
This IE is included in the message when the UE requests a specific QoS flow
descriptions.
#### 8.3.7.9 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
#### 8.3.7.10 Mapped EPS bearer contexts
This IE is included when the UE requests to delete one or more mapped EPS
bearer contexts.
### 8.3.8 PDU session modification reject
#### 8.3.8.1 Message definition
The PDU SESSION MODIFICATION REJECT message is sent by the SMF to the UE to
indicate rejection of the PDU SESSION MODIFICATION REQUEST. See table
8.3.8.1.1.
Message type: PDU SESSION MODIFICATION REJECT
Significance: dual
Direction: network to UE
Table 8.3.8.1.1: PDU SESSION MODIFICATION REJECT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | MO | | | | | | | DIFICATION | 9.7 | | | | | | REJECT | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GSM cause | 5GSM cause | M | V | 1 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 37 | Back-off | GPRS timer | O | TLV | 3 | | | timer | 3 | | | | | | value | | | | | | | | 9.11.2.5 | | | | +-----+------------+------------+----------+--------+---------+ | 61 | 5GSM | 5GSM | O | TLV | 3 | | | congestion | congestion | | | | | | re-attempt | re-attempt | | | | | | indicator | indicator | | | | | | | | | | | | | | 9.11.4.2A | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.8.2 Back-off timer value
The network may include this IE to request a minimum time interval before
procedure retry is allowed.
#### 8.3.8.3 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
#### 8.3.8.4 5GSM congestion re-attempt indicator
The network may include this IE only if it includes the Back-off timer value
IE and the 5GSM cause value is either #67 \"insufficient resources for
specific slice and DNN\" or #69 \"insufficient resources for specific slice\".
### 8.3.9 PDU session modification command
#### 8.3.9.1 Message definition
The PDU SESSION MODIFICATION COMMAND message is sent by the SMF to the UE to
indicate a modification of a PDU session. See table 8.3.9.1.1
Message type: PDU SESSION MODIFICATION COMMAND
Significance: dual
Direction: network to UE
Table 8.3.9.1.1: PDU SESSION MODIFICATION COMMAND message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | MO | | | | | | | DIFICATION | 9.7 | | | | | | COMMAND | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 59 | 5GSM cause | 5GSM cause | O | TV | 2 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 2A | Session | Se | O | TLV | 8 | | | AMBR | ssion-AMBR | | | | | | | | | | | | | | 9.11.4.14 | | | | +-----+------------+------------+----------+--------+---------+ | 56 | RQ timer | GPRS timer | O | TV | 2 | | | value | | | | | | | | 9.11.2.3 | | | | +-----+------------+------------+----------+--------+---------+ | 8- | Always-on | Always-on | O | TV | 1 | | | PDU | PDU | | | | | | session | session | | | | | | indication | indication | | | | | | | | | | | | | | 9.11.4.3 | | | | +-----+------------+------------+----------+--------+---------+ | 7A | Authorized | QoS rules | O | TLV-E | 7-65538 | | | QoS rules | | | | | | | | 9.11.4.13 | | | | +-----+------------+------------+----------+--------+---------+ | 75 | Mapped EPS | Mapped EPS | O | TLV-E | 7-65538 | | | bearer | bearer | | | | | | contexts | contexts | | | | | | | | | | | | | | 9.11.4.8 | | | | +-----+------------+------------+----------+--------+---------+ | 79 | Authorized | QoS flow | O | TLV-E | 6-65538 | | | QoS flow | de | | | | | | de | scriptions | | | | | | scriptions | | | | | | | | 9.11.4.12 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
NOTE: It is possible for networks compliant with earlier versions of this
specification to send the Mapped EPS bearer contexts IE with IEI of value
\"7F\" for this message.
#### 8.3.9.2 5GSM cause
This IE is included when the network performs the PDU session anchor
relocation for SSC mode 3.
#### 8.3.9.3 Session-AMBR
This IE is included when the session-AMBR of the PDU session is modified.
#### 8.3.9.4 RQ timer value
This IE is included when the network needs to provide the RQ timer value.
#### 8.3.9.5 Always-on PDU session indication
The network shall include this IE if the network decides to inform the UE
whether the PDU session is an always-on PDU session.
#### 8.3.9.6 Authorized QoS rules
This IE is included when the authorized QoS rules of the PDU session are
modified.
#### 8.3.9.7 Mapped EPS bearer contexts
This IE is included when interworking with EPS is supported for the PDU
session and the mapped EPS bearer contexts is modified.
#### 8.3.9.8 Authorized QoS flow descriptions
This IE is included when the authorized QoS flow descriptions of the PDU
session are modified.
#### 8.3.9.9 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
### 8.3.10 PDU session modification complete
#### 8.3.10.1 Message definition
The PDU SESSION MODIFICATION COMPLETE message is sent by the UE to the SMF in
response to the PDU SESSION MODIFICATION COMMAND message and indicates an
acceptance of the PDU SESSION MODIFICATION COMMAND message. See table
8.3.10.1.1.
Message type: PDU SESSION MODIFICATION COMPLETE
Significance: dual
Direction: UE to network
Table 8.3.10.1.1: PDU SESSION MODIFICATION COMPLETE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | MO | | | | | | | DIFICATION | 9.7 | | | | | | COMPLETE | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
NOTE: It is possible for UEs compliant with earlier versions of this
specification to include the 5GSM cause IE with IEI 59 in the PDU SESSION
MODIFICATION COMPLETE message, and therefore the IEI 59 cannot be used for
other optional IEs other than the 5GSM cause IE for future extensions of the
PDU SESSION MODIFICATION COMPLETE message.
#### 8.3.10.2 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
### 8.3.11 PDU session modification command reject
#### 8.3.11.1 Message definition
The PDU SESSION MODIFICATION COMMAND REJECT message is sent by the UE to the
SMF to indicate rejection of the PDU SESSION MODIFICATION COMMAND message. See
table 8.3.11.1.1.
Message type: PDU SESSION MODIFICATION COMMAND REJECT
Significance: dual
Direction: UE to network
Table 8.3.11.1.1: PDU SESSION MODIFICATION COMMAND REJECT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | MO | | | | | | | DIFICATION | 9.7 | | | | | | COMMAND | | | | | | | REJECT | | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GSM cause | 5GSM cause | M | V | 1 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.11.2 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
### 8.3.12 PDU session release request
#### 8.3.12.1 Message definition
The PDU SESSION RELEASE REQUEST message is sent by the UE to the SMF to
request a release of a PDU session. See table 8.3.12.1.1.
Message type: PDU SESSION RELEASE REQUEST
Significance: dual
Direction: UE to network
Table 8.3.12.1.1: PDU SESSION RELEASE REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | RELEASE | | | | | | | REQUEST | 9.7 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 59 | 5GSM cause | 5GSM cause | O | TV | 2 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.12.2 5GSM cause
This IE is included in the message when the UE releases the PDU session due to
semantic or syntactical errors in QoS operations, or due to semantic or
syntactical errors in packet filters.
#### 8.3.12.3 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
### 8.3.13 PDU session release reject
#### 8.3.13.1 Message definition
The PDU SESSION RELEASE REJECT message is sent by the SMF to the UE to
indicate rejection of request a release of a PDU session. See table
8.3.13.1.1.
Message type: PDU SESSION RELEASE REJECT
Significance: dual
Direction: network to UE
Table 8.3.13.1.1: PDU SESSION RELEASE REJECT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | RELEASE | | | | | | | REJECT | 9.7 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GSM cause | 5GSM cause | M | V | 1 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.13.2 Extended protocol configuration options
This IE is included in the message when the network needs to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
### 8.3.14 PDU session release command
#### 8.3.14.1 Message definition
The PDU SESSION RELEASE COMMAND message is sent by the SMF to the UE to
indicate a release of a PDU session. See table 8.3.14.1.1.
Message type: PDU SESSION RELEASE COMMAND
Significance: dual
Direction: network to UE
Table 8.3.14.1.1: PDU SESSION RELEASE COMMAND message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | RELEASE | | | | | | | COMMAND | 9.7 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | 5GSM cause | 5GSM cause | M | V | 1 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 37 | Back-off | GPRS timer | O | TLV | 3 | | | timer | 3 | | | | | | value | | | | | | | | 9.11.2.5 | | | | +-----+------------+------------+----------+--------+---------+ | 78 | EAP | EAP | O | TLV-E | 7-1503 | | | message | message | | | | | | | | | | | | | | 9.11.2.2 | | | | +-----+------------+------------+----------+--------+---------+ | 61 | 5GSM | 5GSM | O | TLV | 3 | | | congestion | congestion | | | | | | re-attempt | re-attempt | | | | | | indicator | indicator | | | | | | | | | | | | | | 9.11.4.2A | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.14.2 Back-off timer value
The network may include this IE to request a minimum time interval before
procedure retry is allowed.
#### 8.3.14.3 EAP message
This IE is included when the external DN performs re-authentication and re-
authorization of the UE using EAP and it completes unsuccessfully.
#### 8.3.14.4 Extended protocol configuration options
This IE is included in the message when the network wants to transmit
(protocol) data (e.g. configuration parameters, error codes or
messages/events) to the UE.
#### 8.3.14.5 5GSM congestion re-attempt indicator
The network may include this IE only if it includes the Back-off timer value
IE and the 5GSM cause value is either #67 \"insufficient resources for
specific slice and DNN\" or #69 \"insufficient resources for specific slice\".
### 8.3.15 PDU session release complete
#### 8.3.15.1 Message definition
The PDU SESSION RELEASE COMPLETE message is sent by the UE to the SMF in
response to the PDU SESSION RELEASE COMMAND message and indicates an
acceptance of a release of the PDU session. See table 8.3.15.1.1.
Message type: PDU SESSION RELEASE COMPLETE
Significance: dual
Direction: UE to network
Table 8.3.15.1.1: PDU SESSION RELEASE COMPLETE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | dis | dis | | | | | | criminator | criminator | | | | | | | | | | | | | | 9.2 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | PDU | M | V | 1 | | | session ID | session | | | | | | | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+------------+------------+----------+--------+---------+ | | PTI | Procedure | M | V | 1 | | | | t | | | | | | | ransaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+------------+------------+----------+--------+---------+ | | PDU | Message | M | V | 1 | | | SESSION | type | | | | | | RELEASE | | | | | | | COMPLETE | 9.7 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | 59 | 5GSM cause | 5GSM cause | O | TV | 2 | | | | | | | | | | | 9.11.4.2 | | | | +-----+------------+------------+----------+--------+---------+ | 7B | Extended | Extended | O | TLV-E | 4-65538 | | | protocol | protocol | | | | | | con | con | | | | | | figuration | figuration | | | | | | options | options | | | | | | | | | | | | | | 9.11.4.6 | | | | +-----+------------+------------+----------+--------+---------+
#### 8.3.15.2 5GSM cause
This IE is included in the message when the UE needs to indicate to the
network that an error encountered with a mandatory information element in the
PDU SESSION RELEASE COMMAND message.
#### 8.3.15.3 Extended protocol configuration options
This IE is included in the message when the UE needs to transmit (protocol)
data (e.g. configuration parameters, error codes or messages/events) to the
network.
### 8.3.16 5GSM status
#### 8.3.16.1 Message definition
The 5GSM STATUS message is sent by the SMF or the UE to pass information on
the status of the indicated PDU session and report certain error conditions.
See table 8.3.16.1.1.
Message type: 5GSM STATUS
Significance: dual
Direction: both
Table 8.3.16.1.1: 5GSM STATUS message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | Extended | Extended | M | V | 1 | | | protocol | protocol | | | | | | di | di | | | | | | scriminator | scriminator | | | | | | | | | | | | | | 9.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PDU session | PDU session | M | V | 1 | | | ID | identity | | | | | | | | | | | | | | 9.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PTI | Procedure | M | V | 1 | | | | transaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GSM STATUS | Message | M | V | 1 | | | message | type | | | | | | identity | | | | | | | | 9.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | | 5GSM cause | 5GSM cause | M | V | 1 | | | | | | | | | | | 9.11.4.2 | | | | +-----+-------------+-------------+----------+--------+--------+
# 9 General message format and information elements coding
## 9.1 Overview
### 9.1.1 NAS message format
Within the protocols defined in the present document, every 5GS NAS message is
a standard L3 message as defined in 3GPP TS 24.007 [11]. This means that the
message consists of the following parts:
1) if the message is a plain 5GS NAS message:
a) extended protocol discriminator;
b) security header type associated with a half spare octet or PDU session
identity;
c) procedure transaction identity;
d) message type;
e) other information elements, as required.
2) if the message is a security protected 5GS NAS message:
a) extended protocol discriminator;
b) security header type associated with a half spare octet;
c) message authentication code;
d) sequence number;
e) plain 5GS NAS message, as defined in item 1
The organization of a plain 5GS NAS message is illustrated in the example
shown in figure 9.1.1.
+---------------------+------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------------+------------+---+---+---+---+---+---+---+ | Extended protocol | octet 1 | | | | | | | | | discriminator | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Security header | octet 2 | | | | | | | | | type associated | | | | | | | | | | with a spare half | | | | | | | | | | octet; or | | | | | | | | | | | | | | | | | | | | PDU session | | | | | | | | | | identity | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Procedure | octet 2a* | | | | | | | | | transaction | | | | | | | | | | identity | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Message type | octet 3 | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | | octet 4 | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | Other information | | | | | | | | | | elements as | | | | | | | | | | required | | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+ | | octet n | | | | | | | | +---------------------+------------+---+---+---+---+---+---+---+
Figure 9.1.1.1: General message organization example for a plain 5GS NAS
message
The PDU session identity and the procedure transaction identity are only used
in messages with extended protocol discriminator 5GS session management. Octet
2a with the procedure transaction identity shall only be included in these
messages.
The organization of a security protected 5GS NAS message is illustrated in the
example shown in figure 9.1.2.
* * *
8 7 6 5 4 3 2 1  
Extended protocol discriminator octet 1  
Security header type associated with a spare half octet octet 2  
octet 3  
Message authentication code
                                                            octet 6
Sequence number octet 7  
octet 8  
Plain 5GS NAS message  
octet n
* * *
Figure 9.1.1.2: General message organization example for a security protected
5GS NAS message
Unless specified otherwise in the message descriptions of clause 8 and annex
D, a particular information element shall not be present more than once in a
given message.
### 9.1.2 Field format and mapping
When a field is contained within a single octet, the lowest numbered bit of
the field represents the least significant bit.
When a field extends over more than one octet, the order of bit values
progressively decreases as the octet number increases. In that part of the
field contained in a given octet, the lowest numbered bit represents the least
significant bit. The most significant bit of the field is represented by the
highest numbered bit of the lowest numbered octet of the field. The least
significant bit of the field is represented by the lowest numbered bit of the
highest numbered octet of the field.
For example, a bit number can be identified as a couple (o, b) where o is the
octet number and b is the relative bit number within the octet. Figure 9.1.2.1
illustrates a field that spans from bit (1, 3) to bit (2, 7). The most
significant bit of the field is mapped on bit (1, 3) and the least significant
bit is mapped on bit (2, 7).
* * *
8 7 6 5 4 3 2 1  
2^4^ 2^3^ 2^2^ 1^st^ octet of field 2^1^ 2^0^ 2^nd^ octet of field
* * *
Figure 9.1.2.1: Field mapping convention
## 9.2 Extended protocol discriminator
Bits 1 to 8 of the first octet of every 5GS NAS message contain the Extended
protocol discriminator (EPD) IE. The EPD and its use are defined in 3GPP TS
24.007 [11]. The extended protocol discriminator in the header (see 3GPP TS
24.007 [11]) of a security protected 5GS NAS message is encoded as \"5GS
mobility management messages\".
## 9.3 Security header type
Bits 1 to 4 of the second octet of every 5GMM message contain the Security
header type IE. This IE includes control information related to the security
protection of a 5GMM message. The total size of the Security header type IE is
4 bits.
The Security header type IE can take the values shown in table 9.3.1.
Table 9.3.1: Security header type
+----------------------------+---+---+---+----------------------------+ | Security header type | | | | | | (octet 1) | | | | | +----------------------------+---+---+---+----------------------------+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 4 | 3 | 2 | 1 | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | 0 | Plain 5GS NAS message, not | | | | | | security protected | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | Security protected 5GS NAS | | | | | | message: | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | 1 | Integrity protected | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | 0 | Integrity protected and | | | | | | ciphered | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | 1 | Integrity protected with | | | | | | new 5G NAS security | | | | | | context (NOTE 1) | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 0 | 0 | Integrity protected and | | | | | | ciphered with new 5G NAS | | | | | | security context (NOTE 2) | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | All other values are | | | | | | reserved. | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | NOTE 1: This codepoint may | | | | | | be used only for a | | | | | | SECURITY MODE COMMAND | | | | | | message. | | | | | | | | | | | | NOTE 2: This codepoint may | | | | | | be used only for a | | | | | | SECURITY MODE COMPLETE | | | | | | message. | | | | | +----------------------------+---+---+---+----------------------------+
A 5GMM message received with the security header type encoded as 0000 shall be
treated as not security protected, plain 5GS NAS message. A protocol entity
sending a not security protected 5GMM message shall send the message as plain
5GS NAS message and encode the security header type as 0000.
## 9.4 PDU session identity
Bits 1 to 8 of the second octet of every 5GSM message contain the PDU session
identity IE. The PDU session identity and its use to identify a message flow
are defined in 3GPP TS 24.007 [11].
## 9.5 Spare half octet
This element is used in the description of 5GMM and 5GSM messages when an odd
number of half octet type 1 information elements are used. This element is
filled with spare bits set to zero and is placed in bits 5 to 8 of the octet
unless otherwise specified.
## 9.6 Procedure transaction identity
Bits 1 to 8 of the third octet of every 5GSM message contain the procedure
transaction identity. Bits 1 to 8 of the first octet of every UE policy
delivery message contain the procedure transaction identity. The procedure
transaction identity and its use are defined in 3GPP TS 24.007 [11].
## 9.7 Message type
The Message type IE and its use are defined in 3GPP TS 24.007 [11]. Tables
9.7.1 and 9.7.2 define the value part of the message type IE used in the 5GS
mobility management protocol and 5GS session management protocol.
Table 9.7.1: Message types for 5GS mobility management
Bits
* * *
8 7 6 5 4 3 2 1
0 1 - - - - - - 5GS mobility management messages
0 1 0 0 0 0 0 1 Registration request 0 1 0 0 0 0 1 0 Registration accept 0 1 0
0 0 0 1 1 Registration complete 0 1 0 0 0 1 0 0 Registration reject 0 1 0 0 0
1 0 1 Deregistration request (UE originating) 0 1 0 0 0 1 1 0 Deregistration
accept (UE originating) 0 1 0 0 0 1 1 1 Deregistration request (UE terminated)
0 1 0 0 1 0 0 0 Deregistration accept (UE terminated)
0 1 0 0 1 1 0 0 Service request 0 1 0 0 1 1 0 1 Service reject 0 1 0 0 1 1 1 0
Service accept
0 1 0 1 0 1 0 0 Configuration update command 0 1 0 1 0 1 0 1 Configuration
update complete 0 1 0 1 0 1 1 0 Authentication request 0 1 0 1 0 1 1 1
Authentication response 0 1 0 1 1 0 0 0 Authentication reject 0 1 0 1 1 0 0 1
Authentication failure 0 1 0 1 1 0 1 0 Authentication result 0 1 0 1 1 0 1 1
Identity request 0 1 0 1 1 1 0 0 Identity response 0 1 0 1 1 1 0 1 Security
mode command 0 1 0 1 1 1 1 0 Security mode complete 0 1 0 1 1 1 1 1 Security
mode reject
0 1 1 0 0 1 0 0 5GMM status 0 1 1 0 0 1 0 1 Notification 0 1 1 0 0 1 1 0
Notification response 0 1 1 0 0 1 1 1 UL NAS transport 0 1 1 0 1 0 0 0 DL NAS
transport
Table 9.7.2: Message types for 5GS session management
Bits
* * *
8 7 6 5 4 3 2 1
1 1 - - - - - - 5GS session management messages
1 1 0 0 0 0 0 1 PDU session establishment request 1 1 0 0 0 0 1 0 PDU session
establishment accept 1 1 0 0 0 0 1 1 PDU session establishment reject
1 1 0 0 0 1 0 1 PDU session authentication command 1 1 0 0 0 1 1 0 PDU session
authentication complete 1 1 0 0 0 1 1 1 PDU session authentication result
1 1 0 0 1 0 0 1 PDU session modification request 1 1 0 0 1 0 1 0 PDU session
modification reject 1 1 0 0 1 0 1 1 PDU session modification command 1 1 0 0 1
1 0 0 PDU session modification complete 1 1 0 0 1 1 0 1 PDU session
modification command reject
1 1 0 1 0 0 0 1 PDU session release request 1 1 0 1 0 0 1 0 PDU session
release reject 1 1 0 1 0 0 1 1 PDU session release command 1 1 0 1 0 1 0 0 PDU
session release complete
1 1 0 1 0 1 1 0 5GSM status
## 9.8 Message authentication code
The message authentication code (MAC) information element contains the
integrity protection information for the message. The MAC IE shall be included
in the SECURITY PROTECTED 5GS NAS MESSAGE message if a valid 5G NAS security
context exists and security functions are started. The usage of MAC is
specified in subclause 4.4.3.3.
## 9.9 Plain 5GS NAS message
This IE includes a complete plain 5GS NAS message as specified in subclauses
8.2 and 8.3. The SECURITY PROTECTED 5GS NAS MESSAGE message (see subclause
8.2.28) is not plain 5GS NAS messages and shall not be included in this IE.
## 9.10 Sequence number
This IE includes the NAS message sequence number (SN) which consists of the
eight least significant bits of the NAS COUNT for a SECURITY PROTECTED 5GS NAS
MESSAGE message. The usage of SN is specified in subclause 4.4.3.
## 9.11 Other information elements
### 9.11.1 General
The different formats (V, LV, T, TV, TLV, LV-E, TLV-E) and the five categories
of information elements (type 1, 2, 3, 4 and 6) are defined in 3GPP TS 24.007
[11].
The first octet of an information element in the non-imperative part contains
the IEI of the information element. If this octet does not correspond to an
IEI known in the message, the receiver shall determine whether this IE is of
type 1 or 2 (i.e. it is an information element of one octet length) or an IE
of type 4 (i.e. that the next octet is the length indicator indicating the
length of the remaining of the information element) (see 3GPP TS 24.007 [11]).
This allows the receiver to jump over unknown information elements and to
analyse any following information elements of a particular message.
The definitions of information elements which are:
a) common for the 5GMM and 5GSM protocols;
b) used by access stratum protocols; or
c) sent to upper layers
are described in subclause 9.11.2.
The information elements of the 5GMM or 5GSM protocols can be defined by
reference to an appropriate specification which provides the definition of the
information element, e.g., \"see subclause 10.5.6.3A in 3GPP TS 24.008 [12]\".
### 9.11.2 Common information elements
#### 9.11.2.1 Additional information
The purpose of the Additional information information element is to provide
additional information to upper layers in relation to the NAS transport
mechanism.
The Additional information information element is coded as shown in figure
9.11.2.1.1 and table 9.11.2.1.1.
The Additional information is a type 4 information element with a minimum
length of 3 octets.
* * *
8 7 6 5 4 3 2 1  
Additional information IEI octet 1  
Additional information length octet 2  
Additional information value octets 3-n
* * *
Figure 9.11.2.1.1: Additional information information element
Table 9.11.2.1.1 : Additional information information element
* * *
Additional information value (octet 3 to octet n) The coding of the additional
information value is dependent on the LCS application.
* * *
#### 9.11.2.1A DNN
The purpose of the DNN information element is to identify the data network.
The DNN information element is coded as shown in figure 9.11.2.1A.1.
The DNN is a type 4 information element with a minimum length of 3 octets and
a maximum length of 102 octets.
+------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +========================+=========+===+===+===+===+===+===+===+ | DNN IEI | octet 1 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+ | Length of DNN contents | octet 2 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+ | DNN value | octet 3 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+
Figure 9.11.2.1A.1: DNN information element
A DNN value field contains an APN as defined in 3GPP TS 23.003 [4].
#### 9.11.2.2 EAP message
The purpose of the EAP message information element is to transport an EAP
message as specified in IETF RFC 3748 [34].
The EAP message information element is coded as shown in figure 9.11.2.2.1 and
table 9.11.2.2.1.
The EAP message is a type 6 information element with minimum length of 7
octets and maximum length of 1503 octets.
+--------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------+---------+---+---+---+---+---+---+---+ | EAP message IEI | octet 1 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | Length of EAP message contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+ | EAP message | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +--------------------------------+---------+---+---+---+---+---+---+---+
Figure 9.11.2.2.1: EAP message information element
Table 9.11.2.2.1: EAP message information element
* * *
EAP message (octet 4 to n) An EAP message as specified in IETF RFC 3748 [34].
* * *
#### 9.11.2.3 GPRS timer
See subclause 10.5.7.3 in 3GPP TS 24.008 [12].
#### 9.11.2.4 GPRS timer 2
See subclause 10.5.7.4 in 3GPP TS 24.008 [12].
#### 9.11.2.5 GPRS timer 3
See subclause 10.5.7.4a in 3GPP TS 24.008 [12].
#### 9.11.2.6 Intra N1 mode NAS transparent container
The purpose of the Intra N1 mode NAS transparent container information element
is to provide the UE with parameters that enable the UE to handle the 5G NAS
security context after N1 mode to N1 mode handover.
The Intra N1 mode NAS transparent container information element is coded as
shown in figure 9.11.2.6.1 and table 9.11.2.6.1.
The Intra N1 mode NAS transparent container is a type 4 information element
with a length of 9 octets.
The value part of the Intra N1 mode NAS transparent container information
element is included in specific information elements within some RRC messages
sent to the UE.
NOTE: For these cases the coding of the information element identifier and
length information of RRC is defined in 3GPP TS 38.331 [30].
+---------+---------+---------+------+-----+---------+---------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------+---------+---------+------+-----+---------+---------+---+---+ | Intra | octet 1 | | | | | | | | | N1 mode | | | | | | | | | | NAS | | | | | | | | | | tran | | | | | | | | | | sparent | | | | | | | | | | co | | | | | | | | | | ntainer | | | | | | | | | | IEI | | | | | | | | | +---------+---------+---------+------+-----+---------+---------+---+---+ | Length | octet 2 | | | | | | | | | of | | | | | | | | | | Intra | | | | | | | | | | N1 mode | | | | | | | | | | NAS | | | | | | | | | | tran | | | | | | | | | | sparent | | | | | | | | | | co | | | | | | | | | | ntainer | | | | | | | | | | c | | | | | | | | | | ontents | | | | | | | | | +---------+---------+---------+------+-----+---------+---------+---+---+ | Message | octet 3 | | | | | | | | | authent | | | | | | | | | | ication | octet 6 | | | | | | | | | code | | | | | | | | | +---------+---------+---------+------+-----+---------+---------+---+---+ | Type of | Type of | octet 7 | | | | | | | | ci | in | | | | | | | | | phering | tegrity | | | | | | | | | al | pro | | | | | | | | | gorithm | tection | | | | | | | | | | al | | | | | | | | | | gorithm | | | | | | | | +---------+---------+---------+------+-----+---------+---------+---+---+ | 0 | 0\ | 0 | KACF | TSC | Key set | octet 8 | | | | | Spare | | | | ide | | | | | | | | | | ntifier | | | | | | | | | | in 5G | | | | +---------+---------+---------+------+-----+---------+---------+---+---+ | S | octet 9 | | | | | | | | | equence | | | | | | | | | | number | | | | | | | | | +---------+---------+---------+------+-----+---------+---------+---+---+
Figure 9.11.2.6.1: Intra N1 mode NAS transparent container information element
Table 9.11.2.6.1: Intra N1 mode NAS transparent container information element
* * *
Message authentication code (octet 3 to 6)
This field is coded as the Message authentication code information element
(see subclause 9.8).
Type of integrity protection algorithm (octet 7, bit 1 to 4) and\  
type of ciphering algorithm (octet 7, bit 5 to 8)
These fields are coded as the type of integrity protection algorithm and type
of ciphering algorithm in the NAS security algorithms information element (see
subclause 9.11.3.34).
K_AMF_change_flag (KACF) (octet 8, bit 5)
Bit
5
0 a new K~AMF~ has not been calculated by the network
1 a new K~AMF~ has been calculated by the network
Key set identifier in 5G (octet 8, bit 1 to 3) and\  
Type of security context flag (TSC) (octet 8, bit 4)
These fields are coded as the NAS key set identifier and type of security
context flag in the NAS key set identifier information element (see subclause
9.11.3.32).
Sequence number (octet 9)
This field is coded as the Sequence number information element (see subclause
9.10)
* * *
#### 9.11.2.7 N1 mode to S1 mode NAS transparent container
The purpose of the N1 mode to S1 mode NAS transparent container information
element is to provide the UE with information that enables the UE to create a
mapped EPS security context.
The N1 mode to S1 mode NAS transparent container information element is coded
as shown in figure 9.11.2.7.1 and table 9.11.2.7.1.
The N1 mode to S1 mode NAS transparent container is a type 3 information
element with a length of 2 octets.
The value part of the N1 mode to S1 mode NAS transparent container information
element is included in specific information elements within some RRC messages
sent to the UE; see 3GPP TS 38.331 [30]. For these cases the coding of the
information element identifier and length information is defined in 3GPP TS
38.331 [30].
* * *
8 7 6 5 4 3 2 1  
N1 mode to S1 mode NAS transparent container IEI octet 1  
Sequence number octet 2
* * *
Figure 9.11.2.7.1: N1 mode to S1 mode NAS transparent container information
element
Table 9.11.2.7.1: N1 mode to S1 mode NAS transparent container information
element
* * *
Sequence number (octet 2) This field is coded as the Sequence number
information element (see subclause 9.10).
* * *
#### 9.11.2.8 S-NSSAI
The purpose of the S-NSSAI information element is to identify a network slice.
The S-NSSAI information element is coded as shown in figure 9.11.2.8.1 and
table 9.11.2.8.1.
The S-NSSAI is a type 4 information element with a minimum length of 3 octets
and a maximum length of 10 octets.
+----------------------------+------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +============================+============+===+===+===+===+===+===+===+ | S-NSSAI IEI | octet 1 | | | | | | | | +----------------------------+------------+---+---+---+---+---+---+---+ | Length of S-NSSAI contents | octet 2 | | | | | | | | +----------------------------+------------+---+---+---+---+---+---+---+ | SST | octet 3 | | | | | | | | +----------------------------+------------+---+---+---+---+---+---+---+ | SD | octet 4* | | | | | | | | | | | | | | | | | | | | octet 6* | | | | | | | | +----------------------------+------------+---+---+---+---+---+---+---+ | Mapped HPLMN SST | octet 7* | | | | | | | | +----------------------------+------------+---+---+---+---+---+---+---+ | Mapped HPLMN SD | octet 8* | | | | | | | | | | | | | | | | | | | | octet 10* | | | | | | | | +----------------------------+------------+---+---+---+---+---+---+---+
Figure 9.11.2.8.1: S-NSSAI information element
Table 9.11.2.8.1: S-NSSAI information element
+---------------------+---+---+---+---+---+---+---+---------------------+ | Length of S-NSSAI | | | | | | | | | | contents (octet 2) | | | | | | | | | +=====================+===+===+===+===+===+===+===+=====================+ | | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | This field | | | | | | | | | | indicates the | | | | | | | | | | length of the | | | | | | | | | | included S-NSSAI | | | | | | | | | | contents, and it | | | | | | | | | | can have the | | | | | | | | | | following values. | | | | | | | | | | Depending on the | | | | | | | | | | value of the length | | | | | | | | | | field the following | | | | | | | | | | S-NSSAI contents | | | | | | | | | | are included: | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | Bits | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------------+---+---+---+---+---+---+---+---------------------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 | SST | +---------------------+---+---+---+---+---+---+---+---------------------+ | 0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 | SST and mapped | | | | | | | | | | HPLMN SST | +---------------------+---+---+---+---+---+---+---+---------------------+ | 0 | 0 | 0 | 0 | 0 | 1 | 0 | 0 | SST and SD | +---------------------+---+---+---+---+---+---+---+---------------------+ | 0 | 0 | 0 | 0 | 0 | 1 | 0 | 1 | SST, SD and mapped | | | | | | | | | | HPLMN SST | +---------------------+---+---+---+---+---+---+---+---------------------+ | 0 | 0 | 0 | 0 | 1 | 0 | 0 | 0 | SST, SD, mapped | | | | | | | | | | HPLMN SST and | | | | | | | | | | mapped HPLMN SD | +---------------------+---+---+---+---+---+---+---+---------------------+ | All other values | | | | | | | | | | are reserved. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | Slice/service type | | | | | | | | | | (SST) (octet 3) | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | This field contains | | | | | | | | | | the 8 bit SST | | | | | | | | | | value. The coding | | | | | | | | | | of the SST value | | | | | | | | | | part is defined in | | | | | | | | | | 3G | | | | | | | | | | PP TS 23.003 [4]. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | Slice | | | | | | | | | | differentiator (SD) | | | | | | | | | | (octet 4 to octet | | | | | | | | | | 6) | | | | | | | | | | | | | | | | | | | | This field contains | | | | | | | | | | the 24 bit SD | | | | | | | | | | value. The coding | | | | | | | | | | of the SD value | | | | | | | | | | part is defined in | | | | | | | | | | 3G | | | | | | | | | | PP TS 23.003 [4]. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | If the SST encoded | | | | | | | | | | in octet 3 is not | | | | | | | | | | associated with a | | | | | | | | | | valid SD value, and | | | | | | | | | | the sender needs to | | | | | | | | | | include a mapped | | | | | | | | | | HPLMN SST (octet 7) | | | | | | | | | | and a mapped HPLMN | | | | | | | | | | SD (octets 8 to | | | | | | | | | | 10), then the | | | | | | | | | | sender shall set | | | | | | | | | | the SD value | | | | | | | | | | (octets 4 to 6) to | | | | | | | | | | \"no SD value | | | | | | | | | | associated with the | | | | | | | | | | SST\". | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | mapped HPLMN | | | | | | | | | | Slice/service type | | | | | | | | | | (SST) (octet 7) | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | This field contains | | | | | | | | | | the 8 bit SST value | | | | | | | | | | of an S-NSSAI in | | | | | | | | | | the S-NSSAI(s) of | | | | | | | | | | the HPLMN to which | | | | | | | | | | the SST value is | | | | | | | | | | mapped. The coding | | | | | | | | | | of the SST value | | | | | | | | | | part is defined in | | | | | | | | | | 3G | | | | | | | | | | PP TS 23.003 [4]. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | mapped HPLMN Slice | | | | | | | | | | differentiator (SD) | | | | | | | | | | (octet 8 to octet | | | | | | | | | | 10) | | | | | | | | | | | | | | | | | | | | This field contains | | | | | | | | | | the 24 bit SD value | | | | | | | | | | of an S-NSSAI in | | | | | | | | | | the S-NSSAI(s) of | | | | | | | | | | the HPLMN to which | | | | | | | | | | the SD value is | | | | | | | | | | mapped. The coding | | | | | | | | | | of the SD value | | | | | | | | | | part is defined in | | | | | | | | | | 3G | | | | | | | | | | PP TS 23.003 [4]. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+ | NOTE 1: Octet 3 | | | | | | | | | | shall always be | | | | | | | | | | included. | | | | | | | | | | | | | | | | | | | | NOTE 2: If the | | | | | | | | | | octet 4 is | | | | | | | | | | included, then | | | | | | | | | | octet 5 and octet 6 | | | | | | | | | | shall be included. | | | | | | | | | | | | | | | | | | | | NOTE 3: If the | | | | | | | | | | octet 7 is | | | | | | | | | | included, then | | | | | | | | | | octets 8, 9, and 10 | | | | | | | | | | may be included. | | | | | | | | | | | | | | | | | | | | NOTE 4: If the | | | | | | | | | | octet 8 is | | | | | | | | | | included, then | | | | | | | | | | octet 9 and octet | | | | | | | | | | 10 shall be | | | | | | | | | | included. | | | | | | | | | +---------------------+---+---+---+---+---+---+---+---------------------+
#### 9.11.2.9 S1 mode to N1 mode NAS transparent container
The purpose of the S1 mode to N1 mode NAS transparent container information
element is to provide the UE with parameters that enable the UE to create a
mapped 5G NAS security context and take this context into use after inter-
system change to N1 mode in 5GMM-CONNECTED mode.
The S1 mode to N1 mode NAS transparent container information element is coded
as shown in figure 9.11.2.9.1 and table 9.11.2.9.1.
The S1 mode to N1 mode NAS transparent container is a type 4 information
element with a length of 10 octets.
The value part of the S1 mode to N1 mode NAS transparent container information
element is included in specific information elements within some RRC messages
sent to the UE.
NOTE: For these cases the coding of the information element identifier and
length information of RRC is defined in 3GPP TS 38.331 [30].
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | S1 | octet | | | | | | | | | mode | 1 | | | | | | | | | to N1 | | | | | | | | | | mode | | | | | | | | | | NAS | | | | | | | | | | t | | | | | | | | | | ransp | | | | | | | | | | arent | | | | | | | | | | cont | | | | | | | | | | ainer | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of S1 | | | | | | | | | | mode | | | | | | | | | | to N1 | | | | | | | | | | mode | | | | | | | | | | NAS | | | | | | | | | | t | | | | | | | | | | ransp | | | | | | | | | | arent | | | | | | | | | | cont | | | | | | | | | | ainer | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Me | octet | | | | | | | | | ssage | 3 | | | | | | | | | auth | | | | | | | | | | entic | octet | | | | | | | | | ation | 6 | | | | | | | | | code | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Type | Type | octet | | | | | | | | of | of | 7 | | | | | | | | ciph | inte | | | | | | | | | ering | grity | | | | | | | | | algo | prote | | | | | | | | | rithm | ction | | | | | | | | | | algo | | | | | | | | | | rithm | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | NCC | TSC | Key | octet | | | | | | | | | set | 8 | | | | | | Spare | | | ident | | | | | | | | | | ifier | | | | | | | | | | in 5G | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet | | | | | | | | | | 9 | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | Spare | | | | | | | | | | | octet | | | | | | | | | | 10 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | Spare | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.2.9.1: S1 mode to N1 mode NAS transparent container information
element
Table 9.11.2.9.1: S1 mode to N1 mode NAS transparent container information
element
* * *
Message authentication code (octet 3 to 6)
This field is coded as the Message authentication code information element
(see subclause 9.8).
Type of integrity protection algorithm (octet 7, bit 1 to 4) and\ type of
ciphering algorithm (octet 7, bit 5 to 8)
These fields are coded as the type of integrity protection algorithm and type
of ciphering algorithm in the NAS security algorithms information element (see
subclause 9.11.3.34).
NCC (octet 8, bits 5 to 7)
This field contains the 3 bit Next hop chaining counter (see 3GPP TS 33.501
[24])
Key set identifier in 5G (octet 8, bit 1 to 3) and\ type of security context
flag (TSC) (octet 8, bit 4)
These fields are coded as the NAS key set identifier and type of security
context flag in the NAS key set identifier information element (see subclause
9.11.3.32).
Octets 9 and 10 are spare and shall be coded as zero.
NOTE: In earlier versions of this protocol, octets 9 and 10 can have any
value. In this version of the protocol, octets 9 and 10 can always be ignored
by the UE.
* * *
### 9.11.3 5GS mobility management (5GMM) information elements
#### 9.11.3.1 5GMM capability
The purpose of the 5GMM capability information element is to provide the
network with information concerning aspects of the UE related to the 5GCN or
interworking with the EPS. The contents might affect the manner in which the
network handles the operation of the UE.
The 5GMM capability information element is coded as shown in figure 9.11.3.1.1
and table 9.11.3.1.1.
The 5GMM capability is a type 4 information element with a minimum length of 3
octets and a maximum length of 15 octets.
+-------+-------+-------+-------+-------+-----+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-----+-------+-------+-------+ | 5GMM | octet | | | | | | | | | capab | 1 | | | | | | | | | ility | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-----+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | 5GMM | | | | | | | | | | capab | | | | | | | | | | ility | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-----+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | LPP | HO | S1 | octet | | | | | | | | a | mode | 3 | | Spare | Spare | Spare | Spare | Spare | | ttach | | | +-------+-------+-------+-------+-------+-----+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet | | | | | | | | | | 4* | | | | | | | | | | -15* | +-------+-------+-------+-------+-------+-----+-------+-------+-------+ | Spare | | | | | | | | | +-------+-------+-------+-------+-------+-----+-------+-------+-------+
Figure 9.11.3.1.1: 5GMM capability information element
Table 9.11.3.1.1: 5GMM capability information element
* * *
EPC NAS supported (S1 mode) (octet 3, bit 1)  
0 S1 mode not supported 1 S1 mode supported
ATTACH REQUEST message containing PDN CONNECTIVITY REQUEST message for
handover support (HO attach) (octet 3, bit 2)  
0 ATTACH REQUEST message containing PDN CONNECTIVITY REQUEST message with
request type set to \"handover\" or \"handover of emergency bearer services\"
to transfer PDU session from N1 mode to S1 mode not supported 1 ATTACH REQUEST
message containing PDN CONNECTIVITY REQUEST message with request type set to
\"handover\" or \"handover of emergency bearer services\" to transfer PDU
session from N1 mode to S1 mode supported
LTE Positioning Protocol (LPP) capability (octet 3, bit 3)  
0 LPP in N1 mode not supported 1 LPP in N1 mode supported (see 3GPP TS 36.355
[26]) All other bits in octet 3 to 15 are spare and shall be coded as zero, if
the respective octet is included in the information element.
* * *
#### 9.11.3.2 5GMM cause
The purpose of the 5GMM cause information element is to indicate the reason
why a 5GMM request from the UE is rejected by the network.
The 5GMM cause information element is coded as shown in figure 9.11.3.2.1 and
table 9.11.3.2.1.
The 5GMM cause is a type 3 information element with 2 octets length.
* * *
8 7 6 5 4 3 2 1  
5GMM cause IEI octet 1  
Cause value octet 2
* * *
Figure 9.11.3.2.1: 5GMM cause information element
Table 9.11.3.2.1 : 5GMM cause information element
* * *
Cause value (octet 2)
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 1 1 Illegal UE 0 0 0 0 0 1 0 1 PEI not accepted 0 0 0 0 0 1 1 0
Illegal ME 0 0 0 0 0 1 1 1 5GS services not allowed 0 0 0 0 1 0 0 1 UE
identity cannot be derived by the network 0 0 0 0 1 0 1 0 Implicitly de-
registered 0 0 0 0 1 0 1 1 PLMN not allowed 0 0 0 0 1 1 0 0 Tracking area not
allowed 0 0 0 0 1 1 0 1 Roaming not allowed in this tracking area 0 0 0 0 1 1
1 1 No suitable cells in tracking area 0 0 0 1 0 1 0 0 MAC failure 0 0 0 1 0 1
0 1 Synch failure 0 0 0 1 0 1 1 0 Congestion 0 0 0 1 0 1 1 1 UE security
capabilities mismatch 0 0 0 1 1 0 0 0 Security mode rejected, unspecified 0 0
0 1 1 0 1 0 Non-5G authentication unacceptable 0 0 0 1 1 0 1 1 N1 mode not
allowed 0 0 0 1 1 1 0 0 Restricted service area 0 0 1 0 1 0 1 1 LADN not
available 0 1 0 0 0 0 0 1 Maximum number of PDU sessions reached 0 1 0 0 0 0 1
1 Insufficient resources for specific slice and DNN 0 1 0 0 0 1 0 1
Insufficient resources for specific slice 0 1 0 0 0 1 1 1 ngKSI already in use
0 1 0 0 1 0 0 0 Non-3GPP access to 5GCN not allowed 0 1 0 0 1 0 0 1 Serving
network not authorized 0 1 0 1 1 0 1 0 Payload was not forwarded 0 1 0 1 1 0 1
1 DNN not supported or not subscribed in the slice 0 1 0 1 1 1 0 0
Insufficient user-plane resources for the PDU session 0 1 0 1 1 1 1 1
Semantically incorrect message 0 1 1 0 0 0 0 0 Invalid mandatory information 0
1 1 0 0 0 0 1 Message type non-existent or not implemented 0 1 1 0 0 0 1 0
Message type not compatible with the protocol state 0 1 1 0 0 0 1 1
Information element non-existent or not implemented 0 1 1 0 0 1 0 0
Conditional IE error 0 1 1 0 0 1 0 1 Message not compatible with the protocol
state 0 1 1 0 1 1 1 1 Protocol error, unspecified
Any other value received by the mobile station shall be treated as 0110 1111,
\"protocol error, unspecified\". Any other value received by the network shall
be treated as 0110 1111, \"protocol error, unspecified\".
* * *
#### 9.11.3.2A 5GS DRX parameters
The purpose of the 5GS DRX parameters information element is to indicate that
the UE wants to use DRX and for the network to indicate the DRX cycle value to
be used at paging.
The 5GS DRX parameters is a type 4 information element with a length of 3
octets.
The 5GS DRX parameters information element is coded as shown in figure
9.11.3.2A.1 and table 9.11.3.2A.1.
The value part of a DRX parameter information element is coded as shown in
table 9.11.3.2A.1.
* * *
8 7 6 5 4 3 2 1  
5GS DRX parameters IEI octet 1  
Length of 5GS DRX parameters contents octet 2  
0 0 0 0 DRX value  
spare octet 3
* * *
Figure 9.11.3.2A.1: 5GS DRX parameters information element
Table 9.11.3.2A.1: 5GS DRX parameters information element
+----------------------------+---+---+---+----------------------------+ | DRX value (bits 4 to 1 of | | | | | | octet 3) | | | | | | | | | | | | This field represents the | | | | | | DRX cycle parameter \'T\' | | | | | | as defined in | | | | | | 3GPP TS 38.304 [28]. | | | | | +----------------------------+---+---+---+----------------------------+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 4 | 3 | 2 | 1 | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | 0 | DRX value not specified | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | 1 | DRX cycle parameter T = 32 | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | 0 | DRX cycle parameter T = 64 | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | 1 | DRX cycle parameter T = | | | | | | 128 | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 0 | 0 | DRX cycle parameter T = | | | | | | 256 | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | All other values shall be | | | | | | interpreted as \"DRX value | | | | | | not specified\" by this | | | | | | version of the protocol. | | | | | | | | | | | | Bits 5 to 8 of octet 3 are | | | | | | spare and shall be coded | | | | | | as zero. | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+
#### 9.11.3.3 5GS identity type
The purpose of the 5GS identity type information element is to specify which
identity is requested.
The 5GS identity type is a type 1 information element.
The 5GS identity type information element is coded as shown in figure
9.11.3.3.1 and table 9.11.3.3.1.
+-------------------+-------+----------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------+-------+----------+---------+---+---+---+---+---+ | 5GS identity type | 0 | Type of | octet 1 | | | | | | | | | | | | | | | | | IEI | spare | identity | | | | | | | +-------------------+-------+----------+---------+---+---+---+---+---+
Figure 9.11.3.3.1: 5GS identity type information element
Table 9.11.3.3.1: 5GS identity type information element
* * *
Type of identity (octet 1)  
Bits  
3 2 1  
0 0 1 SUCI 0 1 0 5G-GUTI 0 1 1 IMEI 1 0 0 5G-S-TMSI 1 0 1 IMEISV
All other values are unused and shall be interpreted as \"SUCI\", if received
by the UE.
* * *
#### 9.11.3.4 5GS mobile identity
The purpose of the 5GS mobile identity information element is to provide
either the SUCI, the 5G-GUTI, the IMEI, the IMEISV or the 5G-S-TMSI.
The 5GS mobile identity information element is coded as shown in figures
9.11.3.4.1, 9.11.3.4.2, 9.11.3.4.3, 9.11.3.4.4, 9.11.3.4.5 and 9.11.3.4.6, and
table 9.11.3.4.1.
The 5GS mobile identity is a type 6 information element with a minimum length
of 4.
+---------+---------+---------+---+-------+---------+---------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5GS | octet 1 | | | | | | | | | mobile | | | | | | | | | | i | | | | | | | | | | dentity | | | | | | | | | | IEI | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | Length | octet2 | | | | | | | | | of 5GS | | | | | | | | | | mobile | octet 3 | | | | | | | | | i | | | | | | | | | | dentity | | | | | | | | | | c | | | | | | | | | | ontents | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 1 | 1 | 1 | 1 | 0 | Type of | octet 4 | | | | | | | | | i | | | | | | | | | spare | dentity | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | MCC | MCC | octet 5 | | | | | | | | digit 2 | digit 1 | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | MNC | MCC | octet 6 | | | | | | | | digit 3 | digit 3 | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | MNC | MNC | octet 7 | | | | | | | | digit 2 | digit 1 | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | AMF | octet 8 | | | | | | | | | Region | | | | | | | | | | ID | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | AMF Set | octet 9 | | | | | | | | | ID | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | AMF Set | AMF | octet | | | | | | | | ID | Pointer | 10 | | | | | | | | (con | | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet | | | | | | | | | | 11 | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet | | | | | | | | | (con | 12 | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet | | | | | | | | | (con | 13 | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet | | | | | | | | | (con | 14 | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+
Figure 9.11.3.4.1: 5GS mobile identity information element for type of
identity \"5G-GUTI\"
+------------+------------+------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------+------------+------------+---------+---+---+---+---+---+ | 5GS mobile | octet 1 | | | | | | | | | identity | | | | | | | | | | IEI | | | | | | | | | +------------+------------+------------+---------+---+---+---+---+---+ | Length of | octet 2 | | | | | | | | | 5GS mobile | | | | | | | | | | identity | octet 3 | | | | | | | | | contents | | | | | | | | | +------------+------------+------------+---------+---+---+---+---+---+ | Identity | odd/ | Type of | octet 4 | | | | | | | digit 1 | | identity | | | | | | | | | even | | | | | | | | | | | | | | | | | | | | indic | | | | | | | | +------------+------------+------------+---------+---+---+---+---+---+ | Identity | Identity | octet 5* | | | | | | | | digit p+1 | digit p | | | | | | | | +------------+------------+------------+---------+---+---+---+---+---+
Figure 9.11.3.4.2: 5GS mobile identity information element for type of
identity or \"IMEI\" or \"IMEISV\"
+---------+---------+---------+---------+---------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------+---------+---------+---------+---------+---------+---+---+---+ | 5GS | octet 1 | | | | | | | | | mobile | | | | | | | | | | i | | | | | | | | | | dentity | | | | | | | | | | IEI | | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | Length | octet 2 | | | | | | | | | of 5GS | | | | | | | | | | mobile | octet 3 | | | | | | | | | i | | | | | | | | | | dentity | | | | | | | | | | c | | | | | | | | | | ontents | | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | 0 | SUPI | 0 | Type of | octet 4 | | | | | | | format | | i | | | | | | | spare | | spare | dentity | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | MCC | MCC | octet 5 | | | | | | | | digit 2 | digit 1 | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | MNC | MCC | octet 6 | | | | | | | | digit 3 | digit 3 | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | MNC | MNC | octet 7 | | | | | | | | digit 2 | digit 1 | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | Routing | Routing | octet 8 | | | | | | | | in | in | | | | | | | | | dicator | dicator | | | | | | | | | digit 2 | digit 1 | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | Routing | Routing | octet 9 | | | | | | | | in | in | | | | | | | | | dicator | dicator | | | | | | | | | digit 4 | digit 3 | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | 0 | 0 | 0 | 0 | Pro | octet | | | | | | | | | tection | 10 | | | | | Spare | Spare | Spare | Spare | scheme | | | | | | | | | | Id | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | Home | octet | | | | | | | | | network | 11 | | | | | | | | | public | | | | | | | | | | key | | | | | | | | | | ide | | | | | | | | | | ntifier | | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+ | Scheme | octet | | | | | | | | | output | 12 - x | | | | | | | | +---------+---------+---------+---------+---------+---------+---+---+---+
Figure 9.11.3.4.3: 5GS mobile identity information element for type of
identity \"SUCI\" and SUPI format \"IMSI\"
* * *
8 7 6 5 4 3 2 1  
MSIN digit 2 MSIN digit 1 octet 12  
...  
MSIN digit n+1 MSIN digit n octet x
* * *
Figure 9.11.3.4.3a: Scheme output for type of identity \"SUCI\", SUPI format
\"IMSI\" and Protection scheme Id \"Null scheme\"
+----------+----------+-------+----------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------+----------+-------+----------+---------+---+---+---+---+ | 5GS | octet 1 | | | | | | | | | mobile | | | | | | | | | | identity | | | | | | | | | | IEI | | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | Length | octet 2 | | | | | | | | | of 5GS | | | | | | | | | | mobile | octet 3 | | | | | | | | | identity | | | | | | | | | | contents | | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | 0 | SUPI | 0 | Type of | octet 4 | | | | | | | format | | identity | | | | | | | Spare | | Spare | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | SUCI NAI | octet 5 | | | | | | | | | | - y | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+
Figure 9.11.3.4.4: 5GS mobile identity information element for type of
identity \"SUCI\" and SUPI format \"Network specific identifier\"
+---------+---------+---------+---+-------+---------+---------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5GS | octet 1 | | | | | | | | | mobile | | | | | | | | | | i | | | | | | | | | | dentity | | | | | | | | | | IEI | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | Length | octet 2 | | | | | | | | | of 5GS | | | | | | | | | | mobile | octet 3 | | | | | | | | | i | | | | | | | | | | dentity | | | | | | | | | | c | | | | | | | | | | ontents | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 1 | 1 | 1 | 1 | 0 | Type of | octet 4 | | | | | | | | | i | | | | | | | | | spare | dentity | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | AMF Set | octet 5 | | | | | | | | | ID | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | AMF Set | AMF | octet 6 | | | | | | | | ID | Pointer | | | | | | | | | (con | | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet 7 | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet 8 | | | | | | | | | (con | | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet 9 | | | | | | | | | (con | | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+ | 5G-TMSI | octet | | | | | | | | | (con | 10 | | | | | | | | | tinued) | | | | | | | | | +---------+---------+---------+---+-------+---------+---------+---+---+
Figure 9.11.3.4.5: 5GS mobile identity information element for type of
identity \"5G-S-TMSI\"
+------------+---------+---+---+---+------------+---------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------+---------+---+---+---+------------+---------+---+---+ | 5GS mobile | octet 1 | | | | | | | | | identity | | | | | | | | | | IEI | | | | | | | | | +------------+---------+---+---+---+------------+---------+---+---+ | Length of | octet 2 | | | | | | | | | 5GS mobile | | | | | | | | | | identity | octet 3 | | | | | | | | | contents | | | | | | | | | +------------+---------+---+---+---+------------+---------+---+---+ | 0 | 0 | 0 | 0 | 0 | Type of | octet 4 | | | | | | | | | identity | | | | +------------+---------+---+---+---+------------+---------+---+---+ | spare | | | | | | | | | +------------+---------+---+---+---+------------+---------+---+---+
Figure 9.11.3.4.6: 5GS mobile identity information element for type of
identity \"No identity\"
Table 9.11.3.4.1: 5GS mobile identity information element
Type of identity (octet 4) Bits |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
3 | 2 | 1 |  |  |  |  |  |  |   
0 | 0 | 0 | No identity (NOTE) |  |  |  |  |  |   
0 | 0 | 1 | SUCI |  |  |  |  |  |   
0 | 1 | 0 | 5G-GUTI |  |  |  |  |  |   
0 | 1 | 1 | IMEI |  |  |  |  |  |   
1 | 0 | 0 | 5G-S-TMSI |  |  |  |  |  |   
1 | 0 | 1 | IMEISV |  |  |  |  |  |   
All other values are reserved. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Odd/even indication (octet 4) Bit |  |  |  |  |  |  |  |  |   
4 |  |  |  |  |  |  |  |  |   
0 |  |  | even number of identity digits |  |  |  |  |  |   
1 |  |  | odd number of identity digits |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For the 5G-GUTI, then bits 5 to 8 of octet 3 are coded as "1111", octet 4 through 6 contain the MCC and MNC values as specified below, octet 7 through 9 contain the AMF Region ID, the AMF Set ID and the AMF Pointer values and octet 10 through 13 contain the 5G-TMSI as defined in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
MCC, Mobile country code (octet 5, octet 6 bits 1 to 4) The MCC field is coded as in ITU-T Recommendation E.212 [42], annex A. |  |  |  |  |  |  |  |  |   
MNC, Mobile network code (octet 6 bits 5 to 8, octet 7) The coding of this field is the responsibility of each administration but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. If a network operator decides to use only two digits in the MNC, bits 5 to 8 of octet 6 shall be coded as "1111". The contents of the MCC and MNC digits are coded as octets 6 to 8 of the Temporary mobile group identity IE in figure 10.5.154 of 3GPP TS 24.008 [12]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
AMF Region ID (octet 8) This field contains the binary encoding of the AMF Region ID. Bit 8 of octet 7 is the most significant bit and bit 1 of octet 7 is the least significant bit. AMF Set ID (octet 9, octet 9 bits 7 to 8) This field contains the binary encoding of the AMF Set ID. Bit 8 of octet 8 is the most significant bit and bit 7 of octet 9 is the least significant bit. AMF Pointer (octet 10 bits 1 to 6) This field contains the binary encoding of the AMF Pointer. Bit 6 of octet 9 is the most significant bit and bit 1 of octet 9 is the least significant bit. 5G-TMSI (octet 11 to 14) Bit 8 of octet 11 is the most significant bit and bit 1 of octet 14 is the least significant bit. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Identity digit (octet 4 bits 5 to 8, octet 5 etc.) |  |  |  |  |  |  |  |  |   
For the IMEI, Identity digit field is coded using BCD coding. If the number of identity digits is even then bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111". The format of the IMEI is described in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For the IMEISV, Identity digit field is coded using BCD coding. Bits 5 to 8 of the last octet shall be filled with an end mark coded as "1111". The format of the IMEISV is described in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For the SUCI, bit 8 of octet 4 is spare and shall be coded as zero. Bits 5-7 of octet 4 contain the SUPI format and are coded as shown below. |  |  |  |  |  |  |  |  |   
SUPI format (octet 4, bits 5-7) Bits |  |  |  |  |  |  |  |  |   
7 | 6 | 5 |  |  |  |  |  |  |   
0 | 0 | 0 |  | IMSI |  |  |  |  |   
0 | 0 | 1 |  | Network Specific Identifier |  |  |  |  |   
All other values are interpreted as IMSI by this version of the protocol. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For the SUCI with SUPI format "IMSI", octets 5 through 7 contain the MCC and MNC values as specified below. For subsequent fields, bit 8 of octet 8 is the most significant bit and bit 1 of the last octet the least significant bit. The required fields for the SUCI are as defined in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
MCC, Mobile country code (octet 5, octet 6 bits 1 to 4) The MCC field is coded as in ITU-T Recommendation E.212 [42], annex A. |  |  |  |  |  |  |  |  |   
MNC, Mobile network code (octet 6 bits 5 to 8, octet 7) The coding of this field is the responsibility of each administration but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. If a network operator decides to use only two digits in the MNC, bits 5 to 8 of octet 6 shall be coded as "1111". The contents of the MCC and MNC digits are coded as octets 6 to 8 of the Temporary mobile group identity IE in figure 10.5.154 of 3GPP TS 24.008 [12]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Routing indicator (octets 8-9) Routing Indicator shall consist of 1 to 4 digits. The coding of this field is the responsibility of home network operator but BCD coding shall be used. If a network operator decides to assign less than 4 digits to Routing Indicator, the remaining digits shall be coded as "1111" and inserted at the left side to fill the 4 digits coding of Routing Indicator. If no Routing Indicator is configured in the USIM, the UE shall code the first digit of the Routing Indicator as "0000" and the remaining digits as â€œ1111". |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Protection scheme identifier (octet 10 bits 1 to 4) |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
4 | 3 | 2 | 1 |  |  |  |  |  |   
0 | 0 | 0 | 0 | Null scheme |  |  |  |  |   
0 | 0 | 0 | 1 | ECIES scheme profile A |  |  |  |  |   
0 | 0 | 1 | 0 | ECIES scheme profile B |  |  |  |  |   
0 | 0 | 1 | 1 |  |  |  |  |  |   
to | Reserved |  |  |  |  |  |  |  |   
1 | 0 | 1 | 1 |  |  |  |  |  |   
1 | 1 | 0 | 0 |  |  |  |  |  |   
to | Operator-specific protection scheme |  |  |  |  |  |  |  |   
1 | 1 | 1 | 1 |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Bits 5-8 of octet 10 are spare and shall be coded as zero. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Home network public key identifier (octet 10) |  |  |  |  |  |  |  |  |   
The Home network public key identifier (PKI) field is coded as defined in 3GPP TS 23.003 [4]. Home network public key identifier shall be coded as "00000000" when Protection scheme identifier is set to "0000" (i.e. Null scheme). |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  | Home network PKI value 0  
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  |   
to |  | Home network PKI value (1-254) |  |  |  |  |  |  |   
1 | 1 | 1 | 1 | 1 | 1 | 1 | 0 |  |   
1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |  | Reserved  
|  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Scheme output (octets 12 to x) The Scheme output field consists of a string of characters with a variable length or hexadecimal digits as specified in 3GPP TS 23.003 [4]. If Protection scheme identifier is set to "0000" (i.e. Null scheme), then the Scheme output consists of the MSIN and is coded using BCD coding with each digit of the MSIN coded over 4 bits. If the MSIN includes an odd number of digits, bits 5 to 8 of octet x shall be coded as "1111". If Protection scheme identifier is not "0000" (i.e. ECIES scheme profile A, ECIES scheme profile B or Operator-specific protection scheme), then Scheme output is coded as hexadecimal digits. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For the SUCI with SUPI format set to "Network specific identifier", the SUCI NAI field contains an NAI constructed as specified in subclause 28.7.3 of 3GPP TS 23.003 [4] and encoded as UTF-8 string. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For the 5G-S-TMSI, bits 5 to 8 of octet 4 are coded as "1111". The coding of the 5G-S-TMSI is left open for each administration. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
AMF Set ID (octet 5, octet 6 bits 7 to 8) This field contains the binary encoding of the AMF Set ID. Bit 8 of octet 5 is the most significant bit and bit 7 of octet 6 is the least significant bit. AMF Pointer (octet 6 bits 1 to 6) This field contains the binary encoding of the AMF Pointer. Bit 6 of octet 6 is the most significant bit and bit 1 of octet 6 is the least significant bit. 5G-TMSI (octet 7 to 10) Bit 8 of octet 7 is the most significant bit and bit 1 of octet 10 is the least significant bit. |  |  |  |  |  |  |  |  |   
For Type of identity "No identity", the length of mobile identity contents parameter shall be set to 1 and the bits 4-8 of octet 4 are spare and shall be coded as zero. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
NOTE: This can be used when the requested identity is not available at the UE during the identification procedure. |  |  |  |  |  |  |  |  |   
#### 9.11.3.5 5GS network feature support
The purpose of the 5GS network feature support information element is to
indicate whether certain features are supported by the network.
The 5GS network feature support information element is coded as shown in
figure 9.11.3.5.1 and table 9.11.3.5.1.
The 5GS network feature support is a type 4 information element with a minimum
length of 3 octets and a maximum length of 5 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5GS | octet | | | | | | | | | ne | 1 | | | | | | | | | twork | | | | | | | | | | fe | | | | | | | | | | ature | | | | | | | | | | su | | | | | | | | | | pport | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | 5GS | | | | | | | | | | ne | | | | | | | | | | twork | | | | | | | | | | fe | | | | | | | | | | ature | | | | | | | | | | su | | | | | | | | | | pport | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | MPSI | IWK | EMF | EMC | IMS- | IMS- | octet | | | | | N26 | | | VoPS- | VoPS | 3 | | | | | | | | N3GPP | -3GPP | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | MCSI | EMCN3 | octet | | | | | | | | | | 4 | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Spare | octet | | | | | | | | | | 5* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.5.1: 5GS network feature support information element
Table 9.11.3.5.1: 5GS network feature support information element
+----------------------------+---+---+---+----------------------------+ | IMS voice over PS session | | | | | | over 3GPP access indicator | | | | | | (IMS-VoPS-3GPP) (octet 3, | | | | | | bit 1) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates the | | | | | | support of IMS voice over | | | | | | PS session over 3GPP | | | | | | access | | | | | +----------------------------+---+---+---+----------------------------+ | (see NOTE 1) | | | | | +----------------------------+---+---+---+----------------------------+ | Bit | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | IMS voice over PS session | | | | | | not supported over 3GPP | | | | | | access | +----------------------------+---+---+---+----------------------------+ | 1 | | | | IMS voice over PS session | | | | | | supported over 3GPP access | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | IMS voice over PS session | | | | | | over non-3GPP access | | | | | | indicator (IMS-VoPS-N3GPP) | | | | | | (octet 3, bit 2) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates the | | | | | | support of IMS voice over | | | | | | PS session over non-3GPP | | | | | | access | | | | | +----------------------------+---+---+---+----------------------------+ | Bit | | | | | +----------------------------+---+---+---+----------------------------+ | 2 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | IMS voice over PS session | | | | | | not supported over | | | | | | non-3GPP access | +----------------------------+---+---+---+----------------------------+ | 1 | | | | IMS voice over PS session | | | | | | supported over non-3GPP | | | | | | access | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | Emergency service support | | | | | | indicator for 3GPP access | | | | | | (EMC) (octet 3, bit 3 and | | | | | | bit 4) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates the | | | | | | support of emergency | | | | | | services in 5GS for 3GPP | | | | | | access (see NOTE 2) | | | | | +----------------------------+---+---+---+----------------------------+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 4 | 3 | | | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | | | Emergency services not | | | | | | supported | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | | | Emergency services | | | | | | supported in NR connected | | | | | | to 5GCN only | +----------------------------+---+---+---+----------------------------+ | 1 | 0 | | | Emergency services | | | | | | supported in E-UTRA | | | | | | connected to 5GCN only | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | | | Emergency services | | | | | | supported in NR connected | | | | | | to 5GCN and E-UTRA | | | | | | connected to 5GCN | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | Emergency service fallback | | | | | | indicator for 3GPP access | | | | | | (EMF) (octet 3, bit 5 and | | | | | | bit 6) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates the | | | | | | support of emergency | | | | | | services fallback for 3GPP | | | | | | access (see NOTE 2) | | | | | +----------------------------+---+---+---+----------------------------+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 6 | 5 | | | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | | | Emergency services | | | | | | fallback not supported | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | | | Emergency services | | | | | | fallback supported in NR | | | | | | connected to 5GCN only | +----------------------------+---+---+---+----------------------------+ | 1 | 0 | | | Emergency services | | | | | | fallback supported in | | | | | | E-UTRA connected to 5GCN | | | | | | only | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | | | Emergency services | | | | | | fallback supported in NR | | | | | | connected to 5GCN and | | | | | | E-UTRA connected to 5GCN | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | Interworking without N26 | | | | | | interface indicator (IWK | | | | | | N26) (octet 3, bit 7) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates whether | | | | | | interworking without N26 | | | | | | interface is supported | | | | | +----------------------------+---+---+---+----------------------------+ | Bit | | | | | +----------------------------+---+---+---+----------------------------+ | 7 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | Interworking without N26 | | | | | | interface not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | Interworking without N26 | | | | | | interface supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | MPS indicator (MPSI) | | | | | | (octet 3, bit 8) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates the | | | | | | support of MPS in the | | | | | | RPLMN or equivalent PLMN. | | | | | +----------------------------+---+---+---+----------------------------+ | Bit | | | | | +----------------------------+---+---+---+----------------------------+ | 8 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | Access identity 1 not | | | | | | valid in RPLMN or | | | | | | equivalent PLMN | +----------------------------+---+---+---+----------------------------+ | 1 | | | | Access identity 1 valid in | | | | | | RPLMN or equivalent PLMN | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | Emergency service support | | | | | | for non-3GPP access | | | | | | indicator (EMCN3) (octet | | | | | | 4, bit 1) | | | | | | | | | | | | This bit indicates the | | | | | | support of emergency | | | | | | services in 5GS for | | | | | | non-3GPP access | | | | | | | | | | | | Bit (see NOTE 3) | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | Emergency services not | | | | | | supported over non-3GPP | | | | | | access | +----------------------------+---+---+---+----------------------------+ | 1 | | | | Emergency services | | | | | | supported over non-3GPP | | | | | | access | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | MCS indicator (MCSI) | | | | | | (octet 4, bit 2) | | | | | +----------------------------+---+---+---+----------------------------+ | This bit indicates the | | | | | | support of MCS in the | | | | | | RPLMN or equivalent PLMN. | | | | | +----------------------------+---+---+---+----------------------------+ | Bit | | | | | +----------------------------+---+---+---+----------------------------+ | 2 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | Access identity 2 not | | | | | | valid in RPLMN or | | | | | | equivalent PLMN | +----------------------------+---+---+---+----------------------------+ | 1 | | | | Access identity 2 valid in | | | | | | RPLMN or equivalent PLMN | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | Bits 3 to 8 in octets 4 | | | | | | and all bits in octet 5 | | | | | | are spare and shall be | | | | | | coded as zero, if the | | | | | | respective octet is | | | | | | included in the | | | | | | information element. | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | NOTE 1: For a registration | | | | | | procedure over non-3GPP | | | | | | access, bit 1 of octet 3 | | | | | | is ignored. | | | | | | | | | | | | NOTE 2: For a registration | | | | | | procedure over 3GPP | | | | | | access, bit 1 of octet 4 | | | | | | is ignored. | | | | | | | | | | | | NOTE 3: For a registration | | | | | | procedure over non-3GPP | | | | | | access, bits 3 to 6 of | | | | | | octet 3 are ignored. | | | | | +----------------------------+---+---+---+----------------------------+
#### 9.11.3.6 5GS registration result
The purpose of the 5GS registration result information element is to specify
the result of a registration procedure.
The 5GS registration result information element is coded as shown in figure
9.11.3.6.1 and table 9.11.3.6.1.
The 5GS registration result is a type 4 information element with a length of 3
octets.
+--------+--------+-------+-------+--------+--------+--------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------+--------+-------+-------+--------+--------+--------+---+---+ | 5GS | octet | | | | | | | | | regist | 1 | | | | | | | | | ration | | | | | | | | | | result | | | | | | | | | | IEI | | | | | | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+ | Length | octet | | | | | | | | | of 5GS | 2 | | | | | | | | | regist | | | | | | | | | | ration | | | | | | | | | | result | | | | | | | | | | _con | | | | | | | | | | tents_ | | | | | | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+ | 0 | 0 | 0 | 0 | SMS | 5GS | octet | | | | | | | | a | regist | 3 | | | | Spare | Spare | Spare | Spare | llowed | ration | | | | | | | | | | result | | | | | | | | | | value | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+
Figure 9.11.3.6.1: 5GS registration result information element
Table 9.11.3.6.1: 5GS registration result information element
* * *
5GS registration result value (octet 3, bits 1 to 3)  
Bits  
3 2 1  
0 0 1 3GPP access 0 1 0 Non-3GPP access 0 1 1 3GPP access and non-3GPP access
1 1 1 reserved
All other values are unused and shall be treated as \"3GPP access\", if
received by the UE.
SMS over NAS transport allowed (SMS allowed) (octet 3, bit 4)  
Bit  
4  
0 SMS over NAS not allowed 1 SMS over NAS allowed
Bits 5 to 8 of octet 3 are spare and shall be coded as zero.
* * *
#### 9.11.3.7 5GS registration type
The purpose of the 5GS registration type information element is to indicate
the type of the requested registration.
The 5GS registration type information element is coded as shown in figure
9.11.3.7.1 and table 9.11.3.7.1.
The 5GS registration type is a type 1 information element with a length of 1
octet.
* * *
8 7 6 5 4 3 2 1  
5GS registration type IEI FOR 5GS registration type value octet 1
* * *
Figure 9.11.3.7.1: 5GS registration type information element
Table 9.11.3.7.1: 5GS registration type information element
* * *
5GS registration type value (octet 1, bits 1 to 3)  
Bits  
3 2 1  
0 0 1 initial registration 0 1 0 mobility registration updating 0 1 1 periodic
registration updating 1 0 0 emergency registration 1 1 1 reserved
All other values are unused and shall be interpreted as \"initial
registration\", if received by the network.
Follow-on request bit (FOR) (octet 1, bit 4)  
Bit  
4  
0 No follow-on request pending 1 Follow-on request pending
* * *
#### 9.11.3.8 5GS tracking area identity
The purpose of the 5GS tracking area identity information element is to
provide an unambiguous identification of tracking areas within the area
covered by the 5GS.
The 5GS tracking area identity information element is coded as shown in figure
9.11.3.8.1 and table 9.11.3.8.1.
The 5GS tracking area identity is a type 3 information element with a length
of 7 octets.
* * *
8 7 6 5 4 3 2 1  
5GS tracking area identity IEI octet 1  
MCC digit 2 MCC digit 1 octet 2  
MNC digit 3 MCC digit 3 octet 3  
MNC digit 2 MNC digit 1 octet 4  
TAC octet 5  
TAC (continued) octet 6  
TAC (continued) octet 7
* * *
Figure 9.11.3.8.1: 5GS tracking area identity information element
Table 9.11.3.8.1: 5GS tracking area identity information element
+----------------------------------------------------------------------+ | MCC, Mobile country code (octets 2 and 3) | | | | The MCC field is coded as in ITU-T Rec. E212 [39], annex A. | | | | If the TAI is deleted the MCC and MNC shall take the value from the | | deleted TAI. | | | | In abnormal cases, the MCC stored in the UE can contain elements not | | in the set {0, 1 ... 9}. In such cases the UE should transmit the | | stored values using full hexadecimal encoding. When receiving such | | an MCC, the network shall treat the TAI as deleted. | | | | MNC, Mobile network code (octet 3 bits 5 to 8, octet 4) | | | | The coding of this field is the responsibility of each | | administration, but BCD coding shall be used. The MNC shall consist | | of 2 or 3 digits. For PCS 1900 for NA, Federal regulation mandates | | that a 3-digit MNC shall be used. However, a network operator may | | decide to use only two digits in the MNC in the TAI over the radio | | interface. In this case, bits 5 to 8 of octet 3 shall be coded as | | \"1111\". Mobile equipment shall accept a TAI coded in such a way. | | | | In abnormal cases, the MNC stored in the UE can have: | | | | - digit 1 or 2 not in the set {0, 1 ... 9}, or | | | | - digit 3 not in the set {0, 1 ... 9, F} hex. | | | | In such cases the UE shall transmit the stored values using full | | hexadecimal encoding. When receiving such an MNC, the network shall | | treat the TAI as deleted. | | | | The same handling shall apply for the network, if a 3-digit MNC is | | sent by the UE to a network using only a 2-digit MNC. | | | | TAC, Tracking area code (octets 5 to 7) | | | | In the TAC field bit 8 of octet 5 is the most significant bit and | | bit 1 of octet 7 the least significant bit. | | | | The coding of the tracking area code is the responsibility of each | | administration except that two values are used to mark the TAC, and | | hence the TAI, as deleted. Coding using full hexadecimal | | representation may be used. The tracking area code consists of 3 | | octets. | | | | If a TAI has to be deleted, then all bits of the tracking area code | | shall be set to one with the exception of the least significant bit | | which shall be set to zero. If a USIM is inserted in a mobile | | equipment with the tracking area code containing all zeros, then the | | mobile equipment shall recognise this TAC as part of a deleted TAI. | +----------------------------------------------------------------------+
#### 9.11.3.9 5GS tracking area identity list
The purpose of the 5GS _tracking area identity list_ information element is to
transfer a list of tracking areas from the network to the UE.
The coding of the information element allows combining different types of
lists. The lists of type \"00\" and \"01\" allow a more compact encoding, when
the different TAIs are sharing the PLMN identity.
The 5GS _tracking area identity list_ information element is coded as shown in
figure 9.11.3.8.1, figure 9.11.3.8.2, figure 9.11.3.9.3, figure 9.11.3.9.4 and
table 9.11.3.9.1.
The 5GS _tracking area identity list_ is a type 4 information element, with a
minimum length of 9 octets and a maximum length of 114 octets. The list can
contain a maximum of 16 different tracking area identities.
+----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | 5GS tracking area identity list IEI | octet 1 | | | | | | | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of 5GS tracking area identity list contents | octet 2 | | | | | | | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Partial tracking area identity list 1 | octet 3 | | | | | | | | | | | | | | | | | | | | octet i | | | | | | | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Partial tracking area identity list 2 | octet i+1* | | | | | | | | | | | | | | | | | | | | octet l* | | | | | | | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet l+1* | | | | | | | | | | | | | | | | | | | | octet m* | | | | | | | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+ | Partial tracking area identity list p | octet m+1* | | | | | | | | | | | | | | | | | | | | octet n* | | | | | | | | +----------------------------------------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.9.1: 5GS tracking area identity list information element
+-------------------+--------------+--------------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | 0 | Type of list | Number of elements | octet 1 | | | | | | | | | | | | | | | | | Spare | | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet 2 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet 3 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet 4 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 | octet 5 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 (continued) | octet 6 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 (continued) | octet 7 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | ... | ... | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | ... | ... | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC k | octet 3k+2* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC k (continued) | octet 3k+3* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC k (continued) | octet 3k+4* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+
Figure 9.11.3.9.2: Partial tracking area identity list -- type of list =
\"00\"
+-------------------+--------------+--------------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | 0 | Type of list | Number of elements | octet 1 | | | | | | | | | | | | | | | | | Spare | | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet 2 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet 3 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet 4 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 | octet 5 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 (continued) | octet 6 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 (continued) | octet 7 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+
Figure 9.11.3.9.3: Partial tracking area identity list -- type of list =
\"01\"
+-------------------+--------------+--------------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | 0 | Type of list | Number of elements | octet 1 | | | | | | | | | | | | | | | | | Spare | | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet 2 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet 3 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet 4 | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 | octet 5 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 (continued) | octet 6 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 1 (continued) | octet 7 | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet 8* | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet 9* | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet 10* | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 2 | octet 11* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 2 (continued) | octet 12* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC 2 (continued) | octet 13* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | ... | | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | ... | | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet 6k-4* | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet 6k-3* | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet 6k-2* | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC k | octet 6k-1* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC k (continued) | octet 6k* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+ | TAC k (continued) | octet 6k+1* | | | | | | | | +-------------------+--------------+--------------------+---------+---+---+---+---+---+
Figure 9.11.3.9.4: Partial tracking area identity list -- type of list =
\"10\"
Table 9.11.3.9.1: Tracking area identity list information element
* * *
Value part of the Tracking area identity list information element (octets 3 to
n)
The value part of the Tracking area identity list information element consists
of one or several partial tracking area identity lists. The length of each
partial tracking area identity list can be determined from the \'type of
list\' field and the \'number of elements\' field in the first octet of the
partial tracking area identity list.  
The UE shall store the complete list received. If more than 16 TAIs are
included in this information element, the UE shall store the first 16 TAIs and
ignore the remaining octets of the information element.
Partial tracking area identity list:
Type of list (octet 1)  
Bits  
7 6  
0 0 list of TACs belonging to one PLMN, with non-consecutive TAC values  
0 1 list of TACs belonging to one PLMN, with consecutive TAC values  
1 0 list of TAIs belonging to different PLMNs (see NOTE)
All other values are reserved.
Number of elements (octet 1)  
Bits  
5 4 3 2 1  
0 0 0 0 0 1 element 0 0 0 0 1 2 elements 0 0 0 1 0 3 elements ...  
0 1 1 0 1 14 elements 0 1 1 1 0 15 elements 0 1 1 1 1 16 elements
All other values are unused and shall be interpreted as 16, if received by the
UE.
Bit 8 of octet 1 is spare and shall be coded as zero.
For type of list = \"00\" and number of elements = k:
octet 2 to 4 contain the MCC+MNC, and  
for j = 1, ..., k:  
octets 3j+2 to 3j+4 contain the TAC of the j-th TAI belonging to the partial
list,
For type of list = \"01\" and number of elements = k:
octet 2 to 4 contain the MCC+MNC, and  
octets 5 to 7 contain the TAC of the first TAI belonging to the partial list.  
The TAC values of the other k-1 TAIs are TAC+1, TAC+2, ..., TAC+k-1.
For type of list = \"10\" and number of elements = k:
for j = 1, ..., k.  
octets 6j-4 to 6j-2 contain the MCC+MNC, and  
octets 6j-1 to 6j+1 contain the TAC of the j-th TAI belonging to the partial
list.
MCC, Mobile country code
The MCC field is coded as in ITU-T Recommendation E.212 [42], annex A.
MNC, Mobile network code
The coding of this field is the responsibility of each administration but BCD
coding shall be used. The MNC shall consist of 2 or 3 digits. If a network
operator decides to use only two digits in the MNC, MNC digit 3 shall be coded
as \"1111\".
TAC, Tracking area code
In the TAC field bit 8 of the first octet is the most significant bit and bit
1 of third octet the least significant bit.  
The coding of the tracking area code is the responsibility of each
administration. Coding using full hexadecimal representation may be used. The
tracking area code consists of 3 octets.
NOTE: If the \"list of TAIs belonging to different PLMNs\" is used, the PLMNs
included in the list need to be present in the list of \"equivalent PLMNs\".
* * *
#### 9.11.3.9A 5GS update type
The purpose of the 5GS update type IE is to allow the UE to provide additional
information to the network when performing a registration procedure.
The 5GS update type information element is coded as shown in figure
9.11.3.9A.1 and table 9.11.3.9A.1.
The 5GS update type is a type 4 information element.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5GS | octet | | | | | | | | | u | 1 | | | | | | | | | pdate | | | | | | | | | | type | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | 5GS | | | | | | | | | | u | | | | | | | | | | pdate | | | | | | | | | | type | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | NG-RA | SMS | octet | | | | | | | | N-RCU | requ | 3 | | Spare | Spare | Spare | Spare | Spare | Spare | | ested | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.9A.1: 5GS update type information element
Table 9.11.3.9A.1: 5GS update type information element
* * *
SMS over NAS transport requested (SMS requested) (octet 3, bit 1)  
Bit  
1  
0 SMS over NAS not supported 1 SMS over NAS supported
NG-RAN Radio Capability Update (NG-RAN-RCU) (octet 3, bit 2)  
Bits  
2  
0 NG-RAN radio capability update not needed 1 NG-RAN radio capability update
needed
Bits 3 to 8 of octet 3 are spare and shall be coded as zero.
* * *
#### 9.11.3.10 ABBA
The purpose of the ABBA information element is to enable the bidding down
protection of security features.
The ABBA information element is coded as shown in figure 9.11.3.10.1 and table
9.11.3.10.1.
The ABBA is a type 4 information element with a minimum length of 4 octets.
+-------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=========================+=========+===+===+===+===+===+===+===+ | ABBA IEI | octet 1 | | | | | | | | +-------------------------+---------+---+---+---+---+---+---+---+ | Length of ABBA contents | octet 2 | | | | | | | | +-------------------------+---------+---+---+---+---+---+---+---+ | ABBA contents | octet 3 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-------------------------+---------+---+---+---+---+---+---+---+
Figure 9.11.3.10.1: ABBA information element
Table 9.11.3.10.1: ABBA information element
+----------------------------------------------------------------------+ | ABBA contents (octet 3-n): | | | | indicate set of security features defined for 5GS as described in | | 3GPP TS 33.501 [24]. | +----------------------------------------------------------------------+ | NOTE 1: If the UE receives the ABBA IE with a length that is set to | | a value of 2 and with a value of 0000H, the UE shall use the length | | and the contents of the ABBA IE as received from the network. | | | | NOTE 2: If the UE receives the ABBA IE with a length that is set to | | a value larger than 2 or with a value that is different from 0000H, | | the UE shall use the length and the contents of the ABBA IE as | | received from the network. | +----------------------------------------------------------------------+
#### 9.11.3.11 Access type
The purpose of the access type information element is to indicate the access
type over which the downlink signalling or user data is pending to be sent to
the UE.
The access type is a type 1 information element.
The access type information element is coded as shown in figure 9.11.3.11.1
and table 9.11.3.11.1.
+-------------+-------+-------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------+-------+-------------+---------+---+---+---+---+---+ | Access type | 0 | Access type | octet 1 | | | | | | | | | | | | | | | | | IEI | spare | | | | | | | | +-------------+-------+-------------+---------+---+---+---+---+---+
Figure 9.11.3.11.1: Access type information element
Table 9.11.3.11.1: Access type information element
* * *
Access type value (octet 1, bit 1 to bit 2)
Bits  
2 1  
0 1 3GPP access 1 0 Non-3GPP access
All other values are reserved.
* * *
#### 9.11.3.12 Additional 5G security information
The purpose of the Additional 5G security information information element is
to provide the UE with additional security parameters (e.g. horizontal
derivation parameter) or to request the UE to retransmit an initial NAS
message during a security mode control procedure as defined in 3GPP TS 33.501
[24]. The UE uses these parameters for completion of security mode control
procedure.
The Additional 5G security parameters information element is coded as shown in
figure 9.11.3.12.1 and table 9.11.3.12.1.
The Additional 5G security parameters is a type 4 information element with a
length of 3 octets.
+-------+-------+-------+-------+-------+-------+-------+-----+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+ | Addit | octet | | | | | | | | | ional | 1 | | | | | | | | | 5G | | | | | | | | | | sec | | | | | | | | | | urity | | | | | | | | | | param | | | | | | | | | | eters | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | Addit | | | | | | | | | | ional | | | | | | | | | | 5G | | | | | | | | | | sec | | | | | | | | | | urity | | | | | | | | | | param | | | | | | | | | | eters | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | RINMR | HDP | octet | | | | | | | | | | 3 | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+
Figure 9.11.3.12.1: Additional 5G security parameters information element
Table 9.11.3.12.1: Additional 5G security parameters information element
* * *
Horizontal derivation parameter (HDP) (octet 3, bit 1)  
0 K~AMF~ derivation is not required 1 K~AMF~ derivation is required
Retransmission of initial NAS message request (octet 3, bit 2)  
0 Retransmission of the initial NAS message not requested 1 Retransmission of
the initial NAS message requested
Bits 3 to 8 of octet 3 are spare and shall be coded as zero.
* * *
#### 9.11.3.13 Allowed PDU session status
The purpose of the Allowed PDU session status information element is to
indicate to the network user-plane resources of PDU sessions associated with
non-3GPP access that are allowed to be re-established over 3GPP access or if
there is no PDU session(s) for which the UE allows the user-plane resources to
be re-established over 3GPP access.
The Allowed PDU session status information element is coded as shown in figure
9.11.3.13.1 and table 9.11.3.13.1.
The Allowed PDU session status is a type 4 information element with minimum
length of 4 octets and maximum length of 34 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Al | octet | | | | | | | | | lowed | 1 | | | | | | | | | PDU | | | | | | | | | | se | | | | | | | | | | ssion | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | Al | | | | | | | | | | lowed | | | | | | | | | | PDU | | | | | | | | | | se | | | | | | | | | | ssion | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 3 | | (7) | (6) | (5) | (4) | (3) | (2) | (1) | (0) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 4 | | \ | \ | \ | \ | \ | \ | (9) | (8) | | | (15) | (14) | (13) | (12) | (11) | (10) | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Spare | octet | | | | | | | | | | 5* | | | | | | | | | | -34* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.13.1: Allowed PDU session status information element
Table 9.11.3.13.1: Allowed PDU session status information element
+----------------------------------------------------------------------+ | PSI(x) shall be coded as follows: | | | | PSI(0): | | | | Bit 1octet 3 is spare and shall be coded as zero. | | | | PSI(1) -- PSI(15): | | | | 0 indicates that the user-plane resources of corresponding PDU | | session is not allowed to be re-established over 3GPP access. | | | | 1 indicates that the user-plane resources of corresponding PDU | | session can be re-established over 3GPP access. | | | | If there is no PDU session for which the user-plane resources can be | | re-established over 3GPP access, all bits in PSI(1) -- PSI(15) shall | | be coded as zero. | | | | All bits in octet 5 to 34 are spare and shall be coded as zero, if | | the respective octet is included in the information element. | +----------------------------------------------------------------------+
#### 9.11.3.14 Authentication failure parameter
See subclause 10.5.3.2.2 in 3GPP TS 24.008 [12].
#### 9.11.3.15 Authentication parameter AUTN
See subclause 10.5.3.1.1 in 3GPP TS 24.008 [12].
#### 9.11.3.16 Authentication parameter RAND
See subclause 10.5.3.1 in 3GPP TS 24.008 [12].
#### 9.11.3.17 Authentication response parameter
See subclause 9.9.3.4 in 3GPP TS 24.301 [15].
#### 9.11.3.18 Configuration update indication
The purpose of the Configuration update indication information element is to
indicate the additional information associated with the generic UE
configuration update procedure.
The Configuration update indication information element is coded as shown in
figure 9.11.3.18.1 and table 9.11.3.18.1.
The Configuration update indication is a type 1 information element.
+-------------------------------------+-------+-------+-----+-----+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=====================================+=======+=======+=====+=====+=========+===+===+===+ | Configuration update indication IEI | 0 | 0 | RED | ACK | octet 1 | | | | | | | | | | | | | | | | Spare | Spare | | | | | | | +-------------------------------------+-------+-------+-----+-----+---------+---+---+---+
Figure 9.11.3.18.1: Configuration update indication
Table 9.11.3.18.1: Configuration update indication
Acknowledgement (ACK) value (octet 1, bit 1)
* * *
Bit  
1  
0 acknowledgement not requested 1 acknowledgement requested
Registration requested (RED) value (octet 1, bit 2)  
Bit  
2  
0 registration not requested 1 registration requested
Bits 3 and 4 are spare and shall be coded as zero,
#### 9.11.3.19 Daylight saving time
See subclause 10.5.3.12 in 3GPP TS 24.008 [12].
#### 9.11.3.20 De-registration type
The purpose of the D _e-registration type_ information element is to indicate
the type of de-registration.
The D _e-registration type_ information element is coded as shown in figure
9.11.3.20.1 and table 9.11.3.20.1.
The D _e-registration type_ is a type 1 information element.
+----------------------+--------+--------------------------+-------------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------+--------+--------------------------+-------------+---------+---+---+---+---+ | De-registration type | Switch | Re-registration required | Access type | octet 1 | | | | | | | | | | | | | | | | IEI | off | | | | | | | | +----------------------+--------+--------------------------+-------------+---------+---+---+---+---+
Figure 9.11.3.20.1: Deregistration type information element
Table 9.11.3.20.1: _Deregistration_ type information element
* * *
Switch off (octet 1, bit 4)  
In the UE to network direction:  
Bit  
4  
0 Normal de-registration 1 Switch off
In the network to UE direction bit 4 is spare. The network shall set this bit
to zero.
Re-registration required (octet 1, bit 3)
In the network to UE direction:  
Bit  
3  
0 re-registration not required 1 re-registration required
In the UE to network direction bit 3 is spare. The UE shall set this bit to
zero.
Access type (octet 1,bit 2, bit 1)  
Bit  
2 1  
0 1 3GPP access 1 0 Non-3GPP access 1 1 3GPP access and non-3GPP access
All other values are reserved.
* * *
#### 9.11.3.21 Void
#### 9.11.3.22 Void
#### 9.11.3.23 Emergency number list
See subclause 10.5.3.13 in 3GPP TS 24.008 [12].
#### 9.11.3.23A EPS bearer context status
See subclause 9.9.2.1 in 3GPP TS 24.301 [15].
#### 9.11.3.24 EPS NAS message container
The purpose of the EPS NAS message container information element is to
transport an EPS NAS message as specified in 3GPP TS 24.301 [15].
The EPS NAS message container information element is coded as shown in figure
9.11.3.24.1 and table 9.11.3.24.1.
The EPS NAS message container is a type 6 information element.
+----------------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------------------------------+---------+---+---+---+---+---+---+---+ | EPS NAS message container IEI | octet 1 | | | | | | | | +----------------------------------------------+---------+---+---+---+---+---+---+---+ | Length of EPS NAS message container contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +----------------------------------------------+---------+---+---+---+---+---+---+---+ | EPS NAS message container | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +----------------------------------------------+---------+---+---+---+---+---+---+---+
Figure 9.11.3.24.1: EPS NAS message container information element
Table 9.11.3.24.1: EPS NAS message container information element
* * *
EPS NAS message container (octet 4 to n) An EPS NAS message as specified in
3GPP TS 24.301 [15].
* * *
#### 9.11.3.25 EPS NAS security algorithms
See subclause 9.9.3.23 in 3GPP TS 24.301 [15].
#### 9.11.3.26 Extended emergency number list
See subclause 9.9.3.37A in 3GPP TS 24.301 [15].
#### 9.11.3.27 Void
#### 9.11.3.28 IMEISV request
See subclause 10.5.5.10 in 3GPP TS 24.008 [12].
#### 9.11.3.29 LADN indication
The purpose of the LADN indication information element is to request the
network for LADN information for specific LADN DNN(s) or to indicate a request
for LADN information.
The LADN indication information element is coded as shown in figure
9.11.3.29.1 and table 9.11.3.29.1.
The LADN indication is a type 6 information element with a minimum length of 3
octets and a maximum length of 811 octets.
The LADN indication information element can contain a minimum of 0 and a
maximum of 8 different LADN DNN values.
+------------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN indication IEI | octet 1 | | | | | | | | +------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of LADN indication contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN DNN value 1 | octet 4* | | | | | | | | | | | | | | | | | | | | octet a* | | | | | | | | +------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN DNN value 2 | octet a+1* | | | | | | | | | | | | | | | | | | | | octet b* | | | | | | | | +------------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet b+1* | | | | | | | | | | | | | | | | | | | | octet g* | | | | | | | | +------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN DNN value n | octet g+1* | | | | | | | | | | | | | | | | | | | | octet h* | | | | | | | | +------------------------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.29.1: LADN indication information element
Table 9.11.3.29.1: LADN indication information element
+----------------------------------------------------------------------+ | Value part of the LADN indication information element (octet 4 to | | h): | | | | The value part of the LADN indication information element consists | | of zero or more LADN DNN values. If the LADN indication information | | element conveys more than 8 LADN DNN values in this information | | element, the network shall consider the first 8 LADN DNN values and | | ignore the remaining octets of the information element. | | | | LADN DNN value: | | | | LADN DNN value is coded as the length and value part of DNN | | information element as specified in subclause 9.11.2.1A starting | | with the second octet. | +----------------------------------------------------------------------+
#### 9.11.3.30 LADN information
The purpose of the LADN information information element is to provide the UE
with the LADN service area for each available LADN in the current registration
area or to delete the LADN information at the UE.
The LADN information information element is coded as shown in figure
9.11.3.30.1, figure 9.11.3.30.2 and table 9.11.3.30.1.
The LADN information is a type 6 information element with a minimum length of
3 octets and a maximum length of 1715 octets.
The LADN information information element can contain a minimum of 0 and a
maximum of 8 different LADNs each including a DNN and a 5GS tracking area
identity list.
+-------------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN information IEI | octet 1 | | | | | | | | +-------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of LADN information contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +-------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +-------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN 2 | octet a+1* | | | | | | | | | | | | | | | | | | | | octet b* | | | | | | | | +-------------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet b+1* | | | | | | | | | | | | | | | | | | | | octet g* | | | | | | | | +-------------------------------------+-------------+---+---+---+---+---+---+---+ | LADN n | octet g+1* | | | | | | | | | | | | | | | | | | | | octet h* | | | | | | | | +-------------------------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.30.1: LADN information information element
+---------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=================================+===========+===+===+===+===+===+===+===+ | Length of DNN value | octet 4 | | | | | | | | +---------------------------------+-----------+---+---+---+---+---+---+---+ | DNN value | octet 5 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +---------------------------------+-----------+---+---+---+---+---+---+---+ | 5GS tracking area identity list | octet m+1 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +---------------------------------+-----------+---+---+---+---+---+---+---+
Figure 9.11.3.30.2: LADN
Table 9.11.3.30.1: LADN information information element
+----------------------------------------------------------------------+ | Value part of the LADN information information element (octet 4 to | | octet h) | | | | The value part of the LADN information information element consists | | of one or several LADNs. Each LADN (e.g. octet 4 to octet a) | | consists one DNN value and one 5GS tracking area identity list. The | | length of each LADN is determined by the length of DNN value field | | and the length of 5GS tracking area identity list field. | | | | The UE shall store the complete list as received. If more than 8 | | LADNs are included in this information element, the UE shall store | | the first 8 LADNs and ignore the remaining octets of the information | | element. | | | | DNN value (octet 5 to octet m): | | | | DNN value field is coded as DNN value part of DNN information | | element as specified in subclause 9.11.2.1A starting with the third | | octet. | +----------------------------------------------------------------------+ | 5GS tracking area identity list (octet m+1 to octet a): | +----------------------------------------------------------------------+ | 5GS tracking area identity list field is coded as the length and the | | value part of the 5GS Tracking area identity list information | | element as specified in subclause 9.11.3.9 starting with the second | | octet. | +----------------------------------------------------------------------+
#### 9.11.3.31 MICO indication
The purpose of the MICO indication information element is to indicate the use
of MICO mode or the re-negotiation of MICO mode.
The MICO indication information element is coded as shown in figure
9.11.3.31.1 and table 9.11.3.31.1.
The MICO indication is a type 1 information element.
+---------------------+-------+-------+-------+------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=====================+=======+=======+=======+======+=========+===+===+===+ | MICO indication IEI | 0 | 0 | 0 | RAAI | octet 1 | | | | | | | | | | | | | | | | Spare | Spare | Spare | | | | | | +---------------------+-------+-------+-------+------+---------+---+---+---+
Figure 9.11.3.31.1: MICO indication
Table 9.11.3.31.1: MICO indication
+----------------------------------+----------------------------------+ | Registration Area Allocation | | | Indication (RAAI) (octet 1) | | +==================================+==================================+ | | | +----------------------------------+----------------------------------+ | In the network to UE direction: | | +----------------------------------+----------------------------------+ | Bit | | +----------------------------------+----------------------------------+ | 1 | | +----------------------------------+----------------------------------+ | 0 | all PLMN registration area not | | | allocated | +----------------------------------+----------------------------------+ | 1 | all PLMN registration area | | | allocated | +----------------------------------+----------------------------------+ | In the UE to network direction | | | bit 1 is spare. The UE shall set | | | this bit to zero. | | +----------------------------------+----------------------------------+ | Bits 2, 3 and 4 are spare and | | | shall be coded as zero. | | | | | | NOTE: In the network to UE | | | direction in the CONFIGURATION | | | UPDATE COMMAND message, bit 1 | | | shall be coded as zero. | | +----------------------------------+----------------------------------+
#### 9.11.3.32 NAS key set identifier
The NAS key set identifier is allocated by the network.
The NAS key set identifier information element is coded as shown in figure
9.11.3.32.1 and table 9.11.3.32.1.
The NAS key set identifier is a type 1 information element.
* * *
8 7 6 5 4 3 2 1  
NAS key set identifier IEI TSC NAS key set identifier octet 1
* * *
Figure 9.11.3.32.1: NAS key set identifier information element
Table 9.11.3.32.1: NAS key set identifier information element
* * *
Type of security context flag (TSC) (octet 1)
Bit  
4  
0 native security context (for KSI~AMF~) 1 mapped security context (for
KSI~ASME~)
TSC does not apply for NAS key set identifier value \"111\".
NAS key set identifier (octet 1)
Bits  
3 2 1  
0 0 0  
through possible values for the NAS key set identifier  
1 1 0
1 1 1 no key is available (UE to network); reserved (network to UE)
* * *
#### 9.11.3.33 NAS message container
The purpose of the NAS message container IE is to encapsulate a plain 5GS NAS
message.
The NAS message container information element is coded as shown in figure
9.11.3.33.1 and table 9.11.3.33.1.
The NAS message container is a type 6 information element.
* * *
8 7 6 5 4 3 2 1  
NAS message container IEI octet 1  
Length of NAS message container contents octet 2  
octet 3  
octet 4  
NAS message container contents  
octet n
* * *
Figure 9.11.3.33.1: NAS message container information element
Table 9.11.3.33.1: NAS message container information element
* * *
NAS message container contents (octet 4 to octet n); Max value of 65535 octets
This IE can contain a REGISTRATION REQUEST message as defined in subclause
5.5.1, or a SERVICE REQUEST message as defined in subclause 5.6.1.
* * *
#### 9.11.3.34 NAS security algorithms
The purpose of the NAS security algorithms information element is to indicate
the 5G algorithms to be used for ciphering and integrity protection.
The NAS security algorithms information element is coded as shown in figure
9.11.3.34.1 and table 9.11.3.34.1.
The NAS security algorithms is a type 3 information element with a length of 2
octets.
* * *
8 7 6 5 4 3 2 1  
NAS security algorithms IEI octet 1  
Type of ciphering algorithm Type of integrity protection algorithm octet 2
* * *
Figure 9.11.3.34.1: NAS security algorithms information element
Table 9.11.3.34.1: NAS security algorithms information element
* * *
Type of integrity protection algorithm (octet 2, bit 1 to 3)  
Bits  
4 3 2 1  
0 0 0 0 5G integrity algorithm 5G-IA0 (null integrity protection algorithm) 0
0 0 1 5G integrity algorithm 128-5G-IA1 0 0 1 0 5G integrity algorithm
128-5G-IA2 0 0 1 1 5G integrity algorithm 128-5G-IA3 0 1 0 0 5G integrity
algorithm 5G-IA4 0 1 0 1 5G integrity algorithm 5G-IA5 0 1 1 0 5G integrity
algorithm 5G-IA6 0 1 1 1 5G integrity algorithm 5G-IA7
All other values are reserved.
Type of ciphering algorithm (octet 2, bit 5 to 7)  
Bits  
8 7 6 5  
0 0 0 0 5G encryption algorithm 5G-EA0 (null ciphering algorithm) 0 0 0 1 5G
encryption algorithm 128-5G-EA1 0 0 1 0 5G encryption algorithm 128-5G-EA2 0 0
1 1 5G encryption algorithm 128-5G-EA3 0 1 0 0 5G encryption algorithm 5G-EA4
0 1 0 1 5G encryption algorithm 5G-EA5 0 1 1 0 5G encryption algorithm 5G-EA6
0 1 1 1 5G encryption algorithm 5G-EA7
All other values are reserved.
* * *
#### 9.11.3.35 Network name
See subclause 10.5.3.5a in 3GPP TS 24.008 [12].
#### 9.11.3.36 Network slicing indication
The purpose of the Network slicing indication information element is to
indicate additional information associated with network slicing in the generic
UE configuration update procedure and the registration procedure, other than
the user\'s configured NSSAI, allowed NSSAI and rejected NSSAI information.
The Network slicing indication information element is coded as shown in figure
9.11.3.36.1 and table 9.11.3.36.1.
The Network slicing indication is a type 1 information element.
+--------------------------------+-------+-------+------+-------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +================================+=======+=======+======+=======+=========+===+===+===+ | Network slicing indication IEI | 0 | 0 | DCNI | NSSCI | octet 1 | | | | | | | | | | | | | | | | Spare | Spare | | | | | | | +--------------------------------+-------+-------+------+-------+---------+---+---+---+
Figure 9.11.3.36.1: Network slicing indication
Table 9.11.3.36.1: Network slicing indication
+----------------------------------+----------------------------------+ | Network slicing subscription | | | change indication (NSSCI) (octet | | | 1, bit 1) | | +==================================+==================================+ | Bit | | +----------------------------------+----------------------------------+ | 1 | | +----------------------------------+----------------------------------+ | 0 | Network slicing subscription not | | | changed | +----------------------------------+----------------------------------+ | 1 | Network slicing subscription | | | changed | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | Default configured NSSAI | | | indication (DCNI) (octet 1, bit | | | 2) | | +----------------------------------+----------------------------------+ | Bit | | +----------------------------------+----------------------------------+ | 2 | | +----------------------------------+----------------------------------+ | 0 | Requested NSSAI not created from | | | default configured NSSAI | +----------------------------------+----------------------------------+ | 1 | Requested NSSAI created from | | | default configured NSSAI | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | In the UE to network direction | | | bit 1 is spare. The UE shall set | | | this bit to zero. | | | | | | In the network to UE direction | | | bit 2 is spare. The network | | | shall set this bit to zero. | | | | | | Bits 3 and 4 are spare and shall | | | be coded as zero. | | +----------------------------------+----------------------------------+
#### 9.11.3.36A Non-3GPP NW provided policies
See subclause 10.5.5.37 in 3GPP TS 24.008 [12].
#### 9.11.3.37 NSSAI
The purpose of the NSSAI information element is to identify a collection of
S-NSSAIs
The NSSAI information element is coded as shown in figure 9.11.3.37.1 and
table 9.11.3.37.1.
The NSSAI is a type 4 information element with a minimum length of 4 octets
and a maximum length of 146 octets.
NOTE 1: The number of S-NSSAI values in a requested NSSAI or allowed NSSAI
cannot exceed eight.
NOTE 2: The number of S-NSSAI values in a configured NSSAI cannot exceed
sixteen.
NOTE 3: More than one S-NSSAIs in an NSSAI can have the same SST values, and
optionally same SD values, which are associated with different mapped HPLMN
SST values and optionally mapped HPLMN SD values.
* * *
8 7 6 5 4 3 2 1
* * *
NSSAI IEI octet 1
Length of NSSAI contents octet 2
S-NSSAI value 1 octet 3\  
\  
octet m
S-NSSAI value 2 octet m+1*\  
\  
octet n*
... octet n+1*\  
\  
octet u*
S-NSSAI value n octet u+1*\  
\  
octet v*
* * *
Figure 9.11.3.37.1: NSSAI information element
Table 9.11.3.37.1: NSSAI information element
+----------------------------------------------------------------------+ | Value part of the NSSAI information element (octet 3 to v) | | | | The value part of the NSSAI information element consists of one or | | more S-NSSAI values. Each S-NSSAI value consists of one S-NSSAI and | | optionally one mapped S-NSSAI. | | | | If the recipient of this information element is the UE, the UE shall | | store the complete list received. If the NSSAI information element | | conveys an allowed NSSAI and more than 8 S-NSSAI values are included | | in this information element, the UE shall store the first 8 S-NSSAI | | values and ignore the remaining octets of the information element. | | | | If the NSSAI information element conveys a configured NSSAI and more | | than 16 S-NSSAI values are included in this information element, the | | UE shall store the first 16 S-NSSAI values and ignore the remaining | | octets of the information element. | | | | S-NSSAI value: | | | | S-NSSAI value is coded as the length and value part of S-NSSAI | | information element as specified in subclause 9.11.2.8 starting with | | the second octet. | +----------------------------------------------------------------------+
#### 9.11.3.37A NSSAI inclusion mode
The purpose of the NSSAI inclusion mode information element is to indicate the
NSSAI inclusion mode in which the UE shall operate.
The NSSAI inclusion mode is a type 1 information element.
The NSSAI inclusion mode information element is coded as shown in figure
9.11.3.37A.1 and table 9.11.3.37A.1.
+----------------------+-------+-------+----------------------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------+-------+-------+----------------------+---------+---+---+---+---+ | NSSAI inclusion mode | 0 | 0 | NSSAI inclusion mode | octet 1 | | | | | | | | | | | | | | | | IEI | spare | spare | | | | | | | +----------------------+-------+-------+----------------------+---------+---+---+---+---+
Figure 9.11.3.37A.1: NSSAI inclusion mode information element
Table 9.11.3.37A.1: NSSAI inclusion mode information element
* * *
NSSAI inclusion mode (octet 1, bit 1 to bit 2)
Bits  
2 1  
0 0 NSSAI inclusion mode A 0 1 NSSAI inclusion mode B 1 0 NSSAI inclusion mode
C 1 1 NSSAI inclusion mode D
* * *
#### 9.11.3.38 Operator-defined access category definitions
The purpose of the Operator-defined access category definitions information
element is to provide the UE with the operator-defined access category
definitions or to delete the operator-defined access category definitions at
the UE.
The Operator-defined access category definitions information element is coded
as shown in figure 9.11.3.38.1, figure 9.11.3.38.2 and table 9.11.3.38.1.
The Operator-defined access category definitions is a type 6 information
element with a minimum length of 3 octets.
+---------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------------+-------------+---+---+---+---+---+---+---+ | Operator-defined | octet 1 | | | | | | | | | access category | | | | | | | | | | definitions IEI | | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | Length of | octet 2 | | | | | | | | | operator-defined | | | | | | | | | | access category | octet 3 | | | | | | | | | definitions | | | | | | | | | | contents | | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | Operator-defined | octet 4 | | | | | | | | | access category | | | | | | | | | | definition 1 | octet a | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | Operator-defined | octet a+1* | | | | | | | | | access category | | | | | | | | | | definition 2 | octet b* | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | ... | octet b+1* | | | | | | | | | | | | | | | | | | | | octet g* | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+ | Operator-defined | octet g+1* | | | | | | | | | access category | | | | | | | | | | definition 1 n | octet h* | | | | | | | | +---------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.38.1: Operator-defined access category definitions information
element
+----------+----------+-------+----------+----------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========+==========+=======+==========+==========+===+===+===+===+ | Length | octet 4 | | | | | | | | | of | | | | | | | | | | operator | | | | | | | | | | -defined | | | | | | | | | | access | | | | | | | | | | category | | | | | | | | | | de | | | | | | | | | | finition | | | | | | | | | | contents | | | | | | | | | +----------+----------+-------+----------+----------+---+---+---+---+ | Pr | octet 5 | | | | | | | | | ecedence | | | | | | | | | | value | | | | | | | | | +----------+----------+-------+----------+----------+---+---+---+---+ | PSAC | 0 | 0 | Operator | octet 6 | | | | | | | | | -defined | | | | | | | | Spare | Spare | access | | | | | | | | | | category | | | | | | | | | | number | | | | | | +----------+----------+-------+----------+----------+---+---+---+---+ | Length | octet 7 | | | | | | | | | of | | | | | | | | | | criteria | | | | | | | | | +----------+----------+-------+----------+----------+---+---+---+---+ | Criteria | octet 8 | | | | | | | | | | | | | | | | | | | | octet | | | | | | | | | | a-1 | | | | | | | | +----------+----------+-------+----------+----------+---+---+---+---+ | 0 | 0 | 0 | Stan | octet | | | | | | | | | dardized | a* | | | | | | Spare | Spare | Spare | access | | | | | | | | | | category | | | | | | +----------+----------+-------+----------+----------+---+---+---+---+
Figure 9.11.3.38.2: Operator-defined access category definition
Table 9.11.3.38.1: Operator-defined access category definitions information
element
Value part of the Operator-defined access category definitions information element (octet 3 to h) The value part of the Operator-defined access category definitions information element consists of zero or several operator-defined access category definition fields. Each operator-defined access category definition field is coded as described in figure 9.11.3.38.2. The length of each operator-defined access category definition field is determined by the length of operator-defined access category definition contents field. |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
Operator-defined access category definition (octet 4 to octet a): |  |  |  |  |  |  |  |  |   
Precedence value (octet 5) |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  | Precedence value 0  
to |  |  |  |  |  |  |  |  |   
1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |  | Precedence value 255  
|  |  |  |  |  |  |  |  |   
Operator-defined access category number (bits 5 to 1 of octet 6) |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
5 | 4 | 3 | 2 | 1 |  |  |  |  |   
0 | 0 | 0 | 0 | 0 |  | Access category number 32 |  |  |   
to |  |  |  |  |  |  |  |  |   
1 | 1 | 1 | 1 | 1 |  | Access category number 63 |  |  |   
|  |  |  |  |  |  |  |  |   
Presence of standardized access category (PSAC) (bit 8 of octet 6) |  |  |  |  |  |  |  |  |   
PSAC field indicates whether the standardized access category field is present or absent. |  |  |  |  |  |  |  |  |   
Bit |  |  |  |  |  |  |  |  |   
8 |  |  |  |  |  |  |  |  |   
0 | Standardized access category field is not included |  |  |  |  |  |  |  |   
1 | Standardized access category field is included |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Length of criteria (octet 7) |  |  |  |  |  |  |  |  |   
Length of criteria field indicates binary coded length of the criteria field. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Criteria (octets 8 to octet a-1) |  |  |  |  |  |  |  |  |   
The criteria field contains one or more criteria components fields. Each criteria component field shall be encoded as a sequence of a one octet criteria type field and zero or more octets criteria value field. The criteria type field shall be transmitted first. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Criteria type |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  | DNN type  
0 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |  | OS id + OS App Id type  
0 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |  | S-NSSAI type  
All other values are reserved. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "DNN type", the criteria value field shall be encoded as a sequence of one octet DNN length-value pair count field and one or more DNN length-value pair fields. The DNN length-value pair count field indicates the number of included DNN length-value pair fields. Each DNN length-value pair field is coded as a sequence of one octet DNN value length field and a DNN value field. The DNN value length field indicates the length in octets of the DNN value field. The DNN value field contains an APN as specified in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "OS Id + OS App Id type", the criteria value field shall be encoded as a sequence of one octet app id value count field and one or more app id value fields. The app id value count field indicates the number of included app id value fields. Each app id value field is coded as a sequence of a sixteen octet OS id value field, one octet OS app id value length field and an OS app id value field. The OS app id value length field indicates the length in octets of the OS app id value field. The OS id value field contains a Universally Unique IDentifier (UUID) as specified in IETF RFC 4122 [35A]. The OS app id value field contains an OS specific application identifier. Coding of the OS app id value field is out of scope of the present document. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
For "S-NSSAI type", the criteria value field shall be encoded as a sequence of one octet S-NSSAI length-value pair count field and one or more S-NSSAI length-value value fields. The S-NSSAI length-value pair count field indicates the number of included S-NSSAI length-value pair fields. Each S-NSSAI length-value pair field is coded as a sequence of one octet S-NSSAI value length field and an S-NSSAI value field. The S-NSSAI value length field indicates the length in octets of the S-NSSAI value field. The S-NSSAI value field contains one octet SST field optionally followed by three octets SD field. The SST field contains a SST. The SD field contains an SD. SST and SD are specified in 3GPP TS 23.003 [4]. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Standardized access category (bits 5 to 1 of octet a) |  |  |  |  |  |  |  |  |   
Standardized access category field indicates the access category number of the standardized access category that is used in combination with the access identities to determine the establishment cause. |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
5 | 4 | 3 | 2 | 1 |  |  |  |  |   
0 | 0 | 0 | 0 | 0 |  | Access category number 0 |  |  |   
to |  |  |  |  |  |  |  |  |   
0 | 0 | 1 | 1 | 1 |  | Access category number 7 |  |  |   
All other values are reserved. |  |  |  |  |  |  |  |  |   
#### 9.11.3.39 Payload container
The purpose of the Payload container information element is to transport one
or multiple payloads. If multiple payloads are transported, the associated
information of each payload are also transported together with the payload.
The Payload container information element is coded as shown in figure
9.11.3.39.1, figure 9.11.3.39.2, figure 9.11.3.39.3, figure 9.11.3.39.4 and
table 9.11.3.39.1.
The Payload container is a type 6 information element with a minimum length of
4 octets and a maximum length of 65538 octets.
8 7 6 5 4 3 2 1
* * *
Payload container IEI octet 1  
Length of payload container contents octet 2  
octet 3  
octet 4  
Payload container contents  
octet n
Figure 9.11.3.39.1: Payload container information element
+---------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +===========================+=============+===+===+===+===+===+===+===+ | Number of entries | octet 4 | | | | | | | | +---------------------------+-------------+---+---+---+---+---+---+---+ | Payload container entry 1 | octet 5 | | | | | | | | | | | | | | | | | | | | octet x2 | | | | | | | | +---------------------------+-------------+---+---+---+---+---+---+---+ | Payload container entry 2 | octet x2+1 | | | | | | | | | | | | | | | | | | | | octet x3 | | | | | | | | +---------------------------+-------------+---+---+---+---+---+---+---+ | ...... | ... | | | | | | | | +---------------------------+-------------+---+---+---+---+---+---+---+ | Payload container entry i | octet xi +1 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +---------------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.39.2: Payload container contents with Payload container type
\"Multiple payloads\"
+-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +===================================+========================+=============+===+===+===+===+===+===+ | Length of Payload container entry | octet xi +1 | | | | | | | | | | | | | | | | | | | | octet xi +2 | | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | Number of optional IEs | Payload container type | octet xi +3 | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | Optional IE 1 | octet xi +4 | | | | | | | | | | | | | | | | | | | | octet y2 | | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | Optional IE 2 | octet y2+1 | | | | | | | | | | | | | | | | | | | | octet y3 | | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | ... | | | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | Optional IE j | octet yj+1 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+ | Payload container entry contents | octet z+1 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-----------------------------------+------------------------+-------------+---+---+---+---+---+---+
Figure 9.11.3.39.3: Payload container entry
+-----------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=======================+=============+===+===+===+===+===+===+===+ | Type of optional IE | octet xi +4 | | | | | | | | +-----------------------+-------------+---+---+---+---+---+---+---+ | Length of optional IE | octet xi +5 | | | | | | | | +-----------------------+-------------+---+---+---+---+---+---+---+ | Value of optional IE | octet xi +6 | | | | | | | | | | | | | | | | | | | | octet y2 | | | | | | | | +-----------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.39.4: Optional IE
Table 9.11.3.39.1: Payload container information element
+----------------------+----------------------+----------------------+ | Payload container | | | | contents (octet 4 to | | | | octet n); max value | | | | of 65535 octets | | | +======================+======================+======================+ | If the payload | | | | container type is | | | | set to \"SOR | | | | transparent | | | | container\" and is | | | | included in the DL | | | | NAS TRANSPORT | | | | message, the payload | | | | container contents | | | | are coded the same | | | | way as the contents | | | | of the SOR | | | | transparent | | | | container IE (see | | | | subclause 9.11.3.51) | | | | for SOR data type is | | | | set to value \"0\" | | | | except that the | | | | first three octets | | | | are not included. | | | | | | | | If the payload | | | | container type is | | | | set to \"SOR | | | | transparent | | | | container\" and is | | | | included in the UL | | | | NAS TRANSPORT | | | | message, the payload | | | | container contents | | | | are coded the same | | | | way as the contents | | | | of the SOR | | | | transparent | | | | container IE (see | | | | subclause 9.11.3.51) | | | | for SOR data type is | | | | set to value \"1\" | | | | except that the | | | | first three octets | | | | are not included. | | | | | | | | If the payload | | | | container type is | | | | set to \"UE | | | | parameters update | | | | transparent | | | | container\" and is | | | | included in the DL | | | | NAS TRANSPORT | | | | message, the payload | | | | container contents | | | | are coded the same | | | | way as the contents | | | | of the UE parameters | | | | update transparent | | | | container IE (see | | | | s | | | | ubclause 9.11.3.53A) | | | | for UE parameters | | | | update data type is | | | | set to value \"1\" | | | | except that the | | | | first three octets | | | | are not included. | | | | | | | | If the payload | | | | container type is | | | | set to \"UE | | | | parameters update | | | | transparent | | | | container\" and is | | | | included in the UL | | | | NAS TRANSPORT | | | | message, the payload | | | | container contents | | | | are coded the same | | | | way as the contents | | | | of the UE parameters | | | | update transparent | | | | container IE (see | | | | s | | | | ubclause 9.11.3.53A) | | | | for UE parameters | | | | update data type is | | | | set to value \"0\" | | | | except that the | | | | first three octets | | | | are not included. | | | | | | | | The coding of | | | | Payload container | | | | contents is | | | | dependent on the | | | | particular | | | | application. | | | | | | | | If the payload | | | | container type is | | | | set to \"Multiple | | | | payloads\", the | | | | number of entries | | | | field represents the | | | | total number of | | | | payload container | | | | entries, and the | | | | payload container | | | | contents field is | | | | coded as a list of | | | | payload container | | | | entry according to | | | | figure 9.11.3.39.2, | | | | with each payload | | | | container entry is | | | | coded according to | | | | figure 9.11.3.39.3 | | | | and | | | | figure 9.11.3.39.4. | | | +----------------------+----------------------+----------------------+ | Payload container | | | | entry | | | | | | | | For each payload | | | | container entry, the | | | | payload container | | | | type field | | | | represents the | | | | payload container | | | | type value as | | | | described in | | | | subclause 9.11.3.40, | | | | the coding of | | | | payload container | | | | entry contents field | | | | is dependent on the | | | | particular | | | | application, and the | | | | number of optional | | | | IEs field represents | | | | the total number of | | | | optional IEs | | | | associated with the | | | | payload container | | | | entry contents field | | | | in the payload | | | | container entry. | | | +----------------------+----------------------+----------------------+ | Optional IEs | | | | | | | | Type of optional IE | | | | (octet xi +4) | | | | | | | | This field contains | | | | the IEI of the | | | | optional IE. | | | | | | | | Length of optional | | | | IE (octet xi+5) | | | | | | | | This field indicates | | | | binary coded length | | | | of the value of the | | | | optional IE entry. | | | | | | | | Value of optional IE | | | | (octet xi+6 to octet | | | | y2) | | | | | | | | This field contains | | | | the value of the | | | | optional IE entry | | | | with the value part | | | | of the referred | | | | information element | | | | based on following | | | | optional IE | | | | reference. If the | | | | Request type is | | | | included, the value | | | | part of the Request | | | | type shall be | | | | encoded in the bits | | | | 1 to 4 and bits 5 to | | | | 8 shall be coded as | | | | zero. | | | +----------------------+----------------------+----------------------+ | IEI | Optional IE name | Optional IE | | | | reference | +----------------------+----------------------+----------------------+ | 12 | PDU session ID | PDU session identity | | | | 2 (see | | | | subclause 9.11.3.41) | +----------------------+----------------------+----------------------+ | 24 | Additional | Additional | | | information | information (see | | | | subclause 9.11.2.1) | +----------------------+----------------------+----------------------+ | 58 | 5GMM cause | 5GMM cause (see | | | | subclause 9.11.3.2) | +----------------------+----------------------+----------------------+ | 37 | Back-off timer value | GPRS timer 3 (see | | | | subclause 9.11.2.5) | +----------------------+----------------------+----------------------+ | 59 | Old PDU session ID | PDU session identity | | | | (see subclause 2 | | | | 9.11.3.41) | +----------------------+----------------------+----------------------+ | 80 | Request type | Request type (see | | | | subclause 9.11.3.47) | +----------------------+----------------------+----------------------+ | 22 | S-NSSAI | S-NSSAI (see | | | | subclause 9.11.2.8) | +----------------------+----------------------+----------------------+ | 25 | DNN | DNN (see | | | | subclause 9.11.2.1A) | +----------------------+----------------------+----------------------+ | | | | +----------------------+----------------------+----------------------+ | The coding of | | | | payload container | | | | entry contents is | | | | dependent on the | | | | particular | | | | application. | | | +----------------------+----------------------+----------------------+ | | | | +----------------------+----------------------+----------------------+
#### 9.11.3.40 Payload container type
The purpose of the Payload container type information element indicates type
of payload included in the payload container information element.
The Payload container information element is coded as shown in figure
9.11.3.40.1 and table 9.11.3.40.1.
The Payload container is a type 1 information element.
+------------------------+------------------------------+---------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +========================+==============================+=========+===+===+===+===+===+===+ | Payload container type | Payload container type value | octet 1 | | | | | | | | | | | | | | | | | | IEI | | | | | | | | | +------------------------+------------------------------+---------+---+---+---+---+---+---+
Figure 9.11.3.40.1: Payload container information element
Table 9.11.3.40.1: Payload container information element
Payload container type value (octet 1)
* * *
Bits  
4 3 2 1  
0 0 0 1 N1 SM information 0 0 1 0 SMS 0 0 1 1 LTE Positioning Protocol (LPP)
message container 0 1 0 0 SOR transparent container 0 1 0 1 UE policy
container 0 1 1 0 UE parameters update transparent container 1 1 1 1 Multiple
payloads
All other values are reserved.
NOTE: The value \"Multiple payloads\" is only used when the Payload container
contents in figure 9.11.3.39.1 contains multiple payloads as shown in figure
9.11.3.39.2.
#### 9.11.3.41 PDU session identity 2
The purpose of the PDU session identity 2 information element is to indicate
the identity of a PDU session in a 5GMM message.
The PDU session identity 2 information element is coded as shown in figure
9.11.3.41.1 and table 9.11.3.41.1.
The PDU session identity 2 is a type 3 information element with a length of 2
octets .
8 7 6 5 4 3 2 1
* * *
PDU session identity 2 IEI octet 1  
PDU session identity 2 value octet 2
Figure 9.11.3.41.1: PDU session identity 2 information element
Table 9.11.3.41.1: PDU session identity 2 information element
+----------------------------------------------------------------------+ | PDU session identity 2 value (octet 2) | | | | The coding of the DU session identity 2 value is identical to the | | coding of the PDU session identity value as defined in | | 3GPP TS 24.007 [11] . | +----------------------------------------------------------------------+
#### 9.11.3.42 PDU session reactivation result
The purpose of the PDU session reactivation result information element is to
indicate the result of establishments of user-plane resources of PDU sessions.
The PDU session reactivation result information element is coded as shown in
figure 9.11.3.42.1 and table 9.11.3.42.1.
The PDU session reactivation result is a type 4 information element with
minimum length of 4 octets and maximum length of 34 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PDU | octet | | | | | | | | | se | 1 | | | | | | | | | ssion | | | | | | | | | | re | | | | | | | | | | activ | | | | | | | | | | ation | | | | | | | | | | r | | | | | | | | | | esult | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | PDU | | | | | | | | | | se | | | | | | | | | | ssion | | | | | | | | | | re | | | | | | | | | | activ | | | | | | | | | | ation | | | | | | | | | | r | | | | | | | | | | esult | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 3 | | (7) | (6) | (5) | (4) | (3) | (2) | (1) | (0) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 4 | | \ | \ | \ | \ | \ | \ | (9) | (8) | | | (15) | (14) | (13) | (12) | (11) | (10) | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | | octet | | | | | | | | | ----- | 5* | | | | | | | | | -- -- | -34* | | | | | | | | | - --- | | | | | | | | | | --- | | | | | | | | | | --- - | | | | | | | | | | -- -- | | | | | | | | | | - --- | | | | | | | | | | 0 | | | | | | | | | | | | | | | | | | | | 0 0 | | | | | | | | | | 0 | | | | | | | | | | 0 | | | | | | | | | | 0 | | | | | | | | | | 0 0 | | | | | | | | | | Sp | | | | | | | | | | are | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | ----- | | | | | | | | | | -- -- | | | | | | | | | | - --- | | | | | | | | | | --- | | | | | | | | | | --- - | | | | | | | | | | -- -- | | | | | | | | | | - --- | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.42.1: PDU session reactivation result information element
Table 9.11.3.42.1: PDU session reactivation result information element
+----------------------------------------------------------------------+ | PSI(x) shall be coded as follows: | | | | PSI(0): | | | | Bit 0 of octet 3 is spare and shall be coded as zero. | | | | PSI(1) -- PSI(15): | | | | 0 indicates establishment of user-plane resources of the PDU session | | was not requested in the Uplink data status IE or establishment of | | user-plane resources of the PDU session was not allowed in the | | Allowed PDU session status IE or establishment of user-plane | | resource of the PDU session is successful. | | | | 1 indicates either establishment of user-plane resources of the PDU | | session was requested in the Uplink data status IE but establishment | | of user-plane resource of the PDU session is not successful or | | indicates establishment of user-plane resources of the PDU session | | was allowed in the Allowed PDU session status IE but establishment | | of user-plane resource of the PDU session is either not performed or | | not successful. | | | | All bits in octet 5 to 34 are spare and shall be coded as zero, if | | the respective octet is included in the information element. | +----------------------------------------------------------------------+
#### 9.11.3.43 PDU session reactivation result error cause
The purpose of the PDU session reactivation result error cause information
element is to indicate error causes for PDU session ID(s) where there was a
failure to establish the user-plane resources.
The PDU session reactivation result error cause information element is coded
as shown in figure 9.11.3.43.1 and table 9.11.3.43.1.
The PDU session reactivation result error cause is a type 6 information
element with a minimum length of 5 octets and a maximum length of 515 octets.
* * *
8 7 6 5 4 3 2 1  
PDU session reactivation result error cause IEI octet 1  
Length of PDU session reactivation result error cause octet 2  
octet 3  
PDU session ID octet 4  
cause value octet 5
....
PDU session ID octet 514*  
cause value octet 515*
* * *
Figure 9.11.3.43.1: PDU session reactivation result error cause information
element
Table 9.11.3.43.1: PDU session reactivation result error cause information
element
+----------------------------------------------------------------------+ | PDU session ID is coded same as PDU session ID IE (see | | subclause 9.4). | | | | The cause value is coded same as second octet of 5GMM cause | | information element (see subclause 9.11.3.2). | +----------------------------------------------------------------------+
#### 9.11.3.44 PDU session status
The purpose of the PDU session status information element is to indicate the
state of each PDU session that can be identified by a PDU session identity.
The PDU session status information element is coded as shown in figure
9.11.3.44.1 and table 9.11.3.44.1.
The PDU session status information element is a type 4 information element
with minimum length of 4 octets and a maximum length of 34 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PDU | octet | | | | | | | | | se | 1 | | | | | | | | | ssion | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | PDU | | | | | | | | | | se | | | | | | | | | | ssion | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 3 | | (7) | (6) | (5) | (4) | (3) | (2) | (1) | (0) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 4 | | \ | \ | \ | \ | \ | \ | (9) | (8) | | | (15) | (14) | (13) | (12) | (11) | (10) | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet | | | | | | | | | | 5*- | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | spare | 34* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.44.1: PDU session status information element
Table 9.11.3.44.1: PDU session status information element
+----------------------------------------------------------------------+ | PSI(x) shall be coded as follows: | | | | PSI(0): | | | | Bit 1 of octet 3 is spare and shall be coded as zero. | | | | PSI(1) -- PSI(15): | | | | 0 indicates that the 5GSM state of the corresponding PDU session is | | PDU SESSION INACTIVE. | | | | 1 indicates that the 5GSM state of the corresponding PDU session is | | not PDU SESSION INACTIVE | | | | All bits in octet 5 to 34 are spare and shall be coded as zero, if | | the respective octet is included in the information element. | +----------------------------------------------------------------------+
#### 9.11.3.45 PLMN list
See subclause 10.5.1.13 in 3GPP TS 24.008 [12].
#### 9.11.3.46 Rejected NSSAI
The purpose of the Rejected NSSAI information element is to identify a
collection of rejected S-NSSAIs.
The Rejected NSSAI information element is coded as shown in figure
9.11.3.46.1, figure 9.11.3.46.2 and table 9.11.3.46.1.
The Rejected NSSAI is a type 4 information element with a minimum length of 4
octets and a maximum length of 42 octets.
NOTE: The number of rejected S-NSSAI(s) cannot exceed eight.
* * *
8 7 6 5 4 3 2 1
* * *
Rejected NSSAI IEI octet 1
Length of Rejected NSSAI contents octet 2
Rejected S-NSSAI 1 octet 3\  
\  
octet m
Rejected S-NSSAI 2 octet m+1*\  
\  
octet n*
... octet n+1*\  
\  
octet u*
Rejected S-NSSAI n octet u+1*\  
\  
octet v*
* * *
Figure 9.11.3.46.1: Rejected NSSAI information element
+----------------------------+-------------+---------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +============================+=============+=========+===+===+===+===+===+===+ | Length of rejected S-NSSAI | Cause value | octet 1 | | | | | | | +----------------------------+-------------+---------+---+---+---+---+---+---+ | SST | octet 2 | | | | | | | | +----------------------------+-------------+---------+---+---+---+---+---+---+ | SD | octet 3* | | | | | | | | | | | | | | | | | | | | octet 5* | | | | | | | | +----------------------------+-------------+---------+---+---+---+---+---+---+
Figure 9.11.3.46.2: Rejected S-NSSAI
Table 9.11.3.46.1: Rejected NSSAI information element
* * *
Value part of the Rejected NSSAI information element (octet 3 to v)
The value part of the Rejected NSSAI information element consists of one or
more rejected S-NSSAIs. Each rejected S-NSSAI consists of one S-NSSAI and an
associated cause value. The length of each rejected S-NSSAI can be determined
by the \'length of rejected S-NSSAI\' field in the first octet of the rejected
S-NSSAI.  
The UE shall store the complete list received. If more than 8 rejected
S-NSSAIs are included in this information element, the UE shall store the
first 8 rejected S-NSSAIs and ignore the remaining octets of the information
element.
Rejected S-NSSAI:
Cause value (octet 1)  
Bits  
4 3 2 1  
0 0 0 0 S-NSSAI not available in the current PLMN 0 0 0 1 S-NSSAI not
available in the current registration area All other values are reserved.
Slice/service type (SST) (octet 2)  
This field contains the 8 bit SST value. The coding of the SST value part is
defined in 3GPP TS 23.003 [4].
Slice differentiator (SD) (octet 3 to octet 5)  
This field contains the 24 bit SD value. The coding of the SD value part is
defined in 3GPP TS 23.003 [4].  
NOTE: If octet 3 is included, then octet 4 and octet 5 shall be included.
* * *
#### 9.11.3.47 Request type
The purpose of the Request type information element is to indicate the type of
the 5GSM message.
The Request type information element is coded as shown in figure 9.11.3.47.1
and table 9.11.3.47.1.
The Request type is a type 1 information element.
+------------------+-------+--------------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------+-------+--------------------+---------+---+---+---+---+---+ | Request type IEI | 0 | Request type value | octet 1 | | | | | | | | | | | | | | | | | | spare | | | | | | | | +------------------+-------+--------------------+---------+---+---+---+---+---+
Figure 9.11.3.47.1: Request type information element
Table 9.11.3.47.1: Request type information element
Request type value (octet 1, bit 1 to bit 4)
* * *
Bits  
3 2 1  
0 0 1 initial request 0 1 0 existing PDU session 0 1 1 initial emergency
request 1 0 0 existing emergency PDU session 1 0 1 modification request 1 1 1
reserved All other values are unused and shall be interpreted as \"initial
request\", if received by the network.
#### 9.11.3.48 S1 UE network capability
See subclause 9.9.3.34 in 3GPP TS 24.301 [15].
#### 9.11.3.48A S1 UE security capability
See subclause 9.9.3.36 in 3GPP TS 24.301 [15].
#### 9.11.3.49 Service area list
The purpose of the _Service area list_ information element is to transfer a
list of allowed tracking areas for an allowed area or a list of non-allowed
tracking areas for a non-allowed area from the network to the UE.
The coding of the information element allows combining different types of
lists. The lists of type \"00\" and \"01\" allow a more compact encoding, when
the different TAIs are sharing the PLMN identity. The lists of type \"11\"
indicate all TAIs of the PLMNs in the registration area are allowed area.
The _Service area list_ information element is coded as shown in figure
9.11.3.49.1, figure 9.11.3.49.2, figure 9.11.3.49.3, figure 9.11.3.49.4,
figure 9.11.3.49.5 and table 9.11.3.49.1.
The _Service area list_ is a type 4 information element with a minimum length
of 6 octets and a maximum length of 114 octets. The list can contain a maximum
of 16 different tracking area identities.
+--------------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Service area list IEI | octet 1 | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Length of service area list contents | octet 2 | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Partial service area list 1 | octet 3 | | | | | | | | | | | | | | | | | | | | octet i | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Partial service area list 2 | octet i+1* | | | | | | | | | | | | | | | | | | | | octet l* | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet l+1* | | | | | | | | | | | | | | | | | | | | octet m* | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+ | Partial service area list p | octet m+1* | | | | | | | | | | | | | | | | | | | | octet n* | | | | | | | | +--------------------------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.49.1: Service area list information element
* * *
8 7 6 5 4 3 2 1  
Allowed type Type of list Number of elements octet 1  
MCC digit 2 MCC digit 1 octet 2  
MNC digit 3 MCC digit 3 octet 3  
MNC digit 2 MNC digit 1 octet 4  
TAC 1 octet 5  
TAC 1 (continued) octet 6  
TAC 1 (continued) octet 7  
... ...  
TAC k octet 3k+2*  
TAC k (continued) octet 3k+3*  
TAC k (continued) octet 3k+4*
* * *
Figure 9.11.3.49.2: Partial service area list -- type of list = \"00\"
* * *
8 7 6 5 4 3 2 1  
Allowed type Type of list Number of elements octet 1  
MCC digit 2 MCC digit 1 octet 2  
MNC digit 3 MCC digit 3 octet 3  
MNC digit 2 MNC digit 1 octet 4  
TAC 1 octet 5  
TAC 1 (continued) octet 6  
TAC 1 (continued) octet 7
* * *
Figure 9.11.3.49.3: Partial service area list -- type of list = \"01\"
* * *
8 7 6 5 4 3 2 1  
Allowed type Type of list Number of elements octet 1  
MCC digit 2 MCC digit 1 octet 2  
MNC digit 3 MCC digit 3 octet 3  
MNC digit 2 MNC digit 1 octet 4  
TAC 1 octet 5  
TAC 1 (continued) octet 6  
TAC 1 (continued) octet 7  
MCC digit 2 MCC digit 1 octet 8*  
MNC digit 3 MCC digit 3 octet 9*  
MNC digit 2 MNC digit 1 octet 10*  
TAC 2 octet 11*  
TAC 2 (continued) octet 12*  
TAC 2 (continued) octet 13*  
...  
MCC digit 2 MCC digit 1 octet 6k-4*  
MNC digit 3 MCC digit 3 octet 6k-3*  
MNC digit 2 MNC digit 1 octet 6k-2*  
TAC k octet 6k*-1  
TAC k (continued) octet 6k*  
TAC k (continued) octet 6k+1*
* * *
Figure 9.11.3.49.4: Partial service area list -- type of list = \"10\"
* * *
8 7 6 5 4 3 2 1  
Allowed type Type of list Number of elements octet 1  
MCC digit 2 MCC digit 1 octet 2  
MNC digit 3 MCC digit 3 octet 3  
MNC digit 2 MNC digit 1 octet 4
* * *
Figure 9.11.3.49.5: Partial service area list -- type of list = \"11\"
Table 9.11.3.49.1: Service area list information element
+-----------------+---+-----------------+---+---+-------------+ | Value part of | | | | | | | the Service | | | | | | | area list | | | | | | | information | | | | | | | element (octets | | | | | | | 3 to n) | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | The value part | | | | | | | of the Service | | | | | | | area list | | | | | | | information | | | | | | | element | | | | | | | consists of one | | | | | | | or several | | | | | | | partial service | | | | | | | area lists. The | | | | | | | length of each | | | | | | | partial service | | | | | | | area list can | | | | | | | be determined | | | | | | | from the \'type | | | | | | | of list\' field | | | | | | | and the | | | | | | | \'number of | | | | | | | elements\' | | | | | | | field in the | | | | | | | first octet of | | | | | | | the partial | | | | | | | service area | | | | | | | list. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | The \"Allowed | | | | | | | type\" fields | | | | | | | in all the | | | | | | | partial service | | | | | | | area lists | | | | | | | shall have the | | | | | | | same value. For | | | | | | | allowed type | | | | | | | \"0\", TAIs | | | | | | | contained in | | | | | | | all partial | | | | | | | service area | | | | | | | lists are in | | | | | | | the allowed | | | | | | | area. For | | | | | | | allowed type | | | | | | | \"1\", TAIs | | | | | | | contained in | | | | | | | all partial | | | | | | | service area | | | | | | | lists are in | | | | | | | the non-allowed | | | | | | | area. | | | | | | | | | | | | | | The UE shall | | | | | | | store the | | | | | | | complete list | | | | | | | received. If | | | | | | | more than 16 | | | | | | | TAIs are | | | | | | | included in | | | | | | | this | | | | | | | information | | | | | | | element, the UE | | | | | | | shall store the | | | | | | | first 16 TAIs | | | | | | | and ignore the | | | | | | | remaining | | | | | | | octets of the | | | | | | | information | | | | | | | element. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Partial service | | | | | | | area list: | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Allowed type | | | | | | | (octet 1) | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Bit | | | | | | +-----------------+---+-----------------+---+---+-------------+ | 8 | | | | | | +-----------------+---+-----------------+---+---+-------------+ | 0 | | TAIs in the | | | | | | | list are in the | | | | | | | allowed area | | | | +-----------------+---+-----------------+---+---+-------------+ | 1 | | TAIs in the | | | | | | | list are in the | | | | | | | non-allowed | | | | | | | area | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Type of list | | | | | | | (octet 1) | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Bits | | | | | | +-----------------+---+-----------------+---+---+-------------+ | 7 | 6 | | | | | +-----------------+---+-----------------+---+---+-------------+ | 0 | 0 | list of TACs | | | | | | | belonging to | | | | | | | one PLMN, with | | | | | | | non-consecutive | | | | | | | TAC values | | | | +-----------------+---+-----------------+---+---+-------------+ | 0 | 1 | list of TACs | | | | | | | belonging to | | | | | | | one PLMN, with | | | | | | | consecutive TAC | | | | | | | values | | | | +-----------------+---+-----------------+---+---+-------------+ | 1 | 0 | list of TAIs | | | | | | | belonging to | | | | | | | different PLMNs | | | | | | | (see NOTE) | | | | +-----------------+---+-----------------+---+---+-------------+ | 1 | 1 | All TAIs | | | | | | | belonging to | | | | | | | the PLMNs in | | | | | | | the | | | | | | | registration | | | | | | | area are in the | | | | | | | allowed area | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Number of | | | | | | | elements (octet | | | | | | | 1) | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Bits | | | | | | +-----------------+---+-----------------+---+---+-------------+ | 5 | 4 | 3 | 2 | 1 | | +-----------------+---+-----------------+---+---+-------------+ | 0 | 0 | 0 | 0 | 0 | 1 element | +-----------------+---+-----------------+---+---+-------------+ | 0 | 0 | 0 | 0 | 1 | 2 elements | +-----------------+---+-----------------+---+---+-------------+ | 0 | 0 | 0 | 1 | 0 | 3 elements | +-----------------+---+-----------------+---+---+-------------+ | to | | | | | | +-----------------+---+-----------------+---+---+-------------+ | 0 | 1 | 1 | 0 | 1 | 14 elements | +-----------------+---+-----------------+---+---+-------------+ | 0 | 1 | 1 | 1 | 0 | 15 elements | +-----------------+---+-----------------+---+---+-------------+ | 0 | 1 | 1 | 1 | 1 | 16 elements | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | All other | | | | | | | values are | | | | | | | unused and | | | | | | | shall be | | | | | | | interpreted as | | | | | | | 16, if received | | | | | | | by the UE. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | For type of | | | | | | | list = \"00\" | | | | | | | and number of | | | | | | | elements = k: | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | octets 2 to 4 | | | | | | | contain the | | | | | | | MCC+MNC, and | | | | | | +-----------------+---+-----------------+---+---+-------------+ | for j = 1, ..., | | | | | | | k: | | | | | | +-----------------+---+-----------------+---+---+-------------+ | octets 3j+2 to | | | | | | | 3j+4 contain | | | | | | | the TAC of the | | | | | | | j-th TAI | | | | | | | belonging to | | | | | | | the partial | | | | | | | list, | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | For type of | | | | | | | list = \"01\" | | | | | | | and number of | | | | | | | elements = k: | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | octets 2 to 4 | | | | | | | contain the | | | | | | | MCC+MNC, and | | | | | | +-----------------+---+-----------------+---+---+-------------+ | octets 5 to 7 | | | | | | | contain the TAC | | | | | | | of the first | | | | | | | TAI belonging | | | | | | | to the partial | | | | | | | list. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | The TAC values | | | | | | | of the other | | | | | | | k-1 TAIs are | | | | | | | TAC+1, TAC+2, | | | | | | | ..., TAC+k-1. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | For type of | | | | | | | list = \"10\" | | | | | | | and number of | | | | | | | elements = k: | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | for j = 1, ..., | | | | | | | k. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | octets 6j-4 to | | | | | | | 6j-1 contain | | | | | | | the MCC+MNC, | | | | | | | and | | | | | | +-----------------+---+-----------------+---+---+-------------+ | octets 6j-1 to | | | | | | | 6j+1 contain | | | | | | | the TAC of the | | | | | | | j-th TAI | | | | | | | belonging to | | | | | | | the partial | | | | | | | list. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | For type of | | | | | | | list = \"11\": | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | Allowed type | | | | | | | shall be coded | | | | | | | as \"0\" and | | | | | | | number of | | | | | | | elements shall | | | | | | | be ignored, and | | | | | | | octets 2 to 4 | | | | | | +-----------------+---+-----------------+---+---+-------------+ | containing the | | | | | | | MCC+MNC can be | | | | | | | ignored. | | | | | | | | | | | | | | If allowed type | | | | | | | is coded as | | | | | | | \"1\", it shall | | | | | | | be interpreted | | | | | | | as \"0\". | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | MNC, Mobile | | | | | | | network code | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | The coding of | | | | | | | this field is | | | | | | | the | | | | | | | responsibility | | | | | | | of each | | | | | | | administration | | | | | | | but BCD coding | | | | | | | shall be used. | | | | | | | The MNC shall | | | | | | | consist of 2 or | | | | | | | 3 digits. If a | | | | | | | network | | | | | | | operator | | | | | | | decides to use | | | | | | | only two digits | | | | | | | in the MNC, MNC | | | | | | | digit 3 shall | | | | | | | be coded as | | | | | | | \"1111\". | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | TAC, Tracking | | | | | | | area code | | | | | | +-----------------+---+-----------------+---+---+-------------+ | | | | | | | +-----------------+---+-----------------+---+---+-------------+ | In the TAC | | | | | | | field bit 8 of | | | | | | | the first octet | | | | | | | is the most | | | | | | | significant bit | | | | | | | and bit 1 of | | | | | | | the third octet | | | | | | | the least | | | | | | | significant | | | | | | | bit. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | The coding of | | | | | | | the tracking | | | | | | | area code is | | | | | | | the | | | | | | | responsibility | | | | | | | of each | | | | | | | administration. | | | | | | | Coding using | | | | | | | full | | | | | | | hexadecimal | | | | | | | representation | | | | | | | may be used. | | | | | | | The tracking | | | | | | | area code | | | | | | | consists of 3 | | | | | | | octets. | | | | | | +-----------------+---+-----------------+---+---+-------------+ | NOTE: If the | | | | | | | \"list of TAIs | | | | | | | belonging to | | | | | | | different | | | | | | | PLMNs\" is | | | | | | | used, the PLMNs | | | | | | | included in the | | | | | | | list need to be | | | | | | | present in the | | | | | | | list of | | | | | | | equivalent | | | | | | | PLMNs. | | | | | | +-----------------+---+-----------------+---+---+-------------+
#### 9.11.3.50 Service type
The purpose of the service type information element is to specify the purpose
of the service request procedure.
The service type is a type 1 information element.
The service type information element is coded as shown in figure 9.11.3.50.1
and table 9.11.3.50.1.
+--------------+--------------------+---------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------+--------------------+---------+---+---+---+---+---+---+ | Service type | Service type value | octet 1 | | | | | | | | | | | | | | | | | | IEI | | | | | | | | | +--------------+--------------------+---------+---+---+---+---+---+---+
Figure 9.11.3.50.1: Service type information element
Table 9.11.3.50.1: Service type information element
* * *
Service type value (octet 1)
Service type value  
Bits  
4 3 2 1  
0 0 0 0 signalling 0 0 0 1 data 0 0 1 0 mobile terminated services 0 0 1 1
emergency services 0 1 0 0 emergency services fallback 0 1 0 1 high priority
access 0 1 1 0 elevated signalling 0 1 1 1 unused; shall be interpreted as
\"signalling\", if received by the network 1 0 0 0 unused; shall be
interpreted as \"signalling\", if received by the network 1 0 0 1 unused;
shall be interpreted as \"data\", if received by the network 1 0 1 0 unused;
shall be interpreted as \"data\", if received by the network 1 0 1 1 unused;
shall be interpreted as \"data\", if received by the network
All other values are reserved.
* * *
#### 9.11.3.50A SMS indication
The purpose of the SMS indication information element is to indicate that the
ability for the UE to use SMS over NAS has changed.
The SMS indication information element is coded as shown in figure
9.11.3.50A.1 and table 9.11.3.50A.1.
The SMS indication is a type 1 information element.
+--------------------+-------+-------+-------+-----+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +====================+=======+=======+=======+=====+=========+===+===+===+ | SMS indication IEI | 0 | 0 | 0 | SAI | octet 1 | | | | | | | | | | | | | | | | Spare | Spare | Spare | | | | | | +--------------------+-------+-------+-------+-----+---------+---+---+---+
Figure 9.11.3.50A.1: SMS indication
Table 9.11.3.50A.1: SMS indication
SMS availability indication (SAI) (octet 1)
* * *
Bit  
1  
0 SMS over NAS not available 1 SMS over NAS available
Bits 2, 3 and 4 are spare and shall be coded as zero,
#### 9.11.3.51 SOR transparent container
The purpose of the SOR transparent container information element in the
REGISTRATION ACCEPT message is to provide the list of preferred PLMN/access
technology combinations (or HPLMN indication that \'no change of the
\"Operator Controlled PLMN Selector with Access Technology\" list stored in
the UE is needed and thus no list of preferred PLMN/access technology
combinations is provided\') (see 3GPP TS 23.122 [5] annex C) and optional
acknowledgement request. The purpose of the SOR transparent container
information element in the REGISTRATION COMPLETE message is to indicate the UE
acknowledgement of successful reception of the SOR transparent container IE in
the REGISTRATION ACCEPT message.
NOTE: When used in NAS transport procedure, the contents of the SOR
transparent container information element in the Payload container IE of the
DL NAS TRANSPORT message are used to provide the list of preferred PLMN/access
technology combinations and optional acknowledgement request, and the contents
of the SOR transparent container information element in the Payload container
IE of the UL NAS TRANSPORT message are used to indicate the UE acknowledgement
of successful reception of the SOR transparent container IE in the DL NAS
TRANSPORT message.
The SOR transparent container information element is coded as shown in figure
9.11.3.51.1, figure 9.11.3.51.2, figure 9.11.3.51.3, figure 9.11.3.51.4,
figure 9.11.3.51.5, figure 9.11.3.51.6 and table 9.11.3.51.1.
The SOR transparent container is a type 6 information element with a minimum
length of 20 octets and a maximum length of 2048 octets.
+----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | SOR transparent container IEI | octet 1 | | | | | | | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | Length of SOR transparent container contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | SOR header | octet 4 | | | | | | | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | SOR-MAC-I~AUSF~ | octet 5-20 | | | | | | | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | Counter~SOR~ | octet 21-22 | | | | | | | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+ | Secured packet | octet 23* - 2048* | | | | | | | | +----------------------------------------------+---------------------+---+---+---+---+---+---+---+
Figure 9.11.3.51.1: SOR transparent container information element for list
type with value \"0\" and SOR data type with value \"0\"
+----------------------------------------------+------------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+ | SOR transparent container IEI | octet 1 | | | | | | | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+ | Length of SOR transparent container contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+ | SOR header | octet 4 | | | | | | | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+ | SOR-MAC-I~AUSF~ | octet 5-20 | | | | | | | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+ | Counter~SOR~ | octet 21-22 | | | | | | | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+ | PLMN ID and access technology list | octet 23*-102* | | | | | | | | +----------------------------------------------+------------------+---+---+---+---+---+---+---+
Figure 9.11.3.51.2: SOR transparent container information element for list
type with value \"1\" and SOR data type with value \"0\"
* * *
PLMN ID 1 octet 23*- 25* access technology identifier 1 octet 26*- 27* ...  
PLMN ID n octet 98*-100* access technology identifier n octet 101*-102*
* * *
Figure 9.11.3.51.3: PLMN ID and access technology list
+----------------------------------------------+--------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------------------------------+--------------+---+---+---+---+---+---+---+ | SOR transparent container IEI | octet 1 | | | | | | | | +----------------------------------------------+--------------+---+---+---+---+---+---+---+ | Length of SOR transparent container contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +----------------------------------------------+--------------+---+---+---+---+---+---+---+ | SOR header | octet 4 | | | | | | | | +----------------------------------------------+--------------+---+---+---+---+---+---+---+ | SOR-MAC-I~UE~ | octet 5 - 20 | | | | | | | | +----------------------------------------------+--------------+---+---+---+---+---+---+---+
Figure 9.11.3.51.4: SOR transparent container information element for SOR data
type with value \"1\"
+-------+-------+-------+-------+-----+-----------+-----------------+---------------+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-----+-----------+-----------------+---------------+---------+ | 0 | 0 | 0 | 0 | ACK | List type | List indication | SOR data type | octet 4 | | | | | | | | | | | | Spare | Spare | Spare | Spare | | | | | | +-------+-------+-------+-------+-----+-----------+-----------------+---------------+---------+
Figure 9.11.3.51.5: SOR header for SOR data type with value \"0\"
+-------+-------+-------+-------+-------+-------+-------+---------------+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+---------------+---------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | SOR data type | octet 4 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | | | +-------+-------+-------+-------+-------+-------+-------+---------------+---------+
Figure 9.11.3.51.6: SOR header for SOR data type with value \"1\"
Table 9.11.3.51.1: SOR transparent container information element
* * *
SOR-MAC-I~AUSF,~ SOR-MAC-I~UE~ and Counter~SOR~ are coded as specified in 3GPP
TS 33.501 [24]
SOR data type (octet 4, bit 1)  
0 The SOR transparent container carries steering of roaming information. 1 The
SOR transparent container carries acknowledgement of successful reception of
the steering of roaming information.
List indication value (octet 4, bit 2)  
0 HPLMN indication that \'no change of the \"Operator Controlled PLMN Selector
with Access Technology\" list stored in the UE is needed and thus no list of
preferred PLMN/access technology combinations is provided\' 1 list of
preferred PLMN/access technology combinations is provided
List type (octet 4, bit 3)  
0 The list type is a secured packet. 1 The list type is a \"PLMN ID and access
technology list\".
Acknowledgement (ACK) value (octet 4, bit 4)  
0 acknowledgement not requested 1 acknowledgement requested
The secure packet is coded as specified in 3GPP TS 31.115 [22B].
The PLMN ID and access technology list consists of PLMN ID and access
technology identifier and are coded as specified in 3GPP TS 31.102 [22]
subclause 4.2.5. The PLMN ID and access technology identifier are provided in
decreasing order of priority, i.e. PLMN ID 1 indicates highest priority and
PLMN ID n indicates lowest priority.
* * *
#### 9.11.3.52 Time zone
See subclause 10.5.3.8 in 3GPP TS 24.008 [12].
#### 9.11.3.53 Time zone and time
See subclause 10.5.3.9 in 3GPP TS 24.008 [12].
#### 9.11.3.53A UE parameters update transparent container
The purpose of the UE parameters update transparent container when sent from
the network to the UE is to provide UE parameters update data, optional
acknowledgement request and optional re-registration request. The purpose of
the UE parameters update transparent container when sent from the UE to the
network is to indicate the UE acknowledgement of successful reception of the
UE parameters update transparent container.
The UE parameters update transparent container information element is coded as
shown in figure 9.11.3.53A.1, figure 9.11.3.53A.2, figure 9.11.3.53A.3, figure
9.11.3.53A.4, figure 9.11.3.53A.5, figure 9.11.3.53A.6, figure 9.11.3.53A.7
and table 9.11.3.53A.1.
The UE parameters update transparent container is a type 6 information element
with a minimum length of 20 octets.
+---------------------+------------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------------+------------------+---+---+---+---+---+---+---+ | UE parameters | octet 1 | | | | | | | | | update transparent | | | | | | | | | | container IEI | | | | | | | | | +---------------------+------------------+---+---+---+---+---+---+---+ | Length of UE | octet 2 | | | | | | | | | parameters update | | | | | | | | | | transparent | octet 3 | | | | | | | | | container contents | | | | | | | | | +---------------------+------------------+---+---+---+---+---+---+---+ | UE parameters | octet 4 | | | | | | | | | update header | | | | | | | | | +---------------------+------------------+---+---+---+---+---+---+---+ | UPU-MAC-I~AUSF~ | octet 5-20 | | | | | | | | +---------------------+------------------+---+---+---+---+---+---+---+ | Counter~UPU~ | octet 21-22 | | | | | | | | +---------------------+------------------+---+---+---+---+---+---+---+ | UE parameters | octet 23* - n* | | | | | | | | | update list | | | | | | | | | +---------------------+------------------+---+---+---+---+---+---+---+
Figure 9.11.3.53A.1: UE parameters update transparent container information
element for UE parameters update data type with value \"0\"
+---------+---------+-------+-------+---------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------+---------+-------+-------+---------+---------+---+---+---+ | 0 | 0 | 0 | 0 | UE | octet | | | | | | | | | par | 23* | | | | | Spare | Spare | Spare | Spare | ameters | | | | | | | | | | update | | | | | | | | | | data | | | | | | | | | | set 1 | | | | | | | | | | type | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+ | Length | octet | | | | | | | | | of UE | 24*- | | | | | | | | | par | | | | | | | | | | ameters | 25* | | | | | | | | | update | | | | | | | | | | data | | | | | | | | | | set 1 | | | | | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+ | UE | octet | | | | | | | | | par | 26*- | | | | | | | | | ameters | | | | | | | | | | update | x* | | | | | | | | | data | | | | | | | | | | set 1 | | | | | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+ | ... | | | | | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+ | 0 | 0 | 0 | 0 | UE | octet | | | | | | | | | par | y* | | | | | Spare | Spare | Spare | Spare | ameters | | | | | | | | | | update | | | | | | | | | | data | | | | | | | | | | set n | | | | | | | | | | type | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+ | Length | octet | | | | | | | | | of UE | y+1*- | | | | | | | | | par | | | | | | | | | | ameters | y+2* | | | | | | | | | update | | | | | | | | | | data | | | | | | | | | | set n | | | | | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+ | UE | octet | | | | | | | | | par | y+3*- | | | | | | | | | ameters | | | | | | | | | | update | n* | | | | | | | | | data | | | | | | | | | | set n | | | | | | | | | +---------+---------+-------+-------+---------+---------+---+---+---+
Figure 9.11.3.53A.2: UE parameters update list
* * *
8 7 6 5 4 3 2 1  
Secured packet octet a* - a+2025*
* * *
Figure 9.11.3.53A.3: UE parameters update data set for UE parameters update
data set type with value \"00000001\"
+--------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------+-------------+---+---+---+---+---+---+---+ | Default configured NSSAI | octet b* - | | | | | | | | | | | | | | | | | | | | c* | | | | | | | | +--------------------------+-------------+---+---+---+---+---+---+---+
Figure 9.11.3.53A.4: UE parameters update data set for UE parameters update
data set type with value \"00000010\"
+------------------------------------------------------+--------------+ | UE parameters update transparent container IEI | octet 1 | +------------------------------------------------------+--------------+ | Length of UE parameters update transparent container | octet 2 | | contents | | | | octet 3 | +------------------------------------------------------+--------------+ | UE parameters update header | octet 4 | +------------------------------------------------------+--------------+ | UPU-MAC-I~UE~ | octet 5 - 20 | +------------------------------------------------------+--------------+
Figure 9.11.3.53A.5: UE parameters update transparent container information
element for UE parameters update data type with value \"1\"
+-------+-------+-------+-------+-------+-----+-----+---------------+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-----+-----+---------------+---------+ | 0 | 0 | 0 | 0 | 0 | REG | ACK | UPU data type | octet 4 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | | | | | +-------+-------+-------+-------+-------+-----+-----+---------------+---------+
Figure 9.11.3.53A.6: UE parameters update header for UE parameters update data
type with value \"0\"
+-------+-------+-------+-------+-------+-------+-------+---------------+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+---------------+---------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | UPU data type | octet 4 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | | | +-------+-------+-------+-------+-------+-------+-------+---------------+---------+
Figure 9.11.3.53A.7: UE parameters update header for UE parameters update data
type with value \"1\"
Table 9.11.3.53A.1: UE parameters update transparent container information
element
+----------------------------------+----------------------------------+ | UPU-MAC-I~AUSF~, UPU-MAC-I~UE~ | | | and Counter~UPU~ are coded as | | | specified in | | | 3GPP TS 33.501 [24] | | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | UPU data type (octet 4, bit 1) | | +----------------------------------+----------------------------------+ | 0 | The UE parameters update | | | transparent container carries a | | | UE parameters update list | +----------------------------------+----------------------------------+ | 1 | The UE parameters update | | | transparent container carries an | | | acknowledgement of successful | | | reception of a UE parameters | | | update list | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | Acknowledgement (ACK) value | | | (octet 4, bit 2) | | +----------------------------------+----------------------------------+ | 0 | acknowledgement not requested | +----------------------------------+----------------------------------+ | 1 | acknowledgement requested | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | Re-registration (REG) value | | | (octet 4, bit 3) | | +----------------------------------+----------------------------------+ | 0 | re-registrationt not requested | +----------------------------------+----------------------------------+ | 1 | re-registration requested | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | UE parameters update data set | | | type | | +----------------------------------+----------------------------------+ | Bits | | | | | | 4 3 2 1 | | +----------------------------------+----------------------------------+ | 0 0 0 1 Routing indicator update | | | data | | +----------------------------------+----------------------------------+ | 0 0 1 0 Default configured NSSAI | | | update data | | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | All other values are reserved | | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | The secured packet is coded as | | | specified in | | | 3GPP TS 31.115 [22B]. | | +----------------------------------+----------------------------------+ | | | +----------------------------------+----------------------------------+ | The default configured NSSAI is | | | encoded as the value part of the | | | NSSAI IE (see | | | subclause 9.11.3.37). | | +----------------------------------+----------------------------------+
#### 9.11.3.54 UE security capability
The UE _security_ capability information element is used by the UE and by the
network to indicate which security algorithms are supported by the UE in N1
mode for NAS security as well as which security algorithms are supported over
NR and E-UTRA connected to 5GCN for AS security.
The UE _security_ capability information element is coded as shown in figure
9.11.3.54.1 and table 9.11.3.54.1.
The UE _security capability_ is a type 4 information element with a minimum
length of 4 octets and a maximum length of 10 octets.
Octets 5 to 10 are optional. If octet 5 is included, then also octet 6 shall
be included.
If the UE does not support any security algorithm for AS security over E-UTRA
connected to 5GCN, it shall not include octets 5 and 6. The UE shall not
include octets 7 to 10.
If the network includes octet 7, then it shall include also octet 8. If the
network includes octet 9, then it shall include also octet 10.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | UE | octet | | | | | | | | | _sec | 1 | | | | | | | | | urity | | | | | | | | | | c | | | | | | | | | | apabi | | | | | | | | | | lity_ | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of UE | | | | | | | | | | _sec | | | | | | | | | | urity | | | | | | | | | | capab | | | | | | | | | | ility | | | | | | | | | | cont | | | | | | | | | | ents_ | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 128- | 128- | 128- | 5 | 5 | 5 | 5 | octet | | G-EA0 | | | | G-EA4 | G-EA5 | G-EA6 | G-EA7 | 3 | | | 5 | 5 | 5 | | | | | | | | G-EA1 | G-EA2 | G-EA3 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 128- | 128- | 128- | 5 | 5 | 5 | 5 | octet | | G-IA0 | | | | G-IA4 | G-IA5 | G-IA6 | G-IA7 | 4 | | | 5 | 5 | 5 | | | | | | | | G-IA1 | G-IA2 | G-IA3 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | EEA0 | 128- | 128- | 128- | EEA4 | EEA5 | EEA6 | EEA7 | octet | | | | | | | | | | 5* | | | EEA1 | EEA2 | EEA3 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | EIA0 | 128- | 128- | 128- | EIA4 | EIA5 | EIA6 | EIA7 | octet | | | | | | | | | | 6* | | | EIA1 | EIA2 | EIA3 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Spare | octet | | | | | | | | | | 7* | | | | | | | | | | -10* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.54.1: UE security capability information element
Table 9.11.3.54.1: UE _security capability_ information element
+----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithms | | | | | | supported (see NOTE 1) | | | | | | (octet 3) | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 5G-EA0 supported (octet 3, | | | | | | bit 8) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 5G-EA0 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 5G-EA0 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 128-5G-EA1 supported | | | | | | (octet 3, bit 7) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 128-5G-EA1 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 128-5G-EA1 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 128-5G-EA2 supported | | | | | | (octet 3, bit 6) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 128-5G-EA2 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 128-5G-EA2 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 128-5G-EA3 supported | | | | | | (octet 3, bit 5) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 128-5G-EA31 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 128-5G-EA3 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 5G-EA4 supported (octet 3, | | | | | | bit 4) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 5G-EA4 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 5G-EA4 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 5G-EA5 supported (octet 3, | | | | | | bit 3) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 5G-EA5 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 5G-EA5 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 5G-EA6 supported (octet 3, | | | | | | bit 2) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 5G-EA6 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 5G-EA6 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS encryption algorithm | | | | | | 5G-EA7 supported (octet 3, | | | | | | bit 1) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS encryption algorithm | | | | | | 5G-EA7 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS encryption algorithm | | | | | | 5G-EA7 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithms | | | | | | supported (see NOTE 2) | | | | | | (octet 4) | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 5G-IA0 supported (octet 4, | | | | | | bit 8) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 5G-IA0 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 5G-IA0 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 128-5G-IA1 supported | | | | | | (octet 4, bit 7) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 128-5G-IA1 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 128-5G-IA1 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 128-5G-IA2 supported | | | | | | (octet 4, bit 6) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 128-5G-IA2 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 128-5G-IA2 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 128-5G-IA3 supported | | | | | | (octet 4, bit 5) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 128-5G-IA3 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 128-5G-IA3 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 5G-IA4 supported (octet 4, | | | | | | bit 4) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 5G-IA4 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 5G-IA4 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 5G-IA5 supported (octet 4, | | | | | | bit 3) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 5G-IA5 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 5G-IA5 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 5G-IA6supported (octet 4, | | | | | | bit 2) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 5G-IA6 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 5G-IA6 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | 5GS integrity algorithm | | | | | | 5G-IA7 supported (octet 4, | | | | | | bit 1) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | 5GS integrity algorithm | | | | | | 5G-IA7 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | 5GS integrity algorithm | | | | | | 5G-IA7 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithms | | | | | | supported (see NOTE 3) | | | | | | (octet 5) | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | EEA0 supported (octet 5, | | | | | | bit 8) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | EEA0 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | EEA0 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | 128-EEA1 supported (octet | | | | | | 5, bit 7) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | 128-EEA1 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | 128-EEA1 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | 128-EEA2 supported (octet | | | | | | 5, bit 6) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | 128-EEA2 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | 128-EEA2 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | 128-EEA3 supported (octet | | | | | | 5, bit 5) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | 128-EEA3 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | 128-EEA3 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | EEA4 supported (octet 5, | | | | | | bit 4) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | EEA4 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | EEA4 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | EEA5 supported (octet 5, | | | | | | bit 3) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | EEA5 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | EEA5 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | EEA6 supported (octet 5, | | | | | | bit 2) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | EEA6 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | EEA6 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS encryption algorithm | | | | | | EEA7 supported (octet 5, | | | | | | bit 1) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS encryption algorithm | | | | | | EEA7 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS encryption algorithm | | | | | | EEA7 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithms | | | | | | supported (see NOTE 4) | | | | | | (octet 6) | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | EIA0 supported (octet 6, | | | | | | bit 8) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | EIA0 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | EIA0 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | 128-EIA1 supported (octet | | | | | | 6, bit 7) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | 128-EIA1 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | 128-EIA1 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | 128-EIA2 supported (octet | | | | | | 6, bit 6) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | 128-EIA2 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | 128-EIA2 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | 128-EIA3 supported (octet | | | | | | 6, bit 5) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | 128-EIA3 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | 128-EIA3 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | EIA4 supported (octet 6, | | | | | | bit 4) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | EIA4 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | EIA4 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | EIA5 supported (octet 6, | | | | | | bit 3) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | EIA5 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | EIA5 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | EIA6 supported (octet 6, | | | | | | bit 2) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | EIA6 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | EIA6 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | EPS integrity algorithm | | | | | | EIA7 supported (octet 6, | | | | | | bit 1) | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | EPS integrity algorithm | | | | | | EIA7 not supported | +----------------------------+---+---+---+----------------------------+ | 1 | | | | EPS integrity algorithm | | | | | | EIA7 supported | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | For the UE all bits in | | | | | | octets 7 to 10 are spare | | | | | | and shall be ignored, if | | | | | | the respective octet is | | | | | | received with the | | | | | | information element. | | | | | | | | | | | | If the AMF receives any of | | | | | | the octets 7 to 10 | | | | | | (NOTE 5), it shall store | | | | | | the octets as received and | | | | | | include them when sending | | | | | | the UE security capability | | | | | | information element to the | | | | | | UE. | | | | | +----------------------------+---+---+---+----------------------------+ | NOTE 1: The code points in | | | | | | octet 3 are used to | | | | | | indicate support for 5GS | | | | | | encryption algorithms for | | | | | | NAS security in N1 mode | | | | | | and support for 5GS | | | | | | encryption algorithms for | | | | | | AS security over NR. | | | | | | | | | | | | NOTE 2: The code points in | | | | | | octet 4 are used to | | | | | | indicate support for 5GS | | | | | | integrity algorithms for | | | | | | NAS security in N1 mode | | | | | | and support for 5GS | | | | | | integrity algorithms for | | | | | | AS security over NR. | | | | | | | | | | | | NOTE 3: The code points in | | | | | | octet 5 are used to | | | | | | indicate support for EPS | | | | | | encryption algorithms for | | | | | | AS security over E-UTRA | | | | | | connected to 5GCN. | | | | | | | | | | | | NOTE 4: The code points in | | | | | | octet 6 are used to | | | | | | indicate support for EPS | | | | | | integrity algorithms for | | | | | | AS security over E-UTRA | | | | | | connected to 5GCN. | | | | | | | | | | | | NOTE 5: The AMF can | | | | | | receive this information | | | | | | element also from another | | | | | | AMF or MME during N1 mode | | | | | | to N1 mode or S1 mode to | | | | | | N1 mode handover | | | | | | preparation. | | | | | +----------------------------+---+---+---+----------------------------+
#### 9.11.3.55 UE\'s usage setting
The purpose of the UE\'s usage setting information element is to provide the
network with the UE\'s usage setting as defined in 3GPP TS 24.301 [15]. The
network uses **the UE\'s usage setting** to select the RFSP index.
The UE\'s usage setting information element is coded as shown in figure
9.11.3.55.1 and table 9.11.3.55.1.
The UE\'s usage setting is a type 4 information element with a length of 3
octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | UE\'s | octet | | | | | | | | | usage | 1 | | | | | | | | | se | | | | | | | | | | tting | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | UE\'s | | | | | | | | | | usage | | | | | | | | | | se | | | | | | | | | | tting | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | UE\'s | octet | | | | | | | | | usage | 3 | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | se | | | | | | | | | | tting | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.55.1: UE\'s usage setting information element
Table 9.11.3.55.1: UE\'s usage setting information element
* * *
UE\'s usage setting (octet 3, bit 1)  
0 voice centric 1 data centric
All other bits in the octet 3 are spare and shall be coded as zero,
* * *
#### 9.11.3.56 UE status
The purpose of the UE status information element is to provide the network
with information concerning aspects of the current UE registration status
which is used for interworking with EPS.
The UE status information element is coded as shown in figure 9.11.3.56.1 and
table 9.11.3.56.1.
The UE status is a type 4 information element with a length of 3 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | UE | octet | | | | | | | | | s | 1 | | | | | | | | | tatus | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of UE | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | N1 | S1 | octet | | | | | | | | mode | mode | 3 | | Spare | Spare | Spare | Spare | Spare | Spare | reg | reg | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.56.1: UE status information element
Table 9.11.3.56.1: UE status information element
* * *
EMM registration status (S1 mode reg) (octet 3, bit 1)  
0 UE is not in EMM-REGISTERED state 1 UE is in EMM-REGISTERED state
5GMM registration status (N1 mode reg) (octet 3, bit 2)  
0 UE is not in 5GMM-REGISTERED state 1 UE is in 5GMM-REGISTERED state
All other bits in the octet 3 are spare and shall be coded as zero.
* * *
#### 9.11.3.57 Uplink data status
The purpose of the Uplink data status information element is to indicate to
the network which preserved PDU sessions have uplink data pending.
The Uplink data status information element is coded as shown in figure
9.11.3.57.1 and table 9.11.3.57.1.
The Uplink data status information element is a type 4 information element
with minimum length of 4 octets a maximum length of 34 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | U | octet | | | | | | | | | plink | 1 | | | | | | | | | data | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | u | | | | | | | | | | plink | | | | | | | | | | data | | | | | | | | | | s | | | | | | | | | | tatus | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 3 | | (7) | (6) | (5) | (4) | (3) | (2) | (1) | (0) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | PSI | PSI | PSI | PSI | PSI | PSI | PSI | PSI | octet | | | | | | | | | | 4 | | \ | \ | \ | \ | \ | \ | (9) | (8) | | | (15) | (14) | (13) | (12) | (11) | (10) | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | spare | octet | | | | | | | | | | 5* | | | | | | | | | | -34* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 9.11.3.57.1: Uplink data status information element
Table 9.11.3.57.1: Uplink data status information element
+----------------------------------------------------------------------+ | PSI(x) shall be coded as follows: | | | | PSI(0): | | | | Bit 1 of octet 3 is spare and shall be coded as zero. | | | | PSI(1) -- PSI(15): | | | | 0 indicates that no uplink data are pending for the corresponding | | PDU session identity. | | | | 1 indicates that uplink data are pending for the corresponding PDU | | session identity. | | | | All bits in octet 5 to 34 are spare and shall be coded as zero, if | | the respective octet is included in the information element. | +----------------------------------------------------------------------+
### 9.11.4 5GS session management (5GSM) information elements
#### 9.11.4.1 5GSM capability
The purpose of the 5GSM capability information element is to indicate UE
capability related to the PDU session management.
The 5GSM capability information element is coded as shown in figure 9.11.4.1.1
and table 9.11.4.1.1.
The 5GSM capability is a type 4 information element with a minimum length of 3
octets and a maximum length of 15 octets.
+-------+-------+-------+-------+-------+-------+-------+------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+------+-------+ | 5GSM | octet | | | | | | | | | capab | 1 | | | | | | | | | ility | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | 5GSM | | | | | | | | | | capab | | | | | | | | | | ility | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | MH | RqoS | octet | | | | | | | | 6-PDU | | 3 | | Spare | Spare | Spare | Spare | Spare | Spare | | | | +-------+-------+-------+-------+-------+-------+-------+------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet | | | | | | | | | | 4* | | | | | | | | | | -15* | +-------+-------+-------+-------+-------+-------+-------+------+-------+ | Spare | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+------+-------+
Figure 9.11.4.1.1: 5GSM capability information element
Table 9.11.4.1.1: 5GSM capability information element
* * *
5GSM capability value  
RqoS(octet 3, bit 1)  
This bit indicates the 5GSM capability to support reflective QoS.  
0 Reflective QoS not supported 1 Reflective QoS supported
Multi-homed IPv6 PDU session (MH6-PDU) (octet 3, bit 2)  
This bit indicates the 5GSM capability for Multi-homed IPv6 PDU session.  
0 Multi-homed IPv6 PDU session not supported 1 Multi-homed IPv6 PDU session
supported
All other bits in octet 3 to 15 are spare and shall be coded as zero, if the
respective octet is included in the information element.
* * *
#### 9.11.4.2 5GSM cause
The purpose of the 5GSM cause information element is to indicate the reason
why a 5GSM request is rejected.
The 5GSM cause information element is coded as shown in figure 9.11.4.2.1 and
table 9.11.4.2.1.
The 5GSM cause is a type 3 information element with 2 octets length.
* * *
8 7 6 5 4 3 2 1  
5GSM cause IEI octet 1  
Cause value octet 2
* * *
Figure 9.11.4.2.1: 5GSM cause information element
Table 9.11.4.2.1: 5GSM cause information element
* * *
Cause value (octet 2)  
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 1 0 0 0 Operator determined barring 0 0 0 1 1 0 1 0 Insufficient
resources 0 0 0 1 1 0 1 1 Missing or unknown DNN 0 0 0 1 1 1 0 0 Unknown PDU
session type 0 0 0 1 1 1 0 1 User authentication or authorization failed 0 0 0
1 1 1 1 1 Request rejected, unspecified 0 0 1 0 0 0 0 0 Service option not
supported 0 0 1 0 0 0 0 1 Requested service option not subscribed 0 0 1 0 0 0
1 0 Service option temporarily out of order 0 0 1 0 0 0 1 1 PTI already in use
0 0 1 0 0 1 0 0 Regular deactivation 0 0 1 0 0 1 1 0 Network failure 0 0 1 0 0
1 1 1 Reactivation requested 0 0 1 0 1 0 1 1 Invalid PDU session identity 0 0
1 0 1 1 0 0 Semantic errors in packet filter(s) 0 0 1 0 1 1 0 1 Syntactical
error in packet filter(s) 0 0 1 0 1 1 1 0 Out of LADN service area 0 0 1 0 1 1
1 1 PTI mismatch 0 0 1 1 0 0 1 0 PDU session type IPv4 only allowed 0 0 1 1 0
0 1 1 PDU session type IPv6 only allowed 0 0 1 1 0 1 1 0 PDU session does not
exist 0 1 0 0 0 0 1 1 Insufficient resources for specific slice and DNN 0 1 0
0 0 1 0 0 Not supported SSC mode 0 1 0 0 0 1 0 1 Insufficient resources for
specific slice 0 1 0 0 0 1 1 0 Missing or unknown DNN in a slice 0 1 0 1 0 0 0
1 Invalid PTI value 0 1 0 1 0 0 1 0 Maximum data rate per UE for user-plane
integrity protection is too low 0 1 0 1 0 0 1 1 Semantic error in the QoS
operation 0 1 0 1 0 1 0 0 Syntactical error in the QoS operation 0 1 0 1 0 1 0
1 Invalid mapped EPS bearer identity 0 1 0 1 1 1 1 1 Semantically incorrect
message 0 1 1 0 0 0 0 0 Invalid mandatory information 0 1 1 0 0 0 0 1 Message
type non-existent or not implemented 0 1 1 0 0 0 1 0 Message type not
compatible with the protocol state 0 1 1 0 0 0 1 1 Information element non-
existent or not implemented 0 1 1 0 0 1 0 0 Conditional IE error 0 1 1 0 0 1 0
1 Message not compatible with the protocol state 0 1 1 0 1 1 1 1 Protocol
error, unspecified
Any other value received by the UE shall be treated as 0010 0010, \"service
option temporarily out of order\". Any other value received by the network
shall be treated as 0110 1111, \"protocol error, unspecified\".
* * *
#### 9.11.4.2A 5GSM congestion re-attempt indicator
The purpose of the 5GSM congestion re-attempt indicator information element is
to indicate whether the back-off timer is applied in the registered PLMN or
all PLMNs.
The 5GSM congestion re-attempt indicator information element is coded as shown
in figure 9.11.4.2A.1 and table 9.11.4.2A.1.
The 5GSM congestion re-attempt indicator is a type 4 information element with
a length of 3 octets.
+-------+-------+-------+-------+-------+-------+-------+-----+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+ | 5GSM | octet | | | | | | | | | conge | 1 | | | | | | | | | stion | | | | | | | | | | re-at | | | | | | | | | | tempt | | | | | | | | | | indi | | | | | | | | | | cator | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | 5GSM | | | | | | | | | | conge | | | | | | | | | | stion | | | | | | | | | | re-at | | | | | | | | | | tempt | | | | | | | | | | indi | | | | | | | | | | cator | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | ABO | octet | | | | | | | | | | 3 | | Spare | Spare | Spare | Spare | Spare | Spare | Spare | | | +-------+-------+-------+-------+-------+-------+-------+-----+-------+
Figure 9.11.4.2A.1: 5GSM congestion re-attempt indicator
Table 9.11.4.2A.1: 5GSM congestion re-attempt indicator
ABO (All PLMNs Back-off timer) (octet 3, bit 3)
* * *
Bit  
1  
0 The back-off timer is applied in the registered PLMN. 1 The back-off timer
is applied in all PLMNs.
Bits 2 to 8 of octet 3 are spare and shall be encoded as zero.
#### 9.11.4.3 Always-on PDU session indication
The purpose of the Always-on PDU session indication information element is to
indicate whether a PDU session is established as an always-on PDU session.
The Always-on PDU session indication information element is coded as shown in
figure 9.11.4.3.1 and table 9.11.4.3.1.
The Always-on PDU session indication is a type 1 information element.
+--------------------------------------+-------+-------+-------+------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +======================================+=======+=======+=======+======+=========+===+===+===+ | Always-on PDU session indication IEI | 0 | 0 | 0 | APSI | octet 1 | | | | | | | | | | | | | | | | Spare | Spare | Spare | | | | | | +--------------------------------------+-------+-------+-------+------+---------+---+---+---+
**Figure 9.11.4.3.1: Always-on PDU session indication**
**Table 9.11.4.3.1: Always-on PDU session indication**
Always-on PDU session indication (APSI) (octet 1)
* * *
Bit  
**1**  
0 Always-on PDU session not allowed 1 Always-on PDU session required
Bits 2, 3 and 4 are spare and shall be coded as zero,
#### 9.11.4.4 Always-on PDU session requested
The purpose of the Always-on PDU session requested information element is to
indicate whether a PDU session is requested to be established as an always-on
PDU session.
The Always-on PDU session requested information element is coded as shown in
figure 9.11.4.4.1 and table 9.11.4.4.1.
The Always-on PDU session requested is a type 1 information element.
+-------------------------------------+-------+-------+-------+------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=====================================+=======+=======+=======+======+=========+===+===+===+ | Always-on PDU session requested IEI | 0 | 0 | 0 | APSR | octet 1 | | | | | | | | | | | | | | | | Spare | Spare | Spare | | | | | | +-------------------------------------+-------+-------+-------+------+---------+---+---+---+
Figure 9.11.4.4.1: Always-on PDU session requested
Table 9.11.4.4.1: Always-on PDU session requested
Always-on PDU session requested (APSR) (octet 1)
* * *
Bit  
**1**  
0 Always-on PDU session not requested 1 Always-on PDU session requested
Bits 2, 3 and 4 are spare and shall be coded as zero,
#### 9.11.4.5 Allowed SSC mode
The purpose of the Allowed SSC mode information element is to indicate the SSC
modes allowed to be used by the UE for the PDU session.
The Allowed SSC mode information element is coded as shown in figure
9.11.4.5.1 and table 9.11.4.5.1.
The Allowed SSC mode is a type 1 information element.
+----------------------+-------+------+------+------+---------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------+-------+------+------+------+---------+---+---+---+ | Allowed SSC mode IEI | 0 | SSC3 | SSC2 | SSC1 | octet 1 | | | | | | | | | | | | | | | | Spare | | | | | | | | +----------------------+-------+------+------+------+---------+---+---+---+
Figure 9.11.4.5.1: Allowed SSC mode information element
Table 9.11.4.5.1: Allowed SSC mode information element
SSC1 (octet 1, bit 1)
* * *
Bit  
1  
0 SSC mode 1 not allowed 1 SSC mode 1 allowed
SSC2 (octet 1, bit 2)  
Bit  
2  
0 SSC mode 2 not allowed 1 SSC mode 2 allowed
SSC3 (octet 1, bit 3)  
Bit  
3  
0 SSC mode 3 not allowed 1 SSC mode 3 allowed
Bit 4 is spare and shall be encoded as zero.
#### 9.11.4.6 Extended protocol configuration options
See subclause 10.5.6.3A in 3GPP TS 24.008 [12].
#### 9.11.4.7 Integrity protection maximum data rate
The purpose of the integrity protection maximum data rate information element
is for the UE to indicate to the network the maximum data rate per UE for
user-plane integrity protection for uplink and the maximum data rate per UE
for user-plane integrity protection for downlink that are supported by the UE.
The integrity protection maximum data rate is coded as shown in figure
9.11.4.7.1 and table 9.11.4.7.2.
The integrity protection maximum data rate is a type 3 information element
with a length of 3 octets.
* * *
8 7 6 5 4 3 2 1  
Integrity protection maximum data rate IEI octet 1  
Maximum data rate per UE for user-plane integrity protection for uplink octet
2  
Maximum data rate per UE for user-plane integrity protection for downlink
octet 3
* * *
Figure 9.11.4.7.1: Integrity protection maximum data rate information element
Table 9.11.4.7.2: Integrity protection maximum data rate information element
* * *
Maximum data rate per UE for user-plane integrity protection for uplink (octet
2)  
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 0 64 kbps 1 1 1 1 1 1 1 1 Full data rate All other values are
spare
Maximum data rate per UE for user-plane integrity protection for downlink
(octet 3)  
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 0 64 kbps 1 1 1 1 1 1 1 1 Full data rate The receiving entity
shall treat a spare value as \"64 kbps\".
* * *
#### 9.11.4.8 Mapped EPS bearer contexts
The purpose of the mapped EPS bearer contexts information element is to
indicate a set of EPS contexts for a PDU session, as described in subclause
6.1.4.1.
The mapped EPS bearer contexts information element is a type 6 information
element with a minimum length of 7 octet and a maximum length of 65538 octets.
The mapped EPS bearer contexts information element is coded as shown in figure
9.11.4.8.1, figure 9.11.4.8.2, figure 9.11.4.8.3 and table 9.11.4.8.1.
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| Mapped EPS bearer contexts IEI | octet 1 |  |  |  |  |  |  |   
| Length of Mapped EPS bearer contexts contents | octet 2 |  |  |  |  |  |  |   
|  | octet 3 |  |  |  |  |  |  |   
| Mapped EPS bearer context 1 | octet 4 octet u |  |  |  |  |  |  |   
| Mapped EPS bearer context 2 | octet u+1 octet v |  |  |  |  |  |  |   
| â€¦ | octet v+1 octet w |  |  |  |  |  |  |   
| Mapped EPS bearer context n | octet w+1 octet x |  |  |  |  |  |  |   
Figure 9.11.4.8.1: Mapped EPS bearer contexts
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| EPS bearer identity | octet 4 |  |  |  |  |  |  |   
| Length of Mapped EPS bearer context | octet 5 octet 6 |  |  |  |  |  |  |   
| Operation code | 0 Spare | E bit | Number of EPS parameters | octet 7 |  |  |  |   
| EPS parameters list | octet 8 octet u |  |  |  |  |  |  |   
Figure 9.11.4.8.2: Mapped EPS bearer context
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| EPS parameter identifier 1 | octet 8 |  |  |  |  |  |  |   
| Length of EPS parameter contents 1 | octet 9 |  |  |  |  |  |  |   
| EPS parameter contents 1 | octet 10 octet h |  |  |  |  |  |  |   
| EPS parameter identifier 2 | octet h+1 |  |  |  |  |  |  |   
| Length of EPS parameter contents 2 | octet h+2 |  |  |  |  |  |  |   
| EPS parameter contents 2 | octet h+3 octet i |  |  |  |  |  |  |   
| â€¦ | octet i+1 octet j |  |  |  |  |  |  |   
| EPS parameter identifier N | octet j+1 |  |  |  |  |  |  |   
| Length of EPS parameter contents N | octet j+2 |  |  |  |  |  |  |   
| EPS parameter contents N | octet j+3 octet u |  |  |  |  |  |  |   
Figure 9.11.4.8.3: EPS parameters list
Table 9.11.4.8.1: Mapped EPS bearer contexts information element
+----------------------------------------------------------------------+ | EPS bearer identity (octet 4) | | | | The EPS bearer identity is used to identity the EPS bearer, and is | | coded as specified in subclause 9.3.2 of 3GPP TS 24.301 [15]. | | | | Operation code (bits 8 to 7 of octet 7)\ | | Bits\ | | 8 7 | | | | 0 0 Reserved\ | | 0 1 Create new EPS bearer | | | | 1 0 Delete existing EPS bearer | | | | 1 1 Modify existing EPS bearer | | | | Bit 6 of octet 7 is spare and shall be coded as zero. | | | | E bit (bit 5 of octet 7) | | | | For the \"create new EPS bearer\" operation, the E bit is encoded as | | follows: | | | | Bit\ | | 5 | | | | 0 parameters list is not included | | | | 1 parameters list is included | | | | For the \"modify existing EPS bearer\" operation, the E bit is | | encoded as follows: | | | | Bit\ | | 5 | | | | 0 previously provided parameters list extension | | | | 1 previously provided parameters list replacement | | | | If the E bit is set to \"parameters list is not included\", the | | number of EPS parameters field has zero value. If the E bit is set | | to \"parameters list is included\", the number of EPS parameters | | field has non-zero value. If the E bit is set to \"previously | | provided parameters list extension\" or \"previously provided | | parameters list replacement\", the number of parameters field can | | have zero or non-zero value. | | | | For the \"create new EPS bearer\" operation and \"delete existing | | EPS bearer\" operation, bit 5 of octet 7 is ignored. | | | | Number of EPS parameters (bits 4 to 1 of octet 7) | | | | The number of EPS parameters contains the binary coding for the | | number of EPS parameters in the EPS parameters list field. The | | number of EPS parameters field is encoded in bits 4 through 1 of | | octet x+1 where bit 4 is the most significant and bit 1 is the least | | significant bit. | | | | EPS parameters list (octets 8 to u) | | | | The EPS parameters list contains a variable number of EPS | | parameters. | | | | Each EPS parameter included in the EPS parameters list is of | | variable length and consists of: | | | | - an EPS parameter identifier (1 octet);\ | | - the length of the EPS parameter contents (1 octet); and\ | | - the EPS parameter contents itself (variable amount of octets). | | | | The EPS parameter identifier field is used to identify each EPS | | parameter included in the EPS parameters list and it contains the | | hexadecimal coding of the EPS parameter identifier. Bit 8 of the EPS | | parameter identifier field contains the most significant bit and bit | | 1 contains the least significant bit. In this version of the | | protocol, the following EPS parameter identifiers are specified: | | | | - 01H (Mapped EPS QoS parameters);\ | | - 02H (Mapped extended EPS QoS parameters); and | | | | - 03H (Traffic flow template). | | | | - 04H (APN-AMBR). | | | | - 05H (extended APN-AMBR). | | | | If the EPS parameters list contains an EPS parameter identifier that | | is not supported by the receiving entity the corresponding EPS | | parameter shall be discarded. | | | | The length of EPS parameter contents field contains the binary coded | | representation of the length of the EPS parameter contents field. | | The first bit in transmission order is the most significant bit. | | | | When the parameter identifier indicates mapped EPS QoS parameters, | | the length and parameter contents field are coded as specified in | | subclause 9.9.4.3 of 3GPP TS 24.301 [15]. | | | | When the parameter identifier indicates mapped extended EPS QoS | | parameters, the length and parameter contents field are coded as | | specified in subclause 9.9.4.30 of 3GPP TS 24.301 [15]. | | | | When the parameter identifier indicates traffic flow template, the | | length and parameter contents field are coded from octet 2 as shown | | figure 10.5.144 and table 10.5.162 of 3GPP TS 24.008 [12]. | | | | When the parameter identifier indicates APN-AMBR, the length and | | parameter contents field are coded as specified in subclause 9.9.4.2 | | of 3GPP TS 24.301 [15]. | | | | When the parameter identifier indicates Extended APN-AMBR, the | | length and parameter contents field are coded as specified in | | subclause 9.9.4.29 of 3GPP TS 24.301 [15]. | +----------------------------------------------------------------------+
#### 9.11.4.9 Maximum number of supported packet filters
The purpose of the Maximum number of supported packet filters information
element is for the UE to indicate to the network the maximum number of packet
filters, associated with signaled QoS rules, that can be supported by the UE
for the PDU session that is being established, when the PDU session type
\"IPv4\", \"IPv6\", \"IPv4v6\" or \"Ethernet\".
The Maximum number of supported packet filters is coded as shown in figure
9.11.4.9.1 and table 9.11.4.9.1.
The Maximum number of supported packet filters is a type 3 information element
with a length of 3 octets.
+--------+--------+-------+-------+-------+-------+--------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------+--------+-------+-------+-------+-------+--------+---+---+ | M | octet | | | | | | | | | aximum | 1 | | | | | | | | | number | | | | | | | | | | of | | | | | | | | | | sup | | | | | | | | | | ported | | | | | | | | | | packet | | | | | | | | | | f | | | | | | | | | | ilters | | | | | | | | | | IEI | | | | | | | | | +--------+--------+-------+-------+-------+-------+--------+---+---+ | M | octet | | | | | | | | | aximum | 2 | | | | | | | | | number | | | | | | | | | | of | | | | | | | | | | sup | | | | | | | | | | ported | | | | | | | | | | packet | | | | | | | | | | f | | | | | | | | | | ilters | | | | | | | | | +--------+--------+-------+-------+-------+-------+--------+---+---+ | M | 0 | 0 | 0 | 0 | 0 | octet | | | | aximum | | | | | | 3 | | | | number | Spare | Spare | Spare | Spare | Spare | | | | | of | | | | | | | | | | sup | | | | | | | | | | ported | | | | | | | | | | packet | | | | | | | | | | f | | | | | | | | | | ilters | | | | | | | | | | (cont | | | | | | | | | | inued) | | | | | | | | | +--------+--------+-------+-------+-------+-------+--------+---+---+
Figure 9.11.4.9.1: Maximum number of supported packet filters information
element
Table 9.11.4.9.1: Maximum number of supported packet filters information
element
+----------------------------------------------------------------------+ | Maximum number of supported packet filters (octet 2 to 3) | +----------------------------------------------------------------------+ | In the Maximum number of supported packet filters field bit 8 of the | | first octet is the most significant bit and bit 6 of second octet is | | the least significant bit. Bit 5 to bit 1 of the second octet are | | spare bits and shall be coded as zero. | | | | The number of supported packet filters shall be in the range of 17 | | to 1024. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+
#### 9.11.4.10 PDU address
The purpose of the PDU address information element is to assign to the UE:
\- an IPv4 address associated with a PDU session;
\- an interface identifier for the IPv6 link local address associated with the
PDU session; or
\- an IPv4 address and an interface identifier for the IPv6 link local
address, associated with the PDU session.
The PDU address information element is coded as shown in figure 9.11.4.10.1
and table 9.11.4.10.1.
The PDU address is a type 4 information element with minimum length of 7
octets and a maximum length of 15 octets.
+--------------------------------+----------+---+---+---+------------------------+---------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------+----------+---+---+---+------------------------+---------+---+---+ | PDU address IEI | octet 1 | | | | | | | | +--------------------------------+----------+---+---+---+------------------------+---------+---+---+ | Length of PDU address contents | octet 2 | | | | | | | | +--------------------------------+----------+---+---+---+------------------------+---------+---+---+ | 0 | 0 | 0 | 0 | 0 | PDU session type value | octet 3 | | | +--------------------------------+----------+---+---+---+------------------------+---------+---+---+ | spare | | | | | | | | | +--------------------------------+----------+---+---+---+------------------------+---------+---+---+ | PDU address information | octet 4 | | | | | | | | | | | | | | | | | | | | octet 15 | | | | | | | | +--------------------------------+----------+---+---+---+------------------------+---------+---+---+
Figure 9.11.4.10.1: PDU address information element
Table 9.11.4.10.1: PDU address information element
* * *
PDU session type value (octet 3)  
Bits  
3 2 1  
0 0 1 IPv4 0 1 0 IPv6 0 1 1 IPv4v6
All other values are reserved.
Bit 4 to 8 of octet 3 are spare and shall be coded as zero.
PDU address information (octet 4 to 15)
If the PDU session type value indicates IPv4, the PDU address information in
octet 4 to octet 7 contains an IPv4 address.
If the PDU session type value indicates IPv6, the PDU address information in
octet 4 to octet 11 contains an interface identifier for the IPv6 link local
address.
If the PDU session type value indicates IPv4v6, the PDU address information in
octet 4 to octet 11 contains an interface identifier for the IPv6 link local
address and in octet 12 to octet 15 contains an IPv4 address.
* * *
#### 9.11.4.11 PDU session type
The purpose of the PDU session type information element is to indicate type of
the PDU session.
The PDU session type information element is coded as shown in figure
9.11.4.11.1 and table 9.11.4.11.1.
The PDU session type is a type 1 information element.
+----------------------+-------+------------------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------------------+-------+------------------------+---------+---+---+---+---+---+ | PDU session type IEI | 0 | PDU session type value | octet 1 | | | | | | | | | | | | | | | | | | Spare | | | | | | | | +----------------------+-------+------------------------+---------+---+---+---+---+---+
Figure 9.11.4.11.1: PDU session type information element
Table 9.11.4.11.1: PDU session type information element
PDU session type value (octet 1, bit 1 to bit 3)
* * *
Bits  
3 2 1  
0 0 1 IPv4 0 1 0 IPv6 0 1 1 IPv4v6 1 0 0 Unstructured 1 0 1 Ethernet 1 1 1
reserved
All other values are unused and shall be interpreted as \"IPv4v6\", if
received by the UE or the network.
#### 9.11.4.12 QoS flow descriptions
The purpose of the QoS flow descriptions information element is to indicate a
set of QoS flow descriptions to be used by the UE, where each QoS flow
description is a set of parameters as described in subclause 6.2.5.1.1.4.
The QoS flow descriptions information element is a type 6 information element
with a minimum length of 6 octets. The maximum length for the information
element is 65538 octets.
The QoS flow descriptions information element is coded as shown in figure
9.11.4.12.1, figure 9.11.4.12.2, figure 9.11.4.12.3, figure 9.11.4.12.4, and
table 9.11.4.12.1.
+------------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------------+-----------+---+---+---+---+---+---+---+ | QoS flow descriptions IEI | octet 1 | | | | | | | | +------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of QoS flow descriptions contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +------------------------------------------+-----------+---+---+---+---+---+---+---+ | QoS flow description 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet u | | | | | | | | +------------------------------------------+-----------+---+---+---+---+---+---+---+ | QoS flow description 2 | octet u+1 | | | | | | | | | | | | | | | | | | | | octet v | | | | | | | | +------------------------------------------+-----------+---+---+---+---+---+---+---+ | ... | octet v+1 | | | | | | | | | | | | | | | | | | | | octet w | | | | | | | | +------------------------------------------+-----------+---+---+---+---+---+---+---+ | QoS flow description n | octet w+1 | | | | | | | | | | | | | | | | | | | | octet x | | | | | | | | +------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 9.11.4.12.1: QoS flow descriptions information element
+-----------------+-----------+----------------------+---------+-------+-------+---------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-----------------+-----------+----------------------+---------+-------+-------+---------+---+---+ | 0 | 0 | QFI | octet 4 | | | | | | | | | | | | | | | | | Spare | Spare | | | | | | | | +-----------------+-----------+----------------------+---------+-------+-------+---------+---+---+ | Operation code | 0 | 0 | 0 | 0 | 0 | octet 5 | | | | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | | | | +-----------------+-----------+----------------------+---------+-------+-------+---------+---+---+ | 0 | E | Number of parameters | octet 6 | | | | | | | | | | | | | | | | | Spare | | | | | | | | | +-----------------+-----------+----------------------+---------+-------+-------+---------+---+---+ | Parameters list | octet 7* | | | | | | | | | | | | | | | | | | | | octet u* | | | | | | | | +-----------------+-----------+----------------------+---------+-------+-------+---------+---+---+
Figure 9.11.4.12.2: QoS flow description
+-------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------+-----------+---+---+---+---+---+---+---+ | Parameter 1 | octet 7 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+ | Parameter 2 | octet m+1 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+ | ... | octet n+1 | | | | | | | | | | | | | | | | | | | | octet o | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+ | Parameter n | octet o+1 | | | | | | | | | | | | | | | | | | | | octet u | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+
Figure 9.11.4.12.3: Parameters list
+------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------+---------+---+---+---+---+---+---+---+ | Parameter identifier | octet 7 | | | | | | | | +------------------------------+---------+---+---+---+---+---+---+---+ | Length of parameter contents | octet 8 | | | | | | | | +------------------------------+---------+---+---+---+---+---+---+---+ | Parameter contents | octet 9 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +------------------------------+---------+---+---+---+---+---+---+---+
Figure 9.11.4.12.4: Parameter
Table 9.11.4.12.1: QoS flow descriptions information element
+----------------------------------------------------------------------+ | QoS flow identifier (QFI) (bits 6 to 1 of octet 4) | | | | QFI field contains the QoS flow identifier. | | | | Bits | | | | 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 no QoS flow identifier assigned | | | | 0 0 0 0 0 1 QFI 1 | | | | to | | | | 1 1 1 1 1 1 QFI 63 | | | | The network shall not set the QFI value to 0. | +----------------------------------------------------------------------+ | Operation code (bits 8 to 6 of octet 5) | | | | Bits | | | | 8 7 6 | | | | 0 0 1 Create new QoS flow description | | | | 0 1 0 Delete existing QoS flow description | | | | 0 1 1 Modify existing QoS flow description | | | | All other values are reserved. | +----------------------------------------------------------------------+ | E bit (bit 7 of octet 6) | | | | For the \"create new QoS flow description\" operation, the E bit is | | encoded as follows: | | | | Bit\ | | 7 | | | | 0 reserved | | | | 1 parameters list is included | | | | For the \"Delete existing QoS flow description\" operation, the E | | bit is encoded as follows: | | | | Bit\ | | 7 | | | | 0 parameters list is not included | | | | 1 reserved | | | | For the \"modify existing QoS flow description\" operation, the E | | bit is encoded as follows: | | | | Bit\ | | 7 | | | | 0 extension of previously provided parameters | | | | 1 replacement of all previously provided parameters | | | | If the E bit is set to \"parameters list is not included\", the | | number of parameters field has zero value. If the E bit is set to | | \"parameters list is included\", the number of parameters field has | | non-zero value. If the E bit is set to \"extension of previously | | provided parameters\" or \"replacement of all previously provided | | parameters\", the number of parameters field has non-zero value. If | | the E bit is set to \"extension of previously provided parameters\" | | and one of the parameters in the new parameters list already exists | | in the previously provided parameters, the parameter shall be set to | | the new value. | | | | Number of parameters (bits 6 to 1 of octet 6) | | | | The number of parameters field contains the binary coding for the | | number of parameters in the parameters list field. The number of | | parameters field is encoded in bits 6 through 1 of octet 6 where bit | | 6 is the most significant and bit 1 is the least significant bit. | | | | Parameters list (octets 7 to u) | | | | The parameters list contains a variable number of parameters. | | | | Each parameter included in the parameters list is of variable length | | and consists of: | | | | - a parameter identifier (1 octet);\ | | - the length of the parameter contents (1 octet); and\ | | - the parameter contents itself (variable amount of octets). | | | | The parameter identifier field is used to identify each parameter | | included in the parameters list and it contains the hexadecimal | | coding of the parameter identifier. Bit 8 of the parameter | | identifier field contains the most significant bit and bit 1 | | contains the least significant bit. In this version of the protocol, | | the following parameter identifiers are specified: | | | | - 01H (5QI);\ | | - 02H (GFBR uplink); | | | | - 03H (GFBR downlink); | | | | - 04H (MFBR uplink); | | | | - 05H (MFBR downlink); | | | | - 06H (Averaging window); and | | | | - 07H (EPS bearer identity). | | | | If the parameters list contains a parameter identifier that is not | | supported by the receiving entity the corresponding parameter shall | | be discarded. | | | | The length of parameter contents field contains the binary coded | | representation of the length of the parameter contents field. The | | first bit in transmission order is the most significant bit. | | | | When the parameter identifier indicates 5QI, the parameter contents | | field contains the binary representation of 5G QoS identifier (5QI) | | that is one octet in length. | | | | 5QI: | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 Reserved | | | | 0 0 0 0 0 0 0 1 5QI 1 | | | | 0 0 0 0 0 0 1 0 5QI 2 | | | | 0 0 0 0 0 0 1 1 5QI 3 | | | | 0 0 0 0 0 1 0 0 5QI 4 | | | | 0 0 0 0 0 1 0 1 5QI 5 | | | | 0 0 0 0 0 1 1 0 5QI 6 | | | | 0 0 0 0 0 1 1 1 5QI 7 | | | | 0 0 0 0 1 0 0 0 5QI 8 | | | | 0 0 0 0 1 0 0 1 5QI 9 | | | | 0 0 0 0 1 0 1 0 | | | | to Spare | | | | 0 1 0 0 0 0 0 0 | | | | 0 1 0 0 0 0 0 1 5QI 65 | | | | 0 1 0 0 0 0 1 0 5QI 66 | | | | 0 1 0 0 0 0 1 1 5QI 67 | | | | 0 1 0 0 0 1 0 0 Spare | | | | 0 1 0 0 0 1 0 1 5QI 69 | | | | 0 1 0 0 0 1 1 0 5QI 70 | | | | 0 1 0 0 0 1 1 1 | | | | to Spare | | | | 0 1 0 0 1 0 1 0 | | | | 0 1 0 0 1 0 1 1 5QI 75 | | | | 0 1 0 0 1 1 0 0 | | | | to Spare | | | | 0 1 0 0 1 1 1 0 | | | | 0 1 0 0 1 1 1 1 5QI 79 | | | | 0 1 0 1 0 0 0 0 5QI 80 | | | | 0 1 0 1 0 0 0 1 Spare | | | | 0 1 0 1 0 0 1 0 5QI 82 | | | | 0 1 0 1 0 0 1 1 5QI 83 | | | | 0 1 0 1 0 1 0 0 5QI 84 | | | | 0 1 0 1 0 1 0 1 5QI 85 | | | | 0 1 0 1 0 1 1 0 | | | | to Spare | | | | 0 1 1 1 1 1 1 1 | | | | 1 0 0 0 0 0 0 0 | | | | to Operator-specific 5QIs | | | | 1 1 1 1 1 1 1 0 | | | | 1 1 1 1 1 1 1 1 Reserved | | | | The network shall consider all other values not explicitly defined | | in this version of the protocol as unsupported. | | | | If the UE receives a 5QI value (excluding the reserved 5QI values) | | that it does not understand, the UE shall choose a 5QI value from | | the set of 5QI values defined in this version of the protocol (see | | 3GPP TS 23.501 [8]) and associated with: | | | | - GBR QoS flows, if the QoS flow includes a GFBR uplink parameter | | and a GFBR downlink parameter; and | | | | - non-GBR QoS flows, if the QoS flow does not include a GFBR uplink | | parameter or does not include a GFBR downlink parameter. | | | | The UE shall use this chosen 5QI value for internal operations only. | | The UE shall use the received 5QI value in subsequent NAS signalling | | procedures. | | | | When the parameter identifier indicates \"GFBR uplink\", the | | parameter contents field contains one octet indicating the unit of | | the guaranteed flow bit rate for uplink followed by two octets | | containing the value of the guaranteed flow bit rate for uplink. | | | | Unit of the guaranteed flow bit rate for uplink (octet 1) | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 value is not used | | | | 0 0 0 0 0 0 0 1 value is incremented in multiples of 1 Kbps | | | | 0 0 0 0 0 0 1 0 value is incremented in multiples of 4 Kbps | | | | 0 0 0 0 0 0 1 1 value is incremented in multiples of 16 Kbps | | | | 0 0 0 0 0 1 0 0 value is incremented in multiples of 64 Kbps | | | | 0 0 0 0 0 1 0 1 value is incremented in multiples of 256 Kbps | | | | 0 0 0 0 0 1 1 0 value is incremented in multiples of 1 Mbps | | | | 0 0 0 0 0 1 1 1 value is incremented in multiples of 4 Mbps | | | | 0 0 0 0 1 0 0 0 value is incremented in multiples of 16 Mbps | | | | 0 0 0 0 1 0 0 1 value is incremented in multiples of 64 Mbps | | | | 0 0 0 0 1 0 1 0 value is incremented in multiples of 256 Mbps | | | | 0 0 0 0 1 0 1 1 value is incremented in multiples of 1 Gbps | | | | 0 0 0 0 1 1 0 0 value is incremented in multiples of 4 Gbps | | | | 0 0 0 0 1 1 0 1 value is incremented in multiples of 16 Gbps | | | | 0 0 0 0 1 1 1 0 value is incremented in multiples of 64 Gbps | | | | 0 0 0 0 1 1 1 1 value is incremented in multiples of 256 Gbps | | | | 0 0 0 1 0 0 0 0 value is incremented in multiples of 1 Tbps | | | | 0 0 0 1 0 0 0 1 value is incremented in multiples of 4 Tbps | | | | 0 0 0 1 0 0 1 0 value is incremented in multiples of 16 Tbps | | | | 0 0 0 1 0 0 1 1 value is incremented in multiples of 64 Tbps | | | | 0 0 0 1 0 1 0 0 value is incremented in multiples of 256 Tbps | | | | 0 0 0 1 0 1 0 1 value is incremented in multiples of 1 Pbps | | | | 0 0 0 1 0 1 1 0 value is incremented in multiples of 4 Pbps | | | | 0 0 0 1 0 1 1 1 value is incremented in multiples of 16 Pbps | | | | 0 0 0 1 1 0 0 0 value is incremented in multiples of 64 Pbps | | | | 0 0 0 1 1 0 0 1 value is incremented in multiples of 256 Pbps | | | | Other values shall be interpreted as multiples of 256 Pbps in this | | version of the protocol. | | | | Value of the guaranteed flow bit rate for uplink (octets 2 and 3) | | | | Octets 2 and 3 represent the binary coded value of the guaranteed | | flow bit rate for uplink in units defined by the unit of the | | guaranteed flow bit rate for uplink. | | | | When the parameter identifier indicates \"GFBR downlink\", the | | parameter contents field contains one octet indicating the unit of | | the guaranteed flow bit rate for downlink followed by two octets | | containing the value of the guaranteed flow bit rate for downlink. | | | | Unit of the guaranteed flow bit rate for downlink (octet 1) | | | | The coding is identical to that of the unit of the guaranteed flow | | bit rate for uplink. | | | | Value of the guaranteed flow bit rate for downlink (octets 2 and 3) | | | | Octets 2 and 3 represent the binary coded value of the guaranteed | | flow bit rate for downlink in units defined by the unit of the | | guaranteed flow bit rate for downlink. | | | | When the parameter identifier indicates \"MFBR uplink\", the | | parameter contents field contains the one octet indicating the unit | | of the maximum flow bit rate for uplink followed by two octets | | containing the value of maximum flow bit rate for uplink. | | | | Unit of the maximum flow bit rate for uplink (octet 1) | | | | The coding is identical to that of the unit of the guaranteed flow | | bit rate for uplink. | | | | Value of the maximum flow bit rate for uplink (octets 2 and 3) | | | | Octets 2 and 3 represent the binary coded value of the maximum flow | | bit rate for uplink in units defined by the unit of the maximum flow | | bit rate for uplink. | | | | When the parameter identifier indicates \"MFBR downlink\", the | | parameter contents field contains one octet indicating the unit of | | the maximum flow bit rate for downlink followed by two octets | | containing the value of the maximum flow bit rate for downlink. | | | | Unit of the maximum flow bit rate for downlink (octet 1) | | | | The coding is identical to that of the unit of the guaranteed flow | | bit rate for uplink. | | | | Value of the maximum flow bit rate for downlink (octets 2 and 3) | | | | Octets 2 and 3 represent the binary coded value of the maximum flow | | bit rate for downlink in units defined by the unit of the maximum | | flow bit rate for downlink. | | | | When the parameter identifier indicates \"averaging window\", the | | parameter contents field contains the binary representation of the | | averaging window for both uplink and downlink in milliseconds and | | the parameter contents field is two octets in length. | | | | When the parameter identifier indicates EPS bearer identity, the | | length of EPS bearer identity is one octet and parameter contents | | field is coded as specified in subclause 9.3.2 of | | 3GPP TS 24.301 [15] (see NOTE). The UE shall not include the EPS | | bearer identity parameter in any mobile originated 5GSM messages. | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | NOTE: The total number of EPS bearer identities included in all QoS | | flow descriptions of a UE cannot exceed fifteen. | +----------------------------------------------------------------------+
#### 9.11.4.13 QoS rules
The purpose of the QoS rules information element is to indicate a set of QoS
rules to be used by the UE, where each QoS rule is a set of parameters as
described in subclause 6.2.5.1.1.2:
a) for classification and marking of uplink user traffic; and
b) for identification of a QoS flow which the network is to use for a
particular downlink user traffic.
NOTE: The UE needs to be aware of a QoS flow which the network is to use for a
particular downlink user traffic e.g. to determine whether a resource is
available for downlink media of a media stream of an SDP media description
provided by the UE in an IMS session.
The QoS rules may contain a set of packet filters consisting of zero or more
packet filters for UL direction, zero or more packet filters for DL direction,
zero or more packet filters for both UL and DL directions or any combinations
of these. The set of packet filters determine the traffic mapping to QoS
flows.
The QoS rules information element is a type 6 information element with a
minimum length of 7 octets. The maximum length for the information element is
65538 octets.
The QoS rules information element is coded as shown in figure 9.11.4.13.1,
figure 9.11.4.13.2, figure 9.11.4.13.3, figure 9.11.4.13.4 and table
9.11.4.13.1.
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| QoS rules IEI | octet 1 |  |  |  |  |  |  |   
| Length of QoS rules IE | octet 2 |  |  |  |  |  |  |   
|  | octet 3 |  |  |  |  |  |  |   
| QoS rule 1 | octet 4 octet u |  |  |  |  |  |  |   
| QoS rule 2 | octet u+1 octet v |  |  |  |  |  |  |   
| â€¦ | octet v+1 octet w |  |  |  |  |  |  |   
| QoS rule n | octet w+1 octet x |  |  |  |  |  |  |   
Figure 9.11.4.13.1: QoS rules information element
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| QoS rule identifier | octet 4 |  |  |  |  |  |  |   
| Length of QoS rule | octet 5 |  |  |  |  |  |  |   
|  | octet 6 |  |  |  |  |  |  |   
| Rule operation code | DQR bit | Number of packet filters | octet 7 |  |  |  |  |   
| Packet filter list | octet 8* octet m* |  |  |  |  |  |  |   
| QoS rule precedence | octet m+1* |  |  |  |  |  |  |   
| 0 Spare | Segregation | QoS flow identifier (QFI) | octet m+2* |  |  |  |  |   
Figure 9.11.4.13.2: QoS rule (u=m+2)
* * *
     8       7   6   5   4                            3           2   1   
     0       0   0   0   Packet filter identifier 1   octet 8             
     Spare                                                                
     0       0   0   0   Packet filter identifier 2   octet 9             
     Spare                                                                
     ...                                                                  
     0       0   0   0   Packet filter identifier N   octet N+7           
     Spare
* * *
Figure 9.11.4.13.3: Packet filter list when the rule operation is \"modify
existing QoS rule and delete packet filters\" (z=N+7)
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| 0 | 0 | Packet filter direction 1 | Packet filter identifier 1 | octet 8 |  |  |  |   
| Spare |  |  |  |  |  |  |  |   
| Length of packet filter contents 1 | octet 9 |  |  |  |  |  |  |   
| Packet filter contents 1 | octet 10 octet m |  |  |  |  |  |  |   
| 0 | 0 | Packet filter direction 2 | Packet filter identifier 2 | octet m+1 |  |  |  |   
| Spare |  |  |  |  |  |  |  |   
| Length of packet filter contents 2 | octet m+2 |  |  |  |  |  |  |   
| Packet filter contents 2 | octet m+3 octet n |  |  |  |  |  |  |   
| â€¦ | octet n+1 octet y |  |  |  |  |  |  |   
| 0 | 0 | Packet filter direction N | Packet filter identifier N | octet y+1 |  |  |  |   
| Spare |  |  |  |  |  |  |  |   
| Length of packet filter contents N | octet y+2 |  |  |  |  |  |  |   
| Packet filter contents N | octet y+3 octet z |  |  |  |  |  |  |   
Figure 9.11.4.13.4: Packet filter list when the rule operation is \"create new
QoS rule\", or \"modify existing QoS rule and add packet filters\" or \"modify
existing QoS rule and replace all packet filters\"
Table 9.11.4.13.1: QoS rules information element
+----------------------------------------------------------------------+ | QoS rule identifier (octet 4) | | | | The QoS rule identifier field is used to identify the QoS rule. | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 no QoS rule identifier assigned | | | | 0 0 0 0 0 0 0 1 QRI 1 | | | | to | | | | 1 1 1 1 1 1 1 1 QRI 255 | | | | The network shall not set the QRI value to 0. | | | | QoS rule precedence (octet m+1) | | | | The QoS rule precedence field is used to specify the precedence of | | the QoS rule among all QoS rules (both the signalled QoS rules as | | described in subclause 6.2.5.1.1.2 and the derived QoS rules as | | described in subclause 6.2.5.1.1.3) associated with the PDU session | | of the QoS flow. This field includes the binary coded value of the | | QoS rule precedence in the range from 0 to 255 (decimal). The higher | | the value of the QoS rule precedence field, the lower the precedence | | of that QoS rule is. For the \"delete existing QoS rule\" operation, | | the QoS rule precedence value field shall not be included. For the | | \"create new QoS rule\" operation, the QoS rule precedence value | | field shall be included. | | | | The value 80 (decimal) is reserved. | | | | Segregation bit (bit 7 of octet m+2) (see NOTE 1) | | | | In the UE to network direction the segregation bit indicates whether | | the UE is requesting the network to bind service data flows | | described by the QoS rule to a dedicated QoS Flow and it is encoded | | as follows. In the network to UE direction this bit is spare. | | | | Bit | | | | 7 | | | | 0 Segregation not requested | | | | 1 Segregation requested | | | | QoS flow identifier (QFI) (bits 6 to 1 of octet m+2) (see NOTE 1) | | | | The QoS flow identifier (QFI) field contains the QoS flow | | identifier. | | | | Bits | | | | 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 no QoS flow identifier assigned | | | | 0 0 0 0 0 1 QFI 1 | | | | to | | | | 1 1 1 1 1 1 QFI 63 | | | | The network shall not set the QFI value to 0. | | | | For the \"delete existing QoS rule\" operation, the QoS flow | | identifier value field shall not be included. For the \"create new | | QoS rule\" operation, the QoS flow identifier value field shall be | | included. | | | | DQR bit (bit 5 of octet 7) | | | | The DQR bit indicates whether the QoS rule is the default QoS rule | | and it is encoded as follows: | | | | Bit | | | | 5 | | | | 0 the QoS rule is not the default QoS rule. | | | | 1 the QoS rule is the default QoS rule. | | | | Rule operation code (bits 8 to 6 of octet 7)\ | | Bits\ | | 8 7 6 | | | | 0 0 0 Reserved\ | | 0 0 1 Create new QoS rule | | | | 0 1 0 Delete existing QoS rule | | | | 0 1 1 Modify existing QoS rule and add packet filters | | | | 1 0 0 Modify existing QoS rule and replace all packet filters | | | | 1 0 1 Modify existing QoS rule and delete packet filters | | | | 1 1 0 Modify existing QoS rule without modifying packet filters | | | | 1 1 1 Reserved | | | | Number of packet filters (bits 4 to 1 of octet 7) | | | | The number of packet filters contains the binary coding for the | | number of packet filters in the packet filter list. The number of | | packet filters field is encoded in bits 4 through 1 of octet 7 where | | bit 4 is the most significant and bit 1 is the least significant | | bit. For the \"delete existing QoS rule\" operation and for the | | \"modify existing QoS rule without modifying packet filters\" | | operation, the number of packet filters shall be coded as 0. For the | | \"create new QoS rule\" operation and the \"modify existing QoS rule | | and replace all packet filters\" operation, the number of packet | | filters shall be greater than or equal to 0 and less than or equal | | to 15. For all other operations, the number of packet filters shall | | be greater than 0 and less than or equal to 15. | | | | Packet filter list (octets 8 to m) | | | | The packet filter list contains a variable number of packet filters. | | | | For the \"delete existing QoS rule\" operation, the length of QoS | | rule field is set to one. | | | | For the \"delete existing QoS rule\" operation and the \"modify | | existing QoS rule without modifying packet filters\" operation, the | | packet filter list shall be empty. | | | | For the \"modify existing QoS rule and delete packet filters\" | | operation, the packet filter list shall contain a variable number of | | packet filter identifiers. This number shall be derived from the | | coding of the number of packet filters field in octet 7. | | | | For the \"create new QoS rule\" operation and for the \"modify | | existing QoS rule and replace all packet filters\" operation, the | | packet filter list shall contain 0 or a variable number of packet | | filters. This number shall be derived from the coding of the number | | of packet filters field in octet 7. | | | | For the \"modify existing QoS rule and add packet filters\" | | operation, the packet filter list shall contain a variable number of | | packet filters. This number shall be derived from the coding of the | | number of packet filters field in octet 7. | | | | Each packet filter is of variable length and consists of | | | | a packet filter direction (2 bits);\ | | - a packet filter identifier (4 bits);\ | | - the length of the packet filter contents (1 octet); and\ | | - the packet filter contents itself (variable amount of octets). | | | | The _packet filter direction_ field is used to indicate for what | | traffic direction the filter applies. | | | | Bits | | | | 6 5 | | | | 0 0 reserved | | | | 0 1 downlink only | | | | 1 0 uplink only | | | | 1 1 bidirectional (see NOTE) | | | | The packet filter identifier field is used to identify each packet | | filter in a QoS rule. The least significant 4 bits are used. | | | | The length of the packet filter contents field contains the binary | | coded representation of the length of the packet filter contents | | field of a packet filter. The first bit in transmission order is the | | most significant bit. | | | | The packet filter contents field is of variable size and contains a | | variable number (at least one) of packet filter components. Each | | packet filter component shall be encoded as a sequence of a one | | octet packet filter component type identifier and a fixed length | | packet filter component value field. The packet filter component | | type identifier shall be transmitted first. | | | | In each packet filter, there shall not be more than one occurrence | | of each packet filter component type. Among the \"IPv4 remote | | address type\" and \"IPv6 remote address/prefix length type\" packet | | filter components, only one shall be present in one packet filter. | | Among the \"IPv4 local address type\" and \"IPv6 local | | address/prefix length type\" packet filter components, only one | | shall be present in one packet filter. Among the \"single local port | | type\" and \"local port range type\" packet filter components, only | | one shall be present in one packet filter. Among the \"single remote | | port type\" and \"remote port range type\" packet filter components, | | only one shall be present in one packet filter. If the \"match-all | | type\" packet filter component is present in the packet filter, no | | other packet filter component shall be present in the packet filter | | and the length of the packet filter contents field shall be set to | | one. | | | | The term local refers to the UE and the term remote refers to an | | external network entity. | | | | Packet filter component type identifier\ | | Bits\ | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 1 Match-all type\ | | 0 0 0 1 0 0 0 0 IPv4 remote address type\ | | 0 0 0 1 0 0 0 1 IPv4 local address type\ | | 0 0 1 0 0 0 0 1 IPv6 remote address/prefix length type\ | | 0 0 1 0 0 0 1 1 IPv6 local address/prefix length type\ | | 0 0 1 1 0 0 0 0 Protocol identifier/Next header type\ | | 0 1 0 0 0 0 0 0 Single local port type\ | | 0 1 0 0 0 0 0 1 Local port range type\ | | 0 1 0 1 0 0 0 0 Single remote port type\ | | 0 1 0 1 0 0 0 1 Remote port range type\ | | 0 1 1 0 0 0 0 0 Security parameter index type\ | | 0 1 1 1 0 0 0 0 Type of service/Traffic class type\ | | 1 0 0 0 0 0 0 0 Flow label type | | | | 1 0 0 0 0 0 0 1 Destination MAC address type\ | | 1 0 0 0 0 0 1 0 Source MAC address type\ | | 1 0 0 0 0 0 1 1 802.1Q C-TAG VID type\ | | 1 0 0 0 0 1 0 0 802.1Q S-TAG VID type\ | | 1 0 0 0 0 1 0 1 802.1Q C-TAG PCP/DEI type\ | | 1 0 0 0 0 1 1 0 802.1Q S-TAG PCP/DEI type\ | | 1 0 0 0 0 1 1 1 Ethertype type | | | | All other values are reserved. | | | | The description and valid combinations of packet filter component | | type identifiers in a packet filter are defined in | | 3GPP TS 23.**501 [8]**. | | | | For \"match-all type\", the packet filter component shall not | | include the packet filter component value field. | | | | For \"IPv4 remote address type\", the packet filter component value | | field shall be encoded as a sequence of a four octet IPv4 address | | field and a four octet IPv4 address mask field. The IPv4 address | | field shall be transmitted first. | | | | For \"IPv4 local address type\", the packet filter component value | | field shall be encoded as defined for \"IPv4 remote address type\". | | | | For \"IPv6 remote address/prefix length type\", the packet filter | | component value field shall be encoded as a sequence of a sixteen | | octet IPv6 address field and one octet prefix length field. The IPv6 | | address field shall be transmitted first. | | | | For \"IPv6 local address/prefix length type\", the packet filter | | component value field shall be encoded as defined for \"IPv6 remote | | address /prefix length\". | | | | For \"protocol identifier/Next header type\", the packet filter | | component value field shall be encoded as one octet which specifies | | the IPv4 protocol identifier or Ipv6 next header. | | | | For \"single local port type\" and \"single remote port type\", the | | packet filter component value field shall be encoded as two octets | | which specify a port number. | | | | For \"local port range type\" and \"remote port range type\", the | | packet filter component value field shall be encoded as a sequence | | of a two octet port range low limit field and a two octet port range | | high limit field. The port range low limit field shall be | | transmitted first. | | | | For \"security parameter index\", the packet filter component value | | field shall be encoded as four octets which specify the IPSec | | security parameter index. | | | | For \"type of service/traffic class type\", the packet filter | | component value field shall be encoded as a sequence of a one octet | | type-of-service/traffic class field and a one octet | | type-of-service/traffic class mask field. The | | type-of-service/traffic class field shall be transmitted first. | | | | For \"flow label type\", the packet filter component value field | | shall be encoded as three octets which specify the IPv6 flow label. | | The bits 8 through 5 of the first octet shall be spare whereas the | | remaining 20 bits shall contain the IPv6 flow label. | | | | For \"destination MAC address type\" and \"source MAC address | | type\", the packet filter component value field shall be encoded as | | 6 octets which specify a MAC address. | | | | For \"802.1Q C-TAG VID type\", the packet filter component value | | field shall be encoded as two octets which specify the VID of the | | customer-VLAN tag (C-TAG). The bits 8 through 5 of the first octet | | shall be spare whereas the remaining 12 bits shall contain the VID. | | | | For \"802.1Q S-TAG VID type\", the packet filter component value | | field shall be encoded as two octets which specify the VID of the | | service-VLAN tag (S-TAG). The bits 8 through 5 of the first octet | | shall be spare whereas the remaining 12 bits shall contain the VID. | | | | For \"802.1Q C-TAG PCP/DEI type\", the packet filter component value | | field shall be encoded as one octet which specifies the 802.1Q C-TAG | | PCP and DEI. The bits 8 through 5 of the octet shall be spare, the | | bits 4 through 2 contain the PCP and bit 1 contains the DEI. | | | | For \"802.1Q S-TAG PCP/DEI type\", the packet filter component value | | field shall be encoded as one octet which specifies the 802.1Q S-TAG | | PCP. The bits 8 through 5 of the octet shall be spare, the bits 4 | | through 2 contain the PCP and bit 1 contains the DEI. | | | | For \"ethertype type\", the packet filter component value field | | shall be encoded as two octets which specify an ethertype. | +----------------------------------------------------------------------+ | NOTE 1: Octet m+2 shall not be included without octet m+1. | +----------------------------------------------------------------------+
#### 9.11.4.14 Session-AMBR
The purpose of the Session-AMBR information element is to indicate the initial
subscribed PDU session aggregate maximum bit rate when the UE establishes a
PDU session or to indicate the new subscribed PDU session aggregate maximum
bit rate if it is changed by the network.
The Session-AMBR information element is coded as shown in figure 9.11.4.14.1
and table 9.11.4.14.1.
The Session-AMBR is a type 4 information element with a length of 8 octets.
* * *
8 7 6 5 4 3 2 1  
Session-AMBR IEI octet 1  
Length of Session-AMBR contents octet 2  
Unit for Session-AMBR for downlink octet 3  
Session-AMBR for downlink octet 4-5  
Unit for Session-AMBR for uplink octet 6  
Session-AMBR for uplink octet 7-8
* * *
Figure 9.11.4.14.1: Session-AMBR information element
Table 9.11.4.14.1: Session-AMBR information element
+----------------------------------------------------------------------+ | Unit for Session-AMBR for downlink (octet 3) | | | | 0 0 0 0 0 0 0 0 value is not used | | | | 0 0 0 0 0 0 0 1 value is incremented in multiples of 1 Kbps | | | | 0 0 0 0 0 0 1 0 value is incremented in multiples of 4 Kbps | | | | 0 0 0 0 0 0 1 1 value is incremented in multiples of 16 Kbps | | | | 0 0 0 0 0 1 0 0 value is incremented in multiples of 64 Kbps | | | | 0 0 0 0 0 1 0 1 value is incremented in multiples of 256 kbps | | | | 0 0 0 0 0 1 1 0 value is incremented in multiples of 1 Mbps | | | | 0 0 0 0 0 1 1 1 value is incremented in multiples of 4 Mbps | | | | 0 0 0 0 1 0 0 0 value is incremented in multiples of 16 Mbps | | | | 0 0 0 0 1 0 0 1 value is incremented in multiples of 64 Mbps | | | | 0 0 0 0 1 0 1 0 value is incremented in multiples of 256 Mbps | | | | 0 0 0 0 1 0 1 1 value is incremented in multiples of 1 Gbps | | | | 0 0 0 0 1 1 0 0 value is incremented in multiples of 4 Gbps | | | | 0 0 0 0 1 1 0 1 value is incremented in multiples of 16 Gbps | | | | 0 0 0 0 1 1 1 0 value is incremented in multiples of 64 Gbps | | | | 0 0 0 0 1 1 1 1 value is incremented in multiples of 256 Gbps | | | | 0 0 0 1 0 0 0 0 value is incremented in multiples of 1 Tbps | | | | 0 0 0 1 0 0 0 1 value is incremented in multiples of 4 Tbps | | | | 0 0 0 1 0 0 1 0 value is incremented in multiples of 16 Tbps | | | | 0 0 0 1 0 0 1 1 value is incremented in multiples of 64 Tbps | | | | 0 0 0 1 0 1 0 0 value is incremented in multiples of 256 Tbps | | | | 0 0 0 1 0 1 0 1 value is incremented in multiples of 1 Pbps | | | | 0 0 0 1 0 1 1 0 value is incremented in multiples of 4 Pbps | | | | 0 0 0 1 0 1 1 1 value is incremented in multiples of 16 Pbps | | | | 0 0 0 1 1 0 0 0 value is incremented in multiples of 64 Pbps | | | | 0 0 0 1 1 0 0 1 value is incremented in multiples of 256 Pbps | | | | Other values shall be interpreted as multiples of 256 Pbps in this | | version of the protocol. | | | | Session-AMBR for downlink (octets 4 and 5) | | | | Octets 4 and 5 represent the binary coded value of PDU session | | aggregated maximum bit rate for downlink in units defined by octet | | 3. | | | | Unit for Session-AMBR for uplink (octet 6) | | | | The coding is identical to the unit coding defined for Session-AMBR | | for downlink (octet 3) | | | | Session-AMBR for uplink (octets 7 and 8) | | | | Octets 7 and 8 represent the binary coded value of PDU session | | aggregated maximum bit rate for uplink in units defined by octet 6. | +----------------------------------------------------------------------+
#### 9.11.4.15 SM PDU DN request container
The purpose of the SM PDU DN request container information element is to carry
a DN-specific identity of the UE in the network access identifier (NAI)
format.
The SM PDU DN request container information element is coded as shown in
figure 9.11.4.15.1 and table 9.11.4.15.1.
The SM PDU DN request container is a type 4 information element with minimal
length of 3 octets and maximum length of 255 octets.
* * *
8 7 6 5 4 3 2 1  
SM PDU DN request container information IEI octet 1  
SM PDU DN request container information length octet 2  
DN-specific identity octets 3*-n*
* * *
Figure 9.11.4.15.1: SM PDU DN request container information element
Table 9.11.4.15.1: SM PDU DN request container information element
+----------------------------------------------------------------------+ | DN-specific identity (octet 3 to octet n) | | | | A DN-specific identity of the UE in the network access identifier | | (NAI) format according to IETF RFC 7542 [37], encoded as UTF-8 | | string. | +----------------------------------------------------------------------+
#### 9.11.4.16 SSC mode
The purpose of the SSC mode information element is to indicate SSC mode.
The SSC mode information element is coded as shown in figure 9.11.4.16.1 and
table 9.11.4.16.1.
The SSC mode is a type 1 information element.
+--------------+-------+----------------+---------+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------+-------+----------------+---------+---+---+---+---+---+ | SSC mode IEI | 0 | SSC mode value | octet 1 | | | | | | | | | | | | | | | | | | Spare | | | | | | | | +--------------+-------+----------------+---------+---+---+---+---+---+
Figure 9.11.4.16.1: SSC mode information element
Table 9.11.4.16.1: SSC mode information element
SSC mode value (octet 1, bit 1 to bit 4)
* * *
Bits  
3 2 1  
0 0 1 SSC mode 1 0 1 0 SSC mode 2 0 1 1 SSC mode 3 1 0 0 unused; shall be
interpreted as \"SSC mode 1\", if received by the network 1 0 1 unused; shall
be interpreted as \"SSC mode 2\", if received by the network 1 1 0 unused;
shall be interpreted as \"SSC mode 3\", if received by the network
All other values are reserved.
## 9.12 3GPP specific coding information defined within present document
### 9.12.1 Serving network name (SNN)
The serving network name (SNN) is used:
\- in the Network name field of the AT_KDF_INPUT attribute defined in _IETF
RFC 5448_ [40];
\- in K~AUSF~ derivation function as specified in 3GPP TS 33.501 [24] annex A;
and
\- in RES* and XRES* derivation function as specified in 3GPP TS 33.501 [24]
annex A.
SNN shall contain a UTF-8 string without terminating null characters.
SNN is of maximum length of 1020 octets.
SNN consists of SNN-service-code and SNN-network-identifier, delimited by a
colon.
SNN-network-identifier identifies the serving PLMN.
MCC and MNC in the SNN-PLMN-ID are MCC and MNC of the serving PLMN. If the MNC
of the serving PLMN has two digits, then a zero is added at the beginning.
ABNF syntax of SNN is specified in table 9.12.1.1
Table 9.12.1.1: ABNF syntax of SNN
SNN = SNN-service-code \":\" SNN-network-identifier
SNN-service-code = %x35.47 ; \"5G\"
SNN-network-identifier = SNN-PLMN-ID
SNN-PLMN-ID = SNN-mnc-string SNN-mnc-digits \".\" SNN-mcc-string SNN-mcc-
digits \".\" SNN-3gppnetwork-string \".\" SNN-org-string
SNN-mnc-digits = DIGIT DIGIT DIGIT ; MNC of the PLMN ID
SNN-mcc-digits = DIGIT DIGIT DIGIT ; MCC of the PLMN ID
SNN-mnc-string = %x6d.6e.63 ; \"mnc\" in lower case
SNN-mcc-string = %x6d.63.63 ; \"mcc\" in lower case
SNN-3gppnetwork-string = %x33.67.70.70.6e.65.74.77.6f.72.6b ; \"3gppnetwork\"
in lower case
SNN-org-string = %x6f.72.67 ; \"org\" in lower case
NOTE: SNN-service-code allows for distinguishing of ANID specified in 3GPP TS
24.302 [16] and SNN as either of SNN or ANID can be carried in the
AT_KDF_INPUT attribute.
EXAMPLE: If PLMN ID contains MCC = 234 and MNC = 15, SNN is
5G:mnc015.mcc234.3gppnetwork.org.
# 10 List of system parameters
## 10.1 General
The description of timers in the following tables should be considered a brief
summary. The precise details are found in clauses 4 to 6, which should be
considered the definitive descriptions.
## 10.2 Timers of 5GS mobility management
Timers of 5GS mobility management are shown in table 10.2.1 and table 10.2.2
NOTE: Timer T3346 is defined in 3GPP TS 24.008 [12]. Timers T3444 and T3445
are defined in 3GPP TS 24.301 [15].
Table 10.2.1: Timers of 5GS mobility management -- UE side
+----------+----------+----------+----------+----------+----------+ | TIMER | TIMER | STATE | CAUSE OF | NORMAL | ON\ | | NUM. | VALUE | | START | STOP | EXPIRY | +----------+----------+----------+----------+----------+----------+ | T3510 | 15s | 5 | Tran | REGI | Start | | | | GMM-REGI | smission | STRATION | T3511 or | | | | STERED-I | of | ACCEPT | T3502 as | | | | NITIATED | REGI | message | s | | | | | STRATION | received | pecified | | | | | REQUEST | or | in | | | | | message | REGI | sub | | | | | | STRATION | clause 5 | | | | | | REJECT | .5.1.2.7 | | | | | | message | if T3510 | | | | | | received | expired | | | | | | | during | | | | | | | regi | | | | | | | stration | | | | | | | p | | | | | | | rocedure | | | | | | | for | | | | | | | initial | | | | | | | regis | | | | | | | tration. | | | | | | | | | | | | | | Start | | | | | | | T3511 or | | | | | | | T3502 as | | | | | | | s | | | | | | | pecified | | | | | | | in | | | | | | | sub | | | | | | | clause 5 | | | | | | | .5.1.3.7 | | | | | | | if T3510 | | | | | | | expired | | | | | | | during | | | | | | | the | | | | | | | regi | | | | | | | stration | | | | | | | p | | | | | | | rocedure | | | | | | | for | | | | | | | mobility | | | | | | | and | | | | | | | periodic | | | | | | | regi | | | | | | | stration | | | | | | | update | +----------+----------+----------+----------+----------+----------+ | T3502 | Default | 5 | At | Tran | In | | | 12 min. | GMM-DERE | regi | smission | itiation | | | | GISTERED | stration | of | of the | | | NOTE 1 | 5GMM-RE | failure | REGI | regi | | | | GISTERED | and the | STRATION | stration | | | | | attempt | REQUEST | pr | | | | | counter | message | ocedure, | | | | | is equal | | if still | | | | | to 5 | | required | +----------+----------+----------+----------+----------+----------+ | T3511 | 10s | 5 | At | Tran | Retran | | | | GMM-DERE | regi | smission | smission | | | | GISTERED | stration | of | of the | | | | .ATTEMPT | failure | REGI | REGI | | | | ING-REGI | due to | STRATION | STRATION | | | | STRATION | lower | REQUEST | REQUEST, | | | | | layer | message | if still | | | | 5GMM-R | failure, | | required | | | | EGISTERE | T3510 | 5GMM-C | | | | | D.ATTEMP | timeout | ONNECTED | | | | | TING-REG | or | mode | | | | | ISTRATIO | regi | entered | | | | | N-UPDATE | stration | (NOTE 5) | | | | | | rejected | | | | | | 5GMM-R | with | | | | | | EGISTERE | other | | | | | | D.NORMAL | 5GMM | | | | | | -SERVICE | cause | | | | | | | values | | | | | | | than | | | | | | | those | | | | | | | treated | | | | | | | in | | | | | | | sub | | | | | | | clause 5 | | | | | | | .5.1.2.5 | | | | | | | for | | | | | | | initial | | | | | | | regi | | | | | | | stration | | | | | | | or | | | | | | | sub | | | | | | | clause 5 | | | | | | | .5.1.3.5 | | | | | | | for | | | | | | | mobility | | | | | | | and | | | | | | | periodic | | | | | | | regi | | | | | | | stration | | | +----------+----------+----------+----------+----------+----------+ | T3512 | Default | 5GMM-RE | In | When | In | | | 54 min | GISTERED | 5GMM-REG | entering | itiation | | | | | ISTERED, | state | of the | | | NOTE 1 | | when | 5 | periodic | | | | | 5GMM-C | GMM-DERE | regi | | | NOTE 2 | | ONNECTED | GISTERED | stration | | | | | mode is | or when | p | | | | | left | entering | rocedure | | | | | | 5GMM-C | if the | | | | | | ONNECTED | UE is | | | | | | mode | not | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | s | | | | | | | ervices. | | | | | | | | | | | | | | Locally | | | | | | | de | | | | | | | register | | | | | | | if the | | | | | | | UE is | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | services | +----------+----------+----------+----------+----------+----------+ | T3516 | 30s | 5 | RAND and | SECURITY | Delete | | | | GMM-REGI | RES* | MODE | the | | | | STERED-I | stored | COMMAND | stored | | | | NITIATED | as a | received | RAND and | | | | | result | | RES* | | | | 5GMM-RE | of an 5G | SERVICE | | | | | GISTERED | authen | REJECT | | | | | | tication | received | | | | | 5GM | c | | | | | | M-DEREGI | hallenge | REGI | | | | | STERED-I | | STRATION | | | | | NITIATED | | ACCEPT | | | | | | | received | | | | | 5GMM-S | | | | | | | ERVICE-R | | AUTHEN | | | | | EQUEST-I | | TICATION | | | | | NITIATED | | REJECT | | | | | | | received | | | | | | | | | | | | | | AUTHEN | | | | | | | TICATION | | | | | | | FAILURE | | | | | | | sent | | | | | | | | | | | | | | 5G | | | | | | | MM-DEREG | | | | | | | ISTERED, | | | | | | | 5 | | | | | | | GMM-NULL | | | | | | | or | | | | | | | | | | | | | | 5 | | | | | | | GMM-IDLE | | | | | | | mode | | | | | | | entered | | +----------+----------+----------+----------+----------+----------+ | T3517 | 15s | 5GMM-S | Tran | (a) | Abort | | | | ERVICE-R | smission | In | the | | | | EQUEST-I | of | dication | p | | | | NITIATED | SERVICE | from the | rocedure | | | | | REQUEST | lower | | | | | | message | layers | | | | | | | that the | | | | | | | UE has | | | | | | | changed | | | | | | | to S1 | | | | | | | mode or | | | | | | | E-UTRA | | | | | | | c | | | | | | | onnected | | | | | | | to 5GCN | | | | | | | for case | | | | | | | h) in | | | | | | | su | | | | | | | bclause | | | | | | | 5.6.1.1; | | | | | | | or | | | | | | | | | | | | | | (b) | | | | | | | SERVICE | | | | | | | ACCEPT | | | | | | | message | | | | | | | r | | | | | | | eceived, | | | | | | | or | | | | | | | | | | | | | | SERVICE | | | | | | | REJECT | | | | | | | message | | | | | | | received | | | | | | | for | | | | | | | cases | | | | | | | other | | | | | | | than h) | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 5.6.1.1 | | +----------+----------+----------+----------+----------+----------+ | T3519 | 60s | 5 | Tran | REGI | Delete | | | | GMM-REGI | smission | STRATION | stored | | | | STERED-I | of | ACCEPT | SUCI | | | | NITIATED | IDENTITY | message | | | | | | RESPONSE | with new | | | | | | message, | 5G-GUTI | | | | | | REGI | received | | | | | | STRATION | | | | | | | REQUEST | CONFI | | | | | | message, | GURATION | | | | | | or | UPDATE | | | | | | DEREGI | COMMAND | | | | | | STRATION | message | | | | | | REQUEST | with new | | | | | | message | 5G-GUTI | | | | | | with | received | | | | | | freshly | DEREGI | | | | | | g | STRATION | | | | | | enerated | ACCEPT | | | | | | SUCI | message | | +----------+----------+----------+----------+----------+----------+ | T3520 | 15s | 5 | Tran | AUTHEN | On first | | | | GMM-REGI | smission | TICATION | expiry | | | | STERED-I | of | REQUEST | during a | | | | NITIATED | AUTHEN | message | 5G AKA | | | | | TICATION | received | based | | | | 5GMM-RE | FAILURE | or | primary | | | | GISTERED | message | AUTHEN | authen | | | | | with any | TICATION | tication | | | | 5GM | of the | REJECT | and key | | | | M-DEREGI | 5GMM | message | a | | | | STERED-I | cause | received | greement | | | | NITIATED | #20, | | pr | | | | | #21, | or | ocedure, | | | | 5GMM-S | #26 or | | the UE | | | | ERVICE-R | #71 | SECURITY | should | | | | EQUEST-I | | MODE | consider | | | | NITIATED | Tran | COMMAND | the | | | | | smission | message | network | | | | | of | received | as false | | | | | AUTHEN | | and | | | | | TICATION | when | follow | | | | | RESPONSE | entering | item g | | | | | message | 5 | of | | | | | with an | GMM-IDLE | subc | | | | | EAP- | mode | lause 5. | | | | | response | | 4.1.3.7, | | | | | message | in | if the | | | | | after | dication | UE is | | | | | d | of | not | | | | | etection | tran | re | | | | | of an | smission | gistered | | | | | error as | failure | for | | | | | d | of | e | | | | | escribed | AUTHEN | mergency | | | | | in | TICATION | s | | | | | subcl | FAILURE | ervices. | | | | | ause 5.4 | message | | | | | | .1.2.2.4 | from | On first | | | | | | lower | expiry | | | | | | layers | during a | | | | | | | 5G AKA | | | | | | | based | | | | | | | primary | | | | | | | authen | | | | | | | tication | | | | | | | and key | | | | | | | a | | | | | | | greement | | | | | | | pr | | | | | | | ocedure, | | | | | | | the UE | | | | | | | will | | | | | | | follow | | | | | | | sub | | | | | | | clause 5 | | | | | | | .4.1.3.7 | | | | | | | under | | | | | | | \"For | | | | | | | items c, | | | | | | | d, e and | | | | | | | f:\", if | | | | | | | the UE | | | | | | | is | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | s | | | | | | | ervices. | | | | | | | | | | | | | | On first | | | | | | | expiry | | | | | | | during | | | | | | | an EAP | | | | | | | based | | | | | | | primary | | | | | | | authen | | | | | | | tication | | | | | | | and key | | | | | | | a | | | | | | | greement | | | | | | | pr | | | | | | | ocedure, | | | | | | | the UE | | | | | | | should | | | | | | | consider | | | | | | | the | | | | | | | network | | | | | | | as false | | | | | | | and | | | | | | | follow | | | | | | | item e | | | | | | | of | | | | | | | subcla | | | | | | | use 5.4. | | | | | | | 1.2.4.5, | | | | | | | if the | | | | | | | UE is | | | | | | | not | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | s | | | | | | | ervices. | | | | | | | | | | | | | | On first | | | | | | | expiry | | | | | | | during | | | | | | | an EAP | | | | | | | based | | | | | | | primary | | | | | | | authen | | | | | | | tication | | | | | | | and key | | | | | | | a | | | | | | | greement | | | | | | | pr | | | | | | | ocedure, | | | | | | | the UE | | | | | | | will | | | | | | | follow | | | | | | | subcl | | | | | | | ause 5.4 | | | | | | | .1.2.4.5 | | | | | | | under | | | | | | | \"For | | | | | | | item | | | | | | | e:\", if | | | | | | | the UE | | | | | | | is | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | services | +----------+----------+----------+----------+----------+----------+ | T3521 | 15s | 5GM | Tran | DEREGI | Retran | | | | M-DEREGI | smission | STRATION | smission | | | | STERED-I | of | ACCEPT | of | | | | NITIATED | DEREGI | message | DEREGI | | | | | STRATION | received | STRATION | | | | | REQUEST | | REQUEST | | | | | message | | message | | | | | when | | | | | | | de-regi | | | | | | | stration | | | | | | | p | | | | | | | rocedure | | | | | | | is not | | | | | | | due to a | | | | | | | \"switch | | | | | | | off\" | | | +----------+----------+----------+----------+----------+----------+ | T3525 | Default | 5GMM-R | T3517 | When | The UE | | | 60s | EGISTERE | expires | entering | may | | | | D.NORMAL | and | state | initiate | | | NOTE 3 | -SERVICE | service | other | service | | | | | request | than | request | | | | | attempt | 5GMM-R | p | | | | | counter | EGISTERE | rocedure | | | | | is | D.NORMAL | | | | | | greater | -SERVICE | | | | | | than or | state, | | | | | | equal to | | | | | | | 5 | or | | | | | | | | | | | | | | UE | | | | | | | camped | | | | | | | on a new | | | | | | | PLMN | | | | | | | other | | | | | | | than the | | | | | | | PLMN on | | | | | | | which | | | | | | | timer | | | | | | | started, | | | | | | | | | | | | | | or | | | | | | | | | | | | | | Us | | | | | | | er-plane | | | | | | | r | | | | | | | esources | | | | | | | est | | | | | | | ablished | | | | | | | with the | | | | | | | network | | +----------+----------+----------+----------+----------+----------+ | T3540 | 10s | 5 | REGI | N1 NAS | Release | | | | GMM-REGI | STRATION | si | the NAS | | | | STERED-I | REJECT | gnalling | si | | | | NITIATED | message | co | gnalling | | | | | or | nnection | co | | | | 5GM | DEREGI | released | nnection | | | | M-DEREGI | STRATION | | for the | | | | STERED-I | REQUEST | PDU | cases | | | | NITIATED | message | sessions | a), b) | | | | | received | have | and f) | | | | 5GMM-S | with any | been set | as | | | | ERVICE-R | of the | up | d | | | | EQUEST-I | 5GMM | | escribed | | | | NITIATED | cause | | in | | | | | #7, | | s | | | | | #11, | | ubclause | | | | | #12, | | 5.3.1.3 | | | | | #13, | | | | | | | #15, | | | | | | | #27 or | | | | | | | #72 | | | | | | | | | | | | | | SERVICE | | | | | | | REJECT | | | | | | | message | | | | | | | received | | | | | | | with any | | | | | | | of the | | | | | | | 5GMM | | | | | | | cause | | | | | | | #7, | | | | | | | #11, | | | | | | | #12, | | | | | | | #13, | | | | | | | #15, | | | | | | | #27 or | | | | | | | #72. | | | | | | | | | | | | | | REGI | | | | | | | STRATION | | | | | | | ACCEPT | | | | | | | message | | | | | | | received | | | | | | | as | | | | | | | d | | | | | | | escribed | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 5.3.1.3 | | | | | | | case b) | | | | | | | | | | | | | | SERVICE | | | | | | | ACCEPT | | | | | | | message | | | | | | | received | | | | | | | as | | | | | | | d | | | | | | | escribed | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 5.3.1.3 | | | | | | | case f) | | | +----------+----------+----------+----------+----------+----------+ | | | 5GMM-RE | CONFI | N1 NAS | Release | | | | GISTERED | GURATION | si | the NAS | | | | | UPDATE | gnalling | si | | | | | COMMAND | co | gnalling | | | | | message | nnection | co | | | | | received | released | nnection | | | | | as | | for the | | | | | d | | case e) | | | | | escribed | | and | | | | | in | | perform | | | | | s | | a new | | | | | ubclause | | regi | | | | | 5.3.1.3 | | stration | | | | | case e) | | p | | | | | | | rocedure | | | | | | | as | | | | | | | d | | | | | | | escribed | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 5 | | | | | | | .5.1.3.2 | +----------+----------+----------+----------+----------+----------+ | | | 5 | REGI | | Release | | | | GMM-DERE | STRATION | | the NAS | | | | GISTERED | REJECT | | si | | | | | message | | gnalling | | | | 5GMM-DER | or | | co | | | | EGISTERE | SERVICE | | nnection | | | | D.NORMAL | REJECT | | for the | | | | -SERVICE | message | | cases c) | | | | | received | | and d) | | | | | with the | | as | | | | | 5GMM | | d | | | | | cause | | escribed | | | | | #9 or | | in | | | | | #10 | | s | | | | | | | ubclause | | | | | | | 5.3.1.3 | | | | | | | and | | | | | | | in | | | | | | | itiation | | | | | | | of the | | | | | | | regi | | | | | | | stration | | | | | | | p | | | | | | | rocedure | | | | | | | as | | | | | | | s | | | | | | | pecified | | | | | | | in | | | | | | | sub | | | | | | | clause 5 | | | | | | | .5.1.2.2 | | | | | | | or | | | | | | | 5 | | | | | | | .5.1.3.2 | +----------+----------+----------+----------+----------+----------+ | Non-3GPP | Default | All 5GMM | Entering | N1 NAS | Im | | de-regi | 54 min. | state | 5 | si | plicitly | | stration | | over | GMM-IDLE | gnalling | de- | | timer | NOTE 1 | non-3GPP | mode | co | register | | | | access | over | nnection | the UE | | | NOTE 2 | except | non-3GPP | over | for | | | | 5 | access | non-3GPP | non-3GPP | | | NOTE 4 | GMM-DERE | | access | access | | | | GISTERED | | est | on 1st | | | | over | | ablished | expiry | | | | non-3GPP | | or when | | | | | access | | entering | | | | | | | state | | | | | | | 5 | | | | | | | GMM-DERE | | | | | | | GISTERED | | | | | | | over | | | | | | | non-3GPP | | | | | | | access | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | provided | | | | | | | by the | | | | | | | network | | | | | | | operator | | | | | | | during | | | | | | | the | | | | | | | regi | | | | | | | stration | | | | | | | pr | | | | | | | ocedure. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | default | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | used if | | | | | | | the | | | | | | | network | | | | | | | does not | | | | | | | indicate | | | | | | | a value | | | | | | | in the | | | | | | | REGI | | | | | | | STRATION | | | | | | | ACCEPT | | | | | | | message | | | | | | | and the | | | | | | | UE does | | | | | | | not have | | | | | | | a stored | | | | | | | value | | | | | | | for this | | | | | | | timer. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | UE | | | | | | | implem | | | | | | | entation | | | | | | | s | | | | | | | pecific, | | | | | | | with a | | | | | | | minimum | | | | | | | value of | | | | | | | 60 | | | | | | | seconds. | | | | | | | | | | | | | | NOTE 4: | | | | | | | If the | | | | | | | T3346 | | | | | | | value | | | | | | | received | | | | | | | in the | | | | | | | mobility | | | | | | | ma | | | | | | | nagement | | | | | | | messages | | | | | | | is | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | the | | | | | | | non-3GPP | | | | | | | de-regi | | | | | | | stration | | | | | | | timer, | | | | | | | the UE | | | | | | | sets the | | | | | | | non-3GPP | | | | | | | de-regi | | | | | | | stration | | | | | | | timer | | | | | | | value to | | | | | | | be 4 | | | | | | | minutes | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | timer | | | | | | | T3346. | | | | | | | | | | | | | | NOTE 5: | | | | | | | The | | | | | | | co | | | | | | | nditions | | | | | | | for | | | | | | | which | | | | | | | this | | | | | | | applies | | | | | | | are | | | | | | | d | | | | | | | escribed | | | | | | | in | | | | | | | subc | | | | | | | lause 5. | | | | | | | 5.1.3.7. | | | | | | +----------+----------+----------+----------+----------+----------+
Table 10.2.2: Timers of 5GS mobility management -- AMF side
+----------+----------+----------+----------+----------+----------+ | TIMER | TIMER | STATE | CAUSE OF | NORMAL | ON\ | | NUM. | VALUE | | START | STOP | EXPIRY | +----------+----------+----------+----------+----------+----------+ | T3550 | 6s | 5GMM-CO | Tran | REGI | Retran | | | | MMON-PRO | smission | STRATION | smission | | | | CEDURE-I | of | COMPLETE | of | | | | NITIATED | REGI | message | REGI | | | | | STRATION | received | STRATION | | | | | ACCEPT | | ACCEPT | | | | | message | | message | | | | | with | | | | | | | 5G-GUTI, | | | | | | | with SOR | | | | | | | tra | | | | | | | nsparent | | | | | | | c | | | | | | | ontainer | | | | | | | IE, the | | | | | | | Extended | | | | | | | e | | | | | | | mergency | | | | | | | number | | | | | | | list IE | | | | | | | or the | | | | | | | Operator | | | | | | | -defined | | | | | | | access | | | | | | | category | | | | | | | def | | | | | | | initions | | | | | | | IE | | | | | | | | | | | | | | Tran | | | | | | | smission | | | | | | | of | | | | | | | REGI | | | | | | | STRATION | | | | | | | ACCEPT | | | | | | | message | | | | | | | with any | | | | | | | of a) | | | | | | | Network | | | | | | | slicing | | | | | | | subs | | | | | | | cription | | | | | | | changed | | | | | | | ind | | | | | | | ication, | | | | | | | and b) | | | | | | | new | | | | | | | co | | | | | | | nfigured | | | | | | | NSSAI | | | | | | | and | | | | | | | op | | | | | | | tionally | | | | | | | new | | | | | | | mapped | | | | | | | S- | | | | | | | NSSAI(s) | | | +----------+----------+----------+----------+----------+----------+ | T3560 | 6s | 5GMM-CO | Tran | AUTHEN | Retran | | | | MMON-PRO | smission | TICATION | smission | | | | CEDURE-I | of | RESPONSE | of | | | | NITIATED | AUTHEN | message | AUTHEN | | | | | TICATION | received | TICATION | | | | | REQUEST | | REQUEST | | | | | message | AUTHEN | message | | | | | | TICATION | or | | | | | Tran | FAILURE | SECURITY | | | | | smission | message | MODE | | | | | of | received | COMMAND | | | | | SECURITY | | message | | | | | MODE | SECURITY | | | | | | COMMAND | MODE | | | | | | message | COMPLETE | | | | | | | message | | | | | | | received | | | | | | | | | | | | | | SECURITY | | | | | | | MODE | | | | | | | REJECT | | | | | | | message | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3570 | 6s | 5GMM-CO | Tran | IDENTITY | Retran | | | | MMON-PRO | smission | RESPONSE | smission | | | | CEDURE-I | of | message | of | | | | NITIATED | IDENTITY | received | IDENTITY | | | | | REQUEST | | REQUEST | | | | | message | | message | +----------+----------+----------+----------+----------+----------+ | T3513 | NOTE 4 | 5GMM-RE | Paging | Paging | Network | | | | GISTERED | p | p | d | | | | | rocedure | rocedure | ependent | | | | | i | c | | | | | | nitiated | ompleted | | | | | | | as | | | | | | | s | | | | | | | pecified | | | | | | | in | | | | | | | sub | | | | | | | clause 5 | | | | | | | .6.2.2.1 | | +----------+----------+----------+----------+----------+----------+ | T3522 | 6s | 5GM | Tran | DEREGI | Retran | | | | M-DEREGI | smission | STRATION | smission | | | | STERED-I | of | ACCEPT | of | | | | NITIATED | DEREGI | message | DEREGI | | | | | STRATION | received | STRATION | | | | | REQUEST | | REQUEST | | | | | message | | message | +----------+----------+----------+----------+----------+----------+ | T3555 | 6s | 5GMM-RE | Tran | CONFI | Retran | | | | GISTERED | smission | GURATION | smission | | | | | of | UPDATE | of | | | | | CONFI | COMPLETE | CONFI | | | | | GURATION | message | GURATION | | | | | UPDATE | received | UPDATE | | | | | COMMAND | | COMMAND | | | | | message | | message | | | | | with | | | | | | | Acknowl | | | | | | | edgement | | | | | | | r | | | | | | | equested | | | | | | | flag IE | | | +----------+----------+----------+----------+----------+----------+ | T3565 | 6s | 5GMM-RE | Tran | SERVICE | Retran | | | | GISTERED | smission | REQUEST | smission | | | | | of | message | of | | | | | NOTI | received | NOTI | | | | | FICATION | | FICATION | | | | | message | NOTI | message | | | | | | FICATION | | | | | | | RESPONSE | | | | | | | message | | | | | | | received | | | | | | | | | | | | | | REGI | | | | | | | STRATION | | | | | | | REQUEST | | | | | | | | | | | | | | Message | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | Mobile | NOTE 1 | All | Entering | N1 NAS | Network | | r | | except | 5 | si | de | | eachable | | 5 | GMM-IDLE | gnalling | pendent, | | timer | | GMM-DERE | mode | co | but | | | | GISTERED | | nnection | t | | | | | | est | ypically | | | | | | ablished | paging | | | | | | | is | | | | | | | halted | | | | | | | on 1^st^ | | | | | | | expiry, | | | | | | | and | | | | | | | start | | | | | | | implicit | | | | | | | de-regi | | | | | | | stration | | | | | | | timer, | | | | | | | if the | | | | | | | UE is | | | | | | | not | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | s | | | | | | | ervices. | | | | | | | | | | | | | | Im | | | | | | | plicitly | | | | | | | de- | | | | | | | register | | | | | | | the UE | | | | | | | which is | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | services | +----------+----------+----------+----------+----------+----------+ | Implicit | NOTE 2 | All | The | N1 NAS | Im | | de-regi | | except | mobile | si | plicitly | | stration | | 5 | r | gnalling | de- | | timer | | GMM-DERE | eachable | co | register | | | | GISTERED | timer | nnection | the UE | | | | | expires | est | on 1^st^ | | | | | while | ablished | expiry | | | | | the | | | | | | | network | | | | | | | is in | | | | | | | 5 | | | | | | | GMM-IDLE | | | | | | | mode | | | +----------+----------+----------+----------+----------+----------+ | Non-3GPP | NOTE 3 | All | Entering | N1 NAS | Im | | implicit | | except | 5 | si | plicitly | | de-regi | | 5 | GMM-IDLE | gnalling | de- | | stration | | GMM-DERE | mode | co | register | | timer | | GISTERED | over | nnection | the UE | | | | | non-3GPP | over | for | | | | | access | non-3GPP | non-3GPP | | | | | | access | access | | | | | | est | on 1^s^ | | | | | | ablished | expiry | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | The | | | | | | | default | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | 4 | | | | | | | minutes | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | timer | | | | | | | T3512. | | | | | | | If the | | | | | | | UE is | | | | | | | re | | | | | | | gistered | | | | | | | for | | | | | | | e | | | | | | | mergency | | | | | | | s | | | | | | | ervices, | | | | | | | the | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | set | | | | | | | equal to | | | | | | | the | | | | | | | value of | | | | | | | timer | | | | | | | T3512. | | | | | | | If the | | | | | | | T3346 | | | | | | | value | | | | | | | provided | | | | | | | in the | | | | | | | mobility | | | | | | | ma | | | | | | | nagement | | | | | | | messages | | | | | | | is | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | the | | | | | | | timer | | | | | | | T3512, | | | | | | | the AMF | | | | | | | sets the | | | | | | | mobile | | | | | | | r | | | | | | | eachable | | | | | | | timer | | | | | | | and the | | | | | | | implicit | | | | | | | de-regi | | | | | | | stration | | | | | | | timer | | | | | | | such | | | | | | | that the | | | | | | | sum of | | | | | | | the | | | | | | | timer | | | | | | | values | | | | | | | is | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | timer | | | | | | | T3346. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | network | | | | | | | de | | | | | | | pendent. | | | | | | | If MICO | | | | | | | is | | | | | | | ac | | | | | | | tivated, | | | | | | | the | | | | | | | default | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | 4 | | | | | | | minutes | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | timer | | | | | | | T3512. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | network | | | | | | | de | | | | | | | pendent. | | | | | | | The | | | | | | | default | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | 4 | | | | | | | minutes | | | | | | | greater | | | | | | | than the | | | | | | | non-3GPP | | | | | | | de-regi | | | | | | | stration | | | | | | | timer. | | | | | | | If the | | | | | | | T3346 | | | | | | | value | | | | | | | provided | | | | | | | in the | | | | | | | mobility | | | | | | | ma | | | | | | | nagement | | | | | | | messages | | | | | | | is | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | the | | | | | | | non-3GPP | | | | | | | de-regi | | | | | | | stration | | | | | | | timer, | | | | | | | the AMF | | | | | | | sets the | | | | | | | non-3GPP | | | | | | | implicit | | | | | | | de-regi | | | | | | | stration | | | | | | | timer | | | | | | | value to | | | | | | | be 8 | | | | | | | minutes | | | | | | | greater | | | | | | | than the | | | | | | | value of | | | | | | | timer | | | | | | | T3346. | | | | | | | | | | | | | | NOTE 4: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | network | | | | | | | de | | | | | | | pendent. | | | | | | +----------+----------+----------+----------+----------+----------+
## 10.3 Timers of 5GS session management
Timers of 5GS session management are shown in table 10.3.1 and table 10.3.2.
NOTE: Timer T3396 is defined in 3GPP TS 24.008 [12].
Table 10.3.1: Timers of 5GS session management -- UE side
+----------+----------+----------+----------+----------+----------+ | TIMER | TIMER | STATE | CAUSE OF | NORMAL | ON\ | | NUM. | VALUE | | START | STOP | THE\ | | | | | | | 1^st^, | | | | | | | 2^nd^, | | | | | | | 3^rd^, | | | | | | | 4^th^ | | | | | | | EXPIRY | | | | | | | (NOTE 1) | +----------+----------+----------+----------+----------+----------+ | T3580 | 16s | PDU | Tran | PDU | Retran | | | | SESSION | smission | SESSION | smission | | | | ACTIVE | of PDU | ESTAB | of PDU | | | | PENDING | SESSION | LISHMENT | SESSION | | | | | ESTAB | ACCEPT | ESTAB | | | | | LISHMENT | message | LISHMENT | | | | | REQUEST | received | REQUEST | | | | | message | or | message | | | | | | | | | | | | | PDU | | | | | | | SESSION | | | | | | | ESTAB | | | | | | | LISHMENT | | | | | | | REJECT | | | | | | | message | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3581 | 16s | PDU | Tran | PDU | Retran | | | | SESSION | smission | SESSION | smission | | | | MODI | of PDU | MODI | of PDU | | | | FICATION | SESSION | FICATION | SESSION | | | | PENDING | MODI | COMMAND | MODI | | | | | FICATION | message | FICATION | | | | | REQUEST | with the | REQUEST | | | | | message | same PTI | message | | | | | | is | | | | | | | received | | | | | | | or PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | REJECT | | | | | | | message | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3582 | 16s | PDU | Tran | PDU | Retran | | | | SESSION | smission | SESSION | smission | | | | INACTIVE | of PDU | RELEASE | of PDU | | | | PENDING | SESSION | COMMAND | SESSION | | | | | RELEASE | message | RELEASE | | | | | REQUEST | with the | REQUEST | | | | | message | same PTI | message | | | | | | is | | | | | | | received | | | | | | | or PDU | | | | | | | SESSION | | | | | | | RELEASE | | | | | | | REJECT | | | | | | | message | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3583 | Default | PDU | UE | UE | On 1^st^ | | | 1 min. | SESSION | creates | deletes | expiry: | | | | ACTIVE | or | the | Deletion | | | NOTE 2 | | updates | derived | of the | | | | | a | QoS rule | derived | | | | | derived | (see | QoS rule | | | | | QoS rule | s | | | | | | | ubclause | | | | | | | 6.2. | | | | | | | 5.1.4.5) | | +----------+----------+----------+----------+----------+----------+ | T3584 | NOTE 3 | PDU | PDU | PDU | None | | | | SESSION | SESSION | SESSION | | | | | ACTIVE | ESTAB | RELEASE | | | | | PENDING | LISHMENT | COMMAND | | | | | | REJECT, | or PDU | | | | | PDU | PDU | SESSION | | | | | SESSION | SESSION | MODI | | | | | MODI | MODI | FICATION | | | | | FICATION | FICATION | COMMAND | | | | | PENDING | REJECT, | or | | | | | | or PDU | DEREGI | | | | | PDU | SESSION | STRATION | | | | | SESSION | RELEASE | REQUEST | | | | | ACTIVE | COMMAND | with the | | | | | or PDU | received | re-regi | | | | | SESSION | with | stration | | | | | INACTIVE | 5GSM | type | | | | | PENDING | cause | \ | | | | | | #67 and | "re-regi | | | | | | with a | stration | | | | | | timer | re | | | | | | value | quired\" | | | | | | for | | | | | | | T3584 | | | | | | | | | | | | | | PDU | | | | | | | SESSION | | | | | | | ESTAB | | | | | | | LISHMENT | | | | | | | REQUEST, | | | | | | | or PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | REQUEST | | | | | | | received | | | | | | | in a DL | | | | | | | NAS | | | | | | | T | | | | | | | RANSPORT | | | | | | | message | | | | | | | with | | | | | | | 5GMM | | | | | | | cause | | | | | | | #67 and | | | | | | | with a | | | | | | | timer | | | | | | | value | | | | | | | for | | | | | | | T3584 | | | | | | | (see | | | | | | | subc | | | | | | | lause 5. | | | | | | | 4.5.3.3) | | | +----------+----------+----------+----------+----------+----------+ | T3585 | NOTE 3 | PDU | PDU | PDU | None | | | | SESSION | SESSION | SESSION | | | | | ACTIVE | ESTAB | RELEASE | | | | | PENDING | LISHMENT | COMMAND | | | | | | REJECT, | or PDU | | | | | PDU | PDU | SESSION | | | | | SESSION | SESSION | MODI | | | | | MODI | MODI | FICATION | | | | | FICATION | FICATION | COMMAND | | | | | PENDING | REJECT, | or | | | | | | or PDU | DEREGI | | | | | PDU | SESSION | STRATION | | | | | SESSION | RELEASE | REQUEST | | | | | ACTIVE | COMMAND | with the | | | | | or PDU | received | re-regi | | | | | SESSION | with | stration | | | | | INACTIVE | 5GSM | type | | | | | PENDING | cause | \ | | | | | | #69 and | "re-regi | | | | | | with a | stration | | | | | | timer | re | | | | | | value | quired\" | | | | | | for | | | | | | | T3585 | | | | | | | | | | | | | | PDU | | | | | | | SESSION | | | | | | | ESTAB | | | | | | | LISHMENT | | | | | | | REQUEST, | | | | | | | or PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | REQUEST | | | | | | | received | | | | | | | in a DL | | | | | | | NAS | | | | | | | T | | | | | | | RANSPORT | | | | | | | message | | | | | | | with | | | | | | | 5GMM | | | | | | | cause | | | | | | | #69 and | | | | | | | with a | | | | | | | timer | | | | | | | value | | | | | | | for | | | | | | | T | | | | | | | 3585(see | | | | | | | subc | | | | | | | lause 5. | | | | | | | 4.5.3.3) | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | Ty | | | | | | | pically, | | | | | | | the | | | | | | | pr | | | | | | | ocedures | | | | | | | are | | | | | | | aborted | | | | | | | on the | | | | | | | fifth | | | | | | | expiry | | | | | | | of the | | | | | | | relevant | | | | | | | timer. | | | | | | | Ex | | | | | | | ceptions | | | | | | | are | | | | | | | d | | | | | | | escribed | | | | | | | in the | | | | | | | corre | | | | | | | sponding | | | | | | | p | | | | | | | rocedure | | | | | | | desc | | | | | | | ription. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | network | | | | | | | may | | | | | | | provide | | | | | | | the | | | | | | | value of | | | | | | | this | | | | | | | timer | | | | | | | ap | | | | | | | plicable | | | | | | | to the | | | | | | | derived | | | | | | | QoS | | | | | | | rules of | | | | | | | a | | | | | | | specific | | | | | | | PDU | | | | | | | session | | | | | | | as RQ | | | | | | | timer | | | | | | | value in | | | | | | | the PDU | | | | | | | SESSION | | | | | | | ESTAB | | | | | | | LISHMENT | | | | | | | ACCEPT | | | | | | | message | | | | | | | and PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | COMMAND | | | | | | | message. | | | | | | | The | | | | | | | maximum | | | | | | | value of | | | | | | | the | | | | | | | timer is | | | | | | | 30 min. | | | | | | | If the | | | | | | | network | | | | | | | i | | | | | | | ndicates | | | | | | | a value | | | | | | | greater | | | | | | | than the | | | | | | | maximum | | | | | | | value, | | | | | | | then the | | | | | | | UE shall | | | | | | | use the | | | | | | | maximum | | | | | | | value. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The | | | | | | | value of | | | | | | | this | | | | | | | timer is | | | | | | | provided | | | | | | | by the | | | | | | | network. | | | | | | +----------+----------+----------+----------+----------+----------+
Table 10.3.2: Timers of 5GS session management -- SMF side
+----------+----------+----------+----------+----------+----------+ | TIMER | TIMER | STATE | CAUSE OF | NORMAL | ON\ | | NUM. | VALUE | | START | STOP | THE\ | | | | | | | 1^st^, | | | | | | | 2^nd^, | | | | | | | 3^rd^, | | | | | | | 4^th^ | | | | | | | EXPIRY | | | | | | | (NOTE 1) | +----------+----------+----------+----------+----------+----------+ | T3590 | 15s | P | Tran | PDU | Retran | | | | ROCEDURE | smission | SESSION | smission | | | | TRA | of PDU | AUTHEN | of PDU | | | | NSACTION | SESSION | TICATION | SESSION | | | | PENDING | AUTHEN | COMPLETE | AUTHEN | | | | | TICATION | message | TICATION | | | | | COMMAND | received | COMMAND | | | | | message | | message | +----------+----------+----------+----------+----------+----------+ | T3591 | 16s | PDU | Tran | PDU | Retran | | | | SESSION | smission | SESSION | smission | | | | MODI | of PDU | MODI | of PDU | | | | FICATION | SESSION | FICATION | SESSION | | | | PENDING | MODI | COMPLETE | MODI | | | | | FICATION | message | FICATION | | | | | COMMAND | received | COMMAND | | | | | message | or PDU | message | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | COMMAND | | | | | | | REJECT | | | | | | | message | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3592 | 16s | PDU | Tran | PDU | Retran | | | | SESSION | smission | SESSION | smission | | | | INACTIVE | of PDU | RELEASE | of PDU | | | | PENDING | SESSION | COMPLETE | SESSION | | | | | RELEASE | message | RELEASE | | | | | COMMAND | received | COMMAND | | | | | message | or | message | | | | | | | | | | | | | N1 SM | | | | | | | delivery | | | | | | | skipped | | | | | | | in | | | | | | | dication | | | | | | | received | | +----------+----------+----------+----------+----------+----------+ | T3593 | Default | PDU | R | PDU | N | | | | SESSION | eception | SESSION | etwork-r | | | 60s | MODI | of PDU | RELEASE | equested | | | | FICATION | SESSION | REQUEST | PDU | | | (NOTE 2) | PENDING | MODI | message | session | | | | | FICATION | received | release | | | | | COMPLETE | | p | | | | | message | | rocedure | | | | | for | | p | | | | | tra | | erformed | | | | | nsmitted | | | | | | | PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | COMMAND | | | | | | | message | | | | | | | where | | | | | | | the PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | COMMAND | | | | | | | message | | | | | | | included | | | | | | | 5GSM | | | | | | | cause | | | | | | | #39 | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | Ty | | | | | | | pically, | | | | | | | the | | | | | | | pr | | | | | | | ocedures | | | | | | | are | | | | | | | aborted | | | | | | | on the | | | | | | | fifth | | | | | | | expiry | | | | | | | of the | | | | | | | relevant | | | | | | | timer. | | | | | | | Ex | | | | | | | ceptions | | | | | | | are | | | | | | | d | | | | | | | escribed | | | | | | | in the | | | | | | | corre | | | | | | | sponding | | | | | | | p | | | | | | | rocedure | | | | | | | desc | | | | | | | ription. | | | | | | | | | | | | | | NOTE 2: | | | | | | | If the | | | | | | | PDU | | | | | | | Session | | | | | | | Address | | | | | | | Lifetime | | | | | | | value is | | | | | | | sent to | | | | | | | the UE | | | | | | | in the | | | | | | | PDU | | | | | | | SESSION | | | | | | | MODI | | | | | | | FICATION | | | | | | | COMMAND | | | | | | | message | | | | | | | then | | | | | | | timer | | | | | | | T3593 | | | | | | | shall be | | | | | | | started | | | | | | | with the | | | | | | | same | | | | | | | value, | | | | | | | o | | | | | | | therwise | | | | | | | it shall | | | | | | | use a | | | | | | | default | | | | | | | value. | | | | | | +----------+----------+----------+----------+----------+----------+
###### ## Annex A (informative): Cause values for 5GS mobility management
## A.1 Causes related to UE identification
Cause #3 -- Illegal UE
This 5GMM cause is sent to the UE when the network refuses service to the UE
either because an identity of the UE is not acceptable to the network or
because the UE does not pass the authentication check.
Cause #6 -- Illegal ME
This 5GMM cause is sent to the UE if the ME used is not acceptable to the
network, e.g. blacklisted.
Cause #9 -- UE identity cannot be derived by the network.
This 5GMM cause is sent to the UE when the network cannot derive the UE\'s
identity from the 5G-GUTI or 5G-S-TMSI because of e.g. no matching
identity/context in the network, failure to validate the UE\'s identity due to
integrity check failure of the received message.
Cause #10 -- Implicitly de-registered
This 5GMM cause is sent to the UE either if the network has implicitly de-
registered the UE, e.g. after the implicit de-registration timer has expired,
or if the 5GMM context data related to the subscription does not exist in the
AMF e.g. because of a AMF restart, or because of a registration request for
mobility or registration update is routed to a new AMF.
## A.2 Cause related to subscription options
Cause #5 -- PEI not accepted
This cause is sent to the UE if the network does not accept an initial
registration procedure for emergency services using a PEI.
Cause #7 -- 5GS services not allowed
This 5GMM cause is sent to the UE when it is not allowed to operate 5GS
services.
Cause #11 -- PLMN not allowed
This 5GMM cause is sent to the UE if it requests service, or if the network
initiates a de-registration request, in a PLMN where the UE, by subscription
or due to operator determined barring, is not allowed to operate.
Cause #12 -- Tracking area not allowed
This 5GMM cause is sent to the UE if it requests service, or if the network
initiates a de-registration request, in a tracking area where the HPLMN
determines that the UE, by subscription, is not allowed to operate.
NOTE 1: If 5GMM cause #12 is sent to a roaming subscriber the subscriber is
denied service even if other PLMNs are available on which registration was
possible.
Cause #13 -- Roaming not allowed in this tracking area
This 5GMM cause is sent to a UE which requests service, or if the network
initiates a de-registration request, in a tracking area of a PLMN which by
subscription offers roaming to that UE but not in that tracking area.
Cause #15 -- No suitable cells in tracking area
This 5GMM cause is sent to the UE if it requests service, or if the network
initiates a de-registration request, in a tracking area where the UE, by
subscription, is not allowed to operate, but when it should find another
allowed tracking area in the same PLMN or an equivalent PLMN.
NOTE 2: Cause #15 and cause #12 differ in the fact that cause #12 does not
trigger the UE to search for another allowed tracking area on the same PLMN.
Cause #27 -- N1 mode not allowed
This 5GMM cause is sent to the UE if it requests service, or if the network
initiates a de-registration request, in a PLMN where the UE by subscription,
is not allowed to operate in N1 mode.
Cause #72 -- Non-3GPP access to 5GCN not allowed
This 5GMM cause is sent to the UE if it requests accessing 5GCN over non-3GPP
access in a PLMN, where the UE by subscription, is not allowed to access 5GCN
over non-3GPP access.
## A.3 Causes related to PLMN specific network failures and
congestion/authentication failures
Cause #20 -- MAC failure
This 5GMM cause is sent to the network if the USIM detects that the MAC in the
AUTHENTICATION REQUEST message is not fresh.
Cause #21 -- Synch failure
This 5GMM cause is sent to the network if the USIM detects that the SQN in the
AUTHENTICATION REQUEST message is out of range.
Cause #22 -- Congestion
This 5GMM cause is sent to the UE because of congestion in the network (e.g.
no channel, facility busy/congested etc.).
Cause #23 -- UE security capabilities mismatch
This 5GMM cause is sent to the network if the UE detects that the UE security
capability does not match the one sent back by the network.
Cause #24 -- Security mode rejected, unspecified
This 5GMM cause is sent to the network if the security mode command is
rejected by the UE for unspecified reasons.
Cause #26 -- Non-5G authentication unacceptable
This 5GMM cause is sent to the network in N1 mode if the \"separation bit\" in
the AMF field of AUTN is set to 0 in the AUTHENTICATION REQUEST message (see
3GPP TS 33.501 [24]).
Cause #28 -- Restricted service area
This 5GMM cause is sent to the UE if it requests service in a tracking area
which is a part of the UE\'s non-allowed area or is not a part of the UE\'s
allowed area.
Cause #43 -- LADN not available
This 5GMM cause is sent to the UE if the user-plane resources of the PDU
session are not established when the UE is located outside the LADN service
area.
Cause #65 -- Maximum number of PDU sessions reached
This 5GMM cause is used by the network to indicate that the procedure
requested by the UE was rejected as the network has reached the maximum number
of simultaneously active PDU sessions for the UE.
Cause #67 -- Insufficient resources for specific slice and DNN
This 5GMM cause is sent by the network to indicate that the requested service
cannot be provided due to insufficient resources for specific slice and DNN.
Cause #69 -- Insufficient resources for specific slice
This 5GMM cause is sent by the network to indicate that the requested service
cannot be provided due to insufficient resources for specific slice.
Cause #71 -- ngKSI already in use
This 5GMM cause is sent to the network in N1 mode if the ngKSI value received
in the AUTHENTICATION REQUEST message is already associated with one of the 5G
NAS security contexts stored in the UE.
Cause #73 -- Serving network not authorized
This 5GMM cause is sent to the UE if the UE initiates registration towards a
serving network and the serving network fails to be authorized by the UE\'s
home network.
Cause #90 -- Payload was not forwarded
This 5GMM cause is sent by the network to indicate that the requested service
cannot be provided due to payload could not be forwarded by AMF.
Cause #91 -- DNN not supported or not subscribed in the slice
This 5GMM cause is sent by the network to indicate that the requested service
cannot be provided due to payload could not be forwarded by AMF because the
DNN is not supported or not subscribed in the slice selected by the network if
the UE did not indicate a slice, or the DNN is not supported or not subscribed
in the slice indicated by the UE.
Cause #92 -- Insufficient user-plane resources for the PDU session
This 5GMM cause is sent by the network to indicate that the requested service
cannot be provided due to insufficient user-plane resources for the PDU
session.
## A.4 Causes related to invalid messages
Cause #95 -- Semantically incorrect message
This 5GMM cause is used to report receipt of a message with semantically
incorrect contents.
Cause #96 -- Invalid mandatory information
This cause 5GMM indicates that the equipment sending this 5GMM cause has
received a message with a non-semantical mandatory IE error.
Cause #97 -- Message type non-existent or not implemented
This 5GMM cause indicates that the equipment sending this 5GMM cause has
received a message with a message type it does not recognize either because
this is a message not defined, or defined but not implemented by the equipment
sending this 5GMM cause.
Cause #98 -- Message type not compatible with protocol state
This 5GMM cause indicates that the equipment sending this 5GMM cause has
received a message not compatible with the protocol state.
Cause #99 -- Information element non-existent or not implemented
This 5GMM cause indicates that the equipment sending this 5GMM cause has
received a message which includes information elements not recognized because
the information element identifier is not defined or it is defined but not
implemented by the equipment sending the 5GMM cause. However, the information
element is not required to be present in the message in order for the
equipment sending the 5GMM cause to process the message.
Cause #100 -- Conditional IE error
This 5GMM cause indicates that the equipment sending this cause has received a
message with conditional IE errors.
Cause #101 -- Message not compatible with protocol state
This 5GMM cause indicates that a message has been received which is
incompatible with the protocol state.
Cause #111 -- Protocol error, unspecified
This 5GMM cause is used to report a protocol error event only when no other
5GMM cause in the protocol error class applies.
###### ## Annex B (informative): Cause values for 5GS session management
## B.1 Causes related to nature of request
Cause #8 -- Operator Determined Barring
This 5GSM cause is used by the network to indicate that the requested service
was rejected by the SMF due to Operator Determined Barring.
Cause #26 -- Insufficient resources
This 5GSM cause is used by the UE or by the network to indicate that the
requested service cannot be provided due to insufficient resources.
Cause #27 -- Missing or unknown DNN
This 5GSM cause is used by the network to indicate that the requested service
was rejected by the external DN because the DNN was not included although
required or if the DNN could not be resolved.
Cause #28 -- Unknown PDU session type
This 5GSM cause is used by the network to indicate that the requested service
was rejected by the external DN because the requested PDU session type could
not be recognised or is not allowed.
Cause #29 -- User authentication or authorization failed
This 5GSM cause is used by the network to indicate that the requested service
was rejected by the external DN due to a failed user authentication, revoked
by the external DN, or rejected by 5GCN due to a failed user authentication or
authorization.
Cause #31 -- Request rejected, unspecified
This 5GSM cause is used by the network or by the UE to indicate that the
requested service or operation or the request for a resource was rejected due
to unspecified reasons.
Cause #32 -- Service option not supported
This 5GSM cause is used by the network when the UE requests a service which is
not supported by the PLMN.
Cause #33 -- Requested service option not subscribed
This 5GSM cause is sent when the UE requests a service option for which it has
no subscription.
Cause #35 -- PTI already in use
This 5GSM cause is used by the network to indicate that the PTI included by
the UE is already in use by another active UE requested procedure for this UE.
Cause #36 -- Regular deactivation
This 5GSM cause is used to indicate a regular UE or network initiated release
of PDU session resources.
Cause #38 -- Network failure
This 5GSM cause is used by the network to indicate that the requested service
was rejected due to an error situation in the network.
Cause #39 -- Reactivation requested
This 5GSM cause is used by the network to request a PDU session reactivation.
Cause #41 -- Semantic error in the TFT operation
This 5GSM cause is used by the UE to indicate a semantic error in the TFT
operation included in the request.
Cause #42 -- Syntactical error in the TFT operation
This 5GSM cause is used by the UE to indicate a syntactical error in the TFT
operation included in the request.
Cause #43 --Invalid PDU session identity
This 5GSM cause is used by the network or the UE to indicate that the PDU
session identity value provided to it is not a valid value or the PDU session
identified by the PDU session identity IE in the request or the command is not
active.
Cause #44 -- Semantic errors in packet filter(s)
This 5GSM cause is used by the network or the UE to indicate that the
requested service was rejected due to one or more semantic errors in packet
filter(s) of the QoS rule included in the request.
Cause #45 -- Syntactical error in packet filter(s)
This 5GSM cause is used by the network or the UE to indicate that the
requested service was rejected due to one or more syntactical errors in packet
filter(s) of the QoS rule included in the request.
Cause #46 --Out of LADN service area
This 5GSM cause is used by the network to indicate the UE is out of the LADN
service area.
Cause #47 --PTI mismatch
This 5GSM cause is used by the network or UE to indicate that the PTI provided
to it does not match any PTI in use.
Cause #50 -- PDU session type IPv4 only allowed
This 5GSM cause is used by the network to indicate that only PDU session type
IPv4 is allowed for the requested IP connectivity.
Cause #51 -- PDU session type IPv6 only allowed
This 5GSM cause is used by the network to indicate that only PDU session type
IPv6 is allowed for the requested IP connectivity.
Cause #54 --PDU session does not exist
This 5GSM cause is used by the network to indicate that the network does not
have any information about the PDU session which is requested by the UE to
transfer between 3GPP access and non-3GPP access or from the EPS to the 5GS.
Cause #67 -- Insufficient resources for specific slice and DNN
This 5GSM cause is by the network to indicate that the requested service
cannot be provided due to insufficient resources for specific slice and DNN.
Cause #68 -- Not supported SSC mode
This 5GSM cause is used by the network to indicate that the requested SSC mode
is not supported.
Cause #69 --Insufficient resources for specific slice
This 5GSM cause is used by the network to indicate that the requested service
cannot be provided due to insufficient resources for specific slice.
Cause #70 -- Missing or unknown DNN in a slice
This 5GSM cause is used by the network to indicate that the requested service
was rejected by the external DN because the DNN was not included although
required or if the DNN could not be resolved, in the slice.
Cause #81 -- Invalid PTI value
This 5GSM cause is used by the network or UE to indicate that the PTI provided
to it is unassigned or reserved.
Cause #82 -- Maximum data rate per UE for user-plane integrity protection is
too low
This 5GSM cause is used by the network to indicate that the requested service
cannot be provided due to the maximum data rate per UE for user-plane
integrity protection is too low.
Cause #83 -- Semantic error in the QoS operation
This 5GSM cause is used by the network or the UE to indicate that the
requested service was rejected due to a semantic error in the QoS operation
included in the request.
Cause #84 -- Syntactical error in the QoS operation
This 5GSM cause is used by the network or the UE to indicate that the
requested service was rejected due to a syntactical error in the QoS operation
included in the request.
Cause #85 -- Invalid mapped EPS bearer identity
This 5GSM cause is used by the network or the UE to indicate that the mapped
EPS bearer identity value provided to it is not a valid value or the mapped
EPS bearer identified by the mapped EPS bearer identity does not exist.
## B.2 Protocol errors (e.g., unknown message)
Cause #95 -- Semantically incorrect message
This 5GSM cause is used to report receipt of a message with semantically
incorrect contents.
Cause #96 -- Invalid mandatory information
This 5GSM cause indicates that the equipment sending this 5GSM cause has
received a message with a non-semantical mandatory IE error.
Cause #97 -- Message type non-existent or not implemented
This 5GSM cause indicates that the equipment sending this 5GSM cause has
received a message with a message type it does not recognize either because
this is a message not defined, or defined but not implemented by the equipment
sending this 5GSM cause.
Cause #98 -- Message type not compatible with protocol state
This 5GSM cause indicates that the equipment sending this 5GSM cause has
received a message not compatible with the protocol state.
Cause #99 -- Information element non-existent or not implemented
This 5GSM cause indicates that the equipment sending this 5GSM cause has
received a message which includes information elements not recognized because
the information element identifier is not defined or it is defined but not
implemented by the equipment sending the 5GSM cause. However, the information
element is not required to be present in the message in order for the
equipment sending the 5GSM cause to process the message.
Cause #100 -- Conditional IE error
This 5GSM cause indicates that the equipment sending this cause has received a
message with conditional IE errors.
Cause #101 -- Message not compatible with protocol state
This 5GSM cause indicates that a message has been received which is
incompatible with the protocol state.
Cause #111 -- Protocol error, unspecified
This 5GSM cause is used to report a protocol error event only when no other
5GSM cause in the protocol error class applies.
###### ## Annex C (normative): Storage of 5GMM information
The following 5GMM parameters shall be stored on the USIM if the corresponding
file is present:
a) 5G-GUTI;
b) last visited registered TAI;
c) 5GS update status; and
d) 5G NAS security context parameters from a full native 5G NAS security
context (see 3GPP TS 33.501 [24]).
The presence and format of corresponding files on the USIM is specified in
3GPP TS 31.102 [22].
If the corresponding file is not present on the USIM, these 5GMM parameters
are stored in a non-volatile memory in the ME together with the SUPI from the
USIM. These 5GMM parameters can only be used if the SUPI from the USIM matches
the SUPI stored in the non-volatile memory; else the UE shall delete the 5GMM
parameters.
The following 5GMM parameters shall be stored in a non-volatile memory in the
ME together with the SUPI from the USIM:
\- configured NSSAI(s);
\- NSSAI inclusion mode(s);
\- MPS indicator;
\- MCS indicator; and
\- operator-defined access category definitions.
Each configured NSSAI consists of S-NSSAIs stored together with a PLMN
identity, if it is associated with a PLMN. The UE shall store the S-NSSAI(s)
of the HPLMN. If the UE is in the VPLMN, the UE shall also store the
configured NSSAI for the serving PLMN and any necessary mapping of the
configured NSSAI for the serving PLMN to the S-NSSAI(s) of the HPLMN. The
configured NSSAI(s) can only be used if the SUPI from the USIM matches the
SUPI stored in the non-volatile memory of the ME; else the UE shall delete the
configured NSSAI(s).
Each NSSAI inclusion mode is associated with a PLMN identity and access type.
The NSSAI inclusion mode(s) can only be used if the SUPI from the USIM matches
the SUPI stored in the non-volatile memory of the ME; else the UE shall delete
the NSSAI inclusion mode(s).
The MPS indicator is stored together with a PLMN identity of the PLMN that
provided it, and is valid in that RPLMN or equivalent PLMN. The MPS indicator
can only be used if the SUPI from the USIM matches the SUPI stored in the non-
volatile memory of the ME, else the UE shall delete the MPS indicator.
The MCS indicator is stored together with a PLMN identity of the PLMN that
provided it, and is valid in that RPLMN or equivalent PLMN. The MCS indicator
can only be used if the SUPI from the USIM matches the SUPI stored in the non-
volatile memory of the ME, else the UE shall delete the MCS indicator.
Operator-defined access category definitions are stored together with a PLMN
identity of the PLMN that provided them, and is valid in that PLMN or
equivalent PLMN. The operator-defined access category definitions can only be
used if the SUPI from the USIM matches the SUPI stored in the non-volatile
memory of the ME, else the UE shall delete the operator-defined access
category definitions. The maximum number of stored operator-defined access
category definitions is UE implementation dependent.
If the UE is registered for emergency services, the UE shall not store the
5GMM parameters described in this annex on the USIM or in non-volatile memory.
Instead the UE shall temporarily store these parameters locally in the ME and
the UE shall delete these parameters when the UE is deregistered.
If the UE is configured for eCall only mode as specified in 3GPP TS 31.102
[22], the UE shall not store the 5GMM parameters described in this annex on
the USIM or in non-volatile memory. Instead the UE shall temporarily store
these parameters locally in the ME and the UE shall delete these parameters
when the UE enters 5GMM-DEREGISTERED.eCALL-INACTIVE state, the UE is switched-
off or the USIM is removed.
###### ## Annex D (normative): UE policy delivery service
## D.1 General
### D.1.1 Overview
The PCF may provide the UE with one or more UE policies using the network-
requested UE policy management procedure. The UE provides the PCF with a list
of one or more stored UE policy section identifiers (UPSIs), and the PCF
provides each UE policy using one or more UE policy sections, each identified
by aUPSI. The UPSI is composed of two parts:
a) a PLMN ID part containing the PLMN ID for the PLMN of the PCF which
provides the UE policies; and
b) a UE policy section code (UPSC) containing a value assigned by the PCF.
The UE processes the UE policy sections, each identified by the UPSI, received
from the PCF and informs the PCF of the result.
The UE provides the PCF with the UE policy related capabilities such as the
UE\'s support for ANDSP and the UE\'s OS Id.
### D.1.2 Principles of PTI handling for UE policy delivery service procedures
When the PCF or the UE initiates a procedure, it shall include a valid PTI
value in the message header of the command message or the request message.
When the PCF initiates a transaction related procedure (i.e. a procedure
consisting of more than one message and the messages are related), it shall
include a valid PTI value in the message header of the command message.
If a response message is sent as result of a received command message, the UE
shall include in the response message the PTI value received within the
command message (see examples in figure D.1.2.1).
Figure D.1.2.1: Network-requested transaction related procedure
NOTE: In earlier versions of this protocol, the UE can include in the response
message a PTI value which is not the same as the one received within the
command message, and therefore the PCF could not associate the response
message from the UE to the command message sent.
## D.2 Procedures
### D.2.1 Network-requested UE policy management procedure
#### D.2.1.1 General
The purpose of the network-requested UE policy management procedure is to
enable the network to:
a) add one or more new UE policy sections to the UE;
b) modify one or more UE policy sections stored at the UE; or
c) delete one or more UE policy sections stored at the UE.
#### D.2.1.2 Network-requested UE policy management procedure initiation
In order to initiate the network-requested UE policy management procedure, the
PCF shall:
a) allocate a PTI value currently not used and set the PTI IE to the allocated
PTI value;
b) encode the information about the UE policy sections to be added, modified
or deleted in a UE policy section management list IE as specified in subclause
D.6.2 and include it in a MANAGE UE POLICY COMMAND message;
c) send the MANAGE UE POLICY COMMAND message to the UE via the AMF as
specified in 3GPP TS 23.502 [9]; and
d) start timer T3501 (see example in figure D.2.1.2.1).
NOTE: The PCF starts a different timer T3501 for each allocated PTI value.
Figure D.2.1.2.1: Network-requested UE policy management procedure
Upon receipt of the MANAGE UE POLICY COMMAND message with a PTI value
currently not used, for each instruction included in the UE policy section
management list IE, the UE shall:
a) store the received UE policy section of the instruction, if the UE has no
stored UE policy section associated with the same UPSI as the UPSI associated
with the instruction;
b) replace the stored UE policy section with the received UE policy section of
the instruction, if the UE has a stored UE policy section associated with the
same UPSI as the UPSI associated with the instruction; or
c) delete the stored UE policy section, if the UE has a stored UE policy
section associated with the same UPSI as the UPSI associated with the
instruction and the UE policy section contents of the instruction is empty.
The UE may continue storing a received UE policy section for a PLMN when the
UE registers in another PLMN. If necessary, the UE may delete UE policy
sections stored for a PLMN other than the RPLMN and the HPLMN, before storing
the new received UE policy sections.
NOTE: The maximum number of UE policy sections for PLMNs other than the HPLMN
and the RPLMN that the UE can store and how the UE selects the UE policy
sections to be deleted are up to the UE implementation.
#### D.2.1.3 Network-requested UE policy management procedure accepted by the
UE
If all instructions included in the UE policy section management list IE were
executed successfully by the UE, the UE shall:
a) create a MANAGE UE POLICY COMPLETE message including the PTI value received
within the MANAGE UE POLICY COMMAND message; and
b) transport the MANAGE UE POLICY COMPLETE message using the NAS transport
procedure as specified in subclause 5.4.5.
Upon receipt of the MANAGE UE POLICY COMPLETE message, the PCF shall stop
timer T3501. The PCF should ensure that the PTI value assigned to this
procedure is not released immediately.
NOTE: The way to achieve this is implementation dependent. For example, the
PCF can ensure that the PTI value assigned to this procedure is not released
during the time equal to or greater than the default value of timer T3501.
#### D.2.1.4 Network-requested UE policy management procedure not accepted by
the UE
If the UE could not execute all instructions included in the UE policy section
management list IE successfully, the UE shall:
a) set the PTI IE to the PTI value received within the MANAGE UE POLICY
COMMAND message and encode the UPSI associated with the instructions which
could not be executed successfully and the associated UE policy delivery
service cause indicating the cause of the failure in a UE policy section
management result IE as specified in subclause D.5.3 and include it in a
MANAGE UE POLICY COMMAND REJECT message, and
b) transport the MANAGE UE POLICY COMMAND REJECT message using the NAS
transport procedure as specified in subclause 5.4.5.
Upon receipt of the MANAGE UE POLICY COMMAND REJECT message, the PCF shall
stop timer T3501. Any instruction that was included in the UE policy section
management list IE and whose associated UPSI is not included in a UE policy
section management result IE of the received MANAGE UE POLICY COMMAND REJECT
message is considered as successfully executed.
The PCF should ensure that the PTI value assigned to this procedure is not
released immediately.
NOTE: The way to achieve this is implementation dependent. For example, the
PCF can ensure that the PTI value assigned to this procedure is not released
during the time equal to or greater than the default value of timer T3501.
Upon receipt of the notification from the AMF that the UE is not reachable,
the PCF shall stop the T3501.
#### D.2.1.5 Abnormal cases on the network side
The following abnormal cases can be identified:
a) T3501 expired.
The PCF shall, on the first expiry of the timer T3501, retransmit the MANAGE
UE POLICY COMMAND message and shall reset and start timer T3501. This
retransmission is repeated four times, i.e. on the fifth expiry of timer
T3501, the PCF shall abort the procedure and release the allocated PTI.
#### D.2.1.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Receipt of an instruction associated with a UPSI which has a PLMN ID part
that is not equal to the PLMN ID of the UE\'s HPLMN and the instruction
contains a UE policy part with a UE policy part type set to \"URSP\".
The UE shall set the UE policy delivery service cause to #111 (Protocol error,
unspecified) for the instruction in the UE policy section management result IE
of the MANAGE UE POLICY COMMAND REJECT message.
b) Receipt of an instruction associated with a UPSI which has a PLMN ID part
that is not equal to the PLMN ID of the UE\'s HPLMN or the UE\'s RPLMN and the
instruction contains a UE policy part with a UE policy part type set to
\"ANDSP\".
The UE shall set the UE policy delivery service cause to #111 (Protocol error,
unspecified) for the instruction in the UE policy section management result IE
of the MANAGE UE POLICY COMMAND REJECT message.
c) Transmission failure of the MANAGE UE POLICY COMPLETE message indication
from lower layers.
The UE shall not diagnose an error and consider the network-initiated UE
policy delivery procedure complete.
NOTE 1: Considering the network-initiated UE policy delivery procedure
complete as a result of this abnormal case does not cause the UE to revert the
execution of the instructions included in the MANAGE UE POLICY COMMAND
message.
d) Transmission failure of the MANAGE UE POLICY COMMAND REJECT message
indication from lower layers.
The UE shall not diagnose an error and consider the network-initiated UE
policy delivery procedure complete.
NOTE 2: Considering the network-initiated UE policy delivery procedure
complete as a result of this abnormal case does not cause the UE to revert the
execution of the instructions included in the MANAGE UE POLICY COMMAND message
and successfully processed by the UE.
e) Receipt of a MANAGE UE POLICY COMMAND message with a PTI set to the same
value as the PTI of a previously received MANAGE UE POLICY COMMAND message.
The UE shall discard the message and retransmit the MANAGE UE POLICY COMMAND
COMPLETE or MANAGE UE POLICY COMMAND REJECT message transmitted in response to
the previously received MANAGE UE POLICY COMMAND message.
NOTE 3: The way to achieve this is UE implementation dependent. For example,
the UE can assume that on the fifth expiry of timer T3501, the PCF will abort
the procedure and that the PTI value assigned to the procedure will be
released.
### D.2.2 UE-initiated UE state indication procedure
#### D.2.2.1 General
The purpose of the UE-initiated UE state indication procedure is:
a) to deliver the UPSI(s) of the UE policy section(s) which are:
\- identified by a UPSI with the PLMN ID part indicating the HPLMN or the
selected PLMN; and
\- stored in the UE;
to the PCF if the UE has one or more stored UE policy sections identified by a
UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN; and
b) to indicate whether UE supports ANDSP; and
c) to deliver the UE\'s one or more OS Ids.
#### D.2.2.2 UE-initiated UE state indication procedure initiation
In order to initiate the UE-initiated UE state indication procedure, the UE
shall create a UE STATE INDICATION message. The UE:
a) shall allocate a PTI value currently not used and set the PTI IE to the
allocated PTI value;
b) shall include the UPSI(s) of the UE policy section(s) which are identified
by a UPSI with the PLMN ID part indicating the HPLMN or the selected PLMN
available in the UE in the UPSI list IE;
c) shall specify whether the UE supports ANDSP in the UE policy classmark IE;
and
d) may include the UE\'s one or more OS Ids in the UE OS Id IE.
The UE shall send the UE STATE INDICATION message (see example in figure
D.2.2.2.1). The UE shall transport the created UE STATE INDICATION message
using the registration procedure (see subclause 5.5.1).
Figure D.2.2.2.1: UE-initiated UE state indication procedure
#### D.2.2.3 UE-initiated UE state indication procedure accepted by the
network
Upon receipt of the UE STATE INDICATION message, the PCF shall operate as
described in 3GPP TS 23.502 [9] and 3GPP TS 29.525 [21].
#### D.2.2.4 Abnormal cases on the network side
Apart from the case described in subclause D.2.2.3, no abnormal cases have
been identified.
## D.3 UE policy re-assembly at the UE
When the UE needs to apply ANSDP as specified in 3GPP TS 24.502 [18], the UE
shall consider all UE policy parts with ANSDP contents currently stored at the
UE.
When the UE needs to apply URSP as specified in 3GPP TS 24.526 [19], the UE
shall consider all UE policy parts with URSP contents currently stored at the
UE.
## D.4 Void
## D.5 Message functional definition and contents
### D.5.1 Manage UE policy command
#### D.5.1.1 Message definition
The MANAGE UE POLICY COMMAND message is sent by the PCF to the UE to request
the UE to manage UE policy sections, see table D.5.1.1.1
Message type: MANAGE UE POLICY COMMAND
Significance: dual
Direction: network to UE
Table D.5.1.1.1: MANAGE UE POLICY COMMAND message content
+----------+----------+----------+----------+--------+----------+ | IEI | Inf | Type/R | Presence | Format | Length | | | ormation | eference | | | | | | Element | | | | | +==========+==========+==========+==========+========+==========+ | | PTI | P | M | V | 1 | | | | rocedure | | | | | | | tra | | | | | | | nsaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +----------+----------+----------+----------+--------+----------+ | | MANAGE | UE | M | V | 1 | | | UE | policy | | | | | | POLICY | delivery | | | | | | COMMAND | service | | | | | | message | message | | | | | | identity | type | | | | | | | | | | | | | | D.6.1 | | | | +----------+----------+----------+----------+--------+----------+ | | UE | UE | M | LV-E | 11-65533 | | | policy | policy | | | | | | section | section | | | | | | ma | ma | | | | | | nagement | nagement | | | | | | list | list | | | | | | | | | | | | | | D.6.2 | | | | +----------+----------+----------+----------+--------+----------+ | NOTE: | | | | | | | The | | | | | | | total | | | | | | | length | | | | | | | of the | | | | | | | MANAGE | | | | | | | UE | | | | | | | POLICY | | | | | | | COMMAND | | | | | | | message | | | | | | | cannot | | | | | | | exceed | | | | | | | 65535 | | | | | | | octets | | | | | | | (see | | | | | | | Payload | | | | | | | c | | | | | | | ontainer | | | | | | | contents | | | | | | | maximum | | | | | | | length | | | | | | | as | | | | | | | s | | | | | | | pecified | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 9.11. | | | | | | | 3.39.1). | | | | | | +----------+----------+----------+----------+--------+----------+
### D.5.2 Manage UE policy complete
#### D.5.2.1 Message definition
The MANAGE UE POLICY COMPLETE message is sent by the UE to the PCF to report
that all received instructions have been successfully executed at the UE, see
table D.5.2.1.1
Message type: MANAGE UE POLICY COMPLETE
Significance: dual
Direction: UE to network
Table D.5.2.1.1: MANAGE UE POLICY COMPLETE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PTI | Procedure | M | V | 1 | | | | transaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +-----+-------------+-------------+----------+--------+--------+ | | MANAGE UE | UE policy | M | V | 1 | | | POLICY | delivery | | | | | | COMPLETE | service | | | | | | message | message | | | | | | identity | type | | | | | | | | | | | | | | D.6.1 | | | | +-----+-------------+-------------+----------+--------+--------+
### D.5.3 Manage UE policy command reject
#### D.5.3.1 Message definition
The MANAGE UE POLICY COMMAND REJECT message is sent by the UE to the PCF to
report that one or more instructions could not be successfully executed at the
UE, see table D.5.3.1.1
Message type: MANAGE UE POLICY COMMAND REJECT
Significance: dual
Direction: UE to network
Table D.5.3.1.1: MANAGE UE POLICY COMMAND REJECT message content
+----------+----------+----------+----------+--------+----------+ | IEI | Inf | Type/R | Presence | Format | Length | | | ormation | eference | | | | | | Element | | | | | +==========+==========+==========+==========+========+==========+ | | PTI | P | M | V | 1 | | | | rocedure | | | | | | | tra | | | | | | | nsaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +----------+----------+----------+----------+--------+----------+ | | MANAGE | UE | M | V | 1 | | | UE | policy | | | | | | POLICY | delivery | | | | | | COMMAND | service | | | | | | REJECT | message | | | | | | message | type | | | | | | identity | | | | | | | | D.6.1. | | | | +----------+----------+----------+----------+--------+----------+ | | UE | UE | M | LV-E | 11-65533 | | | policy | policy | | | | | | section | section | | | | | | ma | ma | | | | | | nagement | nagement | | | | | | result | result | | | | | | | | | | | | | | D.6.3 | | | | +----------+----------+----------+----------+--------+----------+ | NOTE: | | | | | | | The | | | | | | | total | | | | | | | length | | | | | | | of the | | | | | | | MANAGE | | | | | | | UE | | | | | | | POLICY | | | | | | | COMMAND | | | | | | | REJECT | | | | | | | message | | | | | | | cannot | | | | | | | exceed | | | | | | | 65535 | | | | | | | octets | | | | | | | (see | | | | | | | Payload | | | | | | | c | | | | | | | ontainer | | | | | | | contents | | | | | | | maximum | | | | | | | length | | | | | | | as | | | | | | | s | | | | | | | pecified | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 9.11. | | | | | | | 3.39.1). | | | | | | +----------+----------+----------+----------+--------+----------+
### D.5.4 UE state indication
#### D.5.4.1 Message definition
The UE STATE INDICATION message is sent by the UE to the PCF:
a) to deliver the UPSI(s) of the UE policy section(s) stored in the UE;
b) to indicate whether the UE supports ANDSP; and
c) to deliver the the UE\'s one or more OS Ids;
see table D.5.4.1.1.
Message type: UE STATE INDICATION
Significance: dual
Direction: UE to network
Table D.5.4.1.1: UE STATE INDICATION message content
+----------+----------+----------+----------+--------+---------+ | IEI | Inf | Type/R | Presence | Format | Length | | | ormation | eference | | | | | | Element | | | | | +==========+==========+==========+==========+========+=========+ | | PTI | P | M | V | 1 | | | | rocedure | | | | | | | tra | | | | | | | nsaction | | | | | | | identity | | | | | | | | | | | | | | 9.6 | | | | +----------+----------+----------+----------+--------+---------+ | | UE STATE | UE | M | V | 1 | | | IN | policy | | | | | | DICATION | delivery | | | | | | message | service | | | | | | identity | message | | | | | | | type | | | | | | | | | | | | | | D.6.1 | | | | +----------+----------+----------+----------+--------+---------+ | | UPSI | UPSI | M | LV-E | 9-65531 | | | list | list | | | | | | | | | | | | | | D.6.4 | | | | +----------+----------+----------+----------+--------+---------+ | | UE | UE | M | LV | 2-4 | | | policy | policy | | | | | | c | c | | | | | | lassmark | lassmark | | | | | | | | | | | | | | D.6.5 | | | | +----------+----------+----------+----------+--------+---------+ | 41 | UE OS Id | OS Id | O | TLV | 18-242 | | | | | | | | | | | D.6.6 | | | | +----------+----------+----------+----------+--------+---------+ | NOTE: | | | | | | | The | | | | | | | total | | | | | | | length | | | | | | | of the | | | | | | | UE STATE | | | | | | | IN | | | | | | | DICATION | | | | | | | message | | | | | | | content | | | | | | | cannot | | | | | | | exceed | | | | | | | 65535 | | | | | | | octets | | | | | | | (see | | | | | | | Payload | | | | | | | c | | | | | | | ontainer | | | | | | | contents | | | | | | | maximum | | | | | | | length | | | | | | | as | | | | | | | s | | | | | | | pecified | | | | | | | in | | | | | | | s | | | | | | | ubclause | | | | | | | 9.11. | | | | | | | 3.39.1). | | | | | | +----------+----------+----------+----------+--------+---------+
## D.6 Information elements coding
### D.6.1 UE policy delivery service message type
Table D.6.1.1: UE policy delivery service message type
* * *
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 0 Reserved 0 0 0 0 0 0 0 1 MANAGE UE POLICY COMMAND message 0 0
0 0 0 0 1 0 MANAGE UE POLICY COMPLETE message 0 0 0 0 0 0 1 1 MANAGE UE POLICY
COMMAND REJECT message 0 0 0 0 0 1 0 0 UE STATE INDICATION message
All other values are reserved
* * *
### D.6.2 UE policy section management list
The purpose of the UE policy section management list information element is to
transfer from the PCF to the UE a list of instructions to be performed at the
UE for management of UE policy section stored at the UE.
The UE policy section management list information element is coded as shown in
figure D.6.2.1, figure D.6.2.2, figure D.6.2.3, figure D.6.2.4, figure
D.6.2.5, figure D.6.2.6, figure D.6.2.7 and table D.6.2.1.
The _UE policy section management list information element has_ a minimum
length of 12 octets and a maximum length of 65534 octets.
+------------------------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------------------------+---------+---+---+---+---+---+---+---+ | UE policy section management list IEI | octet 1 | | | | | | | | +------------------------------------------------------+---------+---+---+---+---+---+---+---+ | Length of UE policy section management list contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +------------------------------------------------------+---------+---+---+---+---+---+---+---+ | UE policy section management list contents | octet 4 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +------------------------------------------------------+---------+---+---+---+---+---+---+---+
Figure D.6.2.1: UE policy section management list information element
+-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section management sublist (PLMN 1) | octet 4 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section management sublist (PLMN 2) | octet a+1 | | | | | | | | | | | | | | | | | | | | octet b | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | ... | octet b+1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet c | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section management sublist (PLMN N) | octet c+1 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +-----------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure D.6.2.2: UE policy section management list contents
+------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | Length of UE policy section management sublist | octet d | | | | | | | | | | | | | | | | | | | | octet d+1 | | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | | MCC digit 1 | octet d+2 | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | MCC digit 2 | | | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | | MCC digit 3 | octet d+3 | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | MNC digit 3 | | | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | | MNC digit 1 | octet d+4 | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | MNC digit 2 | | | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+ | UE policy section management sublist contents | octet d+5 | | | | | | | | | | | | | | | | | | | | octet y | | | | | | | | +------------------------------------------------+-------------+-----------+---+---+---+---+---+---+
Figure D.6.2.3: UE policy section management sublist
+---------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------+-----------+---+---+---+---+---+---+---+ | Instruction 1 | octet d+5 | | | | | | | | | | | | | | | | | | | | octet e | | | | | | | | +---------------+-----------+---+---+---+---+---+---+---+ | Instruction 2 | octet e+1 | | | | | | | | | | | | | | | | | | | | octet f | | | | | | | | +---------------+-----------+---+---+---+---+---+---+---+ | ... | octet f+1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet g | | | | | | | | +---------------+-----------+---+---+---+---+---+---+---+ | Instruction N | octet g+1 | | | | | | | | | | | | | | | | | | | | octet e | | | | | | | | +---------------+-----------+---+---+---+---+---+---+---+
Figure D.6.2.4: UE policy section management sublist contents
+-----------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-----------------------------+-----------+---+---+---+---+---+---+---+ | Instruction contents length | octet d+5 | | | | | | | | | | | | | | | | | | | | octet d+6 | | | | | | | | +-----------------------------+-----------+---+---+---+---+---+---+---+ | UPSC | octet d+7 | | | | | | | | | | | | | | | | | | | | octet d+8 | | | | | | | | +-----------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section contents | octet d+9 | | | | | | | | | | | | | | | | | | | | octet k | | | | | | | | +-----------------------------+-----------+---+---+---+---+---+---+---+
Figure D.6.2.5: Instruction
+------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------+-----------+---+---+---+---+---+---+---+ | UE policy part 1 | octet l | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +------------------+-----------+---+---+---+---+---+---+---+ | UE policy part 2 | octet m+1 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +------------------+-----------+---+---+---+---+---+---+---+ | ... | octet n+1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet o | | | | | | | | +------------------+-----------+---+---+---+---+---+---+---+ | UE policy part N | octet o+1 | | | | | | | | | | | | | | | | | | | | octet p | | | | | | | | +------------------+-----------+---+---+---+---+---+---+---+
Figure D.6.2.6: UE policy section contents
+--------------------------------+-----------+---+---+---------------------+-----------+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------+-----------+---+---+---------------------+-----------+---+---+---+ | UE policy part contents length | octet q | | | | | | | | | | | | | | | | | | | | octet q+1 | | | | | | | | +--------------------------------+-----------+---+---+---------------------+-----------+---+---+---+ | 0 | 0 | 0 | 0 | UE policy part type | octet q+2 | | | | +--------------------------------+-----------+---+---+---------------------+-----------+---+---+---+ | Spare | | | | | | | | | +--------------------------------+-----------+---+---+---------------------+-----------+---+---+---+ | UE policy part contents | octet q+3 | | | | | | | | | | | | | | | | | | | | octet r | | | | | | | | +--------------------------------+-----------+---+---+---------------------+-----------+---+---+---+
Figure D.6.2.7: UE policy part
Table D.6.2.1: UE policy section management list information element
* * *
Value part of the UE policy section management list information element
(octets 4 to z)
The value part of the UE policy section management list information element
consists of one or several UE policy section management sublists.
UE policy section management sublist:
Length of UE policy section management sublist (octets d to d+1)
This field contains the binary encoding of the length of the UE policy section
management sublist in units of octets.
MCC, Mobile country code (octet d+2, and bits 4 to 1 of octet d+3)
The MCC field is coded as in ITU-T Recommendation E.212 [42], annex A.
MNC, Mobile network code (bits 8 to 5 of octet d+3, and octet d+4)
The coding of this field is the responsibility of each administration but BCD
coding shall be used. The MNC shall consist of 2 or 3 digits. If a network
operator decides to use only two digits in the MNC, MNC digit 3 shall be coded
as \"1111\".
UE policy section management sublist contents (octets d+5 to y)
The UE policy section management sublist contents consist of one or several
instructions.
Instruction:
Instruction contents length (octets d+5 to d+6)
This field contains the binary encoding of the instruction contents length in
units of octets.
UPSC (octets d+7 to d+8)
This field contains the binary encoding of the UPSC. The value of the UPSC is
set by the PCF.
UE policy section contents (octets d+9 to k)
The UE policy section contents consist of one or several UE policy parts.
UE policy part:
UE policy part contents length (octets q to q+1)
This field contains the binary encoding of the UE policy part contents length
in units of octets.
UE policy part type (bits 4 to 1 of octet q+2)  
Bits  
4 3 2 1  
0 0 0 0 Reserved 0 0 0 1 URSP 0 0 1 0 ANDSP All other values are reserved.
Bits 8 to 5 of octet q+2 are spare and shall be coded as zero.
UE policy part contents
This field contains a UE policy part encoded as specified in 3GPP TS 24.526
[19].
* * *
### D.6.3 UE policy section management result
The purpose of the UE policy section management result information element is
to transfer from the UE to the PCF information about instructions for UE
policy section management which the UE could not execute successfully.
The UE policy section management result information element is coded as shown
in figure D.6.3.1, figure D.6.3.2, figure D.6.3.3, figure D.6.3.4, figure
D.6.3.5 and table D.6.3.1.
The _UE policy section management result information element has_ a minimum
length of 12 octets and a maximum length of 65534 octets.
+--------------------------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------------------------------------+---------+---+---+---+---+---+---+---+ | UE policy section management result IEI | octet 1 | | | | | | | | +--------------------------------------------------------+---------+---+---+---+---+---+---+---+ | Length of UE policy section management result contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +--------------------------------------------------------+---------+---+---+---+---+---+---+---+ | UE policy section management result contents | octet 4 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +--------------------------------------------------------+---------+---+---+---+---+---+---+---+
Figure D.6.3.1: UE policy section management result information element
+-------------------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------------------------------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section management subresult (PLMN 1) | octet 4 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +-------------------------------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section management subresult (PLMN 2) | octet a+1 | | | | | | | | | | | | | | | | | | | | octet b | | | | | | | | +-------------------------------------------------+-----------+---+---+---+---+---+---+---+ | ... | octet b+1 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet c | | | | | | | | +-------------------------------------------------+-----------+---+---+---+---+---+---+---+ | UE policy section management subresult (PLMN N) | octet c+1 | | | | | | | | | | | | | | | | | | | | octet z | | | | | | | | +-------------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure D.6.3.2: UE policy section management result contents
+---------------+-------------+-----------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +---------------+-------------+-----------+---+---+---+---+---+---+ | Number of | octet d | | | | | | | | | results | | | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | | MCC digit 1 | octet d+1 | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | MCC digit 2 | | | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | | MCC digit 3 | octet d+2 | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | MNC digit 3 | | | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | | MNC digit 1 | octet d+3 | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | MNC digit 2 | | | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+ | UE policy | octet d+4 | | | | | | | | | section | | | | | | | | | | management | octet y | | | | | | | | | subresult | | | | | | | | | | contents | | | | | | | | | +---------------+-------------+-----------+---+---+---+---+---+---+
Figure D.6.3.3: UE policy section management subresult
+----------+------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +----------+------------+---+---+---+---+---+---+---+ | Result 1 | octet d+4 | | | | | | | | | | | | | | | | | | | | octet d+8 | | | | | | | | +----------+------------+---+---+---+---+---+---+---+ | Result 2 | octet d+9 | | | | | | | | | | | | | | | | | | | | octet d+13 | | | | | | | | +----------+------------+---+---+---+---+---+---+---+ | ... | octet d+14 | | | | | | | | | | | | | | | | | | | | ... | | | | | | | | | | | | | | | | | | | | octet e | | | | | | | | +----------+------------+---+---+---+---+---+---+---+ | Result N | octet e+1 | | | | | | | | | | | | | | | | | | | | octet e+5 | | | | | | | | +----------+------------+---+---+---+---+---+---+---+
Figure D.6.3.4: UE policy section management subresult contents
+--------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +--------------------------+-----------+---+---+---+---+---+---+---+ | UPSC | octet f | | | | | | | | | | | | | | | | | | | | octet f+1 | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+ | Failed instruction order | octet f+2 | | | | | | | | | | | | | | | | | | | | octet f+3 | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+ | Cause | octet f+4 | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+
Figure D.6.3.5: Result
Table D.6.3.1: UE policy section management result information element
Value part of the UE policy section management result information element (octets 4 to z) |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  |  |   
The value part of the UE policy section management result information element consists of one or several UE policy section management subresults. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
UE policy section management subresult: |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Number of results (octet d) |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
This field contains the binary encoding of number of results included in the UE policy section management subresult. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
MCC, Mobile country code (octet d+1, and bits 4 to 1 of octet d+2) |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
The MCC field is coded as in ITU-T Recommendation E.212 [42], annex A. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
MNC, Mobile network code (bits 8 to 5 of octet d+2, and octet d+3) |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
The coding of this field is the responsibility of each administration but BCD coding shall be used. The MNC shall consist of 2 or 3 digits. If a network operator decides to use only two digits in the MNC, MNC digit 3 shall be coded as "1111". |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
UE policy section management subresult contents (octets d+4 to y) The UE policy section management subresult contents consist of one or several results. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Result (octet f to f+4) |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
UPSC (octet f to f+1) |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
This field contains the binary encoding of the UPSC. The value of the UPSC is set by the PCF |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Failed instruction order (octets f+2 to f+3) |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
This field contains the binary encoding of the order of the failed instruction in the UE policy section management sublist. |  |  |  |  |  |  |  |  |   
|  |  |  |  |  |  |  |  |   
Cause (octet f+4) |  |  |  |  |  |  |  |  |   
Bits |  |  |  |  |  |  |  |  |   
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |  |   
0 | 1 | 1 | 0 | 1 | 1 | 1 | 1 |  | Protocol error, unspecified  
The receiving entity shall treat any other value as 0110 1111, "protocol error, unspecified". |  |  |  |  |  |  |  |  |   
### D.6.4 UPSI list
The purpose of the UPSI list information element is to transfer from the UE to
the PCF a list of UPSIs.
The UPSI list information element is coded as shown in figure D.6.4.1, figure
D.6.4.2, and table D.6.4.1.
The _UPSI list information element has_ a minimum length of 10 octets and a
maximum length of 65532 octets.
+------------------------------+-------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------------+-------------+---+---+---+---+---+---+---+ | UPSI list IEI | octet 1 | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | Length of UPSI list contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | UPSI sublist (PLMN 1) | octet 4 | | | | | | | | | | | | | | | | | | | | octet a | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | UPSI sublist (PLMN 2) | octet a+1* | | | | | | | | | | | | | | | | | | | | octet b* | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | ... | octet b+1* | | | | | | | | | | | | | | | | | | | | octet c* | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+ | UPSI sublist (PLMN N) | octet c+1* | | | | | | | | | | | | | | | | | | | | octet z* | | | | | | | | +------------------------------+-------------+---+---+---+---+---+---+---+
Figure D.6.4.1: UPSI list information element
+------------------------+-------------+-----------+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | Length of UPSI sublist | octet d | | | | | | | | | | | | | | | | | | | | octet d+1 | | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | MCC digit 2 | MCC digit 1 | octet d+2 | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | MNC digit 3 | MCC digit 3 | octet d+3 | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | MNC digit 2 | MNC digit 1 | octet d+4 | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | UPSC | octet d+5 | | | | | | | | | | | | | | | | | | | | octet d+6 | | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | UPSC | octet d+7* | | | | | | | | | | | | | | | | | | | | octet d+8* | | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | ... | octet d+9* | | | | | | | | | | | | | | | | | | | | octet e* | | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+ | UPSC | octet e+1* | | | | | | | | | | | | | | | | | | | | octet e+2* | | | | | | | | +------------------------+-------------+-----------+---+---+---+---+---+---+
Figure D.6.4.2: UPSI sublist
Table D.6.4.1: UPSI list information element
* * *
MCC, Mobile country code (octet d+2, and bits 4 to 1 of octet d+3) The MCC
field is coded as in ITU-T Recommendation E.212 [42], annex A. MNC, Mobile
network code (bits 8 to 5 of octet d+3, and octet d+4) The coding of this
field is the responsibility of each administration but BCD coding shall be
used. The MNC shall consist of 2 or 3 digits. If a network operator decides to
use only two digits in the MNC, MNC digit 3 shall be coded as \"1111\". UPSC
(octets d+5 to d+6) This field contains the binary encoding of the UPSC. The
value of the UPSC is set by the PCF.
* * *
### D.6.5 UE policy classmark
The purpose of the UE policy classmark information element is to provide the
network with information about the policy aspects of the UE.
The UE policy classmark information element is coded as shown in figure
D.6.5.1 and table D.6.5.1.
The UE policy classmark is a type 4 information element with a minimum length
of 3 octets and a maximum length of 5 octets.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | P | octet | | | | | | | | | olicy | 1 | | | | | | | | | i | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of | | | | | | | | | | P | | | | | | | | | | olicy | | | | | | | | | | i | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | Su | octet | | | | | | | Spare | Spare | pport | 3 | | Spare | Spare | Spare | Spare | Spare | | | ANDSP | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | octet | | | | | | | | | | 4* | | | | | | | | | | -5* | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Spare | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure D.6.5.1: UE policy classmark information element
Table D.6.5.1: UE policy classmark information element
Support of ANDSP by the UE (SupportANDSP) (octet 3, bit 1)
* * *
Bit  
1  
0 ANDSP not supported by the UE 1 ANDSP supported by the UE
All other bits in octet 3 to 5 are spare and shall be coded as zero, if the
respective octet is included in the information element.
### D.6.6 UE OS Id
The purpose of the UE OS Id information element is to provide the network with
information about the OS of the UE.
The UE OS Id information element is coded as shown in figure D.6.6.1 and table
D.6.6.1.
The UE OS Id is a type 4 information element with a minimum length of 18 octet
and a maximum length of 242 octets.
8 7 6 5 4 3 2 1
* * *
OS Id IEI octet 1  
Length of OS Id information contents octet 2  
OS Id_1 octets 3 - 18  
... ...  
OS Id_15 octets 226* -242*
Figure D.6.6.1: UE OS Id information element
Table D.6.6.1: UE OS Id information element
OS Id:
* * *
The OS Id is coded as a sequence of a sixteen octet OS Id value field. The OS
Id value field is defined as Universally Unique IDentifier (UUID) as specified
in IETF RFC 4122 [35A].
## D.7 Timers of UE policy delivery service
Timers of UE policy delivery service are shown in table D.7.1.
Table D.7.1: Timers of UE policy delivery service -- PCF side
* * *
TIMER NUM. TIMER VALUE CAUSE OF START NORMAL STOP ON\ THE\ 1^st^, 2^nd^,
3^rd^, 4^th^ EXPIRY
T3501 NOTE 1 Transmission of MANAGE UE POLICY COMMAND MANAGE UE POLICY COMMAND
COMPLETE or MANAGE UE POLICY COMMAND REJECT message received Retransmission of
MANAGE UE POLICY COMMAND message
NOTE 1: The value of this timer is network dependent.
* * *
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document covers the minimum characteristics considered necessary
in order to provide compliance to 3GPP TS 43.019 [7].
The present document describes the technical characteristics and methods of
test for testing the SIM API for Java Card^TM^ (3GPP TS 43.019 [7])
implemented in the Subscriber Identity Modules (SIMs) for GSM. It specifies
the following parts:
\- test applicability;
\- test environment description;
\- tests format;
\- test area reference;
\- conformance requirements;
\- test auite files;
\- test procedure;
\- test coverage; and
\- a description of the associated testing tools that shall be used.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
− References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
− For a specific reference, subsequent revisions do not apply.
− For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] Void.
[2] Void.
[3] 3GPP TS 51.011: \"Specification of the Subscriber Identity Module \-
Mobile Equipment (SIM - ME) interface (Release 4)\".
[4] 3GPP TS 11.14: \"Specification of the Subscriber Identity Module - Mobile
Equipment (SIM - ME) interface (Release 99)\".
[5] 3GPP TS 11.17: \"Digital cellular telecommunications system (Phase 2+);
Subscriber Identity Module (SIM) test specification (Release 99)\".
[6] Void.
[7] 3GPP TS 43.019: \"Subscriber Identity Module Application Programming
Interface (SIM API) for Java Card™; Stage 2 (Release 5)\".
[8] 3GPP TS 23.048: \"Security Mechanisms for the (U)SIM application toolkit;
Stage 2 (Release 5)\".
[9] ISO/IEC 7816-3 (1997): \"Information technology - Identification cards -
Integrated circuit(s) cards with contacts - Part 3: Electronic signals and
transmission protocols\".
[10] 3GPP TS 42.019: \"Subscriber Identity Module Application Programming
Interface (SIM API); Stage 1 (Release 5)\".
[11] SUN Java Card Specification \"Java Card 2.1 API Specification\".
[12] SUN Java Card Specification \"Java Card 2.1 Runtime Environment
Specification\".
[13] SUN Java Card Specification \"Java Card 2.1 VM Architecture
Specification\".
NOTE: SUN Java Card Specifications can be downloaded at
http://java.sun.com/products/javacard.
[14] ETSI TS 101 220: \"Smart Cards; ETSI numbering system for
telecommunication application providers\".
[15] 3GPP TS 51.010-1: \"Mobile Station (MS) conformance specification; Part
1: Conformance specification (Release 5)\".
[16] 3GPP TS 51.014: \"Specification of the SIM Application Toolkit for the
Subscriber Identity Module - Mobile Equipment (SIM - ME) interface\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TS 51.010-1 [15] and the following apply:
**applet:** application built up using a number of classes which will run
under the control of the Java Card virtual machine
**applet installation parameters:** default values for applet installation
parameters
**applet loading script:** file containing the APDU commands that will load
and install the test applet in the card
**CleanUp Script file:** file containing the APDU commands that will restore
the Default Initial Conditions on the SIM
**Conformance Requirement Reference:** description of the expected card
behaviour according to 3GPP TS 43.019 [7]
**expected state:** state in which the SIM is supposed to be after the
execution of the test procedure applied on the relevant initial conditions
**security parameters:** minimum security requirements defined for the applet
installation process
**test area:** set of Test Cases applicable to a specific part (class method,
framework behaviour, ...) of the 3GPP TS 43.019 [7].
**test case:** elementary test that checks for compliance with one or more
Conformance Requirement References
**test Output file:** TBD.
**test procedure:** the sequence of actions/commands to perform all the test
cases defined in a test area
**test script file:** file containing the APDU commands that will execute and
verify the test results
**Test Toolkit Applet:** applet designed to test a specific functionality of
the SIM API (3GPP TS 43.019 [7])
## 3.2 Abbreviations
For the purpose of the present document, the abbreviations given in GSM 01.04
[2] and the following apply:
AC Application Code
AID Application Identifier
APDU Application Protocol Data Unit
API Application Programming Interface
CAD Card Acceptance Device
CRR Conformance Requirements Reference
CRRC Conformance Requirement Reference Context Error
CRRN Conformance Requirement Reference Normal
CRRP Conformance Requirement Reference Parameter Error
FFS For Further Study
IFD Interface Device
JCRE Java Card™ Run Time Environment
JVM Java Virtual Machine
SE Sending Entity
SIM Subscriber Identity Module
# 4 Test Environment
This clause specifies requirements that shall be met and the testing rules
that shall be followed during the test procedure.
## 4.1 Applicability
The tests defined in the present document shall be performed taking into
account the services supported by the card as specified in the EF~SST~ file.
The test defined in the present document are applicable to cards implementing
3GPP TS 43.019 [7] unless otherwise stated.
The tests defined in the present document require that the card support the
concatenation process with 2 concatenated SMS. Therefore the envelope handler
shall support 280 bytes of data.
## 4.2 Test environment description
The general architecture for the test environment is.
NOTE: Figure 4.2 shows the test architecture required to test interoperability
at both API and bytcode level. The latter is currently not included in the
current specification. The diagram is for information.
Figure 4.2
## 4.3 Tests format
### 4.3.1 Test Area Reference
Each test area is referenced as follows:
API Testing:: \'API_[package name]_[classname]_[methodname]\' where
package name:
sim.access package: \'1\'
sim.toolkit package: \'2\'
class name:
yyy: 3 letters for each class.
See Annex A for full classes acronyms list.
method name:
zzzz[input parameters]:
See Annex A for full methods name acronyms list.
FWK: framework testing
Chapter name:
xxx: 3 letters for each chapter
See annex F for full chapter acronyms list
Subchapter name
yyyy: : 4 letters for each subchapter
See annex F for full subchapter acronyms list
LDR: loader testing
[TBD]
#### 4.3.1.1 Conformance requirements
The conformance requirements are expressed in the following way:
\- Method prototype as listed in 3GPP TS 43.019 [7].
\- Normal execution:
\- Contains normal execution and correct parameters limit values, each
referenced as a Conformance Requirement Reference Normal (CRRN).
\- Parameters error:
\- Contains parameter errors and incorrect parameter limit values, each
referenced as a Conformance Requirement Reference Parameter Error (CRRP).
\- Context error:
\- Contains errors due to the context the method is used in, each referenced
as a Conformance Requirement Reference Context Error (CRRC).
#### 4.3.1.2 Test Area files
The files included in the Test Area use the following naming convention:
\- Test Script: [Test Area Reference]_[Test script number].scr
\- Test Applet: [Test Area Reference]_[Test applet number].java
\- Load Script: [Test Area Reference]_[Load Script number].ldr
\- Cleanup Script: [Test Area Reference]_[Cleanup Script number].clr
\- Parameter File: [Test Area Reference]_[Parameter File number].par
The test script, applet, installation parameters, load script, cleanup script
and conversion parameters numbers start from \'1\'.
The test script, load script and cleanup script shall share a common syntax
and format (see Annex B).
The parameter file has an own syntax (see annex G) and contains parameters to
be used for CAP-file conversion and loading/cleanup script generation.
Scripts file shall be run in the following order:
[Test Area Reference]_1.ldr
[Test Area Reference]_1.scr
[Test Area Reference]_1.clr
[Test Area Reference]_2.ldr
[Test Area Reference]_2.scr
[Test Area Reference]_2.clr
....
[Test Area Reference]_n.ldr
[Test Area Reference]_n.scr
[Test Area Reference]_n.clr
In case that one of the files is not needed, it shall be skipped during the
tests execution.
#### 4.3.1.3 Test Procedure
Each test procedure contains a table to indicate the expected responses form
the API and/or the APDU level as follows:
Test Case
* * *
Id Description API Expectation APDU Expectation _Test Case detailed
description_ _API expected behaviour._ _Expected response at APDU level._
#### 4.3.1.4 Test Coverage
The table at the end of each test procedure indicates the correspondence
between the Conformance Requirements Reference (CRR) and the different test
cases.
## 4.4 Initial Conditions
The Initial Conditions are a set of general prerequisites for the SIM prior to
the execution of testing. For each test procedure described in the present
document, the following rules apply to the Initial Conditions:
\- unless otherwise stated, the file system and the files\' content shall
fulfil the requirements described in annex C;
\- unless otherwise stated, before installing the applet(s) relevant to the
current test procedure, all packages specific to other test procedures shall
not be present.
When both statements apply, a test procedure is said to be in the \"Default
Initial Conditions\" state.
## 4.5 Package name
Java packages integrating this Test Suite shall follow this naming convention:
**sim.test.access.[Test Area Reference]:** Java Card packages containing Test
Area References for the 3GPP TS 43.019 [7] sim.access package.
**sim.test.framework.[Test Area Reference]:** Java Card packages containing
Test Area References for the 3GPP TS 43.019 [7] framework.
**sim.test.util:** for the Test util package defined in this Test Suite.
**sim.test.toolkit.[Test Area Reference]:** Java Card packages containing Test
Area References for the 3GPP TS 43.019 [7] sim.toolkit package.
EXAMPLE: The package _../sim.test.access.[Test Area Reference]_ creates the
following directory structure _../sim/test/access/[Test Area
Reference]/API_1_..._[1..n].*,_ where \'_API_1_..._[1..n].*\'_ are the
different test applets Java source files used in _[Test Area Reference]_.
## 4.6 AID Coding
The AID coding for the Test Packages, Applet classes and Applet shall be as
specified in TS 101 220 [14]. In addition, the following TAR values are
defined for use within the present document:
TAR Coding (3 bytes/ 24 bits):
b1 b2 b3 b4 b5 b6 b21 b22 b23 b24
* * *
                                                                                                  Specific Test Applet Name
                                                                                                  Test Package Identifier
Test package Identifier( bits b1-b3):
000: reserved (as TAR= \'00.00.00\' is reserved for Card Manager)
001: API
010: Framework
011: Loader
111: sim.test.util
other values are RFU
Application Provider specific data (1 byte):
\'00\': for Package
\'01\': for Applet class
\'02\': for Applet Instance
EXAMPLE: The AID of Package sim.test.util is \'A0 00 00 00 09 00 02 FF FF FF
FF 89 E0 00 00 00\'.
### 4.6.1 Specific Test Applet Name for API
Specific applet test name (bits b4-b24):
b4 b5 b6 b7 b8 b9 b10 b11 b12 b13 b14 b15 b16 b17 b18 b19 b20 b21 b22 b23 b24
* * *
                                                                                                                                                                                         Applet instance Number
                                                                                                                                                                                         Applet Class Number
                                                                                                                                                                                         Method
                                                                                                                                                                                         Class
                                                                                                                                                                                         API Test Package
for API Test Package(3 bits)
001 sim.access
010 sim.toolkit
other are RFU
Class (5 bits): need to be assigned specification order see Annex A for the
full list
Method (6 bits): need to be assigned specification order see Annex A for the
full list
Applet Class Number (5 bits): linked to Test Area, it shall start with 1 for
classes and shall be 0 for package.
> Applet Instance Number (2 bits) defined in the test procedure it shall start
> with 01 for applet instance and shall be 00 for package and class.
### 4.6.2 Specific Test Applet Name for Framework
Specific applet test name (bits b4-b24):
b4 b5 b6 b7 b8 b9 b10 b11 b12 b13 b14 b15 b16 b17 b18 b19 b20 b21 b22 b23 b24
* * *
                                                                                                                                                                                         RFU ( set to 0 )
                                                                                                                                                                                         Applet instance Number
                                                                                                                                                                                         Applet Class Number
                                                                                                                                                                                         Test Area within the chapter
                                                                                                                                                                                         Chapter
for Chapter (5 bits)
00001 Toolkit Installation Parameters
00010 Minimum Handler Availability
00011 Handler Integrity
00100 Applet Triggering
00101 Proactive Command Sending
00110 Framework Security
00111 Envelope Response Posting
01000 File System Context
01001 Exception Handling
01010 Other parts transferred to framework from API
01011 Concatenation processing
other are RFU
Test Area within the chapter (6 bits): values are defined in Annex F
Applet Class number (5 bits): linked to Test Area, it shall start with 1 for
classes and shall be 0 for package.
> Applet Instance number (3 bits) defined in the test procedure it shall start
> with 01 for applet instance and shall be 00 for package and class.
## 4.7 Test Equipment
These clauses recommend a minimum specification for each of the items of test
equipment referenced in the tests.
### 4.7.1 APDU tool
This test tool shall meet the following requirements:
\- be able to send command to the card TPDU;
\- be able to check none, only a part, or all of the data returned;
\- be able to check none, only part, or all of the status returned;
\- be able to accept all valid status codes returned;
\- be able to support Reader commands;
\- be able to generate a log file for each test execution.
\- if more data is returned than defined in the test specification, the tool
shall continue;
\- if less data is returned than defined in the test specification, the tool
shall aborts and return an error;
\- if there is an error in data or status returned, the tool shall abort and
return an error.
The log file produced by the test tool shall include the following
information:
\- all commands issued;
\- all data returned;
\- all status returned;
\- all errors codes;
\- expected data and status in case of error;
\- comments from the scripts;
\- a log message to report success or failure of the test.
### 4.7.2 Util package
Annex D includes java source code for the sim.test.util package as well as
loading , testing and cleaning script examples.
### 4.7.3 Applet installation parameters
#### 4.7.3.1 Security parameters
Loading scripts shall use the following security parameters as stated in 3GPP
TS 23.048 [8] for applet installation:
**Parameter** **Value in hexadecimal**
* * *
SPI 0A 00 KIC 00 KID Value as described in the TS 23.048[8] (recommended
value: 15) TAR 00 00 00 CNTR 00 00 00 00 01 PCNTR 00 Key Corresponding to KID
(recommended value: 01 23 45 67 89 AB CD EF EF CD AB 89 67 45 23 01)
#### 4.7.3.2 Loading components
Cap files in loading scripts shall not include the descriptor component as
described in Java Card 2.1 VM Architecture Specification [13].
## 4.8 Testing methodology
### 4.8.1 Test interfaces and facilities
The SIM-ME interface provides the main transport interface for the purpose of
performing conformance tests.
The SIM API interface provides the main test interface for the purpose of
performing conformance tests.
# 5 Test plan
The test plan is divided according to the SIM API specification, that way the
tests will follow the class hierarchy for the sim.toolkit and sim.access
package; for the SIM Toolkit framework this test plan describes the different
points that will be tested with the present test specification.
# 6 API Test Plan
## 6.1 Package sim.access:
### 6.1.1 Interface SIMView
NOTE: The Test applet shall be run on a class that implements this interface.
#### 6.1.1.1 Constants
Test Area Reference: API_1_SVW_CONST
##### 6.1.1.1.1 Conformance Requirements {#conformance-requirements-1 .H6}
This clause does not describe the conformance requirements for a method, but
rather for the constants of the interface.
##### 6.1.1.1.1.1 Normal execution {#normal-execution .H6}
CRRN1: The constants shall have the same name and value that is defined in
3GPP TS 43.019 [7].
##### 6.1.1.1.2 Test Suite Files {#test-suite-files .H6}
None.
##### 6.1.1.1.3 Test Procedure {#test-procedure-1 .H6}
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed.
#### 6.1.1.2 Method select(short fid, byte[] fci, short fciOffset, short
fciLength)
Test Area Reference: API_1_SVW_SLCTS_BSS
##### 6.1.1.2.1 Conformance Requirements {#conformance-requirements-2 .H6}
The method with the following header shall be compliant to its definition in
the API.
public short select(short fid,
byte[] fci,
short fciOffset,
short fciLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.2.1.1 Normal execution {#normal-execution-1 .H6}
− CRRN1: If the desired file is selected, the length of the FCI (File Control
Information) which has been written to the array fci is returned.
− CRRN2: If the length fciLength is greater than or equal to the length of the
FCI structure, the whole FCI structure is copied into the array fci and the
length of the FCI which has been written to the array fci is returned.
− CRRN3: If the length fciLength is less than the length of the FCI structure,
the first part of the FCI structure is copied into the array fci and the
length of the FCI which has been written to the array fci is returned.
− CRRN4: After selecting a DF/MF no EF is selected.
− CRRN5: After selecting a linear fixed EF no record is selected.
− CRRN6: After selecting a cyclic EF the first record which is the last
updated record is selected.
− CRRN7: The current files (file context) of any other applets shall not be
changed. See TS 43.019 [7] - clause5.2. This will be tested during the testing
of the framework.
− CRRN8: The information returned by fci shall be formatted as described in TS
51.011 [3], clause9.2.1.
− CRRN9: The file with a File-ID that matches fid shall be found according to
the following selection rules:
1) An immediate child EF or DF of the current MF/DF can be selected,
2) A sibling DF of the current DF can be selected,
3) The current MF/DF it self can be selected,
4) The parent MF/DF of the current DF can be selected,
5) The MF can always be selected.
##### 6.1.1.2.1.2 Parameter errors {#parameter-errors .H6}
− CRRP1: If the array fci is null, an instance of NullPointerException shall
be thrown.
− CRRP2: If fciOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP3: If fciLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP4: If fciOffset plus fciLength is greater than the length of the array
fci.length, or fciOffset equals fci.length, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.2.1.3 Context errors {#context-errors .H6}
− CRRC1: If the file with a File-ID which matches fid could not be found
according to the selection rules listed in CRRN9, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_NOT_FOUND.
− CRRC2: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC3: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.2.2 Test Suite Files {#test-suite-files-1 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_SLCTS_BSS_1.scr
Test Applet: API_1_SVW_SLCTS_BSS_1.java
Load Script: API_1_SVW_SLCTS_BSS_1.ldr
Cleanup Script: API_1_SVW_SLCTS_BSS_1.clr
Parameter File: API_1_SVW_SLCTS_BSS_1.par
##### 6.1.1.2.3 Test Procedure {#test-procedure-2 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | **SIM | Responses ignored. | | | | Initialization** | | | +----+--------------------+--------------------+------------------+ | 1 | Select EFICCID in | No exception shall | | | | MF (Transparent | be thrown. | | | | EF) | | | | | | Shall return a | | | | fid = | value not greater | | | | SIMV | than 20. | | | | iew.FID_EF_ICCID | | | | | | \ | | +----+--------------------+--------------------+------------------+ | 2 | Select EF~ICCID~ | No exception shall | | | | in MF (Transparent | be thrown. | | | | EF) | | | | | | Shall return 13. | | | | fid = | | | | | SIMV | fci shall contain | | | | iew.FID_EF_ICCID | the first 13 bytes | | | | | of the FCI | | | | fciOffset = 0 | structure. | | | | | | | | | fciLength = 13 | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 3 | Select DF~GSM~ in | No exception shall | | | | MF | be thrown. | | | | | | | | | fid = | Shall return 7. | | | | SI | | | | | MView.FID_DF_GSM | fci shall contain | | | | | the first 7 bytes | | | | fciOffset = 0 | of the FCI. | | | | | | | | | fciLength = 7 | _\ _ | | +----+--------------------+--------------------+------------------+ | 3 | Select DF~GSM~ in | No exception shall | | | | MF | be thrown. | | | | | | | | | fid = | Shall return 7. | | | | SI | | | | | MView.FID_DF_GSM | fci shall contain | | | | | the entire FCI | | | | fciOffset = 0 | structure. | | | | | | | | | fciLength = 7 | _\ _ | | +----+--------------------+--------------------+------------------+ | 4 | Select EF~ACM~ in | No exception shall | | | | DF~GSM~ (CyclicEF) | be thrown. | | | | | | | | | fid = | Shall return a | | | | SI | value between 15 | | | | MView.FID_EF_ACM | and 20. (Cyclic | | | | | EF) | | | | fciOffset = 0 | | | | | | fci shall contain | | | | fciLength = 20 | the first 15 or | | | | | more bytes of the | | | | select() | FCI structure. | | | | | | | | | | fci[14] shall | | | | | have the value 3 | | | | | (length of | | | | | record). | | +----+--------------------+--------------------+------------------+ | 5 | Select MF | No exception shall | | | | | be thrown. | | | | fid = | | | | | SIMView.FID_MF | Shall return a | | | | | value between 22 | | | | fciOffset = 0 | and 34. | | | | | | | | | fciLength = 34 | fci shall contain | | | | | the entire FCI | | | | select() | structure. | | +----+--------------------+--------------------+------------------+ | 6 | Select DF~TELECOM~ | No exception shall | | | | in MF | be thrown. | | | | | | | | | fid = | Shall return 20. | | | | SIMVie | | | | | w.FID_DF_TELECOM | fci shall contain | | | | | the first 20 bytes | | | | fci[0] = | of the FCI | | | | fci[1] = \'05\' | structure starting | | | | | at index 2. The | | | | fciOffset = 2 | first two bytes | | | | | shall (still) have | | | | fciLength = 20 | the value \'05\'. | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 7 | Select EF~FDN~ in | No exception shall | | | | DF~TELECOM~ | be thrown. | | | | (Linear FixedEF) | | | | | | Shall return 15. | | | | fid = | | | | | SI | fci shall contain | | | | MView.FID_EF_FDN | the first 15 bytes | | | | | of the FCI | | | | fciOffset = 0 | structure. | | | | | | | | | fciLength = 15 | fci[14] shall | | | | | have the value 28 | | | | select() | (length of | | | | | record). | | +----+--------------------+--------------------+------------------+ | 8 | fci is null | Shall throw | | | | | java.lang.Nul | | | | fid = | lPointerException. | | | | SI | | | | | MView.FID_EF_FDN | | | | | | | | | | byte[] | | | | | nullBuffer = null | | | | | | | | | | fciOffset = 0 | | | | | | | | | | fciLength = 15 | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 9 | fciOffset \ | java. | | | | fci.length | lang.ArrayIndexOut | | | | | OfBoundsException. | | | | fid = | | | | | SI | | | | | MView.FID_EF_FDN | | | | | | | | | | fciOffset = 20 | | | | | | | | | | fciLength = 15 | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 12 | fciOffset | Shall throw | | | | fci.length | java | | | | | .lang.ArrayIndexOu | | | | fid = | tOfBoundsException | | | | SI | | | | | MView.FID_EF_FDN | | | | | | | | | | fciOffset = 34 | | | | | | | | | | fciLength = 1 | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 13 | Selection | 1 - No exception | | | | possibilities | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | SIMView.FID_MF | shall be thrown. | | | | | | | | | fciOffset = 0 | 3 - No exception | | | | | shall be thrown. | | | | fciLength = 15 | | | | | | 4 - No exception | | | | select() | shall be thrown. | | | | | | | | | 2 - fid = | 5 - No exception | | | | SIMVie | shall be thrown. | | | | w.FID_DF_TELECOM | | | | | | 6 - No exception | | | | select() | shall be thrown. | | | | | | | | | 3 - fid = | 7 - No exception | | | | SIMView | shall be thrown. | | | | .FID_DF_GRAPHICS | | | | | | 8 - No exception | | | | select() | shall be thrown. | | | | | | | | | 4 - fid = | 9 - No exception | | | | SIMVie | shall be thrown. | | | | w.FID_DF_TELECOM | | | | | | | | | | select() | | | | | | | | | | 5 - fid = | | | | | SIMView | | | | | .FID_DF_GRAPHICS | | | | | | | | | | select() | | | | | | | | | | 6 - fid = | | | | | SIMView.FID_MF | | | | | | | | | | select() | | | | | | | | | | 7 - fid = | | | | | SI | | | | | MView.FID_DF_GSM | | | | | | | | | | select() | | | | | | | | | | 8 - fid = | | | | | SIMVie | | | | | w.FID_DF_TELECOM | | | | | | | | | | select() | | | | | | | | | | 9 - fid = | | | | | SIMVie | | | | | w.FID_DF_TELECOM | | | | | | | | | | select() | | | | | | | | | | - | | | +----+--------------------+--------------------+------------------+ | 14 | EF not selected | 1 - No exception | | | | after MF/DF | shall be thrown. | | | | selection | | | | | | 2 - Shall throw | | | | 1 - fid = | sim.acces | | | | SIMView.FID_MF | s.SIMViewException | | | | | with reason code | | | | select() | NO_EF_SELECTED. | | | | | | | | | fid = | | | | | SIMV | | | | | iew.FID_EF_ICCID | | | | | | | | | | select() | | | | | | | | | | 2 - fid = | | | | | SIMView.FID_MF | | | | | | | | | | select() | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 15 | No selection of | 1 - No exception | | | | non-reachable file | shall be thrown. | | | | | | | | | 1 - fid = | 2 - Shall throw | | | | SIMView.FID_MF | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | FILE_NOT_FOUND. | | | | 2 - fid = | | | | | SI | | | | | MView.FID_EF_ACM | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 16 | No record is | 1 - No exception | | | | selected after | shall be thrown. | | | | selecting linear | | | | | fixed EF | 2 - No exception | | | | | shall be thrown. | | | | 1 - fid = | | | | | SIMView.FID_MF | 3 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 4 - Shall throw | | | | 2 - fid = | sim.acces | | | | FID_DF_SIMTEST | s.SIMViewException | | | | | with reason code | | | | select() | RECORD_NUMBE | | | | | R_NOT_AVAILABLE. | | | | 3 - fid = | | | | | FID_EF_LARU | | | | | | | | | | select() | | | | | | | | | | 4 - recNumber = 0 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 17 | Record pointer in | 1 - No exception | | | | selected cyclic EF | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | SIMView.FID_MF | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid = | | | | | FID_DF_SIMTEST | 4 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 5 - The contents | | | | 3 - fid = | of data1 and data2 | | | | FID_EF_CARU | shall be | | | | | identical. | | | | select() | | | | | | | | | | 4 - byte[] data1 | | | | | = { 1,2,3 } | | | | | | | | | | mode = | | | | | REC_A | | | | | CC_MODE_PREVIOUS | | | | | | | | | | u | | | | | pdateRecord(data1) | | | | | | | | | | 5 - fid = | | | | | FID_EF_CARU | | | | | | | | | | select() | | | | | | | | | | readRecord(data2) | | | | | | | | | | compare data1 to | | | | | data2 | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.2.4 Test Coverage {#test-coverage-1 .H6}
CRR Number Test Case Number
* * *
N1 1-7 N2 3, 5 N3 1, 2, 4, 6, 7 N4 14 N5 16 N6 17 N8 1, 3 N9 1-7, 13 P1 8 P2 9
P3 10 P4 11, 12 C1 15 C2, C3 Not Tested
#### 6.1.1.3 Method select (short fid)
Test Area Reference: API_1_SVW_SLCTS
##### 6.1.1.3.1 Conformance Requirements {#conformance-requirements-3 .H6}
The method with the following header shall be compliant to its definition in
the API.
public void select(short fid)
throws SIMViewException
##### 6.1.1.3.1.1 Normal execution {#normal-execution-2 .H6}
− CRRN1: If the desired file is selected, no exception is thrown.
− CRRN2: After selecting a DF/MF no EF is selected.
− CRRN3: After selecting a linear fixed EF no record is selected.
− CRRN4: After selecting a cyclic EF the first record which is the last
updated record is selected.
− CRRN5: The current files (file context) of any other applets shall not be
changed [TS 43.019 [7] - clause5.2]. This will be tested during the testing of
the framework.
−
1) An immediate child EF or DF of the current MF/DF can be selected,
2) A sibling DF of the current DF can be selected,
3) The current MF/DF it self can be selected,
4) The parent MF/DF of the current DF can be selected,
5) The MF can always be selected.
##### 6.1.1.3.1.2 Parameter errors {#parameter-errors-1 .H6}
No requirements.
##### 6.1.1.3.1.3 Context errors {#context-errors-1 .H6}
− CRRC1: If the file with a File-ID which matches fid could not be found
according to the selection rules listed in CCRN6, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_NOT_FOUND.
− CRRC2: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC3: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.3.2 Test Suite Files {#test-suite-files-2 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_SLCTS_1.scr
Test Applet: API_1_SVW_SLCTS_1.java
Load Script: API_1_SVW_SLCTS_1.ldr
Cleanup Script: API_1_SVW_SLCTS_1.clr
Parameter File: API_1_SVW_SLCTS_1.par
##### 6.1.1.3.3 Test Procedure {#test-procedure-3 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | Select EF~ICCID~ | No exception shall | | | | in MF (Transparent | be thrown. | | | | EF) | | | | | | | | | | fid = | | | | | SIMV | | | | | iew.FID_EF_ICCID | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 2 | EF not selected | 1 - No exception | | | | after MF/DF | shall be thrown. | | | | selection | | | | | | 2 - Shall throw | | | | 1 - fid = | sim.acces | | | | SIMView.FID_MF | s.SIMViewException | | | | | with reason code | | | | select() | NO_EF_SELECTED. | | | | | | | | | fid = | | | | | SIMV | | | | | iew.FID_EF_ICCID | | | | | | | | | | select() | | | | | | | | | | 2 - fid = | | | | | SIMView.FID_MF | | | | | | | | | | select() | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 3 | No record is | 1 - No exception | | | | selected after | shall be thrown. | | | | selecting linear | | | | | fixed EF | 2 - No exception | | | | | shall be thrown. | | | | 1 - fid = | | | | | SIMView.FID_MF | 3 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 4 - Shall throw | | | | 2 - fid = | sim.acces | | | | FID_DF_SIMTEST | s.SIMViewException | | | | | with reason code | | | | select() | RECORD_NUMBE | | | | | R_NOT_AVAILABLE. | | | | 3 - fid | | | | | =FID_EF_LARU | | | | | | | | | | select() | | | | | | | | | | 4 - recNumber = 0 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 4 | Record pointer in | 1 - No exception | | | | selected cyclic EF | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | SIMView.FID_MF | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid | | | | | =FID_DF_SIMTEST | 4 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 5 - The contents | | | | 3 - fid = | of data1 and data2 | | | | FID_EF_CARU | shall be | | | | | identical. | | | | select() | | | | | | | | | | 4 - byte[] data1 | | | | | = { 1,2,3 } | | | | | | | | | | u | | | | | pdateRecord(data1) | | | | | | | | | | 5 - fid = | | | | | FID_EF_CARU | | | | | | | | | | select() | | | | | | | | | | readRecord(data2) | | | | | | | | | | compare data1 to | | | | | data2 | | | +----+--------------------+--------------------+------------------+ | 5 | Selection | 1 - No exception | | | | possibilities | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | SIMView.FID_MF | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid = | | | | | SIMVie | 4 - No exception | | | | w.FID_DF_TELECOM | shall be thrown. | | | | | | | | | select() | 5 - No exception | | | | | shall be thrown. | | | | 3 - fid = | | | | | SIMView | 6 - No exception | | | | .FID_DF_GRAPHICS | shall be thrown. | | | | | | | | | select() | 7 - No exception | | | | | shall be thrown. | | | | 4 - fid = | | | | | SIMVie | 8 - No exception | | | | w.FID_DF_TELECOM | shall be thrown. | | | | | | | | | select() | 9 - No exception | | | | | shall be thrown. | | | | 5 - fid = | | | | | SIMView | | | | | .FID_DF_GRAPHICS | | | | | | | | | | select() | | | | | | | | | | 6 - fid = | | | | | SIMView.FID_MF | | | | | | | | | | select() | | | | | | | | | | 7 - fid = | | | | | SI | | | | | MView.FID_DF_GSM | | | | | | | | | | select() | | | | | | | | | | 8 - fid = | | | | | SIMVie | | | | | w.FID_DF_TELECOM | | | | | | | | | | select() | | | | | | | | | | 9 - fid = | | | | | SIMVie | | | | | w.FID_DF_TELECOM | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+ | 6 | No selection of | 1 - No exception | | | | unreachable file | shall be thrown. | | | | | | | | | 1 - fid = | 2 - Shall throw | | | | SIMView.FID_MF | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | FILE_NOT_FOUND. | | | | 2 - fid = | | | | | SI | | | | | MView.FID_EF_ACM | | | | | | | | | | select() | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.3.4 Test Coverage {#test-coverage-2 .H6}
CRR Number Test Case Number
* * *
N1 1 N2 2 N3 3 N4 4 N6 5 C1 6 C2, C3 Not Tested
#### 6.1.1.4 Method status
Test Area Reference: API_1_SVW_STAT_BSS
##### 6.1.1.4.1 Conformance Requirements {#conformance-requirements-4 .H6}
The method with the following header shall be compliant to its definition in
the API.
public short status(byte[] fci,
short fciOffset,
short fciLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.4.1.1 Normal execution {#normal-execution-3 .H6}
− CRRN1: The FCI (File Control Information) of the current DF (or MF) is
returned in the same format as for a SELECT command in case of selecting an
MF/DF (described in 3GPP TS 43.019 [7], clause 9.2.1).
− CRRN2: If the length fciLength is greater than or equal to the length of the
FCI structure, the whole FCI structure is copied into the array fci and the
length of the FCI which has been written to the array fci is returned.
− CRRN3: If the length fciLength is less than the length of the FCI structure,
the first part of the FCI structure is copied into the array fci and the
length of the FCI which has been written to the array fci is returned.
##### 6.1.1.4.1.2 Parameter errors {#parameter-errors-2 .H6}
− CRRP1: If the array fci is null, an instance of NullPointerException shall
be thrown.
− CRRP2: If fciOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP3: If fciLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP4: If fciOffset plus fciLength is greater than the length of the array
fci.length, or fciOffset equals fci.length, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.4.1.3 Context errors {#context-errors-2 .H6}
− CRRC1: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC2: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.4.2 Test Suite Files {#test-suite-files-3 .H6}
Additional requirements for the GSM personalization:
Test Script: API_1_SVW_STAT_BSS_1.scr
Test Applet: API_1_SVW_STAT_BSS_1.java
Load Script: API_1_SVW_STAT_BSS_1.ldr
Cleanup Script: API_1_SVW_STAT_BSS_1.clr
Parameter File: API_1_SVW_STAT_BSS_1.par
##### 6.1.1.4.3 Test Procedure {#test-procedure-4 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | Status of MF | No exception shall | | | | | be thrown. | | | | byte[] fci = new | | | | | byte[34] | Shall return 7. | | | | | | | | | fciOffset = 0 | fci shall contain | | | | | the entire FCI | | | | fciLength = 7 | structure. | | | | | | | | | status() | _\ _ | | +----+--------------------+--------------------+------------------+ | 2 | Status after | 1 - No exception | | | | select EF~ICCID~ | shall be thrown. | | | | in MF | | | | | | Shall return a | | | | 1 - fid = | value between 22 | | | | SI | and 34. | | | | MView.FID_DF_GSM | | | | | | 2 - No exception | | | | fciOffset = 0 | shall be thrown. | | | | | | | | | fciLength = 34 | Shall return 22 or | | | | | more. | | | | len = select() | | | | | | 3 - len and len2 | | | | 2 - byte[] fci2 | shall be identical | | | | = new byte[34] | | | | | | 4 - fci and fci2 | | | | len2 = status() | shall be identical | | | | | | | | | 3 - Compare len | | | | | and len2 | | | | | | | | | | 4 - Compare the | | | | | len bytes of fci | | | | | and fci2 | | | +----+--------------------+--------------------+------------------+ | 3 | Status of | 1 - No exception | | | | DF~Telecom~ | shall be thrown. | | | | | | | | | 1 - fid = | Shall return a | | | | SIMVie | value between 22 | | | | w.FID_DF_TELECOM | and 34. | | | | | | | | | select() | 2 - No exception | | | | | shall be thrown. | | | | 2 - fciOffset = 0 | | | | | | Shall return a | | | | fciLength = 100 | value between 22 | | | | | and34. | | | | status() | | | | | | fci shall contain | | | | | the entire FCI | | | | | structure (check | | | | | that returned | | | | | value is equal to | | | | | 13 plus the | | | | | \"length of | | | | | following data\" - | | | | | fci[12]).FID of | | | | | the returned fci | | | | | (fci[4:5]) is | | | | | FID_DF_TELECOM. | | +----+--------------------+--------------------+------------------+ | 4 | Status DF~TELECOM~ | No exception shall | | | | | be thrown. | | | | fciOffset = 0 | | | | | | Shall return 7. | | | | fciLength = 7 | | | | | | fci shall contain | | | | status() | the first 7 bytes | | | | | of the FCI | | | | | structure starting | | | | | at index 0. | | | | | | | | | | FID of the | | | | | returned fci | | | | | (fci[4:5]) is | | | | | FID_DF_TELECOM. | | +----+--------------------+--------------------+------------------+ | 5 | fci is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | fciOffset = 0 | | | | | | | | | | fciLength = 34 | | | | | | | | | | status() | | | +----+--------------------+--------------------+------------------+ | 6 | fciOffset \ | java. | | | | fci.length | lang.ArrayIndexOut | | | | | OfBoundsException. | | | | fciOffset = 20 | | | | | | | | | | fciLength = 15 | | | | | | | | | | status() | | | +----+--------------------+--------------------+------------------+ | 9 | fciOffset | Shall throw | | | | fci.length | java. | | | | | lang.ArrayIndexOut | | | | fciOffset = 34 | OfBoundsException. | | | | | | | | | fciLength = 1 | | | | | | | | | | status() | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.4.4 Test Coverage {#test-coverage-3 .H6}
CRR Number Test Case Number
* * *
N1 1-4 N2 2, 3 N3 1, 4 P1 5 P2 6 P3 7 P4 8, 9 C1, C2 Not Tested
#### 6.1.1.5 Method readBinary
Test Area Reference: API_1_SVW_REDBS_BSS
##### 6.1.1.5.1 Conformance Requirements {#conformance-requirements-5 .H6}
The method with the following header shall be compliant to its definition in
the API.
public short readBinary(short fileOffset,
byte[] resp,
short respOffset,
short respLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.5.1.1 Normal execution {#normal-execution-4 .H6}
− CRRN1: If data can be accessed at the specified offset, the value respOffset
plus respLength are returned and the data bytes of the currently selected
transparent file are returned in resp.
##### 6.1.1.5.1.2 Parameter errors {#parameter-errors-3 .H6}
− CRRP1: If fileOffset is less than 0, an instance of SIMViewException shall
be thrown. The reason code shall be SIMViewException.OUT_OF_FILE_BOUNDARIES.
− CRRP2: If fileOffset plus respLength exceeds the length of the file, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.OUT_OF_FILE_BOUNDARIES.
− CRRP3: If the array resp is null, an instance of NullPointerException shall
be thrown.
− CRRP4: If respOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP5: If respLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP6: If respOffset plus respLength is greater than the length of the array
resp.length, an instance of ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.5.1.3 Context errors {#context-errors-3 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the currently selected EF is not transparent, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC3: If the calling applet does not fulfil the access condition, READ, to
perform this function, an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC4: If the currently selected EF is invalidated and the file status of
the EF does not allow for the reading of an invalidated file, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC5: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC6: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.5.2 Test Suite Files {#test-suite-files-4 .H6}
Additional requirements for the GSM personalization: none.
Test Script: API_1_SVW_REDBS_BSS_1.scr
Test Applet: API_1_SVW_REDBS_BSS_1.java
Load Script: API_1_SVW_REDBS_BSS_1.ldr
Cleanup Script: API_1_SVW_REDBS_BSS_1.clr
Parameter File: API_1_SVW_REDBS_BSS_1.par
##### 6.1.1.5.3 Test Procedure {#test-procedure-5 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored | | +----+--------------------+--------------------+------------------+ | 1 | Read from EFICCID | 1 - No exception | | | | in MF (Transparent | shall be thrown. | | | | EF) | | | | | | 2 - No exception | | | | 1 - fid = | shall be thrown. | | | | SIMV | | | | | iew.FID_EF_ICCID | Shall return 20. | | | | | | | | | select() | resp shall contain | | | | | the entire | | | | 2 - fileOffset = 0 | contents of | | | | | EFICCID starting | | | | byte[] resp = | at index 10. | | | | new byte[20] | | | | | | \ | | +----+--------------------+--------------------+------------------+ | 2 | Read from EFICCID | No exception shall | | | | in MF | be thrown. | | | | | | | | | resp[0:19] = | Shall return 15. | | | | \'55\' | | | | | | resp shall contain | | | | fileOffset = 5 | the last 5 bytes | | | | | of EFICCID | | | | respOffset = 10 | starting at index | | | | | 10. | | | | respLength = 5 | | | | | | \ | | +----+--------------------+--------------------+------------------+ | 3 | Offset into File | Shall throw | | | | out of bounds | sim.acces | | | | | s.SIMViewException | | | | fileOffset = -1 | with reason code | | | | | OUT_OF\ | | | | respOffset = 0 | _FILE_BOUNDARIES. | | | | | | | | | respLength = 10 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 4 | fileOffset + | Shall throw | | | | respLength > EF | sim.acces | | | | length | s.SIMViewException | | | | | with reason code | | | | fileOffset = 9 | OUT_OF\ | | | | | _FILE_BOUNDARIES. | | | | respOffset = 0 | | | | | | | | | | respLength = 2 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 5 | resp is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | fileOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 10 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 6 | respOffset \ | | | | | resp.length | java.lang. | | | | | ArrayIndexOut | | | | fileOffset = 0 | OfBoundsException. | | | | | | | | | respOffset = 10 | | | | | | | | | | respLength = 11 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 9 | EF is not | 1 - No exception | | | | Transparent | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | FID_DF_SIMTEST | shall be thrown. | | | | | | | | | select() | 3 - Shall throw | | | | | sim.acces | | | | 2 - fid = | s.SIMViewException | | | | FID_EF_LARU | with reason code | | | | | F | | | | select() | ILE_INCONSISTENT. | | | | | | | | | 3 - fileOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 1 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 10 | Access condition | Shall throw | | | | not fulfilled | sim.acces | | | | | s.SIMViewException | | | | 1 - fid = | with reason code | | | | DFSIMTTEST | A | | | | | C_NOT_FULFILLED. | | | | select() | | | | | | | | | | 2 - fid = EFTNR | | | | | | | | | | select() | | | | | | | | | | 3 - fileOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 1 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 11 | EF is invalidated | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFTNU | | | | | | 2 - Shall throw | | | | invalidate() | sim.acces | | | | | s.SIMViewException | | | | 2 - readBinary() | with reason code | | | | | INVALIDATION_STAT | | | | 3 - rehabilitate() | US_CONTRADICTION. | | | | | | | | | | 3 - No exception | | | | | shall be thrown. | | +----+--------------------+--------------------+------------------+ | 12 | No EF selected | 1 - No exception | | | | | shall be thrown. | | | | 1- fid = | | | | | SIMView.FID_MF | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 readBinary() | NO_EF_SELECTED. | | +----+--------------------+--------------------+------------------+
##### 6.1.1.5.4 Test Coverage {#test-coverage-4 .H6}
CRR Number Test Case Number
* * *
N1 1-2 P1 3 P2 4 P3 5 P4 6 P5 7 P6 8, C1 12 C2 9 C3 10 C4 11 C5, C6 Not Tested
#### 6.1.1.6 Method updateBinary
Test Area Reference: API_1_SVW_UPDBS_BSS
##### 6.1.1.6.1 Conformance Requirements {#conformance-requirements-6 .H6}
The method with the following header shall be compliant to its definition in
the API.
public void updateBinary(short fileOffset,
byte[] data,
short dataOffset,
short dataLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.6.1.1 Normal execution {#normal-execution-5 .H6}
− CRRN1: The currently selected transparent file is updated starting at
fileOffset, with the string of dataLength bytes in the array data starting at
dataOffset.
##### 6.1.1.6.1.2 Parameter errors {#parameter-errors-4 .H6}
− CRRP1: If fileOffset is less than 0, an instance of SIMViewException shall
be thrown. The reason code shall be SIMViewException.OUT_OF_FILE_BOUNDARIES.
− CRRP2: If fileOffset plus dataLength exceeds the length of the file, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.OUT_OF_FILE_BOUNDARIES.
− CRRP3: If the array data is null, an instance of NullPointerException shall
be thrown.
− CRRP4: If dataOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP5: If dataLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP6: If dataOffset plus dataLength greater than the length of the array
data.length an instance of ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.6.1.3 Context errors {#context-errors-4 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the currently selected EF is not transparent, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC3: If the calling applet does not fulfil the access condition, UPDATE,
to perform this function, an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC4: If the currently selected EF is invalidated and the file status of
the EF does not allow for updating of an invalidated file, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC5: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC6: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.6.2 Test Suite Files {#test-suite-files-5 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_UPDBS_BSS_1.scr
Test Applet: API_1_SVW_UPDBS_BSS_1.java
Load Script: API_1_SVW_UPDBS_BSS_1.ldr
Cleanup Script: API_1_SVW_UPDBS_BSS_1.clr
Parameter File: API_1_SVW_UPDBS_BSS_1.par
##### 6.1.1.6.3 Test Procedure {#test-procedure-6 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF selected | Shall throw | | | | | sim.acces | | | | fileOffset = 0 | s.SIMViewException | | | | | with reason code | | | | byte[] data = | NO_EF_SELECTED. | | | | new byte[20] | | | | | | | | | | data[0] = \'55\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 10 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 2 | Update Transparent | 1 - No exception | | | | EF | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | DFSIMTEST | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid = EFTARU | | | | | | 4 - No exception | | | | select() | shall be thrown. | | | | | | | | | 3 - fileOffset = 3 | Data in resp[0] | | | | | shall be \'55\'. | | | | data[0] = \'55\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 1 | | | | | | | | | | updateBinary() | | | | | | | | | | 4 - fileOffset = 3 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 1 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 3 | 1 - fileOffset = | 1 - No exception | | | | 254 | shall be thrown. | | | | | | | | | data[0] = \'55\' | 2 - No exception | | | | | shall be thrown. | | | | data[1] = \'AA\' | | | | | | Data in resp shall | | | | data[2] = \'66\' | be | | | | | | | | | dataOffset = 0 | resp[0] = \'55\' | | | | | | | | | dataLength = 3 | resp[1] = \'AA\' | | | | | | | | | updateBinary() | resp[2] = \'66\' | | | | | | | | | 2 - fileOffset = | | | | | 254 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | readBinary() | | | +----+--------------------+--------------------+------------------+ | 4 | Offset into File | Shall throw | | | | out of bounds | sim.acces | | | | | s.SIMViewException | | | | fileOffset = -1 | with reason code | | | | | OUT_OF\ | | | | dataOffset = 0 | _FILE_BOUNDARIES. | | | | | | | | | dataLength = 10 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 5 | fileOffset + | Shall throw | | | | dataLength > EF | sim.acces | | | | length | s.SIMViewException | | | | | with reason code | | | | fileOffset = 259 | OUT_OF\ | | | | | _FILE_BOUNDARIES. | | | | dataOffset = 0 | | | | | | | | | | dataLength = 2 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 6 | data is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | fileOffset = 0 | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 10 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 7 | dataOffset \ | | | | | data.length | java.lang. | | | | | ArrayIndexOut | | | | fileOffset = 0 | OfBoundsException. | | | | | | | | | dataOffset = 10 | | | | | | | | | | dataLength = 11 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 10 | EF is not | 1 - No exception | | | | Transparent | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | FID_DF_SIMTEST | shall be thrown. | | | | | | | | | select() | 3 - Shall throw | | | | | sim.acces | | | | 2 - fid = | s.SIMViewException | | | | FID_EF_LARU | with reason code | | | | | F | | | | select() | ILE_INCONSISTENT. | | | | | | | | | 3 - fileOffset = 0 | | | | | | | | | | data[0] = \'55\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 1 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 11 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = | 2 - Shall throw | | | | DFSIMTEST | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | A | | | | fid = EFTNU | C_NOT_FULFILLED. | | | | | | | | | select() | | | | | | | | | | 2 - fileOffset = 0 | | | | | | | | | | data[0] = \'55\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 1 | | | | | | | | | | updateBinary() | | | +----+--------------------+--------------------+------------------+ | 12 | EF is invalidated | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFTNR | | | | | | 2 - Shall throw | | | | invalidate() | sim.acces | | | | | s.SIMViewException | | | | 2 - fileOffset = 0 | with reason code | | | | | INVALIDATION_STAT | | | | data[0] = \'55\' | US_CONTRADICTION. | | | | | | | | | dataOffset = 0 | 3 - No exception | | | | | shall be thrown. | | | | dataLength = 1 | | | | | | | | | | updateBinary() | | | | | | | | | | 3 - rehabilitate() | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.6.4 Test Coverage {#test-coverage-5 .H6}
CRR Number Test Case Number
* * *
N1 2, 3 P1 4 P2 5 P3 6 P4 7 P5 8 P6 9 C1 1 C2 10 C3 11 C4 12 C5, C6 Not Tested
#### 6.1.1.7 Method readRecord
Test Area Reference: API_1_SVW_REDRSBS_BSS
##### 6.1.1.7.1 Conformance Requirements {#conformance-requirements-7 .H6}
The method with the following header shall be compliant to its definition in
the API.
public short readRecord(short recNumber,
byte mode,
short recOffset,
byte[] resp,
short respOffset,
short respLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.7.1.1 Normal execution {#normal-execution-6 .H6}
− CRRN1: The data bytes from the record, specified by mode and recNumber of
the currently selected linear fixed or cyclic EF, is read at recOffset. A
total of respLength bytes of this data is copied to the array resp at
respOffset.
− CRRN2: If the access mode is REC_ACC_MODE_ABSOLUTE_CURRENT:
\- if recNumber is not 0, the record addressed by recNumber will be read;
\- if recNumber is 0 the current selected record will be read; and
\- the current record pointer shall not change.
− CRRN3: If the access mode is REC_ACC_MODE_NEXT:
\- the next record relative to the current selected record will be selected
and read;
\- if no current record is selected, the first record will be selected and
read;
\- if the current record pointer is set to the last record for a cyclic EF the
record pointer is set to the first record and the record is read;
\- the current record pointer of any other applet shall not be changed.
− CRRN4: If the access mode is REC_ACC_MODE_PREVIOUS:
\- the previous record relative to the current selected record will be
selected and read;
\- if no current record is selected, the last record will be selected and
read;
\- if the current record pointer is set to the first record, for a linear
fixed EF the method responses with an error exception and for a cyclic EF the
record pointer is set to the last record and the record is read;
\- the current record pointer of any other applet shall not be changed.
##### 6.1.1.7.1.2 Parameter errors {#parameter-errors-5 .H6}
− CRRP1: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_ABSOLUTE_CURRENT and recNumber is less than 0 or greater than
records available, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP2: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_ABSOLUTE_CURRENT, recNumber is 0 and there is no current record
selected, an instance of SIMViewException shall be thrown. The reason code
shall be SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP3: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_NEXT and the current record pointer is set to the last record, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP4: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_PREVIOUS and the current record pointer is set to the first
record, an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP5: If the specified offset into the selected record recOffset is less
than 0, an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.OUT_OF_RECORD_BOUNDARIES.
− CRRP6: If recOffset plus respLength is greater than the record length, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.OUT_OF_RECORD_BOUNDARIES.
− CRRP7: If the access mode is not between 2 and 4 inclusive (2 =
REC_ACC_MODE_NEXT, etc.), an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.INVALID_MODE.
− CRRP8: If the array resp is null, an instance of NullPointerException shall
be thrown.
− CRRP9: If respOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP10: If respLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP11: If respOffset plus respLength is greater than the length of the
array resp.length, or respOffset equals resp.length, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.7.1.3 Context errors {#context-errors-5 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the currently selected EF is neither linear fixed nor cyclic, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC3: If the calling applet does not fulfil the access condition, READ, to
perform this function, an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC4: If the currently selected EF is invalidated and the file status of
the EF does not allow for reading an invalidated file, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC5: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC6: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.7.2 Test Suite Files {#test-suite-files-6 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_REDRSBS_BSS_1.scr
Test Applet: API_1_SVW_REDRSBS_BSS_1.java
Load Script: API_1_SVW_REDRSBS_BSS_1.ldr
Cleanup Script: API_1_SVW_REDRSBS_BSS_1.clr
Parameter File: API_1_SVW_REDRSBS_BSS_1.par
##### 6.1.1.7.3 Test Procedure {#test-procedure-7 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF selected | Shall throw | | | | | sim.acces | | | | recNumber = 1 | s.SIMViewException | | | | | with reason code | | | | mode = | NO_EF_SELECTED. | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | byte[] resp = | | | | | new byte[20] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 10 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 2 | Read Absolute and | 1 - No exception | | | | Current from | shall be thrown. | | | | Linear Fixed EF | | | | | | 2 - No exception | | | | 1 - fid = | shall be thrown. | | | | DFSIMTEST | | | | | | 3 - No exception | | | | select() | shall be thrown. | | | | | | | | | 2 - fid = EFLARU | resp shall be: | | | | | | | | | select() | resp[0] = \'55\' | | | | | | | | | // Record pointer | resp[1] = \'55\' | | | | not set. | | | | | | resp[2] = \'55\' | | | | 3 - recNumber = 0 | | | | | | resp[3] = \'55\' | | | | mode = | | | | | RE | 4 - No exception | | | | C_ACC_MODE_NEXT | shall be thrown. | | | | | | | | | recOffset = 0 | resp shall be: | | | | | | | | | respOffset = 0 | resp[0] = \'AA\' | | | | | | | | | respLength = 4 | resp[1] = \'AA\' | | | | | | | | | readRecord() | resp[2] = \'AA\' | | | | | | | | | 4 - recNumber = 2 | resp[3] = \'AA\' | | | | | | | | | mode = | 5 - No exception | | | | REC_ACC_MODE\ | shall be thrown. | | | | _ABSOLUTE_CURRENT | | | | | | resp shall be: | | | | readRecord() | | | | | | resp[0] = \'55\' | | | | 5 - recNumber = 1 | | | | | | resp[1] = \'55\' | | | | readRecord() | | | | | | resp[2] = \'55\' | | | | 6 - recNumber = 0 | | | | | | resp[3] = \'55\' | | | | resp[0] = | | | | | resp[1] = | 6 - No exception | | | | resp[2] = | shall be thrown. | | | | resp[3] = \'00\' | | | | | | resp shall be: | | | | readRecord() | | | | | | resp[0] = \'55\' | | | | | | | | | | resp[1] = \'55\' | | | | | | | | | | resp[2] = \'55\' | | | | | | | | | | resp[3] = \'55\' | | +----+--------------------+--------------------+------------------+ | 3 | Read Next from | No exception shall | | | | Linear Fixed EF | be thrown. | | | | | | | | | recNumber = 0 | resp shall be: | | | | | | | | | mode = | resp[0] = \'AA\' | | | | RE | | | | | C_ACC_MODE_NEXT | resp[1] = \'AA\' | | | | | | | | | recOffset = 0 | resp[2] = \'AA\' | | | | | | | | | respOffset = 0 | resp[3] = \'AA\' | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 4 | Read Next from | Shall throw | | | | Linear Fixed EF | sim.acces | | | | | s.SIMViewException | | | | recNumber = 0 | with reason code | | | | | RECORD_NUMBE | | | | mode = | R_NOT_AVAILABLE. | | | | RE | | | | | C_ACC_MODE_NEXT | | | | | | | | | | recOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 5 | Read Previous from | No exception shall | | | | Linear Fixed EF | be thrown. | | | | | | | | | recNumber = 0 | resp shall be: | | | | | | | | | mode = | resp[0] = \'55\' | | | | REC_A | | | | | CC_MODE_PREVIOUS | resp[1] = \'55\' | | | | | | | | | recOffset = 0 | resp[2] = \'55\' | | | | | | | | | respOffset = 0 | resp[3] = \'55\' | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 6 | Read Previous from | Shall throw | | | | Linear Fixed EF | sim.acces | | | | | s.SIMViewException | | | | recNumber = 0 | with reason code | | | | | RECORD_NUMBE | | | | mode = | R_NOT_AVAILABLE. | | | | REC_A | | | | | CC_MODE_PREVIOUS | | | | | | | | | | recOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 7 | Read Absolute and | 1 - No exception | | | | Current from | shall be thrown. | | | | Cyclic EF | | | | | | 2 - No exception | | | | 1 - fid = EFCARU | shall be thrown. | | | | | | | | | select() | resp shall be: | | | | | | | | | 2 - recNumber = 2 | resp[0] = \' | | | | | AA\' | | | | mode = | | | | | REC_ACC_MODE\ | resp[1] = \' | | | | _ABSOLUTE_CURRENT | AA\' | | | | | | | | | recOffset = 0 | resp[2] = \' | | | | | AA\' | | | | respOffset = 0 | | | | | | 3 - No exception | | | | respLength = 3 | shall be thrown. | | | | | | | | | readRecord() | resp shall be: | | | | | | | | | 3 - recNumber = 1 | resp[0] = \'55\' | | | | | | | | | readRecord() | resp[1] = \'55\' | | | | | | | | | 4 - recNumber = 0 | resp[2] = \'55\' | | | | | | | | | resp[0] = | 4 - No exception | | | | resp[1] = | shall be thrown. | | | | resp[2] = \'00 | | | | | | resp shall be: | | | | readRecord() | | | | | | resp[0] = \'55\' | | | | | | | | | | resp[1] = \'55\' | | | | | | | | | | resp[2] = \'55\' | | +----+--------------------+--------------------+------------------+ | 8 | Read Next from | No exception shall | | | | Cyclic EF | be thrown. | | | | | | | | | recNumber = 0 | resp shall be: | | | | | | | | | mode = | resp[0] = \'AA\' | | | | RE | | | | | C_ACC_MODE_NEXT | resp[1] = \'AA\' | | | | | | | | | recOffset = 0 | resp[2] = \'AA\' | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 9 | Read Next from | No exception shall | | | | Cyclic EF | be thrown. | | | | | | | | | recNumber = 0 | resp shall be: | | | | | | | | | mode = | resp[0] = \'55\' | | | | RE | | | | | C_ACC_MODE_NEXT | resp[1] = \'55\' | | | | | | | | | recOffset = 0 | resp[2] = \'55\' | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 10 | Read Previous from | No exception shall | | | | Cyclic EF | be thrown. | | | | | | | | | recNumber = 0 | resp shall be: | | | | | | | | | mode = | resp[0] = \'AA\' | | | | REC_A | | | | | CC_MODE_PREVIOUS | resp[1] = \'AA\' | | | | | | | | | recOffset = 0 | resp[2] = \'AA\' | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 11 | Read Previous from | No exception shall | | | | Cyclic EF | be thrown. | | | | | | | | | recNumber = 0 | resp shall be: | | | | | | | | | mode = | resp[0] = \'55\' | | | | REC_A | | | | | CC_MODE_PREVIOUS | resp[1] = \'55\' | | | | | | | | | recOffset = 0 | resp[2] = \'55\' | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 12 | **Read Absolute | 1 - No exception | | | | from Linear Fixed | shall be thrown. | | | | EF beyond** | | | | | Records | 2 - Shall throw | | | | | sim.acces | | | | 1 - fid = EFLARU | s.SIMViewException | | | | | with reason code | | | | select() | RECORD_NUMBE | | | | | R_NOT_AVAILABLE. | | | | 2 - recNumber = -1 | | | | | | 3 - Shall throw | | | | mode = | sim.acces | | | | REC_ACC_MODE\ | s.SIMViewException | | | | _ABSOLUTE_CURRENT | with reason code | | | | | RECORD_NUMBE | | | | recOffset = 0 | R_NOT_AVAILABLE. | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | | | | | | | | 3 - recNumber = 3 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 13 | **No current | 1 - No exception | | | | record in linear | shall be thrown. | | | | fixed EF, read** | | | | | current | 2 - Shall throw | | | | | sim.acces | | | | 1 - fid = EFLARU | s.SIMViewException | | | | | with reason code | | | | select() // No | RECORD_NUMBE | | | | curr rec | R_NOT_AVAILABLE. | | | | | | | | | 2 - recNumber = 0 | | | | | // curr rec | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 14 | recOffset \ | shall be thrown. | | | | Record Length | | | | | | 2 - Shall throw | | | | 1 - fid = EFLARU | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | OUT_OF_R | | | | 2 - recNumber = 1 | ECORD_BOUNDARIES. | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 2 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 16 | Reading with | 1 - No exception | | | | invalid mode | shall be thrown. | | | | | | | | | 1 - fid = EFLARU | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - recNumber = 0 | INVALID_MODE. | | | | | | | | | mode = 1 | 3 - Shall throw | | | | | sim.acces | | | | recOffset = 0 | s.SIMViewException | | | | | with reason code | | | | respOffset = 0 | INVALID_MODE. | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | | | | | | | | 3 - mode = 5 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 17 | resp is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 10 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 18 | respOffset \ | | | | | resp.length | java.lang. | | | | | ArrayIndexOut | | | | respOffset = 10 | OfBoundsException. | | | | | | | | | respLength = 11 | | | | | | | | | | readRecord () | | | +----+--------------------+--------------------+------------------+ | 21 | EF is neither | 1 - No exception | | | | Cyclic nor Linear | shall be thrown. | | | | Fixed | | | | | | 2 - No exception | | | | 1 - fid = | shall be thrown. | | | | DFSIMTEST | | | | | | 3 - Shall throw | | | | select() | sim.acces | | | | | s.SIMViewException | | | | 2 - fid = EFTNU | with reason code | | | | | F | | | | select() | ILE_INCONSISTENT. | | | | | | | | | 3 - respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 22 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = EFCNR | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - respLength = 3 | A | | | | | C_NOT_FULFILLED. | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 23 | EF is invalidated | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFCNU | | | | | | 2 - Shall throw | | | | invalidate() | sim.acces | | | | | s.SIMViewException | | | | 2 - readRecord() | with reason code | | | | | INVALIDATION_STAT | | | | 3 - rehabilitate() | US_CONTRADICTION. | | | | | | | | | | 3 - No exception | | | | | shall be thrown. | | +----+--------------------+--------------------+------------------+
##### 6.1.1.7.4 Test Coverage {#test-coverage-6 .H6}
CRR Number Test Case Number
* * *
N1 2-5, 7-11 N2 2, 7 N3 3, 8, 9 N4 5, 10, 11 P1 12 P2 13 P3 4 P4 6 P5 14 P6 15
P7 16 P8 17 P9 18 P10 19 P11 20 C1 1 C2 21 C3 22 C4 23 C5, C6 Not Tested
#### 6.1.1.8 Method updateRecord
Test Area Reference: API_1_SVW_UPDRSBS_BSS
##### 6.1.1.8.1 Conformance Requirements {#conformance-requirements-8 .H6}
The method with the following header shall be compliant to its definition in
the API.
public void updateRecord(short recNumber,
byte mode,
short recOffset,
byte[] data,
short dataOffset,
short dataLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.8.1.1 Normal execution {#normal-execution-7 .H6}
− CRRN1: dataLength bytes of the record specified by mode and recNumber of the
current selected linear fixed or cyclic EF are updated at recOffset, by using
the string of bytes in the array data starting at dataOffset.
− CRRN2: If the access mode is REC_ACC_MODE_ABSOLUTE_CURRENT and the file is a
linear fixed EF:
\- the record addressed by recNumber will be updated;
\- if recNumber is 0 the current selected record will be updated; and
\- the current record pointer shall not change.
− CRRN3: If the access mode is REC_ACC_MODE_NEXT and the file is a linear
fixed EF:
\- the next record relative to the current selected record will be selected
and updated;
\- if no current record is selected, the first record will be selected and
updated;
\- the current record pointer of any other applet shall not be changed.
− CRRN4: If the access mode is REC_ACC_MODE_PREVIOUS:
\- the previous record relative to the current selected record will be
selected and updated;
\- if no current record is selected, the last record will be selected and
updated;
\- if a cyclic EF is updated, the oldest record will be updated independent of
the current record pointer and this record becomes record number 1 and the
current record;
\- the current record pointer of any other applet shall not be changed in case
of a linear fixed EF.
##### 6.1.1.8.1.2 Parameter errors {#parameter-errors-6 .H6}
− CRRP1: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_ABSOLUTE_CURRENT and recNumber is less than 0 or greater than
records available, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP2: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_ABSOLUTE_CURRENT, recNumber is 0 and there is no current record
selected, an instance of SIMViewException shall be thrown. The reason code
shall be SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP3: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_NEXT and the current record pointer is set to the last record, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP4: If the currently selected EF is linear fixed and the access mode is
REC_ACC_MODE_PREVIOUS and the current record pointer is set to the first
record; an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.RECORD_NUMBER_NOT_AVAILABLE.
− CRRP5: If the specified offset into the selected record recOffset is less
than 0, an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.OUT_OF_RECORD_BOUNDARIES.
− CRRP6: If recOffset plus dataLength is greater than the record length, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.OUT_OF_RECORD_BOUNDARIES.
− CRRP7: If the access mode is not between 2 and 4 inclusive (2 =
REC_ACC_MODE_NEXT, etc.), an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.INVALID_MODE.
− CRRP8: If the currently selected EF is cyclic and the mode of record access
mode is not REC_ACC_MODE_PREVIOUS, an instance of SIMViewException shall be
thrown. The reason code shall be SIMViewException.INVALID_MODE.
− CRRP9: If the array data is null, an instance of NullPointerException shall
be thrown.
− CRRP10: If dataOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP11: If dataLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP12: If dataOffset plus dataLength, is greater than the length of the
array data.length, or dataOffset equals data.length, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.8.1.3 Context errors {#context-errors-6 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the currently selected EF is neither linear fixed nor cyclic, an
instance of SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC3: If the calling applet does not fulfil the access condition, UPDATE,
to perform this function, an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC4: If the currently selected EF is invalidated and the file status of
the EF does not allow for updating an invalidated file, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC5: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC6: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.8.2 Test Suite Files {#test-suite-files-7 .H6}
Additional requirements for the GSM personalization: This test is based on the
assumption that the contents of the EFs in DF~SIMTEST~ are identical to those
defined in the default pre-personalization and the current record pointers
have not been altered.
Test Script: API_1_SVW_UPDRSBS_BSS_1.scr
Test Applet: API_1_SVW_UPDRSBS_BSS_1.java
Load Script: API_1_SVW_UPDRSBS_BSS_1.ldr
Cleanup Script: API_1_SVW_UPDRSBS_BSS_1.clr
Parameter File: API_1_SVW_UPDRSBS_BSS_1.par
##### 6.1.1.8.3 Test Procedure {#test-procedure-8 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF selected | Shall throw | | | | | sim.acces | | | | recNumber = 1 | s.SIMViewException | | | | | with reason code | | | | mode = | NO_EF_SELECTED. | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | byte[] data = | | | | | new byte[20] | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 10 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 2 | Update Absolute | 1 - No exception | = 4 | | | and Current from | shall be thrown. | | | | Linear Fixed EF | | | | | | 2 - No exception | | | | 1 - fid = | shall be thrown. | | | | DFSIMTEST | | | | | | 3 - No exception | | | | select() | shall be thrown. | | | | | | | | | 2 - fid = EFLARU | Resp shall be: | | | | | | | | | select() | Resp[0] = \'11\' | | | | | | | | | // Record pointer | Resp[1] = \'11\' | | | | not set. | | | | | | Resp[2] = \'11\' | | | | 3 - recNumber = 2 | | | | | | Resp[3] = \'11\' | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | data[0:3] = | | | | | \'11\' | | | | | | | | | | recOffset = 0 | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 0 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 3 | Update Current | 1 - No exception | | | | from Linear Fixed | shall be thrown. | | | | EF | | | | | | 2 - No exception | | | | 1 - fid = | shall be thrown. | | | | DFSIMTEST | | | | | | 3 - No exception | | | | select() | shall be thrown. | | | | | | | | | 2 - fid = EFLARU | 4 - No exception | | | | | shall be thrown. | | | | select() | | | | | | resp shall be: | | | | // Set record | | | | | pointer with mode | resp[0] = \'22\' | | | | \"next\". | | | | | | resp[1] = \'22\' | | | | 3 - recNumber = 0 | | | | | | resp[2] = \'22\' | | | | mode = | | | | | RE | resp[3] = \'22\' | | | | C_ACC_MODE_NEXT | | | | | | | | | | recOffset = 0 | | | | | | | | | | data[0:3] = | | | | | \'00\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | // write data with | | | | | mode \"current\" | | | | | | | | | | 4 - recNumber = 0 | | | | | | | | | | data[0:3] = | | | | | \'22\' | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | updateRecord() | | | | | | | | | | // read result | | | | | with mode | | | | | \"absolute\" | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 4 | | | | | | | | | | recNumber = 1 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 4 | Update Next from | 1 - No exception | | | | Linear Fixed EF, | shall be thrown. | | | | no record pointer | | | | | set | 2- No exception | | | | | shall be thrown. | | | | 1 - fid = | | | | | FID_DF_SIMTEST | 3 - No exception | | | | | shall be thrown. | | | | select() | | | | | | Resp shall be: | | | | 2 - fid = | | | | | FID_EF_LARU | Resp[0] = \'33\' | | | | | | | | | select | Resp[1] = \'33\' | | | | | | | | | 3 - recNumber = 0 | Resp[2] = \'33\' | | | | | | | | | mode = | Resp[3] = \'33\' | | | | RE | | | | | C_ACC_MODE_NEXT | | | | | | | | | | recOffset = 0 | | | | | | | | | | data[0:3] = | | | | | \'33\' | | | | | | | | | | dataOffset = | | | | | respOffset = 0 | | | | | | | | | | dataLength = | | | | | respLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 5 | Update Next from | 1 - No exception | | | | Linear Fixed EF, | shall be thrown. | | | | record pointer set | | | | | | 2 - No exception | | | | 1 - recNumber = 0 | shall be thrown. | | | | | | | | | mode = | resp shall be: | | | | RE | | | | | C_ACC_MODE_NEXT | resp[0] = \'44\' | | | | | | | | | recOffset = 0 | resp[1] = \'44\' | | | | | | | | | data[0:3] = | resp[2] = \'44\' | | | | \'44\' | | | | | | resp[3] = \'44\' | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | 2 - mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 6 | Update Next from | Shall throw | | | | Linear Fixed EF, | sim.acces | | | | no more records | s.SIMViewException | | | | | with reason code | | | | recNumber = 0 | RECORD_NUMBE | | | | | R_NOT_AVAILABLE. | | | | mode = | | | | | RE | | | | | C_ACC_MODE_NEXT | | | | | | | | | | recOffset = 0 | | | | | | | | | | data[0:3] = | | | | | \'55\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 7 | Update Previous | 1 - No exception | | | | from Linear Fixed | shall be thrown. | | | | EF, no record | | | | | pointer set | 2 - No exception | | | | | shall be thrown. | | | | 1 - fid = | | | | | DFSIMTEST | 3 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 4 - No exception | | | | 2 - fid = EFLARU | shall be thrown. | | | | | | | | | select() | resp shall be: | | | | | | | | | 3 - recNumber = 0 | resp[0] = \'66\' | | | | | | | | | mode = | resp[1] = \'66\' | | | | REC_A | | | | | CC_MODE_PREVIOUS | resp[2] = \'66\' | | | | | | | | | recOffset = 0 | resp[3] = \'66\' | | | | | | | | | data[0:3] = | | | | | \'66\' | | | | | | | | | | dataOffset = | | | | | respOffset = 0 | | | | | | | | | | dataLength = | | | | | respLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | 4 - mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 8 | Update Previous | 1 - No exception | | | | from Linear Fixed | shall be thrown | | | | EF, record pointer | | | | | set | 2 - No exception | | | | | shall be thrown. | | | | 1 - recNumber = 0 | | | | | | Resp shall be: | | | | mode = | | | | | REC_A | Resp[0] = | | | | CC_MODE_PREVIOUS | \'7744\' | | | | | | | | | recOffset = 0 | Resp[1] = | | | | | \'7744\' | | | | data[0:3] = | | | | | \'77\' | Resp[2] = | | | | | \'7744\' | | | | dataOffset = | | | | | respOffset = 0 | Resp[3] = | | | | | \'7744\' | | | | dataLength = | | | | | respLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | readRecord() | | | | | | | | | | 2 - mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | +----+--------------------+--------------------+------------------+ | 9 | Update Previous | Shall throw | | | | from Linear Fixed | sim.acces | | | | EF , no more | s.SIMViewException | | | | records | with reason code | | | | | RECORD_NUMBE | | | | recNumber = 0 | R_NOT_AVAILABLE. | | | | | | | | | mode = | | | | | REC_A | | | | | CC_MODE_PREVIOUS | | | | | | | | | | recOffset = 0 | | | | | | | | | | data[0:3] = | | | | | \'88\' | | | | | | | | | | dataOffset = | | | | | respOffset = 0 | | | | | | | | | | dataLength = | | | | | respLength = 4 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 10 | Update Previous | 1 - No exception | | | | from Cyclic EF | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | FID_DF_SIMTEST | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid = | | | | | FID_EF_CARU | 4 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 5 - No exception | | | | 3 - recNumber = 2 | shall be thrown. | | | | | | | | | mode = | resp shall be: | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | resp[0] = | | | | | data[0] | | | | recOffset = 0 | | | | | | resp[1] = | | | | respOffset = 0 | data[1] | | | | | | | | | respLength = 3 | resp[2] = | | | | | data[2] | | | | readRecord() | | | | | | | | | | 4 - recNumber = 2 | | | | | | | | | | mode = | | | | | REC_A | | | | | CC_MODE_PREVIOUS | | | | | | | | | | data[0:2] = | | | | | resp[0:2] \^ | | | | | \'FF\' | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 3 | | | | | | | | | | updateRecord() | | | | | | | | | | 5 - recNumber = 0 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 11 | Update Absolute | 1 - No exception | | | | from Linear Fixed | shall be thrown. | | | | EF beyond Records | | | | | | 2 - Shall throw | | | | 1 - fid = EFLARU | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | RECORD_NUMBE | | | | 2 -recNumber = -1 | R_NOT_AVAILABLE. | | | | | | | | | mode = | 3 - Shall throw | | | | REC_ACC_MODE\ | sim.acces | | | | _ABSOLUTE_CURRENT | s.SIMViewException | | | | | with reason code | | | | recOffset = 0 | RECORD_NUMBE | | | | | R_NOT_AVAILABLE. | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | 2 - recNumber = 3 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 12 | No current record | 1 - No exception | | | | in linear fixed | shall be thrown. | | | | EF, update current | | | | | | 2 - Shall throw | | | | 1 - fid = EFLARU | sim.acces | | | | | s.SIMViewException | | | | select() // No | with reason code | | | | curr rec | RECORD_NUMBE | | | | | R_NOT_AVAILABLE. | | | | 2 - recNumber = 0 | | | | | // curr rec | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 13 | recOffset \ | shall be thrown. | | | | Record Length | | | | | | 2 - Shall throw | | | | 1 - fid = EFLARU | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | OUT_OF_R | | | | 2 - recNumber = 1 | ECORD_BOUNDARIES. | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 2 | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 15 | Updating with | 1 - No exception | | | | invalid mode | shall be thrown. | | | | | | | | | 1 - fid = EFLARU | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - recNumber = 0 | INVALID_MODE. | | | | | | | | | mode = 1 | 3 - Shall throw | | | | | sim.acces | | | | recOffset = 0 | s.SIMViewException | | | | | with reason code | | | | dataOffset = 0 | INVALID_MODE. | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | | | | | | | | 3 - mode = 5 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 16 | Updating Cyclic EF | 1 - No exception | | | | with invalid mode | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | DFSIMTEST | shall be thrown. | | | | | | | | | select() | 3 - Shall throw | | | | | sim.acces | | | | 2 - fid = EFCARU | s.SIMViewException | | | | | with reason code | | | | select() | INVALID_MODE. | | | | | | | | | 3 - recNumber = 0 | 4 - Shall throw | | | | | sim.acces | | | | mode = | s.SIMViewException | | | | RE | with reason code | | | | C_ACC_MODE_NEXT | INVALID_MODE. | | | | | | | | | recOffset = 0 | 5 - Shall throw | | | | | sim.acces | | | | data[0:2] = | s.SIMViewException | | | | \'00\' | with reason code | | | | | INVALID_MODE. | | | | dataOffset = 0 | | | | | | | | | | dataLength = 3 | | | | | | | | | | updateRecord() | | | | | | | | | | 4 - recNumber = 0 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | updateRecord() | | | | | | | | | | 5 - recNumber = 2 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 17 | data is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 10 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 18 | dataOffset \ | | | | | data.length | java.lang. | | | | | ArrayIndexOut | | | | dataOffset = 10 | OfBoundsException. | | | | | | | | | dataLength = 11 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 21 | EF is neither | 1 - No exception | | | | Cyclic nor Linear | shall be thrown. | | | | Fixed | | | | | | 2 - No exception | | | | 1 - fid = | shall be thrown. | | | | DFSIMTEST | | | | | | 3 - Shall throw | | | | select() | sim.acces | | | | | s.SIMViewException | | | | 2 - fid = EFTNR | with reason code | | | | | F | | | | select() | ILE_INCONSISTENT. | | | | | | | | | 3 - dataOffset = 0 | | | | | | | | | | dataLength = 4 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 22 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = EFCNU | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - recOffset = 0 | A | | | | | C_NOT_FULFILLED. | | | | dataOffset = 0 | | | | | | 3 - No exception | | | | dataLength = 1 | shall be thrown. | | | | | | | | | mode = | 4 - Shall throw | | | | REC_A | sim.acces | | | | CC_MODE_PREVIOUS | s.SIMViewException | | | | | with reason code | | | | updateRecord() | A | | | | | C_NOT_FULFILLED. | | | | 3 - fid = EFLNU | | | | | | | | | | select() | | | | | | | | | | 4 - recNumber = 1 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 1 | | | | | | | | | | updateRecord() | | | +----+--------------------+--------------------+------------------+ | 23 | EF is invalidated | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFCNR | | | | | | 2 - Shall throw | | | | mode = | sim.acces | | | | REC_A | s.SIMViewException | | | | CC_MODE_PREVIOUS | with reason code | | | | | INVALIDATION_STAT | | | | invalidate() | US_CONTRADICTION. | | | | | | | | | 2 - updateRecord() | 3 - No exception | | | | | shall be thrown. | | | | 3 - rehabilitate() | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.8.4 Test Coverage {#test-coverage-7 .H6}
CRR Number Test Case Number
* * *
N1 2, 3,4, 5, 7, 8, 10 N2 2, 3 N3 5, 6 N4 7, 8, 9, 10 P1 11 P2 12 P3 6 P4 9 P5
13 P6 14 P7 15 P8 16 P9 17 P10 18 P11 19 P12 20 C1 1 C2 21 C3 22 C4 23 C5, C6
Not Tested
#### 6.1.1.9 Method seek
Test Area Reference: API_1_SVW_SEEKB_BSS
##### 6.1.1.9.1 Conformance Requirements {#conformance-requirements-9 .H6}
The method with the following header shall be compliant to its definition in
the API.
public short seek(byte mode,
byte[] patt,
short pattOffset,
short pattLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.9.1.1 Normal execution {#normal-execution-8 .H6}
− CRRN1: If the pattern in patt with the length pattLength at offset
pattOffset is found in the record being specified by mode, the current record
pointer is set to that record and the record number is returned. The record
pointer of any other applet is not changed. This will be tested during the
testing of the framework.
− CRRN2: If mode is SEEK_FROM_BEGINNING_FORWARD, the search starts with the
first record forward towards the end of the file.
− CRRN3: If mode is SEEK_FROM_END_BACKWARD, the search starts with the last
record backward towards the beginning of the file.
− CRRN4: If mode is SEEK_FROM_NEXT_FORWARD, the search starts from the next
record after the current record pointer forward towards the end of file. If no
current record pointer is selected, the search starts with the first record.
− CRRN5: If mode is SEEK_FROM_PREVIOUS_BACKWARD, the search starts from the
previous record before the current record pointer backward towards the
beginning of the file. If no current record pointer is selected the search
starts with the last record.
− CRRN6: If pattern in patt is not found, an instance of SIMViewException
shall be thrown. The reason code shall be SIMViewException.PATTERN_NOT_FOUND.
− CRRN7: If mode is SEEK_FROM_NEXT_FORWARD and the record pointer is at the
last record, an instance of SIMViewException shall be thrown. The reason code
shall be SIMViewException.PATTERN_NOT_FOUND.
− CRRN8: If mode is SEEK_FROM_PREVIOUS_BACKWARD and the record pointer is at
the first record, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.PATTERN_NOT_FOUND.
##### 6.1.1.9.1.2 Parameter errors {#parameter-errors-7 .H6}
− CRRP1: If mode is not between 0 and 3 inclusive (0 =
SEEK_FROM_BEGINNING_FORWARD, etc.), an instance of SIMViewException shall be
thrown. The reason code shall be SIMViewException.INVALID_MODE.
− CRRP2: If the pattern array patt is null, an instance of
NullPointerException shall be thrown.
− CRRP3: If pattOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP4: If pattLength is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP5: If pattLength is greater than the size of the record of the currently
selected EF, an instance of SIMViewException shall be thrown. The reason code
shall be SIMViewException.OUT_OF_RECORD_BOUNDARIES.
− CRRP6: If pattOffset plus pattLength is greater than the length of the
pattern array patt.length, an instance of ArrayIndexOutOfBoundsException shall
be thrown.
##### 6.1.1.9.1.3 Context errors {#context-errors-7 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the currently selected EF is not linear fixed, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC3: If the calling applet does not fulfil the access condition, READ, to
perform this function, an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC4: If the currently selected EF is invalidated and the file status of
the EF does not allow for reading an invalidated file, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC5: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC6: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.9.2 Test Suite Files {#test-suite-files-8 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_SEEKB_BSS_1.scr
Test Applet: API_1_SVW_SEEKB_BSS_1.java
Load Script: API_1_SVW_SEEKB_BSS_1.ldr
Cleanup Script: API_1_SVW_SEEKB_BSS_1.ldr
Parameter File: API_1_SVW_SEEKB_BSS_1.par
##### 6.1.1.9.3 Test Procedure {#test-procedure-9 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF selected | Shall throw | | | | | sim.acces | | | | Byte[] patt = | s.SIMViewException | | | | new byte[20] | with reason code | | | | | NO_EF_SELECTED. | | | | pattOffset = 0 | | | | | | | | | | pattLength = 10 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 2 | Pattern not Found | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = | | | | | DFSIMTEST | 2 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 3 - Shall throw | | | | 2 - fid = EFLARU | sim.acces | | | | | s.SIMViewException | | | | select() | with reason code | | | | | PA | | | | 3 - patt[0] = | TTERN_NOT_FOUND. | | | | \'DA\' | | | | | | | | | | pattOffset = 0 | | | | | | | | | | pattLength = 1 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 3 | Seek from | No exception shall | | | | Beginning Forward | be thrown. Shall | | | | | return 1 | | | | patt[0:2] = | | | | | \'55\' | | | | | | | | | | pattOffset = 0 | | | | | | | | | | pattLength = 3 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 4 | Seek from End | No exception shall | | | | Backward | be thrown. Shall | | | | | return 1 | | | | patt[0:2] = | | | | | \'55\' | | | | | | | | | | pattOffset = 0 | | | | | | | | | | pattLength = 3 | | | | | | | | | | mode = | | | | | SEEK_F | | | | | ROM_END_BACKWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 5 | Seek from Next | No exception shall | | | | Forward | be thrown. Shall | | | | | return 2 | | | | patt[0:2] = | | | | | \'AA\' | | | | | | | | | | pattOffset = 0 | | | | | | | | | | pattLength = 3 | | | | | | | | | | mode = | | | | | SEEK_F | | | | | ROM_NEXT_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 6 | Last Record, Seek | Shall throw | | | | from Next Forward | sim.acces | | | | | s.SIMViewException | | | | mode = | with reason code | | | | SEEK_F | PA | | | | ROM_NEXT_FORWARD | TTERN_NOT_FOUND. | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 7 | Seek from Previous | No exception shall | | | | Backward | be thrown. Shall | | | | | return 1 | | | | patt[0:2] = | | | | | \'55\' | | | | | | | | | | pattOffset = 0 | | | | | | | | | | pattLength = 3 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | PREVIOUS_BACKWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 8 | First Record, Seek | Shall throw | | | | from Previous | sim.acces | | | | Backward | s.SIMViewException | | | | | with reason code | | | | SEEK_FROM_ | PA | | | | PREVIOUS_BACKWARD | TTERN_NOT_FOUND. | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 9 | Pattern not Found | Shall throw | | | | (out of reach) | sim.acces | | | | | s.SIMViewException | | | | patt[0:2] = | with reason code | | | | \'55\' | PA | | | | | TTERN_NOT_FOUND. | | | | pattOffset = 0 | | | | | | | | | | pattLength = 3 | | | | | | | | | | mode = | | | | | SEEK_F | | | | | ROM_NEXT_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 10 | Invalid mode | 1 - Shall throw | | | | | sim.acces | | | | 1 - mode = 4 | s.SIMViewException | | | | | with reason code | | | | seek() | INVALID_MODE | | | | | | | | | 2 - mode = -1 | 2 - Shall throw | | | | | sim.acces | | | | seek() | s.SIMViewException | | | | | with reason code | | | | | INVALID_MODE | | +----+--------------------+--------------------+------------------+ | 11 | patt is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek () | | | +----+--------------------+--------------------+------------------+ | 12 | pattOffset \ size | Shall throw | | | | of record | sim.acces | | | | | s.SIMViewException | | | | patt[0:4] = | with reason code | | | | \'55\' | OUT_OF_ | | | | | RECORD_BOUNDARIES | | | | pattOffset = 0 | | | | | | | | | | pattLength = 4 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 15 | pattOffset + | Shall throw | | | | pattLength > | | | | | patt.length | java.lang. | | | | | ArrayIndexOu | | | | patt[0:2] = | tOfBoundsException | | | | \'55\' | | | | | | | | | | pattOffset = 1 | | | | | | | | | | pattLength = 3 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 16 | EF is not Linear | 1 - No exception | | | | Fixed | shall be thrown. | | | | | | | | | 1 - fid = EFTNU | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - pattOffset = 0 | FILE_INCONSISTENT | | | | | | | | | pattLength = 3 | 3 - Shall throw | | | | | sim.acces | | | | mode = | s.SIMViewException | | | | SEEK_FROM_ | with reason code | | | | BEGINNING_FORWARD | FILE_INCONSISTENT | | | | | | | | | seek() | | | | | | | | | | 3 - fid = EFCNU | | | | | | | | | | select() | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 17 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = EFLNR | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - patt[0] = | A | | | | \'55\' | C_NOT_FULFILLED. | | | | | | | | | pattOffset = 0 | | | | | | | | | | pattLength = 1 | | | | | | | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | +----+--------------------+--------------------+------------------+ | 18 | EF is invalidated | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFLARU | | | | | | 2 - No exception | | | | select() | shall be thrown. | | | | | | | | | 2 - invalidate() | 3 - Shall throw | | | | | sim.acces | | | | 3 - patt[0] = | s.SIMViewException | | | | \'55 | with reason code | | | | | INVALIDATION_STAT | | | | pattOffset = 0 | US_CONTRADICTION. | | | | | | | | | pattLength = 1 | 4 - No exception | | | | | shall be thrown. | | | | mode = | | | | | SEEK_FROM_ | | | | | BEGINNING_FORWARD | | | | | | | | | | seek() | | | | | | | | | | 4 - rehabilitate() | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.9.4 Test Coverage {#test-coverage-8 .H6}
CRR Number Test Case Number
* * *
N1 2, 3 - 6, 7 N2 3 N3 4 N4 5 N5 7 N6 2, 6, 8, 9 N7 6 N8 8 P1 10 P2 11 P3 12
P4 13 P5 14 P6 15 C1 1 C2 16 C3 17 C4 18 C5, C6 Not Tested
#### 6.1.1.10 Method increase
Test Area Reference: API_1_SVW_INCR_BS_BS
##### 6.1.1.10.1 Conformance Requirements {#conformance-requirements-10 .H6}
The method with the following header shall be compliant to its definition in
the API.
public short increase(byte[] incr,
short incrOffset,
byte[] resp,
short respOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
SIMViewException
##### 6.1.1.10.1.1 Normal execution {#normal-execution-9 .H6}
− CRRN1: The value in the array incr is added to the value of the last
increased / updated record in the currently selected cyclic EF. The result is
stored in the oldest record and returned in the array resp. The updated record
becomes record number 1 and is selected as current record. The number of bytes
of valid data in resp is returned.
##### 6.1.1.10.1.2 Parameter errors {#parameter-errors-8 .H6}
− CRRP1: If the array incr is null, an instance of NullPointerException shall
be thrown.
− CRRP2: If incrOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP3: If incrOffset plus the value 3, is greater than the length of the
array incr.length, an instance of ArrayIndexOutOfBoundsException shall be
thrown.
− CRRP4: If the result of the addition is greater than the maximum value of
the record (represented by all bytes set to \'FF\'), an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.MAX_VALUE_REACHED.
− CRRP5: If the array resp is null, an instance of NullPointerException shall
be thrown.
− CRRP6: If respOffset is less than 0, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
− CRRP7: If the remaining length of the array resp at the offset respOffset is
less than the length of the record, an instance of
ArrayIndexOutOfBoundsException shall be thrown.
##### 6.1.1.10.1.3 Context errors {#context-errors-8 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the currently selected EF is not cyclic, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC3: If increase is not allowed as indicated by the FCI byte 8 (TS 51.011
[3]: FCI structure of an EF returned by the SELECT command), an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.FILE_INCONSISTENT.
− CRRC4: If the calling applet does not fulfil the access condition, INCREASE,
to perform this function, an instance of SIMViewException shall be thrown. The
reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC5: If the currently selected EF is invalidated, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC6: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC7: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.10.2 Test Suite Files {#test-suite-files-9 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_INCR_BS_BS_1.scr
Test Applet: API_1_SVW_INCR_BS_BS_1.java
Load Script: API_1_SVW_INCR_BS_BS_1.ldr
Cleanup Script: API_1_SVW_INCR_BS_BS_1.clr
Parameter File: API_1_SVW_INCR_BS_BS_1.par
##### 6.1.1.10.3 Test Procedure {#test-procedure-10 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF selected | Shall throw | | | | | sim.acces | | | | byte[] incr = | s.SIMViewException | | | | new byte[4] | with reason code | | | | | NO_EF_SELECTED. | | | | byte[] resp = | | | | | new byte[4] | | | | | | | | | | incrOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 2 | Increase , verify | 1 - No exception | | | | response | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | DFSIMTEST | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid = EFCARU | | | | | | 4 - No exception | | | | select() | shall be thrown. | | | | | | | | | 3 - //Set both | resp[] shall | | | | records to 00 00 | contain {0,0,1,0}. | | | | 00 | | | | | | | | | | mode = | | | | | REC_A | | | | | CC_MODE_PREVIOUS | | | | | | | | | | data[0:3] = 0 | | | | | | | | | | dataOffset = 0 | | | | | | | | | | dataLength = 3 | | | | | | | | | | updateRecord() | | | | | | | | | | updateRecord() | | | | | | | | | | 4 - incrOffset = 0 | | | | | | | | | | incr[2] = 1 | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 3 | Increase, verify | 1 - No exception | | | | file | shall be thrown. | | | | | | | | | 1 - incrOffset = 1 | resp[] shall | | | | | contain {0,0,0,3}. | | | | incr[2] = 0, | | | | | incr[3] = 2 | 2 - No exception | | | | | shall be thrown. | | | | respOffset = 1 | | | | | | resp[] shall | | | | increase() | contain {0,0,3,0}. | | | | | | | | | 2 - resp[3] = 0 | | | | | | | | | | recNumber = 0 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 0 | | | | | | | | | | readRecord() | | | +----+--------------------+--------------------+------------------+ | 4 | incr is null | Shall throw | | | | | java.lang.Nul | | | | byte[] | lPointerException. | | | | nullBuffer = null | | | | | | | | | | incrOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 5 | incrOffset \ | Shall throw | | | | incr.length | | | | | | java.lang. | | | | incrOffset = 2 | ArrayIndexOut | | | | | OfBoundsException. | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 7 | Reach Maximum | Shall throw | | | | Value | sim.acces | | | | | s.SIMViewException | | | | incr[0] = | with reason code | | | | incr[1] = | MA | | | | incr[2] = \'FF\' | X_VALUE_REACHED. | | | | | | | | | incrOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 8 | resp is null | Shall throw | | | | | java.lang.Nul | | | | incr[0] = | lPointerException. | | | | incr[1] = 0x00\' | | | | | | | | | | incr[2] = \'02\' | | | | | | | | | | incrOffset = 0 | | | | | | | | | | byte[] respNull | | | | | = null | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 9 | respOffset \ | | | | | resp.length | java.lang. | | | | | ArrayIndexOut | | | | incrOffset = 0 | OfBoundsException. | | | | | | | | | respOffset = 2 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 11 | EF is not Cyclic | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFTARU | | | | | | 2 - Shall throw | | | | select() | sim.acces | | | | | s.SIMViewException | | | | 2 - incrOffset = 0 | with reason code | | | | | F | | | | respOffset = 0 | ILE_INCONSISTENT. | | | | | | | | | increase() | 3 - No exception | | | | | shall be thrown. | | | | 3 - fid = EFLARU | | | | | | 4 - Shall throw | | | | select() | sim.acces | | | | | s.SIMViewException | | | | 4 - incrOffset = 0 | with reason code | | | | | F | | | | respOffset = 0 | ILE_INCONSISTENT. | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 12 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = EFCNIC | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - incrOffset = 0 | A | | | | | C_NOT_FULFILLED. | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 13 | EF is invalidated | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = EFCARU | | | | | | 2 - No exception | | | | select() | shall be thrown. | | | | | | | | | 2 - invalidate() | 3 - Shall throw | | | | | sim.acces | | | | 3 - incrOffset = 0 | s.SIMViewException | | | | | with reason code | | | | respOffset = 0 | INVALIDATION_STAT | | | | | US_CONTRADICTION. | | | | increase() | | | | | | 4 - No exception | | | | 4 - rehabilitate() | shall be thrown. | | +----+--------------------+--------------------+------------------+ | 14 | Check increase not | 1 - No exception | | | | allowed from FCI | shall be thrown. | | | | | Bit 7 of resp[7] | | | | 1 - fciOffset = 0 | shall not be set | | | | | (0), indicating | | | | fciLength = 8 | that increase is | | | | | not allowed. | | | | select | | | | | (FID_EF_CINA, | 2 - Shall throw | | | | fci...) | sim.acces | | | | | s.SIMViewException | | | | Verify FCI byte 8 | with reason code | | | | (fci[7]) | FILE_INCONSISTENT | | | | | | | | | 2 - incrOffset = 0 | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+
##### 6.1.1.10.4 Test Coverage {#test-coverage-9 .H6}
CRR Number Test Case Number
* * *
N1 2, 3 P1 4 P2 5 P3 6 P4 7 P5 8 P6 9 P7 10 C1 1 C2 11 C3 14 C4 12 C5 13 C6,
C7 Not Tested
#### 6.1.1.11 Method invalidate
Test Area Reference: API_1_SVW_INVL
##### 6.1.1.11.1 Conformance Requirements {#conformance-requirements-11 .H6}
The method with the following header shall be compliant to its definition in
the API.
public void invalidate()
throws SIMViewException
##### 6.1.1.11.1.1 Normal execution {#normal-execution-10 .H6}
− CRRN1: The currently selected EF of the calling applet shall be invalidated,
i.e. the flag in the EF file status shall be changed accordingly.
##### 6.1.1.11.1.2 Parameter errors {#parameter-errors-9 .H6}
No requirements.
##### 6.1.1.11.1.3 Context errors {#context-errors-9 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the calling applet does not fulfil the access condition,
INVALIDATE, to perform this function, an instance of SIMViewException shall be
thrown. The reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC3: If the currently selected EF is already invalidated, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC4: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC5: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.11.2 Test Suite Files {#test-suite-files-10 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_INVL_1.scr
Test Applet: API_1_SVW_INVL_1.java
Load Script: API_1_SVW_INVL_1.ldr
Cleanup Script: API_1_SVW_INVL_1.clr
Parameter File: API_1_SVW_INVL_1.par
##### 6.1.1.11.3 Test Procedure {#test-procedure-11 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF is selected | 1 - Shall throw | | | | | sim.acces | | | | 1 - invalidate() | s.SIMViewException | | | | | with reason code | | | | | NO_EF_SELECTED. | | +----+--------------------+--------------------+------------------+ | 2 | Invalidate EF | 1 - No exception | | | | | shall be thrown. | | | | 1 - fid = | | | | | DFSIMTEST | 2 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 3 - No exception | | | | 2 - fid = EFTNR | shall be thrown. | | | | | | | | | select() | 4 - No exception | | | | | shall be thrown. | | | | 3 - invalidate() | | | | | | | | | | 4 - rehabilitate() | | | +----+--------------------+--------------------+------------------+ | 3 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = EFCNIV | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - invalidate() | A | | | | | C_NOT_FULFILLED. | | +----+--------------------+--------------------+------------------+ | 4 | EF is already | 1 - No exception | | | | invalidated | shall be thrown. | | | | | | | | | 1 - fid = EFTNR | 2 - No exception | | | | | shall be thrown. | | | | select() | | | | | | 3 - Shall throw | | | | 2 - invalidate() | sim.acces | | | | | s.SIMViewException | | | | 3 - invalidate() | with reason code | | | | | INVALIDATION_STAT | | | | | US_CONTRADICTION. | | +----+--------------------+--------------------+------------------+
##### 6.1.1.11.4 Test Coverage {#test-coverage-10 .H6}
CRR number Test Case Number
* * *
N1 2 C1 1 C2 3 C3 4 C4, C5 Not Tested
#### 6.1.1.12 Method rehabilitate
Test Area Reference: API_1_SVW_REHA
##### 6.1.1.12.1 Conformance Requirements {#conformance-requirements-12 .H6}
The method with the following header shall be compliant to its definition in
the API.
public void rehabilitate()
throws SIMViewException
##### 6.1.1.12.1.1 Normal execution {#normal-execution-11 .H6}
− CRRN1: The currently selected EF of the calling applet shall be
rehabilitated, i.e. the flag in the EF file status shall be changed
accordingly.
##### 6.1.1.12.1.2 Parameter errors {#parameter-errors-10 .H6}
No requirements.
##### 6.1.1.12.1.3 Context errors {#context-errors-10 .H6}
− CRRC1: If the calling applet has currently no EF selected, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.NO_EF_SELECTED.
− CRRC2: If the calling applet does not fulfil the access condition,
REHABILITATE, to perform this function, an instance of SIMViewException shall
be thrown. The reason code shall be SIMViewException.AC_NOT_FULFILLED.
− CRRC3: If the currently selected EF is not invalidated, an instance of
SIMViewException shall be thrown. The reason code shall be
SIMViewException.INVALIDATION_STATUS_CONTRADICTION.
− CRRC4: If the method call causes a memory problem (e.g. memory access
error), an instance of SIMViewException shall be thrown. The reason code shall
be SIMViewException.MEMORY_PROBLEM.
− CRRC5: If the method call causes an error to occur that is not expected and
thus not handled, an instance of SIMViewException shall be thrown. The reason
code shall be SIMViewException.INTERNAL_ERROR.
##### 6.1.1.12.2 Test Suite Files {#test-suite-files-11 .H6}
Additional requirements for the GSM personalization: None
Test Script: API_1_SVW_REHA_1.scr
Test Applet: API_1_SVW_REHA_1.java
Load Script: API_1_SVW_REHA_1.ldr
Cleanup Script: API_1_SVW_REHA_1.clr
Parameter File: API_1_SVW_REHA_1.par
##### 6.1.1.12.3 Test Procedure {#test-procedure-12 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | No EF is selected | 1 - Shall throw | | | | | sim.acces | | | | 1 - rehabilitate() | s.SIMViewException | | | | | with reason code | | | | | NO_EF_SELECTED. | | +----+--------------------+--------------------+------------------+ | 2 | Rehabilitate | 1 - No exception | | | | invalidated File | shall be thrown. | | | | | | | | | 1 - fid = | 2 - No exception | | | | DFSIMTEST | shall be thrown. | | | | | | | | | select() | 3 - No exception | | | | | shall be thrown. | | | | 2 - fid = EFCNR | | | | | | 4 - No exception | | | | select() | shall be thrown. | | | | | | | | | 3 - invalidate() | 5 - No exception | | | | | shall be thrown. | | | | 4 - rehabilitate() | | | | | | resp[] shall | | | | 5 - byte[] incr | contain {0,0,1}. | | | | = new byte[3] = | | | | | {0,0,1} | | | | | | | | | | incrOffset = 0 | | | | | | | | | | byte[] resp = | | | | | new byte[1] = 1 | | | | | | | | | | respOffset = 0 | | | | | | | | | | increase() | | | +----+--------------------+--------------------+------------------+ | 3 | Access condition | 1 - No exception | | | | not fulfilled | shall be thrown. | | | | | | | | | 1 - fid = EFCNRH | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - rehabilitate() | AC | | | | | _NOT_FULFILLED.. | | +----+--------------------+--------------------+------------------+ | 4 | Rehabilitate | 1 - No exception | | | | validated File | shall be thrown. | | | | | | | | | 1 - fid = EFCNR | 2 - Shall throw | | | | | sim.acces | | | | select() | s.SIMViewException | | | | | with reason code | | | | 2 - rehabilitate() | INVALIDATION_STAT | | | | | US_CONTRADICTION. | | +----+--------------------+--------------------+------------------+
##### 6.1.1.12.4 Test Coverage {#test-coverage-11 .H6}
CRR number Test Case Number
* * *
N1 2 C1 1 C2 3 C3 4 C4, C5 Not Tested
### 6.1.2 Class SIMSystem
#### 6.1.2.1 Method getTheSIMView
Test Area Reference: API_1_SSY_GETS
##### 6.1.2.1.1 Conformance Requirement: {#conformance-requirement .H6}
The method with following header shall compliant to its definition in the API.
public static SIMView getTheSIMView()
##### 6.1.2.1.1.1 Normal execution {#normal-execution-12 .H6}
  * CRRN1: returns a reference to class which implements the SIMView > interface.
##### 6.1.2.1.1.2 Parameters error {#parameters-error .H6}
No requirements.
##### 6.1.2.1.1.3 Context errors {#context-errors-11 .H6}
No requirements.
##### 6.1.2.1.2 Test suite files {#test-suite-files-12 .H6}
No additional requirements for the GSM personalization:
Test Script: API_1_SSY_GETS_1.scr
Test Applet: API_1_SSY_GETS_1.java
Load Script: API_1_SSY_GETS_1.ldr
Cleanup Script: API_1_SSY_GETS_1.clr
Parameter File: API_1_SSY_GETS_1.par
##### 6.1.2.1.3 Test Procedure {#test-procedure-13 .H6}
Id Description API Expectation APDU Expectation
* * *
1 reference not equal null after execute The returned reference shall be not
null after execute  
2 reference to the GSM interface Returned a reference to the GSM interface
##### 6.1.2.1.4 Test Coverage {#test-coverage-12 .H6}
CRR number Test case number
* * *
N1 1,2
### 6.1.3 Class SIMViewException
#### 6.1.3.1 Method throwIt
Test Area Reference: API_1_SVE_THITS
##### 6.1.3.1.1 Conformance Requirement: {#conformance-requirement-1 .H6}
The method with following header shall be compliant to its definition in the
API.
public static void throwIt(short reason)
throws SIMViewException
##### 6.1.3.1.1.1 Normal execution {#normal-execution-13 .H6}
− CRRN1: Throws the JCRE instance of SIMViewException with the specified
reason.
− CRRN2: Extends javacard.framework.CardRuntimeException.
##### 6.1.3.1.1.2 Parameter errors {#parameter-errors-11 .H6}
No requirements.
##### 6.1.3.1.1.3 Context errors {#context-errors-12 .H6}
No requirements.
##### 6.1.3.1.2 Test Suite Files {#test-suite-files-13 .H6}
No additional requirements for the GSM personalization
Test Script: API_1_SVE_THITS_1.scr
Test Applet: API_1_SVE_THITS_1.java
Load Script: API_1_SVE_THITS_1.ldr
Cleanup Script: API_1_SVE_THITS_1.clr
Parameter File: API_1_SVE_THITS_1.par
##### 6.1.3.1.3 Test Procedure {#test-procedure-14 .H6}
Id Description API Expectation APDU Expectation
* * *
1 Throws the JCRE instance of SIMViewException with the specified reason
Reason = 0  
2 Throws the JCRE instance of SIMViewException with the specified reason
Reason = 1  
3 Throws the JCRE instance of SIMViewException with the specified reason
Reason = 15  
4 **SIMViewException extends javacard.framework.CardRuntimeException** Reason
= 0  
5 SIMViewException extends javacard.framework.CardRuntimeException Reason = 1  
6 SIMViewException extends javacard.framework.CardRuntimeException Reason = 15
##### 6.1.3.1.4 Test Coverage {#test-coverage-13 .H6}
CRR number Test case number
* * *
N1 1,2,3 N2 4,5,6
#### 6.1.3.2 Constructor
Test Area Reference: API_1_SVE_COORS
##### 6.1.3.2.1 Conformance Requirement: {#conformance-requirement-2 .H6}
The method with following header shall compliant to its definition in the API.
public SIMViewException(short reason)
throws SIMViewException
##### 6.1.3.2.1.1 Normal execution {#normal-execution-14 .H6}
− CRRN1: Construct a SIMViewException with the specified reason.
##### 6.1.3.2.1.2 Parameters error {#parameters-error-1 .H6}
No requirements.
##### 6.1.3.2.1.3 Context errors {#context-errors-13 .H6}
No requirements.
##### 6.1.3.2.2 Test suite files {#test-suite-files-14 .H6}
No additional requirements for the GSM personalization
Test Script: API_1_SVE_COORS_1.scr
Test Applet: API_1_SVE_COORS_1.java
Load Script: API_1_SVE_COORS.ldr
Cleanup Script: API_1_SVE_COORS.clr
Parameter File: API_1_SVE_COORS.par
##### 6.1.3.2.3 Test Procedure {#test-procedure-15 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | SIMViewException | Reason (specified) | | | | with the specified | | | | | reason | | | | | | | | | | (The reason shall | | | | | set with setReason | | | | | and compare the | | | | | Exception with | | | | | getReason) | | | +----+--------------------+--------------------+------------------+
##### 6.1.3.2.4 Test Coverage {#test-coverage-14 .H6}
CRR number Test case number
* * *
N1 1
#### 6.1.3.3 Reason Codes
Test Area Reference: API_1_SVE_CONS
##### 6.1.3.3.1 Conformance Requirement: {#conformance-requirement-3 .H6}
There is no API, only constants. This constants shall compliant to its
definition in the API.
##### 6.1.3.3.1.1 Normal execution {#normal-execution-15 .H6}
− CRRN1: The Constants of the class SIMViewException shall all have the same
name and value defined in the 3GPP TS 43.019 [7].
− CRRN2: Constructs SIMViewException a Exception with the specified reason.
##### 6.1.3.3.1.2 Parameters error {#parameters-error-2 .H6}
No requirements.
##### 6.1.3.3.1.3 Context errors {#context-errors-14 .H6}
No requirements.
##### 6.1.3.3.2 Test suite files {#test-suite-files-15 .H6}
None.
##### 6.1.3.3.3 Test Procedure {#test-procedure-16 .H6}
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed
## 6.2 Package sim.toolkit
### 6.2.1 Interface ToolkitConstants
#### 6.2.1.1 Constants
Test Area Reference: API_2_TKC_CONS
##### 6.2.1.1.1 Conformance Requirement {#conformance-requirement-4 .H6}
There is no API, only constants. This constants shall be compare to its
definition in the API.
##### 6.2.1.1.1.1 Normal execution {#normal-execution-16 .H6}
  * CRRN1: The Toolkit Constants shall all have the same name and value > as defined in 3GPP TS 43.019 [7].
##### 6.2.1.1.1.2 Parameters error {#parameters-error-3 .H6}
No requirements.
##### 6.2.1.1.1.3 Context errors {#context-errors-15 .H6}
No requirements.
##### 6.2.1.1.2 Test suite files {#test-suite-files-16 .H6}
None.
##### 6.2.1.1.3 Test Procedure {#test-procedure-17 .H6}
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed.
### 6.2.2 Interface ToolkitInterface
#### 6.2.2.1 Method processToolkit
Test Area Reference: API_2_TKI_PRTKB
##### 6.2.2.1.1 Conformance Requirement: {#conformance-requirement-5 .H6}
The method with following prototype shall be compliant to its definition in
the API.
public void processToolkit(byte event)
throws ToolkitException
##### 6.2.2.1.1.1 Normal execution {#normal-execution-17 .H6}
− CRRN1: This interface must be implemented by a Toolkit applet (which extends
the javacard.framework.Applet class) so that it can be triggered by the
Toolkit Handler according to the registration information.
− CRRN2: The Toolkit applet will have to implement the processToolkit shared
method so that the following events can be notified:
Event Description
* * *
EVENT_PROFILE_DOWNLOAD Terminal Profile command reception
EVENT_FORMATTED_SMS_PP_ENV Formatted envelope SMS-PP Data Download reception
EVENT_FORMATTED_SMS_PP_UPD Formatted Update Record EF SMS
EVENT_FORMATTED_SMS_CB Formatted envelope Cell Broadcast Data Download command
reception EVENT_UNFORMATTED_SMS_PP_ENV Unformatted Envelope SMS-PP Data
Download reception EVENT_UNFORMATTED_SMS_PP_UPD Unformatted Update Record EF
SMS EVENT_UNFORMATTED_SMS_CB Unformatted Cell Broadcast Data Download command
reception EVENT_MENU_SELECTION Envelope Menu Selection command reception
EVENT_MENU_SELECTION_HELP_REQUEST Envelope Menu Selection Help Request command
reception EVENT_CALL_CONTROL_BY_SIM Envelope Call Control by SIM command
reception EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM Envelope MO Short Message
Control by SIM command reception EVENT_TIMER_EXPIRATION Envelope Timer
Expiration EVENT_EVENT_DOWNLOAD_MT_CALL Envelope Event Download - MT call
EVENT_EVENT_DOWNLOAD_CALL_CONNECTED Envelope Event Download - Call connected
EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED Event Download - Call disconnected
EVENT_EVENT_DOWNLOAD_LOCATION_STATUS Envelope Event Download - Location status
EVENT_EVENT_DOWNLOAD_USER_ACTIVITY Envelope Event Download - User activity
EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE Envelope Event Download - Idle
screen available EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS Envelope Event
Download - Card Reader Status EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION Envelope
Event Download - Language Selection EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION
Envelope Event Download - Browser Termination
EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE Envelope Event Download - Data Available
EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS Envelope Event Download - Channel Status
EVENT_FIRST_COMMAND_AFTER_SELECT First command performed after select GSM
application or ATR EVENT_STATUS_COMMAND Status APDU command event
EVENT_UNRECOGNIZED_ENVELOPE Unrecognized Envelope command reception
##### 6.2.2.1.1.2 Parameters error {#parameters-error-4 .H6}
No requirements.
##### 6.2.2.1.1.3 Context errors {#context-errors-16 .H6}
No requirements.
##### 6.2.2.1.2 Test suite files {#test-suite-files-17 .H6}
The method is tested in the Framework.
##### 6.2.2.1.3 Test Coverage {#test-coverage-15 .H6}
CRR number Test case number
* * *
N1 Tested in Framework N2 Tested in Framework
### 6.2.3 Class EditHandler
It is not possible to test the methods provided by this class as it is
declared \'abstract\'; it will be done in the class inheriting it:
EnvelopeResponseHandler, ProactiveHandler.
### 6.2.4 Class EnvelopeHandler
#### 6.2.4.1 Method getEnvelopeTag
Test Area Reference: API_2_ENH_GENT
##### 6.2.4.1.1 Conformance Requirement: {#conformance-requirement-6 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getEnvelopeTag()
##### 6.2.4.1.1.1 Normal execution {#normal-execution-18 .H6}
− CRRN1: The method shall return the Envelope BER-TLV tag.
− CRRN2: The Envelope BER TAG is available for all triggered toolkit applets
from the invocation to the termination of their processToolkit method if the
EnvelopeHandler is available.
##### 6.2.4.1.1.2 Parameters error {#parameters-error-5 .H6}
No requirements.
##### 6.2.4.1.1.3 Context errors {#context-errors-17 .H6}
No requirements.
##### 6.2.4.1.2 Test suite files {#test-suite-files-18 .H6}
Test Script: API_2_ENH_GENT_1.scr
Test Applet: API_2_ENH_GENT_1.java
Load Script: API_2_ENH_GENT_1.ldr
Cleanup Script: API_2_ENH_GENT_1.clr
Parameter File: API_2_ENH_GENT_1.par
##### 6.2.4.1.3 Test Procedure {#test-procedure-18 .H6}
Id Description API Expectation APDU Expectation
* * *
1 getEnvelopeTag called just after triggering of the application. Returns 0xD1  
2 getEnvelopeTag called after a proactive command. Returns 0xD1  
3 getEnvelopeTag called after a second proactive command. Returns 0xD1
##### 6.2.4.1.4 Test Coverage {#test-coverage-16 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 1, 2, 3
#### 6.2.4.2 Method getItemIdentifier
Test Area Reference: API_2_ENH_GIID
##### 6.2.4.2.1 Conformance Requirement: {#conformance-requirement-7 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getItemIdentifier()
throws ToolkitException
##### 6.2.4.2.1.1 Normal execution {#normal-execution-19 .H6}
− CRRN1:The method shall return the item identifier byte value.
− CRRN2:The item identifier byte value returned shall be from the first Item
Identifier TLV element.
− CRRN3: If the element is available it becomes the TLV selected.
− CRRN4: The item identifier is available for all triggered toolkit applets
from the invocation to the termination of their processToolkit method if the
EnvelopeHandler is available.
##### 6.2.4.2.1.2 Parameters error {#parameters-error-6 .H6}
No requirements.
##### 6.2.4.2.1.3 Context errors {#context-errors-18 .H6}
− CRRC1: The method shall throw ToolkitException (UNAVAILABLE_ELEMENT) if the
item identifier TLV is not present.
− CRRC2: The method shall throw ToolkitException (OUT_OF_TLV_BOUNDARIES) if
the item identifier byte is missing in the Item Identifier Simple TLV.
##### 6.2.4.2.2 Test suite files {#test-suite-files-19 .H6}
Test Script: API_2_ENH_GIID_1.scr
Test Applet: API_2_ENH_GIID_1.java
Load Script: API_2_ENH_GIID_1.ldr
Cleanup Script: API_2_ENH_GIID_1.clr
Parameter File: API_2_ENH_GIID_1.par
##### 6.2.4.2.3 Test Procedure {#test-procedure-19 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Send envelope | Returns 03 | | | | SMS-PP Formatted | | | | | with item | | | | | identifier TLV and | | | | | identifier value | | | | | of 03 | | | +----+--------------------+--------------------+------------------+ | 2 | Send envelope | Returns FF | | | | SMS-PP Formatted | | | | | with two item | | | | | identifier TLV | | | | | with first value | | | | | FF and second 44 | | | +----+--------------------+--------------------+------------------+ | 3 | Send envelope | Returns 81 | | | | SMS-PP Formatted | | | | | with two item | Returns 81 | | | | identifier TLV | | | | | with first value | | | | | 81 and second 44, | | | | | call twice the | | | | | method | | | | | getItemIdentifier | | | +----+--------------------+--------------------+------------------+ | 4 | Send envelope | getItemIdent | | | | SMS-PP Formatted | ifier=getValueByte | | | | with item | | | | | identifier TLV and | | | | | value of 66. | | | | | FindTLV with TAG | | | | | 02. | | | | | getItemIdentifier | | | | | and then | | | | | getValueByte with | | | | | offset 0 | | | +----+--------------------+--------------------+------------------+ | 5 | Send envelope | ToolkitException | | | | SMS-PP Formatted | (UNA | | | | without item | VAILABLE_ELEMENT) | | | | identifier TLV and | | | | | getItemIdentifier | | | +----+--------------------+--------------------+------------------+ | 6 | Send Envelope | Returns 66 | | | | SMS-PP Formatted | | | | | with item | | | | | identifier TLV | | | | | (66), send | | | | | proactive command. | | | | | Then | | | | | getItemIdentifier | | | +----+--------------------+--------------------+------------------+ | 7 | Send Envelope | ToolkitException | | | | SMS-PP Formatted | (OUT_OF | | | | with item | _TLV_BOUNDARIES) | | | | identifier TLV but | | | | | without item | | | | | number | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.2.4 Test Coverage {#test-coverage-17 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 2, 3 N3 4 N4 6 C1 5 C2 7
#### 6.2.4.3 Method getSecuredDataLength
Test Area Reference: API_2_ENH_GSDL
##### 6.2.4.3.1 Conformance Requirement: {#conformance-requirement-8 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getSecuredDataLength()
throws ToolkitException
##### 6.2.4.3.1.1 Normal execution {#normal-execution-20 .H6}
− CRRN1: The method shall return the length of the Secured Data from the
Command Packet in the SMS TPDU (simple or concatenated ) or Cell Broadcast
Page Simple TLV contained in the Envelope handler.
− CRRN2: The length is from the first SMS TPDU TLV or Cell Broadcast Page
Simple TLV.
− CRRN3: The length should not include padding bytes.
− CRRN4: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV and
if the SMS TP‑UD is formatted according to 3GPP TS 23.048 [8].
− CRRN5: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD and
if the SMS TP‑UD is formatted according to 3GPP TS 23.048 [8].
− CRRN6: The method can be used if the event is EVENT_FORMATTED_SMS_CB and if
the Cell Broadcast Page is formatted according to 3GPP TS 23.048 [8].
− CRRN7: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_ENV, the selected TLV should be the SMS TPDU TLV.
− CRRN8: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_UPD, the selected TLV should be the SMS TPDU TLV.
− CRRN9: If the method is successful and if the event is
EVENT_FORMATTED_SMS_CB, the selected TLV should be the Cell Broadcast Page
TLV.
##### 6.2.4.3.1.2 Parameters error {#parameters-error-7 .H6}
No requirements.
##### 6.2.4.3.1.3 Context errors {#context-errors-19 .H6}
− CRRC1: The method shall thrown ToolkitException (UNAVAILABLE_ELEMENT) in
case of unavailable SMS TPDU TLV element or Cell Broadcast Page Simple TLV.
− CRRC2: The method shall thrown ToolkitException (UNAVAILABLE_ELEMENT) in
case of wrong data format.
##### 6.2.4.3.2 Test suite files {#test-suite-files-20 .H6}
Specific triggering:
> \- FORMATTED SMS CB.
\- UNFORMATTED SMS CB.
\- FORMATTED SMS PP UPD.
\- UNFORMATED SMS PP ENV.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one used for downloading applications.
Test Script: API_2_ENH_GSDL_1.scr
Test Applet: API_2_ENH_GSDL_1.java
Load Script: API_2_ENH_GSDL_1.ldr
Cleanup Script: API_2_ENH_GSDL_1.clr
Parameter File: API_2_ENH_GSDL_1.par
##### 6.2.4.3.3 Test procedure {#test-procedure-20 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | **FORMATTED SMS PP | | | | | ENV Triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with | Returns 0x002A | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x002A | | | | length of 6 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with TP-OA | Returns 0x002A | | | | length of 12 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with RC/CC/DS | Returns 0x0010 | | | | length of 0 | | | +----+--------------------+--------------------+------------------+ | 5 | Test with RC/CC/DS | Returns 0x0010 | | | | length of 8 | | | +----+--------------------+--------------------+------------------+ | 6 | Test with PCNTR = | Returns 0x0010 | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 7 | Test with PCNTR = | Returns 0x0005 | | | | 7 | | | +----+--------------------+--------------------+------------------+ | 8 | Test with Secured | Returns 0x0000 | | | | Data Length = 00 | | | +----+--------------------+--------------------+------------------+ | 9 | Test with Secured | Returns 0x0033 | | | | Data Length = 0x33 | | | +----+--------------------+--------------------+------------------+ | 10 | Test with Secured | Returns 0x006C | | | | Data Length = 0x6C | | | | | (UDL = 0x7F) | | | +----+--------------------+--------------------+------------------+ | 11 | Test with Secured | Returns 0x006D | | | | Data Length = 0x6D | | | | | (UDL = 0x80) | | | +----+--------------------+--------------------+------------------+ | 12 | Test with Secured | Returns 0x0079 | | | | Data Length = | | | | | maximum length for | | | | | one envelope : | | | | | 0x79 (UDL = 0x8C) | | | +----+--------------------+--------------------+------------------+ | 13 | Verify it is the | Returns 0x0005 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV and | | | | | inside two | | | | | different secured | | | | | data lengths: 5 | | | | | and 10 | | | +----+--------------------+--------------------+------------------+ | 14 | Test with secured | Returns 0x007F | | | | data length = 0x7F | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 15 | Test with secured | Returns 0x0080 | | | | data length = 0x80 | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 16 | Test with secured | Returns 0x00FA | | | | data length = | | | | | maximum length for | | | | | 2 concatenated | | | | | envelopes : 0xFA | | | +----+--------------------+--------------------+------------------+ | 17 | Test with | getValueByte | | | | FORMA | returns 0x0040 | | | | TTED_SMS_PP_ENV | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPD Triggering** | | | +----+--------------------+--------------------+------------------+ | 18 | Same test as 1 but | Returns 0x002A | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 19 | Same test as 2 but | Returns 0x002A | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 20 | Same test as 3 but | Returns 0x002A | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 21 | Same test as 4 but | Returns 0x0010 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 22 | Same test as 5 but | Returns 0x0010 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 23 | Same test as 6 but | Returns 0x0010 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 24 | Same test as 7 but | Returns 0x0005 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 25 | Same test as 8 but | Returns 0x0000 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 26 | Same test as 9 but | Returns 0x0033 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 27 | Same test as 10 | Returns 0x006C | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 28 | Same test as 11 | Returns 0x006D | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 29 | Same test as 12 | Returns 0x0079 | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 30 | Same test as 13 | Returns 0x0005 | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 31 | Test with secured | Returns 0x007F | | | | data length = 0x7F | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 32 | Test with secured | Returns 0x0080 | | | | data length = 0x80 | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 33 | Test with secured | Returns 0x00FA | | | | data length = | | | | | maximum length for | | | | | 2 concatenated | | | | | envelopes : 0xFA | | | +----+--------------------+--------------------+------------------+ | 34 | Test with | getValueByte | | | | FORMA | returns 0x0040 | | | | TTED_SMS_PP_UPD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS CB | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 35 | Same test as 4 but | Returns 0x0010 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 36 | Same test as 5 but | Returns 0x0010 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 37 | Same test as 6 but | Returns 0x0010 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 38 | Same test as 7 but | Returns 0x0005 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 39 | Same test as 8 but | Returns 0x0000 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 40 | Same test as 9 but | Returns 0x0033 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 41 | Same test as 12 | Returns 0x0042 | | | | but with maximum | | | | | secured data | | | | | length: 0x42, and | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 42 | Test with | getValueByte | | | | FORMATTED_SMS_CB | returns 0x00 | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV | | | +----+--------------------+--------------------+------------------+ | | **Error tests** | | | +----+--------------------+--------------------+------------------+ | 43 | Send an envelope | ToolkitException | | | | SMS CB, | UN | | | | ge | AVAILABLE_ELEMENT | | | | tSecuredDataLength | | | +----+--------------------+--------------------+------------------+ | 44 | Send an envelope | ToolkitException | | | | SMS PP unformatted | UN | | | | | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+
##### 6.2.4.3.4 Test Coverage {#test-coverage-18 .H6}
CRR number Test case number
* * *
N1 1 to 42 N2 13, 30 N3 6, 7, 23, 24, 37, 38 N4 1 to 17 N5 18 to 34 N6 35 to
42 N7 17 N8 34 N9 42 C1 43 C2 44
#### 6.2.4.4 Method getSecuredDataOffset
Test Area Reference: API_2_ENH_GSDO
##### 6.2.4.4.1 Conformance Requirement: {#conformance-requirement-9 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getSecuredDataOffset()
throws ToolkitException
##### 6.2.4.4.1.1 Normal execution {#normal-execution-21 .H6}
  * CRRN1: The method shall return the offset of the secured data first > byte contained in a SMS TPDU TLV.
  * CRRN2: The offset is from the first SMS TPDU TLV.
  * CRRN3: The method can be used if the event is > EVENT_FORMATTED_SMS_PP_ENV and if the SMS TP-UD is formatted > according to 3GPP TS 23.048 [8].
  * CRRN4: The method can be used if the event is > EVENT_FORMATTED_SMS_PP_UPD and if the SMS TP-UD is formatted > according to 3GPP TS 23.048 [8].
  * CRRN5: The method can be used if the event is > EVENT_FORMATTED_SMS_CB and if the Cell Broadcast Page is > formatted according to 3GPP TS 23.048 [8].
  * CRRN6: If the method is successful and if the event is > EVENT_FORMATTED_SMS_PP_ENV, the selected TLV should be the SMS > TPDU TLV.
  * CRRN7: If the method is successful and if the event is > EVENT_FORMATTED_SMS_PP_UPD, the selected TLV should be the SMS > TPDU TLV.
  * CRRN8: If the method is successful and if the event is > EVENT_FORMATTED_SMS_CB, the selected TLV should be the Cell > Broadcast Page TLV.
  * CRNN9: If the Secured Data length is zero the value returned shall > be the offset of the first byte following the 3GPP TS 23.048 [8] > Command Packet structure.
##### 6.2.4.4.1.2 Parameters error {#parameters-error-8 .H6}
No requirements.
##### 6.2.4.4.1.3 Context errors {#context-errors-20 .H6}
  * CRRC1: The method shall thrown ToolkitException > (UNAVAILABLE_ELEMENT) in case of unavailable SMS TPDU TLV > element.
  * CRRC2: The method shall thrown ToolkitException > (UNAVAILABLE_ELEMENT) in case of wrong data format.
##### 6.2.4.4.2 Test suite files {#test-suite-files-21 .H6}
Specific triggering:
> \- FORMATTED SMS CB.
>
> \- UNFORMATTED SMS CB.
\- FORMATTED SMS PP UPD.
\- UNFORMATED SMS PP ENV.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one used for downloading applications.
Test Script: API_2_ENH_GSDO_1.scr
Test Applet: API_2_ENH_GSDO_1.java
Load Script: API_2_ENH_GSDO_1.ldr
Cleanup Script: API_2_ENH_GSDO_1.clr
Parameter File: API_2_ENH_GSDO_1.par
##### 6.2.4.4.3 Test Procedure {#test-procedure-21 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | **FORMATTED SMS PP | | | | | ENV triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with TP-OA | Returns 0x21 | | | | length of 2 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x23 | | | | length of 6 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with TP-OA | Returns 0x26 | | | | length of 12 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with RC/CC/DS | Returns 0x21 | | | | length of 0 and | | | | | TP-OA length is 2 | | | +----+--------------------+--------------------+------------------+ | 5 | Test with RC/CC/DS | Returns 0x29 | | | | length of 8 and | | | | | TP-OA length is 2 | | | +----+--------------------+--------------------+------------------+ | 6 | Send a SMS PP with | Returns 0x24 ( the | | | | 2 TPDU TLV and | first offset ) | | | | inside two | | | | | different secured | | | | | data offsets | | | +----+--------------------+--------------------+------------------+ | 7 | Same test as 1 but | Returns 0x21 | | | | without any | | | | | secured data | | | +----+--------------------+--------------------+------------------+ | 8 | Test with | Returns 0x40 | | | | FORMATTED_SMS_PP | | | | | ENV | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 9 | Same test as 1, | Returns 0x21 | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPR triggering** | | | +----+--------------------+--------------------+------------------+ | 10 | Same test as 1 but | Returns 0x21 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 11 | Same test as 2 but | Returns 0x23 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 12 | Same test as 3 but | Returns 0x26 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 13 | Same test as 4 but | Returns 0x21 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 14 | Same test as 5 but | Returns 0x29 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 15 | Same test as 6 but | Returns 0x24 ( the | | | | with | first offset ) | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 16 | Same test as 7 but | Returns 0x21 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 17 | Test with | Returns 0x40 | | | | FORMATTED_SMS_PP | | | | | UPD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 18 | Same test as 10, | Returns 0x21 | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS CB | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 19 | Same test as 4 but | Returns 0x16 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 20 | Same test as 5 but | Returns 0x1E | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 21 | Same test as 7 but | Returns 0x16 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 22 | Test with | Returns 0x00 | | | | FORMATTED_SMS_CB | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 23 | Send an | ToolkitException | | | | UNFORMATTED SMS CB | UN | | | | envelope, | AVAILABLE_ELEMENT | | | | ge | | | | | tSecuredDataOffset | | | +----+--------------------+--------------------+------------------+ | 24 | Send an | ToolkitException | | | | UNFORMATTED SMS PP | UN | | | | envelope, | AVAILABLE_ELEMENT | | | | ge | | | | | tSecuredDataOffset | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.4.4 Test Coverage {#test-coverage-19 .H6}
CRR number Test case number
* * *
N1 1 to 22. N2 6, 15. N3 1 to 9. N4 10 to 18. N5 19, 20, 21, 22 N6 8 N7 17 N8
22 N9 7, 16, 21. C1 23 C2 24
#### 6.2.4.5 Method getTheHandler
Test Area Reference: API_2_ENH_GTHD
##### 6.2.4.5.1 Conformance Requirements {#conformance-requirements-13 .H6}
The method with following header shall be compliant to its definition in the
API.
public static EnvelopeHandler getTheHandler()
throws ToolkitException
##### 6.2.4.5.1.1 Normal execution {#normal-execution-22 .H6}
  * CRRN1: The method shall return the single system instance of the > EnvelopeHandler class.
  * CRRN2: The EnvelopeHandler is a Temporary JCRE Entry Point Object ( > see Javacard 2.1 Runtime Environment (JCRE) Specification [12])
##### 6.2.4.5.1.2 Parameters error {#parameters-error-9 .H6}
No requirements.
##### 6.2.4.5.1.3 Context errors {#context-errors-21 .H6}
  * CRRC1: The method shall thrown ToolkitException > (HANDLER_NOT_AVAILABLE) if the handler is busy.
##### 6.2.4.5.2 Test suite files {#test-suite-files-22 .H6}
Test Script: API_2_ENH_GTHD_1.scr
Test Applet: API_2_ENH_GTHD_1.java
Load Script: API_2_ENH_GTHD_1.ldr
Cleanup Script: API_2_ENH_GTHD_1.clr
Parameter File: API_2_ENH_GTHD_1.par
##### 6.2.4.5.3 Test Procedure {#test-procedure-22 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | getTheHandler | The returned | | | | twice | objects shall be | | | | | the same | | +----+--------------------+--------------------+------------------+ | 2 | Verify that | The reference | | | | getTheHandler | returned shall be | | | | returns an | an EnvelopeHandler | | | | EnvelopeHandler | (check cast) | | | | | | | | | GetTheHandler | | | +----+--------------------+--------------------+------------------+ | 3 | Verify the | The reference | | | | returned value is | returned shall not | | | | not null | be null. | | | | | | | | | GetTheHandler | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.5.4 Test Coverage {#test-coverage-20 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 Checked in Framework tests: FWK_API_HEPO (test case 1) C1
Checked in Framework tests: FWK_MHA_ENHD
#### 6.2.4.6 Method getTPUDLOffset
Test Area Reference: API_2_ENH_GTPO
##### 6.2.4.6.1 Conformance Requirement: {#conformance-requirement-10 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getTPUDLOffset()
throws ToolkitException
##### 6.2.4.6.1.1 Normal execution {#normal-execution-23 .H6}
  * CRRN1: The method shall return the TPUDL offset in a SMS TPDU TLV.
  * CRRN2: The offset is from the first SMS TPDU TLV.
  * CRRN3: The method can be used if the event is > EVENT_FORMATTED_SMS_PP_ENV.
  * CRRN4: The method can be used if the event is > EVENT_FORMATTED_SMS_PP_UPD.
  * CRRN5: The method can be used if the event is > EVENT_UNFORMATTED_SMS_PP_ENV.
  * CRRN6: The method can be used if the event is > EVENT_UNFORMATTED_SMS_PP_UPD.
  * CRRN7: If the method is successful, the selected TLV should be the > SMS TPDU TLV.
##### 6.2.4.6.1.2 Parameters error {#parameters-error-10 .H6}
No requirements.
##### 6.2.4.6.1.3 Context errors {#context-errors-22 .H6}
  * CRRC1: The method shall thrown ToolkitException > (UNAVAILABLE_ELEMENT) in case of unavailable SMS TPDU TLV > element.
  * CRRC2: The method shall thrown ToolkitException > (UNAVAILABLE_ELEMENT) if the TPUDL field does not exist.
##### 6.2.4.6.2 Test suite files {#test-suite-files-23 .H6}
Specific triggering:
\- FORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP ENV.
\- UNFORMATTED SMS CB.
Test Script: API_2_ENH_GTPO_1.scr
Test Applet: API_2_ENH_GTPO_1.java
Load Script: API_2_ENH_GTPO_1.ldr
Cleanup Script: API_2_ENH_GTPO_1.clr
Parameter File: API_2_ENH_GTPO_1.par
##### 6.2.4.6.3 Test procedure {#test-procedure-23 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | **FORMATTED SMS PP | | | | | ENV triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with TP-OA | Returns 0x0D | | | | length of 2 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x0F | | | | length of 6 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with TP-OA | Returns 0x12 | | | | length of 12 | | | +----+--------------------+--------------------+------------------+ | 4 | Send a SMS PP with | Returns 0x10 (the | | | | 2 TPDU TLV and | first offset) | | | | inside two | | | | | different UDL | | | | | offsets | | | +----+--------------------+--------------------+------------------+ | 5 | Same test as 1, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | 6 | Verify after call | Returns 0x40 | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | getTPUDLOffset and | | | | | then getValueByte | | | | | to verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPD triggering** | | | +----+--------------------+--------------------+------------------+ | 7 | Same test as 1 but | Returns 0x0D | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 8 | Same test as 2 but | Returns 0x0F | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 9 | Same test as 3 but | Returns 0x12 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 10 | Same test as 4 but | Returns 0x10 (the | | | | with | first offset) | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 11 | Same test as 7, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | PP UPD | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 12 | Same test as 1 but | Returns 0x0D | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 13 | Same test as 2 but | Returns 0x0F | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 14 | Same test as 3 but | Returns 0x12 | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 15 | Same test as 4 but | Returns 0x12 (the | | | | with | first offset) | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 16 | Same test as 12, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum User | | | | | Data Length = | | | | | 0x010C) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | PP ENV | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 17 | Same test as 1 but | Returns 0x0D | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 18 | Same test as 2 but | Returns 0x0F | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 19 | Same test as 3 but | Returns 0x12 | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 20 | Same test as 4 but | Returns 0x10 (the | | | | with | first offset) | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 21 | Same test as 17, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum User | | | | | Data Length = | | | | | 0x010C) | | | +----+--------------------+--------------------+------------------+ | | **SMS CB | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 22 | Send an envelope | ToolkitException | | | | SMS CB, | UN | | | | getTPUDLOffset | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+
##### 6.2.4.6.4 Test Coverage {#test-coverage-21 .H6}
CRR number Test case number
* * *
N1 1 to 21. N2 4, 10, 15, 20. N3 1, 2, 3, 4, 5, 6 N4 7, 8, 9, 10, 11 N5 12,
13, 14, 15, 16 N6 17, 18, 19, 20, 21 N7 6 C1 22 C2 Not applicable
#### 6.2.4.7 Method getLength
Test Area Reference: API_2_ENH_GLEN
##### 6.2.4.7.1 Conformance Requirement {#conformance-requirement-11 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getLength()
throws ToolkitException
##### 6.2.4.7.1.1 Normal execution {#normal-execution-24 .H6}
  * CRRN1: returns the length in bytes of the TLV list.
##### 6.2.4.7.1.2 Parameter Error {#parameter-error .H6}
No requirements.
##### 6.2.4.7.1.3 Context errors {#context-errors-23 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.4.7.2 Test Suite files {#test-suite-files-24 .H6}
Specific triggering: None
Test Script: API_2_ENH_GLEN_1.scr
Test Applet: API_2_ENH_GLEN_1.java
Load Script: API_2_ENH_GLEN_1.ldr
Cleanup Script: API_2_ENH_GLEN_1.clr
Parameter File: API_2_ENH_GLEN_1.par
##### 6.2.4.7.3 Test Procedure {#test-procedure-24 .H6}
Id Description API Expectation APDU Expectation
* * *
1 Send an envelope SMS PP with BER length of 0x31 Result of getLength() is
0x0031  
2 Send an envelope SMS PP with BER length of 0x7F Result of getLength() is
0x007Fh  
3 Send an envelope SMS PP with BER length of 81 80 Result of getLength() is
0x0080h  
4 Send an envelope SMS PP with BER length of 81 FC (maximum length for a
single SMS) Result of getLength() is 0x00FCh  
5 Send formatted SMS with BER length of 0x00FF, using 2 concatenated SMS
Result of getLength() is 0x00FFh  
6 Send formatted SMS with BER length of 0x0100, using 2 concatenated SMS
Result of getLength() is 0x0100h  
7 Send formatted SMS with maximum user data length (0x10D) (BER
length:0x012F), using 2 concatenated SMS Result of getLength() is 0x012Fh
##### 6.2.4.7.4 Test Coverage {#test-coverage-22 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4, 5, 6, 7 C1 Does not apply for EnvelopeHandler
#### 6.2.4.8 Method copy
Test Area Reference: API_2_ENH_COPY_BSS
##### 6.2.4.8.1 Conformance Requirement {#conformance-requirement-12 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copy(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.8.1.1 Normal execution {#normal-execution-25 .H6}
  * CRRN1: copies the simple TLV list contained in the handler to the > destination byte array.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.4.8.1.2 Parameter errors {#parameter-errors-12 .H6}
  * CRRP1: if dstBuffer is null a NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative, an > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if dstLength is grater than the length of the simple TLV > List, an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException. OUT_OF_TLV_BOUNDARIES.
##### 6.2.4.8.1.3 Context errors {#context-errors-24 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.4.8.2 Test Suite files {#test-suite-files-25 .H6}
Specific triggering: None
Test Script: API_2_ENH_COPY_BSS_1.scr
Test Applet: API_2_ENH_COPY_BSS_1.java
Load Script: API_2_ENH_COPY_BSS_1.ldr
Cleanup Script: API_2_ENH_COPY_BSS_1.clr
Parameter File: API_2_ENH_COPY_BSS_1.par
##### 6.2.4.8.3 Test Procedure {#test-procedure-25 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | NULL as parameter | Nu | | | | to dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | DstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | DstBuffer.length = | | | | | 5 | | | | | | | | | | DstOffset = 3 | | | | | | | | | | DstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ | Toolk | | | | length of the | itException.OUT_O | | | | simple TLV list | F_TLV_BOUNDARIES | | | | | is thrown | | | | DstBuffer.length = | | | | | 48 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 48 | | | +----+--------------------+--------------------+------------------+ | 8 | Successful call, | Result of copy() | | | | dstBuffer is the | is 0X0047 | | | | whole buffer | | | | | | | | | | DstBuffer.length = | | | | | 47 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 47 | | | +----+--------------------+--------------------+------------------+ | 9 | Compare the buffer | Result of | | | | | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 10 | Successful call, | Result of copy() | | | | dstBuffer is part | is 0X0032 | | | | of a buffer | | | | | | | | | | DstBuffer.length = | | | | | 50 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 47 | | | +----+--------------------+--------------------+------------------+ | 11 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 12 | Successful call, | Result of copy() | | | | dstBuffer is part | is 0X0009 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 14 | **Successful call, | Result of copy() | | | | dstBuffer is part | is 0X0104 | | | | of a buffer** | | | | | | | | | | dstBuffer.length = | | | | | 260 | | | | | | | | | | dstOffset = 257 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 16 | Successful call, | Result of copy() | | | | copy with length | is 0x104 | | | | =0 | | | | | | | | | | dstBuffer.length = | | | | | 260 | | | | | | | | | | dstOffset = 260 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | | **Send a Formatted | | | | | SMS PP with the | | | | | maximum user data | | | | | length = 0x010D, | | | | | using 2 | | | | | concatenated | | | | | envelopes** | | | +----+--------------------+--------------------+------------------+ | 17 | Successful call, | Result of copy() | | | | copy with length | is 0x12B | | | | =299 | | | | | | | | | | dstBuffer.length = | | | | | 299 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 299 | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.8.4 Test Coverage {#test-coverage-23 .H6}
CRR number Test case number
* * *
N1 9, 11, 13, 15 N2 8, 10, 12, 14, 16, 17 P1 1 P2 2, 3, 4, 5, 6 P3 7 C1 Does
not apply for EnvelopeHandler
#### 6.2.4.9 Method findTLV
Test Area Reference: API_2_ENH_FINDBB
##### 6.2.4.9.1 Conformance Requirement {#conformance-requirement-13 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findTLV(byte tag, byte occurrence)
throws ToolkitException
##### 6.2.4.9.1.1 Normal execution {#normal-execution-26 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of the
TLV list (handler buffer):
  * CRRN1: the method is successful if the required occurrence exists > then the corresponding TLV becomes current.
  * CRRN2: if the method is successful then it returns > TLV_FOUND_CR_SET when Comprehension Required flag is set.
  * CRRN3: if the method is successful then it returns > TLV_FOUND_CR_NOT_SET when Comprehension Required flag is not > set.
  * CRRN4: if the required occurrence of the TLV element does not exist, > the current TLV is no longer defined and TLV_NOT_FOUND is > returned.
  * CRRN5: The search method is comprehension required flag independent.
##### 6.2.4.9.1.2 Parameter errors {#parameter-errors-13 .H6}
  * CRRP1: if an input parameter is not valid (e.g. occurrence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException BAD_INPUT_PARAMETER.
##### 6.2.4.9.1.3 Context errors {#context-errors-25 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.4.9.2 Test Suite files {#test-suite-files-26 .H6}
Specific triggering: None
Test Script: API_2_ENH_FINDBB_1.scr
Test Applet: API_2_ENH_FINDBB_1.java
Load Script: API_2_ENH_FINDBB_1.ldr
Cleanup Script: API_2_ENH_FINDBB_1.clr
Parameter File: API_2_ENH_FINDBB_1.par
##### 6.2.4.9.3 Test Procedure {#test-procedure-26 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | Trig the applet | | | | | with SMS PP | | | | | including one more | | | | | tag 02 and one TAG | | | | | 04 | | | +----+--------------------+--------------------+------------------+ | 1 | Invalid input | To | | | | parameter | olkitException.BAD | | | | | _INPUT_PARAMETER | | | | Occurrence = 0 | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search 1^st^ TLV | Result is | | | | | T | | | | Tag = 02h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | Call the | Result is 0x02 | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 4 | Search 2^nd^ TLV | Result is | | | | | T | | | | Tag = 06h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 5 | Call the | Result is 0x05h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | Search a wrong tag | Result is | | | | | TLV_NOT_FOUND | | | | Tag = 03h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Search a tag with | Result is | | | | wrong occurrence | TLV_NOT_FOUND | | | | | | | | | Tag = 02h | | | | | | | | | | Occurrence = 3 | | | +----+--------------------+--------------------+------------------+ | 9 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 10 | Search the TLV | Result is | | | | | TLV_F | | | | Tag = 02h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 11 | Search the TLV | Result is | | | | | TLV_F | | | | Tag = 04h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 12 | Search tag 86h | Result is | | | | | T | | | | Tag = 86h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 13 | Search tag 84h | Result is | | | | | TLV_F | | | | Tag = 84h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.9.4 Test Coverage {#test-coverage-24 .H6}
CRR number Test case number
* * *
N1 3, 5 N2 2, 4 N3 10, 11 N4 6, 7, 8, 9 N5 12, 13 P1 1 C1 Does not apply for
EnvelopeHandler
#### 6.2.4.10 Method getValueLength
Test Area Reference: API_2_ENH_GVLE
##### 6.2.4.10.1 Conformance Requirement {#conformance-requirement-14 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getValueLength()
throws ToolkitException
##### 6.2.4.10.1.1 Normal execution {#normal-execution-27 .H6}
  * CRRN1: gets and returns the binary length of the value field for the > last TLV element which has been found in the handler.
##### 6.2.4.10.1.2 Parameter errors {#parameter-errors-14 .H6}
No requirements.
##### 6.2.4.10.1.3 Context errors {#context-errors-26 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.4.10.2 Test Suite files {#test-suite-files-27 .H6}
Specific triggering: None
Test Script: API_2_ENH_GVLE_1.scr
Test Applet: API_2_ENH_GVLE_1.java
Load Script: API_2_ENH_GVLE_1.ldr
Cleanup Script: API_2_ENH_GVLE_1.clr
Parameter File: API_2_ENH_GVLE_1.par
##### 6.2.4.10.3 Test Procedure {#test-procedure-27 .H6}
Id Description API Expectation APDU Expectation
* * *
       Fill the SMS PP with TLV: Tag 33, Length C8
1 getValueLength() ToolkitException.UNAVAILABLE_ELEMENT is thrown  
2 Search TLV 02h  
getValueLength() Result is 0X0002  
3 Search TLV 0Bh  
getValueLength() Result is 0X0024  
4 Search TLV 33h  
getValueLength() Result is 0X00C8  
**Send Formatted SMS PP with the maximum user data length = 0x010D, using 2
concatenated envelopes**  
5 Search SMS TPDU TAG  
getValueLength() Result is 0X0120
##### 6.2.4.10.4 Test Coverage {#test-coverage-25 .H6}
CRR number Test case number
* * *
N1 2, 3, 4, 5 C1 Does not apply for EnvelopeHandler C2 1
#### 6.2.4.11 Method getValueByte
Test Area Reference: API_2_ENH_GVBYS
##### 6.2.4.11.1 Conformance Requirement {#conformance-requirement-15 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getValueByte(short valueOffset)
throws ToolkitException
##### 6.2.4.11.1.1 Normal execution {#normal-execution-28 .H6}
  * CRRN1: Gets a byte from the last TLV element which has been found in > the handler and returns its value (1 byte).
##### 6.2.4.11.1.2 Parameter errors {#parameter-errors-15 .H6}
  * CRRP1: if valueOffset is out of the current TLV an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.4.11.1.3 Context errors {#context-errors-27 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.4.11.2 Test Suite files {#test-suite-files-28 .H6}
Specific triggering: None
Test Script: API_2_ENH_GVBYS_1.scr
Test Applet: API_2_ENH_GVBYS_1.java
Load Script: API_2_ENH_GVBYS_l.dr
Cleanup Script: API_2_ENH_GVBYS_1.clr
Parameter File: API_2_ENH_GVBYS_1.par
##### 6.2.4.11.3 Test Procedure {#test-procedure-28 .H6}
Id Description API Expectation APDU Expectation
* * *
       Fill the SMS PP with TLV: Tag 33, Length C8 Value 01 02 ...
1 getValueByte(0) ToolkitException.UNAVAILABLE_ELEMENT is thrown  
2 Search TLV 02h  
getValueByte(2) ToolkitException.OUT_OF_TLV_BOUNDARIES is thrown  
3 Search TLV 02h  
getValueByte(1) Result is 0x81  
4 Search TLV 02h (Device Identities TLV)  
getValueByte(0) Result is 83h (Source)  
5 Search TLV 33h  
getValueByte(7E) Result is 0x7F  
6 Search TLV 33h  
getValueByte(80) Result is 0x81  
7 getValueByte(7F) Result is 0x80  
8 Search TLV B3h  
getValueByte(C7) Result is 0xC8  
**Send Formatted SMS PP with the maximum user data length = 0x010D, using 2
concatenated envelopes**  
9 Search SMS TPDU TAG  
getValueByte(0x011F) Result is 0xFA
##### 6.2.4.11.4 Test Coverage {#test-coverage-26 .H6}
CRR number Test case number
* * *
N1 3, 4, 5, 6, 7, 8, 9 P1 2 C1 Does not apply for EnvelopeHandler C2 1
#### 6.2.4.12 Method copyValue
Test Area Reference: API_2_ENH_CPYVS_BSS
##### 6.2.4.12.1 Conformance Requirement {#conformance-requirement-16 .H6}
The method with following header shall be compliant with its definition in the
API.
public short copyValue(short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.12.1.1 Normal execution {#normal-execution-29 .H6}
  * CRRN1: copies a part of the last TLV element which has been found, > into a destination. buffer.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.4.12.1.2 Parameter errors {#parameter-errors-16 .H6}
  * CRRP1: if dstBuffer is null NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.4.12.1.3 Context errors {#context-errors-28 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.4.12.2 Test Suite files {#test-suite-files-29 .H6}
Specific triggering: None
Test Script: API_2_ENH_CPYVS_BSS_1.scr
Test Applet: API_2_ENH_CPYVS_BSS_1.java
Load Script: API_2_ENH_CPYVS_BSS_1.ldr
Cleanup Script: API_2_ENH_CPYVS_BSS_1.clr
Parameter File: API_2_ENH_CPYVS_BSS_1.par
##### 6.2.4.12.3 Test procedure {#test-procedure-29 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | copyValue() with a | Nu | | | | null dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 0Bh | | | +----+--------------------+--------------------+------------------+ | | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ TLV | Toolk | | | | length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | dstLength > TLV | itException.OUT_O | | | | length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Search TLV 01h | | | +----+--------------------+--------------------+------------------+ | | copyValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown on the | | | | | copyValue() method | | +----+--------------------+--------------------+------------------+ | 12 | Search TLV 06h | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is | | | | valueOffset = 0 | 0x0006 | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 81 11 22 | | | | | 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | 14 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is | | | | valueOffset = 1 | 0x0007 | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 4 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 11 22 | | | | | | | | | | 33 44 55 55 55 | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 16 | Successful call, | Result of | | | | copy with length | copyValue() is 20 | | | | =0 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 20 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | | Send Formatted SMS | | | | | with the maximum | | | | | user data length = | | | | | 0x010D, using 2 | | | | | concatenated | | | | | envelopes | | | +----+--------------------+--------------------+------------------+ | 17 | Search SMS TPDU | | | | | TAG | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is | | | | valueOffset = 0x11 | 0x010D | | | | | | | | | dstBuffer.length = | | | | | 0x010D | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0x010D | | | +----+--------------------+--------------------+------------------+ | 18 | Compare buffer | Result is 00h | | | | | | | | | buffer = 0348 | | | | | header and secured | | | | | data (01 ... FA) | | | +----+--------------------+--------------------+------------------+ | 19 | Initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is | | | | valueOffset = | 0x010D | | | | 0x0111 | | | | | | | | | | dstBuffer.length = | | | | | 0x010D | | | | | | | | | | dstOffset = 0x0100 | | | | | | | | | | dstLength = 0x000D | | | +----+--------------------+--------------------+------------------+ | 20 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 55 55 55 | | | | | 55 55 | | | | | | | | | | ... | | | | | | | | | | 55 55 EE EF F0 F1 | | | | | F2 F3 F4 F5 F6 F7 | | | | | F8 F9 FA | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.12.4 Test Coverage {#test-coverage-27 .H6}
CRR number Test case number
* * *
N1 13, 15, 18, 20 N2 12, 14, 16, 17, 19 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10
C1 Does not apply for EnvelopeHandler C2 11
#### 6.2.4.13 Method compareValue
Test Area Reference: API_2_ENH_CPRVS_BSS
##### 6.2.4.13.1 Conformance requirement {#conformance-requirement-17 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte compareValue(short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.13.1.1 Normal execution {#normal-execution-30 .H6}
Compares the last found TLV element with a buffer:
  * CRRN1: returns 0 if identical.
  * CRRN2: returns -1 if the first miscomparing byte in simple TLV List > is less than that in compareBuffer.
  * CRRN3: returns 1 if the first miscomparing byte in simple TLV List > is greater than that in compareBuffer.
##### 6.2.4.13.1.2 Parameter errors {#parameter-errors-17 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.4.13.1.3 Context errors {#context-errors-29 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.4.13.2 Test Suite files {#test-suite-files-30 .H6}
Specific triggering: None
Test Script: API_2_ENH_CPRVS_BSS_1.scr
Test Applet: API_2_ENH_CPRVS_BSS_1.java
Load Script: API_2_ENH_CPRVS_BSS_1.ldr
Cleanup Script: API_2_ENH_CPRVS_BSS_1.clr
Parameter File: API_2_ENH_CPRVS_BSS_1.par
##### 6.2.4.13.3 Test procedure {#test-procedure-30 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | compareValue() | Nu | | | | with a null | llPointerException | | | | compareBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 0Bh | | | +----+--------------------+--------------------+------------------+ | | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 5 | | | | | | | | | | compareLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | TLV length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | TLV length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Search TLV 01h | Result is | | | | | TLV_NOT_FOUND | | +----+--------------------+--------------------+------------------+ | | compareValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | Search TLV 06h | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 81 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 7F 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 15 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 81 11 22 | | | | | 33 44 F5 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 1 | | | | | | | | | | compareOffset = 4 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 81 10 22 | | | | | 33 44 F5 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 81 12 22 | | | | | 33 44 F5 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | **Successful call, | Result of | | | | compareValue with | compareValue() is | | | | length** =0 | 0 | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | CompareOffset = 15 | | | | | | | | | | CompareLength = 0 | | | +----+--------------------+--------------------+------------------+ | | Send Formatted SMS | | | | | PP with the | | | | | maximum user data | | | | | length = 0x010D, | | | | | using 2 | | | | | concatenated | | | | | envelopes | | | +----+--------------------+--------------------+------------------+ | | Search SMS TPDU | | | | | TAG | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | 0348 header and | | | | | formatted data(01 | | | | | 02 ... FA) | | | +----+--------------------+--------------------+------------------+ | 19 | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 0x11 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = | | | | | 0x010D | | | | | | | | | | c | | | | | ompareBufferLength | | | | | = 0x010D | | | +----+--------------------+--------------------+------------------+ | 20 | Compare buffers | Result is 00h | | | | | | | | | valueOffset = | | | | | 0x0111 | | | | | | | | | | compareOffset = | | | | | 0x0100 | | | | | | | | | | compareLength = | | | | | 0x000D | | | | | | | | | | c | | | | | ompareBufferLength | | | | | = 0x010D | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.13.4 Test Coverage {#test-coverage-28 .H6}
CRR number Test case number
* * *
N1 12, 15, 19, 20 N2 13, 16, 18 N3 14, 17 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10
C1 Does not apply for EnvelopeHandler C2 11
#### 6.2.4.14 Method findAndCopyValue(byte tag, byte[] dstBuffer, short
dstOffset)
Test Area Reference: API_2_ENH_FACYB_BS
##### 6.2.4.14.1 Conformance requirement {#conformance-requirement-18 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte[] dstBuffer,
short dstOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.14.1.1 Normal execution {#normal-execution-31 .H6}
  * CRRN1: looks for the first occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + length of the copied value is > returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.4.14.1.2 Parameter errors {#parameter-errors-18 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.4.14.1.3 Context errors {#context-errors-30 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.4.14.2 Test Suite files {#test-suite-files-31 .H6}
Specific triggering: None
Test Script: API_2_ENH_FACYB_BS_1.scr
Test Applet: API_2_ENH_FACYB_BS_1.java
Load Script: API_2_ENH_FACYB_BS_1.ldr
Cleanup Script: API_2_ENH_FACYB_BS_1.clr
Parameter File: API_2_ENH_FACYB_BS_1.par
##### 6.2.4.14.3 Test procedure {#test-procedure-31 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | Fill the SMS PP | | | | | with TLV: Tag 02 | | | | | Value 22 44 Tag | | | | | 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | FindAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 06h | | | | | | | | | | dstBuffer.length = | | | | | 06 | | | | | | | | | | dstOffset = 06 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 05 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 5 | DstOffset + length | ArrayIndexOu | | | | >dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | DstBuffer.length = | | | | | 06 | | | | | | | | | | DstOffset = 1 | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 03h | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Successful call | Result of | | | | | findAndCopyValue | | | | Tag = 06h | () is 0006 | | | | | | | | | DstBuffer.length = | | | | | 06 | | | | | | | | | | DstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 9 | Compare buffer | Result is 00h | | | | | | | | | buffer = 81 11 22 | | | | | 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | 10 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue | | | | dstBuffer.length = | () is 0008 | | | | 12 | | | | | | | | | | dstOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 11 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 81 11 22 33 | | | | | 44 F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 12 | Successful call | Result of | | | | | findAndCopyValue | | | | tag = 02h | () is 0002 | | | | | | | | | dstBuffer.length = | | | | | 2 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 | | | +----+--------------------+--------------------+------------------+ | 14 | Successful call | Result of | | | | (with tag 82h) | findAndCopyValue | | | | | () is 0002 | | | | tag = 82h | | | | | | | | | | dstBuffer.length = | | | | | 02 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 | | | +----+--------------------+--------------------+------------------+ | 16 | Successful call | Result of | | | | (with tag B3h) | findAndCopyValue | | | | | () is 00C4 | | | | tag = B3h | | | | | | | | | | dstBuffer.length = | | | | | C4 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Compare buffer | Result is 00h | | | | | | | | | buffer = 01 02 ... | | | | | C4 | | | +----+--------------------+--------------------+------------------+ | | Send Formatted SMS | | | | | PP with the | | | | | maximum user data | | | | | length = 0x010D, | | | | | using 2 | | | | | concatenated | | | | | envelopes | | | +----+--------------------+--------------------+------------------+ | 18 | Successful call | Result of | | | | (with SMS TPDU | findAndCopyValue | | | | TAG) | () is 0x011E | | | | | | | | | tag = 0Bh | | | | | | | | | | dstBuffer.length = | | | | | 0x011E | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 19 | Compare buffer | Result is 00h | | | | | | | | | buffer = 0348 | | | | | Header + secured | | | | | data (01 02 ... | | | | | FA) | | | +----+--------------------+--------------------+------------------+ | 20 | Successful call | Result of | | | | (with SMS TPDU | findAndCopyValue | | | | TAG) | () is 0x021E | | | | | | | | | tag = 0Bh | | | | | | | | | | dstBuffer.length = | | | | | 0x0220 | | | | | | | | | | dstOffset = 0x0100 | | | +----+--------------------+--------------------+------------------+ | 21 | Compare buffer | Result is 00h | | | | | | | | | buffer = 0348 | | | | | Header + secured | | | | | data (01 02 ... | | | | | FA) | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.14.4 Test Coverage {#test-coverage-29 .H6}
CRR number Test case number
* * *
N1 9, 11, 13 N2 6, 7 N3 8, 10, 12 N4 14, 15, 16, 17, 18, 19, 20, 21 P1 1 P2 2,
3, 4, 5 C1 Does not apply for EnvelopeHandler
#### 6.2.4.15 Method findAndCopyValue(byte tag, byte occurrence, short
valueOffset, byte[] dstBuffer, short dstOffset, short dstLength)
Test Area Reference: API_2_ENH_FACYBS_BSS
##### 6.2.4.15.1 Conformance requirement {#conformance-requirement-19 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte occurence,
short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.15.1.1 Normal execution {#normal-execution-32 .H6}
  * CRRN1: looks for the indicated occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + dstLength is returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.4.15.1.2 Parameter errors {#parameter-errors-19 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.4.15.1.3 Context errors {#context-errors-31 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.4.15.2 Test Suite files {#test-suite-files-32 .H6}
Test Script: API_2_ENH_FACYBS_BSS_1.scr
Test Applet: API_2_ENH_FACYBS_BSS_1.java
Load Script: API_2_ENH_FACYBS_BSS_1.ldr
Cleanup Script: API_2_ENH_FACYBS_BSS_1.clr
Parameter File: API_2_ENH_FACYBS_BSS_1.par
##### 6.2.4.15.3 Test procedure {#test-procedure-32 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | Fill the SMS PP | | | | | with TLV: Tag 02 | | | | | Value 22 44 Tag | | | | | 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | findAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ Value | Toolk | | | | length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | **valueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String** length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 06h | AVAILABLE_ELEMENT | | | | | is thrown | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 12 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 13 | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 06h, | is 6 | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 06 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 06 | | | +----+--------------------+--------------------+------------------+ | 14 | Compare buffer | Result is 00h | | | | | | | | | buffer = 81 11 22 | | | | | 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | 15 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue | | | | tag = 06h, | () is 0007 | | | | occurrence = 1 | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 04 | | | +----+--------------------+--------------------+------------------+ | 16 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 22 33 44 | | | | | F5 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 17 | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 02h, | is 0002 | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 2 | | | +----+--------------------+--------------------+------------------+ | 18 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 19 | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 02h, | is 0002 | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 2 | | | +----+--------------------+--------------------+------------------+ | 20 | Compare buffer | Result is 00h | | | | | | | | | buffer = 22 44 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 21 | Successful call | Result of | | | | (with tag 82h) | findAndCopyValue | | | | | () is 0002 | | | | tag = 82h | | | | | | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 02 | | | +----+--------------------+--------------------+------------------+ | 22 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 23 | Successful call | Result of | | | | (with tag 82h) | findAndCopyValue | | | | | () is 0002 | | | | tag = 82h | | | | | | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 02 | | | +----+--------------------+--------------------+------------------+ | 24 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 22 44 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 25 | Successful call, | Result of | | | | findAndCopyValue | findAndCopyValue | | | | with length =0 | () is 12 | | | | | | | | | DstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 12 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | | Send Formatted SMS | | | | | PP with the | | | | | maximum user data | | | | | length = 0x010D, | | | | | using 2 | | | | | concatenated | | | | | envelopes | | | +----+--------------------+--------------------+------------------+ | 26 | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 0Bh, | is 0x010D | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0x11 | | | | | | | | | | dstBuffer.length = | | | | | 0x010D | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0x010D | | | +----+--------------------+--------------------+------------------+ | 27 | Compare buffer | Result is 00h | | | | | | | | | buffer = 0348 | | | | | Header + secured | | | | | data (01 02 ... | | | | | FA) | | | +----+--------------------+--------------------+------------------+ | 28 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue | | | | tag = 0Bh, | () is 0x010D | | | | occurrence = 1 | | | | | | | | | | valueOffset = | | | | | 0x0111 | | | | | | | | | | dstBuffer.length = | | | | | 0x010D | | | | | | | | | | dstOffset = 0x0100 | | | | | | | | | | dstLength = 0x0D | | | +----+--------------------+--------------------+------------------+ | 29 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 ... 55 55 EE | | | | | EF F0 F1 F2 F3 F4 | | | | | F5 F6 F7 F8 F9 FA | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.15.4 Test Coverage {#test-coverage-30 .H6}
CRR number Test case number
* * *
N1 14, 15, 17, 19, 20 N2 11, 12 N3 13, 15, 17, 19, 25 N4 21, 22, 23, 24, 26,
27, 28,29 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 Does not apply for
EnvelopeHandler
#### 6.2.4.16 Method findAndCompareValue(byte tag, byte[] compareBuffer, short
compareOffset)
Test Area Reference: API_2_ENH_FACRB_BS
##### 6.2.4.16.1 Conformance requirement {#conformance-requirement-20 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte[] compareBuffer,
short compareOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.16.1.1 Normal execution {#normal-execution-33 .H6}
Looks for the first occurrence of a TLV element from beginning of a TLV list
and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical returns 0.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer returns -1.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer returns 1.
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.4.16.1.2 Parameter errors {#parameter-errors-20 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.4.16.1.3 Context errors {#context-errors-32 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.4.16.2 Test Suite files {#test-suite-files-33 .H6}
Test Script: API_2_ENH_FACRB_BS_1.scr
Test Applet: API_2_ENH_FACRB_BS_1.java
Load Script: API_2_ENH_FACRB_BS_1.ldr
Cleanup Script: API_2_ENH_FACRB_BS_1.clr
Parameter File: API_2_ENH_FACRB_BS_1.par
##### 6.2.4.16.3 Test procedure {#test-procedure-33 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | Fill the SMS PP | | | | | with TLV: Tag 02 | | | | | Value 22 44 Tag | | | | | 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | dstBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 06h | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 12 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 05 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | length > | tOfBoundsException | | | | co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 7 | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 03h | is thrown | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | tag = 06h | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 9 | Verify current TLV | Result is 06 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 10 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F4 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F6 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 12 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 81 11 22 33 | | | | | 44 F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 83 81 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 83 80 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 15 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 83 82 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 81 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 02h) | | | | | | | | | | tag = 02h | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = 01 | | | | | 02 ... C4 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag B3h) | | | | | | | | | | Tag = B3h | | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = C4 | | | | | | | | | | CompareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | | Send Unformatted | | | | | SMS PP with the | | | | | maximum user data | | | | | length = 0x010C, | | | | | using 2 | | | | | concatenated | | | | | envelopes | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | 0340 Header + user | | | | | data (00 01 02 ... | | | | | FF 01 ... 0C) | | | +----+--------------------+--------------------+------------------+ | 18 | Successful call | Result is 00h | | | | (with SMS TPDU | | | | | TAG) | | | | | | | | | | Tag = 0Bh | | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 0x011E | | | | | | | | | | CompareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = 55 | | | | | 55 ... 55 | | | | | | | | | | CompareBuffer from | | | | | offset 0x0100= | | | | | 0340 Header + user | | | | | data (00 01 02 ... | | | | | FF 01 ... 0C) | | | +----+--------------------+--------------------+------------------+ | 19 | Successful call | Result is 00h | | | | (with SMS TPDU | | | | | TAG) | | | | | | | | | | Tag = 0Bh | | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 0x220 | | | | | | | | | | CompareOffset = | | | | | 0x0100 | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.16.4 Test Coverage {#test-coverage-31 .H6}
CRR number Test case number
* * *
N1 6,7 N2 9 N3 8, 12, 13, 18, 19 N4 10, 14 N5 11, 15 N6 16, 17 P1 1 P2 2, 3,
4, 5 C1 Does not apply for EnvelopeHandler
#### 6.2.4.17 Method findAndCompareValue(byte tag, byte occurrence, short
valueOffset, byte[] compareBuffer, short compareOffset, short compareLength)
Test Area Reference: API_2_ENH_FACRBBS_BSS
##### 6.2.4.17.1 Conformance requirement {#conformance-requirement-21 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte occurence,
short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.4.17.1.1 Normal execution {#normal-execution-34 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of a
TLV list and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical 0 is returned.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer -1 is returned.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer 1 is returned
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.4.17.1.2 Parameter errors {#parameter-errors-21 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, compareLength or both are out of the current > TLV an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
  * CRRP4: if an input parameter is not valid (e.g. occurence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException BAD_INPUT_PARAMETER.
##### 6.2.4.17.1.3 Context errors {#context-errors-33 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.4.17.2 Test Suite files {#test-suite-files-34 .H6}
Test Script: API_2_ENH_FACRBBS_BSS_1.scr
Test Applet: API_2_ENH_FACRBBS_BSS_1.java
Load Script: API_2_ENH_FACRBBS_BSS_1.ldr
Cleanup Script: API_2_ENH_FACRBBS_BSS_1.clr
Parameter File: API_2_ENH_FACRBBS_BSS_1.par
##### 6.2.4.17.3 Test procedure {#test-procedure-34 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | Fill the SMS PP | | | | | with TLV: Tag 02 | | | | | Value 22 44 Tag | | | | | 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | compareBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 6 | | | | | | | | | | compareOffset = 6 | | | | | | | | | | compareLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | Value length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Value length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Invalid parameter | To | | | | | olkitException.BAD | | | | **occurrence = 0** | _INPUT_PARAMETER | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 06h | is thrown | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 15 | Verify current TLV | Result is 0006 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F4 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F6 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 22 33 44 | | | | | F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 4 | | | +----+--------------------+--------------------+------------------+ | 19 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 22 33 45 | | | | | F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 20 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 22 33 43 | | | | | F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 21 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 81 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 22 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 22 44 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 23 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 22 45 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is -1 | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 24 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 81 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 02h) | | | | | | | | | | tag = 02h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 25 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 01 | | | | | 02 ... C4 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag B3h) | | | | | | | | | | tag = B3h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 00C4 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = | | | | | 00C4 | | | +----+--------------------+--------------------+------------------+ | 26 | Successful call, | Result of | | | | f | fin | | | | indAndCompareValue | dAndCompareValue() | | | | with length =0 | is 00h | | | | | | | | | DstBuffer.length = | | | | | C4 | | | | | | | | | | DstOffset = C4 | | | | | | | | | | DstLength = 0 | | | +----+--------------------+--------------------+------------------+ | | Send Formatted SMS | | | | | PP with the | | | | | maximum user data | | | | | length = 0x010D, | | | | | using 2 | | | | | concatenated | | | | | envelopes | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | 23.048 Header + | | | | | secured data (01 | | | | | 02 ... FA) | | | +----+--------------------+--------------------+------------------+ | 27 | Successful call | Result is 00h | | | | (with SMS TPDU | | | | | TAG) | | | | | | | | | | tag = 0Bh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0x11 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 0x010D | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = | | | | | 0x010D | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = 55 | | | | | 55 ... 55 EE EF F0 | | | | | F1 F2 F3 F4 F5 F6 | | | | | F7 F8 F9 FA | | | +----+--------------------+--------------------+------------------+ | 28 | Successful call | Result is 00h | | | | (with SMS TPDU | | | | | TAG) | | | | | | | | | | tag = 0Bh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0x11 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 0x010D | | | | | | | | | | compareOffset = | | | | | 0x0100 | | | | | | | | | | compareLength = | | | | | 0x0D | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.17.4 Test Coverage {#test-coverage-32 .H6}
CRR number Test case number
* * *
N1 12, 13 N2 15 N3 14, 18, 21, 22, 26, 27, 28 N4 16, 20 N5 17, 19, 23 N6 24,
25 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 P4 11 C1 Does not apply for
EnvelopeHandler
#### 6.2.4.18 Method getCapacity
Test Area Reference: API_2_ENH_GCAP
##### 6.2.4.18.1 Conformance Requirement: {#conformance-requirement-22 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getCapacity()
##### 6.2.4.18.1.1 Normal execution {#normal-execution-35 .H6}
  * CRRN1: The method shall return the maximum size of the Simple TLV > list managed by the handler.
##### 6.2.4.18.2 Test suite files {#test-suite-files-35 .H6}
Test Script: API_2_ENH_GCAP_1.scr
Test Applet: API_2_ENH_GCAP_1.java
Load Script: API_2_ENH_GCAP_1.ldr
Cleanup Script: API_2_ENH_GCAP_1.clr
Parameter File: API_2_ENH_GCAP_1.par
##### 6.2.4.18.3 Test Procedure {#test-procedure-35 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | **EnvelopeHandler | 1 - Applet is | | | | available** | triggered | | | | | | | | | 1 - Send envelope | 2 - No exception | | | | SMS-PP Formatted | is thrown | | | | | | | | | 2 - The applet | 3 - No exception | | | | calls the | is thrown; the | | | | getLength() method | capacity is | | | | | greater than the | | | | 3 - The applet | BER TLV Length | | | | calls | | | | | g | | | | | etCapacity()method | | | +----+--------------------+--------------------+------------------+
##### 6.2.4.18.4 Test Coverage {#test-coverage-33 .H6}
CRR number Test case number
* * *
N1 1
#### 6.2.4.19 Method getUserDataLength
Test Area Reference: API_2_ENH_GUDL
##### 6.2.4.19.1 Conformance Requirement: {#conformance-requirement-23 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getUserDataLength()
##### 6.2.4.19.1.1 Normal execution {#normal-execution-36 .H6}
  * CRRN1: The method shall return the length of the User Data contained > in the SMS TPDU TLV element.
  * CRRN2: The length is from the first SMS TPDU TLV element.
  * CRRN3: If the SMS TPDU TLV element is available, it becomes the > selected TLV
  * CRRN4: The method can be used if the event is > EVENT_FORMATTED_SMS_PP_ENV.
  * CRRN5: The method can be used if the event is > EVENT_FORMATTED_SMS_PP_UPD.
  * CRRN6: The method can be used if the event is > EVENT_UNFORMATED_SMS_PP_ENV.
  * CRRN7: The method can be used if the event is > EVENT_UNFORMATTED_SMS_PP_UDP.
##### 6.2.4.19.1.2 Context errors {#context-errors-34 .H6}
  * CRRC1: The method shall throw UNAVAILABLE_ELEMENT in case of > unavailable TPDU TLV element.
  * CRRC2: The method shall throw UNAVAILABLE_ELEMENT in case of wrong > data format.
##### 6.2.4.19.2 Test suite files {#test-suite-files-36 .H6}
Specific triggering:
  * UNFORMATTED_SMS_PP_ENV
  * FORMATTED_SMS_PP_UPD
  * UNFORMATED_SMS_PP_UPD
  * UNRECOGNIZED_ENVELOPE
  * For Formatted triggering if CC/RC/DS is used, the security parameters are those used for downloading applications.
Test Script: API_2_ENH_GUDL_1.scr
Test Applet: API_2_ENH_GUDL_1.java
Load Script: API_2_ENH_GUDL_1.ldr
Cleanup Script: API_2_ENH_GUDL_1.clr
Parameter File: API_2_ENH_GUDL_1.par
##### 6.2.4.19.3 Test Procedure {#test-procedure-36 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | FORMATTED SMS PP | | | | | ENV Triggering | | | +----+--------------------+--------------------+------------------+ | 1 | Test with | Returns 0x003D | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2 and user data | | | | | length of 0x3D | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x003D | | | | length of 12 and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 3 | Test with RC/CC/DS | Returns 0x0023 | | | | length of 0 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with RC/CC/DS | Returns 0x002B | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 5 | Test with PCNTR = | Returns 0x0023 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 6 | Test with PCNTR = | Returns 0x001F | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x05 | | | +----+--------------------+--------------------+------------------+ | 7 | Test with | Returns 0x0013 | | | | SecuredDataLength | | | | | = 00 and no | | | | | RC/CC/DS | | | +----+--------------------+--------------------+------------------+ | 8 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 9 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 10 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length | | | | | (0x8C) for a | | | | | single SMS | | | +----+--------------------+--------------------+------------------+ | 11 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 12 | Send envelope | GetValueByte() | | | | SMS-PP Formatted. | returns | | | | | 0x40(23.040 first | | | | FindTLV() with | byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 13 | Test with | Returns 0x00FF | | | | UserDataLength = | | | | | 0xFF with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 14 | Test with | Returns 0x0100 | | | | UserDataLength = | | | | | 0x100 with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 15 | Test with | Returns 0x010D | | | | UserDataLength = | | | | | maximum length | | | | | (0x010D) with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | | FORMATTED SMS PP | | | | | UPD Triggering | | | +----+--------------------+--------------------+------------------+ | 16 | Test with | Returns 0x003D | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | | | and TP-OA length | | | | | of 2 and user data | | | | | length of 0x3D | | | +----+--------------------+--------------------+------------------+ | 17 | Test with TP-OA | Returns 0x003D | | | | length of 12 and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 18 | Test with RC/CC/DS | Returns 0x0023 | | | | length of 0 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 19 | Test with RC/CC/DS | Returns 0x002B | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 20 | Test with PCNTR = | Returns 0x0023 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 21 | Test with PCNTR = | Returns 0x001F | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x05 | | | +----+--------------------+--------------------+------------------+ | 22 | Test with | Returns 0x0013 | | | | SecuredDataLength | | | | | = 00 and no | | | | | RC/CC/DS | | | +----+--------------------+--------------------+------------------+ | 23 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 24 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 25 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum | | | | | length(0x8C) for a | | | | | single SMS | | | +----+--------------------+--------------------+------------------+ | 26 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 27 | Send envelope | GetValueByte() | | | | SMS-PP Formatted. | returns | | | | | 0x40(23.040 first | | | | FindTLV() with | byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 28 | Test with | Returns 0x00FF | | | | UserDataLength = | | | | | 0xFF with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 29 | Test with | Returns 0x0100 | | | | UserDataLength = | | | | | 0x100 with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 30 | Test with | Returns 0x010D | | | | UserDataLength = | | | | | maximum length | | | | | (0x010D) with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS PP | | | | | ENV Triggering | | | +----+--------------------+--------------------+------------------+ | 31 | Test with | Returns 0x003D | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2, and user | | | | | data length of | | | | | 0x3D | | | +----+--------------------+--------------------+------------------+ | 32 | Test with TP-OA | Returns 0x003D | | | | length of 12, and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 33 | Test with | Returns 0x0000 | | | | UserDataLength = | | | | | 0x00 | | | +----+--------------------+--------------------+------------------+ | 34 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 35 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 36 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length: | | | | | 0x8C for a single | | | | | SMS | | | +----+--------------------+--------------------+------------------+ | 37 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 38 | Send envelope | GetValueByte() | | | | SMS-PP | returns 0x00 | | | | Unformatted. | | | | | | (23.040 first | | | | FindTLV() with | byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | | | (first user data = | | | | | 0x55) | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS PP | | | | | UPD Triggering | | | +----+--------------------+--------------------+------------------+ | 39 | Test with | Returns 0x003D | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | and TP-OA length | | | | | of 2, and user | | | | | data length of | | | | | 0x3D | | | +----+--------------------+--------------------+------------------+ | 40 | Test with TP-OA | Returns 0x003D | | | | length of 12, and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 41 | Test with | Returns 0x0000 | | | | UserDataLength = | | | | | 0x00 | | | +----+--------------------+--------------------+------------------+ | 42 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 43 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 44 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length: | | | | | 0x8C for a single | | | | | SMS | | | +----+--------------------+--------------------+------------------+ | 45 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 46 | Send envelope | GetValueByte() | | | | SMS-PP | returns 0x00 | | | | Unformatted. | | | | | | (23.040 first | | | | FindTLV() with | byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | | **UNRE | | | | | COGNIZED_ENVELOPE | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 47 | Test with an | ToolkitException | | | | UNRE | UN | | | | COGNIZED_ENVELOPE | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+
##### 6.2.4.19.4 Test Coverage {#test-coverage-34 .H6}
+------------+--------------------------+ | CRR number | Test case number | +============+==========================+ | N1 | All test cases excepted: | | | | | | 53 | +------------+--------------------------+ | N2 | 11, 26, 37, 45 | +------------+--------------------------+ | N3 | 12, 27, 38, 46 | +------------+--------------------------+ | N4 | 1 to 15 | +------------+--------------------------+ | N5 | 16 to 30 | +------------+--------------------------+ | N6 | 31 to 38 | +------------+--------------------------+ | N7 | 39 to 46 | +------------+--------------------------+ | C1 | 47 | +------------+--------------------------+ | C2 | Not applicable | +------------+--------------------------+
#### 6.2.4.20 Method getChannelIdentifier
Test Area Reference: API_2_ENH_GCID
##### 6.2.4.20.1 Conformance Requirement: {#conformance-requirement-24 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getChannelIdentifier()
throws ToolkitException
##### 6.2.4.20.1.1 Normal execution {#normal-execution-37 .H6}
  * CRRN1: The method shall return the channel identifier byte value.
  * CRRN2: The channel identifier byte value returned shall be from the > first Channel status TLV element.
  * CRRN3: If the element is available it becomes the currently selected > TLV.
  * CRRN4: The channel identifier is available for all triggered toolkit > applets from the invocation to the termination of their > processToolkit method if the EnvelopeHandler is available.
##### 6.2.4.20.1.2 Context errors {#context-errors-35 .H6}
  * CRRC1: The method shall throw ToolkitException > (UNAVAILABLE_ELEMENT) if the Channel status TLV is not present.
  * CRRC2: The method shall throw ToolkitException > (OUT_OF_TLV_BOUNDARIES) if the Simple TLV Channel Status length > is equal to 0.
##### 6.2.4.20.2 Test suite files {#test-suite-files-37 .H6}
Test Script: API_2_ENH_GCID_1.scr
Test Applet: API_2_ENH_GCID_1.java
Load Script: API_2_ENH_GCID_1.ldr
Cleanup Script: API_2_ENH_GCID_1.clr
Parameter File: API_2_ENH_GCID_1.par
##### 6.2.4.20.3 Test Procedure {#test-procedure-37 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 0 | 1- Applet1 is | | 2- OPEN CHANNEL | | | installed with | | proactive command | | | maximum number of | | is fetched | | | channel = 07. | | | | | | | TERMINAL RESPONSE | | | 2- Applet1 builds | | is issued with | | | proactive commands | | Channel Id from 01 | | | OPEN CHANNEL with | | to 07 | | | init() method in | | | | | order to open all | | | | | channels. | | | | | | | | | | Proac | | | | | tiveHandler.send() | | | | | methods are | | | | | called. | | | +----+--------------------+--------------------+--------------------+ | 1 | 1- Send envelope | 1- Applet1 is | | | | Event Download | triggered | | | | Channel Status | | | | | with channel | 2- Returns 0x01 | | | | status TLV: | | | | | | | | | | channel status | | | | | value = 0x8100. | | | | | | | | | | 2- Call | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 2 | 1- Send envelope | 2- Returns 0x04 | | | | Event Download | | | | | Channel Status | Returns 0x04 | | | | with two channel | | | | | status TLV: | | | | | | | | | | first value = | | | | | 0x8400 | | | | | | | | | | second value = | | | | | 0x8500. | | | | | | | | | | 2- Call twice the | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 3 | 1- Send envelope | 2- Returns 0x06 | | | | Event Download | | | | | Channel Status | 3- | | | | with channel | GetC | | | | status TLV: | hannelIdentifier() | | | | | =getValueByte(0) | | | | Channel Status | | | | | value = 0x0605 | | | | | | | | | | Vie | | | | | wHandler.FindTLV() | | | | | with Device | | | | | IdentityTag. | | | | | | | | | | 2- Call | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | | | | | | | | 3- Compare | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | and then | | | | | ViewHandle | | | | | r.getValueByte(0). | | | +----+--------------------+--------------------+--------------------+ | 4 | 1- Send envelope | 2- A Toolkit | | | | Menu Selection | exception | | | | without Channel | UN | | | | Status TLV. | AVAILABLE_ELEMENT | | | | | is thrown. | | | | 2- Call | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 5 | 1- Send Envelope | 1- Returns 0x06 | | | | Event Download | | | | | Channel Status | | | | | with Channel | | | | | Status TLV: | | | | | | | | | | Channel status | | | | | value = 0x0600 | | | | | | | | | | 2- Call | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 6 | 1- Send | 2- A Toolkit | | | | unrecognized | exception | | | | envelope with a | OUT_O | | | | Channel Status TLV | F_TLV_BOUNDARIES | | | | having a length | is thrown. | | | | equal to 0. | | | | | | | | | | 2- Call | | | | | En | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+
##### 6.2.4.20.4 Test Coverage {#test-coverage-35 .H6}
CRR number Test case number
* * *
N1 1, 2 N2 3 N3 3 N4 5 C1 4 C2 6
### 6.2.5 Class EnvelopeResponseHandler
#### 6.2.5.1 Method getTheHandler
Test Area Reference: API_2_ERH_GTHD
##### 6.2.5.1.1 Conformance requirement: {#conformance-requirement-25 .H6}
The method with following header shall be compliant to its definition in the
API.
public static EnvelopeResponseHandler getTheHandler()
throws ToolkitException
##### 6.2.5.1.1.1 Normal execution {#normal-execution-38 .H6}
  * CRRN1: The method shall return the single system instance of the > EnvelopeResponseHandler class.
  * CRRN2: The EnvelopeResponseHandler is a Temporary JCRE Entry Point > Object ( see Javacard 2.1 Runtime Environment (JCRE) Specification > [12]).
##### 6.2.5.1.1.1 Parameter errors {#parameter-errors-22 .H6}
No requirements.
##### 6.2.5.1.1.3 Context errors {#context-errors-36 .H6}
  * CRRC1: The method shall thrown ToolkitException > (HANDLER_NOT_AVAILABLE) if the handler is busy.
  * CRRC2: After the first invocation of the ProactiveHandler.send > method the EnvelopeResponseHandler is no more available
##### 6.2.5.1.2 Test suite files {#test-suite-files-38 .H6}
Test Script: API_2_ERH_GTHD_1.scr
Test Applet: API_2_ERH_GTHD_1.java
Load Script: API_2_ERH_GTHD_1.ldr
Cleanup Script: API_2_ERH_GTHD_1.clr
Parameter File: API_2_ERH_GTHD_1.par
##### 6.2.5.1.3 Test procedure {#test-procedure-38 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | getTheHandler | The returned | | | | twice | objects shall be | | | | | the same | | +----+--------------------+--------------------+------------------+ | 2 | Verify that | The reference | | | | getTheHandler | returned shall be | | | | returns an | an | | | | EnvelopeHandler | Envel | | | | | opeResponseHandler | | | | getTheHandler | (checkcast) | | +----+--------------------+--------------------+------------------+ | 3 | Verify the | The reference | | | | returned value is | returned shall not | | | | not null | be null. | | | | | | | | | getTheHandler | | | +----+--------------------+--------------------+------------------+ | 4 | Send a proactive | ToolkitException | | | | command, and then | HANDL | | | | getTheHandler() | ER_NOT_AVAILABLE | | | | | is thrown | | +----+--------------------+--------------------+------------------+
##### 6.2.5.1.4 Test Coverage {#test-coverage-36 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 Checked in Framework tests: FWK_API_HEPO (test case 2) C1
Checked in Framework tests: FWK_MHA_ERHD C2 4
#### 6.2.5.2 Method post
Test Area Reference: API_2_ERH_POSTB
##### 6.2.5.2.1 Conformance requirement {#conformance-requirement-26 .H6}
The method with following header shall be compliant to its definition in the
API.
public void post(byte statusType)
throws ToolkitException
##### 6.2.5.2.1.1 Normal execution {#normal-execution-39 .H6}
  * CRRN1: When the method is called, the toolkit applet can continue > it\'s processing (e.g. prepare a proactive command).
  * CRRN2: The byte statusType is SW1 of the status.
  * CRRN3: If the send method is called after a post method, the posted > data are the first sent to the ME.
  * CRRN4: The SIM Toolkit Framework shall take the optional Application > Data posted by the triggered toolkit applet if present, secure and > send the response packet. The SIM Toolkit Framework will return > the response APDU defined by the toolkit applet.
##### 6.2.5.2.1.2 Parameter error {#parameter-error-1 .H6}
No requirements.
##### 6.2.5.2.1.3 Context errors {#context-errors-37 .H6}
  * CRRC1: The method shall thrown ToolkitException > (HANDLER_NOT_AVAILABLE) if the handler is busy.
##### 6.2.5.2.2 Test suite files {#test-suite-files-39 .H6}
Specific triggering: Unformatted SMS PP Env and Call control
Test Script: API_2_ERH_POSTB_1.scr
Test Applet: API_2_ERH_POSTB_1.java
Load Script: API_2_ERH_POSTB_1.ldr
Cleanup Script: API_2_ERH_POSTB_1.clr
Parameter File: API_2_ERH_POSTB_1.par
##### 6.2.5.2.3 Test procedure {#test-procedure-39 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | | Call Control | | | | | Triggering | | | +----+--------------------+--------------------+--------------------+ | 1 | getTheHandler and | | 9000 | | | then post | | | | | | | | | | (the handler is | | | | | empty) | | | +----+--------------------+--------------------+--------------------+ | 2 | **Fill the handler | | 9FFD data are | | | ( appendTLV to | | retrieved with GET | | | have** bytes in it | | RESPONSE command | | | )and then post | | | | | data with status | | | | | 9F | | | +----+--------------------+--------------------+--------------------+ | 3 | Verify that after | ToolkitException | | | | a post the handler | HANDL | | | | is no more | ER_NOT_AVAILABLE | | | | available | is thrown on the | | | | | second appendTLV | | | | appendTLV, post | | | | | and then appendTLV | | | +----+--------------------+--------------------+--------------------+ | | Unformatted SMS PP | | | | | Env triggering | | | +----+--------------------+--------------------+--------------------+ | 4 | construct the | | 9E12 and posted | | | response | | data retrieved by | | | (appendTLV with | | a GET RESPONSE | | | 0x10 data) and | | with status 9113 | | | post it with | | and display text | | | status 9E and then | | retrieved by a | | | send a display | | FETCH | | | text | | | +----+--------------------+--------------------+--------------------+ | 5 | Verify that it is | | 91 13 and display | | | possible to send a | | text is retrieved | | | proactive command | | by a FETCH | | | after a post | | | | | | | | | | getTheHandler and | | | | | post , then send a | | | | | display text | | | +----+--------------------+--------------------+--------------------+ | 6 | Verify it is not | ToolkitException | | | | possible to post | HANDL | | | | after a proactive | ER_NOT_AVAILABLE | | | | command | is thrown | | | | | | | | | getTheHandler, | | | | | appendTLV, send a | | | | | display text, | | | | | post. | | | +----+--------------------+--------------------+--------------------+ | 7 | Verify that the | ToolkitException | 9E12 and posted | | | handler is no more | HANDL | data retrieved by | | | available after a | ER_NOT_AVAILABLE | a GET RESPONSE | | | post | is thrown | | | | | | | | | getTheHandler, | | | | | appendTLV, post | | | | | with status 9E, | | | | | post with status | | | | | 9F | | | +----+--------------------+--------------------+--------------------+
##### 6.2.5.2.4 Test Coverage {#test-coverage-37 .H6}
CRR number Test case number
* * *
N1 3, 4, 7 N2 1, 2, 4, 7 N3 4, 5 N4 Checked in Framework tests: FWK_FWS_OUDA
C1 6
#### 6.2.5.3 Method postAsBERTLV
Test Area Reference:API_2_ERH_POSTBB
##### 6.2.5.3.1 Conformance Requirement {#conformance-requirement-27 .H6}
The method with following header shall be compliant to its definition in the
API.
public void postAsBERTLV(byte statusType,
byte tag)
throws ToolkitException
##### 6.2.5.3.1.1 Normal execution {#normal-execution-40 .H6}
  * CRRN1: When the method is called, the toolkit applet can continue > it\'s processing (e.g. prepare a proactive command) the SIM > Toolkit Framework will return the response APDU defined by the > toolkit applet.
  * CRRN2: The byte statusType is SW1 of the status
  * CRRN3: If the send method is called after a postAsBERTLV method, the > posted data are the first sent to the ME.
  * CRRN4: The byte tag is the BER Tag at the beginning of the simple > TLV list.
##### 6.2.5.3.1.2 Parameter errors {#parameter-errors-23 .H6}
No requirements.
##### 6.2.5.3.1.3 Context errors {#context-errors-38 .H6}
  * CRRC1: The method shall thrown ToolkitException > (HANDLER_NOT_AVAILABLE) if the handler is busy.
##### 6.2.5.3.2 Test suite files {#test-suite-files-40 .H6}
Specific triggering: Unformatted SMS PP Env and Call control
Test Script: API_2_ERH_POSTBB_1.scr
Test Applet: API_2_ERH_POSTBB_1.java
Load Script: API_2_ERH_POSTBB_1.ldr
Cleanup Script: API_2_ERH_POSTBB_1.clr
Parameter File: API_2_ERH_POSTBB_1.par
##### 6.2.5.3.3 Test procedure {#test-procedure-40 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | | Call Control | | | | | triggering | | | +----+--------------------+--------------------+--------------------+ | 1 | getTheHandler and | | 9F02 data are | | | then postAsBERTLV | | retrieved with GET | | | | | RESPONSE command, | | | (the handler is | | the tag shall be | | | empty) | | 33 and the length | | | | | is 00 | +----+--------------------+--------------------+--------------------+ | 2 | Fill the handler | | 9FFF data are | | | and then | | retrieved with GET | | | postAsBERTLV the | | RESPONSE command, | | | data with status | | the tag shall be | | | 9F, and tag 33 | | 33 | +----+--------------------+--------------------+--------------------+ | 3 | appendTLV, | ToolkitException | | | | postAsBERTLV and | HANDL | | | | then appendTLV | ER_NOT_AVAILABLE | | | | | is thrown on the | | | | | second appendTLV | | +----+--------------------+--------------------+--------------------+ | | Unformatted SMS PP | | | | | Env triggering | | | +----+--------------------+--------------------+--------------------+ | 4 | construct the | | 9E14 and posted | | | response | | data retrieved by | | | (appendTLV with | | a GET RESPONSE the | | | 0x10 data) and | | tag shall be 75 | | | postAsBERTLV it | | with status 9113 | | | with status 9E, | | and display text | | | tag 75 and then | | retrieved by a | | | send a display | | FETCH | | | text | | | +----+--------------------+--------------------+--------------------+ | 5 | getTheHandler and | | 9E02 and posted | | | postAsBERTLV, then | | data retrieved by | | | send a display | | a GET RESPONSE the | | | text | | tag 33 (and the | | | | | length 00) with | | | | | status 9113 and | | | | | display text is | | | | | retrieved by a | | | | | FETCH | +----+--------------------+--------------------+--------------------+ | 6 | Verify it is not | ToolkitException | | | | possible to | HANDL | | | | postAsBERTLV after | ER_NOT_AVAILABLE | | | | a proactive | is thrown on the | | | | command | postAsBERTLV | | | | | | | | | getTheHandler, | | | | | appendTLV, send a | | | | | display text, | | | | | postAsBERTLV. | | | +----+--------------------+--------------------+--------------------+ | 7 | Verify that the | ToolkitException | 9E14 and posted | | | handler is no more | HANDL | data retrieved by | | | available after a | ER_NOT_AVAILABLE | a GET RESPONSE the | | | postAsBERTLV | is thrown on the | tag shall be 56 | | | | second | with status 9000 | | | getTheHandler, | postAsBERTLV | | | | appendTLV(with | | | | | data length = | | | | | 0x10, postAsBERTLV | | | | | with status 9E, | | | | | tag 56, | | | | | postAsBERTLV with | | | | | status 9F, tag 28 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.5.3.4 Test Coverage {#test-coverage-38 .H6}
CRR number Test case number
* * *
N1 3, 4, 7 N2 1, 2, 4, 7 N3 4, 5 N4 2, 4, 7 C1 6
#### 6.2.5.4 Method getLength
Test Area Reference: API_2_ERH_GLEN
##### 6.2.5.4.1 Conformance requirement {#conformance-requirement-28 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getLength()
throws ToolkitException
##### 6.2.5.4.1.1 Normal execution {#normal-execution-41 .H6}
  * CRRN1: returns the length in bytes of the TLV list.
##### 6.2.5.4.1.2 Parameter errors {#parameter-errors-24 .H6}
No requirements.
##### 6.2.5.4.1.3 Context errors {#context-errors-39 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.4.2 Test Suite files {#test-suite-files-41 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_GLEN_1.scr
Test Applet: API_2_ERH_GLEN_1.java
Load Script: API_2_ERH_GLEN_1.ldr
Cleanup Script: API_2_ERH_GLEN_1.clr
Parameter File: API_2_ERH_GLEN_1.par
##### 6.2.5.4.3 Test procedure {#test-procedure-41 .H6}
+----------------+----------------+----------------+----------------+ | Id | Description | API | APDU | | | | Expectation | Expectation | +================+================+================+================+ | 1 | Clear the | Result of | | | | handler | getLength() is | | | | | 0 | | | | getLength() | | | +----------------+----------------+----------------+----------------+ | 2 | appendTLV with | Result of | | | | length of 7 | getLength() is | | | | | 9 | | | | getLength() | | | +----------------+----------------+----------------+----------------+ | 3 | Clear the | Result of | | | | handler and | getLength() is | | | | appendTLV with | 253 | | | | Length of 250 | | | | | | | | | | getLength() | | | +----------------+----------------+----------------+----------------+ | 4 | Build a 7Fh | Result of | | | | Envelope | getLength() is | | | | response | 81h | | | | handler | | | | | | | | | | getLength() | | | +----------------+----------------+----------------+----------------+ | 5 | Build a 80h | Result of | | | | Envelope | getLength() is | | | | response | 83h | | | | handler | | | | | | | | | | getLength() | | | +----------------+----------------+----------------+----------------+ | 6 | Call the | A toolkit | | | | post() method | Exception with | | | | | HANDLER_ | | | | getLength() | NOT_AVAILABLE | | | | | reason is | | | | | thrown. | | +----------------+----------------+----------------+----------------+ | NOTE: Test | | | | | case 3 is | | | | | limited to 253 | | | | | and not 256 | | | | | because the | | | | | current 3GPP | | | | | TS 43.019 | | | | | [7] is not | | | | | clear enough | | | | | on this point. | | | | | So this test | | | | | allows the two | | | | | possible | | | | | im | | | | | plementations. | | | | +----------------+----------------+----------------+----------------+
##### 6.2.5.4.4 Test Coverage {#test-coverage-39 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4, 5 C1 6
#### 6.2.5.5 Method copy
Test Area Reference: API_2_ERH_COPY_BSS
##### 6.2.5.5.1 Conformance requirement {#conformance-requirement-29 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copy(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.5.1.1 Normal execution {#normal-execution-42 .H6}
  * CRRN1: copies the simple TLV list contained in the handler to the > destination byte array.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.5.5.1.2 Parameter errors {#parameter-errors-25 .H6}
  * CRRP1: if dstBuffer is null a NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative, an > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if dstLength is greater than the length of the simple TLV > List, an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 6.2.5.5.1.3 Context errors {#context-errors-40 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.5.2 Test Suite files {#test-suite-files-42 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_COPY_BSS_1.scr
Test Applet: API_2_ERH_COPY_BSS_1.java
Load Script: API_2_ERH_COPY_BSS_1.ldr
Cleanup Script: API_2_ERH_COPY_BSS_1.clr
Parameter File: API_2_ERH_COPY_BSS_1.par
##### 6.2.5.5.3 Test procedure {#test-procedure-42 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | appendTLV with | Nu | | | | value length of 7 | llPointerException | | | | | is thrown | | | | NULL as parameter | | | | | to dstBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | | | | +----+--------------------+--------------------+------------------+ | | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ | Toolk | | | | length of the | itException.OUT_O | | | | simple TLV list | F_TLV_BOUNDARIES | | | | | is thrown | | | | dstBuffer.length = | | | | | 10 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 10 | | | +----+--------------------+--------------------+------------------+ | 8 | Successful call, | Result of copy() | | | | dstBuffer is the | is 9 | | | | whole buffer | | | | | | | | | | dstBuffer.length = | | | | | 9 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 9 | | | +----+--------------------+--------------------+------------------+ | 9 | Compare the buffer | Result of | | | | | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 10 | Successful call, | Result of copy() | | | | dstBuffer is part | is 12 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 9 | | | +----+--------------------+--------------------+------------------+ | 11 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 12 | Successful call, | Result of copy() | | | | dstBuffer is part | is 9 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 14 | Successful call, | Result of copy() | | | | copy with length | is 15 | | | | =0 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 15 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 15 | Call the post() | A toolkit | | | | method | Exception with | | | | | HANDL | | | | Call copy(): | ER_NOT_AVAILABLE | | | | | reason is thrown. | | | | dstBuffer.length = | | | | | 10 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.5.4 Test Coverage {#test-coverage-40 .H6}
CRR number Test case number
* * *
N1 9, 11, 13 N2 8, 10, 12, 14 P1 1 P2 2, 3, 4, 5, 6 P3 7 C1 15
#### 6.2.5.6 Method findTLV
Test Area Reference: API_2_ERH_FINDBB
##### 6.2.5.6.1 Conformance requirement {#conformance-requirement-30 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findTLV(byte tag, byte occurrence)
throws ToolkitException
##### 6.2.5.6.1.1 Normal execution {#normal-execution-43 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of the
TLV list (handler buffer):
  * CRRN1: the method is successful if the required occurrence exists > then the corresponding TLV becomes current.
  * CRRN2: if the method is successful then it returns > TLV_FOUND_CR_SET when Comprehension Required flag is set.
  * CRRN3: if the method is successful then it returns > TLV_FOUND_CR_NOT_SET when Comprehension Required flag is not > set.
  * CRRN4: if the required occurrence of the TLV element does not exist, > the current TLV is no longer defined and TLV_NOT_FOUND is > returned.
  * CRRN5: The search method is comprehension required flag independent.
##### 6.2.5.6.1.2 Parameter errors {#parameter-errors-26 .H6}
  * CRRP1: if an input parameter is not valid (e.g. occurrence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException.BAD_INPUT_PARAMETER.
##### 6.2.5.6.1.3 Context errors {#context-errors-41 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.6.2 Test Suite files {#test-suite-files-43 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_FINDBB_1.scr
Test Applet: API_2_ERH_FINDBB_1.java
Load Script: API_2_ERH_FINDBB_1.ldr
Cleanup Script: API_2_ERH_FINDBB_1.clr
Parameter File: API_2_ERH_FINDBB_1.par
##### 6.2.5.6.3 Test procedure {#test-procedure-43 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | append the handler | | | | | with TLVs: | | | | | | | | | | 81 03 11 22 33 | | | | | | | | | | 82 02 99 77 | | | +----+--------------------+--------------------+------------------+ | | Invalid input | To | | | | parameter | olkitException.BAD | | | | | _INPUT_PARAMETER | | | | Occurrence = 0 | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | | | | +----+--------------------+--------------------+------------------+ | | Search 1^st^ TLV | Result is | | | | | T | | | | Tag = 01h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | Call the | Result is 03h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 4 | Search 2^nd^ TLV | Result is | | | | | T | | | | Tag = 02h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 5 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | Search a wrong tag | Result is | | | | | TLV_NOT_FOUND | | | | Tag = 03h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Search a tag with | Result is | | | | wrong occurrence | TLV_NOT_FOUND | | | | | | | | | Tag = 01h | | | | | | | | | | Occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 9 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 10 | Append a TLV with | | | | | tag=02h | | | +----+--------------------+--------------------+------------------+ | | Search the TLV | Result is | | | | | TLV_F | | | | Tag = 02h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 11 | Append a TLV with | | | | | tag=04h | | | +----+--------------------+--------------------+------------------+ | | Search the TLV | Result is | | | | | TLV_F | | | | Tag = 04h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 12 | Search tag 81h | Result is | | | | | T | | | | Tag = 81h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 13 | Search tag 84h | Result is | | | | | TLV_F | | | | Tag = 84h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 14 | Call the post() | A toolkit | | | | method then Search | Exception with | | | | 1^st^ TLV | HANDL | | | | | ER_NOT_AVAILABLE | | | | Tag = 81h | reason is thrown. | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.6.4 Test Coverage {#test-coverage-41 .H6}
CRR number Test case number
* * *
N1 3, 5 N2 2, 4 N3 10, 11 N4 6, 7,8, 9 N5 12, 13 P1 1 C1 14
#### 6.2.5.7 Method getValueLength
Test Area Reference: API_2_ERH_GVLE
##### 6.2.5.7.1 Conformance requirement {#conformance-requirement-31 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getValueLength()
throws ToolkitException
##### 6.2.5.7.1.1 Normal execution {#normal-execution-44 .H6}
  * CRRN1: gets and returns the binary length of the value field for the > last TLV element which has been found in the handler.
##### 6.2.5.7.1.2 Parameter errors {#parameter-errors-27 .H6}
No requirements.
##### 6.2.5.7.1.3 Context errors {#context-errors-42 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException.UNAVAILABLE_ELEMENT.
##### 6.2.5.7.2 Test Suite files {#test-suite-files-44 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_GVLE_1.scr
Test Applet: API_2_ERH_GVLE_1.java
Load Script: API_2_ERH_GVLE_1.ldr
Cleanup Script: API_2_ERH_GVLE_1.clr
Parameter File: API_2_ERH_GVLE_1.par
##### 6.2.5.7.3 Test procedure {#test-procedure-44 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | appendTLV 02 02 02 | | | | | 02 | | | | | | | | | | findTLV with TAG | | | | | 03 | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | appendTLV with TAG | | | | | 0D and length 00 | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 00h | | +----+--------------------+--------------------+------------------+ | 3 | Clear the handler | | | | | and append TLV | | | | | with TAG 0D and | | | | | length 02 | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 02h | | +----+--------------------+--------------------+------------------+ | 4 | Clear the handler | | | | | and append TLV | | | | | with TAG 0D and | | | | | length 0x7F | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 7Fh | | +----+--------------------+--------------------+------------------+ | 5 | Clear the handler | | | | | and append TLV | | | | | with TAG 0D and | | | | | length 0x80 | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 80h | | +----+--------------------+--------------------+------------------+ | 6 | Clear the handler | | | | | and append TLV | | | | | with TAG 0D and | | | | | length 0xF1 | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is F1h | | +----+--------------------+--------------------+------------------+ | 7 | Call the post() | A toolkit | | | | method | Exception with | | | | | HANDL | | | | getValueLength() | ER_NOT_AVAILABLE | | | | | reason is thrown. | | +----+--------------------+--------------------+------------------+
##### 6.2.5.7.4 Test Coverage {#test-coverage-42 .H6}
CRR number Test case number
* * *
N1 2, 3, 4, 5, 6 C1 7 C2 1
#### 6.2.5.8 Method getValueByte
Test Area Reference: API_2_ERH_GVBYS
##### 6.2.5.8.1 Conformance requirement {#conformance-requirement-32 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getValueByte(short valueOffset)
throws ToolkitException
##### 6.2.5.8.1.1 Normal execution {#normal-execution-45 .H6}
  * CRRN1: Gets a byte from the last TLV element which has been found in > the handler and returns its value (1 byte).
##### 6.2.5.8.1.2 Parameter errors {#parameter-errors-28 .H6}
  * CRRP1: if valueOffset is out of the current TLV an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 6.2.5.8.1.3 Context errors {#context-errors-43 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException.UNAVAILABLE_ELEMENT.
##### 6.2.5.8.2 Test Suite files {#test-suite-files-45 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_GVBYS_1.scr
Test Applet: API_2_ERH_GVBYS_1.java
Load Script: API_2_ERH_GVBYS_1.ldr
Cleanup Script: API_2_ERH_GVBYS_1.clr
Parameter File: API_2_ERH_GVBYS_1.par
##### 6.2.5.8.3 Test procedure {#test-procedure-45 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | appendTLV 82 02 81 | | | | | 82, appendTLV 81 | | | | | 03 11 22 FE | | | | | | | | | | findTLV with TAG | | | | | 03 | | | +----+--------------------+--------------------+------------------+ | | getValueByte(0x00) | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 01h | | | +----+--------------------+--------------------+------------------+ | | getValueByte(0x03) | Toolk | | | | | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 3 | Search TLV 01h | | | +----+--------------------+--------------------+------------------+ | | getValueByte(0x02) | Result is FEh | | +----+--------------------+--------------------+------------------+ | 4 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | getValueByte(0x00) | Result is 81h | | +----+--------------------+--------------------+------------------+ | 5 | appendTLV with TAG | | | | | 0D, Length 0x7E, | | | | | Value: 00, 01, | | | | | ..., 7D | | | +----+--------------------+--------------------+------------------+ | | g | Result is 7Dh | | | | etValueByte(0x07D) | | | +----+--------------------+--------------------+------------------+ | 6 | clear the handler, | | | | | appendTLV with TAG | | | | | 0D, Length 0x80, | | | | | Value: 00, 01, | | | | | ..., 7F | | | +----+--------------------+--------------------+------------------+ | | g | Result is 7Eh | | | | etValueByte(0x07E) | | | +----+--------------------+--------------------+------------------+ | 7 | g | Result is 7Fh | | | | etValueByte(0x07F) | | | +----+--------------------+--------------------+------------------+ | 8 | clear the handler, | | | | | appendTLV with TAG | | | | | 0D, Length 0xF1, | | | | | Value: 00, 01, | | | | | ..., F0 | | | +----+--------------------+--------------------+------------------+ | | g | Result is F0h | | | | etValueByte(0x0F0) | | | +----+--------------------+--------------------+------------------+ | 9 | Call the post() | A toolkit | | | | method | Exception with | | | | | HANDL | | | | getValueByte(0) | ER_NOT_AVAILABLE | | | | | reason is thrown. | | +----+--------------------+--------------------+------------------+
##### 6.2.5.8.4 Test Coverage {#test-coverage-43 .H6}
CRR number Test case number
* * *
N1 3, 4, 5, 6, 7, 8 P1 2 C1 9 C2 1
#### 6.2.5.9 Method copyValue
Test Area Reference: API_2_ERH_CPYVS_BSS
##### 6.2.5.9.1 Conformance requirement {#conformance-requirement-33 .H6}
The method with following header shall be compliant with its definition in the
API.
public short copyValue(short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.9.1.1 Normal execution {#normal-execution-46 .H6}
  * CRRN1: copies a part of the last TLV element which has been found, > into a destination. buffer.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.5.9.1.2 Parameter errors {#parameter-errors-29 .H6}
  * CRRP1: if dstBuffer is null NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 6.2.5.9.1.3 Context errors {#context-errors-44 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException.UNAVAILABLE_ELEMENT.
##### 6.2.5.9.2 Test Suite files {#test-suite-files-46 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_CPYVS_BSS_1.scr
Test Applet: API_2_ERH_CPYVS_BSS_1.java
Load Script: API_2_ERH_CPYVS_BSS_1.ldr
Cleanup Script: API_2_ERH_CPYVS_BSS_1.clr
Parameter File: API_2_ERH_CPYVS_BSS_1.par
##### 6.2.5.9.3 Test procedure {#test-procedure-46 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | appendTLV with | | | | | TAG: 0D and length | | | | | 16 | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | copyValue() with a | Nu | | | | null dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | | | | +----+--------------------+--------------------+------------------+ | | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ Text | Toolk | | | | String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | copyValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | clear the handler, | | | | | appendTLV with | | | | | TAG: 0D and value: | | | | | 04 00 01 ... 0F | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is 17 | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 14 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is 15 | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 12 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 16 | Successful call, | Result of | | | | copyValue with | copyValue() is 20 | | | | length =0 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 20 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Call post() method | A toolkit | | | | then copyValue() | Exception with | | | | | HANDL | | | | dstBuffer.length = | ER_NOT_AVAILABLE | | | | 20 | reason is thrown. | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.9.4 Test Coverage {#test-coverage-44 .H6}
CRR number Test case number
* * *
N1 13, 15 N2 12, 14, 16 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 17 C2 11
#### 6.2.5.10 Method compareValue
Test Area Reference: API_2_ERH_CPRVS_BSS
##### 6.2.5.10.1 Conformance requirement {#conformance-requirement-34 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte compareValue(short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.10.1.1 Normal execution {#normal-execution-47 .H6}
Compares the last found TLV element with a buffer:
  * CRRN1: returns 0 if identical.
  * CRRN2: returns -1 if the first miscomparing byte in simple TLV List > is less than that in compareBuffer.
  * CRRN3: returns 1 if the first miscomparing byte in simple TLV List > is greater than that in compareBuffer.
##### 6.2.5.10.1.2 Parameter errors {#parameter-errors-30 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 6.2.5.10.1.3 Context errors {#context-errors-45 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException.UNAVAILABLE_ELEMENT.
##### 6.2.5.10.2 Test Suite files {#test-suite-files-47 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_CPRVS_BSS_1.scr
Test Applet: API_2_ERH_CPRVS_BSS_1.java
Load Script: API_2_ERH_CPRVS_BSS_1.ldr
Cleanup Script: API_2_ERH_CPRVS_BSS_1.clr
Parameter File: API_2_ERH_CPRVS_BSS_1.par
##### 6.2.5.10.3 Test procedure {#test-procedure-47 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | appendTLV with | | | | | TAG: 0D and length | | | | | 16 | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | compareValue() | Nu | | | | with a null | llPointerException | | | | compareBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | | | | +----+--------------------+--------------------+------------------+ | | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 5 | | | | | | | | | | compareLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | Text String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Text String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise the | T | | | | handler | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | compareValue() | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | appendTLV with | Result is 00h | | | | TAG: 0D and value: | | | | | 04 00 01 ... 0F | | | | | | | | | | Select Text String | | | | | TLV | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | | | | | | | | Compare buffers | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 02 03 | | | | | | | | | | 04 05 06 07 08 | | | | | | | | | | 05 0A 0B 0C 0D | | | | | | | | | | 0E 10 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | Result is +1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 15 | Initialise | Result is 00h | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | Compare buffers | | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 12 | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 02 01 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | Result is +1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0A 0D | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | Successful call, | Result of | | | | compareValue with | compareValue() is | | | | length =0 | 0 | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 15 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+ | 19 | Call post() method | A toolkit | | | | then | Exception with | | | | compareValue() | HANDL | | | | | ER_NOT_AVAILABLE | | | | co | reason is thrown. | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.10.4 Test Coverage {#test-coverage-45 .H6}
CRR number Test case number
* * *
N1 12, 15, 18 N2 13, 16 N3 14, 17 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 19
C2 11
#### 6.2.5.11 Method findAndCopyValue(byte tag, byte[] dstBuffer, short
valueOffset)
Test Area Reference: API_2_ERH_FACYB_BS
##### 6.2.5.11.1 Conformance requirement {#conformance-requirement-35 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte[] dstBuffer,
short dstOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.11.1.1 Normal execution {#normal-execution-48 .H6}
  * CRRN1: looks for the first occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + length of the copied value is > returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.5.11.1.2 Parameter errors {#parameter-errors-31 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.5.11.1.3 Context errors {#context-errors-46 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.11.2 Test Suite files {#test-suite-files-48 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_FACYB_BS_1.scr
Test Applet: API_2_ERH_FACYB_BS_1.java
Load Script: API_2_ERH_FACYB_BS_1.ldr
Cleanup Script: API_2_ERH_FACYB_BS_1.clr
Parameter File: API_2_ERH_FACYB_BS_1.par
##### 6.2.5.11.3 Test procedure {#test-procedure-48 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | appendTLV with | | | | | TAG: 0D and length | | | | | 16 | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 0Dh | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 20 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 5 | | | +----+--------------------+--------------------+------------------+ | 5 | length > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 6 | clear the handler, | T | | | | appendTLV with TAG | oolkitException.UN | | | | 02 and Length 02 | AVAILABLE_ELEMENT | | | | | is thrown | | | | Select a TLV (tag | | | | | 02h) | T | | | | | oolkitException.UN | | | | findAndCopyValue() | AVAILABLE_ELEMENT | | | | | is thrown. | | | | tag = 03h | | | | | | | | | | Call the | | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 7 | appendTLV with | Result of | | | | TAG: 0D and value: | findAndCopyValue() | | | | 04 00 01 ... 0F | is 17 | | | | | | | | | Successful call | | | | | | | | | | Tag = 0Dh | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 9 | initialise | Result of | | | | dstBuffer | findAndCopyValue() | | | | | is 19 | | | | dstBuffer = 55 55 | | | | | ... 55 | | | | | | | | | | Successful call | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 10 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+------------------+ | 11 | clear the handler, | Result of | | | | appendTLV with | findAndCopyValue() | | | | TAG: 0D and value: | is 17 | | | | 04 00 01 ... 0F | | | | | | | | | | append a 2^nd^ | | | | | Text String TLV | | | | | | | | | | Successful call | | | | | | | | | | tag = 0Dh | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 12 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 13 | clear the handler, | Result of | | | | appendTLV with | findAndCopyValue() | | | | TAG: 0D and value: | is 17 | | | | 04 00 01 ... 0F | | | | | | | | | | Successful call | | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 14 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 15 | Append tag 0Fh | Result of | | | | | findAndCopyValue() | | | | buffer = 00 01 ... | is 16 | | | | 0F | | | | | | | | | | Successful call | | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh | | | | | | | | | | dstBuffer.length = | | | | | 16 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 16 | Compare buffer | Result is 00h | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | 17 | Call post() method | A toolkit | | | | then | Exception with | | | | findAndCopyValue() | HANDL | | | | | ER_NOT_AVAILABLE | | | | tag = 8Fh | reason is thrown. | | | | | | | | | dstBuffer.length = | | | | | 0 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.11.4 Test Coverage {#test-coverage-46 .H6}
CRR number Test case number
* * *
N1 8, 10, 12 N2 6 N3 7, 9, 11 N4 13, 14, 15, 16 P1 1 P2 2, 3, 4, 5 C1 17
#### 6.2.5.12 Method findAndCopyValue(byte tag, byte occurrence, short
valueOffset, byte[] dstBuffer, short dstOffset, short dstLength)
Test Area Reference: API_2_ERH_FACYBBS_BSS
##### 6.2.5.12.1 Conformance requirement {#conformance-requirement-36 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte occurrence,
short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.12.1.1 Normal execution {#normal-execution-49 .H6}
  * CRRN1: looks for the indicated occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + dstLength is returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.5.12.1.2 Parameter errors {#parameter-errors-32 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 6.2.5.12.1.3 Context errors {#context-errors-47 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.12.2 Test Suite files {#test-suite-files-49 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_FACYBBS_BSS_1.scr
Test Applet: API_2_ERH_FACYBBS_BSS_1.java
Load Script: API_2_ERH_FACYBBS_BSS_1.ldr
Cleanup Script: API_2_ERH_FACYBBS_BSS_1.clr
Parameter File: API_2_ERH_FACYBBS_BSS_1.par
##### 6.2.5.12.3 Test procedure {#test-procedure-49 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | Nu | | | | handler | llPointerException | | | | | is thrown | | | | findAndCopyValue() | | | | | with a null | | | | | dstBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | appendTLV with | ArrayIndexOu | | | | TAG: 0D and length | tOfBoundsException | | | | 16 | is thrown | | | | | | | | | dstOffset ≥ | | | | | dstBuffer.length | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ Text | Toolk | | | | String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | clear the handler, | T | | | | appendTLV with TAG | oolkitException.UN | | | | 02 and Length 02 | AVAILABLE_ELEMENT | | | | | is thrown | | | | Select a TLV (tag | | | | | 02h) | T | | | | | oolkitException.UN | | | | findAndCopyValue() | AVAILABLE_ELEMENT | | | | | is thrown. | | | | tag = 0Dh | | | | | | | | | | occurrence = 2 | | | | | | | | | | Call the | | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 12 | clear the handler | Result of | | | | and appendTLV with | findAndCopyValue() | | | | TAG: 0D and value: | is 17 | | | | 04 00 01 ... 0F | | | | | | | | | | Successful call | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 14 | initialise | Result of | | | | dstBuffer | findAndCopyValue() | | | | | is 15 | | | | dstBuffer = 55 55 | | | | | ... 55 | | | | | | | | | | Successful call | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 12 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 16 | Append a Text | Result of | | | | String TLV | findAndCopyValue() | | | | | is 17 | | | | tag = 0D | | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 (no | | | | | specific DCS byte) | | | | | | | | | | Successful call | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 17 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 18 | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 0Dh, | is 6 | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 19 | Compare buffer | Result is 00h | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 | | | +----+--------------------+--------------------+------------------+ | 20 | clear the handler | Result of | | | | and appendTLV with | findAndCopyValue | | | | TAG: 0D and value: | () is 17 | | | | 04 00 01 ... 0F | | | | | | | | | | Successful call | | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh | | | | | | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 21 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 22 | Append tag 0Fh | Result of | | | | | findAndCopyValue | | | | buffer = 00 01 ... | () is 16 | | | | 0F | | | | | | | | | | Successful call | | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh | | | | | | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 16 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 16 | | | +----+--------------------+--------------------+------------------+ | 23 | Compare buffer | Result is 00h | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | 24 | Successful call, | Result of | | | | findAndCopyValue | findAndCopyValue | | | | with length =0 | () is 16 | | | | | | | | | dstBuffer.length = | | | | | 16 | | | | | | | | | | dstOffset = 16 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 25 | Call post() method | A toolkit | | | | then | Exception with | | | | findAndCopyValue() | HANDL | | | | | ER_NOT_AVAILABLE | | | | dstBuffer.length = | reason is thrown. | | | | 16 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.12.4 Test Coverage {#test-coverage-47 .H6}
CRR number Test case number
* * *
N1 13, 15, 17, 19 N2 11 N3 12, 14, 16, 18, 24 N4 20, 21, 22, 23 P1 1 P2 2, 3,
4, 5, 6 P3 7, 8, 9, 10 C1 25
#### 6.2.5.13 Method findAndCompareValue(byte tag, byte[] compareBuffer, short
compareOffset)
Test Area Reference: API_2_ERH_FACRB_BS
##### 6.2.5.13.1 Conformance requirement {#conformance-requirement-37 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte[] compareBuffer,
short compareOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.13.1.1 Normal execution {#normal-execution-50 .H6}
Looks for the first occurrence of a TLV element from beginning of a TLV list
and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical returns 0.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer returns -1.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer returns 1.
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.5.13.1.2 Parameter errors {#parameter-errors-33 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.5.13.1.3 Context errors {#context-errors-48 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.13.2 Test Suite files {#test-suite-files-50 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_FACRB_BS_1.scr
Test Applet: API_2_ERH_FACRB_BS_1.java
Load Script: API_2_ERH_FACRB_BS_1.ldr
Cleanup Script: API_2_ERH_FACRB_BS_1.clr
Parameter File: API_2_ERH_FACRB_BS_1.par
##### 6.2.5.13.3 Test procedure {#test-procedure-50 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | appendTLV with | Nu | | | | TAG: 0D and length | llPointerException | | | | 16 | is thrown | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | with a null | | | | | dstBuffer and tag | | | | | 0Dh | | | +----+--------------------+--------------------+------------------+ | 2 | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 0Dh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 20 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \ | tOfBoundsException | | | | co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 5 | | | +----+--------------------+--------------------+------------------+ | 5 | length > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 6 | clear the handler, | T | | | | appendTLV with TAG | oolkitException.UN | | | | 02 and Length 02 | AVAILABLE_ELEMENT | | | | | is thrown | | | | Select a TLV (tag | | | | | 02h) | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 03h | | | +----+--------------------+--------------------+------------------+ | 7 | Verify current TLV | T | | | | | oolkitException.UN | | | | getValueLength() | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | clear the handler | Result is 00h | | | | and appendTLV with | | | | | TAG: 0D and value: | | | | | 04 00 01 ... 0F | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | | | | | | | | Compare buffers | | | | | | | | | | tag = 0Dh | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 9 | Verify current TLV | Result is 17 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 10 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise | Result is +1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 12 | Initialise | Result is 00h | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | | | | | | | | Compare buffers | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | append a Text | Result is 00h | | | | String TLV | | | | | | | | | | tag = 0Dh | | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | | | | | | | | Compare buffers | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 01 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | | | | | | | | Compare buffers | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 15 | Initialise | Result is +1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0D 10 55 | | | | | | | | | | Compare buffers | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 16 | clear the handler | Result is 00h | | | | and appendTLV with | | | | | TAG: 0D and value: | | | | | 04 00 01 ... 0F | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 04 | | | | | 00 01 ... 0F | | | | | | | | | | Successful call | | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 17 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Append tag 0Fh | Result is 00h | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 00 | | | | | 01 ... 0F | | | | | | | | | | Successful call | | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 18 | Call post() method | A toolkit | | | | then | Exception with | | | | fin | HANDL | | | | dAndCompareValue() | ER_NOT_AVAILABLE | | | | | reason is thrown. | | | | tag = 8Fh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 0 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.13.4 Test Coverage {#test-coverage-48 .H6}
CRR number Test case number
* * *
N1 6,7 N2 7,9 N3 8, 13, 12 N4 10, 14 N5 11, 15 N6 17, 16 P1 1 P2 2, 3, 4, 5 C1
18
#### 6.2.5.14 Method findAndCompareValue(byte tag, byte occurrence, short
valueOffset, byte[] compareBuffer, short compareOffset, short compareLength)
Test Area Reference: API_2_ERH_FACRBBS_BSS
##### 6.2.5.14.1 Conformance requirement {#conformance-requirement-38 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte occurrence,
short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.14.1.1 Normal execution {#normal-execution-51 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of a
TLV list and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical 0 is returned.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer -1 is returned.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer 1 is returned
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.5.14.1.2 Parameter errors {#parameter-errors-34 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, compareLength or both are out of the current > TLV an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException.OUT_OF_TLV_BOUNDARIES.
  * CRRP4: if an input parameter is not valid (e.g. occurrence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException.BAD_INPUT_PARAMETER.
##### 6.2.5.14.1.3 Context errors {#context-errors-49 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.5.14.2 Test Suite files {#test-suite-files-51 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_FACRBBS_BSS_1.scr
Test Applet: API_2_ERH_FACRBBS_BSS_1.java
Load Script: API_2_ERH_FACRBBS_BSS_1.ldr
Cleanup Script: API_2_ERH_FACRBBS_BSS_1.clr
Parameter File: API_2_ERH_FACRBBS_BSS_1.par
##### 6.2.5.14.3 Test procedure {#test-procedure-51 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | Nu | | | | handler | llPointerException | | | | | is thrown | | | | fin | | | | | dAndCompareValue() | | | | | with a null | | | | | compareBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | clear the handler | ArrayIndexOu | | | | and appendTLV with | tOfBoundsException | | | | TAG: 0D and value: | is thrown | | | | 04 00 01 ... 0F | | | | | | | | | | compareOffset ≥ | | | | | co | | | | | mpareBuffer.length | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 5 | | | | | | | | | | compareLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | Text String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Text String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Invalid parameter | To | | | | | olkitException.BAD | | | | occurrence = 0 | _INPUT_PARAMETER | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | appendTLV with TAG | T | | | | 02 and length 02 | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | Select a TLV (tag | is thrown | | | | 02h) | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh | | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | Verify current TLV | T | | | | | oolkitException.UN | | | | getValueLength() | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 14 | clear the handler | Result is 00h | | | | and appendTLV with | | | | | TAG: 0D and value: | | | | | 04 00 01 ... 0F | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 15 | Verify current TLV | Result is 17 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | Result is +1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | Initialise | Result is 00h | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | Compare buffers | | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 12 | | | +----+--------------------+--------------------+------------------+ | 19 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 02 01 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 20 | Initialise | Result is +1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0A 0D | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | Compare buffers | | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 21 | append a Text | Result is 00h | | | | String TLV | | | | | | | | | | tag = 0Dh | | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 22 | Initialise | Result is 00h | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 00 11 22 33 44 55 | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 23 | Initialise | Result is -1 | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 00 11 22 33 44 66 | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 24 | clear the handler | Result is 00h | | | | and appendTLV with | | | | | TAG: 0D and value: | | | | | 04 00 01 ... 0F | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 04 | | | | | 00 01 ... 0F | | | | | | | | | | Successful call | | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 17 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 25 | Append tag 0Fh | Result is 00h | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | | | | | | | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 00 | | | | | 01 ... 0F | | | | | | | | | | Successful call | | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 16 | | | +----+--------------------+--------------------+------------------+ | 26 | Successful call, | Result of | | | | f | f | | | | indAndCompareValue | indAndCompareValue | | | | with length =0 | () is 00 | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 16 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+ | 27 | Call post() method | A toolkit | | | | then | Exception with | | | | fin | HANDL | | | | dAndCompareValue() | ER_NOT_AVAILABLE | | | | | reason is thrown. | | | | Co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.14.4 Test Coverage {#test-coverage-49 .H6}
CRR number Test case number
* * *
N1 12,13 N2 15,13 N3 14, 18, 22, 21, 26 N4 16, 19, 23 N5 17, 19 N6 25, 24 P1 1
P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 P4 11 C1 27
#### 6.2.5.15 Method appendArray
Test Area Reference: API_2_ERH_APDA_BSS
##### 6.2.5.15.1 Conformance requirement: {#conformance-requirement-39 .H6}
The method with following header shall be compliant to its definition in the
API.
public void appendArray(byte[] buffer,
short offset,
short length)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.15.1.1 Normal execution {#normal-execution-52 .H6}
  * CRRN1: appends a buffer into the EditHandler buffer.
  * CRRN2: a successful append does not modify the TLV selected.
##### 6.2.5.15.1.2 Parameters error {#parameters-error-11 .H6}
  * CRRP1: if buffer is null, a java.lang.NullPointerException is > thrown.
  * CRRP2: if offset or length or both would cause access outside the > array bounds, or if length is negative, a > java.lang.ArrayIndexOutOfBoundsException is thrown.
##### 6.2.5.15.1.3 Context errors {#context-errors-50 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.5.15.2 Test suite files {#test-suite-files-52 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_APDA_BSS_1.scr
Test Applet: API_2_ERH_APDA_BSS_1.java
Load Script: API_2_ERH_APDA_BSS_1.ldr
Cleanup Script: API_2_ERH_APDA_BSS_1.clr
Parameter File: API_2_ERH_APDA_BSS_1.par
##### 6.2.5.15.3 Test procedure {#test-procedure-52 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | | Initialise the | | | | | envelope response | | | | | handler with a TLV | | | | | of length 1 | | | +----+--------------------+--------------------+------------------+ | 1 | Null buffer | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | offset ≥ | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer.length = 5 | | | | | | | | | | offset = 5 | | | | | | | | | | length = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | offset \ | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer.length = 5 | | | | | | | | | | offset = 0 | | | | | | | | | | length = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | offset + length > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer.length = 5 | | | | | | | | | | offset = 3 | | | | | | | | | | length = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | length \ element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.5.16.1.2 Parameters error {#parameters-error-12 .H6}
No requirements
##### 6.2.5.16.1.3 Context errors {#context-errors-51 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.5.16.2 Test suite files {#test-suite-files-53 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_APTLBB_1.scr
Test Applet: API_2_ERH_APTLBB_1.java
Load Script: API_2_ERH_APTLBB_1.ldr
Cleanup Script: API_2_ERH_APTLBB_1.clr
Parameter File: API_2_ERH_APTLBB_1.par
##### 6.2.5.16.3 Test procedure {#test-procedure-53 .H6}
+----------------+----------------+----------------+----------------+ | Id | Description | API | APDU | | | | Expectation | Expectation | +================+================+================+================+ | 1 | Call | Toolki | | | | appendArray() | tException.HAN | | | | | DLER_OVERFLOW | | | | length = 253 | is thrown by | | | | | one of the | | | | Handler | two. | | | | Overflow: Call | | | | | twice the | | | | | app | | | | | endTLV()method | | | +----------------+----------------+----------------+----------------+ | 2 | append the | Result is 03h | | | | handler with | | | | | TLVs: | | | | | | | | | | 81 03 11 22 33 | | | | | | | | | | 82 02 99 77 | | | | | | | | | | Select Command | | | | | Details TLV | | | | | | | | | | Call the | | | | | appendTLV() | | | | | method | | | | | | | | | | Verify Current | | | | | TLV: Call | | | | | ge | | | | | tValueLength() | | | +----------------+----------------+----------------+----------------+ | 3 | Clear the | Result is 00h | | | | handler | | | | | | | | | | Successful | | | | | call | | | | | | | | | | tag = 84h | | | | | | | | | | value = 00h | | | | | | | | | | Call copy() | | | | | method | | | | | | | | | | Compare | | | | | handler | | | | | | | | | | compareBuffer | | | | | = 84 01 00 | | | +----------------+----------------+----------------+----------------+ | 4 | Successful | Result is 00h | | | | call | | | | | | | | | | tag = 01h | | | | | | | | | | value = FEh | | | | | | | | | | Call copy() | | | | | method | | | | | | | | | | Compare | | | | | handler | | | | | | | | | | compareBuffer | | | | | = 84 01 00 01 | | | | | 01 FE | | | +----------------+----------------+----------------+----------------+ | 5 | Call post() | A toolkit | | | | method then | Exception with | | | | appendTLV() | HANDLER_ | | | | | NOT_AVAILABLE | | | | tag = 01h | reason is | | | | | thrown. | | | | value = FEh | | | +----------------+----------------+----------------+----------------+ | NOTE: Test | | | | | case 1 call | | | | | twice | | | | | appendTLV | | | | | because the | | | | | current 3GPP | | | | | TS 43.019 | | | | | [7] is not | | | | | clear enough | | | | | on this point. | | | | | So this test | | | | | allows the two | | | | | possible | | | | | im | | | | | plementations. | | | | +----------------+----------------+----------------+----------------+
##### 6.2.5.16.4 Test Coverage {#test-coverage-51 .H6}
CRR number Test case number
* * *
N1 3, 4 N2 2 C1 1 C2 5
#### 6.2.5.17 Method appendTLV(byte tag, byte value1, byte value2)
Test Area Reference: API_2_ERH_APTLBBB
##### 6.2.5.17.1 Conformance requirements: {#conformance-requirements-14 .H6}
The method with following header shall be compliant to its definition in the
API.
public void appendTLV(byte tag,
byte value1,
byte value2)
throws ToolkitException
##### 6.2.5.17.1.1 Normal execution {#normal-execution-54 .H6}
  * CRRN1: Appends a TLV element to the current TLV list (2-byte > element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.5.17.1.2 Parameters error {#parameters-error-13 .H6}
No requirements
##### 6.2.5.17.1.3 Context errors {#context-errors-52 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.5.17.2 Test suite files {#test-suite-files-54 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_APTLBBB_1.scr
Test Applet: API_2_ERH_APTL BBB_1.java
Load Script: API_2_ERH_APTL BBB_1.ldr
Cleanup Script: API_2_ERH_APTLBBB_1.clr
Parameter File: API_2_ERH_APTLBBB_1.par
##### 6.2.5.17.3 Test procedure {#test-procedure-54 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Call the | ToolkitException | | | | appendArray with | .HANDLER_OVERFLOW | | | | length of 253 | is thrown | | | | | | | | | Handler Overflow: | | | | | Call the | | | | | appendTLV() method | | | +----+--------------------+--------------------+------------------+ | 2 | clear the handler, | Result is 03h | | | | append the handler | | | | | with TLVs: | | | | | | | | | | 81 03 11 22 33 | | | | | | | | | | 82 02 99 77 | | | | | | | | | | Select Command | | | | | Details TLV | | | | | | | | | | Call the | | | | | appendTLV() method | | | | | | | | | | Verify Current | | | | | TLV: Call | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 3 | Clear the handler | Result is 00h | | | | | | | | | Successful call | | | | | | | | | | tag = 84h | | | | | | | | | | value1 = 00h | | | | | | | | | | value2 = 01h | | | | | | | | | | Call copy() method | | | | | | | | | | Compare handler | | | | | | | | | | compareBuffer = 84 | | | | | 02 00 01 | | | +----+--------------------+--------------------+------------------+ | 4 | Successful call | Result is 00h | | | | | | | | | tag = 01h | | | | | | | | | | value1 = FEh | | | | | | | | | | value2 = FDh | | | | | | | | | | Call copy() method | | | | | | | | | | Compare handler | | | | | | | | | | compareBuffer = 84 | | | | | 02 00 01 01 02 FE | | | | | FD | | | +----+--------------------+--------------------+------------------+ | 5 | Call post() method | A toolkit | | | | then appendTLV() | Exception with | | | | | HANDL | | | | tag = 01h | ER_NOT_AVAILABLE | | | | | reason is thrown. | | | | value1 = FEh | | | | | | | | | | value2 = FDh | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.17.4 Test Coverage {#test-coverage-52 .H6}
CRR number Test case number
* * *
N1 3, 4 N2 2 C1 1 C2 5
#### 6.2.5.18 Method appendTLV(byte tag, byte[ ] value, short valueoffset,
short valuelength)
Test Area Reference: API_2_ERH_APTLB_BSS
##### 6.2.5.18.1 Conformance requirement: {#conformance-requirement-41 .H6}
The method with following header shall be compliant to its definition in the
API.
public void appendTLV(byte tag,
byte[] value,
short valueOffset,
short valueLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.5.18.1.1 Normal execution {#normal-execution-55 .H6}
  * CRRN1: Appends a TLV element to the current TLV list (byte-array > element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.5.18.1.2 Parameters error {#parameters-error-14 .H6}
  * CRRP1: if value is null, a java.lang.NullPointerException is thrown
  * CRRP2: if valueoffset or valuelength or both would cause access > outside the array bounds, or if length is negative, a > java.lang.ArrayIndexOutOfBoundsException is thrown.
##### 6.2.5.18.1.3 Context errors {#context-errors-53 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
  * CRRC3: if valuelength is greater than 255, a ToolkitException is > thrown with reason code BAD_INPUT_PARAMETER.
##### 6.2.5.18.2 Test suite files {#test-suite-files-55 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_APTLB_BSS_1.scr
Test Applet: API_2_ERH_APTLB_BSS_1.java
Load Script: API_2_ERH_APTLB_BSS_1.ldr
Cleanup Script: API_2_ERH_APTLB_BSS_1.clr
Parameter File: API_2_ERH_APTLB_BSS_1.par
##### 6.2.5.18.3 Test procedure {#test-procedure-55 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Null value | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | valueOffset ≥ | ArrayIndexOu | | | | value.length | tOfBoundsException | | | | | is thrown | | | | value.length = 5 | | | | | | | | | | valueOffset = 5 | | | | | | | | | | valueLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | valueOffset \ | ArrayIndexOu | | | | value.length | tOfBoundsException | | | | | is thrown | | | | value.length = 5 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | valueLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | ValueOffset + | ArrayIndexOu | | | | valueLength > | tOfBoundsException | | | | value.length | is thrown | | | | | | | | | value.length = 5 | | | | | | | | | | valueOffset = 3 | | | | | | | | | | valueLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | valueLength \ byte-array element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.5.19.1.2 Parameters error {#parameters-error-15 .H6}
  * CRRP1: if value2 is null, a java.lang.NullPointerException is > thrown.
  * CRRP2: if value2offset or value2length or both would cause access > outside the array bounds, or if length is negative, a > java.lang.ArrayIndexOutOfBoundsException is thrown.
##### 6.2.5.19.1.3 Context errors {#context-errors-54 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
  * CRRC3: if valuelength is greater than 255, a ToolkitException is > thrown with reason code BAD_INPUT_PARAMETER.
##### 6.2.5.19.2 Test suite files {#test-suite-files-56 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_APTLBB_BSS_1.scr
Test Applet: API_2_ERH_APTLBB_BSS_1.java
Load Script: API_2_ERH_APTLBB_BSS_1.ldr
Cleanup Script: API_2_ERH_APTLBB_BSS_1.clr
Parameter File: API_2_ERH_APTLBB_BSS_1.par
##### 6.2.5.19.3 Test procedure {#test-procedure-56 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Null value2 | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | value2Offset ≥ | ArrayIndexOu | | | | value2.length | tOfBoundsException | | | | | is thrown | | | | value2.length = 5 | | | | | | | | | | value2Offset = 5 | | | | | | | | | | value2Length = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | value2Offset \ | ArrayIndexOu | | | | value2.length | tOfBoundsException | | | | | is thrown | | | | value2.length = 5 | | | | | | | | | | value2Offset = 0 | | | | | | | | | | value2Length = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | value2Offset + | ArrayIndexOu | | | | value2Length > | tOfBoundsException | | | | value2.length | is thrown | | | | | | | | | value2.length = 5 | | | | | | | | | | value2Offset = 3 | | | | | | | | | | value2Length = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | value2Length \ TLV selected.
##### 6.2.5.20.1.2 Parameters error {#parameters-error-16 .H6}
No requirements
##### 6.2.5.20.1.3 Context errors {#context-errors-55 .H6}
  * CRRC1: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.5.20.2 Test suite files {#test-suite-files-57 .H6}
Specific triggering: Unrecognized Envelope
Test Script: API_2_ERH_CLER_1.scr
Test Applet: API_2_ERH_CLER_1.java
Load Script: API_2_ERH_CLER_1.ldr
Cleanup Script: API_2_ERH_CLER_1.clr
Parameter File: API_2_ERH_CLER_1.par
##### 6.2.5.20.3 Test procedure {#test-procedure-57 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | append the handler | Result of | | | | with TLVs: | getLength() is not | | | | | null | | | | 81 03 11 22 33 | | | | | | Result of | | | | 82 02 99 77 | getLength() is 0 | | | | | | | | | Select Command | | | | | Details TLV | | | | | | | | | | Call the | | | | | getLength() method | | | | | | | | | | Clear the handler | | | | | | | | | | Call the | | | | | getLength() method | | | +----+--------------------+--------------------+------------------+ | 2 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | shall be thrown | | +----+--------------------+--------------------+------------------+ | 3 | Call post() method | A toolkit | | | | then clear() | Exception with | | | | | HANDL | | | | | ER_NOT_AVAILABLE | | | | | reason is thrown. | | +----+--------------------+--------------------+------------------+
##### 6.2.5.20.4 Test Coverage {#test-coverage-55 .H6}
CRR number Test case number
* * *
N1 1, 2 C1 3
#### 6.2.5.21 Method getCapacity
Test Area Reference: API_2_ERH_GCAP
##### 6.2.5.21.1 Conformance Requirement: {#conformance-requirement-44 .H6}
The method with following header shall be compliant to its definition in the
API.
Public byte getCapacity()
##### 6.2.5.21.1.1 Normal execution {#normal-execution-58 .H6}
  * CRRN1: The method shall return the maximum size of the Simple TLV > list managed by the handler.
##### 6.2.5.21.1.2 Context errors {#context-errors-56 .H6}
  * CRRC1: The method shall throw HANDLER_NOT_AVAILABLE > ToolkitException if the handler is busy.
##### 6.2.5.21.2 Test suite files {#test-suite-files-58 .H6}
Test Script: API_2_ERH_GCAP_1.scr
Test Applet: API_2_ERH_GCAP_1.java
Load Script: API_2_ERH_GCAP_1.ldr
Cleanup Script: API_2_ERH_GCAP_1.clr
Parameter File: API_2_ERH_GCAP_1.par
##### 6.2.5.21.3 Test Procedure {#test-procedure-58 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | **Envel | 1- Applet is | | | | opeResponseHandler | triggered | | | | available** | | | | | | 2- No exception is | | | | 1- Send envelope | thrown | | | | SMS-PP Formatted | | | | | | 3- No exception is | | | | 2- The applet | thrown | | | | calls | | | | | getTheHandler() | 4- No exception is | | | | method | thrown | | | | | | | | | 3- The applet | 5- No exception is | | | | calls | thrown | | | | getCapacity() | | | | | method on the | 6- | | | | Envel | HANDLER_OVERFLOW | | | | opeResponseHandler | exception is | | | | | thrown | | | | 4- The applet | | | | | fills the handler | | | | | with the maximum | | | | | capacity using | | | | | AppendTLV() method | | | | | | | | | | 5- The applet | | | | | calls clear() | | | | | method on the | | | | | Envel | | | | | opeResponseHandler | | | | | | | | | | 6- The applet | | | | | fills the handler | | | | | with the maximum | | | | | capacity plus one, | | | | | using AppendTLV() | | | | | method | | | +----+--------------------+--------------------+------------------+
##### 6.2.5.21.4 Test Coverage {#test-coverage-56 .H6}
CRR number Test case number
* * *
N1 1 C1 Tested in Framework part: FWK_MHA_ERHD
### 6.2.6 Class MEProfile
#### 6.2.6.1 Method check (byte index)
Test Area Reference: API_2_MEP_CHECB
##### 6.2.6.1.1 Conformance requirement: {#conformance-requirement-45 .H6}
The method with following header shall compliant to its definition in the API.
public static boolean check(byte index)
throws ToolkitException
##### 6.2.6.1.1.1 Normal execution {#normal-execution-59 .H6}
  * CRRN1: The method checks a facility in the handset profile: returns > true if supported and false otherwise.
##### 6.2.6.1.1.2 Parameters error {#parameters-error-17 .H6}
No requirements.
##### 6.2.6.1.1.3 Context errors {#context-errors-57 .H6}
  * CRRC1: The method shall throw ME_PROFILE_NOT_AVAILABLE > ToolkitException if Terminal Profile data are not available
##### 6.2.6.1.2 Test suite files {#test-suite-files-59 .H6}
Specific triggering:
EVENT_STATUS_COMMAND
No Additional requirements for the GSM personalization:
Test Script: API_2_MEP_CHECB_1.scr
Test Applet: API_2_MEP_CHECB_1.java
Load Script: API_2_MEP_CHECB_1.ldr
Cleanup Script: API_2_MEP_CHECB_1.clr
Parameter File: API_2_MEP_CHECB_1.par
##### 6.2.6.1.3 Test procedure {#test-procedure-59 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | No Terminal | ME_PROFI | | | | Profile is | LE_NOT_AVAILABLE | | | | registered | ToolkitException | | | | | is thrown | | | | Triggered by | | | | | status command | | | | | | | | | | Index = 1 | | | +----+--------------------+--------------------+------------------+ | 2 | Terminal Profile, | true is returned | | | | Facility is | by the method | | | | supported | | | | | | | | | | index = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | Terminal Profile, | false is returned | | | | Facility is not | by the method | | | | supported | | | | | | | | | | index = 15 | | | +----+--------------------+--------------------+------------------+
##### 6.2.6.1.4 Test Coverage {#test-coverage-57 .H6}
CRR number Test case number
* * *
N1 2,3 C1 1
#### 6.2.6.2 Method check (byte [ ] mask, short offset, short length)
Test Area Reference: API_2_MEP_CHEC_BSS
##### 6.2.6.2.1 Conformance requirement: {#conformance-requirement-46 .H6}
The method with following header shall compliant to its definition in the API.
public static boolean check(byte[] mask,
short offset,
short length)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.6.2.1.1 Normal execution {#normal-execution-60 .H6}
  * CRRN1: The method checks all the facilities corresponding to bits > set to 1 in the mask buffer: returns true if they are all > supported and false if not.
  * CRRN2: The method returns true if the length to check is 0.
##### 6.2.6.2.1.2 Parameters error {#parameters-error-18 .H6}
  * CRRP1: The method shall throw java.lang.NullPointerException if mask > is null.
  * CRRP2: The method shall throw > java.lang.ArrayIndexOutOfBoundsException if offset or length or > both would cause access outside array bounds.
  * CRRP3: The method shall throw ME_PROFILE_NOT_AVAILABLE > ToolkitException if Terminal Profile data are not available.
##### 6.2.6.2.1.3 Context errors {#context-errors-58 .H6}
No requirements.
##### 6.2.6.2.2 Test suite files {#test-suite-files-60 .H6}
Specific triggering:
UNFORMATTED_SMS_PP_UPD
No Additional requirements for the GSM personalization:
Test Script: API_2_MEP_CHEC_BSS_1.scr
Test Applet: API_2_MEP_CHEC_BSS_1.java
Load Script: API_2_MEP_CHEC_BSS_1.ldr (the applet is loaded without INI after
the reset (RST))
Cleanup Script: API_2_MEP_CHEC_BSS_1.clr
Parameter File: API_2_MEP_CHEC_BSS_1.par
##### 6.2.6.2.3 Test procedure {#test-procedure-60 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | No Terminal | ME_PROFI | | | | Profile is | LE_NOT_AVAILABLE | | | | registered | ToolkitException | | | | | is thrown | | | | Triggered by | | | | | unformatted SMS | | | | | | | | | | Mask = | | | | | 0xFFFFFFFFFFFFFFFF | | | | | FFFFFFFFFFFFFFFF7F | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 16 | | | +----+--------------------+--------------------+------------------+ | 2 | NULL as parameter | Nu | | | | to check | llPointerException | | | | | is thrown | | | | mask= NULL | | | +----+--------------------+--------------------+------------------+ | 3 | Offset > | ArrayIndexOu | | | | mask.length | tOfBoundsException | | | | | is thrown | | | | mask = | | | | | 0xFFFFFFFFFFFFFFFF | | | | | FFFFFFFFFFFFFFFF7F | | | | | | | | | | Offset = 17 | | | +----+--------------------+--------------------+------------------+ | 4 | Offset \ | ArrayIndexOu | | | | mask.length | tOfBoundsException | | | | | is thrown | | | | mask = | | | | | 0xFFFFFFFFFFFFFFFF | | | | | FFFFFFFFFFFFFFFF7F | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 18 | | | +----+--------------------+--------------------+------------------+ | 6 | Offset + length > | ArrayIndexOu | | | | mask.length | tOfBoundsException | | | | | is thrown | | | | Mask = | | | | | 0xFFFFFFFFFFFFFFFF | | | | | FFFFFFFFFFFFFFFF7F | | | | | | | | | | Offset = 9 | | | | | | | | | | Length = 9 | | | +----+--------------------+--------------------+------------------+ | 7 | length = 0 | true is returned | | | | | | | | | mask = | | | | | 0xFFFFFFFFFFFFFFFF | | | | | FFFFFFFFFFFFFFFF7F | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | Check all the | false is returned | | | | Terminal Profile | by the method | | | | | because facility | | | | mask = | 15 is not | | | | 0xFFFFFFFFFFFFFFFF | supported | | | | FFFFFFFFFFFFFFFF7F | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 16 | | | +----+--------------------+--------------------+------------------+ | 9 | Check a part of | true is returned | | | | the Terminal | by the method: the | | | | Profile | 16 first | | | | | facilities except | | | | mask = | facility 15 have | | | | 0xFFFFFFFFFFFFFFFF | been successfully | | | | FFFFFFFFFFFFFFFF7F | checked | | | | | | | | | Offset = 15 | | | | | | | | | | Length = 2 | | | +----+--------------------+--------------------+------------------+ | 10 | Check a part of | false is returned | | | | the Terminal | by the method only | | | | Profile | facility 15 is | | | | | checked and not | | | | mask = 0x0080 | supported. | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 2 | | | +----+--------------------+--------------------+------------------+
##### 6.2.6.2.4 Test Coverage {#test-coverage-58 .H6}
CRR number Test case number
* * *
N1 8, 9, 10 N2 7 P1 2 P2 3, 4, 5, 6 P3 1
#### 6.2.6.3 Method check (short index)
Test Area Reference: API_2_MEP_CHECS
##### 6.2.6.3.1 Conformance requirement: {#conformance-requirement-47 .H6}
The method with following header shall compliant to its definition in the API.
public static boolean check(short index)
throws ToolkitException
##### 6.2.6.3.1.1 Normal execution {#normal-execution-61 .H6}
  * CRRN1: The method checks a facility in the handset profile: returns > true if the facility is supported, false if facility is not > supported, or if facility-index outside MEProfile data.
##### 6.2.6.3.1.2 Parameters error {#parameters-error-19 .H6}
No requirements.
##### 6.2.6.3.1.3 Context errors {#context-errors-59 .H6}
  * CRRC1: The method shall throw ME_PROFILE_NOT_AVAILABLE > ToolkitException if Terminal Profile data are not available
##### 6.2.6.3.2 Test suite files {#test-suite-files-61 .H6}
Specific triggering:
EVENT_STATUS_COMMAND
No Additional requirements for the GSM personalization:
Test Script: API_2_MEP_CHECS_1.scr
Test Applet: API_2_MEP_CHECS_1.java
Load Script: API_2_MEP_CHECS_1.ldr
Cleanup Script: API_2_MEP_CHECS_1.clr
Parameter File: API_2_MEP_CHECS_1.par
##### 6.2.6.3.3 Test procedure {#test-procedure-61 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | No Terminal | ME_PROFI | | | | Profile is | LE_NOT_AVAILABLE | | | | registered | ToolkitException | | | | | is thrown | | | | Triggered by | | | | | status command | | | | | | | | | | index = 1 | | | +----+--------------------+--------------------+------------------+ | 2 | Terminal Profile, | true is returned | | | | Facility is | by the method | | | | supported | | | | | | | | | | index = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | Terminal Profile, | false is returned | | | | Facility is not | by the method | | | | supported | | | | | | | | | | index = 15 | | | +----+--------------------+--------------------+------------------+ | 4 | Facility index is | false is returned | | | | outside MEProfile | by the method | | | | data | | | | | | | | | | index = 0x0099 | | | +----+--------------------+--------------------+------------------+
##### 6.2.6.3.4 Test Coverage {#test-coverage-59 .H6}
CRR number Test case number
* * *
N1 2, 3, 4 C1 1
#### 6.2.6.4 Method getValue (short indexMSB, short indexLSB)
Test Area Reference: API_2_MEP_GVALSS
##### 6.2.6.4.1 Conformance requirement: {#conformance-requirement-48 .H6}
The method with following header shall compliant to its definition in the API.
public static short getValue(short indexMSB, short indexLSB)
throws ToolkitException
##### 6.2.6.4.1.1 Normal execution {#normal-execution-62 .H6}
  * CRRN1: The method returns the binary value of a parameter, delimited > by two indexes, from the handset profile.
##### 6.2.6.4.1.2 Parameters error {#parameters-error-20 .H6}
  * CRRP1: The method shall throw BAD_INPUT_PARAMETER ToolkitException > if (indexMSB >= indexLSB +16) or (indexMSB \ (indexMSB \ ToolkitException if Terminal Profile data are not available.
##### 6.2.6.4.2 Test suite files {#test-suite-files-62 .H6}
Specific triggering:
EVENT_STATUS_COMMAND
No Additional requirements for the GSM personalization:
Test Script: API_2_MEP_GVALSS_1.scr
Test Applet: API_2_MEP_GVALSS_1.java
Load Script: API_2_MEP_GVALSS_1.ldr
Cleanup Script: API_2_MEP_GVALSS_1.clr
Parameter File: API_2_MEP_GVALSS_1.par
##### 6.2.6.4.3 Test procedure {#test-procedure-62 .H6}
TP = FF 01 D2 F0 00 00 00 00 00 00 00 00 00 8D FF
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | No Terminal | ME_PROFI | | | | Profile is | LE_NOT_AVAILABLE | | | | registered | ToolkitException | | | | | is thrown | | | | Triggered by | | | | | status command | | | | | | | | | | indexMSB = 15, | | | | | indexLSB = 0 | | | +----+--------------------+--------------------+------------------+ | 2 | Retrieve number of | 13 is returned by | | | | character down ME | the method | | | | display in | | | | | Terminal Profile | | | | | which is 13 | | | | | | | | | | indexMSB = 108, | | | | | indexLSB = 104 | | | +----+--------------------+--------------------+------------------+ | 3 | Retrieve byte 3 | 0xF0D2 is returned | | | | and byte 4 from | by the method | | | | terminal profile. | | | | | | | | | | Byte 3 = 0xD2, | | | | | Byte 4 = 0xF0 | | | | | | | | | | indexMSB = 31, | | | | | indexLSB = 16 | | | +----+--------------------+--------------------+------------------+ | 4 | indexMSB is | BAD | | | | negative | _INPUT_PARAMETER | | | | | ToolkitException | | | | indexMSB = 0xFFFF, | is thrown | | | | indexLSB = 0xFFFD | | | +----+--------------------+--------------------+------------------+ | 5 | indexLSB is | BAD | | | | negative | _INPUT_PARAMETER | | | | | ToolkitException | | | | indexMSB = 0x0002, | is thrown | | | | indexLSB = 0xFFFD | | | +----+--------------------+--------------------+------------------+ | 6 | indexMSB \ | BAD | | | | indexLSB + 16 | _INPUT_PARAMETER | | | | | ToolkitException | | | | indexMSB = 0x0021, | is thrown | | | | indexLSB = 0x0010 | | | +----+--------------------+--------------------+------------------+
##### 6.2.6.4.4 Test Coverage {#test-coverage-60 .H6}
CRR number Test case number
* * *
N1 2,3 P1 4, 5, 6, 7 C1 1
#### 6.2.6.5 Method copy (short startOffset, byte[] dstBuffer, short
dstOffset, short dstLength)
Test Area Reference: API_2_MEP_COPYS_BSS
##### 6.2.6.5.1 Conformance requirement: {#conformance-requirement-49 .H6}
The method with following header shall compliant to its definition in the API.
public static short copy(short startOffset, byte[] dstBuffer, short dstOffset,
short dstLength)
throws ToolkitException
##### 6.2.6.5.1.1 Normal execution {#normal-execution-63 .H6}
  * CRRN1: The method copies a part of the handset profile in a buffer.
  * CRRN2: The method returns dstOffset + dstLength.
##### 6.2.6.5.1.2 Parameters error {#parameters-error-21 .H6}
  * CRRP1: if dstBuffer is null NullPointerException is thrown.
  * CRRP2 : _If_ dstOffset _or_ dstLength _parameter is negative an_ > ArrayIndexOutOfBoundsException _exception is thrown and no copy is > performed_
  * CRRP3: _If_ dstOffset+dstLength _is greater than_ dstBuffer.length _, > the length of the_ dstBuffer _array an_ > ArrayIndexOutOfBoundsException _exception is thrown and no copy is > performed_
##### 6.2.6.5.1.3 Context errors {#context-errors-61 .H6}
  * CRRC1: The method shall throw ME_PROFILE_NOT_AVAILABLE > ToolkitException if Terminal Profile data are not available.
##### 6.2.6.5.2 Test suite files {#test-suite-files-63 .H6}
Specific triggering:
EVENT_STATUS_COMMAND
No Additional requirements for the GSM personalization:
Test Script: API_2_MEP_COPYS_BSS_1.scr
Test Applet: API_2_MEP_COPYS_BSS_1.java
Load Script: API_2_MEP_COPYS_BSS_1.ldr
Cleanup Script: API_2_MEP_COPYS_BSS_1.clr
Parameter File: API_2_MEP_COPYS_BSS_1.par
##### 6.2.6.5.3 Test procedure {#test-procedure-63 .H6}
TP = FF 01 D2 F0 01 02 00 00 00 00 00 00 00 8D FF
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | No Terminal | ME_PROFI | | | | Profile is | LE_NOT_AVAILABLE | | | | registered | ToolkitException | | | | | is thrown | | | | Triggered by | | | | | status command | | | | | | | | | | startOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 2 | dstBuffer is null | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | startOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 4 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | startOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 7 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | startOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 8 | Successful call | Result of copy() | | | | extreme values | is 6 | | | | | | | | | startOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 9 | Successful call | Result of copy() | | | | any values | is 7 | | | | | | | | | startOffset = 1 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 4 | | | +----+--------------------+--------------------+------------------+ | 10 | Successful call, | Result of copy() | | | | copy with length | is 20 | | | | =0 | | | | | | | | | | startOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 20 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 11 | Value outside | Result of copy() | | | | MEProfile data | is 6 | | | | available | | | | | | | | | | startOffset = 13 | | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+
##### 6.2.6.5.4 Test Coverage {#test-coverage-61 .H6}
CRR number Test case number
* * *
N1 8, 9, 10, 11 N3 8, 9, 10, 11 P1 2 P2 4, 5 P3 3, 6, 7 C1 1
### 6.2.7 Class ProactiveHandler
#### 6.2.7.1 Method getTheHandler
Test Area Reference: API_2_PAH_GTHD
##### 6.2.7.1.1 Conformance requirement {#conformance-requirement-50 .H6}
The method with following header shall be compliant to its definition in the
API.
public static ProactiveHandler getTheHandler()
throws ToolkitException
##### 6.2.7.1.1.1 Normal execution {#normal-execution-64 .H6}
  * CRRN1: The method shall return the single system instance of the > ProactiveHandler class.
  * CRRN2: The EnvelopeHandler is a Temporary JCRE Entry Point Object
##### 6.2.7.1.1.2 Parameter errors {#parameter-errors-35 .H6}
No requirements.
##### 6.2.7.1.1.3 Context errors {#context-errors-62 .H6}
  * CRRC1: The method shall throw > ToolkitException.HANDLER_NOT_AVAILABLE if the handler is busy.
##### 6.2.7.1.2 Test Suite files {#test-suite-files-64 .H6}
Test Script: API_2_PAH_GTHD_1.scr
Test Applet: API_2_PAH_GTHD_1.java
Load Script: API_2_PAH_GTHD_1.ldr
Cleanup Script: API_2_PAH_GTHD_1.clr
Parameter File: API_2_PAH_GTHD_1.par
##### 6.2.7.1.3 Test procedure {#test-procedure-64 .H6}
Id Description API Expectation APDU Expectation
* * *
1 getTheHandler() twice The returned objects shall be the same  
2 getTheHandler() The reference shall be a ProactiveHandler  
3 getTheHandler() The reference shall not be null
##### 6.2.7.1.4 Test Coverage {#test-coverage-62 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 Checked in Framework tests: FWK_API_HEPO (test case 3) C1
Checked in Framework tests: FWK_MHA_PAHD
#### 6.2.7.2 Method init
Test Area Reference: API_2_PAH_INITBBB
##### 6.2.7.2.1 Conformance requirement {#conformance-requirement-51 .H6}
The method with following header shall be compliant to its definition in the
API.
public void init(byte type,
byte qualifier,
byte dstDevice)
##### 6.2.7.2.1.1 Normal execution {#normal-execution-65 .H6}
  * CRRN1: The init() method initialises the next Proactive command in > the ProactiveHandler, with Command details and Device Identities > TLV. The source device is always the SIM Card (81h). The > Comprehension Required flags are set.
  * CRRN2: The Command number may take any value between 01h and FEh.
  * CRRN3: The init() method clears the ProactiveHandler before > initializing it.
  * CRRN4: No TLV is selected after a call to the method.
  * CRRN5: The handler is not sent to the mobile by the init() method.
##### 6.2.7.2.1.2 Parameter errors {#parameter-errors-36 .H6}
No requirements.
##### 6.2.7.2.1.3 Context errors {#context-errors-63 .H6}
No requirements.
##### 6.2.7.2.2 Test Suite files {#test-suite-files-65 .H6}
Test Script: API_2_PAH_INITBBB_1.scr
Test Applet: API_2_PAH_INITBBB_1.java
Load Script: API_2_PAH_INITBBB_1.ldr
Cleanup Script: API_2_PAH_INITBBB_1.clr
Parameter File: API_2_PAH_INITBBB_1.par
##### 6.2.7.2.3 Test procedure {#test-procedure-65 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Call the init() | | | | | method | | | | | | | | | | type = 01h | | | | | | | | | | qualifier = 02h | | | | | | | | | | dstDevice = 03h | | | +----+--------------------+--------------------+------------------+ | | Copy | | | | | ProactiveHandler | | | | | in a byte array | | | | | (source) | | | +----+--------------------+--------------------+------------------+ | | Compare the byte | source and | | | | array | reference are | | | | | identical | | | | reference = | | | | | | | | | | 81h 03h xxh 01h | | | | | 02h | | | | | | | | | | 82h 02h 81h 03h | | | +----+--------------------+--------------------+------------------+ | 2 | Verify the command | 01h-FEh | | | | number value | | | +----+--------------------+--------------------+------------------+ | 3 | Call the init() | | | | | method | | | | | | | | | | type = FFh | | | | | | | | | | qualifier = FEh | | | | | | | | | | destination = FDh | | | +----+--------------------+--------------------+------------------+ | | Copy | | | | | ProactiveHandler | | | | | in a byte array | | | | | (source) | | | +----+--------------------+--------------------+------------------+ | | Compare the byte | source and | | | | array | reference are | | | | | identical | | | | reference = | | | | | | | | | | 81h 03h xxh FFh | | | | | FEh | | | | | | | | | | 82h 02h 81h FDh | | | +----+--------------------+--------------------+------------------+ | 4 | Select the 1^st^ | | | | | TLV in the handler | | | | | | | | | | Call the init() | | | | | method with any | | | | | value | | | +----+--------------------+--------------------+------------------+ | | Call the | UN | | | | getValueLength() | AVAILABLE_ELEMENT | | | | method | ToolkitException | | | | | is thrown by | | | | | getValueLength() | | +----+--------------------+--------------------+------------------+
##### 6.2.7.2.4 Test Coverage {#test-coverage-63 .H6}
CRR number Test case number
* * *
N1 1, 3 N2 2 N3 3 N4 4 N5 1, 3
#### 6.2.7.3 Method initDisplayText
Test Area Reference: API_2_PAH_INDTBB_BSS
##### 6.2.7.3.1 Conformance requirement {#conformance-requirement-52 .H6}
The method with following header shall be compliant to its definition in the
API.
public void initDisplayText(byte qualifier,
byte dcs,
byte[] buffer,
short offset,
short length)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.3.1.1 Normal execution {#normal-execution-66 .H6}
  * CRRN1: The method shall build a DISPLAY TEXT proactive command in > the ProactiveHandler, using qualifier, dcs and buffer parameters. > Comprehension required flags are set.
  * CRRN2: A call to this method clears the handler then initialises it.
  * CRRN3: No TLV is selected after a call to the method.
  * CRRN4: The DISPLAY TEXT command is not sent by the method.
  * CRRN5: The Command Number may take any value between 01h and FEh.
  * CRRN6: If length is equal to zero, then the Text String TLV inserted > in the command is a null text string TLV as defined in TS 11.14 > [4].
##### 6.2.7.3.1.2 Parameter errors {#parameter-errors-37 .H6}
  * CRRP1: The method shall throw NullPointerException if buffer is > null.
  * CRRP2: If offset or length or both would cause access outside array > bounds, an ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.7.3.1.3 Context errors {#context-errors-64 .H6}
  * CRRC1: A ToolkitException.HANDLER_OVERFLOW shall be thrown if the > ProactiveHandler is too small to put the requested data.
##### 6.2.7.3.2 Test Suite files {#test-suite-files-66 .H6}
Test Script: API_2_PAH_INDTBB_BSS_1.scr
Test Applet: API_2_PAH_INDTBB_BSS_1.java
Load Script: API_2_PAH_INDTBB_BSS_1.ldr
Cleanup Script: API_2_PAH_INDTBB_BSS_1.clr
Parameter File: API_2_PAH_INDTBB_BSS_1.par
##### 6.2.7.3.3 Test procedure {#test-procedure-66 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | NULL as parameter | Nu | | | | to buffer | llPointerException | | | | | is thrown | | | | buffer = NULL | | | +----+--------------------+--------------------+--------------------+ | 2 | offset > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 5 | | | | | | | | | | length = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | offset \ | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 0 | | | | | | | | | | length = 5 | | | +----+--------------------+--------------------+--------------------+ | 5 | offset + length > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 3 | | | | | | | | | | length = 2 | | | +----+--------------------+--------------------+--------------------+ | 6 | length \ ProactiveHandler, using qualifier, dcs and buffer parameters. > Comprehension Required flags are set.
  * CRRN2: A call to this method clears the handler then initialises it.
  * CRRN3: No TLV is selected after a call to the method.
  * CRRN4: The GET INKEY command is not sent by the method.
  * CRRN5: The Command Number may take any value between 01h and FEh.
  * CRRN6: If length is equal to zero, then the Text String TLV inserted > in the command is a null text string TLV as defined in TS 11.14 > [4].
##### 6.2.7.4.1.2 Parameter errors {#parameter-errors-38 .H6}
  * CRRP1: The method shall throw NullPointerException if buffer is > null.
  * CRRP1: If offset or length or both would cause access outside array > bounds, a ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.7.4.1.3 Context errors {#context-errors-65 .H6}
  * CRRC1: A ToolkitException.HANDLER_OVERFLOW shall be thrown if the > ProactiveHandler is to small to put the requested data.
##### 6.2.7.4.2 Test Suite files {#test-suite-files-67 .H6}
Test Script: API_2_PAH_INGKBB_BSS_1.scr
Test Applet: API_2_PAH_INGKBB_BSS_1.java
Load Script: API_2_PAH_INGKBB_BSS_1.ldr
Cleanup Script: API_2_PAH_INGKBB_BSS_1.clr
Parameter File: API_2_PAH_INGKBB_BSS_1.par
##### 6.2.7.4.3 Test procedure {#test-procedure-67 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | NULL as parameter | Nu | | | | to buffer | llPointerException | | | | | is thrown | | | | buffer = NULL | | | +----+--------------------+--------------------+--------------------+ | 2 | offset > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 5 | | | +----+--------------------+--------------------+--------------------+ | 3 | offset \ | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 0 | | | | | | | | | | length = 5 | | | +----+--------------------+--------------------+--------------------+ | 5 | offset + length > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 3 | | | | | | | | | | length = 2 | | | +----+--------------------+--------------------+--------------------+ | 6 | length \ ProactiveHandler, using qualifier, dcs, buffer, minRespLength and > maxRespLength parameters. Comprehension Required flags are set.
  * CRRN2: A call to this method clears the handler then initialises it.
  * CRRN3: No TLV is selected after a call to the method.
  * CRRN4: The GET INPUT command is not sent by the method.
  * CRRN5: The Command Number may take any value between 01h and FEh.
  * CRRN6: If length is equal to zero, then the Text String TLV inserted > in the command is a null text string TLV as defined in TS 11.14 > [4].
##### 6.2.7.5.1.2 Parameter errors {#parameter-errors-39 .H6}
  * CRRP1: The method shall throw NullPointerException if buffer is > null.
  * CRRP2: If offset or length or both would cause access outside array > bounds, a ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.7.5.1.3 Context errors {#context-errors-66 .H6}
  * CRRC1: A ToolkitException.HANDLER_OVERFLOW shall be thrown if the > ProactiveHandler is to small to put the requested data.
##### 6.2.7.5.2 Test Suite files {#test-suite-files-68 .H6}
Test Script: API_2_PAH_INGPBB_BSSSS_1.scr
Test Applet: API_2_PAH_INGPBB_BSSSS_1.java
Load Script: API_2_PAH_INGPBB_BSSSS_1.ldr
Cleanup Script: API_2_PAH_INGPBB_BSSSS_1.clr
Parameter File: API_2_PAH_INGPBB_BSSSS_1.par
##### 6.2.7.5.3 Test procedure {#test-procedure-68 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | NULL as parameter | Nu | | | | to buffer | llPointerException | | | | | is thrown | | | | buffer = NULL | | | +----+--------------------+--------------------+--------------------+ | 2 | offset > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 5 | | | +----+--------------------+--------------------+--------------------+ | 3 | offset \ | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 0 | | | | | | | | | | length = 5 | | | +----+--------------------+--------------------+--------------------+ | 5 | offset + length > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer = \"Text\" | | | | | | | | | | offset = 3 | | | | | | | | | | length = 2 | | | +----+--------------------+--------------------+--------------------+ | 6 | length \ mobile.
  * CRRN2: The returned byte is equal to general result of the command > (first byte of Result TLV in Terminal Response).
  * CRRN3: The handler remains unchanged after a call to send() method > until the use of initXX() or appendTLV().
  * CRRN4: There is no invocation of select() or deselect() method.
  * CRRN5: A pending toolkit applet transaction at the method invocation > is aborted.
##### 6.2.7.6.1.2 Parameter errors {#parameter-errors-40 .H6}
No requirements.
##### 6.2.7.6.1.3 Context errors {#context-errors-67 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown is > the Result Simple TLV is missing in Terminal Response.
  * CRRC2: A ToolkitException.OUT_OF_TLV_BOUNDARIES shall be thrown > if the general result byte is missing in the Result Simple TLV in > Terminal Response.
  * CRRC3: A ToolkitException COMMAND_NOT_ALLOWED shall be thrown if > the proactive command to be sent is not allowed by the SIM Toolkit > Framework.
  * CRRC4: A ToolkitException COMMAND_NOT_ALLOWED shall be thrown if > one parameter of the proactive command to be sent is not allowed > by the SIM Toolkit Framework.
##### 6.2.7.6.2 Test Suite files {#test-suite-files-69 .H6}
Test Script: API_2_PAH_SEND_1.scr
Test Applet: API_2_PAH_SEND_1.java
Load Script: API_2_PAH_SEND_1.ldr
Cleanup Script: API_2_PAH_SEND_1.clr
Parameter File: API_2_PAH_SEND_1.par
##### 6.2.7.6.3 Test procedure {#test-procedure-69 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | +----+--------------------+--------------------+--------------------+ | 2 | Terminal Response | Result of send() | | | | with General | is 00h | | | | Result = 00 | | | | | | | | | | Result TLV = 03 01 | | | | | 00 (command | | | | | performed | | | | | successfully) | | | +----+--------------------+--------------------+--------------------+ | 3 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | +----+--------------------+--------------------+--------------------+ | 4 | Terminal Response | Result of send() | | | | with General | is 01h | | | | Result = 01, | | | | | without Additional | | | | | information on | | | | | result | | | | | | | | | | Result TLV = 03 01 | | | | | 01 (command | | | | | performed with | | | | | partial | | | | | comprehension) | | | +----+--------------------+--------------------+--------------------+ | 5 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | +----+--------------------+--------------------+--------------------+ | 6 | Terminal Response | Result of send() | | | | with General | is 01h | | | | Result = 01, with | | | | | Additional | | | | | information on | | | | | result | | | | | | | | | | Result TLV = 03 02 | | | | | 01 55 (command | | | | | performed with | | | | | partial | | | | | comprehension) | | | +----+--------------------+--------------------+--------------------+ | 7 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | +----+--------------------+--------------------+--------------------+ | 8 | Terminal Response | Result of send() | | | | with General | is 02h | | | | Result = 02 | | | | | | | | | | Result TLV = 03 04 | | | | | 02 65 43 21 | | | | | (Missing | | | | | information) | | | +----+--------------------+--------------------+--------------------+ | 9 | Build and send a | | DISPLAY TEXT | | | 7Fh byte command | | Proactive command | | | (DISPLAY TEXT) | | | | | | | BER-TLV = D0 7F | | | qualifier = 00h | | | | | | | Text String TLV = | | | dcs = 04h | | 8D 74 04 55 55 | | | | | 55... | | | buffer = | | | | | \"UUUUU...\" | | | | | | | | | | length = 73h | | | +----+--------------------+--------------------+--------------------+ | 10 | Build and send a | | DISPLAY TEXT | | | 80h byte command | | Proactive command | | | (DISPLAY TEXT) | | | | | | | BER-TLV = D0 81 80 | | | qualifier = 00h | | | | | | | Text String TLV = | | | dcs = 04h | | 8D 75 04 55 55 | | | | | 55... | | | buffer = | | | | | \"UUUUU...\" | | | | | | | | | | length = 74h | | | +----+--------------------+--------------------+--------------------+ | 11 | Build and send a | | DISPLAY TEXT | | | maximum length | | Proactive command | | | command (length of | | | | | the handler should | | BER-TLV = D0 81 FD | | | be 253) | | | | | | | Text String TLV = | | | DISPLAY TEXT: | | 8D 81 F1 04 55 | | | | | 55... | | | Qualifier = 0 | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = | | | | | \"UUU...\" | | | | | | | | | | offset = 0 | | | | | | | | | | length = 240 | | | +----+--------------------+--------------------+--------------------+ | 12 | Verify that the | | | | | Proactive Handler | | | | | is not modified | | | | | after a send() | | | | | | | | | | Build a DISPLAY | | | | | TEXT command | | | +----+--------------------+--------------------+--------------------+ | | Copy | | | | | ProactiveHandler | | | | | to source byte | | | | | array | | | +----+--------------------+--------------------+--------------------+ | | Send command | | | +----+--------------------+--------------------+--------------------+ | | Copy | | | | | ProactiveHandler | | | | | to destination | | | | | byte array | | | +----+--------------------+--------------------+--------------------+ | | Compare source and | Source and | | | | destination | destination are | | | | | identical | | +----+--------------------+--------------------+--------------------+ | 13 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | Verify there is no | | | | | invocation of | | | | | select() or | | | | | deselect() method. | | | +----+--------------------+--------------------+--------------------+ | 14 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | Result of send() | | | | with 2 Result TLV | is 02h | | | | | | | | | 1^st^ Result TLV = | | | | | 03 02 02 12 | | | | | | | | | | 2^nd^ Result TLV = | | | | | 03 03 03 34 56 | | | +----+--------------------+--------------------+--------------------+ | 15 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | T | | | | without Result | oolkitException.UN | | | | Simple TLV | AVAILABLE_ELEMENT | | | | | is thrown by | | | | | send() | | +----+--------------------+--------------------+--------------------+ | 16 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | Toolk | | | | without general | itException.OUT_O | | | | result byte in the | F_TLV_BOUNDARIES | | | | Simple TLV | is thrown by | | | | | send() | | | | Result TLV = 03 00 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.7.6.4 Test Coverage {#test-coverage-67 .H6}
CRR number Test case number
* * *
N1 1, 3, 5, 7, 9, 10, 11, 12, 13, 14 N2 2, 4, 6, 8, 14 N3 12 N4 13 N5 checked
in Framework tests: FWK_API_TRAN C1 15 C2 16 C3 checked in the Framework test
: FWK_PCS_PCCO (test case 1) C4 checked in the Framework test : FWK_PCS_PCCO
(test cases 2 to 3)
#### 6.2.7.7 Method getLength
Test Area Reference API_2_PAH_GLEN
##### 6.2.7.7.1 Conformance requirement {#conformance-requirement-56 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getLength()
throws ToolkitException
##### 6.2.7.7.1.1 Normal execution {#normal-execution-70 .H6}
  * CRRN1: returns the length in bytes of the TLV list.
##### 6.2.7.7.1.2 Parameter errors {#parameter-errors-41 .H6}
No requirements.
##### 6.2.7.7.1.3 Context errors {#context-errors-68 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.7.7.2 Test Suite files {#test-suite-files-70 .H6}
Test Script: API_2_PAH_GLEN_1.scr
Test Applet: API_2_PAH_GLEN_1.java
Load Script: API_2_PAH_GLEN_1.ldr
Cleanup Script: API_2_PAH_GLEN_1.clr
Parameter File: API_2_PAH_GLEN_1.par
##### 6.2.7.7.3 Test procedure {#test-procedure-70 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Clear the handler | Result of | | | | | getLength() is 0 | | | | getLength() | | | +----+--------------------+--------------------+------------------+ | 2 | Call the init() | Result of | | | | method | getLength() is 9 | | | | | | | | | getLength() | | | +----+--------------------+--------------------+------------------+ | 3 | Call the | Result of | | | | initDisplayText() | getLength() is 253 | | | | method, with | | | | | buffer length = | | | | | 240 | | | | | | | | | | getLength() | | | +----+--------------------+--------------------+------------------+ | 4 | Build a 7Fh | Result of | | | | Proactive Handler | getLength() is 7Fh | | | | | | | | | getLength() | | | +----+--------------------+--------------------+------------------+ | 5 | Build a 80h | Result of | | | | Proactive Handler | getLength() is 80h | | | | | | | | | getLength() | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.7.4 Test Coverage {#test-coverage-68 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4, 5 C1 Does not apply for Proactive Handler
#### 6.2.7.8 Method copy
Test Area Reference API_2_PAH_COPY_BSS
##### 6.2.7.8.1 Conformance requirement {#conformance-requirement-57 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copy(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.8.1.1 Normal execution {#normal-execution-71 .H6}
  * CRRN1: copies the simple TLV list contained in the handler to the > destination byte array.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.7.8.1.2 Parameter errors {#parameter-errors-42 .H6}
  * CRRP1: if dstBuffer is null a NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative, an > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if dstLength is grater than the length of the simple TLV > List, an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException. OUT_OF_TLV_BOUNDARIES.
##### 6.2.7.8.1.3 Context errors {#context-errors-69 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.7.8.2 Test Suite files {#test-suite-files-71 .H6}
Test Script: API_2_PAH_COPY_BSS_1.scr
Test Applet: API_2_PAH_COPY_BSS_1.java
Load Script: API_2_PAH_COPY_BSS_1.ldr
Cleanup Script: API_2_PAH_COPY_BSS_1.clr
Parameter File: API_2_PAH_COPY_BSS_1.par
##### 6.2.7.8.3 Test procedure {#test-procedure-71 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | NULL as parameter | Nu | | | | to dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Call the init() | | | | | method | | | +----+--------------------+--------------------+------------------+ | | DstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ | Toolk | | | | length of the | itException.OUT_O | | | | simple TLV list | F_TLV_BOUNDARIES | | | | | is thrown | | | | dstBuffer.length = | | | | | 10 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 10 | | | +----+--------------------+--------------------+------------------+ | 8 | Successful call, | Result of copy() | | | | dstBuffer is the | is 9 | | | | whole buffer | | | | | | | | | | dstBuffer.length = | | | | | 9 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 9 | | | +----+--------------------+--------------------+------------------+ | 9 | Compare the buffer | Result of | | | | | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 10 | Successful call, | Result of copy() | | | | dstBuffer is part | is 12 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 9 | | | +----+--------------------+--------------------+------------------+ | 11 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 12 | Successful call, | Result of copy() | | | | dstBuffer is part | is 9 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+
##### 6.2.7.8.4 Test Coverage {#test-coverage-69 .H6}
CRR number Test case number
* * *
N1 9, 11, 13 N2 8, 10, 12 P1 1 P2 2, 3, 4, 5, 6 P3 7 C1 Does not apply for
ProactiveHandler
#### 6.2.7.9 Method findTLV
Test Area Reference API_2_PAH_FINDBB
##### 6.2.7.9.1 Conformance requirement {#conformance-requirement-58 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findTLV(byte tag, byte occurrence)
throws ToolkitException
##### 6.2.7.9.1.1 Normal execution {#normal-execution-72 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of the
TLV list (handler buffer):
  * CRRN1: the method is successful if the required occurrence exists > then the corresponding TLV becomes current.
  * CRRN2: if the method is successful then it returns > TLV_FOUND_CR_SET when Comprehension Required flag is set.
  * CRRN3: if the method is successful then it returns > TLV_FOUND_CR_NOT_SET when Comprehension Required flag is not > set.
  * CRRN4: if the required occurrence of the TLV element does not exist, > the current TLV is no longer defined and TLV_NOT_FOUND is > returned.
  * CRRN5: The search method is comprehension required flag independent.
##### 6.2.7.9.1.2 Parameter errors {#parameter-errors-43 .H6}
  * CRRP1: if an input parameter is not valid (e.g. occurrence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException BAD_INPUT_PARAMETER.
##### 6.2.7.9.1.3 Context errors {#context-errors-70 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.7.9.2 Test Suite files {#test-suite-files-72 .H6}
Test Script: API_2_PAH_FINDBB_1.scr
Test Applet: API_2_PAH_FINDBB_1.java
Load Script: API_2_PAH_FINDBB_1.ldr
Cleanup Script: API_2_PAH_FINDBB_1.clr
Parameter File: API_2_PAH_FINDBB_1.par
##### 6.2.7.9.3 Test procedure {#test-procedure-72 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | Invalid input | To | | | | parameter | olkitException.BAD | | | | | _INPUT_PARAMETER | | | | Occurrence = 0 | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Call the init() | | | | | method | | | +----+--------------------+--------------------+------------------+ | | Search 1^st^ TLV | Result is | | | | | T | | | | Tag = 01h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | Call the | Result is 03h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 4 | Search 2^nd^ TLV | Result is | | | | | T | | | | Tag = 02h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 5 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | Search a wrong tag | Result is | | | | | TLV_NOT_FOUND | | | | Tag = 03h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Search a tag with | Result is | | | | wrong occurrence | TLV_NOT_FOUND | | | | | | | | | Tag = 01h | | | | | | | | | | Occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 9 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 10 | Append a TLV with | | | | | tag=02h | | | +----+--------------------+--------------------+------------------+ | | Search the TLV | Result is | | | | | TLV_F | | | | Tag = 02h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 11 | Append a TLV with | | | | | tag=04h | | | +----+--------------------+--------------------+------------------+ | | Search the TLV | Result is | | | | | TLV_F | | | | Tag = 04h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 12 | Search tag 81h | Result is | | | | | T | | | | Tag = 81h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 13 | Search tag 84h | Result is | | | | | TLV_F | | | | Tag = 84h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.9.4 Test Coverage {#test-coverage-70 .H6}
CRR number Test case number
* * *
N1 3, 5 N2 2, 4 N3 10, 11 N4 6, 7,8, 9 N5 12, 13 P1 1 C1 Does not apply for
Proactive Handler
#### 6.2.7.10 Method getValueLength
Test Area Reference API_2_PAH_GVLE
##### 6.2.7.10.1 Conformance requirement {#conformance-requirement-59 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getValueLength()
throws ToolkitException
##### 6.2.7.10.1.1 Normal execution {#normal-execution-73 .H6}
  * CRRN1: gets and returns the binary length of the value field for the > last TLV element which has been found in the handler.
##### 6.2.7.10.1.2 Parameter errors {#parameter-errors-44 .H6}
No requirements.
##### 6.2.7.10.1.3 Context errors {#context-errors-71 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.7.10.2 Test Suite files {#test-suite-files-73 .H6}
Test Script: API_2_PAH_GVLE_1.scr
Test Applet: API_2_PAH_GVLE_1.java
Load Script: API_2_PAH_GVLE_1.ldr
Cleanup Script: API_2_PAH_GVLE_1.clr
Parameter File: API_2_PAH_GVLE_1.par
##### 6.2.7.10.3 Test procedure {#test-procedure-73 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Call the init() | | | | | method | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Call the | | | | | appendTLV() method | | | | | | | | | | tag = 0D | | | | | | | | | | valueOffset = 0 | | | | | | | | | | valueLength = 0 | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 00h | | +----+--------------------+--------------------+------------------+ | 3 | Call the | | | | | initDisplayText() | | | | | method | | | | | | | | | | length = 1 (+ dcs | | | | | byte) | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 02h | | +----+--------------------+--------------------+------------------+ | 4 | Call the | | | | | initDisplayText() | | | | | method | | | | | | | | | | length = 7Eh (+ | | | | | dcs byte) | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 7Fh | | +----+--------------------+--------------------+------------------+ | 5 | Call the | | | | | initDisplayText() | | | | | method | | | | | | | | | | length = 7Fh (+ | | | | | dcs byte) | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is 80h | | +----+--------------------+--------------------+------------------+ | 6 | Call the | | | | | initDisplayText() | | | | | method | | | | | | | | | | length = F0h | | | | | (maximum text | | | | | length) | | | +----+--------------------+--------------------+------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueLength() | Result is F1h | | +----+--------------------+--------------------+------------------+
##### 6.2.7.10.4 Test Coverage {#test-coverage-71 .H6}
CRR number Test case number
* * *
N1 2, 3, 4, 5, 6 C1 Does not apply for Proactive Handler C2 1
#### 6.2.7.11 Method getValueByte
Test Area Reference API_2_PAH_GVBYS
##### 6.2.7.11.1 Conformance requirement {#conformance-requirement-60 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getValueByte(short valueOffset)
throws ToolkitException
##### 6.2.7.11.1.1 Normal execution {#normal-execution-74 .H6}
  * CRRN1: Gets a byte from the last TLV element which has been found in > the handler and returns its value (1 byte).
##### 6.2.7.11.1.2 Parameter errors {#parameter-errors-45 .H6}
  * CRRP1: if valueOffset is out of the current TLV an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.7.11.1.3 Context errors {#context-errors-72 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.7.11.2 Test Suite files {#test-suite-files-74 .H6}
Test Script: API_2_PAH_GVBYS_1.scr
Test Applet: API_2_PAH_GVBYS_1.java
Load Script: API_2_PAH_GVBYS_1.ldr
Cleanup Script: API_2_PAH_GVBYS_1.clr
Parameter File: API_2_PAH_GVBYS_1.par
##### 6.2.7.11.3 Test procedure {#test-procedure-74 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Call the init() | | | | | method | | | | | | | | | | type = FFh | | | | | | | | | | qualifier = FEh | | | | | | | | | | destination = FDh | | | +----+--------------------+--------------------+------------------+ | | getValueByte(0) | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 01h | | | | | (Command Details | | | | | TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueByte(3) | Toolk | | | | | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 3 | Search TLV 01h | | | | | (Command Details | | | | | TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueByte(2) | Result is FEh | | | | | (qualifier) | | +----+--------------------+--------------------+------------------+ | 4 | Search TLV 02h | | | | | (Device Identities | | | | | TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueByte(0) | Result is 81h | | | | | (Source) | | +----+--------------------+--------------------+------------------+ | 5 | initDisplayText() | | | | | | | | | | buffer = 00 01 ... | | | | | 7D | | | | | | | | | | length = 7Eh | | | | | | | | | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueByte(7E) | Result is 7Dh | | +----+--------------------+--------------------+------------------+ | 6 | initDisplayText() | | | | | | | | | | buffer = 00 01 ... | | | | | 7D 7E | | | | | | | | | | length = 7Fh | | | | | | | | | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueByte(7E) | Result is 7Dh | | +----+--------------------+--------------------+------------------+ | 7 | getValueByte(7F) | Result is 7Eh | | +----+--------------------+--------------------+------------------+ | 8 | initDisplayText() | | | | | | | | | | buffer = 00 01 ... | | | | | EF | | | | | | | | | | length = F0h | | | | | | | | | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+------------------+ | | getValueByte(F0) | Result is EFh | | +----+--------------------+--------------------+------------------+
##### 6.2.7.11.4 Test Coverage {#test-coverage-72 .H6}
CRR number Test case number
* * *
N1 3, 4, 5, 6, 7, 8 P1 2 C1 Does not apply for Proactive Handler C2 1
#### 6.2.7.12 Method copyValue
Test Area Reference API_2_PAH_CPYVS_BSS
##### 6.2.7.12.1 Conformance requirement {#conformance-requirement-61 .H6}
The method with following header shall be compliant with its definition in the
API.
public short copyValue(short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.12.1.1 Normal execution {#normal-execution-75 .H6}
  * CRRN1: copies a part of the last TLV element which has been found, > into a destination. buffer.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.7.12.1.2 Parameter errors {#parameter-errors-46 .H6}
  * CRRP1: if dstBuffer is null NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if valueOffset is negative or valueOffset + dstLength > > current TLV length, an instance of ToolkitException shall be > thrown. The reason code shall be ToolkitException > OUT_OF_TLV_BOUNDARIES.
##### 6.2.7.12.1.3 Context errors {#context-errors-73 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.7.12.2 Test Suite files {#test-suite-files-75 .H6}
Test Script: API_2_PAH_CPYVS_BSS_1.scr
Test Applet: API_2_PAH_CPYVS_BSS_1.java
Load Script: API_2_PAH_CPYVS_BSS_1.ldr
Cleanup Script: API_2_PAH_CPYVS_BSS_1.clr
Parameter File: API_2_PAH_CPYVS_BSS_1.par
##### 6.2.7.12.3 Test procedure {#test-procedure-75 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | | | | | | | | Select a TLV | | | +----+--------------------+--------------------+------------------+ | | copyValue() with a | Nu | | | | null dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | initDisplayText() | | | | | with length = 15 | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 7 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | [Select Text | Toolk | | | | String TLV] | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset \ Text | is thrown | | | | String length | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | [Select Text | Toolk | | | | String TLV] | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset + | is thrown | | | | dstLength > Text | | | | | String length | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | copyValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is 17 | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 14 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is 15 | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 12 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.12.4 Test Coverage {#test-coverage-73 .H6}
CRR number Test case number
* * *
N1 13, 15 N2 12, 14 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 Does not apply for
Proactive Handler C2 11
#### 6.2.7.13 Method compareValue
Test Area Reference API_2_PAH_CPRVS_BSS
##### 6.2.7.13.1 Conformance requirement {#conformance-requirement-62 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte compareValue(short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.13.1.1 Normal execution {#normal-execution-76 .H6}
Compares the last found TLV element with a buffer:
  * CRRN1: returns 0 if identical.
  * CRRN2: returns -1 if the first miscomparing byte in simple TLV List > is less than that in compareBuffer.
  * CRRN3: returns 1 if the first miscomparing byte in simple TLV List > is greater than that in compareBuffer.
##### 6.2.7.13.1.2 Parameter errors {#parameter-errors-47 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset is negative or valueOffset + dstLength > > current TLV length, an instance of ToolkitException shall be > thrown. The reason code shall be ToolkitException > OUT_OF_TLV_BOUNDARIES.
##### 6.2.7.13.1.3 Context errors {#context-errors-74 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.7.13.2 Test Suite files {#test-suite-files-76 .H6}
Test Script: API_2_PAH_CPRVS_BSS_1.scr
Test Applet: API_2_PAH_CPRVS_BSS_1.java
Load Script: API_2_PAH_CPRVS_BSS_1.ldr
Cleanup Script: API_2_PAH_CPRVS_BSS_1.clr
Parameter File: API_2_PAH_CPRVS_BSS_1.par
##### 6.2.7.13.3 Test procedure {#test-procedure-76 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | | | | | | | | Select a TLV | | | +----+--------------------+--------------------+------------------+ | | compareValue() | Nu | | | | with a null | llPointerException | | | | compareBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | initDisplayText() | | | | | with length = 15 | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | compareOffset > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 6 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 7 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | [Select Text | Toolk | | | | String TLV] | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset \ | is thrown | | | | Text String length | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | [Select Text | Toolk | | | | String TLV] | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset + | is thrown | | | | compareLength > | | | | | Text String length | | | | | | | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | compareValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 02 03 | | | | | | | | | | 04 05 06 07 08 | | | | | | | | | | 05 0A 0B 0C 0D | | | | | | | | | | 0E 10 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 15 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 12 | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 02 01 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0A 0D | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 99 03 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.13.4 Test Coverage {#test-coverage-74 .H6}
CRR number Test case number
* * *
N1 12, 15 N2 13, 16 N3 14, 17, 18 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 Does
not apply for Proactive Handler C2 11
#### 6.2.7.14 Method findAndCopyValue(byte tag, byte[] dstBuffer, short
valueOffset)
Test Area Reference API_2_PAH_FACYB_BS
##### 6.2.7.14.1 Conformance requirement {#conformance-requirement-63 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte[] dstBuffer,
short dstOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.14.1.1 Normal execution {#normal-execution-77 .H6}
  * CRRN1: looks for the first occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + length of the copied value is > returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.7.14.1.2 Parameter errors {#parameter-errors-48 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.7.14.1.3 Context errors {#context-errors-75 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.7.14.2 Test Suite files {#test-suite-files-77 .H6}
Test Script: API_2_PAH_FACYB_BS_1.scr
Test Applet: API_2_PAH_FACYB_BS_1.java
Load Script: API_2_PAH_FACYB_BS_1.ldr
Cleanup Script: API_2_PAH_FACYB_BS_1.clr
Parameter File: API_2_PAH_FACYB_BS_1.par
##### 6.2.7.14.3 Test procedure {#test-procedure-77 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | FindAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | InitDisplayText() | | | | | with length = 15 | | | +----+--------------------+--------------------+------------------+ | | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 0Dh | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 21 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 5 | DstOffset + length | ArrayIndexOu | | | | >dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | DstBuffer.length = | | | | | 20 | | | | | | | | | | DstOffset = 5 | | | +----+--------------------+--------------------+------------------+ | 6 | initDisplayText() | | | +----+--------------------+--------------------+------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 03h | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 7 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | Tag = 0Dh | is 17 | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 9 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | dstBuffer.length = | is 19 | | | | 20 | | | | | | | | | | dstOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 10 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+------------------+ | 11 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | append a 2^nd^ | | | | | Text String TLV | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | tag = 0Dh | is 17 | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 12 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 13 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | (with tag 8Dh) | findAndcopyValue() | | | | | is 17 | | | | tag = 8Dh | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 14 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 15 | Append tag 0Fh | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | (with tag 8Fh) | findAndcopyValue() | | | | | is 16 | | | | tag = 8Fh | | | | | | | | | | dstBuffer.length = | | | | | 16 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 16 | Compare buffer | Result is 00h | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.14.4 Test Coverage {#test-coverage-75 .H6}
CRR number Test case number
* * *
N1 8, 10, 12 N2 6 N3 7, 9, 11 N4 13, 14, 15, 16 P1 1 P2 2, 3, 4, 5 C1 Does not
apply for Proactive Handler
#### 6.2.7.15 Method findAndCopyValue(byte tag, byte occurence, short
valueOffset, byte[] dstBuffer, short dstOffset, short dstLength)
Test Area Reference API_2_PAH_FACYBBS_BSS
##### 6.2.7.15.1 Conformance requirement {#conformance-requirement-64 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte occurence,
short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.15.1.1 Normal execution {#normal-execution-78 .H6}
  * CRRN1: looks for the indicated occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + dstLength is returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.7.15.1.2 Parameter errors {#parameter-errors-49 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset is negative or valueOffset + dstLength > > current TLV length, an instance of ToolkitException shall be > thrown. The reason code shall be ToolkitException > OUT_OF_TLV_BOUNDARIES.
##### 6.2.7.15.1.3 Context errors {#context-errors-76 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.7.15.2 Test Suite files {#test-suite-files-78 .H6}
Test Script: API_2_PAH_FACYBBS_BSS_1.scr
Test Applet: API_2_PAH_FACYBBS_BSS_1.java
Load Script: API_2_PAH_FACYBBS_BSS_1.ldr
Cleanup Script: API_2_PAH_FACYBBS_BSS_1.clr
Parameter File: API_2_PAH_FACYBBS_BSS_1.par
##### 6.2.7.15.3 Test procedure {#test-procedure-78 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | initDisplayText() | | | | | with length = 15 | | | +----+--------------------+--------------------+------------------+ | | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | tag = 0Dh, | is thrown | | | | occurrence = 1 | | | | | | | | | | valueOffset = 7 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | valueOffset \ Text | Toolk | | | | String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | InitDisplayText() | | | +----+--------------------+--------------------+------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 0Dh | AVAILABLE_ELEMENT | | | | | is thrown | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 12 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 0Dh, | is 17 | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 14 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | tag = 0Dh, | is 15 | | | | occurrence = 1 | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 12 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 16 | Append a Text | | | | | String TLV | | | | | | | | | | tag = 0D | | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 (no | | | | | specific DCS byte) | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 0Dh, | is 17 | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 17 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 18 | Successful call | Result of | | | | | findAndCopyValue() | | | | tag = 0Dh, | is 6 | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 19 | Compare buffer | Result is 00h | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 | | | +----+--------------------+--------------------+------------------+ | 20 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | (with tag 8Dh) | findAndcopyValue() | | | | | is 17 | | | | tag = 8Dh | | | | | | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 17 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 17 | | | +----+--------------------+--------------------+------------------+ | 21 | Compare buffer | Result is 00h | | | | | | | | | buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+------------------+ | 22 | Append tag 0Fh | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | (with tag 8Fh) | findAndcopyValue() | | | | | is 16 | | | | tag = 8Fh | | | | | | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 16 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 16 | | | +----+--------------------+--------------------+------------------+ | 23 | Compare buffer | Result is 00h | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.15.4 Test Coverage {#test-coverage-76 .H6}
CRR number Test case number
* * *
N1 13, 15, 17, 19 N2 11 N3 12, 14, 16, 18 N4 20, 21, 22, 23 P1 1 P2 2, 3, 4,
5, 6 P3 7, 8, 9, 10 C1 Does not apply for ProactiveHandler
#### 6.2.7.16 Method findAndCompareValue(byte tag, byte[] compareBuffer, short
compareOffset)
Test Area Reference API_2_PAH_FACRB_BS
##### 6.2.7.16.1 Conformance requirement {#conformance-requirement-65 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte[] compareBuffer,
short compareOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.16.1.1 Normal execution {#normal-execution-79 .H6}
Looks for the first occurrence of a TLV element from beginning of a TLV list
and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical returns 0.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer returns -1.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer returns 1.
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.7.16.1.2 Parameter errors {#parameter-errors-50 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.7.16.1.3 Context errors {#context-errors-77 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.7.16.2 Test Suite files {#test-suite-files-79 .H6}
Test Script: API_2_PAH_FACRB_BS_1.scr
Test Applet: API_2_PAH_FACRB_BS_1.java
Load Script: API_2_PAH_FACRB_BS_1.ldr
Cleanup Script: API_2_PAH_FACRB_BS_1.clr
Parameter File: API_2_PAH_FACRB_BS_1.par
##### 6.2.7.16.3 Test procedure {#test-procedure-79 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | dstBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | initDisplayText() | | | | | with length = 15 | | | +----+--------------------+--------------------+------------------+ | | compareOffset > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 0Dh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 21 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 5 | **compareOffset + | ArrayIndexOu | | | | length >** | tOfBoundsException | | | | co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 5 | | | +----+--------------------+--------------------+------------------+ | 6 | InitDisplayText() | | | +----+--------------------+--------------------+------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 03h | is thrown | | +----+--------------------+--------------------+------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 7 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | tag = 0Dh | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | Verify current TLV | Result is 17 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 9 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 10 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 11 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 12 | append a Text | | | | | String TLV | | | | | | | | | | tag = 0Dh | | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 01 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0D 10 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 15 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = 04 | | | | | 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 17 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 16 | Append tag 0Fh | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 00 | | | | | 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 00 | | | | | 99 01 03 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is +1 | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.16.4 Test Coverage {#test-coverage-77 .H6}
CRR number Test case number
* * *
N1 6 N2 8 N3 7, 11, 12, 17 N4 9, 13 N5 10, 14 N6 15, 16 P1 1 P2 2, 3, 4, 5 C1
Does not apply for Proactive Handler
#### 6.2.7.17 Method findAndCompareValue(byte tag, byte occurence, short
valueOffset, byte[] compareBuffer, short compareOffset, short compareLength)
Test Area Reference API_2_PAH_FACRBBS_BSS
##### 6.2.7.17.1 Conformance requirement {#conformance-requirement-66 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte occurence,
short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.17.1.1 Normal execution {#normal-execution-80 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of a
TLV list and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical 0 is returned.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer -1 is returned.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer 1 is returned.
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.7.17.1.2 Parameter errors {#parameter-errors-51 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset is negative or valueOffset + dstLength > > current TLV length, an instance of ToolkitException shall be > thrown. The reason code shall be ToolkitException > OUT_OF_TLV_BOUNDARIES.
  * CRRP4: if an input parameter is not valid (e.g. occurrence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException BAD_INPUT_PARAMETER.
##### 6.2.7.17.1.3 Context errors {#context-errors-78 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.7.17.2 Test Suite files {#test-suite-files-80 .H6}
Test Script: API_2_PAH_FACRBBS_BSS_1.scr
Test Applet: API_2_PAH_FACRBBS_BSS_1.java
Load Script: API_2_PAH_FACRBBS_BSS_1.ldr
Cleanup Script: API_2_PAH_FACRBBS_BSS_1.clr
Parameter File: API_2_PAH_FACRBBS_BSS_1.par
##### 6.2.7.17.3 Test procedure {#test-procedure-80 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | | | | | handler | | | +----+--------------------+--------------------+------------------+ | | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | compareBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | initDisplayText() | | | | | with length = 15 | | | +----+--------------------+--------------------+------------------+ | | compareOffset > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 6 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | **compareOffset + | ArrayIndexOu | | | | compareLength** | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | tag = 0Dh, | is thrown | | | | occurrence = 1 | | | | | | | | | | valueOffset = 7 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+------------------+ | 8 | valueOffset \ | Toolk | | | | Text String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Text String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Invalid parameter | To | | | | | olkitException.BAD | | | | occurrence = 0 | _INPUT_PARAMETER | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | InitDisplayText() | | | +----+--------------------+--------------------+------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 0Dh | is thrown | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 13 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 14 | Verify current TLV | Result is 17 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 15 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 12 | | | +----+--------------------+--------------------+------------------+ | 18 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 02 01 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 19 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0A 0D | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 20 | append a Text | | | | | String TLV | | | | | | | | | | tag = 0Dh | | | | | | | | | | buffer = 00 11 22 | | | | | 33 44 55 | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 21 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 00 11 22 33 44 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 22 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 00 11 22 33 44 66 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is -1 | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 23 | initDisplayText() | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = 04 | | | | | 00 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 17 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+ | 24 | Append tag 0Fh | | | | | | | | | | buffer = 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = 00 | | | | | 01 ... 0F | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 8Fh) | | | | | | | | | | tag = 8Fh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 16 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 16 | | | +----+--------------------+--------------------+------------------+ | 25 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer | | | | | =0099 02 ... 0F | | | +----+--------------------+--------------------+------------------+ | | fin | Result is +1 | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.17.4 Test Coverage {#test-coverage-78 .H6}
CRR number Test case number
* * *
N1 12 N2 14 N3 13, 17, 20, 21 N4 15, 18, 22 N5 16, 19 N6 23, 24 P1 1 P2 2, 3,
4, 5, 6 P3 7, 8, 9, 10 P4 11 C1 Does not apply for Proactive Handler
#### 6.2.7.18 Method appendArray
Test Area Reference: API_2_PAH_APDA_BSS
##### 6.2.7.18.1 Conformance requirement: {#conformance-requirement-67 .H6}
The method with following header shall be compliant to its definition in the
API.
void appendArray(byte[] buffer,
short offset,
short length)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.18.1.1 Normal execution {#normal-execution-81 .H6}
  * CRRN1: appends a buffer into the Edithandler buffer.
  * CRRN2: a successful append does not modify the TLV selected.
##### 6.2.7.18.1.2 Parameters error {#parameters-error-22 .H6}
  * CRRP1: if buffer is null, a java.lang.NullPointerException is > thrown.
  * CRRP2: if offset or length or both would cause access outside the > array bounds, or if length is negative, a > java.lang.ArrayIndexOutOfBoundsException is thrown.
##### 6.2.7.18.1.3 Context errors {#context-errors-79 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.7.18.2 Test suite files {#test-suite-files-81 .H6}
Test Script: API_2_PAH_APDA_BSS_1.scr
Test Applet: API_2_PAH_APDA_BSS_1.java
Load Script: API_2_PAH_APDA_BSS_1.ldr
Cleanup Script: API_2_PAH_APDA_BSS_1.clr
Parameter File: API_2_PAH_APDA_BSS_1.par
##### 6.2.7.18.3 Test procedure {#test-procedure-81 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Null buffer | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | offset > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer.length = 5 | | | | | | | | | | offset = 6 | | | | | | | | | | length = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | offset \ | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer.length = 5 | | | | | | | | | | offset = 0 | | | | | | | | | | length = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | offset + length > | ArrayIndexOu | | | | buffer.length | tOfBoundsException | | | | | is thrown | | | | buffer.length = 5 | | | | | | | | | | offset = 3 | | | | | | | | | | length = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | length \ element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.7.19.1.2 Parameters error {#parameters-error-23 .H6}
No requirements
##### 6.2.7.19.1.3 Context errors {#context-errors-80 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.7.19.2 Test suite files {#test-suite-files-82 .H6}
Test Script: API_2_PAH_APTLBB_1.scr
Test Applet: API_2_PAH_APTLBB_1.java
Load Script: API_2_PAH_APTLBB_1.ldr
Cleanup Script: API_2_PAH_APTLBB_1.clr
Parameter File: API_2_PAH_APTLBB_1.par
##### 6.2.7.19.3 Test procedure {#test-procedure-82 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Call appendArray() | | | | | | | | | | length = 251 | | | +----+--------------------+--------------------+------------------+ | | Handler Overflow: | ToolkitException | | | | Call the | .HANDLER_OVERFLOW | | | | appendTLV() method | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Initialise handler | | | +----+--------------------+--------------------+------------------+ | | Select Command | | | | | Details TLV | | | +----+--------------------+--------------------+------------------+ | | Call the | | | | | appendTLV() method | | | +----+--------------------+--------------------+------------------+ | | Verify Current | Result is 03h | | | | TLV: Call | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 3 | Clear the handler | | | +----+--------------------+--------------------+------------------+ | | Successful call | | | | | | | | | | tag = 84h | | | | | | | | | | value = 00h | | | +----+--------------------+--------------------+------------------+ | | Call copy() method | | | +----+--------------------+--------------------+------------------+ | | Compare the arrays | Result of | | | | | ja | | | | compareBuffer = 84 | vacard.framework.U | | | | 01 00 | til.arrayCompare() | | | | | is 00h | | +----+--------------------+--------------------+------------------+ | 4 | Successful call | | | | | | | | | | tag = 01h | | | | | | | | | | value = FEh | | | +----+--------------------+--------------------+------------------+ | | Call copy() method | | | +----+--------------------+--------------------+------------------+ | | Compare the arrays | Result of | | | | | ja | | | | compareBuffer = 84 | vacard.framework.U | | | | 01 00 01 01 FE | til.arrayCompare() | | | | | is 00h | | +----+--------------------+--------------------+------------------+ | 5 | Clear the handler | | | +----+--------------------+--------------------+------------------+ | | Call appendArray() | | | | | | | | | | length = 250 | | | | | | | | | | buffer = 00 81 F7 | | | | | 03 04 ... F9 | | | +----+--------------------+--------------------+------------------+ | | Successful call | | | | | | | | | | tag = 84h | | | | | | | | | | value = 00h | | | +----+--------------------+--------------------+------------------+ | | Call getLength() | result = 253 | | | | method | | | +----+--------------------+--------------------+------------------+ | | Call copy() method | | | +----+--------------------+--------------------+------------------+ | | Compare the array | Result of | | | | | ja | | | | compareBuffer = 00 | vacard.framework.U | | | | 81 F7 03 04 ... F9 | til.arrayCompare() | | | | 84 01 00 | is 00h | | +----+--------------------+--------------------+------------------+
##### 6.2.7.19.4 Test Coverage {#test-coverage-80 .H6}
CRR number Test case number
* * *
N1 3, 4, 5 N2 2 C1 1 C2 Does not apply for Proactive Handler
#### 6.2.7.20 Method appendTLV(byte tag, byte value1, byte value2)
Test Area Reference: API_2_PAH_APTLBBB
##### 6.2.7.20.1 Conformance requirements: {#conformance-requirements-15 .H6}
The method with following header shall be compliant to its definition in the
API.
public void appendTLV(byte tag,
byte value1,
byte value2)
throws ToolkitException
##### 6.2.7.20.1.1 Normal execution {#normal-execution-83 .H6}
  * CRRN1: Appends a TLV element to the current TLV list (2-byte > element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.7.20.1.2 Parameters error {#parameters-error-24 .H6}
No requirements
##### 6.2.7.20.1.3 Context errors {#context-errors-81 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
##### 6.2.7.20.2 Test suite files {#test-suite-files-83 .H6}
Test Script: API_2_PAH_APTLBBB_1.scr
Test Applet: API_2_PAH_APTLBBB_1.java
Load Script: API_2_PAH_APTLBBB_1.ldr
Cleanup Script: API_2_PAH_APTLBBB_1.clr
Parameter File: API_2_PAH_APTLBBB_1.par
##### 6.2.7.20.3 Test procedure {#test-procedure-83 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Call the | | | | | initDisplayText() | | | | | | | | | | length = 250 | | | +----+--------------------+--------------------+------------------+ | | Handler Overflow: | ToolkitException | | | | Call the | .HANDLER_OVERFLOW | | | | appendTLV() method | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Initialise handler | | | +----+--------------------+--------------------+------------------+ | | Select Command | | | | | Details TLV | | | +----+--------------------+--------------------+------------------+ | | Call the | | | | | appendTLV() method | | | +----+--------------------+--------------------+------------------+ | | Verify Current | Result is 03h | | | | TLV: Call | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 3 | Clear the handler | | | +----+--------------------+--------------------+------------------+ | | Successful call | | | | | | | | | | tag = 84h | | | | | | | | | | value1 = 00h | | | | | | | | | | value2 = 01h | | | +----+--------------------+--------------------+------------------+ | | Call copy() method | | | +----+--------------------+--------------------+------------------+ | | Compare the arrays | Result of | | | | | ja | | | | compareBuffer = 84 | vacard.framework.U | | | | 02 00 01 | til.arrayCompare() | | | | | is 00h | | +----+--------------------+--------------------+------------------+ | 4 | Successful call | | | | | | | | | | tag = 01h | | | | | | | | | | value1 = FEh | | | | | | | | | | value2 = FDh | | | +----+--------------------+--------------------+------------------+ | | Call copy() method | | | +----+--------------------+--------------------+------------------+ | | Compare the arrays | Result of | | | | | ja | | | | compareBuffer = 84 | vacard.framework.U | | | | 02 00 01 01 02 FE | til.arrayCompare() | | | | FD | is 00h | | +----+--------------------+--------------------+------------------+ | 5 | Clear the handler | | | +----+--------------------+--------------------+------------------+ | | Call appendArray() | | | | | | | | | | length = 249 | | | | | | | | | | buffer = 00 81 F6 | | | | | 03 04 ... F8 | | | +----+--------------------+--------------------+------------------+ | | Successful call | | | | | | | | | | tag = 84h | | | | | | | | | | value1 = 00h | | | | | | | | | | value2 = 01h | | | +----+--------------------+--------------------+------------------+ | | Call getLength() | result = 253 | | | | method | | | +----+--------------------+--------------------+------------------+ | | Call copy() method | | | +----+--------------------+--------------------+------------------+ | | Compare handler | Result of | | | | | ja | | | | compareBuffer = 00 | vacard.framework.U | | | | 81 F6 03 04 ... F8 | til.arrayCompare() | | | | 84 02 00 01 | is 00h | | +----+--------------------+--------------------+------------------+
##### 6.2.7.20.4 Test Coverage {#test-coverage-81 .H6}
CRR number Test case number
* * *
N1 3, 4, 5 N2 2 C1 1 C2 Does not apply for Proactive Handler
#### 6.2.7.21 Method appendTLV(byte tag, byte[] value, short valueoffset,
short valuelength)
Test Area Reference: API_2_PAH_APTLB_BSS
##### 6.2.7.21.1 Conformance requirement {#conformance-requirement-69 .H6}
The method with following header shall be compliant to its definition in the
API.
void appendTLV(byte tag,
byte[] value,
short valueoffset,
short valuelength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.7.21.1.1 Normal execution {#normal-execution-84 .H6}
  * CRRN1: Appends a TLV element to the current TLV list (byte-array > element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.7.21.1.2 Parameters error {#parameters-error-25 .H6}
  * CRRP1: if value is null, a java.lang.NullPointerException is thrown.
  * CRRP2: if valueoffset or valuelength or both would cause access > outside the array bounds, or if length is negative, a > java.lang.ArrayIndexOutOfBoundsException is thrown.
##### 6.2.7.21.1.3 Context errors {#context-errors-82 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
  * CRRC3: if valuelength is greater than 255, a ToolkitException is > thrown with reason code BAD_INPUT_PARAMETER.
##### 6.2.7.21.2 Test suite files {#test-suite-files-84 .H6}
Test Script: API_2_PAH_APTLB_BSS_1.scr
Test Applet: API_2_PAH_APTLB_BSS_1.java
Load Script: API_2_PAH_APTLB_BSS_1.ldr
Cleanup Script: API_2_PAH_APTLB_BSS_1.clr
Parameter File: API_2_PAH_APTLB_BSS_1.par
##### 6.2.7.21.3 Test procedure {#test-procedure-84 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Null value | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | valueOffset > | ArrayIndexOu | | | | value.length | tOfBoundsException | | | | | is thrown | | | | value.length = 5 | | | | | | | | | | valueOffset = 6 | | | | | | | | | | valueLength = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | valueOffset \ | ArrayIndexOu | | | | value.length | tOfBoundsException | | | | | is thrown | | | | value.length = 5 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | valueLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | valueOffset + | ArrayIndexOu | | | | valueLength > | tOfBoundsException | | | | value.length | is thrown | | | | | | | | | value.length = 5 | | | | | | | | | | valueOffset = 3 | | | | | | | | | | valueLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | valueLength \ byte-array element).
  * CRRN2: A successful append does not modify the TLV selected.
##### 6.2.7.22.1.2 Parameters error {#parameters-error-26 .H6}
  * CRRP1: if value2 is null, a java.lang.NullPointerException is > thrown.
  * CRRP2: if value2offset or value2length or both would cause access > outside the array bounds, or if length is negative, a > java.lang.ArrayIndexOutOfBoundsException is thrown.
##### 6.2.7.22.1.3 Context errors {#context-errors-83 .H6}
  * CRRC1: if the EditHandler buffer is too small to append the > requested data, a ToolkitException is thrown with reason code > HANDLER_OVERFLOW.
  * CRRC2: if the EditHandler buffer is busy, a ToolkitException is > thrown with reason code HANDLER_NOT_AVAILABLE.
  * CRRC3: if valuelength is greater than 255, a ToolkitException is > thrown with reason code BAD_INPUT_PARAMETER.
##### 6.2.7.22.2 Test suite files {#test-suite-files-85 .H6}
Test Script: API_2_PAH_APTLBB_BSS_1.scr
Test Applet: API_2_PAH_APTLBB_BSS_1.java
Load Script: API_2_PAH_APTLBB_BSS_1.ldr
Cleanup Script: API_2_PAH_APTLBB_BSS_1.clr
Parameter File: API_2_PAH_APTLBB_BSS_1.par
##### 6.2.7.22.3 Test procedure {#test-procedure-85 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Null value2 | Nu | | | | | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | value2Offset > | ArrayIndexOu | | | | value2.length | tOfBoundsException | | | | | is thrown | | | | value2.length = 5 | | | | | | | | | | value2Offset = 6 | | | | | | | | | | value2Length = 0 | | | +----+--------------------+--------------------+------------------+ | 3 | value2Offset \ | ArrayIndexOu | | | | value2.length | tOfBoundsException | | | | | is thrown | | | | value2.length = 5 | | | | | | | | | | value2Offset = 0 | | | | | | | | | | value2Length = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | value2Offset + | ArrayIndexOu | | | | value2Length > | tOfBoundsException | | | | value2.length | is thrown | | | | | | | | | value2.length = 5 | | | | | | | | | | value2Offset = 3 | | | | | | | | | | value2Length = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | value2Length \ thrown with reason code HANDLER_NOT_AVAILABLE
##### 6.2.7.23.2 Test suite files {#test-suite-files-86 .H6}
Test Script: API_2_PAH_CLER_1.scr
Test Applet: API_2_PAH_CLER_1.java
Load Script: API_2_PAH_CLER_1.ldr
Cleanup Script: API_2_PAH_CLER_1.clr
Parameter File: API_2_PAH_CLER_1.par
##### 6.2.7.23.3 Test procedure {#test-procedure-86 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Initialise the | Result of | | | | handler | getLength() is not | | | | | null | | | | Select Command | | | | | Details TLV | | | | | | | | | | Call the | | | | | getLength() method | | | +----+--------------------+--------------------+------------------+ | | Clear the handler | Result of | | | | | getLength() is 0 | | | | Call the | | | | | getLength() method | | | +----+--------------------+--------------------+------------------+ | 2 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+
##### 6.2.7.23.4 Test Coverage {#test-coverage-84 .H6}
CRR number Test case number
* * *
N1 1 N2 2 C1 Does not apply for Proactive Handler
#### 6.2.7.24 Method getCapacity
Test Area Reference: API_2_PAH_GCAP
##### 6.2.7.24.1 Conformance Requirement {#conformance-requirement-72 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getCapacity()
##### 6.2.7.24.1.1 Normal execution {#normal-execution-87 .H6}
  * CRRN1: The method shall return the maximum size of the Simple TLV > list managed by the handler.
##### 6.2.7.24.2 Test suite files {#test-suite-files-87 .H6}
Test Script: API_2_PAH_GCAP_1.scr
Test Applet: API_2_PAH_GCAP_1.java
Load Script: API_2_PAH_GCAP_1.ldr
Cleanup Script: API_2_PAH_GCAP_1.clr
Parameter File: API_2_PAH_GCAP_1.par
##### 6.2.7.24.3 Test Procedure {#test-procedure-87 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | **ProactiveHandler | 1- Applet is | | | | available** | triggered | | | | | | | | | 1- Send envelope | 2- No exception is | | | | SMS-PP Formatted | thrown | | | | | | | | | 2- The applet | 3- No exception is | | | | calls | thrown, the | | | | getTheHandler() | capacity shall not | | | | | be null | | | | 3- The applet | | | | | calls | 4- No exception is | | | | getCapacity() on | thrown | | | | the | | | | | ProactiveHandler | 5- No exception is | | | | | thrown | | | | 4- The applet | | | | | fills the handler | 6- | | | | with the maximum | HANDLER_OVERFLOW | | | | capacity, using | exception is | | | | appendTLV() method | thrown | | | | | | | | | 5- The applet | | | | | calls clear() on | | | | | the proactive | | | | | handler | | | | | | | | | | 6- The applet | | | | | fills the handler | | | | | with the maximum | | | | | capacity plus one, | | | | | using appendTLV() | | | | | method | | | +----+--------------------+--------------------+------------------+
##### 6.2.7.24.4 Test Coverage {#test-coverage-85 .H6}
CRR number Test case number
* * *
N1 1
#### 6.2.7.25 Method initCloseChannel
Test Area Reference: API_2_PAH_ICCHB
##### 6.2.7.25.1 Conformance requirement {#conformance-requirement-73 .H6}
The method with following header shall be compliant to its definition in the
API.
public void initCloseChannel(byte bChannelIdentifier)
##### 6.2.7.25.1.1 Normal execution {#normal-execution-88 .H6}
  * CRRN1: The method shall build a Close Channel Proactive command, > using Channel Identifier. Comprehension Required flags are set.
  * CRRN2: A call to this method clears the handler then initialises it > with Close Channel Proactive command.
  * CRRN3: After the method invocation, no TLV is selected.
  * CRRN4: The Close Channel Proactive command is not sent by the > method.
##### 6.2.7.25.2 Test suite files {#test-suite-files-88 .H6}
Test Script: API_2_PAH_ICCHB_1.scr
Test Applet: API_2_PAH_ICCHB_1.java
Load Script: API_2_PAH_ICCHB_1.ldr
Cleanup Script: API_2_PAH_ICCHB_1.clr
Parameter File: API_2_PAH_ICCHB_1.par
##### 6.2.7.25.3 Test procedure {#test-procedure-88 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 0 | Applet1 is | | | | | installed with | | | | | maximum number of | | | | | channel = 01. | | | +----+--------------------+--------------------+--------------------+ | 1 | Call | 2- Applet1 is | 1- OPEN CHANNEL | | | initCloseChannel() | triggered. | proactive command | | | method | | is fetched. | | | | 5- Applet1 is not | | | | 1- Call | triggered. | TERMINAL RESPONSE | | | Proac | | of OPEN CHANNEL is | | | tiveHandler.init() | | sent to the SIM | | | method to Open a | | with Channel Id = | | | Channel. | | 01. | | | | | | | | Call the | | 4- CLOSE CHANNEL | | | Proac | | proactive command | | | tiveHandler.send() | | is fetched. | | | method. | | | | | | | TERMINAL RESPONSE | | | 2- Send an | | of CLOSE CHANNEL | | | EVE | | is sent to the | | | NT_EVENT_DOWNLOA | | SIM. | | | D_CHANNEL_STATUS | | | | | Envelope. | | | | | | | | | | 3- Call the | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | method with | | | | | Channel Id = 01. | | | | | | | | | | 4- Call the | | | | | Proac | | | | | tiveHandler.send() | | | | | method. | | | | | | | | | | 5- Send an | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_CHANNEL_STATUS | | | | | Envelope. | | | +----+--------------------+--------------------+--------------------+ | 2 | Call the | 5- Applet1 is not | 1- OPEN CHANNEL | | | initCloseChannel | triggered. | proactive command | | | () method with any | | is fetched. | | | value then build | | | | | and send a Close | | TERMINAL RESPONSE | | | Channel command | | of OPEN CHANNEL is | | | | | sent to the SIM | | | 1- Call | | with Channel Id = | | | Proac | | 01. | | | tiveHandler.init() | | | | | to Open a Channel | | 4- CLOSE CHANNEL | | | and | | proactive command | | | Proac | | is fetched. | | | tiveHandler.send() | | | | | methods. | | TERMINAL RESPONSE | | | | | of CLOSE CHANNEL | | | 2- | | is sent to the | | | ProactiveHandler. | | SIM. | | | initCloseChannel() | | | | | with Channel Id = | | | | | 2 | | | | | | | | | | 3- | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | with the Channel | | | | | Id = 1. | | | | | | | | | | 4- call the send() | | | | | method. | | | | | | | | | | 5- Send an | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_CHANNEL_STATUS | | | | | Envelope. | | | +----+--------------------+--------------------+--------------------+ | 3 | Select a TLV in | 3- | 1- OPEN CHANNEL | | | the | UN | proactive command | | | ProactiveHandler | AVAILABLE_ELEMENT | is fetched. | | | | ToolkitException | | | | Call the | is thrown by | TERMINAL RESPONSE | | | initCloseChannel | getValueLength() | of OPEN CHANNEL is | | | () method | method. | sent to the SIM | | | | | with Channel Id = | | | 1- Call | | 01. | | | Proac | | | | | tiveHandler.init() | | 4- CLOSE CHANNEL | | | method to open a | | proactive command | | | Channel and call | | is fetched. | | | the | | | | | Proac | | TERMINAL RESPONSE | | | tiveHandler.send() | | of CLOSE CHANNEL | | | method. | | is sent to the | | | | | SIM. | | | Select 1^st^ TLV | | | | | of the Proactive | | | | | Handler. | | | | | | | | | | 2- Call | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | method with | | | | | Channel Id = 01. | | | | | | | | | | 3- Call the | | | | | ViewHandle | | | | | r.getValueLength() | | | | | method. | | | | | | | | | | 4- Call | | | | | Proac | | | | | tiveHandler.send() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 4 | Call the | 3- Applet1 is | 1- OPEN CHANNEL | | | initCloseChannel() | triggered. | proactive command | | | without sending | | is fetched. | | | the command | | | | | | | TERMINAL RESPONSE | | | 1- Call | | of OPEN CHANNEL is | | | Proac | | sent to the SIM | | | tiveHandler.init() | | with Channel Id = | | | method to open a | | 01. | | | Channel and call | | | | | the | | No proactive | | | Proac | | command shall be | | | tiveHandler.send() | | sent. Expected | | | method. | | status is \'9000\' | | | | | | | | 2- Call the | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | method with | | | | | Channel Id = 01 | | | | | without | | | | | Proact | | | | | iveHandler.send(). | | | | | | | | | | 3- Send an | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_CHANNEL_STATUS | | | | | Envelope. | | | +----+--------------------+--------------------+--------------------+
##### 6.2.7.25.4 Test Coverage {#test-coverage-86 .H6}
CRR number Test case number
* * *
N1 1 N2 2 N3 3 N4 2, 4
### 6.2.8 Class ProactiveResponseHandler
#### 6.2.8.1 Method copyAdditionalInformation
Test Area Reference: API_2_PRH_CPAI_BSS
##### 6.2.8.1.1 Conformance requirement {#conformance-requirement-74 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copyAdditionalInformation(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.1.1.1 Normal execution {#normal-execution-89 .H6}
  * CRRN1: The copyAdditionalInformation() method shall copy a part of > the additional information field from Result TLV element in > dstBuffer, using dstOffset and dstLength.
  * CRRN2: dstBuffer shall only be modified from dstOffset to > (dstOffset + dstLength - 1) (included).
  * CRRN3: The method returns (dstOffset + dstLength).
  * CRRN4: If a Result TLV element is available, it becomes the TLV > selected after a call to the method.
  * CRRN5: The method shall copy from the first Result TLV.
##### 6.2.8.1.1.2 Parameter errors {#parameter-errors-52 .H6}
  * CRRP1: A NullPointerException shall be thrown if dstBuffer is null.
  * CRRP2: An ArrayIndexOutOfBoundsException shall be thrown if > dstOffset or dstLength or both would cause access outside array > bounds.
##### 6.2.8.1.1.3 Context errors {#context-errors-85 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Result TLV element.
  * CRRC2: A ToolkitException.OUT_OF_TLV_BOUNDARIES shall be thrown > if dstLength is greater than the value field of the available TLV.
##### 6.2.8.1.2 Test Suite files {#test-suite-files-89 .H6}
Test Script: API_2_PRH_CPAI_BSS_1.scr
Test Applet: API_2_PRH_CPAI_BSS_1.java
Load Script: API_2_PRH_CPAI_BSS_1.ldr
Cleanup Script: API_2_PRH_CPAI_BSS_1.clr
Parameter File: API_2_PRH_CPAI_BSS_1.par
##### 6.2.8.1.3 Test procedure {#test-procedure-89 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 0 | | | | | | | | | | dcs = 4 | | | | | | | | | | buffer = \"Text\" | | | +----+--------------------+--------------------+--------------------+ | | **Terminal | | | | | Response with 11 | | | | | additional** bytes | | | | | | | | | | Result TLV = 03 0C | | | | | 01 01 23 45 67 89 | | | | | AB CD EF 01 23 45 | | | +----+--------------------+--------------------+--------------------+ | | NULL as parameter | Nu | | | | to dstBuffer | llPointerException | | | | | is thrown | | | | dstBuffer = NULL | | | +----+--------------------+--------------------+--------------------+ | 2 | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 10 | | | | | | | | | | dstOffset = 11 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 10 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 11 | | | +----+--------------------+--------------------+--------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 10 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+--------------------+ | 6 | dstLength \ data | OUT_O | | | | available | F_TLV_BOUNDARIES | | | | | ToolkitException | | | | dstBuffer.length = | is thrown | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 20 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 5 additional | | | | | bytes | | | | | | | | | | Result TLV = 03 06 | | | | | 01 00 11 22 33 44 | | | +----+--------------------+--------------------+--------------------+ | | Initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = {00h, | | | | | 01h, 02h, 03h...} | | | +----+--------------------+--------------------+--------------------+ | | **Call the | | | | | copyAdditio | | | | | nalInformation()** | | | | | method | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+--------------------+ | | Compare dstBuffer | result of | | | | using | arrayCompare() is | | | | arrayCompare() | 00h | | | | | | | | | src = { | | | | | | | | | | 00h, 01h, 02h, | | | | | 03h, 04h, | | | | | | | | | | 00h, 11h, 22h, | | | | | 33h, 44h, | | | | | | | | | | 0Ah, 0Bh, 0Ch, | | | | | 0Dh, 0Eh, | | | | | | | | | | 0Fh, 10h, 11h, | | | | | 12h, 13h} | | | | | | | | | | srcOffset = 0 | | | | | | | | | | dest = dstBuffer | | | | | | | | | | destOffset = 0 | | | | | | | | | | length = 20 | | | +----+--------------------+--------------------+--------------------+ | 21 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 2 Result TLV | | | | | elements | | | | | | | | | | 1^st^ Result TLV = | | | | | 03 06 01 01 23 45 | | | | | 67 89 | | | | | | | | | | 2^nd^ Result TLV = | | | | | 03 01 00 | | | +----+--------------------+--------------------+--------------------+ | | Successful call to | result of | | | | copyAddit | copyAddit | | | | ionalInformation() | ionalInformation() | | | | | is 05h. | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+--------------------+ | 22 | Compare dstBuffer | result of | | | | using | arrayCompare() is | | | | arrayCompare() | 00h. | | | | | | | | | src = {01, 23, 45, | | | | | 67, 89} | | | | | | | | | | srcOffset = 00 | | | | | | | | | | dest = dstBuffer | | | | | | | | | | destOffset = 0 | | | | | | | | | | length = 5 | | | +----+--------------------+--------------------+--------------------+ | 23 | Call the | Result is 06h. | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 24 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | T | | | | without Result | oolkitException.UN | | | | Simple TLV | AVAILABLE_ELEMENT | | | | | is thrown by | | | | | send() | | +----+--------------------+--------------------+--------------------+ | | Proacti | T | | | | veResponseHandler, | oolkitException.UN | | | | getTheHandler call | AVAILABLE_ELEMENT | | | | copyAddit | is thrown | | | | ionalInformation() | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.1.4 Test Coverage {#test-coverage-87 .H6}
CRR number Test case number
* * *
N1 8, 11, 13, 15, 17, 20, 22 N2 20 N3 7, 10, 12, 14, 16, 21 N4 9, 18, 23 N5
21, 22, 23 P1 1 P2 2, 3, 4, 5, 6 C1 24 C2 19
#### 6.2.8.2 Method copyTextString
Test Area Reference: API_2_PRH_CPTS_BS
##### 6.2.8.2.1 Conformance requirement {#conformance-requirement-75 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copyTextString(byte[] dstBuffer,
short dstOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.2.1.1 Normal execution {#normal-execution-90 .H6}
  * CRRN1: The copyTextString() method copies the text string value from > the first Text String TLV element, using dstBuffer and dstOffset.
  * CRRN2: If a Text String TLV element is available, it becomes the TLV > selected.
  * CRRN3: The method returns (dstOffset + length of copied value).
##### 6.2.8.2.1.2 Parameter errors {#parameter-errors-53 .H6}
  * CRRP1: A NullPointerException shall be thrown if dstBuffer is null.
  * CRRP2: A ArrayIndexOutOfBoundsException shall be thrown if dstOffset > or dstOffset + (length of the TextString to be copied, without the > Data Coding Scheme included), as specified for the returned value, > would cause access outside array bounds.
##### 6.2.8.2.1.3 Context errors {#context-errors-86 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Text String TLV element.
##### 6.2.8.2.2 Test Suite files {#test-suite-files-90 .H6}
Test Script: API_2_PRH_CPTS_BS_1.scr
Test Applet: API_2_PRH_CPTS_BS_1.java
Load Script: API_2_PRH_CPTS_BS_1.ldr
Cleanup Script: API_2_PRH_CPTS_BS_1.clr
Parameter File: API_2_PRH_CPTS_BS_1.par
##### 6.2.8.2.3 Test procedure {#test-procedure-90 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | | | | | | | | minRespLength = | | | | | 00h | | | | | | | | | | maxRespLength = | | | | | FFh | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | | | | | | Text String TLV = | | | | | 0D 02 04 41 | | | +----+--------------------+--------------------+--------------------+ | | **Proact | Nu | | | | iveResponseHandler | llPointerException | | | | .getTheHandler()** | is thrown | | | | ; call the | | | | | copyTextString() | | | | | method with a null | | | | | dstBuffer | | | | | | | | | | dstBuffer = null | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 2 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | | | | | | | | | | Proactive | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | | | | | | Text String TLV = | | | | | 0D 04 04 \"ABC\" | | | +----+--------------------+--------------------+--------------------+ | | dstOffset + text | ArrayIndexOu | | | | length > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 04h | | | | | | | | | | dstOffset = 02h | | | +----+--------------------+--------------------+--------------------+ | 3 | dstOffset \ field from the first Result TLV in the ProactiveResponseHandler.
  * CRRN2: After a successful execution of the method, the Result TLV > becomes the selected TLV of the ProactiveResponseHandler.
##### 6.2.8.3.1.2 Parameter errors {#parameter-errors-54 .H6}
No requirements.
##### 6.2.8.3.1.3 Context errors {#context-errors-87 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Result TLV element.
##### 6.2.8.3.2 Test Suite files {#test-suite-files-91 .H6}
Test Script: API_2_PRH_GTIL_1.scr
Test Applet: API_2_PRH_GTIL_1.java
Load Script: API_2_PRH_GTIL_1.ldr
Cleanup Script: API_2_PRH_GTIL_1.clr
Parameter File: API_2_PRH_GTIL_1.par
##### 6.2.8.3.3 Test procedure {#test-procedure-91 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | without additional | | | | | information | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 00h | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 2 | Call the | Result is 01h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 3 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | ProactiveProactive | | | command | | command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 1 additional | | | | | byte | | | | | | | | | | Result TLV = 03 02 | | | | | 02 55 | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 01h | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 4 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 5 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | ProactiveProactive | | | command | | command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 7Eh | | | | | additional bytes | | | | | | | | | | Result TLV = 03 7F | | | | | 02 55 55 55 ... | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 7Eh | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 6 | Call the | Result is 7Fh | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 7 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | **Terminal | | | | | Response with 7Fh | | | | | additional** bytes | | | | | | | | | | Result TLV = 03 81 | | | | | 80 02 55 55 55 ... | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 7Fh | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 8 | Call the | Result is 80h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 9 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 80h | | | | | additional bytes | | | | | | | | | | Result TLV = 03 81 | | | | | 81 02 55 55 55 ... | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 80h | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 10 | Call the | Result is 81h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 11 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with F2h | | | | | additional bytes | | | | | | | | | | Result TLV = 03 81 | | | | | F3 02 55 55 55 ... | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is F2h | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 12 | Call the | Result is F3h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 13 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 2 Result TLV | | | | | | | | | | 1^st^ Result TLV = | | | | | 03 03 02 01 23 | | | | | | | | | | 2^nd^ Result TLV = | | | | | 03 01 00 | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 02h | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getAdditionalI | | | | | nformationLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 14 | Call the | Result is 03h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 15 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | T | | | | without Result | oolkitException.UN | | | | Simple TLV | AVAILABLE_ELEMENT | | | | | is thrown by | | | | | send() | | +----+--------------------+--------------------+--------------------+ | | Get | | | | | Proact | | | | | iveResponseHandler | | | +----+--------------------+--------------------+--------------------+ | | Call the | T | | | | getAdditionalI | oolkitException.UN | | | | nformationLength() | AVAILABLE_ELEMENT | | | | method | is thrown by | | | | | getAdditiona | | | | | lInformationLength | | | | | () | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.3.4 Test Coverage {#test-coverage-89 .H6}
CRR number Test case number
* * *
N1 1, 3, 5, 7, 9, 11, 13 N2 2, 4, 6, 8, 10, 12, 14 C1 15
#### 6.2.8.4 Method getGeneralResult
Test Area Reference: API_2_PRH_GTGR
##### 6.2.8.4.1 Conformance requirement {#conformance-requirement-77 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getGeneralResult()
throws ToolkitException
##### 6.2.8.4.1.1 Normal execution {#normal-execution-92 .H6}
  * CRRN1: This method returns the general result of a proactive > command.
  * CRRN2: After a successful execution of the method, the Result TLV > becomes the selected TLV of the ProactiveResponseHandler.
##### 6.2.8.4.1.2 Parameter errors {#parameter-errors-55 .H6}
No requirements.
##### 6.2.8.4.1.3 Context errors {#context-errors-88 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Result TLV element.
  * CRRC2: A ToolkitException.OUT_OF_TLV_BOUNDARIES shall be thrown > if the general result byte is missing in the Result Simple TLV.
##### 6.2.8.4.2 Test Suite files {#test-suite-files-92 .H6}
Test Script: API_2_PRH_GTGR_1.scr
Test Applet: API_2_PRH_GTGR_1.java
Load Script: API_2_PRH_GTGR_1.ldr
Cleanup Script: API_2_PRH_GTGR_1.clr
Parameter File: API_2_PRH_GTGR_1.par
##### 6.2.8.4.3 Test procedure {#test-procedure-92 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | | | | | | | | qualifier = 00h | | | | | | | | | | dcs = 04h | | | | | | | | | | buffer = \'Text\' | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with General | | | | | Result = 00 | | | | | (command performed | | | | | successfully) | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result of | | | | ctiveResponseHandl | getGeneralResult() | | | | er.getTheHandler() | is 00h | | | | | | | | | Call the | | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 2 | Call the | Result is 01h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 3 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with General | | | | | Result = 01, | | | | | without Additional | | | | | information on | | | | | result (command | | | | | performed with | | | | | partial | | | | | comprehension) | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result of | | | | ctiveResponseHandl | getGeneralResult() | | | | er.getTheHandler() | is 01h | | | | | | | | | Call the | | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 4 | Call the | Result is 01h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 5 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with General | | | | | Result = 01, with | | | | | Additional | | | | | information on | | | | | result | | | | | | | | | | Result TLV = 03 02 | | | | | 01 55 (command | | | | | performed with | | | | | partial | | | | | comprehension) | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result of | | | | ctiveResponseHandl | getGeneralResult() | | | | er.getTheHandler() | is 01h | | | | | | | | | Call the | | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 6 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 7 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | **Terminal | | | | | Response with | | | | | General Result =** | | | | | 02 | | | | | | | | | | Result TLV = 03 04 | | | | | 02 65 43 21 | | | | | (Missing | | | | | information) | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result of | | | | ctiveResponseHandl | getGeneralResult() | | | | er.getTheHandler() | is 02h | | | | | | | | | Call the | | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 8 | Call the | Result is 04h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 9 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | **Terminal | | | | | Response with 7Fh | | | | | additional** bytes | | | | | | | | | | Result TLV = 03 81 | | | | | 80 02 55 55 55 ... | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result is 02h | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | ; call the | | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 10 | Call the | Result is 80h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 11 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 2 Result TLV | | | | | | | | | | 1^st^ Result TLV = | | | | | 03 02 02 12 | | | | | | | | | | 2^nd^ Result TLV = | | | | | 03 03 03 34 56 | | | +----+--------------------+--------------------+--------------------+ | | **Proact | Result is 02h | | | | iveResponseHandler | | | | | .getTheHandler()** | | | | | ; call the | | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 12 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 13 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | without Result | | | | | Simple TLV | | | +----+--------------------+--------------------+--------------------+ | | Proa | UN | | | | ctiveResponseHandl | AVAILABLE_ELEMENT | | | | er.getTheHandler() | ToolkitException | | | | ; call the | is thrown | | | | getGeneralResult() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 14 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | without General | | | | | Result Byte in | | | | | Result Simple TLV | | | +----+--------------------+--------------------+--------------------+ | | **Proact | OUT_O | | | | iveResponseHandler | F_TLV_BOUNDARIES | | | | .getTheHandler()** | ToolkitException | | | | ; call the | is thrown | | | | getGeneralResult() | | | | | method | | | | | | | | | | Result TLV = 03 00 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.4.4 Test Coverage {#test-coverage-90 .H6}
CRR number Test case number
* * *
N1 1, 3, 5, 7, 9, 11 N2 2, 4, 6, 8, 10, 12 C1 13 C2 14
#### 6.2.8.5 Method getItemIdentifier
Test Area Reference: API_2_PRH_GTII
##### 6.2.8.5.1 Conformance requirement {#conformance-requirement-78 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getItemIdentifier()
throws ToolkitException
##### 6.2.8.5.1.1 Normal execution {#normal-execution-93 .H6}
  * CRRN1: The method returns the item identifier byte value from the > first Item Identifier TLV element.
  * CRRN2: If an Item Identifier TLV element is available, it becomes > the TLV selected.
##### 6.2.8.5.1.2 Parameter errors {#parameter-errors-56 .H6}
No requirements.
##### 6.2.8.5.1.3 Context errors {#context-errors-89 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Item Identifier TLV element.
  * CRRC2: A ToolkitException.OUT_OF_TLV_BOUNDARIES shall be thrown > if the item identifier byte is missing in the Item Identifier > Simple TLV.
##### 6.2.8.5.2 Test Suite files {#test-suite-files-93 .H6}
Test Script: API_2_PRH_GTII_1.scr
Test Applet: API_2_PRH_GTII_1.java
Load Script: API_2_PRH_GTII_1.ldr
Cleanup Script: API_2_PRH_GTII_1.clr
Parameter File: API_2_PRH_GTII_1.par
##### 6.2.8.5.3 Test procedure {#test-procedure-93 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | (no Item | | | | | Identifier TLV | | | | | available) | | | +----+--------------------+--------------------+--------------------+ | | Call to | UN | | | | g | AVAILABLE_ELEMENT | | | | etItemIdentifier() | ToolkitException | | | | with unavailable | is thrown | | | | Item Identifier | | | | | TLV | | | +----+--------------------+--------------------+--------------------+ | 2 | Build and send a | | SELECT ITEM | | | SELECT ITEM | | Proactive command | | | command with 2 | | | | | items (ID=01, 02) | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with Item 1 | | | | | selected | | | | | | | | | | Item Identifier | | | | | TLV = 10 01 01 | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 01h | | | | g | | | | | etItemIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 3 | Call the | Result is 01h | | | | getValueByte() | | | | | method | | | | | | | | | | valueOffset = 00h | | | +----+--------------------+--------------------+--------------------+ | 4 | Build and send a | | SELECT ITEM | | | SELECT ITEM | | Proactive command | | | command with 3 | | | | | items (ID=03, 05, | | | | | 07) | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with Item 5 | | | | | selected | | | | | | | | | | Item Identifier | | | | | TLV = 10 01 05 | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 05h | | | | g | | | | | etItemIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 5 | Call the | Result is 05h | | | | getValueByte() | | | | | method | | | | | | | | | | valueOffset = 00h | | | +----+--------------------+--------------------+--------------------+ | 6 | Build and send a | | SELECT ITEM | | | SELECT ITEM | | Proactive command | | | command with 3 | | | | | items (ID=FDh, | | | | | FEh, FFh) | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with Item FFh | | | | | selected | | | | | | | | | | Item Identifier | | | | | TLV = 10 01 FF | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is FFh | | | | g | | | | | etItemIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 7 | Call the | Result is FFh | | | | getValueByte() | | | | | method | | | | | | | | | | valueOffset = 00h | | | +----+--------------------+--------------------+--------------------+ | 8 | Build and send a | | SELECT ITEM | | | SELECT ITEM | | Proactive command | | | command with 3 | | | | | items (ID=FDh, | | | | | FEh, FFh) | | | +----+--------------------+--------------------+--------------------+ | | **Terminal | | | | | Response with 2 | | | | | Item Identifier** | | | | | TLV | | | | | | | | | | 1^st^ Item | | | | | Identifier TLV = | | | | | 10 01 FFh | | | | | | | | | | 2^nd^ Item | | | | | Identifier TLV = | | | | | 10 01 FEh | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is FFh | | | | g | | | | | etItemIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 9 | Call the | Result is FFh | | | | getValueByte() | | | | | method | | | | | | | | | | valueOffset = 00h | | | +----+--------------------+--------------------+--------------------+ | 10 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | without item | | | | | identifier in the | | | | | Item Identifier | | | | | Simple TLV | | | | | | | | | | Item Identifier | | | | | TLV = 10 00 | | | +----+--------------------+--------------------+--------------------+ | | Call to | OUT_O | | | | g | F_TLV_BOUNDARIES | | | | etItemIdentifier() | ToolkitException | | | | | is thrown | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.5.4 Test Coverage {#test-coverage-91 .H6}
CRR number Test case number
* * *
N1 2, 4, 6, 8 N2 3, 5, 7, 9 C1 1 C2 10
#### 6.2.8.6 Method getTextStringCodingScheme
Test Area Reference: API_2_PRH_GTCS
##### 6.2.8.6.1 Conformance requirement {#conformance-requirement-79 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getTextStringCodingScheme()
throws ToolkitException
##### 6.2.8.6.1.1 Normal execution {#normal-execution-94 .H6}
  * CRRN1: This method returns the data coding scheme from the first > Text String TLV element.
  * CRRN2: If a Text String TLV element is available, it becomes the TLV > selected.
##### 6.2.8.6.1.2 Parameter errors {#parameter-errors-57 .H6}
No requirements.
##### 6.2.8.6.1.3 Context errors {#context-errors-90 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Text String TLV element.
  * CRRC2: A ToolkitException.OUT_OF_TLV_BOUNDARIES shall be thrown > if the Text String TLV is present with a length of 0.
##### 6.2.8.6.2 Test Suite files {#test-suite-files-94 .H6}
Test Script: API_2_PRH_GTCS_1.scr
Test Applet: API_2_PRH_GTCS_1.java
Load Script: API_2_PRH_GTCS_1.ldr
Cleanup Script: API_2_PRH_GTCS_1.clr
Parameter File: API_2_PRH_GTCS_1.par
##### 6.2.8.6.3 Test procedure {#test-procedure-94 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | (no Text String | | | | | TLV element | | | | | available) | | | +----+--------------------+--------------------+--------------------+ | | Call to | UN | | | | getTextSt | AVAILABLE_ELEMENT | | | | ringCodingScheme() | ToolkitException | | | | with unavailable | is thrown | | | | Text String TLV | | | +----+--------------------+--------------------+--------------------+ | 2 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with a null Text | | | | | String TLV | | | | | | | | | | Text String TLV = | | | | | 0D 00 | | | +----+--------------------+--------------------+--------------------+ | | Call the | OUT_O | | | | getTextSt | F_TLV_BOUNDARIES | | | | ringCodingScheme() | ToolkitException | | | | method | is thrown | | +----+--------------------+--------------------+--------------------+ | 3 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | **Terminal | | | | | Response with text | | | | | length = 01h,** | | | | | DCS = 04h | | | | | | | | | | Text String TLV = | | | | | 0D 02 04 \"A\" | | | +----+--------------------+--------------------+--------------------+ | | **Call the | Result is 04h | | | | getTextStri | | | | | ngCodingScheme()** | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 4 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 5 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 02h, DCS = 00h | | | | | | | | | | Text String TLV = | | | | | 0D 03 00 \"BB\" | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 00h | | | | getTextSt | | | | | ringCodingScheme() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 6 | Call the | Result is 03h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 7 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 7Eh, DCS = 08h | | | | | | | | | | Text String TLV = | | | | | 0D 7F 08 01 02 ... | | | | | 7E | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 08h | | | | getTextSt | | | | | ringCodingScheme() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 8 | Call the | Result is 7Fh | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 9 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 7Fh, DCS = 04h | | | | | | | | | | Text String TLV = | | | | | 0D 81 80 04 01 02 | | | | | ... 7F | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 04h | | | | getTextSt | | | | | ringCodingScheme() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 10 | Call the | Result is 80h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 11 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | EFh, DCS = 08h | | | | | | | | | | Text String TLV = | | | | | 0D 81 F0 08 01 02 | | | | | ... EE EF | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 08h | | | | getTextSt | | | | | ringCodingScheme() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 12 | Call the | Result is F0h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 13 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 2 Text String | | | | | TLV | | | | | | | | | | 1^st^ Text String | | | | | TLV = 0D 02 04 41 | | | | | | | | | | 2^nd^ Text String | | | | | TLV = 0D 03 08 42 | | | | | 43 | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 04h | | | | getTextSt | | | | | ringCodingScheme() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 14 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.6.4 Test Coverage {#test-coverage-92 .H6}
CRR number Test case number
* * *
N1 3, 5, 7, 9, 11, 13 N2 4, 6, 8, 10, 12, 14 C1 1 C2 2
#### 6.2.8.7 Method GetTextStringLength
Test Area Reference: API_2_PRH_GTTL
##### 6.2.8.7.1 Conformance requirement {#conformance-requirement-80 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getTextStringLength()
throws ToolkitException
##### 6.2.8.7.1.1 Normal execution {#normal-execution-95 .H6}
  * CRRN1: The getTextStringLength() method returns the text string > length value from the first Text String TLV element.
  * CRRN2: If a Text String TLV element is available, it becomes the TLV > selected.
##### 6.2.8.7.1.2 Parameter errors {#parameter-errors-58 .H6}
No requirements.
##### 6.2.8.7.1.3 Context errors {#context-errors-91 .H6}
  * CRRC1: A ToolkitException.UNAVAILABLE_ELEMENT shall be thrown in > case of unavailable Text String TLV element.
##### 6.2.8.7.2 Test Suite files {#test-suite-files-95 .H6}
Test Script: API_2_PRH_GTTL_1.scr
Test Applet: API_2_PRH_GTTL_1.java
Load Script: API_2_PRH_GTTL_1.ldr
Cleanup Script: API_2_PRH_GTTL_1.clr
Parameter File: API_2_PRH_GTTL_1.par
##### 6.2.8.7.3 Test procedure {#test-procedure-95 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | DISPLAY TEXT | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | (no Text String | | | | | TLV element | | | | | available) | | | +----+--------------------+--------------------+--------------------+ | | Call to | UN | | | | get | AVAILABLE_ELEMENT | | | | TextStringLength() | ToolkitException | | | | with unavailable | is thrown | | | | Text String TLV | | | +----+--------------------+--------------------+--------------------+ | 2 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with a null Text | | | | | String TLV | | | | | | | | | | Text String TLV = | | | | | 0D 00 | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 00h | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 3 | Call the | Result is 00h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 4 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 01h, DCS = 04h | | | | | | | | | | Text String TLV = | | | | | 0D 02 04 \"A\" | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 01h | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 5 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 6 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 02h, DCS = 00h | | | | | | | | | | Text String TLV = | | | | | 0D 03 00 \"BB\" | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 02h | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 7 | Call the | Result is 03h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 8 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 7Eh, DCS = 08h | | | | | | | | | | Text String TLV = | | | | | 0D 7F 08 01 02 ... | | | | | 7E | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 7Eh | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 9 | Call the | Result is 7Fh | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 10 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | 7Fh, DCS = 04h | | | | | | | | | | Text String TLV = | | | | | 0D 81 80 04 01 02 | | | | | ... 7F | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 7Fh | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 11 | Call the | Result is 80h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 12 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with text length = | | | | | EFh, DCS = 04h | | | | | | | | | | Text String TLV = | | | | | 0D 81 F0 04 01 02 | | | | | ... EE EF | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is EFh | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 13 | Call the | Result is F0h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 14 | Build and send a | | GET INPUT | | | GET INPUT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 2 Text String | | | | | TLV | | | | | | | | | | 1^st^ Text String | | | | | TLV = 0D 02 04 41 | | | | | | | | | | 2^nd^ Text String | | | | | TLV = 0D 03 08 42 | | | | | 43 | | | +----+--------------------+--------------------+--------------------+ | | Call the | Result is 01h | | | | get | | | | | TextStringLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 15 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.7.4 Test Coverage {#test-coverage-93 .H6}
CRR number Test case number
* * *
1 2, 4, 6, 8, 10, 12, 14 2 3, 5, 7, 9, 11, 13, 15 3 1
#### 6.2.8.8 Method getTheHandler
Test Area Reference: API_2_PRH_GTHD
##### 6.2.8.8.1 Conformance requirement {#conformance-requirement-81 .H6}
The method with following header shall be compliant to its definition in the
API.
public static ProactiveResponseHandler getTheHandler()
throws ToolkitException
##### 6.2.8.8.1.1 Normal execution {#normal-execution-96 .H6}
  * CRRN1: The method shall return the single system instance of the > ProactiveHandler class.
  * CRRN2: The EnvelopeHandler is a Temporary JCRE Entry Point Object
##### 6.2.8.8.1.2 Parameter errors {#parameter-errors-59 .H6}
No requirements.
##### 6.2.8.8.1.3 Context errors {#context-errors-92 .H6}
  * CRRC1: The method shall throw > ToolkitException.HANDLER_NOT_AVAILABLE if the handler is busy.
##### 6.2.8.8.2 Test Suite files {#test-suite-files-96 .H6}
Test Script: API_2_PRH_GTHD_1.scr
Test Applet: API_2_PRH_GTHD_1.java
Load Script: API_2_PRH_GTHD_1.ldr
Cleanup Script: API_2_PRH_GTHD_1.clr
Parameter File: API_2_PRH_GTHD_1.par
##### 6.2.8.8.3 Test procedure {#test-procedure-96 .H6}
Id Description API Expectation APDU Expectation
* * *
1 Build and send a Proactive Command Proactive Command Terminal Response  
getTheHandler() twice The returned objects shall be the same  
2 getTheHandler() The reference shall be a ProactiveResponseHandler  
3 getTheHandler() The reference shall not be null
##### 6.2.8.8.4 Test Coverage {#test-coverage-94 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 Checked in Framework tests: FWK_API_HEPO (test case 4) C1
Checked in Framework tests: FWK_MHA_PRHD
#### 6.2.8.9 Method getLength
Test Area Reference API_2_PRH_GLEN
##### 6.2.8.9.1 Conformance requirement {#conformance-requirement-82 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getLength()
throws ToolkitException
##### 6.2.8.9.1.1 Normal execution {#normal-execution-97 .H6}
  * CRRN1: returns the length in bytes of the TLV list.
##### 6.2.8.9.1.2 Parameter errors {#parameter-errors-60 .H6}
No requirements.
##### 6.2.8.9.1.3 Context errors {#context-errors-93 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be > ToolkitException.HANDLER_NOT_AVAILABLE.
##### 6.2.8.9.2 Test Suite files {#test-suite-files-97 .H6}
Test Script: API_2_PRH_GLEN_1.scr
Test Applet: API_2_PRH_GLEN_1.java
Load Script: API_2_PRH_GLEN_1.ldr
Cleanup Script: API_2_PRH_GLEN_1.clr
Parameter File: API_2_PRH_GLEN_1.par
##### 6.2.8.9.3 Test procedure {#test-procedure-97 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Build and send a | | DISPLAY TEXT | | | Display Text | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | without additional | | | | | information in | | | | | General Result TLV | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result of | | | | ctiveResponseHandl | getLength() is 12 | | | | er.getTheHandler() | | | | | | | | | | getLength() | | | +----+--------------------+--------------------+--------------------+ | 2 | Build and send a | | DISPLAY TEXT | | | Display Text | | Proactive command | | | command | | | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with F2h | | | | | additional | | | | | information in | | | | | General Result TLV | | | +----+--------------------+--------------------+--------------------+ | | Proa | Result of | | | | ctiveResponseHandl | getLength() is FFh | | | | er.getTheHandler() | | | | | | | | | | getLength() | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.9.4 Test Coverage {#test-coverage-95 .H6}
CRR number Test case number
* * *
N1 1, 2 C1 Does not apply for Proactive Response Handler
#### 6.2.8.10 Method copy
Test Area Reference API_2_PRH_COPY_BSS
##### 6.2.8.10.1 Conformance requirement {#conformance-requirement-83 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copy(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.10.1.1 Normal execution {#normal-execution-98 .H6}
  * CRRN1: copies the simple TLV list contained in the handler to the > destination byte array.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.8.10.1.2 Parameter errors {#parameter-errors-61 .H6}
  * CRRP1: if dstBuffer is null a NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative, an > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if dstLength is grater than the length of the simple TLV > List, an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException. OUT_OF_TLV_BOUNDARIES.
##### 6.2.8.10.1.3 Context errors {#context-errors-94 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.8.10.2 Test Suite files {#test-suite-files-98 .H6}
Test Script: API_2_PRH_COPY_BSS_1.scr
Test Applet: API_2_PRH_COPY_BSS_1.java
Load Script: API_2_PRH_COPY_BSS_1.ldr
Cleanup Script: API_2_PRH_COPY_BSS_1.clr
Parameter File: API_2_PRH_COPY_BSS_1.par
##### 6.2.8.10.3 Test procedure {#test-procedure-98 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a DISPLAY | | DISPLAY TEXT | | | TEXT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | without Additional | | | | | Information in | | | | | General Result | | | | | TLV: | | | | | | | | | | 81 03 01 21 00 02 | | | | | 02 82 81 03 01 00 | | | +----+--------------------+--------------------+--------------------+ | | Proa | Nu | | | | ctiveResponseHandl | llPointerException | | | | er.getTheHandler() | is thrown | | | | | | | | | copy() with NULL | | | | | as parameter to | | | | | dstBuffer | | | +----+--------------------+--------------------+--------------------+ | 2 | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+--------------------+ | 6 | dstLength \ | Toolk | | | | length of the | itException.OUT_O | | | | simple TLV list | F_TLV_BOUNDARIES | | | | | is thrown | | | | dstBuffer.length = | | | | | 13 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 13 | | | +----+--------------------+--------------------+--------------------+ | 8 | Successful call, | Result of copy() | | | | dstBuffer is the | is 12 | | | | whole buffer | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 12 | | | +----+--------------------+--------------------+--------------------+ | 9 | Compare the buffer | Result of | | | | with buffer: | arrayCompare() is | | | | | 0 | | | | 81 03 01 21 00 02 | | | | | 02 82 81 03 01 00 | | | +----+--------------------+--------------------+--------------------+ | 10 | Successful call, | Result of copy() | | | | dstBuffer is part | is 15 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 12 | | | +----+--------------------+--------------------+--------------------+ | 11 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | | | Reference = | | | | | | | | | | 00 01 02 | | | | | | | | | | 81 03 01 21 00 | | | | | | | | | | 02 02 82 81 | | | | | | | | | | 03 01 00 | | | | | | | | | | 0F 10 11 12 13 | | | +----+--------------------+--------------------+--------------------+ | 12 | Initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 00h | | | | | 01h 02h ... 13h | | | +----+--------------------+--------------------+--------------------+ | | Successful call, | Result of copy() | | | | dstBuffer is part | is 12 | | | | of a buffer | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 9 | | | +----+--------------------+--------------------+--------------------+ | 13 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | | | Reference = | | | | | | | | | | 00 01 02 | | | | | | | | | | 81 03 01 21 00 | | | | | | | | | | 02 02 82 81 | | | | | | | | | | 0C 0D 0E | | | | | | | | | | 0F 10 11 12 13 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.10.4 Test Coverage {#test-coverage-96 .H6}
CRR number Test case number
* * *
N1 9, 11, 13 N2 8, 10, 12 P1 1 P2 2, 3, 4, 5, 6 P3 7 C1 Does not apply for
Proactive Response Handler
#### 6.2.8.11 Method findTLV
Test Area Reference API_2_PRH_FINDBB
##### 6.2.8.11.1 Conformance requirement {#conformance-requirement-84 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findTLV(byte tag, byte occurrence)
throws ToolkitException
##### 6.2.8.11.1.1 Normal execution {#normal-execution-99 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of the
TLV list (handler buffer):
  * CRRN1: the method is successful if the required occurrence exists > then the corresponding TLV becomes current.
  * CRRN2: if the method is successful then it returns > TLV_FOUND_CR_SET when Comprehension Required flag is set.
  * CRRN3: if the method is successful then it returns > TLV_FOUND_CR_NOT_SET when Comprehension Required flag is not > set.
  * CRRN4: if the required occurrence of the TLV element does not exist, > the current TLV is no longer defined and TLV_NOT_FOUND is > returned.
  * CRRN5: The search method is comprehension required flag independent.
##### 6.2.8.11.1.2 Parameter errors {#parameter-errors-62 .H6}
  * CRRP1: if an input parameter is not valid (e.g. occurrence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException BAD_INPUT_PARAMETER.
##### 6.2.8.11.1.3 Context errors {#context-errors-95 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.8.11.2 Test Suite files {#test-suite-files-99 .H6}
Test Script: API_2_PRH_FINDBB_1.scr
Test Applet: API_2_PRH_FINDBB_1.java
Load Script: API_2_PRH_FINDBB_1.ldr
Cleanup Script: API_2_PRH_FINDBB_1.clr
Parameter File: API_2_PRH_FINDBB_1.par
##### 6.2.8.11.3 Test procedure {#test-procedure-99 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a DISPLAY | | DISPLAY TEXT | | | TEXT command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | with 2 General | | | | | Result TLV | | | | | | | | | | 81 03 01 21 00 | | | | | | | | | | 82 02 82 81 | | | | | | | | | | 03 01 00 | | | | | | | | | | 03 02 01 12 | | | +----+--------------------+--------------------+--------------------+ | | findTLV() with | To | | | | Invalid input | olkitException.BAD | | | | parameter | _INPUT_PARAMETER | | | | | is thrown | | | | occurrence = 0 | | | +----+--------------------+--------------------+--------------------+ | 2 | Search 1^st^ TLV | Result is | | | | | T | | | | tag = 01h | LV_FOUND_CR_SET | | | | | | | | | occurrence = 1 | | | +----+--------------------+--------------------+--------------------+ | 3 | Call the | Result is 03h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 4 | Search 2^nd^ TLV | Result is | | | | | T | | | | tag = 02h | LV_FOUND_CR_SET | | | | | | | | | occurrence = 1 | | | +----+--------------------+--------------------+--------------------+ | 5 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+--------------------+ | | Search a wrong tag | Result is | | | | | TLV_NOT_FOUND | | | | tag = 04h | | | | | | | | | | occurrence = 1 | | | +----+--------------------+--------------------+--------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | shall be thrown | | +----+--------------------+--------------------+--------------------+ | 8 | Search a tag with | Result is | | | | wrong occurrence | TLV_NOT_FOUND | | | | | | | | | tag = 01h | | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+--------------------+ | 9 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | shall be thrown. | | +----+--------------------+--------------------+--------------------+ | 10 | Search 3^rd^ TLV | Result is | | | | | TLV_F | | | | tag = 03h | OUND_CR_NOT_SET | | | | | | | | | occurrence = 1 | | | +----+--------------------+--------------------+--------------------+ | 11 | Call the | Result is 01h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 12 | Search 3^rd^ TLV | Result is | | | | | TLV_F | | | | tag = 03h | OUND_CR_NOT_SET | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+--------------------+ | 13 | Call the | Result is 02h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 14 | Search tag 83h | Result is | | | | | TLV_F | | | | Tag = 83h | OUND_CR_NOT_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+--------------------+ | 15 | Search tag 82h | Result is | | | | | T | | | | Tag = 82h | LV_FOUND_CR_SET | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.11.4 Test Coverage {#test-coverage-97 .H6}
CRR number Test case number
* * *
N1 3, 5, 11, 13 N2 2, 4 N3 10, 12 N4 6, 7,8, 9 N5 14,15 P1 1 C1 Does not apply
for Proactive Response Handler
#### 6.2.8.12 Method getValueLength
Test Area Reference API_2_PRH_GVLE
##### 6.2.8.12.1 Conformance requirement {#conformance-requirement-85 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getValueLength()
throws ToolkitException
##### 6.2.8.12.1.1 Normal execution {#normal-execution-100 .H6}
  * CRRN1: gets and returns the binary length of the value field for the > last TLV element which has been found in the handler.
##### 6.2.8.12.1.2 Parameter errors {#parameter-errors-63 .H6}
No requirements.
##### 6.2.8.12.1.3 Context errors {#context-errors-96 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.8.12.2 Test Suite files {#test-suite-files-100 .H6}
Test Script: API_2_PRH_GVLE_1.scr
Test Applet: API_2_PRH_GVLE_1.java
Load Script: API_2_PRH_GVLE_1.ldr
Cleanup Script: API_2_PRH_GVLE_1.clr
Parameter File: API_2_PRH_GVLE_1.par
##### 6.2.8.12.3 Test procedure {#test-procedure-100 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | | | | | | Text String TLV = | | | | | 0D 00 | | | +----+--------------------+--------------------+--------------------+ | | Proa | T | | | | ctiveResponseHandl | oolkitException.UN | | | | er.getTheHandler() | AVAILABLE_ELEMENT | | | | | is thrown | | | | GetValueLength() | | | +----+--------------------+--------------------+--------------------+ | 2 | Search TLV 0Dh | | | +----+--------------------+--------------------+--------------------+ | | getValueLength() | Result is 00h | | +----+--------------------+--------------------+--------------------+ | 3 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response | | | | | | | | | | Text String TLV = | | | | | 0D 02 04 41 | | | +----+--------------------+--------------------+--------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueLength() | Result is 02h | | +----+--------------------+--------------------+--------------------+ | 4 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 7Eh | | | | | | | | | | Text String TLV = | | | | | 0D 7F 04 01 02 ... | | | | | 7E | | | +----+--------------------+--------------------+--------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueLength() | Result is 7Fh | | +----+--------------------+--------------------+--------------------+ | 5 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 7Fh | | | | | | | | | | Text String TLV = | | | | | 0D 81 80 04 01 02 | | | | | ... 7E 7F | | | +----+--------------------+--------------------+--------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueLength() | Result is 80h | | +----+--------------------+--------------------+--------------------+ | 6 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = EFh | | | | | | | | | | Text String TLV = | | | | | 0D 81 F0 04 01 02 | | | | | ... EF | | | +----+--------------------+--------------------+--------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueLength() | Result is F0h | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.12.4 Test Coverage {#test-coverage-98 .H6}
CRR number Test case number
* * *
N1 2, 3, 4, 5, 6 C1 Does not apply for Proactive Response Handler C2 1
#### 6.2.8.13 Method getValueByte
Test Area Reference API_2_PRH_GVBYS
##### 6.2.8.13.1 Conformance requirement {#conformance-requirement-86 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getValueByte(short valueOffset)
throws ToolkitException
##### 6.2.8.13.1.1 Normal execution {#normal-execution-101 .H6}
  * CRRN1: Gets a byte from the last TLV element which has been found in > the handler and returns its value (1 byte).
##### 6.2.8.13.1.2 Parameter errors {#parameter-errors-64 .H6}
  * CRRP1: if valueOffset is out of the current TLV an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.8.13.1.3 Context errors {#context-errors-97 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.8.13.2 Test Suite files {#test-suite-files-101 .H6}
Test Script: API_2_PRH_GVBYS_1.scr
Test Applet: API_2_PRH_GVBYS_1.java
Load Script: API_2_PRH_GVBYS_1.ldr
Cleanup Script: API_2_PRH_GVBYS_1.clr
Parameter File: API_2_PRH_GVBYS_1.par
##### 6.2.8.13.3 Test procedure {#test-procedure-101 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 7Eh | | | | | | | | | | Text String TLV = | | | | | 0D 7F 04 01 02 ... | | | | | 7E | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | getValueByte(0) | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 2 | Search TLV 01h | | | | | (Command Details | | | | | TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueByte(3) | Toolk | | | | | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 3 | Search TLV 01h | | | | | (Command Details | | | | | TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueByte(2) | Result is 00h | | | | | (qualifier) | | +----+--------------------+--------------------+--------------------+ | 4 | Search TLV 02h | | | | | (Device Identities | | | | | TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueByte(0) | Result is 82h | | | | | (Source) | | +----+--------------------+--------------------+--------------------+ | 5 | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueByte(7E) | Result is 7Eh | | +----+--------------------+--------------------+--------------------+ | 6 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = EFh | | | | | | | | | | Text String TLV = | | | | | 0D 81 F0 04 01 02 | | | | | ... 7E 7F ... EF | | | +----+--------------------+--------------------+--------------------+ | | Search TLV 0Dh | | | | | (Text String TLV) | | | +----+--------------------+--------------------+--------------------+ | | getValueByte(7E) | Result is 7Eh | | +----+--------------------+--------------------+--------------------+ | 7 | GetValueByte(7F) | Result is 7Fh | | +----+--------------------+--------------------+--------------------+ | 8 | GetValueByte(EF) | Result is EFh | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.13.4 Test Coverage {#test-coverage-99 .H6}
CRR number Test case number
* * *
N1 3, 4, 5, 6, 7, 8 P1 2 C1 Does not apply for Proactive Response Handler C2 1
#### 6.2.8.14 Method copyValue
Test Area Reference API_2_PRH_CPYVS_BSS
##### 6.2.8.14.1 Conformance requirement {#conformance-requirement-87 .H6}
The method with following header shall be compliant with its definition in the
API.
public short copyValue(short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.14.1.1 Normal execution {#normal-execution-102 .H6}
  * CRRN1: copies a part of the last TLV element which has been found, > into a destination. buffer.
  * CRRN2: returns dstOffset + dstLength.
##### 6.2.8.14.1.2 Parameter errors {#parameter-errors-65 .H6}
  * CRRP1: if dstBuffer is null NullPointerException is thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException is thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.8.14.1.3 Context errors {#context-errors-98 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.8.14.2 Test Suite files {#test-suite-files-102 .H6}
Test Script: API_2_PRH_CPYVS_BSS_1.scr
Test Applet: API_2_PRH_CPYVS_BSS_1.java
Load Script: API_2_PRH_CPYVS_BSS_1.ldr
Cleanup Script: API_2_PRH_CPYVS_BSS_1.clr
Parameter File: API_2_PRH_CPYVS_BSS_1.par
##### 6.2.8.14.3 Test procedure {#test-procedure-102 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 5 | | | | | | | | | | Text String TLV = | | | | | 0D 06 04 01 02 ... | | | | | 05 | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+--------------------+ | | CopyValue() with a | Nu | | | | null dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 2 | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+--------------------+ | 6 | dstLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 7 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 8 | valueOffset \ Text | Toolk | | | | String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+--------------------+ | 10 | **ValueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String** length | F_TLV_BOUNDARIES | | | | | is thrown | | | | ValueOffset = 2 | | | | | | | | | | DstBuffer.length = | | | | | 15 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 5 | | | +----+--------------------+--------------------+--------------------+ | 11 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Pr | | | | | oactiveResponseHan | | | | | dler.getTheHandler | | | +----+--------------------+--------------------+--------------------+ | | CopyValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 12 | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | | copyValue() is 17 | | | | ValueOffset = 0 | | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+ | 14 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | | copyValue() is 15 | | | | ValueOffset = 2 | | | | | | | | | | DstBuffer.length = | | | | | 20 | | | | | | | | | | DstOffset = 3 | | | | | | | | | | DstLength = 12 | | | +----+--------------------+--------------------+--------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | Buffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.14.4 Test Coverage {#test-coverage-100 .H6}
CRR number Test case number
* * *
N1 13, 15 N2 12, 14 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 Does not apply for
Proactive Response Handler C2 11
#### 6.2.8.15 Method compareValue
Test Area Reference API_2_PRH_CPRVS_BSS
##### 6.2.8.15.1 Conformance requirement {#conformance-requirement-88 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte compareValue(short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.15.1.1 Normal execution {#normal-execution-103 .H6}
Compares the last found TLV element with a buffer:
  * CRRN1: returns 0 if identical.
  * CRRN2: returns -1 if the first miscomparing byte in simple TLV List > is less than that in compareBuffer.
  * CRRN3: returns 1 if the first miscomparing byte in simple TLV List > is greater than that in compareBuffer.
##### 6.2.8.15.1.2 Parameter errors {#parameter-errors-66 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.8.15.1.3 Context errors {#context-errors-99 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
  * CRRC2: in case of unavailable TLV element an instance of > ToolkitException shall be thrown. The reason code shall be > ToolkitException UNAVAILABLE_ELEMENT.
##### 6.2.8.15.2 Test Suite files {#test-suite-files-103 .H6}
Test Script: API_2_PRH_CPRVS_BSS_1.scr
Test Applet: API_2_PRH_CPRVS_BSS_1.java
Load Script: API_2_PRH_CPRVS_BSS_1.ldr
Cleanup Script: API_2_PRH_CPRVS_BSS_1.clr
Parameter File: API_2_PRH_CPRVS_BSS_1.par
##### 6.2.8.15.3 Test procedure {#test-procedure-103 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 5 | | | | | | | | | | Text String TLV = | | | | | 0D 06 04 01 02 ... | | | | | 05 | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | | | | | | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+--------------------+ | | compareValue() | Nu | | | | with a null | llPointerException | | | | compareBuffer | is thrown | | +----+--------------------+--------------------+--------------------+ | 2 | compareOffset > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 6 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+--------------------+ | 6 | compareLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 7 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 8 | valueOffset \ | Toolk | | | | Text String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+--------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Text String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+--------------------+ | 11 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | CompareValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 12 | Select Text String | | | | | TLV | | | +----+--------------------+--------------------+--------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | | | | | | ValueOffset = 0 | | | | | | | | | | CompareOffset = 0 | | | | | | | | | | CompareLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 15 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | | | | | | ValueOffset = 2 | | | | | | | | | | CompareOffset = 3 | | | | | | | | | | CompareLength = 12 | | | +----+--------------------+--------------------+--------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 55 02 01 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0A 0D | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.15.4 Test Coverage {#test-coverage-101 .H6}
CRR number Test case number
* * *
N1 12, 15 N2 13, 16 N3 14, 17 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 Does not
apply for Proactive Response Handler C2 11
#### 6.2.8.16 Method findAndCopyValue(byte tag, byte[] dstBuffer, short
valueOffset)
Test Area Reference API_2_PRH_FACYB_BS
##### 6.2.8.16.1 Conformance requirement {#conformance-requirement-89 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte[] dstBuffer,
short dstOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.16.1.1 Normal execution {#normal-execution-104 .H6}
  * CRRN1: looks for the first occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + length of the copied value is > returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.8.16.1.2 Parameter errors {#parameter-errors-67 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.8.16.1.3 Context errors {#context-errors-100 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.8.16.2 Test Suite files {#test-suite-files-104 .H6}
Test Script: API_2_PRH_FACYB_BS_1.scr
Test Applet: API_2_PRH_FACYB_BS_1.java
Load Script: API_2_PRH_FACYB_BS_1.ldr
Cleanup Script: API_2_PRH_FACYB_BS_1.clr
Parameter File: API_2_PRH_FACYB_BS_1.par
##### 6.2.8.16.3 Test procedure {#test-procedure-104 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 15 | | | | | | | | | | Text String TLV = | | | | | 0D 10 04 01 02 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | FindAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+--------------------+ | 2 | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 0Dh | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 21 | | | +----+--------------------+--------------------+--------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 5 | dstOffset + length | ArrayIndexOu | | | | >dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 5 | | | +----+--------------------+--------------------+--------------------+ | 6 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+--------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 04h | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+--------------------+ | 7 | Successful call | Result of | | | | | findAndcopyValue() | | | | Tag = 0Dh | is 17 | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 8 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+ | 9 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | DstBuffer.length = | is 19 | | | | 20 | | | | | | | | | | DstOffset = 2 | | | +----+--------------------+--------------------+--------------------+ | 10 | Compare buffer | Result is 00h | | | | | | | | | Buffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+--------------------+ | 11 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | with 2 Text String | | | | | TLV | | | | | | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | | | | | | | | 0D 02 04 41 | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | Tag = 0Dh | is 17 | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 12 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+ | 13 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | (with tag 8Dh) | findAndcopyValue() | | | | | is 17 | | | | Tag = 8Dh | | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 14 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.16.4 Test Coverage {#test-coverage-102 .H6}
CRR number Test case number
* * *
N1 8, 10, 12 N2 6 N3 7, 9, 11 N4 13, 14 P1 1 P2 2, 3, 4, 5 C1 Does not apply
for Proactive Response Handler
#### 6.2.8.17 Method findAndCopyValue(byte tag, byte occurence, short
valueOffset, byte[] dstBuffer, short dstOffset, short dstLength)
Test Area Reference API_2_PRH_FACYBBS_BSS
##### 6.2.8.17.1 Conformance requirement {#conformance-requirement-90 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte occurence,
short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.17.1.1 Normal execution {#normal-execution-105 .H6}
  * CRRN1: looks for the indicated occurrence of a TLV element from the > beginning of a TLV list and copy its value into a destination > buffer.
  * CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN3: if the method is successful then the corresponding TLV > becomes current and dstOffset + dstLength is returned.
  * CRRN4: The search method is comprehension required flag independent.
##### 6.2.8.17.1.2 Parameter errors {#parameter-errors-68 .H6}
  * CRRP1: if dstBuffer is null NullPointerException shall be thrown.
  * CRRP2: if dstOffset or dstLength or both would cause access outside > array bounds, or if dstLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, dstLength or both are out of the current TLV > an instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 6.2.8.17.1.3 Context errors {#context-errors-101 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.8.17.2 Test Suite files {#test-suite-files-105 .H6}
Test Script: API_2_PRH_FACYBBS_BSS_1.scr
Test Applet: API_2_PRH_FACYBBS_BSS_1.java
Load Script: API_2_PRH_FACYBBS_BSS_1.ldr
Cleanup Script: API_2_PRH_FACYBBS_BSS_1.clr
Parameter File: API_2_PRH_FACYBBS_BSS_1.par
##### 6.2.8.17.3 Test procedure {#test-procedure-105 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 15 | | | | | | | | | | Text String TLV = | | | | | 0D 10 04 01 02 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | findAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+--------------------+ | 2 | dstOffset > | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 6 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+--------------------+ | 6 | dstLength \ | Toolk | | | | Text String Length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | tag = 0Dh, | is thrown | | | | occurrence = 1 | | | | | | | | | | valueOffset = 7 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 8 | valueOffset \ Text | Toolk | | | | String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+--------------------+ | 10 | valueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+--------------------+ | 11 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+--------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 0Dh | AVAILABLE_ELEMENT | | | | | is thrown | | | | occurrence = 2 | | | +----+--------------------+--------------------+--------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+--------------------+ | 12 | Successful call | Result of | | | | | findAndCopyValue() | | | | Tag = 0Dh, | is 17 | | | | occurrence = 1 | | | | | | | | | | ValueOffset = 0 | | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+ | 14 | initialise | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | | findAndcopyValue() | | | | Tag = 0Dh, | is 15 | | | | occurrence = 1 | | | | | | | | | | ValueOffset = 2 | | | | | | | | | | DstBuffer.length = | | | | | 20 | | | | | | | | | | DstOffset = 3 | | | | | | | | | | DstLength = 12 | | | +----+--------------------+--------------------+--------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | Buffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | 16 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | with 2 Text String | | | | | TLV | | | | | | | | | | 0D 11 04 00 01 02 | | | | | ... 0F | | | | | | | | | | 0D 06 00 11 22 33 | | | | | 44 55 (no specific | | | | | DCS byte) | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | | findAndCopyValue() | | | | Tag = 0Dh, | is 17 | | | | occurrence = 1 | | | | | | | | | | ValueOffset = 0 | | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 17 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+ | 18 | Successful call | Result of | | | | | findAndCopyValue() | | | | Tag = 0Dh, | is 6 | | | | occurrence = 2 | | | | | | | | | | ValueOffset = 0 | | | | | | | | | | DstBuffer.length = | | | | | 6 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 19 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 00 11 22 | | | | | 33 44 55 | | | +----+--------------------+--------------------+--------------------+ | 20 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Successful call | Result of | | | | (with tag 8Dh) | findAndcopyValue() | | | | | is 17 | | | | Tag = 8Dh, | | | | | occurrence = 1 | | | | | | | | | | ValueOffset = 0 | | | | | | | | | | DstBuffer.length = | | | | | 17 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 21 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 04 00 01 | | | | | ... 0F | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.17.4 Test Coverage {#test-coverage-103 .H6}
CRR number Test case number
* * *
N1 13, 15, 17, 19 N2 11 N3 12, 14, 16, 18 N4 20, 21 P1 1 P2 2, 3, 4, 5, 6 P3
7, 8, 9, 10 C1 Does not apply for Proactive Response Handler
#### 6.2.8.18 Method findAndCompareValue(byte tag, byte[] compareBuffer, short
compareOffset)
Test Area Reference API_2_PRH_FACRB_BS
##### 6.2.8.18.1 Conformance requirement {#conformance-requirement-91 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte[] compareBuffer,
short compareOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.18.1.1 Normal execution {#normal-execution-106 .H6}
Looks for the first occurrence of a TLV element from beginning of a TLV list
and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical returns 0.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer returns -1.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer returns 1.
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.8.18.1.2 Parameter errors {#parameter-errors-69 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset would cause access outside array bounds > ArrayIndexOutOfBoundsException shall be thrown.
##### 6.2.8.18.1.3 Context errors {#context-errors-102 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.8.18.2 Test Suite files {#test-suite-files-106 .H6}
Test Script: API_2_PRH_FACRB_BS_1.scr
Test Applet: API_2_PRH_FACRB_BS_1.java
Load Script: API_2_PRH_FACRB_BS_1.ldr
Cleanup Script: API_2_PRH_FACRB_BS_1.clr
Parameter File: API_2_PRH_FACRB_BS_1.par
##### 6.2.8.18.3 Test procedure {#test-procedure-106 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 15 | | | | | | | | | | Text String TLV = | | | | | 0D 10 04 01 02 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | dstBuffer | | | +----+--------------------+--------------------+--------------------+ | 2 | compareOffset > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 0Dh | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | compareOffset = 21 | | | +----+--------------------+--------------------+--------------------+ | 3 | compareOffset \ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 5 | **CompareOffset + | ArrayIndexOu | | | | length >** | tOfBoundsException | | | | co | is thrown | | | | mpareBuffer.length | | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 20 | | | | | | | | | | CompareOffset = 5 | | | +----+--------------------+--------------------+--------------------+ | 6 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+--------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 04h | is thrown | | +----+--------------------+--------------------+--------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+--------------------+ | 7 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | | | | | | Tag = 0Dh | | | | | | | | | | CompareOffset = 0 | | | +----+--------------------+--------------------+--------------------+ | 8 | Verify current TLV | Result is 17 | | | | | | | | | GetValueLength() | | | +----+--------------------+--------------------+--------------------+ | 9 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 10 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 11 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | | | | | | CompareOffset = 2 | | | +----+--------------------+--------------------+--------------------+ | 12 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | with 2 Text String | | | | | TLV | | | | | | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | | | | | | | | 0D 06 00 11 22 33 | | | | | 44 55 | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | | | | | | CompareOffset = 2 | | | +----+--------------------+--------------------+--------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 04 01 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0E 0F 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is -1 | | | | | | | | | CompareOffset = 2 | | | +----+--------------------+--------------------+--------------------+ | 14 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 55 55 04 00 01 | | | | | | | | | | 02 03 04 05 06 | | | | | | | | | | 07 08 09 0A 0B | | | | | | | | | | 0C 0D 0D 10 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is +1 | | | | | | | | | CompareOffset = 2 | | | +----+--------------------+--------------------+--------------------+ | 15 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | (with tag 8Dh) | | | | | | | | | | Tag = 8Dh | | | | | | | | | | CompareOffset = 0 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.18.4 Test Coverage {#test-coverage-104 .H6}
CRR number Test case number
* * *
N1 6 N2 8 N3 7, 11, 12 N4 9, 13 N5 10, 14 N6 15 P1 1 P2 2, 3, 4, 5 C1 Does not
apply for Proactive Response Handler
#### 6.2.8.19 Method findAndCompareValue(byte tag, byte occurence, short
valueOffset, byte[] compareBuffer, short compareOffset, short compareLength)
Test Area Reference API_2_PRH_FACRBBS_BSS
##### 6.2.8.19.1 Conformance requirement {#conformance-requirement-92 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte occurence,
short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.19.1.1 Normal execution {#normal-execution-107 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of a
TLV list and compare its value with a buffer:
  * CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT > exception is thrown and the current TLV is no longer defined.
  * CRRN2: if the method is successful then the corresponding TLV > becomes current.
  * CRRN3: if identical 0 is returned.
  * CRRN4: if the first miscomparing byte in simple TLV is less than > that in compareBuffer -1 is returned.
  * CRRN5: if the first miscomparing byte in simple TLV is greater than > that in compareBuffer 1 is returned
  * CRRN6: The search method is comprehension required flag independent.
##### 6.2.8.19.1.2 Parameter errors {#parameter-errors-70 .H6}
  * CRRP1: if compareBuffer is null NullPointerException shall be > thrown.
  * CRRP2: if compareOffset or compareLength or both would cause access > outside array bounds, or if compareLength is negative > ArrayIndexOutOfBoundsException shall be thrown.
  * CRRP3: if valueOffset, compareLength or both are out of the current > TLV an instance of ToolkitException shall be thrown. The reason > code shall be ToolkitException OUT_OF_TLV_BOUNDARIES.
  * CRRP4: if an input parameter is not valid (e.g. occurence = 0) an > instance of ToolkitException shall be thrown. The reason code > shall be ToolkitException BAD_INPUT_PARAMETER.
##### 6.2.8.19.1.3 Context errors {#context-errors-103 .H6}
  * CRRC1: if the handler is busy an instance of ToolkitException shall > be thrown. The reason code shall be ToolkitException > HANDLER_NOT_AVAILABLE.
##### 6.2.8.19.2 Test Suite files {#test-suite-files-107 .H6}
Test Script: API_2_PRH_FACRBBS_BSS_1.scr
Test Applet: API_2_PRH_FACRBBS_BSS_1.java
Load Script: API_2_PRH_FACRBBS_BSS_1.ldr
Cleanup Script: API_2_PRH_FACRBBS_BSS_1.clr
Parameter File: API_2_PRH_FACRBBS_BSS_1.par
##### 6.2.8.19.3 Test procedure {#test-procedure-107 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 15 | | | | | | | | | | Text String TLV = | | | | | 0D 10 04 01 02 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | compareBuffer | | | +----+--------------------+--------------------+--------------------+ | 2 | compareOffset > | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 6 | | | | | | | | | | compareLength = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 5 | **CompareOffset + | ArrayIndexOu | | | | compareLength** | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | CompareOffset = 3 | | | | | | | | | | CompareLength = 3 | | | +----+--------------------+--------------------+--------------------+ | 6 | compareLength \ | Toolk | | | | Text String length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | valueOffset = 0 | is thrown | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+--------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Text String length | F_TLV_BOUNDARIES | | | | | is thrown | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+--------------------+ | 11 | Invalid parameter | To | | | | | olkitException.BAD | | | | Occurrence = 0 | _INPUT_PARAMETER | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 12 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+--------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 0Dh | is thrown | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+--------------------+ | | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+--------------------+ | 13 | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 14 | Verify current TLV | Result is 17 | | | | | | | | | GetValueLength() | | | +----+--------------------+--------------------+--------------------+ | 15 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 10 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 16 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 03 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 17 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 12 | | | +----+--------------------+--------------------+--------------------+ | 18 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 02 01 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0B 0C | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 19 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 01 02 | | | | | | | | | | 03 04 05 06 07 | | | | | | | | | | 08 09 0A 0A 0D | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+--------------------+ | 20 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | with 2 Text String | | | | | TLV | | | | | | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | | | | | | | | 0D 06 00 11 22 33 | | | | | 44 55 | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+--------------------+ | 21 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 00 11 22 33 44 55 | | | +----+--------------------+--------------------+--------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 22 | Initialise | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 00 11 22 33 44 66 | | | +----+--------------------+--------------------+--------------------+ | | fin | Result is -1 | | | | dAndCompareValue() | | | | | | | | | | tag = 0Dh, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 23 | Send a GET INPUT | | GET INPUT | | | command | | Proactive command | +----+--------------------+--------------------+--------------------+ | | Terminal Response, | | | | | Text String length | | | | | = 16 | | | | | | | | | | Text String TLV = | | | | | 0D 11 04 00 01 ... | | | | | 0F | | | +----+--------------------+--------------------+--------------------+ | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | +----+--------------------+--------------------+--------------------+ | | Initialise | | | | | compareBuffer | | | | | | | | | | CompareBuffer = | | | | | | | | | | 04 00 01 ... 0F | | | +----+--------------------+--------------------+--------------------+ | | Compare buffers | Result is 00h | | | | (with tag 8Dh) | | | | | | | | | | tag = 8Dh, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 17 | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.19.4 Test Coverage {#test-coverage-105 .H6}
CRR number Test case number
* * *
N1 12 N2 14 N3 13, 17, 20, 21 N4 15, 18, 22 N5 16, 19 N6 23 P1 1 P2 2, 3, 4,
5, 6 P3 7, 8, 9, 10 P4 11 C1 Does not apply for Proactive Response Handler
#### 6.2.8.20 Method getCapacity
Test Area Reference: API_2_PRH_GCAP
##### 6.2.8.20.1 Conformance Requirement {#conformance-requirement-93 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getCapacity()
##### 6.2.8.20.1.1 Normal execution {#normal-execution-108 .H6}
  * CRRN1: The method shall return the maximum size of the Simple TLV > list managed by the handler.
##### 6.2.8.20.2 Test suite files {#test-suite-files-108 .H6}
Test Script: API_2_PRH_GCAP_1.scr
Test Applet: API_2_PRH_GCAP_1.java
Load Script: API_2_PRH_GCAP_1.ldr
Cleanup Script: API_2_PRH_GCAP_1.clr
Parameter File: API_2_PRH_GCAP_1.par
##### 6.2.8.20.3 Test Procedure {#test-procedure-108 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | **Proact | 1- Applet is | 2- 91 XX | | | iveResponseHandler | triggered | | | | available** | | 3- The proactive | | | | 4-No exception is | command is fetched | | | 1- Send envelope | thrown | | | | SMS-PP Formatted | | | | | | 5- The Capacity | | | | 2- The applet | result is greater | | | | sends a proactive | or equal to | | | | command | getLength() result | | | | | | | | | 3- Fetch the | | | | | proactive command | | | | | and send Terminal | | | | | Response | | | | | | | | | | 4- The applet | | | | | calls method | | | | | getCapacity() | | | | | method | | | | | | | | | | 5- The applet | | | | | calls method | | | | | getLength() method | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.20.4 Test Coverage {#test-coverage-106 .H6}
CRR number Test case number
* * *
N1 1
#### 6.2.8.21 Method getChannelIdentifier
Test Area Reference: API_2_PRH_GCID
##### 6.2.8.21.1 Conformance Requirement: {#conformance-requirement-94 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getChannelIdentifier()
throws ToolkitException
##### 6.2.8.21.1.1 Normal execution {#normal-execution-109 .H6}
  * CRRN1:The method shall return the channel identifier byte value.
  * CRRN2:The channel identifier byte value returned shall be from the > first Channel status TLV element.
  * CRRN3: If the element is available it becomes the currently selected > TLV.
##### 6.2.8.21.1.2 Context errors {#context-errors-104 .H6}
  * CRRC1: The method shall throw ToolkitException > (UNAVAILABLE_ELEMENT) if the Channel status TLV is not present.
  * CRRC2: The method shall throw ToolkitException > (OUT_OF_TLV_BOUNDARIES) if the Simple TLV Channel Status length > is equal to 0.
##### 6.2.8.21.2 Test suite files {#test-suite-files-109 .H6}
Test Script: API_2_PRH_GCID_1.scr
Test Applet: API_2_PRH_GCID_1.java
Load Script: API_2_PRH_GCID_1.ldr
Cleanup Script: API_2_PRH_GCID_1.clr
Parameter File: API_2_PRH_GCID_1.par
##### 6.2.8.21.3 Test Procedure {#test-procedure-109 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 0 | Applet1 is | | | | | installed with | | | | | maximum number of | | | | | channel = 01. | | | +----+--------------------+--------------------+--------------------+ | 1 | Channel status TLV | 2- | 1- DISPLAY TEXT | | | is not present | UN | Proactive command | | | | AVAILABLE_ELEMENT | is fetched. | | | 1- Build and send | ToolkitException | | | | a DISPLAY TEXT | is thrown | TERMINAL RESPONSE | | | command | | with no Channel | | | | | status TLV | | | 2- Call | | available. | | | ProactiveRe | | | | | sponseHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 2 | **Channel status | 2- | 1- OPEN CHANNEL | | | TLV with a length | OUT_O | Proactive command | | | equal to 0** | F_TLV_BOUNDARIES | is fetched. | | | | ToolkitException | | | | 1- Build and send | is thrown | TERMINAL RESPONSE | | | a OPEN CHANNEL | | with Channel | | | proactive command | | status TLV length | | | | | equal to 0. | | | 2- Call | | | | | ProactiveRe | | | | | sponseHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 3 | **Get channel | 2- Returns 0x01 | 1- OPEN CHANNEL | | | identifier value** | | Proactive Command | | | | | is fetched. | | | 1- Call | | | | | Proac | | TERMINAL RESPONSE | | | tiveHandler.init() | | is issued with | | | and | | channel status | | | Proac | | value = 0x8100. | | | tiveHandler.send() | | | | | methods to open a | | | | | channel. | | | | | | | | | | 2- Call | | | | | ProactiveRe | | | | | sponseHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | | | | | | | | 3- Call | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | and | | | | | Proac | | | | | tiveHandler.send() | | | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 4 | Get channel | 2- Returns 0x01 | 1- OPEN CHANNEL | | | identifier value | | Proactive Command | | | with 2 TLV | | is fetched. | | | | | | | | 1- Call | | TERMINAL RESPONSE | | | Proactiv | | is issued with | | | eHandler.init()and | | channel status | | | Proac | | value = 0x8100 and | | | tiveHandler.send() | | 0x8200. | | | methods to open a | | | | | channel | | | | | | | | | | 2- Call | | | | | ProactiveRe | | | | | sponseHandler.getC | | | | | hannelIdentifier() | | | | | | | | | | 3- Call | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | and | | | | | Proac | | | | | tiveHandler.send() | | | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 5 | Channel status TLV | 2- Returns 0x03 | 1- OPEN CHANNEL | | | is currently | | Proactive Command | | | selected TLV | 3- Check | is fetched. | | | | getC | | | | 1- Call | hannelIdentifier() | TERMINAL RESPONSE | | | Proac | =getValueByte(0) | is issued with | | | tiveHandler.init() | | channel status | | | and | | value = | | | Proac | | 0x0305~~.~~ | | | tiveHandler.send() | | | | | methods to open a | | | | | channel. | | | | | | | | | | V | | | | | iewHandler.FindTLV | | | | | with Device | | | | | Identity Tag. | | | | | | | | | | 2- Call | | | | | ProactiveRe | | | | | sponseHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | | | | | | | | 3- Compare | | | | | ProactiveRe | | | | | sponseHandler.getC | | | | | hannelIdentifier() | | | | | and then | | | | | ViewHandl | | | | | er.getValueByte(0) | | | | | methods. | | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.21.4 Test Coverage {#test-coverage-107 .H6}
CRR number Test case number
* * *
N1 3 N2 4 N3 5 C1 1 C2 2
#### 6.2.8.22 Method copyChannelData
Test Area Reference: API_2_PRH_CCHD_BSS
##### 6.2.8.22.1 Conformance Requirement: {#conformance-requirement-95 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copyChannelData(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.8.22.1 Normal execution {#normal-execution-110 .H6}
  * CRRN1: The method shall copy a part of the Channel data string > field.
  * CRRN2: The Channel data string field value returned shall be the > first Channel data TLV element of the current response data field.
  * CRRN3: If the element is available it becomes the currenly selected > TLV.
  * CRRN4: Returns dstOffset + dstLength.
##### 6.2.8.22.2 Parameters error {#parameters-error-28 .H6}
  * CRRP1: If dstBuffer is null, a NullPointerException is thrown.
  * CRRP2: If dstOffset or dstLength parameter is negative an > ArrayIndexOutOfBoundsException exception is thrown and no copy is > performed.
  * CRRP3: If dstOffset+dstLength is greater than dstBuffer.length, the > length of the dstBuffer array an ArrayIndexOutOfBoundsException > exception is thrown and no copy is performed.
  * CRRP4: If dstLength is greater than the value field of the available > TLV, a OUT_OF_TLV_BOUNDARIES ToolkitException is thrown.
##### 6.2.8.22.3 Context errors {#context-errors-105 .H6}
  * CRRC1: The method shall throw a UNAVAILABLE_ELEMENT > ToolkitException if the Result TLV is not present.
##### 6.2.8.22.2 Test suite files {#test-suite-files-110 .H6}
Test Script: API_2_PRH_CCHD_BSS_1.scr
Test Applet: API_2_PRH_CCHD_BSS_1.java
Load Script: API_2_PRH_CCHD_BSS_1.ldr
Cleanup Script: API_2_PRH_CCHD_BSS_1.clr
Parameter File: API_2_PRH_CCHD_BSS_1.par
##### 6.2.8.22.3 Test Procedure {#test-procedure-110 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 0 | 1- Applet1 is | | 2- OPEN CHANNEL | | | installed with | | proactive command | | | maximum number of | | is fetched | | | channel = 01. | | | | | | | TERMINAL RESPONSE | | | 2- Applet1 builds | | is issued with | | | proactive commands | | Channel Id = 01 | | | OPEN CHANNEL with | | | | | init() method in | | | | | order to open one | | | | | channel. | | | | | | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called. | | | +----+--------------------+--------------------+--------------------+ | 1 | CopyChannelData() | Nu | RECEIVE DATA | | | with NULL | llPointerException | Proactive command | | | dstBuffer | is thrown | is fetched. | | | | | | | | Build and send a | | TERMINAL RESPONSE | | | RECEIVE DATA | | with not empty | | | command | | Channel Data TLV | | | | | is issued. | | | Call | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.copyChannelData | | | | | dstBuffer = NULL | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+--------------------+ | 2 | CopyChannelData() | 2- an | 1- RECEIVE DATA | | | with negative | ArrayIndexOu | proactive command | | | dstOffset | tOfBoundsException | is fetched. | | | | exception is | | | | 1- call init() | thrown. | TERMINAL RESPONSE | | | method for the | | with 6 bytes | | | RECEIVE DATA | 3- no copy is | avalaible | | | proactive command. | performed. | (\'Hello1\') | | | | | | | | 2- call | | | | | Proact | | | | | iveResponseHandler | | | | | .copyChannelData() | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = -1 | | | | | | | | | | dstLength = 1 | | | | | | | | | | 3- check dstBuffer | | | | | is empty. | | | +----+--------------------+--------------------+--------------------+ | 3 | CopyChannelData() | 1- an | | | | with negative | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | | exception is | | | | 1- call | thrown. | | | | Proact | | | | | iveResponseHandler | 2- no copy is | | | | .copyChannelData() | performed. | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = -1 | | | | | | | | | | 2- check dstBuffer | | | | | is empty. | | | +----+--------------------+--------------------+--------------------+ | 4 | CopyChannelData() | 1- an | | | | with | ArrayIndexOu | | | | d | tOfBoundsException | | | | stOffset+dstLength | exception is | | | | greater than | thrown. | | | | dstBuffer.length | | | | | | 2- no copy is | | | | 1- call | performed. | | | | Proact | | | | | iveResponseHandler | | | | | .copyChannelData() | | | | | with | | | | | d | | | | | stOffset+dstLength | | | | | greater than | | | | | dstBuffer.length. | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 5 | | | | | | | | | | 2- check dstBuffer | | | | | is empty. | | | +----+--------------------+--------------------+--------------------+ | 5 | CopyChannelData() | a | | | | with dstLength too | OUT_O | | | | large | F_TLV_BOUNDARIES | | | | | ToolkitException | | | | Call | is thrown. | | | | Proact | | | | | iveResponseHandler | | | | | .copyChannelData() | | | | | with dstLength | | | | | greater than the | | | | | value field of the | | | | | available TLV. | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+--------------------+ | 6 | CopyChannelData() | 2- a | 1- RECEIVE DATA | | | without Channel | UN | proactive command | | | Data TLV element | AVAILABLE_ELEMENT | is fetched | | | | ToolkitException | | | | 1- call init() | is thrown. | TERMINAL RESPONSE | | | method for the | | without | | | RECEIVE DATA | | ChannelData TLV | | | proactive command. | | element. | | | | | | | | Call send() | | | | | method. | | | | | | | | | | 2- call | | | | | Proact | | | | | iveResponseHandler | | | | | .copyChannelData() | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 7 | Successful | 3- the Channel | 1- RECEIVE DATA | | | copyChannelData() | Data TLV is copied | proactive command | | | | into dstBuffer. | is fetched | | | Call init() method | | | | | for the RECEIVE | The applet checks | TERMINAL RESPONSE | | | DATA proactive | the returned value | with one Channel | | | command. | is dstOffset + | data TLV element. | | | | dstLength = 6. | (6 bytes available | | | Call send() | | = \'Hello2\') | | | method. | | | | | | | | | | 2- Call findTLV() | | | | | with TAG of DEVICE | | | | | IDENTITY. | | | | | | | | | | 3- Call | | | | | Proact | | | | | iveResponseHandler | | | | | .copyChannelData() | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | | | | | | | | dstBuffer is the | | | | | whole Buffer. | | | +----+--------------------+--------------------+--------------------+ | 8 | Compare copied | The applet checks | | | | Buffer | that dstBuffer | | | | | contains the | | | | Check dstBuffer. | channel data from | | | | | the TERMINAL | | | | | RESPONSE. | | +----+--------------------+--------------------+--------------------+ | 9 | **Check the | The returned byte | | | | Channel Data TLV | is the same than | | | | is selected** | the first byte of | | | | | the Channel data | | | | Call the | TLV (i.e. \'H\') | | | | ViewHandl | | | | | er.getValueByte(0) | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 10 | Successful | The Channel Data | | | | copyChannelData() | TLV is copied into | | | | | dstBuffer. | | | | Call | | | | | Proact | The applet checks | | | | iveResponseHandler | the returned value | | | | .copyChannelData() | is dstOffset + | | | | | dstLength = 5. | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 2 | | | | | | | | | | dstLength = 3 | | | | | | | | | | DstBuffer is a | | | | | part of Buffer. | | | +----+--------------------+--------------------+--------------------+ | 11 | Compare copied | The applet checks | | | | Buffer | that bytes from 2 | | | | | to 4 of dstBuffer | | | | Check dstBuffer. | contain the first | | | | | 3 bytes of channel | | | | | data TLV from the | | | | | TERMINAL RESPONSE. | | +----+--------------------+--------------------+--------------------+ | 12 | Successful | 2- The Channel | | | | copyChannelData() | Data TLV is copied | | | | | into dstBuffer. | | | | 1- Initialise | | | | | dstBuffer to [00, | The returned value | | | | 01...] | is dstOffset + | | | | | dstLength = 5. | | | | 2- Call | | | | | Proact | | | | | iveResponseHandler | | | | | .copyChannelData() | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 2 | | | | | | | | | | dstLength = 3 | | | | | | | | | | DstBuffer is a | | | | | part of buffer. | | | +----+--------------------+--------------------+--------------------+ | 13 | Compare copied | The applet checks | | | | Buffer | that only bytes | | | | | from 2 to 4 of | | | | Check dstBuffer. | dstBuffer have | | | | | been updated with | | | | | the first 3 bytes | | | | | of channel data | | | | | TLV from the | | | | | TERMINAL RESPONSE. | | +----+--------------------+--------------------+--------------------+ | 14 | Successful | 2- the first | 1- RECEIVE DATA | | | copyChannelData(), | Channel Data TLV | proactive command | | | with 2 TLV | is copied into | is fetched | | | | dstBuffer. | | | | 1- call init() | | TERMINAL RESPONSE | | | method for the | The returned value | with two Channel | | | RECEIVE DATA | is | data TLV element | | | proactive command. | d | | | | | stOffset+dstLength | 1^st^ TLV : 6 | | | Call send() | =0x06 | bytes available = | | | method. | | \'Hello3\' | | | | | | | | 2- call | | 2^nd^ TLV : 6 | | | Proact | | bytes available = | | | iveResponseHandler | | \'Hello4\' | | | .copyChannelData() | | | | | with dstLength | | | | | lower than the | | | | | value field of the | | | | | available TLV. | | | | | | | | | | dstBuffer.length = | | | | | 8 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+--------------------+ | 15 | Compare copied | Check that | | | | Buffer | dstBuffer contains | | | | | the first Channel | | | | Check dstBuffer. | Data TLV from the | | | | | TERMINAL RESPONSE. | | +----+--------------------+--------------------+--------------------+
##### 6.2.8.22.4 Test Coverage {#test-coverage-108 .H6}
CRR number Test case number
* * *
N1 7, 10, 12, 14 N2 14 N3 9 N4 8, 11, 13, 15 P1 1 P2 2, 3 P3 4 P4 5 C1 6
### 6.2.9 Class ToolkitRegistry
#### 6.2.9.1 Method allocateTimer
Test Area Reference: API_2_TKR_ATIM
##### 6.2.9.1.1 Conformance requirement: {#conformance-requirement-96 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte allocateTimer()
throws ToolkitException
##### 6.2.9.1.1.1 Normal execution {#normal-execution-111 .H6}
  * CRRN1: the returned timer identifier shall be between 01 and 08 > inclusive.
  * CRRN2: the returned timer identifier shall be different from a > previously allocated but not released one.
  * CRRN3: The SIM Toolkit Framework shall trigger the applet when > receiving an ENVELOPE(TIMER EXPIRATION) command for the allocated > timer.
  * CRRN4: A call to isEventSet() method for EVENT_TIMER_EXPIRATION > should return true if the applet has at least one timer allocated.
##### 6.2.9.1.1.2 Parameters error {#parameters-error-29 .H6}
No requirements.
##### 6.2.9.1.1.3 Context errors {#context-errors-106 .H6}
  * CRRC1: Shall throw a ToolkitException with reason > NO_TIMER_AVAILABLE if all the timers are allocated.
  * CRRC2: Shall throw a ToolkitException with reason > NO_TIMER_AVAILABLE if the maximum number of timers have been > allocated to this applet according to installation parameter.
##### 6.2.9.1.2 Test suite files {#test-suite-files-111 .H6}
Test Script: API_2_TKR_ATIM_1.scr
Test Applet: API_2_TKR_ATIM_1.java
API_2_TKR_ATIM_2.java
API_2_TKR_ATIM_3.java
  * Installation parameters:
  * For this test procedure the non-volatile memory of each instance is > 200 (Hexa).
  * The maximum timer parameter value is as follows for each applet:
\- applet1 (API_2_TKR_ATIM_1): 8 timers
\- applet2 (API_2_TKR_ATIM_2): 4 timers
\- applet3 (API_2_TKR_ATIM_3): 0 timer
Load Script: API_2_TKR_ATIM_1.ldr
  * The load script installs the 6 instances.
Cleanup Script: API_2_TKR_ATIM_1.clr
Parameter File: API_2_TKR_ATIM_1.par
##### 6.2.9.1.3 Test procedure {#test-procedure-111 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Allocates up to 8 | No exception shall | | | | timers\ | be thrown. Timer | | | | (applet1) | ID returned shall | | | | | be between 01 and | | | | 8 * | 08 inclusive. It | | | | allocateTimer(). | shall be different | | | | | after each call. | | +----+--------------------+--------------------+------------------+ | 2 | Allocate timers | Shall throw a | | | | more than the | ToolkitException | | | | maximum\ | with reason | | | | (applet1) | NO\ | | | | | _TIMER_AVAILABLE. | | | | The applet1 | | | | | allocates 1 more | | | | | timer. | | | +----+--------------------+--------------------+------------------+ | 3 | Check applet is | Shall trigger each | | | | Triggered by | time an | | | | ENVELOPE( | ENVELOPE(TIMER | | | | TIMER_EXPIRATION) | EXPIRATION) is | | | | command\ | sent to the SIM, | | | | (applet1) | for Timer ID = | | | | | \'01\' to \'08\'. | | | | Send | | | | | ENVELOPE(TIMER | | | | | EXPIRATION) with | | | | | all timers id (not | | | | | in an increase | | | | | order). | | | | | | | | | | Calls | | | | | releaseTimer(id) | | | | | each time a timer | | | | | expires. | | | +----+--------------------+--------------------+------------------+ | 4 | Allocate up to 4 | No exception shall | | | | timers\ | be thrown. Each | | | | (applet2) | time, the returned | | | | | timer identifier | | | | 4 * | shall be between | | | | allocateTimer(). | \'01\' and \'08\' | | | | | inclusive. It | | | | | shall be different | | | | | after each call. | | +----+--------------------+--------------------+------------------+ | 5 | Allocate timers | Shall throw a | | | | more than the | ToolkitException | | | | maximum\ | with reason | | | | (applet3) | NO\ | | | | | _TIMER_AVAILABLE. | | | | The applet3 | | | | | allocates 1 more | | | | | timer. | | | +----+--------------------+--------------------+------------------+
##### 6.2.9.1.4 Test Coverage {#test-coverage-109 .H6}
CRR number Test case number
* * *
N1 1, 4 N2 1, 4 N3 3 N4 1 C1 2 C2 5
#### 6.2.9.2 Method changeMenuEntry
Test Area Reference: API_2_TKR_CMETB_BSSBZBS
##### 6.2.9.2.1 Conformance requirement: {#conformance-requirement-97 .H6}
The method with following header shall be compliant to its definition in the
API.
public void changeMenuEntry(byte id,
byte[] menuEntry,
short offset,
short length,
byte nextAction,
boolean helpSupported,
byte iconQualifier,
short iconIdentifier)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.9.2.1.1 Normal execution {#normal-execution-112 .H6}
  * CRRN1: The SIM Toolkit Framework shall dynamically update the menu > stored in the ME by issuing a SET UP MENU proactive command.The > later will reflect the changes done for the entry. The SIM Toolkit > Framework shall use the data of the EF sume file in order to build > the SET UP MENU command.
  * CRRN2: The default state of the changed menu entry is \'enabled\'.
  * CRRN3: a call to isEventSet() method on EVENT_MENU_SELECTION shall > return true before and after the call.
  * CRRN4: if helpSupported was true then a call to isEventSet() method > on EVENT_MENU_SELECTION_HELP_REQUEST event shall return true.
  * CRRN5: if helpSupported was true then after the completion of the > SETUP MENU command, if an ENVELOPE(MENU_SELECTION_HELP_REQUEST) > command is received by the SIM for this entry, then the SIM > Toolkit framework shall trigger the applet.
  * CRRN6: if help supported was true, the SIM Toolkit Framework shall > issue a SETUP MENU command with command qualifier = \'80\'
  * CRRN7: if helpSupported was false and if no entries is supporting > help then a call to isEventSet() method on > EVENT_MENU_SELECTION_HELP_REQUEST event shall return false .
  * CRRN8: if helpSupported was false and if no entries is supporting > help then after the completion of the SETUP MENU command, if an > ENVELOPE(MENU_SELECTION_HELP_REQUEST) command is received by > the SIM, then the SIM Toolkit framework shall not trigger the > applet.
  * CRRN9: The SIM Toolkit Framework shall supply in the SET UP MENU > command with the icon identifier provided in the icon identifier > list within the item icon identifier list Simple TLV if all the > applets registered to the EVENT_MENU_SELECTION provide it.
  * CRRN10: The SIM Toolkit Framework shall set in the SET UP MENU > command with the Icon list qualifier transmitted to the ME as > \'icon is not self explanatory\' if one of the applet registered > prefers this qualifier.
  * CRRN11: If Next Action Indicator was different from \'00\', the SIM > Toolkit Framework shall issue a SETUP MENU proactive command > containing an Items Next Action Indicator simple TLV with the > comprehension flag set to 0 as defined in 3GPP TS 51.014 [16].
##### 6.2.9.2.1.2 Parameters error {#parameters-error-30 .H6}
  * CRRP1: Shall throw java.lang.NullPointerException - if menuEntry is > null
  * CRRP2: Shall throw java.lang.ArrayIndexOutOfBoundsException - if > offset would cause access outside array bounds
  * CRRP3: Shall throw java.lang.ArrayIndexOutOfBoundsException - if > length would cause access outside array bounds
  * CRRP4: Shall throw java.lang.ArrayIndexOutOfBoundsException - if > both offset and length would cause access outside array bounds
##### 6.2.9.2.1.3 Context errors {#context-errors-107 .H6}
  * CRRC1: Shall throw a ToolkitException with MENU_ENTRY_NOT_FOUND > reason if the Menu Identifier isn\'t associated to the calling > applet instance.
  * CRRC2: Shall throw ALLOWED_LENGTH_EXCEEDED if the menu entry > string is bigger than the allocated space.
##### 6.2.9.2.2 Test suite files {#test-suite-files-112 .H6}
Additional requirements for the GSM personalization:
\- content of EF assume shall be:
  * Title Alpha Identifier: \"TOOLKIT TEST\"
Test Script: API_2_TKR_CMETB_BBSSBZBS_1.scr
Test Applet: API_2_TKR_CMETB_BBSSBZBS_1.java
\- entry \'01\' is \"Init1\"
\- entry \'02\' is \"Init2\"
  * Installation parameter:
Same as default applet but with:
\- Maximum text length for a menu entry: 15
\- Maximum number of menu entries: 2
\- Position / Identifier for each menu entry: \'01\'/\'01\',\'02\'/\'02\'
Load Script: API_2_TKR_CMETB_BBSSBZBS_1.ldr
Cleanup Script: API_2_TKR_CMETB_BBSSBZBS_1.clr
Parameter File: API_2_TKR_CMETB_BBSSBZBS_1.par
##### 6.2.9.2.3 Test procedure {#test-procedure-112 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Applet changes the | 1- No exception | The SIM shall | | | entry\'s title by | shall be thrown. | issue a SETUP MENU | | | menuEntry buffer, | | proactive command | | | with a greater | 2- Shall return | which contains the | | | length than the | true. | new text for entry | | | initial length | | ID \'02\'. | | | | 3- Shall return | | | | 1- | false. | | | | Cha | | | | | ngeMenuEntry()with | | | | | parameters: | | | | | | | | | | Id = \'02\' | | | | | | | | | | MenuEntry = | | | | | \"UseAllBuffer\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = | | | | | 0. | | | | | | | | | | 2- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 3- | | | | | isEventSet(EVE | | | | | NT_MENU_SELECTIO | | | | | N_HELP_REQUEST). | | | +----+--------------------+--------------------+--------------------+ | 2 | Changing the title | 1- No exception | The SIM shall | | | with part of | shall be thrown. | issue a SETUP MENU | | | menuEntry buffer | | proactive command | | | | 2- Shall return | which contains the | | | 1- | true. | new text for entry | | | cha | | ID \'01\'. | | | ngeMenuEntry()with | 3- Shall return | | | | parameters: | false. | | | | | | | | | Id = \'01\' | | | | | | | | | | MenuEntry = | | | | | \ | | | | | "UsePartOfBuffer\" | | | | | | | | | | Offset = 3 | | | | | | | | | | Length = 12 | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = | | | | | 0. | | | | | | | | | | 2- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 3 | Length = 0 | 1- No exception | The SIM shall | | | | shall be thrown. | issue a SETUP MENU | | | 1- | | proactive command | | | changeMenuEntry() | 2- Shall return | which contains for | | | for entry \'01\' | true. | entry \'01\'and | | | and entry \'02\', | | entry \'02\', no | | | with parameters: | 3- Shall return | text part. | | | | false. | | | | Id = \'01\'/\'02\' | | | | | | | | | | MenuEntry = | | | | | \"LengthEquals0\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 0 | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = | | | | | 0. | | | | | | | | | | 2- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 3- | | | | | isEventSet(EVE | | | | | NT_MENU_SELECTIO | | | | | N_HELP_REQUEST). | | | +----+--------------------+--------------------+--------------------+ | 4 | Setting a next | 1- No exception | The SIM shall | | | action indicator | shall be thrown. | issue a SETUP MENU | | | != 0 | | proactive command | | | | 2- Shall return | which contains an | | | 1- | true. | Items Next Action | | | cha | | Indicator list and | | | ngeMenuEntry()with | 3- Shall return | which contains a | | | parameters: | false. | command qualifier | | | | | \'80\'. | | | Id = \'02\' | | | | | | | | | | MenuEntry = | | | | | \ | | | | | "NextActionIndic\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = | | | | | \'10\' (SETUP | | | | | CALL) | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 2- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 3- | | | | | isEventSet(EVE | | | | | NT_MENU_SELECTIO | | | | | N_HELP_REQUEST). | | | | | | | | | | 4- | | | | | cha | | | | | ngeMenuEntry()with | | | | | parameters: | | | | | | | | | | Id = \'02\' | | | | | | | | | | MenuEntry = | | | | | \ | | | | | "NextActionIndic\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = | | | | | \'10\' (SETUP | | | | | CALL) | | | | | | | | | | HelpSupported = | | | | | true | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 5 | Checking applet is | Applet is trigged | | | | triggered by a | by a | | | | MENU_SELECT | MENU_SELECT | | | | ION_HELP_REQUEST | ION_HELP_REQUEST | | | | | and the Item | | | | Send | Identifier is 02 | | | | ENVE | | | | | LOPE(MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | | | with Item | | | | | Identifier = | | | | | \'02\' | | | +----+--------------------+--------------------+--------------------+ | 6 | help | 1- No exception | The SIM shall | | | supported=true | shall be thrown. | issue a SETUP MENU | | | | | proactive command | | | 1- | 2- Shall return | which contains a | | | cha | true. | command qualifier | | | ngeMenuEntry()with | | \'80\'. | | | parameters: | 3- Shall return | | | | | true. | | | | Id = \'01\' | | | | | | | | | | MenuEntry = | | | | | \"HelpSupported\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | true | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 2- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 3- | | | | | isEventSet(EVE | | | | | NT_MENU_SELECTIO | | | | | N_HELP_REQUEST). | | | +----+--------------------+--------------------+--------------------+ | 7 | Checking applet is | Applet is trigged | | | | triggered by a | by a | | | | MENU_SELECT | MENU_SELECT | | | | ION_HELP_REQUEST | ION_HELP_REQUEST | | | | | and the Item | | | | Send | Identifier is 01 | | | | ENVE | | | | | LOPE(MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | | | with Item | | | | | Identifier = | | | | | \'01\' | | | +----+--------------------+--------------------+--------------------+ | 8 | Setting icons, | 1- No exception | The SIM shall | | | help supported = | shall be thrown. | issue a SETUP MENU | | | false | | proactive command | | | | 2- Shall return | which contains an | | | 1- | true. | Icon Identifier | | | changeMenuEntry() | | List. | | | for entries | 3- Shall return | | | | \'01\',\'02\', | false. | | | | with parameters: | | | | | | | | | | Id = \'01\'/\'02\' | | | | | | | | | | MenuEntry = | | | | | \"IconQualifier\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'01\' | | | | | | | | | | IconIdentifier = | | | | | \'02\' / \'01\' | | | | | | | | | | 2- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 3- | | | | | isEventSet(EVE | | | | | NT_MENU_SELECTIO | | | | | N_HELP_REQUEST). | | | +----+--------------------+--------------------+--------------------+ | 9 | MenuEntry is | 1- No exception | The SIM shall | | | disabled | shall be thrown. | issue a SETUP MENU | | | | | proactive command | | | 1- | 2- No exception | which contains the | | | disable | shall be thrown. | entry. Without | | | MenuEntry(\'01\'). | | Icon identifier | | | | 3- Shall return | List Simple TLV | | | 2- | true. | | | | cha | | | | | ngeMenuEntry()with | 4- Shall return | | | | parameters: | false. | | | | | | | | | Id = \'01\' | | | | | | | | | | MenuEntry = | | | | | \"EnableEntry\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 3- | | | | | isEventSet(EVENT\ | | | | | _MENU_SELECTION). | | | | | | | | | | 4- | | | | | isEventSet(EVE | | | | | NT_MENU_SELECTIO | | | | | N_HELP_REQUEST). | | | +----+--------------------+--------------------+--------------------+ | 10 | MenuEntry is null | Shall throw | | | | | java.lang.Nul | | | | chan | lPointerException. | | | | geMenuEntry()with: | | | | | | | | | | MenuEntry = NULL | | | +----+--------------------+--------------------+--------------------+ | 11 | Offset causes | Shall throw | | | | access outside | java. | | | | array bounds | lang.ArrayIndexOut | | | | | OfBoundsException. | | | | Id = \'01\' | | | | | | | | | | MenuEntry = | | | | | \"Violation\" | | | | | | | | | | Offset = | | | | | menuEntry.length | | | | | +1 | | | | | | | | | | Length = 0 | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 12 | Big Offset causes | Shall throw | | | | access outside | java. | | | | array bounds | lang.ArrayIndexOut | | | | | OfBoundsException. | | | | Id = \'01\' | | | | | | | | | | MenuEntry = | | | | | \"Violation\" | | | | | | | | | | Offset = 255 | | | | | | | | | | Length = 1 | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 13 | Offset \ 15 | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 20 | With a smaller | 1. No exception | The SIM shall | | | text length than | shall be thrown. | issue a SETUP MENU | | | the initial length | | proactive command | | | | 2. Shall return | which contains the | | | 1. | true. | new text for entry | | | cha | | ID \'02\'. | | | ngeMenuEntry()with | 3. Shall return | | | | parameters: | false. | | | | | | | | | Id = \'02\' | | | | | | | | | | MenuEntry = | | | | | \"Init\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 2. | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3. | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+
##### 6.2.9.2.4 Test Coverage {#test-coverage-110 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4, 6, 8, 9, 20 N2 9 N3 1, 2, 3, 4, 6, 8, 9, 20 N4 6 N5 7,5 N6 6 N7
1, 2, 3, 4, 8, 9, 20 N8 Checked in framework tests: FWK_APT_EMSH N9 8, 9 N10 8
N11 4 P1 10 P2 11, 12, 13 P3 14, 15 P4 16 C1 17, 18 C2 19
#### 6.2.9.3 Method clearEvent
Test Area Reference: API_2_TKR_CEVTB
##### 6.2.9.3.1 Conformance requirement: {#conformance-requirement-98 .H6}
The method with following header shall be compliant to its definition in the
API.
public void clearEvent(byte event)
throws ToolkitException,
javacard.framework.TransactionException
##### 6.2.9.3.1.1 Normal execution {#normal-execution-113 .H6}
  * CRRN1: A call to isEventSet() method for a cleared event should > return false after a call to clearEvent.
  * CRRN2: The SIM Toolkit Framework shall not trigger the applet on the > occurrence of the cleared event anymore.
  * CRRN3: if event was EVENT_CALL_CONTROL_BY_SIM and after the > call, no applet is registered to it, The SIM Toolkit Framework > shall allow an applet to register to this event.
  * CRRN4: if event was EVENT_CALL_CONTROL_BY_SIM and one applet is > still registered to these event, The SIM Toolkit Framework shall > not allow an applet to register to this event.
  * CRRN5: if event was EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM and > after the call, no applet is registered to it, The SIM Toolkit > Framework shall allow an applet to register to this event.
  * CRRN6: if event was EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM and > one applet is still registered to these event, The SIM Toolkit > Framework shall not allow an applet to set this event.
##### 6.2.9.3.1.2 Parameters error {#parameters-error-31 .H6}
  * CRRP1: Shall throw a Toolkit Exception with reason > EVENT_NOT_ALLOWED if event was EVENT_MENU_SELECTION.
  * CRRP2: Shall throw a Toolkit Exception with reason > EVENT_NOT_ALLOWED if event was > EVENT_MENU_SELECTION_HELP_REQUEST.
  * CRRP3: Shall throw a Toolkit Exception with reason > EVENT_NOT_ALLOWED if event was EVENT_TIMER_EXPIRATION.
  * CRRP4: Shall throw a Toolkit Exception with reason > EVENT_NOT_ALLOWED if event was EVENT_STATUS_COMMAND.
##### 6.2.9.3.1.3 Context errors {#context-errors-108 .H6}
  * CRRC1: shall throw javacard.framework.TransactionException - if the > operation would cause the commit capacity to be exceeded.
##### 6.2.9.3.2 Test suite files {#test-suite-files-113 .H6}
Test Script: API_2_TKR_CEVTB_1.scr
Test Applet: API_2_TKR_CEVTB_1.java
  * As default but applet registers to an event list which contains all > defined events in 3GPP TS 43.019 [7] excepted those that are not > allowed or supported by setEvent().
Load Script: API_2_TKR_CEVTB_1.ldr
Cleanup script: API_2_TKR_CEVTB_1.clr
Parameter File: API_2_TKR_CEVTB_1.par
##### 6.2.9.3.3 Test procedure {#test-procedure-113 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Clear ALLOWED | 1- No exception is | | | | unregistered | thrown each time. | | | | events | | | | | | 2- Shall return | | | | For events ranging | false each time. | | | | from -1, 1 to 24 | | | | | and 127* excepted | | | | | those that aren\'t | | | | | allowed (7, 8, 11, | | | | | 19), the applet | | | | | calls: | | | | | | | | | | 1- clearEvent() | | | | | method | | | | | | | | | | 2- isEventSet() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 2 | Clear registered | 1- No exception | | | | events | shall be thrown. | | | | | | | | | 1- For each | 2.1- No exception | | | | ALLOWED and | shall be thrown. | | | | SUPPORTED event | | | | | (-1, 1 to 24 and | 2.2- Shall return | | | | 127)* excepted | false. | | | | those that aren\'t | | | | | allowed (7, 8, 11, | | | | | 19), the applet | | | | | calls setEvent() | | | | | method. | | | | | | | | | | 2- For each | | | | | ALLOWED and | | | | | SUPPORTED event | | | | | (-1, 1 to 24 and | | | | | 127)* excepted | | | | | those that aren\'t | | | | | allowed (7, 8, 11, | | | | | 19), the applet | | | | | calls: | | | | | | | | | | 2.1- clearEvent() | | | | | method | | | | | | | | | | 2.2- isEventSet() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 3 | Clearing NOT | 1- Each time, | | | | ALLOWED events | clearEvent shall | | | | | throw a | | | | For each event | ToolkitException | | | | among: | with reason | | | | | EV | | | | EVENT | ENT_NOT_ALLOWED. | | | | _MENU_SELECTION, | | | | | EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST, | | | | | EVENT_ | | | | | TIMER_EXPIRATION, | | | | | EVEN | | | | | T_STATUS_COMMAND | | | | | | | | | | 1- The applet | | | | | calls | | | | | clearEvent(event) | | | | | method. | | | +----+--------------------+--------------------+------------------+ | 4 | Checking applet | Applet is not | | | | isn\'t triggered | trigged by an | | | | by an | ENVELOPE(SMS-PP | | | | ENVELOPE(SMS-PP | DOWNLOAD) command | | | | DOWNLOAD) command | | | | | | | | | | 1 - reset and | | | | | initialise the | | | | | card | | | | | | | | | | 2 - An | | | | | ENVELOPE(SMS-PP | | | | | DOWNLOAD) is sent | | | | | with a TAR | | | | | referencing | | | | | applet. | | | +----+--------------------+--------------------+------------------+
NOTE: Although the method clearEvent is defined for a range from --128 to 127
only the allowed events are tested here, because the range from -128 to --2 is
reserved for propriatary use in TS 43.019 [7] chapter 6.2 and the range from
25 to 126 is omitted for compatibility with future releases of TS 43.019 [7]
##### 6.2.9.3.4 Test Coverage {#test-coverage-111 .H6}
CRR number Test case number
* * *
N1 1,2 N2 4 N3 Framework N4 Framework N5 Framework N6 Framework P1 3 P2 3 P3 3
P4 3 C1 not testable
#### 6.2.9.4 Method disableMenuEntry
Test Area Reference: API_2_TKR_DMETB
##### 6.2.9.4.1 Conformance requirement: {#conformance-requirement-99 .H6}
The method with following header shall be compliant to its definition in the
API.
public void disableMenuEntry(byte id)
throws ToolkitException
##### 6.2.9.4.1.1 Normal execution {#normal-execution-114 .H6}
  * CRRN1: A call to isEventSet() method on EVENT_MENU_SELECTION shall > return the same result before and after the call to > disableMenuEntry() method.
  * CRRN2: A call to isEventSet() method on > EVENT_MENU_SELECTION_HELP_REQUEST shall return the same result > before and after the call to disableMenuEntry() method.
  * CRRN3: After invocation of this method the SIM Toolkit Framework > shall dynamically update the menu stored in the ME .
  * CRRN4: After invocation of this method, if there is no more enabled > menu entries then the SIM Toolkit framework shall issue a SETUP > MENU proactive command containing Item Data Object for Item 1 TLV > with a length of zero and no value part.
##### 6.2.9.4.1.2 Parameters error {#parameters-error-32 .H6}
No requirements.
##### 6.2.9.4.1.3 Context errors {#context-errors-109 .H6}
  * CRRC1: shall throw a ToolkitException with reason = > ENTRY_NOT_FOUND if the menu entry doesn\'t exist for this applet
##### 6.2.9.4.2 Test suite files {#test-suite-files-114 .H6}
Additional requirements for the GSM personalization:
\- content of EF sume shall be:
  * Title Alpha Identifier: \"TOOLKIT TEST\"
Test Script: API_2_TKR_DMETB_1.scr
Test Applet: API_2_TKR_DMETB_1.java
  * Installation parameter:
Same as default applet but with:
\- Maximum text length for a menu entry: 15
\- Maximum number of menu entries: 2
\- Position / Identifier for each menu entry: \'01\'/\'01\', \'02\'/\'02\'
Load Script: API_2_TKR_DMETB_1.ldr
Cleanup script: API_2_TKR_DMETB_1.clr
Parameter File: API_2_TKR_DMETB_1.par
##### 6.2.9.4.3 Test procedure {#test-procedure-114 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Check the menu | 1- Shall return | 1- The SIM shall | | | state before\ | true | issue a SET UP | | | disabling a | | MENU proactive | | | previously enabled | 2- Shall return | command with entry | | | entry\ | false | \'01\' and \'02\'. | | | not registered to | | | | | E | | | | | VENT_MENU_SELECT | | | | | ION_HELP_REQUEST | | | | | | | | | | 1- reset and | | | | | initialise the | | | | | card | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 2 | Check the menu | 1- No exception | 3- The SIM shall | | | state after\ | shall be thrown. | issue a SET UP | | | disabling a | | MENU proactive | | | previously enabled | 2- Shall return | command with entry | | | entry\ | true. | \'02\' only. | | | not registered to | | | | | E | 3- Shall return | | | | VENT_MENU_SELECT | false. | | | | ION_HELP_REQUEST | | | | | | | | | | 1- | | | | | disabl | | | | | eMenuEntry(\'01\') | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 3 | Check the menu | 2- Shall return | 3- The SIM shall | | | before\ | true | issue a SET UP | | | disabling a | | MENU proactive | | | previously enabled | 3- Shall return | command with entry | | | entry\ | true | \'02\', indicating | | | registered to | | help supported. | | | E | | | | | VENT_MENU_SELECT | | | | | ION_HELP_REQUEST | | | | | | | | | | 1- change Menu | | | | | Entry \'02\' to | | | | | indicate help | | | | | supported | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 4 | Check the menu | 1- No exception | 3- The SIM shall | | | after\ | shall be thrown. | issue a SET UP | | | disabling a | | MENU proactive | | | previously enabled | 2- Shall return | command with 1^st^ | | | entry\ | true. | Item TLV with a | | | registered to | | length of 0. | | | E | 3- Shall return | | | | VENT_MENU_SELECT | true. | | | | ION_HELP_REQUEST | | | | | | | | | | 1- | | | | | disabl | | | | | eMenuEntry(\'02\') | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 5 | Disabling invalid | Each time a | | | | entries | Toolkit Exception | | | | | with | | | | For ID ranging | MENU\ | | | | from \'00\' to | _ENTRY_NOT_FOUND | | | | \'FF\' except | reason code shall | | | | \'01\' and \'02\', | be thrown. | | | | the applet calls | | | | | di | | | | | sableMenuEntry(ID) | | | | | method. | | | +----+--------------------+--------------------+--------------------+
##### 6.2.9.4.4 Test Coverage {#test-coverage-112 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4 N2 1, 2, 3, 4 N3 2,4 N4 4 C1 5
#### 6.2.9.5 Method enableMenuEntry
Test Area Reference: API_2_TKR_EMETB
##### 6.2.9.5.1 Conformance requirement: {#conformance-requirement-100 .H6}
The method with following header shall be compliant to its definition in the
API.
public void enableMenuEntry(byte id)
throws ToolkitException
##### 6.2.9.5.1.1 Normal execution {#normal-execution-115 .H6}
  * CRRN1: A call to isEventSet() method on EVENT_MENU_SELECTION shall > return the same result before and after the call to > enableMenuEntry() method.
  * CRRN2: A call to isEventSet() method on > EVENT_MENU_SELECTION_HELP_REQUEST shall return the same result > before and after the call to enableMenuEntry() method.
  * CRRN3:The SIM Toolkit Framework shall dynamically issue a SETUP MENU > proactive command which does contain an ITEM SIMPLE TLV object for > this entry.
##### 6.2.9.5.1.2 Parameters error {#parameters-error-33 .H6}
No requirements.
##### 6.2.9.5.1.3 Context errors {#context-errors-110 .H6}
  * CRRC1: shall throw a ToolkitException with reason = > MENU_ENTRY_NOT_FOUND if the menu entry doesn\'t exist for this > applet
##### 6.2.9.5.2 Test suite files {#test-suite-files-115 .H6}
Additional requirements for the GSM personalization:
\- content of EF sume shall be:
  * Title Alpha Identifier: \"TOOLKIT TEST\"
Test Script: API_2_TKR_EMETB_1.scr
Test Applet: API_2_TKR_EMETB_1.java
  * Installation parameter:
Same as default applet but with:
\- Maximum text length for a menu entry: 15
\- Maximum number of menu entries: 2
\- Position / Identifier for each menu entry: \'01\'/\'01\', \'02\'/\'02\'
Load Script: API_2_TKR_EMETB_1.ldr
Cleanup script: API_2_TKR_EMETB_1.clr
Parameter File: API_2_TKR_EMETB_1.par
##### 6.2.9.5.3 Test procedure {#test-procedure-115 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | Check menu state | 1- Shall return | 3- The SIM shall | | | before\ | true | issue a SET UP | | | enabling a | | MENU proactive | | | previously | 2- Shall return | command with entry | | | disabled entry\ | false | \'02\' only. | | | not registered to | | | | | E | 3- No exception | | | | VENT_MENU_SELECT | shall be thrown. | | | | ION_HELP_REQUEST | | | | | | | | | | 1- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 2- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | | | | | | | | 3- | | | | | disabl | | | | | eMenuEntry(\'01\') | | | +----+--------------------+--------------------+--------------------+ | 2 | Check menu state | 1- No exception | 3- The SIM shall | | | after\ | shall be thrown. | issue a SET UP | | | enabling a | | MENU proactive | | | previously | 2- Shall return | command with entry | | | disabled entry\ | true. | \'01\' and \'02\'. | | | not registered to | | | | | E | 3- Shall return | | | | VENT_MENU_SELECT | false. | | | | ION_HELP_REQUEST | | | | | | | | | | 1- | | | | | enabl | | | | | eMenuEntry(\'01\') | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 3 | Check menu state | 2- Shall return | 4- The SIM shall | | | before\ | true | issue a SET UP | | | enabling a | | MENU proactive | | | previously enabled | 3- Shall return | command with entry | | | entry\ | true | \'01\'. The help | | | registered to | | information | | | E | 4- No exception | available flag.is | | | VENT_MENU_SELECT | shall be thrown | not verified | | | ION_HELP_REQUEST | | | | | | | | | | 1- change Menu | | | | | Entry \'02\' to | | | | | indicate help | | | | | supported | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | | | | | | | | 4- | | | | | disabl | | | | | eMenuEntry(\'02\') | | | +----+--------------------+--------------------+--------------------+ | 4 | Check menu state | 1- No exception | 3- The SIM shall | | | after\ | shall be thrown. | issue a SET UP | | | enabling a | | MENU proactive | | | previously enabled | 2- Shall return | command with | | | entry\ | true. | entries \'01\' and | | | registered to | | \'02\' indicating | | | E | 3- Shall return | help supported. | | | VENT_MENU_SELECT | true. | | | | ION_HELP_REQUEST | | | | | | | | | | 1- | | | | | enable | | | | | MenuEntry(\'02\'). | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | | | | | | | | 3- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 5 | Enabling invalid | Each time a | | | | entries | Toolkit Exception | | | | | with | | | | For ID ranging | MENU\ | | | | from \'00\' to | _ENTRY_NOT_FOUND | | | | \'FF\' except | reason code shall | | | | \'01\' and \'02\', | be thrown. | | | | the applet calls | | | | | e | | | | | nableMenuEntry(ID) | | | | | method. | | | +----+--------------------+--------------------+--------------------+
##### 6.2.9.5.4 Test Coverage {#test-coverage-113 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4 N2 1, 2, 3, 4 N3 1, 2, 3, 4 C1 5
#### 6.2.9.6 Method getEntry
Test Area Reference: API_2_TKR_GETY
##### 6.2.9.6.1 Conformance requirement: {#conformance-requirement-101 .H6}
The method with following header shall be compliant to its definition in the
API.
public static ToolkitRegistry getEntry()
throws ToolkitException
##### 6.2.9.6.1.1 Normal execution {#normal-execution-116 .H6}
  * CRRN1: returns a reference to the applet ToolkitRegistry object of > the calling applet.
  * CRRN2: Each successive call to getEntry() method shall return the > same object.
##### 6.2.9.6.1.2 Parameters error {#parameters-error-34 .H6}
No requirements.
##### 6.2.9.6.1.3 Context errors {#context-errors-111 .H6}
No requirements.
##### 6.2.9.6.2 Test suite files {#test-suite-files-116 .H6}
Test Script: API_2_TKR_GETY_1.scr
Test Applet: API_2_TKR_GETY_1.java
Load Script: API_2_TKR_GETY_1.ldr
Cleanup script: API_2_TKR_GETY_1.clr
Parameter File: API_2_TKR_GETY_1.par
##### 6.2.9.6.3 Test procedure {#test-procedure-116 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Installalation | Returns a not null | | | | | ToolkitRegistry | | | | In the | instance. | | | | constructor, the | | | | | applet instance | | | | | calls the | | | | | getEntry() method. | | | +----+--------------------+--------------------+------------------+ | 2 | Check it returns | Returns the same | | | | the same entry | ToolkitRegistry | | | | | instance as for | | | | The applet calls | test case 1. | | | | the getEntry() | | | | | method again. | | | +----+--------------------+--------------------+------------------+
##### 6.2.9.6.4 Test Coverage {#test-coverage-114 .H6}
CRR number Test case number
* * *
N1 1 N2 2
#### 6.2.9.7 Method getPollInterval
Test Area Reference: API_2_TKR_GPOL
##### 6.2.9.7.1 Conformance requirement: {#conformance-requirement-102 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getPollInterval()
##### 6.2.9.7.1.1 Normal execution {#normal-execution-117 .H6}
  * CRRN1: shall return a value between 1 and 15300 if applet is > registered to EVENT_STATUS_COMMAND event.
  * CRRN2: shall return POLL_NO_DURATION value (0) if the toolkit > applet is not registered to EVENT_STATUS_COMMAND event.
##### 6.2.9.7.1.2 Parameters error {#parameters-error-35 .H6}
No requirements.
##### 6.2.9.7.1.3 Context errors {#context-errors-112 .H6}
No requirements.
##### 6.2.9.7.2 Test suite files {#test-suite-files-117 .H6}
Test Script: API_2_TKR_GPOL_1.scr
Test Applet: API_2_TKR_GPOL_1.java
Load Script: API_2_TKR_GPOL_1.ldr
Cleanup script: API_2_TKR_GPOL_1.clr
Parameter File: API_2_TKR_GPOL_1.par
##### 6.2.9.7.3 Test procedure {#test-procedure-117 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Applet isn\'t | Shall return 0. | | | | registered to | | | | | EVEN | | | | | T_STATUS_COMMAND | | | | | | | | | | getPollInterval(). | | | +----+--------------------+--------------------+------------------+ | 2 | Requesting max | 1- No exception | | | | duration | shall be thrown. | | | | | | | | | 1- | 3- Shall return a | | | | requestP | value between 1 | | | | ollInterval(15300) | and 15300. | | | | | | | | | 2- Reset and | | | | | initialise the | | | | | card | | | | | | | | | | 3- | | | | | getPollInterval() | | | +----+--------------------+--------------------+------------------+ | 3 | Requesting System | 1- No exception | | | | Duration | shall be thrown. | | | | | | | | | 1- | 3- Shall return a | | | | request | value between 1 | | | | PollInterval(POLL\ | and 15300. | | | | _SYSTEM_DURATION) | | | | | | | | | | 2- Reset and | | | | | initialise the | | | | | card | | | | | | | | | | 3- | | | | | getPollInterval(). | | | +----+--------------------+--------------------+------------------+ | 4 | Requesting no | 1- No exception | | | | Duration | shall be thrown. | | | | | | | | | 1- | 3- Shall return 0. | | | | req | | | | | uestPollInterval(P | | | | | OLL_NO_DURATION) | | | | | | | | | | 2- Reset and | | | | | initialise the | | | | | card | | | | | | | | | | 3- | | | | | getPollInterval(). | | | +----+--------------------+--------------------+------------------+
##### 6.2.9.7.4 Test Coverage {#test-coverage-115 .H6}
CRR number Test case number
* * *
N1 2, 3 N2 1, 4
#### 6.2.9.8 Method initMenuEntry
Test Area Reference: API_2_TKR_IMET_BSSBZBS
##### 6.2.9.8.1 Conformance requirement: {#conformance-requirement-103 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte initMenuEntry(byte[] menuEntry,
short offset,
short length,
byte nextAction,
boolean helpSupported,
byte iconQualifier,
short iconIdentifier)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 6.2.9.8.1.1 Normal execution {#normal-execution-118 .H6}
  * CRRN1: The SIM Toolkit Framework shall automatically update the menu > stored in the ME by issuing a SETUP MENU proactive command.The > later will reflect the changes done for the entry. The SIM Toolkit > Framework shall use the data of the EF sume file in order to build > the SET UP MENU command.
  * CRRN2: a call to isEventSet() method on EVENT_MENU_SELECTION shall > return true after the 1^st^ successful call (without an > exception).
  * CRRN3: if helpSupported was true then a following call to > isEventSet() method on EVENT_MENU_SELECTION_HELP_REQUEST event > shall return true .
  * CRRN4: if helpSupported was true then after the completion of the > SETUP MENU command, if an ENVELOPE(MENU_SELECTION_HELP_REQUEST) > command is received by the SIM for this entry, then the SIM > Toolkit framework shall trigger the applet.
  * CRRN5: if help supported was true, the SIM Toolkit Framework shall > issue a SETUP MENU command with command qualifier = \'80\'
  * CRRN6: if helpSupported was false and there isn\'t any menu entry > supporting help then a call to isEventSet() method on > EVENT_MENU_SELECTION_HELP_REQUEST event shall return false.
  * CRRN7: The SIM Toolkit Framework shall supply in the SET UP MENU > command with the icon identifier provided in the icon identifier > list within the item icon identifier list Simple TLV if all the > applets registered to the EVENT_MENU_SELECTION provide it.
  * CRRN8: The SIM Toolkit Framework shall set in the SET UP MENU > command with the Icon list qualifier transmitted to the ME as > \'icon is not self explanatory\' if one of the applet registered > prefers this qualifier.
  * CRRN9: If Next Action Indicator was different from \'00\', the SIM > Toolkit Framework shall issue a SETUP MENU proactive command > containing an Items Next Action Indicator simple TLV with the > comprehension flag set to 0.
  * CRRN10: After the completion of the SETUP MENU command, if an > ENVELOPE (MENU_SELECTION) command is received by the SIM for this > identifier, then the SIM Toolkit framework shall trigger the > applet.
##### 6.2.9.8.1.2 Parameters error {#parameters-error-36 .H6}
  * CRRP1: Shall throw java.lang.NullPointerException - if menuEntry is > null
  * CRRP2: Shall throw java.lang.ArrayIndexOutOfBoundsException - if > offset would cause access outside array bounds
  * CRRP3: Shall throw java.lang.ArrayIndexOutOfBoundsException - if > length would cause access outside array bounds
  * CRRP4:Shall throw java.lang.ArrayIndexOutOfBoundsException - if both > offset and length would cause access outside array bounds
##### 6.2.9.8.1.3 Context errors {#context-errors-113 .H6}
  * CRRC1: Shall throw ALLOWED_LENGTH_EXCEEDED if the menu entry > string is bigger than the allocated space
  * CRRC2: Shall throw REGISTRY_ERROR if the menu entry cannot be > initialised (eg no more item data in applet loading parameter)
##### 6.2.9.8.2 Test suite files {#test-suite-files-118 .H6}
Additional requirements for the GSM personalization:
\- content of EF sume shall be:
  * Title Alpha Identifier: \"TOOLKIT TEST\"
  * Test case trigger:
\- 1- Applet instantiation
\- 2- Menu selection
\- 3- Menu selection Help Supported
Test Script: API_2_TKR_IMET_BSSBZBS_1.scr
Test Applet: API_2_TKR_IMET_BSSBZBS_1.java
  * Installation parameter:
Same as default applet but with:
\- Maximum text length for a menu entry: 15
\- Maximum number of menu entries: 6
\- Position / Identifier for each menu entry: \'01\'/\'01\', \'02\'/\'02\',
\'03\'/\'03\', \'04\'/\'04\', \'05\'/\'05\', and \'06\'/\'06\'
Load Script: API_2_TKR_IMET_BSSBZBS_1.ldr
Cleanup script: API_2_TKR_IMET_BSSBZBS_1.clr
Parameter File: API_2_TKR_IMET_BSSBZBS_1.par
##### 6.2.9.8.3 Test procedure {#test-procedure-118 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+====================+ | 1 | NULL as parameter | Shall throw a | | | | to menuEntry | java.lang.Nul | | | | | lPointerException. | | | | MenuEntry = NULL | | | +----+--------------------+--------------------+--------------------+ | 2 | Offset > | Shall throw | | | | menuEntry.length | java. | | | | | lang.ArrayIndexOut | | | | MenuEntry = | OfBoundsException. | | | | \"ToolkitTest\" | | | | | | | | | | Offset = 12 | | | | | | | | | | Length = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | Offset \ | Shall throw | | | | menuEntry.length | java. | | | | | lang.ArrayIndexOut | | | | MenuEntry = | OfBoundsException. | | | | \"ToolkitTest\" | | | | | | | | | | Offset = 11 | | | | | | | | | | Length = 1 | | | +----+--------------------+--------------------+--------------------+ | 8 | MenuEntry.length | ALLOWED | | | | > size allocated | _LENGTH_EXCEEDED | | | | at loading for | ToolkitException | | | | each menu entry | is thrown. | | | | | | | | | MenuEntry = | | | | | \"ToolkitTest | | | | | impossible\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 16 | | | +----+--------------------+--------------------+--------------------+ | 9 | Successful call,\ | 1- No exception | | | | menuEntry is the | shall be thrown, | | | | whole buffer | Shall return ID | | | | | \'01\'. | | | | 1- initMenuEntry() | | | | | | 2- Shall return | | | | MenuEntry = | true. | | | | \"TOOLKIT TEST 1\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 14 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 2- | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | +----+--------------------+--------------------+--------------------+ | 10 | Successful call,\ | 1- No exception | | | | menuEntry part of | shall be | | | | a buffer | thrown,Shall | | | | | return ID \'02\'. | | | | 1- initMenuEntry() | | | | | | 2- Shall return | | | | MenuEntry = | false. | | | | \"1234567TOOLKIT | | | | | TEST 2\" | | | | | | | | | | Offset = 7 | | | | | | | | | | Length = 14 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 2- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 11 | Successful call,\ | 1- No exception | | | | menuEntry with | shall be thrown, | | | | help supported | Shall return ID | | | | | \'03\' | | | | 1- initMenuEntry() | | | | | | 2- Shall return | | | | MenuEntry = | true. | | | | \"TOOLKIT TEST 3\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 14 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | true | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | 2- | | | | | isEventSet(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+--------------------+ | 12 | Successful call,\ | 1- No exception | | | | menuEntry with an | shall be thrown. | | | | Icon | | | | | | 2- Shall return ID | | | | MenuEntry = | \'04\' | | | | \"TOOLKIT TEST 4\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 14 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'01\' [icon not | | | | | self explanatory] | | | | | | | | | | IconIdentifier = 1 | | | +----+--------------------+--------------------+--------------------+ | 13 | Successful call,\ | 1- No exception | | | | menuEntry with a | shall be thrown. | | | | next action | | | | | indication | 2- Shall return ID | | | | | \'05\' | | | | MenuEntry = | | | | | \"TOOLKIT TEST 5\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 14 | | | | | | | | | | NextAction = | | | | | \'24\' [Select | | | | | Item] | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 14 | Successful call,\ | No exception shall | | | | length = 0 | be thrown,Shall | | | | | return ID \'06\'. | | | | initMenuEntry() | | | | | | | | | | MenuEntry = | | | | | \"ToolkitTest\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 0 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 15 | Initialise more | REGISTRY_ERROR\ | | | | entry than | ToolkitException | | | | allocated at | is thrown. | | | | loading | | | | | | | | | | MenuEntry = | | | | | \"ToolkitTest\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 11 | | | +----+--------------------+--------------------+--------------------+ | 16 | **Dynamic update | | Card shall Send a | | | of the menu stored | | SetUpMenu | | | by the** ME | | Proactive command: | | | | | | | | Fetch | | [Comma | | | | | ndQualifier]=help | | | | | supported | | | | | | | | | | [A | | | | | lphaId]=\"TOOLKIT | | | | | TEST\" | | | | | | | | | | [ItemId=1] = | | | | | \"TOOLKIT TEST 1\" | | | | | | | | | | [ItemId=2] = | | | | | \"TOOLKIT TEST 2\" | | | | | | | | | | [ItemId=3] = | | | | | \"TOOLKIT TEST 3\" | | | | | | | | | | [ItemId=4] = | | | | | \"TOOLKIT TEST 4\" | | | | | | | | | | [ItemId=5] = | | | | | \"TOOLKIT TEST | | | | | 5\"\ | | | | | [ItemId=6] = | | | | | \"\"\ | | | | | [ItemsNextActio | | | | | n]=06000000002400 | +----+--------------------+--------------------+--------------------+ | 17 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOP | ENVELOP | | | | E(MENU_SELECTION) | E(MENU_SELECTION) | | | | command | command & Menu | | | | | Entry ID = \'01\' | | | | Menu Entry ID = | | | | | \'01\' | | | +----+--------------------+--------------------+--------------------+ | 18 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOP | ENVELOP | | | | E(MENU_SELECTION) | E(MENU_SELECTION) | | | | command | command & Menu | | | | | Entry ID = \'02\' | | | | Menu Entry ID = | | | | | \'02\' | | | +----+--------------------+--------------------+--------------------+ | 19 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOP | ENVELOP | | | | E(MENU_SELECTION) | E(MENU_SELECTION) | | | | command | command & Menu | | | | | Entry ID = \'03\' | | | | Menu Entry ID = | | | | | \'03\' | | | +----+--------------------+--------------------+--------------------+ | 20 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOP | ENVELOP | | | | E(MENU_SELECTION) | E(MENU_SELECTION) | | | | command | command & Menu | | | | | Entry ID = \'04\' | | | | Menu Entry ID = | | | | | \'04\' | | | +----+--------------------+--------------------+--------------------+ | 21 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOP | ENVELOP | | | | E(MENU_SELECTION) | E(MENU_SELECTION) | | | | command | command & Menu | | | | | Entry ID = \'05\' | | | | Menu Entry ID = | | | | | \'05\' | | | +----+--------------------+--------------------+--------------------+ | 22 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOPE | ENVE | | | | (MENU_SELECTI | LOPE(MENU_SELECTI | | | | ON_HELP_REQUEST) | ON_HELP_REQUEST) | | | | command | command & Menu | | | | | Entry ID = \'03\' | | | | Menu Entry ID = | | | | | \'03\' | | | +----+--------------------+--------------------+--------------------+ | 23 | Check Applet is | Applet is trigged | | | | triggered by | by an | | | | ENVELOP | ENVELOP | | | | E(MENU_SELECTION) | E(MENU_SELECTION) | | | | command | command & Menu | | | | | Entry ID = \'06\' | | | | Menu Entry ID = | | | | | \'06\' | | | +----+--------------------+--------------------+--------------------+
##### 6.2.9.8.4 Test Coverage {#test-coverage-116 .H6}
CRR number Test case number
* * *
N1 16 N2 9 N3 11 N4 22 N5 11, 16 N6 10 N7 12,16 N8 12,16 N9 13,16 N10 9, 10,
11, 12, 13, 14, 17, 18, 19, 20, 21, 23 P1 1 P2 2, 3, 4 P3 5, 6 P4 7 C1 8 C2 14
#### 6.2.9.9 Method isEventSet
Test Area Reference: API_2_TKR_IEVSB
##### 6.2.9.9.1 Conformance requirement: {#conformance-requirement-104 .H6}
The method with following header shall be compliant to its definition in the
API.
public boolean isEventSet(byte event)
##### 6.2.9.9.1.1 Normal execution {#normal-execution-119 .H6}
  * CRRN1: shall return true if the event is set in the Toolkit Registry > for the applet.
  * CRRN2: shall return false if the event isn\'t set in the Toolkit > Registry for the applet.
##### 6.2.9.9.1.2 Parameters error {#parameters-error-37 .H6}
No requirements.
##### 6.2.9.9.1.3 Context errors {#context-errors-114 .H6}
No requirements.
##### 6.2.9.9.2 Test suite files {#test-suite-files-119 .H6}
Test Script: API_2_TKR_IEVSB_1.scr
Test Applet: API_2_TKR_IEVSB_1.java
API_2_TKR_IEVSB_2.java
  * Installation parameter:
Same as default applet but with:
\- Maximum text length for a menu entry: 15
\- Maximum number of menu entries: 1
\- Position / Identifier for each menu entry: \'01\'/\'01\'
\- Maximum number of timers: 1
Load Script: API_2_TKR_IEVSB_1.ldr
Cleanup script: API_2_TKR_IEVSB_1.clr
Parameter File: API_2_TKR_IEVSB_1.par
##### 6.2.9.9.3 Test procedure {#test-procedure-119 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Install Applet1 | Shall return false | | | | only registered to | each time. | | | | | | | | | EVENT | | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVEN | | | | | T_MENU_SELECTION | | | | | | | | | | Test that events | | | | | aren\'t set | | | | | | | | | | Applet calls | | | | | isEventSet() for | | | | | each event ranging | | | | | from --1, 1 to 24 | | | | | and 127* excepted | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | (2) and | | | | | EVEN | | | | | T_MENU_SELECTION | | | | | (7). | | | +----+--------------------+--------------------+------------------+ | 2 | For | Shall return true. | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | +----+--------------------+--------------------+------------------+ | 3 | For | Shall return true | | | | EVEN | | | | | T_MENU_SELECTION | | | | | | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | +----+--------------------+--------------------+------------------+ | 4 | After clearing | 1- No exception | | | | EVENT_FORMA | shall be thrown. | | | | TTED_SMS_PP_ENV | | | | | | 2- Shall return | | | | 1- | false. | | | | clearE | | | | | vent(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | | | | | | | | 2. isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | +----+--------------------+--------------------+------------------+ | 5 | Setting events | 1- No exception | | | | | shall be thrown. | | | | For all allowed | | | | | events defined in | 2- Shall return | | | | TS 43.019[7] for | true each time. | | | | method | | | | | setEvent():\ | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD, | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_F | | | | | ORMATTED_SMS_CB, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_UNF | | | | | ORMATTED_SMS_CB, | | | | | EVENT_CALL\ | | | | | _CONTROL_BY_SIM, | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM, | | | | | EVENT_EVENT_D | | | | | OWNLOAD_MT_CALL, | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _CALL_CONNECTED, | | | | | EVENT_ | | | | | EVENT_DOWNLOAD_C | | | | | ALL_DISCONNECTED, | | | | | EVENT | | | | | _EVENT_DOWNLOAD\ | | | | | _LOCATION_STATUS, | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_USER_ACTIVITY, | | | | | EVENT_EVENT | | | | | _DOWNLOAD_IDLE_ | | | | | SCREEN_AVAILABLE, | | | | | EVENT_EV | | | | | ENT_DOWNLOAD_CAR | | | | | D_READER_STATUS, | | | | | EVENT_E | | | | | VENT_DOWNLOAD_LA | | | | | NGUAGE_SELECTION, | | | | | EVENT_EV | | | | | ENT_DOWNLOAD_BRO | | | | | WSER_TERMINATION, | | | | | | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _DATA_AVAILABLE, | | | | | | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _CHANNEL_STATUS, | | | | | | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT, | | | | | | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | applet calls: | | | | | | | | | | 1- setEvent() | | | | | method | | | | | | | | | | 2- isEventSet() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 6 | For | 1. Shall return | | | | EVENT_MENU\ | false. | | | | _SELECTION_HELP_ | | | | | REQUEST | Shall return true. | | | | | | | | | 1. isEve | | | | | ntSet(EVENT_MENU\ | | | | | _SELECTION_HELP_ | | | | | REQUEST) | | | | | | | | | | 2. call | | | | | | | | | | changeMenuEntry() | | | | | with help | | | | | supported | | | | | | | | | | 3. isEve | | | | | ntSet(EVENT_MENU\ | | | | | _SELECTION_HELP_ | | | | | REQUEST) | | | +----+--------------------+--------------------+------------------+ | 7 | For | 1- Shall return | | | | EVENT\ | false. | | | | _TIMER_EXPIRATION | | | | | | 3- Shall return | | | | 1- | true. | | | | isEventSet(EVENT_ | | | | | TIMER_EXPIRATION) | | | | | | | | | | 2- call | | | | | allocateTimer() | | | | | | | | | | 3- | | | | | isEventSet(EVENT_ | | | | | TIMER_EXPIRATION) | | | +----+--------------------+--------------------+------------------+ | 8 | For | 1- Shall return | | | | EVEN | false. | | | | T_STATUS_COMMAND | | | | | | 3- Shall return | | | | 1- | true. | | | | isEventSet(EVENT | | | | | _STATUS_COMMAND) | | | | | | | | | | 2. call | | | | | | | | | | requestPollInter | | | | | val(POLL_SYSTEM_ | | | | | DURATION) | | | | | | | | | | 3- | | | | | isEventSet(EVENT | | | | | _STATUS_COMMAND) | | | +----+--------------------+--------------------+------------------+ | 9 | Install Applet2 | Shall return | | | | only registered to | false. | | | | | | | | | EVENT | | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | isEventSet(EVENT | | | | | _MENU_SELECTION) | | | +----+--------------------+--------------------+------------------+
NOTE: Although the method isEventSet() is defined for a range from --128 to
127 only the allowed events are tested, because the range from -128 to --2 is
reserved for propriatary use in TS 43.019 [7] chapter 6.2 and the range from
25 to 126 is omitted for compatibility with future releases of TS 43.019 [7]
##### 6.2.9.9.4 Test Coverage {#test-coverage-117 .H6}
CRR number Test case number
* * *
N1 2,3,4,5,6,7,8 N2 1,5,6,7,8,9
#### 6.2.9.10 Method releaseTimer
Test Area Reference: API_2_TKR_RTIMB
##### 6.2.9.10.1 Conformance requirement: {#conformance-requirement-105 .H6}
The method with following header shall be compliant to its definition in the
API.
public void releaseTimer(byte timerIdentifier)
throws ToolkitException
##### 6.2.9.10.1.1 Normal execution {#normal-execution-120 .H6}
  * CRRN1: if it was the last allocated timer for the applet then a > following call to isEventSet() method for EVENT_TIMER_EXPIRATION > should return false.
  * CRRN2: if applet has timers allocated then a call to > isEventSet(EVENT_TIMER_EXPIRATION) shall return true.
  * CRRN3: After invocation of the method the indicated timer shall be > released and available for reallocation.
  * CRRN4: The applet is deregistered of the EVENT_TIMER_EXPIRATION > for the indicated Timer Identifier.
##### 6.2.9.10.1.2 Parameters error {#parameters-error-38 .H6}
  * CRRP1: shall throw a ToolkitException with INVALID_TIMER_ID reason > if the timer identifier isn\'t between 1 and 8.
##### 6.2.9.10.1.3 Context errors {#context-errors-115 .H6}
  * CRRC1: shall throw a ToolkitException with INVALID_TIMER_ID reason > if the timer is valid but isn\'t allocated to this applet.
##### 6.2.9.10.2 Test suite files {#test-suite-files-120 .H6}
Test Script: API_2_TKR_RTIMB_1.scr
Test Applet: API_2_TKR_RTIMB_1.java
  * Installation parameter:
\- As Default, except max timer which is set to 8.
Load Script: API_2_TKR_RTIMB_1.ldr
Cleanup script: API_2_TKR_RTIMB_1.clr
Parameter File: API_2_TKR_RTIMB_1.par
##### 6.2.9.10.3 Test procedure {#test-procedure-120 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Releasing not | Each time, method | | | | allocated timers | shall throw a | | | | | ToolkitException | | | | For each timer ID | with reason code | | | | ranging from | I | | | | \'00\' to \'FF\', | NVALID_TIMER_ID. | | | | applet calls | | | | | releaseTimer(ID). | | | +----+--------------------+--------------------+------------------+ | 2 | Releasing | 1- No exception | | | | allocated timers | shall be thrown. | | | | | | | | | 1- 8 * | 2- Each time, no | | | | allocateTimer() . | exception shall be | | | | | thrown. | | | | 2- 7 * | | | | | releaseTimer(id). | 3- Shall return | | | | | true | | | | 3- | | | | | isEventSet(EVENT_ | | | | | TIMER_EXPIRATION) | | | +----+--------------------+--------------------+------------------+ | 3 | Releasing invalid | 1- Shall throw a | | | | timer ID | ToolkitException | | | | | with | | | | 1- | INVALID_TIMER_ID | | | | re | reason code. | | | | leaseTimer(\'FF\') | | | | | method | 2- Shall return | | | | | true. | | | | 2- | | | | | isEventSet(EVENT_ | | | | | TIMER_EXPIRATION) | | | +----+--------------------+--------------------+------------------+ | 4 | Releasing last | 1- No exception | | | | timer | shall be thrown. | | | | | | | | | 1- | 2- Shall return | | | | releaseTimer(last | false. | | | | timer allocated) | | | | | | | | | | 2- | | | | | isEventSet(EVENT_ | | | | | TIMER_EXPIRATION) | | | +----+--------------------+--------------------+------------------+ | 5 | **Checking we can | No exception shall | | | | allocate timers | be thrown. | | | | after they** have | | | | | been released | | | | | | | | | | 8 * | | | | | allocateTimer(). | | | +----+--------------------+--------------------+------------------+ | 6 | Releasing all | No exception shall | | | | timers. | be thrown. | | | | | | | | | For 1 to 8, | | | | | releaseTimer(id). | | | +----+--------------------+--------------------+------------------+ | 7 | **Checking applet | Applet is not | | | | isn\'t triggered | trigged by an | | | | by** | ENVELOPE( | | | | ENVELOPE( | TIMER_EXPIRATION) | | | | TIMER_EXPIRATION) | command | | | | command | | | | | | | | | | Send | | | | | ENVELOPE( | | | | | TIMER_EXPIRATION) | | | +----+--------------------+--------------------+------------------+
##### 6.2.9.10.4 Test Coverage {#test-coverage-118 .H6}
CRR number Test case number
* * *
N1 4 N2 2, 3 N3 5, 6 N4 7 P1 1, 3 C1 Framework
#### 6.2.9.11 Method requestPollInterval
Test Area Reference: API_2_TKR_RPOLS
##### 6.2.9.11.1 Conformance requirement: {#conformance-requirement-106 .H6}
The method with following header shall be compliant to its definition in the
API.
public void requestPollInterval(short duration)
throws ToolkitException
##### 6.2.9.11.1.1 Normal execution {#normal-execution-121 .H6}
  * CRRN1: If duration is between 1 and 15300 or equal to > POLL_SYSTEM_DURATION, the applet registers to > EVENT_STATUS_COMMAND.
  * CRRN2: If duration is POLL_NO_DURATION, the applet is deregistered > from EVENT_STATUS_COMMAND.
##### 6.2.9.11.1.2 Parameters error {#parameters-error-39 .H6}
  * CRRP1: the method should throw a ToolkitException with > REGISTRY_ERROR reason if duration is > 15300 or is \ (POLL_SYSTEM_DURATION).
##### 6.2.9.11.1.3 Context errors {#context-errors-116 .H6}
No requirements.
##### 6.2.9.11.2 Test suite files {#test-suite-files-121 .H6}
Test Script: API_2_TKR_RPOLS_1.scr
Test Applet: API_2_TKR_RPOLS_1.java
Load Script: API_2_TKR_RPOLS_1.ldr
Cleanup script: API_2_TKR_RPOLS_1.clr
Parameter File: API_2_TKR_RPOLS_1.par
##### 6.2.9.11.3 Test procedure {#test-procedure-121 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Requesting a value | 1- Shall return | | | | between 1 and | false. | | | | 15300 s | | | | | | 2- No exception | | | | 1- | shall be thrown. | | | | isEventSet(EVENT\ | | | | | _STATUS_COMMMAND) | 3- Shall return | | | | | true. | | | | 2- | | | | | requestPoll | | | | | Interval(duration) | | | | | for boundaries | | | | | values: 1, 255, | | | | | 256, 15300. | | | | | | | | | | 3- | | | | | isEventSet(EVENT\ | | | | | _STATUS_COMMAND). | | | +----+--------------------+--------------------+------------------+ | 2 | **Check Applet is | 2- Applet is | | | | triggered by a | trigged by a | | | | STATUS command** | STATUS command | | | | | | | | | 1- reset and card | | | | | initialization | | | | | | | | | | 2- Send STATUS | | | | | command | | | +----+--------------------+--------------------+------------------+ | 3 | Requesting POLL | 1- Shall return | | | | SYSTEM DURATION | true. | | | | | | | | | 1- | 2- No exception | | | | isEventSet(EVENT_ | shall be thrown. | | | | STATUS_COMMMAND). | | | | | | 3- Shall return | | | | 2- | true. | | | | RequestP | | | | | ollInterval(POLL_ | | | | | SYSTEM_DURATION). | | | | | | | | | | 3- | | | | | IsEventSet(EVENT\ | | | | | _STATUS_COMMAND). | | | +----+--------------------+--------------------+------------------+ | 4 | Check Applet is | 2- Applet is | | | | triggered by a | trigged by a | | | | STATUS command | STATUS command | | | | | | | | | 1- reset and card | | | | | initialization | | | | | | | | | | 2- Send STATUS | | | | | command | | | +----+--------------------+--------------------+------------------+ | 5 | Requesting invalid | Each time, a | | | | duration | ToolkitException | | | | | with | | | | requestPoll | REGISTRY_ERROR | | | | Interval(duration) | reason code, shall | | | | for following | be thrown. | | | | values: 15301, | | | | | 32767, -2, -32768 | | | +----+--------------------+--------------------+------------------+ | 6 | Requesting POLL NO | 1- Shall return | | | | DURATION | true. | | | | | | | | | 1- | 2- No exception | | | | isEventSet(EVENT\ | shall be thrown. | | | | _STATUS_COMMMAND) | | | | | | 3- Shall return | | | | 2- | false. | | | | req | | | | | uestPollInterval(P | | | | | OLL_NO_DURATION) | | | | | | | | | | 3- | | | | | isEventSet(EVENT | | | | | _STATUS_COMMAND) | | | +----+--------------------+--------------------+------------------+ | 7 | Check Applet | 2- Applet is not | | | | isn\'t triggered | trigged by a | | | | by an STATUS | STATUS command | | | | command. | | | | | | | | | | 1- reset and card | | | | | initialization | | | | | | | | | | 2- Send STATUS | | | | | command | | | +----+--------------------+--------------------+------------------+
##### 6.2.9.11.4 Test Coverage {#test-coverage-119 .H6}
CRR number Test case number
* * *
N1 1, 2, 3, 4 N2 6, 7 P1 5
#### 6.2.9.12 Method setEvent
Test Area Reference: API_2_TKR_SEVTB
##### 6.2.9.12.1 Conformance Requirement: {#conformance-requirement-107 .H6}
The method with following header shall be compliant to its definition in the
API.
public void setEvent(byte id)
throws ToolkitException,
javacard.framework.TransactionException
##### 6.2.9.12.1.1 Normal execution {#normal-execution-122 .H6}
  * CRRN1: a following call to isEventSet() method with the same event > id shall answer true for the applet.
  * CRRN2: the SIM Toolkit Framework shall trigger the applet if an > occurrence of the set event happens.
  * CRRN3: the method shall accept all the events defined in 3GPP TS > 43.019 [7] except: EVENT_MENU_SELECTION, > EVENT_MENU_SELECTION_HELP_REQUEST, EVENT_TIMER_EXPIRATION , > EVENT_STATUS_COMMAND
  * CRRN4: no exception shall be thrown if the applet registers more > than once to the same event.
  * CRRN5: all updates in the ToolkitRegistry are atomic.
##### 6.2.9.12.1.2 Parameters error {#parameters-error-40 .H6}
  * CRRP1: shall throw a ToolkitException with EVENT_NOT_SUPPORTED > reason if event is 0.
  * CRRP2: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if event is EVENT_MENU_SELECTION.
  * CRRP3: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if event is EVENT_MENU_SELECTION_HELP_REQUEST.
  * CRRP4: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if event is EVENT_TIMER_EXPIRATION.
  * CRRP5: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if event is EVENT_STATUS_COMMAND.
##### 6.2.9.12.1.3 Context errors {#context-errors-117 .H6}
  * CRRC1: shall throw a ToolkitException with > EVENT_ALREADY_REGISTERED if event is > EVENT_CALL_CONTROL_BY_SIM but another applet is already > registered to it.
  * CRRC2: shall throw a ToolkitException with > EVENT_ALREADY_REGISTERED if event is > EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM but another applet is > already registered to it.
  * CRRC3: shall throw a ToolkitException with TAR_NOT_DEFINED if > event is FORMATTED_SMS_PP_ENV and the applet has no TAR > defined.
  * CRRC4: shall throw a ToolkitException with TAR_NOT_DEFINED if > event is FORMATTED_SMS_PP_UPD and the applet has no TAR > defined.
  * CRRC5: shall throw a ToolkitException with TAR_NOT_DEFINED if > event is FORMATTED_SMS_CB_ENV and the applet has no TAR > defined.
  * CRRC6: shall throw javacard.framework.TransactionException - if the > operation would cause the commit capacity to be exceeded.
##### 6.2.9.12.2 Test suite files {#test-suite-files-122 .H6}
Test Script: API_2_TKR_SEVTB_1.scr
Test Applet: API_2_TKR_SEVTB_1.java
API_2_TKR_SEVTB_2.java
API_2_TKR_SEVTB_3.java
API_2_TKR_SEVTB_4.java
Load Script: API_2_TKR_SEVTB_1.ldr
The load script installs the 4 instances.
Cleanup script: API_2_TKR_SEVTB_1.clr
Parameter File: API_2_TKR_SEVTB_1.par
##### 6.2.9.12.3 Test Procedure {#test-procedure-122 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Applet1 is | Applet1 shall be | | | | triggered by | triggered | | | | ENVELOPE(SMS_ | | | | | PP_FORMATTED) | | | | | command. | | | | | | | | | | Send | | | | | ENVELOPE(S | | | | | MS_PP_FORMATTED) | | | +----+--------------------+--------------------+------------------+ | 2 | Setting ALLOWED | 1.1- No exception | | | | and SUPPORTED | shall be thrown. | | | | events | | | | | | 1.2- Shall return | | | | 1- For all allowed | false. | | | | events (-1, 1 to | | | | | 24 and 127 | 1.3- No exception | | | | excepted 7, 8, 11, | shall be thrown. | | | | 19) defined in TS | | | | | 43.019 [7]*:\ | 1.4- Shall return | | | | EVENT_ | true. | | | | PROFILE_DOWNLOAD, | | | | | EVENT_FORMAT | 1.5- No exception | | | | TED_SMS_PP_ENV, | shall be thrown. | | | | EVENT_FORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_F | | | | | ORMATTED_SMS_CB, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_UNF | | | | | ORMATTED_SMS_CB, | | | | | EVENT_CALL\ | | | | | _CONTROL_BY_SIM, | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM, | | | | | EVENT_EVENT_D | | | | | OWNLOAD_MT_CALL, | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _CALL_CONNECTED, | | | | | EVENT_ | | | | | EVENT_DOWNLOAD_C | | | | | ALL_DISCONNECTED, | | | | | EVENT | | | | | _EVENT_DOWNLOAD\ | | | | | _LOCATION_STATUS, | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_USER_ACTIVITY, | | | | | EVENT_EVENT | | | | | _DOWNLOAD_IDLE_ | | | | | SCREEN_AVAILABLE, | | | | | EVENT_EV | | | | | ENT_DOWNLOAD_CAR | | | | | D_READER_STATUS, | | | | | EVENT_E | | | | | VENT_DOWNLOAD_LA | | | | | NGUAGE_SELECTION, | | | | | EVENT_EV | | | | | ENT_DOWNLOAD_BRO | | | | | WSER_TERMINATION, | | | | | | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _DATA_AVAILABLE, | | | | | | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _CHANNEL_STATUS, | | | | | | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT, | | | | | | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1.1- | | | | | clearEvent(event) | | | | | | | | | | 1.2- | | | | | isEventSet(event) | | | | | | | | | | 1.3- | | | | | setEvent(event) | | | | | | | | | | 1.4- | | | | | isEventSet(event) | | | | | | | | | | 1.5- | | | | | clearEvent(event) | | | +----+--------------------+--------------------+------------------+ | 3 | Event 0 | Shall throw a | | | | | ToolkitException | | | | Call setEvent(0) | with | | | | | EVE | | | | | NT_NOT_SUPPORTED | | | | | reason code. | | +----+--------------------+--------------------+------------------+ | 4 | Setting | Shall throw a | | | | EVEN | ToolkitException | | | | T_MENU_SELECTION | with | | | | | E | | | | Call | VENT_NOT_ALLOWED | | | | setEvent(EVENT | reason code. | | | | _MENU_SELECTION) | | | +----+--------------------+--------------------+------------------+ | 5 | Setting | Shall throw a | | | | E | ToolkitException | | | | VENT_MENU_SELECT | with | | | | ION_HELP_REQUEST | E | | | | | VENT_NOT_ALLOWED | | | | Call | reason code. | | | | setEvent(EV | | | | | ENT_MENU_SELECTI | | | | | ON_HELP_REQUEST) | | | +----+--------------------+--------------------+------------------+ | 6 | Setting | Shall throw a | | | | EVENT\ | ToolkitException | | | | _TIMER_EXPIRATION | with | | | | | E | | | | Call | VENT_NOT_ALLOWED | | | | setEvent(EVENT_ | reason code. | | | | TIMER_EXPIRATION) | | | +----+--------------------+--------------------+------------------+ | 7 | Setting | Shall throw a | | | | EVEN | ToolkitException | | | | T_STATUS_COMMAND | with | | | | | E | | | | Call | VENT_NOT_ALLOWED | | | | setEvent(EVENT | reason code. | | | | _STATUS_COMMAND) | | | +----+--------------------+--------------------+------------------+ | 8 | Setting | No Exception shall | | | | EVENT_CALL | be thrown | | | | _CONTROL_BY_SIM | | | | | | | | | | Call | | | | | set | | | | | Event(EVENT_CALL\ | | | | | _CONTROL_BY_SIM) | | | +----+--------------------+--------------------+------------------+ | 9 | Setting | No Exception shall | | | | EVENT_ | be thrown | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | Call | | | | | setEvent(EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM) | | | +----+--------------------+--------------------+------------------+ | 10 | Check applet is | Applet is trigged | | | | triggered by an | by an | | | | ENVELOPE(CALL\ | ENVELOPE(CALL\ | | | | _CONTROL_BY_SIM) | _CONTROL_BY_SIM) | | | | | | | | | Trigger the applet | | | +----+--------------------+--------------------+------------------+ | 11 | Check applet is | Applet is trigged | | | | triggered by an | by an | | | | ENVELOPE(M | ENVELOPE(M | | | | O_SHORT_MESSAGE\ | O_SHORT_MESSAGE\ | | | | _CONTROL_BY_SIM) | _CONTROL_BY_SIM) | | | | | | | | | Trigger the Applet | | | +----+--------------------+--------------------+------------------+ | 12 | Applet2 is | Applet2 is trigged | | | | triggered by | by an | | | | ENVELOPE(SMS_ | ENVELOPE(SMS_ | | | | PP_DOWNLOAD) | PP_DOWNLOAD) | | | | command. | command | | | | | | | | | Trigger the | | | | | Applet2 | | | +----+--------------------+--------------------+------------------+ | 13 | Applet2 registers | Shall throw a | | | | to | ToolkitException | | | | CALL\ | with | | | | _CONTROL_BY_SIM\ | EVENT_A | | | | but it is already | LREADY_REGISTERED | | | | assigned | reason code. | | | | | | | | | set | | | | | Event(EVENT_CALL\ | | | | | _CONTROL_BY_SIM) | | | +----+--------------------+--------------------+------------------+ | 14 | Applet2 registers | Shall throw a | | | | to | ToolkitException | | | | MO_ME | with | | | | SSAGE_CONTROL_BY | EVENT_A | | | | SIM\ | LREADY_REGISTERED | | | | but it is already | reason code. | | | | assigned | | | | | | | | | | setEvent(EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM) | | | +----+--------------------+--------------------+------------------+ | 15 | Applet3 with no | 1. Applet3 shall | | | | TAR defined | be triggered | | | | registers to | | | | | EVENT_UN | 2. | | | | FORMATTED_SMS_CB | ToolkitException | | | | | with reason | | | | 1. send | code | | | | ENVELOPE(CELL\ | | | | | _BROADCAST_DATA_ | TAR_NOT_DEFINED | | | | DOWNLOAD) | should be | | | | | thrown | | | | 2 | | | | | . setEvent(FORMAT | 3. | | | | TED_SMS_PP_ENV) | ToolkitException | | | | | with reason | | | | 3 | code | | | | . setEvent(FORMAT | | | | | TED_SMS_PP_UPD) | TAR_NOT_DEFINED | | | | | should be | | | | 4 | thrown | | | | . setEvent(FORMAT | | | | | TED_SMS_CB_ENV) | ToolkitException | | | | | with reason code | | | | | TAR_NOT_DEFINED | | | | | should be thrown | | +----+--------------------+--------------------+------------------+ | 16 | Applet4 registers | 1- Applet4 shall | | | | multiple to | be triggered | | | | | | | | | EVENT_FORMA | 2- no Exception | | | | TTED_SMS_PP_ENV | shall be thrown | | | | | | | | | 1- send | 3- no Exception | | | | ENVELOPE( | shall be thrown | | | | EVENT_FORMATTED_ | | | | | SMS_PP_ENV) | 4- Applet4 shall | | | | | be triggered | | | | 2- | | | | | setEvent(EVENT_FO | | | | | RMATTED_SMS_PP_ | | | | | UPD) | | | | | | | | | | 3- | | | | | setEvent(EVENT_FO | | | | | RMATTED_SMS_PP_ | | | | | UPD) | | | | | | | | | | 4- send | | | | | ENVELOPE( | | | | | EVENT_FORMATTED_ | | | | | SMS_PP_UPD) | | | +----+--------------------+--------------------+------------------+
NOTE: Although the method setEvent is defined for a range from --128 to 127
only the allowed events are tested, because the range from -128 to \--2 is
reserved for propriatary use in TS TS 43.019 [7] chapter 6.2 and the range
from 25 to 126 is omitted for compatibility with future releases of TS 43.019
[7]
##### 6.2.9.12.4 Test Coverage {#test-coverage-120 .H6}
CRR number Test case number
* * *
N1 2 N2 1,8,9,10,11,12 N3 2,4,5,6,7 N4 16 N5 not testable P1 3 P2 4 P3 5 P4 6
P5 7 C1 13 C2 14 C3 15 C4 15 C5 15 C6 not testable
#### 6.2.9.13 Method setEventList
Test Area Reference: API_2_TKR_SEVL_BSS
##### 6.2.9.13.1 Conformance Requirement: {#conformance-requirement-108 .H6}
The method with following header shall be compliant to its definition in the
API.
public void setEventList(byte[] eventList,
short offset,
short length)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException,
javacard.framework.TransactionException
##### 6.2.9.13.1.1 Normal execution {#normal-execution-123 .H6}
  * CRRN1: for all events set successfully by this method, a call to > isEventSet() method should return true.
  * CRRN2: the SIM Toolkit Framework shall trigger the applet if an > occurrence of one of the successfully registered events happens.
  * CRRN3: this method shall accept all the events defined in 3GPP TS > 43.019 [7] except: EVENT_MENU_SELECTION, > EVENT_MENU_SELECTION_HELP_REQUEST, EVENT_TIMER_EXPIRATION , > EVENT_STATUS_COMMAND.
  * CRRN4: all updates on the ToolkitRegistry are atomic
  * CRRN5: No exception shall be thrown if the applet registers more > than once to the same event.
##### 6.2.9.13.1.2 Parameters error {#parameters-error-41 .H6}
  * CRRP1: shall throw a java.lang.NullPointerException if eventList is > null.
  * CRRP2: shall throw a java.lang.ArrayIndexOutOfBoundsException if > offset would cause access outside array bounds.
  * CRRP3: shall throw a java.lang.ArrayIndexOutOfBoundsException if > length would cause access outside array bounds.
  * CRRP4: shall throw a java.lang.ArrayIndexOutOfBoundsException if > both offset and length would cause access outside array bounds.
  * CRRP5: shall throw a ToolkitException with EVENT_NOT_SUPPORTED > reason if event is 0.
  * CRRP6: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if eventList contains EVENT_MENU_SELECTION.
  * CRRP7: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if eventList contains > EVENT_MENU_SELECTION_HELP_REQUEST.
  * CRRP8: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if eventList contains EVENT_TIMER_EXPIRATION.
  * CRRP9: shall throw a ToolkitException with EVENT_NOT_ALLOWED > reason if eventList contains EVENT_STATUS_COMMAND.
##### 6.2.9.13.1.3 Context errors {#context-errors-118 .H6}
  * CRRC1: shall throw a ToolkitException with > EVENT_ALREADY_REGISTERED if eventList contains > EVENT_CALL_CONTROL_BY_SIM but another applet is already > registered to it.
  * CRRC2: shall throw a ToolkitException with > EVENT_ALREADY_REGISTERED if eventList contains > EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM but another applet is > already registered to it.
  * CRRC3: shall throw a ToolkitException with TAR_NOT_DEFINED if > event is FORMATTED_SMS_PP_ENV and the applet has no TAR > defined.
  * CRRC4: shall throw a ToolkitException with TAR_NOT_DEFINED if > event is FORMATTED_SMS_PP_UPD and the applet has no TAR > defined.
  * CRRC5: shall throw a ToolkitException with TAR_NOT_DEFINED if > event is FORMATTED_SMS_CB_ENV and the applet has no TAR > defined.
  * CRRC6: shall throw javacard.framework.TransactionException - if the > operation would cause the commit capacity to be exceeded.
##### 6.2.9.13.2 Test suite files {#test-suite-files-123 .H6}
Test Script: API_2_TKR_SEVL_BSS_1.scr
Test Applet: API_2_TKR_SEVL_BSS_1.java
API_2_TKR_SEVL_BSS_2.java
API_2_TKR_SEVL_BSS_3.java
Load Script: API_2_TKR_SEVL_BSS_1.ldr
The load script installs the 4 instances.
Cleanup script: API_2_TKR_SEVL_BSS_1.clr
Parameter File: API_2_TKR_SEVL_BSS_1.par
##### 6.2.9.13.3 Test Procedure {#test-procedure-123 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Applet1 | 1- No exception | | | | Registering all | shall be thrown. | | | | eventList buffer | | | | | | 2- No exception | | | | EventList = all | shall be thrown. | | | | allowed events | | | | | (-1, 1 to 24 and | 3- Each time shall | | | | 127 excepted 7, 8, | return true. | | | | 11, 19) defined in | | | | | TS 43.019[7]:\ | 4- No exception | | | | EVENT_ | shall be thrown. | | | | PROFILE_DOWNLOAD, | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_F | | | | | ORMATTED_SMS_CB, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_UNF | | | | | ORMATTED_SMS_CB, | | | | | EVENT_CALL\ | | | | | _CONTROL_BY_SIM, | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM, | | | | | EVENT_EVENT_D | | | | | OWNLOAD_MT_CALL, | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _CALL_CONNECTED, | | | | | EVENT_ | | | | | EVENT_DOWNLOAD_C | | | | | ALL_DISCONNECTED, | | | | | EVENT | | | | | _EVENT_DOWNLOAD\ | | | | | _LOCATION_STATUS, | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_USER_ACTIVITY, | | | | | EVENT_EVENT | | | | | _DOWNLOAD_IDLE_ | | | | | SCREEN_AVAILABLE, | | | | | | | | | | EVENT_EV | | | | | ENT_DOWNLOAD_CAR | | | | | D_READER_STATUS, | | | | | EVENT_E | | | | | VENT_DOWNLOAD_LA | | | | | NGUAGE_SELECTION, | | | | | EVENT_EV | | | | | ENT_DOWNLOAD_BRO | | | | | WSER_TERMINATION, | | | | | | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _DATA_AVAILABLE, | | | | | | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _CHANNEL_STATUS, | | | | | | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT, | | | | | | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1- For each event | | | | | in EventList | | | | | clearEvent(event) | | | | | | | | | | 2- | | | | | setEv | | | | | entList(eventList) | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | eventList.lentgh | | | | | | | | | | 3- For all events | | | | | in eventList | | | | | isEventSet(event) | | | | | | | | | | 4- For each event | | | | | in EventList | | | | | clearEvent(event) | | | +----+--------------------+--------------------+------------------+ | 2 | Registering part | 1- No exception | | | | of eventList | shall be thrown. | | | | buffer | | | | | | 2- No exception | | | | EventList = all | shall be thrown. | | | | allowed events | | | | | defined in TS | 3- Each time shall | | | | 43.019[7] (see | return true for | | | | test case 1). | events ranging | | | | | from offset to | | | | 1- For each event | offset+length else | | | | in EventList | shall return | | | | clearEvent(event) | false. | | | | | | | | | 2- | 4- No exception | | | | setEv | shall be thrown. | | | | entList(eventList, | | | | | offset, length) | | | | | | | | | | Offset > 0 | | | | | | | | | | Length = | | | | | eventList.lentgh | | | | | -- offset | | | | | | | | | | 3- For all events | | | | | in eventList: | | | | | | | | | | > | | | | | isEventSet(event) | | | | | | | | | | 4- For each event | | | | | in EventList: | | | | | clearEvent(event) | | | +----+--------------------+--------------------+------------------+ | 3 | Null buffer | Shall throw a | | | | | java.lang.Nu | | | | EventList = null | llPointerException | | | | | Exception | | +----+--------------------+--------------------+------------------+ | 4 | Out of bounds | Shall throw a | | | | offset | java.lang.Arr | | | | | ayIndexOutOfBounds | | | | Offset = | Exception | | | | eventList.length | | | | | | | | | | Length = 1 | | | +----+--------------------+--------------------+------------------+ | 5 | Out of bounds and | Shall throw a | | | | big offset | java.lang.Arr | | | | | ayIndexOutOfBounds | | | | Offset = 255 | Exception | | | | | | | | | Length = 1 | | | +----+--------------------+--------------------+------------------+ | 6 | Offset \ | Exception | | | | eventList.length + | | | | | 1 | | | +----+--------------------+--------------------+------------------+ | 11 | Event 0 | Shall throw a | | | | | ToolkitException | | | | Call | with | | | | setEv | EVE | | | | entList(eventList) | NT_NOT_SUPPORTED | | | | with eventList | reason code. | | | | indicating event 0 | | | +----+--------------------+--------------------+------------------+ | 12 | EVEN | Shall throw a | | | | T_MENU_SELECTION | ToolkitException | | | | | with reason code | | | | Call | EV | | | | setEv | ENT_NOT_ALLOWED. | | | | entList(eventList) | | | | | with eventList | | | | | indicating | | | | | EVEN | | | | | T_MENU_SELECTION | | | +----+--------------------+--------------------+------------------+ | 13 | E | Shall throw a | | | | VENT_MENU_SELECT | ToolkitException | | | | ION_HELP_REQUEST | with reason code | | | | | EV | | | | Call | ENT_NOT_ALLOWED. | | | | setEv | | | | | entList(eventList) | | | | | with eventList | | | | | indicating | | | | | E | | | | | VENT_MENU_SELECT | | | | | ION_HELP_REQUEST | | | +----+--------------------+--------------------+------------------+ | 14 | EVENT\ | Shall throw a | | | | _TIMER_EXPIRATION | ToolkitException | | | | | with reason code | | | | Call | EV | | | | setEv | ENT_NOT_ALLOWED. | | | | entList(eventList) | | | | | with eventList | | | | | indicating | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | +----+--------------------+--------------------+------------------+ | 15 | EVEN | Shall throw a | | | | T_STATUS_COMMAND | ToolkitException | | | | | with reason code | | | | Call | EV | | | | setEv | ENT_NOT_ALLOWED. | | | | entList(eventList) | | | | | with eventList | | | | | indicating | | | | | EVEN | | | | | T_STATUS_COMMAND | | | +----+--------------------+--------------------+------------------+ | 16 | Setting | Shall not throw an | | | | EVENT_CALL | exception | | | | _CONTROL_BY_SIM | | | | | | | | | | setEventList(List, | | | | | 0, 2) with List | | | | | containing | | | | | | | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | & | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | +----+--------------------+--------------------+------------------+ | 17 | Check applet is | Applet is trigged | | | | triggered by an | by an | | | | ENVELOPE(CALL\ | ENVELOPE(CALL\ | | | | _CONTROL_BY_SIM) | _CONTROL_BY_SIM) | | | | | | | | | Reset and | | | | | initialise the | | | | | card | | | | | | | | | | **Trigger the | | | | | applet** | | | +----+--------------------+--------------------+------------------+ | 18 | Check applet is | Applet is trigged | | | | triggered by an | by an | | | | ENVELOPE(M | ENVELOPE(M | | | | O_SHORT_MESSAGE\ | O_SHORT_MESSAGE\ | | | | _CONTROL_BY_SIM) | _CONTROL_BY_SIM) | | | | | | | | | Trigger the applet | | | +----+--------------------+--------------------+------------------+ | 19 | Applet2 registers | Shall throw a | | | | to | ToolkitException | | | | CALL\ | with | | | | _CONTROL_BY_SIM\ | EVENT_A | | | | but it is already | LREADY_REGISTERED | | | | assigned | reason code. | | | | | | | | | setEventList( | | | | | MonoEventList,0,1) | | | | | with MonoEventList | | | | | containing | | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | +----+--------------------+--------------------+------------------+ | 20 | Applet2 registers | Shall throw a | | | | to | ToolkitException | | | | M | with | | | | O_SHORT_MESSAGE\ | EVENT_A | | | | _CONTROL_BY_SIM\ | LREADY_REGISTERED | | | | but it is already | reason code. | | | | assigned | | | | | setEventList( | | | | | MonoEventList,0,1) | | | | | with MonoEventList | | | | | containing | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | +----+--------------------+--------------------+------------------+ | 21 | Applet3 with no | 1- Applet3 shall | | | | TAR defined | be triggered | | | | registers to | | | | | EVENT_UN | 2- | | | | FORMATTED_SMS_CB | ToolkitException | | | | | with reason code | | | | 1- send | TAR_NOT_DEFINED | | | | E | should be thrown | | | | NVELOPE(EVENT_UNF | | | | | ORMATTED_SMS_CB) | 3- | | | | | ToolkitException | | | | 2- | with reason code | | | | setEvent | TAR_NOT_DEFINED | | | | List(EVENT_FORMAT | should be thrown | | | | TED_SMS_PP_ENV, | | | | | EVENT_UNFORMAT | 4- | | | | TED_SMS_PP_ENV, | ToolkitException | | | | EVENT_UNFORMAT | with reason code | | | | TED_SMS_PP_ENV) | TAR_NOT_DEFINED | | | | | should be thrown | | | | 3- | | | | | setEve | 5- method should | | | | ntList(EVENT_UNFO | return FALSE | | | | RMATTED_SMS_PP_ | | | | | ENV, | 6- method should | | | | EVENT_FORMAT | return FALSE | | | | TED_SMS_PP_UPD, | | | | | EVENT_UNFORMAT | 7- method should | | | | TED_SMS_PP_ENV) | return FALSE | | | | | | | | | 4- | 8- method should | | | | setEventLi | return FALSE | | | | st(EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | 9- method should | | | | EVENT_UNFORMAT | return FALSE | | | | TED_SMS_PP_ENV, | | | | | EVENT_FORMAT | | | | | TED_SMS_CB_ENV) | | | | | | | | | | 5- | | | | | isEventS | | | | | et(EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV) | | | | | | | | | | 6- | | | | | isEventS | | | | | et(EVENT_UNFORMAT | | | | | TED_SMS_PP_UPD) | | | | | | | | | | 7- | | | | | isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | | | | | | | | 8- | | | | | isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_PP_UPD) | | | | | | | | | | 9- | | | | | isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_CB_ENV) | | | +----+--------------------+--------------------+------------------+ | 22 | 1- | 1- no exception | | | | setEventLi | should be thrown | | | | st(EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | 2- method should | | | | EVENT_UNFORMAT | return true | | | | TED_SMS_PP_ENV) | | | | | | | | | | 2- | | | | | isEventS | | | | | et(EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV) | | | +----+--------------------+--------------------+------------------+
##### 6.2.9.13.4 Test Coverage {#test-coverage-121 .H6}
CRR number Test case number
* * *
N1 1,2 N2 16,17,18 N3 1,2,11,12,13,14,15 N4 21 N5 22 P1 3 P2 4,5,6 P3 7,8,9 P4
10 P5 11 P6 12 P7 13 P8 14 P9 15 C1 19 C2 20 C3 21 C4 21 C5 21 C6 not testable
### 6.2.10 Class ViewHandler
It is not possible to test the methods provided by this class as it is
declared \'abstract\'; it will be done in the class inheriting it:
EditHandler, EnvelopeHandler, ProactiveResponseHandler, ProactiveHandler.
### 6.2.11 Class ToolkitException
#### 6.2.11.1 Exception Constants
Test Area Reference: API_2_TKE_CONS
##### 6.2.11.1.1 Conformance requirement: {#conformance-requirement-109 .H6}
There is no API, only constants.
##### 6.2.11.1.1.1 Normal execution {#normal-execution-124 .H6}
  * CRRN1: The Constants of the class ToolkitException shall all have > the same name and value defined in the 3GPP TS 43.019 [7].
##### 6.2.11.1.1.2 Parameters error {#parameters-error-42 .H6}
No requirements.
##### 6.2.11.1.1.3 Context errors {#context-errors-119 .H6}
No requirements.
##### 6.2.11.1.2 Test suite files {#test-suite-files-124 .H6}
None.
##### 6.2.11.1.3 Test procedure {#test-procedure-124 .H6}
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed.
#### 6.2.11.2 Constructor ToolkitException
Test Area Reference: API_2_TKE_COORS
##### 6.2.11.2.1 Conformance requirement: {#conformance-requirement-110 .H6}
The constructor with following headershall compliant to its definition in the
API.
public ToolkitException(short reason)
##### 6.2.11.2.1.1 Normal execution {#normal-execution-125 .H6}
  * CRRN1: Construct a ToolkitException instance with the specified > reason.
##### 6.2.11.2.1.2 Parameters error {#parameters-error-43 .H6}
No requirements.
##### 6.2.11.2.1.3 Context errors {#context-errors-120 .H6}
No requirements.
##### 6.2.11.2.2 Test suite files {#test-suite-files-125 .H6}
No additional requirements for the GSM personalization:
Test Script: API_2_TKE_COORS_1.scr
Test Applet: API_2_TKE_COORS_1.java
Load Script: API_2_TKE_COORS_1.ldr
Cleanup script: API_2_TKE_COORS_1.clr
Parameter File: API_2_TKE_COORS_1.par
##### 6.2.11.2.3 Test procedure {#test-procedure-125 .H6}
Id Description API Expectation APDU Expectation
* * *
1 reason = (short) 19 ToolkitException.getReason() = (short)19
##### 6.2.11.2.4 Test Coverage {#test-coverage-122 .H6}
CRR number Test case number
* * *
N1 1
#### 6.2.11.3 Method throwIt
Test Area Reference: API_2_TKE_THITS
##### 6.2.11.3.1 Conformance requirement: {#conformance-requirement-111 .H6}
The method with following header shall compliant to its definition in the API.
public static void throwIt(short reason)
throws ToolkitException
##### 6.2.11.3.1.1 Normal execution {#normal-execution-126 .H6}
  * CRRN1: Throws the JCRE instance of the ToolkitException class with > the specified reason.
  * CRRN2: extends javacard.framework.CardRuntimeException
##### 6.2.11.3.1.2 Parameters error {#parameters-error-44 .H6}
No requirements.
##### 6.2.11.3.1.3 Context errors {#context-errors-121 .H6}
No requirements.
##### 6.2.11.3.2 Test suite files {#test-suite-files-126 .H6}
No additional requirements for the GSM personalization:
Test Script: API_2_TKE_THITS_1.scr
Test Applet: API_2_TKE_THITS_1.java
Load Script: API_2_TKE_THITS_1.ldr
Cleanup Script: API_2_TKE_THITS_1.clr
Parameter File: API_2_TKE_THITS_1.par
##### 6.2.11.3.3 Test procedure {#test-procedure-126 .H6}
Id Description API Expectation APDU Expectation
* * *
1 Throws the JCRE instance of ToolkitException with the specified reason
Reason = 0  
2 Throws the JCRE instance of ToolkitException with the specified reason
Reason = 1  
3 Throws the JCRE instance of ToolkitException with the specified reason
Reason = 15  
4 **ToolkitException extends javacard.framework.CardRuntimeException** Reason
= 0  
5 ToolkitException extends javacard.framework.CardRuntimeException Reason = 1  
6 ToolkitException extends javacard.framework.CardRuntimeException Reason = 15
##### 6.2.11.3.4 Test Coverage {#test-coverage-123 .H6}
CRR number Test case number
* * *
N1 1, 2, 3 N2 4, 5, 6
## 6.3 SIM Toolkit Framework
### 6.3.1 Minimum Handler Availability
This test area tests the rules that define the minimum requirements for the
availability of the system handlers.
#### 6.3.1.1 ProactiveHandler
Test Area Reference: FWK_MHA_PAHD
##### 6.3.1.1.1 Conformance Requirement {#conformance-requirement-112 .H6}
##### 6.3.1.1.1.1 Normal Execution {#normal-execution-127 .H6}
  * CRRN1: If a proactive session is not ongoing the ProactiveHandler is > available from the invocation to the termination of the > processToolkit method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_FORMATTED_SMS_CB
EVENT_UNFORMATTED_SMS_CB
EVENT_MENU_SELECTION
EVENT_MENU_SELECTION_HELP_REQUEST
EVENT_TIMER_EXPIRATION
EVENT_EVENT_DOWNLOAD_MT_CALL
EVENT_EVENT_DOWNLOAD_CALL_CONNECTED
EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED
EVENT_EVENT_DOWNLOAD_LOCATION_STATUS
EVENT_EVENT_DOWNLOAD_USER_ACTIVITY
EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE
EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS
EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION
EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION
EVENT_UNRECOGNIZED_ENVELOPE
EVENT_STATUS_COMMAND
EVENT_CALL_CONTROL
EVENT_SMS_MO_CONTROL
EVENT_PROFILE_DOWNLOAD
EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE
EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS
##### 6.3.1.1.1.2 Parameters error {#parameters-error-45 .H6}
No requirements.
##### 6.3.1.1.1.3 Context errors {#context-errors-122 .H6}
  * CRRC1: The ProactiveHandler and its content are not available for > any toolkit applet triggered from the invocation to the > termination of their processToolkit method for the following > events:
EVENT_FIRST_COMMAND_AFTER_SELECT
##### 6.3.1.1.2 Test Suite Files {#test-suite-files-127 .H6}
> Test Script: FWK_MHA_PAHD_1.scr
>
> Test Applet: FWK_MHA_PAHD_1.java
>
> FWK_MHA_PAHD_2.java
>
> Load Script: FWK_MHA_PAHD_1.ldr
>
> Cleanup Script: FWK_MHA_PAHD_1.clr
>
> Parameter File: FWK_MHA_PAHD_1.par
##### Test Procedure {#test-procedure-127 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API /Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applets | 1- Applet1 is | | | | registration to | triggered by | | | | all events and | EVENT_FIRST_COMM | | | | Proactive Handler | AND_AFTER_SELECT | | | | availability with | | | | | EVENT_FIRST_COMM | 2- A Toolkit | | | | AND_AFTER_SELECT | Exception | | | | | HANDL | | | | Applet1 is | ER_NOT_AVAILABLE | | | | registered to all | is thrown. | | | | events defined in | | | | | TS 43.019 [7]. | Applet1 finalizes | | | | | | | | | Using the methods | Applet2 is | | | | initMenuEntry() | triggered by | | | | for | EVENT_FIRST_COMM | | | | EVENT | AND_AFTER_SELECT | | | | _MENU_SELECTION, | | | | | req | 3- A Toolkit | | | | uestPollInterval() | Exception | | | | for | HANDL | | | | EVENT | ER_NOT_AVAILABLE | | | | _STATUS_COMMAND, | is thrown. | | | | allocateTimer() | | | | | for | Applet2 finalizes | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | Applet2 is | | | | | registered to all | | | | | events defined in | | | | | TS 43.019 [7], | | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | and | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | Using the methods | | | | | initMenuEntry() | | | | | for | | | | | EVENT | | | | | _MENU_SELECTION, | | | | | req | | | | | uestPollInterval() | | | | | for | | | | | EVENT | | | | | _STATUS_COMMAND, | | | | | allocateTimer() | | | | | for | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | The priority of | | | | | applet1 is higher | | | | | than priority of | | | | | applet2 | | | | | | | | | | 1- Select MF | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler. | | | | | | | | | | Applet1 is | | | | | deregistered from | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | | | | | | | | Applet2 is | | | | | deregistered to | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | +----+--------------------+--------------------+--------------------+ | 2 | **Proactive | 1- Applet1 is | | | | Handler | triggered by | | | | availability with | EVENT\ | | | | EVENT_P | _PROFILE_DOWNLOAD | | | | ROFILE_DOWNLOAD** | | | | | | 2- No exception is | | | | 1- Terminal | thrown. | | | | Profile command is | | | | | sent to the SIM | Applet1 finalizes. | | | | without the | | | | | facility of | Applet2 is | | | | SET_EVENT_LIST, | triggered by | | | | POLL_INTERVAL,SET | EVENT\ | | | | UP IDLE MODE TEXT | _PROFILE_DOWNLOAD | | | | and SET UP MENU. | | | | | | 3- No exception is | | | | 2- Applet1 gets | thrown | | | | the Proactive | | | | | Handler | | | | | | | | | | Applet1 is | | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | | | | | | | | Applet2 is | | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | +----+--------------------+--------------------+--------------------+ | 3 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | E | | | | | VENT_MENU_SELECT | 2- No exception is | | | | ION_HELP_REQUEST | thrown | | | | | | | | | Perform SIM | Applet1 finalizes | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1- Envelope menu | | | | | selection with | | | | | help request is | | | | | sent to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 4 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_MENU_SELECTION | 2- No exception is | | | | | thrown. | | | | 1- Envelope menu | | | | | selection is sent | Applet1 finalizes | | | | to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 5 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1- Envelope | | | | | dataDownLoad | Applet1 finalizes | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 6 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1- Envelope | | | | | dataDownLoad | Applet1 finalizes | | | | unformatted is | | | | | sent to the SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the Proactive | 3 No exception is | | | | Handler | thrown. | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 7 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMATTE | | | | | D_CELL_BROADCAST | 2-No exception is | | | | | thrown | | | | 1- Envelope cell | | | | | broadcast | Applet1 finalizes | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 8 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMATTE | | | | | D_CELL_BROADCAST | 2- No exception is | | | | | thrown | | | | 1- Envelope cell | | | | | broadcast | Applet1 finalizes | | | | unformatted is | | | | | sent to the SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the Proactive | 3 No exception is | | | | Handler | thrown | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 9 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT\ | | | | | _TIMER_EXPIRATION | 2- No exception is | | | | | thrown. | | | | 1- Timer Id =1 | | | | | | Applet1 finalizes | | | | Envelope Timer | | | | | Expiration is sent | | | | | to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 10 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | 2- No exception is | | | | | thrown. | | | | 1- Envelope call | | | | | control by SIM is | | | | | sent to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 11 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_MO_SHORT | | | | | _MESSAGE_CONTROL | 2- No exception is | | | | | thrown | | | | 1- Envelope mo | | | | | short message | | | | | control by SIM is | | | | | sent to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 12 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | 2- No exception is | | | | | thrown. | | | | 1- Envelope event | | | | | download mt call | Applet1 finalizes | | | | is sent to the SIM | | | | | | Applet2 is | | | | 2- Applet1 gets | triggered | | | | the Proactive | | | | | Handler | 3-No exception is | | | | | thrown | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 13 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVE | | | | | NT_EVENT_DOWNLOA | 2- No exception is | | | | D_CALL_CONNECTED | thrown. | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download call | | | | | connected is sent | Applet2 is | | | | to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- No exception is | | | | the Proactive | thrown | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 14 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | 2- No exception is | | | | CALL_DISCONNECTED | thrown. | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download call | | | | | disconnected is | Applet2 is | | | | sent to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- No exception is | | | | the Proactive | thrown. | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 15 | Applets triggering | 1- Applet1 is | | | | with | triggered | | | | EVENT_EVENT | | | | | _LOCATION_STATUS | 2- No exception is | | | | | thrown. | | | | 1- Envelope event | | | | | download location | Applet1 finalizes | | | | status is sent to | | | | | the SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the Proactive | 3- No exception is | | | | Handler | thrown | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 16 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EV | | | | | ENT_EVENT_DOWNLO | 2- No exception is | | | | AD_USER_ACTIVITY | thrown | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download user | | | | | activity is sent | Applet2 is | | | | to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- No exception is | | | | the Proactive | thrown | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 17 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_EVEN | | | | | T_DOWNLOAD_IDLE\ | 2- No exception is | | | | _SCREEN_AVAILABLE | thrown. | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download idle | | | | | screen available | Applet2 is | | | | is sent to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- No exception is | | | | the Proactive | thrown | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 18 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_E | | | | | VENT_DOWNLOAD_CA | 2- No exception is | | | | RD_READER_STATUS | thrown. | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download card | | | | | reader status is | Applet2 is | | | | sent to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- No exception is | | | | the Proactive | thrown | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 19 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | EVENT_DOWNLOAD_L | 2-No exception is | | | | ANGUAGE_SELECTION | thrown. | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download language | | | | | selection is sent | Applet2 is | | | | to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3-No exception is | | | | the Proactive | thrown | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 20 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_E | | | | | VENT_DOWNLOAD_BR | 2-No exception is | | | | OWSER_TERMINATION | thrown. | | | | | | | | | 1- Envelope event | Applet1 finalizes | | | | download browser | | | | | termination is | Applet2 is | | | | sent to the SIM | triggered | | | | | | | | | 2- Applet1 gets | 3-No exception is | | | | the Proactive | thrown | | | | Handler | | | | | | | | | | 3- Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 21 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_STATUS_COMMAND | 2- No exception is | | | | | thrown. | | | | 1- Status command | | | | | is sent to the SIM | Applet1 finalizes | | | | | | | | | 2- Applet1 gets | Applet2 is | | | | the Proactive | triggered | | | | Handler | | | | | | 3- No exception is | | | | 3- Applet2 gets | thrown. | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 22 | Proactive Handler | 2-Applet1 is | 1- OPEN CHANNEL | | | availability with | triggered | proactive Command | | | EVE | | is fetched | | | NT_EVENT_DOWNLOA | 3-No exception is | | | | D_DATA_AVAILABLE | thrown. | TERMINAL RESPONSE | | | | | is issued with | | | 1- Applet1 builds | Applet1 finalizes | Channel Id = 01 | | | a proactive | | | | | command OPEN | | | | | CHANNEL | | | | | proac | | | | | tiveHandler.send() | | | | | method is called. | | | | | | | | | | 2- An Envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM, | | | | | with channelId=01. | | | | | | | | | | 3- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 23 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVE | | | | | NT_EVENT_DOWNLOA | 2- No exception is | | | | D_CHANNEL_STATUS | thrown. | | | | | | | | | **1- An Envelope | Applet1 finalizes | | | | Event Download | | | | | Channel Status is | | | | | sent to the SIM, | | | | | with | | | | | ChannelId=01** | | | | | | | | | | **2- Applet1 gets | | | | | the Proactive | | | | | Handler** | | | +----+--------------------+--------------------+--------------------+ | 24 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | UNRE | | | | | COGNIZED_ENVELOPE | 2- No exception is | | | | | thrown. | | | | 1- An unrecognized | | | | | Envelope (BER TLV | Applet1 finalizes | | | | Tag unrecognized) | | | | | is sent to the SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the Proactive | 3- No exception is | | | | Handler | thrown | | | | | | | | | 3-Applet2 gets the | | | | | Proactive Handler | | | +----+--------------------+--------------------+--------------------+ | 25 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- Update Record | | | | | EFsms instruction | Applet1 finalizes | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2- Applet1 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+ | 26 | Proactive Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- Update Record | | | | | EFsms instruction | Applet1 finalizes | | | | unformatted is | | | | | sent to the SIM | 3- Applet2 is | | | | | triggered | | | | 1. Applet1 gets | | | | | the Proactive | 4- No exception is | | | | Handler | thrown. | | | | | | | | | 2. Applet2 gets | | | | | the Proactive | | | | | Handler | | | +----+--------------------+--------------------+--------------------+
##### 6.3.1.1.4 Test Coverage {#test-coverage-124 .H6}
**CRR Number** **Test Case Number**
* * *
CRRN1 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,
22, 23, 24, 25, 26 CRRC1 1
#### 6.3.1.2 ProactiveResponseHandler
Test Area Reference: FWK_MHA_PRHD
##### 6.3.1.2.1 Conformance Requirement {#conformance-requirement-113 .H6}
##### 6.3.1.2.1.1 Normal Execution {#normal-execution-128 .H6}
  * CRRN1: The ProactiveResponseHandler is available after the first > call to the ProactiveHandler.send() method to the termination of > the processToolkit method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_FORMATTED_SMS_CB
EVENT_UNFORMATTED_SMS_CB
EVENT_MENU_SELECTION
EVENT_MENU_SELECTION_HELP_REQUEST
EVENT_TIMER_EXPIRATION
EVENT_EVENT_DOWNLOAD_MT_CALL
EVENT_EVENT_DOWNLOAD_CALL_CONNECTED
EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED
EVENT_EVENT_DOWNLOAD_LOCATION_STATUS
EVENT_EVENT_DOWNLOAD_USER_ACTIVITY
EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE
EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS
EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION
EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION
EVENT_UNRECOGNIZED_ENVELOPE
EVENT_STATUS_COMMAND
EVENT_CALL_CONTROL
EVENT_SMS_MO_CONTROL
EVENT_PROFILE_DOWNLOAD
EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE
EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS
##### 6.3.1.2.1.2 Parameters error {#parameters-error-46 .H6}
No requirements.
##### 6.3.1.2.1.3 Context errors {#context-errors-123 .H6}
  * CRRC1: The ProactiveResponseHandler and its content are not > available for any toolkit applet triggered from the invocation to > the termination of their processToolkit method for the following > events:
EVENT_FIRST_COMMAND_AFTER_SELECT
##### 6.3.1.2.2 Test Suite Files {#test-suite-files-128 .H6}
> Test Script: FWK_MHA_PRHD_1.scr
>
> Test Applet: FWK_MHA_PRHD_1.java
>
> FWK_MHA_PRHD_2.java
>
> Load Script: FWK_MHA_PRHD_1.ldr
>
> Cleanup Script: FWK_MHA_PRHD_1.clr
>
> Parameter File: FWK_MHA_PRHD_1.par
##### 6.3.1.2.3 Test Procedure {#test-procedure-128 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applets | 1-Applet1 is | 3- The proactive | | | registration to | triggered by | command | | | all events and | EVENT\ | | | | Proactive Response | _PROFILE_DOWNLOAD | DISPLAY TEXT is | | | Handler | | fetched | | | availability with | No exception is | | | | EVENT\ | thrown | TERMINAL RESPONSE | | | _PROFILE_DOWNLOAD | | | | | | 4- No exception is | 6- The proactive | | | Applet1 is | thrown | command | | | registered to all | | | | | events defined in | Applet1 finalizes | DISPLAY TEXT is | | | TS 43.019 [7] | | fetched | | | except | Applet2 is | | | | E | triggered by | TERMINAL RESPONSE | | | VENT_FIRST_COMMA | EVENT\ | | | | ND_AFTER_SELECT, | _PROFILE_DOWNLOAD | | | | | | | | | Applet2 is | 7- No exception is | | | | registered to all | thrown | | | | events defined in | | | | | TS 43.109[7] | | | | | except | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT, | | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | and | | | | | EVENT_MO_SMS\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | Using the methods | | | | | initMenuEntry() | | | | | for | | | | | EVENT | | | | | _MENU_SELECTION, | | | | | req | | | | | uestPollInterval() | | | | | for | | | | | EVENT | | | | | _STATUS_COMMAND, | | | | | allocateTimer() | | | | | for | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | 1-Terminal Profile | | | | | command is sent to | | | | | the SIM without | | | | | the facility of | | | | | SET_EVENT_LIST, | | | | | POLL_INTERVAL,SET | | | | | UP IDLE MODE TEXT | | | | | and SET UP MENU. | | | | | | | | | | 2- Applet1 builds | | | | | a proactive | | | | | command DISPLAY | | | | | TEXT. | | | | | | | | | | 3- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 4- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet1 is | | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | | | | | | | | 5- Applet2 builds | | | | | a proactive | | | | | command DISPLAY | | | | | TEXT. | | | | | | | | | | 6- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 7- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet1 is | | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | +----+--------------------+--------------------+--------------------+ | 2 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | E | 3- No exception is | | | | VENT_MENU_SELECT | thrown | TERMINAL RESPONSE | | | ION_HELP_REQUEST | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-Envelope menu | | | | | selection with | | | | | help request is | | | | | sent to the SIM | | | | | | | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 3 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVEN | 3- No exception is | | | | T_MENU_SELECTION | thrown | TERMINAL RESPONSE | | | | | | | | 1-Envelope menu | | | | | selection is sent | | | | | to the SIM | | | | | | | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 4 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_FORMA | 3- No exception is | | | | TTED_SMS_PP_ENV | thrown | TERMINAL RESPONSE | | | | | | | | 1-Envelope | | | | | dataDownLoad | | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 5 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_UNFORMA | 3- No exception is | | | | TTED_SMS_PP_ENV | thrown | TERMINAL RESPONSE | | | | | | | | 1-Envelope | Applet1 finalizes | 4- A proactive | | | dataDownLoad | | command DISPLAY | | | unformatted is | Applet2 is | TEXT is fetched | | | sent to the SIM | triggered | | | | | | TERMINAL RESPONSE | | | Applet1 builds a | 5- No exception is | | | | proactive command | thrown | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 6 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVE | 3- No exception is | | | | NT_FORMATTED_SMS | thrown | TERMINAL RESPONSE | | | _CB | | | | | | | | | | 1-Envelope cell | | | | | broadcast | | | | | formatted is | | | | | | | | | | sent to the SIM | | | | | | | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called. | | | +----+--------------------+--------------------+--------------------+ | 7 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT | 3- No exception is | | | | _UNFORMATTED_SMS | thrown | TERMINAL RESPONSE | | | _CB | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope call | | command DISPLAY | | | broadcast | Applet2 is | TEXT is fetched | | | unformatted is | triggered | | | | | | TERMINAL RESPONSE | | | sent to the SIM | 5- No exception is | | | | | thrown | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called. | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 8 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT\ | 3- No exception is | | | | _TIMER_EXPIRATION | thrown | TERMINAL RESPONSE | | | | | | | | Timer id=1 | | | | | | | | | | 1-Envelope Timer | | | | | Expiration is sent | | | | | to the SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 9 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_CALL | 3- No exception is | | | | _CONTROL_BY_SIM | thrown | TERMINAL RESPONSE | | | | | | | | 1-Envelope call | | | | | control by sim is | | | | | sent to the SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 10 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | _ | 3- No exception is | | | | MO_SHORT_MESSAGE | thrown | TERMINAL RESPONSE | | | _CONTROL_BY_SIM | | | | | | | | | | 1-Envelope mo | | | | | short message | | | | | control by sim is | | | | | sent to the SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 11 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_EVENT_ | 3- No exception is | | | | DOWNLOAD_MT_CALL | thrown | TERMINAL RESPONSE | | | | | | | | 1-Envelope event | Applet1 finalizes | 4- A proactive | | | download mt call | | command DISPLAY | | | is sent to the SIM | Applet2 is | TEXT is fetched | | | | triggered | | | | Applet1 builds a | | TERMINAL RESPONSE | | | proactive command | 5- No exception is | | | | DISPLAY TEXT | thrown | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called. | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 12 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVE | 3- No exception is | | | | NT_EVENT_DOWNLOA | thrown | TERMINAL RESPONSE | | | D_CALL_CONNECTED | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope event | | command DISPLAY | | | download call | Applet2 is | TEXT is fetched | | | connected is sent | triggered | | | | to the SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 13 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT\ | 3- No exception is | | | | _EVENT_DOWNLOAD_ | thrown | TERMINAL RESPONSE | | | CALL_DISCONNECTED | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope event | | command DISPLAY | | | download call | Applet2 is | TEXT is fetched | | | disconnected is | triggered | | | | sent to the SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 14 | Proactive Response | 1- Applet1 is | 2-A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVEN | 3- No exception is | | | | T_EVENT_DOWNLOAD | thrown | TERMINAL RESPONSE | | | _LOCATION_STATUS | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope event | | command DISPLAY | | | download location | Applet2 is | TEXT is fetched | | | status is sent to | triggered | | | | the SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 15 | Proactive Response | 1- Applet1 is | 2-A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EV | 3- No exception is | | | | ENT_EVENT_DOWNLO | thrown | TERMINAL RESPONSE | | | AD_USER_ACTIVITY | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope event | | command DISPLAY | | | download user | Applet2 is | TEXT is fetched | | | activity is sent | triggered | | | | to the SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 16 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_EVEN | 3- No exception is | | | | T_DOWNLOAD_IDLE\ | thrown | TERMINAL RESPONSE | | | _SCREEN_AVAILABLE | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope event | | command DISPLAY | | | download idle | Applet2 is | TEXT is fetched | | | screen available | triggered | | | | is sent to the SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 17 | Proactive Response | 1- Applet1 is | 2-A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_E | 3- No exception is | | | | VENT_DOWNLOAD_CA | thrown | TERMINAL RESPONSE | | | RD_READER_STATUS | | | | | | Applet1 finalizes | 4- A proactive | | | 1-Envelope event | | command DISPLAY | | | download card | Applet2 is | TEXT is fetched | | | reader status is | triggered | | | | sent to the SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 18 | Proactive Response | 1- Applet1 is | 2-A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_EVENT_DO | 3-No exception is | | | | WNLOAD_LANGUAGE_ | thrown | TERMINAL RESPONSE | | | | | | | | SELECTION | Applet1 finalizes | 4-A proactive | | | | | command DISPLAY | | | 1-Envelope event | Applet2 is | TEXT is fetched | | | download language | triggered | | | | selection is sent | | TERMINAL RESPONSE | | | to the SIM | 5-No exception is | | | | | thrown | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 19 | Proactive Response | 1- Applet1 is | 2-A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_EVENT_D | 3-No exception is | | | | OWNLOAD_BROWSER_ | thrown | TERMINAL RESPONSE | | | | | | | | TERMINATION | Applet1 finalizes | 4-A proactive | | | | | command DISPLAY | | | 1-Envelope event | Applet2 is | TEXT is fetched | | | download Browser | triggered | | | | termination is | | TERMINAL RESPONSE | | | sent to the SIM | 5-No exception is | | | | | thrown | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 20 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVEN | 3- No exception is | | | | T_STATUS_COMMAND | thrown | TERMINAL RESPONSE | | | | | | | | 1-Status command | Applet1 finalizes | 4- A proactive | | | is sent to the SIM | | command DISPLAY | | | | Applet2 is | TEXT is fetched | | | Applet1 builds a | triggered | | | | proactive command | | TERMINAL RESPONSE | | | DISPLAY TEXT | 5- No exception is | | | | | thrown | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 21 | Proactive Handler | 1- Applet1 is | 1- OPEN CHANNEL | | | availability with | registered to | proactive command | | | EVE | EVE | is fetched | | | NT_EVENT_DOWNLOA | NT_EVENT_DOWNLOA | | | | D_DATA_AVAILABLE | D_DATA_AVAILABLE | TERMINAL RESPONSE | | | | and | is issued with | | | 1- Applet1 builds | EVE | Channel Id = 01 | | | a proactive | NT_EVENT_DOWNLOA | | | | command OPEN | D_CHANNEL_STATUS | 4- A proactive | | | CHANNEL. | | command DISPLAY | | | | 2- Applet1 is | TEXT is fetched | | | proac | triggered | | | | tiveHandler.send() | | TERMINAL RESPONSE | | | method is called | 5- No exception is | | | | | thrown | | | | 2- An Envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM, | | | | | with ChannelId=01. | | | | | | | | | | 3-Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 22 | Proactive Handler | 1- Applet1 is | 2- A proactive | | | availability with | triggered | command DISPLAY | | | EVE | | TEXT is fetched | | | NT_EVENT_DOWNLOA | 3- No exception is | | | | D_CHANNEL_STATUS | thrown | TERMINAL RESPONSE | | | | | | | | 1-An Envelope | | | | | Event Download | | | | | Channel Status is | | | | | sent to the SIM | | | | | with ChannelId=01. | | | | | | | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 23 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | UNRE | 3- No exception is | | | | COGNIZED_ENVELOPE | thrown | TERMINAL RESPONSE | | | | | | | | 1-An unrecognized | Applet1 finalizes | 4- A proactive | | | Envelope is sent | | command DISPLAY | | | to the SIM | Applet2 is | TEXT is fetched | | | | triggered | | | | Applet1 builds a | | TERMINAL RESPONSE | | | proactive command | 5- No exception is | | | | DISPLAY TEXT | thrown | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 24 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_FORMA | 3- No exception is | | | | TTED_SMS_PP_UPD | thrown | TERMINAL RESPONSE | | | | | | | | 1- Update Record | | | | | EFsms instruction | | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 25 | Proactive Response | 1- Applet1 is | 2- A proactive | | | Handler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_UNFORMA | 3- No exception is | | | | TTED_SMS_PP_UPD | thrown | TERMINAL RESPONSE | | | | | | | | 1- Update Record | Applet1 finalizes | 4- A proactive | | | EFsms instruction | | command DISPLAY | | | unformatted is | Applet2 is | TEXT is fetched | | | sent to the SIM | triggered | | | | | | TERMINAL RESPONSE | | | Applet1 builds a | 5- No exception is | | | | proactive command | thrown | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+
##### 6.3.1.2.4 Test Coverage {#test-coverage-125 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25 CRRC1 Not testable
#### 6.3.1.3 EnvelopeHandler
Test Area Reference: FWK_MHA_ENHD
##### 6.3.1.3.1 Conformance Requirement {#conformance-requirement-114 .H6}
##### 6.3.1.3.1.1 Normal Execution {#normal-execution-129 .H6}
  * CRRN1: The EnvelopeHandler and its content are available for all > toolkit applets triggered from the invocation to the termination > of their processToolkit method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_FORMATTED_SMS_CB
EVENT_UNFORMATTED_SMS_CB
EVENT_MENU_SELECTION
EVENT_MENU_SELECTION_HELP_REQUEST
EVENT_TIMER_EXPIRATION
EVENT_EVENT_DOWNLOAD_MT_CALL
EVENT_EVENT_DOWNLOAD_CALL_CONNECTED
EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED
EVENT_EVENT_DOWNLOAD_LOCATION_STATUS
EVENT_EVENT_DOWNLOAD_USER_ACTIVITY
EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE
EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS
EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION
EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION
EVENT_UNRECOGNIZED_ENVELOPE
EVENT_CALL_CONTROL
EVENT_SMS_MO_CONTROL
EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE
EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS
##### 6.3.1.3.1.2 Parameters error {#parameters-error-47 .H6}
No requirements.
##### 6.3.1.3.1.3 Context Errors {#context-errors-124 .H6}
  * CRRC1: The EnvelopeHandler and its content are not available for any > toolkit applet triggered from the invocation to the termination of > their processToolkit method for the following events:
EVENT_STATUS_COMMAND
EVENT_PROFILE_DOWNLOAD
EVENT_FIRST_COMMAND_AFTER_SELECT
##### 6.3.1.3.2 Test Suite Files {#test-suite-files-129 .H6}
> Test Script: FWK_MHA_ENHD_1.scr
>
> Test Applet: FWK_MHA_ENHD_1.java
>
> FWK_MHA_ENHD_2.java
>
> Load Script: FWK_MHA_ENHD_1.ldr
>
> Cleanup Script: FWK_MHA_ENHD_1.clr
>
> Parameter File: FWK_MHA_ENHD_1.par
##### 6.3.1.3.3 Test Procedure {#test-procedure-129 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet1 and | 1- No exception is | | | | Applet2 | thrown | | | | registration and | | | | | Envelope Handler | 2- Applet1 is | | | | availability with | triggered by | | | | EVENT_FIRST_COMM | EVENT_FIRST_COMM | | | | AND_AFTER_SELECT | AND_AFTER_SELECT | | | | | | | | | 1.Applet1 is | 3- A Toolkit | | | | registered to all | exception | | | | events defined TS | HANDL | | | | 43.019 [7]. | ER_NOT_AVAILABLE | | | | | is thrown | | | | The registration | | | | | is done using the | Applet1 finalizes | | | | methods | | | | | initMenuEntry() | Applet2 is | | | | for | triggered | | | | EVENT | | | | | _MENU_SELECTION, | 4- A Toolkit | | | | req | exception | | | | uestPollInterval() | HANDL | | | | for | ER_NOT_AVAILABLE | | | | EVENT | is thrown | | | | _STATUS_COMMAND, | | | | | allocateTimer() | | | | | for | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | Applet2 is | | | | | registered to all | | | | | events defined TS | | | | | 43.019 [7] | | | | | except | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD, | | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | and | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | The registration | | | | | is done using the | | | | | methods | | | | | initMenuEntry() | | | | | for | | | | | EVENT | | | | | _MENU_SELECTION, | | | | | req | | | | | uestPollInterval() | | | | | for | | | | | EVENT | | | | | _STATUS_COMMAND, | | | | | allocateTimer for | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList | | | | | for the rest of | | | | | the events. | | | | | | | | | | 2- Select MF. | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | Applet1 is | | | | | deregistered from | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | | | | | | | | 4-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | | | | | | | | Applet2 is | | | | | deregistered to | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | +----+--------------------+--------------------+--------------------+ | 2 | Handler | 1- Applet1 is | | | | availability with | triggered by | | | | EVENT\ | EVENT\ | | | | _PROFILE_DOWNLOAD | _PROFILE_DOWNLOAD | | | | | | | | | 1- Terminal | 2- A Toolkit | | | | Profile command is | exception | | | | sent to the SIM | HANDL | | | | without the | ER_NOT_AVAILABLE | | | | facility of | is thrown | | | | SET_EVENT_LIST, | | | | | SETUP\ | Applet1 finalizes | | | | _IDLE_MODE_TEXT, | | | | | POLL_INTERVAL and | Applet2 is | | | | SETUP MENU | triggered by | | | | | EVENT\ | | | | 2- | _PROFILE_DOWNLOAD | | | | EnvelopeHandl | | | | | er.getTheHandler() | 3- A Toolkit | | | | method is called | exception | | | | by Applet1 | HANDL | | | | | ER_NOT_AVAILABLE | | | | Applet1 is | is thrown | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | | | | | | | | Applet2 is | | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | +----+--------------------+--------------------+--------------------+ | 3 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | E | | | | | VENT_MENU_SELECT | 2- No exception is | | | | ION_HELP_REQUEST | thrown. | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | Envelope menu | | | | | selection with | | | | | help request is | | | | | sent to the SIM | | | | | | | | | | 1-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 4 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_MENU_SELECTION | 2- No exception is | | | | | thrown. | | | | 1-Envelope menu | | | | | selection is sent | | | | | to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 5 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1-A | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | envelope is sent | | | | | to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 6 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1-An unformatted | | | | | sms pp envelope is | Applet1 finalizes | | | | sent to the SIM | | | | | | 3- Applet2 is | | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 4- No exception is | | | | by Applet1 | thrown. | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 7 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EV | | | | | ENT_FORMATTED_CB | 2-No exception is | | | | | thrown | | | | 1-Envelope cell | | | | | broadcast | | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 8 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_UNFORMATTED_CB | 2- No exception is | | | | | thrown | | | | 1-Envelope cell | | | | | broadcast | Applet1 finalizes | | | | unformatted is | | | | | sent to the SIM | 3- Applet2 is | | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 4- No exception is | | | | method is called | thrown | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 9 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT\ | | | | | _TIMER_EXPIRATION | 2- No exception is | | | | | thrown. | | | | Timer id=1 | | | | | | | | | | 1-Envelope Timer | | | | | Expiration is sent | | | | | to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 10 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | 2- No exception is | | | | | thrown. | | | | 1-Envelope call | | | | | control by sim is | | | | | sent to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 11 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | 2- No exception is | | | | _CONTROL_BY_SIM | throw | | | | | | | | | 1-Envelope mo | | | | | short message | | | | | control by sim is | | | | | sent to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1. | | | +----+--------------------+--------------------+--------------------+ | 12 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | 2- No exception is | | | | | thrown. | | | | 1-Envelope event | | | | | download mt call | Applet1 finalizes | | | | is sent to the SIM | | | | | | 3- Applet2 is | | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 4- No exception is | | | | by Applet1 | thrown. | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 13 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVE | | | | | NT_EVENT_DOWNLOA | 2- No exception is | | | | D_CALL_CONNECTED | thrown. | | | | | | | | | 1-Envelope event | Applet1 finalizes | | | | download call | | | | | connected is sent | 3- Applet2 is | | | | to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 14 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered. | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | 2- No exception is | | | | CALL_DISCONECTTED | thrown. | | | | | | | | | 1-Envelope event | Applet1 finalizes | | | | download call | | | | | disconnected is | 3- Applet2 is | | | | sent to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 15 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_EVENT_DOWNLOAD | 2- No exception is | | | | _LOCATION_STATUS | thrown. | | | | | | | | | 1-Envelope event | Applet1 finalizes | | | | download location | | | | | status is sent to | 3- Applet2 is | | | | the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 16 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EV | | | | | ENT_EVENT_DOWNLO | 2- No exception is | | | | AD_USER_ACTIVITY | thrown | | | | | | | | | 1-Envelope event | Applet1 finalizes | | | | download user | | | | | activity is sent | 3- Applet2 is | | | | to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 17 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_EVEN | | | | | T_DOWNLOAD_IDLE\ | 2- No exception is | | | | _SCREEN_AVAILABLE | thrown. | | | | | | | | | 1-Envelope event | Applet1 finalizes | | | | download idle | | | | | screen available | 3- Applet2 is | | | | is sent to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 18 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_E | | | | | VENT_DOWNLOAD_CA | 2- No exception is | | | | RD_READER_STATUS | thrown. | | | | | | | | | 1-Envelope event | Applet1 finalizes | | | | download card | | | | | reader status is | 3- Applet2 is | | | | sent to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 19 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_EVENT_DO | | | | | WNLOAD_LANGUAGE_ | 2-No exception is | | | | | thrown. | | | | SELECTION | | | | | | Applet1 finalizes. | | | | 1-Envelope event | | | | | download language | Applet2 is | | | | selection is sent | triggered | | | | to the SIM | | | | | | 3-No exception is | | | | 2-EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | Applet1 finalizes. | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 20 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_EVENT_D | | | | | OWNLOAD_BROWSER_ | 2-No exception is | | | | | thrown. | | | | TERMINATION | | | | | | Applet1 finalizes. | | | | 1-Envelope event | | | | | download browser | Applet2 is | | | | termination is | triggered | | | | sent to the SIM | | | | | | 3-No exception is | | | | 2-EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 21 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_STATUS_COMMAND | 2- A Toolkit | | | | | exception | | | | 1-Status command | HANDL | | | | is sent to the SIM | ER_NOT_AVAILABLE | | | | | is thrown | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | Applet1 finalizes. | | | | method is called | | | | | by Applet1 | 3- Applet2 is | | | | | triggered | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | 4- A Toolkit | | | | method is called | exception | | | | by Applet2 | HANDL | | | | | ER_NOT_AVAILABLE | | | | | is thrown | | +----+--------------------+--------------------+--------------------+ | 22 | Envelope Handler | 1- Applet1 is | 1- OPEN CHANNEL | | | availability with | registered to | proactive command | | | EVE | EVE | is fetched | | | NT_EVENT_DOWNLOA | NT_EVENT_DOWNLOA | | | | D_DATA_AVAILABLE | D_DATA_AVAILABLE | TERMINAL RESPONSE | | | | and | is issued with | | | 1- Applet1 builds | EVE | Channel Id = 01 | | | a proactive | NT_EVENT_DOWNLOA | | | | command OPEN | D_CHANNEL_STATUS | | | | CHANNEL. | | | | | | 2- Applet1 is | | | | proac | triggered | | | | tiveHandler.send() | | | | | method is called | 3-No exception is | | | | | thrown. | | | | 2-Envelope event | | | | | download data | | | | | available is sent | | | | | to the SIM with | | | | | ChannelId=01. | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 23 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVE | | | | | NT_EVENT_DOWNLOA | 2-No exception is | | | | D_CHANNEL_STATUS | thrown. | | | | | | | | | 1-Envelope event | | | | | download channel | | | | | status is sent to | | | | | the SIM with | | | | | ChannelId=01. | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 24 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | UNRE | 2- No exception is | | | | COGNIZED_ENVELOPE | thrown. | | | | | | | | | 1-An unrecognized | Applet1 finalizes | | | | Envelope is sent | | | | | to the SIM | Applet2 is | | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 3- No exception is | | | | method is called | thrown. | | | | by Applet1 | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 25 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- A formatted | | | | | Update Record | | | | | EFsms instruction | | | | | is sent to the SIM | | | | | | | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 26 | Envelope Handler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1-An unformatted | | | | | Update Record | Applet1 finalizes | | | | EFsms instruction | | | | | is sent to the SIM | Applet2 is | | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 3- No exception is | | | | method is called | thrown. | | | | by Applet1 | | | | | | | | | | **3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2** | | | +----+--------------------+--------------------+--------------------+
##### 6.3.1.3.4 Test Coverage {#test-coverage-126 .H6}
CRR Number Test Case Number
* * *
CRRN1 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 22, 23,
24, 25, 26 CRRC1 1, 2, 21
#### 6.3.1.4 EnvelopeResponseHandler
Test Area Reference: FWK_MHA_ERHD
##### 6.3.1.4.1 Conformance Requirement {#conformance-requirement-115 .H6}
##### 6.3.1.4.1.1 Normal Execution {#normal-execution-130 .H6}
  * CRRN1: The handler is available for all triggered toolkit applets > from the invocation of the processToolkit method of the toolkit > applet until a toolkit applet has posted an envelope response or > the first invocation of the ProactiveHandler.send method for the > following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_CALL_CONTROL
EVENT_SMS_MO_CONTROL
EVENT_UNRECOGNIZED_ENVELOPE
  * CRRN2: After a call to the post method the handler is not longer > available.
  * CRRN3: After a call to the send method the handler is not longer > available.
##### 6.3.1.4.1.2 Parameters error {#parameters-error-48 .H6}
No requirements.
##### 6.3.1.4.1.3 Context Errors {#context-errors-125 .H6}
  * CRRC1: The handler is not available for the following events:
EVENT_FORMATTED_SMS_CB
EVENT_UNFORMATTED_SMS_CB
EVENT_MENU_SELECTION
EVENT_MENU_SELECTION_HELP_REQUEST
EVENT_TIMER_EXPIRATION
EVENT_EVENT_DOWNLOAD_MT_CALL
EVENT_EVENT_DOWNLOAD_CALL_CONNECTED
EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED
EVENT_EVENT_DOWNLOAD_LOCATION_STATUS
EVENT_EVENT_DOWNLOAD_USER_ACTIVITY
EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE
EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS
EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION
EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION
EVENT_STATUS_COMMAND
EVENT_PROFILE_DOWNLOAD
EVENT_FIRST_COMMAND_AFTER_SELECT
EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE
EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
##### 6.3.1.4.2 Test Suite Files {#test-suite-files-130 .H6}
> Test Script: FWK_MHA_ERHD_1.scr
>
> Test Applet: FWK_MHA_ERHD_1.java
>
> FWK_MHA_ERHD_2.java
>
> Load Script: FWK_MHA_ERHD_1.ldr
>
> Cleanup Script: FWK_MHA_ERHD_1.clr
>
> Parameter File: FWK_MHA_ERHD_1.par
##### 6.3.1.4.3 Test Procedure {#test-procedure-130 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Toolkit Applet1 | 1- No exception is | | | | and Toolkit | thrown | | | | Applet2 | | | | | registration and | 2- Applet1 is | | | | Envelope Response | triggered by | | | | Handler | EVENT_FIRST_COMM | | | | availability with | AND_AFTER_SELECT | | | | EVENT_FIRST_COMM | | | | | AND_AFTER_SELECT | 3- A Toolkit | | | | | exception | | | | 1- Applet1 is | HANDL | | | | registered to all | ER_NOT_AVAILABLE | | | | events defined in | is thrown | | | | TS 43.019 [7]. | | | | | | | | | | Using the methods | | | | | initMenuEntry() | | | | | for | | | | | EVENT | | | | | _MENU_SELECTION, | | | | | req | | | | | uestPollInterval() | | | | | for | | | | | EVENT | | | | | _STATUS_COMMAND, | | | | | allocateTimer() | | | | | for | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | Applet2 is | | | | | registered to | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_UNREC | | | | | OGNIZED_ENVELOPE. | | | | | | | | | | 3. Select MF. | | | | | | | | | | 3-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | Applet1 is | | | | | deregistered to | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | +----+--------------------+--------------------+--------------------+ | 2 | Handler | 1- Applet1 Is | | | | availability with | Triggered By | | | | EVENT\ | EVENT\ | | | | _PROFILE_DOWNLOAD | _PROFILE_DOWNLOAD | | | | | | | | | 1- Terminal | 2- A Toolkit | | | | Profile command is | exception | | | | sent to the SIM | HANDL | | | | without the | ER_NOT_AVAILABLE | | | | facility of | is thrown | | | | SET_EVENT_LIST, | | | | | SETUP\ | | | | | _IDLE_MODE_TEXT, | | | | | SETUP_MENU and | | | | | POLL_INTERVAL. | | | | | | | | | | 2- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | Applet1 is | | | | | deregistered to | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | +----+--------------------+--------------------+--------------------+ | 3 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | E | 2- A Toolkit | | | | VENT_MENU_SELECT | exception | | | | ION_HELP_REQUEST | HANDL | | | | | ER_NOT_AVAILABLE | | | | Perform SIM | is thrown | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-Envelope menu | | | | | selection with | | | | | help request is | | | | | sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 4 | Envelope Response | 1- Applet1 is | | | | Handler | triggered | | | | availability with | | | | | EVEN | 2- A Toolkit | | | | T_MENU_SELECTION | exception | | | | | HANDL | | | | 1-A envelope menu | ER_NOT_AVAILABLE | | | | selection is sent | is thrown | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 5 | Envelope Response | 1- The applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EV | 2-A Toolkit | | | | ENT_FORMATTED_CB | exception | | | | | HANDL | | | | 1-Envelope cell | ER_NOT_AVAILABLE | | | | broadcast | is thrown | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 6 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVEN | 2- A Toolkit | | | | T_UNFORMATTED_CB | exception | | | | | HANDL | | | | 1-Envelope cell | ER_NOT_AVAILABLE | | | | broadcast | is thrown | | | | unformatted is | | | | | sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 7 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVENT\ | 2- A Toolkit | | | | _TIMER_EXPIRATION | exception | | | | | HANDL | | | | 1-Envelope Timer | ER_NOT_AVAILABLE | | | | Expiration is sent | is thrown | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 8 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVENT_EVENT_ | 2 -A Toolkit | | | | DOWNLOAD_MT_CALL | exception | | | | | HANDL | | | | 1-Envelope event | ER_NOT_AVAILABLE | | | | download mt call | is thrown | | | | is sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 9 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVE | 2- A Toolkit | | | | NT_EVENT_DOWNLOA | exception | | | | D_CALL_CONNECTED | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1-Envelope event | is thrown | | | | download call | | | | | connected is sent | | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 10 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVENT\ | 2- A Toolkit | | | | _EVENT_DOWNLOAD_ | exception | | | | CALL_DISCONNECTED | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1-Envelope event | is thrown | | | | download call | | | | | disconnected is | | | | | sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 11 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVEN | 2- A Toolkit | | | | T_EVENT_DOWNLOAD | exception | | | | _LOCATION_STATUS | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1-Envelope event | is thrown | | | | download location | | | | | status is sent to | | | | | the SIM | | | | | | | | | | 2-Applet1 obtains | | | | | the Envelope | | | | | Response Handler | | | +----+--------------------+--------------------+--------------------+ | 12 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EV | 2- A Toolkit | | | | ENT_EVENT_DOWNLO | exception | | | | AD_USER_ACTIVITY | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1-Envelope event | is thrown | | | | download user | | | | | activity is sent | | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 13 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVENT_EVEN | 2- A Toolkit | | | | T_DOWNLOAD_IDLE\ | exception | | | | _SCREEN_AVAILABLE | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1-Envelope event | is thrown | | | | download idle | | | | | screen available | | | | | is sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 14 | Envelope Response | 1- Applet1 is | | | | Handler | triggered | | | | availability with | | | | | EVENT_E | 2- A Toolkit | | | | VENT_DOWNLOAD_CA | exception | | | | RD_READER_STATUS | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1-Envelope event | is thrown | | | | download card | | | | | reader status is | | | | | sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 15 | Envelope Response | 1- Applet1 is | | | | Handler | triggered | | | | availability with | | | | | EVENT_EVENT_DO | 2-A Toolkit | | | | WNLOAD_LANGUAGE_ | exception | | | | | HANDL | | | | SELECTION | ER_NOT_AVAILABLE | | | | | is thrown | | | | 1-Envelope event | | | | | download language | | | | | selection is sent | | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 16 | Envelope Response | 1- Applet1 is | | | | Handler | triggered | | | | availability with | | | | | EVENT_EVENT_D | 2-A Toolkit | | | | OWNLOAD_BROWSER_ | exception | | | | | HANDL | | | | TERMINATION | ER_NOT_AVAILABLE | | | | | is thrown | | | | 1-Envelope event | | | | | download browser | | | | | termination is | | | | | sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 17 | Envelope Response | 1- Applet1 is | | | | Handler | triggered | | | | availability with | | | | | EVEN | 2- A Toolkit | | | | T_STATUS_COMMAND | exception | | | | | HANDL | | | | 1-Status command | ER_NOT_AVAILABLE | | | | is sent to the SIM | is thrown | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 18 | Envelope Response | 2- Applet1 is | 1. The OPEN | | | Handler | triggered | CHANNEL | | | availability with | | command is | | | EVE | 3- A Toolkit | fetched. | | | NT_EVENT_DOWNLOA | exception | | | | D_DATA_AVAILABLE | HANDL | TERMINAL RESPONSE | | | | ER_NOT_AVAILABLE | IS SENT TO THE SIM | | | 1- Applet1 | is thrown | with channelId=01 | | | initialises a | | | | | proactive command | | | | | OPEN CHANNEL and | | | | | calls the send() | | | | | method. | | | | | | | | | | 2- Envelope event | | | | | download data | | | | | avalaible is sent | | | | | to the SIM with | | | | | channelId=01 | | | | | | | | | | 3-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 19 | Envelope Response | 1- Applet1 is | | | | Handler | triggered | | | | availability with | | | | | EVE | 2- A Toolkit | | | | NT_EVENT_DOWNLOA | exception | | | | D_CHANNEL_STATUS | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1- Envelope event | is thrown | | | | download channel | | | | | status is sent to | | | | | the SIM with | | | | | channelId=01 | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 20 | Envelope Response | 1- The applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVENT_FORMA | 2-A Toolkit | | | | TTED_SMS_PP_UPD | exception | | | | | HANDL | | | | 1- Update Record | ER_NOT_AVAILABLE | | | | EFsms instruction | is thrown | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 21 | Envelope Response | 1- Applet1 is | | | | Handler | triggered. | | | | availability with | | | | | EVENT_UNFORMA | 2- A Toolkit | | | | TTED_SMS_PP_UPD | exception | | | | | HANDL | | | | 1- Update Record | ER_NOT_AVAILABLE | | | | EFsms instruction | is thrown | | | | unformatted is | | | | | sent to the SIM | | | | | | | | | | 2-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 22 | Envelope Response | 1- Applet1 is | 3- The response | | | Handler | triggered | packet is sent | | | availability with | | | | | EVENT_FORMA | 2- No exception is | 7- The proactive | | | TTED_SMS_PP_ENV | thrown. | command is sent | | | | | | | | 1-A formatted sms | 4- A Toolkit | | | | pp envelope is | exception | | | | sent to the SIM | HANDL | | | | | ER_NOT_AVAILABLE | | | | 2-Env | is thrown for each | | | | elopeResponseHandl | method | | | | er.getTheHandler() | | | | | method is called | Applet1 finalizes | | | | by Applet1 | | | | | | 5- Applet1 is | | | | 3-Applet1 builds | triggered | | | | an additional | | | | | information for | 6- No Exception is | | | | response packet | thrown | | | | and it calls the | | | | | post method | 8- Toolkit | | | | | exception | | | | 4-Applet1 calls | HANDL | | | | all methods of the | ER_NOT_AVAILABLE | | | | Envelope Response | is thrown for each | | | | Handler (including | method | | | | the inherited | | | | | method) | | | | | | | | | | 5-A | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | envelope is sent | | | | | to the SIM | | | | | | | | | | 6-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 7-Applet1 builds a | | | | | proactive command | | | | | and it calls the | | | | | send() method | | | | | | | | | | 8-Applet1 calls | | | | | all methods of the | | | | | Envelope Response | | | | | Handler (including | | | | | the inherited | | | | | method) | | | +----+--------------------+--------------------+--------------------+ | 23 | Envelope Response | 1- Applet1 is | 3- The envelope | | | Handler | triggered | response is sent | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | 9- The proactive | | | TTED_SMS_PP_ENV | thrown. | command is fetched | | | | | and the Terminal | | | 1-An unformatted | 4- A Toolkit | response is | | | sms pp envelope is | exception | issued. | | | sent to the SIM | HANDL | | | | | ER_NOT_AVAILABLE | | | | 2-Env | is thrown for each | | | | elopeResponseHandl | method | | | | er.getTheHandler() | | | | | method is called | Applet1 finalizes | | | | by Applet1 | | | | | | 5- Applet2 is | | | | 3-Applet1 builds | triggered. | | | | the envelope | | | | | response and it | A Toolkit | | | | calls the post() | exception | | | | method | HANDL | | | | | ER_NOT_AVAILABLE | | | | 4- Applet1 calls | is thrown. | | | | all methods of the | | | | | Envelope Response | Applet2 finalizes | | | | Handler (including | | | | | the inherited | 6- Applet1 is | | | | method) | triggered. | | | | | | | | | 5-Env | 7- No exception is | | | | elopeResponseHandl | thrown. | | | | er.getTheHandler() | | | | | method is called | 9- A Toolkit | | | | | exception | | | | 6-An unformatted | HANDL | | | | sms pp envelope is | ER_NOT_AVAILABLE | | | | sent to the SIM | is thrown for each | | | | | method. | | | | 7-Env | | | | | elopeResponseHandl | Applet1 finalizes | | | | er.getTheHandler() | | | | | method is called. | 10- Applet2 is | | | | | triggered. | | | | 8-Applet1 builds a | | | | | proactive command | A Toolkit | | | | and it calls the | exception | | | | send() method | HANDL | | | | | ER_NOT_AVAILABLE | | | | 9-Applet1 calls | is thrown. | | | | all methods of the | | | | | Envelope Response | | | | | Handler (including | | | | | the inherited | | | | | method) | | | | | | | | | | 10-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 24 | Envelope Response | 1- Applet1 is | 3- The envelope | | | Handler | triggered | response is sent | | | availability with | | | | | EVENT_CALL | 2- No exception is | 7- The proactive | | | _CONTROL_BY_SIM | thrown. | command is fetched | | | | | and the Terminal | | | 1-Envelope call | 4- Toolkit | response is issued | | | control by sim is | exception | | | | sent to the SIM | HANDL | | | | | ER_NOT_AVAILABLE | | | | 2-Env | is thrown for each | | | | elopeResponseHandl | method | | | | er.getTheHandler() | | | | | method is called | Applet1 finalizes | | | | by Applet1 | | | | | | 5- Applet1 is | | | | 3-Applet1 builds | triggered | | | | the envelope | | | | | response and it | 6- No Exception is | | | | calls the | thrown | | | | postAsBERTLV() | | | | | method | 8- A Toolkit | | | | | exception | | | | 4-Applet1 calls | HANDL | | | | all methods of the | ER_NOT_AVAILABLE | | | | Envelope Response | is thrown for each | | | | Handler (including | method | | | | the inherited | | | | | method) | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to the SIM | | | | | | | | | | 6-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 7-Applet1 builds a | | | | | proactive command | | | | | and it calls the | | | | | send() method | | | | | | | | | | 8-Applet1 calls | | | | | all methods of the | | | | | Envelope Response | | | | | Handler (including | | | | | the inherited | | | | | method) | | | +----+--------------------+--------------------+--------------------+ | 25 | Envelope Response | 1- Applet1 is | 3-The envelope | | | Handler | triggered | response is sent | | | availability with | | | | | EVENT_ | 2- No exception is | 7- The proactive | | | MO_SHORT_MESSAGE | thrown. | command is fetched | | | _CONTROL_BY_SIM | | and the Terminal | | | | 4- A Toolkit | Response is issued | | | 1-Envelope mo | exception | | | | short message | HANDL | | | | control by sim is | ER_NOT_AVAILABLE | | | | sent to the SIM | is thrown for each | | | | | method | | | | 2-Env | | | | | elopeResponseHandl | Applet1 finalizes | | | | er.getTheHandler() | | | | | method is called | 5- Applet1 is | | | | by Applet1 | triggered | | | | | | | | | 3-Applet1 builds | 6- No exception is | | | | the envelope | thrown | | | | response and it | | | | | calls the | 8- A Toolkit | | | | postAsBERTLV() | exception | | | | method | HANDL | | | | | ER_NOT_AVAILABLE | | | | 4-Applet1 calls | is thrown for each | | | | all methods of the | method | | | | Envelope Response | | | | | Handler (including | | | | | the inherited | | | | | method) | | | | | | | | | | 5-Envelope mo | | | | | short message | | | | | control by sim is | | | | | sent to the SIM | | | | | | | | | | 6-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 7-Applet1 builds a | | | | | proactive command | | | | | and it calls the | | | | | send method | | | | | | | | | | 8-Applet1 calls | | | | | all methods of the | | | | | Envelope Response | | | | | Handler (including | | | | | the inherited | | | | | method) | | | +----+--------------------+--------------------+--------------------+ | 26 | Envelope Response | 1- Applet1 is | 3- The envelope | | | Handler | triggered | response is sent | | | availability with | | | | | EVENT_UNRE | 2- No exception is | 9- The proactive | | | COGNIZED_ENVELOPE | thrown. | command is fetched | | | | | and the Terminal | | | 1-An unrecognized | 4- A Toolkit | response is issued | | | Envelope is sent | exception | | | | to the SIM | HANDL | | | | | ER_NOT_AVAILABLE | | | | 2-Env | is thrown for each | | | | elopeResponseHandl | method | | | | er.getTheHandler() | | | | | method is called | Applet1 finalizes | | | | by Applet1 | | | | | | 5- Applet2 is | | | | 3-Applet1 builds | triggered. | | | | the envelope | | | | | response and it | A Toolkit | | | | calls the | exception | | | | postAsBERTLV() or | HANDL | | | | post method | ER_NOT_AVAILABLE | | | | | is thrown. | | | | 4-Applet1 calls | | | | | all methods of | Applet2 finalizes | | | | Envelope Response | | | | | Handler (including | 6- Applet1 is | | | | the inherited | triggered. | | | | method) | | | | | | 7- No exception is | | | | 5-Env | thrown. | | | | elopeResponseHandl | | | | | er.getTheHandler() | 9- A Toolkit | | | | method is called | exception | | | | | HANDL | | | | 6-An unrecognized | ER_NOT_AVAILABLE | | | | Envelope is sent | is thrown for each | | | | to the SIM | method | | | | | | | | | 7-Env | Applet1 finalizes | | | | elopeResponseHandl | | | | | er.getTheHandler() | 10- Applet2 is | | | | method is called | triggered | | | | | | | | | 8-Applet1 builds a | A Toolkit | | | | proactive command | exception | | | | and it calls the | HANDL | | | | send() method | ER_NOT_AVAILABLE | | | | | is thrown. | | | | 9-Applet1 calls | | | | | all methods of the | | | | | Envelope Response | | | | | Handler (including | | | | | the inherited | | | | | method) | | | | | | | | | | 10-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 27 | The envelope | 1- Applet1 is | 2- 91 XX | | | response is sent | triggered. | | | | when a proactive | | 5-The envelope | | | session is ongoing | 3- Applet1 is | response is sent | | | | triggered | | | | 1-A formatted SMS | | 9F YY | | | PP envelope is | 4- No exception is | | | | sent to the SIM. | thrown | GET RESPONSE | | | | | | | | 2-Proactive | | Data | | | command DISPLAY | | | | | TEXT is built and | | 91 XX | | | it calls the | | | | | send() method. | | Fetch DISPLAY TEXT | | | | | | | | 3-A call control | | Terminal Response | | | by sim envelope is | | DISPLAY TEXT | | | sent to the SIM. | | | | | | | | | | 4-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 5-Applet1 builds | | | | | the envelope | | | | | response and it | | | | | calls the | | | | | postAsBERTLV | | | +----+--------------------+--------------------+--------------------+ | 28 | Envelope Response | 1- Applet1 is | 6. The response | | | Handler | triggered | is checked. | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | | | | TTED_SMS_PP_ENV | thrown. | | | | in case of | | | | | multi-triggering | 3- Applet1 | | | | | finalizes | | | | 1-A unformatted | | | | | sms pp envelope is | 4- Applet2 is | | | | sent to the SIM | triggered. | | | | | | | | | 2-Env | 5- No Exception is | | | | elopeResponseHandl | thrown | | | | er.getTheHandler() | | | | | method is called | Applet2 finalizes | | | | by Applet1 | | | | | | | | | | 5-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet 2 | | | | | | | | | | 6- Applet2 calls | | | | | the post( ) method | | | +----+--------------------+--------------------+--------------------+ | 29 | Envelope Response | 1- Applet1 is | 6- The response is | | | Handler | triggered | checked | | | availability with | | | | | EVENT_UNRE | 2- No exception is | | | | COGNIZED_ENVELOPE | thrown. | | | | in case of | | | | | multi-triggering | 3- Applet1 | | | | | finalizes | | | | 1-An unrecognized | | | | | Envelope is sent | 4- Applet2 is | | | | to the SIM | triggered. | | | | | | | | | 2-Env | 5- No Exception is | | | | elopeResponseHandl | thrown | | | | er.getTheHandler() | | | | | method is called | Applet2 finalizes | | | | by Applet1 | | | | | | | | | | 5-Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet 2 | | | | | | | | | | 6- Applet2 calls | | | | | the post( ) method | | | +----+--------------------+--------------------+--------------------+
##### 6.3.1.4.4 Test Coverage {#test-coverage-127 .H6}
CRR Number Test Case Number
* * *
CRRN1 20, 21, 22, 23, 24, 25,26,27 CRRN2 20, 21, 22, 23, 24, 25 CRRN3 20, 21,
22, 23, 24, 25 CRRC1 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,
17, 18, 19, 28, 29
### 6.3.2 Handler Integrity
#### 6.3.2.1 ProactiveHandler
Test Area Reference: FWK_HIN_PAHD
##### 6.3.2.1.1 Conformance Requirement {#conformance-requirement-116 .H6}
##### 6.3.2.1.1.1 Normal Execution {#normal-execution-131 .H6}
  * CRRN1: At the processToolkit invocation the TLV-List is cleared.
  * CRRN2: After a call to ProactiveHandler.send method the handler will > remain unchanged until the ProactiveHandler.init or appendTLV > method are called.
##### 6.3.2.1.1.2 Parameters error {#parameters-error-49 .H6}
No requirements.
##### 6.3.2.1.1.3 Context Errors {#context-errors-126 .H6}
No requirements.
##### 6.3.2.1.2 Test Suite Files: {#test-suite-files-131 .H6}
> Test Script: FWK_HIN_PAHD_1.scr
>
> Test Applet: FWK_HIN_PAHD_1.java
>
> FWK_HIN_PAHD_2.java
>
> Load Script: FWK_HIN_PAHD_1.ldr
>
> Cleanup Script: FWK_HIN_PAHD_1.clr
>
> Parameter File: FWK_HIN_PAHD_1.par
##### 6.3.2.1.3 Test Procedure {#test-procedure-131 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | At the | 1- Applet1 is | | | | processToolkit | triggered. | | | | invocation the | | | | | TLV-List is | 2- The return | | | | cleared | value is 0 | | | | | | | | | Applet1 and | | | | | Applet2 are | | | | | registered to | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-An envelope | | | | | containing an | | | | | unformatted sms pp | | | | | is sent to the SIM | | | | | | | | | | 2-ProactiveH | | | | | andler.getLength() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 2 | TLV-List change | 1- The return | | | | after the init | value is 9 | | | | method invocation | | | | | | | | | | Proac | | | | | tiveHandler.init() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 1-ProactiveH | | | | | andler.getLength() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 3 | The TLV-List | 2- The return | 1- The proactive | | | remains unchanged | value is 9, and | command is fetched | | | after the send() | its contents is | and the terminal | | | method invocation | the same than | response is | | | | before the calling | issued. | | | 1-Proac | to send method | | | | tiveHandler.send() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 2-ProactiveH | | | | | andler.getLength() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | It\'s checked that | | | | | the content is the | | | | | same than before | | | | | the calling to | | | | | send method using | | | | | Proactiv | | | | | eHandler.copyValue | | | | | and | | | | | Util.arrayCompare | | | | | methods | | | +----+--------------------+--------------------+--------------------+ | 4 | At the | 1- Applet2 is | | | | processToolkit | triggered | | | | invocation the | | | | | TLV-List is | 2- The return | | | | cleared | value is 0 | | | | | | | | | 1-ProactiveH | 3- | | | | andler.getLength() | ToolkitException | | | | method is called | UN | | | | by Applet2 | AVAILABLE_ELEMENT | | | | | is thrown | | | | 2-ProactiveHandle | | | | | r.getValueLength() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+
##### 6.3.2.1.4 Test Coverage {#test-coverage-128 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3, 4 CRRN2 3
#### 6.3.2.2 ProactiveResponseHandler
Test Area Reference: FWK_HIN_PRHD
##### 6.3.2.2.1 Conformance Requirement {#conformance-requirement-117 .H6}
##### 6.3.2.2.1.1 Normal Execution {#normal-execution-132 .H6}
  * CRRN1: The ProactiveResponseHandler content is changed after the > call to ProactiveHandler.send method and remains unchanged until > next call to the ProactiveHandler.send method.
  * CRRN2: The ProactiveResponseHandler may not be available before the > first call to ProactiveHandler.send method, if available the > content is cleared.
##### 6.3.2.2.1.2 Parameters error {#parameters-error-50 .H6}
No requirements.
##### 6.3.2.2.1.3 Context Errors {#context-errors-127 .H6}
No requirements.
##### 6.3.2.2.2 Test Suite Files {#test-suite-files-132 .H6}
> Test Script: FWK_HIN_PRHD_1.scr
>
> Test Applet: FWK_HIN_PRHD_1.java
>
> Load Script: FWK_HIN_PRHD_1.ldr
>
> Cleanup Script: FWK_HIN_PRHD_1.clr
>
> Parameter File: FWK_HIN_PRHD_1.par
##### 6.3.2.2.3 Test Procedure {#test-procedure-132 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet | 1- No exception is | | | | registration and | thrown | | | | Proact | | | | | iveResponseHandler | 2- Applet is | | | | obtaining | triggered. | | | | | | | | | 1-Applet is | 3- Behaviour 1: | | | | registered to all | | | | | events defined in | Toolkit Exception | | | | [7]. | HANDL | | | | | ER_NOT_AVAILABLE | | | | Using the methods | is thrown. | | | | initMenuEntry for | | | | | EVENT | Behaviour 2: | | | | _MENU_SELECTION, | | | | | req | No exception is | | | | uestPollInterval() | thrown, the return | | | | for | value is 0 | | | | EVENT | | | | | _STATUS_COMMAND, | | | | | allocateTimer() | | | | | for | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | Terminal Profile | | | | | command is sent to | | | | | the SIM without | | | | | the facilities of | | | | | SET_EVENT_LIST | | | | | ,SETUP\ | | | | | _IDLE_MODE_TEXT, | | | | | SETUP_MENU and | | | | | POLL_INTERVAL. | | | | | | | | | | For each event: | | | | | | | | | | 2-Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | is called | | | | | | | | | | If handler is | | | | | available, | | | | | ProactiveResponseH | | | | | andler.getLength() | | | | | is called | | | +----+--------------------+--------------------+--------------------+ | 2 | The | 1- The | 2- A proactive | | | Proact | Proact | command is fetched | | | iveResponseHandler | iveResponseHandler | | | | remains unchanged | contains the | The terminal | | | after send method | terminal response | response is sent | | | invocation until | | with length 12 | | | next send method | 3- The return | | | | invocation | value is 12 | 6- A proactive | | | | | command is fetched | | | 1-Applet builds a | 4- No exception is | | | | proactive command | thrown and the | The terminal | | | Proac | Proactive Response | response is sent | | | tiveHandler.send() | Handler remains | with length 15 | | | method is called | unchanged | | | | | | | | | 2- | 5- The | | | | ProactiveResponseH | Proact | | | | andler.getLength() | iveResponseHandler | | | | method is called | contains the | | | | | terminal response | | | | 3-Proac | of the second | | | | tiveHandler.init() | proactive command | | | | method is called | | | | | | 7- The return | | | | 4-Proac | value is 15 | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | ProactiveResponseH | | | | | andler.getLength() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+
##### 6.3.2.2.4 Test Coverage {#test-coverage-129 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 1
#### 6.3.2.3 EnvelopeHandler
Test Area Reference: FWK_HIN_ENHD
##### 6.3.2.3.1 Conformance Requirement {#conformance-requirement-118 .H6}
##### 6.3.2.3.1.1 Normal Execution {#normal-execution-133 .H6}
  * CRRN1: The EnvelopeHandler and its content are available for all > triggered toolkit applets, from the invocation to the termination > of their processToolkit method
  * CRRN2: The SIM Toolkit Framework guarantees that all triggered > toolkit applets receive the data.
  * CRRN3: The SIM Toolkit Framework shall convert the Update Record > EFsms in the EnvelopeHandler TLV List containing Device Identities > TLV, Address TLV and SMS TPDU TLV.
  * CRRN4: The getEnvelopeTag() method shall return > _BTAG_SMS_PP_DOWNLOAD_.
  * CRRN5: The getLength() method shall return the Simple TLV list > length.
  * CRRN6 The Device Identity Simple TLV is used to store the > information about the absolute record number in the EFsms file and > the value of the EFsms record status byte.
##### 6.3.2.3.1.2 Parameters error {#parameters-error-51 .H6}
No requirements.
##### 6.3.2.3.1.3 Context Errors {#context-errors-128 .H6}
No requirements.
##### 6.3.2.3.2 Test Suite Files {#test-suite-files-133 .H6}
> Test Script: FWK_HIN_ENHD_1.scr
>
> Test Applet: FWK_HIN_ENHD_1.java
>
> Load Script: FWK_HIN_ENHD_1.ldr
>
> Cleanup Script: FWK_HIN_ENHD_1.clr
>
> Parameter File: FWK_HIN_ENHD_1.par
##### 6.3.2.3.3 Test Procedure {#test-procedure-133 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet | 1-No exception is | 5- 91 xx. | | | initialization and | thrown | | | | Envelope Handler | | A proactive | | | integrity checks | 2- Applet is | command Display | | | with | triggered | Text is fetched | | | E | | | | | VENT_MENU_SELECT | 3- No exception is | The terminal | | | ION_HELP_REQUEST | thrown. | Response of | | | | | DISPLAY TEXT is | | | 1- Applet is | 4- No exception is | sent to the SIM | | | registered to all | thrown | | | | events defined in | | | | | TS 43.019 [7] | 6- Applet is | | | | except | triggered | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | 7- No exception is | | | | and | thrown and the | | | | EVENT | handler contains | | | | _STATUS_COMMAND. | the envelope call | | | | | control by SIM | | | | Using the methods | | | | | initMenuEntry() | 8- The contents of | | | | for | the envelope | | | | EVENT | handler shall be | | | | _MENU_SELECTION, | the same as stored | | | | allocateTimer()for | in buffer 1 | | | | EVENT_ | | | | | TIMER_EXPIRATION, | | | | | and setEventList() | | | | | for the rest of | | | | | the events. | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-Envelope menu | | | | | selection with | | | | | help request is | | | | | sent to the SIM | | | | | | | | | | 3-EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 4-Copy the | | | | | contents of the | | | | | envelope handler | | | | | in buffer 1 using | | | | | Enve | | | | | lopeHandler.copy() | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_HELP_REQUEST | | | | | | | | | | 5-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 6-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 7- It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_HELP_REQUEST | | | | | is the TLV | | | | | selected | | | | | | | | | | 8-The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 2 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVEN | 2- No exception is | Display Text is | | | T_MENU_SELECTION | thrown. | fetched | | | | | | | | 1-An envelope menu | 3- No exception is | The terminal | | | selection is sent | thrown. | Response of | | | to SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the SIM | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 6- No exception is | | | | | thrown and the | | | | 3-Copy the | handler contains | | | | contents of the | the envelope call | | | | envelope handler | control by SIM | | | | in buffer 1 using | | | | | Enve | 7- The contents of | | | | lopeHandler.copy() | the envelope | | | | | handler shall be | | | | The | the same as stored | | | | Envelop | in buffer 1 | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG | | | | | _ITEM_IDENTIFIER | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- It\'s checked | | | | | the contents of | | | | | the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG | | | | | _ITEM_IDENTIFIER | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 3 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_FORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_ENV | thrown. | fetched | | | | | | | | 1-A formatted sms | 3- No exception is | The terminal | | | pp envelope is | thrown. | Response of | | | sent to SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the SIM | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 6- No exception is | | | | | thrown and the | | | | 3-Copy the | handler contains | | | | contents of the | the envelope call | | | | envelope handler | control by SIM | | | | in buffer 1 using | | | | | Env | 7- The contents of | | | | elopeHandler.copy( | the envelope | | | | ) | handler shall be | | | | | the same as stored | | | | The | in buffer 1 | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Env | | | | | elopeHandler.copy( | | | | | ) and | | | | | Util.arrayCompare | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_SMS_TPDU | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 4 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_UNFORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_ENV | thrown. | fetched | | | | | | | | 1-A unformatted | 3- No exception is | The terminal | | | sms pp envelope is | thrown. | Response of | | | sent to SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the SIM | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 6- No exception is | | | | | thrown and the | | | | 3-Copy the | handler contains | | | | contents of the | the envelope call | | | | envelope handler | control by SIM | | | | in buffer 1 using | | | | | Env | 7- The contents of | | | | elopeHandler.copy( | the envelope | | | | ) | handler shall be | | | | | the same as stored | | | | The | in buffer 1. | | | | Envel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 5 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_UN | 2- No exception is | Display Text is | | | FORMATTED_SMS_CB | thrown. | fetched | | | | | | | | 1-A unformatted | 3- No exception is | The terminal | | | cellbroadcast | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | En | | | | | velopeHandler.copy | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 6 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT\ | 2- No exception is | Display Text is | | | _TIMER_EXPIRATION | thrown. | fetched | | | | | | | | 1-A timer | 3- No exception is | The terminal | | | expiration | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1 | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_TIMER_ID | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_TIMER_ID | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 7 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_CALL | 2- No exception is | Display Text is | | | _CONTROL_BY_SIM | thrown. | fetched | | | | | | | | 1-A call control | 3- No exception is | The terminal | | | envelope is sent | thrown. | Response of | | | to SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the SIM | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 6- No exception is | | | | | thrown and the | | | | 3-Copy the | handler contains | | | | contents of the | the envelope call | | | | envelope handler | control by SIM | | | | in buffer 1 using | | | | | Enve | 7- The contents of | | | | lopeHandler.copy() | the envelope | | | | | handler shall be | | | | The | the same as stored | | | | Envelop | in buffer 1 | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_ADDRESS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 8 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | MO_SHORT_MESSAGE | 2- No exception is | Display Text is | | | _CONTROL_BY_SIM | thrown. | fetched | | | | | | | | 1-A mo short | 3- No exception is | The terminal | | | message control by | thrown. | Response of | | | sim envelope is | | DISPLAY TEXT is | | | sent to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_ADDRESS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 9 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | EVENT_ | 2- No exception is | Display Text is | | | DOWNLOAD_MT_CALL | thrown. | fetched | | | | | | | | 1-A event download | 3- No exception is | The terminal | | | mt call envelope | thrown. | Response of | | | is sent to SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the SIM | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 6- No exception is | | | | | thrown and the | | | | 3-Copy the | handler contains | | | | contents of the | the envelope call | | | | envelope handler | control by SIM | | | | in buffer 1 using | | | | | Enve | 7- The contents of | | | | lopeHandler.copy() | the envelope | | | | | handler shall be | | | | The | the same as stored | | | | Envelop | in buffer 1 | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_ADDRESS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 10 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | EVENT_DOWNLOA | 2- No exception is | Display Text is | | | D_CALL_CONNECTED | thrown. | fetched | | | | | | | | 1-A event download | 3- No exception is | The terminal | | | call connected | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | En | | | | | velopeHandler.copy | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_ADDRESS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 11 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | EVENT_DOWNLOAD_ | 2- No exception is | Display Text is | | | CALL_DISCONNECTED | thrown. | fetched | | | | | | | | 1-A event download | 3- No exception is | The terminal | | | call disconnected | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | En | | | | | velopeHandler.copy | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_ADDRESS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 12 | Envelope Handler | 1- Applet is | 4-91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | EVENT_DOWNLOAD | 2- No exception is | Display Text is | | | _LOCATION_STATUS | thrown. | fetched | | | | | | | | 1-A event download | 3- No exception is | The terminal | | | location status | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1 | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG | | | | | _LOCATION_STATUS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG | | | | | _LOCATION_STATUS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 13 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | EVENT_DOWNLO | 2- No exception is | Display Text is | | | AD_USER_ACTIVITY | thrown. | fetched | | | | | | | | 1-A event download | 3- No exception is | The terminal | | | user activity | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to SIM | 5- Applet is | sent to the SIM | | | | triggered | | | | 2-EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3-Copy the | the envelope call | | | | contents of the | control by SIM | | | | envelope handler | | | | | in buffer 1 using | 7- The contents of | | | | Enve | the envelope | | | | lopeHandler.copy() | handler shall be | | | | | the same as stored | | | | The | in buffer 1 | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 14 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | EVEN | 2- No exception is | Display Text is | | | T_DOWNLOAD_IDLE\ | thrown. | fetched | | | _SCREEN_AVAILABLE | | | | | | 3- No exception is | The terminal | | | 1-A event download | thrown. | Response of | | | idle screen | | DISPLAY TEXT is | | | available envelope | 5- Applet is | sent to the SIM | | | is sent to SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3-Copy the | control by SIM | | | | contents of the | | | | | envelope handler | 7- The contents of | | | | in buffer 1 using | the envelope | | | | Enve | handler shall be | | | | lopeHandler.copy() | the same as stored | | | | | in buffer 1 | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 15 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | E | 2- No exception is | Display Text is | | | VENT_DOWNLOAD_CA | thrown. | fetched | | | RD_READER_STATUS | | | | | | 3- No exception is | The terminal | | | 1-A event download | thrown. | Response of | | | card reader status | | DISPLAY TEXT is | | | envelope is sent | 5- Applet is | sent to the SIM | | | to SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3-Copy the | control by SIM | | | | contents of the | | | | | envelope handler | 7- The contents of | | | | in buffer 1 using | the envelope | | | | Enve | handler shall be | | | | lopeHandler.copy() | the same as stored | | | | | in buffer 1 | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_CA | | | | | RD_READER_STATUS | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | En | | | | | velopeHandler.copy | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_CA | | | | | RD_READER_STATUS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 16 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | UNRE | 2- No exception is | Display Text is | | | COGNIZED_ENVELOPE | thrown. | fetched | | | | | | | | 1-A unrecognized | 3- No exception is | The terminal | | | envelope is sent | thrown. | Response of | | | to SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the SIM | | | 2-EnvelopeHandl | triggered | | | | er.getTheHandler() | | | | | method is called | 6- No exception is | | | | | thrown and the | | | | 3-Copy the | handler contains | | | | contents of the | the envelope call | | | | envelope handler | control by SIM | | | | in buffer 1 using | | | | | Enve | 7- The contents of | | | | lopeHandler.copy() | the envelope | | | | | handler shall be | | | | 4-A proactive | the same as stored | | | | command DISPLAY | in buffer 1 | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | The | | | | | EnvelopeHandle | | | | | r.getValueLength() | | | | | is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 17 | Envelope Handler | 1- Applet is | 4-91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | _EVENT_E | 2-No exception is | Display Text is | | | VENT_DOWNLOAD_LA | thrown. | fetched | | | NGUAGE_SELECTION_ | | | | | | 3-No exception is | The terminal | | | 1-A event download | thrown. | Response of | | | language selection | | DISPLAY TEXT is | | | envelope is sent | 5- Applet is | sent to the SIM | | | to SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3-Copy the | control by SIM | | | | contents of the | | | | | envelope handler | 7- The contents of | | | | in buffer 1 using | the envelope | | | | Enve | handler shall be | | | | lopeHandler.copy() | the same as stored | | | | | in buffer 1 | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_EVENT_LIST | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_EVENT_LIST | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 18 | Envelope Handler | 1- Applet is | 4-91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | _EVENT_EV | 2-No exception is | Display Text is | | | ENT_DOWNLOAD_BRO | thrown. | fetched | | | WSER_TERMINATION_ | | | | | | 3-No exception is | The terminal | | | 1-A event download | thrown. | Response of | | | browser | | DISPLAY TEXT is | | | termination | 5- Applet is | sent to the SIM | | | envelope is sent | triggered | | | | to SIM | | | | | | 6- No exception is | | | | 2-EnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3-Copy the | | | | | contents of the | 7- The contents of | | | | envelope handler | the envelope | | | | in buffer 1 using | handler shall be | | | | Enve | the same as stored | | | | lopeHandler.copy() | in buffer 1 | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_EVENT_LIST | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_EVENT_LIST | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 19 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_FORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_UPD | thrown. | fetched | | | | | | | | 1-Update Record | 3- No exception is | The terminal | | | EFsms instruction | thrown. | Response of | | | single and | | DISPLAY TEXT is | | | formatted is sent | 5- Applet is | sent to the SIM | | | to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3-Copy the | control by SIM | | | | contents of the | | | | | envelope handler | 7- The contents of | | | | in buffer 1 using | the envelope | | | | Env | handler shall be | | | | elopeHandler.copy( | the same as stored | | | | ) | in buffer 1 | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Env | | | | | elopeHandler.copy( | | | | | ) and | | | | | Util.arrayCompare | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the TAG_SMS_TPDU | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 20 | Envelope Handler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_UNFORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_UPD | thrown. | fetched | | | | | | | | 1- Update Record | 3- No exception is | The terminal | | | EFsms instruction | thrown. | Response of | | | single and | | DISPLAY TEXT is | | | unformatted is | 5- Applet is | sent to the SIM | | | sent to the SIM | triggered | | | | | | | | | 2-EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3-Copy the | control by SIM | | | | contents of the | | | | | envelope handler | 7- The contents of | | | | in buffer 1 using | the envelope | | | | Env | handler shall be | | | | elopeHandler.copy( | the same as stored | | | | ) | in buffer 1. | | | | | | | | | The | | | | | Envel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4-A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5-Envelope call | | | | | control by sim is | | | | | sent to SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6-It\'s checked | | | | | that the contents | | | | | of the envelope | | | | | handler is the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | It\'s checked that | | | | | the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The contents of | | | | | EnvelopeHandler | | | | | are compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 21 | Check the TLV list | 1- Applet is | | | | conversion for | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- An | | | | | EVENT_FORMA | 3- return the | | | | TTED_SMS_PP_UPD | absolute record. | | | | is sent to the | | | | | SIM. | 4- return the | | | | | record status | | | | 2- The findTLV(tag | | | | | == device | 5- No exception is | | | | identities Tag) is | thrown. | | | | called. | | | | | | 7- No exception is | | | | 3- The | thrown. | | | | g | | | | | etValueByte(offset | | | | | == 0) is called. | | | | | | | | | | 4- The | | | | | g | | | | | etValueByte(offset | | | | | == 1) is called. | | | | | | | | | | 5- The findTLV(tag | | | | | == address Tag) is | | | | | called. | | | | | | | | | | 6- Check the | | | | | content | | | | | | | | | | 7- The findTLV(tag | | | | | == SMS TPDU Tag) | | | | | is called. | | | | | | | | | | 8- Check the | | | | | content | | | +----+--------------------+--------------------+--------------------+ | 22 | Check TLV list | 1. return the | | | | conversion for | Simple TLV list | | | | EVENT_FORMA | length | | | | TTED_SMS_PP_UPD | | | | | | | | | | 1- The getLength() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 23 | Check TLV list | 1- return | | | | conversion for | _BTAG_ | | | | EVENT_FORMA | SMS_PP_DOWNLOAD_ | | | | TTED_SMS_PP_UPD | | | | | | | | | | 1- The | | | | | getEnvelopeTag() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 24 | Check the TLV list | 1- Applet is | | | | conversion for | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- An | | | | | EVENT_UNFORMA | 3- return the | | | | TTED_SMS_PP_UPD | absolute record. | | | | is sent to the | | | | | SIM. | 4- return the | | | | | record status | | | | 2- The findTLV(tag | | | | | == device | 5- No exception is | | | | identities Tag) is | thrown. | | | | called. | | | | | | 7- No exception is | | | | 3- The | thrown. | | | | g | | | | | etValueByte(offset | | | | | == 0) is called. | | | | | | | | | | 4- The | | | | | g | | | | | etValueByte(offset | | | | | == 1) is called. | | | | | | | | | | 5- The findTLV(tag | | | | | == address Tag) is | | | | | called. | | | | | | | | | | 6- Check the | | | | | content | | | | | | | | | | 7- The findTLV(tag | | | | | == SMS TPDU Tag) | | | | | is called. | | | | | | | | | | 8- Check the | | | | | content | | | +----+--------------------+--------------------+--------------------+ | 25 | Check TLV list | 1. return the | | | | conversion for | Simple TLV list | | | | EVENT_UNFORMA | length | | | | TTED_SMS_PP_UPD | | | | | | | | | | 1- The getLength() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 26 | Check TLV list | 1- return | | | | conversion for | _BTAG_ | | | | EVENT_UNFORMA | SMS_PP_DOWNLOAD_ | | | | TTED_SMS_PP_UPD | | | | | | | | | | 1- The | | | | | getEnvelopeTag() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+
##### 6.3.2.3.4 Test Coverage {#test-coverage-130 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20
CRRN2 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20
CRRN3 21, 24 CRRN4 22, 25 CRRN5 23, 26 CRRN6 21, 24
#### 6.3.2.4 EnvelopeResponseHandler
Test Area Reference: FWK_HIN_ERHD
##### 6.3.2.4.1 Conformance Requirement {#conformance-requirement-119 .H6}
##### 6.3.2.4.1.1 Normal Execution {#normal-execution-134 .H6}
  * CRRN1: At the processToolkit invocation the TLV-List is cleared.
##### 6.3.2.4.2 Test Suite Files: {#test-suite-files-134 .H6}
> Test Script: FWK_HIN_ERHD_1.scr
>
> Test Applet: FWK_HIN_ERHD_1.java
>
> Load Script: FWK_HIN_ERHD_1.ldr
>
> Cleanup Script: FWK_HIN_ERHD_1.clr
>
> Parameter File: FWK_HIN_ERHD_1.par
##### 6.3.2.4.3 Test Procedure {#test-procedure-134 .H6}
Id Description API/Framework Expectation APDU Expectation
* * *
1 Applet1 is registered to EVENT_UNRECOGNIZED_ENVELOPE.  
1-An unrecognised envelope is sent to the SIM 1- Applet 1 is triggered.  
2- EnvelopeResponseHandler.getTheHandler()is called by the Applet1.  
3- EnvelopeResponseHandler.getLength() method is called by Applet1 2- The
return value shall be 0.
##### 6.3.2.4.4 Test Coverage {#test-coverage-131 .H6}
CRR Number Test Case Number
* * *
CRRN1 1
### 6.3.3 Applet Triggering
#### 6.3.3.1 EVENT_PROFILE_DOWNLOAD
Test Area Reference: FWK_APT_EPDW
##### 6.3.3.1.1 Conformance Requirement {#conformance-requirement-120 .H6}
##### 6.3.3.1.1.1 Normal Execution {#normal-execution-135 .H6}
  * CRRN1: Upon the reception of Terminal Profile command by the SIM, > the STF stores the ME Profile and then triggers the registered > toolkit applets.
  * CRRN2: The applet is not triggered by the EVENT_PROFILE_DOWNLOAD > once it has deregistered from this event.
  * CRRN3: The STF shall not reply busy to a Terminal Profile command
##### 6.3.3.1.1.2 Parameters error {#parameters-error-52 .H6}
No requirements.
##### 6.3.3.1.1.3 Context Errors {#context-errors-129 .H6}
No requirements.
##### 6.3.3.1.2 Test Suite Files {#test-suite-files-135 .H6}
> Test Script: FWK_APT_EPDW_1.scr
>
> Test Applet: FWK_APT_EPDW_1.java
>
> FWK_APT_EPDW_2.java
>
> FWK_APT_EPDW_3.java
>
> Load Script: FWK_APT_EPDW_1.ldr
>
> Cleanup Script: FWK_APT_EPDW_1.clr
>
> Parameter File: FWK_APT_EPDW_1.par
##### 6.3.3.1.3 Test Procedure {#test-procedure-135 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applets | 1- Applet1 is | | | | registration to | triggered | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | Applet1 finalizes | | | | and triggering | | | | | | 2- Applet2 is | | | | Applet1 is | triggered | | | | registered to the | | | | | EVENT\ | Applet2 finalizes | | | | _PROFILE_DOWNLOAD | | | | | | 3- Applet3 is not | | | | Applet2 is | triggered | | | | registered to the | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | | | | | | | | Applet3 is not | | | | | registered to the | | | | | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | | | and is registered | | | | | to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-Terminal Profile | | | | | command is sent to | | | | | SIM | | | +----+--------------------+--------------------+--------------------+ | 2 | The STF shall not | 1- Applet3 is | 2- A proactive | | | reply busy to a | triggered by the | command is sent | | | Terminal Profile | EVENT_FORMA | | | | command | TTED_SMS_PP_ENV | The terminal | | | | | Response of the | | | 1-Formatted sms pp | Applet3 is | proactive command | | | envelope is sent | suspended until | is sent | | | to SIM | the terminal | | | | | response | | | | Applet3 builds a | | | | | REFRESH proactive | 3- Applet1 is | | | | command in sim | triggered by | | | | initialization | EVENT\ | | | | mode | _PROFILE_DOWNLOAD | | | | | | | | | 2-Proac | Applet1 finalizes | | | | tiveHandler.send() | | | | | method is called | 4- Applet2 is | | | | by applet3 | triggered by | | | | | EVENT\ | | | | 3-Terminal Profile | _PROFILE_DOWNLOAD | | | | command is sent to | | | | | SIM | Applet2 finalizes | | | | | | | | | Applet1 calls | Applet3 finalizes | | | | Toolkit | | | | | Re | | | | | gistry.clearEvent( | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD) | | | | | | | | | | 4-Applet2 calls | | | | | Toolkit | | | | | Re | | | | | gistry.clearEvent( | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD) | | | | | | | | | | ToolkitRegistr | | | | | y.setEvent(EVENT_ | | | | | PROFILE_DOWNLOAD) | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 3 | Deregistered | Applet3 is | | | | applets are not | triggered | | | | triggered | | | | | | (Applet1 and | | | | Terminal Profile | Applet2 are not | | | | command is sent to | triggered) | | | | SIM | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.1.4 Test Coverage {#test-coverage-132 .H6}
CRR Number Test Case Number
* * *
CRRN1 1 CRRN2 3 CRRN3 2
#### 6.3.3.2 EVENT_MENU_SELECTION
Test Area Reference: FWK_APT_EMSE
##### 6.3.3.2.1 Conformance Requirement {#conformance-requirement-121 .H6}
##### 6.3.3.2.1.1 Normal Execution {#normal-execution-136 .H6}
  * CRRN1: The applet is triggered by the EVENT_MENU_SELECTION when an > Envelope Menu Selection is received with the item identifier of a > menu entry of this applet if no proactive session is ongoing.
##### 6.3.3.2.1.2 Parameters error {#parameters-error-53 .H6}
No requirements.
##### 6.3.3.2.1.3 Context Errors {#context-errors-130 .H6}
No requirements.
##### 6.3.3.2.2 Test Suite Files {#test-suite-files-136 .H6}
> Test Script: FWK_APT_EMSE_1.scr
>
> Test Applet: FWK_APT_EMSE_1.java
>
> FWK_APT_EMSE_2.java
>
> Load Script: FWK_APT_EMSE_1.ldr
>
> Cleanup Script: FWK_APT_EMSE_1.clr
>
> Parameter File: FWK_APT_EMSE_1.par
##### 6.3.3.2.3 Test Procedure {#test-procedure-136 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- The method must | | | | registration to | return true. | | | | EVEN | | | | | T_MENU_SELECTION | 2- Applet1 is | | | | and triggering | triggered and | | | | | applet2 is not | | | | ToolkitRegist | triggered | | | | ry.initMenuEntry() | | | | | method is called | Applet1 finalizes | | | | in the constructor | | | | | of applet1 and | 3- Applet2 is | | | | Applet2. | triggered and | | | | | applet1 is not | | | | For applet1: | triggered | | | | | | | | | Men | | | | | uEntry=\"Applet1\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | H | | | | | elpSupported=false | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | For applet2: | | | | | | | | | | Men | | | | | uEntry=\"Applet2\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | H | | | | | elpSupported=false | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | event= | | | | | EVEN | | | | | T_MENU_SELECTION | | | | | | | | | | 1-ToolkitReg | | | | | istry.isEventSet() | | | | | is called in | | | | | constructor. | | | | | | | | | | Perform SIM | | | | | initialization the | | | | | facility SET UP | | | | | MENU and without | | | | | the facilities SET | | | | | EVENT LIST and | | | | | POLL INTEVAL | | | | | features | | | | | | | | | | 2-Item Identifier | | | | | = 1 | | | | | | | | | | Event Menu | | | | | Selection envelope | | | | | is sent to the SIM | | | | | with the item | | | | | identifier of a | | | | | menu entry of | | | | | applet | | | | | | | | | | 3-Item Identifier | | | | | = 2 | | | | | | | | | | Event Menu | | | | | Selection envelope | | | | | is sent to the SIM | | | | | with the item | | | | | identifier of a | | | | | menu entry of | | | | | applet | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.2.4 Test Coverage {#test-coverage-133 .H6}
CRR Number Test Case Number
* * *
CRRN1 1
#### 6.3.3.3 EVENT_MENU_SELECTION_HELP_REQUEST
Test Area Reference: FWK_APT_EMSH
##### 6.3.3.3.1 Conformance Requirement {#conformance-requirement-122 .H6}
##### 6.3.3.3.1.1 Normal Execution {#normal-execution-137 .H6}
  * CRRN1: If an ENVELOPE (MENU_SELECTION_HELP_SUPPORTED) command is > received for one entry supporting help, then STF shall trigger the > corresponding applet.
  * CCRN2: A toolkit applet shall be triggered by the > EVENT_MENU_SELECTION_HELP_REQUEST event only if the Menu Id > corresponding to the Envelope Menu Selection Help Request received > by the SIM Toolkit framework was registered with the helpSupported > value set to true.
  * CCRN3: If at least one menuId of a Toolkit Applet registers to > EVENT_MENU_SELECTION_HELP_REQUEST, the SET UP MENU proactive > command sent by the SIM Toolkit Framework shall indicate to the ME > that help information is available unless all the menus entries > that support help are disabled.
##### 6.3.3.3.1.2 Parameters error {#parameters-error-54 .H6}
No requirements.
##### 6.3.3.3.1.3 Context Errors {#context-errors-131 .H6}
No requirements.
##### 6.3.3.3.2 Test Suite Files {#test-suite-files-137 .H6}
Test Script: FWK_APT_EMSH_1.scr
Test Applet: FWK_APT_EMSH_1.java
FWK_APT_EMSH_2.java
FWK_APT_EMSH_3.java
Load Script: FWK_APT_EMSH_1.ldr
Cleanup Script: FWK_APT_EMSH_1.clr
Parameter File: FWK_APT_EMSH_1.par
##### 6.3.3.3.3 Test Procedure {#test-procedure-137 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet | 1- The command | | | | registration to | shall return true. | | | | E | | | | | VENT_MENU_SELECT | 2- The command | | | | ION_HELP_REQUEST | shall return true. | | | | and triggering | | | | | | 3- Applet1 is | | | | Applet1 and | triggered and | | | | Applet2 are | Applet2 is not | | | | installed | triggered | | | | | | | | | ToolkitRegist | 4 Applet1 and | | | | ry.InitMenuEntry() | Applet2 are not | | | | method is called | triggered | | | | in the constructor | | | | | of Applet1 and | 5- Applet2 is | | | | Applet2. | triggered and | | | | | Applet1 is not | | | | For Applet1 (item | triggered | | | | id 1): | | | | | | 6- Applet2 and | | | | Menu | Applet1 are not | | | | Entry=\"Applet1A\" | triggered | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | HelpSupported=true | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | For Applet1 (item | | | | | id 2): | | | | | | | | | | Menu | | | | | Entry=\"Applet1B\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | H | | | | | elpSupported=false | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | event= | | | | | E | | | | | VENT_MENU_SELECT | | | | | ION_HELP_REQUEST | | | | | | | | | | 1- | | | | | ToolkitReg | | | | | istry.isEventSet() | | | | | is called in | | | | | constructor. | | | | | | | | | | For Applet2 (item | | | | | id 3): | | | | | | | | | | Menu | | | | | Entry=\"Applet2A\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | HelpSupported=true | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | For Applet2 (item | | | | | id 4): | | | | | | | | | | Menu | | | | | Entry=\"Applet2B\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | H | | | | | elpSupported=false | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | event= | | | | | E | | | | | VENT_MENU_SELECT | | | | | ION_HELP_REQUEST | | | | | | | | | | 2- | | | | | ToolkitReg | | | | | istry.isEventSet() | | | | | is called in | | | | | constructor. | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with the facility | | | | | SET UP MENU and | | | | | without the | | | | | facilities SET | | | | | EVENT LIST and | | | | | POLL INTERVAL | | | | | | | | | | 3-Item identifier | | | | | = 1 | | | | | | | | | | Menu Selection | | | | | Help Request | | | | | envelope is sent | | | | | to the SIM with | | | | | item identifier 1 | | | | | belonging to | | | | | applet1 | | | | | | | | | | 4-Item identifier | | | | | = 2 | | | | | | | | | | Menu Selection | | | | | Help Request | | | | | envelope is sent | | | | | to the SIM with | | | | | item identifier 2 | | | | | belonging to | | | | | applet1 | | | | | | | | | | 5-Item identifier | | | | | = 3 | | | | | | | | | | Menu Selection | | | | | Help Request | | | | | envelope is sent | | | | | to the SIM with | | | | | item identifier 3 | | | | | belonging to | | | | | applet2 | | | | | | | | | | 6-Item identifier | | | | | = 4 | | | | | | | | | | Menu Selection | | | | | Help Request | | | | | envelope is sent | | | | | to the SIM with | | | | | item identifier 4 | | | | | belonging to | | | | | applet2 | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet | 2. Applet3 is | 1. The SIM shall | | | deregistration to | triggered by | issue a SET UP | | | E | E | MENU proactive | | | VENT_MENU_SELECT | VENT_MENU_SELECT | command with Menu | | | ION_HELP_REQUEST | ION_HELP_REQUEST | Entry ID entry | | | | | \'05\', \'06\' and | | | Applet1 and | 4. Applet3 is | \'07\', and Help | | | Applet2 are | triggered by | supported set to | | | deleted | E | true. | | | | VENT_MENU_SELECT | | | | Applet3 is | ION_HELP_REQUEST | 3. The SIM shall | | | installed | | issue a SET UP | | | | | MENU proactive | | | ToolkitRegist | | command with Menu | | | ry.InitMenuEntry() | | Entry ID entry | | | method is called | | \'06\' and \'07\', | | | in the constructor | | and Help supported | | | of Applet3. | | set to true. | | | | | | | | For Applet3 (item | | 5. The SIM shall | | | id 5): | | issue a SET UP | | | | | MENU proactive | | | Menu | | command with Menu | | | Entry=\"Applet3A\" | | Entry ID entry | | | | | \'07\', and Help | | | Offset=0 | | supported set to | | | | | false. | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | HelpSupported=true | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | For Applet3 (item | | | | | id 6): | | | | | | | | | | Menu | | | | | Entry=\"Applet3B\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | HelpSupported=true | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | For Applet3 (item | | | | | id 7): | | | | | | | | | | Menu | | | | | Entry=\"Applet3C\" | | | | | | | | | | Offset=0 | | | | | | | | | | Lengt | | | | | h=menuEntry.length | | | | | | | | | | H | | | | | elpSupported=false | | | | | | | | | | IconQualifier=0 | | | | | | | | | | IconIdentifier=0 | | | | | | | | | | 1. Perform SIM | | | | | initialization | | | | | with the facility | | | | | SET UP MENU and | | | | | without the | | | | | facilities SET | | | | | EVENT LIST and | | | | | POLL INTERVAL | | | | | | | | | | 2. Menu Selection | | | | | Help Request | | | | | envelope is sent | | | | | to the SIM with | | | | | item identifier 5 | | | | | belonging to | | | | | applet3 | | | | | | | | | | 3. | | | | | ToolkitRegistry. | | | | | disableMenuEntry() | | | | | method for item id | | | | | 5 is called by the | | | | | Menu Selection | | | | | Help Request | | | | | Envelope. | | | | | | | | | | 4. Menu Selection | | | | | Help Request | | | | | envelope is sent | | | | | to the SIM with | | | | | item identifier 6 | | | | | belonging to | | | | | applet3 | | | | | | | | | | 5. | | | | | ToolkitRegistry. | | | | | disableMenuEntry() | | | | | method for item id | | | | | 6 is called by the | | | | | Menu Selection | | | | | Help Request | | | | | Envelope. | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.3.4 Test Coverage {#test-coverage-134 .H6}
CRR Number Test Case Number
* * *
CRRN1 1 CRRN2 1 CRRN3 2
#### 6.3.3.4 EVENT_FORMATTED_SMS_PP_ENV
Test Area Reference: FWK_APT_EFSE
##### 6.3.3.4.1 Conformance Requirement {#conformance-requirement-123 .H6}
##### 6.3.3.4.1.1 Normal Execution {#normal-execution-138 .H6}
  * CRRN1: The applet is triggered by the EVENT_FORMATTED_SMS_PP_ENV > once:
\- it has been registered to this event;
\- a Short Message Point to Point (Single or Concatenated) is received by
Envelope APDU(s) and is formatted according to 3GPP TS 23.048 [8];
\- the toolkit applet to be triggered is registered with the corresponding TAR
in the SMS TPDU;
\- the security is verified.
  * CRRN2: The applet is not triggered by the > EVENT_FORMATTED_SMS_PP_ENV once it has deregistered from this > event.
##### 6.3.3.4.1.2 Parameters error {#parameters-error-55 .H6}
No requirements.
##### 6.3.3.4.1.3 Context Errors {#context-errors-132 .H6}
No requirements.
##### 6.3.3.4.2 Test Suite Files {#test-suite-files-138 .H6}
> Test Script: FWK_APT_EFSE_1.scr
>
> Test Applet: FWK_APT_EFSE_1.java
>
> Load Script: FWK_APT_EFSE_1.ldr
>
> Cleanup Script: FWK_APT_EFSE_1.clr
>
> Parameter File: FWK_APT_EFSE_1.par
##### 6.3.3.4.3 Test Procedure {#test-procedure-138 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Applet is | | | | registration to | triggered | | | | EVENT | | | | | FORMA | 2- Applet is | | | | TTED_SMS_PP_ENV | triggered | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1- A Single Short | | | | | Message SMS-PP | | | | | Formatted Data | | | | | Download is sent | | | | | to the SIM. | | | | | | | | | | 2- A Concatenated | | | | | Short Message | | | | | SMS-PP Formatted | | | | | Data Download is | | | | | sent to the SIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_FORMA | triggered | | | | TTED_SMS_PP_ENV | | | | | | 4- Applet is | | | | 1- A Single Short | triggered | | | | Message SMS-PP | | | | | Data Download is | | | | | sent to the SIM.. | | | | | | | | | | 2- A Concatenated | | | | | Short Messages | | | | | SMS-PP Data | | | | | Download is sent | | | | | to the SIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 3- A Single Short | | | | | Messages SMS-PP | | | | | Data Download is | | | | | sent to the SIM. | | | | | | | | | | 4- A Concatenated | | | | | Short Messages | | | | | SMS-PP Data | | | | | Download is sent | | | | | to the SIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.4.4 Test Coverage {#test-coverage-135 .H6}
CRR Number Test Case Number
* * *
CRRN1 (See note) 1, 2 CRRN2 2
NOTE: The security checks are not relevant to the test designed in this test
area; they will be checked in the \"Framework Security Management\" clause.
#### 6.3.3.5 EVENT_UNFORMATTED_SMS_PP_ENV
Test Area Reference: FWK_APT_EUSE
##### 6.3.3.5.1 Conformance Requirement {#conformance-requirement-124 .H6}
##### 6.3.3.5.1.1 Normal Execution {#normal-execution-139 .H6}
  * CRRN1: The applets registers are triggered by the > EVENT_UNFORMATTED_SMS_PP_ENV once a Short Message Point to > Point (Single or Concatenated) is received by Envelope APDU(s) and > is unformatted.
  * CRRN2: The applet is not triggered by the > EVENT_UNFORMATTED_SMS_PP_ENV once it has deregistered from > this event.
##### 6.3.3.5.1.2 Parameters error {#parameters-error-56 .H6}
No requirements.
##### 6.3.3.5.1.3 Context Errors {#context-errors-133 .H6}
No requirements.
##### 6.3.3.5.2 Test Suite Files {#test-suite-files-139 .H6}
> Test Script: FWK_APT_EUSE_1.scr
>
> Test Applet: FWK_APT_EUSE_1.java
>
> Load Script: FWK_APT_EUSE_1.ldr
>
> Cleanup Script: FWK_APT_EUSE_1.clr
>
> Parameter File: FWK_APT_EUSE_1.par
##### 6.3.3.5.3 Test Procedure {#test-procedure-139 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- The method | | | | registration to | returns true | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | 3- Applet is | | | | registered to the | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 2- A Single and | | | | | Unformatted SMS-PP | | | | | Data Download | | | | | Envelope is sent | | | | | to the SIM. | | | | | | | | | | 3- A Concatenated | | | | | and Unformatted | | | | | SMS-PP Data | | | | | Download Envelope | | | | | is sent to the SIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Toolkit | 2- Applet isn\'t | | | | Registry. | triggered | | | | clearEvent()method | | | | | is called for | 3- Applet is | | | | EVENT_UNFORMA | triggered | | | | TTED_SMS_PP_ENV | | | | | | 4- Applet is | | | | 1- A Single and | triggered | | | | Unformatted SMS-PP | | | | | Data Download | | | | | Envelope is sent | | | | | to the SIM. | | | | | | | | | | 2- A Concatenated | | | | | and Unformatted | | | | | SMS-PP Data | | | | | Download Envelope | | | | | is sent to the SIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | | | | | | | | Applet is | | | | | triggered by a | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 3- A Single and | | | | | Unformatted SMS-PP | | | | | Data Download | | | | | Envelope is sent | | | | | to the SIM. | | | | | | | | | | 4- A Concatenated | | | | | and Unformatted | | | | | SMS-PP Data | | | | | Download Envelope | | | | | is sent to the SIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.5.4 Test Coverage {#test-coverage-136 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.6 EVENT_CALL_CONTROL_BY_SIM
Test Area Reference: FWK_APT_ECCN
##### 6.3.3.6.1 Conformance Requirement {#conformance-requirement-125 .H6}
##### 6.3.3.6.1.1 Normal Execution {#normal-execution-140 .H6}
  * CRRN1: The applet is triggered by the EVENT_CALL_CONTROL_BY_SIM > once it has registered to this event and an Envelope Call Control > is received.
  * CRRN2: The applet is not triggered by the > EVENT_CALL_CONTROL_BY_SIM once it has deregistered from this > event.
##### 6.3.3.6.1.2 Parameters error {#parameters-error-57 .H6}
No requirements.
##### 6.3.3.6.1.3 Context Errors {#context-errors-134 .H6}
No requirements.
##### 6.3.3.6.2 Test Suite Files {#test-suite-files-140 .H6}
> Test Script: FWK_APT_ECCN_1.scr
>
> Test Applet: FWK_APT_ECCN_1.java
>
> Load Script: FWK_APT_ECCN_1.ldr
>
> Cleanup Script: FWK_APT_ECCN_1.clr
>
> Parameter File: FWK_APT_ECCN_1.par
##### 6.3.3.6.3 Test Procedure {#test-procedure-140 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applets | 1- Applet1 is | | | | registration to | triggered | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | and triggering | | | | | | | | | | Applet1 is | | | | | registered to | | | | | EVENT_CALL\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | Applet2 is | | | | | registered to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 1-An Envelope Call | | | | | control by SIM is | | | | | sent to SIM | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet | 1-Applet2 is | 2- A proactive | | | deregistration and | triggered by | command DISPLAY | | | registration of | EVENT_FORMAT | TEXT is sent and | | | the third applet | TED_SMS_PP_ENV. | | | | to | | applet is | | | EVENT_CALL | 3- Applet1 is | suspended until | | | -CONTROL_BY_SIM. | triggered | the terminal | | | | | response | | | 1-An Envelope | Applet1 finalizes. | | | | Formatted SMS PP | | TERMINAL RESPONSE | | | envelope is sent | Applet2 finalizes | of DISPLAY TEXT is | | | to SIM | | sent to the SIM | | | | | | | | Applet2 contructs | | | | | a DISPLAY TEXT | | | | | proactive command. | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3-An Envelope Call | | | | | control by SIM | | | | | envelope is sent | | | | | to SIM | | | | | | | | | | ToolkitReg | | | | | istry.clearEvent() | | | | | is called for | | | | | EVENT_CALL\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_CALL\ | | | | | _CONTROL_BY_SIM. | | | +----+--------------------+--------------------+--------------------+ | 3 | Applet triggering | Applet2 is | | | | | triggered. | | | | An Envelope Call | | | | | control by SIM | (Applet1 is not | | | | envelope is sent | triggered) | | | | to SIM | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.6.4 Test Coverage {#test-coverage-137 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3 CRRN2 3
#### 6.3.3.7 EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
Test Area Reference: FWK_APT_EMCN
##### 6.3.3.7.1 Conformance Requirement {#conformance-requirement-126 .H6}
##### 6.3.3.7.1.1 Normal Execution {#normal-execution-141 .H6}
  * CRRN1: The applet is triggered by the > EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM once it has registered > to this event and an Envelope MO Short Message Control.
  * CRRN2: The applet is not triggered by the > EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM once it has > deregistered from this event.
##### 6.3.3.7.1.2 Parameters error {#parameters-error-58 .H6}
No requirements.
##### 6.3.3.7.1.3 Context Errors {#context-errors-135 .H6}
No requirements.
##### 6.3.3.7.2 Test Suite Files {#test-suite-files-141 .H6}
> Test Script: FWK_APT_EMCN_1.scr
>
> Test Applet: FWK_APT_EMCN_1.java
>
> FWK_APT_EMCN_2.java
>
> Load Script: FWK_APT_EMCN_1.ldr
>
> Cleanup Script: FWK_APT_EMCN_1.clr
>
> Parameter File: FWK_APT_EMCN_1.par
##### 6.3.3.7.3 Test Procedure {#test-procedure-141 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet | 1- Applet1 is | | | | registration to | triggered. | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | and triggering | | | | | | | | | | Applet1 is | | | | | reggistered to | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | Applet2 is | | | | | registered to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-An Envelope MO | | | | | short message | | | | | envelope is sent | | | | | to SIM | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet | 1- Applet2 is | 2- A Proactive | | | deregistration and | triggered. | command DISPLAY | | | registration of | | TEXT is sent and | | | the third applet | 3- Applet1 is | | | | to | triggered. | applet is | | | EVENT_M | | suspended until | | | O_SHORT_MESSAGE\ | Applet1 finalizes. | the terminal | | | _CONTROL_BY_SIM. | | response | | | | Applet2 finalizes. | | | | The STF shall not | | TERMINAL RESPONSE | | | reply busy to a | | of DISPLAY TEXT is | | | call control | | sent to the SIM | | | envelope | | | | | | | | | | 1-An Envelope | | | | | formatted SMS PP | | | | | envelope is sent | | | | | to SIM. | | | | | | | | | | Applet2 builds a | | | | | DISPLAY TEXT | | | | | proactive command. | | | | | | | | | | 2-Proac | | | | | tiveHandler.send() | | | | | method is called. | | | | | | | | | | 3-An Envelope MO | | | | | Short message | | | | | envelope is sent | | | | | to SIM | | | | | | | | | | ToolkitReg | | | | | istry.clearEvent() | | | | | for | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM. | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM. | | | +----+--------------------+--------------------+--------------------+ | 3 | Applet3 triggering | Applet2 is | | | | | triggered. | | | | An Envelope MO SMS | | | | | control by SIM | (Applet1 is not | | | | envelope is sent | triggered) | | | | to SIM | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.7.4 Test Coverage {#test-coverage-138 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3 CRRN2 3
#### 6.3.3.8 EVENT_TIMER_EXPIRATION
Test Area Reference: FWK_APT_ETEX
##### 6.3.3.8.1 Conformance Requirement {#conformance-requirement-127 .H6}
##### 6.3.3.8.1.1 Normal Execution {#normal-execution-142 .H6}
  * CRRN1: The applet is triggered by the EVENT_TIMER_EXPIRATION once > it has been registered to this event and an Envelope Timer > Expiration with a Timer Identifier of the applet is received if no > proactive session is ongoing.
  * CRRN2: The applet is not triggered by the EVENT_TIMER_EXPIRATION > once it has been deregistered from this event.
##### 6.3.3.8.1.2 Parameters error {#parameters-error-59 .H6}
No requirements.
##### 6.3.3.8.1.3 Context Errors {#context-errors-136 .H6}
No requirements.
##### 6.3.3.8.2 Test Suite Files {#test-suite-files-142 .H6}
> Test Script: FWK_APT_ETEX_1.scr
>
> Test Applet: FWK_APT_ETEX_1.java
>
> Load Script: FWK_APT_ETEX_1.ldr
>
> Cleanup Script: FWK_APT_ETEX_1.clr
>
> Parameter File: FWK_APT_ETEX_1.par
##### 6.3.3.8.3 Test Procedure {#test-procedure-142 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- The method | | | | registration to | returns true | | | | EVENT\ | | | | | _TIMER_EXPIRATION | 2- Applet is | | | | and triggering | triggered. | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | using the | | | | | allocateTimer() | | | | | method and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | event= | | | | | EVENT\ | | | | | _TIMER_EXPIRATION | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | TIMER_EXPIRATION | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Timer id=1 | 2- Applet is | | | | | triggered | | | | Toolkit | | | | | Regis | | | | | try.ReleaseTimer() | | | | | method is called | | | | | | | | | | 1-An Envelope | | | | | timer expiration | | | | | is sent to the | | | | | SIM. | | | | | | | | | | An Envelope | | | | | formated sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Toolkit | | | | | Regist | | | | | ry.AllocateTimer() | | | | | method is called | | | | | | | | | | 2-An Envelope | | | | | TIMER_EXPIRATION | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.8.4 Test Coverage {#test-coverage-139 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.9 EVENT_UNFORMATTED_SMS_CB
Test Area Reference: FWK_APT_EUCB
##### 6.3.3.9.1 Conformance Requirement {#conformance-requirement-128 .H6}
##### 6.3.3.9.1.1 Normal Execution {#normal-execution-143 .H6}
  * CRRN1: The applet is triggered by the EVENT_UNFORMATTED_SMS_CB > once it has registered to this event and an Envelope Cell > Broadcast DownLoad is received.
  * CRRN2: The applet is not triggered by the > EVENT_UNFORMATTED_SMS_CB once it has deregistered from this > event.
##### 6.3.3.9.1.2 Parameters error {#parameters-error-60 .H6}
No requirements.
##### 6.3.3.9.1.3 Context Errors {#context-errors-137 .H6}
No requirements.
##### 6.3.3.9.2 Test Suite Files {#test-suite-files-143 .H6}
> Test Script: FWK_APT_EUCB_1.scr
>
> Test Applet: FWK_APT_EUCB_1.java
>
> Load Script: FWK_APT_EUCB_1.ldr
>
> Cleanup Script: FWK_APT_EUCB_1.clr
>
> Parameter File: FWK_APT_EUCB_1.par
##### 6.3.3.9.3 Test Procedure {#test-procedure-143 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API Expectation | APDU Expectation | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true. | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | and | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | event= | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | UN | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Toolkit | 2- Applet is | | | | Registry. | triggered | | | | ClearEvent()method | | | | | is called for | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | 1-An Envelope | | | | | UN | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | SIM. | | | | | | | | | | An Envelope | | | | | formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | event= | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | 2-An Envelope | | | | | UN | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.9.4 Test Coverage {#test-coverage-140 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.10 EVENT_EVENT_DOWNLOAD_MT_CALL
Test Area Reference: FWK_APT_EDMC
##### 6.3.3.10.1 Conformance Requirement {#conformance-requirement-129 .H6}
##### 6.3.3.10.1.1 Normal Execution {#normal-execution-144 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_MT_CALL once it has registered to this > event and an Envelope Event DownLoad MT Call is received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_MT_CALL once it has deregistered from > this event.
##### 6.3.3.10.1.2 Parameters error {#parameters-error-61 .H6}
No requirements.
##### 6.3.3.10.1.3 Context Errors {#context-errors-138 .H6}
No requirements.
##### 6.3.3.10.2 Test Suite Files {#test-suite-files-144 .H6}
> Test Script: FWK_APT_EMSE_1.scr
>
> Test Applet: FWK_APT_EMSE_1.java
>
> Load Script: FWK_APT_EMSE_1.ldr
>
> Cleanup Script: FWK_APT_EMSE_1.clr
>
> Parameter File: FWK_APT_EMSE_1.par
##### 6.3.3.10.3 Test Procedure {#test-procedure-144 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- The method | | | | registration to | returns true | | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | | | | | and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | event= | | | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVENT_ | | | | | DOWNLOAD_MT_CALL | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | event= | 2- Applet is | | | | EVENT_EVENT_ | triggered | | | | DOWNLOAD_MT_CALL | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-An Envelope | | | | | EVENT_ | | | | | DOWNLOAD_MT_CALL | | | | | is sent to the | | | | | SIM. | | | | | | | | | | An Envelope | | | | | formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | event= | | | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | EVENT_ | | | | | DOWNLOAD_MT_CALL | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.10.4 Test Coverage {#test-coverage-141 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.11 EVENT_EVENT_DOWNLOAD_CALL_CONNECTED
Test Area Reference: FWK_APT_EDCC
##### 6.3.3.11.1 Conformance Requirement {#conformance-requirement-130 .H6}
##### 6.3.3.11.1.1 Normal Execution {#normal-execution-145 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_CALL_CONNECTED once it has registered to > this event and an Envelope Event DownLoad Call Connected is > received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_CALL_CONNECTED once it has deregistered > from this event.
##### 6.3.3.11.1.2 Parameters error {#parameters-error-62 .H6}
No requirements.
##### 6.3.3.11.1.3 Context Errors {#context-errors-139 .H6}
No requirements.
##### 6.3.3.11.2 Test Suite Files {#test-suite-files-145 .H6}
> Test Script: FWK_APT_EDCC_1.scr
>
> Test Applet: FWK_APT_EDCC_1.java
>
> Load Script: FWK_APT_EDCC_1.ldr
>
> Clean-up Script: FWK_APT_EDCC_1.clr
>
> Parameter File: FWK_APT_EDCC _1.par
##### 6.3.3.11.3 Test Procedure {#test-procedure-145 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EVE | | | | | NT_EVENT_DOWNLOA | 2- Applet is | | | | D_CALL_CONNECTED | triggered. | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_CALL_CONNECTED | | | | | and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | event= | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_CALL_CONNECTED | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLOA | | | | | D_CALL_CONNECTED | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | event=EVE | 2- Applet is | | | | NT_EVENT_DOWNLOA | triggered | | | | D_CALL_CONNECTED | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-A call connected | | | | | event dowload is | | | | | sent to the SIM. | | | | | | | | | | An Envelope | | | | | formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_CALL_CONNECTED | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLOA | | | | | D_CALL_CONNECTED | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.11.4 Test Coverage {#test-coverage-142 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.12 EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED
Test Area Reference: FWK_APT_EDCD
##### 6.3.3.12.1 Conformance Requirement {#conformance-requirement-131 .H6}
##### 6.3.3.12.1.1 Normal Execution {#normal-execution-146 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED once it has registered > to this event and an Envelope Event DownLoad Call Disconnected is > received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED once it has > deregistered from this event.
##### 6.3.3.12.1.2 Parameters error {#parameters-error-63 .H6}
No requirements.
##### 6.3.3.12.1.3 Context Errors {#context-errors-140 .H6}
No requirements.
##### 6.3.3.12.2 Test Suite Files {#test-suite-files-146 .H6}
> Test Script: FWK_APT_EDCD_1.scr
>
> Test Applet: FWK_APT_EDCD_1.java
>
> Load Script: FWK_APT_EDCD_1.ldr
>
> Cleanup Script: FWK_APT_EDCD_1.clr
>
> Parameter File: FWK_APT_EDCD_1.par
##### 6.3.3.12.3 Test Procedure {#test-procedure-146 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | 2- Applet is | | | | CALL_DISCONNECTED | triggered. | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | Event=EVENT\ | | | | | _EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event= | 2- Applet is | | | | EVENT\ | triggered | | | | _EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-An Envelope | | | | | EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim. | | | | | | | | | | Event= | | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | | | | | CALL_DISCONNECTED | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.12.4 Test Coverage {#test-coverage-143 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.13 EVENT_EVENT_DOWNLOAD_LOCATION_STATUS
Test Area Reference: FWK_APT_EDLS
##### 6.3.3.13.1 Conformance Requirement {#conformance-requirement-132 .H6}
##### 6.3.3.13.1.1 Normal Execution {#normal-execution-147 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_LOCATION_STATUS once it has registered to > this event and an Envelope Event DownLoad Location Status is > received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_LOCATION_STATUS once it has deregistered > from this event.
##### 6.3.3.13.1.2 Parameters error {#parameters-error-64 .H6}
No requirements.
##### 6.3.3.13.1.3 Context Errors {#context-errors-141 .H6}
No requirements.
##### 6.3.3.13.2 Test Suite Files {#test-suite-files-147 .H6}
> Test Script: FWK_APT_EDLS_1.scr
>
> Test Applet: FWK_APT_EDLS_1.java
>
> Load Script: FWK_APT_EDLS_1.ldr
>
> Cleanup Script: FWK_APT_EDLS_1.clr
>
> Parameter File: FWK_APT_EDLS_1.par
##### 6.3.3.13.3 Test Procedure {#test-procedure-147 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EVEN | | | | | T_EVENT_DOWNLOAD | 2- Applet is | | | | _LOACTION_STATUS | triggered. | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _LOCATION_STATUS | | | | | and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | Event=EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _LOCATION_STATUS | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _LOCATION_STATUS | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event=EVEN | 2- Applet is | | | | T_EVENT_DOWNLOAD | triggered | | | | _LOCATION_STATUS | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-An Envelope | | | | | EVENT_DOWNLOAD | | | | | _LOCATION_STATUS | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVEN | | | | | T_EVENT_DOWNLOAD | | | | | _LOCATION_STATUS | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLOAD | | | | | _LOCATION_STATUS | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.13.4 Test Coverage {#test-coverage-144 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.14 EVENT_EVENT_DOWNLOAD_USER_ACTIVITY
Test Area Reference: FWK_APT_EDUA
##### 6.3.3.14.1 Conformance Requirement {#conformance-requirement-133 .H6}
##### 6.3.3.14.1.1 Normal Execution {#normal-execution-148 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_USER_ACTIVITY once it has registered to > this event and an Envelope Event DownLoad User Activity is > received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_USER_ACTIVITY once it has deregistered > from this event.
##### 6.3.3.14.1.2 Parameters error {#parameters-error-65 .H6}
No requirements.
##### 6.3.3.14.1.3 Context Errors {#context-errors-142 .H6}
No requirements.
##### 6.3.3.14.2 Test Suite Files {#test-suite-files-148 .H6}
> Test Script: FWK_APT_EDUA_1.scr
>
> Test Applet: FWK_APT_EDUA_1.java
>
> Load Script: FWK_APT_EDUA_1.ldr
>
> Cleanup Script: FWK_APT_EDUA_1.clr
>
> Parameter File: FWK_APT_EDUA_1.par
##### 6.3.3.14.3 Test Procedure {#test-procedure-148 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EV | | | | | ENT_EVENT_DOWNLO | 2- Applet is | | | | AD_USER_ACTIVITY | triggered | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EV | | | | | ENT_EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | Event= | | | | | EV | | | | | ENT_EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event= | 2- Applet is | | | | EV | triggered | | | | ENT_EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-An Envelope | | | | | EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EV | | | | | ENT_EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.14.4 Test Coverage {#test-coverage-145 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.15 EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE
Test Area Reference: FWK_APT_EDIS
##### 6.3.3.15.1 Conformance Requirement {#conformance-requirement-134 .H6}
##### 6.3.3.15.1.1 Normal Execution {#normal-execution-149 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE once it has > registered to this event and an Envelope Event DownLoad Idle > Screen Available is received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE once it has > deregistered from this event.
##### 6.3.3.15.1.2 Parameters error {#parameters-error-66 .H6}
No requirements.
##### 6.3.3.15.1.3 Context Errors {#context-errors-143 .H6}
No requirements.
##### 6.3.3.15.2 Test Suite Files {#test-suite-files-149 .H6}
> Test Script: FWK_APT_EDIS_1.scr
>
> Test Applet: FWK_APT_EDIS_1.java
>
> Load Script: FWK_APT_EDIS_1.ldr
>
> Cleanup Script: FWK_APT_EDIS_1.clr
>
> Parameter File: FWK_APT_EDIS_1.par
##### 6.3.3.15.3 Test Procedure {#test-procedure-149 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EVENT_EVEN | | | | | T_DOWNLOAD_IDLE\ | 2- Applet is | | | | _SCREEN_AVAILABLE | triggered | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_EVEN | | | | | T_DOWNLOAD_IDLE\ | | | | | _SCREEN_AVAILABLE | | | | | and to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | Event= | | | | | | | | | | EVENT_EVEN | | | | | T_DOWNLOAD_IDLE\ | | | | | _SCREEN_AVAILABLE | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVEN | | | | | T_DOWNLOAD_IDLE\ | | | | | _SCREEN_AVAILABLE | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event=EVENT_EVEN | 2- Applet is | | | | T_DOWNLOAD_IDLE\ | triggered | | | | _SCREEN_AVAILABLE | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-An Envelope | | | | | EVEN | | | | | T_DOWNLOAD_IDLE\ | | | | | _SCREEN_AVAILABLE | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVENT_EVEN | | | | | T_DOWNLOAD_IDLE\ | | | | | _SCREEN_AVAILABLE | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | EVEN | | | | | T_DOWNLOAD_IDLE\ | | | | | _SCREEN_AVAILABLE | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.15.4 Test Coverage {#test-coverage-146 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.16 EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS
Test Area Reference: FWK_APT_EDCR
##### 6.3.3.16.1 Conformance Requirement {#conformance-requirement-135 .H6}
##### 6.3.3.16.1.1 Normal Execution {#normal-execution-150 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS once it has > registered to this event and Envelope Event DownLoad Card Reader > Status is received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS once it has > deregistered from this event.
##### 6.3.3.16.1.2 Parameters error {#parameters-error-67 .H6}
No requirements.
##### 6.3.3.16.1.3 Context Errors {#context-errors-144 .H6}
No requirements.
##### 6.3.3.16.2 Test Suite Files {#test-suite-files-150 .H6}
> Test Script: FWK_APT_EDCR_1.scr
>
> Test Applet: FWK_APT_EDCR_1.java
>
> Load Script: FWK_APT_EDCR_1.ldr
>
> Cleanup Script: FWK_APT_EDCR_1.clr
>
> Parameter File: FWK_APT_EDCR_1.par
##### 6.3.3.16.3 Test Procedure {#test-procedure-150 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EVENT_E | | | | | VENT_DOWNLOAD_CA | 2- Applet is | | | | RD_READER_STATUS | triggered | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_E | | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | and to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | Event=EVENT_E | | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | E | | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event= | 2- Applet is | | | | EVENT_E | triggered | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 1-An Envelope | | | | | E | | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | is sent to the | | | | | SIM. | | | | | | | | | | An Envelope | | | | | formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVENT_E | | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with all the | | | | | facilities | | | | | supported | | | | | | | | | | 2-An Envelope | | | | | E | | | | | VENT_DOWNLOAD_CA | | | | | RD_READER_STATUS | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.16.4 Test Coverage {#test-coverage-147 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.17 EVENT_UNRECOGNIZED_ENVELOPE
Test Area Reference: FWK_APT_EUEV
##### 6.3.3.17.1 Conformance Requirement {#conformance-requirement-136 .H6}
##### 6.3.3.17.1.1 Normal Execution {#normal-execution-151 .H6}
  * CRRN1: The applet is triggered by the EVENT_UNRECOGNIZED_ENVELOPE > once it has registered to this event and an Unrecognized Envelope > is received.
  * CRRN2: The applet is not triggered by the > EVENT_UNRECOGNIZED_ENVELOPE once it has deregistered from this > event.
##### 6.3.3.17.1.2 Parameters error {#parameters-error-68 .H6}
No requirements.
##### 6.3.3.17.1.3 Context Errors {#context-errors-145 .H6}
No requirements.
##### 6.3.3.17.2 Test Suite Files {#test-suite-files-151 .H6}
> Test Script: FWK_APT_EUEN_1.scr
>
> Test Applet: FWK_APT_EUEN_1.java
>
> Load Script: FWK_APT_EUEN_1.ldr
>
> Cleanup Script: FWK_APT_EUEN_1.clr
>
> Parameter File: FWK_APT_EUEN_1.par
##### 6.3.3.17.3 Test Procedure {#test-procedure-151 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Method returns | | | | registration to | true | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | | | | | registered to the | | | | | | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | and to | | | | | EVENT_FORMMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | Event= | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | UNRE | | | | | COGNIZED_ENVELOPE | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event= | 2- Applet is | | | | EVENT_UNRE | triggered | | | | COGNIZED_ENVELOPE | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | 1-An Envelope | | | | | UNRE | | | | | COGNIZED_ENVELOPE | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | 2-An Envelope | | | | | UNRE | | | | | COGNIZED_ENVELOPE | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.17.4 Test Coverage {#test-coverage-148 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.18 EVENT_STATUS_COMMAND
Test Area Reference: FWK_APT_ESTC
##### 6.3.3.18.1 Conformance Requirement {#conformance-requirement-137 .H6}
##### 6.3.3.18.1.1 Normal Execution {#normal-execution-152 .H6}
  * CRRN1: The applet is triggered by the EVENT_STATUS_COMMAND once it > has registered to this event and a Status Command is received.
  * CRRN2: The applet is not triggered by the EVENT_STATUS_COMMAND > once it has deregistered from this event.
##### 6.3.3.18.1.2 Parameters error {#parameters-error-69 .H6}
No requirements.
##### 6.3.3.18.1.3 Context Errors {#context-errors-146 .H6}
No requirements.
##### 6.3.3.18.2 Test Suite Files {#test-suite-files-152 .H6}
> Test Script: FWK_APT_ESTC_1.scr
>
> Test Applet: FWK_APT_ESTC_1.java
>
> FWK_APT_ESTC_2.java
>
> FWK_APT_ESTC_3.java
>
> Load Script: FWK_APT_ESTC_1.ldr
>
> Cleanup Script: FWK_APT_ESTC_1.clr
>
> Parameter File: FWK_APT_ESTC_1.par
##### 6.3.3.18.3 Test Procedure {#test-procedure-152 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applets | 1- Applet1 is | | | | registration to | triggered. | | | | EVEN | | | | | T_STATUS_COMMAND | Applet1 finalizes | | | | and triggering | | | | | | 2- Applet2 is | | | | Applet1 is | triggered. | | | | registered to | | | | | EVEN | Applet2 finalizes | | | | T_STATUS_COMMAND | | | | | using the | 3- Applet3 is not | | | | | triggered | | | | req | | | | | uestPollInterval() | | | | | command. | | | | | | | | | | Applet2 is | | | | | registered to | | | | | EVEN | | | | | T_STATUS_COMMAND | | | | | using the | | | | | | | | | | Req | | | | | uestPollInterval() | | | | | command. | | | | | | | | | | Applet3 is | | | | | registered to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-A status command | | | | | is sent to SIM | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet | 1- Applet3 is | 2- A proactive | | | deregistration and | triggered. | command DISPLAY | | | registration of | | TEXT is sent and | | | the third applet | 3- Applet1 is | | | | to | triggered. | applet is | | | EVENT | | suspended until | | | _STATUS_COMMAND. | Applet1 finalizes | the terminal | | | | | response | | | The STF shall not | 4- Applet2 is | | | | reply busy to a | triggered. | 5- TERMINAL | | | call control | | RESPONSE of | | | envelope | Applet2 finalizes | DISPLAY TEXT is | | | | | sent to the SIM | | | 1-A formatted sms | Applet3 finalizes | | | | pp envelope is | | | | | sent to SIM | | | | | | | | | | Applet3 builds a | | | | | DISPLAY TEXT. | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | is called | | | | | | | | | | 3-A status command | | | | | is sent to SIM. | | | | | | | | | | requestPollInteval | | | | | with | | | | | POLL_NO_DURATION | | | | | is called | | | | | | | | | | requestPollInteval | | | | | with | | | | | POLL_NO_DURATION | | | | | is called | | | | | | | | | | req | | | | | uestPollInterval() | | | | | method is called. | | | +----+--------------------+--------------------+--------------------+ | 3 | Applet3 triggering | Applet3 is | | | | | triggered. | | | | Perform SIM | | | | | initialization | (Applet1 and | | | | with all the | Applet2 are not | | | | facilities | triggered) | | | | supported | | | | | | | | | | Status command is | | | | | sent to SIM. | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.18.4 Test Coverage {#test-coverage-149 .H6}
CR Number Test Case Number
* * *
CRRN1 1, 2, 3 CRRN2 3
#### 6.3.3.19 EVENT_FORMATTED_SMS_CB
Test Area Reference: FWK_APT_EFCB
##### 6.3.3.19.1 Conformance Requirement {#conformance-requirement-138 .H6}
##### 6.3.3.19.1.1 Normal Execution {#normal-execution-153 .H6}
  * CRRN1: The applet is triggered by the EVENT_FORMATTED_SMS_CB > once:
\- it has been registered to this event;
\- an envelope APDU carrying a Cell Broadcast Page, formatted according to
3GPP TS 23.048 [8], is received;
\- the toolkit applet to be triggered is registered with the corresponding TAR
in the CB page;
\- the security is verified.
  * CRRN2: The applet is not triggered by the EVENT_FORMATTED_SMS_CB > once it has deregistered from this event.
##### 6.3.3.19.1.2 Parameters error {#parameters-error-70 .H6}
No requirements.
##### 6.3.3.19.1.3 Context Errors {#context-errors-147 .H6}
No requirements.
##### 6.3.3.19.2 Test Suite Files {#test-suite-files-153 .H6}
> Test Script: FWK_APT_EFCB_1.scr
>
> Test Applet: FWK_APT_EFCB_1.java
>
> Load Script: FWK_APT_EFCB_1.ldr
>
> Cleanup Script: FWK_APT_EFCB_1.clr
>
> Parameter File: FWK_APT_EFCB_1.par
##### 6.3.3.19.3 Test Procedure {#test-procedure-153 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1-Applet is | | | | registration to | triggered | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | and | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 1-An Envelope | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_ | triggered | | | | FORMATTED_SMS_CB | | | | | | | | | | 1-A formatted SMS | | | | | CB envelope is | | | | | sent to the SIM. | | | | | | | | | | 2-An envelope | | | | | SMS-PP formatted | | | | | is sent to the SIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | 3-An Envelope | | | | | FORMATTED_SMS_CB | | | | | is sent to the SIM | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.19.4 Test Coverage {#test-coverage-150 .H6}
CR Number Test Case Number
* * *
CRRN1 (See note) 1, 2 CRRN2 2 NOTE: The security checks are not relevant to
the test designed in this test area; they will be checked in clause 6.3.6.
#### 6.3.3.20 EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION
Test Area Reference: FWK_APT_EDLG
##### 6.3.3.20.1 Conformance Requirement {#conformance-requirement-139 .H6}
##### 6.3.3.20.1.1 Normal Execution {#normal-execution-154 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION once it has registered > to this event and an Envelope Event DownLoad Language Selection is > received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION once it has > deregistered from this event.
##### 6.3.3.20.1.2 Parameters error {#parameters-error-71 .H6}
No requirements.
##### 6.3.3.20.1.3 Context Errors {#context-errors-148 .H6}
No requirements.
##### 6.3.3.20.2 Test Suite Files {#test-suite-files-154 .H6}
> Test Script: FWK_APT_EDLG_1.scr
>
> Test Applet: FWK_APT_EDLG_1.java
>
> Load Script: FWK_APT_EDLG_1.ldr
>
> Cleanup Script: FWK_APT_EDLG_1.clr
>
> Parameter File: FWK_APT_EDLG_1.par
##### 6.3.3.20.3 Test Procedure {#test-procedure-154 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1-Method returns | | | | registration to | true | | | | EVENT_ | | | | | EVENT_DOWNLOAD_L | 2- Applet is | | | | ANGUAGE_SELECTION | triggered | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_ | | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | and to | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | Event= | | | | | EVENT_ | | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event= | 2- Applet is | | | | EVENT_ | triggered | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with Profile | | | | | Download, SMS PP | | | | | Data Download, | | | | | Command Result and | | | | | Language Selection | | | | | facilities. | | | | | | | | | | 1-An Envelope | | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVENT_ | | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with Profile | | | | | Download, SMS PP | | | | | Data Download, | | | | | Command Result and | | | | | Language Selection | | | | | facilities. | | | | | | | | | | 2-An Envelope | | | | | EVENT_DOWNLOAD_L | | | | | ANGUAGE_SELECTION | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.20.4 Test Coverage {#test-coverage-151 .H6}
CR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.21 EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION
Test Area Reference: FWK_APT_EDBT
##### 6.3.3.21.1 Conformance Requirement {#conformance-requirement-140 .H6}
##### 6.3.3.21.1.1 Normal Execution {#normal-execution-155 .H6}
  * CRRN1: The applet is triggered by the > EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION once it has > registered to this event and an Envelope Event DownLoad Browser > Termination is received.
  * CRRN2: The applet is not triggered by the > EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION once it has > deregistered from this event.
##### 6.3.3.21.1.2 Parameters error {#parameters-error-72 .H6}
No requirements.
##### 6.3.3.21.1.3 Context Errors {#context-errors-149 .H6}
No requirements.
##### 6.3.3.21.2 Test Suite Files {#test-suite-files-155 .H6}
> Test Script: FWK_APT_EDBT_1.scr
>
> Test Applet: FWK_APT_EDBT_1.java
>
> Load Script: FWK_APT_EDBT_1.ldr
>
> Cleanup Script: FWK_APT_EDBT_1.clr
>
> Parameter File: FWK_APT_EDBT_1.par
##### 6.3.3.21.3 Test Procedure {#test-procedure-155 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1-Method returns | | | | registration to | true | | | | EVENT\ | | | | | _EVENT_DOWNLOAD_ | 2- Applet is | | | | BR | triggered | | | | OWSER_TERMINATION | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_E | | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | and to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | Event= | | | | | | | | | | EVENT_E | | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | | | | | | 1-Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | E | | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | Event= | 2- Applet is | | | | EVENT_E | triggered | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | | | | | | Toolkit | | | | | Registry. | | | | | clearEvent()method | | | | | is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with Profile | | | | | Download, SMS PP | | | | | Data Download, | | | | | Command Result and | | | | | Browser | | | | | Termination | | | | | facilities. | | | | | | | | | | 1-An Envelope | | | | | E | | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | is sent to the | | | | | SIM. | | | | | | | | | | a formatted sms pp | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | Event= | | | | | EVENT_E | | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | | | | | | Toolkit | | | | | R | | | | | egistry.setEvent() | | | | | method is called | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with Profile | | | | | Download, SMS PP | | | | | Data Download, | | | | | Command Result and | | | | | Browser | | | | | Termination | | | | | facilities. | | | | | | | | | | 2-An Envelope | | | | | E | | | | | VENT_DOWNLOAD_BR | | | | | OWSER_TERMINATION | | | | | is sent to the | | | | | SIM. | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.21.4 Test Coverage {#test-coverage-152 .H6}
CR Number Test Case Number
* * *
CRRN1 1, 2 CRRN2 2
#### 6.3.3.22 EVENT_FIRST_COMMAND_AFTER_SELECT
Test Area Reference: FWK_APT_EFCA
##### 6.3.3.22.1 Conformance Requirement {#conformance-requirement-141 .H6}
##### 6.3.3.22.1.1 Normal Execution {#normal-execution-156 .H6}
  * CRRN1: The applet is triggered by the > EVENT_FIRST_COMMAND_AFTER_SELECT once it has registered to > this event; Upon reception of the first command received by the > GSM application after it has been selected, or after the ATR if it > is the default application, and before the Status Word of the > processed command has been sent back by the GSM application, the > toolkit framework shall trigger all the toolkit applets registered > to this event.
  * CRRN2: The applet is not triggered by the > EVENT_FIRST_COMMAND_AFTER_SELECT once it has deregistered from > this event.
  * CRRN3: If the first command received by the GSM application is a > toolkit applet triggering command (e.g. TERMINAL PROFILE), the > toolkit applets registered on the > EVENT_FIRST_COMMAND_AFTER_SELECT event shall be triggered > first.
##### 6.3.3.22.2 Test Suite Files {#test-suite-files-156 .H6}
> Test Script: FWK_APT_EFCA_1.scr
>
> Test Applet: FWK_APT_EFCA_1.java
>
> FWK_APT_EFCA_2.java
>
> FWK_APT_EFCA_3.java
>
> FWK_APT_EFCA_4.java
>
> FWK_APT_EFCA_5.java
>
> Load Script: FWK_APT_EFCA_1.ldr
>
> Cleanup Script: FWK_APT_EFCA_1.clr
>
> Parameter File: FWK_APT_EFCA_1.par
##### 6.3.3.22.3 Test Procedure {#test-procedure-156 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applets | 1- Applet1 is | | | | registration to | triggered by | | | | EVENT_FIRST_COMM | EVENT_FIRST_COMM | | | | AND_AFTER_SELECT | AND_AFTER_SELECT | | | | and triggering | | | | | | Applet1 finalizes | | | | Applet1 is | | | | | registered to the | Applet2 is | | | | EVENT_FIRST_COMM | triggered by | | | | AND_AFTER_SELECT | EVENT\ | | | | | _PROFILE_DOWNLOAD | | | | Applet2 is | | | | | registered to the | Applet2 finalizes | | | | EVENT_ | | | | | PROFILE_DOWNLOAD. | Applet3 is not | | | | | triggered | | | | Applet3 is | | | | | registered to | 3-Applet3 is | | | | EVENT_FORMAT | triggered. | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-Terminal Profile | | | | | command is sent to | | | | | the SIM. | | | | | | | | | | Applet1 | | | | | deregisters from | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | | | | | | | | 2- Applet2 | | | | | deregisters from | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD. | | | | | | | | | | 3-Envelop | | | | | e(SMS-PP-DOWNLOAD) | | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 4-Applet3 calls | | | | | setEvent() on | | | | | event | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | +----+--------------------+--------------------+--------------------+ | 2 | Deregistered | 1-Applet3 is | | | | applets are not | triggered. | | | | triggered | | | | | | Applet1 and | | | | 1-Reset then | Applet2 are not | | | | Terminal Profile | triggered. | | | | command is sent to | | | | | the SIM | 2-Applet3 | | | | | finalizes. | | | | 2-Applet3 calls | | | | | setEvent() on | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD. | | | +----+--------------------+--------------------+--------------------+ | 3 | Install a 4^th^ | 1- Applet4 is | | | | applet registered | triggered by | | | | to | E | | | | EVENT_FIRST_COMM | VENT_FIRST_COMMA | | | | AND_AFTER_SELECT | ND_AFTER_SELECT. | | | | and | | | | | EVENT\ | Applet3 is | | | | _PROFILE_DOWNLOAD | triggered by | | | | | E | | | | Applet4 is | VENT_FIRST_COMMA | | | | installed, with | ND_AFTER_SELECT. | | | | the same priority | | | | | level as Applet3. | Applet4 is | | | | | triggered by | | | | 1-Reset then | EVENT_PROFILE | | | | Terminal Profile | DOWNLOAD. | | | | command is sent to | | | | | the SIM | Applet3 is | | | | | triggered by | | | | Delete all | EVENT_ | | | | applets. | PROFILE_DOWNLOAD. | | +----+--------------------+--------------------+--------------------+ | 4 | Check that the | 2- Applet 5 is | 3-The SETUP MENU | | | applet is | triggered | proactive command | | | triggered before | | is fetched. | | | the first SW is | | | | | sent. | | There is only one | | | | | item for Applet5. | | | 1-Install Applet | | | | | 5. | | | | | | | | | | Applet 5 is | | | | | registered with | | | | | two entries in the | | | | | menu entries list. | | | | | Applet5 is also | | | | | registered to | | | | | E | | | | | VENT_FIRST_COMMA | | | | | ND_AFTER_SELECT. | | | | | | | | | | 2-Reset and | | | | | TERMINAL PROFILE. | | | | | | | | | | 3-Applet disables | | | | | a menu entry. | | | +----+--------------------+--------------------+--------------------+
NOTE: Testing the triggering of an applet upon the first command after select
is not possible.
##### 6.3.3.22.4 Test Coverage {#test-coverage-153 .H6}
CR Number Test Case Number
* * *
CRRN1 1,2,3, 4 CRRN2 3 CRRN3 1, 4
#### 6.3.3.23 EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE
Test Area Reference: FWK_APT_EDDA
##### 6.3.3.23.1 Conformance Requirement {#conformance-requirement-142 .H6}
##### 6.3.3.23.1.1 Normal Execution {#normal-execution-157 .H6}
  * CRRN1: For EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE, the framework > shall only trigger the applet registered to this event with the > appropriate channel identifier.
  * CRRN2: The registration to the > EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE is effective once the > toolkit applet has issued a successful OPEN CHANNEL proactive > command, and valid till the first successful CLOSE CHANNEL or the > end of card session.
  * CRRN3: When a Toolkit Applet has sent an OPEN CHANNEL proactive > command and received a successful TERMINAL RESPONSE, the framework > shall register the received channel identifier for the calling > Toolkit Applet.
  * CRRN4: When a Toolkit Applet has sent a CLOSE CHANNEL proactive > command and received a successful TERMINAL RESPONSE, the framework > shall release the channel identifier contained in the command. A > successful TERMINAL RESPONSE means that the result of the > proactive command execution belongs to command performed category > (i.e. General Result =\'0x\').
##### 6.3.3.23.2 Test Suite Files {#test-suite-files-157 .H6}
> Test Script: FWK_APT_EDDA_1.scr
>
> Test Applet: FWK_APT_EDDA_1.java
>
> Load Script: FWK_APT_EDDA_1.ldr
>
> Cleanup Script: FWK_APT_EDDA_1.clr
>
> Parameter File: FWK_APT_EDDA_1.par
##### 6.3.3.23.3 Test Procedure {#test-procedure-157 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet | 1- Applet1 is | 6- OPEN CHANNEL | | | registration to | triggered by | proactive command | | | EVE | Unformatted SMS PP | is fetched. | | | NT_EVENT_DOWNLOA | envelope. | | | | D_DATA_AVAILABLE | | Unsuccessful | | | | 2- Applet1 | TERMINAL RESPONSE | | | Applet1 is | finalizes. | of OPEN CHANNEL is | | | registered to | | sent to the SIM. | | | Unformatted SMS PP | 3- Applet1 is not | | | | Envelope. | triggered. | 11- OPEN CHANNEL | | | | | proactive command | | | 1- Unformatted SMS | 4- Applet1 is | is fetched. | | | PP envelope is | triggered by | | | | sent to the SIM. | Unformatted SMS PP | Successful | | | | envelope. | TERMINAL RESPONSE | | | 2- Applet calls | | of OPEN CHANNEL is | | | setEvent() with | 7- Applet1 | sent to the SIM | | | the event | finalizes. | with Channel Id = | | | EVEN | | 01. | | | T_EVENT_DOWNLOAD | 8- Applet1 is not | | | | _DATA_AVAILABLE. | triggered. | | | | | | | | | 3- An envelope | 9- Applet1 is | | | | Event Download | triggered by | | | | Data Available is | EVENT_UNFORMAT | | | | sent to the SIM | TED_SMS_PP_ENV. | | | | | | | | | Channel Status = | 12- Applet1 | | | | 81 00 | finalizes. | | | | | | | | | 4- Unformatted SMS | | | | | PP envelope is | | | | | sent to the SIM. | | | | | | | | | | 5- Applet1 builds | | | | | a proactive | | | | | command OPEN | | | | | CHANNEL calling | | | | | Proac | | | | | tiveHandler.init() | | | | | method. | | | | | | | | | | 6- send() method | | | | | is called to | | | | | register to this | | | | | event. | | | | | | | | | | 8- An envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM | | | | | with Channel | | | | | Status = 01 00. | | | | | | | | | | 9- Unformatted SMS | | | | | PP envelope is | | | | | sent to the SIM. | | | | | | | | | | 10- Applet1 builds | | | | | a proactive | | | | | command OPEN | | | | | CHANNEL calling | | | | | Proac | | | | | tiveHandler.init() | | | | | method. | | | | | | | | | | 11- send() method | | | | | is called to | | | | | register to this | | | | | event. | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet triggering | 1- Applet1 is | | | | to | triggered. | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_DATA_AVAILABLE | | | | | | | | | | 1- An envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM | | | | | | | | | | Channel Status = | | | | | 81 00. | | | +----+--------------------+--------------------+--------------------+ | 3 | Applet | 0- Applet1 is | 1- OPEN CHANNEL | | | deregistration to | triggered. | proactive command | | | EVENT_EVENT_ | | is fetched. | | | DOWNLOAD_DATA_ | 3- Applet1 is | | | | AVAILABLE | triggered. | Successful | | | | | terminal response | | | 0- Unformatted SMS | 5- Applet1 | is sent, with | | | PP envelope is | finalizes. | channelId=02. | | | sent to the SIM. | | | | | | | 2- CLOSE CHANNEL | | | 1- Applet1 | | proactive command | | | initialises and | | is fetched. | | | sends an OPEN | | | | | CHANNEL proactive | | Unsuccessful | | | command. | | TERMINAL RESPONSE | | | | | of CLOSE CHANNEL | | | 2- Applet1 builds | | is sent to the | | | a CLOSE CHANNEL | | SIM. | | | Proactive Command | | | | | calling | | 4- CLOSE CHANNEL | | | ProactiveHandler. | | proactive command | | | initCloseChannel() | | is fetched. | | | and | | | | | Proac | | Successful | | | tiveHandler.send() | | TERMINAL RESPONSE | | | methods. | | of CLOSE CHANNEL | | | | | is sent to the SIM | | | 3- An envelope | | with Channel Id = | | | Event Download | | 02. | | | Data Available is | | | | | sent to the SIM. | | | | | | | | | | Channel Status = | | | | | 82 00 | | | | | | | | | | 4- Applet1 builds | | | | | a CLOSE CHANNEL | | | | | Proactive Command | | | | | calling | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | and | | | | | Proac | | | | | tiveHandler.send() | | | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 4 | Applet triggering | 1- Applet1 is not | | | | to | triggered. | | | | EVE | | | | | NT_EVENT_DOWNLOA | | | | | D_DATA_AVAILABLE | | | | | | | | | | 1- An envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM | | | | | | | | | | Channel Status = | | | | | 82 00. | | | +----+--------------------+--------------------+--------------------+ | 5 | Applet1 not | 3- returns true. | 1- OPEN CHANNEL | | | triggered after a | | proactive command | | | reset | 5- Applet1 is not | is fetched. | | | | triggered. | | | | 0- Applet1 is | | 2- Successful | | | triggered by an | | TERMINAL RESPONSE | | | unformatted SMS PP | | of OPEN CHANNEL is | | | Envelope | | sent to the SIM | | | | | with Channel Id = | | | 1- Applet1 builds | | 02. | | | a proactive | | | | | command OPEN | | | | | CHANNEL calling | | | | | Proac | | | | | tiveHandler.init() | | | | | method. | | | | | | | | | | 2- send() method | | | | | is called to | | | | | register to this | | | | | event. | | | | | | | | | | 3- isEventSet() | | | | | method is called. | | | | | | | | | | 4- Reset the card. | | | | | | | | | | 5- An envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM | | | | | | | | | | Channel Status = | | | | | 82 00. | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.23.4 Test Coverage {#test-coverage-154 .H6}
CR Number Test Case Number
* * *
CRRN1 2 CRRN2 1, 4, 5 CRRN3 1 CRRN4 3
#### 6.3.3.24 EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS
Test Area Reference: FWK_APT_EDCS
##### 6.3.3.24.1 Conformance Requirement {#conformance-requirement-143 .H6}
##### 6.3.3.24.1.1 Normal Execution {#normal-execution-158 .H6}
  * CRRN1: For EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS, the framework > shall only trigger the applet registered to this event with the > appropriate channel identifier.
  * CRRN2: The registration to the > EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS is effective once the > toolkit applet has issued a successful OPEN CHANNEL proactive > command, and valid till the first successful CLOSE CHANNEL or the > end of the card session.
  * CRRN3: When a Toolkit Applet has sent an OPEN CHANNEL proactive > command and received a successful TERMINAL RESPONSE, the framework > shall register the received channel identifier for the calling > Toolkit Applet.
  * CRRN4: When a Toolkit Applet has sent a CLOSE CHANNEL proactive > command and received a successful TERMINAL RESPONSE, the framework > shall release the channel identifier contained in the command. A > successful TERMINAL RESPONSE means that the result of the > proactive command execution belongs to command performed category > (i.e. General Result =\'0x\').
##### 6.3.3.24.2 Test Suite Files {#test-suite-files-158 .H6}
> Test Script: FWK_APT_EDCS_1.scr
>
> Test Applet: FWK_APT_EDCS_1.java
>
> Load Script: FWK_APT_EDCS_1.ldr
>
> Cleanup Script: FWK_APT_EDCS_1.clr
>
> Parameter File: FWK_APT_EDCS_1.par
##### 6.3.3.24.3 Test Procedure {#test-procedure-158 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet | 1- Applet1 is | 6- OPEN CHANNEL | | | registration to | triggered by | proactive command | | | EVE | Unformatted SMS PP | is fetched. | | | NT_EVENT_DOWNLOA | envelope | | | | D_CHANNEL_STATUS | | Unsuccessful | | | | 2- Applet1 | TERMINAL RESPONSE | | | Applet1 is | finalizes. | of OPEN CHANNEL is | | | registered to | | sent to the SIM. | | | Unformatted SMS PP | 3- Applet1 is not | | | | Envelope. | triggered. | 11- OPEN CHANNEL | | | | | proactive command | | | 1-Unformatted SMS | 4- Applet1 is | is fetched. | | | PP envelope is | triggered by | | | | sent to the SIM. | Unformatted SMS PP | Successful | | | | envelope. | TERMINAL RESPONSE | | | 2-The applet calls | | of OPEN CHANNEL is | | | setEvent() with | 7- Applet | sent to the SIM | | | EVEN | finalizes. | with Channel Id = | | | T_EVENT_DOWNLOAD | | 01. | | | _CHANNEL_STATUS. | 8- Applet1 is not | | | | | triggered. | | | | 3- An envelope | | | | | Event Download | 9- Applet1 is | | | | Channel Status is | triggered by | | | | sent to the SIM. | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV. | | | | Channel Status = | | | | | 81 00 | 12- Applet1 | | | | | finalizes. | | | | 4-Unformatted SMS | | | | | PP envelope is | | | | | sent to the SIM. | | | | | | | | | | 5- Applet1 builds | | | | | a proactive | | | | | command OPEN | | | | | CHANNEL calling | | | | | Proac | | | | | tiveHandler.init() | | | | | method. | | | | | | | | | | 6- send() method | | | | | is called to | | | | | register to this | | | | | event. | | | | | | | | | | 8- An envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM | | | | | with Channel | | | | | Status = 01 00. | | | | | | | | | | 9- Unformatted SMS | | | | | PP envelope is | | | | | sent to the SIM. | | | | | | | | | | 10- Applet1 builds | | | | | a proactive | | | | | command OPEN | | | | | CHANNEL calling | | | | | Proac | | | | | tiveHandler.init() | | | | | method. | | | | | | | | | | 11- send() method | | | | | is called to | | | | | register to this | | | | | event a second | | | | | time. | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet triggering | 1- Applet1 is | | | | to | triggered. | | | | EVENT_EVENT\ | | | | | _DOWNLOAD_CHANNEL | | | | | STATUS | | | | | | | | | | 1- An envelope | | | | | Event Download | | | | | Channel Status is | | | | | sent to the SIM. | | | | | | | | | | Channel Status = | | | | | 81 00 | | | +----+--------------------+--------------------+--------------------+ | 3 | Applet | 0- Applet1 is | OPEN CHANNEL | | | deregistration to | triggered. | proactive command | | | EVENT_EVENT_ | | is fetched. | | | DOWNLOAD_CHANNEL | 3- The applet is | | | | STATUS | triggered. | Successful | | | | | terminal response | | | 0- Unformatted SMS | 5- Applet1 | is sent, with | | | PP envelope is | finalizes. | channelId=02. | | | sent to the SIM. | | | | | | | 2-CLOSE CHANNEL | | | 1-Applet1 | | proactive command | | | initialises and | | is fetched. | | | sends an OPEN | | | | | CHANNEL proactive | | Unsuccessful | | | command. | | TERMINAL RESPONSE | | | | | of CLOSE CHANNEL | | | 2- Applet1 builds | | is sent to the | | | a CLOSE CHANNEL | | SIM. | | | Proactive Command | | | | | calling | | 4- CLOSE CHANNEL | | | ProactiveHandler. | | proactive command | | | initCloseChannel() | | is fetched. | | | and | | | | | Proac | | Successful | | | tiveHandler.send() | | TERMINAL RESPONSE | | | methods. | | of CLOSE CHANNEL | | | | | is sent to the SIM | | | 3-An envelope | | with Channel Id = | | | Event Download | | 02. | | | Channel Status is | | | | | sent to the SIM. | | | | | | | | | | Channel Status = | | | | | 82 00 | | | | | | | | | | 4- Applet1 builds | | | | | a Close Channel | | | | | Proactive Command | | | | | calling | | | | | ProactiveHandler. | | | | | initCloseChannel() | | | | | and | | | | | Proac | | | | | tiveHandler.send() | | | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 4 | Applet triggering | Applet1 is not | | | | to | triggered. | | | | EVENT_EVENT\ | | | | | _DOWNLOAD_CHANNEL | | | | | STATUS | | | | | | | | | | 1- An envelope | | | | | Event Download | | | | | Channel Status is | | | | | sent to the SIM. | | | | | | | | | | Channel Status = | | | | | 82 00 | | | +----+--------------------+--------------------+--------------------+ | 5 | Applet1 not | 3- returns true. | 1- OPEN CHANNEL | | | triggered after a | | proactive command | | | reset | 5- Applet1 is not | is fetched. | | | | triggered. | | | | 0- Applet1 is | | 2- Successful | | | triggered by an | | TERMINAL RESPONSE | | | unformatted SMS PP | | of OPEN CHANNEL is | | | Envelope. | | sent to the SIM | | | | | with Channel Id = | | | 1- Applet1 builds | | 02. | | | a proactive | | | | | command OPEN | | | | | CHANNEL calling | | | | | Proac | | | | | tiveHandler.init() | | | | | method. | | | | | | | | | | 2- send() method | | | | | is called to | | | | | register to this | | | | | event. | | | | | | | | | | 3- isEventSet() | | | | | method is called. | | | | | | | | | | 4- Reset the card. | | | | | | | | | | 5- An envelope | | | | | Event Download | | | | | Data Available is | | | | | sent to the SIM | | | | | | | | | | Channel Status = | | | | | 82 00. | | | +----+--------------------+--------------------+--------------------+
##### 6.3.3.24.4 Test Coverage {#test-coverage-155 .H6}
CR Number Test Case Number
* * *
CRRN1 2 CRRN2 1, 4, 5 CRRN3 1 CRRN4 3
#### 6.3.3.25 EVENT_FORMATTED_SMS_PP_UPD
Test Area Reference: FWK_APT_EFSU
##### 6.3.3.25.1 Conformance Requirement {#conformance-requirement-144 .H6}
##### 6.3.3.25.1.1 Normal Execution {#normal-execution-159 .H6}
  * CRRN1: The applet is triggered by the EVENT_FORMATTED_SMS_PP_UPD > once:
  * it has been registered to this event,
  * a Short Message Point to Point (Single or Concatenated) is received > by Update Record EFsms APDU(s) and is formatted according to TS > 23.048 [8],
  * the toolkit applet to be triggered is registered with the > corresponding TAR in the SMS TPDU,
  * CRRN2: The applets are not triggered by the > EVENT_FORMATTED_SMS_PP_UPD once it has deregistered from this > event.
##### 6.3.3.25.2 Test Suite Files {#test-suite-files-159 .H6}
> Test Script: FWK_APT_EFSU_1.scr
>
> Test Applet: FWK_APT_EFSU_1.java
>
> Load Script: FWK_APT_EFSU_1.ldr
>
> Cleanup Script: FWK_APT_EFSU_1.clr
>
> Parameter File: FWK_APT_EFSU_1.par
##### 6.3.3.25.3 Test Procedure {#test-procedure-159 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- The method | | | | registration to | returns true. | | | | EVENT | | | | | FORMA | 2- Applet is | | | | TTED_SMS_PP_UPD | triggered. | | | | and triggering | | | | | | 3- Applet is | | | | Applet is | triggered on | | | | registered to | reception of the | | | | EVENT_FORMA | last concatenated | | | | TTED_SMS_PP_UPD | SMS | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1. Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Single and | | | | | Formatted is | | | | | received by Update | | | | | Record EFsms APDU. | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Concatenated | | | | | Formatted is | | | | | received by Update | | | | | Record EFsms | | | | | APDU(s) (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_FORMA | triggered | | | | TTED_SMS_PP_UPD | | | | | | 4- Applet is | | | | 1. Short Message | triggered on | | | | Point to Point | reception of the | | | | Single and | last concatenated | | | | Formatted is | SMS. | | | | received by Update | | | | | Record EFsms APDU. | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Formatted is | | | | | received by Update | | | | | Record EFsms | | | | | APDU(s). (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Single and | | | | | Formatted is | | | | | received by Update | | | | | Record EFsms APDU. | | | | | | | | | | 4. Short Message | | | | | Point to Point | | | | | Concatenated | | | | | Formatted is | | | | | received by Update | | | | | Record EFsms | | | | | APDU(s). (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.25.4 Test Coverage {#test-coverage-156 .H6}
CRR Number Test Case Number
* * *
CRRN1 (See note) 1,2 CRRN2 2
NOTE: The security checks are not relevant to the test designed in this test
area; they will be checked in the \"Framework Security Management\" clause.
#### 6.3.3.26 EVENT_UNFORMATTED_SMS_PP_UPD
Test Area Reference: FWK_APT_EUSU
##### 6.3.3.26.1 Conformance Requirement {#conformance-requirement-145 .H6}
##### 6.3.3.26.1.1 Normal Execution {#normal-execution-160 .H6}
  * CRRN1: The applets registers are triggered by the > EVENT_UNFORMATTED_SMS_PP_UPD once a Short Message Point to > Point (Single or Concatenated) is received by Update Record EFsms > APDU(s) and is unformatted.
  * CRRN2: The applets are not triggered by the > EVENT_UNFORMATTED_SMS_PP_UPD once it has deregistered from > this event.
##### 6.3.3.26.2 Test Suite Files {#test-suite-files-160 .H6}
> Test Script: FWK_APT_EUSU_1.scr
>
> Test Applet: FWK_APT_EUSU_1.java
>
> Load Script: FWK_APT_EUSU_1.ldr
>
> Cleanup Script: FWK_APT_EUSU_1.clr
>
> Parameter File: FWK_APT_EUSU_1.par
##### 6.3.3.26.3 Test Procedure {#test-procedure-160 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Applet | 1- Applet is not | | | | registration to | triggered | | | | EVENT | | | | | UNFORMA | 2- Applet is | | | | TTED_SMS_PP_UPD | triggered. | | | | and triggering | | | | | | 3- Applet is | | | | Applet is | triggered on | | | | registered to | reception of the | | | | EVENT_UNFORMA | last concatenated | | | | TTED_SMS_PP_UPD | SMS. | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1. Toolkit | | | | | Reg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Single and | | | | | Unformatted is | | | | | received by Update | | | | | Record EFsms APDU | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Unformatted is | | | | | received by Update | | | | | Record EFsms APDU | | | | | (The Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered. | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_UNFORMA | triggered | | | | TTED_SMS_PP_UPD | | | | | | 4- Applet is | | | | 1. Short Message | triggered on | | | | Point to Point | reception of the | | | | Single and | last concatenated | | | | Unformatted is | SMS | | | | received by Update | | | | | Record EFsms APDU | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Unformatted is | | | | | received by Update | | | | | Record EFsms | | | | | APDU(s) (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the sim | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Single and | | | | | Unformatted is | | | | | received by Update | | | | | Record EFsms APDU | | | | | | | | | | 4. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Unformatted is | | | | | received by Update | | | | | Record EFsms | | | | | APDU(s) (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
##### 6.3.3.26.4 Test Coverage {#test-coverage-157 .H6}
CRR Number Test Case Number
* * *
CRRN1 1,2 CRRN2 2
### 6.3.4 Proactive Command Sending by the STF
#### 6.3.4.1 System Proactive Commands
Test Area Reference: FWK_PCS_SPCO
##### 6.3.4.1.1 Conformance Requirements {#conformance-requirements-16 .H6}
##### 6.3.4.1.1.1 Normal Execution {#normal-execution-161 .H6}
  * CRRN1: When a toolkit applet changes a menu entry of its registry > object, the SIM Toolkit Framework shall dynamically* update the > menu stored in the ME during the current card session
  * CRRN2: The STF shall use the data of the EFsume file when issuing > the SET UP MENU proactive command.
  * CRRN3: For all EVENT_EVENT_DOWNLOAD __*_ : When a toolkit applet > changes one or more of these requested events of its registry > object, the STF shall dynamically* update the event list stored > in the ME during the current card session by SET UP EVENT LIST > proactive command.
NOTE: *The STF shall send its system proactive command as soon as no proactive
session is pending and all the applets registered to the current events have
been triggered and have returned from the processToolkit method invocation.
##### 6.3.4.1.1.2 Parameters error {#parameters-error-73 .H6}
No requirements.
##### 6.3.4.1.1.3 Context Errors {#context-errors-150 .H6}
No requirements.
##### 6.3.4.1.2 Test Suite Files {#test-suite-files-161 .H6}
Test Script: FWK_PCS_SPCO_1.scr
Test Applet: FWK_PCS_SPCO_1.java
Load Script: FWK_PCS_SPCO_1.ldr
Cleanup Script: FWK_PCS_SPCO_1.clr
Parameter File: FWK_PCS_SPCO_1.par
##### 6.3.4.1.3 Test Procedure {#test-procedure-161 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Install Applet 1, | | setEventList | | | Registered to the | | proactive command | | | EVENT_EVENT_ | | | | | DOWNLOAD_MT_CALL | | **[Event list]= | | | and | | \'19020003\'** or | | | EVENT\ | | **\'99020003\'** | | | _EVENT_DOWNLOAD_ | | | | | LOCATION_STATUS | | | | | | | | | | Perform SIM | | | | | initialization | | | | | with EVENT | | | | | DOWNLOAD | | | | | facilities | | | | | supported | | | +----+--------------------+--------------------+--------------------+ | 2 | Trigger the applet | | 1. DISPLAY TEXT | | | by ENVELOPE | | Proactive command | | | (S | | | | | MS_FORMATTED_PP) | | 2. SET UP EVENT | | | command | | LIST Proactive | | | | | command | | | Clear the events | | | | | and build a | | [C | | | display text | | ommandQualifier]= | | | command | | 00h | +----+--------------------+--------------------+--------------------+
##### 6.3.4.1.4 Test Coverage {#test-coverage-158 .H6}
+------------+------------------------+ | CRR number | Test case number | +============+========================+ | N1 | see: | | | | | | clause6.2.9.2, CRRN1, | | | | | | clause 6.2.9.4, CRRN3, | | | | | | clause 6.2.9.5 CRRN4, | | | | | | clause 6.2.9.8 CRRN1 | +------------+------------------------+ | N2 | see: | | | | | | clause 6.2.9.2 CRRN1, | | | | | | clause 6.2.9.8 CRRN1 | +------------+------------------------+ | N3 | 1,2 | +------------+------------------------+
#### 6.3.4.2 Interaction with GSM commands
Test Area Reference: FWK_PCS_IGCO
##### 6.3.4.2.1 Conformance Requirements {#conformance-requirements-17 .H6}
##### 6.3.4.2.1.1 Normal Execution {#normal-execution-162 .H6}
  * CRRN1: The STF shall process a GSM command even when a proactive > command is pending (before and after the FETCH command until the > terminal response). The STF shall answer with the SW1 and SW2 > described in 3GPP TS 51.011 [3] and 3GPP TS 51.014 [16].
##### 6.3.4.2.1.2 Parameters error {#parameters-error-74 .H6}
No requirements.
##### 6.3.4.2.1.3 Context Errors {#context-errors-151 .H6}
No requirements.
##### 6.3.4.2.2 Test Suite Files {#test-suite-files-162 .H6}
Test Script: FWK_PCS_IGCO_1.scr
Test Applet: FWK_PCS_IGCO_1.java
Load Script: FWK_PCS_IGCO_1.ldr
Cleanup Script: FWK_PCS_IGCO_1.clr
Parameter File: FWK_PCS_IGCO_1.par
##### 6.3.4.2.3 Test Procedure {#test-procedure-162 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Interaction with | | 1- 91xx | | | GSM Commands after | | | | | TERMINAL PROFILE | | 2- 9Fxx | | | in connection with | | | | | FETCH and TERMINAL | | 3- 91xx | | | RESPONSE | | | | | | | 4- 9404 | | | Applet is | | | | | registered to Menu | | 5- Proactive | | | Selection | | Command: SETUP | | | | | MENU | | | RST | | | | | | | 6- 9Fxx | | | TERMINAL PROFILE | | | | | | | 7- 9000 | | | (Profile: supports | | | | | all facilities | | 8- 9000 | | | except: SET UP | | | | | EVENT LIST, POLL | | | | | INTERVAL and | | | | | POLLING OFF) | | | | | | | | | | 1- System issues a | | | | | proactive command | | | | | SETUP_MENU | | | | | | | | | | 2- SELECT MF | | | | | | | | | | 3- GET RESPONSE (6 | | | | | Bytes) | | | | | | | | | | 4- Failed SELECT | | | | | File | | | | | | | | | | 5- FETCH | | | | | | | | | | 6- SELECT MF | | | | | | | | | | 7- GET RESPONSE (6 | | | | | Bytes) | | | | | | | | | | 8- TERMINAL | | | | | RESPONSE | | | +----+--------------------+--------------------+--------------------+ | 2 | Interaction with | | 1- 9FXX | | | GSM Commands after | | | | | | | 2- 91XX | | | ENVELOPE (MENU | | | | | SELECTION) | | 3- 9404 | | | | | | | | in connection with | | 4- Proactive | | | FETCH and TERMINAL | | Command: DISPLAY | | | RESPONSE | | TEXT | | | | | | | | Menu Entry ID = | | 5- 9FXX | | | 0x01 | | | | | | | 6- 9000 | | | 1- SELECT MF | | | | | | | 7- 9000 | | | 2- GET RESPONSE (6 | | | | | Bytes) | | | | | | | | | | 3- Failed SELECT | | | | | File | | | | | | | | | | 4- FETCH | | | | | | | | | | 5- SELECT MF | | | | | | | | | | 6- GET RESPONSE (6 | | | | | Bytes) | | | | | | | | | | 7- TERMINAL | | | | | RESPONSE | | | +----+--------------------+--------------------+--------------------+ | 3 | **Interaction with | | 1- 9FXX | | | GSM Commands after | | | | | TERMINAL RESPONSE | | 2- 91XX | | | in proactive | | | | | command session in | | 3- Proactive | | | connection with | | Command: DISPLAY | | | FETCH and TERMINAL | | TEXT | | | RESPONSE** | | | | | | | 4- 9FXX | | | Menu Entry ID = | | | | | 0x02 | | 5- 9000 | | | | | | | | 1- SELECT MF | | 6- 9404 | | | | | | | | 2- GET RESPONSE (6 | | 7- 9000 | | | Bytes) | | | | | | | 8- 9FXX | | | 3- FETCH | | | | | | | 9- 91XX | | | 4- SELECT MF | | | | | | | 10-9404 | | | 5- GET RESPONSE (6 | | | | | Bytes) | | 11-Proactive | | | | | Command: DISPLAY | | | 6- Failed SELECT | | TEXT | | | File | | | | | | | 12-9FXX | | | 7- TERMINAL | | | | | RESPONSE | | 13-9000 | | | | | | | | 8- SELECT MF | | 14-9000 | | | | | | | | 9- GET RESPONSE (6 | | | | | Bytes) | | | | | | | | | | 10-Failed SELECT | | | | | File | | | | | | | | | | 11-FETCH | | | | | | | | | | 12-SELECT MF | | | | | | | | | | 13-GET RESPONSE (6 | | | | | Bytes) | | | | | | | | | | 14-TERMINAL | | | | | RESPONSE | | | +----+--------------------+--------------------+--------------------+
##### 6.3.4.2.4 Test Coverage {#test-coverage-159 .H6}
CRR number Test case number
* * *
N1 1, 2, 3
#### 6.3.4.3 Proactive Command Control
Test Area Reference: FWK_PCS_PCCO
##### 6.3.4.1.1 Conformance Requirements {#conformance-requirements-18 .H6}
##### 6.3.4.1.1.1 Normal Execution {#normal-execution-163 .H6}
  * CRRN1: The SIM Toolkit Framework shall prevent the toolkit applet to > issue the following proactive commands: SET UP MENU, SET UP EVENT > LIST, POLL INTERVAL, POLLING OFF. If an applet attempts to issue > such a command, the SIM Toolkit Framework shall throw an > exception.
  * CRRN2: The SIM Toolkit Framework shall prevent a toolkit applet to > issue a TIMER MANAGEMENT proactive command using a timer > identifier, which is not allocated to it. If an applet attempts to > issue such a command, the SIM Toolkit Framework shall throw an > exception.
  * CRRN3: The SIM Toolkit Framework shall prevent a toolkit applet to > issue a SEND DATA, RECEIVE DATA and CLOSE CHANNEL proactive > commands using a channel identifier, which is not allocated to it. > If an applet attempts to issue such a command the SIM Toolkit > Framework shall throw an exception.
  * CRRN4: The SIM Toolkit Framework shall prevent a toolkit applet to > issue an OPEN CHANNEL proactive command if it exceeds the maximum > number of channel allocated to this applet. If an applet attempts > to issue such a command the SIM Toolkit Framework shall throw an > exception.
  * CRRN5: The proactive command is sent to the ME as defined and constructed by the toolkit applet without any check of the SIM Toolkit Framework.
  * CRRN6: The SIM Toolkit Framework cannot guarantee that if the SET UP IDLE MODE TEXT proactive command is used by a toolkit applet, another toolkit applet will not overwrite this text at a later stage.
##### 6.3.4.1.2 Test Suite Files {#test-suite-files-163 .H6}
Test Script: FWK_PCS_PCCO_1.scr
Test Applet: FWK_PCS_PCCO_1.java
FWK_PCS_PCCO_2.java
FWK_PCS_PCCO_3.java
Load Script: FWK_PCS_PCCO_1.ldr
Cleanup Script: FWK_PCS_PCCO_1.clr
Parameter File: FWK_PCS_PCCO_1.par
##### 6.3.4.1.3 Test Procedure {#test-procedure-163 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 0 | Applets | | | | | installation | | | | | | | | | | Applet1 is | | | | | installed with 4 | | | | | timers maximum, 0 | | | | | channel maximum | | | | | and 1 menu. | | | | | | | | | | Applet2 is | | | | | installed with 8 | | | | | timers maximum, 3 | | | | | channels maximum. | | | | | | | | | | Applet3 is | | | | | installed with 1 | | | | | channel maximum. | | | +----+--------------------+--------------------+--------------------+ | 1 | **STK Proactive | 1- Applet1 is | 1- 90 00 (no | | | Commands** | triggered | proactive command | | | | | is sent) | | | 1- Send a | 2- | | | | formatted envelope | COM | | | | with the TAR of | MAND_NOT_ALLOWED | | | | Applet1 | toolkit exception | | | | | is thrown | | | | 2- Applet1 builds | | | | | and sends a SET UP | 3- | | | | MENU proactive | COM | | | | command | MAND_NOT_ALLOWED | | | | | toolkit exception | | | | 3- Applet1 builds | is thrown | | | | and sends a SET UP | | | | | EVENT LIST | 4- | | | | proactive command | COM | | | | | MAND_NOT_ALLOWED | | | | 4- Applet1 builds | toolkit exception | | | | and sends a POLL | is thrown | | | | INTERVAL proactive | | | | | command | 5- | | | | | COM | | | | 5- Applet1 builds | MAND_NOT_ALLOWED | | | | and sends a | toolkit exception | | | | POLLING OFF | is thrown | | | | proactive command | | | +----+--------------------+--------------------+--------------------+ | 2 | **TIMER MANAGEMENT | 1- Applet2 is | 8- 3 TIMER | | | Proactive | triggered | MANAGEMENT | | | command** | | proactive commands | | | | 2- No exception is | are fetched | | | 1- Send a | thrown | | | | formatted envelope | | 9- The Status word | | | with the TAR of | 3- Applet1 is | of the last | | | Applet2 | triggered | previous Terminal | | | | | Response is 90 00 | | | 2- Applet2 | 4- No exception is | (no more proactive | | | allocates 8 timers | thrown | command is sent) | | | by calling | | | | | allocateTimer() | 5- Applet2 is | | | | method and release | triggered | | | | the 3 timers from | | | | | id 1 to 3. | 6- No exception is | | | | | thrown | | | | 3- Send a | | | | | formatted envelope | 7- Applet1 is | | | | with the TAR of | triggered | | | | Applet1 | | | | | | 8- No exception is | | | | 4- Applet1 | thrown | | | | allocates 3 timers | | | | | (Id 1 to 3) by | 9- | | | | calling | COM | | | | allocateTimer() | MAND_NOT_ALLOWED | | | | method 3 times | toolkit exception | | | | | is thrown | | | | 5- Send a | | | | | formatted envelope | | | | | with the TAR of | | | | | Applet2 | | | | | | | | | | 6- Applet2 | | | | | releases timers of | | | | | Id 4 to 7 | | | | | | | | | | 7- Send a | | | | | formatted envelope | | | | | with the TAR of | | | | | Applet1 | | | | | | | | | | 8- For each of the | | | | | 3 timers allocated | | | | | by Applet1 (Id 1to | | | | | 3) a TIMER | | | | | MANAGEMENT | | | | | proactive session | | | | | is performed | | | | | | | | | | 9- For other | | | | | timers (Id 4 to | | | | | 8), Applet1 builds | | | | | and sends a TIMER | | | | | MANAGEMENT | | | | | proactive command | | | +----+--------------------+--------------------+--------------------+ | 3 | **No Channel | 1- Applet1 is | 1- 90 00 (no | | | allowed** | triggered | proactive command | | | | | is sent) | | | 1- Send a | 2- | | | | formatted envelope | COM | | | | with the TAR of | MAND_NOT_ALLOWED | | | | Applet1 | toolkit exception | | | | | is thrown | | | | 2- Applet1 builds | | | | | and sends a CSD | 3- | | | | OPEN CHANNEL | COM | | | | proactive command | MAND_NOT_ALLOWED | | | | | toolkit exception | | | | 3- Applet1 builds | is thrown | | | | and sends a GPRS | | | | | OPEN CHANNEL | 4- | | | | proactive command | COM | | | | | MAND_NOT_ALLOWED | | | | 4Applet1 builds | toolkit exception | | | | and sends a SEND | is thrown | | | | DATA proactive | | | | | command | 5- | | | | | COM | | | | 5- Applet1 builds | MAND_NOT_ALLOWED | | | | and sends a | toolkit exception | | | | RECEIVE DATA | is thrown | | | | proactive command | | | | | | 6- | | | | 6- Applet1 builds | COM | | | | and sends a CLOSE | MAND_NOT_ALLOWED | | | | CHANNEL proactive | toolkit exception | | | | command | is thrown | | +----+--------------------+--------------------+--------------------+ | 4 | **4 Channels | 1- Applet3 is | > 2- 91 1C | | | allowed** | triggered | > | | | | | > 3- OPEN CHANNEL | | | 1- Send a | 2- No exception is | > proactive | | | formatted envelope | thrown | > | | | with the TAR of | | > 5- 91 1C | | | Applet3 | 4- Applet2 is | > | | | | triggered | > 6- OPEN CHANNEL | | | 2- Applet3 builds | | > proactive | | | and sends a CSD | 5- No exception is | > command is | | | OPEN CHANNEL | thrown | > fetched | | | proactive command | | > | | | | 7- No exception is | > 7- 91 17 | | | 3- Send a Fetch | thrown | > | | | and Terminal | | > 8- OPEN CHANNEL | | | Response OK on | 9- | > proactive | | | channel 7 | COM | > command is | | | | MAND_NOT_ALLOWED | > fetched, SW = 91 | | | 4- Send a | toolkit exception | > 1C on the | | | formatted envelope | is thrown | > Terminal | | | with the TAR of | | > Response | | | Applet2 | 10- | > | | | | COM | > 13- OPEN CHANNEL | | | 5- Applet2 builds | MAND_NOT_ALLOWED | > proactive | | | and sends a CSD | toolkit exception | > command is | | | OPEN CHANNEL | is thrown | > fetched | | | proactive command | | | | | | 11- | 14- 90 00 expected | | | 6- Send a Fetch | COM | to the previous | | | and Terminal | MAND_NOT_ALLOWED | Terminal Response | | | Response OK on | toolkit exception | (no proactive | | | channel 1 | is thrown | command is sent) | | | | | | | | 7- Applet2 builds | 12- No exception | | | | and sends a GPRS | is thrown | | | | OPEN CHANNEL | | | | | proactive command | 14- | | | | | COM | | | | 8- Send Fetch and | MAND_NOT_ALLOWED | | | | Terminal Response | toolkit exception | | | | OK on channel 2 | is thrown | | | | | | | | | 9- For each | | | | | channel id from 3 | | | | | to 7, Applet2 | | | | | builds and sends a | | | | | SEND DATA | | | | | proactive command | | | | | | | | | | 10- For each | | | | | channel id from 3 | | | | | to 7, Applet2 | | | | | builds and sends a | | | | | RECEIVE DATA | | | | | proactive command | | | | | | | | | | 11- For each | | | | | channel id from 3 | | | | | to 7, Applet2 | | | | | builds and sends a | | | | | CLOSE CHANNEL | | | | | proactive command | | | | | | | | | | 12- Applet2 builds | | | | | and sends a CSD | | | | | OPEN CHANNEL | | | | | proactive command | | | | | | | | | | 13- Fetch and | | | | | Terminal Response | | | | | OK on channel 3 | | | | | | | | | | 14- Applet2 builds | | | | | and sends an OPEN | | | | | CHANNEL proactive | | | | | command | | | +----+--------------------+--------------------+--------------------+ | 5 | **Unknown | 1- Applet1 is | > 2- 91 15 | | | proactive | triggered | > | | | command** | | > 3- Command | | | | | > details TLV, | | | 1- Send an | | > Device | | | envelope menu | | > Identities TLV | | | selection with the | | > and unknown TLV | | | item id of Applet1 | | > including 8 null | | | | | > bytes are | | | **2- Applet1 build | | > fetched. | | | an unknown | | | | | proactive command | | | | | of 8 null bytes | | | | | and send it** | | | | | | | | | | **3- Fetch and | | | | | terminal response | | | | | OK** | | | +----+--------------------+--------------------+--------------------+
##### 6.3.4.1.4 Test Coverage {#test-coverage-160 .H6}
CRR number Test case number
* * *
N1 1 N2 2 N3 3,4 N4 3,4 N5 5 N6 Not testable
### 6.3.5 Exception Handling
#### 6.3.5.1 Hide Exceptions from the ME
Test Area Reference: FWK_EXH_HEME
##### 6.3.5.1.1 Conformance Requirements {#conformance-requirements-19 .H6}
##### 6.3.5.1.1.1 Normal Execution {#normal-execution-164 .H6}
  * CRRN1: A toolkit applet may throw an exception, but this error will > not be sent to the ME.
NOTE: Because the behaviour of the SIM is not exactly defined for the above
CRRN, there are no tests defined here yet.
##### 6.3.5.1.1.2 Parameters error {#parameters-error-75 .H6}
No requirements.
##### 6.3.5.1.1.3 Context Errors {#context-errors-152 .H6}
No requirements.
#### 6.3.5.2 Interaction with Multiple Triggering
Test Area Reference: FWK_EXH_IMTG
##### 6.3.5.2.1 Conformance Requirements {#conformance-requirements-20 .H6}
##### 6.3.5.2.1.1 Normal Execution: {#normal-execution-165 .H6}
  * CRRN1: An exception thrown by a toolkit applet, will not influence > toolkit applets registered to the same event.
##### 6.3.5.2.1.2 Parameters error {#parameters-error-76 .H6}
No requirements.
##### 6.3.5.2.1.3 Context Errors {#context-errors-153 .H6}
No requirements.
##### 6.3.5.2.2 Test Suite Files {#test-suite-files-164 .H6}
Test Script: FWK_EXH_IMTG_1.scr
Test Applet: FWK_EXH_IMTG_1.java
Load Script: FWK_EXH_IMTG_1.ldr
Cleanup Script: FWK_EXH_IMTG_1.clr
Parameter File: FWK_EXH_IMTG_1.par
##### 6.3.5.2.3 Test Procedure {#test-procedure-164 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 0 | Load/install 2 | | | | | toolkit applets | | | | | registered to | | | | | EVENT | | | | | _STATUS_COMMAND, | | | | | EVENT_ | | | | | PROFILE_DOWNLOAD, | | | | | EVENT_UNREC | | | | | OGNIZED_ENVELOPE, | | | | | EVENT_EVENT_D | | | | | OWNLOAD_MT_CALL, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | applet1: Priority= | | | | | 0x01, | | | | | | | | | | applet2: Priority= | | | | | 0x02, | | | | | | | | | | (i.e. applet1 is | | | | | triggered before | | | | | applet2) | | | +----+--------------------+--------------------+------------------+ | 1 | Status_Command is | 1- Applet1 is | | | | sent | triggered | | | | | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 2 | Profile_Download | 1- Applet1 is | | | | is sent | triggered | | | | | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 3 | UNRE | 1- Applet1 is | | | | COGNIZED_Envelope | triggered | | | | is sent | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 4 | Event_ | 1- Applet1 is | | | | Download_MT_Call | triggered | | | | is sent | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 5 | Unforma | 1- Applet1 is | | | | tted_SMS_PP_Env | triggered | | | | is sent | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 6 | Unforma | 1- Applet1 is | | | | tted_SMS_PP_Upd | triggered | | | | is sent | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 7 | Un | 1- Applet1 is | | | | formatted_SMS_CB | triggered | | | | is sent | | | | | | : | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+
##### 6.3.5.2.4 Test Coverage {#test-coverage-161 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3, 4, 5, 6, 7
### 6.3.6 Framework Security Management
##### Security Parameters {#security-parameters-1 .H6}
The table that follows contains the security parameters that shall be used
when the 3GPP TS 23.048 [8] security is required in the test cases developed
in the current clause.
Parameter Value in hexadecimal
* * *
KIC Value as described in the TS 23.048[8] (recommended value: 15) KID Value
as described in the TS 23.048[8] (recommended value: 15) CNTR 00 00 00 00 01
Key for ciphering Corresponding to KIC (recommended value: 01 41 42 7F DA E8
91 A7 02 41 42 7F DA E8 91 A7) Key for RC/CC/DS Corresponding to KID
(recommended value: 01 23 45 67 89 AB CD EF EF CD AB 89 67 45 23 01)
If a parameter is not listed explicitly in the above table, the default values
of clause 4.7.3.1 apply.
#### 6.3.6.1 Input Data
Test Area Reference: FWK_FWS_INDA
##### 6.3.6.1.1 Conformance Requirements {#conformance-requirements-21 .H6}
##### 6.3.6.1.1.1 Normal Execution {#normal-execution-166 .H6}
  * CRRN1: If the SIM receives an envelope APDU containing an > SMS_PP_DATADOWNLOAD BER TLV formatted according to 3GPP TS > 23.048 [8], the SIM Toolkit Framework shall verify the security > of the SMS TPDU.
  * CRRN2: The toolkit applet will only be triggered if the TAR is known > and the security verified.
  * CRRN3: If the SIM receives an envelope APDU containing an > SMS_CB_DATADOWNLOAD formatted according to 3GPP TS 23.048 [8], > the SIM Toolkit Framework shall verify the security of the cell > broadcast page.
  * CRRN4: If the SIM receives an Update Record EFsms instruction > formatted according to TS 23.048[8], the SIM Toolkit Framework > shall verify the security of the SMS.
  * CRRN5: The STF shall provide the input data deciphered.
##### 6.3.6.1.1.2 Parameters error {#parameters-error-77 .H6}
No requirements.
##### 6.3.6.1.1.3 Context Errors {#context-errors-154 .H6}
No requirements.
##### 6.3.6.1.2 Test Area Files {#test-area-files-1 .H6}
Test Script: FWK_FWS_INDA_1.scr
Test Applet: FWK_FWS_INDA_1.java
FWK_FWS_INDA_2.java
FWK_FWS_INDA_3.java
FWK_FWS_INDA_4.java
FWK_FWS_INDA_5.java
FWK_FWS_INDA_6.java
Load Script: FWK_FWS_INDA_1.ldr
Cleanup Script: FWK_FWS_INDA_1.clr
Parameter File: FWK_FWS_INDA_1.par
##### 6.3.6.1.3 Test Procedure {#test-procedure-165 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Framework checks | 1- Applet1 is | 1- The SIM answers | | | the Cryptographic | triggered and the | to the Envelope | | | checksum and | value integrity is | with status words | | | deciphers the data | checked. | 9000 | | | | | | | | Applet1 is loaded | 2- Applet1 is | 2- The SIM answers | | | and installed | triggered and the | to the Envelope | | | | value integrity is | with status words | | | 1-Envelope(SMS-PP) | checked | 9000 | | | single and | | | | | formatted is sent | | | | | to the SIM with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1; | | | | | | | | | | Data = 01 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1; | | | | | | | | | | Data length is | | | | | 150. | | | +----+--------------------+--------------------+--------------------+ | 2 | Triggering two | 1- Applet1 is | 1- The SIM answers | | | different applets | triggered and the | to the Envelope | | | with different | value integrity is | with status words | | | security | checked | 9000 | | | | | | | | Applet2 is | 2- Applet1 is | 2- The SIM answers | | | installed | triggered and the | to the Envelope | | | | value integrity is | with status words | | | 1-Envelope(SMS-PP) | checked | 9000 | | | single and | | | | | formatted is sent | 3- Applet2 is | 3- The SIM answers | | | to the SIM with | triggered and the | to the Envelope | | | this features: | value integrity is | with status words | | | | checked | 9000 | | | Ciphering; | | | | | | 4- Applet2 is | 4- The SIM answers | | | Cryptographic | triggered and the | to the Envelope | | | checksum; | value integrity is | with status words | | | | checked | 9000 | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data = 03 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data length = 150 | | | | | | | | | | 3-Envelope(SMS-PP) | | | | | single and | | | | | formatted is sent | | | | | to the SIM with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet2 | | | | | | | | | | Data = 05 | | | | | | | | | | 4- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet2 | | | | | | | | | | Data length = 150. | | | +----+--------------------+--------------------+--------------------+ | 3 | Envelope(SMS-PP) | 1- No applet is | 1- The SIM answers | | | formatted with | triggered. | to the Envelope | | | wrong | | with status words | | | cryptographic | 2- No applet is | 9000 | | | checksum | triggered. | | | | | | | | | 1-Envelope 03.48 | | | | | single and | | | | | formatted is sent | | | | | to the SIM with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data = 07 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data length = 150 | | | +----+--------------------+--------------------+--------------------+ | 4 | **Framework checks | 1- Applet3 is | 1- The SIM answers | | | the Cryptographic | triggered and the | to the Envelope | | | checksum and | value integrity is | with status words | | | deciphers the | checked | 9000 | | | data** | | | | | | | | | | Applet3 is loaded | | | | | and installed | | | | | | | | | | 1-Envelope(SMS-CB) | | | | | formatted is sent | | | | | to the SIM with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | Data = 01 | | | +----+--------------------+--------------------+--------------------+ | 5 | **Triggering two | 1- Applet3 is | 1- The SIM answers | | | different applets | triggered and the | to the Envelope | | | with different | value integrity is | with status words | | | security on | checked | 9000 | | | Envelope(SMS-CB) | | | | | formatted** | 2- Applet4 is | 2- The SIM answers | | | | triggered and the | to the Envelope | | | Applet4 is | value integrity is | with status words | | | installed | checked | 9000 | | | | | | | | 1-Envelope(SMS-CB) | | | | | formatted is sent | | | | | to the SIM with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet3 | | | | | | | | | | Data = 02 | | | | | | | | | | 2-Envelope(SMS-CB) | | | | | formatted is sent | | | | | to the SIM with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet4 | | | | | | | | | | Data = 03 | | | +----+--------------------+--------------------+--------------------+ | 6 | Envelope(SMS-CB) | No applet is | 1- The SIM answers | | | formatted with | triggered | to the Envelope | | | wrong | | with status words | | | cryptographic | | 9000 | | | checksum | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet3 | | | | | | | | | | Data = 04 | | | +----+--------------------+--------------------+--------------------+ | 7 | Framework checks | 1- Applet5 is | 1- The SIM answers | | | the Cryptographic | triggered and the | to the Update | | | checksum and | value integrity is | Record EFsms | | | deciphers the data | checked. | instruction with | | | | | status words 9000 | | | Applet5 is | 2- Applet5 is | | | | installed | triggered and the | 2- The SIM answers | | | | value integrity is | to the Update | | | 1- Short Message | checked | Record EFsms | | | single and | | instruction with | | | formatted is sent | | status words 9000 | | | to the SIM by | | | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5; | | | | | | | | | | Data = 01 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by | | | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5; | | | | | | | | | | Data length = 150. | | | +----+--------------------+--------------------+--------------------+ | 8 | Triggering two | 1- Applet5 is | 1- The SIM answers | | | different applets | triggered and the | to the Update | | | with different | value integrity is | Record EFsms | | | security | checked. | instruction with | | | | | status words 9000 | | | Applet6 is | 2- Applet5 is | | | | installed | triggered and the | 2- The SIM answers | | | | value integrity is | to the Update | | | 1- Short Message | checked. | Record EFsms | | | single and | | instruction with | | | formatted is sent | 3- Applet6 is | status words 9000 | | | to the SIM by | triggered and the | | | | Update Record | value integrity is | 3- The SIM answers | | | EFsms instruction | checked. | to the Update | | | with these | | Record EFsms | | | features: | 4- Applet6 is | instruction with | | | | triggered and the | status words 9000 | | | Ciphering; | value integrity is | | | | | checked. | 4- The SIM answers | | | Cryptographic | | to the Update | | | checksum; | | Record EFsms | | | | | instruction with | | | No proof of | | status words 9000 | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data = 03 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by | | | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data length = 150. | | | | | | | | | | 3- Short Message | | | | | single and | | | | | formatted is sent | | | | | to the SIM by | | | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet6; | | | | | | | | | | Data = 05 | | | | | | | | | | 4- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by | | | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet6; | | | | | | | | | | Data length = 150. | | | +----+--------------------+--------------------+--------------------+ | 9 | Update Record | 1- No applet is | 1- The SIM answers | | | EFsms instruction | triggered. | to the Update | | | formatted with | | Record EFsms | | | wrong | 2- No applet is | instruction with | | | cryptographic | triggered. | status words 9000 | | | checksum | | | | | | | 2- The SIM answers | | | 1- Short Message | | to the Update | | | single and | | Record EFsms | | | formatted is sent | | instruction with | | | to the SIM by | | status words 9000 | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features:No | | | | | ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data = 07 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the SIM by | | | | | Update Record | | | | | EFsms instruction | | | | | with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data length = 150 | | | +----+--------------------+--------------------+--------------------+
##### 6.3.6.1.4 Test Coverage {#test-coverage-162 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3 CRRN2 3,6,9 CRRN3 4, 5, 6 CRRN4 7,8,9 CRRN5 1,2,4,5,7,8
#### 6.3.6.2 Output Data
Test Area Reference: FWK_FWS_OUDA
##### 6.3.6.2.1 Conformance Requirements {#conformance-requirements-22 .H6}
##### 6.3.6.2.1.1 Normal Execution {#normal-execution-167 .H6}
  * CRRN1: The SIM Toolkit Framework shall secure and send the response > packet.
##### 6.3.6.2.1.2 Parameters error {#parameters-error-78 .H6}
No requirements.
##### 6.3.6.2.1.3 Context Errors {#context-errors-155 .H6}
No requirements.
##### 6.3.6.2.2 Test Area Files {#test-area-files-2 .H6}
> Test Script: FWK_FWS_OUDA_1.scr
>
> Test Applet: FWK_FWS_OUDA_1.java
>
> Load Script: FWK_FWS_OUDA_1.ldr
>
> Cleanup Script: FWK_FWS_OUDA_1.clr
>
> Parameter File: FWK_FWS_OUDA_1.par
##### 6.3.6.2.3 Test Procedure {#test-procedure-166 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Envelope(SMS-PP) | The applet is | The SIM answers to | | | formatted | triggered and | the Envelope with | | | | sends a \"Display | status words 9Fxx | | | Ciphering; | Text\" proactive | and a PoR is | | | | command with the | retrieved with a | | | Cryptographic | data received in | GetResponse | | | checksum; | the Envelope. | command. The PoR | | | | | has no application | | | proof of receipt | | data. | | | response shall be | | | | | sent using | | The SIM answers to | | | S | | the Get Response | | | MS-Deliver-Report; | | command with | | | | | status words 91xx | | | no security | | to issue a Display | | | applied to proof | | Text \"APPLET1\". | | | of receipt | | | | | | | | | | Data in plain text | | | | | = \"APPLET1\" | | | +----+--------------------+--------------------+--------------------+ | 2 | Envelope(SMS-PP) | The applet posts | The SIM answers to | | | formatted | application data. | the Envelope with | | | | It does not call | status words 9Fxx | | | Ciphering; | the | and a PoR is | | | | Proac | retrieved with a | | | Cryptographic | tiveHandler.send() | GetResponse | | | checksum; | method | command. The PoR | | | | | has the | | | proof of receipt | | application data | | | response shall be | | posted by the | | | sent using | | application. | | | S | | | | | MS-Deliver-Report; | | The SIM answers to | | | | | the Get Response | | | no security | | command with | | | applied to proof | | status words 9000. | | | of receipt | | | | | | | | | | Data in plain text | | | | | = \"APPLET1\" | | | +----+--------------------+--------------------+--------------------+ | 3 | Envelope(SMS-PP) | The applet posts | The SIM answers to | | | formatted | application data | the Envelope with | | | | and calls the | status words 9Fxx | | | Ciphering; | Proac | and a PoR is | | | | tiveHandler.send() | retrieved with a | | | Cryptographic | method to send a | GetResponse | | | checksum; | \"Display Text\" | command. The PoR | | | | proactive command | has the | | | proof of receipt | with the data | application data | | | response shall be | received in the | posted by the | | | sent using | Envelope. | application. | | | S | | | | | MS-Deliver-Report; | | The SIM answers to | | | | | the Get Response | | | no security | | command with | | | applied to proof | | status words 91xx | | | of receipt | | to issue the | | | | | Display Text | | | Data in plain text | | \"TEST\". | | | = \"TEST\" | | | +----+--------------------+--------------------+--------------------+ | 4 | Envelope(SMS-PP) | The applet posts | The SIM answers to | | | formatted | application data | the Envelope with | | | | and calls the | status words 9Fxx | | | Ciphering; | Proac | and a PoR is | | | | tiveHandler.send() | retrieved with a | | | Cryptographic | method to send a | GetResponse | | | checksum; | \"Display Text\" | command. The PoR | | | | proactive command | has the | | | proof of receipt | with the data | application data | | | response shall be | received in the | posted by the | | | sent using | Envelope. | application. | | | S | | | | | MS-Deliver-Report; | | The SIM answers to | | | | | the Get Response | | | proof of receipt | | command with | | | shall be ciphered | | status words 91xx | | | | | to issue the | | | Data in plain text | | Display Text | | | = \"TEST\" | | \"TEST\". | +----+--------------------+--------------------+--------------------+ | 5 | Envelope(SMS-PP) | No applet is | The SIM answers to | | | formatted | triggered | the Envelope with | | | | | status words 9Exx | | | The Terminal | | and a PoR is | | | Profile command | | retrieved with a | | | shall be issued | | GetResponse | | | with the facility | | command. The | | | \"\'9EXX\' | | Response Status | | | response code for | | Code Octet shall | | | SIM data download | | be \'01\'. | | | error\" enabled | | | | | | | | | | The | | | | | Envelope(SMS-PP) | | | | | formatted has to | | | | | be issued with the | | | | | following | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | proof of receipt | | | | | response shall be | | | | | sent using | | | | | S | | | | | MS-Deliver-Report; | | | | | | | | | | no security | | | | | applied to proof | | | | | of receiptData in | | | | | plain text = | | | | | \"TEST\" | | | +----+--------------------+--------------------+--------------------+
##### 6.3.6.2.4 Test Coverage {#test-coverage-163 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3, 4, 5
### 6.3.7 Envelope Response Posting
#### 6.3.7.1 EVENT_CALL_CONTROL_BY_SIM
Test Area Reference: FWK_ERP_ECCN
##### 6.3.7.1.1 Conformance Requirements {#conformance-requirements-23 .H6}
##### 6.3.7.1.1.1 Normal Execution {#normal-execution-168 .H6}
  * CRRN1: The SIM Toolkit Framework can\'t reply busy when an > Envelope(Call Control) is sent to the SIM.
##### 6.3.7.1.1.2 Parameters error {#parameters-error-79 .H6}
No requirements.
##### 6.3.7.1.1.3 Context Errors {#context-errors-156 .H6}
No requirements.
##### 6.3.7.1.2 Test Area Files {#test-area-files-3 .H6}
Test Script: FWK_ERP_ECCN_1.scr
Test Applet: FWK_ERP_ECCN_1.java
FWK_ERP_ECCN_2.java
FWK_ERP_ECCN_3.java
Load Script: FWK_ERP_ECCN_1.ldr
Cleanup Script: FWK_ERP_ECCN_1.clr
Parameter File: FWK_ERP_ECCN_1.par
##### 6.3.7.1.3 Test Procedure {#test-procedure-167 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet1 is | Applet2 is | The SIM answer | | | registered on the | suspended | 9Fxx to the | | | EVENT_CALL\ | | Envelope(Call | | | _CONTROL_BY_SIM, | Applet1 is | Control) | | | Applet2 is | triggered. | | | | registered and | | The dialling | | | triggered on the | Applet2\'s | number is | | | EVENT | execution shall | retrieved with a | | | _MENU_SELECTION. | continue. | GetResponse | | | | | command. | | | 1-Applet2 invokes | | | | | the method | | The SIM answers to | | | send()and no fetch | | the Get Response | | | is performed | | command with | | | | | status words 91xx. | | | 2-Envelope(Call | | | | | Control) is sent | | | | | to the SIM | | | | | | | | | | 3-Applet1 calls | | | | | the method | | | | | En | | | | | velopeResponseHand | | | | | ler.postASBERTLV() | | | | | to change any | | | | | incoming dialling | | | | | number into +11 22 | | | | | 33 44. | | | | | | | | | | 4-A Fetch command | | | | | is sent to the SIM | | | | | | | | | | 5-A Terminal | | | | | Response command | | | | | is sent to the SIM | | | | | | | | | | 6-Delete Applet1 & | | | | | Applet2 | | | | | | | | | | 7-Install Applet3 | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet3 is | Applet3 is | The SIM answer | | | registered on both | triggered on the | 9Fxx to the | | | the events | EVEN | Envelope(Call | | | EVENT_CALL | T_MENU_SELECTION | Control) | | | _CONTROL_BY_SIM | | | | | and | Applet3 is | The dialling | | | EVENT | suspended on the | number is | | | _MENU_SELECTION. | send() method | retrieved with a | | | | | GetResponse | | | 1-Envelope Menu | Applet3 is | command. | | | Selection is sent | triggered on the | | | | to the SIM. | EVENT_CALL\ | The SIM answers to | | | | _CONTROL_BY_SIM. | the Get Response | | | 2-Applet3 invokes | | command with | | | the method | The Applet3\'s | status words 91xx. | | | send()and no fetch | execution shall | | | | is performed) | continue. | | | | | | | | | 3-Envelope(Call | | | | | Control) is sent | | | | | to the SIM | | | | | | | | | | 4-Applet3 calls | | | | | the method | | | | | En | | | | | velopeResponseHand | | | | | ler.postASBERTLV() | | | | | to change any | | | | | incoming dialling | | | | | number into +11 22 | | | | | 33 44. | | | | | | | | | | 5-A Fetch command | | | | | is sent to the SIM | | | | | | | | | | 6-A Terminal | | | | | Response command | | | | | is sent to the SIM | | | +----+--------------------+--------------------+--------------------+
##### 6.3.7.1.4 Test Coverage {#test-coverage-164 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2
#### 6.3.7.2 EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
Test Area Reference: FWK_ERP_EMCN
##### 6.3.7.2.1 Conformance Requirements {#conformance-requirements-24 .H6}
##### 6.3.7.2.1.1 Normal Execution {#normal-execution-169 .H6}
  * CRRN1: The SIM Toolkit Framework can\'t reply busy when an > Envelope(MO-Short Message Control) is sent to the SIM.
##### 6.3.6.2.1.2 Parameters error {#parameters-error-80 .H6}
No requirements.
##### 6.3.6.2.1.3 Context Errors {#context-errors-157 .H6}
No requirements.
##### 6.3.7.2.2 Test Area Files {#test-area-files-4 .H6}
Test Script: FWK_ERP_EMCN_1.scr
Test Applet: FWK_ERP_EMCN_1.java
FWK_ERP_EMCN_2.java
FWK_ERP_EMCN_3.java
Load Script: FWK_ERP_EMCN_1.ldr
Cleanup Script: FWK_ERP_EMCN_1.clr
Parameter File: FWK_ERP_EMCN_1.par
##### 6.3.7.2.3 Test Procedure {#test-procedure-168 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Applet1 is | Applet2 is | The SIM answers | | | registered on the | suspended | 9Fxx to the | | | EVENT_M | | Envelope(MO-Short | | | O_SHORT_MESSAGE\ | Applet1 is | Message Control) | | | _CONTROL_BY_SIM; | triggered. | | | | Applet2 is | | The | | | registered and | The Applet\'s | TP_De | | | triggered on the | execution shall | stination_Address | | | EVENT | continue. | is retrieved with | | | _MENU_SELECTION. | | a GetResponse | | | | | command. | | | 1-Applet2 invokes | | | | | the method | | The SIM answers to | | | send()and no fetch | | the Get Response | | | is performed) | | command with | | | | | status words 91xx. | | | 2-Envelope(MO-SM | | | | | control) is sent | | | | | to the SIM | | | | | | | | | | 3-Applet1 calls | | | | | the method | | | | | En | | | | | velopeResponseHand | | | | | ler.postASBERTLV() | | | | | to change any | | | | | incoming | | | | | TP_De | | | | | stination_Address | | | | | and any | | | | | RP_De | | | | | stination_Address | | | | | of the Service | | | | | Center into +11 22 | | | | | 33 44 | | | | | | | | | | 4-A Fetch command | | | | | is sent to the SIM | | | | | | | | | | 5-A Terminal | | | | | Response command | | | | | is sent to the SIM | | | | | | | | | | 6-Delete Applet1 & | | | | | Applet2 | | | | | | | | | | 7-Install Applet3 | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet3 is | Applet3 is | The SIM answers | | | registered on both | suspended on the | 9Fxx to the | | | the events | send() method | Envelope(MO-Short | | | EVENT_ | | Message Control) | | | MO_SHORT_MESSAGE | Applet3 is | | | | _CONTROL_BY_SIM | triggered on the | The | | | and | EVENT_M | TP_De | | | EVENT | O_SHORT_MESSAGE\ | stination_Address | | | _MENU_SELECTION. | _CONTROL_BY_SIM. | is retrieved with | | | | | a GetResponse | | | 1-Applet3 invokes | The Applet3\'s | command. | | | the method | execution shall | | | | send()and no fetch | continue. | The SIM answers to | | | is performed) | | the Get Response | | | | | command with | | | 2-Envelope(MO-SM | | status words 91xx. | | | control) is sent | | | | | to the SIM | | | | | | | | | | 3-Applet3 calls | | | | | the method | | | | | En | | | | | velopeResponseHand | | | | | ler.postASBERTLV() | | | | | to change any | | | | | incoming | | | | | TP_De | | | | | stination_Address | | | | | and any | | | | | RP_De | | | | | stination_Address | | | | | of the Service | | | | | Center into +11 22 | | | | | 33 44. | | | | | | | | | | 4-A Fetch command | | | | | is sent to the SIM | | | | | | | | | | 5-A Terminal | | | | | Response command | | | | | is sent to the SIM | | | +----+--------------------+--------------------+--------------------+
##### 6.3.7.2.4 Test Coverage {#test-coverage-165 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2
#### 6.3.7.3 EVENT_UNRECOGNIZED_ENVELOPE
Test Area Reference: FWK_ERP_EUEN
##### 6.3.7.3.1 Conformance Requirements {#conformance-requirements-25 .H6}
##### 6.3.7.3.1.1 Normal Execution {#normal-execution-170 .H6}
  * CRRN1: The EnvelopeResponseHandler is available for the > EVENT_UNRECOGNIZED_ENVELOPE.
##### 6.3.7.3.1.2 Parameters error {#parameters-error-81 .H6}
No requirements.
##### 6.3.7.3.1.3 Context Errors {#context-errors-158 .H6}
No requirements.
##### 6.3.7.3.2 Test Area Files {#test-area-files-5 .H6}
> Test Script: FWK_ERP_EUEN_1.scr
>
> Test Applet: FWK_ERP_EUEN_1.java
>
> Load Script: FWK_ERP_EUEN_1.ldr
>
> Cleanup Script: FWK_ERP_EUEN_1.clr
>
> Parameter File: FWK_ERP_EUEN_1.par
##### 6.3.7.3.3 Test Procedure {#test-procedure-169 .H6}
Id Description API/Framework Expectation APDU Expectation
* * *
1 An applet triggered on the EVENT_UNRECOGNIZED_ENVELOPE calls the
EnvelopeResponseHandler.post() method The post() method returns no exception
The SIM answers to the Envelope with status words 9Fxx. The data retrieved
with the GetResponse command are the ones posted by the applet.
##### 6.3.7.3.4 Test Coverage {#test-coverage-166 .H6}
CRR Number Test Case Number
* * *
CRRN1 1
#### 6.3.7.4 EVENT_FORMATTED_SMS_PP_ENV
Test Area Reference: FWK_ERP_EFSE
##### 6.3.7.4.1 Conformance Requirement {#conformance-requirement-146 .H6}
##### 6.3.7.4.1.1 Normal Execution {#normal-execution-171 .H6}
  * CRRN1: If PoR is required a SMS-DELIVER REPORT is sent by the SIM, > when the post() or the postAsBERTLV() method is invoked and if bit > 6 of the second octet of SPI is set to 0.
  * CRRN2: If PoR is required a SMS-SUBMIT is sent by the SIM, when the > post() or the postAsBERTLV() method is invoked and if bit 6 of the > second octet of SPI is set to 1. In this case the statusType > method parameter is meaningless. The SIM Toolkit Framework shall > build and issue a Send Short Message proactive command as defined > in TS 11.14 [4].
##### 6.3.7.4.2 Test Suite Files {#test-suite-files-165 .H6}
Test Script: FWK_ERP_EFSE_1.scr
Test Applet: FWK_ERP_EFSE_1.java
FWK_ERP_EFSE _2.java
Load Script: FWK_ERP_EFSE _1.ldr
Cleanup Script: FWK_ERP_EFSE _1.clr
Parameter File: FWK_ERP_EFSE _1.par
##### 6.3.7.4.3 Test Procedure {#test-procedure-170 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | SMS DELIVER REPORT | 1- Applet1 is | 3- ME receives | | | | triggered | 9FXX and checks | | | 1- A formatted sms | | the response | | | pp envelope with | 2- No exception is | | | | SMS Deliver Report | thrown. | 5- ME receives | | | required is sent | | 9FXX and checks | | | to the SIM with | Applet1 finalizes | the response | | | bit 6 of SPI2 set | | | | | to 0. | 4- Applet1 is | | | | | triggered | | | | 2- | | | | | Env | 5- No exception is | | | | elopeResponseHandl | thrown. | | | | er.getTheHandler() | | | | | method is called | Applet1 finalizes | | | | by Applet1 | | | | | | | | | | 3- Applet1 builds | | | | | the answer and | | | | | calls the post() | | | | | method with | | | | | Statu | | | | | sType=SW1_RP_ACK | | | | | | | | | | 4- A formatted sms | | | | | pp envelope with | | | | | SMS Deliver Report | | | | | required is sent | | | | | to the SIM with | | | | | bit 6 of SPI2 set | | | | | to 0. | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 6- Applet1 builds | | | | | the answer and | | | | | calls the | | | | | postAsBERTLV() | | | | | method with | | | | | Statu | | | | | sType=SW1_RP_ACK | | | +----+--------------------+--------------------+--------------------+ | 2 | SMS-SUBMIT | 1- Applet1 is | 3- ME receives a | | | | triggered | Send Short Message | | | 1- A formatted sms | | proactive command. | | | pp envelope with | 2- No exception is | | | | SMS Submit | thrown. | 6- ME receives a | | | required is sent | | Send Short Message | | | to the SIM with | Applet1 finalizes | proactive command. | | | bit 6 of SPI2 set | | | | | to 1. | 4- Applet1 is | 9- ME receives a | | | | triggered | Send Short Message | | | 2- | | proactive command. | | | Env | 5- No exception is | | | | elopeResponseHandl | thrown | 12- ME receives a | | | er.getTheHandler() | | Send Short Message | | | method is called | Applet1 finalizes | proactive command. | | | by Applet1 | | | | | | 7- Applet1 is | | | | 3- Applet1 builds | triggered | | | | the answer and | | | | | calls the post() | 8- No exception is | | | | method with | thrown. | | | | Statu | | | | | sType=SW1_RP_ACK | Applet1 finalizes | | | | | | | | | 4- A formatted sms | 10- Applet1 is | | | | pp envelope with | triggered | | | | SMS Submit | | | | | required is sent | 11- No exception | | | | to the SIM with | is thrown. | | | | bit 6 of SPI2 set | | | | | to 1. | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 6- Applet1 builds | | | | | the answer and | | | | | calls the post() | | | | | method with | | | | | StatusT | | | | | ype=SW1_RP_ERROR | | | | | | | | | | 7- A formatted sms | | | | | pp envelope with | | | | | SMS Submit | | | | | required is sent | | | | | to the SIM with | | | | | bit 6 of SPI2 set | | | | | to 1. | | | | | | | | | | 8- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 9.-Applet1 builds | | | | | the answer and | | | | | calls the | | | | | postAsBERTLV() | | | | | method with | | | | | Statu | | | | | sType=SW1_RP_ACK | | | | | | | | | | 10- A formatted | | | | | sms pp envelope | | | | | with SMS Submit | | | | | required is sent | | | | | to the SIM with | | | | | bit 6 of SPI2 set | | | | | to 1. | | | | | | | | | | 11- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 12- Applet1 builds | | | | | the answer and | | | | | calls the | | | | | postAsBERTLV () | | | | | method with | | | | | StatusT | | | | | ype=SW1_RP_ERROR | | | +----+--------------------+--------------------+--------------------+
##### 6.3.7.4.4 Test Coverage {#test-coverage-167 .H6}
CRR Number Test Case Number
* * *
CRRN1 1 CRRN2 2
### 6.3.8 Toolkit Installation
#### 6.3.8.1 Timers Allocation
Test Area Reference: FWK_TIN_TMAL
##### 6.3.8.1.1 Conformance Requirements {#conformance-requirements-26 .H6}
##### 6.3.8.1.1.1 Normal execution {#normal-execution-172 .H6}
  * CRRN1: One toolkit applet can register to several timers, but a > timer can only be allocated to one toolkit applet.
##### 6.3.8.1.1.2 Parameters error {#parameters-error-82 .H6}
No requirements.
##### 6.3.8.1.1.3 Context errors {#context-errors-159 .H6}
  * CRRC1: Allocated timers shall not exceed the maximum number of > timers allowed for this applet instance defined during > installation.
  * CRRC2: The total number of timers allocated for all the applets > shall not exceed 8. If the maximum number of timers required is > greater than \'08\' (maximum numbers of timers specified in TS > 11.14 [4], the card shall return the Status Word \'6A80\', > incorrect parameters in data field, to the Install(Install) > command.
##### 6.3.8.1.2 Test suite files {#test-suite-files-166 .H6}
Test Script: FWK_TIN_TMAL_1.scr
Test Applet: FWK_TIN_TMAL_1.java
FWK_TIN_TMAL_2.java
FWK_TIN_TMAL_3.java
Load Script: FWK_TIN_TMAL_1.ldr
Cleanup Script: FWK_TIN_TMAL_1.clr
Parameter File: FWK_TIN_TMAL_1.par
##### 6.3.8.1.3 Test Procedure {#test-procedure-171 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | **More than 8 | | The SIM answers to | | | timers at the | | the Envelope with | | | instantiation of | | status words 9Fxx | | | applet1: check | | | | | that applet1 is | | A GET RESPONSE is | | | not installed.** | | sent and the | | | | | additional data in | | | Install for | | the PoR is | | | install of applet1 | | checked. It must | | | with maximum 9 | | be 01 6A 80. | | | timers allocated, | | | | | requesting a PoR | | | | | to be sent via | | | | | S | | | | | MS-DELIVER-REPORT. | | | +----+--------------------+--------------------+--------------------+ | | Reset the card | | | +----+--------------------+--------------------+--------------------+ | 2 | Good installation | | The SIM answers to | | | of applet2 | | the Envelope with | | | | | status words 90 00 | | | Install for | | | | | install of applet2 | | | | | (maximum 4 timers | | | | | allocated). | | | +----+--------------------+--------------------+--------------------+ | 3 | **Allocate 4 | No exception shall | | | | timers** | be thrown. | | | | | | | | | **Applet2** | | | +----+--------------------+--------------------+--------------------+ | 4 | **Allocate one | Shall throw a | | | | more timer** | ToolkitException | | | | | with reason | | | | **Applet2** | NO | | | | | _TIMER_AVAILABLE | | +----+--------------------+--------------------+--------------------+ | 5 | Good installation | | The SIM answers to | | | of applet3 | | the Envelope with | | | | | status words 90 00 | | | Install for | | | | | install of applet3 | | | | | (maximum 8 timers | | | | | allocated). | | | +----+--------------------+--------------------+--------------------+ | 6 | **Allocate 4 | No exception shall | | | | timers** | be thrown. | | | | | | | | | **Applet3** | | | +----+--------------------+--------------------+--------------------+ | 7 | **Allocate one | Shall throw a | | | | more timer** | ToolkitException | | | | | with reason | | | | **Applet3** | NO | | | | | _TIMER_AVAILABLE | | +----+--------------------+--------------------+--------------------+ | 8 | **Check that each | | | | | timerId (allocated | | | | | by applet2 and | | | | | applet3) is | | | | | between 1 and 8 | | | | | and is different | | | | | from each other** | | | +----+--------------------+--------------------+--------------------+
##### 6.3.8.1.4 Test Coverage {#test-coverage-168 .H6}
CRR number Test case number
* * *
N1 2, 3, 8 C1 1, 7 C2 4, 5, 6
#### 6.3.8.2 Item Identifier
Test Area Reference: FWK_TIN_ITID
##### 6.3.8.2.1 Conformance Requirements {#conformance-requirements-27 .H6}
##### 6.3.8.2.1.1 Normal execution {#normal-execution-173 .H6}
  * CRRN1: If the requested item identifier in the range [1-127] is > not already allocated, then this item identifier shall be > allocated to the current applet.
  * CRRN2: If the requested item identifier is \'00\', the card shall > take the first free value in the range [128,255].
##### 6.3.8.2.1.2 Parameters error {#parameters-error-83 .H6}
  * CRRP1: If the requested item identifier is in the range [128,255], > then the card shall reject the install command.
##### 6.3.8.2.1.3 Context errors {#context-errors-160 .H6}
  * CRRC1: If the requested item identifier in the range [1-127] is > already allocated, then the card shall reject the install command.
##### 6.3.8.2.2 Test suite files {#test-suite-files-167 .H6}
Test Script: FWK_TIN_ITID_1.scr
Test Applet: FWK_TIN_ITID_1.java
FWK_TIN_ITID_2.java
FWK_TIN_ITID_3.java
Load Script: FWK_TIN_ITID_1.ldr
Cleanup Script: FWK_TIN_ITID_1.clr
Parameter File: FWK_TIN_ITID_1.par
##### 6.3.8.2.3 Test Procedure {#test-procedure-172 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Bad installation | | applet1 is not | | | of applet1 | | found, status word | | | | | 6X XX | | | Install for | | | | | install of | | | | | applet1.The | | | | | following | | | | | parameters item Id | | | | | equal to 128 | | | | | | | | | | applet1 is | | | | | selected | | | +----+--------------------+--------------------+--------------------+ | 2 | Good installation | | The SIM answers to | | | of applet1 | | the Envelope with | | | | | status words 91xx | | | Install for | | to send back to | | | install of | | the ME the 2 new | | | applet1. item Id = | | menus. | | | 1 for the first | | | | | menu and 127 for | | The menus are | | | the second one | | | | | | | (pos | | | A Terminal Profile | | ition/itemId/text) | | | is sent to the | | | | | card with only | | 01/01/menu11 | | | PROFILE_DOWNLOAD, | | | | | SMS_PP_DOWNLOAD, | | 02/127/menu12 | | | MENU_SELECTION, | | | | | SET_UP_MENU and | | | | | COMMAND_RESULT | | | | | facilities. | | | +----+--------------------+--------------------+--------------------+ | 3 | Bad installation | | applet2 is not | | | of applet2 | | found, status word | | | | | 6X XX | | | Item identifier | | | | | already allocated | | | | | | | | | | Install for | | | | | install of | | | | | applet2. | | | | | | | | | | item Id = 127 | | | | | | | | | | applet2 is | | | | | selected | | | +----+--------------------+--------------------+--------------------+ | 4 | Good installation | | The SIM answers to | | | of applet2 | | the Envelope with | | | | | status words 91xx | | | Install for | | to send back to | | | install of | | the ME the 3 | | | applet2. | | menus. | | | | | | | | item Id = 0 | | The menus are | | | | | | | | | | 01/01/menu11 | | | | | | | | | | 02/127/menu12 | | | | | | | | | | 03/128/menu21 | +----+--------------------+--------------------+--------------------+ | 5 | Good installation | | The SIM answers to | | | of applet3 | | the Envelope with | | | | | status words 91xx | | | Install for | | to send back to | | | install of | | the ME the 4 | | | applet3. | | menus. | | | | | | | | item Id = 0 | | The menus are | | | | | | | | | | 01/01/menu11 | | | | | | | | | | 02/127/menu12 | | | | | | | | | | 03/128/menu21 | | | | | | | | | | 04/129/menu31 | +----+--------------------+--------------------+--------------------+ | 6 | Good delete and | | The SIM answers to | | | installation of | | the Terminal | | | applet2 | | Profile with | | | | | status words 91xx | | | Delete instance of | | to send back to | | | applet2 | | the ME the 3 | | | | | menus. | | | Perform a RESET | | | | | and a Terminal | | The menus are | | | Profile with the | | | | | facilities of | | 01/01/menu11 | | | PROFILE_DOWNLOAD, | | | | | SMS-P | | 02/127/menu12 | | | P_DATA_DOWNLOAD, | | | | | MENU_SELECTION, | | 03/129/menu31 | | | COMMAND_RESULT | | | | | and SET_UP_MENU | | The SIM answers to | | | | | the Envelope with | | | Install for | | status words 91xx | | | install of | | to send back to | | | applet2. | | the ME the 4 | | | | | menus. | | | item Id = 0 | | | | | | | The menus are | | | | | | | | | | 01/01/menu11 | | | | | | | | | | 02/127/menu12 | | | | | | | | | | 03/128/menu21 | | | | | | | | | | 04/129/menu31 | +----+--------------------+--------------------+--------------------+
##### 6.3.8.2.4 Test Coverage {#test-coverage-169 .H6}
CRR number Test case number
* * *
N1 2 N2 4, 5, 6 P1 1 C1 3
#### 6.3.8.3 Item Position
Test Area Reference: FWK_TIN_ITPO
##### 6.3.8.3.1 Conformance Requirements {#conformance-requirements-28 .H6}
##### 6.3.8.3.1.1 Normal execution {#normal-execution-174 .H6}
  * CRRN1: The position of the new menu entries is an absolute position > among the existing ones.
  * CRRN2: If the position identifier is 00h, the menu shall have the > last position.
##### 6.3.8.3.1.2 Parameters error {#parameters-error-84 .H6}
No requirements.
##### 6.3.8.3.1.3 Context errors {#context-errors-161 .H6}
No requirements.
##### 6.3.8.3.2 Test suite files {#test-suite-files-168 .H6}
Test Script: FWK_TIN_ITPO_1.scr
Test Applet: FWK_TIN_ITPO_1.java
FWK_TIN_ITPO_2.java
FWK_TIN_ITPO_3.java
Load Script: FWK_TIN_ITPO_1.ldr
Cleanup Script: FWK_TIN_ITPO_1.clr
Parameter File: FWK_TIN_ITPO_1.par
##### 6.3.8.3.3 Test Procedure {#test-procedure-173 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Installation of | | The menus are | | | applet1 | | | | | | | (pos | | | Perform Install | | ition/itemId/text) | | | for install of | | | | | apple | | 01/01/menu11 | | | t1.Position/ItemId | | | | | | | 02/02/menu12 | | | 01/01 | | | | | | | | | | 02/02 | | | | | | | | | | A Terminal Profile | | | | | is sent to the | | | | | card | | | +----+--------------------+--------------------+--------------------+ | 2 | Installation of | | The SIM answers to | | | applet2 | | the Envelope with | | | | | status words 91xx | | | Perform Install | | to send back to | | | for install of | | the ME the 4 | | | applet2. | | menus. | | | | | | | | Position/ItemId | | The menus are | | | | | | | | 03/03 | | (pos | | | | | ition/itemId/text) | | | 04/04 | | | | | | | 01/01/menu11 | | | | | | | | | | 02/02/menu12 | | | | | | | | | | 03/03/menu21 | | | | | | | | | | 04/04/menu22 | +----+--------------------+--------------------+--------------------+ | 3 | Installation of | | The SIM answers to | | | applet3 | | the Envelope with | | | | | status words 91xx | | | Perform Install | | to send back to | | | for install of | | the ME the 5 | | | applet3. | | menus. | | | | | | | | Position/ItemId | | The menus are | | | | | | | | 00/05 | | (pos | | | | | ition/itemId/text) | | | | | | | | | | 01/01/menu11 | | | | | | | | | | 02/02/menu12 | | | | | | | | | | 03/03/menu21 | | | | | | | | | | 04/04/menu22 | | | | | | | | | | 05/05/menu31 | +----+--------------------+--------------------+--------------------+
##### 6.3.8.3.4 Test Coverage {#test-coverage-170 .H6}
NOTE: As Item Position management is not fully specified in the 3GPP TS 43.019
[7] or 3GPP TS 23.048 [8] all possible tests cannot be performed.
CRR number Test case number
* * *
N1 1, 2 N2 3
#### 6.3.8.4 Maximum Text Length for a menu entry
Test Area Reference: FWK_TIN_MLME
##### 6.3.8.4.1 Conformance Requirements {#conformance-requirements-29 .H6}
##### 6.3.8.4.1.1 Normal execution {#normal-execution-175 .H6}
  * CRRN1: The maximum length of item text string is defined at the > installation of the toolkit applet.
##### 6.3.8.4.1.2 Parameters errors {#parameters-errors .H6}
  * CRRP1: If initMenuEntry length parameter is greater than the > allocated space (Maximum Text Length for a menu entry), then a > ToolkitException ALLOWED_LENGTH_EXCEEDED is thrown.
  * CRRP2: If changeMenuEntry length parameter is greater than the > allocated space (Maximum Text Length for a menu entry), then a > ToolkitException ALLOWED_LENGTH_EXCEEDED is thrown.
##### 6.3.8.4.1.3 Context errors {#context-errors-162 .H6}
No requirements.
##### 6.3.8.4.2 Test suite files {#test-suite-files-169 .H6}
> Test Script: FWK_TIN_MLME_1.scr
>
> Test Applet: FWK_TIN_MLME_1.java
>
> Load Script: FWK_TIN_MLME_1.ldr
>
> Cleanup Script: FWK_TIN_MLME_1.clr
>
> Parameter File: FWK_TIN_MLME_1.par
##### 6.3.8.4.3 Test Procedure {#test-procedure-174 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API / Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Installation of | | | | | applet with 2 | | | | | menus not | | | | | exceeding the | | | | | maximum text | | | | | length | | | | | | | | | | Install one applet | | | | | with 2 menu | | | | | entries allowed | | | | | and max. text | | | | | length equal to | | | | | 10. | | | | | | | | | | initMenuEntry | | | | | defined at the | | | | | install (install) | | | | | command | | | | | | | | | | MenuEntry = | | | | | \"MenuEntry1\", | | | | | \"MenuEntry2\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 10 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 2 | initMenuEntry with | ToolkitException | | | | a too large length | ALLOWED | | | | | _LENGTH_EXCEEDED | | | | initMenuEntry with | is thrown | | | | length equal to 11 | | | | | | | | | | MenuEntry = \" | | | | | MenuEntry03\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 11 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | initMenuEntry with | | a SET UP MENU (2 | | | a right length | | items) is issued | | | | | with TLV item | | | initMenuEntry with | | length equal to 11 | | | length parameter | | (Identifier + Text | | | equal to 10 | | string of item) | | | | | | | | MenuEntry = \" | | | | | MenuEntry3\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 10 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 4 | changeMenuEntry | | a SET UP MENU (2 | | | with a right | | items) is issued | | | length | | with TLV item | | | | | length equal to 11 | | | Applet1 is | | (Identifier + Text | | | triggered by a | | string of item) | | | EVENT | | | | | _MENU_SELECTION. | | | | | | | | | | changeMenuEntry of | | | | | menu 1, with | | | | | length parameter | | | | | equal to 10 | | | | | | | | | | Id = \'01\' | | | | | | | | | | MenuEntry = | | | | | \"MenuEntry4\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | Return from | | | | | processToolkit | | | +----+--------------------+--------------------+--------------------+ | 5 | changeMenuEntry | ToolkitException | Shall not receive | | | with a too large | ALLOWED | a SET UP MENU | | | length | _LENGTH_EXCEEDED | different from the | | | | is thrown | previous one | | | Applet1 is | | | | | triggered by a | | | | | EVENT | | | | | _MENU_SELECTION. | | | | | | | | | | ChangeMenuEntry of | | | | | menu 1, with | | | | | length parameter | | | | | equal to 11 | | | | | | | | | | Id = \'02\' | | | | | | | | | | MenuEntry = | | | | | \"MenuEntry05\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | menuEntry.length | | | | | | | | | | NextAction = 0 | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = 0 | | | | | | | | | | IconIdentifier = 0 | | | | | | | | | | Return from | | | | | processToolkit | | | +----+--------------------+--------------------+--------------------+
##### 6.3.8.4.4 Test Coverage {#test-coverage-171 .H6}
CRR number Test case number
* * *
CRRN1 1, 3, 4 CRRP1 2 CRRP2 5
#### 6.3.8.5 Maximum number of menu entries
Test Area Reference: FWK_TIN_NBME
##### 6.3.8.5.1 Conformance Requirements {#conformance-requirements-30 .H6}
##### 6.3.8.5.1.1 Normal execution {#normal-execution-176 .H6}
  * CRRN1: The maximum number of menu entries is defined at the > installation of the toolkit applet and can be the maximum number > of successful invocations of the method initMenuEntry .
##### 6.3.8.5.1.2 Parameters errors {#parameters-errors-1 .H6}
  * CRRP1: If the menu entry cannot be initialised (e.g. no more item > data in applet loading parameter), a ToolkitException with the > REGISTRY_ERROR reason code is thrown.
##### 6.3.8.5.1.3 Context errors {#context-errors-163 .H6}
No requirements.
##### 6.3.8.5.2 Test suite files {#test-suite-files-170 .H6}
> Test Script: FWK_TIN_NBME_1.scr
>
> Test Applet: FWK_TIN_NBME_1.java
>
> FWK_TIN_NBME_2.java
>
> Load Script: FWK_TIN_NBME_1.ldr
>
> Cleanup Script: FWK_TIN_NBME_1.clr
>
> Parameter File: FWK_TIN_NBME_1.par
##### 6.3.8.5.3 Test Procedure {#test-procedure-175 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Installation of | No Exception is | | | | applet with 3 | thrown | | | | menus | | | | | | | | | | Install (install) | | | | | applet with max. | | | | | number of menu | | | | | entry is \'3\', | | | | | defined at the | | | | | install (install) | | | | | command. | | | | | | | | | | initMenuEntry for | | | | | each menu entry | | | | | allowed (3 times) | | | | | | | | | | MenuEntry = | | | | | \"menu1\", | | | | | \"menu2\", | | | | | \"menu3\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 5 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 2 | init of a 4^th^ | ToolkitException | SET UP MENU (3 | | | menu | REGISTRY_ERROR is | items) is issued | | | | thrown | with TLV item | | | initMenuEntry one | | length equal to 6 | | | more time | | (Identifier + Text | | | | | string of item) | | | MenuEntry = | | | | | \"menu4\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 5 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+ | 3 | Installation of | ToolkitException | Shall not receive | | | 2^nd^ applet with | REGISTRY_ERROR is | a SET UP MENU | | | 0 menu | thrown | different from the | | | | | previous one | | | Install (install) | | | | | another applet, | | | | | with max. number | | | | | of menu entry is | | | | | \'0\', defined at | | | | | the install | | | | | (install) command. | | | | | | | | | | initMenuEntry once | | | | | | | | | | MenuEntry = | | | | | \"menu1\" | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = 5 | | | | | | | | | | NextAction = | | | | | \'00\' | | | | | | | | | | HelpSupported = | | | | | false | | | | | | | | | | IconQualifier = | | | | | \'00\' | | | | | | | | | | IconIdentifier = 0 | | | +----+--------------------+--------------------+--------------------+
##### 6.3.8.5.4 Test Coverage {#test-coverage-172 .H6}
CRR number Test case number
* * *
CRRN1 1 CRRP1 2, 3
#### 6.3.8.6 Access Domain
Test Area Reference: FWK_TIN_ACDO
##### 6.3.8.6.1 Conformance Requirements {#conformance-requirements-31 .H6}
##### 6.3.8.6.1.1 Normal execution {#normal-execution-177 .H6}
  * CRRN1: The Access Domain parameter indicates the mechanism used to > control the applet instance access to the GSM file System (\'00\' > means full access to the GSM File System, \'FF\' means no access > to the GSM File System).
##### 6.3.8.6.1.2 Parameters errors {#parameters-errors-2 .H6}
  * CRRP1: If the Access Domain Parameter requested is not supported, > the card shall return the Status Word \'6A80\', incorrect > parameters in data field, to the Install(Install) command.
  * CRRP2: If an applet with Access Domain Parameter \'FF\' (i.e. No > Access to the GSM File System) tries to access a GSM file (e.g. > invoke the updateBinary(..) method) the framework shall throw a > SIMViewException with a AC_NOT_FULFILLED reason.
##### 6.3.8.6.1.3 Context errors {#context-errors-164 .H6}
No requirements.
##### 6.3.8.6.2 Test suite files {#test-suite-files-171 .H6}
> Test Script: FWK_TIN_ACDO_1.scr
>
> Test Applet: FWK_TIN_ACDO_1.java
FWK_TIN_ACDO_2.java
FWK_TIN_ACDO_3.java
> Load Script: FWK_TIN_ACDO_1.ldr
>
> Cleanup Script: FWK_TIN_ACDO_1.clr
>
> Parameter File: FWK_TIN_ACDO_1.par
##### 6.3.8.6.3 Test Procedure {#test-procedure-176 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 0 | Install (install) | | | | | applet1 with: | | | | | | | | | | - Length of | | | | | Access Domain | | | | | field value is | | | | | \'1\' | | | | | | | | | | - Access Domain | | | | | Parameter value is | | | | | \'00\' (full | | | | | access to the GSM | | | | | File System) | | | | | | | | | | Install (install) | | | | | applet2 with: | | | | | | | | | | - Length of | | | | | Access Domain | | | | | field value is | | | | | \'1\' | | | | | | | | | | - Access Domain | | | | | Parameter value is | | | | | \'FF\' (No access | | | | | to the GSM File | | | | | System) | | | | | | | | | | Install (install) | | | | | applet3 with: | | | | | | | | | | - Length of | | | | | Access Domain | | | | | field value is | | | | | \'1\' | | | | | | | | | | - Access Domain | | | | | Parameter value is | | | | | \'00\' (full | | | | | access to the GSM | | | | | File System) | | | +----+--------------------+--------------------+------------------+ | 1 | rea | 1 to 4- no | | | | dBinary/readRecord | exception is | | | | method with full | thrown | | | | Access Domain | | | | | Parameter | 5- | | | | | SIMViewException | | | | 1- Select EF-TARU | AC_NOT_FULFILLED | | | | file whose Read | is thrown | | | | access condition | | | | | is ALWAYS | | | | | | | | | | Perform the | | | | | readBinary method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 2- Select EF-SMS | | | | | file whose Read | | | | | access condition | | | | | is CHV1 | | | | | | | | | | Perform the | | | | | readRecord method: | | | | | | | | | | recNumber = 1 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 3- Select EF-TRAC | | | | | file whose Read | | | | | access condition | | | | | is CHV2 | | | | | | | | | | Perform the | | | | | readBinary method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 4- Select EF-SUME | | | | | file Read access | | | | | condition is ADM0 | | | | | | | | | | Perform the | | | | | readBinary method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 5- Select EF-TNR | | | | | file whose Read | | | | | access condition | | | | | is NEVER | | | | | | | | | | Perform the | | | | | readBinary method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | +----+--------------------+--------------------+------------------+ | 2 | updateB | 1 to 4- no | | | | inary/updateRecord | exception is | | | | method with full | thrown | | | | Access Domain | | | | | Parameter | 5- | | | | | SIMViewException | | | | For each case, | AC_NOT_FULFILLED | | | | send an Envelope | is thrown | | | | that triggers the | | | | | applet with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | 1- Select EF-TNR | | | | | file whose Update | | | | | access condition | | | | | is ALWAYS | | | | | | | | | | Perform the | | | | | updateBinary | | | | | method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = | | | | | abUpdate[FFFFFF] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 2- Select EF-SMS | | | | | file whose Update | | | | | access condition | | | | | is CHV1 | | | | | | | | | | Perform the | | | | | updateRecord | | | | | method: | | | | | | | | | | recNumber = 1 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0resp | | | | | = abUpdate[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 3- Select EF-FDN | | | | | file whose Update | | | | | access condition | | | | | is CHV2 | | | | | | | | | | Perform the | | | | | updateBinary | | | | | method: | | | | | | | | | | recNumber = 1 | | | | | | | | | | mode = | | | | | REC_ACC_MODE\ | | | | | _ABSOLUTE_CURRENT | | | | | | | | | | recOffset = 0 | | | | | | | | | | resp = | | | | | abUpdate[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 4- Select EF-SUME | | | | | file Update access | | | | | condition is ADM0 | | | | | | | | | | Perform the | | | | | updateBinary | | | | | method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = | | | | | abUpdate[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | 5- Select EF-TNU | | | | | file whose Update | | | | | access condition | | | | | is NEVER | | | | | | | | | | Perform the | | | | | updateBinary | | | | | method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = | | | | | abUpdate[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | +----+--------------------+--------------------+------------------+ | 3 | invalidate method | 1 to 4- no | | | | with full Access | exception is | | | | Domain Parameter | thrown | | | | | | | | | 1- Select EF-TNR | 5- | | | | file whose | SIMViewException | | | | Invalidate access | AC_NOT_FULFILLED | | | | condition is | is thrown | | | | ALWAYS | | | | | | | | | | Perform the | | | | | invalidate method | | | | | | | | | | 2- Select EF-TIAC | | | | | file whose | | | | | Invalidate access | | | | | condition is CHV1 | | | | | | | | | | Perform the | | | | | invalidate method | | | | | | | | | | 3- Select EF-ADN | | | | | file whose | | | | | Invalidate access | | | | | condition is CHV2 | | | | | | | | | | Perform the | | | | | invalidate method | | | | | | | | | | 4- Select EF-SUME | | | | | file Invalidate | | | | | access condition | | | | | is ADM0 | | | | | | | | | | Perform the | | | | | invalidate method | | | | | | | | | | 5- Select EF-CNIV | | | | | file whose | | | | | Invalidate access | | | | | condition is NEVER | | | | | | | | | | Perform the | | | | | invalidate method | | | +----+--------------------+--------------------+------------------+ | 4 | rehabilitate | 1 to 4- no | | | | method with full | exception is | | | | Access Domain | thrown | | | | Parameter | | | | | | 5- | | | | 1- Select EF-TNR | SIMViewException | | | | file whose | AC_NOT_FULFILLED | | | | Rehabilitate | is thrown | | | | access condition | | | | | is ALWAYS | | | | | | | | | | Perform the | | | | | rehabilitate | | | | | method | | | | | | | | | | 2- Select EF-IMSI | | | | | file whose | | | | | Rehabilitate | | | | | access condition | | | | | is CHV1 | | | | | | | | | | Perform the | | | | | rehabilitate | | | | | method | | | | | | | | | | 3- Select EF-ADN | | | | | file whose | | | | | Rehabilitate | | | | | access condition | | | | | is CHV2 | | | | | | | | | | Perform the | | | | | rehabilitate | | | | | method | | | | | | | | | | 4- Select EF-SUME | | | | | file Rehabilitate | | | | | access condition | | | | | is ADM0 | | | | | | | | | | Perform the | | | | | rehabilitate | | | | | method | | | | | | | | | | 5- Select EF-CNRI | | | | | file whose | | | | | Rehabilitate | | | | | access condition | | | | | is NEVER | | | | | | | | | | Perform the | | | | | rehabilitate | | | | | method | | | +----+--------------------+--------------------+------------------+ | 5 | increase method | 1 to 4- no | | | | with full Access | exception is | | | | Domain Parameter | thrown | | | | | | | | | 1- Select EF-CNR | 5- | | | | file whose | SIMViewException | | | | Increase access | AC_NOT_FULFILLED | | | | condition is | is thrown | | | | ALWAYS | | | | | | | | | | Perform the | | | | | increase method: | | | | | | | | | | incr = | | | | | a | | | | | bIncreaseValue[] | | | | | | | | | | incrOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | 2- Select EF-ACM | | | | | file whose | | | | | Increase access | | | | | condition is CHV1 | | | | | | | | | | Perform the | | | | | increase method: | | | | | | | | | | incr = | | | | | a | | | | | bIncreaseValue[] | | | | | | | | | | incrOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | 3- Select EF-CIAC | | | | | file whose | | | | | Increase access | | | | | condition is CHV2 | | | | | | | | | | Perform the | | | | | increase method: | | | | | | | | | | incr = | | | | | a | | | | | bIncreaseValue[] | | | | | | | | | | incrOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | 4- Select EF-CIAA | | | | | file Increase | | | | | access condition | | | | | is ADM0 | | | | | | | | | | Perform the | | | | | increase method: | | | | | | | | | | incr = | | | | | a | | | | | bIncreaseValue[] | | | | | | | | | | incrOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | 5- Select EF-CNU | | | | | file whose | | | | | Increase access | | | | | condition is NEVER | | | | | | | | | | Perform the | | | | | increase method | | | +----+--------------------+--------------------+------------------+ | 6 | readBinary method | SIMViewException | | | | with no Access | AC_NOT_FULFILLED | | | | Domain Parameter | is thrown | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | applet with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Select EF-TARU | | | | | file whose Read | | | | | access condition | | | | | is ALWAYS | | | | | | | | | | Perform the | | | | | readBinary method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = abRead[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | | | | | | | | t | | | +----+--------------------+--------------------+------------------+ | 7 | updateRecord | SIMViewException | | | | method with no | AC_NOT_FULFILLED | | | | Access Domain | is thrown | | | | Parameter | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | applet with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Select EF-SMS file | | | | | whose Update | | | | | access condition | | | | | is CHV1 | | | | | | | | | | Perform the | | | | | updateRecord | | | | | method: | | | | | | | | | | fileOffset = 0 | | | | | | | | | | resp = | | | | | abUpdate[] | | | | | | | | | | respOffset = 0 | | | | | | | | | | respLength = 3 | | | +----+--------------------+--------------------+------------------+ | 8 | invalidate method | SIMViewException | | | | with no Access | AC_NOT_FULFILLED | | | | Domain Parameter | is thrown | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | applet with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Select EF-ADN file | | | | | whose Invalidate | | | | | access condition | | | | | is CHV2 | | | | | | | | | | Perform the | | | | | invalidate method | | | +----+--------------------+--------------------+------------------+ | 9 | rehabilitate | SIMViewException | | | | method with no | AC_NOT_FULFILLED | | | | Access Domain | is thrown | | | | Parameter | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | applet with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Select EF-SUME | | | | | file Rehabilitate | | | | | access condition | | | | | is ADM0 | | | | | | | | | | Perform the | | | | | rehabilitate | | | | | method | | | +----+--------------------+--------------------+------------------+ | 10 | increase method | SIMViewException | | | | with no Access | AC_NOT_FULFILLED | | | | Domain Parameter | is thrown | | | | | | | | | Send an Envelope | Applet2 finalizes | | | | that triggers the | | | | | applet with the | Applet3 restore | | | | EVENT_UNFORMA | EF-SUME | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Select EF-CNR file | | | | | whose Increase | | | | | access condition | | | | | is NEVER | | | | | | | | | | Perform the | | | | | increase method | | | +----+--------------------+--------------------+------------------+
##### 6.3.8.6.4 Test Coverage {#test-coverage-173 .H6}
NOTE: As Item Position management is not fully specified in the 3GPP TS 43.019
[7] or 3GPP TS 23.048 [8] all possible tests cannot be performed.
CRR number Test case number
* * *
CRRN1 1, 2, 3, 4, 5 CRRP1 Not tested CRRP2 6, 7, 8, 9, 10
#### 6.3.8.7 Priority Level
Test Area Reference: FWK_TIN_PRLV
##### 6.3.8.7.1 Conformance Requirements {#conformance-requirements-32 .H6}
##### 6.3.8.7.1.1 Normal execution {#normal-execution-178 .H6}
  * CRRN1: The priority specifies the order of activation of an applet > compared to the other applet registered to the same event (\'01\': > Highest priority level, \'FF\' : Lowest priority level).
  * CRRN2: If two or more applets are registered to the same event and > have the same priority level, the applets are activated according > to their installation date (i.e. the most recent applet is > activated first).
##### 6.3.8.7.1.2 Parameters errors {#parameters-errors-3 .H6}
No requirements.
##### 6.3.8.7.1.3 Context errors {#context-errors-165 .H6}
No requirements.
##### 6.3.8.7.2 Test suite files {#test-suite-files-172 .H6}
Test Script: FWK_TIN_PRLV_x.scr, x from 1 to 12
Test Applet: FWK_TIN_PRLV_x.java, x from 1 to 12, 8A, 8B, 9A, 9B, 10A, 10B
Load Script: FWK_TIN_PRLV_x.ldr, x from 1 to 12
Cleanup Script: FWK_TIN_PRLV_x.clr, x from 1 to 12
Parameter File: FWK_TIN_PRLV_x.par, x from 1 to 12, 8A, 8B, 9A, 9B, 10A, 10B
##### 6.3.8.7.3 Test Procedure {#test-procedure-177 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 0 | All applets are | | | | | registered on an | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event | | | +----+--------------------+--------------------+------------------+ | 1 | Trigger 2 applets | A static variable | | | | with 2 different | is used to | | | | maximum Priority | validate | | | | Levels | triggering order: | | | | | applet2 is | | | | Install (install) | triggered before | | | | applet1 with | applet1 | | | | priority level | | | | | \'2\' and applet2 | | | | | with priority | | | | | level \'1\', from | | | | | package | | | | | fwk_tin_prlv_1. | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 2 | Trigger 2 applets | A static variable | | | | with 2 different | is used to | | | | maximum Priority | validate | | | | Levels | triggering order: | | | | | applet1 is | | | | Install (install) | triggered before | | | | applet1 with | applet2. | | | | priority level | | | | | \'1\' and applet2 | | | | | with priority | | | | | level \'2\', from | | | | | package | | | | | fwk_tin_prlv_2. | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 3 | Trigger 2 applets | A static variable | | | | with 2 different | is used to | | | | Priority Levels | validate | | | | | triggering order: | | | | Install (install) | applet2 is | | | | applet1 with | triggered before | | | | priority level | applet1 | | | | \'80\' and applet2 | | | | | with priority | | | | | level \'7F\', from | | | | | package | | | | | fwk_tin_prlv_3. | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 4 | Trigger 2 applets | A static variable | | | | with 2 different | is used to | | | | Priority Levels | validate | | | | | triggering order: | | | | Install (install) | applet2 is | | | | applet1 with | triggered before | | | | priority level | applet1 | | | | \'7F\' and applet2 | | | | | with priority | | | | | level \'80\', from | | | | | package | | | | | fwk_tin_prlv_4. | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 5 | Trigger 3 applets | A static variable | | | | with the same | is used to | | | | Priority Level | validate | | | | | triggering order: | | | | Install (install) | applet3 is | | | | applet 1, 2, 3 in | triggered before | | | | this order with | applet2, and | | | | same priority | applet2 is | | | | level from package | triggered before | | | | fwk_tin_prlv_5. | applet1. | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 3 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages. | | | +----+--------------------+--------------------+------------------+ | 6 | Trigger 2 applets | A static variable | | | | from 2 classes, | is used to | | | | with 2 different | validate | | | | Priority Level | triggering order: | | | | | applet2 is | | | | Install (install) | triggered before | | | | applet1 from class | applet1 | | | | A with priority | | | | | level \'2\' | | | | | | | | | | Install (install) | | | | | applet2 from class | | | | | B with priority | | | | | level \'1\' | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 7 | Trigger 2 applets | A static variable | | | | from 2 classes, | is used to | | | | with the same | validate | | | | Priority Level | triggering order: | | | | | applet2 is | | | | Install (install) | triggered before | | | | applet1 from class | applet1 | | | | A with priority | | | | | level \'1\' | | | | | | | | | | Install (install) | | | | | applet2 from class | | | | | B with priority | | | | | level \'1\' | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 8 | Trigger 2 applets | A static variable | | | | from 2 packages, | is used to | | | | with 2 different | validate | | | | Priority Level | triggering order: | | | | | applet2 is | | | | Install package | triggered before | | | | fwk_tin_prlv_8. | applet1 | | | | | | | | | Install (install) | | | | | applet1 from | | | | | package | | | | | fwk_tin_prlv_8A | | | | | with priority | | | | | level \'2\' | | | | | | | | | | Install (install) | | | | | applet2 from | | | | | package | | | | | fwk_tin_prlv_8B | | | | | with priority | | | | | level \'1\' | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances ad | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 9 | Trigger 2 applets | A static variable | | | | from 2 packages, | is used to | | | | with the same | validate | | | | Priority Level | triggering order: | | | | | applet2 is | | | | Install package | triggered before | | | | fwk_tin_prlv_9. | applet1 | | | | | | | | | Install (install) | | | | | applets 1 from | | | | | package | | | | | fwk_tin_prlv_9A | | | | | and applet2 from | | | | | package | | | | | fwk_tin_prlv_9B | | | | | in this order, | | | | | with same priority | | | | | level | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 10 | Trigger 4 applets | 1- A static | | | | from 2 packages | variable is used | | | | | to validate | | | | 1-Install packages | triggering order: | | | | f | applet1 is | | | | wk_tin_prlv_10, | triggered before | | | | f | applet2 | | | | wk_tin_prlv_10A | | | | | and | 2- Applet3 is | | | | fw | triggered before | | | | k_tin_prlv_10B. | applets 1, 4, then | | | | Install (install) | 2. | | | | 2 applets 1 then 2 | | | | | from package | | | | | fw | | | | | k_tin_prlv_10A, | | | | | with respectively | | | | | priority levels 1 | | | | | and 2. | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 2 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | 2- Install | | | | | (install) 2 | | | | | applets 3 then 4 | | | | | from package | | | | | fw | | | | | k_tin_prlv_10B, | | | | | with respectively | | | | | priority levels 1 | | | | | and 2. | | | | | | | | | | Send an Envelope | | | | | that triggers the | | | | | 4 applets. | | | | | | | | | | Delete applets | | | | | instances and | | | | | packages | | | +----+--------------------+--------------------+------------------+ | 11 | Trigger 4 applets | 1- A static | | | | with the same | variable is used | | | | Priority Level | to validate | | | | then delete them | triggering order: | | | | one after another | applets are | | | | and trigger them | triggered in order | | | | each time | 4, 3, 2, 1. | | | | | | | | | 1- Install | 2- Applets are | | | | (install) applet1, | triggered in order | | | | 2, 3, 4 in this | 3, 2, 1. | | | | order with same | | | | | priority level | 3- Applets are | | | | from package | triggered in order | | | | f | 2, 1. | | | | wk_tin_prlv_11. | | | | | | | | | | Send an Enveloppe | | | | | that triggers the | | | | | 4 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applet | | | | | instance 4 | | | | | | | | | | 2- Send an | | | | | Enveloppe that | | | | | triggers the 3 | | | | | applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete applet | | | | | instance 3 | | | | | | | | | | 3- Send an | | | | | Enveloppe that | | | | | triggers the 2 | | | | | applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | Delete remaining | | | | | applet instances | | | | | and packages | | | +----+--------------------+--------------------+------------------+ | 12 | Trigger 5 applets | 1- A static | | | | with different | variable is used | | | | Priority Levels, | to validate | | | | alternating | triggering order: | | | | install and delete | applets are | | | | | triggered in order | | | | 1- Install | 3, 1, 4, 2 | | | | (install) applets | | | | | 1, 2, 3, 4 in this | 2- Applets are | | | | order with | triggered in order | | | | respective | 3, 5, 4, 2 | | | | priority levels 1, | | | | | 2, 1, 2 | 3- Applets are | | | | | triggered in order | | | | Send an Enveloppe | 1, 3, 5, 4, 2 | | | | that triggers the | | | | | 4 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | 2- Delete applet | | | | | instance 1 and | | | | | install (install) | | | | | applet5 with | | | | | priority level 2 | | | | | | | | | | Send an Enveloppe | | | | | that triggers the | | | | | 4 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | | | | | | | | 3- Re-install | | | | | (install) applet1 | | | | | with priority | | | | | level 1 | | | | | | | | | | Send an Enveloppe | | | | | that triggers the | | | | | 5 applets with the | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | event. | | | +----+--------------------+--------------------+------------------+
##### 6.3.8.7.4 Test Coverage {#test-coverage-174 .H6}
CRR number Test case number
* * *
CRRN1 1, 2, 3, 4, 6, 8, 10, 12 CRRN2 5, 7, 9, 11
#### 6.3.8.8 Channel Allocation
Test Area Reference: FWK_TIN_CHAL
##### 6.3.8.8.1 Conformance Requirements {#conformance-requirements-33 .H6}
##### 6.3.8.8.1.1 Normal execution {#normal-execution-179 .H6}
  * CRRN1: One toolkit applet can register to several channels, but a > channel can only be allocated to one toolkit applet.
##### 6.3.8.8.1.2 Context errors {#context-errors-166 .H6}
  * CRRC1 : Allocated channels shall not exceed the maximum number of > channels allowed for this applet instance.
  * CRRC2 : The total number of channels allocated for all the applets > shall not exceed 7. If the maximum number of channels required is > greater than \'07\' (maximum numbers of channels specified in TS > 11.14 [4]), the card shall return the Status Word \'6A80\', > incorrect parameters in data field, to the Install(Install) > command.
##### 6.3.8.8.2 Test suite files {#test-suite-files-173 .H6}
Test Script: FWK_TIN_CHAL_1.scr
Test Applet: FWK_TIN_CHAL_1.java
FWK_TIN_CHAL_2.java
FWK_TIN_CHAL_3.java
Load Script: FWK_TIN_CHAL_1.ldr
Cleanup Script: FWK_TIN_CHAL_1.clr
Parameter File: FWK_TIN_CHAL_1.par
##### 6.3.8.8.3 Test Procedure {#test-procedure-178 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | **More than 7 | | 1- The SIM answers | | | channels at the | | to the Envelope | | | instantiation of | | with status words | | | applet1: check | | 9Fxx. | | | that applet1 is | | | | | not installed** | | A GET RESPONSE is | | | | | sent and the | | | 1-Install for | | additional data in | | | install of applet1 | | the PoR is | | | with maximum 8 | | checked. It must | | | channels | | be 01 6A 80. | | | allocated. | | | | | | | | | | A PoR is asked to | | | | | be sent via | | | | | S | | | | | MS-DELIVER-REPORT. | | | +----+--------------------+--------------------+--------------------+ | | **Reset the card** | | | +----+--------------------+--------------------+--------------------+ | 2 | **Good | | The SIM answers to | | | installation of | | the Envelope with | | | applet2** | | status words 90 00 | | | | | | | | Install for | | | | | install of applet2 | | | | | (maximum 4 | | | | | channels | | | | | allocated). | | | +----+--------------------+--------------------+--------------------+ | 3 | **Open 4 | No exception shall | OPEN CHANNEL | | | channels** | be thrown. | proactive command | | | | | are fetched. | | | **Applet2** | | | | | | | Successful | | | Applet2 builds a | | TERMINAL RESPONSE | | | proactive command | | of OPEN CHANNEL | | | OPEN CHANNEL 4 | | are sent to the | | | times, calling | | SIM with Channel | | | init() and send() | | Id = 01 to 04 | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 4 | **Open one more | Shall throw a | | | | channel** | ToolkitException | | | | | with reason | | | | **Applet2** | COM | | | | | MAND_NOT_ALLOWED | | | | Applet2 builds a | | | | | proactive command | | | | | OPEN CHANNEL once | | | | | again, calling | | | | | init() and send() | | | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 5 | **Good | | The SIM answers to | | | installation of | | the Envelope with | | | applet3** | | status words 90 00 | | | | | | | | Install for | | | | | install of applet3 | | | | | (maximum 7 | | | | | channels | | | | | allocated). | | | +----+--------------------+--------------------+--------------------+ | 6 | **Open 3 | No exception shall | OPEN CHANNEL | | | channels** | be thrown. | proactive command | | | | | is fetched. | | | **Applet3** | | | | | | | Successful | | | Applet3 builds a | | TERMINAL RESPONSE | | | proactive command | | of OPEN CHANNEL | | | OPEN CHANNEL 3 | | are sent to the | | | times, calling | | SIM with Channel | | | init() and send() | | Id from 05 to 07 | | | methods. | | | +----+--------------------+--------------------+--------------------+ | 7 | **Open one more | No exception shall | OPEN CHANNEL | | | channel** | be thrown. | proactive command | | | | | is fetched. | | | **Applet3** | | | | | | | Unsuccessful | | | Applet3 builds a | | Terminal Response | | | proactive command | | is sent to the SIM | | | OPEN CHANNEL once | | with \'No Channel | | | again, calling | | Available\' as | | | init() and send() | | Additional | | | methods. | | Information on | | | | | Result. | +----+--------------------+--------------------+--------------------+
##### 6.3.8.8.4 Test Coverage {#test-coverage-175 .H6}
CRR number Test case number
* * *
N1 2,3 C1 1, 7 C2 4,5,6
#### 6.3.8.9 Minimum Security Level
Test Area Reference: FWK_TIN_MSL
##### 6.3.8.9.1 Conformance Requirements {#conformance-requirements-34 .H6}
##### 6.3.8.9.1.1 Normal execution {#normal-execution-180 .H6}
  * CRRN1: The Receiving Entity shall check the Minimum Security Level > during processing the security of the Command Packet.
  * CRRN2: The Receiving Entity shall reject the message if the MSL > check fails.
  * CRRN3: If the MSL check fails, a Response Packet with the > \'Insufficient Security Level\' Response Status Code shall be sent > if required.
  * CRRN4: If the length of the Minimum Security Level field is greater > than zero, the Minimum Security Level is used to specify the > minimum level of security to be applied to Secured Packets. The > first byte shall be the MSL Parameter, other bytes shall be the > MSL Data.
  * CRRN5: If the length of the Minimum Security Level field is zero, no > minimum security level check shall be performed by the receiving > entity.
  * CRRN6: If no Minimum Security Level field is present (no MSL length, > no MSL parameter and no MSL data), no minimum security level check > shall be performed by the receiving entity.
  * CRRN7: If the Maximum number of channels field is included in the > command data then the Length of Minimum Security Level field shall > also be included.
  * CRRN8: If an optional parameter is included, then all the previous > parameters shall be included also
##### 6.3.8.9.2 Test suite files {#test-suite-files-174 .H6}
Test Script: FWK_TIN_MSL_1.scr
Test Applet: FWK_TIN_MSL_1.java
Load Script: FWK_TIN_MSL_1.ldr
Cleanup Script: FWK_TIN_MSL_1.clr
Parameter File: FWK_TIN_MSL_1.par
##### 6.3.8.9.3 Test Procedure {#test-procedure-179 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | Installation with | 2- Applet is | 1- 9000 | | | MSL length of 0 | triggered | | | | | | | | | 1- Install | 3- Applet is | | | | (install) applet | triggered | | | | with a MSL length | | | | | = 0 | | | | | | | | | | 2- Send formatted | | | | | SMS PP env with no | | | | | RC/CC/DS, no | | | | | Ciphering and | | | | | counter mode 0 | | | | | (not checked) | | | | | | | | | | 3- Send a | | | | | formatted SMS PP | | | | | env with CC, | | | | | ciphering and | | | | | counter mode 1 | | | | | (counter available | | | | | and no checking) | | | | | | | | | | 4- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+------------------+ | 2 | Installation | 2- Applet is | 1- 9000 | | | without MSL field | triggered | | | | | | | | | 1- Install | 3- Applet is | | | | (install) applet | triggered | | | | without MSL field | | | | | (no MSL length, no | | | | | MSL parameter and | | | | | no data) | | | | | | | | | | 2- Send formatted | | | | | SMS PP env with no | | | | | RC/CC/DS, no | | | | | Ciphering and | | | | | counter mode 0 | | | | | (not checked) | | | | | | | | | | 3- Send a | | | | | formatted SMS PP | | | | | env with CC, | | | | | ciphering and | | | | | counter mode 1 | | | | | counter available | | | | | and no checking) | | | | | | | | | | 4- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+------------------+
##### 6.3.8.9.4 Test Coverage {#test-coverage-176 .H6}
CRR number Test case number
* * *
CRRN1 Not applicable CRRN2 Not applicable CRRN3 Not applicable CRRN4 Not
applicable CRRN5 1 CRRN6 2 CRRN7 Not testable CRRN8 Not testable
### 6.3.9 File System Context
#### 6.3.9.1 Initial Context
Test Area Reference: FWK_FSC_INIT
##### 6.3.9.1.1 Conformance Requirements {#conformance-requirements-35 .H6}
##### 6.3.9.1.1.1 Normal Execution {#normal-execution-181 .H6}
  * CRRN1: At the invocation of the processToolkit method of a toolkit > applet, the current file is the MF.
##### 6.3.9.1.1.2 Parameters errors {#parameters-errors-4 .H6}
No requirements.
##### 6.3.9.1.1.3 Context errors {#context-errors-167 .H6}
No requirements.
##### 6.3.9.1.2 Test Suite Files {#test-suite-files-175 .H6}
Test Script: FWK_FSC_INIT_1.scr
Test Applet: FWK_FSC_INIT_1.java
FWK_FSC_INIT_2.java
Load Script: FWK_FSC_INIT_1.ldr
Cleanup Script: FWK_FSC_INIT_1.clr
FWK_FSC_INIT_2.clr
Parameter File: FWK_FSC_INIT_1.par
##### 6.3.9.1.3 Test Procedure {#test-procedure-180 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+------------------+ | 1 | MF is the selected | No exception shall | | | | DF in | be thrown. | | | | processToolkit() | | | | | | Shall return 7. | | | | An ENVELOPE APDU | | | | | containing a | fci shall contain | | | | formatted SMS PP | the following part | | | | for Applet 1 is | of the FCI | | | | issued to the SIM | structure: | | | | | | | | | byte[] fci = new | \ | | | | | | | | | fciOffset = 0 | | | | | | | | | | fciLength = 7 | | | | | | | | | | status() | | | +----+--------------------+--------------------+------------------+ | 2 | No EF is selected | SIMView exception | | | | | shall be thrown | | | | rehabilitate () | with reason | | | | | NO_EF_SELECTED | | +----+--------------------+--------------------+------------------+ | 3 | MF is selected | 1 - No exception | | | | even when an | shall be thrown. | | | | applet triggered | | | | | before selected | 2 - No exception | | | | any other file... | shall be thrown. | | | | | Shall return 7. | | | | Applets 1 and 2 | | | | | register to | fci shall contain | | | | EVENT_DOWNLOA | the following part | | | | D_USER_ACTIVITY. | of the FCI | | | | Applet 1 has | structure: | | | | higher priority | | | | | than Applet 2. | \ | | | | An ENVELOPE | | | | | \"EVENT - USER | 3 - SIMView | | | | ACTIVITY\" is sent | exception shall be | | | | to the SIM | thrown with reason | | | | | NO_EF_SELECTED | | | | 1 - Applet 1: | | | | | | | | | | - is triggered by | | | | | ev | | | | | ent_event_downlo | | | | | ad_user_activity | | | | | | | | | | - selects DF_GSM | | | | | and EF_IMSI | | | | | | | | | | 2 - Applet 2: | | | | | | | | | | - is triggered by | | | | | ev | | | | | ent_event_downlo | | | | | ad_user_activity | | | | | | | | | | fciOffset = 0 | | | | | | | | | | fciLength = 7 | | | | | | | | | | status() | | | | | | | | | | 3 - rehabilitate | | | | | () | | | +----+--------------------+--------------------+------------------+
##### 6.3.9.1.4 Test Coverage {#test-coverage-177 .H6}
CRR Number Test Case Number
* * *
CRRN1 1, 2, 3
#### 6.3.9.2 Context Preservation (current file)
Test Area Reference: FWK_FSC_CUFI
##### 6.3.9.2.1 Conformance Requirements {#conformance-requirements-36 .H6}
##### 6.3.9.2.1.1 Normal execution {#normal-execution-182 .H6}
  * CRRN1: When calling the method select (), the current files (file > context) of any other applets shall not be changed (see 3GPP TS > 43.019 [7] - clause 5.2).
  * CRRN2: The select() methods select a file without changing the > current file of any other applet or of the subscriber session.
  * CRRN3: After invocation of ProactiveHandler.send() method: the > current file context of the toolkit applet is unchanged (see 3GPP > TS 43.019 [7] - clause 5.2.).
##### 6.3.9.2.1.2 Parameters errors {#parameters-errors-5 .H6}
No requirements.
##### 6.3.9.2.1.3 Context errors {#context-errors-168 .H6}
No requirements.
##### 6.3.9.2.2 Test Suite Files {#test-suite-files-176 .H6}
Test Script: FWK_FSC_CUFI_1.scr
Test Applet: FWK_FSC_CUFI_1.java
FWK_FSC_CUFI_2.java
Load Script: FWK_FSC_CUFI_1.ldr
Cleanup Script: FWK_FSC_CUFI_1.clr
FWK_FSC_CUFI_2.clr
Parameter File: FWK_FSC_CUFI_1.par
##### 6.3.9.2.3 Test Procedure {#test-procedure-181 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+--------------------+ | 1 | No change to file | 1 - No exception | A GET INKEY | | | context by another | shall be thrown. | proactive command | | | applet | | is fetched from | | | | 2 - No exception | the SIM | | | Applet1 registers | shall be thrown. | | | | to | | | | | EVENT_FORMAT | 3 - No exception | | | | TED_SMS_PP_ENV. | shall be thrown. | | | | | The value of | | | | Applet2 registers | buffer2 is { 0xCA, | | | | to | 0xFE } | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | | | | | | 1 - Applet 1: | | | | | | | | | | - is triggered by | | | | | a formatted SMS | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_TARU | | | | | | | | | | - fileOffset = 0; | | | | | dataLength = 2; | | | | | dataOffset = 0; | | | | | | | | | | - buffer = {0xCA, | | | | | 0xFE } | | | | | | | | | | - updateBinary | | | | | (): first 2 bytes | | | | | of EF_TARU are | | | | | written as \'CA | | | | | FE\'. | | | | | | | | | | - issues a | | | | | proactive command | | | | | \"Get Inkey\". | | | | | | | | | | 2 - An ENVELOPE | | | | | APDU containing a | | | | | CALL CONTROL BY | | | | | SIM is issued to | | | | | the SIM | | | | | | | | | | Applet 2: | | | | | | | | | | - is triggered by | | | | | a CALL CONTROL BY | | | | | SIM | | | | | | | | | | - selects | | | | | DF_TELECOM and | | | | | EF_ADN. | | | | | | | | | | 3 - The terminal | | | | | response for Get | | | | | Inkey reactivates | | | | | Applet 1: | | | | | | | | | | - fileOffset = 0; | | | | | respLength = 2; | | | | | respOffset = 0; | | | | | | | | | | - readBinary () | | | | | info buffer2 | | | +----+--------------------+--------------------+--------------------+ | 2 | No change to file | 1 - No exception | 1 - A GET INKEY | | | context by | shall be thrown. | proactive command | | | subscriber session | | is fetched from | | | | 3 - No exception | the SIM | | | 1 - Applet 1 | shall be thrown. | | | | | The value of | | | | - issues a | buffer2 is { 0xCA, | | | | proactive command | 0xFE } | | | | \"Get Inkey\". | | | | | | | | | | 2 - Subscriber | | | | | session selects | | | | | DF_TELECOM and | | | | | EF_ADN. | | | | | | | | | | 3 - The terminal | | | | | response for Get | | | | | Inkey reactivates | | | | | Applet 1: | | | | | | | | | | - fileOffset = 0; | | | | | respLength = 2; | | | | | respOffset = 0; | | | | | | | | | | - readBinary () | | | | | info buffer2 | | | +----+--------------------+--------------------+--------------------+ | 3 | No change by | 1 - No exception | 1 - A GET INKEY | | | applet of | shall be thrown. | proactive command | | | subscriber session | | is fetched from | | | context | 3 - No exception | the SIM | | | | shall be thrown. | | | | 1 - Applet 1: | | 2 - READ RECORD | | | | | absolute number 1 | | | - selects | | shall read \"FF FF | | | DF_SIMTEST and | | FF FF FF FF FF FF | | | EF_TNU | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | - issues a | | FF FF FF FF FF FF | | | proactive command | | FF FF\" (from | | | \"Get Inkey\". | | EF~ADN~) | | | | | | | | 2 - subscriber | | | | | session reads | | | | | record 1 of | | | | | current file | | | | | (shall be EF_ADN) | | | | | | | | | | 3 - The terminal | | | | | response for Get | | | | | Inkey reactivates | | | | | Applet 1, which | | | | | terminates | | | | | execution | | | +----+--------------------+--------------------+--------------------+
##### 6.3.9.2.4 Test Coverage {#test-coverage-178 .H6}
CRR Number Test Case Number
* * *
CRRN1 1 CRRN2 1, 2, 3 CRRN3 1,2
#### 6.3.9.3 Context Preservation (current record pointer)
Test Area Reference: FWK_FSC_CURE
##### 6.3.9.3.1 Conformance Requirements {#conformance-requirements-37 .H6}
##### 6.3.9.3.1.1 Normal execution {#normal-execution-183 .H6}
  * CRRN1: When the seek method is called by one applet, the record > pointer of any other applet is not changed.
  * CRRN2: _updateRecord_ : the current record pointer of other applets / > subscriber shall not be changed in case of linear fixed EF
  * CRRN3: _updateRecord_ : the record pointer of a cyclic EF shall be > changed for all other applets / subscriber to the record number 1.
  * CRRN4: _readRecord:_ read data bytes of the linear fixed or cyclic > EF currently selected by the applet without changing the current > record pointer of any other applet / subscriber.
  * CRRN5: _increase_ : the last updated record of the cyclic EF > currently selected becomes record number 1 for every other applet > and subscriber session.
##### 6.3.9.3.1.2 Parameters errors {#parameters-errors-6 .H6}
No requirements.
##### 6.3.9.3.1.3 Context errors {#context-errors-169 .H6}
No requirements.
##### 6.3.9.3.2 Test Suite Files {#test-suite-files-177 .H6}
Test Script: FWK_FSC_CURE_1.scr
Test Applet: FWK_FSC_CURE_1.java
FWK_FSC_CURE_2.java
Load Script: FWK_FSC_CURE_1.ldr
Cleanup Script: FWK_FSC_CURE_1.clr
FWK_FSC_CURE_2.clr
Parameter File: FWK_FSC_CURE_1.par
##### 6.3.9.3.3 Test Procedure {#test-procedure-182 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 0 | SIM Initialization | Responses ignored. | | +----+--------------------+--------------------+--------------------+ | 1 | Seek without | 1 - No exception | 1 - A GET INKEY | | | affecting another | shall be thrown. | proactive command | | | record pointer | | is fetched from | | | | 2 - No exception | the SIM | | | Applet1 registers | shall be thrown. | | | | to | | | | | EVENT_FORMA | 3 - No exception | | | | TTED_SMS_PP_ENV | shall be thrown. | | | | | | | | | Applet 2 registers | | | | | to | | | | | EVENT_CALL | | | | | _CONTROL_BY_SIM | | | | | | | | | | 1 - Applet 1: | | | | | | | | | | - is triggered by | | | | | a formatted SMS | | | | | event | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_LARU | | | | | | | | | | - reads record 2 | | | | | using NEXT so that | | | | | the current record | | | | | pointer is set to | | | | | record 2 | | | | | | | | | | - issues a | | | | | proactive command, | | | | | e.g. Get Inkey. | | | | | | | | | | 2 - An ENVELOPE | | | | | APDU containing a | | | | | CALL CONTROL BY | | | | | SIM is issued to | | | | | the SIM | | | | | | | | | | Applet 2: | | | | | | | | | | - is triggered by | | | | | a CALL CONTROL | | | | | event | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_LARU | | | | | | | | | | - performs a seek | | | | | of pattern {0x55} | | | | | from beginning | | | | | forward, which | | | | | finds record 1. | | | | | | | | | | - returns from | | | | | processToolkit | | | | | | | | | | 3 - The terminal | | | | | response for Get | | | | | Inkey reactivates | | | | | Applet 1: | | | | | | | | | | - call | | | | | readRecord() using | | | | | CURRENT | | | | | | | | | | - the record read | | | | | should still be | | | | | record 2 of | | | | | EF_LARU, | | | | | containing {0xAA, | | | | | 0xAA, 0xAA, 0xAA} | | | +----+--------------------+--------------------+--------------------+ | 2 | updateRecord in | 1 - No exception | 1 - A GET INKEY | | | linear fixed EF | shall be thrown. | proactive command | | | without affecting | | is fetched from | | | current pointer of | 2 - No exception | the SIM | | | others | shall be thrown. | | | | | | | | | 1 - Applet 1: | 3 - No exception | | | | | shall be thrown. | | | | - is triggered by | | | | | a formatted SMS | | | | | event | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_LARU | | | | | | | | | | - reads record 2 | | | | | using NEXT so that | | | | | the current record | | | | | pointer is set to | | | | | record 2 | | | | | | | | | | - issues a | | | | | proactive command, | | | | | e.g. Get Inkey. | | | | | | | | | | 2 - An ENVELOPE | | | | | APDU containing a | | | | | CALL CONTROL BY | | | | | SIM is issued to | | | | | the SIM | | | | | | | | | | Applet 2: | | | | | | | | | | - is triggered by | | | | | a CALL CONTROL BY | | | | | SIM event | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_LARU | | | | | | | | | | - updates record | | | | | 1, by using mode | | | | | \"NEXT\". | | | | | | | | | | - returns from | | | | | processToolkit | | | | | | | | | | 3 - The terminal | | | | | response for Get | | | | | Inkey reactivates | | | | | Applet 1: | | | | | | | | | | - call | | | | | readRecord() using | | | | | CURRENT | | | | | | | | | | - the record read | | | | | should still be | | | | | record 2 of | | | | | EF_LARU, | | | | | containing {0xAA, | | | | | 0xAA, 0xAA, 0xAA} | | | +----+--------------------+--------------------+--------------------+ | 3 | readRecord in | 1 - No exception | 1 - A GET INKEY | | | linear fixed EF | shall be thrown. | proactive command | | | without affecting | | is fetched from | | | current pointer of | 2 - No exception | the SIM | | | others | shall be thrown. | | | | | | | | | 1 - Applet 1: | 3 - No exception | | | | | shall be thrown. | | | | - is triggered by | | | | | a formatted SMS | | | | | event | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_LARU | | | | | | | | | | - reads record 2 | | | | | using NEXT so that | | | | | the current record | | | | | pointer is set to | | | | | record 2 | | | | | | | | | | - issues a | | | | | proactive command, | | | | | e.g. Get Inkey. | | | | | | | | | | 2 - An ENVELOPE | | | | | APDU containing a | | | | | CALL CONTROL BY | | | | | SIM is issued to | | | | | the SIM | | | | | | | | | | Applet 2: | | | | | | | | | | - is triggered by | | | | | a CALL CONTROL BY | | | | | SIM event | | | | | | | | | | - selects | | | | | DF_SIMTEST and | | | | | EF_LARU | | | | | | | | | | - reads record 1, | | | | | by using mode | | | | | \"NEXT\". | | | | | | | | | | - returns from | | | | | processToolkit | | | | | | | | | | 3 - The terminal | | | | | response for Get | | | | | Inkey reactivates | | | | | Applet 1: | | | | | | | | | | - call | | | | | readRecord() using | | | | | CURRENT | | | | | | | | | | - the record read | | | | | should still be | | | | | record 2 of | | | | | EF_LARU, | | | | | containing {0xAA, | | | | | 0xAA, 0xAA, 0xAA} | | | +----+--------------------+--------------------+--------------------+
##### 6.3.9.3.4 Test Coverage {#test-coverage-179 .H6}
CRR Number Test Case Number
* * *
CRRN1 1 CRRN2 2 CRRN3 not tested (see note) CRRN4 3 CRRN5 not tested (see
note) NOTE: These requirements have not been tested because of an inconsistent
behaviour in 3GPP TS 43.019 [7], which is foreseen to be corrected in future
releases.
### 6.3.10 Other parts transferred to framework from API
#### 6.3.10.1 A handler is a temporary JCRE Entry Point object
Test Area Reference: FWK_API_HEPO
##### 6.3.10.1.1 Conformance Requirement: {#conformance-requirement-147 .H6}
##### 6.3.10.1.1.1 Normal execution {#normal-execution-184 .H6}
  * CRRN1: The EnvelopeHandler is a Temporary JCRE Entry Point Object > (see Javacard 2.1 Runtime Environment (JCRE) Specification > [12]).
  * CRRN2: The EnvelopeResponseHandler is a Temporary JCRE Entry Point > Object (see Javacard 2.1 Runtime Environment (JCRE) Specification > [12]).
  * CRRN3: The ProactiveHandler is a Temporary JCRE Entry Point Object > (see Javacard 2.1 Runtime Environment (JCRE) Specification > [12]).
  * CRRN4: The ProactiveResponseHandler is a Temporary JCRE Entry Point > Object (see Javacard 2.1 Runtime Environment (JCRE) Specification > [12]).
##### 6.3.10.1.1.2 Parameters errors {#parameters-errors-7 .H6}
No requirements.
##### 6.3.10.1.1.3 Context errors {#context-errors-170 .H6}
No requirements.
##### 6.3.10.1.2 Test suite files {#test-suite-files-178 .H6}
Test Script: FWK_API_HEPO_1.scr
Test Applet: FWK_API_HEPO_1.java
Load Script: FWK_API_HEPO_1.ldr
Cleanup Script: FWK_API_HEPO_1.clr
Parameter File: FWK_API_HEPO_1.par
##### 6.3.10.1.3 Test Procedure {#test-procedure-183 .H6}
Id Description API/Framework Expectation APDU Expectation
* * *
1 EnvelopeHandler.getTheHandler and store it in a static field of the toolkit
applet SecurityException is thrown  
2 EnvelopeHandler.getTheHandler and store it in a field of the toolkit applet
SecurityException is thrown  
3 EnvelopeResponseHandler.getTheHandler and store it in a static field of the
toolkit applet SecurityException is thrown  
4 EnvelopeResponseHandler.getTheHandler and store it in a field of the toolkit
applet SecurityException is thrown  
5 ProactiveHandler.getTheHandler and store it in a static field of the toolkit
applet SecurityException is thrown  
6 ProactiveHandler.getTheHandler and store it in a field of the toolkit applet
SecurityException is thrown  
7 Build and send a DISPLAY TEXT command to be able to get the reference of the
ProactiveReponseHandler Proactive command fetched and terminal response is
issued ProactiveResponseHandler.getTheHandler and store it in a static field
of the toolkit applet SecurityException is thrown  
8 ProactiveResponseHandler.getTheHandler and store it in a field of the
toolkit applet SecurityException is thrown
##### 6.3.10.1.4 Test Coverage {#test-coverage-180 .H6}
CRR number Test case number
* * *
N1 1, 2 N2 3, 4 N3 5, 6 N4 7, 8
#### 6.3.10.2 Transaction
Test Area Reference: FWK_API_TRAN
##### 6.3.10.2.1 Conformance Requirement: {#conformance-requirement-148 .H6}
##### 6.3.10.2.1.1 Normal execution {#normal-execution-185 .H6}
  * CRRN1: A pending toolkit applet transaction at the > ProactiveHandler.send() method invocation is aborted.
##### 6.3.10.2.1.2 Parameters errors {#parameters-errors-8 .H6}
No requirements.
##### 6.3.10.2.1.3 Context errors {#context-errors-171 .H6}
No requirements.
##### 6.3.10.2.2 Test suite files {#test-suite-files-179 .H6}
Test Script: FWK_API_TRAN_1.scr
Test Applet: FWK_API_TRAN_1.java
Load Script: FWK_API_TRAN_1.ldr
Cleanup Script: FWK_API_TRAN_1.clr
Parameter File: FWK_API_TRAN_1.par
##### 6.3.10.2.3 Test Procedure {#test-procedure-184 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+====================+ | 1 | Verify that | | | | | transaction is | | | | | aborted when a | | | | | proactive command | | | | | is sent | | | +----+--------------------+--------------------+--------------------+ | | Initialise a byte | | Proactive command | | | field with 0x05 | | fetched and | | | | | terminal response | | | Build a display | | is issued | | | text proactive | | | | | command. | | | | | | | | | | beginTransaction() | | | | | | | | | | Update the byte | | | | | with 0x02 | | | | | | | | | | send the proactive | | | | | command | | | +----+--------------------+--------------------+--------------------+ | | Verify that the | Shall return 0 | | | | byte value is 0x05 | | | | | | | | | | JCSystem.get | | | | | TransactionDepth() | | | +----+--------------------+--------------------+--------------------+
##### 6.3.10.2.4 Test Coverage {#test-coverage-181 .H6}
CRR number Test case number
* * *
N1 1
#### 6.3.10.3 Timer Id between Applets
Test Area Reference: FWK_API_TMID
##### 6.3.10.3.1 Conformance Requirement: {#conformance-requirement-149 .H6}
##### 6.3.10.3.1.1 Normal execution {#normal-execution-186 .H6}
No requirements.
##### 6.3.10.3.1.2 Parameters errors {#parameters-errors-9 .H6}
No requirements.
##### 6.3.10.3.1.3 Context errors {#context-errors-172 .H6}
  * CRRC1: The method ToolkitRegistry.releaseTimer() shall throw a > ToolkitException with INVALID_TIMER_ID reason if the timer is > valid but isn\'t allocated to this applet.
##### 6.3.10.3.2 Test suite files {#test-suite-files-180 .H6}
Test Script: FWK_API_TMID_1.scr
Test Applet: FWK_API_TMID_1.java
Load Script: FWK_API_TMID_1.ldr
Cleanup Script: FWK_API_TMID_1.clr
Parameter File: FWK_API_TMID_1.par
##### 6.3.10.3.3 Test Procedure {#test-procedure-185 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | 1 | During | releaseTimer() | | | | installation : | shall throw a | | | | | ToolkitException | | | | First instance | with | | | | allocate a timer | INVALID_TIMER_ID | | | | and store the | reason | | | | returned value in | | | | | a static field. | | | | | | | | | | Second instance | | | | | allocate a timer. | | | | | | | | | | Trig second | | | | | instance and try | | | | | to releaseTimer() | | | | | with the static | | | | | field value. | | | +----+--------------------+--------------------+------------------+
##### 6.3.10.3.4 Test Coverage {#test-coverage-182 .H6}
CRR number Test case number
* * *
N1 1
### 6.3.11 Concatenated SMS
#### 6.3.11.1 Concatenation processing
##### 6.3.11.1.1 Conformance Requirements {#conformance-requirements-38 .H6}
##### 6.3.11.1.1.1 Normal execution {#normal-execution-187 .H6}
  * CRRN1: The SIM Toolkit Framework shall link single Short Messages > together to re-assemble the original message before any further > processing.
  * CRRN2: The concatenation control headers used to re-assemble the > short messages in the correct order shall not be present in the > SMS TPDU.
  * CRRN3: The TP-elements of the SMS TPDU and the Address > (TS-Service-Centre-Address) shall correspond to the ones in the > last received Short Message (independently of the Sequence number > of Information-Element-Data).
  * CRRN4: The original Short Message shall be placed in one SMS TPDU > TLV (with TP-UDL field coded on one octet) included in the > EnvelopeHandler.
  * CRRN5: The SIM Toolkit Framework shall be able to process messages > with the following properties:
\- The Information Element Identifier is equal to the 8-bit reference number
\- It contains uncompressed 8 bit data or uncompressed UCS2 data.
##### 6.3.11.2 Test Suite Files {#test-suite-files-181 .H6}
Test Script: FWK_CSM_PROC_1.scr
Test Applet: FWK_CSM_PROC_1.java
Load Script: FWK_CSM_PROC_1.ldr
Cleanup Script: FWK_CSM_PROC_1.clr
Parameter File: FWK_CSM_PROC_1.par
##### 6.3.11.3 Test Procedure {#test-procedure-186 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/Framework | APDU Expectation | | | | Expectation | | +====+====================+====================+==================+ | | Applet | | | | | registration to | | | | | EVENT__FORMAT | | | | | TED_ _SMS_PP_ENV | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | A concatenated | | | | | formatted SMS_PP | | | | | short message is | | | | | sent to the SIM | | | | | (composed of two | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 1 | The second segment | Applet is not | | | | of a concatenated | triggered. | | | | short message is | | | | | sent to the SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | The first segment | Applet is | | | | of the | triggered. | | | | concatenated short | | | | | message is sent to | | | | | the SIM | | | +----+--------------------+--------------------+------------------+ | 3 | Call the | No exception is | | | | EnvelopeHanld | thrown. | | | | er.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 4 | Call the | Check that the | | | | EnvelopeH | message has been | | | | andler.findTLV()to | re-assembled in | | | | select the Dev Id, | the correct order. | | | | the adress and the | Check that TP-UDL | | | | TPDU TLV and the | field is coded one | | | | EnvelopeHand | octet. Check that | | | | ler.compareValue() | the concatenation | | | | to check each | control header is | | | | content. | not present in the | | | | | message. Check the | | | | | integrity of the | | | | | message. | | +----+--------------------+--------------------+------------------+ | 5 | A new concatenated | Applet is | | | | formatted short | triggered. | | | | message is sent to | | | | | the SIM composed | | | | | of two segments. | | | | | The Address field | | | | | of the first | | | | | segment is | | | | | different from the | | | | | address field in | | | | | the second | | | | | segment. | | | +----+--------------------+--------------------+------------------+ | 6 | Call the | No exception is | | | | EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 7 | Call the | Check that the | | | | EnvelopeH | address field of | | | | andler.findTLV()to | the message is | | | | select the the | equal to the | | | | address TLV and | address field of | | | | the | the second | | | | EnvelopeHand | segment. | | | | ler.compareValue() | | | | | to check its | | | | | content. | | | +----+--------------------+--------------------+------------------+ | 8 | A new concatenated | Applet is | | | | formatted short | triggered. | | | | message is sent to | | | | | the SIM composed | | | | | of two segments. | | | | | Some TP_elements | | | | | of the TP_DU of | | | | | the first segment | | | | | are different from | | | | | the TP elements in | | | | | the second | | | | | segment. | | | +----+--------------------+--------------------+------------------+ | 9 | Call the | No exception is | | | | EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 10 | Call the | Check that the TP | | | | EnvelopeH | elements of the | | | | andler.findTLV()to | message are equal | | | | select the the TP | to the ones of the | | | | DU TLV and the | second segment. | | | | EnvelopeHand | | | | | ler.compareValue() | | | | | to check its TP | | | | | elements. | | | +----+--------------------+--------------------+------------------+ | 11 | Send a | Applet is | | | | concatenated | triggered. | | | | formatted short | | | | | message (composed | | | | | of 2 segment)with | | | | | uncompressed 8 | | | | | bits data. | | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVENT_UN _FORMAT | | | | | TED_ _SMS_PP_ENV | | | | | and triggering | | | | | | | | | | Same test as 1 but | | | | | with an | | | | | unformatted | | | | | SMS_PP envelope. | | | | | | | | | | A concatenated | | | | | unformatted | | | | | SMS_PP short | | | | | message is sent to | | | | | the SIM (composed | | | | | of two segments). | | | +----+--------------------+--------------------+------------------+ | 12 | The second segment | Applet is not | | | | of a concatenated | triggered. | | | | short message is | | | | | sent to the SIM. | | | +----+--------------------+--------------------+------------------+ | 13 | The first segment | Applet is | | | | of the | triggered. | | | | concatenated short | | | | | message is sent to | | | | | the SIM | | | +----+--------------------+--------------------+------------------+ | 14 | Call the | No exception is | | | | EnvelopeHanld | thrown. | | | | er.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 15 | Call the | Check that the | | | | EnvelopeH | message has been | | | | andler.findTLV()to | re-assembled in | | | | select the Dev Id, | the correct order. | | | | the adress and the | Check that TP-UDL | | | | TPDU TLV and the | field is coded one | | | | EnvelopeHand | octet. Check that | | | | ler.compareValue() | the concatenation | | | | to check each | control header is | | | | content. | not present in the | | | | | message. Check the | | | | | integrity of the | | | | | message. | | +----+--------------------+--------------------+------------------+ | 16 | A new concatenated | Applet is | | | | formatted short | triggered. | | | | message is sent to | | | | | the SIM composed | | | | | of two segments. | | | | | The Address field | | | | | of the first | | | | | segment is | | | | | different from the | | | | | address field in | | | | | the second | | | | | segment. | | | +----+--------------------+--------------------+------------------+ | 17 | Call the | No exception is | | | | EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 18 | Call the | Check that the | | | | EnvelopeH | address field of | | | | andler.findTLV()to | the message is | | | | select the the | equal to the | | | | address TLV and | address field of | | | | the | the second | | | | EnvelopeHand | segment. | | | | ler.compareValue() | | | | | to check its | | | | | content. | | | +----+--------------------+--------------------+------------------+ | 19 | A new concatenated | Applet is | | | | unformatted short | triggered. | | | | message is sent to | | | | | the SIM composed | | | | | of two segments. | | | | | Some TP_elements | | | | | of the TP_DU of | | | | | the first segment | | | | | are different from | | | | | the TP_elements | | | | | in the second | | | | | segment. | | | +----+--------------------+--------------------+------------------+ | 20 | Call the | No exception is | | | | EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 21 | Call the | Check that the TP | | | | EnvelopeH | elements of the | | | | andler.findTLV()to | message are equal | | | | select the the TP | to the ones of the | | | | DU TLV and the | second segment. | | | | EnvelopeHand | | | | | ler.compareValue() | | | | | to check its TP | | | | | elements. | | | +----+--------------------+--------------------+------------------+ | 22 | Send a | Applet is | | | | concatenated | triggered. | | | | unformatted short | | | | | message (composed | | | | | of 2 segments) | | | | | with uncompressed | | | | | UCS2 data. | | | +----+--------------------+--------------------+------------------+
##### 6.3.11.4 Test Coverage {#test-coverage-183 .H6}
CRR number Test case number
* * *
N1 1,2, 3, 5, 6, 8, 9, 12, 13, 14, 16, 17, 19, 20 N2 4,15 N3 7,10, 18, 21 N4
4,15 N5 11,22
###### ## Annex A (normative): Class and Methods AID numbering and acronyms
# A.1 Sim.access
Class Name Acronyms Numbering on 5 bits
* * *
SIMView SVW 00001 SIMSystem SSY 00010 SIMViewException SVE 00011
## A.1.1 SIMView methods
Method Name Acronyms Numbering on 6 bits
* * *
static final Constants 000001 short increase(byte[] incr, short incrOffset,
byte[] resp, short respOffset) INCR_BS_BS 000010 void invalidate() INVL 000011
void readBinary(short fileOffset, byte[] resp, short respOffset, short
respLength) REDBS_BSS 000100 short readRecord(short recNumber, byte mode,
short recOffset, byte[] resp, short respOffset, short respLength) REDRSBS_BSS
000101 void rehabilitate() REHA 000110 short seek(byte mode, byte[] patt,
short pattOffset, short pattLength) SEEKB_BSS 000111 void select(short fid)
SLCTS 001000 short select(short fid, byte[] fci, short fciOffset, short
fciLength) SLCTS_BSS 001001 short status(byte[] fci, short fciOffset, short
fciLength) STAT_BSS 001010 short updateBinary(short fileOffset, byte[] data,
short dataOffset, short dataLength) UPDBS_BSS 001011 void updateRecord(short
recNumber, byte mode, short recOffset, byte[] data, short dataOffset, short
dataLength) UPDRSBS_BSS 001100
## A.1.2 SIMSystem methods
Method Name Acronyms Numbering on 6 bits
* * *
static SIMView getTheSIMView() GETS 000001
## A.1.3 SIMViewException methods
Method Name Acronyms Numbering on 6 bits
* * *
static void throwIt(short reason) THITS 000001 SIMViewException(short reason)
COORS 000010 Constants CONS 000011
# A.2 Sim.toolkit
Class Name Acronyms Numbering on 5 bits
* * *
ToolkitConstants TKC 00001 ToolkitInterface TKI 00010 EditHandler EDH 00011
EnvelopeHandler ENH 00100 EnvelopeResponseHandler ERH 00101 MEProfile MEP
00110 ProactiveHandler PAH 00111 ProactiveResponseHandler PRH 01000
ToolkitRegistry TKR 01001 ViewHandler VWH 01010 ToolkitException TKE 01011
## A.2.1 ToolkitConstants
Method Name Acronyms Numbering on 6 bits
* * *
Constants CONS 000001
## A.2.2 ToolkitInterface methods
Method Name Acronyms Numbering on 6 bits
* * *
void processToolkit (byte event) PRTKB 000001
## A.2.3 EditHandler methods
The numbering of the EditHandler methods it will be done in the classes
inherit it: EnvelopeResponseHandler, ProactiveHandler, because the methods
provided by this class as it is declared \'abstract\'.
## A.2.4 EnvelopeHandler methods
+-------------------------------+--------------+---------------------+ | Method Name | Acronyms | Numbering on 6 bits | +===============================+==============+=====================+ | Byte | GENT | 000001 | | getEnvelopeTag() | | | +-------------------------------+--------------+---------------------+ | Byte | GIID | 000010 | | getItemIdentifier() | | | +-------------------------------+--------------+---------------------+ | Short | GSDL | 000011 | | getSe | | | | curedDataLength() | | | +-------------------------------+--------------+---------------------+ | Short | GSDO | 000100 | | getSe | | | | curedDataOffset() | | | +-------------------------------+--------------+---------------------+ | Enve | GTHD | 000101 | | lopeHandler | | | | getTheHandler() | | | +-------------------------------+--------------+---------------------+ | Short | GTPO | 000110 | | getTPUDLOffset() | | | +-------------------------------+--------------+---------------------+ | Short getCapacity() | GCAP | 010010 | +-------------------------------+--------------+---------------------+ | Short getUserDataLength() | GUDL | 010011 | +-------------------------------+--------------+---------------------+ | Byte getChannelIdentifier() | GCID | 010100 | +-------------------------------+--------------+---------------------+ | | | | +-------------------------------+--------------+---------------------+ | Inherited Method Name: | | | | ViewHandler | | | +-------------------------------+--------------+---------------------+ | Byte | CPRVS_BSS | 000111 | | | | | | compareValue(sho | | | | rt valueOffset,byte[] compa | | | | reBuffer,short compareOffset, | | | | short compareLength) | | | +-------------------------------+--------------+---------------------+ | Short | COPY_BSS | 001000 | | | | | | copy(byte[] dstBuffer,sho | | | | rt dstOffset,short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | CPYVS_BSS | 001001 | | | | | | copyValue(short valueOffset, | | | | byte[] dstBuffer,sho | | | | rt dstOffset,short dstLength) | | | +-------------------------------+--------------+---------------------+ | Byte | FACRB_BS | 001010 | | | | | | findAndCompare | | | | Value(byte tag,byte[] compa | | | | reBuffer,short compareOffset) | | | +-------------------------------+--------------+---------------------+ | Byte | FACRBBS_BSS | 001011 | | findAndCompareVa | | | | lue(byte tag,byte occurrence, | | | | short valueOffset,byte\ | | | | [] compareBuffer,short compa | | | | reOffset,short compareLength) | | | +-------------------------------+--------------+---------------------+ | Short | FACYBBS_BSS | 001100 | | Fi | | | | ndAndCopyValue(byte tag,byte | | | | occurrence,short valueOffset, | | | | byte[] dstBuffer, | | | | short dstOffset, | | | | short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | FACYB_BS | 001101 | | fin | | | | dAndCopyValue(byte tag,byte[ | | | | ] dstBuffer,short dstOffset) | | | +-------------------------------+--------------+---------------------+ | Byte | FINDBB | 001110 | | | | | | Find | | | | TLV(byte tag,byte occurrence) | | | +-------------------------------+--------------+---------------------+ | Short | GLEN | 001111 | | | | | | GetLength() | | | +-------------------------------+--------------+---------------------+ | Byte | GVBYS | 010000 | | | | | | Ge | | | | tValueByte(short valueOffset) | | | +-------------------------------+--------------+---------------------+ | Short | GVLE | 010001 | | | | | | GetValueLength() | | | +-------------------------------+--------------+---------------------+
## A.2.5 EnvelopeResponseHandler methods
+-------------------------------+--------------+---------------------+ | Method Name | Acronym | Numbering on 6 bits | +===============================+==============+=====================+ | EnvelopeResponseHand | GTHD | 000001 | | ler | | | | getTheHandler() | | | +-------------------------------+--------------+---------------------+ | Void | POSTB | 000010 | | post(byte | | | | statusType) | | | +-------------------------------+--------------+---------------------+ | Void | POSTBB | 000011 | | postAsBERT | | | | LV(byte | | | | statusType, byte tag) | | | +-------------------------------+--------------+---------------------+ | Short getCapacity() | GCAP | 010101 | +-------------------------------+--------------+---------------------+ | | | | +-------------------------------+--------------+---------------------+ | Inherited Method Name: | | | | EditHandler | | | +-------------------------------+--------------+---------------------+ | Void appendArray(byte[] | APDA_BSS | 000100 | | buffer, short offset, short | | | | length, short dstLength) | | | +-------------------------------+--------------+---------------------+ | Void appendTLV(byte tag, byte | APTLBB | 000101 | | value) | | | +-------------------------------+--------------+---------------------+ | Void appendTLV(byte tag, | APTLB_BSS | 000110 | | byte[] value, short | | | | valueOffset, short | | | | valueLength) | | | +-------------------------------+--------------+---------------------+ | Void appendTLV(byte tag, byte | APTLBBB | 000111 | | value1, byte value2) | | | +-------------------------------+--------------+---------------------+ | Void appendTLV(byte tag, byte | APTLBB_BSS | 001000 | | value1, byte[] value2, | | | | short value2Offset, short | | | | value2Length) | | | +-------------------------------+--------------+---------------------+ | Void clear() | CLER | 001001 | +-------------------------------+--------------+---------------------+ | | | | +-------------------------------+--------------+---------------------+ | Inherited Method Name: | | | | ViewHandler | | | +-------------------------------+--------------+---------------------+ | Byte | CPRVS_BSS | 001010 | | | | | | compareValue(sho | | | | rt valueOffset,byte[] compa | | | | reBuffer,short compareOffset, | | | | short compareLength) | | | +-------------------------------+--------------+---------------------+ | Short | COPY_BSS | 001011 | | | | | | Copy(byte[] dstBuffer,sho | | | | rt dstOffset,short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | CPYVS_BSS | 001100 | | | | | | CopyValue(short valueOffset, | | | | byte[] dstBuffer,sho | | | | rt dstOffset,short dstLength) | | | +-------------------------------+--------------+---------------------+ | Byte | FACRB_BS | 001101 | | | | | | findAndCompare | | | | Value(byte tag,byte[] compa | | | | reBuffer,short compareOffset) | | | +-------------------------------+--------------+---------------------+ | Byte | FACRBBS_BSS | 001110 | | findAndCompareV | | | | alue(byte tag,byte occurence, | | | | short valueOffset,byte\ | | | | [] compareBuffer,short compa | | | | reOffset,short compareLength) | | | +-------------------------------+--------------+---------------------+ | Short | FACYBBS_BSS | 001111 | | f | | | | indAndCopyValue(byte tag,byte | | | | occurence,short valueOffset, | | | | byte[] dstBuffer, | | | | short dstOffset, | | | | short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | FACYB_BS | 010000 | | fin | | | | dAndCopyValue(byte tag,byte[ | | | | ] dstBuffer,short dstOffset) | | | +-------------------------------+--------------+---------------------+ | Byte | FINDBB | 010001 | | | | | | find | | | | TLV(byte tag,byte occurrence) | | | +-------------------------------+--------------+---------------------+ | Short | GLEN | 010010 | | | | | | GetLength() | | | +-------------------------------+--------------+---------------------+ | Byte | GVBYS | 010011 | | | | | | ge | | | | tValueByte(short valueOffset) | | | +-------------------------------+--------------+---------------------+ | Short | GVLE | 010100 | | | | | | getValueLength() | | | +-------------------------------+--------------+---------------------+
## A.2.6 MEProfile methods
Method Name Acronym Numbering on 6 bits
* * *
static boolean check(byte index) CHECB 000001 static boolean check(byte[]
mask, short offset, short length) CHECBSS 000010 static boolean check(short
index) CHECS 000011 static short copy(short startOffset, byte[] dstBuffer,
short dstOffset, short dstLength) COPYS_BSS 000100 static short getValue(short
indexMSB, short indexLSB) GVALSS 000101
## A.2.7 ProactiveHandler methods
+------------------------------+---------------+---------------------+ | Method Name | Acronyms | Numbering on 6 bits | +==============================+===============+=====================+ | ProactiveHandler | GTHD | 000001 | | getTheHandler() | | | +------------------------------+---------------+---------------------+ | Void | INITBBB | 000010 | | | | | | init(byte | | | | type, byte qualifier, byte | | | | dstDevice) | | | +------------------------------+---------------+---------------------+ | Void | INDTBB_BSS | 000011 | | [i | | | | nitDisplayText](file:///C:\U | | | | sers\Kymalainen\Documents\3g | | | | pp\CT\CT89_eMeeting\Local%20 | | | | Settings\Local%20Settings\Lo | | | | cal%20Settings\Local%20Setti | | | | ngs\sim\toolkit\ProactiveHan | | | | dler.html#initDisplayText(by | | | | te, byte, byte[], shor)(byte | | | | qualifier, byte dcs, | | | | byte[] buffer, short | | | | offset, short length) | | | +------------------------------+---------------+---------------------+ | Void | INGKBB_BSS | 000100 | | [initGetInkey](file:///C:\U | | | | sers\Kymalainen\Documents\3g | | | | pp\CT\CT89_eMeeting\Local%20 | | | | Settings\Local%20Settings\Lo | | | | cal%20Settings\Local%20Setti | | | | ngs\sim\toolkit\ProactiveHan | | | | dler.html#initGetInkey(byte, | | | | byte, byte[], short, )(byte | | | | qualifier, byte dcs, | | | | byte[] buffer, short | | | | offset, short length) | | | +------------------------------+---------------+---------------------+ | Void | INGPBB_BSSSS | 000101 | | [initGetInput](file:///C:\U | | | | sers\Kymalainen\Documents\3g | | | | pp\CT\CT89_eMeeting\Local%20 | | | | Settings\Local%20Settings\Lo | | | | cal%20Settings\Local%20Setti | | | | ngs\sim\toolkit\ProactiveHan | | | | dler.html#initGetInput(byte, | | | | byte, byte[], short, )(byte | | | | qualifier, byte dcs, | | | | byte[] buffer, short | | | | offset, short length, short | | | | minRespLength, short | | | | maxRespLength) | | | +------------------------------+---------------+---------------------+ | Byte | SEND | 000110 | | send() | | | +------------------------------+---------------+---------------------+ | Short getCapacity() | GCAP | 011000 | +------------------------------+---------------+---------------------+ | Void | ICCHB | 011001 | | initCloseChan | | | | nel(byte bChannelIdentifier) | | | +------------------------------+---------------+---------------------+ | | | | +------------------------------+---------------+---------------------+ | Inherited Method Name: | | | | EditHandler | | | +------------------------------+---------------+---------------------+ | Void appendArray(byte[] | APDA_BSS | 000111 | | buffer, short offset, short | | | | length, short dstLength) | | | +------------------------------+---------------+---------------------+ | Void appendTLV(byte tag, | APTLBB | 001000 | | byte value) | | | +------------------------------+---------------+---------------------+ | Void appendTLV(byte tag, | APTLB_BSS | 001001 | | byte[] value, short | | | | valueOffset, short | | | | valueLength) | | | +------------------------------+---------------+---------------------+ | Void appendTLV(byte tag, | APTLBBB | 001010 | | byte value1, byte value2) | | | +------------------------------+---------------+---------------------+ | Void appendTLV(byte tag, | APTLBB_BSS | 001011 | | byte value1, byte[] | | | | value2, short value2Offset, | | | | short value2Length) | | | +------------------------------+---------------+---------------------+ | Void clear() | CLER | 001100 | +------------------------------+---------------+---------------------+ | | | | +------------------------------+---------------+---------------------+ | Inherited Method Name: | | | | ViewHandler | | | +------------------------------+---------------+---------------------+ | Byte | CPRVS_BSS | 001101 | | | | | | compareValue(short | | | | valueOffset,byte[] compar | | | | eBuffer,short compareOffset, | | | | short compareLength) | | | +------------------------------+---------------+---------------------+ | Short | COPY_BSS | 001110 | | | | | | copy(byte[] dstBuffer,shor | | | | t dstOffset,short dstLength) | | | +------------------------------+---------------+---------------------+ | Short | CPYVS_BSS | 001111 | | | | | | copyValue(short valueOffset, | | | | byte[] dstBuffer,shor | | | | t dstOffset,short dstLength) | | | +------------------------------+---------------+---------------------+ | Byte | FACRB_BS | 010000 | | | | | | findAndCompareVa | | | | lue(byte tag,byte[] compar | | | | eBuffer,short compareOffset) | | | +------------------------------+---------------+---------------------+ | Byte | FACRBBS_BSS | 010001 | | findAndCompareVa | | | | lue(byte tag,byte occurence, | | | | short valueOffset,byte[\ | | | | ] compareBuffer,short compar | | | | eOffset,short compareLength) | | | +------------------------------+---------------+---------------------+ | Short | FACYBBS_BSS | 010010 | | fin | | | | dAndCopyValue(byte tag,byte | | | | occurence,short valueOffset, | | | | byte[] dstBuffer, | | | | short dstOffset, | | | | short dstLength) | | | +------------------------------+---------------+---------------------+ | Short | FACYB_BS | 010011 | | findA | | | | ndCopyValue(byte tag,byte[\ | | | | ] dstBuffer,short dstOffset) | | | +------------------------------+---------------+---------------------+ | Byte | FINDBB | 010100 | | | | | | findT | | | | LV(byte tag,byte occurrence) | | | +------------------------------+---------------+---------------------+ | Short | GLEN | 010101 | | | | | | getLength() | | | +------------------------------+---------------+---------------------+ | Byte | GVBYS | 010110 | | | | | | get | | | | ValueByte(short valueOffset) | | | +------------------------------+---------------+---------------------+ | Short | GVLE | 010111 | | | | | | getValueLength() | | | +------------------------------+---------------+---------------------+
## A.2.8 ProactiveResponseHandler methods
+-------------------------------+--------------+---------------------+ | Method Name | Acronyms | Numbering on 6 bits | +===============================+==============+=====================+ | Short | CPAI_BSS | 000001 | | [copyAdditionalI | | | | nformation](file:///C:\Users\ | | | | Kymalainen\Documents\3gpp\CT\ | | | | CT89_eMeeting\Local%20Setting | | | | s\Local%20Settings\Local%20Se | | | | ttings\Local%20Settings\sim\t | | | | oolkit\ProactiveResponseHandl | | | | er.html#copyAdditionalInforma | | | | tion(byte[], short,)(byte[] | | | | dstBuffer, short dstOffset, | | | | short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | CPTS_BS | 000010 | | copyTextString(byte[] | | | | dstBuffer, short dstOffset) | | | +-------------------------------+--------------+---------------------+ | Short | GTIL | 000011 | | getAd | | | | ditionalInformationLength() | | | +-------------------------------+--------------+---------------------+ | Byte | GTGR | 000100 | | getGen | | | | eralResult() | | | +-------------------------------+--------------+---------------------+ | Byte | GTII | 000101 | | getItemI | | | | dentifier() | | | +-------------------------------+--------------+---------------------+ | Byte | GTCS | 000110 | | getTextStringCodingSchem | | | | e() | | | +-------------------------------+--------------+---------------------+ | Short | GTTL | 000111 | | getTextStrin | | | | gLength() | | | +-------------------------------+--------------+---------------------+ | ProactiveResponseHandler | GTHD | 001000 | | getTheHandler() | | | +-------------------------------+--------------+---------------------+ | Short getCapacity() | GCAP | 010100 | +-------------------------------+--------------+---------------------+ | Byte getChannelIdentifier() | GCID | 010101 | +-------------------------------+--------------+---------------------+ | Short | CCHD_BSS | 010110 | | copyCh | | | | annelData(byte[] dstBuffer, | | | | short dstOffset, | | | | short dstLength) | | | +-------------------------------+--------------+---------------------+ | | | | +-------------------------------+--------------+---------------------+ | Inherited Method Name: | | | | ViewHandler | | | +-------------------------------+--------------+---------------------+ | Byte | CPRVS_BSS | 001001 | | | | | | CompareValue(sho | | | | rt valueOffset,byte[] compa | | | | reBuffer,short compareOffset, | | | | short compareLength) | | | +-------------------------------+--------------+---------------------+ | Short | COPY_BSS | 001010 | | | | | | Copy(byte[] dstBuffer,sho | | | | rt dstOffset,short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | CPYVS_BSS | 001011 | | | | | | CopyValue(short valueOffset, | | | | byte[] dstBuffer,sho | | | | rt dstOffset,short dstLength) | | | +-------------------------------+--------------+---------------------+ | Byte | FACRB_BS | 001100 | | | | | | FindAndCompare | | | | Value(byte tag,byte[] compa | | | | reBuffer,short compareOffset) | | | +-------------------------------+--------------+---------------------+ | Byte | FACRBBS_BSS | 001101 | | findAndCompareV | | | | alue(byte tag,byte occurence, | | | | short valueOffset,byte\ | | | | [] compareBuffer,short compa | | | | reOffset,short compareLength) | | | +-------------------------------+--------------+---------------------+ | Short | FACYBBS_BSS | 001110 | | F | | | | indAndCopyValue(byte tag,byte | | | | occurence,short valueOffset, | | | | byte[] dstBuffer, | | | | short dstOffset, | | | | short dstLength) | | | +-------------------------------+--------------+---------------------+ | Short | FACYB_BS | 001111 | | fin | | | | dAndCopyValue(byte tag,byte[ | | | | ] dstBuffer,short dstOffset) | | | +-------------------------------+--------------+---------------------+ | Byte | FINDBB | 010000 | | | | | | Find | | | | TLV(byte tag,byte occurrence) | | | +-------------------------------+--------------+---------------------+ | Short | GLEN | 010001 | | | | | | GetLength() | | | +-------------------------------+--------------+---------------------+ | Byte | GVBYS | 010010 | | | | | | Ge | | | | tValueByte(short valueOffset) | | | +-------------------------------+--------------+---------------------+ | Short | GVLE | 010011 | | | | | | GetValueLength() | | | +-------------------------------+--------------+---------------------+
## A.2.9 ToolkitRegistry methods
Method Name Acronyms Numbering on 6 bits
* * *
AllocateTimer() ATIM 000001
[changeMenuEntry](file:///C:\Users\Kymalainen\Documents\3gpp\CT\CT89_eMeeting\Local%20Settings\Local%20Settings\Local%20Settings\Local%20Settings\sim\toolkit\ToolkitRegistry.html#changeMenuEntry(byte,
byte[], short, sho)(byte id, byte[] menuEntry, short offset, short length,
byte nextAction, boolean helpSupported, byte iconQualifier, short
iconIdentifier) CMETB_BSSBZBS 000010 clearEvent(byte event) CEVTB 000011
disableMenuEntry(byte id) DMETB 000100 enableMenuEntry(byte id) EMETB 000101
getEntry() GETY 000110 getPollInterval() GPOL 000111
[initMenuEntry](file:///C:\Users\Kymalainen\Documents\3gpp\CT\CT89_eMeeting\Local%20Settings\Local%20Settings\Local%20Settings\Local%20Settings\sim\toolkit\ToolkitRegistry.html#initMenuEntry(byte[],
short, short, byte)(byte[] menuEntry, short offset, short length, byte
nextAction, boolean helpSupported, byte iconQualifier, short iconIdentifier)
IMET_BSSBZBS 001000 isEventSet(byte event) IEVSB 001001 releaseTimer(byte
timerIdentifier) RTIM 001010 requestPollInterval(short duration) RPOL 001011
setEvent(byte event) SEVTB 001100 setEventList(byte[] eventList, short offset,
short length) SEVL_BSS 001101
## A.2.10 ViewHandler methods
The numbering of the ViewHandler methods it will be done in the classes
inherit it: EditHandler, EnvelopeHandler, ProactiveResponseHandler,
ProactiveHandler, because the methods provided by this class as it is declared
\'abstract\'.
## A.2.11 ToolkitException methods
Method Name Acronyms Numbering on 6 bits
* * *
Static void throwIt(short reason) THITS 000001 ToolkitException(short reason)
COORS 000010 Constants CONS 000011
###### ## Annex B (normative): Script file syntax and format description
# B.1 Syntax description
Following is a syntax description in BNF.
\ ::= [ \ **\n**] +
\ ::= \ \| \ \| _\ _
\ ::= \ \| \ \| \ \| \
\ ::= **RST**
\ ::= **INI** _\ _
\ ::= **CMD** _\ _ [ \ ] ( \ )
\ ::= **[** _\ _ **]**
\ ::= **(** _\ _ **)**
\ ::= **REM** _\ _
\ ::= **SWI {** [\] + **}**
\ ::= \ **: \n** \
Description of syntax metalanguage :
**\n** represents a linebreak
[ x ] means x can appear optionally
[ x ] + means 1 or more appearances of x
x \| y means x or y
**[]{}:** (bold) these are characters that appear literally in the script
files
_\ _ any character until the end of the line
_\ _ a line containing no text is acceptable
_\ _ data written in hexadecimal, each byte separated from the
following by a whitespace
Each simple statement beginning with 3 characters different than the ones
defined indicates another tool command, and shall be ignored by the parser if
not recognized.
\' \', \'\t\' : Can be used as separator
A long statement can be broken into several lines by using the character
\'**\** \' at the end of each line which is not the last one in the statement.
For more details refer to the examples in B.3.
# B.2 Semantics
Following is the meaning of each of the statements:
**CMD** : Sends an APDU Command to the card, including (optionally) the
expected response data and also (optionally) the expected status words SW1,
SW2.
**RST** : Resets and powers on the card
**INI** : Performs the terminal profile with the following data. Afterwards,
it shall perform all the fetch and terminal response commands until there is
no proactive session in progress.
**REM** : Used for comments
**SWI** : Activates a switch condition. Every labelled list represents a list
of statements to be executed, if the label matches the SW resulting from the
previously executed command.
Evaluation of expected response and status in the case of a CMD:
\ data within **[**...**]** has to be checked, it needs to be
present for an outgoing command. Bytes written as XX shall not be checked by
the APDU tool.
\ status contained within **(**...**)** has to be checked; when
several status are valid they shall be separated by commas. Nibble written as
X shall not be checked by the APDU tool.
# B.3 Example
REM this is an example
RST
INI FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF
REM Case 1 example
CMD A0 C2 00 00 00 (91 33 , 69 XX)
REM Case 2 example
CMD A0 B6 00 00 07 \
[XX XX XX 55 55 XX 55] \
(91 33 , 67 XX)
CMD A0 B6 00 00 07 \
(91 33 , 67 XX)
CMD A0 C0 00 00 1F \
[10 A0 00 00 00 09 00 02 FF FF FF FF 89 28 A4 05 \
02 0D CC CC CC CC CC CC CC CC CC CC CC CC CC ] \
(90 00)
REM Case 3 example
CMD A0 C2 00 00 33 \
D1 31 82 02 83 81 06 05 80 11 22 33 44 8B 24 40 \
08 00 24 23 85 18 41 04 51 10 10 00 00 00 00 13 \
02 70 00 00 0E 0D 00 00 00 00 28 A4 05 00 00 00 \
00 00 00 \
(90 00)
REM Case 4 example with switch statement
CMD 00 A4 04 00 10 \
A0 00 00 00 09 00 02 FF FF FF FF 89 41 04 44 02 \
(61 XX, 6A 82)
SWI {
61 XX:
CMD 00 C0 00 00 14 \
[10 A0 00 00 00 09 00 02 FF FF FF FF 89 41 04 44 \
02 02 CC CC] \
(90 00)
CMD A0 A4 00 00 02 \
3F 00
6A 82:
RST
}
REM Case 5 example
CMD A0 C2 00 00 33 \
D1 31 82 02 83 81 06 05 80 11 22 33 44 8B 24 40 \
08 00 24 23 85 18 41 04 51 10 10 00 00 00 00 13 \
02 70 00 00 0E 0D 00 00 00 00 28 A4 05 00 00 00 \
00 00 00 \
(6X 00)
# B.4 Style and formatting
In order to show a common appearance all the scripts shall follow those format
rules:
\- start always with a \'RST\'.
\- The command, data to be checked and status to be checked shall be presented
in the following order:
CMD _COMMAND_ [_EXPECTED DATA_] (_EXPECTED STATUS_)
\- APDU shall be presented with command (CLA INS P1 P2 P3) in one line and
data (if present) in next line grouped 16 bytes per line (see example above).
\- The expected data (if present) shall be presented in 16 bytes groups per
line (see example above).
###### ## Annex C (normative): Default Prepersonalization
# C.1 General Default Prepersonalization
This table shows the default prepersonalization, the file system and the
files\' content, that the test SIM cards shall contain unless otherwise
stated.
+-------------+------------+-------------------+-------------------+ | Name | Identifier | Default Value | Special Features | +=============+============+===================+===================+ | EF~ICCID~ | 2FE2 | 0F FF FF FF FF FF | This value is not | | | | FF FF FF FF | compliant with | | | | | 3GPP TS 51.011 | | | | | [3] | +-------------+------------+-------------------+-------------------+ | EF~IMSI~ | 6F07 | FF FF FF FF FF FF | This value is not | | | | FF FF FF | compliant with | | | | | 3GPP TS 51.011 | | | | | [3] | +-------------+------------+-------------------+-------------------+ | EF~LP~ | 6F05 | 01 FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~Kc~ | 6F20 | FF FF FF FF FF FF | | | | | FF FF 07 | | +-------------+------------+-------------------+-------------------+ | EF~PLMNsel~ | 6F30 | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~HPLMN~ | 6F31 | 05 | | +-------------+------------+-------------------+-------------------+ | EF~ACMmax~ | 6F37 | 00 00 00 | Access condition | | | | | UPDATE: CHV1 | +-------------+------------+-------------------+-------------------+ | EF~SST~ | 6F38 | FF 3F C3 0F 0C 00 | | | | | FF 0F 00 33 | | +-------------+------------+-------------------+-------------------+ | EF~ACM~ | 6F39 | 00 00 00 | Access condition | | | | | UPDATE: CHV1 | +-------------+------------+-------------------+-------------------+ | EF~PUCT~ | 6F41 | FF FF FF 00 00 | Access condition | | | | | UPDATE: CHV1 | +-------------+------------+-------------------+-------------------+ | EF~BCCH~ | 6F74 | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~ACC~ | 6F78 | 00 00 | | +-------------+------------+-------------------+-------------------+ | EF~FPLMN~ | 6F7B | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~LOCI~ | 6F7E | FF FF FF FF 00 F0 | | | | | 00 00 00 FF 01 | | +-------------+------------+-------------------+-------------------+ | EF~AD~ | 6FAD | 00 FF FF | | +-------------+------------+-------------------+-------------------+ | EF~Phase~ | 6FAE | 03 | | +-------------+------------+-------------------+-------------------+ | EF~FDN~ | 6F3B | Default value in | Records: 5 | | | | all the records: | | | | | | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~SMSP~ | 6F42 | FF FF FF FF FF FF | Records: 1 | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~LND~ | 6F44 | FF FF FF FF FF FF | Records: 1 | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~SMSS~ | 6F43 | FF FF | | +-------------+------------+-------------------+-------------------+ | EF~SMS~ | 6F3C | 1^st^ record: 00 | Records: 3 | | | | FF ... FF(length | | | | | 176) | | | | | | | | | | 2^nd^ record:00 | | | | | FF ... FF(length | | | | | 176) | | | | | | | | | | 3^rd^ record: 00 | | | | | FF ... FF(length | | | | | 176) | | +-------------+------------+-------------------+-------------------+ | EF~ADN~ | 6F3A | FF FF FF FF FF FF | Records: 1 | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~CCP~ | 6F3D | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF | | +-------------+------------+-------------------+-------------------+ | EF~MSISDN~ | 6F40 | FF FF FF FF FF FF | Records: 1 | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~SDN~ | 6F49 | FF FF FF FF FF FF | Records: 1 | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF FF FF | | | | | FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~SUME~ | 6F54 | 85 0C 54 4F 4F 4C | | | | | 4B 49 54 20 54 45 | | | | | 53 54 FF FF FF FF | | +-------------+------------+-------------------+-------------------+ | EF~CBMI~ | 6F45 | FF FF | | +-------------+------------+-------------------+-------------------+ | EF~CBMID~ | 6F48 | 10 80 | | +-------------+------------+-------------------+-------------------+ | EF~CBMIR~ | 6F50 | 10 80 10 9F | | +-------------+------------+-------------------+-------------------+ | EF~IMG~ | 4F20 | FF FF FF FF FF FF | | | | | FF FF FF FF FF | | +-------------+------------+-------------------+-------------------+
The default value for the CHV1 shall be \"0x31 0x31 0x31 0x31 0xFF 0xFF 0xFF
0xFF\" and its state shall be \'disabled\' during test applets execution.
# C.2 Sim.Access.SimView test default prepersonalization
## C.2.1 DF~SIMTEST~ (SIM Test)
Identifier: \'0319\'
## C.2.2 EF~TNR~ (Transparent Never Read)
+----------------------+------------------------+---------------+-----+---------+ | Identifier: \'6F01\' | Structure: transparent | Mandatory | | | +======================+========================+===============+=====+=========+ | File size: 3 bytes | Update activity: low | | | | +----------------------+------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ NEVER | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +----------------------+------------------------+---------------+-----+---------+ | Bytes | Description | Default Value | M/O | Length | +----------------------+------------------------+---------------+-----+---------+ | 1 - 3 | Test Data | AA AA AA | M | 3 bytes | +----------------------+------------------------+---------------+-----+---------+
## C.2.3 EF~TNU~ (Transparent Never Update)
+----------------------+------------------------+---------------+-----+---------+ | Identifier: \'6F02\' | Structure: transparent | Mandatory | | | +======================+========================+===============+=====+=========+ | File size: 3 bytes | Update activity: low | | | | +----------------------+------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE NEVER | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +----------------------+------------------------+---------------+-----+---------+ | Bytes | Description | Default Value | M/O | Length | +----------------------+------------------------+---------------+-----+---------+ | 1 - 3 | Test Data | 55 55 55 | M | 3 bytes | +----------------------+------------------------+---------------+-----+---------+
## C.2.4 EF~TARU~ (Transparent Always Read and Update)
+----------------------+------------------------+---------------+-----+-----------+ | Identifier: \'6F03\' | Structure: transparent | Mandatory | | | +======================+========================+===============+=====+===========+ | File size: 260 bytes | Update activity: low | | | | +----------------------+------------------------+---------------+-----+-----------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +----------------------+------------------------+---------------+-----+-----------+ | Bytes | Description | Default Value | M/O | Length | +----------------------+------------------------+---------------+-----+-----------+ | 1 - 260 | Test Data | FF ... FF | M | 260 bytes | +----------------------+------------------------+---------------+-----+-----------+
## C.2.5 EF~CNR~ (Cyclic Never Read)
+------------------------+-----------------------+---------------+-----+---------+ | Identifier: \'6F04\' | Structure: cyclic | Mandatory | | | +========================+=======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: high | | | | +------------------------+-----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ NEVER | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+
## C.2.6 EF~CNU~ (Cyclic Never Update)
+------------------------+-----------------------+---------------+-----+---------+ | Identifier: \'6F05\' | Structure: cyclic | Mandatory | | | +========================+=======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: high | | | | +------------------------+-----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE NEVER | | | | | | | | | | | | INCREASE NEVER | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+
## C.2.7 EF~CNIC~ (Cyclic Never Increase)
+------------------------+-----------------------+---------------+-----+---------+ | Identifier: \'6F06 | Structure: cyclic | Mandatory | | | +========================+=======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: high | | | | +------------------------+-----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE NEVER | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+
## C.2.8 EF~CNIV~ (Cyclic Never Invalidate)
+------------------------+-----------------------+---------------+-----+---------+ | Identifier: \'6F07 | Structure: cyclic | Mandatory | | | +========================+=======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: high | | | | +------------------------+-----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE NEVER | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+
## C.2.9 EF~CNRH~ (Cyclic Never Rehabilitate)
+------------------------+-----------------------+---------------+-----+---------+ | Identifier: \'6F08\' | Structure: cyclic | Mandatory | | | +========================+=======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: high | | | | +------------------------+-----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE NEVER | | | | | +------------------------+-----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+
## C.2.10 EF~CARU~ (Cyclic Always Read and Update)
+------------------------+-----------------------+---------------+-----+---------+ | Identifier: \'6F09\' | Structure: cyclic | Mandatory | | | +========================+=======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: high | | | | +------------------------+-----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-----------------------+---------------+-----+---------+ | 1 | Test Data | 55 55 55 | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+ | 2 | Test Data | AA AA AA | M | 3 bytes | +------------------------+-----------------------+---------------+-----+---------+
## C.2.11 EF~LNR~ (Linear Fixed Never Read)
+------------------------+-------------------------+---------------+-----+---------+ | Identifier: \'6F0A\' | Structure: linear fixed | Mandatory | | | +========================+=========================+===============+=====+=========+ | Record length: 4 bytes | Update activity: low | | | | +------------------------+-------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ NEVER | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-------------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-------------------------+---------------+-----+---------+ | 1 | Test Data - Record 1 | FF FF FF FF | M | 4 bytes | +------------------------+-------------------------+---------------+-----+---------+ | 2 | Test Data - Record 2 | FF FF FF FF | M | 4 bytes | +------------------------+-------------------------+---------------+-----+---------+
## C.2.12 EF~LNU~ (Linear Fixed Never Update)
+------------------------+-------------------------+---------------+-----+---------+ | Identifier: \'6F0B\' | Structure: linear fixed | Mandatory | | | +========================+=========================+===============+=====+=========+ | Record length: 4 bytes | Update activity: low | | | | +------------------------+-------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE NEVER | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-------------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-------------------------+---------------+-----+---------+ | 1 | Test Data - Record 1 | FF FF FF FF | M | 4 bytes | +------------------------+-------------------------+---------------+-----+---------+ | 2 | Test Data - Record 2 | FF FF FF FF | M | 4 bytes | +------------------------+-------------------------+---------------+-----+---------+
## C.2.13 EF~LARU~ (Linear Fixed Always Read and Update)
+------------------------+-------------------------+---------------+-----+---------+ | Identifier: \'6F0C\' | Structure: linear fixed | Mandatory | | | +========================+=========================+===============+=====+=========+ | Record length: 4 bytes | Update activity: low | | | | +------------------------+-------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+-------------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+-------------------------+---------------+-----+---------+ | 1 | Test Data - Record 1 | 55 55 55 55 | M | 4 bytes | +------------------------+-------------------------+---------------+-----+---------+ | 2 | Test Data - Record 2 | AA AA AA AA | M | 4 bytes | +------------------------+-------------------------+---------------+-----+---------+
## C.2.14 EF~CINA~ (Cyclic Increase Not Allowed)
+-----------------+-----------------+---------------+-----+---------+ | Identifier: | Structure: | Mandatory | | | | \'6F0D\' | cyclic | | | | +=================+=================+===============+=====+=========+ | Record length: | Update | | | | | 3 bytes | activity: high | | | | +-----------------+-----------------+---------------+-----+---------+ | Access | | | | | | Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | (see note) | | | | | | | | | | | | INVALIDATE | | | | | | ALWAYS | | | | | | | | | | | | REHABILITATE | | | | | | ALWAYS | | | | | +-----------------+-----------------+---------------+-----+---------+ | Logical Record | Description | Default Value | M/O | Length | | Number | | | | | +-----------------+-----------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +-----------------+-----------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +-----------------+-----------------+---------------+-----+---------+ | NOTE: This file | | | | | | will be | | | | | | personalized in | | | | | | a way such that | | | | | | increase is not | | | | | | allowed, as | | | | | | indicated by | | | | | | the FCI byte 8, | | | | | | bit 7 (3GPP TS | | | | | | 51.011 [3]: | | | | | | FCI structure | | | | | | of an EF | | | | | | returned by the | | | | | | SELECT command) | | | | | +-----------------+-----------------+---------------+-----+---------+
## C.2.15 EF~TRAC~ (Transparent Read Access Condition CHV2)
+------------------------+------------------------+---------------+-----+---------+ | Identifier: \'6F0E\' | Structure: transparent | Mandatory | | | +========================+========================+===============+=====+=========+ | Record length: 3 bytes | Update activity: low | | | | +------------------------+------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ CHV2 | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+------------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+------------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+------------------------+---------------+-----+---------+
## C.2.16 EF~TIAC~ (Transparent Invalidate Access Condition CHV1)
+------------------------+------------------------+---------------+-----+---------+ | Identifier: \'6F0F\' | Structure: transparent | Mandatory | | | +========================+========================+===============+=====+=========+ | Record length: 3 bytes | Update activity: low | | | | +------------------------+------------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE CHV1 | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+------------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+------------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+------------------------+---------------+-----+---------+
## C.2.17 EF~CIAC~ (Cyclic Increase Access Condition CHV2)
+------------------------+----------------------+---------------+-----+---------+ | Identifier: \'6F10\' | Structure: cyclic | Mandatory | | | +========================+======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: low | | | | +------------------------+----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE CHV2 | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+----------------------+---------------+-----+---------+
## C.2.18 EF~CIAA~ (Cyclic Increase Access Condition ADM)
+------------------------+----------------------+---------------+-----+---------+ | Identifier: \'6F11\' | Structure: cyclic | Mandatory | | | +========================+======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: low | | | | +------------------------+----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | > INCREASE ADM | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE ALWAYS | | | | | +------------------------+----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+----------------------+---------------+-----+---------+
## C.2.19 EF~CNRI~ (Cyclic Never Rehabilitate Invalidated)
+------------------------+----------------------+---------------+-----+---------+ | Identifier: \'6F12\' | Structure: cyclic | Mandatory | | | +========================+======================+===============+=====+=========+ | Record length: 3 bytes | Update activity: low | | | | +------------------------+----------------------+---------------+-----+---------+ | Access Conditions: | | | | | | | | | | | | READ ALWAYS | | | | | | | | | | | | UPDATE ALWAYS | | | | | | | | | | | | INCREASE ALWAYS | | | | | | | | | | | | INVALIDATE ALWAYS | | | | | | | | | | | | REHABILITATE NEVER | | | | | +------------------------+----------------------+---------------+-----+---------+ | Logical Record Number | Description | Default Value | M/O | Length | +------------------------+----------------------+---------------+-----+---------+ | 1 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+----------------------+---------------+-----+---------+ | 2 | Test Data | 00 00 00 | M | 3 bytes | +------------------------+----------------------+---------------+-----+---------+
The file status shall be invalidated as defined in 3GPP TS 51.011 [3].
###### ## Annex D (normative): sim.test.util package and loading, testing and
cleaning script examples
See attached files:
\- Annex_D_SimTestUtil.zip
\- Annex_D_Examples.zip
###### ## Annex E (normative): Test Area files
See attached file:
\- Annex_E_SourceCode.zip
###### ## Annex F (normative): AID numbering and acronyms for Framework tests
# F.1 Toolkit Installation Parameters (TIN)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
Timer allocation TMAL 000001 Item identifier ITID 000010 Item position ITPO
000011 Access conditions ACCO 000100 Priority level PRLV 000101 Maximum length
for each menu entry MLME 000110 Number of menu entries NBME 000111 Memory
space MESP 001000 Channel Allocation CHAL 001001 Minimum Security Level MSL
001010
# F.2 Minimum Handler Availability (MHA)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
ProactiveHandler PAHD 000001 ProactiveResponseHandler PRHD 000010
EnvelopeHandler ENHD 000011 EnvelopeResponseHandler ERHD 000100
# F.3 Handler Integrity (HIN)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
ProactiveHandler PAHD 000001 ProactiveResponseHandler PRHD 000010
EnvelopeHandler ENHD 000011 EnvelopeResponseHandler ERHD 000100
# F.4 Applet Triggering (APT)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
EVENT_PROFILE_DOWNLOAD EPDW 000001 EVENT_MENU_SELECTION EMSE 000010
EVENT_MENU_SELECTION_HELP_REQUEST EMSH 000011 EVENT_FORMATTED_SMS_PP_ENV EFSE
000100 EVENT_UNFORMATTED_SMS_PP_ENV EUSE 000101 EVENT_CALL_CONTROL_BY_SIM ECCN
000110 EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM EMCN 000111
EVENT_TIMER_EXPIRATION ETEX 001000 EVENT_UNFORMATTED_SMS_CB EUCB 001001
EVENT_EVENT_DOWNLOAD_MT_CALL EDMC 001010 EVENT_EVENT_DOWNLOAD_CALL_CONNECTED
EDCC 001011 EVENT_EVENT_DOWNLOAD_CALL_DISCONNECTED EDCD 001100
EVENT_EVENT_DOWNLOAD_LOCATION_STATUS EDLS 001101
EVENT_EVENT_DOWNLOAD_USER_ACTIVITY EDUA 001110
EVENT_EVENT_DOWNLOAD_IDLE_SCREEN_AVAILABLE EDIS 001111
EVENT_EVENT_DOWNLOAD_CARD_READER_STATUS EDCR 010000
EVENT_UNRECOGNIZED_ENVELOPE EUEV 010001 EVENT_STATUS_COMMAND ESTC 010010
EVENT_EVENT_DOWNLOAD_LANGUAGE_SELECTION EDLG 010011
EVENT_EVENT_DOWNLOAD_BROWSER_TERMINATION EDBT 010100 EVENT_FORMATTED_SMS_CB
EFCB 010101 EVENT_FIRST_COMMAND_AFTER_SELECT EFCA 010110
EVENT_EVENT_DOWNLOAD_DATA_AVAILABLE EDDA 010111
EVENT_EVENT_DOWNLOAD_CHANNEL_STATUS EDCS 011000 EVENT_FORMATTED_SMS_PP_UPD
EFSU 011001 EVENT_UNFORMATTED_SMS_PP_UPD EUSU 011010
# F.5 Proactive Command Sending (PCS)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
System Proactive commands SPCO 000001 Interaction with GSM commands IGCO
000010 Errors during proactive command sending EPCS 000011 Proactive Command
Control PCCO 000100
# F.6 Envelope Response Posting (ERP)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
EVENT_CALL_CONTROL_BY_SIM ECCN 000001 EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EMCN 000010 EVENT_UNRECOGNIZED_ENVELOPE EUEN 000011 EVENT_FORMATTED_SMS_PP_ENV
EFSE 000010
# F.7 Framework Security (FWS)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
Input data INDA 000001 Output data OUDA 000010
# F.8 File System Context (FSC)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
Initial Context INIT 000001 Context Preservation for Current File CUFI 000010
Context Preservation for Current Record CURE 000011
# F.9 Exception Handling (EXH)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
Hide exception to the mobile HEME 000001 Interaction with multi-triggering
IMTG 000010
# F.10 Other parts transferred to framework from API (API)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
A handler is a temporary JCRE Entry Point object HEPO 000001 Transaction TRAN
000010 Timer Id between Applets TMID 000011
# F.11 Concatenation processing (PROC)
Test Area within the chapter Acronyms Numbering on 6 bits
* * *
Concatenation processing PROC 000001
###### ## Annex G (normative): Configuration Parameters File
This file describes all the mandatory and optional parameters that are used in
order to create the loading script(s) for one test area. The configuration
parameters file contains the values for the parameters needed in order to
generate the loading and cleanup scripts.
The name of the parameters file will be **_\ _\_.par**.
The number \ is associated with the loading/cleanup script number, i.e.
API_2_TKR_ SEVL_BSS_1.par is used to generate API_2_TKR_ SEVL_BSS_1.ldr etc.
# G.1 Syntax
The general syntax for this file will be:
> \ ::= \+
>
> \ ::= \ \ \
>
> \ ::= \'[\' \ \']\'
>
> \ ::= \+
>
> \ ::= \ \'=\' \ \
Where \'+\' indicates one or more repetitions of the previous syntax element.
Any text included between the symbol \'**;** \' and the end of line is
considered a comment and ignored by parsing tools.
Empty values are considered valid. They are used to indicate that an optional
value is not present.
Names of clauses, names of parameters and values are case-sensitive.
Blank spaces and Tabs between tokens are allowed and will be ignored by the
parser.
When values represent a sequence of bytes, they are expressed in hexadecimal
format, where every 2 digits represent one byte. Blank space between bytes is
optional.
Example:
; comment
[Clause1]
Parameter11 = 00 11 22 33
Parameter12 = 0101 ; another comment
[Clause2]
Parameter21 = vvwwxxyyzz
# G.2 File Contents and Organization
Parameters in this file are organized in the following clauses:
[CONVERT] Conversion parameters used during conversion (i.e. CAP file
generation)
* * *
[INSTALL(load)] Parameters used by the Install for Load command [LOAD]
Parameters used by the Load command [INSTALL(install)] Parameters used by the
Install for Install command
All clauses may appear only once in the file, except for the
\"INSTALL(install)\" clause. If that clause appears more than once, it will
apply to different applet instances, in sequence.
## G.2.1 Default values, order and processing
The ordering of the parameters and the clauses is relevant, since parameter
names may be repeated and apply to different applets.
When one single parameter is repeated within one clause, it refers to
different applets. The value of the _n^th^_ appearance of the parameter
applies to applet _n_.
When one clause is repeated (INSTALL(install)), then the _n^th^_ appearance of
the clause applies to applet _n_. Parameter/value pairs which are found in one
appearance of the clause are valid for the subsequent applets as long as they
are not overridden. For example, first INSTALL(install) may contain all values
for parameters, whereas the subsequent INSTALL(install) clauses may only
contain parameters whose values change.
If one required parameter is missing from one clause, the last defined value
of this parameter in a previous clause of the same file will be used.
## G.2.2 CONVERT Clause
These parameters allow configuration of the conversion process of the Java
class file(s) into one CAP file.
Parameter Description
* * *
PackageAID AID of the package PackageName Fully qualified name of the package
PackageVersion Version of the package AppletClassAID AID of the applet
AppletClassName Name of the applet
## G.2.3 INSTALL(load) Clause
Here are the parameters to be included in the Install(Load) command (as
specified in TS 23.048 [8] ).
Parameter Description
* * *
PackageAID AID of the package PackageNonVolatileMemSize Non Volatile memory
space (in bytes) required for package loading InstallationNonVolatileMemSize
Non volatile memory required for installation, in bytes
InstallationVolatileMemSize Volatile memory required for installation, in
bytes
## G.2.4 LOAD Clause
Here are the parameters to be included in the Load command (as specified in TS
23.048 [8] ).
Parameter Description
* * *
MaxLoadCommandDataLength Maximum length of the data provided in the load
command (P3 parameter of the LOAD APDU embedded in the command packet)
## G.2.5 INSTALL(install) Clause
Here are the parameters to be included in the Install(Install) command (as
specified in 3GPP TS 23.048 [8]).
Parameter Description
* * *
PackageAID AID of the package AppletClassAID AID of the applet InstanceAID AID
of the instance of the applet InstallationNonVolatileMemSize Non volatile
memory required for installation, in bytes InstallationVolatileMemSize
Volatile memory required for installation, in bytes AccessDomain Specify the
SIM files that may be accessed by the applet and the operations allowed on
these files. This parameter includes the Access Domain Parameter (ADP) and
Access Domain Data (ADD) PriorityLevel Priority level of the Toolkit applet
instance MaxNumberOfTimers Maximum number of timers allowed for this applet
instance MaxMenuEntryTextLength Maximum text length for a menu entry
MaxNumberOfMenuEntries Maximum number of menu entries allowed for this applet
instance MenuEntriesPositionIdentifier For each menu entry: Position and
identifier of that menu entry MaxNumberOfChannels Maximum Number of channels
for this applet instance MSLFieldLength Length of Minimum Security Level field
MSLParameter MSL Parameter MSLData MSL Data AppletSpecificParameters
Parameters specific to the applet
The applet shall be installed with install(install and make selectable)
command.
# G.3 Full example
> [CONVERT]
>
> PackageAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 00
>
> PackageName = sim.test.access.api_1_svw_updrbs
>
> PackageVersion = 1.0
>
> AppletClassAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 01
>
> AppletClassName = API_1_SVW_UPDRBS_1
>
> AppletClassAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 02
>
> AppletClassName = API_1_SVW_UPDRBS_2
>
> [INSTALL(load)]
>
> PackageNonVolatileMemSize = 0D27
>
> ;InstallationNonVolatileMemSize = 0400
>
> ;InstallationVolatileMemSize = 0000
>
> [LOAD]
>
> MaxLoadCommandDataLength = 6C ; max value
>
> [INSTALL(install)]
>
> AppletClassAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 01
>
> InstanceAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 01
>
> InstallationNonVolatileMemSize = 0400
>
> InstallationVolatileMemSize = 0000
>
> AccessDomain = 00
>
> PriorityLevel = FF
>
> MaxNumberOfTimers = 00
>
> MaxMenuEntryTextLength = 10
>
> MaxNumberOfMenuEntries = 01
>
> MenuEntriesPositionIdentifier = 0001
>
> AppletSpecificParameters =
>
> [INSTALL(install)]
>
> AppletClassAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 02
>
> InstanceAID = A0 00 00 00 30 00 02 FF FF FF FF 89 00 00 01 02
>
> InstallationNonVolatileMemSize = 0200
>
> InstallationVolatileMemSize = 0000
>
> MenuEntriesPositionIdentifier = 0002
>
> MaxNumberOfChannels = 05
>
> MSLFieldLength = 00
>
> MSLParameter =
>
> MSLData =
; rest of INSTALL(install) parameters are taken from previous
INSTALL(install)...
#
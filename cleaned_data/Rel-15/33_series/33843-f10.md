# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document contains a study of the security aspects of enhancements
to ProSe UE-to-Network Relay. Its objective is to identify threats when an
Evolved ProSe Remote UE with UICC connects to the network via an Evolved ProSe
UE-to-Network Relay. The potential requirements are identified based on threat
and the potential solutions are studied. Evaluations of solutions are captured
and the conclusion forms the basis for the potential normative work.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS)\".
[3] 3GPP TR 23.733: \"Study on Architecture Enhancements to ProSe UE-to-
Network Relay\".
[4] 3GPP TR 36.746: \" Study on further enhancements to LTE Device to Device
(D2D),User Equipment (UE) to network relays for Internet of Things (IoT) and
wearables \".
[5] 3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE)\".
[6] 3GPP TS 33.303: \" Proximity-based Services (ProSe)
[7] Forsberg D., \"LTE Security\", Wiley & Sons, 2010, First Edition.
[8] 3GPP TS 33.223: \"Generic Bootstrapping Architecture (GBA) Push function\"
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
eRelay-UE: as defied in TR 23.733 [3]
eRemote-UE: as defied in TR 23.733 [3]
**Indirect 3GPP Communication:** as defined in TR 23.733 [3]
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AKA Authentication and Key Agreement
B-TID Bootstrapping Transaction Identifier
C-RNTI Cell Radio Network Temporary Identifier
DUIK Discovery User Integrity Key
DUCK Discovery User Confidentility Key
DUSK Discovery User Scrambling Key
eProSe enhanced ProSe
GUTI Globally Unique Temporary UE Identity
GPI GBA Push Info
IMSI International Mobile Subscriber Identification Number
Ks(_ext)_NAF UICC external NAF-key in GBA_U
MIC Message Integrity Code
MITM Man-in-the-Middle Attack
MSISDN Mobile Subscriber International ISDN number
NCC Next hop Chaining Counter
PDCP Packet Data Convergence Protocol
PKMF ProSe Key Management Function
PRUK ID ProSe Relay User Key Identity
P-TID Push Temporary Identifier
REAR Remote UE access via relay UE
# 4 Overview of REAR
## 4.1 Introduction
This document studies key issues, threats and potential requirements for the
case when an eRemote-UE with 3GPP subscription discovers an eRelay-UE and
connects to a 3GPP network via the eRelay-UE. The document also proposes
security solutions to mitigate the security threats identified.
For discovery and indirect 3GPP communication, the document studies the
authentication and authorization of the eRemote-UE and the eRelay-UE, privacy
of the eRemote-UE, security of discovery and security of CP signalling and UP
data between the eRemote-UE and the 3GPP network.
This document also studies guaranteeing service continuity and the security of
path switching from direct communication path to indirect communication path,
and vice-versa. This includes the security of handover of eRemote-UE between
eRelay-UEs and handover of eRelay-UEs.
The key issues with security risks and requirements are analysed in clause 5
of this document, and the corresponding solutions are described in clause 6.
The document also gives conclusions for the key issues in clause 7.
## 4.2 Architecture
Some architecture assumptions are given in TR 23.733[3] and TR 36.746[4].
# 5 Key issues
## 5.1 Key Issue #1: Authorization for indirect 3GPP communication
### 5.1.1 Key Issue details
Based on the requirements of TS 22.278 [2], the following from TR 23.733[3]
are considered:
\- How does the network authorise whether a UE can act as an eRelay-UE?
\- How does the network authorise whether the eRemote-UE can access the
network through an eRelay-UE?
In TS 33.303 [6] clause 6.1 security of authorization for ProSe Direct
Discovery is described. In this clause the ProSe server is in charge of
providing the service authorization It should be studied whether this case can
work similarly a 3GPP network entity could also be possibly in charge of
authentication and authorization, e.g. MME or ProSe Function and may be
involved for authorization( and authentication) when an eRemote-UE accesses
network through eRelay-UE over PC5.
### 5.1.2 Security threats
As the eRelay-UE is a commercial terminal, the possibility of misbehaving
eRelay-UE is increasing compared to a public-safety only Relay UE. If a
malicious eRelay-UE which is not authenticated or authorized exists, this may
lead to a number of threats and attacks:
1\. Impersonation of a relayed user or network (injection of user-plane data);
2\. Eavesdropping of the user\'s communication;
3\. Replaying user/network communications;
4\. Offering a relay service while preventing some/all packets from transiting
the relay;
5\. Using the relay service to unnecessarily undermine the privacy of the
user.
If an eRemote-UE with subscription connecting to network indirectly is not
authenticated, the illegal eRemote-UE may misuse or abuse the network resource
by indirect accessing network, and causing attacks to the operator network.
The other procedures such as establishment of PC5 connection or discovery of
eRelay-UE need also to guarantee an eRemote-UE is authenticated, otherwise the
illegal eRemote-UE will discover or communicate with any eRelay-UE.
If an eRemote-UE is not authorized when connecting to network through a
certain eRelay-UE even it is authenticated, the unauthorized eRemote-UE would
waste the relay resource of eRelay-UE, take up control resource of network,
prevent the eRelay from providing relay service for authorized eRemote-UE, or
prevent the eRelay-UE from performing as a regular UE.
### 5.1.3 Potential security requirements
eRelay-UE shall be authorized by the network when providing eRelay Service.
eRemote-UE shall be authorized by the network when connecting to network via
the eRelay-UE.
## 5.2 Key Issue #2: Authentication of eRemote-UE via eRelay-UE
### 5.2.1 Introduction
In case an eRemote-UE attaches via an eRelay-UE to the network, it may be
required to authenticate. The question that this key issue seeks to answer is
whether an eRelay-UE can be authenticated via an eRemote-UE. This includes the
cases where the eRemote-UE attaches to network via eRelay-UE, as well as cases
where the UE is already authenticated by the network via Uu using existing
mechanism and then switches to eRelay-UE path.
### 5.2.2 Key Issue Details
In order to attach to the network via an eRelay-UE, an eRemote-UE may have to
authenticate to the network and vice versa. Because the eRelay-UE sits in
between the eRemote-UE and the network, it may have the possibility to perform
MITM, DoS, and replay attacks on the AKA between the eRemote-UE and the
network.
### 5.2.3 Security Threats
\- A man-in-the-middle attack by the eRelay-UE on the eRemote-UE and the
network;
\- A denial of service attack by the eRelay-UE on the eRemote-UE;
\- A replay attack of the authentication run by the eRelay-UE;
\- Impersonation of the eRemote-UE by the eRelay-UE.
### 5.2.4 Potential Security Requirements
\- The authentication between the eRemote-UE and the network shall be robust
against the above mentioned attacks;
\- The authentication between the eRemote-UE and the network shall match the
security level of EPS AKA.
## 5.3 Key Issue #3: IMSI Privacy of eRemote-UE
### 5.3.1 Introduction
TR 23.733 [3] contains a number of solutions where the IMSI may be sent from
the eRemote-UE to the eRelay-UE either as a result of the connection setup or
for allowing the eRelay-UE to listen to paging messages on behalf of the
eRemote-UE. This key issue deals with potential privacy issues of these
identifiers.
### 5.3.2 Key Issue Details
In order to establish bearers to the network via an eRelay-UE, an eRemote-UE
may have to perform an attach, TAU, or handover procedure. As a result, the
eRemote-UE and eRelay-UE will have to share identifiers in order to let the
network identify the two UEs involved in the indirect communication.
Additionally, the eRemote-UE may share its IMSI with the eRelay-UE after
connection setup in order to allow the eRelay-UE to forward paging messages.
Depending on the identifier used, revealing these may constitute a privacy
problem.
The TR 23.733 contains 10 solutions where identifiers are exchanged for the
purpose of setting up or switching to the indirect connection. In addition, TR
23.733 contains one solution for paging. Depending on the solution, the
identifiers that are exchanged (or sent via eRemote or eRelay-UE) are for
example the following:
\- GUTI, S-TMSI;
\- IMSI;
\- C-RNTI;
\- eProSe Discovery ID;
Of these identifiers, the GUTI, S-TMSI, C-RNTI and eProSe Discovery ID are
meant to be sent in the clear and have a temporary nature. The IMSI, however,
is not meant to be revealed and may have to be protected. The IMSI is sent
from the eRemote-UE to the eRelay-UE the following cases:
1\. When the eRemote-UE performs an initial attach via the eRelay-UE;
2\. When a TAU, NAS Service Request, or GUTI attach results in an error from
the network and an identity request;
3\. When the eRemote-UE and eRelay-UE have set up a connection and the IMSI is
forwarded to the eRelay-UE to enable IMSI-paging for the eRemote-UE.
It should be noted that the case 2 can also be done by a malicious eRelay-UE.
Furthermore, the case 3 describes the situation where the eRelay-UE and the
eRemote-UE have already established a connection and the eRemote-UE forwards
its IMSI to the eRelay-UE so that it can listen to paging messages on its
behalf.
Concluding, some procedures and functionality may require that the eRemote-UE
may send its IMSI to the eRelay-UE which may constitute a privacy problem.
### 5.3.3 Security Threats
Revealing eRemote-UE\'s the IMSI to the eRelay-UE is a breach of the user\'s
privacy.
### 5.3.4 Potential Security Requirements
\- The IMSI of the eRemote-UE shall never be sent to the network via the
eRelay-UE in clear text;
\- The IMSI of the eRemote-UE shall not be shared with the eRelay-UE for IMSI
paging.
## 5.4 Key Issues #4: Discovery
### 5.4.1 Key Issue details
In TS 33.303[6], the UE-to-Network Relay Discovery has been defined for Public
Safety Service. There are two models of relay discovery: model A and model B.
The parameters used for two model of discovery are configured by PKMF. Using
configured parameters the Remote UE could discovery the nearby Relay UE which
provides the desired relay service. It is noted that in R14 eRelay discovery,
eRemote-UE could also be provisioned with information which assists eRelay
discovery e.g. preference. Compared to the Relay discovery defined in TS
33.303[6], a requirement has been proposed:
The 3GPP system shall support pairing of an Evolved ProSe Remote UE and a
specific Evolved ProSe UE-to-Network Relay to allow for fast remote
connectivity setup with UE consent given, and/or MNO control applied, at the
time of pairing.
The eRemote-UE and eRelay-UE support pairing procedure to establish security
association based on which eRemote-UE could discovery eRelay-UE and setup
connectivity.
Based on the above analyses, the solution of Public Safety discovery in TS
33.303 [6] may not be sufficient, as the existing Relay discovery solution
doesn\'t address how the eRemote-UE discovery an eRelay-UE upon paired. From
this point of view, two types of discovery for eRelay discovery is proposed in
TR 23.733[2]. The former one is used when no trust relationship is setup and
the eRelay permits discovered by any eRemote-UE, while the latter one is used
when eRemote-UE and eRelay-UE has been paired and a trust relationship has
been setup, only the authorized eRemote-UE could discover eRelay-UE. Both
model A and model B are support for each type of discovery.
From perspective of security, no matter which type of discovery the
broadcasted discovery message needs integrity protection. In addition for the
restricted discovery, the discovery message also needs confidentiality and
replay protection, in this way only permitted eRemote-UE could discover eRelay
and that the discovery message would not be replayed at a later time.
### 5.4.2 Security threats
Malicious UE which is not authorized to use eRelay discovery service could
request for the security parameters of open discovery or restricted discovery,
and then pretend to be an eRelay-UE or eRemote-UE. The malicious eRelay-UE
leads to deplete other resource from monitoring the right eRelay-UE. The
malicious eRemote-UE will cause an illegal UE which is not authorized to
discover the eRelay-UE by open or restricted discovery and attack the eRelay-
UE.
If discovery messages announced in PC5 are not protected, security threats
such as replay, impersonation, and tracking UE can exist.
### 5.4.3 Potential security requirements
The system should support a method to mitigate the replay attack for open and
restricted discovery.
The system should provide a means of minimising the possibility of tracking of
UEs based on the content of their discovery messages over time.
The system shall support the prevention of impersonation attacks.
The identity announced on in the restricted discovery message shall be
protected from being understood by unauthorized UEs.
The parameters for discovery shall be configured securely in the eRemote-UE
and eRelay-UE.
## 5.5 Key Issues #5: Security of CP between eRemote-UE and network
### 5.5.1 Issue detail
Evolved ProSe UE-to-Network Relay, the network shall be able to identify,
address, authenticate and reach eRemote-UE when it accesses to network
indirectly. Based on the control plane protocols defined in TR 36.746[4],
there are NAS and RRC layer for eRemote-UE when connecting network indirectly
via eRelay-UE. Consistent with EPS, the NAS and RRC signalling shall be
integrity and confidentiality protected. Hence a security context shall be
established at CN and RAN entities.
### 5.5.2 Security threats
Without integrity protection, the signalling between UE and network can be
modified, injected and replayed by the attacker, which can lead to some severe
attacks such as UE impersonation, false network.
Without confidentiality protection, the signalling between UE and network can
be eavesdropped by the attacker or a misbehaving eRelay-UE, which can lead to
some attacks such as tracking eRemote-UE or collecting eRemote-UE\'s privacy
information.
### 5.5.3 Potential security requirements
Requirements on NAS and RRC signalling protection from TS 33.401[5] clauses
5.1.3 and 5.1.4 apply.
## 5.6 Key Issue #6: Security of Service Continuity
### 5.6.1 Issue detail
The requirement of service continuity for an eRemote-UE results in a number of
handover scenarios that need to be studied:
\- Handover between indirect mode and direct mode and vice versa:
Figure 5.6.1-1: Handover between direct and indirect mode
\- Handover of the eRemote-UE from one eRelay-UE to another eRelay-UE;
Figure 5.6.1-2: Handover between two eRelay-UEs
\- Handover of (a set of) eRemote-UE(s) when an eRelay-UE is handed over
between eNodeBs.
Figure 5.6.1-3: Handover over an eRelay-UE
The following clauses discuss the potential security issues with each
handover.
Of the above models, the first one (path switch from direct to indirect and
vice versa) is considered in both TR 36.746 [4] and TR 23.733 [3]. The second
one (path switch between two eRelay-UEs) is not considered in TR 23.733 [3] or
TR 36.476 [4]. The third one (handover of an eRelay-UE) is considered in TR
36.476 [4] and TR 23.733 [3]. For the third one it should be noted that the TR
36.476 considered a group handover, i.e. a handover of the whole group in one
go, too complex. The consideration in TR 23.733 is to hand each UE over
individually, which is different from the approach in TR 36.476 [4] and should
be the focus for this model within the scope of this document.
#### 5.6.1.1 Handover between indirect and direct mode and vice versa
##### 5.6.1.1.1 Handover from direct mode to indirect mode
When a eRemote-UE switches from direct mode to indirect mode, it may either
connect to an eRelay-UE that is connected to the same eNB as the eRemote-UE
was initially connected to, or it may connect to an eRelay-UE that is
connected to a different eNB than it was initially connected to. Said
differently, the switch from direct mode to indirect mode may also mean that
the endpoint of the PDCP layer is changed in the process.
The questions to be addressed are how and whether this type of handover is
managed from a security point of view, more specifically:
\- Whether new keys need to be derived;
\- How inputs for the key derivation function are shared between the eNB and
the eRemote-UE;
\- How the target eNB obtains the old key.
##### 5.6.1.1.2 Handover from indirect mode to direct mode
When a eRemote-UE switches from indirect mode to direct mode, it may encounter
the situation that the eNB that is connects to is different from the one that
it was connected to through the eRelay-UE, which means that the PDCP endpoint
may change in the process.
The questions to be addressed are how and whether this type of handover is
managed from a security point of view, more specifically:
\- Whether new keys need to be derived;
\- How inputs for the key derivation function are shared between the eNB and
the eRemote-UE;
\- How the target eNB obtains the old key;
#### 5.6.1.2 Handover between eRelay-UEs
When a eRemote-UE switches between eRelay-UEs, the PDCP endpoint may or may
not change. Similarly to the case with the handover between direct and
indirect mode, the questions to be addressed are how and whether this type of
handover is managed from a security point of view, more specifically:
\- Whether new keys need to be derived;
\- How inputs for the key derivation function are shared between the eNB and
the eRemote-UE;
\- How the target eNB obtains the old key.
#### 5.6.1.3 Handover of eRelay-UEs
When an eRelay-UE is handed over from one eNB to another, the PDCP endpoints
of all of the eRemote-UEs will also change. Effectively, the handover of one
eRelay-UE may therefore cause a simultaneous handover of a (set of) eRemote-
UE(s). The questions to be addressed are how and whether this type of handover
is managed from a security point of view, more specifically:
\- Whether new keys need to be derived;
\- How inputs for the key derivation function are shared between the eNB and
the eRemote- UE;
\- How the target eNB obtains the old key;
\- How the eNB can handle the load of multiple handovers at the same time.
### 5.6.2 Security threats
The security threats due to lack of key freshness and a compromise of a single
eNB include:
\- Eavesdropping of user and signalling plane data;
\- Manipulation of user and signalling plane data;
\- Insertion of user and signalling plane data;
\- Unauthorized usage of connection;
\- Denial of service on the eRemote-UE.
The security threats due to improper key derivations during handover include:
\- Denial of service on the eRemote-UE.
The security threats due to handing a large set of eRemote-UEs over at the
same time include:
\- Overload at the eNB.
### 5.6.3 Potential security requirements
The change of the eRemote-UE\'s PDCP endpoint due to a handover of the eRelay-
UE, due to the switching between direct and indirect mode, or the switching
between eRemote-UEs:
\- should have the capability to provide forward and backward security
(comparable to what is defined in TS 33.401 [5]) with respect to the access
network;
\- should guarantee service continuity;
\- should trade-off signalling load and security.
## 5.7 Key Issues #7: Authentication of eRemote-UE during Setting Up Indirect
3GPP Communication
### 5.7.1 Key Issue details
Before transferring signalling and data to the network from the eRemote-UE via
an eRelay-UE, one-to-one communication between the eRemote-UE and the eRelay-
UE shall be setup.
When a rogue eRemote-UE eavesdropped a PRUK ID or IMSI from a legal eRemote-
UE, and tries to establish the connection with an eRelay-UE, referencing the
solution of setting up one to one communication in [6], the eRelay-UE will
send a Key Request to the PKMF, and the PKMF will send the K~D~ corresponding
to the PRUK ID to the eRelay-UE before authenticating the eRemote-UE. The
eRelay-UE will send Direct Security Mode Command to the eRemote-UE and verify
the integrity of the Direct Security Mode Complete message sent from the
eRemote-UE. Only at this point, the eRelay-UE could know whether the eRemote-
UE is a legal UE or not.
Considering the eRelay-UE may serve multiple eRemote-UEs at the same time,
such rogue UEs as described above will waste the resource of the eRelay-UE and
prevent the eRelay-UE to provide normal services. So it is desirable to
authenticate the eRemote-UE as early as possible.
### 5.7.2 Security threats
If an eRemote-UE is not authenticated when setting up one-to-one communication
with an eRelay-UE, the unauthenticated eRemote-UE would waste the relay
resource of eRelay-UE, prevent the eRelay from providing relay service for
legal eRemote-UEs, or prevent the eRelay-UE from performing as a regular UE.
### 5.7.3 Potential security requirements
eRemote-UE shall be authenticated by the network for establishment of one to
one communication with eRelay-UE
## 5.8 Key Issue #8: Authentication of eRelay-UE
### 5.8.1 Issue Detail
This key issue is about authentication of an eRelay-UE. For an eRelay-UE there
are essentially two modes of operation, namely the mode where it functions as
a normal UE and a mode where it functions as a layer-2 relay in addition. In
the case it functions as a normal UE, authentication is required as per TS
33.401 [5]. For the eRelay-UE to function as a layer-2 relay, it will need to
receive ProSe discovery codes, it will need to receive authorization and it
will need to be identifiable by the network in order to provide resources.
Said differently, the network and UE will have to authenticate each other
before the eRelay-UE can be provisioned for the providing the service.
### 5.8.3 Security Threats
\- Without authentication, the eRelay-UE cannot determine whether it received
ProSe codes, authorization, and/or network resources;
\- Without authentication, the network cannot provide authorizations, ProSe
codes, and/or network resources for the service to work.
### 5.8.4 Potential Security Requirements
An eRelay-UE and the network should mutually authenticate each other.
## 5.9 Key Issue #9: User Plane protection between eRemote-UE and eNB
### 5.9.1 Issue detail
In case of indirect 3GPP communication, an eRemote-UE is connected to an eNB
through an eRelay-UE. In case the user plane are not properly protected, a
number of attacks launched by the eRelay-UE might result. Amongst others, the
eRelay-UE might eavesdrop on the eRemote-UEs communication, might insert data,
and might replay the eRemote-UEs data. The UP between the eRemote-UE and the
eNB should therefore be protected.
### 5.9.2 Security threats
The security threats due to lack of protection of the UP between the eRemote-
UE and the eNB include:
\- Eavesdropping of user plane data;
\- Insertion of user data;
\- Manipulation of user data;
\- Replay of user data.
### 5.9.3 Potential security requirements
Requirements on UP protection from TS 33.401 [5] clauses 5.1.3 and 5.1.4
apply.
# 6 Solutions
## 6.1 Solution #1: Authentication of eRemote-UE via eRelay-UE
### 6.1.1 Introduction
This solution addresses key issue #2.
### 6.1.2 Solution details
In order to authenticate an eRemote-UE that connects via an eRelay-UE, the
network and eRemote-UE shall follow the procedures as detailed in subclause
6.1 of TS 33.401 [5].
One possible deviation of subclause 6.1 could be derivation of a KeNB_relay
instead of a KeNB in case this is what is opted for in the solution #10.
### 6.1.3 Evaluation
This solution fulfils the requirements of key issue #2.
## 6.2. Solution #2: eRemote-UE Authentication with MITM detection
### 6.2.1 Introduction
The proposed solution tries to solve security threats described in Key issue
5.1 and key issue section 5.2 \"Authentication of eRemote-UE via eRelay-UE.\"
Currently, there is no security specified between eRemote-UE and layer 2 Relay
UE over the PC5 interface. Lack of security association between eRemote-UE and
Relay UE could introduce the possibility of DoS attacks which could prevent
public safety personnel and law enforcement to send or receive mission
critical messages. The attacks are performed by a malicious eRelay-UE which is
successfully placed itself between the eRemote-UE a legitimate eRelay-UE. In
this case, the malicious eRemote-UE acts as a man-in-the middle attacker,
presenting itself to eRemote-UE as a real eRelay-UE, and impersonating the
eRemote-UE to the real eRelay-UE. In successfully doing so, the malicious
eRelay-UE will be able to place itself in the path of data traffic (control
plane) between the eRemote-UE and eNB.
In this proposed solution, eRemote-UE or the eRelay-UE can detect the presence
of fake Relay UE using a two phased process is used. In the first phase, after
successful the initial attach by eRemote-UE with the core network, a security
context (Kr\') is generated for secure communication (with confidentiality and
integrity) between the eRemote-UE and eRelay-UE. The second phase involves a
man in the middle attack detection mechanism. The second phase is achieved by
using running a Fake Relay detection message Request/Response between the
eRemote-UE and Real Relay UE over the established SA.
## 6.2.2 Solution details
### 6.2.2.1 Authorization and Authentication of an eRemote-UE to Core Network
and security context establishment between eRemote-UE and eRelay-UE
The following Figure shows high-level steps for Security Context Key Kr\'
generation between eRemote-UE and eRelay-UE:
Figure 6.2.2.1-1: Kr\' security context between eRemote-UE and eRelay-UE.
a) First, the eRelay-UE follows the currently defined attach procedure in
clause 5.3.2.1 of TS 23.401 [2], normal authentication and authorization
process happens during attach procedure. NAS security with confidentiality and
integrity is required between eRelay-UE and the MME. Secondly, the eRemote-UE
establishes a PC5 connection with the eRelay-UE, and it authenticates to the
core network via the eRelay-UE.
b) K~ASME~ and NAS SMC is completed between MME and eRemote-UE.
c) MME generates K~r\'~ using NAS UPLINK count of eRemote-UE similar to K~eNB~
generation. Similarly, eRemote-UE generates the Kr\'.
d) MME sends the Kr\' generated to eRelay-UE encrypted using eRelay-UE\'s NAS
key here called as K~NAS_Relay_UE~. Both eRemote-UE and eRelay-UE share the
Kr\' and forms a secure channel between them.
NOTE: The existing mechanism in TS33.303 [6] is reused to establish security
between eRemote UE and eRelay UE.
### 6.2.2.2 Man in the middle attack detection mechanism
Following pre-conditions are assumed:
1) MITM detection message can be sent right after Initial Attach or
ReAuthentication
2) MITM detection message exchange can be bootstrapped by either eRemote-UE or
eRelay-UE. Following diagrams only show the message exchange started by
eRemote-UE.
The following Figure 3 shows high-level steps for MITM detection message
exchange:
Figure 6.2.2.2-1: Mutual Verification UE and Target eNB
1) eRemote-UE and eRelay-UE have already established the security context a
described in 6.X.2.1 above. A key Kr\' is shared between eRemote-UE and
eRelay-UE which can be used to form a secure connection between Remote and
Relay UEs.
2) Request-FakeUEDetection is generated by the remote-UE. This message is
encrypted using Kr\'.
a) The message includes the GPS location or any other relative location of the
eRemote-UE and other parameters that are unique to eRemote-UE/eRelay-UE. It
also includes a Nonce to prevent a Replay attack.
Note: The other parameters that eRemote-UE/eRelay-UE can send need to be
unique to the entities. Example of this may be radio-level and physical layer
measurements such as TA, CFO along with the timestamp Angle of Arrival, Angle
of departure, frequency offset of the oscillator, and RF characteristics of
the channel (e.g. second order statistics) over the encrypted link for
verification.
b) Upon reception of the Request-FakeUEDetection message, eRelayUE calculates
the unique property for either eRemote-UE/eRelay-UE with received GPS
location. It then compares the calculated unique characteristic with Actual
characteristic.
c) Upon comparing the two values, Relay UE can determine whether the Response-
FakeUEDetection is sent by Real eRemote-UE or FakeRelayUE. A Response-
FakeUEDetection is sent back to the eRemote-UE encrypted using Kr\'. A nonce
is also included in the payload to avoid a replay attack.
3) Upon receipt of the Response-FakeUEDetection message, the UE eRemote-UE can
either stop or continue the connection with the core network through eRelay-
UE.
### 6.2.3 Evaluation
This solution is a detection mechanism for MITM attacks that may occur during
a session. Since key issue #1 and key issue #2 address connection setup (i.e.
authentication and authorization), this solution does not address neither of
these key issues.
## 6.3 Solution #3: Authentication of eRelay-UE
### 6.3.1 Introduction
This solution addresses key issue #8.
### 6.3.2 Solution details
The eRelay-UE and network authenticate each other using EPS AKA as defined in
clause 6.1.1 of TS 33.401 [5]. No further authentication is necessary.
### 6.3.3 Evaluation
This solution addresses key issue #8 in a straightforward fashion.
## 6.4. Solution #4: Solution of Authorization for Indirect 3GPP Communication
### 6.4.1 Introduction
This solution addresses key issue 1.
### 6.4.2 Solution details
#### 6.4.2.1 eRelay-UE Authorization
Authorization of eRelay-UE follows the following pricinples:
\- When eRelay-UE attaches to network or transfers from ECM_IDLE state to
ECM_CONNECTED state, the eRelay-UE\'MME shall check whether the eRelay-UE is
authorized to be a L2-Relay based on subscription. If the authorization
successes, the ProSe Authorized IE is sent from the eRelay-UE\'s MME to eNB in
S1-AP message.
\- ProSe Function and PKMF shall perform service authorization with eRelay-UE
when configuring parameters of discovery.
#### 6.4.2.2 eRemote-UE Authorization
Authorization of eRemote-UE follows the following pricinples:
\- When the eRemote-UE accesses network indirectly, the eRemot UE\'s MME
checks based on subscription whether it could access network via eRelay-UE. If
yes, ProSe Authorized IE is sent to eNB in S1-AP message from the eRemote-
UE\'s MME.
\- ProSe Function and PKMF performs service authorization with the eRemote-UE
when configuring parameters of discovery.
\- PKMF performs service authorization of whether the eRemote-UE can access
network via specific eRelay during one-to-one communication between eRemote-UE
and eRelay-UE setting up procedure.
### 6.4.3 Evaluation
This solution reuses same mechanism as solution 6.1.5 in TR 23.733 [3] when
authorizing the UE for the service. In addition, in this solution the eRemote-
UE is also authorized by the PKMF during the procedure for setting up indirect
3GPP communication via specific eRelay-UE.
This solution addresses key issue 1.
## 6.5 Solution #5: Protection of the UP between eRemote-UE and eRelay-UE
### 6.5.1 Introduction
This solution addresses key issue #9.
### 6.5.2 Solution details
In order to protect the UP between the eRemote-UE and the eNB, this solution
takes advantage of existence of the PDCP-layer between the eRemote-UE and the
eNB. In this solution, the PDCP-layer is protected using the protection
specified in subclauses 5.1.2 and 5.1.3 from TS 33.401 [5].
This solution requires no further protection of the UP between the eRemote-UE
and eRelay-UE as protection is already provided by the PDCP-layer between the
eRemote-UE and eNB.
### 6.5.3 Evaluation
This solution addresses key issue #9 in a straightforward fashion.
## 6.6. Solution #6: Solution for protection of CP between eRemote-UE and
Network
### 6.6.1 Introduction
This solution addresses key issue #5.
### 6.6.2 Solution details
In this solution, NAS message between the eRemote-UE and the MME shall be
protected using EPS security context as specified in subclauses 5.1.3 and
5.1.4 in TS 33.401 [5]. The security mechanisms for NAS signalling are
consistent with subclause 7 in TS 33.401 [5]. The RRC message is protected at
PDCP-layer between the eRemote-UE and eNB. PDCP-layer is protected as
specified in subclauses 5.1.3 and 5.1.4 in TS 33.401 [5]. The security
mechanisms for RRC signalling are consistent with subclause 8 in TS 33.401[5].
### 6.6.3 Evaluation
This solution straightforwardly addresses key issue #5.
This solution addresses the key issue #5 using the legacy solution without
impacting the UE and the network functions.
## 6.7 Solution #7: Solution of IMSI privacy for attach via eRelay-UE
### 6.7.1 Introduction
This solution addresses key issue #3.
There are several scenarios that the eRemote-UE\'s IMSI will be seen by
eRelay-UE as followingï¼š
\- The eRemote-UE sends Attach message with eRemote-UE\'s IMSI when eRemote-UE
doesn\'t have a GUTI.
\- The eRemote-UE responses to an Identity Request with eRemote-UE\'s IMSI
when MME needs to the eRemote-UE\'s IMSI for authentication.
\- When existing mechanism of setting up one-to-one communication in TS
33.303[6] is re-used, the eRemote-UE sends Direct Communication request to the
eRelay-UE with eRemote-UE\'s IMSI when the eRemote-UE isn\'t configured with
PRUK.
For the first two cases, the eRemote-UE could use PRUK ID to replace the IMSI.
Before sending any NAS message, the eRemote-UE will acquire the PRUK ID which
can be used to identify the eRemote-UE. This requires that the mapping of the
PRUK ID and the IMSI will be stored at the network.
For the third case, the eRemote-UE could use other identity which is known by
PKMF to identify the eRemote-UE. This identity could be B-TID/P-TID generated
during bootstrapping procedure and used in acquring discovery security
parameters from the PKMF. If there is no B-TID/P-TID, MSISDN could be used.
### 6.7.2 Solution details
To protect the eRemote-UE\'s IMSI against the eRelay-UE, the one-to-one
communication establishment procedure and attach procedure shall be enhanced
as following:
NOTE1: The following flow focuses on concealing IMSI to the eRelay-UE. The
detailed procedure of one-to-one communication establishment will be described
in solution 6.X.
Figure 6.7.2:IMSI privacy when sending Attach from eRemote-UE
1) The eRemote-UE and the eRelay-UE fetch necessary security parameters
required to protect eRelay Discovery from the PKMF.
2) The eRemote-UE requests or updates PRUK from the PKMF.
3) The eRemote-UE discovers the eRelay-UE through whether Model A or Model B
eRelay Discovery.
4) The eRemote-UE sends Direct Communication Request to the eRelay-UE to
establish one-to-one connection with the eRelay-UE. The Direct Communication
Request contains the Long Term ID of the eRemote-UE. The Long Term ID is the
PRUK ID for the eRelay service. If the PRUK ID is not available, in order to
conceal IMSI against the eRelay-UE, the Long Term ID contains other identity
to identify the eRemote-UE, i.e. B-TID/P-TID generated during bootstrapping
procedure for acquiring discovery security parameters from the PKMF. If all of
above identities are not available, MSISDN of the eRemote-UE could be used.
NOTE2: As a successful discovery is perform before sending Direct
Communication Request, the eRemote-UE establishes TLS connection with the PKMF
to acquire discovery security parameter. Bootstrapping procedure is executed
for generating keys for TLS connection. So B-TID/P-TID derived from the
bootstrapping procedure are stored in the eRemote-UE.
NOTE3: For using MSISDN, it requires the PKMF stores the MSISDN.
5) The eRelay-UE sends Key Request to the PKMF. The Key Request contains the
PRUK ID or B-TID/P-TID or MSISDN received from the Direct Communication
Request.
6) The PKMF gets the eRemote-UE\'s IMSI based on the received PRUK ID or
B-TID/P-TID or MSISDN. The PKMF acquires the IMSI locally by the PRUK
ID/MSISDN or acquires from BSF by the indicated B-TID/P-TID.
7) The PKMF assists to establish one-to-one communication between the eRemote-
UE and the eRelay-UE. In this procedure, if PRUK ID is not received, the PKMF
fetches GPI and forms PRUK for eRemote-UE, and the PRUK ID is generated by the
PKMF and included in the GPI.
8) The PKMF update subcscription data in HSS by sending an Update
Subcscription Data message for the eRemote-UE. The PRUK ID and the eRemote-
UE\'s IMSI are included in the message. The HSS stores the mapping of the PRUK
ID and the eRemote-UE\'s IMSI.
9) The eRemote-UE sends an Attach message to MME. When eRemote-UE doesn\'t
have GUTI, the eRemote-UE will use the PRUK ID instead of IMSI to identify
itself.
10) The MME proceeds with the Attach message. When requesting authentication
data from the HSS, the PRUK ID is used as the eRemote-UE\'s identity.
11) The HSS identifies the IMSI of eRemote-UE based on the PRUK ID, and
responses with AV and the IMSI of eRemote-UE.
12) The MME performs other steps of attach procedure.
NOTE4: The mechanism for IMSI privacy is the same when the eRemote-UE
responses an Identity Response upon receiving an Identity Request.
### 6.7.3 Evaluation
This solution addresses the key issue #7 with impact on network functions. In
this solution, the MME stores the relationship of IMSI and PRUK ID acquired
from the PKMF via the HSS.
## 6.8. Solution #8: eRelay Discovery
### 6.8.1 General
There are two types of eRelay Discovery described in TR 23.733 [3]: eRelay
Open Discovery and eRelay Restricted Discovery.
\- eRelay Open Discovery: discovery can take place between an eRelay-UE and
eRemote-UE without requiring explicit permission (i.e., user interaction). The
message broadcasted for eRelay Open Discovery is not encrypted, so any
eRemote-UEs can interpret the message.
\- eRelay Restricted Discovery: discovery only takes place between the eRelay-
UE and eRemote-UE with explicit permission (i.e. user interaction). The
message broadcasted for eRelay Restricted Discovery is encrypted, so only the
eRemote-UEs with permission can interpret the message.
Both eRelay Open Discovery and eRelay Restricted Discovery support model A and
model B discovery.
In both Open and Restricted discovery, PKMF is re-used for configured
discovery key(s) e.g. PSDK. The PSDK will be used to derive the needed DUIK,
DUCK and optional DUSK. The mechanisms of using DUIK, DUCK and optional DUSK
to protect discovery message are the same as ProSe in TS 33.303 [6].
Like the usage in ProSe, eRelay discovery also use UTC-based counter to
provide freshness for the discovery message against replay attack. The
parameters CURRENT_TIME and MAX_OFFSET are also provided to UE from the PKMF
to ensure that the obtained UTC-based counter is sufficiently close to real
time.
### 6.8.2 Solution details
#### 6.8.2.1 eRelay Open Discovery
The configuration of security material for protection of eRelay Open Discovery
message is the same as the flow shown in TS 33.303 [6] Figure 6.6.4.1.
The eRelay-UE and the eRemote-UE will use the configured security parameters
for protection of eRelay Open Discovery message according to the subclause
6.6.7 of TS 33.303[6], in which:
\- the eRelay-UE and the eRemote-UE only calculates DUIK from PSDK without
calculating DUCK or DUSK, and then follows the subclause 6.1.3.4.3.2 and
6.1.3.4.3.3 in TS 33.303[6].
If the eRemote-UE is configured with the security material for a specific
eRelay Service or a particular eRelay-UE as above, the eRemote-UE can check
MIC by itself.
#### 6.8.2.2 eRelay Restricted Discovery
The eRelay-UE and the eRemote-UE are configured with security material for
protection of eRelay Restricted Discovery message in the same way as the flow
shown in TS 33.303[6] Figure 6.6.4.1.
The eRelay-UE and the eRemote-UE will use the configured security parameters
for protection of eRelay Restricted Discovery message according to the
subclause 6.6.7 of TS 33.303[6], in which:
\- DUIK and DUCK shall be derived, DUSK is optional, and then follows the
subclause 6.1.3.4.3.2 and 6.1.3.4.3.3 in TS 33.303[6].
### 6.8.3 Evaluation
This solution addresses the key issue #4. The security function of eRelay
Discovery reuses the mechanism in R13 satisfying the requirement of eRelay
Discovery defined in 3GPP TR 23.733[3].
## 6.9 Solution #9: Path Switch of direct to indirect 3GPP Communication and
vice versa
### 6.9.1 Introduction
This solution addresses key issue #6. In particular, it deals with the
security of the switch from direct to indirect 3GPP Communication by the
eRemote-UE. In this solution, it is assumed that the eRemote-UE is in RRC
Active state. The following scenarios are considered:
1\. The eRemote-UE switches path between indirect and direct 3GPP
communication under the same eNB;
2\. The eRemote-UE switches path between indirect and direct 3GPP
communication under different eNBs.
### 6.9.2 Solution details
#### 6.9.2.1 eRemote-UE path switch under the same eNB
##### 6.9.2.1.1 Preconditions
For the switch from direct to indirect, the following preconditions apply:
\- The eRemote-UE has discovered an eRelay-UE;
\- The eRemote-UE has sent a path switch request to the network;
\- The network has determined that the eRelay-UE and the eRemote-UE are served
by the same eNB;
\- The network does not initiate a handover procedure for the eRemote-UE.
For the switch from indirect to direct, the following preconditions apply:
\- A path switch request has been initiated by either the network or the
eRemote-UE;
\- The network has determined that the eRelay-UE and the eRemote-UE are served
by the same eNB;
\- The network does not initiate a handover procedure for the eRemote-UE.
NOTE: For this solution it is irrelevant whether the path switch was requested
using a NAS or AS message, as is distinguished in TR 23.733 [3].
##### 6.9.2.1.2 Solution Variant a): Without special relay key
When switching from direct to indirect 3GPP communication, the eNB and the UE
continue to use the keys that are in use. This does not preclude that the eNB
and UE do not refresh the key due to triggers defined in TS 33.401 [5].
When switching from indirect to direct 3GPP communication, the eNB and the UE
continue to use the keys that are in use. This does not preclude that the eNB
and UE do not refresh the key due to triggers defined in TS 33.401 [5].
The NCC value is not incremented when doing any of these path switches, and
the COUNT value continues to be used as normal.
##### 6.9.2.1.3 Solution Variant b): With special relay key
When switching from direct to indirect 3GPP communcation, the eNB and the UE
derive a new key, specifically meant for relayed communication from k~eNB~
that was in use before. The relay key is derived as follows (notation
according to Forsberg et al. [7]):
k~eNB_REAR~ = KDF(k~eNB~, input string)
where the subscript \"eNB_REAR\" indicates that the key has the same function
as a regular k~eNB~ and that it is only used for the derivation of keys
(K~RRCenc~, K~RRCint~, K~UP~) meant to protect traffic that is relayed through
an eRemoteUE. The input string could contain:
\- The eRelay-UE identifier used in the path switch request;
\- The channel identifier;
\- A nonce provided by the eNB in the handover command;
\- A nonce provided by the UE in the path switch request;
\- A static string, e.g. \"REAR\".
In the process, the NCC counter is not incremented and the COUNT value is
reset.
When switching from indirect to direct 3GPP communication, the eNB and the UE
derive a fresh k~eNB*~ according to the X2-handover procedure:
K~eNB*~ = KDF(K~eNB_REAR~, PCI, EARFCN-DL).
#### 6.9.2.2 eRemote-UE Mobility under a different eNB
##### 6.9.2.2.1 Preconditions
For the switch from direct to indirect, the following preconditions apply:
\- The eRemote-UE has discovered an eRelay-UE;
\- The eRemote-UE has sent a path switch request to the network;
\- The network has determined that the eRelay-UE and the eRemote-UE are served
by different eNBs;
\- The network has initiated a handover procedure for the eRemote-UE.
For the switch from indirect to direct, the following preconditions apply:
\- A path switch from indirect to direct has been initiated by the network or
the eRemote-UE;
\- The network has determined that the eRelay-UE will be served by a different
eNB;
\- The network has initiated a handover procedure for the eRemote-UE.
NOTE: For this solution it is irrelevant whether the path switch was requested
using a NAS or AS message as is defined in TR 23.733 [3].
##### 6.9.2.2.2 Solution Variant a): Without special relay key
When switching from direct to indirect 3GPP communication or vice versa, the
eNB and the UE derive the k~eNB*~ according to the mechanism specified in TS
33.401 [5]. These derivations can be notated as follows:
K~eNB*~ = KDF(K~eNB~, PCI, EARFCN-DL) in case of a horizontal handover
K~eNB*~ = KDF(NH~NCC~, PCI, EARFCN-DL) in case of a vertical handover
##### 6.9.2.2.3 Solution Variant b): With special relay key
When switching from direct to indirect 3GPP communication, the eNB and the UE
derive a new key, specifically meant for relayed communication from k~eNB~
that was in use before. The relay key is derived as follows:
K~eNB_REAR~ = KDF(K~eNB~, input string) in case of a horizontal handover
K~eNB_REAR~ = KDF(NH~NCC~, input string) in case of a vertical handover
where the subscript \"eNB_REAR\" indicates that the key has the same function
as a regular k~eNB~ and that it is only used for the derivation of keys
(K~RRCenc~, K~RRCint~, K~UP~) meant to protect traffic that is relayed through
an eRemoteUE. The input string could contain:
\- The eRelay-UE identifier used in the path switch request;
\- The channel identifier;
\- A nonce provided by the eNB in the handover command;
\- A nonce provided by the UE in the path switch request
\- A static string \"REAR\".
In case of a vertical handover, the NCC value is increased. In either case,
the COUNT value is reset.
When switching from indirect to direct 3GPP communication, the eNB and the UE
derive a fresh k~eNB*~ either according to the X2 or S1 handover procedure,
namely
K~eNB*~ = KDF(K~eNB_REAR~, PCI, EARFCN-DL) in case of a horizontal handover;
K~eNB*~ = KDF(NH~NCC~, PCI, EARFCN-DL) in case of a vertical handover.
The NCC value and COUNT values are handled according to TS 33.401 [5].
### 6.8.3 Evaluation
This solution addresses key issue #6, and in particular the switch from direct
to indirect 3GPP Communication under different and same eNBs.
The solution variants A reuse existing mechanisms from TS 33.401 in order to
derive keys that are used for protecting the communication between the eRelay-
UE and the eNB. The solution variants B differ in that they derive a key
specifically for relaying.
Both variants meet the security goals of key issue #6. There are no specific
advantages for using solution variant A or solution variant B over one-
another.
The solution variant B has more impact on the eNB than solution A, because in
solution B the eNB will have to use different inputs for the derivation of the
keys of the eRelay-UE
## 6.10 Solution #10: Handover of eRemote-UE from one eRelay to another
### 6.10.1 Introduction
This solution addresses key issue #6. In particular, it deals with the
handling of the security context of the eRemote-UE in case of a handover from
one eRelay-UE to another eRelay-UE. In this solution, it is assumed that the
eRemote-UE is in RRC Active state. The following scenarios are considered:
1\. The eRemote-UE is handed over from one eRelay-UE to another eRelay-UE that
are under the same eNB;
2\. The eRemote-UE is handed over from one eRelay-UE to another eRelay-UE
which are under different eNBs.
### 6.10.2 Solution details
#### 6.10.2.1 Handover under the same eNB
##### 6.10.2.1.1 Preconditions
For the handover from one eRelay-UE to another, the following preconditions
apply:
\- The eRemote-UE has discovered a new target eRelay-UE;
\- The eRemote-UE has sent a path switch request to the network;
\- The network has determined that the target eRelay-UE and the eRemote-UE are
served by the same eNB;
\- The network does not initiate a handover procedure for the eRemote-UE.
NOTE: For this solution it is irrelevant whether the path switch was requested
using a NAS or AS message, as is distinguished in TR 23.733 [3].
##### 6.10.2.1.2 Solution Variant a): Without special relay key
In this solution variant, the eNB and the UE continue to use the keys that are
in use. This does not preclude that the eNB and UE do not refresh the key due
to triggers defined in TS 33.401 [5].
The NCC value is not incremented when doing the handover from the source
eRelay-UE to the target eRelay-UE, and the COUNT value continues to be used as
normal.
##### 6.10.2.1.3 Solution Variant b): With special relay key
In this solution variant, the eNB and the UE may derive a new relay key or
not. In case the network decides that no new keys are necessary, the eNB
indicates that in the path switch command message and the UE and eNB continue
to use the same keys as is described in solution variant a) in the above
clause 6.SC2.2.1.2.
In case the network decides that a fresh key is necessary, the eNB and the UE
derive a fresh k~eNB_REAR*~ from k~eNB_REAR~. This relay key is derived as
follows (notation according to Forsberg et al. [7]):
k~eNB_REAR*~ = KDF(k~eNB_REAR~, input string)
where the subscript \"eNB_REAR\" indicates that the key has the same function
as a regular k~eNB~ and that it is only used for the derivation of keys
(K~RRCenc~, K~RRCint~, K~UP~) meant to protect traffic that is relayed through
an eRemoteUE. The input string could contain:
\- The eRelay-UE identifier used in the path switch request;
\- The channel identifier;
\- A nonce provided by the eNB in the handover command;
\- A nonce provided by the UE in the path switch request;
\- A static string, e.g. \"REAR\".
In the process, the NCC counter is not incremented and the COUNT value is
reset.
#### 6.10.2.2 Handover under a different eNB
##### 6.10.2.2.1 Preconditions
For the handover from one eRelay-UE to another, the following preconditions
apply:
\- The eRemote-UE has discovered a new target eRelay-UE;
\- The eRemote-UE has sent a path switch request to the network;
\- The network has determined that the target eRelay-UE and the eRemote-UE are
served by different eNBs;
\- The network has initiated a handover procedure for the eRemote-UE.
NOTE: For this solution it is irrelevant whether the path switch was requested
using a NAS or AS message as is defined in TR23.733 [3].
##### 6.10.2.2.2 Solution Variant a): Without special relay key
When handing over the eRemote-UE from one eRelay-UE to another eRelay-UE that
is served by a different eNB, the eNB and the UE derive a fresh k~eNB*~
according to the mechanism specified in TS 33.401 [5]. These derivations can
be notated as follows:
K~eNB*~ = KDF(K~eNB~, PCI, EARFCN-DL) in case of a horizontal handover;
K~eNB*~ = KDF(NH~NCC~, PCI, EARFCN-DL) in case of a vertical handover.
##### 6.10.2.2.3 Solution Variant b): With special relay key
In this solution variant, the eNB and the UE may derive a fresh relay key or
not. The network may only decide not to derive a fresh key in case the
handover is a horizontal handover (in a vertical handover, a fresh relay key
should always be derived). In case the network decides that no new keys are
necessary, the eNB indicates that in the path switch command message and the
UE continues to use the same relay key. The source eNB then provides the
target eNB with the k~eNB_REAR~.
In case the network decides that a new relay key is necessary, i.e. the
handover is a vertical handover or the network deems the previous key too old,
the eNB and the UE derive a fresh key k~eNB_REAR*~ from the k~eNB_REAR~ or
NH~NCC~ that was in use before. The relay key is derived as follows:
K~eNB_REAR*~ = KDF(K~eNB_REAR~, input string) in case of a horizontal handover
K~eNB_REAR*~ = KDF(NH~NCC~, input string) in case of a vertical handover
where the subscript \"eNB_REAR\" indicates that the key has the same function
as a regular k~eNB~ and that it is only used for the derivation of keys
(K~RRCenc~, K~RRCint~, K~UP~) meant to protect traffic that is relayed through
an eRemote-UE. The input string could contain:
\- The eRelay-UE identifier used in the path switch request;
\- The channel identifier;
\- A nonce provided by the eNB in the handover command;
\- A nonce provided by the UE in the path switch request
\- A static string \"REAR\".
### 6.10.3 Evaluation
This solution addresses key issue #6, and in particular the path switch of an
eRemote-UE from one eRelay-UE to another eRelay-UE. The solution addresses
both scenarios where the eRelay-UEs are served by the same and by two
different eNBs.
The solution variants A reuse existing mechanisms from TS 33.401 in order to
derive keys that are used for protecting the communication between the eRelay-
UE and the eNB. The solution variants B differ in that they derive a key
specifically for relaying.
Both variants meet the potential security requirements of key issue #6.
An advantage of solution variant B over solution variant A is that in variant
B it is possible to refrain from deriving a new key whenever the path switch
results in a change of eNB at the same time as detailed in subclause
6.10.2.2.3. The drawback of the variant B is that this comes at the cost of
changes in the eNB and the signalling for horizontal handovers.
This solution has no corresponding solution on path switch between two eRelay-
UEs in TR 23.733 [3]. This solution is therefore not pursued for normative
work.
## 6.11 Solution #11: Handover of eRelay-UE
### 6.11.1 Introduction
This solution addresses key issue #6. In particular, it deals with the
handling of the security context of the eRemote-UE in case of a handover of a
eRelay-UE from one eNB to another. In this solution, it is assumed that the
eRemote-UE is in RRC Active state and that the eRemote-UE continues to use the
same eRelay-UE.
### 6.11.2 Solution details
#### 6.11.2.1 Handover of the eRelay-UE
##### 6.11.2.1.1 Preconditions
For the handover of a eRelay-UE to another eNB, the following preconditions
apply:
\- The network has determined that the target eRelay-UE and the eRemote-UE are
served by the same eNB;
\- The network has initiated a handover procedure for the eRelay-UE.
NOTE: For this solution it is irrelevant whether the path switch was requested
using a NAS or AS message, as is distinguished in TR 23.733 [3].
##### 6.11.2.1.2 Solution Variant a): Without special relay key
When handing over the eRelay-UE from one eNB to another eNB, new keys should
be derived for all eRemote-UEs connected through that specific eRelay-UE. The
affected eRemote-UEs and the target eNB should derive a fresh k~eNB*~
according to the mechanism specified in TS 33.401 [5]. These derivations can
be notated as follows (notation according to Forsberg et al. [7]):
K~eNB*~ = KDF(K~eNB~, PCI, EARFCN-DL) in case of a horizontal handover;
K~eNB*~ = KDF(NH~NCC~, PCI, EARFCN-DL) in case of a vertical handover.
##### 6.11.2.1.3 Solution Variant b): With special relay key
In this solution variant, the eNB and the eRemote-UE may derive a new relay
key or not. The network may decide to do so in case of a horizontal over. In
case of a vertical handover a new key should be derived.
When a an eRelay-UE is handed over from a source eNB to a target eNB and the
handover is an X2 handover, the network may decide that no new keys are
necessary. In this case, there will not be any communication between the
source eNB and the eRemote-UE(s) that are being handed over simultaneously
with the eRelay-UE. Effectively, the eRemote-UE is unaware of the handover. In
the network, the source eNB will initiate a normal X2 handover procedure for
the eRelay-UE and when this handover takes place, the source eNB will provide
the target eNB with the security contexts of the eRemote-UEs that are
connected to the eRelay-UE.
In case the network decides that a fresh key is necessary, the eNB and all the
eRemote-UE(s) that are connected through the eRelay-UE that is handed over
derive a fresh k~eNB_REAR*~ from k~eNB_REAR~. This relay key is derived as
follows:
k~eNB_REAR*~ = KDF(k~eNB_REAR~, input string)
where the subscript \"eNB_REAR\" indicates that the key has the same function
as a regular k~eNB~ and that it is only used for the derivation of keys
(K~RRCenc~, K~RRCint~, K~UP~) meant to protect traffic that is relayed through
an eRemoteUE. The input string could contain:
\- The eRelay-UE identifier used in the path switch request;
\- The channel identifier;
\- A nonce provided by the eNB in the handover command;
\- A nonce provided by the UE in the path switch request;
\- A static string, e.g. \"REAR\".
### 6.11.3 Evaluation
This solution addresses key issue #6, and in particular the handover an
eRelay-UE from one eNB to another while one or more eRemote-UEs are connected
via this eRelay-UE.
The solution variants A reuse existing mechanisms from TS 33.401 in order to
derive keys that are used for protecting the communication between the eRelay-
UE and the eNB. The solution variants B differ in that they derive a key
specifically for relaying.
Both variants meet the potential security requirements of key issue #6.
An advantage of solution variant B over solution variant A is that in variant
B it is possible to refrain from deriving a new key for eNB at the same time
as detailed in subclause 6.11.2.2.3. The drawback of the variant B is that
this comes at the cost of changes in the eNB and the signalling for horizontal
handovers.
The corresponding solution on handovers of eRelay-UEs in TR 23.733 [3] is
solution 6.5.5 which is also selected for normative work. The solution 6.5.5
in TR 23.733 is more alike solution variant A. It is therefore proposed to
select solution variant A for normative work.
## 6.12 Solution #12: Enhancement of Setting Up Connection between eRemote-UE
and eRelay-UE
### 6.12.1 Introduction
This solution is to address key issue #7.
In the solution, the eRemote-UE is firstly authenticated and authorized by the
PKMF, if authentication and authorization succeed, the PKMF assists to
establish the one-to-one communication between the eRemote-UE and the eRelay-
UE, else the PKMF terminates the procedure.
### 6.12.2 Solution details
The call flow is identical to the description in TS 33.303[6] subclause
6.7.3.2.1.1 with the following enhancement:
3\. The eRemote-UE calculates MIC using the PRUK for authentication of the
eRemote-UE. Fresh information shall be used for generating the MIC. The fresh
information could be time information of the eRemote-UE associated with the
time slot of sending the Direct Communication Request message, e.g. UTC-based
counter which is used in discovery. The MIC and the fresh information are
transferred in the Direct Communication Request. If no PRUK is stored in the
eRemote-UE, the eRemote-UE may use Ks(_ext)_NAF stored in the eRemote-UE
instead of the PRUK. The existing Ks(_ext)_NAF is generated during
bootstrapping procedure when the eRemote-UE communicating with the PKMF to
acquire discovery security parameters. In this case B-TID/P-TID is associated
with the Ks(_ext)_NAF and is used to identify the eRemote-UE for the PKMF.
NOTE3: The MIC could be calculated as sub clause A.2 in TS 33.303[6] in which
a new type of message type should be defined.
4a. The PKMF shall further check the MIC to authenticate the eRemote-UE. The
PRUK or the Ks(_ext)_NAF corresponding to PRUK ID or B-TID/P-TID respectively
is retrieved by the PKMF.
4b. If the PKMF authenticates the eRemote-UE successfully, it proceeds the
following procedure as specified in 33.303[6] subclause 6.7.3.2.1.1 from 4b to
5b.
If the authentication of the eRemote-UE fails, the PKMF shall send Key
Response with error code. The eRelay-UE rejects Direct Communication Request
from the eRemote-UE.
### 6.12.3 Evaluation
This solution proposes to reuse the one-to-one communication establishment
mechanism defined in 33.303[6] between eRemote UE and eRelay UE. However, the
existing solution doesn\'t consider the case that eRemote UE is a UE with 3GPP
subscription, and lacks of authentication to the eRemote UE. In which case, a
rogue eRemote UE could eavesdrop a PRUK ID or IMSI from a legal eRemote UE,
and try to establish the connection with an eRelay UE. This will make eRelay
UE to interact with PKMF. The PKMF could not verify the eRemote UE only purely
based on PRUK ID or IMSI. Until the eRelay UE checks the integrity of Direct
Security Mode Complete message sent from the eRemote UE, the eRelay UE will
know the eRemote UE is an illegal UE and refuse the service from the eRemote
UE. If multiple rogue UEs as described above exits, they will waste the
resource of the eRelay UE and prevent the eRelay UE to provide normal
services. So it is necessary to authenticate the eRemote UE by the PKMF so as
to avoid waste resource of the eRelay UE.
This solution addresses key issue #7 by authenticating the eRemote UE by the
PKMF before establishing one-to-one communication.
## 6.13 Solution #13: Security Parameters Configuration on eRemote-UE during
Dynamic Trust Relationship Establishment
### 6.13.1 Introduction
This solution is to address key issue #4.
This solution provides the security protection for dynamic trust relationship
establishment as defined in subclause 6.1.4 of [3].
### 6.13.2 Solution details
0) The eRemote-UE discovers eRelay-UE using eRelay-UE Open Discovery.
1) The eRemote-UE sends a Bonding Request message (eRemote-UE ID) to the
eRelay-UE to establish trust relationship.
2) The eRelay-UE responds with a Bonding Request Acknowledge message to the
eRemote-UE.
3) If the eRelay-UE determines to provide the relay service for the eRemote-
UE, the eRelay-UE sends a Trust Relationship Establishment Request Message
(eRemote-UE ID, eRelay-UE ID) to the ProSe Function in HPLMN.
4) The ProSe Function in HPLMN checks whether the eRelay-UE is authorised to
act as an eRelay-UE and the eRemote-UE is authorised to access the network
through an eRelay-UE. If the eRelay-UE and the eRemote-UE are both authorised,
the ProSe Function in HPLMN establishes the trust relationship between the
eRemote-UE and the eRelay-UE, and responds to the eRelay-UE with a Trust
Relationship Establishment Response (eRemote-UE container) message. The
security parameters and other eRelay Restricted Discovery information are
included in the eRemote-UE container. The security parameters are the key used
for eRelay Restricted Discovery.
NOTE: detail information in the message of this flow is defined in 3GPP TR
23.733 [3].
> In order to protect the eRemote-UE container, the ProSe Function shall
> request GBA Push Info (GPI) as defined in TS 33.223 [8] for the eRemote-UE
> from the BSF if Zn interface is supported, the ProSe Function receives GPI
> and Ks(_ext)_NAF. Otherwise, if PC4a interface is supported, the PKMF shall
> request an Authentication Vector (AV) for the eRemote-UE from HSS, the ProSe
> Function locally forms the GPI and Ks(_ext)_NAF.
>
> The ProSe Function derives a Key~enc~ and Key~int~ from the Ks(_ext)_NAF and
> Nonce as specified in annex X. The Key~enc~ and the Key~int~ are used to
> encrypt and integrity protect the eRemote-UE container separately. Nonce is
> the fresh parameter generated by the ProSe Function. The GPI and the Nonce
> are also included in the Trust Relationship Establishment Response message.
NOTE: the KDF to derive Keyenc and Keyint from the Ks(_ext)_NAF will be
defined in normative work if this solution is accepted.
> 5) The eRemote-UE receives the Trust Relationship establishment Notification
> message which includes the eRemote-UE container, GPI and Nonce. The eRemote-
> UE shall calculate the Ks(_ext)_NAF based on the GPI, and derives Key~enc~
> and Key~int~ from the Ks(_ext)_NAF and the fresh parameters in the same way
> as the ProSe Function. The eRemote-UE uses the Key~enc~ to decrypt the
> eRemote-UE container and uses the Key~int~ to check the integrity of the
> eRemote-UE container. If verification is successful, the eRemote-UE shall
> save the information contained in the eRemote-UE container.
### 6.13.3 Evaluation
This solution claims to address key issue 4, but in fact does not deal with
any of the requirements of key issue 4. Also, the corresponding solution 6.1.4
in TR 23.733 [3] is not selected for normative work. This solution is
therefore not selected for normative work either.
# 7 Conclusions
## 7.1 Key Issue 1
Key issue 1 is addressed by solution #4 which builds on solution #6.1.5 in TR
23.733 [3]. It is therefore proposed to base normative work on solution #4.
## 7.2 Key Issue 2
Key issue 2 is addressed by solution #6.1. It is proposed to base normative
work on solution #6.1.
## 7.3 Key Issue 3
Key issue 3 is addressed by solution #7. It is proposed to base normative work
on solution #7.
## 7.4 Key Issue 4.
Key issue #4 is addressed by solutions #8 and solution #13. Solution #13,
however, does not address any of the security requirements of key issue 4.
Also, the corresponding solution in stage 2 architecture is found in clause
6.1.4 of TR 23.733 [3] and is not selected for normative work. Solution #6.13
should therefore not be selected for normative work.
Solution #8 addresses the key issue #4 by reusing the discovery mechanism
defined in 3GPP TS 33.303 [6]. It is proposed to base normative work on
solution #8.
## 7.5 Key Issue 5.
Key issue 5 is addressed by solution #6. It is proposed to base normative work
on solution #6.
## 7.6 Key Issue 6
Key issue 6 is addressed by solutions #.9, #10, and #11. All the solutions
contain an A and B variant. All of the solutions address the key issue
security requirements. Solutions #6.9 has corresponding solutions in TR 36.476
[4] and TR 23.733 [3]. Solution #10 does not have such a corresponding
solution and solution #11 has a corresponding solution in TR 23.733 [3] only.
Solution #l0 is therefore not preferred.
The B variant of solutions #10 and #11 has the advantage that a handover can
be performed without signalling between the eRemote-UE and the eNB.
Corresponding solution #11, however, does require signalling so that
signalling efficiency cannot be achieved in practise. Solution variant B is
therefore not preferred.
Concluding, it is proposed to base normative work on the A variant of
solutions #9 and #11.
## 7.7 Key Issue 7
Key issue 7 is addressed by solution #12. Solution #12 authenticates the
eRemote-UE and sets up PC-5 security in one procedure. However the solution
does not analyse whether it is necessary to set up PC-5 security after the
eRemote-UE is authenticated by the PKMF. It is therefore proposed to base
normative work on solution #12 with further analysis of PC-5 security.
## 7.8 Key Issue 8
Key issue 8 is addressed by solution #6.3. It is proposed to base normative
work on solution #6.3.
## 7.9 Key Issue 9
Key issue 9 is addressed by solution #6.5. It is proposed to base normative
work on solution #6.5.
## 7.10 Overall conclusions
For the following key issues, the following solutions are recommended for
normative work:
\- Key Issue 1: solution #4 of the present specification;
\- Key Issue 2: solution #1 of the present specification;
\- Key Issue 3: solution #7 of the present specification;
\- Key Issue 4: solution #8 of the present specification;
\- Key Issue 5: solution #6 of the present specification;
\- Key Issue 6: solutions #9 and #11 A variant of the present specification;
\- Key Issue 7: solution #12 of the present specification;
\- Key Issue 8: solution #3 of the present specification;
\- Key Issue 9: solution #5 of the present specification.
It is noted that there is no solution for secure pairing selected for
normative work since the corresponding solution in 23.733 [3] has not been
selected for normative work. This means that the present specification does
not meet the requirement for secure pairing as stated in clause 7C.1 of TS
22.278 [2].
With respect to authorization it is noted that the present specification does
not contain a mechanism for a eRelay-UE to authorize a specific eRemote-UE
when it attempts to set up an indirect 3GPP connection. Said differently, the
eRelay-UE either relays or doesn\'t relay, but does not have the ability to
selectively relay or not. If such functionality is required, a solution will
have to be specified during normative work.
#
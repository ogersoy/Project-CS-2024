# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The present document specifies the signalling requirements and procedures used
at network elements related to the Gateway Location Register (GLR) for Mobile
Application Part (MAP) within the 3GPP system. (i.e. the present document
specifies the delta against 3GPP TS 29.002.)
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document describes the signalling requirements and procedures used
at network elements related to the GLR for MAP within the 3GPP system at the
application level.
The present document gives the description of the systems needed only in the
network utilising GLR as the delta document against 3GPP TS 29.002.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies.
[1] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[2] 3GPP TS 23.007: \"Restoration procedures\".
[3] 3GPP TS 23.012: \"Location registration procedures\".
[4] 3GPP TS 23.040: \"Technical realization of the Short Message Service (SMS)
Point to Point (PP)\".
> [5] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
>
> [6] 3GPP TS 23.119: \"Gateway Location Register (GLR) - stage2\".
# 3 Abbreviations
For the purposes of the present document, the following abbreviations apply:
CCBS Completion of Call to Busy Subscriber\ GLR Gateway Location Register\
GPRS General Packet Radio Service\ IM_GSN Intermediate GSN\ IM_MSC
Intermediate MSC\ SGSN Serving GPRS support node\ GGSN Gateway GPRS support
node
# 4 The entities and interfaces within the mobile network utilising the GLR
## 4.1 The entities of the mobile system
The functional entities related to the GLR are described below. The
description of each entity is detailed in 3GPP TS 23.119 (GLR stage2
specification). The other functional entities described in the present
document (e.g. MSC, VLR, and HLR) are specified in 3GPP TS 29.002.
\- The Gateway location Register (GLR).
\- The Intermediate MSC (IM-MSC).
\- The Intermediate GSN (IM-GSN).
## 4.2 The Interfaces within the mobile services
The Interfaces related to the GLR are described below. The description of each
interface is detailed in 3GPP TS 23.119 (GLR stage2 specification).
\- Interface between the HLR and the GLR.
\- Interface between the VLR and the GLR.
\- Interface between the MSC and the IM_MSC.
\- Interface between the SGSN and the GLR.
\- Interface between the MSC and the GLR.
\- Interface between the GLR and the IM_GSN.
# 5 Overload and compatibility overview
## 5.1 Overload control for MAP entities
The VLR and SGSN see the GLR as an HLR, and the HLR sees the GLR as a VLR or a
SGSN. Therefore the GLR shall behave like mobile entity as which the GLR is
regarded. If overload of the GLR is detected, the responder may ignore
requests for certain MAP operations (see tables 5.1/1, 5.1/2 and 5.1/3 in 3GPP
TS 29.002). The decision as to which MAP Operations may be ignored is made by
the MAP service provider and is based upon the priority of the application
context.
## 5.2 Compatibility
A version negotiation mechanism based on the use of an application-context-
name is used to negotiate the protocol version used between two entities for
supporting a MAP-user signalling procedure. The description of the version
negotiation mechanism is detailed in 3GPP TS 29.002.
# 6 Requirements concerning the use of SCCP and TC
## 6.1 Use of SCCP
The Mobile Application Part makes use of the services offered by the
Signalling Connection Control Part of signalling System No. 7. CCITT Blue Book
or ITU‑T (03/93) Recommendations Q.711 to Q.716 should be consulted for the
full specification of SCCP. In North America (World Zone 1) the national
version of SCCP is used as specified in ANSI T1.112.
### 6.1.1 SCCP Class
MAP will only make use of the connectionless classes (0 or 1) of the SCCP.
### 6.1.2 Sub-System Number (SSN)
The Application Entities (AEs) defined for MAP consist of several Application
Service Elements (ASEs) and are addressed by sub-system numbers (SSNs). The
SSN for MAP are specified in 3GPP TS 23.003 [1]. The specific SSN is not
needed for the GLR, IM_MSC, and IM_GSN.
### 6.1.3 SCCP addressing
#### 6.1.3.1 Introduction
The format and coding of address parameters carried by SCCP are detailed in
3GPP TS 29.002.
The following subclauses describe the method of SCCP addressing appropriate
for each entity both for the simple intra-PLMN case and where an inter-PLMN
communication is required. The following entities are considered for the GLR
additionally:
\- the Gateway location Register (GLR);
\- the Intermediate Mobile-services Switching Centre (IM_MSC);
\- the Intermediate GPRS Support Node (IM_GSN).
#### 6.1.3.2 The Gateway Location Register (GLR)
##### 6.1.3.2.1 Addressed by the VLR
In the network utilising the GLR, when an MS that belongs to other PLMN
registers in a VLR/SGSN, the VLR/SGSN sees the GLR as the MS\'s HLR. When
initiating the update location dialogues, the VLR is able to address the GLR
based on the SPC of the GLR because of intra-PLMN signalling. And the VLR can
address the GLR based on an E.214 Mobile Global Title originally derived by
the VLR from the IMSI (when CCITT or ITU-T SCCP is used), or an E.212 number
originally derived from IMSI (when ANSI SCCP is used, an IMSI). When answering
with Global Title to the VLR, the GLR shall insert its E.164 address in the
Calling Party Address of the SCCP message containing the first responding
CONTINUE message. After that, the VLR can address the GLR based on an E.164
GLR address.
##### 6.1.3.2.2 Addressed by the HLR
When a location updating dialogue initiated by a GLR has been successfully
completed, the HLR sees the GLR as the VLR. When initiating dialogues towards
the VLR, the routeing information used by the HLR is derived from the E.164
VLR number received as a parameter of the MAP message initiating the update
location dialogue, but in reality the HLR addresses the GLR using the VLR
number.
##### 6.1.3.2.3 Addressed by the GMSC
In the case that the MS is served by the SGSN in the network utilising the
GLR, the GMSC sees the GLR as the SGSN. When the GMSC initiates dialogues
towards the SGSN the SGSN (MAP) SSN (See 3GPP TS 23.003) shall be included in
the called party address. The routeing information used by the GMSC is derived
from the E.164 SGSN number received as a parameter of the MAP message
initiating the forward short message procedure. But in reality the GMSC
addresses the GLR using the SGSN number.
##### 6.1.3.2.4 Addressed by the IM-GSN
In the network utilising the GLR, the IM-GSN initiates the GPRS location
information retrieval to the GLR. The IM-GSN must have the value of the GLR
address beforehand.
#### 6.1.3.3 The Intermediate MSC (IM_MSC)
##### 6.1.3.3.1 Addressed by the GMSC
When a short message for CS has to be routed to an MS, the GMSC addresses the
MSC by an MSC identity received from the HLR that complies with E.164 rules.
But in reality the GMSC addresses the IM-MSC in the network utilising the GLR.
##### 6.1.3.3.2 Addressed by the GMLC
When a location request for a particular MS needs to be sent to the MS\'s
VMSC, the GMLC addresses the MSC using an E.164 address received from the
MS\'s HLR. But in reality the GMLC addresses the IM-MSC in the network
utilising the GLR.
#### 6.1.3.4 The Intermediate GSN (IM_GSN)
The IM-GSN provides routing of the Network-Requested PDP Context activation.
If a Network-Requested PDP Context activation fails, the GLR will alert the
IM-GSN when the subscriber becomes reachable. The GLR will use the E.164 IM-
GSN number received as parameter of the MAP message reporting the failure.
#### 6.1.3.5 Summary table
The following table summarises the SCCP address used for invoke operations. As
a principle, within a PLMN either an SPC or a GT may be used (network
operation option), whereas when addressing an entity outside the PLMN the GT
must be used. The address type mentioned in the table (e.g. MSISDN) is used as
GT or to derive the SPC.
For a response, the originating address passed in the invoke message is used
as SCCP Called Party Address. For extra‑PLMN addressing the own E.164 entity
address is used as SCCP Calling Party Address; for intra-PLMN addressing an
SPC derived from the entity number may be used instead. When using an SPC, the
SPC may be taken directly from MTP.
Table 6.1.3/1
to from | fixed net work | HLR | VLR | MSC | **SGSN** | **GGSN** | **GLR** | **IM-MSC** | **IM-GSN**  
---|---|---|---|---|---|---|---|---|---  
**fixed network** |  |  |  |  |  |  |  |  |   
**home location register** |  |  |  |  |  |  | I:SPC/GT E:GT T:VLR NUMBER |  |   
**visitor location register** |  |  |  |  |  |  | I:SPC/GT E:GT T:MGT (outside World Zone 1)/MSISDN (World Zone 1/)HLR NUMBER (note) |  |   
**mobile-services switching centre** |  |  |  |  |  |  | E:GT T:SGSN NUMBER | I:SPC/GT E:GT T:MSC NUMBER |   
**Serving** **GPRS** **Support** **Node** |  |  |  |  |  |  | I:SPC/GT T:MGT/MSISDN/HLR NUMBER |  |   
**Gateway** **GPRS** **Support** **Node** |  |  |  |  |  | Note1 |  |  |   
**Gateway** **Location** **register** | \--- | E:GT T:MGT (outside World Zone1)/MSISDN(World Zone1/) HLR NUMBER (note) | I:SPC/GT T:VLR NUMBER | \--- | I:SPC/GT T:SGSN NUMBER |  |  |  |   
**Intermediate-** **MSC** | \--- |  |  | I:SPC/GT T:MSC NUMBER |  |  |  |  |   
**Intermediate-** **GSN** | \--- |  |  |  |  |  | I:SPC/GT T:HLR NUMBER |  |   
I: Intra-PLMN E: Extra (Inter)-PLMN T: Address Type\ GT: Global Title MGT:
E.214 Mobile Global Title SPC: Signalling Point Code
NOTE 0: For initiating the location updating procedure and an authentication
information retrieval from the HLR preceding it, the VLR has to derive the HLR
address from the IMSI of the MS. The result can be an SPC or an E.214 Mobile
Global Title if CCITT or ITU-T SCCP is used, or IMSI itself if ANSI SCCP is
used (ANSI SCCP is used in World Zone 1). When continuing the established
update location dialogue (as with any other dialogue) the VLR must derive the
routeing information towards the HLR from the Calling Party Address received
with the first responding CONTINUE message until the dialogue terminating
message is received.
For transactions invoked by the VLR after update location completion, the VLR
may derive the information for addressing the HLR from addresses received in
the course of the update location procedure (MSISDN or HLR number) or from the
IMSI.
When invoking the Restore Data procedure and an authentication information
retrieval from the HLR preceding it, the VLR must derive the information for
addressing the HLR from the address information received in association with
the roaming number request. This may be either the IMSI received as a
parameter of the MAP message requesting the Roaming Number or the Calling
Party Address associated with the MAP message requesting the Roaming Number.
> From VLR in, GLR as for T (address type) only HLR Number is used. VLR and
> HLR are because only the thing that is belonging to same PLMN is thought.
NOTE1: The hatching part is the same part of 3GPP TS29.002.
## 6.2 Use of TC
Refer to the corresponding section in 3GPP TS 29.002.
# 7 General on MAP services
Refer to the corresponding section in 3GPP TS 29.002 with the exceptions
described below.
## 7.1 Common MAP services
The following common services are used:
\- MAP-OPEN service;
\- MAP-CLOSE service;
\- MAP-DELIMITER service;
\- MAP-U-ABORT service;
\- MAP-P-ABORT service;
\- MAP-NOTICE service;
> \- MAP-SECURE-TRANSPORT-CLASS-1 service;
>
> \- MAP-SECURE-TRANSPORT-CLASS-2 service;
>
> \- MAP-SECURE-TRANSPORT-CLASS-3 service;
>
> \- MAP-SECURE-TRANSPORT-CLASS-4 service.
Replace the MAP-U-ABORT service as follows.
### 7.1.1 MAP-U-ABORT service
This service enables the service-user to request the MAP dialogue to be
aborted. The service is an unconfirmed service with service-primitives as
shown in table 7.1/1. MAP service-user in the GLR may set \"application
context not supported\" as user reason.
Table 7.1/1: Service-primitives for the MAP-U-ABORT service
* * *
Parameters Request Indication User reason M M(=) Diagnostic information U C(=)
Specific information U C(=)
* * *
[User reason]{.underline}:
This parameter can take the following values:
\- resource limitation (congestion);
the requested user resource is unavailable due to congestion;
\- resource unavailable;
the requested user resource is unavailable for reasons other than congestion;
\- application procedure cancellation;
the procedure is cancelled for reason detailed in the diagnostic information
parameter;
\- application context not supported;
the requested application context is not supported;
\- procedure error;
processing of the procedure is terminated for procedural reasons.
[Diagnostic information]{.underline}:
This parameter may be used to give additional information for some of the
values of the user-reason parameter:
Table 7.1/2: User reason and diagnostic information
* * *
**User reason** **Diagnostic information**
Resource limitation (congestion) -
Resource unavailable Short term/long term problem
Application procedure cancellation Handover cancellation/\ Radio Channel
release/\ Network path release/\ Call release/\ Associated procedure failure/\
Tandem dialogue released/\ Remote operations failure
Application context not supported -
Procedure error -
* * *
[Specific information]{.underline}:
This parameter may be used for passing any user specific information.
Establishment and processing of the Specific information is not specified by
GSM and shall be performed according to operator specific requirements.
# 8 Mobility services
## 8.1 General
Regarding definition of each service, only the interval for adoption shall be
considered for the GLR introduction. The interval for adoption for the GLR
specification is described below. Service primitives and parameter definitions
are as in 3GPP TS 29.002.
## 8.2 Location Management services
* * *
Services Interval for adoption MAP_UPDATE_LOCATION VLR -- GLR GLR -- HLR
MAP_CANCEL _LOCATION HLR -- GLR GLR -- VLR GLR -- SGSN MAP_PURGE_MS VLR -- GLR
SGSN -- GLR GLR -- HLR MAP_UPDATE_GPRS_LOCATION SGSN -- GLR GLR -- HLR
* * *
Figure 8.2 /1
## 8.3 Authentication Management services
* * *
Services Interval for adoption MAP_SEND_AUTHENTICATION_INFO VLR -- GLR SGSN --
GLR GLR -- HLR MAP_AUTHENTICATION_FAILURE_REPORT VLR -- GLR SGSN -- GLR GLR --
HLR
* * *
Figure 8.3/1
## 8.4 Subscriber management services
* * *
Services Interval for adoption MAP_ INSERT-SUBSCRIBER-DATA HLR -- GLR GLR --
VLR GLR -- SGSN MAP-DELETE-SUBSCRIBER-DATA HLR -- GLR GLR -- VLR GLR -- SGSN
* * *
Figure 8.4/1
## 8.5 Fault recovery services
* * *
Services Interval for adoption MAP_RESET HLR -- GLR GLR -- VLR GLR -- SGSN
MAP_FORWARD_CHECK_SS_INDICATION HLR -- GLR GLR -- VLR MAP_RESTORE_DATA VLR --
GLR
* * *
Figure 8.5/1
## 8.6 Subscriber Information services
* * *
Services Interval for adoption MAP-PROVIDE-SUBSCRIBER-Info VLR -- GLR GLR --
HLR
* * *
Figure 8.6/1
# 9 Operation and maintenance services
## 9.1 General
Regarding definition of each service, only the interval for adoption shall be
considered for the GLR introduction. The intervals for adoption for the GLR
specification are described below. Service primitives and parameter
definitions are as in 3GPP TS 29.002.
## 9.2 MAP_SEND_IMSI service
* * *
Services Interval for adoption MAP_ SEND_IMSI HLR -- GLR GLR -- VLR
* * *
Figure 9.2/1
# 10 Call handling services
## 10.1 General
Regarding definition of each service, only the interval for adoption shall be
considered for the GLR introduction. The intervals for adoption for the GLR
specification are described below. Service primitives and parameter
definitions are as in 3GPP TS 29.002.
## 10.2 MAP_PROVIDE_ROAMING_NUMBER service
* * *
Services Interval for adoption MAP_ PROVIDE_ROAMING_NUMBER HLR -- GLR GLR --
VLR
* * *
Figure 10.2/1
## 10.3 MAP_SET_REPORTING_STATE service
* * *
Services Interval for adoption MAP_ SET_REPORTING_STATE HLR -- GLR GLR -- VLR
* * *
Figure 10.3/1
## 10.4 MAP_STATUS_REPORT service
* * *
Services Interval for adoption MAP_ STATUS_REPORT VLR -- GLR GLR -- HLR
* * *
Figure 10.4/1
## 10.5 MAP_REMOTE_USER_FREE service
* * *
Services Interval for adoption MAP_REMOTE_USER_FREE VLR -- GLR GLR -- HLR
* * *
Figure 10.5/1
# 11 Supplementary services related services
## 11.1 General
Regarding definition of each service, only the interval for adoption shall be
considered for the GLR introduction. The intervals for adoption for the GLR
specification are described below. Service primitives and parameter
definitions are as in 3GPP TS 29.002.
## 11.2 MAP_REGISTER_SS service
* * *
Services Interval for adoption MAP_ REGISTER_SS VLR -- GLR GLR -- HLR
* * *
Figure 11.2/1
## 11.3 MAP_ERASE_SS service
* * *
Services Interval for adoption MAP_ ERASE_SS VLR -- GLR GLR -- HLR
* * *
Figure 11.3/1
## 11.4 MAP_ACTIVATE_SS service
* * *
Services interval for adoption MAP_ ACTIVATE_SS VLR -- GLR GLR -- HLR
* * *
Figure 11.4/1
## 11.5 MAP_DEACTIVATE_SS service
* * *
Services Interval for adoption MAP_ DEACTIVATE_SS VLR -- GLR GLR -- HLR
* * *
Figure 11.5/1
## 11.6 MAP_ INTERROGATE _SS service
* * *
Services Interval for adoption MAP_ INTERROGATE_SS VLR -- GLR GLR -- HLR
* * *
Figure 11.6/1
## 11.7 MAP_ REGISTER_PASSWORD service
* * *
Services Interval for adoption MAP_ REGISTER_PASSWORD VLR -- GLR GLR -- HLR
* * *
Figure 11.7/1
## 11.8 MAP_ GET_PASSWORD service
* * *
Services Interval for adoption MAP_ GET_PASSWORD HLR -- GLR GLR -- VLR
* * *
Figure 11.8/1
## 11.9 MAP_ PROCESS_UNSTRUCTURED_SS_REQUEST service
* * *
Services Interval for adoption MAP_ PROCESS_UNSTRUCTURED_SS_REQUEST VLR -- GLR
GLR -- HLR
* * *
Figure 11.9/1
## 11.10 MAP_ UNSTRUCTURED_SS_REQUEST service
* * *
Services Interval for adoption MAP_ UNSTRUCTURED_SS_REQUEST HLR -- GLR GLR --
VLR
* * *
Figure 11.10/1
## 11.11 MAP_UNSTRUCTURED_SS_NOTIFY service
* * *
Services Interval for adoption MAP_ UNSTRUCTURED_SS_NOTIFY HLR -- GLR GLR --
VLR
* * *
Figure 11.11/1
## 11.12 MAP_REGISTER_CC_ENTRY service
* * *
Services Interval for adoption MAP_ UNSTRUCTURED_SS_NOTIFY VLR -- GLR GLR --
HLR
* * *
Figure 11.12/1
## 11.13 MAP_ERASE_CC_ENTRY service
* * *
Services Interval for adoption MAP_ ERASE_CC_NOTIFY VLR -- GLR GLR -- HLR
* * *
Figure 11.13/1
# 12 Short message service management services
## 12.1 General
Regarding definition of each service, only the interval for adoption shall be
considered for the GLR introduction. The intervals for adoption for the GLR
specification are described below. Service primitives and parameter
definitions are as in 3GPP TS 29.002.
## 12.2 MAP-READY-FOR-SM service
* * *
Services interval for adoption MAP-READY-FOR-SM VLR -- GLR SGSN -- GLR GLR --
HLR
* * *
Figure 12.2/1
## 12.3 MAP-MT-FORWARD-SHORT-MESSAGE service
* * *
Services interval for adoption MAP_MT_FORWARD_SHORT_MESSAGE SMS-GMSC -- IM-MSC
IM-MSC -- MSC SMS-GMSC -- GLR GLR -- SGSN
* * *
Figure 12.3/1
# 13 Network-Requested PDP Context Activation services
## 13.1 General
Regarding definition of each service, only the interval for adopttion shall be
considered for the GLR introduction. The intervals for adoption for the GLR
specification are described below. Service primitives and parameter
definitions are as in 3GPP TS 29.002.
## 13.2 MAP_SEND_ROUTING_INFO_FOR_GPRS service
* * *
Services Interval for adoption MAP_SEND_ROUTING_INFO_FOR_GPRS IM-GSN -- GLR
* * *
Figure 13.2/1
## 13.3 MAP_FAILURE_REPORT service
* * *
Services Interval for adoption MAP_ FAILURE_REPORT IM-GSN -- GLR
* * *
Figure 13.3/1
# 14 Void
# 15 Element of procedure
The elements of procedures for the MAP protocol are referred to the
corresponding section in 3GPP TS 29.002002 with the exceptions described
below.
## 15.1 SDL descriptions
Replace the corresponding part of Process Secure_MAP_DSM as figure 15.1/1.
{width="6.651388888888889in" height="8.204166666666667in"}
Figure 15.1/1: Process Secure_MAP_DSM_GLR
# 16 Mapping onto TC services
Dialogue control, Service specific procedures and SDL descriptions are
referred to the corresponding section in 3GPP TS 29.002.
# 17 Abstract syntax of the MAP protocol
## 17.1 General
Refer to the corresponding section in 3GPP TS 29.002 except Packages
specifications and Application contexts.
Regarding the operations which are initiated by the VLR or SGSN toward HLR via
GLR, the timer value used in the operations should be configured enough long
to guarantee the GLR specific fallback mechanism.
## 17.2 Packages specifications
Regarding Packages specifications, only the supplier and consumer definition
shall be considered for the GLR introduction. The supplier and consumer
definition for the GLR specification are derived Table 17.2/1. For the other
definitions of the package specifications are as in 3GPP TS 29.002.
Table 17.2/1: supplier and consumer definition
* * *
**Operation Package** **supplier** **consumer** LocationUpdatingPackage-v3 HLR
GLR GLR VLR LocationCancellationPackage-v3 VLR or SGSN GLR GLR HLR
RoamingNumberEnquiryPackage-v3 VLR GLR GLR HLR InfoRetrievalPackage-v2 HLR GLR
GLR VLR GLR SGSN InfoRetrievalPackage-v1 HLR GLR GLR VLR GLR SGSN
IMSIRetrievalPackage-v2 HLR GLR GLR VLR SubscriberDataMngtStandAlonePackage-v3
VLR or SGSN GLR GLR HLR SubscriberDataMngtPackage-v3 VLR or SGSN GLR GLR HLR
ResetPackage-v2 VLR or SGSN GLR GLR HLR FunctionalSsPackage-v2 HLR GLR GLR HLR
BindingPackage-v1 HLR GLR GLR VLR UnstructuredSsPackage-v2 HLR GLR GLR VLR
UnstructuredSsPackage-v1 HLR GLR GLR VLR MTShortMsgRelayPackage-v3 IM-MSC or
GLR GMSC MSC IM-MSC SGSN GLR MwdMngtPackage-v3 HLR GLR GLR SGSN GLR VLR
MwdMngtPackage-v1 HLR GLR GLR VLR DataRestorationPackage-v3 GLR VLR
PurgingPackage-v3 HLR GLR GLR VLR GLR SGSN
SubscriberInformationEnquiryPackage-v3 VLR GLR GLR HLR
GprsLocationUpdatingPackage-v3 HLR GLR GLR SGSN FailureReportingPackage-v3 GLR
IM-GSN SetReportingStatePackage-v3 VLR GLR GLR HLR StatusReportPackage-v3 HLR
GLR GLR VLR RemoteUserFreePackage-v3 VLR GLR GLR HLR CallCompletionPackage-v3
HLR GLR GLR VLR AuthenticationFailureReportPackage-v3 HLR GLR GLR VLR GLR SGSN
SecureTransportHandlingPackage-v3 This operation package includes the
operations required for the secure transport of MAP messages between any MAP
entities.
* * *
## 17.3 Application contexts
Regarding Application contexts specifications, only the responder and
initiator definition shall be considered for the GLR introduction. The
responder and initiator definition for the GLR specification are derived Table
17.3/1. For the other definitions of the package specifications are as in 3GPP
TS 29.002.
Table 17.3/1: supplier and consumer definition
* * *
**Application Context** **Version** **Initiator** **Responder**
locationCancellationContext v3 HLR GLR GLR VLR or SGSN imsiRetrievalContext v2
VLR GLR GLR HLR infoRetrievalContext v2 VLR or SGSN GLR GLR HLR mwdMngtContext
v3 VLR or SGSN GLR GLR HLR msPurgingContext v3 VLR or SGSN GLR GLR HLR
resetContext v2 HLR GLR GLR VLR or SGSN networkUnstructuredSsContext v2 VLR
GLR GLR HLR HLR GLR GLR VLR networkFunctionalSsContext v2 VLR GLR GLR HLR
shortMsgMT-RelayContext v3 MSC IM-MSC or GLR IM-MSC MSC GLR SGSN
networkLocUpContext v3 VLR GLR GLR HLR gprsLocationUpdateContext v3 SGSN GLR
GLR HLR subscriberDataMngtContext v3 HLR GLR GLR VLR or SGSN
roamingNumberEnquiryContext v3 HLR GLR GLR VLR
gprsLocationInfoRetrievalContext v3 IM-GSN GLR failureReportContext v3 IM-GSN
GLR subscriberInfoEnquiryContext v3 HLR GLR GLR VLR reportingContext v3 VLR
GLR GLR HLR HLR GLR GLR VLR callCompletionContext v3 VLR GLR GLR HLR
authenticationFailureReportContext v3 VLR or SGSN GLR GLR HLR
SecureTransportHandlingContext v3 This application context is used for the
secure transport of MAP messages between any MAP entities.
* * *
# 18 General on MAP user procedure
Refer to 3GPP TS 29.002 for general matters for procedure description such as
notation convention, version handling at dialogue establishment and
interaction between MAP provider and MAP users.
# 19 Mobility procedures
## 19.1 Location management Procedures
For non-GPRS subscribers, this subclause comprises a number of processes to
handle the mobile nature of the subscriber. The processes will be addressed by
SCCP SSN (VLR or HLR) and the Application Context. The processes in the GLR
interact with the processes in the VLR or HLR defined in 29.002. The
followings show the relations between the protocol processes in the GLR and
the processes in the other node.
Process Update Location (VLR-GLR):
\- Initiator: Update_Location_Area_VLR or Update_Location_HLR;
\- Responder: Update_Location_GLR.
Process Update Location (GLR-HLR):
\- Initiator: GLR_Update_Location_HLR;
\- Responder: Update_Location_HLR.
Process Cancel Location (VLR-GLR):
\- Initiator: GLR_Cancel_Location_VLR;
\- Responder: Cancel_Location_VLR.
Process Cancel Location (GLR-HLR):
\- Initiator: Cancel_Location_HLR;
\- Responder: Cancel_Location_GLR.
Process Purge MS (VLR-GLR):
\- Initiator: Purge_MS_VLR;
\- Responder: Purge_MS_GLR.
Process Purge MS (GLR-HLR):
\- Initiator: GLR_Purge_MS_HLR;
\- Responder: Purge_MS_HLR.
A Location Management Co-ordinator in the GLR co-ordinates the two protocol
processes \"Update_Location_GLR\" (subclause 19.1.2) and \"RESTORE_DATA_GLR\"
(subclause 19.2) that are addressed by the same application context.
On receipt of a dialogue request for the Location Management Application
Context, the location Management_Coordinator_GLR will:
\- Terminate the process in case of parameter problems; or
\- Revert to MAP version Vr protocol if the VLR requests version Vr protocol;
or
\- Continue as described in the following, if the dialogue is accepted.
The protocol process is created depending on the first primitive received from
the MAP service provider within this dialogue:
\- Update_Location_GLR if the primitive is a MAP_UPDATE_LOCATION indication.
\- RESTORE_DATA_GLR if the primitive is a MAP_RESTORE_DATA indication.
If a MAP_NOTICE indication is received instead, the dialogue towards the VLR
is terminated and the process returns to idle state.
After creation of the protocol process the service primitive received from the
MAP service-provider is passed to the protocol process. Henceforth, the co-
ordinator will relay all service primitives from MAP service-provider to the
MAP service-user and vice versa, until a request or indication for dialogue
termination is received. This last primitive will be relayed, too, before the
Co-ordinator process returns to idle state.
{width="6.413194444444445in" height="8.185416666666667in"}
Figure 19.1.1/1: Process Location_Management_Coordinator_GLR
For GPRS subscribers, this subclause comprises a number of other processes to
handle the mobile nature of the subscriber. The processes will be addressed by
SCCP Sub-System Number (SGSN or HLR) and the Application Context. The
processes in the GLR interact with the processes in the VLR, SGSN or HLR
defined in 29.002. The followings show the relations between the processes in
the GLR and the processes in the other node:
Process GPRS Update Location (VLR or SGSN-GLR):
Initiator: GPRS_Update_Location_Area_VLR, or SGSN_Update_HLR.
Responder: Update_GPRS_Location_GLR.
Process GPRS Update Location (GLR-HLR):
Initiator: GLR_Update_GPRS_Location_HLR.
Responder: Update_GPRS_Location_HLR.
Process Cancel Location (SGSN-GLR):
Initiator: GLR_Cancel_Location_SGSN.
Responder: Cancel_Location_SGSN.
Process Cancel Location (GLR-HLR):
Initiator: Cancel_GPRS_Location_HLR.
Responder: Cancel_GPRS_Location_GLR.
Process Purge MS (SGSN-GLR):
Initiator: Purge_MS_SGSN.
Responder: Purge_MS_GLR_for_GPRS.
Process Purge MS (GLR-HLR):
Initiator: GLR_Purge_MS_HLR_for_GPRS.
Responder: Purge_MS_HLR.
### 19.1.1 Location updating
#### 19.1.1.1 General
This location updating procedure is used to update the location information
held in the network.
If the GLR is located between the VLR and the HLR, the MAP_UPDATE_LOCATION
service is invoked towards the GLR whose identity is contained in the VLR
table. When the GLR receives a MAP_UPDATE_LOCATION indication, it determines
whether it invokes the MAP_UPDATE_LOCATION service towards the HLR, and
invokes it if necessary.
If the GLR is located between the SGSN and the HLR, the
MAP_UPDATE_GPRS_LOCATION service is invoked towards the GLR whose identity is
contained in the SGSN table. When the GLR receives a MAP_UPDATE_GPRS_LOCATION
indication, it determines whether it invokes the MAP_UPDATE_GPRS_LOCATION
service towards the HLR, and invokes it if necessary.
+----+ +----+ +----+ +-----+\ │VLR/│ \| \| │ │ │PGLR/│
│SGSN+-----+----------│GLR │-------+---------│HLR +-------+---------│PVLR/│\ │
│ \| \| │ │ │PSGSN│
+----+ +----+ +----+ +-----+\ │ │ │ │\ │ MAP UPDATE_LOCATION │ │ │\
│-------------------->│ │ │\ │ or MAP UPDATE GPRS │ MAP UPDATE_LOCATION │
MAP_CANCEL_ │\ │ LOCATION │ -------------------->│ \--------------------->│\ │
│or MAP UPDATE GPRS │ LOCATION │\ │ │ LOCATION │ │\ │ │ │ │\ │ │ │
MAP_CANCEL_LOCATION │\ │ │ │\│--------------------> │ │\ │ ack │ ack │ │\ │ │ │ │\ │
│ │ │\ │MAP CHECK SS │MAP CHECK SS │ │\ │ INDICATION │ INDICATION │ │\
│\│ │ │\ │ │ MAP_CANCEL_ │ MAP_CANCEL_ │\ │ │
-------------------->│ \--------------------->│\ │ │ LOCATION │ LOCATION │\ │
│ │ │\ │ │ │ │\ │ │ MAP_CANCEL_LOCATION │ MAP_CANCEL_LOCATION │\ │
│\│ │ │\ │ │ MAP_CANCEL_ │ MAP_CANCEL_ │\ │ │
-------------------->│ \--------------------->│\ │ │ LOCATION │ LOCATION │\ │
│ │ │\ │ │ │ │\ │ │ MAP_CANCEL_LOCATION │ MAP_CANCEL_LOCATION │\ │
│\│ │\ │ │ MAP_CANCEL_ │\ │ │
--------------------->│\ │ │ LOCATION │\ │ │ │\ │ │ │\ │ │ MAP_CANCEL_LOCATION
│\ │ │\│ │\ │ │ MAP PURGE_MS │\ │ │ -------------------->│\ │ │
│\ │ │ │\ │ │ │\ │ │ MAP PURGE_MS ack │\ │ MAP_PURGE_MS ack
│\│ 3.│ │\ │ +--------------->│ 4.│\ │ │ + - - - - - - - >│\ │
│ │ │
1) Delete Subscriber.
2) MAP_CANCEL_LOCATION.
3) MAP_CANCEL_LOCATION_ACK.
4) Subscriber Deleted.
Figure 20.2.1/1: Subscriber deletion procedure
In the subscriber deletion procedure the subscriber data should be removed
from the VLR and from the HLR. The HLR uses the MAP_CANCEL_LOCATION service.
+-----+ +-----+ +------+ +-------+\ │SGSN │ │ GLR │ │ HLR │ │ OMC │\ +-----+
+-----+ +------+ +-------+\ │ │ │1. │\ │ │2. +\│ 3.│ │\ │ +--------------->│ 4.│\ │ │ + - - - - - - - >│\ │
│ │ │
1) Delete GPRS Subscriber.
2) MAP_CANCEL_LOCATION.
3) MAP_CANCEL_LOCATION_ACK.
4) GPRS Subscriber Deleted.
Figure 20.2.1/2: Subscriber deletion procedure for GPRS
In the subscriber deletion procedure the subscriber data should be removed
from the SGSN and from the HLR. The HLR uses the MAP_CANCEL_LOCATION service.
+-----+ +-----+ +------+ +-------+\ │ VLR │ │ GLR │ │ HLR │ │ OMC │\ +-----+
+-----+ +------+ +-------+\ │ │ │1. │\ │ │2. +\│ 3.│ │\ │ +--------------->│ 4.│\ │ │ + - - - - - - - >│\ │
│ │ │
1) Modify Subscriber Data.
2) MAP_CANCEL_LOCATION, MAP_INSERT_SUBSCRIBER_DATA or\
MAP_DELETE_SUBSCRIBER_DATA.
3) MAP_CANCEL_LOCATION_ACK, MAP_INSERT_SUBSCRIBER_DATA_ACK or\
MAP_DELETE_SUBSCRIBER_DATA_ACK.
4) Subscriber Data Modified.
Figure 20.2.1/3: Subscriber data modification procedure
+-----+ +-----+ +------+ +-------+\ │SGSN │ │ GLR │ │ HLR │ │ OMC │\ +-----+
+-----+ +------+ +-------+\ │ │ │1. │\ │ │2. +\│ 3.│ │\ │ +--------------->│ 4.│\ │ │ + - - - - - - - >│\ │
│ │ │
1) Modify Subscriber Data.
2) MAP_CANCEL_LOCATION, MAP_INSERT_SUBSCRIBER_DATA or\
MAP_DELETE_SUBSCRIBER_DATA.
3) MAP_CANCEL_LOCATION_ACK, MAP_INSERT_SUBSCRIBER_DATA_ACK or\
MAP_DELETE_SUBSCRIBER_DATA_ACK.
4) Subscriber Data Modified.
Figure 20.2.1/4: Subscriber data modification procedure for GPRS
In the subscriber data modification procedure the subscriber data is modified
in the HLR and when necessary also in the VLR or in the SGSN. The HLR
initiates either the MAP_INSERT_SUBSCRIBER_DATA, MAP_DELETE_SUBSCRIBER_DATA or
MAP_CANCEL_LOCATION service depending on the modified data.
### 20.2.2 Procedures in the GLR
#### 20.2.2.1 Subscriber deletion procedure
The subscriber deletion procedure in the GLR is described in the subclause 19.
#### 20.2.2.2 Subscriber data modification procedure
When receiving either the MAP_INSERT_SUBSCRIBER_DATA indication or the
MAP_DELETE_SUBSCRIBER_DATA indication, the GLR checks the parameters and data
in the primitive. Data errors are reported as an unexpected data value error
or a data missing error depending on the nature of the error.
After receiving the first MAP_INSERT_SUBSCRIBER_DATA indication, the GLR will
check the IMSI that is included in the primitive. If the IMSI is unknown, the
error \"Unidentified subscriber\" is returned.
If the GLR does not support received basic or supplementary services or the
network feature Operator Determined Barring, or there is a problem with
Regional Subscription Data then this is reported to the HLR.
If the entire MSC area that covered the VLR wherein the subscriber is
registered is restricted due to regional subscription, this is reported to the
HLR.
If the updating of the subscriber data is not possible, the GLR will initiate
the MAP_U_ABORT request primitive.
If the updating is successful in the GLR, the GLR will initiate the
MAP_INSERT_SUBSCRIBER_DATA request or the MAP_DELETE_SUBSCRIBER_DATA request
to the VLR or to the SGSN wherein the subscriber is registered.
The subscriber data modification procedure in the GLR is shown in the figures
20.2.2.2/1, 20.2.2.2/2, 20.2.2.2/3, 20.2.2.2/4, 20.2.2.2/5 and 20.2.2.2/6.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 20.2.2.2/1 (Sheet 1 of 3): Process INS_SUBS_DATA_GLR
{width="6.775in" height="8.185416666666667in"}
Figure 20.2.2.2/1 (Sheet 2 of 3): Process INS_SUBS_DATA_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 20.2.2.2/1 (Sheet 3 of 3): Process INS_SUBS_DATA_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 20.2.2.2/2 (Sheet 1 of 3): Process INS_GPRS_SUBS_DATA_GLR
{width="6.775in" height="8.185416666666667in"}
Figure 20.2.2.2/2 (Sheet 2 of 3): Process INS_GPRS_SUBS_DATA_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 20.2.2.2/2 (Sheet 3 of 3): Process INS_GPRS_SUBS_DATA_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 20.2.2.2/3: Process Delete_Subscriber_Data_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 20.2.2.2/4: Process Delete_GPRS_Subscriber_Data_GLR
{width="6.6875in" height="8.102777777777778in"}
Figure 20.2.2.2/5: Macro Delete_Subs_Data_GLR
{width="6.6875in" height="8.102777777777778in"}
Figure 20.2.2.2/6: Macro Delete_GPRS_Subs_Data_GLR
## 20.3 Subscriber Identity procedure
In the subscriber identity procedure the IMSI of the subscriber is retrieved
from the HLR. The procedure is shown in figure 20.3/1.
+-----+ +------+ +------+ +------+\ ¦ OMC ¦ ¦ VLR ¦ ¦ GLR ¦ ¦ HLR ¦\ ¦ ¦ ¦ ¦ ¦
¦ ¦ ¦\ +-----+ +------+ +------+ +------+\ ¦ 1.¦ ¦ ¦\ \+ - - - - >¦ 2.¦ 2.¦\ ¦
+------------->¦------------>¦\ ¦ ¦ 3. ¦ 3. ¦\ ¦ 4.
+\
\------------------------------------------------>
* * *
Figure 21.3.1/1: Message Flow for Setting the Reporting State
### 21.3.2 Process in the GLR to set the reporting state
The MAP process in the GLR to set the reporting state is shown in figures
21.3.2/1 and 21.3.2/2. The MAP process invokes a macro not define in this
subclause; the definition of this macro can be found as follows:
Receive_Open_Ind see subclause 25.1.
Receive_Open_Cnf see subclause 25.1.
Check_Confirmation see subclause 25.2.
**Set the reporting state**
When receiving the MAP_SET_REPORTING_STATE indication, the MAP user in the GLR
transfers the information to the VLR in the MAP_ SET_REPORTING_STATE request.
The GLR then awaits the receipt of the MAP_ SET_REPORTING_STATE confirm from
the VLR. The MAP user in the GLR shall transfer the information contained in
this primitive to the HLR in the MAP_ SET_REPORTING_STATE response without
checking its contents.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 21.3.2/1: Process Reporting_State_Receive_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 21.3.2/2: Process Reporting_State_Send_GLR
## 21.4 Status Reporting
### 21.4.1 General
In case that the monitored subscriber becomes to the idle state, the message
flow for reporting subscriber\'s state to the HLR is shown in figure 21.4.1/1.
The stage2 specification for the interaction with CCBS in a GLR is in 3GPP TS
23.119.
* * *
VLR GLR HLR MAP_STATUS_REPORT MAP_ STATUS_REPORT  
\-------------------------------------------------->
\-------------------------------------------------->  
MAP_STATUS_REPORT ack MAP_ STATUS_REPORT ack  
\
\-------------------------------------------------->
* * *
Figure 21.5.1/1: Message Flow for Remote User Free
### 21.5.2 Process in the GLR for Remote User Free
The MAP process in the GLR to handling Remote User Free is shown in figures
21.5.2/1 and 21.5.2/2.
**Remote User Free**
When receiving the MAP_REMOTE_USER_FREE indication, the MAP user in the GLR
transfers the information to the VLR in the MAP_ REMOTE_USER_FREE request.
The GLR then awaits the receipt of the MAP_REMOTE_USER_FREE confirm from the
VLR. The MAP user in the GLR shall transfer the information contained in this
primitive to the HLR in the MAP_REMOTE_USER_FREE response without checking its
contents.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 21.5.2/1: Process Remote_User_Free_Receive_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 21.5.2/2: Process Remote_User_Free_Send_GLR
# 22 Supplementary services procedures
## 22.1 Functional supplementary service processes
### 22.1.1 Functional supplementary service process co-ordinator for GLR
Any functional SS process in the GLR starts by the GLR receiving a MAP-OPEN
service indication. If that service is successful, the GLR can handle
supplementary service indications from the VLR. Table 21.1/1 shows the co-
ordinating process\' reaction on receipt of specific SS service indications
from the VLR. After the relevant process is invoked, the received service
indication is sent to that process, and the co-ordinating process terminates.
Table 21.1/1: Relationship between received service indication and invoked
process in the GLR
* * *
Service indication received Process invoked MAP_REGISTER_SS_ind
REGISTER_SS_GLR MAP_ERASE_SS_ind ERASE_SS_GLR MAP_ACTIVATE_SS_ind
ACTIVATE_SS_GLR MAP_DEACTIVATE_SS_ind DEACTIVATE_SS_GLR MAP_INTERROGATE_SS_ind
INTERROGATE_SS_GLR MAP_REGISTER_PASSWORD REGISTER_PASSWORD_GLR
* * *
Figure 22.1/1 shows the co-ordinating process in the GLR.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.1/1 (sheet 1 of 2): Process SS_Coordinator_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.1/1 (sheet 2 of 2): Process SS_Coordinator_GLR
### 22.1.2 Call completion supplementary service process co-ordinator for GLR
The MAP co-ordinating process in the GLR to handle a dialogue opened with the
call Completion application context is shown in figure 22.1/2. The MAP process
invokes a macro not defined in this subclause; the definition of this macro
can be found as follows:
Receive_Open_Ind see subclause 25.1.
Any call completion SS process in the GLR starts by the GLR receiving a MAP-
OPEN service indication. If that service is successful, the GLR can handle
call completion supplementary service indications from the VLR. Table 22.1/2
shows the co-ordinating process\' reaction on receipt of specific call
completion SS service indications from the VLR. After the relevant process is
invoked, the received service indication is sent to that process.
Table 22.1/2: Relationship between received service indication and invoked
process in the GLR
* * *
Service indication received Process invoked MAP_REGISTER_CC_ENTRY_ind
REGISTER_CC_ENTRY_GLR MAP_ERASE_CC_ENTRY_ind ERASE_CC_ENTRY_GLR
* * *
After creation of the user process the Co-ordinator relays the messages
between the MAP_PM and the invoked process until a request or an indication
for dialogue termination is received.
The Call_Completion Co-ordinator is shown in figure 22.1/2.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.1/2: Process_CC_Coord_GLR
## 22.2 Registration procedure
### 22.2.1 General
The registration procedure is used to register data related to a supplementary
service in the HLR. The registration procedure is a fully transparent
communication between the MS and the HLR.
### 22.2.2 Procedures in the GLR
**Supplementary service registration**
When receiving the MAP_REGISTER_SS indication from VLR, the MAP user in the
GLR transfers the information to the HLR in the MAP_REGISTER_SS request
without checking the contents of the service indication.
The GLR then awaits the receipt of the MAP_REGISTER_SS confirm from the HLR.
The MAP user in the GLR shall transfer the information contained in this
primitive to the VLR in the MAP_REGISTER_SS response without checking its
contents.
**Error handling**
If at any time during this procedure a MAP_P_ABORT, MAP_U_ABORT, MAP_NOTICE or
unexpected MAP_CLOSE indication is received from the VLR concerning the
process, a MAP_U_ABORT request indicating application procedure cancellation
is sent to the HLR (if a connection exists). If a MAP_NOTICE indication was
received from the VLR, that dialogue must be closed by sending a MAP_CLOSE
request towards the VLR. The process is terminated.
If a MAP_P_ABORT, MAP_U_ABORT or MAP_CLOSE indication is received from the
HLR, a MAP_U_ABORT request shall be sent to the VLR terminating the process.
If a MAP_NOTICE indication was received from the HLR, that dialogue must be
closed by sending a MAP_CLOSE request towards the HLR. The process terminates.
The registration procedure in the GLR is shown in figure 22.2/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.2/1 (sheet 1 of 2): Procedure SS_Register_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.2/1 (sheet 2 of 2): Procedure SS_Register_GLR
## 22.3 Erasure procedure
### 22.3.1 General
The erasure procedure is used to erase data related to a supplementary service
in the HLR. The erasure procedure is a fully transparent communication between
the MS and the HLR.
### 22.3.2 Procedures in the GLR
The GLR procedures for erasure are identical to those specified for
registration in subclause 22.2. The text and diagrams in subclause 22.2 apply
with all references to registration changed to erasure.
## 22.4 Activation procedure
### 22.4.1 General
The activation procedure is used to activate a supplementary service in the
HLR. The activation procedure is a fully transparent communication between the
MS and the HLR.
### 22.4.2 Procedures in the GLR
Supplementary service activation
When receiving the MAP_ACTIVATE_SS indication, the MAP user in the GLR
transfers the information to the HLR in the MAP_ACTIVATE_SS request without
checking the contents of the service indication.
The GLR may then receive the MAP_GET_PASSWORD indication. This information is
transferred to the VLR in the MAP_GET_PASSWORD request. If a MAP_GET_PASSWORD
confirm primitive is received from the VLR, the VLR initiates the
MAP_GET_PASSWORD response towards the HLR.
The GLR will receive the MAP_ACTIVATE_SS confirm from the HLR. The MAP user in
the GLR shall transfer the information contained in this primitive to the VLR
in the MAP_ACTIVATE_SS response without checking its contents.
Error handling
The handling of MAP_P_ABORT, MAP_U_ABORT, MAP_NOTICE and unexpected MAP_CLOSE
in this procedure is identical to the handling in the Registration procedure
in the GLR, see subclause 22.2 of the present document.
The activation procedure in the GLR is shown in figure 22.4/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.4/1 (sheet 1 of 2): Procedure Activate_SS_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.4/1 (sheet 2 of 2): Procedure SS_Activate_GLR
## 22.5 Deactivation procedure
### 22.5.1 General
The deactivation procedure is used to deactivate a supplementary service in
the HLR. The deactivation procedure is a fully transparent communication
between the MS and the HLR.
### 22.5.2 Procedures in the GLR
The GLR procedures for deactivation are identical to those specified for
activation in subclause 22.4. The text and diagrams in subclause 22.4 apply
with all references to activation changed to deactivation.
## 22.6 Interrogation procedure
### 22.6.1 General
The interrogation procedure is used to retrieve information related to a
supplementary service from the VLR or the HLR. The interrogation procedure in
the GLR is a fully transparent communication between the VLR and the HLR.
### 22.6.2 Procedures in the GLR
The GLR procedures for interrogation are identical to those specified for
registration in subclause 22.2. The text and diagrams in subclause 22.2 apply
with all references to registration changed to interrogation.
## 22.7 Password registration procedure
### 22.7.1 General
The password registration procedure is used to register a password in the HLR.
The password registration procedure is a fully transparent communication
between the MS and the HLR.
### 22.7.2 Procedures in the GLR
The password registration procedure in the GLR is identical to that for
activation specified in subclause 22.4. All the text and diagrams in subclause
22.4 apply with all references to activation changed to password registration.
## 22.8 Mobile Initiated USSD procedure
### 22.8.1 Procedures in the GLR
The initiation of the process is shown in subclause 22.1.
In the case that a GLR is located between the VLR and the HLR, the Mobile
Initiated USSD procedure in the GLR is a fully transparent communication
between the VLR and the HLR.
When receiving the MAP_PROCESS_UNSTRUCTURED_SS_REQUEST indication from VLR,
the MAP user in the GLR transfers the information to the HLR in the
MAP_PROCESS_UNSTRUCTURED_SS_REQUEST request without checking the contents of
the service indication.
The GLR may subsequently receive one or more MAP_UNSTRUCTURED_SS_REQUEST or
MAP_UNSTRUCTURED_SS_NOTIFY indications from the HLR. These shall be sent
transparently to the VLR. When a confirmation is received from the VLR this
shall be returned to the HLR.
When the GLR receives a MAP_PROCESS_UNSTRUCTURED_SS_REQUEST confirmation from
the HLR then it shall pass this to the VLR and closes the MAP provider
service.
Error Handling
Both the VLR and the HLR may initiate release of the MAP service at any time.
This is handled as shown in the diagrams.
The procedure in the HLR is shown in figure 22.8/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.8/1 (sheet 1 of 2): Procedure MI_USSD_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.8/1 (sheet 2 of 2): Procedure MI_USSD_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.8/2: Macro MS_Receive_ERROR_at_GLR
## 22.9 Network initiated USSD procedure
### 22.9.1 Procedure in the GLR
In the case that a GLR is located between the VLR and the HLR, the Network
initiated USSD procedure in the GLR is a fully transparent communication
between the VLR and the HLR.
The procedure may be invoked by the HLR. It may start by using either the
MAP_UNSTRUCTURED_SS_REQUEST or MAP_UNSTRUCTURED_SS_NOTIFY service.
The GLR may subsequently receive one or more MAP_UNSTRUCTURED_SS_REQUEST_ind
or MAP_UNSTRUCTURED_SS_NOTIFY_ind indications from the VLR. These shall be
sent transparently to the HLR. When a confirmation is received from the HLR
this shall be returned to the VLR.
When the GLR receives a MAP_CLOSE_ind from the HLR then it shall pass this to
the VLR and close the MAP dialogue.
Error Handling
Both the VLR and the HLR may initiate release of the MAP service at any time.
This is handled as shown in the diagrams.
The Network initiated USSD procedure in the GLR is shown in figure 22.9/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.9/1 (sheet 1 of 2): Procedure NI_USSD_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.9/1 (sheet 2 of 2): Procedure NI_USSD_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.9/2: Marco NW_Receive_Rrror_at_GLR
## 22.10 Common macros for clause 22
### 22.10.1 SS Password handling macros
Macro Get_Password_GLR
This macro is used by the GLR to relay a request for password from the HLR to
the VLR, and to relay a response from the VLR back to the HLR. The macro is
described in figure 22.10/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.10/1: Macro Get_PW_GLR
## 22.11 Activation of a CCBS request
### 22.11.1 General
The Activation of a CCBS request procedure in the GLR is a fully transparent
communication between the VLR and the HLR.
### 22.11.2 Procedure in the GLR
When receiving the MAP_REGISTER_CC_ENTRY indication from VLR, the MAP user in
the GLR transfers the information to the HLR in the MAP_REGISTER_CC_ENTRY
request without checking the contents of the service indication.
When the GLR receives a MAP_REGISTER_CC_ENTRY confirmation from the HLR then
it shall pass this to the VLR and closes the MAP provider service.
The activation of a CCBS request procedure in the GLR is shown in figure
22.11/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.11/1 (sheet 1 of 2): Process Register_CC_Entry_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.11/1 (sheet 2 of 2): Process Register_CC_Entry_GLR
## 22.12 Deactivation of a CCBS request
### 22.12.1 General
The Deactivation of a CCBS request procedure in the GLR is a fully transparent
communication between the VLR and the HLR.
### 22.12.2 Procedure in the GLR
When receiving the MAP_ ERASE _CC_ENTRY indication from VLR, the MAP user in
the GLR transfers the information to the HLR in the MAP_ ERASE _CC_ENTRY
request without checking the contents of the service indication.
When the GLR receives a MAP_ ERASE _CC_ENTRY confirmation from the HLR then it
shall pass this to the VLR and closes the MAP provider service.
The deactivation of a CCBS request procedure in the GLR is shown in figure
22.12/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.12/1 (sheet 1 of 2): Process Erase_CC_Entry_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 22.12/1 (sheet 2 of 2): Process Erase_CC_Entry_GLR
# 23 Short message service procedures
## 23.1 General
The short message service procedures are used to control both mobile
originated and mobile terminated short message transfer.
Four procedures exist for short message services (see 29.002) but only the
following two procedures are involved in the GLR and the IM-MSC:
\- mobile terminated short message service transfer;
\- short message alert procedure.
## 23.2 The mobile terminated short message transfer procedure
The mobile terminated short message transfer procedure is used for forwarding
a short message or several short messages from a Service Centre to a mobile
subscriber. This subclause includes the description of the procedures in the
IM-MSC and the GLR. The procedures in the other existing entities are entirely
the same as in the network without the GLR and are described in 29.002.
### 23.2.1 Procedure in the Intermediate MSC
When initiating the dialogue with the IM-MSC, the SMS Gateway MSC must provide
the IMSI of the subscriber to whom the short message is directed.
The IMSI can be included either in the Destination Reference of the MAP_OPEN
indication received from the SMS Gateway MSC or in the sm-RP-DA information
field of the MAP_MT_FORWARD_SHORT_MESSAGE indication.
When receiving a MAP_OPEN indication primitive that is not associated with any
MAP service indication primitive and if the dialogue is accepted, the MAP
service-user in the IM-MSC issues a MAP_DELIMITER request primitive in order
to trigger the local MAP service-provider to confirm the dialogue.
When receiving the first MAP_MT_FORWARD_SHORT_MESSAGE indication from the
gateway MSC, the IM- MSC retrieves the E.164 Number of the servicing MSC from
the GLR if the MAP service primitive is accepted.
The MAP_MT_FORWARD_SHORT_MESSAGE indication primitive is checked by the macro
\"Check_Indication\". If the received MAP service primitive contains errors,
the service is aborted and an unexpected data value error or data missing
error is returned to the GMSC.
The subscriber identity information that may be included in the MAP_OPEN
indication primitive and in the MAP service indication primitive is checked by
the macro \"Check_Subscr_Identity_For_MT_SMS\" as follows.
If a Destination Reference has been received in the MAP_OPEN indication, an
LMSI must be present in the sm-RP-DA information field of the
MAP_MT_FORWARD_SHORT_MESSAGE indication. The LMSI shall be key information for
retrieving the MSC Number in the GLR.
Otherwise, if the IMSI is included in the sm-RP-DA information field of the
MAP_MT_FORWARD_SHORT_MESSAGE indication, it is used to retrieve the MSC Number
in the GLR.
If:
a Destination Reference has been received in the IM-MSC and the sm-RP-DA
information field of the MAP_MT_FORWARD_SHORT_MESSAGE indication does not
include an LMSI, or
no Destination Reference has been received and the sm-RP-DA information field
does not cover an IMSI;
the service is aborted in the IM-MSC and the error \"Unexpected Data Value\"
is returned to the SMS GMSC.
The interaction between the IM-MSC and the GLR for the MSC Number retrieval is
described in 3GPP TS 23.119 GLR‑stage2.
If the IM-MSC is successfully retrieves the MSC Number it initiates the
forward short message procedure to the servicing MSC. The presence of the
Destination Reference in the MAP_OPEN request and the LMSI or IMSI in the
first MAP_MT_FORWARD_SHORT_MESSAGE request follows the message received from
the GMSC. The More Messages To Send flag is set to TRUE or FALSE depending on
the information received from the GMSC.
If the grouping of MAP_OPEN request and MAP_MT_FORWARD_SHORT_MESSAGE request
together would need segmenting, these primitives must not be grouped together.
The MAP_OPEN request primitive is sent first without any associated MAP
service request primitive and the dialogue confirmation must be received
before the MAP_MT_FORWARD_SHORT_MESSAGE request is sent.
As a response to the procedure, the IM-MSC will receive the
MAP_MT_FORWARD_SHORT_MESSAGE confirmation indicating:
> \- a successful forwarding of the short message. This indication is passed
> to the GMSC;
>
> \- unsuccessful forwarding of the short message. This indication is passed
> to the GMSC.
The IM-MSC informs the delivery failure to the GLR, if an absent
subscriber_SM, an unidentified subscriber or SM delivery failure with error
cause MS memory capacity exceeded indication is received from the servicing
MSC. That enables the GLR set the MNRF. The interaction between the IM-MSC and
the GLR regarding the procedure is described in 3GPP TS 23.119 GLR-stage2.
Unexpected data value, system failure errors and other errors are simply
passed to the GMSC.
If the More Messages To Send flag was TRUE in the MAP_MT_FORWARD_SHORT_MESSAGE
request and the previous short message transfer succeeded, then the IM-MSC
awaits the next short message.
When receiving the next short message from the GMSC, the IM-MSC sets the More
Messages To Send flag according to the information received and starts the
service MAP_MT_FORWARD_SHORT_MESSAGE again.
If the More Messages To Send flag was FALSE or the service
MAP_MT_FORWARD_SHORT_MESSAGE ends unsuccessfully, the transaction to the
gateway MSC is terminated.
The mobile terminated short message transfer procedure in the IM-MSC is shown
in figure 23.2/1 and 23.2/2.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/1 (sheet1 of 3): Procedure_MT_SM_Transfer_IM-MSC
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/1 (sheet 2 of 3): Procedure MT_SM_Transfer_IM-MSC
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/1 (sheet 3 of 3): Procedure MT_SM_Transfer_IM-MSC
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/2 (sheet1 of 2): Macro MT_SM_IM-MSC
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/2 (sheet2 of 2): Macro MT_SM_IM-MSC
### 23.2.2 Procedure in the GLR
When initiating the dialogue with the GLR, the SMS Gateway MSC must provide
the IMSI of the subscriber to whom the short message is directed.
The IMSI is included in the sm-RP-DA information field of the
MAP_MT_FORWARD_SHORT_MESSAGE indication.
When receiving a MAP_OPEN indication primitive that is not associated with any
MAP service indication primitive and if the dialogue is accepted, the MAP
service-user in the GLR issues a MAP_DELIMITER request primitive in order to
trigger the local MAP service-provider to confirm the dialogue.
When receiving the first MAP_MT_FORWARD_SHORT_MESSAGE indication from the
gateway MSC, the GLR performs some subscriber data checks, if the MAP service
primitive is accepted.
The MAP_MT_FORWARD_SHORT_MESSAGE indication primitive is checked by the macro
\"Check_Indication\". If the received MAP service primitive contains errors,
the service is aborted and an unexpected data value error or data missing
error is returned to the GMSC.
The subscriber identity information that is included in the MAP service
indication primitive is checked by the macro
\"Check_Subscr_Identity_For_MT_SMS\" as follows:
If the IMSI is included in the sm-RP-DA information field of the
MAP_MT_FORWARD_SHORT_MESSAGE indication, the MAP_OPEN indication received from
the gateway MSC shall not include a Destination Reference.
If no Destination Reference has been received and the sm-RP-DA information
field does not cover an IMSI the service is aborted in the GLR and the error
\"Unexpected Data Value\" is returned to the GMSC.
The following outcomes from the subscriber data checks can occur in GLR:
\- if the mobile subscriber is unknown, the unidentified subscriber error is
forwarded to the GMSC;
\- if the \"Confirmed by HLR\" indicator is set to \"Not Confirmed\", the
unidentified subscriber error is forwarded to the GMSC.
If the mobile subscriber is known and \"Confirmed by HLR\" indicator is set to
\"Confirmed\", the GLR shall successfully retrieves the SGSN Number.
If the GLR is successfully retrieves the SGSN Number it initiates the forward
short message procedure to the SGSN. The IMSI is included in the sm-RP-DA
information field of the MAP_MT_FORWARD_SHORT_MESSAGE request. More Messages
To Send flag is set to TRUE or FALSE depending on the information received
from the GMSC.
If the grouping of MAP_OPEN request and MAP_MT_FORWARD_SHORT_MESSAGE request
together would need segmenting, these primitives must not be grouped together.
The MAP_OPEN request primitive is sent first without any associated MAP
service request primitive and the dialogue confirmation must be received
before the MAP_MT_FORWARD_SHORT_MESSAGE request is sent.
As a response to the procedure, the GLR will receive the
MAP_MT_FORWARD_SHORT_MESSAGE confirmation indicating:
> \- a successful forwarding of the short message. This indication is passed
> to the GMSC;
>
> \- unsuccessful forwarding of the short message. This indication is passed
> to the GMSC.
The GLR sets MNRG, if an absent subscriber_SM (except for the case that absent
subscriber reason is PurgedMS), an unidentified subscriber or SM delivery
failure with error cause MS memory capacity exceeded indication is received
from the SGSN.
If the GLR receives an absent subscriber_SM and absent subscriber reason is
PurgedMS, the GLR deletes the subscriber data for the user.
Unexpected data value, system failure errors and other errors are simply
passed to the GMSC.
If the More Messages To Send flag was TRUE in the MAP_MT_FORWARD_SHORT_MESSAGE
request and the previous short message transfer succeeded, then the GLR awaits
the next short message.
When receiving the next short message from the GMSC, the GLR sets the More
Messages To Send flag according to the information received and starts the
service MAP_MT_FORWARD_SHORT_MESSAGE again.
If the More Messages To Send flag was FALSE or the service
MAP_MT_FORWARD_SHORT_MESSAGE ends unsuccessfully, the transaction to the
gateway MSC is terminated.
The mobile terminated short message transfer procedure in the GLR is shown in
figure 23.2/3 and 23.2/4.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/3 (sheet 1 of 3): Procedure MT_SM_Transfer_GLR
{width="6.745138888888889in" height="8.158333333333333in"}
Figure 23.2/3 (sheet 2 of 3): Procedure MT_SM_Transfer_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/3 (sheet 3 of 3): Procedure MT_SM_Transfer_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.2/4 (sheet1 of 2): Macro MT_SM_GLR
{width="6.5875in" height="7.966666666666667in"}
Figure 23.2/4 (sheet2 of 2): Macro MT_SM_GLR
## 23.3 The Short Message Alert procedure
The Short Message Alert procedure is used for alerting the Service Centre when
the mobile subscriber is active after a short message transfer has failed
because the mobile subscriber is not reachable or when the MS has indicated
that it has memory capacity to accept a short message.
### 23.3.1 Procedures in the GLR
When the GLR receives MAP_READY_FOR_SM indication from the VLR or the SGSN and
it has MNRF or MNRG, it sends MAP_READY_FOR_SM request to the HLR.
If the outcome is successful, the MNRF or MNRG is cleared.
The short message alert procedure in the GLR is shown in figure 23.3/1.
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.3/1 (sheet 1 of 2): Process SM_Alert_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 23.3/1 (sheet 2 of 2): Process SM_Alert_GLR
# 24 GPRS process description
## 24.1 General
The MAP GPRS procedures are used for the Network Requested PDP-Context
Activation procedures.
The stage 2 specification for Packet Switched Service involving GLR is in 3GPP
TS 23.119.
## 24.2 Send Routing Information procedure
### 24.2.1 Process in the GLR for Send Routing Information for GPRS
The MAP process in the GLR to provide routing information for a network-
requested PDP context activation is shown in figure 24.2/1. The MAP process
invokes a macro not defined in this subclause; the definition of this macro
can be found as follows:
\- Receive_Open_Ind see subclause 25.1;
\- Check_Indication see subclause 25.2.
Successful outcome
When the MAP process receives a MAP_OPEN indication with the application
context gprsLocationInfoRetrieval, it checks it by invoking the macro
Receive_Open_Ind.
If the macro takes the OK exit, the MAP process waits for a service
indication.
If a MAP_SEND_ROUTING_INFO_FOR_GPRS service indication is received, the GLR
sends a Send Routing Info For Gprs request to the GPRS application process in
the GLR, and wait for a response. The Send Routing Info For Gprs request
contains the parameter received in the MAP_SEND_ROUTING_INFO_FOR_GPRS service
indication.
If the GPRS application process in the GLR returns a positive response
containing the routing information, the MAP process constructs a
MAP_SEND_ROUTING_INFO_FOR_GPRS service response containing the routing info,
constructs a MAP_CLOSE service request, sends them to the IM-GSN and returns
to the idle state.
Negative response from GLR GPRS application process
If the GPRS application process in the GLR returns a negative response, the
MAP process constructs a MAP_SEND_ROUTING_INFO_FOR_GPRS service response
containing the appropriate error, constructs a MAP_CLOSE service request,
sends them to the IM-GSN and returns to the idle state.
Failure of dialogue opening with the IM-GSN
If the macro Receive_Open_Ind takes the Vr exit or the Error exit, the MAP
process returns to the idle state.
If the MAP provider sends a MAP_P_ABORT while the MAP process is waiting for a
service indication, the MAP process returns to the idle state.
If the MAP provider sends a MAP_NOTICE while the MAP process is waiting for a
service indication, the MAP process sends a MAP_CLOSE request to terminate the
dialogue and returns to the idle state.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 24.2/1: Process Send Routing Info For Gprs_GLR
### 24.2.2 Process in the IM-GSN for Send Routing Information for GPRS
Successful Outcome
When the MAP process receives a Send Routing Info For Gprs request from the
GPRS application process in the IM-GSN, it:
\- requests a dialogue with the GLR whose identity is contained in the Send
Routing Info For Gprs request by sending a MAP_OPEN service request;
\- requests routeing information using a MAP_SEND_ROUTING_INFO_FOR_GPRS
service request, and
\- invokes the macro Receive_Open_Cnf to wait for the response to the dialogue
opening request.
If the dialogue opening is successful, the MAP process waits for a response
from the GLR.
If the MAP process receives a MAP_SEND_ROUTING_INFO_FOR_GPRS service confirm
from the GLR, the MAP process invokes the macro Check_Confirmation to check
the content of the confirmation.
If the macro Check_Confirmation takes the OK exit, the MAP process sends a
Send Routing Info For Gprs ack containing the routing information received
from the GLR to the GPRS application process in the IM-GSN and returns to the
idle state.
Failure of dialogue opening with the GLR
If the macro Receive_Open_Cnf takes the Vr exit or the Error exit, the MAP
process sends a negative response to the GPRS application process in the IM-
GSN and returns to the idle state.
Error in MAP_SEND_ROUTING_INFO_FOR_GPRS confirm
If the MAP_SEND_ROUTING_INFO_FOR_GPRS service confirm contains a user error or
a provider error, or the macro Check_Confirmation indicates that there is a
data error, the MAP process sends a Send Routing Info For Gprs negative
response to the GPRS application process in the IM-GSN and returns to the idle
state.
Abort of GLRdialogue
After the dialogue with the GLR has been established, the MAP service provider
may abort the dialogue by issuing a MAP_P_ABORT or a MAP_U_ABORT indication.
In this case, the MAP process sends a Send Routing Info For Gprs negative
response to the GPRS application process in the IM-GSN and returns to the idle
state.
If the MAP provider indicates a protocol problem by sending a MAP_NOTICE
indication, the MAP process closes the dialogue with the GLR, sends a Send
Routing Info For Gprs negative response indicating system failure to the GPRS
application process in the IM-GSN and returns to the idle state.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 24.2/2: Process Send_Routing_Info_For_Gprs_IM-GSN
## 24.3 Failure Report procedure
### 24.3.1 Process in the GLR for Failure Report
The MAP process in the GLR to set the MNRG (Mobile station Not Reachable for
GPRS) flag for the subscriber is shown in figure 24.3/1. The MAP process
invokes a macro not defined in this subclause; the definition of this macro
can be found as follows:
\- Receive_Open_Ind see subclause 25.1;
\- Check Indication see subclause 25.2.
Successful outcome
When the MAP process receives a MAP_OPEN indication with the application
context failureReport, it checks it by invoking the macro Receive_Open_Ind.
If the macro takes the OK exit, the MAP process waits for a service
indication.
If a MAP_FAILURE_REPORT service indication is received, the GLR sends a
Failure Report request to the GPRS application process in the GLR, and wait
for a response. The Failure Report request contains the parameter received in
the MAP_FAILURE_REPORT service indication.
If a positive response is received, the MAP process constructs a
MAP_FAILURE_REPORT service response, constructs a MAP_CLOSE service request,
sends them to the IM-GSN and returns to the idle state.
Negative response from GLR GPRS application process
If the GPRS application process in the GLR returns a negative response, the
MAP process constructs a MAP_FAILURE_REPORT service response containing the
appropriate error, constructs a MAP_CLOSE service request, sends them to the
IM-GSN and returns to the idle state.
Failure of dialogue opening with the IM-GSN
If the macro Receive_Open_Ind takes the Vr exit or the Error exit, the MAP
process returns to the idle state.
If the MAP provider sends a MAP_P_ABORT while the MAP process is waiting for a
service indication, the MAP process returns to the idle state.
If the MAP provider sends a MAP_NOTICE while the MAP process is waiting for a
service indication, the MAP process sends a MAP_CLOSE request to terminate the
dialogue and returns to the idle state.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 24.3/1: Process Failure_Report_GLR
### 24.3.2 Process in the IM-GSN for Failure Report
Successful Outcome
When the MAP process receives a Failure Report request from the GPRS
application process in the IM-GSN, it requests a dialogue with the GLR whose
identity is contained in the Failure Report request by sending a MAP_OPEN
service request, sending failure information using a MAP_FAILURE_REPORT
service request and invokes the macro Receive_Open_Cnf to wait for the
response to the dialogue opening request. If the dialogue opening is
successful, the MAP process waits for a response from the GLR.
If the MAP process receives a MAP_FAILURE_REPORT service confirm from the GLR,
the MAP process invokes the macro Check_Confirmation to check the content of
the confirmation.
If the macro Check_Confirmation takes the OK exit, the MAP process sends a
Failure Report ack containing the information received from the GLR to the
GPRS application process in the IM-GSN and returns to the idle state.
Failure of dialogue opening with the GLR
If the macro Receive_Open_Cnf takes the Vr exit or the Error exit, the MAP
process sends a negative response to the GPRS application process in the IM-
GSN and returns to the idle state.
Error in MAP_FAILURE_REPORT confirm
If the MAP_FAILURE_REPORT service confirm contains a user error or a provider
error, or the macro Check_Confirmation indicates that there is a data error,
the MAP process sends a Failure Report negative response to the GPRS
application process in the IM-GSN and returns to the idle state.
Abort of GLR dialogue
After the dialogue with the GLR has been established, the MAP service provider
may abort the dialogue by issuing a MAP_P_ABORT or a MAP_U_ABORT indication.
In this case, the MAP process sends a Failure Report negative response to the
GPRS application process in the IM-GSN and returns to the idle state.
If the MAP provider indicates a protocol problem by sending a MAP_NOTICE
indication, the MAP process closes the dialogue with the GLR, sends a Failure
Report negative response indicating system failure to the GPRS application
process in the IM-GSN and returns to the idle state.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 24.3/2: Process Failure_Report_IM-GSN
# 25 General macro description
## 25.1 MAP open macros
This subclause refers 3GPP TS 29.002.
## 25.2 Macros to check the content of indication and confirmation primitives
This subclause refers 3GPP TS 29.002.
## 25.3 Authentication processes
### 25.3.1 Process Obtain_Authentication_Sets_GLR
This process is initiated by the GLR to fetch authentication vectors from a
subscriber\'s HLR to the VLR. The process is described in figure 25.3/1.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 25.3.1/1 (sheet 1 of 2): Process Obtain_Authentication_Sets_GLR
{width="6.768055555555556in" height="8.185416666666667in"}
Figure 25.3.1/2 (sheet 2 of 2): Process Obtain_Authentication_Sets_GLR
### 25.3.2 Process Authentication_Failure_Report_GLR
This process is initiated by the GLR to notify a subscriber\'s HLR about the
occurrence of an authentication failure in the VLR or SGSN. The process is
described in figure 25.3/2.
{width="6.651388888888889in" height="8.378472222222221in"}
Figure 25.3.2/1 (sheet 1 of 2): Process Authentication_Failure_Report_GLR
{width="6.651388888888889in" height="8.029861111111112in"}
Figure 25.3.2/2 (sheet 2 of 2): Process Authentication_ Failure_Report _GLR
## 25.4 Short Message Alert procedures
### 25.4.1 Subscriber_Present_GLR_AS_VLR process
The Subscriber_Present_GLR_AS_VLR process is invoked by the GLR, when GLR
receives Update Location from VLR and the MNRF flag is set. The general
description of the short message alert procedures is in the subclause 23.3.
The GLR sends the MAP_READY_FOR_SM request to the HLR and waits for the HLR to
answer. When receiving the answer, the GLR will act as follows:
\- the MNRF flag is cleared if the procedure is successful;
\- the MNRF flag is not cleared if the procedure is not successful.
The Subscriber_Present_GLR_AS_VLR process is shown in the figure 25.4/1.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 25.4/1: Process Subscriber_Present_GLR_AS_VLR
### 25.4.2 The Mobile Subscriber is present
When GLR receives Update GPRS Location from SGSN, while the MS not reachable
for GPRS (MNRG) flag is set, the GLR will send the MAP_READY_FOR_SM request
towards the HLR. The Alert Reason is set to indicate that the mobile
subscriber is present for GPRS.
When receiving the answer, the GLR will act as follows:
\- MNRG is cleared if the procedure is successful.
\- MNRG is not cleared if the procedure is not successful.
The Subscriber_Present_GLR_AS_SGSN process is shown in the figure 25.4/2.
{width="6.768055555555556in" height="8.539583333333333in"}
Figure 25.4/2: Process Subscriber_Present_GLR_AS_SGSN
#
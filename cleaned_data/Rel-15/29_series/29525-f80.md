# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present specification provides the stage 3 definition of the UE Policy
Control Service (Npcf_UEPolicyControl) of the 5G System.
The stage 2 definition and procedures of UE Policy Control Service are
contained in 3GPP TS 23.502 [3] and 3GPP TS 23.503 [4]. The 5G System
Architecture is defined in 3GPP TS 23.501 [2].
Stage 3 call flows are provided in 3GPP TS 29.513 [7].
The Technical Realization of the Service Based Architecture and the Principles
and Guidelines for Services Definition of the 5G System are specified in 3GPP
TS 29.500 [5] and 3GPP TS 29.501 [6].
The UE Policy Control Service is provided by the Policy Control Function
(PCF). This service provides UE policies.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System;
Stage 2\".
[5] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
[6] 3GPP TS 29.501: \"5G System; Principles and Guidelines for Services
Definition; Stage 3\".
[7] 3GPP TS 29.513: \"5G System; Policy and Charging Control signalling flows
and QoS parameter mapping; Stage 3\".
[8] IETF RFC 7540: \"Hypertext Transfer Protocol Version 2 (HTTP/2)\".
[9] IETF RFC 8259: \"The JavaScript Object Notation (JSON) Data Interchange
Format\".
[10] OpenAPI, \"OpenAPI 3.0.0 Specification\", https://github.com/OAI/OpenAPI-
Specification/blob/master/versions/3.0.0.md.
[11] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
[12] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[13] 3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage
3\".
[14] 3GPP TS 29.518: \"5G System; Access and Mobility Management Services;
Stage 3\".
[15] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[16] 3GPP TS 24.526: \"UE policies for 5G System (5GS); Stage 3\".
[17] 3GPP TS 29.519: \"5G System; Usage of the Unified Data Repository service
for Policy Data, Application Data and Structured Data for Exposure; Stage 3\".
[18] 3GPP TS 32.422: \"Telecommunication management; Subscriber and equipment
trace; Trace control and configuration management\".
[19] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[20] IETF RFC 6749: \"The OAuth 2.0 Authorization Framework\".
[21] IETF RFC 7807: \"Problem Details for HTTP APIs\".
[22] 3GPP TR 21.900: \"Technical Specification Group working methods\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AMF Access and Mobility Management Function
ANDSP Access Network Discovery and Selection Policy
API Application Programming Interface
DNN Data Network Name
GPSI Generic Public Subscription Identifier
GUAMI Globally Unique AMF Identifier
HTTP Hypertext Transfer Protocol
H-PCF Home Policy Control Function
JSON JavaScript Object Notation
N3AN Non-3GPP access network
NF Network Function
NRF Network Repository Function
OS Operating System
OSId Operating System Identity
PCF Policy Control Function
PEI Permanent Equipment Identifier
PRA Presence Reporting Area
PTI Procedure Transaction Identity.
SUPI Subscription Permanent Identifier
UDR Unified Data Repository
UPSC UE policy section code
UPSI UE policy section identifier
URSP UE Route Selection Policy
V-PCF Visited Policy Control Function
# 4 UE Policy Control Service
## 4.1 Service Description
### 4.1.1 Overview
The UE Policy Control Service, as defined in 3GPP TS 23.502 [3] and 3GPP TS
23.503 [4], is provided by the Policy Control Function (PCF).
This service is used as part of the provisioning of UE policies determined by
the PCF to the UE via the AMF and offers the following functionalities:
\- creation of the UE Policy Association requested by the NF service consumer
(e.g. AMF);
\- provisioning of the policy control request triggers to the NF service
consumer (e.g. AMF);
\- provisioning of the UE policy to the V-PCF by the H-PCF in the roaming
case;
\- reporting of the met policy control request trigger; and
\- deletion of the the UE Policy Association requested by the NF service
consumer (e.g. AMF).
### 4.1.2 Service Architecture
The 5G System Architecture is defined in 3GPP TS 23.501 [2]. The Policy and
Charging related 5G architecture is also described in 3GPP TS 29.513 [7].
The UE Policy Control Service (Npcf_UEPolicyControl) is part of the Npcf
service-based interface exhibited by the Policy Control Function (PCF).
The known consumers of the Npcf_UEPolicyControl service are the Access and
Mobility Management Function (AMF) and the Visited Policy Control Function
(V-PCF).
The AMF accesses the UE Policy Control Service at the PCF via the N15
Reference point. In the roaming scenario, the N15 reference point is located
between the V-PCF in the visited network and the AMF. The V-PCF accesses the
UE Policy Control Service at the Home Policy Control Function (H-PCF) via the
N24 Reference point.
Figure 4.1.2-1: Reference Architecture for the Npcf_UEPolicyControl Service;
SBI representation
Figure 4.1.2-2: Non-roaming Reference Architecture for the
Npcf_UEPolicyControlService; reference point representation
Figure 4.1.3-2: Roaming reference Architecture for the
Npcf_UEPolicyControlService; reference point representation
### 4.1.3 Network Functions
#### 4.1.3.1 Policy Control Function (PCF)
For non-roaming scenarios, the Policy Control Function (PCF):
\- Supports unified policy framework to govern network behaviour; and
\- Provides UE policy, including Access Network Discovery and Selection Policy
(ANDSP) and UE Route Selection Policy (URSP) via the AMF transparently to the
UE; and
\- Provides policy control request triggers to the AMF.
NOTE 1: The PCF invokes the Namf_Communication service specified in 3GPP TS
29.518 [14] to provide the UE Policy.
For roaming scenarios, the Visited Policy Control Function (V-PCF):
\- Provides policy control request triggers to the AMF;
\- Provides the ANDSP of the VPLMN via the AMF transparently to the UE; and
\- Forwards the ANDSP and URSP received form the H-PCF via the AMF to the UE.
NOTE 2: The V-PCF invokes the Namf_Communication service specified in 3GPP TS
29.518 [14] to provide the UE Policy.
For roaming scenarios, the Home Policy Control Function (H-PCF):
\- Provides policy control request triggers to the V-PCF; and
\- Provides the ANDSP and URSP of the HPLMN to the V-PCF for forwarding to the
UE via the the AMF.
#### 4.1.3.2 NF Service Consumers
The Access and Mobility Management function (AMF) performs:
\- Registration management;
\- Connection management;
\- Reachability management;
\- Mobility Management;
\- Forwardingof UE Policy towards the served UE;
\- Reporting of the UE state to the (V-)PCF; and
\- Forwarding of the UE policy enforcement result received from the UE to the
(V-)PCF.
NOTE: The AMF invokes the Namf_Communication service specified in 3GPP TS
29.518 [14] to report the UE policy enforcement result.
The Visited Policy Control Function (V-PCF) provides the functions described
in subclause 4.1.3.1 towards the visited network as NF service prodcer and
acts as NF Service consumer toward the H-PCF, performing the following
functions:
\- Receiving policy control request triggers, ANDSP and URSP form the H-PCF
\- Reporting of the UE state and UE policy enforcement result to the H-PCF.
## 4.2 Service Operations
### 4.2.1 Introduction
Table 4.2.1-1: Operations of the Npcf_UEPolicyControl Service
+----------------------+----------------------+----------------------+ | Service operation | Description | Initiated by | | name | | | +----------------------+----------------------+----------------------+ | Npcf_UEP | Creates a UE Policy | NF consumer (AMF, | | olicyControl_Create | Association. | V-PCF in roaming | | | | case) | +----------------------+----------------------+----------------------+ | Npcf_UEP | Updates of an UE | NF consumer (AMF, | | olicyControl_Update | Policy Association | V-PCF in roaming | | | and provides | case) | | | corresponding | | | | policies to the NF | | | | consumer when the | | | | policy control | | | | request trigger is | | | | met or the AMF is | | | | relocated due to the | | | | UE mobility and the | | | | old PCF is selected. | | +----------------------+----------------------+----------------------+ | Npcf_UEPolicyC | Provides the updated | PCF (H-PCF and V-PCF | | ontrol_UpdateNotify | policy control | in roaming case) | | | request triggers to | | | | the AMF by the | | | | (V-)PCF in the | | | | non-roaming or | | | | roaming case; | | | | | | | | Provides updated UE | | | | policy and policy | | | | control request | | | | trigger to the V-PCF | | | | by the H-PCF; or | | | | | | | | initiates the UE | | | | Policy association | | | | termination towards | | | | to the NF consumer | | | | by the NF producer. | | +----------------------+----------------------+----------------------+ | Npcf_UEP | Provides means for | NF consumer (AMF, | | olicyControl_Delete | the NF consumer to | V-PCF in roaming | | | delete the UE Policy | case) | | | Association. | | +----------------------+----------------------+----------------------+
### 4.2.2 Npcf_UEPolicyControl_Create Service Operation
#### 4.2.2.1 General
The procedure in the present subclause is applicable when the NF service
consumer creates a UE policy association in the following cases:
\- UE initial registers to the network as defined in subclause 5.5.1.2.2 of
3GPP TS 24.501 [15];
\- UE performs the mobility registration if the UE operating in the single-
registration mode performs inter-system change from S1 mode to N1 mode as
defined in subclause 5.5.1.3.2 of 3GPP TS 24.501 [15] and there is no existing
UE Policy Association between AMF and PCF for this UE;
\- the AMF is relocated (between the different AMF sets) and the new AMF
selects a new PCF. The procedure for the case where the AMF is relocated and
the new AMF selects the old PCF is defined in subclause 4.2.3.1.
The creation of an UE policy association only applies for normally registered
UEs, i.e., it does not apply for emergency-registered UEs.
Figure 4.2.2.1-1 illustrates the creation of a policy association.
Figure 4.2.2.1-1: Creation of a UE policy association
NOTE 1: For the roaming case, the PCF represents the V-PCF if the NF service
consumer is an AMF and the PCF represents the H-PCF if the NF service consumer
is a V-PCF.
To establish a UE policy association with the PCF, the NF service consumer
(e.g. AMF) shall send an HTTP POST request with: \"{apiRoot}/npcf-ue-policy-
control/v1/policies/\" as Resource URI and the PolicyAssociationRequest data
structure as request body that shall include:
\- Notification URI encoded as \"notificationUri\" attribute; and
\- SUPI encoded as \"supi\" attribute,
and that shall include when available:
\- GPSI encoded as \"gpsi\" attribute;
\- Access type encoded as \"accessType\" attribute;
\- Permanent Equipment Identifier (PEI) encoded as \"pei\" attribute;
\- User Location Information encoded as \"userLoc\" attribute;
\- UE Time Zone encoded as \"timeZone\" attribute;
\- Serving PLMN Identifier encoded as \"servingPlmn\" attribute;
\- RAT type encoded as \"ratType\" attribute;
\- the received UE policy delivery protocol message defined in Annex D of 3GPP
TS 24.501 [15] encoded as \"uePolReq\" attribute;
\- if the NF service consumer is an AMF, H-PCF ID (if the consumer is V-PCF,
when receiving the H-PCF ID from AMF) encoded as \"hPcfId\" attribute;
\- Internal Group Identifier(s) encoded as \"groupIds\" attribute;
\- if the NF service consumer is an AMF, the GUAMI encoded as \"guami\"
attribute;
\- if the NF service consumer is an AMF, the name of a service produced by the
AMF that expects to receive information within
Npcf_UEPolicyControl_UpdateNotify service operation encoded as \"serviceName\"
attribute;
\- if the NF service consumer is an AMF, alternate or backup IPv4 Address(es)
where to send Notifications encoded as \"altNotifIpv4Addrs\" attribute;
\- if the NF service consumer is an AMF, alternate or backup IPv6 Address(es)
where to send Notifications encoded as \"altNotifIpv6Addrs\" attribute; and
\- if the NF service consumer is an AMF, serving AMF Id encoded in the
\"servingNfId\" attribute.
Upon the reception of the HTTP POST request,
\- the (V-)(H-)PCF shall assign a UE policy association ID;
\- based on operator policy the V-PCF should send as the NF service consumer
towards the H-PCF a request for the Creation of a UE policy association as
described in the present clause;
\- the (V-)(H-)PCF shall determine the applicable UE policy as detailed in
subclause 4.2.2.2, for the V-PCF taking into consideration any policy received
from the H-PCF in the reply to the possible request for the Creation of a
policy association;
\- if the (V-)PCF determines that UE policy needs to be provisioned, it shall
use the Namf_Communication service specified in 3GPP TS 29.518 [14] to
provision the UE policy according to subclause 4.2.2.2 and as follows:
(i) the V-PCF shall subscribe at the AMF to notifications of N1 messages for
UE Policy Delivery Results using the Namf_Communication_N1N2MessageSubscribe
service operation;
(ii) the V-PCF shall send the determined UE policy using
Namf_Communication_N1N2MessageTransfer service operation(s); and
(iii) the V-PCF shall be prepared to receive UE Policy Delivery Results from
the AMF within the Namf_Communication_N1MessageNotify service operation and
for the V-PCF if the received UE Policy Delivery results relate to UE policy
sections provided by the H-PCF shall use the Npcf_UEPolicyControl_Update
Service Operation to send those UE Policy Delivery results to the H-PCF;
\- for the succesfull case the (V-)(H-)PCF shall send a HTTP \"201 Created\"
response with the URI for the created resource in the \"Location\" header
field
NOTE 2: The assigned policy association ID is part of the URI for the created
resource and is thus associated with the SUPI.
and the the PolicyAssociation data type as body including:
\- optionally for the H-PCF as service producer communicating with the V-PCF,
UE policy (see subclause 4.2.2.2) encoded as \"uePolicy\" attribute;
\- optionally one or several of the following Policy Control Request
Trigger(s) encoded as \"triggers\" attribute (see subclause 4.2.3.2):
a) Location change (tracking area); and
b) Change of UE presence in PRA; and
\- if the Policy Control Request Trigger \"Change of UE presence in PRA\" is
provided, the presence reporting areas for which reporting is required encoded
as \"pras\" attribute; and
\- if errors occur when processing the HTTP POST request, the (V-)(H-)PCF
shall apply error handling procedures as specified in subclause 5.7 and
according to the following provisions:
\- if the user information received within the \"supi\" attribute is unknown,
the PCF shall reject the request and include in an HTTP \"400 Bad Request\"
response message the \"cause\" attribute of the ProblemDetails data structure
set to \"USER_UNKNOWN\"; and
\- if the PCF is, due to incomplete, erroneous or missing information in the
request not able to provision an UE policy decision, the PCF may reject the
request and include in an HTTP \"400 Bad Request\" response message the
\"cause\" attribute of the ProblemDetails data structure set to
\"ERROR_REQUEST_PARAMETERS\".
If the (V-)PCF received an GUAMI, the (V-)PCF may subscribe to GUAMI changes
using the AMFStatusChange service operation of the Namf_Communication service
specified in 3GPP TS 29.518 [14], and it may use the Nnrf_NFDiscovery Service
specified in 3GPP TS 29.510 [13] (using the obtained GUAMI and possibly
service name) to query the other AMFs within the AMF set.
#### 4.2.2.2 UE Policy
##### 4.2.2.2.1 General
The UE policy consists of UE Access Network discovery and selection policies
and UE Route Selection Policy (URSP). The encoding of UE policies is defined
in 3GPP TS 24.526 [16].
The UE Policy is transferred to the UE using the UE policy delivery protocol
defined in Annex D of 3GPP TS 24.501 [15]. The (V-)(H-)PCF will receive
\"MANAGE UE POLICY COMPLETE\" messages, \"MANAGE UE POLICY COMMAND REJECT\"
messages and \"UE STATE INDICATION\" message and shall send UE policy using
the \"MANAGE UE POLICY COMMAND\" messages. Those messages are transparently
forwarded by the AMF.
The \"UE STATE INDICATION\" message is transferred transparently during the
creation of a policy association, as described in subclause 4.2.2.1.
The (V-)PCF shall use the Namf_Communication_N1N2MessageTransfer service
operation defined in subclause 5.2.2.3.1 of 3GPP TS 29.518 [14] to send MANAGE
UE POLICY COMMAND\" messages to the UE and use the
Namf_Communication_N1MessageNotify service operation defined in subclause
5.2.2.3.5 of 3GPP TS 29.518 [14] to receive \"MANAGE UE POLICY COMPLETE\" and
\"MANAGE UE POLICY COMMAND REJECT\" messages from the UE. The (V-)PCF shall
only send \"MANAGE UE POLICY COMMAND\" messages below a predefined size limit.
The H-PCF shall use service operations as defined in the present specification
to receive \"MANAGE UE POLICY COMPLETE\" and \"MANAGE UE POLICY COMMAND
REJECT\" messages from the V-PCF and to send MANAGE UE POLICY COMMAND\"
messages to the V-PCF. The H-PCF shall encode the \"MANAGE UE POLICY COMMAND\"
message in an \"uePolicy\" attribute. The H-PCF shall only send \"MANAGE UE
POLICY COMMAND\" messages below a predefined size limit.
The (V-)(H-)PCF may deliver the UE policy to the UE in several \"MANAGE UE
POLICY COMMAND\" messages.
For the purpose of such fragmented delivery and subsequent partial updates of
UE policies, the UE policy is divided into policy sections. Such policy
sections may be predefined in the (V-)(H-)PCF, may be retrieved by the
(V-)(H-)PCF from the UDR as specified in 3GPP TS 29.519 [17], or may be
dynamically generated by the (V-)(H-)PCF, but shall comply to the rules below.
The (V-)(H-)PCF may combine several policy sections into one \"MANAGE UE
POLICY COMMAND\" message if the predefined size limit is observed.
The following rules apply for policy sections:
\- The size shall be below the predefined size limit.
\- The policy section shall only contain complete URSP rule(s), WLANSP
rule(s), and/or complete N3AN node configuration information, but no fractions
of such rules or configuration information.
\- To ease a subsequent partial update of UE policies, policy sections should
only contain a small number of URSP rule(s), and/or WLANSP rule(s).
\- The entire content of a policy section shall be provided by a single PLMN.
A PCF shall only determine policy sections of its own PLMN. However, a V-PCF
may forward UE policy sections received from the H-PCF to the UE.
Each UE policy section is identified by a UE policy section identifier (UPSI).
The UPSI is composed of two parts:
a) a PLMN ID part containing the PLMN ID for the PLMN of the PCF which
provides the UE policies; and
b) a UE policy section code (UPSC) containing a unique value within the PLMN
selected by the PCF.
The (V-)(H-)PCF provides an UPSI when providing a new UE policy section and
may then identify that policy section using that UPSI when requesting that
this UE policy section is modified or deleted, as specified in Annex D of 3GPP
TS 24.501 [15].
The (H-)PCF may store in the UDR and/or retrieve from the UDR, as specified in
3GPP TS 29.519 [17]:
a) UPSCs and related policy sections of the own PLMN it provided to a UE;
b) the PEI received from the AMF;
c) the OSId(s) received from the UE as described in the Annex D of 3GPP TS
24.501 [15]; and
d) the indication of UE\'s support for ANDSP included in the \"UE STATE
INDICATION\" message as described in the Annex D of 3GPP TS 24.501 [15].
The (H-)PCF will use the SUPI of the UE as data key and store separate
information for each UE in the UDR.
The V-PCF may retrieve UPSCs and related policy sections applicable for all
UEs from a HPLMN from the UDR, using the HPLMN ID as key as specified in 3GPP
TS 29.519 [17].
When receiving the \"UE STATE INDICATION\" message, the (V-)(H-)PCF shall
determine based on the UPSIs, the ANDSP support indication and the OSId(s)
indicated in that message, UPSC stored in the UDR and local policy whether any
new UE policy sections need to be installed and any existing UE policy section
need to be updated or deleted. A V-PCF should also send an \"UE STATE
INDICATION\" message with the UPSIs of the HPLMN and the ANDSP support
indication received in the original \"UE STATE INDICATION\" message to the
H-PCF and will then receive possible new or modified policy sections
determined by the H-PCFin a \"MANAGE UE POLICY COMMAND\". If the (V-)(H-)PCF
determines that changes are required and/or the V-PCF receives possible new or
modified policy sections determined by the H-PCF in the roaming case, it shall
send the determined new, updated or deleted policy sections using one or
several \"MANAGE UE POLICY COMMAND\" messages towards the NF service consumer.
In the roaming case, the V-PCF may either combine policy sections received
from the H-PCF and policy sections the V-PCF selected in the same \"MANAGE UE
POLICY COMMAND\" (as long as the predefined size limit is observed), or use
separate \"MANAGE UE POLICY COMMAND\" messages; however, the V-PCF shall not
distribute the policy sections received in one \"MANAGE UE POLICY COMMAND\"
from the H-PCF into several \"MANAGE UE POLICY COMMAND\" messages as long as
the predefined size limit is observed for the policy sections received from
the H-PCF. The V-PCF shall allocate a new PTI for the \"MANAGE UE POLICY
COMMAND\" sent by the V-PCF and store the mapping between the new PTI and the
PTI within the \"MANAGE UE POLICY COMMAND\" received from the H-PCF.
After sending a \"MANAGE UE POLICY COMMAND\" messages, the (V-)(H-)PCF shall
wait for a related confirmation in a \"MANAGE UE POLICY COMPLETE\" messages or
failure indication in a \"MANAGE UE POLICY COMMAND REJECT\" message. When
receiving no such message until the expiry of a supervision timer specified in
Annex D of 3GPP TS 24.501 [15], or when receiving a failure indication, the
PCF should re-send related instructions for the policy sections. In the
roaming case, the H-PCF and the V-PCF shall each be responsible for resending
those policy sections that it originally supplied. In the case that the V-PCF
combined policy sections received from the H-PCF and policy sections the V-PCF
selected in the same \"MANAGE UE POLICY COMMAND\" described below, the V-PCF
shall wait for the H-PCF to resend the policy sections of HPLMN, and then
resend the combined policy sections. The (V-)(H-)PCF shall always include the
initially supplied policy sections when resending the UE policy.
The (V-)(H-)PCF shall determine that a received \"MANAGE UE POLICY COMPLETE\"
message or \"MANAGE UE POLICY COMMAND REJECT\" message is related to the
result of a \"MANAGE UE POLICY COMMAND\" based on the PTI within that message.
In the roaming case, the V-PCF shall determine that the received message is
related to the result of the UE policy provided by the H-PCF if the PTI within
the message belongs to one of the stored PTI mapping.
If the V-PCF combined policy sections received from the H-PCF and policy
sections the V-PCF selected in the same \"MANAGE UE POLICY COMMAND\", upon
reception of a \"MANAGE UE POLICY COMPLETE\" message or \"MANAGE UE POLICY
COMMAND REJECT\" message the V-PCF shall:
\- forward the corresponding \"MANAGE UE POLICY COMPLETE\" message to the
H-PCF;
\- if a \"MANAGE UE POLICY COMMAND REJECT\" message with UPSI(s) of the HPLMN
is received, forward the parts of the \"MANAGE UE POLICY COMMAND REJECT\"
message that relate to the UPSI(s) of the HPLMN to the H-PCF;
\- if a \"MANAGE UE POLICY COMMAND REJECT\" message without UPSI(s) of the
HPLMN is received, send a \"MANAGE UE POLICY COMPLETE\" message to the H-PCF;
and
\- provide the stored PTI received from the HPLMN in the corresponding
\"MANAGE UE POLICY COMMAND\" within the \"MANAGE UE POLICY COMPLETE\" message
or \"MANAGE UE POLICY COMMAND REJECT\" message towards the H-PCF.
If the V-PCF sent a separate \"MANAGE UE POLICY COMMAND\" containing only the
policy sections received from the H-PCF, the V-PCF shall forward the
corresponding \"MANAGE UE POLICY COMPLETE\" or \"MANAGE UE POLICY COMMAND
REJECT\" message to the H-PCF and provide the stored PTI received from the
HPLMN in the corresponding \"MANAGE UE POLICY COMMAND\" within the \"MANAGE UE
POLICY COMPLETE\" message or \"MANAGE UE POLICY COMMAND REJECT\" message
towards the H-PCF.If the V-PCF distributed the policy sections received in one
\"MANAGE UE POLICY COMMAND\" from the H-PCF into several \"MANAGE UE POLICY
COMMAND\" messages to the UE (because the predefined size limit of the VPLMN
was exceeded), the V-PCF shall aggregate all corresponding \"MANAGE UE POLICY
COMPLETE\" or \"MANAGE UE POLICY COMMAND REJECT\" messages received from the
UE into one \"MANAGE UE POLICY COMPLETE\" or \"MANAGE UE POLICY COMMAND
REJECT\" message towards the H-PCF.
When the (V-)PCF receives an Namf_Communication_N1N2MessageTransfer failure
response as defined in subclause 5.2.2.3.1.2 of 3GPP TS 29.518 [14], or an
N1N2 Transfer Failure Notification as defined in subclause 5.2.2.3.2 of 3GPP
TS 29.518 [14], the (V-)PCF shall stop the supervision timer specified in
Annex D of 3GPP TS 24.501 [15] corresponding to the affected PTIs. For the
N1N2 Transfer Failure Notification case, the (V-)PCF determines the affected
PTIs allocated by the V-PCF based on the resource URI within the
\"n1n2MsgDataUri\" attribute of the N1N2MsgTxfrFailureNotification data
structure as defined in subclause 6.1.6.2.30 of 3GPP TS 29.518 [14].
NOTE: The (V-)PCF correlates the Namf_Communication_N1N2MessageTransfer
request and the corresponding N1N2 Transfer Failure Notification based on the
resource URI within the \"Location\" header included in the response HTTP
status code \"202 Accepted\" of the Namf_Communication_N1N2MessageTransfer
response and the resource URI within the \"n1n2MsgDataUri\" attribute of and
N1N2 Transfer Failure Notification. And then the V-PCF determines the affected
PTIs related with the resource URI.
For the roaming case and if the V-PCF determines that the affected UE policy
is related with the UE policy delivered by the H-PCF, the V-PCF shall send the
POST message as defined in subclause 4.2.3.1 to notify the H-PCF of the
failure of UE policy transfer by including the \"uePolTransFailNotif\"
attribute within the PolicyAssociationUpdateRequest data structure. Within the
UePolicyTransferFailureNotification data structure, the V-PCF shall include
the cause of the UE Policy Transfer Failure within the \"cause\" attribute and
the PTI(s) allocated by the H-PCF corresponding to the PTI(s) allocated by the
V-PCF within the \"ptis\" attribute. The H-PCF shall stop the supervision
timer corresponding to the affected PTIs.
##### 4.2.2.2.2 UE Access Network discovery and selection policies
UE Access Network discovery and selection policies are used by the UE to
select non-3GPP accesses and to decide how to route traffic between the
selected 3GPP and non 3GPP accesses.
In this release of the specification, the Access Network Discovery & Selection
policy shall contain only rules that aid the UE in selecting a WLAN access
network. Rules for selecting other types of non-3GPP access networks are not
specified.
The WLAN access network selected by the UE with the use of Access Network
Discovery & Selection policy may be used for direct traffic offload (i.e.
sending traffic to the WLAN outside of a PDU Session) and for registering to
5GC using the non-3GPP access network selection information.
The Access Network Discovery & Selection policy shall contain one or more WLAN
Selection Policy (WLANSP) rules and and may contain Non-3GPP access network
(N3AN) node selection information and configuration information.
N3AN node selection information and configuration information is used to
control UE behaviour related to selection of either N3IWF or ePDG for
accessing 5GC via non-3GPP access.
UE Access Network discovery and selection policies are encoded as defined in
3GPP TS 24.526 [16].
UE Access Network discovery and selection policies may be provided by a V-PCF
and/or a H-PCF.
If the UE has indicated in the \"UE STATE INDICATION\" message it does not
support ANDSP, i.e. the UE does not support non-3GPP access, the PCF shall not
send any Access Network discovery and selection policies to the UE.
##### 4.2.2.2.3 UE Route Selection Policy(URSP)
The UE Route Selection Policy is used by the UE to determine how to route
outgoing traffic.
The UE Route Selection Policy shall consist of one or several URSP rules.
URSP rules are encoded as defined in 3GPP TS 24.526 [16].
UE Route Selection Policy may only be provided by a H-PCF, but shall not be
provided by a V-PCF.
The (H-)PCF shall use the UE subscription stored in UDR as specified in 3GPP
TS 29.519 [17] to ensure the values included in the Route Selection Descriptor
of the generated URSP rules are always supported by subscription.
The (H-)PCF may obtain the information about the UE\'s OS from the UE as
described in the Annex D of 3GPP TS 24.501 [15] or it may derive the
information about the UE\'s OS from the PEI provided by the AMF.
If the (H-)PCF is required to provide UE policies to the UE that includes
application descriptors then:
a) If the (H-)PCF has been provided with one UE\'s OS Id by the UE, the
(H-)PCF shall use either the traffic descriptor \"OS App Id type\" or the
traffic descriptor \"OS Id + OS App Id type\" as defined in 3GPP TS 24.526
[16].
NOTE: The (H-)PCF uses the traffic descriptor \"OS Id + OS App Id type\" when
the (H-)PCF does not take the received UE\'s OS Id into account.
b) If the (H-)PCF has been provided with more than one UE\'s OS Id by the UE,
\- the (H-)PCF shall use the traffic descriptor \"OS Id + OS App Id type\" for
the UE\'s OS Id provided by the UE as defined in 3GPP TS 24.526 [16]; and
\- the (H-)PCF shall not use the traffic descriptor \"OS App Id type\" as
defined in 3GPP TS 24.526 [16].
c) If the (H-)PCF has not been provided with the UE\'s OS Id by the UE,
\- the (H-)PCF shall use the traffic descriptor \"OS Id + OS App Id type\" as
defined in 3GPP TS 24.526 [16]; and
\- the (H-)PCF shall not use the traffic descriptor \"OS App Id type\" as
defined in 3GPP TS 24.526 [16].
d) If the (H-)PCF has been provided with the UE\'s OS Id by the UE and the
(H-)PCF has derived the UE\'s OS Id from the PEI and if there is an
inconsistency between the OS Id provided by the UE and the OS Id derived from
the PEI, the (H-)PCF shall use the OS Id provided by the UE for providing UE
policies to the UE that include application descriptors.
### 4.2.3 Npcf_UEPolicyControl_Update Service Operation
#### 4.2.3.1 General
The procedure in the present subclause is applicable when the NF service
consumer modifies an existing UE policy association (including the case where
the AMF is relocated and the new AMF selects to maintain the policy
association with the old PCF and to update the Notification URI).
Figure 4.2.3.1-1 illustrates the update of a policy association.
Figure 4.2.3.1-1: Update of a UE policy association
NOTE 1: For the roaming case, the PCF represents the V-PCF if the NF service
consumer is an AMF and the PCF represents the H-PCF if the NF service consumer
is a V-PCF.
The AMF as NF service consumer invokes this procedure when a subscribed policy
control request trigger (see subclause 4.2.3.2) occurs: When the location
change trigger or the change of UE presence in PRA trigger occurs, the AMF
shall only invoke the procedure if the PCF has subscribed to that event
trigger.
NOTE 2: The AMF uses the Namf_Communication_N1MessageNotify service operation
specified in 3GPP TS 29.518 [14] to send a \"MANAGE UE POLICY COMPLETE\"
message or a \"MANAGE UE POLICY COMMAND REJECT\" message, as defined in Annex
D.5 of 3GPP TS 24.501 [15], to the V-PCF.
If an AMF knows by implementation specific means that the UE context has been
transferred to an AMF with another GUAMI within the AMF set, it may also
invoke this procedure to update the Notification URI and the GUAMI.
NOTE 3: Either the old or the new AMF can invoke this procedure.
During the AMF relocation, if the new AMF received the resource URI of the
individual AM Policy from the old AMF and selects the old PCF, the new AMF
shall also invoke this procedure to update the Notification URI and the GUAMI.
The new AMF may also update the alternate or backup IP addresses.
The V-PCF as NF service consumer invokes this procedure when a policy control
request trigger (see subclause 4.2.3.2) occurs. When the \"UE_POLICY\",
trigger occurs, the V-PCF shall always invoke the procedure. When the location
change trigger or the change of UE presence in PRA trigger occurs, the V-PCF
shall only invoke the procedure if the H‑PCF has subscribed to that event
trigger.
To request policies from the PCF or to update the Notification URI, or to
update the trace control configuration, or to request the termination of
trace, the NF Service Consumer shall request the update of an AM Policy
Association by providing relevant parameters about the UE context by sending
an HTTP POST request with \"{apiRoot}/npcf-ue-policy-
control/v1/policies/{polAssoId}/update\" as Resource URI and the
PolicyAssociationUpdateRequest data structure as request body that shall
include:
\- at least one of the following:
1\. a new Notification URI encoded in the \"notificationUri\" attribute;
and/or
2\. observed Policy Control Request Trigger(s) (see subclause 4.2.3.2) encoded
as \"triggers\" attribute;
3\. if a UE location change occurred, the UE location encoded as \"userLoc\"
attribute;
4\. if a \"MANAGE UE POLICY COMPLETE\" message or a \"MANAGE UE POLICY COMMAND
REJECT\" message of the UE policy delivery protocol defined in Annex D of 3GPP
TS 24.501 [15] has been received by the V-PCF as NF service consumer, and at
least parts of the contents relate to UPSIs of the HPLMN, the parts of that
message that relate to UPSIs of the HPLMN encoded as \"uePolDelResult\"
attribute;
5\. if the Policy Control Request Trigger \"Change of UE presence in PRA\" is
provided, the current presence status of the UE for the presence reporting
areas for which reporting was requested, if not previously provided, or the
presence reporting areas for which reporting was requested and the status has
changed encoded as \"praStatuses\" attribute;
6\. if the NF service consumer is an AMF, for AMF relocation scenarios, if
available, alternate or backup IPv4 Address(es) where to send Notifications
encoded as \"altNotifIpv4Addrs\" attribute;
7\. if the NF service consumer is an AMF, for AMF relocation scenarios, if
available, alternate or backup IPv6 Address(es) where to send Notifications
encoded as \"altNotifIpv6Addrs\" attribute;
8\. for the AMF relocation scenarios, if available, the new GUAMI encoded as
\"guami\" attribute; and/or
NOTE 4: An alternate NF service consumer than the one that requested the
generation of the subscription resource can send the request. For instance, an
AMF as service consumer can change.
9\. if the NF service consumer is an AMF, for AMF relocation scenarios, the
new serving AMF Id encoded in the \"servingNfId\" attribute.
Upon the reception of the HTTP POST request,
\- if the PCF is a V-PCF and the V-PCF has an established policy association,
the V-PCF shall determine based on the contents of a potentially received
\"uePolDelResult\" attribute (see above) and requested event triggers of the
H-PCF whether to send as the NF service consumer towards the H-PCF a request
for the update of the policy association as described in the present clause;
\- the (V-)(H-)PCF shall determine the applicable policy based on local policy
and for the V-PCF any policy received from the H-PCF in the reply to the
possible request for the update of a policy association;
\- the (V-)(H-)PCF for the succesfull case shall send a HTTP \"200 OK\"
response with the PolicyUpdate data type as body with possible updates for
that applicable UE policy (for the H-PCF) and Policy Control Request
Trigger(s) encoded as described in subclause 4.2.3.3;
\- if the (V-)PCF determines that UE policy needs to be updated, it shall use
the Namf_Communication service specified in 3GPP TS 29.518 [14] to provision
the UE policy according to subclause 4.2.2.2 and as follows:
(i) the (V-)PCF shall send the determined UE policy using
Namf_Communication_N1N2MessageTransfer service operation(s); and
(ii) the (V-)PCF shall be prepared to receive UE Policy Delivery Results from
the AMF within the Namf_Communication_N1MessageNotify service operation and
for the V-PCF if the received UE Policy Delivery results relate to UE policy
sections provided by the H-PCF shall use the Npcf_UEPolicyControl_Update
Service Operation to send those UE Policy Delivery results to the H-PCF; and
\- if errors occur when processing the HTTP POST request, shall apply error
handling procedures as specified in subclause 5.7 and according to the
following provisions:
\- if the (V-)(H-)PCF is, due to incomplete, erroneous or missing information
in the request not able to provision a UE policy decision, the PCF may reject
the request and include in an HTTP \"400 Bad Request\" response message the
\"cause\" attribute of the ProblemDetails data structure set to
\"ERROR_REQUEST_PARAMETERS\".
If the PCF received a new GUAMI, the PCF may subscribe to GUAMI changes using
the AMFStatusChange service operation of the Namf_Communication service
specified in 3GPP TS 29.518 [14], and it may use the Nnrf_NFDiscovery Service
specified in 3GPP TS 29.510 [13] (using the obtained GUAMI and possibly
service name) to query the other AMFs within the AMF set.
#### 4.2.3.2 Policy Control Request Triggers
The following Policy Control Request Triggers are defined (see subclause
6.1.2.5 of 3GPP TS 23.503 [4]):
\- \"LOC_CH\", i.e. location change (tracking area): the tracking area of the
UE has changed;
\- \"PRA_CH\", i.e. change of UE presence in PRA: the UE is entering/leaving a
Presence Reporting Area, this includes reporting the initial status at the
time the request for reports is initiated; and
\- \"UE_POLICY\", i.e. a \"MANAGE UE POLICY COMPLETE\" message or a \"MANAGE
UE POLICY COMMAND REJECT\" message, as defined in Annex D.5 of 3GPP TS 24.501
[15], has been received by the V-PCF and is being forwarded to the H-PCF.
#### 4.2.3.3 Encoding of updated policy
Updated policies shall be encoded within the PolicyUpdate data type that may
include:
\- only when the updated policy is supplied by the H-PCF in the roaming
scenario, UE policy (see subclause 4.2.2.2) encoded as \"uePolicy\" attribute;
\- updated Policy Control Request Trigger(s) (see subclause 4.2.3.2) encoded
as \"triggers\" attribute i.e.:
1) either a new complete list of applicable Policy Control Request Trigger(s)
including one or several of the following:
a) Location change (tracking area); or
b) Change of UE presence in PRA; or
2) a \"NULL\" value to request the removal of all previously installed Policy
Control Request Trigger(s); and
\- if the Policy Control Request Trigger \"Change of UE presence in PRA\" is
provided or if that trigger was already set but the requested presence
reporting areas need to be changed, the presence reporting areas for which
reporting is required encoded as \"pras\" attribute encoded as follows:
a) A new entry shall be added by supplying a new identifier as key and the
corresponding PresenceInfo data type instance with complete contents as value
as an entry within the map.
b) An existing entry shall be modified by supplying the existing identifier as
key and the PresenceInfo data type instance with complete contents as value as
an entry within the map.
c) An existing entry shall be deleted by supplying the existing identifier as
key and \"NULL\" as value as an entry within the map.
d) For an unmodified entry, no entry needs to be provided within the map.
### 4.2.4 Npcf_UEPolicyControl_UpdateNotify Service Operation
#### 4.2.4.1 General
The (V-)(H)-PCF may decide to update policy control request trigger, and in
the roaming case the H-PCF may decide to update the UE Policy, and the PCF
(H-PCF in the roaming case) may decide to request the termination of the
policy association and the (V-)(H-)PCF shall then use an
Npcf_UEPolicyControl_UpdateNotify service operation.
The following procedures using the Npcf_UEPolicyControl_UpdateNotify service
operation are supported:
\- policy update notification; and
\- request for termination of the UE policy association.
#### 4.2.4.2 Policy update notification
Figure 4.2.4.2-1 illustrates the policy update notification.
Figure 4.2.4.2-1: policy update notification
NOTE: For the roaming case, the PCF represents the V-PCF if the NF service
consumer is an AMF and the PCF represents the H-PCF if the NF service consumer
is a V-PCF.
The (V-)(H)-PCF may decide to update policy control request trigger(s) and in
the roaming case, the H-PCF may also decide to update the UE Policy and the
(V-)(H-)PCF shall then send an HTTP POST request with
\"{notificationUri}/update\" as URI (where the Notification URI was previously
supplied by the NF service consumer) to the NF service consumer and the
PolicyUpdate data structure as request body encoded as described in subclause
4.2.3.3.
Upon the reception of the HTTP POST request, the NF service consumer:
\- if the V-PCF is the NF service consumer, shall use the Namf_Communication
Service defined in 3GPP TS 29.518 [14] to send \"MANAGE UE POLICY COMMAND\"
message(s) with the received policy to the UE via the AMF;
\- if the V-PCF is the NF service consumer, shall provision the received
policy control requested trigger(s) to the AMF using the
Npcf_UEPolicyControl_UpdateNotify service operation according to the present
clause;
\- if the AMF is the NF service consumer, shall enforce the received policy
control request trigger(s);
\- shall either send a HTTP \"204 No Content\" response indicating the success
of the enforcement or an appropriate failure response, for the V-PCF as the NF
service consumer taking into consideration a reply received from the possible
Namf_Communication Service service operation and from the possible
Npcf_UEPolicyControl_UpdateNotify service operation according to the previous
bullets; and
\- if errors occur when processing the HTTP POST request, shall apply error
handling procedures as specified in subclause 5.7.
#### 4.2.4.3 Request for termination of the policy association
Figure 4.2.4.3-1 illustrates the request for a termination of the policy
association.
Figure 4.2.4.3-1: request for a termination of theUE policy association
NOTE: For the roaming case, the PCF represents the V-PCF if the NF service
consumer is an AMF and the PCF represents the H-PCF if the NF service consumer
is a V-PCF.
The (V-)(H-)PCF may to request the termination of the UE policy association
and shall then send an HTTP POST request with \"{notificationUri}/terminate\"
as URI (where the Notification URI was previously supplied by the NF service
consumer) and the TerminationNotification data structure as request body that
shall include:
\- the resource URI of the concerned individual UE policy association
(including the policy association ID) encoded as \"resourceUri\" attribute;
and
\- the cause why the (V-)(H-)PCF requests the termination of the policy
association encoded as \"cause\" attribute.
Upon the reception of the HTTP POST request, the NF service consumer:
\- if the V-PCF is the NF service consumer, shall send as NF service producer
for the corresponding policy association (towards the AMF) a request for a
termination of the policy association according to the present clause;
\- shall either send a HTTP \"204 No Content\" response for the succesfull
processing of the HTTP POST request or an appropriate failure response, for
the V-PCF as the NF service consumer taking into consideration a reply
received for the possible corresponding policy association termination request
according to the previous bullet; and
\- if errors occur when processing the HTTP POST request, shall apply error
handling procedures as specified in subclause 5.7.
After the succesfull processing of the HTTP POST request, any NF service
consumer except for the V-PCF shall invoke the Npcf_UEPolicyControl_Delete
Service Operation defined in subclause 4.2.5 to terminate the policy
association.
If the AMF as NF service consumer is not able to handle the notification but
knows by implementation specific means that another AMF is able to handle the
notification, it shall reply with an HTTP \"307 temporary redirect\" error
response pointing to the URI of the new AMF. If the AMF is not able to handle
the notification but another unknown AMF could possibly handle the
notification, it shall reply with an HTTP \"404 Not found\" error response.
If the (V-)PCF receives a \"307 temporary redirect\" response, the PCF shall
resend the failed request for termination of the policy association using the
received URI in the Location header field as Notification URI.
If the (V-)PCF becomes aware that a new AMF is requiring notifications (e.g.
via the \"404 Not found\" response or via Namf_Communication service
AMFStatusChange Notifications, see 3GPP TS TS 29.518 [14], or via link level
failures), and the (V-)PCF knows alternate or backup IPv4 or IPv6 Addess(es)
where to send Notifications (e.g. via \"altNotifIpv4Addrs\" or
\"altNotifIpv6Addrs\" attributes received when the policy association was
created or via AMFStatusChange Notifications, or via the Nnrf_NFDiscovery
Service specified in 3GPP TS 29.510 [13] (using the service name and GUAMI
obtained during the creation of the subscription) to query the other AMFs
within the AMF set), the (V-)PCF shall exchange the authority part of the
corresponding Notification URI with one of those addresses and shall resend
the failed request for termination of the policy association to that URI.
If the (V-)PCF received a \"404 Not found\" response, the (V-)PCF should
resend the failed request for termination of the policy association to that
URL.
### 4.2.5 Npcf_UEPolicyControl_Delete Service Operation
Figure 4.2.5-1 illustrates the deletion of a policy association.
Figure 4.2.5-1: Deletion of a policy association
NOTE: For the roaming case, the PCF represents the V-PCF if the NF service
consumer is an AMF and the PCF represents the H-PCF if the NF service consumer
is a V-PCF.
The AMF as NF service consumer requests that the policy association is deleted
when the corresponding UE context is terminated, e.g. during UE de-
registration from the network.
During the AMF relocation, the old AMF shall invoke this procedure when:
\- the resource URI of the individual UE Policy Association resource is not
transferred to the new AMF; or
\- the new AMF informs the old AMF that the individual UE Policy Association
resource is not being reused.
To request that the UE policy association is deleted, the NF service consumer
(e.g. AMF) shall send an HTTP DELETE request with \"{apiRoot}/npcf-ue-policy-
control/v1/policies/{polAssoId}\" as Resource URI.
Upon the reception of the HTTP DELETE request,
\- the (V-)(H-)PCF shall delete the policy association;
\- if the PCF is a V-PCF and has an established corresponding policy
association towards the H-PCF, the V-PCF shall send as the NF service consumer
towards the H-PCF a request for the deletion of that policy association as
described in the present clause;
\- the (V-)(H-)PCF shall send either an HTTP \"204 No Content\" response
indicating the success of the deletion or an appropriate failure response, for
the V-PCF as PCF taking into consideration a reply received for the possible
policy association deletion request according to the previous bullet; and
\- the (V-)(H-)PCF shall if errors occur when processing the HTTP DELETE
request, apply error handling procedures as specified in subclause 5.7.
# 5 Npcf_UEPolicyControl API
## 5.1 Introduction
The Access and Mobility Policy Control Service shall use the
Npcf_UEPolicyControl API.
The request URI used in HTTP request from the NF service consumer towards the
PCF shall have the structure defined in subclause 4.4.1 of 3GPP TS 29.501 [6],
i.e.:
**{apiRoot}/{apiName}/{apiVersion}/{apiSpecificResourceUriPart}**
with the following components:
\- The {apiRoot} shall be set as described in 3GPP TS 29.501 [6].
\- The {apiName} shall be \"npcf-ue-policy-control\".
\- The {apiVersion} shall be \"v1\".
\- The {apiSpecificResourceUriPart} shall be set as described in subclause
5.3.
## 5.2 Usage of HTTP
### 5.2.1 General
HTTP/2, IETF RFC 7540 [8], shall be used as specified in clause 5 of 3GPP TS
29.500 [5].
HTTP/2 shall be transported as specified in subclause 5.3 of 3GPP TS 29.500
[5].
The OpenAPI [10] specification of HTTP messages and content bodies for the
Npcf_UEPolicyControl is contained in Annex A.
### 5.2.2 HTTP standard headers
#### 5.2.2.1 General
See subclause 5.2.2 of 3GPP TS 29.500 [5] for the usage of HTTP standard
headers.
#### 5.2.2.2 Content type
JSON, IETF RFC 8259 [9], shall be used as content type of the HTTP bodies
specified in the present specification as specified in subclause 5.4 of 3GPP
TS 29.500 [5]. The use of the JSON format shall be signalled by the content
type \"application/json\".
\"Problem Details\" JSON object shall be used to indicate additional details
of the error in a HTTP response body and shall be signalled by the content
type \"application/problem+json\", as defined in IETF RFC 7807 [21].
### 5.2.3 HTTP custom headers
The mandatory HTTP custom header fields specified in subclause 5.2.3.2 of 3GPP
TS 29.500 [5] shall be applicable
## 5.3 Resources
### 5.3.1 Resource Structure
x
Figure 5.3.1-1: Resource URI structure of the Npcf_UEPolicyControl API
Table 5.3.1-1 provides an overview of the resources and applicable HTTP
methods.
Table 5.3.1-1: Resources and methods overview
* * *
Resource name Resource URI HTTP method or custom operation Description
UE Policy Associations {apiRoot}/\ POST Create a new Individual UE policy
association resource. npcf-ue-policy-control/\  
v1/policies/
Individual UE Policy Association {apiRoot}\ GET Read the Individual UE Policy
Association resource. /npcf-ue-policy-control/\  
v1/policies/\  
{polAssoId}
                                                                 DELETE                            Delete the Individual UE Policy Association resource.
                                     {apiRoot}\                  update (POST)                     Report observed event trigger and obtain updated UE policies.
                                     /npcf-ue-policy-control/\                                     
                                     v1/policies/\                                                 
                                     {polAssoId}/update
* * *
### 5.3.2 Resource:UE Policy Associations
#### 5.3.2.1 Description
This resource represents a collection of UE policy associations.
#### 5.3.2.2 Resource definition
Resource URI: **{apiRoot}/npcf-ue-policy-control/v1/policies/**
This resource shall support the resource URI variables defined in table
5.3.2.2-1.
Table 5.3.2.2-1: Resource URI variables for this resource
* * *
Name Definition apiRoot See subclause 5.1
* * *
#### 5.3.2.3 Resource Standard Methods
##### 5.3.2.3.1 POST
This method shall support the URI query parameters specified in table
5.3.2.3.1-1.
Table 5.3.2.3.1-1: URI query parameters supported by the POST method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.3.2.3.1-2 and the response data structures and response codes specified in
table 5.3.2.3.1-3.
Table 5.3.2.3.1-2: Data structures supported by the POST Request Body on this
resource
* * *
Data type P Cardinality Description PolicyAssociationRequest M 1 Input
parameters for the creation of a policy association.
* * *
Table 5.3.2.3.1-3: Data structures supported by the POST Response Body on this
resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | Poli | M | 1 | 201 Created | Policy | | cyAssociation | | | | association | | | | | | was created | | | | | | and policies | | | | | | are being | | | | | | provided. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 400 Bad | (NOTE 2) | | roblemDetails | | | Request | | +---------------+---+-------------+---------------+---------------+ | NOTE 1: The | | | | | | mandatory | | | | | | HTTP error | | | | | | status codes | | | | | | for the POST | | | | | | method listed | | | | | | in Table | | | | | | 5.2.7.1-1 of | | | | | | 3GPP TS | | | | | | 29.500 [5] | | | | | | also apply. | | | | | | | | | | | | NOTE 2: | | | | | | Failure cases | | | | | | are described | | | | | | in | | | | | | s | | | | | | ubclause 5.7. | | | | | +---------------+---+-------------+---------------+---------------+
### 5.3.3 Resource: Individual UE Policy Association
#### 5.3.3.1 Description
This resource represents an individual UE policy association.
#### 5.3.3.2 Resource definition
Resource URI: **{apiRoot}/npcf-ue-policy-control/v1/policies/{polAssoId}**
This resource shall support the resource URI variables defined in table
5.3.2.2-1.
Table 5.3.2.2-1: Resource URI variables for this resource
* * *
Name Definition apiRoot See subclause 5.1. polAssoId Identifier of a policy
association.
* * *
#### 5.3.3.3 Resource Standard Methods
##### 5.3.3.3.1 GET
This method shall support the URI query parameters specified in table
5.3.2.3.1-1.
Table 5.3.3.3.1-1: URI query parameters supported by the GET method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.3.2.3.1-2 and the response data structures and response codes specified in
table 5.3.2.3.1-3.
Table 5.3.3.3.1-2: Data structures supported by the GET Request Body on this
resource
* * *
Data type P Cardinality Description n/a
* * *
Table 5.3.3.3.1-3: Data structures supported by the GET Response Body on this
resource
* * *
Data type P Cardinality Response codes Description PolicyAssociation M 1 200
OK  
NOTE: The mandatory HTTP error status codes for the GET method listed in Table
5.2.7.1-1 of 3GPP TS 29.500 [5] also apply.
* * *
##### 5.3.3.3.2 DELETE
This method shall support the URI query parameters specified in table
5.3.3.3.2-1.
Table 5.3.3.3.2-1: URI query parameters supported by the DELETE method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.3.3.3.2-2 and the response data structures and response codes specified in
table 5.3.3.3.2-3.
Table 5.3.3.3.2-2: Data structures supported by the DELETE Request Body on
this resource
* * *
Data type P Cardinality Description n/a
* * *
Table 5.3.3.3.2-3: Data structures supported by the DELETE Response Body on
this resource
* * *
Data type P Cardinality Response codes Description n/a 204 No Content The
policy association was successfully deleted. NOTE: The mandatory HTTP error
status codes for the DELETE method listed in Table 5.2.7.1-1 of 3GPP TS 29.500
[5] also apply.
* * *
#### 5.3.3.4 Resource Custom Operations
##### 5.3.3.4.1 Overview
Table 5.3.3.4.1-1: Custom operations
* * *
Custom operation URI Mapped HTTP method Description
{apiRoot}\ POST Report observed event trigger and obtain updated policies.
/npcf-ue-policy-control/v1/\  
policies/\  
{polAssoId}/update
* * *
##### 5.3.3.4.2 Operation: Update
###### 5.3.3.4.2.1 Description
The update custom operation allows an NF service consumer to report the
occurrence on a police request trigger and to obtain related updated policies.
###### 5.3.3.4.2.2 Operation Definition
This operation shall support the request data structures specified in table
5.3.3.4.2.2-1 and the response data structure and response codes specified in
table 5.3.3.4.2.2-2.
Table 5.3.3.4.2.2-1: Data structures supported by the POST Request Body on
this resource
* * *
Data type P Cardinality Description PolicyAssociationUpdateRequest M 1
Describes the observed event trigger(s).
* * *
Table 5.3.3.4.2.2-2: Data structures supported by the POST Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | PolicyUpdate | M | 1 | 200 OK | Describes | | | | | | updated | | | | | | policies. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 400 Bad | (NOTE 2) | | roblemDetails | | | Request | | +---------------+---+-------------+---------------+---------------+ | NOTE 1: The | | | | | | mandatory | | | | | | HTTP error | | | | | | status codes | | | | | | for the POST | | | | | | method listed | | | | | | in Table | | | | | | 5.2.7.1-1 of | | | | | | 3GPP TS | | | | | | 29.500 [5] | | | | | | also apply. | | | | | | | | | | | | NOTE 2: | | | | | | Failure cases | | | | | | are described | | | | | | in | | | | | | s | | | | | | ubclause 5.7. | | | | | +---------------+---+-------------+---------------+---------------+
## 5.4 Custom Operations without associated resources
None.
## 5.5 Notifications
### 5.5.1 General
Table 5.5.1-1: Notifications
* * *
Custom operation URI Mapped HTTP method Description {notificationUri}/update
POST Policy Update Notification. {notificationUri}/terminate POST Request for
termination of the policy association.
* * *
### 5.5.2 Policy Update Notification
#### 5.5.2.1 Description
This notification is used by the H-PCF to provide updates of UE policies to
the V-PCF as NF service consumer, and used by the V-PCF to provide updates of
policy control request triggers to the AMF as NF service consumer.
#### 5.5.2.2 Operation Definition
This operation shall support the request data structures specified in table
5.5.2.2-1 and the response data structure and response codes specified in
table 5.5.2.2-2.
Table 5.5.2.2-1: Data structures supported by the POST Request Body on this
resource
* * *
Data type P Cardinality Description PolicyUpdate M 1 Updated policies.
* * *
Table 5.5.2.2-2: Data structures supported by the POST Response Body on this
resource
* * *
Data type P Cardinality Response codes Description n/a 204 No Content The
policies were successfully updated. NOTE: The mandatory HTTP error status
codes for the POST method listed in Table 5.2.7.1-1 of 3GPP TS 29.500 [5] also
apply.
* * *
### 5.5.3 Request for termination of the UE policy association
#### 5.5.3.1 Description
This notification is used by the PCF to request the termination of a UE policy
association.
#### 5.5.3.2 Operation Definition
This operation shall support the request data structures specified in table
5.5.3.2-1 and the response data structure and response codes specified in
table 5.5.3.2-2.
Table 5.5.3.2-1: Data structures supported by the POST Request Body on this
resource
* * *
Data type P Cardinality Description TerminationNotification M 1 Request to
terminate the policy association.
* * *
Table 5.5.3.2-2: Data structures supported by the POST Response Body on this
resource
* * *
Data type P Cardinality Response codes Description n/a 204 No Content The
request for policy association termination was received. n/a 307 temporary
redirect The NF service consumer shall generate a Location header field
containing a different URI pointing to another NF service consumer to which
the notification should be send. ProblemDetails M 1 404 Not Found The NF
service consumer can use this response when the notification can be sent to
another unknown host. NOTE: The mandatory HTTP error status codes for the POST
method listed in Table 5.2.7.1-1 of 3GPP TS 29.500 [5] also apply.
* * *
## 5.6 Data Model
### 5.6.1 General
This subclause specifies the application data model supported by the API.
Table 5.6.1-1 specifies the data types defined for the Npcf_UEPolicyControl
service based interface protocol.
Table 5.6.1-1: Npcf_UEPolicyControl specific Data Types
* * *
Data type Section defined Description Applicability PolicyAssociation 5.6.2.2
Description of a policy association that is returned by the PCF when a policy
Association is created, updated, or read.  
PolicyAssociationReleaseCause 5.6.3.4 The cause why the PCF requests the
termination of the policy association.  
PolicyAssociationRequest 5.6.2.3 Information that NF service consumer provides
when requesting the creation of a policy association.  
PolicyAssociationUpdateRequest 5.6.2.4 Information that NF service consumer
provides when requesting the update of a policy association.  
PolicyUpdate 5.6.2.5 Updated policies that the PCF provides in a notification
or in the reply to an Update Request.  
RequestTrigger 5.6.3.3 Enumeration of possible Request Triggers.  
TerminationNotification 5.6.2.6 Request to terminate a policy Association that
the PCF provides in a notification.  
UePolicy 5.6.3.2 UE Policies  
UePolicyDeliveryResult 5.6.3.2 UE Policy delivery Result  
UePolicyRequest 5.6.3.2 Request for UE Policies  
UePolicyTransferFailureNotification 5.6.2.7 Information that the UE policy is
failure to be transferred to the UE because the UE is not reachable.
* * *
Table 5.6.1-2 specifies data types re-used by the Npcf_UEPolicyControl service
based interface protocol from other specifications, including a reference to
their respective specifications and when needed, a short description of their
use within the Npcf_UEPolicyControl service based interface.
Table 5.6.1-2: Npcf_UEPolicyControl re-used Data Types
* * *
Data type Reference Comments Applicability AccessType 3GPP TS 29.571 [11]  
Gpsi 3GPP TS 29.571 [11] Generic Public Subscription Identifier  
GroupId 3GPP TS 29.571 [11]  
Guami 3GPP TS 29.571 [11] Globally Unique AMF Identifier  
Ipv4Addr 3GPP TS 29.571 [11]  
Ipv6Addr 3GPP TS 29.571 [11]  
N1N2MessageTransferCause 3GPP TS 29.518 [14]  
NetworkId 3GPP TS 29.571 [11]  
NfInstanceId 3GPP TS 29.571 [11]  
Pei 3GPP TS 29.571 [11] Permanent Equipment Identifier  
PresenceInfo 3GPP TS 29.571 [11] Presence reporting area information  
ProblemDetails 3GPP TS 29.571 [11]  
Uri 3GPP TS 29.571 [11]  
UserLocation 3GPP TS 29.571 [11]  
RatType 3GPP TS 29.571 [11]  
Supi 3GPP TS 29.571 [11] Subscription Permanent Identifier  
SupportedFeatures 3GPP TS 29.571 [11] Used to negotiate the applicability of
the optional features defined in table 5.8-1.  
TimeZone 3GPP TS 29.571 [11]  
Uinteger 3GPP TS 29.571 [11]
* * *
### 5.6.2 Structured data types
#### 5.6.2.1 Introduction
This subclause defines the structures to be used in resource representations.
#### 5.6.2.2 Type PolicyAssociation
Table 5.6.2.2-1: Definition of type PolicyAssociation
* * *
Attribute name Data type P Cardinality Description Applicability request
PolicyAssociationRequest O 0..1 The information provided by the NF service
consumer when requesting the creation of a policy association  
uePolicy UePolicy O 0..1 The UE policy as determined by the PCF.  
triggers array(RequestTrigger) O 1..N Request Triggers that the PCF
subscribes. Only values \"LOC_CH\" and \"PRA_CH\" are permitted.  
pras map(PresenceInfo) C 1..N If the Trigger \"PRA_CH\" is provided, the
presence reporting area(s) for which reporting is requested shall be provided.
The \"praId\" attribute within the PresenceInfo data type shall also be the
key of the map. The \"presenceState\" attribute within the PresenceInfo data
type shall not be supplied.  
suppFeat SupportedFeatures M 1 Indicates the negotiated supported features.
* * *
#### 5.6.2.3 Type PolicyAssociationRequest
Table 5.6.2.3-1: Definition of type PolicyAssociationRequest
* * *
Attribute name Data type P Cardinality Description Applicability
notificationUri Uri M 1 Identifies the recipient of Notifications sent by the
PCF.  
altNotifIpv4Addrs array(Ipv4Addr) O 1..N Alternate or backup IPv4 Addess(es)
where to send Notifications.  
altNotifIpv6Addrs array(Ipv6Addr) O 1..N Alternate or backup IPv6 Addess(es)
where to send Notifications.  
supi Supi M 1 Subscription Permanent Identifier.  
gpsi Gpsi C 0..1 Generic Public Subscription Identifier. Shall be provided
when available.  
accessType AccessType C 0..1 The Access Type where the served UE is camping.
Shall be provided when available.  
pei Pei C 0..1 The Permanent Equipment Identifier of the served UE. Shall be
provided when available.  
userLoc UserLocation C 0..1 The location of the served UE. Shall be provided
when available.  
timeZone TimeZone C 0..1 The time zone where the served UE is camping. Shall
be provided when available.  
servingPlmn NetworkId C 0..1 The serving PLMN where the served UE is camping.
Shall be provided when available.  
ratType RatType C 0..1 The RAT Type where the served UE is camping. Shall be
provided when available.  
groupIds array(GroupId) C 1..N Internal Group Identifier(s) of the served UE.
Shall be provided when available.  
hPcfId string C 0..1 H-PCF Identifier. Shall be provided when available.  
uePolReq UePolicyRequest C 0..1 A request for UE Policies. Shall be provided
when the AMF receives an \"UE STATE INDICATION\" message, as defined in Annex
D.5.4 of 3GPP TS 24.501 [15] .  
guami Guami C 0..1 The Globally Unique AMF Identifier (GUAMI) shall be
provided by an AMF as service consumer.  
serviceName string O 0..1 If the NF service consumer is an AMF, it should
provide the name of a service produced by the AMF that makes use of
information received within the Npcf_UEPolicyControl_UpdateNotify service
operation.  
servingNfId NfInstanceId C 0..1 If the NF service consumer is an AMF, it shall
contain the identifier of the serving AMF.  
suppFeat SupportedFeatures M 1 Indicates the features supported by the service
consumer.
* * *
#### 5.6.2.4 Type PolicyAssociationUpdateRequest
Table 5.6.2.4-1: Definition of type PolicyAssociationUpdateRequest
* * *
Attribute name Data type P Cardinality Description Applicability
notificationUri Uri O 0..1 Identifies the recipient of Notifications sent by
the PCF.  
altNotifIpv4Addrs array(Ipv4Addr) O 1..N Alternate or backup IPv4 Address(es)
where to send Notifications.  
altNotifIpv6Addrs array(Ipv6Addr) O 1..N Alternate or backup IPv6 Address(es)
where to send Notifications.  
triggers array(RequestTrigger) C 1..N Request Triggers that the NF service
consumer observes.  
praStatuses map(PresenceInfo) C 1..N If the Trigger \"PRA_CH\" is reported,
the UE presence status for tracking area for which changes of the UE presence
occurred shall be provided. The \"praId\" attribute within the PresenceInfo
data type shall also be the key of the map. The \"presenceState\" attribute
within the PresenceInfo data type shall be supplied.  
userLoc UserLocation C 0..1 The location of the served UE shall be provided
for trigger \"LOC_CH\".  
uePolDelResult UePolicyDeliveryResult C 0..1 UE Policy Delivery Result. Shall
be provided together with trigger \"UE_POLICY\" when a \"MANAGE UE POLICY
COMPLETE\" message or a \"MANAGE UE POLICY COMMAND REJECT\" message, as
defined in Annex D.5 of 3GPP TS 24.501 [15], has been received by the V-PCF
and is being forwarded to the H-PCF.  
uePolTransFailNotif UePolicyTransferFailureNotification C 0..1 The UE policy
transfer failure notification. Shall be the provided together with trigger
\"UE_POLICY\" when a response with HTTP status code 4xx or 5xx as defined in
subclause 5.2.2.3.1.2 of 3GPP TS 29.518 [14] or a N1N2 Transfer Failure
Notification as defined in subclause 5.2.2.3.2 of 3GPP TS 29.518 [14] is
received after the V-PCF provisioned the UE policy by invoking the
Namf_Communication_N1N2MessageTransfer service operation to the AMF and is
notifying the H-PCF.  
guami Guami O 0..1 The Globally Unique AMF Identifier (GUAMI) shall be
provided by an AMF as service consumer.  
servingNfId NfInstanceId C 0..1 It shall contain the identifier of the new AMF
during the AMF relocation.
* * *
#### 5.6.2.5 Type PolicyUpdate
Table 5.6.2.5-1: Definition of type PolicyUpdate
* * *
Attribute name Data type P Cardinality Description Applicability resourceUri
Uri M 1 The resource URI of the individual UE policy association related to
the notification.  
uePolicy UePolicy O 0..1 The UE policy as determined by the PCF.  
triggers array(RequestTrigger) O 1..N Request Triggers that the PCF
subscribes. Only values \"LOC_CH\" and \"PRA_CH\" are permitted.  
pras map(PresenceInfo) C 1..N If the Trigger \"PRA_CH\" is provided or if that
trigger was already set but the requested presence reporting areas need to be
changed, the presence reporting area(s) for which reporting is requested shall
be provided. The \"praId\" attribute within the PresenceInfo data type shall
also be the key of the map. The \"presenceState\" attribute within the
PresenceInfo data type shall not be supplied.
* * *
#### 5.6.2.6 Type TerminationNotification
Table 5.6.2.6-1: Definition of type TerminationNotification
* * *
Attribute name Data type P Cardinality Description Applicability resourceUri
Uri M 1 The resource URI of the individual UE policy association related to
the notification.  
cause PolicyAssociationReleaseCause M 1 The cause why the PCF requests the
termination of the policy association.
* * *
#### 5.6.2.7 Type UePolicyTransferFailureNotification
Table 5.6.2.7-1: UEPolicyTransferFailureNotification
* * *
Attribute name Data type P Cardinality Description Applicability cause
N1N2MessageTransferCause M 1 Indicates the reason why the UE policy could not
be transferred by the AMF.  
ptis array(Uinteger) M 1..N Contains a list of PTI assigned by the H-PCF
corresponding to the UE policy(s) which could not be transferred by the AMF.
* * *
### 5.6.3 Simple data types and enumerations
#### 5.6.3.1 Introduction
This subclause defines simple data types and enumerations that can be
referenced from data structures defined in the previous subclauses.
#### 5.6.3.2 Simple data types
The simple data types defined in table 5.6.3.2-1 shall be supported.
Table 5.6.3.2-1: Simple data types
* * *
Type Name Type Definition Description Applicability UePolicy Bytes \"MANAGE UE
POLICY COMMAND\" message content, as defined in Table D.5.1.1.1 of 3GPP TS
24.501 [15]  
UePolicyDeliveryResult Bytes \"MANAGE UE POLICY COMPLETE\" message content, as
defined in Table D.5.2.1.1 of 3GPP TS 24.501 [15], or \"MANAGE UE POLICY
COMMAND REJECT\" message content, as defined in Table D.5.3.1.1 of 3GPP TS
24.501 [15]  
UePolicyRequest Bytes \"UE STATE INDICATION\" message content, as defined in
Table D.5.4.1.1 of 3GPP TS 24.501 [15]
* * *
#### 5.6.3.3 Enumeration: RequestTrigger
The enumeration RequestTrigger represents the possible Policy Control Request
Triggers.. It shall comply with the provisions defined in table 5.6.3.3-1.
Table 5.6.3.3-1: Enumeration RequestTrigger
* * *
Enumeration value Description Applicability LOC_CH Location change (tracking
area): the tracking area of the UE has changed.  
PRA_CH Change of UE presence in PRA: the AMF reports the current presence
status of the UE in a Presence Reporting Area, and notifies that the UE
enters/leaves the Presence Reporting Area.  
UE_POLICY A \"MANAGE UE POLICY COMPLETE\" message or a \"MANAGE UE POLICY
COMMAND REJECT\" message, as defined in Annex D.5 of 3GPP TS 24.501 [15], has
been received by the V-PCF and is being forwarded to the H-PCF. A
Namf_Communication_N1N2MessageTransfer failure response as defined in
subclause 5.2.2.3.1.2 of 3GPP TS 29.518 [14], or an N1N2 Transfer Failure
Notification as defined in subclause 5.2.2.3.2 of 3GPP TS 29.518 [14], a UE
Policy transfer failure is being notifying to the H-PCF. This event does not
require a subscription and is only applicable for the V‑PCF as NF service
consumer and the H‑PCF as NF service producer.
* * *
#### 5.6.3.4 Enumeration: PolicyAssociationReleaseCause
The enumeration PolicyAssociationReleaseCause represents the cause why the PCF
requests the termination of the policy association. It shall comply with the
provisions defined in table 5.6.3.4-1.
Table 5.6.3.4-1: Enumeration PolicyAssociationReleaseCause
* * *
Enumeration value Description Applicability UNSPECIFIED This value is used for
unspecified reasons.  
UE_SUBSCRIPTION This value is used to indicate that the policy association
needs to be terminated because the subscription of UE has changed (e.g. was
removed).  
INSUFFICIENT_RES This value is used to indicate that the server is overloaded
and needs to abort the policy association.
* * *
## 5.7 Error handling
### 5.7.1 General
For the Npcf_UEPolicyControl API, HTTP error responses shall be supported as
specified in subclause 4.8 of 3GPP TS 29.501 [6]. Protocol errors and
application errors specified in table 5.2.7.2-1 of 3GPP TS 29.500 [5] shall be
supported for an HTTP method if the corresponding HTTP status codes are
specified as mandatory for that HTTP method in table 5.2.7.1-1 of 3GPP TS
29.500 [5].
In addition, the requirements in the following subclauses are applicable for
the Npcf_UEPolicyControl API.
### 5.7.2 Protocol Errors
No specific protocol errorsfor the Npcf_UEPolicyControl API are specified.
### 5.7.3 Application Errors
The application errors defined for the Npcf_UEPolicyControl service are listed
in Table 5.7.3-1. The PCF may include in the HTTP status code a
\"ProblemDetails\" data structure with the \"cause\" attribute indicating the
application error as listed in table 5.7.3-1.
Table 5.7.3-1: Application errors
* * *
Application Error HTTP status code Description USER_UNKNOWN 400 Bad Request
The HTTP request is rejected because the end user specified in the request is
unknown to the PCF. ERROR_REQUEST_PARAMETERS 400 Bad Request The HTTP request
is rejected because the set of information needed by the PCF for UE Policy
selection is incomplete or erroneous or not available for the decision to be
made. NOTE: Including a \"ProblemDetails\" data structure with the \"cause\"
attribute in the HTTP response is optional unless explicitly mandated in the
service operation subclauses.
* * *
## 5.8 Feature negotiation
The optional features in table 5.8-1 are defined for the Npcf_UEPolicyControl
API. They shall be negotiated using the extensibility mechanism defined in
subclause 6.6 of 3GPP TS 29.500 [5].
Table 5.8-1: Supported Features
* * *
Feature number Feature Name Description
* * *
## 5.9 Security
As indicated in 3GPP TS 33.501 [19] and 3GPP TS 29.500 [5], the access to the
Npcf_UEPolicyControl API may be authorized by means of the OAuth2 protocol
(see IETF RFC 6749 [20]), based on local configuration, using the \"Client
Credentials\" authorization grant, where the NRF (see 3GPP TS 29.510 [13])
plays the role of the authorization server.
If OAuth2 is used, an NF Service Consumer, prior to consuming services offered
by the Npcf_UEPolicyControl API, shall obtain a \"token\" from the
authorization server, by invoking the Access Token Request service, as
described in 3GPP TS 29.510 [13], subclause 5.4.2.2.
NOTE: When multiple NRFs are deployed in a network, the NRF used as
authorization server is the same NRF that the NF Service Consumer used for
discovering the Npcf_UEPolicyControl service.
The Npcf_UEPolicyControl API defines a single scope \"npcf-ue-policy-control\"
for the entire service, and it does not define any additional scopes at
resource or operation level.
###### ## Annex A (normative): OpenAPI specification
# A.1 General
The present Annex contains an OpenAPI [10] specification of HTTP messages and
content bodies used by the Npcf_UEPolicyControl API.
This Annex shall take precedence when being discrepant to other parts of the
specification with respect to the encoding of information elements and methods
within the API.
NOTE 1: The semantics and procedures, as well as conditions, e.g. for the
applicability and allowed combinations of attributes or values, not expressed
in the OpenAPI definitions but defined in other parts of the specification
also apply.
Informative copies of the OpenAPI specification file contained in this 3GPP
Technical Specification are available on the public 3GPP file server in the
following locations (see clause 5B of the 3GPP TR 21.900 [22] for further
information):
\- https://www.3gpp.org/ftp/Specs/archive/OpenAPI/\/, and
\- https://www.3gpp.org/ftp/Specs/\/\/OpenAPI/.
NOTE 2: To fetch the OpenAPI specification file after CT#83 plenary meeting
for Release 15 in the above links \ must be replaced with the date
the CT Plenary occurs, in the form of year-month (yyyy-mm), e.g. for CT#83
meeting \ must be replaced with value \"2019-03\" and \ must
be replaced with value \"Rel-15\".
# A.2 Npcf_UEPolicyControl API
openapi: 3.0.0
info:
version: 1.0.5
title: Npcf_UEPolicyControl
description: \|
UE Policy Control Service.
© 2020, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA,
TTC).
All rights reserved.
externalDocs:
description: 3GPP TS 29.525 V15.6.0; 5G System; UE Policy Control Service.
url: \'http://www.3gpp.org/ftp/Specs/archive/29_series/29.525/\'
servers:
\- url: \'{apiRoot}/npcf-ue-policy-control/v1\'
variables:
apiRoot:
default: https://example.com
description: apiRoot as defined in subclause 4.4 of 3GPP TS 29.501
security:
\- {}
\- oAuth2ClientCredentials:
\- npcf-ue-policy-control
paths:
/policies:
post:
operationId: CreateIndividualUEPolicyAssociation
summary: Create individual UE policy association.
tags:
\- UE Policy Associations (Collection)
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/PolicyAssociationRequest\'
responses:
\'201\':
description: Created
content:
application/json:
schema:
\$ref: \'#/components/schemas/PolicyAssociation\'
headers:
Location:
description: \'Contains the URI of the newly created resource, according to
the structure: {apiRoot}/npcf-ue-policy-control/v1/policies/{polAssoId}\'
required: true
schema:
type: string
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
callbacks:
policyUpdateNotification:
\'{\$request.body#/notificationUri}/update\':
post:
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/PolicyUpdate\'
responses:
\'204\':
description: No Content, Notification was successful
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
policyAssocitionTerminationRequestNotification:
\'{\$request.body#/notificationUri}/terminate\':
post:
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/TerminationNotification\'
responses:
\'204\':
description: No Content, Notification was successful
\'307\':
description: temporary redirect
headers:
Location:
description: \'A URI pointing to the endpoint of another NF service consumer
to which the notification should be sent.\'
required: true
schema:
type: string
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
/policies/{polAssoId}:
get:
operationId: ReadIndividualUEPolicyAssociation
summary: Read individual UE policy association.
tags:
\- Individual UE Policy Association (Document)
parameters:
\- name: polAssoId
in: path
description: Identifier of a policy association
required: true
schema:
type: string
responses:
\'200\':
description: OK. Resource representation is returned
content:
application/json:
schema:
\$ref: \'#/components/schemas/PolicyAssociation\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'406\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/406\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
delete:
operationId: DeleteIndividualUEPolicyAssociation
summary: Delete individual UE policy association.
tags:
\- Individual UE Policy Association (Document)
parameters:
\- name: polAssoId
in: path
description: Identifier of a policy association
required: true
schema:
type: string
responses:
\'204\':
description: No Content. Resource was successfully deleted
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
/policies/{polAssoId}/update:
post:
operationId: ReportObservedEventTriggersForIndividualUEPolicyAssociation
summary: Report observed event triggers and possibly obtain updated policies
for an individual UE policy association.
tags:
\- Individual UE Policy Association (Document)
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/PolicyAssociationUpdateRequest\'
parameters:
\- name: polAssoId
in: path
description: Identifier of a policy association
required: true
schema:
type: string
responses:
\'200\':
description: OK. Updated policies are returned
content:
application/json:
schema:
\$ref: \'#/components/schemas/PolicyUpdate\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
components:
securitySchemes:
oAuth2ClientCredentials:
type: oauth2
flows:
clientCredentials:
tokenUrl: \'{nrfApiRoot}/oauth2/token\'
scopes:
npcf-ue-policy-control: Access to the Npcf_UEPolicyControl API
schemas:
PolicyAssociation:
type: object
properties:
request:
\$ref: \'#/components/schemas/PolicyAssociationRequest\'
uePolicy:
\$ref: \'#/components/schemas/UePolicy\'
triggers:
type: array
items:
\$ref: \'#/components/schemas/RequestTrigger\'
minItems: 1
description: Request Triggers that the PCF subscribes. Only values \"LOC_CH\"
and \"PRA_CH\" are permitted.
pras:
type: object
additionalProperties:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/PresenceInfo\'
minProperties: 1
suppFeat:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/SupportedFeatures\'
required:
\- suppFeat
PolicyAssociationRequest:
type: object
properties:
notificationUri:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Uri\'
altNotifIpv4Addrs:
type: array
items:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Ipv4Addr\'
minItems: 1
description: Alternate or backup IPv4 Address(es) where to send Notifications.
altNotifIpv6Addrs:
type: array
items:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Ipv6Addr\'
minItems: 1
description: Alternate or backup IPv6 Address(es) where to send Notifications.
supi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
gpsi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Gpsi\'
accessType:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/AccessType\'
pei:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Pei\'
userLoc:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/UserLocation\'
timeZone:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/TimeZone\'
servingPlmn:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/NetworkId\'
ratType:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/RatType\'
groupIds:
type: array
items:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/GroupId\'
minItems: 1
hPcfId:
type: string
description: H-PCF Identifier. Shall be provided when available.
uePolReq:
\$ref: \'#/components/schemas/UePolicyRequest\'
guami:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Guami\'
serviceName:
type: string
description: If the NF service consumer is an AMF, it should provide the name
of a service produced by the AMF that makes use of information received within
the Npcf_UEPolicyControl_UpdateNotify service operation.
servingNfId:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/NfInstanceId\'
suppFeat:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/SupportedFeatures\'
required:
\- notificationUri
\- suppFeat
\- supi
PolicyAssociationUpdateRequest:
type: object
properties:
notificationUri:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Uri\'
altNotifIpv4Addrs:
type: array
items:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Ipv4Addr\'
minItems: 1
description: Alternate or backup IPv4 Address(es) where to send Notifications.
altNotifIpv6Addrs:
type: array
items:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Ipv6Addr\'
minItems: 1
description: Alternate or backup IPv6 Address(es) where to send Notifications.
triggers:
type: array
items:
\$ref: \'#/components/schemas/RequestTrigger\'
minItems: 1
description: Request Triggers that the NF service consumer observes.
praStatuses:
type: object
additionalProperties:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/PresenceInfo\'
description: Map of PRA status information.
minProperties: 1
userLoc:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/UserLocation\'
uePolDelResult:
\$ref: \'#/components/schemas/UePolicyDeliveryResult\'
uePolTransFailNotif:
\$ref: \'#/components/schemas/UePolicyTransferFailureNotification\'
guami:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Guami\'
servingNfId:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/NfInstanceId\'
PolicyUpdate:
type: object
properties:
resourceUri:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Uri\'
uePolicy:
\$ref: \'#/components/schemas/UePolicy\'
triggers:
type: array
items:
\$ref: \'#/components/schemas/RequestTrigger\'
minItems: 1
nullable: true
description: Request Triggers that the PCF subscribes. Only values \"LOC_CH\"
and \"PRA_CH\" are permitted.
pras:
type: object
additionalProperties:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/PresenceInfo\'
description: Map of PRA information.
minProperties: 1
nullable: true
required:
\- resourceUri
TerminationNotification:
type: object
properties:
resourceUri:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Uri\'
cause:
\$ref: \'#/components/schemas/PolicyAssociationReleaseCause\'
required:
\- resourceUri
\- cause
UePolicyTransferFailureNotification:
type: object
properties:
cause:
\$ref:
\'TS29518_Namf_Communication.yaml#/components/schemas/N1N2MessageTransferCause\'
ptis:
type: array
items:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Uinteger\'
minItems: 1
required:
\- cause
\- ptis
UePolicy:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Bytes\'
UePolicyDeliveryResult:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Bytes\'
UePolicyRequest:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Bytes\'
RequestTrigger:
anyOf:
\- type: string
enum:
\- LOC_CH
\- PRA_CH
\- UE_POLICY
\- type: string
description: >
This string provides forward-compatibility with future
extensions to the enumeration but is not used to encode
content defined in the present version of this API.
description: >
Possible values are
\- LOC_CH: Location change (tracking area). The tracking area of the UE has
changed.
\- PRA_CH: Change of UE presence in PRA. The AMF reports the current presence
status of the UE in a Presence Reporting Area, and notifies that the UE
enters/leaves the Presence Reporting Area.
\- UE_POLICY: A MANAGE UE POLICY COMPLETE message or a MANAGE UE POLICY
COMMAND REJECT message, as defined in Annex D.5 of 3GPP TS 24.501, has been
received by the AMF and is being forwarded.
PolicyAssociationReleaseCause:
anyOf:
\- type: string
enum:
\- UNSPECIFIED
\- UE_SUBSCRIPTION
\- INSUFFICIENT_RES
\- type: string
description: >
This string provides forward-compatibility with future
extensions to the enumeration but is not used to encode
content defined in the present version of this API.
description: >
Possible values are
\- UNSPECIFIED: This value is used for unspecified reasons.
\- UE_SUBSCRIPTION: This value is used to indicate that the policy association
needs to be terminated because the subscription of UE has changed (e.g. was
removed).
\- INSUFFICIENT_RES: This value is used to indicate that the server is
overloaded and needs to abort the policy association.
###### ## Annex B (informative): Withdrawn API versions
This Annex list withdrawn API versions of the Npcf_UEPolicyControl API defined
in the present specification. 3GPP TS 3GPP TS 29.501 [6] subclause 4.3.1.6
describes the withdrawal of API versions.
The API versions listed in table B-1 are withdrawn for the
Npcf_UEPolicyControl API.
Table B-1: Withdrawn API versions of the Npcf_UEPolicyControl service
+--------------------+------------------------------------------------+ | API version number | Remarks | +--------------------+------------------------------------------------+ | 1.0.0 | Deficits in: | | | | | | - SUPI not mandatory (Unnecessary support of | | | Emergency registration). | | | | | | - Missing AMF instance id in Policy | | | Association request | +--------------------+------------------------------------------------+
#
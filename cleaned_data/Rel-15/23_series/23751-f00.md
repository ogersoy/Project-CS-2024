# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document studies enhancements required for the support of VoIMS
via Trusted and Untrusted WLAN access related with QoS differentiation for
better user experience.
This includes:
\- potential user plane impacts for the support of QoS differentiation;
\- potential UE-TWAN and UE-ePDG signalling enhancements for the support of
QoS differentiation.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[3] IEEE Std 802.11-2012: \"IEEE Standard for Information technology -
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[4] IETF RFC 4301: \"Security Architecture for the Internet Protocol\".
[5] IETF RFC 7296: _\"_ Internet Key Exchange Protocol Version 2 (IKEv2)_\"._
[6] 3GPP TS 23.139: \"3GPP system - fixed broadband access network
interworking\".
[7] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3\".
[8] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[9] GSMA IR.34: \"Guidelines for IPX Provider networks\".
# 3 Definitions, symbols and abbreviations
Delete from the above heading those words which are not applicable.
Clause numbering depends on applicability and should be renumbered
accordingly.
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] apply.
# 4 Architectural considerations
## 4.1 Architectural assumptions and requirements
It is assumed that:
\- The impacts of solutions proposed by this study can be limited to the UE
and ePDG. The IMS subsystem and remaining parts of EPC will not be impacted;
\- The WLANs (e.g. IEEE 802.11 [3]) and the corresponding backhauls to ePDG
and TWAG support QoS differentiation;
\- QoS differentiation is supported per GTP bearer over the S2a and S2b
interfaces respectively supporting TWAN-PGW connectivity and ePDG-PGW
connectivity.
Solutions proposed shall support:
\- QoS differentiation for user plane data e.g. IMS media flows. This includes
IP flows that are non-symmetrical.
\- Update/modification of uplink QoS policies at the UE. This typically
happens during the setup of an IMS call.
# 5 Key issues
## 5.1 Key issue 1: QoS differentiation in the user plane for untrusted WLAN
QoS differentiation is currently supported over S2b: the use of dedicated
bearers over S2b provides the means for supporting QoS differentiation between
the ePDG and the PGW both for uplink and downlink packets.
However, no mechanism has been specified for supporting QoS differentiation
between the ePDG and the UE (over SWu interface) therefore there is no end-to-
end mechanism for QoS differentiation.
A number of WLANs (e.g. IEEE 802.11 [3]) and their backhaul can support QoS
differentiation, but UE-ePDG cannot support QoS differentiation because all
the traffic of a PDN connection is encapsulated in the same IPsec tunnel.
Solutions for this key issue will study how QoS differentiation can be
provided between the UE and the ePDG among different IP flows, for both
downlink and uplink traffic, and how they are mapped from/to S2b bearers. The
scope of the solution is limited to the user-plane handling, i.e. it is not in
the scope of this key issue how the UE learns the QoS policies to be applied
for uplink packets.
## 5.2 Key issue 2: QoS differentiation in the user plane for trusted WLAN
QoS differentiation is currently supported over S2a: the use of dedicated
bearers over S2a provides the means for supporting QoS differentiation between
the ePDG and the PGW both for uplink and downlink packets.
According to TS 23.402 [2] and in case of trusted WLAN, the UE and the AP
shall support IEEE 802.11 [3], which support QoS differentiation via EDCA
Access Classes.
Since the WLCP protocol and the identification of data traffic are currently
at PDN connection level only, the TWAG cannot always derive the dedicated
bearer in the case of two bearers with same QCI.
Solutions for this key issue will study how QoS differentiation can be
provided between the UE and the TWAN among different IP flows, for both
downlink and uplink traffic, and how they are mapped from/to S2a bearers. The
scope of the solution is limited to the user-plane handling, i.e. it is not in
the scope of this key issue how the UE learns the QoS policies to be applied
for uplink packets.
## 5.3 Key issue 3: UE Determination of the QoS to apply to an uplink IP
packet for untrusted WLAN
Assuming that QoS differentiation in the user plane can be supported between
the UE and the ePDG, the QoS class to be applied to the downlink traffic is
determined by the PGW by selecting the EPS bearer (downlink GTP-U tunnel). The
UE needs to determine the DSCP and the WLAN IEEE 802.11 [3] QoS class to apply
to the uplink traffic and to allow the ePDG to map the uplink traffic to the
correct bearer, but no mechanism has been specified how the UE learns the
rules to be applied.
## 5.4 Key issue 4: UE Determination of the QoS to apply to an uplink IP
packet for trusted WLAN
Assuming that QoS differentiation in the user plane can be supported between
the UE and the TWAN, the QoS class to be applied to the downlink traffic is
determined by the PGW by selecting the EPS bearer (downlink GTP-U tunnel). The
UE needs to determine the DSCP and the WLAN IEEE 802.11 [3] QoS class to apply
to the uplink traffic and to allow the TWAN to map the uplink traffic to the
correct bearer, but no mechanism has been specified how the UE learns the
rules to be applied.
# 6 Solutions
## 6.1 Solution 1: Solution to Key Issue#1 for untrusted WLAN based on IPsec
child security associations
### 6.1.1 Description
This solution is related to key issue #1 (QoS differentiation in the user
plane for untrusted WLAN).
For EPC access via untrusted WLAN, the UE establishes a single IPsec tunnel
per PDN connection. The inner DSCP cannot be used to differentiate the QoS up
to the ePDG in an IPsec tunnel as the QoS will depend on the outer DSCP .
Mapping the inner DSCP to the outer DSCP does not work if the anti-replay
mechanism is used: indeed, assigning a different outer DSCP to packets will
result in disordering packets, and late disordered packets will be discarded
by the anti-replay mechanism, as anti-replay mechanism uses sequence
numbering. This is well described in IETF RFC 4301 [4] clause 4.1:
\"If different classes of traffic (distinguished by Differentiated Services
Code Point (DSCP) bits [NiBlBaBL98], [Gro02]) are sent on the same SA, and if
the receiver is employing the optional anti-replay feature available in both
AH and ESP, this could result in inappropriate discarding of lower priority
packets due to the windowing mechanism used by this feature. Therefore, a
sender SHOULD put traffic of different classes, but with the same selector
values, on different SAs to support Quality of Service (QoS) appropriately. To
permit this, the IPsec implementation MUST permit establishment and
maintenance of multiple SAs between a given sender and receiver, with the same
selectors.\"
A way to achieve such QoS differentiation between UE and ePDG is to setup
different Child Security Associations for services requiring different QoS
(via IKE CREATE_CHILD_SA exchanges specified in IETF RFC 7296 [5]). This can
be done e.g. when the PGW establishes a dedicated bearer over S2b. If a UE
does not support multiple IPsec Child Security Associations, the ePDG shall
detect it according to IETF RFC 7296 [5] mechanisms, stop its attempt to setup
a new IPsec Child Security Association and route all the IP packets of the PDN
connection to the existing IPsec Security Association.
For example, when the PDN connection for IMS APN is established, the default
bearer on S2b interface (IMS signalling) should be QCI=5. When PCRF requests
QCI=1 for voice over IMS, the PGW will setup a dedicated bearer over S2b with
QCI=1. This should trigger the ePDG to establish a pair of Child Security
Associations (one uplink, one downlink) with an appropriate outer DSCP (same
for UL SA and DL SA).
For the uplink, the UE should be provided with sufficient information by the
network to determine which SA to be associated with a given IP flow. But this
will be resolved as part of Key Issue 3 \"UE determination of the QoS to apply
to an uplink IP packet\".
Figure 1-1: example of end-to-end support of QoS with untrusted WLAN
Another aspect is whether there should be one to one mapping between an UE-
ePDG IPsec SA and a dedicated bearer over S2b.
When a S2b bearer is established, uplink TFT filters are provided by the PGW
to the ePDG. When an uplink packet is received from the UE, these UL TFT
filters or a one to one mapping between an IPsec SA and a S2b bearer may be
used in the ePDG to select the S2b bearer the packet shall be routed to.
Hence, the S2b bearer selection by the ePDG does not depend on which IPsec
Child Security Association an uplink packet is sent. The ePDG shall derive the
DSCP of the IPsec child SA outer IP header from the QCI.
NOTE: How the UE maps a packet to a Security Association is not addressed in
this solution.
In this solution, the ePDG shall be able to establish a pair of IPsec child
Security Associations using IKEv2 signalling when a S2b bearer is established,
however, the ePDG may decide either to setup one IPsec Child SA per bearer, to
setup one IPsec Child SA per QCI or to reuse an existing SA.
Once the IPsec Child SA has been established, the ePDG shall route the
downlink data packets received over an S2b bearer to the corresponding IPsec
child Security Association.
When the last dedicated bearer using an IPsec Security Association is
released, the ePDG shall release the corresponding IPsec Security Association
using IKEv2 signalling.
Once the IPsec Child Security Association is established, the UE shall route
the uplink data packets to the corresponding IPsec child Security Association.
The UE should be able to establish/release an IPsec child Security Association
when requested by IKEv2 from the network.
### 6.1.2 Impacts on existing nodes and functionality
ePDG:
\- the ePDG is impacted to be able to establish a pair of IPsec child Security
Associations using IKEv2 signalling;
\- the ePDG is impacted to be able to route the downlink data packets received
over an S2b bearer to the corresponding IPsec child Security Association;
\- the ePDG is impacted to be able to route the uplink packets to the
corresponding S2a bearer based on the TFT provided by the PGW;
\- the ePDG is impacted to be able to release the corresponding IPsec child
Security Association using IKEv2 signalling at bearer release.
UE:
\- the UE is impacted to be able to establish/release an IPsec child Security
Association when requested by IKEv2 from the network;
\- the UE is impacted to be able to route the uplink data packets to the
appropriate IPsec child Security Association.
### 6.1.3 Solution evaluation
This solution allows end-to-end QoS differentiation via using separate IPsec
Security Associations and via
\- for the downlink, the mapping between the QCI over S2b, the IP packet DSCP
and the IPsec Security Association;
\- for the uplink, the UE selects the appropriate child IPSec association and
the ePDG maps the IP flow to an S2b bearer, using the UL TFT or using a one to
one mapping between an IPsec SA and a S2b bearer. Whether UL TFT in the ePDG
or one to one mapping between an IPSec SA and a S2b bearer is to be determined
in the conclusion.
This solution allows either to establish one IPsec SA per S2b bearer, or to
use an IPsec SA for several S2b bearers.
This solution needs to be complemented with a solution that allows the UE to
determine the IPsec SA to use for each uplink IP packet.
## 6.2 Solution 2: Solution to Key Issue #3 for untrusted WLAN based on
reflective QoS
### 6.2.1 Description
This solution is related to key issue #3 (UE Determination of the QoS to apply
to an uplink IP packet for untrusted WLAN) and is based on solution 1 for Key
Issue 1.
Solution 1 for Key Issue 1 states that the ePDG shall derive the DSCP of the
IPsec child SA outer IP header from the QCI and shall route the downlink IP
packets towards the IPsec child SA that is mapped to the QCI.
Solution 1 for Key Issue 1 also states that for the uplink, that the UE should
be provided with sufficient information by the network to determine which SA
to be associated with a given IP flow.
In this solution, the UE gets the information required for the uplink mapping
from the user plane, based on reflective QoS principles described in TS 23.139
[6] clauses 6.3.1 and 6.3.3:
\- It is assumed that if the UE supports multiple SAs, it also supports
Reflective QoS.
DSCP marking of uplink traffic by the UE:
\- For each incoming downlink IP packet the UE checks if a DSCP marking rule
for the n-tuple of this IP packet exists. If the rule does not exist, then a
new marking rule is added. Otherwise, the DSCP value and the time stamp for
this marking rule are set.
\- The n-tuples correspond to the n-tuples of the inner header of the packet.
In all scenarios, the DSCP value of the marking rule is the DSCP value of the
inner header of the packet.
\- The uplink n-tuple in each marking rule is made from the downlink n-tuple
of that rule by swapping source and destination addresses (and ports). The
rule contains the DSCP value and the identity of the IPsec SA.
\- For each outgoing IP packet the UE checks if a marking rule for this IP
packet exists. If the n-tuple of the packet matches the uplink n-tuple of a
marking rule, then the DSCP value of the packet is set to the DSCP value of
that marking rule. The time stamp for that rule is set.
\- A marking rule is removed when a certain period of time has passed since
the time stamp.
\- The function of reflective QoS overwrites DSCP markings set by the UE
application with the DSCP value stored in the marking rule. The IPsec SA is
selected based on the identity of the IPsec SA stored in the marking rule.
\- For IP flows initiated from the UE, uplink packets are marked with the DSCP
value that corresponds to the first established IPsec SA until a marked
downlink packet is received with the downlink n-tuple that matches the
received uplink n-tuple.
This solution relies on the assumption that there is not more than one IPsec
SA per DSCP value. For example, it does not work if the ePDG sets an IPsec SA
per bearer, where two bearers have the same QCI.
NOTE: This solution cannot provide QoS differentiation for unidirectional and
non symmetrical uplink flows.
### 6.2.2 Impacts on existing nodes and functionality
UE:
\- the UE is impacted to support reflective QoS.
### 6.2.3 Solution evaluation
Solution 2 supports QoS differentiation for bidirectional symmetrical IMS
media IP flows.
However,
\- it cannot provide QoS differentiation for unidirectional and non-
symmetrical uplink flows;
\- it is restricted to a single IPsec SA per DSCP: it cannot be used if the
ePDG sets an IPsec SA per bearer, where several bearers have the same QCI.
It only supports update/modification of uplink QoS policy for an uplink IP
flow whenever there is a downlink packet of the counterpart downlink flow.
## 6.3 Solution 3: Solution to Key Issue #3 for sending TFTs to UE for
untrusted WLAN based on IKEv2
### 6.3.1 Description
This solution is related to key issue #3 (UE Determination of the QoS to apply
to an uplink IP packet for untrusted WLAN). In this solution it is assumed
that separate IPsec SAs are used for the different QoS flows as proposed in
solution 6.1. In this solution there is a 1 to 1 mapping between an EPS bearer
and a SA. The default EPS bearer maps to the initial SA. Every dedicated
bearer maps to separate child SA. The ePDG maintains the binding between SAs
and EPS bearers. If a UE does not support multiple IPsec Child Security
Associations, the ePDG shall detect it according to IETF RFC 7296 [5]
mechanisms, stop its attempt to setup a new IPsec Child Security Association
and route all the IP packets of the PDN connection to the existing IPsec
Security Association.
Furthermore, in this solution, TFTs and Bearer QoS information are conveyed to
the UE at EPS bearer creation and potentially at modification. In EPC the UE
is using TFTs to determine on what radio bearer each uplink IP packet should
be sent on. There are support for different filter types, precedence of
filters that and the TFTs can be updated. TFTs are sent on S2b between PGW and
ePDG when bearers are created and updated. The UE shall also use TFTs in this
case as well.
The IKEv2 traffic selectors TSi and TSr shall not be used if the UE uses TFTs
for a given SA.
There are no impacts on existing SA implementations other than the routing of
packets to the SA.
As stated before, bearer QoS information is also sent to UE at EPS bearer
creation and potentially at modification. The bearer QoS information includes
information regarding the QoS characteristics of the bearer (e.g., maximum
bit-rates, QCI). The UE uses this information to set DSCP value for uplink
packets. The mapping of QoS class to DSCP could be configurable in the UE and
as an example can use the recommended mappings specified in 3GPP (mapping
between standardized QCIs and Release 99 QoS parameter value in TS 23.401 [8])
and IEEE 802.11 [3]. Additionally the UE may use the bearer QoS information
for some local UE aspects of admission control.
#### 6.3.1.1 Initial Attach
Initial attach is done according to TS 23.402 [2] with the addition that a
supporting UE includes a capability indication for the feature. If capability
flag is sent by the UE and if EPDG supports the feature, dedicated bearers
will be setup as described in this solution. Otherwise the legacy behaviour
shall be used (with dedicated bearers only on S2b interface). This is the same
solution for capability indication as for other features over SWu e.g., P-CSCF
restoration.
#### 6.3.1.2 EPS Bearer Creation
When ePDG receives a request to setup a new dedicated bearer over S2b, it
shall use the IKEv2 CREATE_CHILD_SA exchange to setup a new IPsec SA between
ePDG and UE over SWu.
Further, when ePDG receives a create bearer request from PGW over S2b, it
shall copy the TFT information to a new IKEv2 notify payload \"TFT\". ePDG
will not have to process the TFT but can send this transparently between S2b
and SWu.
Figure 6.3.1-1: Dedicated S2b bearer activation
In the procedure Dedicated S2b bearer activation, the ePDG shall trigger a
CREATE_CHILD_SA as depicted in figure 6.3.1-1. Note that one CREATE_CHILD SA
exchange results in IPsec SAs for both directions. The CREATE_CHILD_SA message
shall contain a new IKEv2 notify payload \"TFT\" that is a copy of the TFTs
received over S2b in step 1. The CREATE_CHILD_SA message shall also contain a
new IKEv2 notify payload \"Bearer QoS\" information. This is similar to the
MME behaviour to relay TFTs via NAS. IKEv2 notify payload is used since it has
already been used by 3GPP to send other information elements over SWu like
device identity, back off timer and NBIFOM containers (as specified in TS
24.302 [7]).
The default bearer maps to the initial IPsec SA.
#### 6.3.1.3 EPS Bearer Modification
In the case of PGW initiated bearer modification and if the TFTs are updated,
the ePDG shall trigger an INFORMATIONAL exchange as depicted in figure
6.3.1-2. The INFORMATIONAL request message shall contain the IKEv2 notify
payload \"TFT\" and \"Bearer QoS\".
Figure 6.3.1-2: PGW initiated bearer modification
#### 6.3.1.4 EPS Bearer Deactivation
When ePDG receives a request to deactivate an existing dedicated bearer over
S2b, it shall use the IKEv2 INFORMATIONAL exchange with Delete payloads to
remove the IPsec SAs between ePDG and UE over SWu for the deactivated bearer.
Note that ePDG orders the delete of the IPsec SA from UE to ePDG and UE
responds with deleting the IPsec SA from ePDG to the UE.
Figure 6.3.1-4: Dedicated S2b bearer Deactivation
#### 6.3.1.5 Handover between 3GPP access and Untrusted non-3GPP
Handover from untrusted non-3GPP to E-UTRAN will be done as legacy and all
bearers on LTE access will be re-created.
Note that the ePDG is releasing the IKEv2 tunnel after handover is complete
and that will implicitly also remove the IPsec SAs.
For handover from E-UTRAN to untrusted non-3GPP when there are dedicated
bearers active in the E-UTRAN access, the IPsec SAs corresponding to the
dedicated bearers will be explicitly created as described in 6.3.1.2. The UE
is not expected to re-use any dedicated bearer information from the old
access.
### 6.3.2 Impacts on existing nodes and functionality
ePDG:
The ePDG is modified to perform additionally the following tasks:
\- Trigger a CREATE_CHILD_SA exchange when a new dedicated bearer is created
over S2b
\- Include the IKEv2 \"TFT\" notify payload in IKEv2 create_child_sa message
when a new dedicated bearer is created over S2b
\- Include the IKEv2 \"TFT\" notify payload in IKEv2 notify message when TFT
is updated over S2b
UE:
The UE is modified to perform additionally the following tasks:
\- Receive CREATE_CHILD_SA request and setup a new IPsec SA and respond to
ePDG
\- Receive IKEv2 \"TFT\" notify payload both when setting up a new IPsec SA
and at any time when UE receives an IKEv2 informational message
\- Route packets to correct IPsec based on uplink TFTs
### 6.3.3 Solution evaluation
Solution 3 supports QoS differentiation for IMS media IP flows.
Solution 3 supports Update/modification of uplink QoS policies.
The usage of feature capability indication when UE attaches provides for
compatibility with legacy UEs and ePDGs not supporting the solution.
**Control Plane Impacts**
\- The ePDG must translate and bind information elements to be exchanged
between S2b and SWu. The UE must, based on input from SWu procedures,
provision the uplink QoS flows in the user plane and respond over SWu.
\- Additionally, the ePDG and UE must support multiple IPsec SAs and the new
IKEv2 notify payloads if supporting the QoS feature.
**User Plane Impacts**
\- The ePDG will relay packets between IPsec child SA and GTP tunnel for all
EPS bearers. For UEs that don\'t support this feature, the ePDG will need to
follow the legacy function and use uplink TFTs to determine what uplink S2b
bearer to use.
\- The UE will need to route packets to correct IPsec child SA based on the
uplink TFTs. This is a similar function as used on 3GPP access to determine
uplink DRB.
## 6.4 Solution 4 to Key Issue #2: QoS differentiation for trusted WLAN based
on DSCP mapping
### 6.4.1 Description
This solution is related to Key Issue #2 (QoS differentiation in the user
plane for trusted WLAN).
Downlink QoS
> Dedicated bearers established by the PGW are already supported from Rel-11
> onwards for GTP: GTP Create (Modify) Bearer Request message contains
> \"Bearer Level QoS\" IE (ARP, QCI, MBR UL/DL, GBR UL/DL + UL TFT). The TWAG
> translates the bearer QCI into a DSCP value to apply to the downlink IP
> packet for the TWAG/AP path. Then the AP maps the DSCP to IEEE 802.11 [3]
> User Priorities e.g. according to GSMA IR.34 [9], and User Priorities are
> mapped to IEEE 802.11 [3] EDCA Access Categories according to IEEE 802.11
> [3], clause 9.2.4.2.
Uplink QoS
> The DSCP of an uplink packet is mapped to IEEE 802.11 [3] EDCA Access
> Categories in the same way as for the downlink: the \"QoS Map Set element\"
> (IEEE 802.11 [3], clause 8.4.2.97) carries the mapping of the DSCP field to
> User Priorities, and EDCA Access Categories are derived from the User
> Priorities according to IEEE 802.11 [3], clause 9.2.4.2.
>
> According to TS 23.402 [2], the TWAN uses the uplink packet filter (UL TFT)
> to determine the mapping of traffic flows to the S2a bearer.
How the DSCP of an uplink packet is determined is discussed in solutions to
Key Issue #4.
### 6.4.2 Impacts on existing nodes and functionality
TWAG:
\- the TWAG shall map the QCI of any downlink GTP-u packet to a DSCP value to
apply to the downlink IP packet.
\- the TWAG shall route the uplink packets towards the corresponding S2a
bearer based on the UL TFT provided by the PGW;
UE:
\- the UE shall map the DSCP value of an uplink packet to an EDCA Access
Category;
### 6.4.3 Solution evaluation
This solution allows end-to-end QoS differentiation via
\- for the downlink, the mapping between the QCI over S2a, the IP packet DSCP
and the EDCA on the radio path;
\- for the uplink, the mapping between the IP packet DSCP and the EDCA on the
radio path, and between the IP packet DSCP and the S2a bearer.
This solution needs to be complemented with a solution that allows the UE to
determine the DSCP to apply to an uplink packet.
## 6.5 Solution 5 to Key Issue #4 using WLCP for sending TFTs to UE for
trusted WLAN
### 6.5.1 Description
This solution is related to key issue #4 (UE Determination of the QoS to apply
to an uplink IP packet for trusted WLAN). In this solution, it is assumed
that, as proposed in solution 6.4 (QoS differentiation for trusted WLAN based
on DSCP mapping):
\- For downlink, the bearer QCI is mapped by the TWAG into a DSCP value
applied to the IP packet, then the DSCP is mapped to an IEEE 802.11 [3] EDCA
Access Category over the radio.
\- For uplink, the IP packet DSCP is mapped by the UE into an IEEE 802.11 [3]
EDCA Access Category over the radio, then the IP packet is routed to the S2a
bearer by using the UL TFT received from the PGW during the S2a bearer
establishment/modification procedure.
The UE then must determine for each uplink IP packet the DSCP to apply. In
multi-connection mode, it is proposed to use the WLCP protocol to convey the
UL TFT from the TWAG to the UE. In single-connection mode, it is not possible
to signal UL TFT to the UE.
In multi-connection mode, WLCP PDN Connectivity Request with additional UL TFT
with associated DSCP can be used at the establishment of a PDN connection, and
WLCP PDN Modification Request with additional UL TFT parameter with associated
DSCP can be used at any point of time once the PDN connection has been
established, e.g. at Dedicated bearer activation.
The UE derives the DSCP to apply to an uplink packet from the association
between the UL TFT and the DSCP provided by WLCP signalling at the
establishment and modification of the PDN connection. The derived DSCP
overwrites DSCP markings set by the UE application.
{width="6.6875in" height="2.265972222222222in"}
Figure 6.5.1-1: Signalling of UL TFT to the UE
### 6.5.2 Procedures
#### 6.5.2.1 UE Initiated PDN connectivity request procedure in multi-
connection mode
The UE initiated PDN connectivity request procedure in multi-connection mode
is as described in TS 23.402 [2] clause 16.8.1 with the following
modifications:
7\. The TWAN returns a WLCP PDN Connection Response (APN, PDN Type, PDN
Address, PDN Connection ID, User Plane Connection ID, Protocol Configuration
Options and UL TFT with associated DSCP) message to the UE. For uplink packets
that match an UL TFT, the UE applies the DSCP provided with that UL TFT.
#### 6.5.2.2 Dedicated bearer activation in WLAN on GTP S2a
The dedicated bearer activation procedure for GTP based S2a is depicted in
figure 6.5.2.1-1.
Figure 6.5.2.1-1: Dedicated S2a Bearer Activation Procedure with GTP on S2a
The Dedicated Bearer Activation procedure is as described in TS 23.402 [2]
clause 16.5 with the following differences:
3\. The TWAN sends WLCP PDN Modification Request (PDN connection ID, UL TFT
with associated DSCP) to the UE. The UE stores the UL TFT with associated DSCP
and responds with WLCP PDN Modification Accept (PDN connection ID) to the
TWAN. For uplink packets that match an UL TFT, the UE applies the DSCP
provided with that UL TFT. A TWAN specific resource allocation/modification
procedure may be executed in this step. The details of this step are out of
the scope of 3GPP.
#### 6.5.2.3 PDN GW Initiated Bearer Modification
The PDN GW initiated bearer modification procedure for a GTP based S2a is
depicted in figure 6.5.2.3-1. This procedure also applies for the case of
bearer deactivation.
Figure 6.5.2.3-1: PDN GW-initiated S2a Bearer Modification Procedure with GTP
on S2a
The PDN GW Initiated Bearer Modification procedure is as described in TS
23.402 [2] clause 16.6.1 with the following differences:
3\. The TWAN sends WLCP PDN Modification Request (PDN connection ID, UL TFT
with associated DSCP) to the UE. The UE stores the UL TFT and responds with
WLCP PDN Modification Accept (PDN connection ID) to the TWAN. For uplink
packets that match an UL TFT, the UE applies the DSCP provided with that UL
TFT. A TWAN specific resource allocation/modification procedure may be
executed in this step. The details of this step are out of the scope of 3GPP.
### 6.5.3 Impacts on existing nodes and functionality
TWAG:
\- the TWAG shall map the QCI of any downlink GTP-u packet to a DSCP value to
apply to the downlink IP packet.
\- the TWAG is modified to send the UL TFT with associated DSCP via the WLCP
Modification Request/accept procedure.
\- the TWAG shall route the uplink packets towards the corresponding S2a
bearer based on the UL TFT provided by the PGW;
UE:
\- the UE shall map the DSCP value of an uplink packet to an EDCA Access
Category;
\- the UE shall support the WLCP Modification procedure and use the received
UL TFT with associated DSCP for the determination of the DSCP of uplink
packets.
### 6.5.4 Solution evaluation
This solution complements solution #4.
This solution supports QoS differentiation for bidirectional or unidirectional
IMS media IP flows.
This solution supports update/modification of uplink QoS policies at any point
of time.
## 6.6 Solution 6 to Key Issue #4 : Using WLCP bearers for sending TFTs to UE
for trusted WLAN
### 6.6.1 Description
This solution is related to key issue #4 (UE Determination of the QoS to apply
to an uplink IP packet for trusted WLAN).
In this solution, it is assumed that the user plane solution is according to
6.7 (QoS differentiation for trusted WLAN based on WLCP bearer).
User plane solution mimic 3GPP behaviour by using bearers between UE and TWAG
and then there is a one-to-one relationship in TWAG between the S2a bearers
and WLCP bearers.
The control plane to setup the WLCP bearers is similar to how DRBs are setup
in LTE. A per-UE unique user plane connection ID (MAC address) is assigned for
each WLCP bearer.
### 6.6.2 Procedures
#### 6.6.2.1 UE Initiated PDN connectivity request procedure in multi-
connection mode
The UE initiated PDN connectivity request procedure in multi-connection mode
is depicted in figure 6.6.2.1-1.
Figure 6.6.2.1-1: PDN Connectivity Request
The UE initiated PDN connectivity request procedure in multi-connection mode
is as described in TS 23.402 [2] clause 16.8.1 with the following differences
> 1\. The UE sends WLCP PDN connection Request which include a capability
> indicator for multiple WLCP bearers per PDN connection.
>
> 7\. The TWAN sends WLCP PDN connection Response which includes Bearer ID and
> QoS for the default bearer. The MAC address provided in the WLCP connection
> response will be used for packets sent on the default WLCP bearer
#### 6.6.2.2 Dedicated bearer activation in WLAN on GTP S2a
The dedicated bearer activation procedure for GTP based S2a is depicted in
figure 6.6.2.2-1.
Figure 6.6.2.2-1: Dedicated S2a Bearer Activation Procedure with GTP on S2a
The Dedicated Bearer Activation procedure is as described in TS 23.402 [2]
clause 16.5 with the following differences:
3\. The TWAN sends new WLCP message Bearer Creation Request (PDN connection
ID, Bearer ID, TFT, Bearer QoS with associated QCI, User plane connection ID)
to the UE if UE is capable of multiple WLCP bearers per PDN connection. The
user plane connection ID is assigned by the TWAG and shall be unique among all
WLCP bearers for that UE. The UE stores the information on the new WLCP bearer
and responds with WLCP Bearer Creation Response to the TWAN. For uplink
packets that match bearer TFT according to same principles as for 3GPP access,
the UE applies Bearer QoS and send packet on that bearer i.e., on the user
plane connection ID (MAC address) associated with the bearer. A TWAN specific
resource allocation/modification procedure may be executed in this step. The
details of this step are out of the scope of 3GPP.
WLCP Bearer Creation Request and Response are new messages.
#### 6.6.2.3 PDN GW Initiated Bearer Modification
The PDN GW initiated bearer modification procedure for a GTP based S2a is
depicted in figure 6.6.2.3-1.
Figure 6.6.2.3-1: PDN GW-initiated S2a Bearer Modification Procedure with GTP
on S2a
The PDN GW Initiated Bearer Modification procedure is as described in TS
23.402 [2] clause 16.6.1 with the following differences:
3\. The TWAN sends WLCP Bearer Update Request with a list of modified bearers
{Bearer ID, [TFT], [Bearer QoS]} to the UE if such a bearer exists. The UE
stores and uses the updated TFT or Bearer QoS for each bearer id.
WLCP Bearer Update Request and Response are new messages.
#### 6.6.2.4 PDN GW initiated Resource Allocation Deactivation
The PDN GW initiated Resource Allocation Deactivation for a GTP based S2a is
depicted in figure 6.6.2.4-1.
Figure 6.6.2.4-1: PDN GW initiated Resource Allocation Deactivation with GTP
on S2a
The PDN GW Initiated Bearer Modification procedure is as described in TS
23.402 [2] clause 16.6.1 with the following differences:
3\. In case the default bearer is marked for deletion in step 2, the TWAN
sends WLCP PDN Disconnection request.
4 In case a dedicated bearer is marked for deletion in step 2 and the bearer
exists, the TWAN sends a new WLCP Bearer Delete message with a list of bearer
identities to be deleted.
WLCP Bearer Delete Request and Response are new messages.
#### 6.6.2.5 Handover between 3GPP access and Trusted non-3GPP
Handover from trusted non-3GPP to E-UTRAN will be done as legacy and all
bearers on LTE access will be re-created.
Note that the PGW performs a delete of the default bearer on non-3GPP after
handover to LTE is complete and that will implicitly also remove the WLCP
bearers.
For handover from E-UTRAN to trusted non-3GPP when there are dedicated bearers
active in the E-UTRAN access, the WLCP bearers corresponding to the dedicated
bearers will be explicitly created as described in 6.6.2.2. The UE is not
expected to re-use any dedicated bearer information from the old access.
### 6.6.3 Impacts on existing nodes and functionality
TWAG:
\- the TWAG is modified to setup dedicated WLCP bearer by assigning a unique
(per UE) user plane connection ID to the dedicated bearer, send new WLCP
message Bearer Creation Request and receive reply from UE.
\- the TWAG is modified to be able to delete WLCP bearer or disconnect WLCP
PDN connection at PDN GW initiated Resource Allocation Deactivation
UE:
\- the UE shall support the WLCP Bearer activation, deactivation and
modification procedure.
### 6.6.4 Solution evaluation
Solution 6 supports QoS differentiation for IMS media IP flows.
Solution 6 supports Update/modification of uplink QoS policies.
**Control Plane Impacts**
\- The TWAG and UE must support the updated WLCP procedures
\- The TWAG must translate and bind information elements to be exchanged
between S2a and WLCP. The UE must, based on input from WLCP procedures,
provision the uplink QoS flows in the user plane.
\- Additionally, the TWAG and UE must support multiple WLCP bearers per PDN
connection.
**User Plane Impacts**
\- The TWAG will relay packets between WLCP bearer and GTP tunnel for all EPS
bearers. For UEs that don\'t support this feature, the TWAG will need to
follow the legacy function and use uplink TFTs to determine what uplink S2a
bearer to use.
\- The UE will need to route packets to the correct WLCP bearer based on the
uplink TFTs. This is a similar function as used on 3GPP access to determine
uplink DRB.
## 6.7 Solution 7 to Key Issue #2: QoS differentiation for trusted WLAN based
on WLCP bearer
### 6.7.1 Description
This solution is related to Key Issue #2 (QoS differentiation in the user
plane for trusted WLAN).
Downlink QoS
Dedicated bearers established by the PGW are already supported from Rel-11
onwards for GTP: GTP Create (Modify) Bearer Request message contains \"Bearer
Level QoS\" IE (ARP, QCI, MBR UL/DL, GBR UL/DL + UL TFT). In this solution a
WLCP bearer has been created as well that maps one-to-one with the S2a bearer.
TWAG map the QCI of the WLCP/S2a bearer to a DSCP and use that for downlink IP
packets for the TWAG/AP path. Then the AP maps the DSCP to IEEE 802.11 [3]
User Priorities for example based on GSMA IR.34 [9], and User Priorities are
mapped to IEEE 802.11 [3] EDCA Access Categories according to IEEE 802.11 [3],
clause 9.2.4.2.
Uplink QoS
UE will use TFTs associated to the Bearer to determine what WLCP bearer to use
for sending uplink IP packets and based on bearer QCI value, the DSCP value
can be derived. Then the UE maps the DSCP to IEEE 802.11 [3] User Priorities
for example based on GSMA IR.34 [9], and User Priorities are mapped to 802.11
EDCA Access Categories according to IEEE 802.11 [3], clause 9.2.4.2.
Different WLCP bearers use different unique user plane connection IDs i.e. MAC
addresses on the TWAG side. This implies that TWAG knows what WLCP bearer is
used and can directly relay the packet to a S2a bearer without having to
process the uplink TFTs.
### 6.7.2 Impacts on existing nodes and functionality
TWAG:
\- the TWAG shall map the bearer QCI of any downlink GTP-u packet to a DSCP
value to apply to the downlink IP packet.
\- the TWAG shall route the uplink packets towards the corresponding S2a
bearer based on what WLCP bearer the packet is received on.
UE:
\- the UE shall use TFTs to determine what WLCP bearer to use for an uplink
packet
\- the UE shall set the DSCP value of an uplink packet based on the QCI value
of the selected bearer and then derive the EDCA Access Category from the DSCP
value
\- the UE shall send uplink packet with destination MAC address corresponding
to the WLCP bearer user plane connection ID
# 7 Overall evaluation
Editor\'s note: This clause will contain the evaluation of the identified
solutions for every key issue.
For untrusted WLAN, the set of solutions #1 and #3:
\- allows end-to-end QoS differentiation via using separate IPsec Security
Associations and via
\- for the downlink, the mapping between the QCI over S2b, the IP packet DSCP
and the IPsec Security Association;
\- for the uplink, the mapping between an IP flow and an S2b bearer, using the
UL TFT in the ePDG.
\- the mapping between the outer IP header DSCP of the IPsec SA to the EDCA
class on WLAN radio.
\- allows to establish one IPsec SA per S2b bearer.
\- supports QoS differentiation for bidirectional or unidirectional IMS media
IP flows.
\- supports update/modification of uplink QoS policies at any point of time.
Whereas, even if the set of solutions #1 and #2 allows end-to-end QoS
differentiation via using separate IPsec Security Associations:
\- it cannot provide QoS differentiation for unidirectional and non-
symmetrical uplink flows;
\- it is restricted to a single IPsec SA per DSCP: it cannot be used if the
ePDG sets an IPsec SA per bearer, where several bearers have the same QCI.
\- It only supports update/modification of uplink QoS policy for an uplink IP
flow whenever there is a downlink packet of the counterpart downlink flow.
For trusted WLAN, the set of solutions #6 and #7:
\- allows end-to-end QoS differentiation via
\- for the downlink, the mapping between the QCI over S2a, the IP packet DSCP
and the EDCA on the radio;
\- for the uplink, the mapping between the IP packet DSCP and the EDCA on the
radio (using UL TFT sent via WLCP signalling), and between the IP packet DSCP
and the S2a bearer (using a one to one mapping between a DSCP and a S2a
bearer).
\- supports QoS differentiation for bidirectional or unidirectional IMS media
IP flows.
\- supports update/modification of uplink QoS policies at any point of time.
Whereas, even if the set of solutions #4 and #5 has the same characteristics,
it uses the TWAG UL TFT provided by the PGW over S2a instead of using an
explicit signalling of the one to one mapping between DSCP and S2a bearer.
# 8 Conclusions
Editor\'s note: This clause is intended to list conclusions, which are agreed
during the course of the study item activities.
For untrusted WLAN, the set of solutions #1 and #3 with one to one mapping
between IPsec child SA and S2b bearer (using explicit signalling) is
recommended for normative specification work.
For trusted WLAN, the set of solutions #6 and #7 with one to one mapping
between WLCP bearer and S2a bearer (using explicit signalling) is recommended
for normative specification work.
#
# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
The capability to allow media to be routed in an optimal manner between IMS
operators when the subscriber is roaming was introduced in Rel-10. However,
certain features may require that the media is controlled by the home network.
These features include conferencing, transcoding, tones insertion and
announcement insertion.
In these cases, the media plane is typically re-directed back to the home
network to perform these functions. For transcoding, the media would have to
stay routed through the home network for the duration of the call. However,
for tone and announcement insertion, there is the possibility to temporarily
re-direct the media plane though the home network only for the duration of the
tone/announcement. Unfortunately, neither of these solutions is ideal from a
subscriber\'s perspective as it potentially introduces delay between the call
parties. In addition, the subscriber will also experience a cut-out of media
whilst the re-direction is performed (if redirected mid-call e.g. for
tone/announcement insertion). This increases the risk of the call being cut-
off (e.g. if the redirect fails for some reason).
# 1 Scope
The present document provides a study into the new (Rel-11) requirements
identified by SA WG1 to allow a home network to control a visited network to
perform the following IMS functions for its subscribers:
\- conferencing (network hosted);
\- transcoding;
\- tone insertion; and
\- announcement insertion.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TR 21.801: \"Specification drafting rules\".
[3] 3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IM call model;
Stage 2\".
[4] 3GPP TS 23.228: \" IP multimedia subsystem; Stage 2\".
[5] 3GPP TS 24.229: \"IP multimedia call control protocol based on SIP and
SDP; stage 3\".
[6] 3GPP TR 23.850: \"Study on Roaming Architecture for Voice over IMS with
Local Breakout\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AS Application Server
B2BUA Back to back user agent
CS Circuit Switched
CSCF Call Session Control Function
HPLMN Home Public Land Mobile Network
IBCF Interconnection Border Control Function
MGCF Media Gateway Control Function
MRB Media Resource Broker
MRF Media Resource Function
MRFC Media Resource Function Controller
MRFP Media Resource Function Processor
I-CSCF Interrogating CSCF
P-CSCF Proxy CSCF
S-CSCF Serving CSCF
SDP Session Description Protocol
SIP Session Initiation Protocol
TCP Transmission Control Protocol
TrGW Translation Gateway
UDP User Datagram Protocol
UE User Equipment
VPLMN Visited Public Land Mobile Network
# 4 Assumptions, architectural requirements, and use cases
## 4.1 Assumptions
The following assumptions need to be borne in mind for the chosen solution,
and add clarity to the architectural requirements that follow in the next sub-
clause:
\- The subscribers involved in the solution are assumed to be inbound roaming
subscribers from another PLMN operator. However, there should be nothing
preventing a PLMN using it for its own subscribers, if it so wishes.
\- Any Private and Public Identity selection that is preconfigured in the
VPLMN is statically configured and agreed by the HPLMN through usual inter-
PLMN commercial roaming agreements.
## 4.2 Architectural Requirements
The chosen solution shall fulfil the following architectural requirements:
\- Can avoid the need to route the IMS media plane via the HPLMN for the IMS
functions as listed in the Scope section of the present document.
\- Shall have minimal impact on the existing IMS architecture and shall reuse
or enhance existing interfaces/reference points wherever possible.
\- Can be invoked selectively by the VPLMN as follows:
\- On a per subscriber basis such as:
\- static configuration in the VPLMN; and
\- subscriber profile flag conveyed by the HPLMN.
\- On a per IMS function (as listed in the Scope section of the present
document) such as:
\- static configuration in the VPLMN; and
\- subscriber profile flag conveyed by the HPLMN.
\- The VPLMN can deny all or a sub-set of the IMS functions (as listed in the
Scope section of the present document) to all or a defined sub-set of
subscribers at any session establishment (e.g. due to a lack of
capacity/availability).
\- Architecture alternatives shall avoid disclosing the hierarchy of
operator\'s resources network and the operator\'s selected deployments of
AS/MRF, MRFC/MRFP and/or MRB/MRFC.
NOTE: The language used in all of the above bullets is in compliance with TR
21.801 [2], Annex E. As such, the term \"can\" is used in place of the phrase
\"shall be able to\" (the latter of which is commonly used in other TRs).
# 5 Solution Alternatives
## 5.1 Solution Alternatives for Allocation of Resources
### 5.1.1 Introduction
Currently, the MRF is limited to HPLMN, which results in media having to be
home-routed either temporarily or permanently, in order to place the MRF in
its path, resulting in a simplified architecture as follows:
Figure 5.1.1-1
This was identified as one of the reasons why operators could not fully
realize Optimal Media Routing, when transcoding, conferencing, tone or
announcements insertion is needed.
NOTE: Although other scenarios are commonly used for allocation of resources,
e.g. AS interfacing MRFC or using MRB in query and/or in-line mode, for the
sake of simplicity, just the one involving the S-CSCF in the signalling path
has been shown.
The following sub-clauses discuss solutions for allocating and provisioning of
certain resources (as specified in clause 4 of the present document) to
inbound roaming IMS subscribers. All architecture solutions shall follow the
constraints specified in clause 4.
### 5.1.2 Tones/Announcements insertion in the VPLMN
Announcement/tone insertion is not that commonly used for calls once those
have commenced. Some common cases for insertion of tones/announcements relate
to conference calls, with optimizations discussed in chapter 5.2.3, and pre-
paid calls in which the user is indicated limit of credit by means of tones.
For cases other than conferencing, the sequence of playing announcements/tones
for a UE-originating IMS session is depicted in the figure below. An AS
(acting as B2BUA) performs third party call control with the MRF, where the
S-CSCF is in the signalling path.
The AS interacts with the UE as usual to establish the dialog.
Upon detecting tone/announcement needs to be played and the UE is located in
the VPLMN, the AS may perform two different actions, depending on whether a
MRB (in query mode) exists or just the MRF needs to be contacted:
1 An MRB is interrogated to assign an MRF fitting the characteristics demanded
by the service. The MRB will return the address of the relevant MRF in the
VPLMN and the AS will simply initiate a dialogue towards that MRF for playing
the announcement.
2\. An MRB is invoked to select an MRF fitting the characteristics demanded by
the service. The MRB should then contact directly the relevant MRF in the
VPLMN, inserting itself in the dialogue path between the AS and the MRF.
This becomes an alternative of the existing MRB in In-line mode in which the
MRB returns the MRF address to the AS which in turn initiates session towards
the S-CSCF and MRFC in the normal offer/answer model.
3\. In the absence of MRB, the AS will select relevant MRF in the VPLMN and
the normal offer/answer model will be used in the negotiation between the
AS/S-CSCF, in the HPLMN, and the MRFC in the VPLMN.
The discovery of the MRB/MRF in the VPLMN by the AS may be done by
configuration agreed between VPLMN and HPLMN or by provisioning at
registration or session establishment.
If the MRB is located in the HPLMN, it may be configured to have a list of the
MRFs in the VPLMN fitting the characteristics of the service demanded.
NOTE 1: Standardization of announcements across the interfaces is not
intended.
NOTE 2: Charging records are generated by the entities in both VPLMN and
HPLMN. Charging of services in the VPLMN will be a matter of agreements
between both operators.
Figure 5.1.2-1: Tones/Announcements insertion in VPLMN
1) A session initiation request is received at the S-CSCF (Call 1).
2) The session request is forwarded to an AS, based on the filter criteria.
3) The AS service logic determines to proceed with the call.
4) New session initiation request is sent towards destination, via the S-CSCF,
to establish a new leg (Call 2).
5) A failure is detected; call cannot proceed.
6) Session failure returned to the AS.
7) The AS service logic determines to play an announcement/tone to the calling
party.
8) The AS determines which MRB/MRF to address and depending on the presence of
MRB, its mode of operation or simply MRF, different flows exist.
9a) For MRB in In-line mode, the session initiation is sent to the MRB, which
in turn establishes the session towards the MRF. Sufficient information is
included to specify the details for the announcement/tone (Call 3).
9b) For MRB in Query mode, or for MRF either provisioned by VPLMN or
configured at HPLMN, the dialogue is established via the S-CSCF.
10-12) The MRF allocates the requested resource and indicates selected media.
The AS manages the dialog for Call 1 as normal, with the info provided by the
MRF. MRF plays the announcement as instructed.
### 5.1.3 Conferencing
Conferencing is realised by routing all the media via a focus (same as a
bridge in CS terms) so where the focus entity is based becomes irrelevant to
the UE; UE just need to be able to address the focus in order to route the
traffic to it.
There are, however, several cases with conferencing:
\- Ad-hoc conferencing.
\- Network based conferencing (AS/MRF hosted service).
Routing optimizations are mainly relevant to the cases in which the roaming
user is in charge of the conferencing control, e.g. creating, managing or
terminating a conference by means of a conference URI. Joining or leaving
network hosted conferences servers may observe different optimizations.
The figure below shows a sequence of a roaming user establishing a multiparty
call service. The Application Server, in control of the conference, operates
as B2BUA performing 3^rd^ party control towards the VPLMN-MRF by either:
\- interrogating an MRB (either in the VPLMN or HPLMN) to retrieve the VPLMN-
MRF address fitting the capabilities demanded by the conference, or
\- being already aware of the VPLMN-MRF capabilities (by VPLMN provisioning or
configuration at the HPLMN).
In order to optimize the routing and control of the conferencing resources,
the AS shall determine whether break-out can be performed in the VPLMN or in
HPLMN, after analyzing the availability of resources and the parties involved
in the call. i.e. at session initiation, AS receives the Ad-hoc conference
indication from the roaming UE, for the existing sessions with UE2 and UE3 (as
shown in the following figure), being able to determine, on a per operator
policy, whether the breakout shall take place in the VPLMN where user1 is
roaming, in the HPLMN, or in the PLMNs where user2 and user3 are camping.
In case the AS decides that breakout shall occur in a PLMN different than the
VPLMN1, it will not execute discovery of the VPLMN1 MRF; instead it shall:
\- either allocate an MRF belonging to the HPLMN network or,
\- execute MRF service discovery in the UE2 and/or UE3 PLMNs.
NOTE: OMR is required to optimize the media flows in these conferencing
scenarios, when other PLMN\'s are involved.
Figure 5.1.3-1: Conferencing with MRF in VPLMN
1) Session initiation received at S-CSCF from UE1 to start ad hoc conference
(Call 1) for existing sessions with UE2 and UE-3.
2) Session request forwarded to AS.
3) AS performs service logic starts ad hoc conference. The availability of
resources and the location of UE1, UE2 and UE3 is determined in order to
decide breakout in the VPLMN or HPLMN.
4) The AS determines which MRB/MRF to address and depending on the presence of
MRB, its mode of operation or simply MRF, different flows exist.
5a) For MRB in In-line mode, the session initiation is sent to the MRB, which
in turn establishes the session towards the MRF. Sufficient information is
included to specify the details for the announcement/tone (Call 2). If AS has
determined that break-out would occur at the VPLMN where UE1 resides, the MRF
addressed is also located in the VPLMN. Otherwise, the MRF addressed in these
steps is located in the HPLMN or in a VPLMN where UE2 and UE3 are located.
5b) For MRB in Query mode, or for MRF either provisioned by VPLMN or
configured at HPLMN, the dialogue is established via the S-CSCF (call 2).
If AS has determined that break-out will occur at the VPLMN where UE1 resides,
the MRF addressed is also located in the VPLMN. Otherwise, the MRF addressed
in these steps is located in the HPLMN or in a VPLMN where UE2 and UE3 are
located.
6-7) Establish dialog between AS and UE2 (Call 3).
8) Path established between MRF and UE2.
9) New session request towards MRF for UE3 (Call4); establish dialog with UE3
(Call 5) and path between MRF and UE3.
10-15) New session request sent to MRF for UE1 (Call 6); response returned to
the ad-hoc conference request (Call 1).
16) The session is established.
### 5.1.4 Transcoding at Network Edge
Although transcoding is done in the MRF in the existing specifications, a
clear optimization for roaming subscribers is to make use of the IBCF/TrGW
transcoding capabilities since they are ideally located at the edge of the NNI
for such purpose.
The usage of IBCF/TrGW for transcoding can be done based on static policies
and commercial agreements between the PLMN and HPLMN.
The following flow shows the reactive transcoding scenario depicted in TS
23.228 [4] where IBCF/TrGW performs the transcoding function after a failure
to establish a session due to lack of common codec. This usage is already
today provided upon agreement between IM CN subsystems.
Figure 5.1.4-1: Transcoding at Network Edge
1\. Roaming UE (A) initiates an IMS session towards User B, and the session is
analysed at the IBCF. The SDP offer is forwarded towards User B.
2\. A subsequent entity in the signalling path determines that it does not
support any codec in the SDP offer and answers with an appropriate error
response. This response may include a list of supported Codecs.
3\. Based on the response, the IBCF detects the need for reactive transcoding
invocation.
4\. The IBCF instructs the TrGW to allocate media processing resources for the
session, allocate appropriate transcoding resources for the session and bridge
the media flows between the calling and called party endpoints.
5\. Based on the response from the TrGW, the IBCF creates a new SDP offer that
contains the codec and transport address information received from the TrGW.
6\. UE (B) selects a codec and acknowledges the SDP offer with an SDP answer.
7\. Upon receipt of the SDP answer, the IBCF updates the TrGW with the
information from the SDP answer.
8\. The IBCF prepares an answer to the offer in step 1, including the selected
codec and transport address information for the originating side of the TrGW.
The session between the end-points is now established with the media flow
traversing the transcoding device.
At session release, the codec transcoding resource will be released.
### 5.1.5 Transcoding in IMS core network
#### 5.1.5.1 Proactive transcoding using MRF in visited network
This scenario shows how transcoding is performed using the MRF in the visited
network. The discovery of MRF in the visited network is as per MRF discovery
in clauses 5.2.1, 5.2.2 and 5.2.3. In this case, transcoding is performed
prior to sending the session establishment request to the called party. The
following information flow in figure 5.1.5.1-1 is an extension of the
requirements in TS 23.228 [4], clause 5.14.4 and Annex P.
Figure 5.1.5.1-1: Proactive transcoding using an MRF in the visited network
1) A calling party UE sends session establishment request to a called party
UE, including an SDP offer with media components, supported Codecs, IP address
and port number at which the UE wishes to receive media.
2) As a result of filter criteria evaluation, the request is forwarded to an
AS.
3) AS service logic determines to proceed with the call and may apply
originating services to the call.
4) The need for proactive transcoding invocation is detected by the AS. If the
SDP offer does not include any codec known to be supported by the called party
UE, then the AS is triggered to set up a SIP session with the MRFC, providing
Codecs and transport parameters to initiate a transcoding session.
5) The AS discovers an MRF in the visited network either through an pre-
configured MRF address for an MRF in the visited network which can be used for
transcoding purposes, or by querying an MRB, either in the visited network or
in the home network, which returns the address of an MRF in the visited
network which can be used for transcoding purposes. As an alternative, MRB in
In-line mode can initiate itself the request to the MRF, placing itself this
way in the session path between the AS and the MRF.
6) The AS instructs the MRFC to:
\- allocate media processing resources from an MRFP entity under the MRFC\'s
control, configured with the address and port at which the calling UE wishes
to receive media, using a codec (say, codec-A) previously included by the
calling party UE in the SDP offer and hence known to be supported;
\- allocate media processing resources from the same MRFP entity to the called
party UE, using a codec (say, codec-B) known to be supported by the called
party UE; and
\- cause the MRFP entity to bridge those two media flows, such that media
received on one will be converted to the format of and transmitted on the
other.
The MRFC accepts the transcoding request and contacts an MRFP to allocate the
requested resources. The MRFP responds with the IP address and port number
associated with each requested codec. The MRFC returns this information to the
AS.
7-8) The AS updates the SIP request received in step 2 by appending codec-B to
the list of Codecs in the SDP offer (after all Codecs that were previously in
the offer), and altering the transport address and port information to
indicate the addresses associated by the MRFP with its resources of type
codec-B. The session establishment request is then routed towards the called
party UE.
9-10) The called party UE acknowledges the SDP offer and makes a codec
selection, providing in the SDP answer the IP address and TCP or UDP port at
which it wants to receive media.
11) Upon receipt of the answer from the called party UE, the AS updates the
session with the MRFC (providing the codec selected and the address /port
information from the SDP answer). The MRFC processes the received information
to configure the transcoding unit with the codec, the destination address and
port towards the called party UE.
12-13) The AS modifies the SDP answer received from the called party UE such
that it refers to codec-A and the MRFP address and port number associated with
it in step 10, and sends this message to the calling party UE.
14) The session between the end points is now established with the media flow
traversing the transcoding device.
#### 5.1.5.2 Reactive transcoding using MRF in visited network
This scenario shows how reactive transcoding is performed using the MRF in the
visited network. The discovery of MRF in the visited network is as per MRF
discovery in clauses 5.2.1, 5.2.2 and 5.2.3. In this case, transcoding is
performed after receiving an error response from the called party indicating
that the Codecs offered in the session establishment request are not
supported. The following information flow in figure 5.1.5.2-1 is an extension
of the requirements in TS 23.228 [4], clause 5.14.4 and Annex P.
Figure 5.1.5.2-1: Proactive transcoding using an MRF in the visited network
1) A calling party UE sends session establishment request to a called party
UE, including an SDP offer with media components, supported Codecs, IP address
and port number at which the UE wishes to receive media.
2) As a result of filter criteria evaluation, the request is forwarded to an
AS
3) AS service logic determines to proceed with the call and may apply
originating services to the call. In this case proactive transcoding is not
executed since the need for transcoding may not yet be known.
4-5) The session establishment request is routed towards the called party UE.
6-7) The called party UE or a terminating network entity (such as MGCF)
determines that it does not support any codec in the SDP offer and answers
with an appropriate error response. This response can include a list of Codecs
that the called party UE can support.
8) The AS detects the codec mismatch as a result of receiving the error
response from the called party UE. AS service logic determines that
transcoding is necessary and proceeds to determine a suitable MRF to carry out
transuding for this session.
9) The AS discovers an MRF in the visited network either through an pre-
configured MRF address for an MRF in the visited network which can be used for
transcoding purposes, or by querying an MRB, either in the visited network or
in the home network, which returns the address of an MRF in the visited
network which can be used for transcoding purposes. As an alternative, MRB in
In-line mode can initiate itself the request to the MRF, placing itself this
way in the session path between the AS and the MRF.
10) The AS instructs the MRFC to:
\- allocate media processing resources from an MRFP entity under the MRFC\'s
control, configured with the address and port at which the calling UE wishes
to receive media, using a codec (say, codec-A) previously included by calling
party UE in the SDP offer hence known to be supported by calling UE;
\- allocate media processing resources from the same MRFP entity to called
party UE, using a codec (say, codec-B) known to be supported by called party
UE; and
\- cause the MRFP entity to bridge those two media flows, such that media
received on one will be converted to the format of and transmitted on the
other.
The MRFC accepts the transcoding request and contacts an MRFP to allocate the
requested resources. The MRFP responds with the IP address and port number
associated with each requested codec. The MRFC returns this information to the
AS.
11-12) Based on the information received from the MRFC, the AS creates a new
SDP offer that contains the information provided by the MRFC (codec and
transport addresses). If no information about supported Codecs was available
from the error response, the invoking function offers all Codecs supported by
the transcoding device. It sends this offer to the called party UE.
13-14) The called party UE acknowledges the SDP offer and makes a codec
selection, providing in the SDP answer the IP address and TCP or UDP port at
which it wants to receive media.
15) Upon receipt of the answer from the called party UE, the AS updates the
session with the MRFC (providing the codec selected and the address /port
information from the SDP answer). The MRFC processes the received information
to configure the transcoding unit with the codec, the destination address and
port towards the called party UE.
16-17) The AS modifies the SDP answer received from the called party UE such
that it refers to codec-A and the MRFP address and port number associated with
it in step 10, and sends this message to the calling party UE.
18) The session between the end points is now established with the media flow
traversing the transcoding device.
### 5.1.6 Transcoder placement alternative
In this alternative the session transcoding function is co-located with the
AGW in the VPLMN under control of the P-CSCF, using the same procedures
currently described for the IBCF in TS 23.228 [4].
Since transcoding is also a capability required of the ATGW for eSRVCC
scenarios, it is reasonable to consider use of the same transcoding element
for transcoding between mismatched UA Codecs as well as for eSRVCC.
The ATCF is generally expected to be co-located with an existing functional
element in the IMS architecture, such as the P-CSCF, IBCF or MSC server. The
most likely candidate for ATCF co-location is the P-CSCF, since it is already
in the path of all UE signalling with IMS. The IBCF is only in the path for a
session when the UE is roaming, and the MSC server is only involved in a
session during and after SRVCC. Thus the IBCF and MSC server are less
attractive candidates for co-location with the ATCF.
### 5.1.7 IBCF interactions
#### 5.1.7.1 General
The signalling between an AS and an MRF located in a VPLMN can traverse two
IBCFs at the network borders. The following clauses describes some
implications of invoking IBCFs on the signalling path between AS and remote
MRF.
#### 5.1.7.2 Impact on IMS NNI
Signalling associated with the Cr, Mr and Mr\' reference points for
interaction with the MRF are not currently within the scope of the IMS NNI and
related impacts shall be studied and addressed by stage 3 work.
#### 5.1.7.3 Optimal Media Routing
In the typical case, an IBCF handling MRF signalling between networks will
allocate a TrGW for bearer isolation unless it supports Optimal Media Routing
(OMR) to avoid any unnecessary anchoring of the media.
Figure 5.1.7.3-1 shows an example of the impact of OMR when an AS controls a
remote MRF in the VPLMN.
NOTE: Intermediate IPX networks and IPX proxies can be inserted in the paths
between the PLMNs but are not shown in the figure and do not change the flow.
Figure 5.1.7.3-1: Impact of OMR on media routing with remote MRF
### 5.1.8 Optimal MRF placement for RAVEL scenarios
The Study on Roaming Architecture for Voice over IMS with Local Breakout
(RAVEL) TR 23.850 [6] describes options for the home routing scenario and
loopback.
In the RAVEL home routing scenario, the signalling and media both flow to the
HPLMN. In this scenario, there is little point in forcing placement of a media
resource under AS control within the VPLMN, ostensibly to create a more
efficient media path, when the media flows through the HPLMN anyway. Leaving
the MRF in the HPLMN has the added advantage of simplifying the MRF signalling
flow (which no longer needs to flow between the HPLMN and VPLMN), while having
no detrimental effect on the efficiency of the media path.
The HPLMN is in general the appropriate network since the media and signalling
both flow to the HPLMN. However there may be some scenarios where the
resources can be allocated in the VPLMN, or other network. This is subject to
local policies.
The usage of OSCAR optimizes the resource allocation in the VPLMN for the
services studied in this report. RAVEL home routing/loopback scenarios may
benefit from this optimization and considerations on that will be recorded as
part of RAVEL conclusions.
## 5.2 Solution Alternatives for MRF/MRB discovery
### 5.2.1 MRF/MRB Selection at Registration
This option allows the MRF/MRB address to be provided to the home network from
the visited network for a specific subscriber during the time of Registration.
This option requires that the AS that may invoke the MRF/MRB receives 3-party
register events from the S-CSCF.
Figure 5.2.1-1: MRF/MRB Selection at Registration
1\. UE registers to the visited network.
2\. P-CSCF in visited network has a set of MRF addresses or MRB address
allocated to it that can be used for the roaming users. P-CSCF adds the
address to the Register request before forwarding the Register request to the
S‑CSCF in the home network.
3\. The S-CSCF includes the provided address in the 3-party register to the
AS.
### 5.2.2 MRF/MRB Selection at Session initiation
This option allows the MRF/MRB address to be provided to the home network from
the visited network for a specific subscriber when the user originates a call.
This option cannot be used for terminating calls, but only originating calls.
Figure 5.2.2-1: MRF/MRB Selection at Session initiation
1\. UE initiates the session.
2\. P-CSCF in visited network has a set of MRF addresses or MRB address
allocated to it that can be used for the roaming users. P-CSCF adds the
selected address to the Session initiation request before forwarding the
request to the S-CSCF in the home network.
3\. The S-CSCF forwards the message to the AS.
4\. The AS uses the MRF or MRB address to invoke the MRF (according to
procedures of previous clauses).
### 5.2.3 AS is configured with VPLMN MRF address
In the case where an MRB is not used to determine which MRF is to be used for
media resources located in the VPLMN, the AS serving the roaming user shall be
provisioned with the address of one or more MRFs located in the VPLMN as per
operator policy and roaming agreements.
Upon receiving a request from a served user, that requires invocation of media
resources, the AS first checks if the user is roaming and in which VPLMN the
UE is currently located. The AS the selects the most appropriate MRF address
from the available MRFs it is aware of. The AS sends a request to the selected
MRF to initiate media resource reservation and to retrieve MRF capabilities,
Codecs and port numbers for the requested media resources.
### 5.2.4 AS uses MRB in Query Mode
In the case where the AS serving the roaming user consults an MRB in Query
Mode, the MRB may be located in the home network or in the visited network. In
the case where the MRB is in the VPLMN, the AS is provisioned with the address
of the MRB in the VPLMN as per operator policy and roaming agreements, or it
may become aware of the MRB address at registration or session initiation
(according to clauses 5.2.1 and 5.2.2). The query is sent over an inter-
operator Rc Interface.
The AS may include in the query information about the media resources
required, including the network domain in which the served user is roaming.
The MRB returns the address of an appropriate MRF, to which the AS sends a
request to initiate media resource reservation and to retrieve MRF
capabilities, Codecs and port numbers for the requested media resources.
In case the MRB is located in the HPLMN, no major impact is expected in the
existing procedures; however, the MRB at the HPLMN needs to know the complete
topology of resources in the VPLMN for each service invoked.
In case the MRB is located in the VPLMN, the topology of the VPLMN is hidden
and the HPLMN just needs to know the address of the MRB in the VPLMN. No major
impacts foreseen for the actual resource allocation during traffic, except for
securing the Cr/Mr\'/Mr interface crossing inter-operator domain.
### 5.2.5 AS uses MRB in In-Line Mode
In the case where the AS serving the roaming user sends a request to invoke
media resources, an MRB operating in In-Line Mode may be located in the home
network or in the visited network. In the case where the MRB is in the VPLMN,
the AS is provisioned with the address of the MRB in the VPLMN as per operator
policy and roaming agreements, or it may become aware of the MRB address at
registration or session initiation (according to clauses 5.2.1 and 5.2.2). The
query is sent over an In-Line inter-operator Rc Interface, carrying
information about requested media resources.
The MRB may receive such a request and based upon the information provided in
the received request, decide upon which MRF to forward the request towards. .
The AS may include in the request information about the media resources
required, including the network domain in which the served user is roaming.
Upon determining that an MRF in the visited network is available to provide
media resources for the roaming user, the request is sent to the selected MRF
to initiate media resource reservation and to retrieve MRF capabilities,
Codecs and port numbers for the requested media resources.
The usage of MRB in In-Line Mode is described in TS 23.218 [3].
NOTE: Relevant security requirements will be addressed in the stage 3 phase of
Rc and, Mr\' if these are inter-operator interfaces. Mr is already an inter-
operator interface.
**MRB in the HPLMN:**
In case the MRB is located in the HPLMN, no major impact is expected in the
existing procedures; however, the MRB at the HPLMN needs to know the complete
topology of resources in the VPLMN for each service invoked. No additional
security would be needed for securing the Mr interface, as it has been an
inter-operator interface since Rel5.
**MRB in the VPLMN:**
In case the MRB in In-Line mode is located in the VPLMN, the topology of the
VPLMN is hidden and the HPLMN just needs to know the address of the MRB in the
VPLMN.
Figure 5.2.5-1: Inter-operator traffic when MRB in In-Line mode is located in
VPLMN
Referring to Figure 5.2.5-1, the following interfaces are considered to be
inter-operator interfaces under the following conditions:
1\. The interface between AS and MRB traverses network boundaries if MRB is
located in the visited network. This is applicable for both MRB Query Mode and
MRB In-Line Mode.
2\. The interface between AS and visited network MRFC traverses network
boundaries. In such configuration, it is assumed that AS has prior knowledge
of visited network MRFC address that can service the request for media
resources. This can be through configuration, at session
registration/initiation or through interacting with an MRB in query mode.
3\. The interface between S-CSCF and visited network MRFC traverses network
boundaries. In such configuration, it is assumed that AS has prior knowledge
of visited network MRFC address that can service the request for media
resources. This can be through configuration, at session
registration/initiation or through interacting with an MRB in query mode. The
S-CSCF proxies such requests for invoking media resources from the AS to the
visited network MRFC.
4\. If the MRB is located in the home network, then the interface between the
MRB and visited network MRFC traverses network boundaries. This assumes the
MRB in the HPLMN has knowledge of the resource network topology of the VPLMN.
NOTE 1: Mr interface has been an inter-operator interface since Release 5.
NOTE 2: For the case that MRB in located in the visited network and is
deployed in In-Line Mode, the most efficient configuration to contact the
desired MRFC in the visited network is via Mr\' interface between MRB and
MRFC, instead of traversing back to the home network to route signalling via
the S-CSCF over Mr interface to the MRFC.
# 6 Assessment
The current study has investigated two areas regarding the allocation of
resources in the VPLMN for IMS services:
\- VPLMN MRB/MRF discovery, where three different alternatives have been
discussed, and
\- MRB placement in the HPLMN or VPLMN.
Assessing the feasibility of the different alternatives for discovery, will
imply making an analysis of whether each alternative facilitates the
fulfilment of the architectural requirements for each of the IMS services.
That is depicted in the chart below.
In addition, placement of MRB in the HPLMN or VPLMN shall be assessed with
regards to the same fulfilment of requirements and is included in the chart as
well.
Other alternatives might also be considered in subsequent stage 2 work.
Table 6-1: Assessment
+----------+----------+----------+----------+----------+----------+ | | Avoids | Minimal | Can be | VPLMN | VPLMN | | | routing | impact | invoked | can deny | can | | | the IMS | on the | sel | all or a | \"hide\" | | | media | existing | ectively | sub-set | its | | | plane | IMS | by the | of the | detailed | | | via the | arch | VPLMN | IMS | internal | | | HPLMN | itecture | | f | arch | | | | and | | unctions | itecture | | | | reuses | | to all | | | | | or | | or a | | | | | enhances | | defined | | | | | existing | | sub-set | | | | | in | | of | | | | | terfaces | | sub | | | | | | | scribers | | +----------+----------+----------+----------+----------+----------+ | a) | Yes, | No | Pa | Yes. | Yes. It | | MRF/MRB | with the | impact | rtially, | Res | selects | | se | res | on | since | triction | app | | lection: | triction | pro | s | may be | ropriate | | MRF/MRB | placed | cedures. | election | enabled | MRB/MRF | | S | by RAVEL | | of | based on | | | election | home | No major | MRB/MRF | e.g. | | | at | routing | impacts | may be | network | | | Regi | s | on | only | c | | | stration | cenario. | resource | done on | ondition | | | | | al | a per | | | | | | location | su | | | | | | during | bscriber | | | | | | traffic, | basis | | | | | | except | | | | | | | for | | | | | | | securing | | | | | | | the | | | | | | | Cr | | | | | | | /Mr\'/Mr | | | | | | | i | | | | | | | nterface | | | | | | | crossing | | | | | | | inter- | | | | | | | operator | | | | | | | domain | | | | +----------+----------+----------+----------+----------+----------+ | b) | Yes, | No | Yes, | Yes. | Yes. It | | MRF/MRB | with the | impact | since | Res | selects | | se | res | on | s | triction | app | | lection: | triction | pro | election | may be | ropriate | | MRF/MRB | placed | cedures. | of | enabled | MRB/MRF | | S | by RAVEL | | MRB/MRF | based on | | | election | home | No major | is done | e.g. | | | at | routing | impacts | on a per | network | | | Session | s | on | su | c | | | in | cenario. | resource | bscriber | ondition | | | itiation | | al | and | | | | | | location | service | | | | | | during | basis | | | | | | traffic, | (see | | | | | | except | NOTE) | | | | | | for | | | | | | | securing | | | | | | | the | | | | | | | Cr | | | | | | | /Mr\'/Mr | | | | | | | i | | | | | | | nterface | | | | | | | crossing | | | | | | | inter- | | | | | | | operator | | | | | | | domain | | | | +----------+----------+----------+----------+----------+----------+ | c) | Yes, | No | No. All | VPLMN | No, the | | Al | with the | impact | sub | can only | AS in | | location | res | on | scribers | deny | the | | of MRF | triction | pro | would be | al | HPLMN | | in | placed | cedures. | a | location | would | | VPLMN: | by RAVEL | | llocated | of | need to | | AS is | home | No major | the same | r | know the | | co | routing | impacts | MRB/MRF | esources | complete | | nfigured | s | on | and all | after | topology | | with | cenario. | resource | d | request | of the | | VPLMN | | al | ecisions | from | VPLMN\'s | | MRB/MRF | | location | on | HPLMN | r | | address | | during | service | | esources | | | | traffic, | in | | on a per | | | | except | vocation | | service | | | | for | would be | | basis. | | | | securing | taken by | | | | | | the | HPLMN. | | | | | | Cr | | | | | | | /Mr\'/Mr | | | | | | | i | | | | | | | nterface | | | | | | | crossing | | | | | | | inter- | | | | | | | operator | | | | | | | domain | | | | +----------+----------+----------+----------+----------+----------+ | d) MRB | Yes, | No | No. All | VPLMN | No, MRB | | located | with the | impact | sub | can only | in HPLMN | | in HPLMN | res | for the | scribers | deny | would | | | triction | case of | would be | r | need to | | | placed | MRB | a | esources | know the | | | by RAVEL | playing | llocated | when | complete | | | home | in Query | the same | being | topology | | | routing | mode. | MRB and | queried | of the | | | s | | relevant | by HPLMN | VPLMN\'s | | | cenario. | For | MRF | (prov | r | | | | existing | would be | isioning | esources | | | | In-line | simply | of | on a per | | | | mode, no | selected | MRB/MRF | service | | | | impact | based on | address | basis. | | | | on | service | from the | | | | | pr | in | VPLMN is | | | | | ocedures | vocation | not | | | | | or | decision | app | | | | | al | taken by | licable) | | | | | location | HPLMN. | | | | | | of | | | | | | | r | | | | | | | esources | | | | | | | during | | | | | | | traffic. | | | | | | | In the | | | | | | | new | | | | | | | alt | | | | | | | ernative | | | | | | | for | | | | | | | In-line | | | | | | | mode, | | | | | | | proposed | | | | | | | i | | | | | | | nterface | | | | | | | between | | | | | | | MRB and | | | | | | | MRFC | | | | | | | will | | | | | | | need to | | | | | | | be | | | | | | | secured. | | | | +----------+----------+----------+----------+----------+----------+ | e) MRB | Yes, | For the | P | Yes. | Yes. It | | located | with the | case of | artially | Res | selects | | in VPLMN | res | MRB | if MRB | triction | app | | | triction | playing | address | may be | ropriate | | | placed | in Query | is | enabled | MRB/MRF | | | by RAVEL | mode. No | s | based on | | | | home | impact | ignalled | e.g. | | | | routing | on | during | network | | | | s | pr | regis | c | | | | cenario. | ocedures | tration. | ondition | | | | | beyond | | if MRB | | | | | securing | Yes, if | address | | | | | the Rc | MRB | s | | | | | in | address | ignalled | | | | | terface. | is | from the | | | | | | s | VPLMN. | | | | | For | ignalled | | | | | | existing | during | If MRB | | | | | In-line | session | address | | | | | mode, no | setup | is | | | | | impact | (see | co | | | | | on | NOTE). | nfigured | | | | | al | | in the | | | | | location | No, if | AS, | | | | | of | MRB | VPLMN | | | | | r | address | can only | | | | | esources | is | deny | | | | | during | co | al | | | | | traffic | nfigured | location | | | | | but | in the | of | | | | | expected | HPLMN-AS | r | | | | | major | | esources | | | | | si | | after | | | | | gnalling | | request | | | | | crossing | | from | | | | | inter | | HPLMN | | | | | operator | | | | | | | bo | | | | | | | undaries | | | | | | | (due to | | | | | | | S-CSCF | | | | | | | in the | | | | | | | path | | | | | | | between | | | | | | | MRB and | | | | | | | MRFC). | | | | | | | Such | | | | | | | si | | | | | | | gnalling | | | | | | | would | | | | | | | need | | | | | | | ad | | | | | | | ditional | | | | | | | s | | | | | | | ecurity. | | | | | | | | | | | | | | In the | | | | | | | new | | | | | | | alt | | | | | | | ernative | | | | | | | for | | | | | | | In-line | | | | | | | mode, No | | | | | | | impact | | | | | | | on | | | | | | | pr | | | | | | | ocedures | | | | | | | beyond | | | | | | | securing | | | | | | | the Rc | | | | | | | i | | | | | | | nterface | | | | | | | and | | | | | | | de | | | | | | | veloping | | | | | | | the new | | | | | | | Mr\' | | | | | | | between | | | | | | | MRB and | | | | | | | MRFC. | | | | +----------+----------+----------+----------+----------+----------+ | NOTE: | | | | | | | The | | | | | | | prov | | | | | | | isioning | | | | | | | of | | | | | | | MRB/MRF | | | | | | | address | | | | | | | during | | | | | | | session | | | | | | | in | | | | | | | itiation | | | | | | | can be | | | | | | | done on | | | | | | | a per | | | | | | | IMS | | | | | | | service | | | | | | | basis, | | | | | | | without | | | | | | | anti | | | | | | | cipating | | | | | | | whether | | | | | | | ton | | | | | | | es/annou | | | | | | | ncements | | | | | | | or | | | | | | | conf | | | | | | | erencing | | | | | | | are to | | | | | | | be | | | | | | | invoked. | | | | | | | For that | | | | | | | reason, | | | | | | | this | | | | | | | req | | | | | | | uirement | | | | | | | is | | | | | | | f | | | | | | | ulfilled | | | | | | | as long | | | | | | | as the | | | | | | | VPLMN | | | | | | | can | | | | | | | signal | | | | | | | the MRB | | | | | | | address | | | | | | | or list | | | | | | | of MRF | | | | | | | a | | | | | | | ddresses | | | | | | | that can | | | | | | | support | | | | | | | p | | | | | | | otential | | | | | | | ton | | | | | | | es/annou | | | | | | | ncements | | | | | | | or | | | | | | | conf | | | | | | | erencing | | | | | | | services | | | | | | | being | | | | | | | invoked | | | | | | | during | | | | | | | m | | | | | | | id-call. | | | | | | | If the | | | | | | | MRF | | | | | | | a | | | | | | | nnounced | | | | | | | at | | | | | | | ini | | | | | | | tiation, | | | | | | | does not | | | | | | | match | | | | | | | the | | | | | | | criteria | | | | | | | for the | | | | | | | service | | | | | | | being | | | | | | | invoked | | | | | | | at | | | | | | | m | | | | | | | id-call, | | | | | | | a | | | | | | | red | | | | | | | iscovery | | | | | | | p | | | | | | | rocedure | | | | | | | may need | | | | | | | to be | | | | | | | invoked. | | | | | | +----------+----------+----------+----------+----------+----------+
# 7 Conclusion
As observed from the different chapters in this document, the functionality
missing to be able to allocate resources in the visited network are:
\- MRB/MRF discovery, and
\- Direct interface between an MRB and MRFC, when MRB is in In-line mode.
MRB/MRF discovery must be achieved without the visited network needing to
reveal the topology of its resources in its network, i.e. the actual
allocation and/or denial of resources is decided by the visited network as per
its own subscribers and simply announced to the home network in case there is
a need or advantage to execute a breakout for optimal routing.
The actual decision on break-out is taken by the home network and based also
on agreements between home and visited networks. However, the most restrictive
condition is imposed by the lack of resources in the VPLMN. Relation exists
with the work being developed in RAVEL (TR 23.850 [6]) and conclusion on that
is depicted below.
The alternative described in clause 5.2.5 for MRB-to-MRFC interface, when MRB
is placed in In-line mode is being specified in the normative phase in CT WG1,
as well as the security requirements implied by such alternatives, for each of
the services concluded below.
For some services, additionally, there is no need to allocate any additional
resource in order to execute local breakout, i.e. transcoding at the edge. As
opposed to that, any service that might demand allocation of MRF for
transcoding in the visited network, requires missing alternatives for MRB/MRF
placement in the VPLMN to be depicted. These alternatives are assumed to be
studied by CT WG1 but are not considered optimal from allocation of resources
and signalling points of view in case of transcoding.
The following list details the main impacts derived from this study.
1\. Transcoding
> No impact at all is foreseen for transcoding at the edge, based on P-CSCF or
> IBCF/TrGW functionality, and thus those are optimal options from impacts and
> reusability points of view. This is in addition widely deployed solution on
> a per inter-operator agreement.
>
> This study does not recommend allocating MRF/MRB in the VPLMN to control
> transcoding options, due to complexity in resources allocation and
> signalling exchange. However, further releases might consider that option as
> a potential alternative after mode of MRB operation and placement of MRF in
> VPLMN has concluded all alternatives.
2\. Tones/announcements
> Even if announcement/tone insertion are not that commonly used for calls
> once those have commenced, it would be beneficial to harmonize the way the
> MRB/MRF is discovered in all cases. The following conclusions are agreed as
> the basis for normative work:
a) MRB/MRF discovery for OSCAR scenarios may be based on information provided
from the visited network to the home network at registration or session
establishment (as in clauses 5.2.1 and 5.2.2). The home network can, based on
local policy, take this information into account when invoking the MRB or MRF.
Other mechanisms for discovery might exist, and non-OSCAR use cases might
require other discovery mechanisms. It is left to CT WG1 to investigate
additional discovery mechanisms, as required.
> While the AS is described in this TR as the home network entity that
> discovers MRB or MRF, the decision regarding which entity does this is left
> for CT WG1 to determine.
>
> NOTE: Use of information provided at registration or session establishment
> might not provide optimal resource management in deployment scenarios where
> multiple alternative MRFs are available, since the resource availability may
> change by the time of resource allocation.
b) For MRB placement and mode of operation, both In-line mode and Query mode
shall be addressed for MRB located in the VPLMN. This study shall be conducted
by CT WG1 as part of interoperator scenarios in the current WID for Media
Resource Broker (C1-113712).
> Any additional security requirement for MRB and MRF interfaces shall be
> addressed in that work.
>
> Additionally, any impact on the NNI profile due to placement of MRF
> resources in the VPLMN shall be addressed by CT WG3 working group.
3\. Conferencing
> In the conferencing case, routing optimizations are mainly achieved for the
> cases in which the roaming user is in charge of the control, management and
> termination of the conferencing.
a) MRB/MRF discovery for conferencing scenarios may be based on information
provided from the visited network to the home network at registration or
session establishment (as in clauses 5.2.1 and 5.2.2). The home network can,
based on local policy, take this information into account when invoking the
MRB or MRF. Other mechanisms for discovery might exist, and non-OSCAR use
cases might require other discovery mechanisms. It is left to CT WG1 to
investigate additional discovery mechanisms, as required.
> While the AS is described in this TR as the home network entity that
> discovers MRB or MRF, the decision regarding which entity does this is left
> for CT WG1 to determine.
>
> NOTE: Use of information provided at registration or session establishment
> might not provide optimal resource management in deployment scenarios where
> multiple alternative MRFs are available, since the resource availability may
> change by the time of resource allocation.
b) For Conferencing service, both In-line mode and Query mode shall be
addressed for MRB located in the VPLMN. This study shall be conducted by CT
WG1 as part of interoperator scenarios in the current WID for Media Resource
Broker (C1-113712).
> Any additional security requirement for MRB and MRF interfaces shall be
> addressed in that work.
>
> Additionally, any impact on the NNI profile due to placement of MRF
> resources in the VPLMN shall be addressed by CT WG3 working group.
>
> According to clause 5.1.3, the AS may decide to select an MRF for
> conferencing in a different network that the visited or the home. This
> decision may be based on policies or on determining the location of the
> users involved in the conferencing session. However, such scenario is not in
> the scope of OSCAR improvements and thus shall be addressed separately, and
> if CT WG1 determines so, from OSCAR work.
4\. RAVEL dependencies
> The home network is in general the appropriate network since the media and
> signalling both flow to the home. However there may be some scenarios where
> the resources can be allocated in the visited or other network. This is
> subject to local policies.
>
> The usage of OSCAR optimizes the resource allocation in the VPLMN for the
> services studied in this report and RAVEL loopback scenarios may benefit
> from this optimization.
#
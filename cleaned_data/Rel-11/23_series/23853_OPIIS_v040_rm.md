# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
Editor\'s note: this clause is optional; will be removed if deemed
unnecessary.
# 1 Scope
This Technical Report describes solutions that define:
  * operator policies for selecting an IP interface in the UE for > routing of IP flows among a choice of available interfaces in both > 3GPP and non-3GPP accesses;
  * system architecture for distribution of these policies to the UE.
Editor\'s note: The working assumption is that the Rel-10 ANDSF architecture
is used for distribution of the operator policies defined in this TR.
Editor's note: The wording in the first bullet needs to be re-visited after
discussion on use case scenarios.
The solutions described in this TR shall clarify how the operator policies
defined in this TR relate with the Rel-10 ANDSF policies.
The report is intended to document the analysis of the architectural aspects
to achieve these objectives in order to select a solution and include it in
the relevant technical specifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\"
[2] RFC3442 The Classless Static Route Option for Dynamic Host Configuration
Protocol (DHCP) version 4
[3] RFC4191 Default Router Preferences and More-Specific Routes
[4] draft-ietf-mif-dhcpv6-route-option, DHCPv6 Route Option
[5] draft-ietf-mif-dns-server-selection, Improved DNS Server Selection for
Multi-Homed Nodes
[6] draft-ietf-6man-addr-select-opt, Distributing Address Selection Policy
using DHCPv6
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Requirements
## 4.1 Scenarios
### 4.1.1 Scenario #1: Multiple PDN connections
In this scenario the user has two established PDN connections:
  * connection PDN1 associated with APN1, used for access to the IMS core network;
  * connection PDN2 associated with APN2, used for access to the Internet.
{width="6.165277777777778in" height="4.75in"}
Figure 4.1.1-1: Multiple PDN connections
For traffic flows generated by applications that are not bound to an APN, the
UE relies on operator policies defined in this TR to decide on which PDN
connection to route the IP flows.
### 4.1.2 Scenario #2: Multiple PDN connections from a CSG cell
This scenario begins with the user outside of his home with an established PDN
connection (PDN1) that is used for all traffic flows (e.g. IMS, Internet,
etc). The PDN connection PDN1 is associated with APN1.
When the user returns home, a second PDN connection (PDN2) is established with
a local gateway (LGW). The PDN connection PDN2 is associated with APN2.
{width="6.6930555555555555in" height="3.7284722222222224in"}
Figure 4.1.2-1: Multiple PDN connections from a CSG cell
From this point on, some Internet-bound flows can be routed via PDN2, pending
user's consent. The UE relies on operator policies defined in this TR for
identifying the candidate Internet-bound flows that can be routed via PDN2.
NOTE: Based on UE implementation the UE may decide to re-route any _active_ IP
flows (i.e. flows that were established while the user was outside the home)
via PDN2, in which case IP address preservation is not provided.
When the user leaves the home again, the PDN2 connection is released. The UE
relies on operator policies defined in this TR for identifying the candidate
Internet-bound flows that can be routed via PDN1 again.
### 4.1.3 Scenario #3: Multiple PDN connections and non-seamless WLAN offload
This scenario begins with the user outside of his home with an established PDN
connection (PDN1) that is used for all traffic (e.g. IMS, Internet, etc). The
PDN connection PDN1 is associated with APN1.
When the user returns home, a second PDN connection (PDN2) is established with
a local gateway (LGW). The PDN connection PDN2 is associated with APN2. In
addition, the UE's capability for non-seamless WLAN offload is enabled.
{width="6.688194444444444in" height="3.816666666666667in"}
Figure 4.1.3-1: Multiple PDN connections and non-seamless WLAN offload
From this point on, some Internet-bound flows can be routed either via PDN2
(pending user's consent) or via non-seamless WLAN offload. The UE relies on
operator policies for identifying the candidate Internet-bound flows that can
be routed via PDN2 or via non-seamless WLAN offload.
NOTE: Based on implementation the UE may decide to re-route any _active_ IP
flows (i.e. flows that were established while the user was outside the home)
via PDN2 or via non-seamless WLAN offload, in which case IP address
preservation is not provided.
When the user leaves the home again, the PDN2 connection is released and the
WLAN coverage is not available. The UE relies on operator policies defined in
this TR for identifying the candidate Internet-bound flows that can be routed
via PDN1 again.
## 4.2 Architectural requirements
Based on the scenarios described in the previous clause, the following
requirements are made:
\- The solution for IP interface selection should minimize the conflict with
the Inter-System Routing Policies (ISRPs) specified in Rel-10.
\- The solution shall allow the UE to override the rules for OPIIS for traffic
that is explicitly bound to a local IP address of the UE and/or an APN, or due
to user preferences.
\- For UEs capable of operating multiple PDN connections simultaneously the
EPS shall allow the operator to provide policies that assist the UE in
selecting a specific APN for routing a specific IP flow. The operator policies
may also indicate which APNs are restricted for a specific IP flow.
\- For UEs capable of operating multiple PDN connections simultaneously and
also capable of non-seamless WLAN offload, the EPS shall allow the operator to
provide policies that assist the UE in deciding whether a specific IP flow
should be routed on a specific APN. The operator policies may also indicate
which APNs are restricted for a specific IP flow.
Editor\'s note: It is FFS whether non-seamless WLAN offload can have any
relative priority over APNs associated with PDN connections.
Editor\'s note: The interaction with Rel-10 ISRPs is FFS.
# 5 Solutions
## 5.1 Solution 1: Inter-APN Routing Policies
### 5.1.1 Description
To support policy-based IP interface selection based on the scenarios in
section 4, a new set of routing policies is introduced called Inter-APN
Routing Policies (IARP).
Figure 5.1.1-1 below shows the scope of IARP applicability and how IARP
policies can be applied in conjunction with ISRP for NS-WLAN offload policies.
Figure 5.1.1-1: Applicability of Inter-APN Routing Policies
NOTE 1: The above figure aims at showing only the relationship between the
ISRP for NSWLAN and the Inter-APN routing policies. For routing uplink traffic
the UE may take into account other parameters (e.g. the local operating
environment information) which are not shown in the figure for simplicity.
Editor's Note: Figure 5.1.1-1 assumes that the policies for non-seamless WLAN
offload are evaluated by the UE before the evaluation of Inter-APN Routing
Policies. It is FFS is this order of policy evaluation is necessary or if any
possible order could be supported. It is FFS how this solution can enable
scenarios where WLAN is not the default interface.
The Inter-APN Routing Policies (IARP) can be statically configured in the UE
or they could be provisioned by the ANDSF. A UE that is inter-APN capable can
use IARP to select an outgoing interface based on the preferred APN in IARP
policies. A UE is defined to be inter-APN capable if it is capable of routing
IP flows across multiple simultaneously active interfaces, each one associated
with a different APN. These interfaces may be linked to different access
networks or linked with the same access network.
The following assumptions and specifications apply:
\- Every IP interface that can be selected with IARP is associated with a
different APN.
\- IP interfaces not associated with an APN are considered outside the scope
of IARP. Such interfaces could include e.g. an IP interface to a tethering
device connected to UE over USB, or an IP interface corresponding to an
enterprise VPN connection over WLAN, etc.
\- The scenario where multiple IP interfaces are associated with the same APN
is also considered outside the scope of IARP.
\- The ANDSF may provide a list of inter-APN Routing Policies to UE. A UE that
is inter-APN routing capable uses these policies to select an existing IP
interface to route IP flows that match specific criteria (e.g. all flows to a
specific TCP port or to a specific destination address, etc).
\- Each inter-APN routing policy includes the following information:
\- Validity conditions, i.e. conditions indicating when the provided policy is
valid.
\- One or more Filter Rules, each one identifying a prioritised list of APNs
which should be used by the UE to route IP flows that match specific IP
filters. A filter rule also identifies which APNs are restricted for IP flows
that match specific IP filters.
\- An Inter-APN routing capable UE selects an existing IP interface, which is
associated with a specific APN, to route IP flows based on the received /
provisioned inter-APN routing policies and user preferences.
### 5.1.2 Impact on existing nodes or functionality
The relationship between IARP and ISRP policies (excluding MAPCON policies for
simplicity) is schematically shown in Figure 5.1.1-1 above.
## 5.2 Solution 2: Extension of existing ISRPs with addition of Filter Rules
for Inter-APN Routing
### 5.2.1 Description
This solution assumes that the Rel-11 ISRP rule is enhanced by defining new
Filter Rules (a.k.a. _flow distribution rules_ in Stage 3 terminology) for
Inter-APN Routing. Therefore the UE uses the ISRP when it can route IP traffic
simultaneously over multiple radio access interfaces.
The Filter Rules for Inter-APN Routing are defined at the same hierarchical
level as the existing Filter Rules for IFOM, MAPCON and Non-seamless WLAN
offload, as illustrated in Figure 5.X.1-1. The rule evaluation is performed
with the APNs which are available. The Filter Rules for IFOM, MAPCON, non-
seamless WLAN offload and Inter-APN Routing are associated with a rule
priority. If more than one valid Filter Rules match a specific IP traffic
flow, the UE applies the Filter Rule with the highest rule priority.
Each inter-APN routing policy includes the following information:
  * Validity conditions, i.e. conditions indicating when the provided policy is valid.
  * One or more Filter Rules, each one identifying a prioritised list of APNs which shall be used by the UE when PDN connections to these APNs are available to route IP flows that match specific IP filters. This Filter Rule may also identify which APNs are restricted for IP flows that match specific IP filters.
Figure 5.2.1-1: Hierarchical location of Filter Rules for Inter-APN Routing
(simplified and illustrative)
NOTE 1: The figure above aims at showing the hierarchical location of Inter-
APN Routing rules compared with the existing Filter Rules for IFOM, MAPCON and
Non-seamless WLAN offload, and is purely illustrative. It is left to Stage 3
to define the exact realisation of the new Filter Rule in the OMA DM
management object.
### 5.2.2 Impact on existing nodes or functionality
New Filter Rules for Inter-APN Routing are included in ISRPs. The introduction
of new Filter Rules for Inter-APN Routing may require a two-round evaluation
of ISRP rules in the terminal. Namely, if the UE selects a Filter Rule for
Inter-APN Routing during the initial iteration and if the UE is IFOM- or
MAPCON-capable, the UE needs to go through a second iteration of ISRP rule
evaluation. During the second iteration the Filter Rules for Inter-APN Routing
and for Non-seamless WLAN offload are not active.
# 6 Other considerations
Editor\'s note: this clause is a placeholder for any special considerations
(e.g. scenarios where multiple PDN connections carry traffic with overlapping
private IPv4 addresses, DIDA).
## 6.1 Potential Implications of Co-existence of OPIIS and IETF mechanisms
The purpose of this section is to provide examples of IETF mechanisms that may
have to be considered for the co-existence with OPIIS.
**Some of the IETF mechanisms considered are** RFC3442 The Classless Static
Route Option for Dynamic Host Configuration Protocol (DHCP) version 4 [2],
RFC4191 Default Router Preferences and More-Specific Routes [3], draft-ietf-
mif-dhcpv6-route-option, DHCPv6 Route Option [4], draft-ietf-mif-dns-server-
selection, Improved DNS Server Selection for Multi-Homed Nodes [5], draft-
ietf-6man-addr-select-opt, Distributing Address Selection Policy using DHCPv6
[6].
The following example of potential need for co-existence implications is based
on IPv6 and on the split UE scenario, where the TE is represented by a laptop
or any other off-the-shelf wireless device other than a 3GPP Mobile phone. In
general the co-existence may be relevant not only to the split UE scenario but
also to the scenario with a monolithic UE.
This example illustrates a case where a TE is connected to the Internet
directly via local access, such as WLAN (i.e., non-seamless offloading), and
via a cellular network as provided by a MT. In this scenario, ANDSF may be
used to configure the MT, but not the TE. On the other hand, the PGW could
utilize IETF mechanisms to "configure" TE's routing table to influence its
routing decisions.
{width="6.254166666666666in" height="3.3305555555555557in"}
Figure 6.1.-1: Split UE scenario using IETF mechanisms to configure the TE
NOTE 1: The co-existence case with IETF mechanisms described above also
applies to Rel-10 inter-system routing policies for non-seamless WLAN offload.
NOTE 2: The example considered above focuses mainly on IPv6 but similar
considerations can be applicable to IPv4.
# 7 Conclusions
#
# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This Technical Report describes the solutions to implement the architectural
aspects based on the requirements from TS 22.220 [3], clauses 5.7 and 5.9, and
TS 22.101 [2], clause 4.3.5, for LIPA and SIPTO at the local network.
This includes:
\- the support of mobility for LIPA between the H(e)NBs located in the local
IP network;
\- functionality to support Selected IP Traffic Offload requirements at the
local network, including mobility.
The report is intended to document the analysis of the architectural aspects
to achieve these objectives in order to include the solutions in the relevant
technical specifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.101: \"Service principles\".
[3] 3GPP TS 22.220: \"Service requirements for Home NodeBs and Home eNodeBs\".
[4] 3GPP TS 25.467: \"UTRAN architecture for 3G Home Node B (HNB); Stage 2\".
[5] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[6] RFC 2136: \"Dynamic Updates in the Domain Name System (DNS UPDATE)\".
[7] 3GPP TS 23.829 10.0.0: \"Local IP Access and Selected IP Traffic
Offload\".
[8] 3GPP TS 25.467: \"UTRAN architecture for 3G Home Node B (HNB); Stage 2\".
[9] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Requirements
## 4.1 Scenarios
### 4.1.1 General
For LIPA:
\- Session continuity of IP data sessions (i.e. IP address preservation) for
LIPA considering mobility between H(e)NBs within a single residential or
Enterprise network.
For SIPTO:
\- Session continuity of IP data sessions (i.e. IP address preservation) for
SIPTO at the local network and SIPTO above the RAN considering mobility among
H(e)NBs of the same local network;
\- Session continuity of IP data sessions for SIPTO above the RAN considering
mobility from the macro network to H(e)NBs; and
\- Session continuity of IP data sessions for SIPTO above the RAN considering
mobility from H(e)NBs to the macro network.
### 4.1.2 Scenarios for SIPTO at the local network
#### 4.1.2.1 Scenario 1: Per APN SIPTO\@LN
SIPTO\@LN on per APN basis could be carried out on the following cases:
\- case 1: UE camping in idle mode in an H(e)NB cell and requesting a new PDN
connection. The H(e)NB cell is part of a local network (e.g. Local H(e)NB
Network) supporting an L-GW.
\- case 2: UE camping in idle mode in an H(e)NB cell and making a Service
Request. The H(e)NB cell is part of a local network (e.g. Local H(e)NB
Network) supporting an L-GW.
\- case 3: UE in connected mode in a macro cell having an active PDN
connection is handed over to an H(e)NB cell that is part of a local network
(e.g. Local H(e)NB Network) supporting an L-GW. After handover is completed,
SIPTO\@LN may be carried out to existing active PDN connection(s) the UE may
have.
\- case 4: UE in connected mode in an H(e)NB cell having an active PDN
connection towards a PDN-GW in the mobile operator network is handed over to a
neighbour H(e)NB cell. The source H(e)NB may be part of a local network (e.g.
Local H(e)NB network) supporting an L-GW. The target H(e)NB may be part of the
same or different local network (e.g. Local H(e)NB Network) supporting an
L-GW. After handover is completed, SIPTO\@LN may be carried out to existing
active PDN connection(s) the UE may have.
\- case 5: UE in connected mode in an H(e)NB cell has an active PDN connection
towards a PDN-GW in the mobile operator network. The H(e)NB cell is part of a
local network, e.g. Local H(e)NB Network supporting an L-GW. The PDN
connection towards the PDN-GW is subject to SIPTO\@LN.
NOTE 1: H(e)NB cell is either a CSG cell or a hybrid cell.
NOTE 2: SIPTO\@LN offload also applies for non-CSG members when UE attached to
a hybrid cell.
## 4.2 Architectural requirements
The solution proposed for LIPA mobility shall support the following
requirements:
\- The solution for LIPA mobility shall allow the UE to maintain session
continuity for its LIPA PDN connection(s) to one or several local PDN(s) when
moving between H(e)NBs of the local H(e)NB network.
Figure 4.2.1: Architecture for LIPA mobility
\- A Local H(e)NB Network (LHN) is defined by a set of H(e)NBs having IP
connectivity for LIPA to local PDN(s) via one or several L-GWs, whereby:
\- a H(e)NB only belongs to a single Local H(e)NB Network;
\- an L-GW only belongs to a single Local H(e)NB Network;
\- an L-GW can access one or several PDNs, and one PDN can be accessed via
multiple LHNs;
\- the H(e)NBs of a Local H(e)NB Network may belong to different CSGs;
NOTE 1: In Release 10, inter-CSG HO is supported only via S1/Iu.
\- a CSG can comprise both H(e)NBs of the Local H(e)NB Network and H(e)NBs
outside the Local H(e)NB Network.
\- The solution should not impose additional delay on the RAN handover
procedures between H(e)NBs of the Local H(e)NB Network;
\- The solution shall keep the control of the MM/SM in the MME/SGSN for
mobility of the LIPA bearers;
NOTE 2: This does not preclude the RAN-based optimised Iurh/X2 handover.
\- Session continuity for LIPA with mobility between H(e)NBs of the same Local
H(e)NB Network shall be supported by means of an L-GW acting as an anchor, a
standardized interface between the L-GW and the H(e)NB, and handover
procedures from the source H(e)NB to the target H(e)NB.
Editor\'s note: It is FFS whether a given UE can be connected to several L-GWs
for multiple LIPA PDN connections.
For SIPTO:
\- Session continuity for SIPTO at the local network with mobility between
H(e)NBs belonging to the same local network shall be supported for idle mode
and for connected mode.
A common architecture should be used for LIPA and SIPTO at the local network.
The architecture shall support the following common requirements:
\- the UE might be aware that LIPA or SIPTO\@LN is applied for a connection;
\- to enable the use of pre-Rel-10 UEs, the use of SIPTO\@LN and LIPA features
shall not require any new UE feature;
NOTE 3: This does not preclude solutions that use optional additional UE
features, e.g. for optimization.
\- LIPA and SIPTO\@LN shall not have any impact to other services/connections
of the UE;
\- in both LIPA and SIPTO\@LN cases, that traffic shall not be routed via the
3GPP operator\'s Core Network.
# 5 Solutions
## 5.1 General
Editor\'s note: The scope of the work item covers several key issues. Clause
§5 is intended to develop these key issues in separate sub-clauses, grouped
into §5.2 LIPA mobility related issues, §5.3 SIPTO at the local network
related issues, §5.4 Miscellaneous issues. This clause §5.1 can be used to
summarise the key issues and provide guidance regarding the organisation of
the key issues.
## 5.2 Support of LIPA mobility
### 5.2.1 Key issue #L1: Architecture for LIPA mobility
#### 5.2.1.1 Architecture solution 1: Stand-alone logical L-GW
##### 5.2.1.1.1 Overall description
When a UE requests a LIPA bearer, a PDN connection is established and
terminates in the L-GW, where it is assigned an IP address (belonging to the
local IP network). As the UE moves around between the H(e)NBs in the local
network, it needs to maintain its connectivity to the L-GW in order to keep
its IP address and the ongoing services (note that this is also valid in idle
mode, since incoming packets may arrive at this L-GW which will buffer them
and trigger paging to the S-GW, as already described in Rel-10).
The L-GW is thus the obvious anchor point of the LIPA connectivity to the
local IP network.
Figure 5.2.1.1.1.1: LIPA mobility with stand-alone L-GW
The L-GW is a new stand-alone logical entity in the local network. It is
connected to the S-GW or SGSN via the S5 interface (resp. Gn interface) and to
the Home eNodeB (resp. Home NodeB) via a new interface Sxx.
Figure 5.2.1.1.1.2: Stand-alone L-GW architecture (EPS diagram for HeNB
subsystem)
Figure 5.2.1.1.1.3: Stand-alone L-GW architecture (EPS diagram for HNB
subsystem)
Figure 5.2.1.1.1.4: Stand-alone L-GW architecture (UMTS diagram)
NOTE 1: The SeGW is optional. For the HeNB subsystem, the HeNB GW is optional.
When the HeNB GW is present, the S1-U from the HeNB can terminate at the HeNB
GW or directly at the SGW, see TS 36.300 [5].
NOTE 2: The Iurh HNB-to-HNB interface can also go through the optional SeGW or
through the HNB GW, see TS 25.467 [4].
In Rel-11, the L-GW is a separate logical node from the H(e)NB. The procedures
defined in Rel-10 over the internal interface between the H(e)NB and the L-GW
are not intended to be necessarily reused.
The following issues are FFS:
\- The details of the new Sxx interface between the H(e)NB and the L-GW are
FFS. Whether this interface only transports the user plane data or includes
also a control plane is also FFS;
\- How the tunnels between the H(e)NBs and the L-GW are established is FFS.
\- How the secure tunnel transporting the S5 interface between the L-GW and
the SGW is established is FFS.
\- The procedures for the handover over the Sxx interface are FFS.
##### 5.2.1.1.2 Architecture description when Sxx is user plane only
In this variant, the Core Network architecture is kept unchanged and mobility
control signalling is run over the Iuh, S1, S11/S4, Gn and S5 interfaces. This
solution, where the L-GW is a stand-alone entity, avoids a new control
interface (\"Sxx\") between the L-GW and the H(e)NB.
Instead, E-UTRAN handover based on Rel-10 procedures for S1 is signalled, from
the H(e)NB via the MME, to the S‑GW and forwarded to the L-GW. The MME needs
to send the LHN parameters (e.g. L-GW address) via the S-GW to the L-GW. If
there is a requirement for supporting LIPA session continuity during mobility
between the local network (LN) and the macro network, this can be accomplished
without signalling changes, i.e. TAU signalling procedures and IRAT handover
procedures are unchanged.
{width="3.7493055555555554in" height="2.7597222222222224in"}
Figure 5.2.1.1.2.1: Stand-alone L-GW with control via MME and S-GW\ (EPS
diagram for HeNB subsystem)
For UTRAN with the mandatory HNB GW and the support for handover without core
network evolvement (TS 25.467 [8]), the signalling to update the L-GW can be
performed by the RANAP message (e.g. Enhanced Relocation Complete Request or a
new message) over Iu to the SGSN and SGSN transfers the information to the
L-GW via the S-GW.
Figure 5.2.1.1.2.2: Stand-alone L-GW with control via HNB GW and S-GW\ (EPS
diagram for HNB subsystem)
Figure 5.2.1.1.2.3: Stand-alone L-GW with control via HNB GW and Gn SGSN
Annex A illustrates some simplified flows for various mobility procedures
without Sxx control plane.
##### 5.2.1.1.3 Architecture solution 1 variant 2: control plane Sxx
###### 5.2.1.1.3.1 Overview
In this variant of the architecture, there is control plane signalling over
the Sxx interface to enable the control of the path between the H(e)NB and the
L-GW. As the functions required for the path management are similar to the
S5/Gn interface, the assumption is that a GTP-based solution can be used.
Therefore in the rest of the section, GTP messages are used to illustrate how
this architecture works.
The Sxx control plane signalling is dedicated to the setup of a direct data
path (Sxx data path) between H(e)NB and L‑GW for LIPA bearers only. This Sxx
data path is in addition to the normal S1/S5/Gn data path established during
LIPA PDN connection establishment or re-establishment. The normal S1/S5/Gn
data path and its associated signalling are protected by end-to-end IPsec as
currently employed by the Core Network. The Sxx control plane signalling and
Sxx data path are for local domain use and possible to be protected with
whatever local security deems appropriate.
This architecture can work with core network (DNS) based and RAN-based L-GW
selection, thus this part of the flows (how the H(e)NB learns the IP address
of the selected L-GW) is not described. The basic idea is that during LIPA
connection establishment, the H(e)NB receives the local address of the L-GW
(or an identifier that can be used to derive that address ) from the MME/SGSN.
During handovers, the target H(e)NB receives the local address of the L-GW (or
an identifier that can be used to derive that address) from the source side.
Annex A.3 illustrates the basic procedures of this architecture variant.
#### 5.2.1.2 Architecture solution 2: Standalone L-GW on the S1/Iuh path
##### 5.2.1.2.1 Architecture description
The L-GW is a new stand-alone logical entity in the local network. It is
connected to the S-GW (or SGSN) via the S5 interface (resp. Gn interface) and
is configured to be on the S1 (resp. Iuh) path between the H(e)NB and the
operator core network.
Figure 5.2.1.2.1.1: Standalone L-GW on the S1 path (EPS diagram for HeNB
subsystem)
Figure 5.2.1.2.1.2: Standalone L-GW on the Iuh path (EPS diagram for HNB
subsystem)
Figure 5.2.1.2.1.3: Standalone L-GW on the Iuh path (UMTS diagram for HNB
subsystem)
NOTE 1: This architecture solution assumes a single L-GW per LHN; every H(e)NB
of the LHN is associated with the L-GW responsible of the LHN through
configuration.
NOTE 2: The SeGW is optional. For the HeNB subsystem, the HeNB GW is optional.
When the HeNB GW is present, the S1-U interface from the HeNB proxied by the
L-GW may be terminated at the HeNB GW or directly at the S-GW, see TS 36.300
[5].
Since the L-GW is configured to be on the S1/Iuh path between the H(e)NB and
the operator\'s core network, connected mode mobility for LIPA PDN connections
can be supported based on the existing Rel-10 handover procedures for S1/Iuh.
##### 5.2.1.2.2 Architectural details for the LTE/3G architecture
\- The H(e)NBs of the LHN are associated with the L-GW responsible for this
LHN through configuration.
NOTE 1: This architecture solution assumes a single L-GW per LHN.
\- At start-up, the L-GW is authenticated by the SeGW and configured reusing
the existing Rel-10 procedures defined for \"H(e)NBs with co-located L-GW\".
NOTE 2: IKEv2 mechanisms are used by the L-GW to request an IP address for
each of the S1 termination points at the L-GW (S1-L-GW\@CN) as well as for the
S5 termination points at the L-GW (S5-L‑GW\@CN). Alternatively, a common IP
address may be used for all termination points, the traffic segregation being
performed based on TEID ranges, as described in TS 25.467 [4] and TS 36.300
[5].
NOTE 3: A single IPsec tunnel can be used between the L-GW and the SeGW for
all S1-MME/S1-U or Iu sessions.
\- The L-GW includes a subset of the functions of the P-GW. The functionality
to handle LIPA PDN connections is identical to the corresponding L-GW
functionality defined for the collocated L-GW case in Rel-10.
\- The H(e)NB tunnels all UE-associated signalling on S1-MME/Iu control plane
and user plane messages on S1-U/Iu user plane through the L-GW.
NOTE 4: The L-GW\@LN IP address is a matter of local configuration in the
local network.
NOTE 5: Encryption and integrity protection of the traffic between the L-GW
and the operator network is based on the IPsec tunnel between the L-GW and the
SeGW.
NOTE 6: Encryption and integrity protection of the traffic between the H(e)NBs
and the L-GW in the residential or enterprise network is based on IPsec.
\- On the S1-U/Iu user plane path and the S1-MME/Iu control plane path, the
L-GW provides the following functions:
\- it serves as a proxy function for the S1-MME/Iu control plane signalling
(i.e. there exists a 1:1 mapping between the S1-MME/Iu control plane instances
on both sides of the L-GW);
\- it serves as a proxy function for the S1-U/Iu user plane for non-LIPA PDN
bearers (i.e. there exists a 1:1 mapping between the S1-U/Iu user plane
instances on both sides of the L-GW); and
\- it terminates the S1-U/Iu user plane interface with the HeNB for LIPA PDN
connections.
\- The assigned S5/Gn address is signalled to the MME by the L-GW in UE-
associated signalling messages on S1-MME/Iu. The MME/SGSN uses the information
from the L-GW to override the normal P-GW/GGSN selection algorithm, etc.
\- The Correlation-ID provided by the MME/SGSN to the H(e)NB on S1-MME/Iu is
used by the L-GW to determine which S1-U/Iu and S5/Gn bearers to be offloaded
at the L-GW.
\- At start-up time, the H(e)NBs of the LHN are authenticated and configured
by the operator network based on the existing Rel-10 procedures.
NOTE 7: The L-GW is not required to be involved in these procedures.
The following issues are FFS:
\- whether the limitation to have only a single L-GW per LHN is an actual
problem for LHN deployments;
\- whether the fact that all traffic from/to the H(e)NBs of a LHN traverses
the L-GW creates a security and reliability concern.
Annex B presents the details (e.g. protocol stacks, message flows) of the
Standalone L-GW architecture option 2.
### 5.2.2 Key issue #L2: L-GW selection and addressing
#### 5.2.2.1 General description
In Rel-10 LIPA architecture, the L-GW is collocated with H(e)NB, and
therefore, the L-GW address and H(e)NB address do not need to be signalled
between them. However, in Rel-11, when the standalone L-GW is supported, L-GW
and H(e)NB must exchange their addresses in order to establish the direct data
path between them. Considering the involvement of Security Gateway (SeGW),
there would be two addresses each for the L-GW and H(e)NB, i.e. the local
address from the home network, and the Core Network address allocated by SeGW
(IPsec inner IP address).
#### 5.2.2.2 L-GW selection and addressing for Architecture solution 1 (Stand-
alone logical L-GW)
##### 5.2.2.2.1 General
The L-GW addresses are named L-GW\@LN address/FQDN, L-GW\@CN, H(e)NB\@LN/FQDN,
and H(e)NB\@CN respectively. The L-GW\@LN address/FQDN and H(e)NB\@LN
address/FQDN are the addresses/FQDN allocated by the local network, and the
L-GW and H(e)NB use them to establish secure connections to the SeGW. The
L-GW\@CN address and H(e)NB\@CN address are the addresses allocated by the
SeGW in the Core Network domain space and used for communicating with Core
Network entities, e.g. S-GW.
NOTE: L-GW\@LN and H(e)NB\@LN FQDNs may be used within the Local Network e.g.
to ease local configuration aspects.
In the LIPA connection setup process, the following issues need to be
considered:
\- how to inform the Core Network (MME/SGSN) of the L-GW\@CN address;
\- how to inform the H(e)NB of L-GW\@LN address/FQDN and TEID for setup of the
direct data path;
\- how to inform the L-GW of H(e)NB\@LN address/FQDN and TEID for forwarding
the downlink traffic over the direct data path.
##### 5.2.2.2.2 Stand-alone L-GW selection
The L-GW selection function should be able to take into account several
parameters such as e.g. the APN requested by the UE, the Local H(e)NB Network
ID, L-GW load balancing, L-GW failure cases, etc. On the other hand, the
H(e)NB is not aware of Non-Access-Stratum layer information especially in the
case of LTE as NAS is encrypted and hence the H(e)NB cannot see it except if
provided by the Core Network via S1AP/RANAP.
Some more details can be found in 5.2.2.2.5.
In the case L-GW selection needs to be performed by the Core Network e.g. if
it depends on NAS information such as APN, the H(e)NB will not provide the
L-GW\@CN IP address but necessary information that will enable the Core
Network to select the L-GW. According to the architecture principles, an L-GW
in a given LHN cannot serve a H(e)NB in another LHN. Hence, the H(e)NB needs
to provide the Core Network with a LHN ID in order to prevent the selection of
an L-GW outside the LHN.
In order for the Core Network to select an L-GW, the LHN ID is provided by the
H(e)NB to the Core Network. Thanks to the LHN ID, the MME/SGSN should be able
to determine the DNS server that serves the L-GWs of that LHN or access to a
proxy-DNS that will fetch the appropriate DNS server.
NOTE: The introduction of the LHN ID is not expected to impact existing
MME/SGSN functions related to selection, pool support and load-balancing.
##### 5.2.2.2.3 Signalling the L-GW\@LN address/FQDN and TEID to the H(e)NB
In the collocated L-GW case, in the E-RAB/RAB establishment process, a
Correlation ID is sent from the MME/SGSN to the H(e)NB. Release 10
specifications defined the Correlation ID as the TEID or the GRE keys of the
L-GW for the user plane. In order to support the standalone L-GW, the L-GW\@LN
address/FQDN should also be sent to the H(e)NB e.g. in the Correlation ID in
order for the H(e)NB to establish the direct data path with the L-GW.
On the other hand, the L-GW\@CN address and TEID or the GRE keys must be
signalled to the S-GW in order to establish the S5 user plane, e.g. for paging
support.
Following are the options to signal the L-GW\@LN address/FQDN and TEID or GRE
key to the H(e)NB:
1) **The H(e)NB obtains the L-GW\@LN address/FQDN during direct data path
setup signalling (Sxx interface).** In this approach, the MME/SGSN provides
the L-GW\@CN and TEID/GRE key in the Bearer Setup Request/RAB Assignment
Request message. The H(e)NB uses the received L-GW\@CN address for the
signalling of setting up the direct data path (Sxx control plane), which
results in the messages going through the SeGW(s) and the Core Network IP
network. During the direct data path setup signalling, the L-GW\@LN
address/FQDN can be passed by the L-GW to the H(e)NB . The L-GW\@LN
address/FQDN is used for the user plane of Sxx.
2) **The H(e)NB obtains the L-GW\@LN address/FQDN from Core Network.** In this
approach, the L-GW provides its L-GW\@LN address/FQDN to the Core Network with
e.g. dynDNS procedure. The L-GW\@LN address/FQDN can be signalled to the
H(e)NB after L-GW selection by the Core Network in the Bearer Setup Request /
RAB Assignment Request message (see Figures 5.2.2.2.6.1 and 5.2.2.2.6.2). The
MME/SGSN needs to form the Correlation ID using the TEID sent from the L-GW
(via S-GW) and the L-GW\@LN address obtained from DNS.
##### 5.2.2.2.4 Signalling the H(e)NB\@LN local address/FQDN and TEID to L-GW
In normal operation, the H(e)NB allocates the TEID and sends it to the
MME/SGSN in the Bearer Setup Response/RAB Assignment Response message. In the
standalone L-GW case, this TEID and the H(e)NB\@LN have to be signalled to the
L-GW such that the downlink direction of the direct data path can be setup
accordingly.
Two possible approaches can be used for signalling the address and TEID:
a) modify the S5 interface control plane to deliver the H(e)NB\@LN
address/FQDN and TEID from the S-GW to the L-GW.
b) a new control plane on Sxx interface between H(e)NB and L-GW can be used to
signal the H(e)NB\@LN address/FQDN and TEID to the L-GW. Any tunnel management
mechanism can be reused for this interface, e.g. GTP or IKEv2 with extensions.
##### 5.2.2.2.5 Signalling the L-GW\@CN address to the SGSN/MME
In case of the collocated L-GW, the H(e)NB includes the L-GW address in every
INITIAL UE MESSAGE and every UPLINK NAS TRANSPORT (or UTRAN Originated DIRECT
TRANSFER) control message.
For the standalone L-GW case, the L-GW\@CN address needs to be provided to the
SGSN/MME. Following are two kinds of alternatives to achieve that:
a) **RAN-based alternative: Keep the procedures for collocated L-GW, i.e. the
H(e)NB informs the SGSN/MME of L-GW\@CN address via Iu/S1.**
However, this approach requires the H(e)NB be informed about the L-GW\@CN
address before the UE requests for a LIPA connection. A few sub-options are
listed below **for the case of single L-GW in the Local H(e)NB Network** :
i. H(e)NB obtains L-GW\@CN by interacting with Core Network entities, for
example a DNS server in the Core Network. In this option, the L-GW registers
L-GW\@CN to the Core Network entities, e.g. DNS server in the Core Network.
The H(e)NB can query the DNS server with the Local H(e)NB Network ID to obtain
the corresponding L-GW\@CN address. Note that the DNS server can be deployed
for serving only the H(e)NBs.
ii. The H(e)NB obtains the L-GW\@CN address from local network. As H(e)NB and
L-GW are user premises entities, they can discover each other via local
network discovery mechanisms, e.g. via the local network DNS, DHCP, UPnP or
deployment configurations, etc. The Core Network does not need to be aware of
the mechanism employed for this local discovery. Note that these discovery
mechanisms normally would only provide H(e)NB with the L-GW\@LN address. After
the discovery, the H(e)NB and L-GW can attempt the establishment of a Sxx
interface, and exchange the information of addresses allocated by the Core
Network, i.e. L-GW\@CN address and H(e)NB\@CN address using the control plane.
In case there are multiple L-GWs in the local network, the Core Network node,
e.g. SGSN/MME, may need to be involved in the selection of the L-GW. In order
to support that, the H(e)NB needs to send all the eligible L‑GWs\' information
(e.g. L-GW\@CN address and APN supported for each L-GW) to the SGSN/MME, and
the SGSN/MME can select the proper L-GW based on available information, e.g.
UE requested APN.
b) **DNS-based alternative: Instead of the sending the L-GW\@CN, the H(e)NB
only indicates either the Local H(e)NB Network ID in the message towards
SGSN/MME. The SGSN/MME would then use that information to query a DNS server
in the Core Network to obtain the L-GW\@CN address.**
This approach would require the L-GW to register the L-GW\@CN address, the
L-GW\@LN address/FQDN to a DNS server in the Core Network. This can be done by
running a DNS Update from the L-GW after obtaining the address from the SeGW
(dynDNS).
This registration needs to provide the DNS server with all the APNs that can
be supported by the L-GW, and all the H(e)NBs that can locally connected to
the L-GW (i.e. the Local H(e)NB Network ID). When the UE requests a LIPA PDN
connection, the SGSN/MME queries the DNS server using the requested APN, the
Local H(e)NB Network ID, etc.
NOTE: In Rel-10 procedure for L-GW selection, when there is no L-GW\@CN
address provided by the H(e)NB, the MME would either reject the LIPA PDN
connection request (for \"LIPA Only\" APN), or setup a non LIPA PDN connection
(for \"LIPA conditional\" APN). Therefore, in order to be backward compatible,
the H(e)NB needs to indicate a preset address, e.g. 0.0.0.0, to the SGSN/MME,
which would trigger the DNS query.
##### 5.2.2.2.6 Description of the DNS-based and RAN-based alternatives
Below are described two alternatives for signalling the L-GW address to the
SGSN/MME, showing the L-GW selection by the Core Network, how the L-GW\@LN
address/FQDN and TEID are signalled to the H(e)NB, and how the H(e)NB\@LN
address/FQDN and TEID are signalled to the L-GW:
a) DNS-based alternative
At initialization, after having established an IPsec tunnel with the SeGW,
each L-GW can register as DNS client with Update DNS capability (IETF RFC 2136
[6]) to a DNS server in the mobile Core Network with some parameters such as
the Local H(e)NB Network ID , the L-GW\@LN address or the L-GW local FQDN, the
L-GW\@CN address allocated by the SeGW, etc). The DNS server will maintain
these data for interrogation from the MME/SGSN at UE LIPA PDN connection
request: the MME/SGSN can perform a DNS query as it does in other cases with
specific parameters: APN, Local H(e)NB Network ID. The DNS server will then
return one or several L-GW addresses to the MME/SGSN.
This DNS server may be hosted by e.g. the H(e)NB GW if present.
An example is shown in the following call flow.
Figure 5.2.2.2.6.1: DNS-based alternative
b) RAN-based alternative
Each H(e)NB is configured with the L-GW\@LN address or FQDN of all L-GW(s) it
has connectivity with. The H(e)NBs and the L-GWs need to exchange data over
Sxx interface via control plane to allow the H(e)NB to know the L-GW\@CN
address of each L-GW that has been allocated by the SeGW. The H(e)NB transfers
the list of L-GW\@CN IP addresses or FQDNs to the Core Network via S1AP/RANAP.
Based on e.g. APN and Local H(e)NB Network ID, the Core Network selects one
L-GW among the list of L-GW(s) provided by the H(e)NB.
Figure 5.2.2.2.6.2: RAN-based alternative
### 5.2.3 Key issue #L3: Discovery of the LIPA mobility area
#### 5.2.3.1 Description of the key issue
The Local H(e)NB Network (LHN) is defined by a set of H(e)NBs having IP
connectivity for LIPA to local PDN(s) via one or several L-GWs. The H(e)NBs of
a Local H(e)NB Network may belong to different CSGs, and a CSG can comprise
both H(e)NBs of the Local H(e)NB Network and H(e)NBs outside the Local H(e)NB
Network. The H(e)NBs belonging to the same Local H(e)NB Network as the source
H(e)NB define the mobility area for the LIPA PDN connections of the UE.
It means that session continuity for LIPA with mobility of a UE between
H(e)NBs requires IP connectivity between the target H(e)NB and the L-GW which
is also connected with the source H(e)NB and acts as an anchor of the LIPA PDN
connection.
In order to perform handover of the LIPA PDN connections, the source and/or
target H(e)NBs as well as the MME/SGSN need to be able to identify that the
source and target H(e)NBs belong to the same Local H(e)NB Network. If the
target H(e)NB does not belong to the same LHN as the source H(e)NB, the LIPA
bearer(s) need to be deactivated (see key issue #L4, clause 5.2.4, LIPA
deactivation, for further details).
#### 5.2.3.2 Option 1: using the L-GW\@CN address for architecture solution 1
(Stand‑alone logical L-GW)
##### 5.2.3.2.1 General
In Rel-10 LIPA architecture, the L-GW is collocated with H(e)NB and mobility
of the LIPA PDN connection is not supported, and therefore, the H(e)NB will
inform the L-GW to deactivate the LIPA bearer before initiating handover.
However, in Rel-11, when LIPA mobility is supported, the source H(e)NB needs
first to try and select a target H(e)NB to ensure session continuity for LIPA,
or decide whether to include the LIPA bearer in the Handover Request (Handover
Required) message, if the source H(e)NB can have information regarding the IP
connectivity between the (candidate) target side(s) and the anchor L-GW of the
LIPA PDN connection. When the source H(e)NB does not know accurately about IP
connectivity between the (candidate) target side(s) and the anchor L-GW, it
may directly include the LIPA bearer in the Handover Request (Handover
Required) message. The LIPA bearer, therefore, needs to be handled properly in
the network according to whether the target side could connect to the anchor
L-GW.
For the idle mode mobility procedures, the Rel-10 mechanism still works. The
H(e)NB supporting Rel-11 LIPA function includes the L-GW\@CN address of the
L-GW which the H(e)NB could connect with to the MME/SGSN in every INITIAL UE
MESSAGE and every UPLINK NAS TRANSPORT(or UTRAN Originated DIRECT TRANSFER)
control messages. The MME/SGSN to decide whether the LIPA PDN connection needs
to be deactivated based on the L-GW\@CN information or the lack of it. It is
FFS how to indicate the L-GW\@CN addresses of multiple L-GWs if the Local
H(e)NB Network includes multiple L-GWs.
##### 5.2.3.2.2 Handover decision
The H(e)NB with Rel-11 LIPA capability may keep information regarding whether
the neighbour H(e)NB/cell belongs to the same Local H(e)NB Network as itself.
The source H(e)NB tries to select a target H(e)NB ensuring session continuity
for LIPA before initiating handover.
When information of IP connectivity to the L-GW for the neighbour H(e)NB/cell
is not available or reliable and the UE has LIPA PDN connection, the source
H(e)NB may always directly perform a handover with LIPA for the UE.
Considering the target H(e)NB knows reliably about its own IP connectivity to
a specific L-GW, the source H(e)NB includes the anchor L-GW\@CN address in the
Handover Request (Handover Required) message for the target side to confirm.
The Handover Request (Handover Required) message also includes the LIPA bearer
information.
##### 5.2.3.2.3 LIPA bearer handling
If the target H(e)NB has IP connectivity to the anchor L-GW of the LIPA PDN
connection, it can grant the resource for the LIPA bearer and feed back that
the LIPA bearer is successfully set up in the target H(e)NB. If the target
H(e)NB has no IP connectivity to the anchor L-GW of the LIPA PDN connection,
the target H(e)NB may exclude the LIPA bearer when granting the resource for
the other bearers. The target H(e)NB may also feed back its support or lack of
connectivity to the L-GW to the source side. This way, the source H(e)NB can
build and/or correct its neighbour H(e)NB/cell relation table with proper L-GW
IP connectivity information.
NOTE 1: The feedback from the target H(e)NB is necessary to help the source
H(e)NB identify whether the target H(e)NB is a legacy H(e)NB.
For a legacy target node (i.e. pre-Rel-11) not supporting LIPA mobility or
LIPA, by sending the L-GW\@CN address and LIPA bearer information in Handover
Request message as new parameters, the target side will ignore the LIPA bearer
and L-GW\@CN address and continue handover procedure without considering the
LIPA bearer. When the target side sends back an original Handover Request
Acknowledge message without LIPA bearer setup or L-GW IP connectivity
information, the source H(e)NB will know the target side is a legacy node.
Editor\'s note: It is FFS how to guarantee that the legacy target H(e)NB can
handle the new parameter properly without resulting in Handover failure or
accidently allocating radio resources for LIPA bearers.
NOTE 2: The MME/SGSN needs to forward the Handover Request message with new
L-GW IP connectivity information between the source H(e)NB and the target side
in S1/Iu handover. It is FFS how the LIPA bearer is handled in the Core
Network in handover, which is related to whether the Sxx has both CP and UP or
UP only.
#### 5.2.3.3 Option 2: using the LHN-ID for architecture solution 1 (Stand-
alone logical L-GW)
##### 5.2.3.3.1 General
The LHN ID is configured locally in each H(e)NB of the LHN. To make sure that
a LHN ID is not used by several LHNs, and because this concept is independent
from the CSG concept, a solution could be to identify a LHN uniquely in a
PLMN-ID as it is done for an eNB (Global eNB ID is defined in a PLMN). The
H(e)NB(s) in the same LHN shall have the same LHN-ID.
NOTE 1: If the DNS method is used to support the L-GW selection, the LHN ID is
also configured in each L-GW of the LHN.
The HeNB includes the LHN-ID to the MME in every INITIAL UE MESSAGE and every
UPLINK NAS TRANSPORT message.
The HNB includes the LHN-ID to the SGSN in every INITIAL UE MESSAGE and every
UTRAN Originated DIRECT TRANSFER control message.
NOTE 2: This can be used as an indicator that the H(e)NB supports LIPA
mobility among the same LHN.
##### 5.2.3.3.2 LIPA PDN connection management
If the PDN connection(s) for LIPA are activated, the MME/SGSN records the LHN-
ID reported by the H(e)NB. It will be stored in the UE\'s MM context. When the
last LIPA PDN connection for the UE is deactivated, MME/SGSN should delete it
from the UE\'s MM context. For one UE, only one LHN-ID is stored on the
MME/SGSN.
**Idle mode mobility procedure**
For the Service Request procedure, MME/SGSN checks whether the cell the UE
accessed reports the same LHN-ID compared to the stored LHN-ID. If not, all
the LIPA PDN connections shall be deactivated.
For the intra CN node RAU/TAU procedure, if the MME/SGSN receives the TAU/RAU
request from the H(e)NB and the LHN-ID is different compared to the stored
LHN-ID or no LHN-ID is received, the MME/SGSN shall delete all the LIPA PDN
connections.
For the inter CN node RAU/TAU procedure, it is assumed that there are no
inter-CN entity mobility when the UE moves between H(e)NBs in the same LHN.
Based on that assumption, if the MME/SGSN receives the RAU/TAU request from
other MME/SGSN entity, it shall delete all the LIPA PDN connections.
NOTE 1: The H(e)NBs in the same LHN are always in the same SGSN/MME pool.
NOTE 2: If the inter-CN mobility needs to be supported, e.g. HNB and HeNB can
coexist in one LHN, the source MME/SGSN checks the received LHN-ID included in
the Context Req to decide whether the LIPA PDN connection can be sent to the
new CN node.
**Connected mode mobility procedure**
It is FFS how to use the LHN-ID to handle the connected mode mobility.
### 5.2.4 Key issue #L4: LIPA deactivation
#### 5.2.4.1 General
For a UE which has activated a LIPA PDN connection in a Local H(e)NB Network,
when mobility events occur, the following issues need to be addressed:
\- What are the scenarios under which the LIPA PDN connection should be
deactivated?
\- What are the criteria for the deactivation decision?
\- Which node(s) is responsible for the decision of LIPA PDN connection
deactivation?
\- Which procedure(s) shall be used when LIPA PDN connection are deactivated?
#### 5.2.4.2 Solutions
### 5.2.5 Key issue #L5: H(e)NB providing LIPA support indication to UE
#### 5.2.5.1 General description
The current requirement in TS 22.220 [3] states that:
\- The user may be notified when a H(e)NB provides access to a
residential/enterprise IP network.
Three solutions have been documented in TR 23.829 [7] for providing an
indication to the UE that LIPA is supported by the H(e)NB. The three solutions
are listed in the following sections.
Editor\'s note: A solution without this requirement is not precluded.
#### 5.2.5.2 Solution 1: UE configuration
A list of CSG IDs or cell IDs statically configured in the UE/USIM, e.g. based
on provisioning. This method best suits the case for residential LIPA access
but may not be well suited for a corporate network for example if some of the
H(e)NBs support LIPA and others do not. It also does not work for the hybrid
cells where the UE is not a member and open cells.
#### 5.2.5.3 Solution 2: NAS signalling
Informing the UE via NAS, i.e., the MME includes an indication in the NAS
message towards the UE when it establishes a connection whether LIPA is
supported at this cell. The UE can decide whether to initiate a LIPA PDN
connection based on this indication. For example, the MME may be informed of
the cell\'s capability to support LIPA when the UE establishes a connection in
the initial UE message or the relocation request acknowledgement.
#### 5.2.5.4 Solution 3: RRC signalling
Including the LIPA capability in RAN layer signalling. An indication of the
LIPA support can be included in the SIB broadcasted by the RAN nodes or
included in RRC signalling.
#### 5.2.5.5 Evaluation
## 5.3 SIPTO above the RAN
### 5.3.1 Key issue #S1: Principles for session continuity for SIPTO above the
RAN
\- Session continuity for SIPTO above the RAN with mobility within the macro
network and between the macro network and H(e)NBs shall be supported with the
existing mobility procedures defined in Rel-10 specifications.
\- The impact of mobility events can be managed based on operator policies
using GW deployment and configuration with no impacts to the current
specifications.
## 5.4 SIPTO at the local network
### 5.4.1 Key issue #SL1: Principles for session continuity for SIPTO at the
local network
Editor\'s note: It is FFS how to support session continuity for SIPTO at the
local network.
#### 5.4.1.1 Solution 1: per APN SIPTO\@LN re-using Rel-10 SIPTO above the RAN
procedures
This solution takes into account the use cases for per APN SIPTO\@LN specified
in clause 4.1.2.1 (Scenario 1).
It is proposed to re-use the procedure for SIPTO above the RAN defined in
Release 10. The proposed solution consists of releasing a PDN connection of a
particular APN towards a PDN-GW followed by the establishment of a new PDN
connection to the local network using the same APN where the network selects
an L-GW in the local network.
For all use cases defined in 4.1.2.1, it is assumed that:
\- SIPTO\@LN is authorised for the UE and the APN;
\- The L-GW supports the APN being offloaded;
\- The mobile operator network is aware that the local network (i.e. Local
H(e)NB Network, L-GW) supports SIPTO\@LN.
The procedure for per APN SIPTO\@LN for each case described in the scenarios
clause (clause 4.1.2.1) is:
For case 1, the mobile operator network may select an L-GW in order to offload
immediately the PDN connection locally using the same APN.
For cases 2 to 5, the procedure of SIPTO\@LN by the network consists of the
release of the PDN connection terminated at the PDN-GW in the mobile operator
network, followed by the establishment of a new PDN connection to the same APN
whereby the network will select an L-GW in the Local H(e)NB Network.
If the user needs to also access resources in the local network in parallel,
the UE need to establish a separate PDN connection for LIPA (i.e. to a LIPA
specific APN).
### 5.4.2 Key issue #SL2: SIPTO at the local network permission
#### 5.4.2.1 General description
The activation of SIPTO\@LN service requires special permission from the HPLMN
operator at the MME/SGSN for GW selection as well as consent from the user for
offloading UE traffic in the local network. The HPLMN operator can configure
this permission per UE, per APN, and per VPLMN basis. The network operator
permission to allow UE traffic to be offloaded to a local network that is
stored in subscription data in the HSS on per user per APN granularity is also
used to indicate user consent.
#### 5.4.2.2 Solution 1
A solution similar to the Rel-10 SIPTO solution, which has added SIPTO
specific permission information to each APN, is used. To support the
requirement that it shall be possible for an operator to allow/disallow
SIPTO\@LN on a per subscriber basis for SIPTO permitted APNs, the SIPTO
Permissions have a new value defined to specifically allow SIPTO\@LN. In short
the SIPTO Permissions have the following three values:
\- SIPTO Prohibited,
\- SIPTO Allowed (excluding SIPTO\@LN),
\- SIPTO Allowed including SIPTO\@LN (new value).
\- SIPTO\@LN Allowed only (new value).
"SIPTO\@LN Allowed" indicates that the user has provided consent to allow the
network to offload UE traffic in the local network and network operator
permission on per user per APN granularity.
The \"SIPTO Allowed\" value implies that SIPTO at /above the RAN is permitted,
but SIPTO\@LN is not.
As concluded in Rel-10, the LIPA Permissions and SIPTO Permissions are
mutually exclusive. For Rel-12, the same principle should be applied between
SIPTO\@LN permissions and LIPA permission, i.e., if SIPTO permission is set to
"SIPTO-allowed", "SIPTO Allowed including SIPTO\@LN" or "SIPTO\@LN Allowed
only", the LIPA permission shall be set to LIPA-prohibited
The \"SIPTO Allowed including SIPTO\@LN\" value is used by the MME/SGSN to
determine if it can:
\- select a P-GW for providing SIPTO at/above RAN when the user is in a macro
cell, or
\- select a P-GW for providing SIPTO at/above RAN or an L-GW for providing
SIPTO\@LN for an APN when user is in a CSG cell or a hybrid cell.
Editor\'s note: It is FFS whether in the additional case there is any order of
precedence between SIPTO at/above RAN and SIPTO\@LN.
Moreover, the existing SIPTO Rel-10 solution allowing the HPLMN to indicate to
the VPLMN if SIPTO is allowed or not for a given user is also applicable to
SIPTO\@LN.
#### 5.4.2.3 Solution 2
One approach is to reuse the LIPA permissions as specified in Rel-10 for
SIPTO\@LN with one extension to the LIPA permissions for Rel-11: an additional
value \"L-GW allowed\". This value allows the MME/SGSN to select the L-GW for
that APN bypassing the CSG check.
The LIPA permissions are interpreted as follows:
\- LIPA-prohibited -- means the MME is not allowed to select the L-GW for that
UE;
\- LIPA-only -- means the MME shall select the L-GW for the UE if available;
NOTE: the MME has to check the APN is part of the CSG subscription data as
well.
\- LIPA-conditional -- means the MME should select the L-GW for the UE if the
UE is camped on the correct CSG corresponding to the APN requested based on
the CSG subscription data. Otherwise the MME selects the P-GW as if the UE is
camped on a macro;
\- L-GW-allowed -- means the MME may select the L-GW for the UE if available
for members or non-members of a CSG.
Editor\'s Note: it is FFS if precedence between SIPTO\@LN and SIPTO at and
above RAN is needed when both L-GW allowed and SIPTO allowed flags are set for
an APN.
#### 5.4.2.4 Evaluation
Comparing the two proposals on extension SIPTO or LIPA permission, both
solutions capture all possible combinations for permissions. There was a
preference to extend the SIPTO permissions for SIPTO\@LN, as SIPTO\@LN was
considered closer feature to Rel-10 SIPTO than LIPA.
# 6 Conclusions
For Key issue #L1: \"Architecture for LIPA mobility\", it is agreed that the
solution 1 described in clause 5.2.1.1, \"Architecture solution 1: Standalone
logical L-GW\" will be adopted as the baseline architecture.
For Key issue #SL2: "SIPTO at the local network permission", it is agreed that
the solution 1 described in clause 5.4.2.2 will be adopted for SIPTO\@LN
control.
###### ### Annex A: Evaluation of mobility procedure impacts for architecture
1
# A.1 Sxx user-plane only Option 1
## A.1.1 Setup of local connection
### A.1.1.1 E-UTRAN
The PDN Connectivity Request procedure is used to set up a connection in the
local network (LN).
Figure A.1.1.1.1: Setup of local connection (E-UTRAN)
Comments on the local connection setup signalling procedure:
\- L-GW\@LN address is included in steps 4, 5 and 6. It is stored in MME and
HeNB contexts;
\- HeNB\@LN address is included in steps 9 and 12;
\- HeNB\@LN address is forwarded to L-GW in the step 13 if the HeNB\@LN
address is included in step 12 (step 13 is mandatory for bearers of LIPA PDN
connection); and
\- The HeNB\@LN address and L-GW\@LN address can be sent in existing IEs on
S1-MME. It is FFS if this is applicable in all cases, or we need new IEs on
S1-MME for the local addresses (this is a stage 3 issue).
### A.1.1.2 UTRAN
The PDP Context procedure is used to set up a connection in the local network
(LN). The procedure has no impacts on the Core Network (assuming no UP in
SGSN), the GTP TEIDs are passed transparently via the SGSN (and HNB GW).
Figure A.1.1.2.1: Setup of local connection (UTRAN)
Comments on the local connection setup signalling procedure:
\- L-GW\@LN address is included in steps 4 (SGSN ← L-GW) and 5 (RAN ← SGSN).
The L-GW\@LN address is stored in the HNB for further mobility updates.
\- HNB\@LN address is included in steps 5 (RAN → SGSN) and 8 (SGSN → L-GW).
The HNB\@LN address is stored in the L-GW for further mobility updates (Step 8
is mandatory for bearers of LIPA PDN connection).
## A.1.2 Handovers within the local network
### A.1.2.1 X2 handover within enterprise / local network (E-UTRAN)
The X2 handover procedure can be used to handle mobility in the local network
(LN).
Figure A.1.2.1.1: X2 handover within enterprise / local network (E-UTRAN)
X2 handover signalling procedure:
\- L-GW\@LN address is forwarded to target HeNB in step 2;
\- Target HeNB\@LN address is included in steps 7 and 8;
\- Target HeNB\@LN address is forwarded to L-GW in the step 9 if the target
HeNB\@LN address is included in step 8 (step 9 is mandatory for bearers of
LIPA PDN connection).
### A.1.2.2 Intra HNB GW mobility within enterprise / local network (UTRAN)
The mobility procedure for inter-HNB, intra HNB GW mobility is based on the
procedure defined in 3GPP TS 25.467 [8] but the procedure in 3GPP TS 25.467
[8] has no standalone L-GW functionality and a solution is needed to update
the L-GW with the target HNB address. The proposal is to have the HNB GW to
trigger an Iu like RANAP message as \"Enhanced Relocation Complete Request\"
to the SGSN and SGSN triggers a Modify Bearer Request to S-GW and L-GW.
Figure A.1.2.2.1: Intra HNB GW mobility within enterprise / local network
(UTRAN)
Comments on the signalling procedure:
\- The IP address and the GTP TEID of the target HNB is transferred to the HNB
GW in message 3a.
\- The HNB GW forwards the IP address and the GTP TEID of the target HNB to
the SGSN in step 3b\' (new signalling).
\- The SGSN sends the IP address and the GTP TEID of the target HNB to the
L-GW in step 3b (new signalling).
\- The UL IP address and GTP TEID of the L-GW is not changed so the target HNB
will use the same address as the source. This information will be carried in
the inter-HNB signalling.
## A.1.3 S1 handover within enterprise / local network
The S1 handover procedure can be used to handle mobility within the local
network (LN).
Figure A.1.3.1: S1 handover within enterprise / local network
Comments on the S1 handover signalling procedure:
\- The L-GW\@LN address is included in step 3 to target HeNB;
\- Target HeNB\@LN address is included in steps 9 and 10;
\- Target HeNB\@LN address is forwarded to L-GW in the step 11 if the Target
HeNB\@LN address is included in step 10 (step 11 is mandatory for bearers of
LIPA PDN connection).
## A.1.4 S1/Iu release
### A.1.4.1 S1 release
The S1 release procedure is used to release the S1 connection.
Figure A.1.4.1.1: S1 release
Comments on the S1 release signalling procedure:
\- The S-GW informs the L-GW about the release of the HeNB context in the step
3 (new signalling. It is FFS if Modify Bearer shall be used).
### A.1.4.2 Iu release
The Iu release procedure is the same as existing Iu/Iuh disconnect. The Core
Network is responsible for notifying the L‑GW that the UE is in Idle mode
(i.e. same idle mode behaviour as in Rel-10).
## A.1.5 Service request
### A.1.5.1 E-UTRAN
The Service Request procedure is by the UE to establish the user plane.
Figure A.1.5.1.1: Service request (E-UTRAN)
Comments on the Service request signalling procedure:
\- The L-GW\@LN address is included in step 3 for HeNB;
\- HeNB\@LN address is included in steps 5 and 6 besides the HeNB\@CN address;
\- HeNB\@LN address is forwarded to L-GW in the step 7 if the HeNB\@LN address
is included in step 6 (step 7 is mandatory for bearers of LIPA PDN
connection).
### A.1.5.2 UTRAN
The Service Request in UTRAN will use the same principles as at PDP context
setup. The HNB GW will pass the GTP TEIDs of the HNB and the L-GW
transparently, while it also stores the addresses of the L-GW for further
mobility updates.
# A.2 Sxx user-plane only Option 2
## A.2.1 General
For the following procedure description, the term L-GW refers to the P-GW and
the HeNB refers to the eNodeB shown in the figure.
## A.2.2 Connection management procedure
### A.2.2.1 LIPA PDN connection establishment
For the LIPA PDN connection established in the attach procedure, similar
changes applied.
Figure A.2.2.1.1: LIPA PDN connection establishment
In comparison with the existing call flow, the following steps need to be
updated:
1\. If the HeNB supports the establishment of LIPA PDN connections to the
standalone L-GW, it includes the LHN‑ID in the S1-AP message.
NOTE 1: if the RAN-based GW selection mechanism is adopted, the L-GW addresses
also need to be included.
2\. If the APN requested is authorized to establish LIPA PDN connection, the
MME selects an L-GW based on the key issue #L2: \"L-GW selection and
addressing\" and stores the LHN-ID.
5, 6, In the Create Session Response message returned to MME, the L-GW
provides the additional L-GW\@LN address per bearer. The MME stores the
received L-GW\@LN address.
The MME sends the Correlation ID per bearer to the HeNB. The Correlation ID is
enhanced to include the L‑GW\@LN address.
After step 7, the HeNB gets the L-GW\@LN address and TEID, it establishes the
Sxx tunnel for the LIPA PDN connection (uplink direction) in parallel with the
S1-U tunnel. For the non-LIPA PDN connection, HeNB sends the packet via the
S1-U tunnel. For the LIPA PDN connection, the HeNB sends the packet via the
Sxx tunnel.
10\. In the Bearer Setup Response message, the HeNB provides the additional
HeNB\@LN address per bearer to the MME, i.e. the HeNB\@CN+HeNB\@LN+TEID
returned to MME.
14a/b. The MME provides the additional HeNB\@LN address/TEID to the L-GW per
bearer via the Change Notification Procedure.
After step 14, the L-GW gets the HeNB\@LN address/TEID information, it
establishes the Sxx tunnel for the LIPA PDN connection (downlink direction) in
parallel with S5 tunnel to SGW. The L-GW sends the packet to the HeNB directly
via the Sxx tunnel.
### A.2.2.2 UE triggered Service Request procedure
Figure A.2.2.2.1: UE triggered Service Request procedure
In comparison with the existing call flow, the following steps need to be
updated:
4\. The MME sends the Correlation ID per bearer to the HeNB. The Correlation
ID is enhanced to include the L‑GW\@LN address.
7\. In the Initial Context Setup Complete message, the HeNB provides the
additional HeNB\@LN address per bearer to the MME.
13a/b. The MME provides the additional HeNB\@LN address/TEID to the L-GW per
bearer via the Change Notification Procedure.
### A.2.2.3 Network triggered Service Request procedure
Figure A.2.2.3.1: Network triggered Service Request procedure
In comparison with the existing call flow, only step 5 needs to be updated
according to description in section A.2.2.2. Others steps are the same as
before.
### A.2.2.4 S1-Release procedure
Figure A.2.2.4.1: S1-Release procedure
In comparison with the existing call flow, the following steps need to be
updated:
7a/b. The MME notifies the L-GW to release the HeNB\@LN address/TEID from the
UE\'s bearer context. After that, the Sxx tunnel is released. If the L-GW
receives the data packet, the network triggered service request procedure will
be triggered.
## A.2.3 Mobility management procedure
### A.2.3.1 Idle state mobility management procedure
For the idle state mobility, the LHN-ID is used for the MME to judge whether
the LIPA PDN connection shall be deleted. Refer to section 5.2.3.3.2, \"LIPA
PDN connection management\".
### A.2.3.2 Connected state mobility management procedure
Editor\'s note: Two control methods are described below, and other options are
FFS. The flows\' use of Modify Bearer Signalling in these options is not
shown.
#### A.2.3.2.1 Option 1: MME control method
##### A.2.3.2.1.1 X2 based handover procedure
Figure A.2.3.2.1.1.1: X2 based handover procedure
In comparison with the existing call flow, the following steps need to be
updated:
At the handover preparation procedure, the source HeNB provides the additional
L-GW\@LN address/TEID information to the target HeNB. The Target HeNB
establishes the Sxx tunnel (local GTP-U tunnel) (uplink direction) to the L-GW
based on that information.
3\. The target HeNB provides additional HeNB\@LN address per LIPA bearer to
the MME in the Path Switch Request message.
4a/b. The MME provides the additional HeNB\@LN address/TEID to the L-GW per
bearer via the Change Notification Procedure.
After step 4a/b, the related HeNB\@LN address/TEID information stored on the
L-GW UE\'s Bearer Context are updated. The L-GW establishes the Sxx tunnel
(local GTP-U tunnel) (downlink direction) and sends the packet to the Target
HeNB.
##### A.2.3.2.1.2 S1 based handover procedure
Figure A.2.3.2.1.2.1: S1 based handover procedure
In comparison with the existing call flow, the following steps need to be
updated:
2\. In the handover required message, the source HeNB provides an additional
LHN-ID to the MME.
5\. The target MME provides the Correlation ID per bearer to the HeNB. The
Correlation ID includes the L‑GW\@LN address/TEID. The Target HNB provides
additional HeNB\@LN address per LIPA bearer to the MME.
After step 13, the target HeNB establishes the Sxx tunnel (local GTP-U tunnel)
(uplink direction) to the L-GW based on the information received in step 5.
17a/b. The MME provides the additional HeNB\@LN address/TEID to the L-GW per
bearer via the Change Notification Procedure.
After step 17, the L-GW establishes the Sxx tunnel (local GTP-U tunnel)
(downlink direction) to the target HeNB based on the information received in
step 17a/b.
#### A.2.3.2.2 Option 2: HeNB in the target side control method
##### A.2.3.2.2.1 X2 based handover procedure
Figure A.2.3.2.2.1.1: X2 based handover procedure
In comparison with the existing call flow, the following steps need to be
updated:
At the Handover Preparation procedure, the source HeNB provides LHN-ID (or the
L-GW\@CN address), and L-GW\@LN address/TEID information to the target HeNB.
The Target HeNB establishes the Sxx tunnel (uplink direction) based on the
L-GW information.
1\. The target HeNB provides additional HeNB\@LN address/TEID per LIPA bearer
to the MME in the Path Switch Request message.
4a/b. The MME provides the additional HeNB\@LN address/TEID to the L-GW per
bearer via the Change Notification Procedure.
After step 4a/b, the related HeNB\@LN/TEID information stored on the L-GW
UE\'s Bearer Context is updated. The L-GW establishes the Sxx tunnel (local
GTP-U tunnel) (downlink direction) and sends the packet to the Target HeNB.
##### A.2.3.2.2.2 S1 based handover procedure
Figure A.2.3.2.2.2.1: S1 based handover procedure
In comparison with the existing call flow, the following steps need to be
updated:
2\. In the Handover required message, the source HeNB provides LHN-ID (or the
L-GW\@CN address), and L-GW\@LN address/TEID information to the source MME.
5\. The target MME provides the Correlation ID per bearer, LHN-ID (or the
L-GW\@CN address) to the target HeNB. The Correlation ID includes the L-GW\@LN
address/TEID.
5a. The target HeNB provides the additional target HeNB\@LN address /TEID to
the MME per LIPA bearer.
After step 13, the target HeNB establishes the Sxx tunnel (local GTP-U tunnel)
(uplink direction) to the L-GW based on the information received in step 5.
17a/b. The MME provides the additional target HeNB\@LN address /TEID to the
L-GW per bearer via the Change Notification Procedure.
After step 17, the L-GW establishes the Sxx tunnel (local GTP-U tunnel)
(downlink direction) to the target HeNB based on the information received in
step 17a/b.
### A.2.3.3 Connected state mobility management procedure---Iurh handover
In the 3G HNB case Iurh handover, the HNB sends the RANAP message to the SGSN
to update the related HeNB\@LN address/TEID information stored on the L-GW
UE\'s Bearer Context.
# A.3 Sxx control plan and user plane
Editor\'s note: details of the procedure for the support of UMTS are FFS.
Figure A.3.1 illustrates the setup of LIPA PDN connection via the UE requested
PDN connectivity request procedure. Similar changes would also apply to setup
of LIPA PDN connection in the attach procedure.
Figure A.3.1: UE requested PDN connectivity for LIPA
The key differences of this flow from the collocated case are:
6\. The L-GW\@LN/CN address of control plane is sent to the HeNB in Bearer
Setup Request message as the content of Correlation ID for establishing the
direct data path between the HeNB and the L-GW. The L‑GW\@LN/CN FQDN also can
be provided to the HeNB instead of L-GW\@LN address of control plane for DNS
query to find appropriate L-GW. In order to correlate the Sxx tunnel with the
S5 tunnel for the same UE, the L-GW\@CN address of user plane and L-GW S5 TEID
should be contained in the Correlation ID.
14\. HeNB sends Create LIPA Session Request message to the L-GW with the
HeNB\@LN address and the TEID of the user plane. It also provides the L-GW S5
TEID and L-GW\@CN address of user plane to the L-GW for correlating the Sxx
tunnel with the appropriate S5 tunnel.
15\. L-GW responds with a Create LIPA Session Response to the HeNB with the
L-GW TEID of the user plane for uplink data.
Figure A.3.2 illustrates the S1 release procedure. Note that similar changes
would also apply to the LIPA PDN connection release procedures.
Figure A.3.2: S1 release procedure with a LIPA PDN connection
In comparison with the existing call flow for S1 Release procedure, the
following steps are worth additional explanation:
7\. The HeNB sends a Delete LIPA Session Request to the L-GW to request the
L-GW to release all HeNB related information (HeNB\@LN address and TEIDs) for
the LIPA PDN connection of the UE. Note that this message does not release any
S5 related resources in the L-GW.
8\. The L-GW releases the HeNB address and TEIDs from the UE's context for the
LIPA PDN connection. The Sxx GTP-U tunnel is now released. The L-GW starts
buffering downlink packets received. On receiving the first DL packet for idle
mode UE, the PGW forwards the first packet to the S-GW which will trigger the
MME to page the UE.
Figure A.3.3 illustrates the LIPA PDN connection handover procedures within
X2-based handover procedure.
Figure A.3.3: LIPA PDN connection handover procedures within X2-based handover
In comparison with the existing call flow for X2-based handover, the following
steps are worth additional explanation:
2\. For each LIPA bearer, the source HeNB includes L-GW\@LN address and TEIDs
for UL data over Sxx.
10\. The target HeNB sends the Modify LIPA Bearer Request message to the L-GW
including the target HeNB\@LN address and TEID for DL traffic over Sxx. Note
that step 10 can happen any time after step 5, there is no need to wait for
step 9.
11\. The L-GW responds with the Modify LIPA Bearer Response message which
contains the L-GW\@LN and TEIDs for UL data traffic.
Figure A.3.4 illustrates the LIPA PDN connection handover procedures within
S1-based handover procedure without MME and SGW change.
Figure A.3.4: LIPA PDN connection handover procedures within S1-based handover
In comparison with the existing call flow for S1-based handover, the following
steps are worth additional explanation:
2\. For each LIPA bearer, the source HeNB includes L-GW\@LN address and TEID
for UL data over Sxx in the source to target transparent container.
Alternatively, MME could send Correlation ID with L-GW\@LN and S5-TEID in step
3. Other options are also possible.
3\. The MME forwards the source to target container to the target HeNB.
11\. The target HeNB sends the Modify LIPA Bearer Request message to the L-GW
including the target HeNB\@LN address and TEID for DL traffic over Sxx.
12\. The L-GW responds with the Modify LIPA Bearer Response message which
contains the L-GW address and TEIDs for UL data traffic.
###### ### Annex B: Architectural details for architecture option 2,
standalone L-GW on Iuh/S1 path
# B.1 3G HNB architecture
## B.1.1 Functional entities
### B.1.1.1 HNB Management System (HMS)
\- Based on TR-069 family of standards;
\- facilitates HNB-GW discovery;
\- provisions configuration data to the HNB or Standalone L-GW;
\- performs location verification of HNB or Standalone L-GW and assigns
appropriate serving elements (HMS, Security Gateway and HNB-GW).
NOTE: The Standalone L-GW appears to the HMS as a HNB -- i.e. no changes are
required on the HMS.
Editor\'s note: It is FFS whether the Standalone L-GW can use the HNB Location
information IE to inform the HMS about its L-GW\@LN IP address; otherwise, the
IP address or a resolvable FQDN would be pre-configured in the HMS.
### B.1.1.2 Security Gateway (SeGW)
\- Terminates Secure tunnelling for TR-069 as well as Iuh;
\- authentication of HNB or standalone L-GW;
\- provides the HNB or Standalone L-GW with access to the HMS and HNB-GW.
NOTE: The Standalone L-GW appears to the SeGW as a HNB -- i.e. no changes are
required on the SeGW.
### B.1.1.3 HNB Gateway (HNB-GW)
\- Terminates Iuh from HNB;
\- appears as an RNC to the existing Core network using existing Iu interface;
\- supports HNB registration and UE registration over Iuh.
### B.1.1.4 HNB
\- Customer Premise Equipment that offers the Uu Interface to the UE;
\- provides RAN connectivity using the Iuh interface;
\- supports RNC-like functions;
\- supports HNB registration and UE registration over Iuh;
\- in case of LIPA support with collocated L-GW, the HNB supports the
following additional functions:
\- transfer of the collocated L-GW IP address of the HNB over Iuh;
\- support of basic GGSN/P-GW functions in the collocated L-GW function by
support of the Gi/SGi interface corresponding to LIPA;
\- support of use of Correlation ID for correlation purposes between the
collocated L-GW function and the HNB,
NOTE: In case of LIPA support with Standalone L-GW on Iuh, no additional
functions are required.
### B.1.1.5 Standalone L-GW on Iuh path
\- Proxy for HNBAP/RANAP signalling between HNB and HNB-GW;
\- for LIPA/SIPTO related bearer signalling over Iuh, the L-GW supports the
following additional functions:
\- transfer of the L-GW\'s IP address for the Gn termination over Iuh,
\- support of basic GGSN/P-GW functions to support the Gi/SGi interface
corresponding to LIPA,
\- support of Correlation ID for correlation purposes allowing internal direct
user plane path (within the L-GW),
\- deactivate the LIPA connection when the UE moves outside the LHN.
\- in Idle mode, support of first packet sending to SGSN/SGW, buffering of
subsequent downlink packets;
\- relays communications between the HNB and the HMS via the SeGW in the Core
Network, when the HNB has been configured to use the L-GW as SeGW (e.g. based
on O&M provisioning at start-up).
## B.1.2 Protocol stacks
### B.1.2.1 Control plane protocol stack
Figure B.1.2.1.1 shows the control plane protocol stack for the Iuh
connectivity via the L-GW.
Figure B.1.2.1.1: Interface protocol stack for Iuh-connectivity via the L-GW
and Gn from SGSN
For the Iuh control plane between the HNB and HNB-GW, the standalone L-GW
located on the Iuh path acts as a SCTP proxy and relays all message by mapping
the HNB\'s IP address and SCTP port to its L-GW\@CN IP address and SCTP port
in the UL and the HNB-GW\'s IP address and SCTP port to its local IP address
and SCTP port in the DL.
The L-GW also acts as a HNBAP/RANAP proxy and relays all messages between the
HNB and HNB-GW:
\- For the LIPA PDP connection activation, the L-GW includes its own address
in the RANAP Initial UE message for the Gn termination in the Direct Transfer
message to the SGSN.
\- To support the direct user plane path within the L-GW located on the Iuh
path, the L-GW checks if the RAB Assignment Request message of RABs belonging
to a LIPA PDP context includes a Correlation ID.
\- To support the user plane path through the L-GW, the L-GW also translates
the HNB-GW\'s IP address and transport layer identifier (e.g. TEID) to its
local address and transport layer identifier in the RAB assignment request
messages, and the HNB\'s IP address and transport layer identifier (e.g. TEID)
to its L-GW\@CN IP address and transport layer identifier in the RAB
assignment response messages.
### B.1.2.2 User plane protocol stack
Figure B.1.2.2.1 shows the user plane protocol stack for the Iuh connectivity
via the L-GW.
Figure B.1.2.2.1: Interface protocol stack for Iuh-connectivity via the L-GW
and Gn from SGSN
For the Iuh user plane between the HNB and HNB-GW, the standalone L-GW located
on the Iuh path acts as a user-plane proxy. The L-GW forwards the user plane
packets between the HNB-GW and HNB.
For RABs that belong to a LIPA PDP context, the L-GW uses the Correlation ID
(provided in the RAB Assignment Request message) to enable the direct user
plane handling in the same way as for the co-located L-GW case defined in
Rel-10.
## B.1.3 Procedures
### B.1.3.1 Standalone L-GW registration
Figure B.1.3.1.1: L-GW registration procedure
2\. The L-GW establishes a secure tunnel to the SeGW of the serving HNB-GW for
this LHN. From the perspective of the SeGW, the L-GW looks like any other HNB.
The SeGW address and security credentials can be configured via O&M.
NOTE: This step may be omitted if the secure tunnel happens to be the same
tunnel that is already established to contact the HMS.
### B.1.3.2 HNB registration in case of a L-GW on the Iuh path
The following section illustrates the case when the HNB registers with a
standalone L-GW located on the Iuh path.
Figure B.1.3.2.1: HNB registration procedure
2a. The HNB establishes a secure tunnel to a pre-configured Security Gateway
in the operator network. The HNB is authenticated by the operator network as
part of this step.
2b. The HNB contacts the HMS for O&M provisioning (incl. location
verification). The HMS determines the serving elements and provides the HNB GW
and Security Gateway to the HNB.
NOTE: The SeGW used initially (for contacting the HMS) can be changed at this
step by the HMS.
2c. The HNB establishes a new secure tunnel to the L-GW of the LHN. From the
perspective of the HNB, the L-GW looks like a SeGW. The L-GW address and
security credentials are configured via the HMS in step 2b or are pre-
configured.
NOTE: This step may be omitted if the initial secure tunnel is already
terminated at the L-GW (e.g. based on pre-configuration).
3a. The HNB sets up an SCTP transport session to a well-defined port on the
serving L-GW. From the perspective of the HNB, the L-GW looks like a HNB-GW.
The L-GW address is configured via the HMS in step 2b or is pre-configured.
3b. The L-GW, who acts as a SCTP proxy on the Iu interface, sets up the
corresponding SCTP transport session to a well-defined port on the serving
HNB-GW. From the perspective of the HNB-GW, the L-GW looks like a HNB.
4\. The HNB then attempts to register with the serving HNB-GW using an HNB
REGISTER REQUEST message.
NOTE: The HNB shall start broadcasting only after successful registration with
the HNB-GW.
### B.1.3.3 UE registration
Figure B.1.3.3.1: UE registration for CSG UEs and CSG or Hybrid HNBs
4\. The HNB attempts to register the UE on the HNB-GW by transmitting the UE
REGISTER REQUEST. The message is proxied by the L-GW, which appears towards
the HNB as the HNB-GW.
5\. The HNB-GW checks UE capabilities and if these indicate that CSG is
supported and if the HNB supports CSG, the HNB-GW may accept the UE
registration and allocate a context-id for the UE.
6\. The HNB-GW responds with a UE REGISTER ACCEPT message back to the HNB
including a context-id allocated to the UE. The message is proxied by the
L-GW, which appears towards the HNB-GW as the HNB.
7\. The HNB then sends a RUA CONNECT message containing the RANAP Initial UE
message. The RANAP Initial UE message may contain the Cell Access Mode. If the
L-GW is operating in LIPA/SIPTO mode, the message is proxied, and the L-GW
will include its L-GW\@CN IP address for the Gn termination in the RANAP
Initial UE message.
### B.1.3.4 LIPA PDP Context Activation procedure
Figure B.1.3.4.1: LIPA PDP Context Activation procedure for Iu mode
This procedure is identical to the PDP Context Activation Procedure according
to TS 23.060 [9], clause 9.2.2.1 with the following difference in step 1:
1\. If the message is being sent via a HNB which has a standalone L-GW located
on the Iuh path, the L-GW includes its L-GW\@CN address for the Gn termination
in the Direct Transfer message to the SGSN.
5\. In Iu mode, RAB setup is done by the RAB Assignment procedure, see clause
\"RAB Assignment procedure\".
The L-GW forwards the RAB assignment request and response messages between the
HNB GW and HNB. Upon receipt of a RAB assignment request, the L-GW changes the
GTP tunnel end point address and TEID of the HNB GW to its local address and a
TEID. Upon receipt of a RAB assignment response, the L-GW changes the GTP
tunnel end point address and TEID of the HNB to its L-GW\@CN address and a
TEID.
### B.1.3.5 LIPA PDP Context Deactivation procedure
The standalone L-GW triggers the LIPA PDP context deactivation procedure when
it detects that the UE moved to a Target-HNB that does not belong to the LHN
or a macro cell. The L-GW deactivates the LIPA PDN based on the GGSN-initiated
PDP Context Deactivation Procedure according to TS 23.060 [9], clause 9.2.4.3.
For handover scenarios based on SRNC relocation, the L-GW monitors the HNBAP
UE Relocation Required messages. When the target cell (HNB or NB) is not part
of the LHN, the L-GW deactivates the LIPA PDP context.
NOTE: Since all HNBs belonging to the LHN of the L-GW establish a secure
tunnel to the L-GW, the L-GW is aware of all HNBs belonging to the LHN.
For Iurh based handover scenarios, the L-GW monitors the HNBAP UE DEREGISTER
messages sent from the HNB GW to the Source-HNB at the end of the handover
procedure. When the target HNB is not part of the LHN, the L-GW deactivates
the LIPA PDP context.
In case the UE moved during idle mode to a target cell that does not belong to
the LHN, the SGSN triggers the LIPA PDN deactivation as defined in Rel-10
based on the SGSN-initiated PDP Context Deactivation procedure according to TS
23.060 [9], clause 9.2.4.2.
### B.1.3.6 HNB to HNB Mobility via Iurh
Different Iurh connectivity options are supported:
\- Direct Iurh interface connectivity between the two involved HNBs.
The HNB-GW and L-GW are not involved at all in Iurh RNL signalling.
\- Iurh interface connectivity between HNBs with the HNB-GW serving as an Iurh
proxy. The HNB-GW acting as an Iurh-proxy appears to a HNB as the peer HNB.
The L-GW proxies all messages in a transparent way for the HNB and HNB-GW.
For this connectivity option, the role of the HNB-GW is transparent with
regards to RNSAP signalling. Conveying respective signalling messages via the
HNB-GW is performed by routing based on information provided by the RNSAP User
Adaptation (RNA) layer.
Figure B.1.3.6.1: HNB to HNB Handover via Iurh interface -- UE involved
1\. Source HNB sends RNA Connect (or RNA Direct Transfer if already in SHO)
containing RNSAP Enhanced Relocation Request message to the identified target
HNB to prepare the Target for a relocation.
2\. Target HNB optionally queries the HNB-GW to perform access control for the
UE that is being handed over. These steps are proxied by the L-GW in a
transparent way to the HNB and HNB-GW.
NOTE 1: This step is optional as the target HNB may not need to query the HNB-
GW if the target HNB has the same CSG Id as the source HNB or if only CSG UEs
are supported
3\. The target HNB updates the transport network layer information for any
RABs that are to be relocated to it by sending a HNBAP TNL Update Request
message to the HNB-GW, the HNB-GW responds with a HNBAP TNL Update Response.
These steps are proxied by the L-GW in a transparent way to the HNB and HNB-
GW. The L‑GW changes the IP address and the GTP TEID of the target HNB to the
L-GW\@CN IP address and the corresponding GTP TEID in the TNL Update Request
message and the HNB-GW's IP address and GTP TEID to the L-GW\'s local IP
address and the corresponding TEID in the TNL Update Response message.
4\. Target HNB sends RNA Direct Transfer containing RNSAP Enhanced Relocation
Response back to the source HNB to indicate that it has successfully prepared
the relocation.
5\. Source HNB sends RNA Direct Transfer containing RNSAP Relocation Commit,
to commit the relocation preparation on the target HNB, this message will
include information to aid the relocation procedure.
6\. Source HNB reconfigures the UE to commence the handover procedure.
7\. At some point later, Layer 1 synchronisation is achieved between the UE
and the target HNB. UE then completes the RRC reconfiguration procedure by
sending an RRC Radio Bearer Reconfiguration Complete message to the target
HNB.
8\. Target HNB indicates to the HNB-GW that the UE has successfully relocated
via the HNBAP UE Relocation Complete. The HNB-GW also switches the user plane
to the target HNB. These steps are proxied by the L-GW in a transparent way to
the HNB and HNB-GW.
9\. The HNB-GW sends the HNBAP UE DEREGISTER to the Source-HNB indicating
\"Successful RNSAP Relocation\". These steps are proxied by the L-GW in a
transparent way to the HNB and HNB-GW.
In case the Target-HNB belongs to a different LHN, the L-GW triggers at this
point the disconnection of the LIPA PDP context based on the GGSN-initiated
PDP Context Deactivation Procedure according to TS 23.060 [9], clause 9.2.4.3.
10\. Source HNB sends an RNA Disconnect containing RNSAP Enhanced Relocation
Signalling Transfer message to the target HNB to transfer any L3 information
that the source HNB may have received during the relocation procedure and
locally releases any resources it has for the UE.
NOTE 2: In the case of GW based HO, the RNA messages are routed via the HNB-
GW.
### B.1.3.7 O&M Provisioning procedure for L-GW
Figure B.1.3.7.1: Provisioning procedure for HNB
1\. A secure tunnel is established from the L-GW to the Security gateway,
whereby the L-GW looks like a HNB towards the SeGW.
2\. Location verification shall be performed by the HMS based on information
sent by the L-GW. HMS determines the serving elements and provides the HNB GW
and Security Gateway to the L-GW.
### B.1.3.8 O&M Provisioning procedure for HNB
Figure B.1.3.8.1: Provisioning procedure for HNB
1\. A secure tunnel is established from the HNB to the Security gateway.
2\. Location verification shall be performed by the HMS based on information
sent by the HNB (e.g. macro neighbour cell scans, global navigational
satellite system type of information etc.). HMS determines the serving
elements and provides the HNB GW and Security Gateway to the HNB.
NOTE: The SeGW used initially (for contacting the HMS) can be changed at this
step by the HMS.
#
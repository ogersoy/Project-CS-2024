# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document describes the stage 2 of the VAS4SMS (Value Added Service
for SMS). It includes:
\- The logic architecture;
\- The logic elements functionality;
\- The signaling flows;
\- The interaction with other features.
The service requirements of VAS4SMS are specified in 3GPP TS 22.142 [2].
The functionality and mechanism of SMS Service is defined in 3GPP TS 23.040
[4].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.142: \"Value Added Services (VAS) for Short Message Service
(SMS) requirements \".
[3] 3GPP TS 22.041: \"Operator Determined Barring (ODB)\".
[4] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[5] 3GPP TS 23.204: \"Support of Short Message Service (SMS) over generic 3GPP
Internet Protocol (IP) access\".
# 3 Definitions
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [x] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[x].
**Loop prevention indication:** a indication set by VAS AS which indicates
that a VAS service has been applied to generate this new message, e.g. message
receipt, auto reply or message forwarding service. This indication is used by
recipients VAS AS to check before also generating a new message to prevent
loops.
**Message transfer** : this term is used for SM transfer between MS and SMS
Node.
**Delivery report** : this term is used to deliver the status report of
original SM between MS and SMS Node..
**VAS check** : this term is used for the SMS Node to inquire the VAS AS if
the VAS of user has activated.
**VAS check response** : this term is used for the VAS AS to reply the result
of VAS check.
**Submit short message** : this term is used for the VAS AS to submit a new
message to the SMS Node.
**Submit short message sesponse** : this term is used for the SMS Node to
acknowledge the submit short message from the VAS AS.
**VAS delivery report** : this term is used for the SMS Node to deliver status
report of the short message from the VAS AS.
**VAS submittal report** : this term is used for the VAS AS to submit a
general status report of the short message which generated by the VAS AS based
on VAS delivery report.
**Relay short message** : this term is used to transfer the short message
between SMS Nodes.
**Delivery status notification** : this term is used to deliver VAS submittal
report between SMS Nodes.
NOTE: Relay short message and Delivery status notification are functionally
equivalent to Message transfer and Delivery report respectively. Different
naming is used to allow different mapping in stage 3 protocols
# 4 VAS-SMS service requirements
## 4.1 General description of VAS-SMS service requirements
As defined in 3GPP TS 22.142[2], the VAS4SMS is an operator specific service
by which an operator enables the subscriber to experience some value-added
service features for SMS.
VAS4SMS features that were defined in stage 1 include:
1) Short Message Forwarding
2) Short Message Forwarding Multiple Subscriptions
3) Short Message Filtering
4) Short Message Receipt
5) Short Message Network Storage
6) Short Message to Multiple Destinations
7) Short Message Virtual Private Network (VPN)
8) Short Message Auto Reply
9) Short Message Personal Signature
10) Short Message Deferred Delivery
VAS4SMS should not negatively affect the normal SMS communication between
calling and called parties.
The service subscriber is able to subscribe to the VAS4SMS service, activate
(or de-activate) the service, and update the settings, e.g., to change by
configure the personalized service related information. The personalized
service information can consist of message signature, the forwarding
destination address and message contents for auto reply, etc.
The VAS4SMS subscriber is able to refine the VAS4SMS behaviour with configured
rules, e.g. time, the identity of the calling party, the SMS forwarding
service is able to act according to the rules.
VAS4SMS is either a terminating network or originating network service. That
is, VAS4SMS can be used by the calling and called subscribers.
In general, services offered by the sender's VAS4SMS occur prior to the SMS
delivering to the recipient's operation.
## 4.2 Operational requirements
### 4.2.1 VAS-SMS Provision/withdrawal
#### 4.2.1.1 General
The VAS4SMS may be provided after prior arrangement with the service provider.
The VAS4SMS may be provided/withdrawn upon the subscriber's request or for
administrative reasons.
#### 4.2.1.2 Requirements on the originating network side
A VAS4SMS application server in the originating network is required to be
under the control of the SMS-SC that is serving a calling subscriber who has
activated VAS4SMS.
#### 4.2.1.3 Requirements on the terminating network side
A VAS4SMS application server in the terminating network is required to be
under the control of the SMS-Route that is serving a called subscriber who has
activated VAS4SMS.
# 5 Architecture and Interface
## 5.1 Architectural requirements
**The network architecture defined for VAS SMS should have less impact on pre-
Rel 8 realization of short message service. The VAS SMS solution shall be able
to be deployed independently of the pre-Rel 8 services. VAS SMS shall not
break pre-Rel 8 services.**
## 5.2 Reference model
### 5.2.1 Logical network architecture
Figure 5.2.1.1 Logical network architecture for VAS4SMS
NOTE: Other SMS related elements (MSC/SGSN etc.) behavior is according to 3GPP
TS 23.040[4].
Editors Notes: the name of the reference point shall be allocated by SA2.
### 5.2.2 Functional entities
**The main functional entities involved in the VAS SMS services provisioning
depicted in figure 5.2.1.1 are described as follows.**
#### 5.2.2.1 **_VAS AS (VAS SMS Application Server)_**
**The VAS AS is an entity in user's HPLMN of which the main requirement with
respect to handling of the VAS4SMS messages is the necessary service logic
handling.**
**The VAS AS informs the SMS Node whether or not it takes over the handling of
a short message. The VAS AS will use a SMS Node for delivery of new or
modified messages.**
**The VAS AS informs the SMS Node about the outcome of its short message
handling.**
**VAS AS may receive the delivery report of the VAS4SMS messages generated by
it from SMS Node**
**If the delivery of SMS is failed,_VAS AS may re-send/resubmit_ the VAS4SMS
messages for several times, subject to operator's configuration**
#### 5.2.2.2 **_SMS node_**
**_SMS Node may be the integration of standard SMS Functional elements defined
in 3GPP TS 23.040[4] depending on HPLMN (MO or MT): SMS-IWMSC, SMS-GMSC, SMS-
SC or SMS Router._**
**_Besides standard SMS functionalities described in TS 23.040 [4] the SMS
Node may support:_**
\- storage of the user subscription indication for the VAS4SMS
\- triggering a short message to VAS AS, if a user has VAS4SMS subscription
\- receiving a short message from VAS AS which is generated based on a
previously triggered short message
\- submitting a short message which comes from VAS AS to the PLMN
\- receiving a report from PLMN and forwarding it to VAS AS
\- receiving a report from VAS AS
**_In case the communication between the SMS Node and VAS AS fails, the SMS
Node proceeds as if the user hasn't subscribed the VAS4SMS._**
#### 5.2.2.3 Service Portal Function (SPF)
**_The SPF provides the means to VAS SMS subscription,_** activation &
deactivation, configuration** _. The detailed information for these operations
is described in section 6. After a user subscribing a VAS4SMS, the portal
should support the capability to synchronize the user setting information to
VAS AS._**
#### 5.2.2.4 **_Billing and Charging Function (BCF)_**
**_BCF plays the role of receiving the call detail record (CDR) information
from the VAS AS._**
**_The other function entities in figure 5.2.1.1 shall follow 3GPP TS
23.040[4], which is outside the scope of this specification._**
### 5.2.3 Interfaces
**_As illustrated in figure_ 5.2.1.1*, following interfaces are defined:***
  * **_Rf-a: Rf-a is the interface between VAS AS and SMS Node. The VAS AS shall be able to influence and impact the SMS procedure on behalf of the services and it uses Rf-a interface to communicate with SMS Node.The SMS Node shall decide whether the information related to an incoming SMS is needed to send to the VAS AS and VAS AS shall make the SMS Node aware of any resulting activity. Rf-a shall also support to transfer the delivery result between VAS AS and SMS Node._**
  * **_Rf-b: Rf-b is the interface between two SMS Nodes. The Rf-b interface is used for message transferring between two PLMSs._**
  * **_Rf-c: Rf-c is the interface between VAS AS and Charging and Billing Function (BCF). The Rf-c is used for the VAS AS to transfer the CDR information to the BCF._**
  * **_Rf-d: Rf-d is the interface between VAS AS and Service Portal Function (SPF). Rf-d is used to synchronize the user setting and subscription information from SPF to VAS AS_**
# 6 VAS-SMS service provisioning, activation & deactivation, configuration
### 6.1 Activation/deactivation
The VAS-SMS service is activated at provisioning and deactivated at
withdrawal.
A subscriber can subscribe all the VAS-SMS service features as a whole or make
the subscription to every feature separately, which is subject to operator's
policy. When a VAS-SMS service is activated, a subscriber can specify some
configuration for each subscribed service feature, such as the destination
address which short messages shall be forwarded to.
After a subscriber has activated their VAS-SMS service, all short messages
related to him shall be handled according to his service configuration.
### 6.2 Configuration
Different methods may be provided for configuration of VAS-SMS service, e.g.
such as short message, IVR and etc. It is out of the scope of this document to
specify the configuration procedure itself.
# 7 VAS-SMS signalling procedure
## 7.0 General Signalling Procedure
### 7.0.1 Originating Signalling flows
Figure 7.0.1-1 General Short Message submittal procedures without active
originating VAS
1\. MS successfully sends the message to the SMS Node via the originating
user\'s serving node (MSC or SGSN). See 3GPP TS 23.040[4] for details.
2\. After checking out that the originating user has subscribed VAS, the SMS
Node A interacts with the VAS AS A to interrogate whether the VAS of the
originating user is active by sending an inquiring message including the
message content received in step 1. In that case the SMS Node shall save the
original short message.
3\. The VAS AS A indicates to the SMS Node A that there is no active
originating VAS for the originating user.
4\. The SMS Node A transfers the original short message to the termination
side.
5\. The termination side responds the delivery report to SMS Node to notify
that the short message has been delivered successfully. In that case the SMS
Node deletes the original short message which was saved in step 2.
6\. The SMS Node A send the status report to the MS, which is optional
depending on user's request.
Figure 7.0.1-2 General Short Message submittal procedures with active
originating VAS
1\. MS successfully sends the message to the SMS Node A via the originating
user\'s serving node (MSC or SGSN). See 3GPP TS 23.040[4] for details.
2\. After checking out that the originating user has subscribed VAS, the SMS
Node A interacts with the VAS AS A to interrogate whether originating VAS is
active by sending an inquiring message including the message content received
in step 1. In that case the SMS Node shall save the original short message.
3\. The VAS AS A indicates to the SMS Node A that originating VAS is active.
4\. The VAS AS A performs originating VAS for the original user and generates
a new short message by modifying the message content if necessary and submits
the new short message to SMS Node A for transferring.
NOTE: It is assumed that after this step VAS AS A has executed the service
logic for all originating services.
5\. The SMS Node A sends a Submit short message response message to the
Originating VAS AS A.
6\. The SMS Node A shall not check for VAS services for messages that are
submitted by a VAS AS A. The SMS Node A successfully transfer the new short
message to the termination side.
7\. The termination side sends the delivery status notification to SMS Node A
to notify the new short message has been delivered successfully.
8\. The SMS Node A transfers the delivery status notification as the VAS
delivery report to the originating VAS AS A .
9\. The originating VAS AS A generates a general delivery report based on the
report which received in step 8 and sends it to the SMS Node A. The SMS Node
removes the original short message which was saved in step 2 when it receives
the VAS submittal report from the VAS AS A.
10\. The SMS Node A delivers the status report to originating MS, which is
optional depending on originating user's request.
### 7.0.2 Terminating signalling flows
Figure 7.0.2-1 General Short Message delivery procedures without active
terminating VAS
1-2. SMS Node B receives the forwarded short message from the originating side
and responds by sending an acknowledge message.
3\. After checking out that the terminating user has subscribed VAS, the SMS
Node B interacts with the VAS AS B to interrogate whether terminating VAS is
active by sending an inquiring message including the message content received
in step 1. In that case the SMS Node B shall save the short message.
4\. The VAS AS B indicates to the SMS Node B that there is no active
terminating VAS for the terminating user.
5-6.The SMS Node B successfully transfers the short message to the terminating
MS B via MSC/SGSN and receives the Delivery report messages. In that case the
SMS Node B removes the short message which was saved in step 3.
7\. The SMS Node B notifies the originating side of the delivery status.
Figure 7.0.2-2 General Short Message delivery procedures with active
terminating VAS
1-2. SMS Node B receives the forwarded short message from the originating side
and responds by sending an acknowledge message.
3\. After checking out that the terminating user has subscribed VAS, the SMS
Node-B interacts with the VAS AS B to interrogate whether terminating VAS is
active by sending an inquiring message including the message content received
in step 1. In that case the SMS Node B shall save the short message.
4\. The VAS AS B indicates to the SMS Node B that there is active terminating
VAS for the terminating user.
5\. The VAS AS performs terminating VAS and generates a new short message by
modifying the message content if necessary and submits the new short message
to SMS Node B for transferring.
NOTE 1: It is assumed that after this step VAS AS has executed the service
logic for all terminating services.
6\. The SMS-Node B sends a response message to the VAS AS B.
7-8. The SMS Node B shall not check for VAS services for messages that are
submitted by a VAS AS B. The SMS Node B delivers the short message to the MS
via MSC/SGSN and receives the ACK messages.
9\. The SMS Node B transfers the delivery report to the VAS AS B.
10\. The VAS AS B generates a delivery report of the short message for the
originating user based on the report which received in step 9 and sends to SMS
Node B.
11\. The SMS Node B notifies the originating side of the delivery status. In
that case the SMS Node B removes the short message which was saved in step 3.
NOTE 2: Depending on the stage 3 protocol used, for VAS services where step 11
exceeds the allowed response time, a report of delivery status may be returned
after step 4. This does not inform SMS Node A of the actual delivery outcome.
Depending on the capabilities of the stage 3 protocol PLMN A may request a
separate delivery report to be informed of the final delivery status.
## 7.1 Short Message forwarding
The short message forwarding shall be a service feature only active for
terminating user. The signaling procedure in originating side network shall
not be affected for whether the message forwarding is active or not.
The figures in this section describe the following possible scenarios when
short message forwarding is active:
\- a short message is forwarded to an address which is specified by
terminating user other than called number.
\- a short message is not forwarded subject to terminating user's
configuration
Figure 7.1-1 Terminating signaling flow - Short Message is forwarded
NOTE1: The content of the VAS4SMS message in operation 5 is the same as the
original SMS, only the destination address shall be changed to forwarded-to
number.
1-4. See general flow described in the previous chapter 7.0. The VAS AS B
checks that a terminating user has activated short message network forwarding
service and indicates to the SMS Node B there is terminating VAS active.
5\. According to user B's preferences, the VAS AS B decides the message needs
to be forwarded to MS C. The VAS AS B takes a loop check for original SM. If
there is a loop prevention indication set in the SM, the VAS AS B shall not
apply short message forwarding service and do not go to following steps.
6-10.The VAS AS B delivers the original short message to the MS C after
including a loop prevention indication.
11\. The VAS AS B generates a report of the short message and sends it to SMS
Node B.
12\. The SMS Node B notifies the originating side of the delivery status.
Figure 7.1-2 Terminating signaling flow - Short Message is not forwarded
NOTE2: The VAS4SMS message in operation 5 is the same as the original SM.
1-4. See general flow described in the previous chapter 7.0. The VAS AS B
checks that a terminating user has activated short message forwarding service
and indicates to the SMS Node B there is terminating VAS active.
5\. According to user B's preferences, the VAS AS B decides the message needs
not to be forwarded.
6-10.The VAS AS B delivers the original short message to the terminating user.
See general flow described in the previous chapter 7.0.
11\. The VAS AS B generates a report of the short message and sends it to SMS
Node B.
12\. The SMS Node B notifies the originating side of the delivery status.
## 7.2 Short Message forwarding multiple subscriptions
Short Message Forwarding Multiple Subscriptions is applicable for the
terminating user. In this case, the VAS AS checks that the terminating user
has activated the Short Message Forwarding Multiple Subscriptions service and
shall send the original short message to multiple receivers based on the
subscription information. The procedure of Short Message Forwarding Multiple
Subscriptions described in the following figure 7.2-1.
Figure 7.2-1 Short Message forwarding to multiple subscriptions procedure
1.-3. The short message is transferred from the originating user to
terminating sides' SMS Node B. After checking out that the terminating user
has subscribed VAS, the SMS Node B interacts with the VAS AS to interrogate
whether the VAS of the terminating user is active by sending an inquiring
message including the message content received in step 1. In that case the SMS
Node shall save the original short message.
4\. The VAS AS performs the short message forwarding to multiple subscriptions
service and generates new short messages based on the original short message
for each subscription.
5-6. The SMS Node B receives a short message to MS-1 and sends the Submit
short message response to the VAS AS B.
7-8. The SMS Node B receives a short message to MS-n and sends the Submit
short message response to the VAS AS B.
9-10. The SMS node B delivers the short message to MS-1 and relay the delivery
report received from MS-1 to the VAS AS. These steps can happen at any time
after step 6.
11-12. The SMS node B delivers the short message to MS-n and relay the
delivery report received from MS-n to the VAS AS. These steps can happen at
any time after step 6. There is no sequence requirement of sending short
message for SMS Node, i.e. the SMS Node can send the short message in
parallel.
13\. The VAS AS generates a general delivery report based on all the delivery
reports it receives and sends it to SMS Node B.
14\. The SMS Node B notifies the originating side of the delivery status.
## 7.3 Short Message filtering
The short message filtering shall be a service feature only active for
terminating user. The signaling procedure in originating side network shall
not be affected for whether the message filtering is active or not.
The figures in this section describe the following possible scenarios when
short message filtering is active:
-a short message is filtered subject to terminating user's configuration, such as a terminating user would not like to receive the message coming from a certain user.
-a short message is not filtered subject to terminating user's configuration.
Figure 7.3-1 Terminating signaling flow - Short Message is filtered
NOTE 1: In step 6, whether the delivery result is failure or success is
subject to operator's configuration
NOTE 2: Appropriate failure codes for the status notification have to be
selected carefully to avoid the unnecessary retries.
1-4. See general flow described in the previous chapter 7.0. The VAS AS B
checks that a terminating user has activated short message filtering service
and indicates to the SMS Node B there is terminating VAS active.
5\. According to user B's preferences, the VAS AS B decides the message needs
to be filtered.
6\. The VAS AS B generates a report of the short message and sends it to SMS
Node B. The delivery result in report is based on the configuration of user B
or operator.
7\. The SMS Node B notifies the originating side of the delivery status.
Figure 7.3-2 Terminating signaling flow - Short Message is not filtered
NOTE: The VAS4SMS message in step 5 is the same as the original SM.
1-4. See general flow described in the previous chapter 7.0. The VAS AS B
checks that a terminating user has activated short message filtering service
and indicates to the SMS Node B there is terminating VAS active.
5\. According to user B's preferences, the VAS AS B decides the message needs
not to be filtered.
6-10.The VAS AS B delivers the original short message to the terminating user.
See general flow described in the previous chapter 7.0.
12\. The VAS AS B generates a report of the short message and sends it to SMS
Node B.
13\. The SMS Node B notifies the originating side of the delivery status.
## 7.4 Short Message receipt
Short Message Receipt is a terminating VAS. The procedure of the short message
receipt refers to the general flow for VAS SMS described in the sub-clause
7.0.2. The VAS AS checks that the terminating user has activated the Short
Message Receipt service and generates a new short message as the receipt of
original message.
Figure 7.4-1 Short Message receipt procedure
1-4. See general flow described in the previous chapter 7.0. The VAS AS B
checks that a terminating user has activated short message receipt service and
indicates to the SMS Node B there is terminating VAS active.
5\. According to user B's preferences, the VAS AS B decides a message receipt
is needed and shall be sent to user A. The VAS AS B takes a loop check for
original SM. If there is a loop prevention indication set in the SM, the VAS
AS B shall not apply short message receipt service and do not go to following
steps.
6-9. The VAS AS B delivers the original short message to the terminating user.
See general flow described in the previous chapter 7.0.
10\. The VAS AS B generates a receipt short message, based on the report
received in step 9 and terminating user's preferences. The receipt message
shall include a loop prevention indication that indicating it is a message
generated for message receipt service of user B.
11-14. The VAS AS B delivers the message receipt to the originating user. See
general flow described in the previous chapter 7.0.
15\. The VAS AS B generates a report of the short message and sends it to SMS
Node B.
16\. The SMS Node B notifies the originating side of the delivery status.
## 7.5 Short Message network storage
The short message storage can be active to both originating and terminating
user.
Figure 7.5-1 Originating signaling flow - Short Message storage
NOTE: The VAS4SMS message in operation 4 is the same as the original SM.
1-3. See general flow described in the previous chapter 7.0. The VAS AS A
checks that a originating user has activated short message network storage
service and indicates to the SMS Node A there is originating VAS active.
4\. The VAS AS A decides that the original SMS shall be stored based on
originating user's preferences.
5-9. The VAS AS A delivers the original short message to the terminating user.
See general flow described in the previous chapter 7.0.
10\. VAS AS A stores the original SMS and relevant information for originating
user.
11\. The VAS AS A generates a delivery report for the original short message
based on the report which received in step 9 and sends to SMS Node A.
12\. The SMS Node A sends the status report to UE, which is optional depending
on user's request.
Figure 7.5-2 Terminating signaling flow - Short Message storage
NOTE 1: The VAS4SMS message in operation 5 is the same as the original SM.
NOTE 2: Depending on the stage 3 protocol used, for VAS services where step 12
exceeds the allowed response time, a report of delivery status may be returned
after step 4. This does not inform SMS Node A of the actual delivery outcome.
Depending on the capabilities of the stage 3 protocol PLMN A may request a
separate delivery report to be informed of the final delivery status.
1-4. See general flow described in the previous chapter 7.0. The VAS AS B
checks that a terminating user has activated short message network storage
service and indicates to the SMS Node B that the terminating VAS is active.
5\. The VAS AS B decides that the original SMS shall be stored based on
terminating user's preferences.
6-9.The VAS AS B delivers the original short message to the terminating user.
See general flow described in the previous chapter 7.0.
10\. The VAS AS B stores the SMS and relevant information for terminating
user.
11\. The VAS AS B generates a report of the short message and sends it to SMS
Node B.
12\. The SMS Node B notifies the originating side of the delivery status.
## 7.6 Short Message to multiple destinations
In order to support short message to multiple destinations service it is
needed for one user to establish a SMS group which is identified by a unique
identifier in the VAS AS firstly. The SMS Group ID shall be allocated by VAS
AS uniquely and be known by all the members of the SMS group. A SMS group also
can be deleted by creator. There may be many ways to manage a SMS group, i.e.
create or delete or query a SMS group which is out of the scope of this
specification.
When the SMS group is established, every group member can send the short
message to all other members in this group by setting the destination to the
unique identifier of the SMS group. The procedure of sending message to
multiple destinations is described in the following figure 7.6-1.
Figure 7.6-1 Short Message to multiple destinations service procedure
1.-3. These steps are identical to step 1 to 3 of the general message flow
described in sub-clause 7.0. SMS Group ID shall be included in the short
message and identified by recipient address.
4\. The VAS AS performs a short message to multiple destinations service and
generates new short messages with the same content as the original short
message.
5.-14. The VAS AS separately submits the short message to the SMS Node A with
different destination address. These destinations should be all other
recipients within the SMS group. There is no sequence requirement of sending
short message for VAS AS, i.e. the VAS AS can send the short message in
parallel. The SMS Node A receives a delivery report from each receiving MS and
relays it to the VAS AS. The VAS AS generates a general delivery report based
on the results of the delivery reports from each recipient.
15.-16. The general delivery report is sent from VAS AS to SMS Node A and
transferred to the sending MS by SMS Node if possible.
## 7.7 Short Message Virtual Private Network (VPN)
The originating user and the terminating user are in the same VPN and support
sending messages to local numbers in the VPN. The local number may be a short
number which is bound to mobile number. The mapping table with local number to
mobile number shall be stored in the VAS AS. The VAS AS receiving a checking
message from SMS Node checks that the originating user activating VPN service,
then replace local number by terminating user's mobile number.
Figure 7.7-1 Short Message Virtual Private Network procedure
1\. The SMS Node A receives a short message to local number from MS and need
ask the VAS AS to check whether the originating user has activated VAS.
2.-3. The VAS AS checks that the originating user has activated VPN service
and the destination is a local number. The VAS AS indicates the SMS Node there
is active originating VAS for originating user.
4\. The VAS AS replaces the local number by its mobile number and continues
according to the general procedure described in sub-clause 7.0 step 4 and
following.
## 7.8 Short Message auto reply
Short Message Auto Reply is a terminating VAS. The procedure of the short
message auto reply refers to the general flow for VAS SMS described in the
previous sub-clause 7.0. The VAS AS checks that the terminating user has
activated the Short Message Auto Reply service and generates an auto reply
short message which contents have been defined in advance, then deliver it to
the originating user.
Figure 7.8-1 Short Message auto reply procedure
NOTE: There is no requirement of the sequence for which one of auto reply
message or original SM should be sent firstly in the VAS AS, i.e. auto reply
message can be sent before or after original SM.
1.-4. See general flow described in the previous chapter 7.0. The VAS AS
checks that a terminating user has activated short message auto reply service
and indicates to the SMS Node B there is terminating VAS active.
5\. The VAS-AS B checks a loop prevention indication within the message. If
the loop prevention indication is not set, then the VAS AS B generates an auto
reply short message and set the loop prevention indication within the auto
reply short message to indicate a spawned message. Otherwise an auto reply
short message shall not be generated. The VAS AS B stores the original short
message for next delivery.
6.-7. The VAS AS B delivers a short message which is indicated as an auto
reply message to the SMS Node B.
8.-9. The auto reply short message is delivered to the originating user. See
3GPP TS 23.040[4] for details.
10\. The VAS AS B receives a delivery report for auto reply message delivery.
11.-17. The VAS AS B continues to deliver the original short message to the
terminating user. See general flow described in the previous chapter 7.0.
## 7.9 Short Message personal signature
Short Message Personal Signature service is applicable for the originating
user. In this case, the VAS AS checks that the originating user has activated
the Short Message Personal Signature service and shall append the user's
personal signature to the short message. The Short Message Personal Signature
procedure refers to the general procedure for VAS SMS which described in the
previous chapter 7.0.
Short message personal signature should be appended in the last concatenated
message for a large message need to be separated into concatenated messages.
## 7.10 Short Message deferred delivery
Short Message Deferred Delivery service allows the user to set the short
message delivery time. In this case the VAS AS checks that the originating
user has activated the short message deferred delivery service. The VAS AS
shall store the short message and set the timer to deferred delivery time. The
short message should be sent when the timer times out. The deferred delivery
time should be determined by the originating user. The service procedure
refers to the general flow for VAS SMS which described in the previous chapter
7.0.
NOTE 1: Short message deferred delivery time can be set in many ways by the
originating user, e.g. via Ut interface.
NOTE 2:.Deferred delivery capability may be provide in SMS Node, however it is
out of the scope of this specification.
# 8 Interaction with other features
## 8.1 Interaction with barring services
Barring services described in 3GPP TS 23.040[4] are prior to VAS-SMS services.
Any related VAS-SMS service to Operator Determined Barring (see 3GPP TS 22.041
[3]) is not applicable when Operator Determined Barring applies to the Short
Message Service. For example, if an originating service for SMS is barred by
ODB and a terminating service for SMS is not barred, all the related
originating services for VAS-SMS service are also barred, but terminating
services (e.g. SMS forwarding) for VAS-SMS are not impacted.
## 8.2 Interaction with multiple Short Message transfer
There is no direct conflict between the VAS-SMS service and the multiple short
message transfer service described in 3GPP TS 23.040[4]. VAS-SMS services
shall not impact the implementation of the multiple short message transfer
service when the SMS-SC indicates to the SMS-GMSC that there are more messages
to send for each message waiting in the service centre.
## 8.3 Interaction with SMS COMPRESSION
VAS-SMS services should be applicable for the SMS COMPRESSION described in
3GPP TS 23.040[4]. If the VAS-SMS service does not support SMS COMPRESSION
(for example for VAS-SMS services that modify the content of a SM), then it
shall guarantee the compressed SMS message delivery as normal.
## 8.4 Interaction with Enhanced Messaging Service
For the enhanced messaging service described in 3GPP TS 23.040[4], VAS-SMS
services should be applicable. If the VAS-SMS service does not support the
enhanced messaging service (for example for VAS-SMS services that modify the
content of a SM), then it shall guarantee enhanced message delivery as normal.
## 8.5 Interaction with SM delivery report
If a Short Message Receipt service is applied the SMS Node shall not send SM
delivery report message to the user.
## 8.6 Interaction with charging
VAS-SMS services are required to produce billing of extra fee (e.g. monthly
based function fee).
## 8.7 Interaction between VAS-SMS services
VAS-SMS services should be classified by priority and triggered according to
priority order based on operator's policy.
# 9 Interworking with other networks
The network architecture defined for VAS SMS is based on cellular networks.
3GPP TS 23.204 [5] specifies how to deliver SMS over generic 3GPP IP access.
The theory of interworking with IP based network for VAS SMS is the same as
normal SMS; refers to 3GPP TS 23.204 [5].
NOTE: Application of VAS services is triggered from either an SMS-SC or an SMS
Router. As a consequence, for interworking in the originating side, both
originating and terminating VAS services can be applied. For interworking in
the terminating side the terminating VAS services can be applied subject to an
SMS Node being involved in the message flow.
#
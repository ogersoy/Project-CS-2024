# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document provides the stage 3 specification of the Sy reference
point for the present release. The functional requirements and the stage 2
specifications of the Sy reference point are contained in TS 23.203 [2]. The
Sy reference point lies between the Policy and Charging Rule Function (PCRF)
and the Online Charging System (OCS). The internal OCS functionality for
policy counter provision management pertaining to Sy is specified in TS 32.296
[16].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.203: \"Policy Control and Charging architecture\".
[3] IETF RFC 3588: \"Diameter Base Protocol\".
[4] IETF RFC 4005: \"Diameter Network Access Server Application\"
[5] IETF RFC 4006: \"Diameter Credit Control Application\".
[6] IETF RFC 5719: \"Updated IANA Considerations for Diameter Command Code
Allocations"
[7] IETF RFC 2234: \"Augmented BNF for syntax specifications\".
[8] 3GPP TS 29.213: \"Policy and charging control signalling flows and Quality
of Service (QoS) parameter mapping\".
[9] 3GPP TS 23.335: \"User Data Convergence (UDC); Technical realization and
information flows; Stage 2\".
[10] 3GPP TS 29.335: \"User Data Convergence (UDC); User Data Repository
Access Protocol over the Ud interface; Stage 3\".
[11] Void.
[12] Void.
[13] IETF RFC 791: \"Transmission Control Protocol\".
[14] IETF RFC 4960: \"Stream Control Transmission Protocol\".
[15] 3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol\".
[16] 3GPP TS 32.296: \"Telecommunication management; charging management;
Online Charging System (OCS) applications and interfaces\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**policy counter:** A mechanism within the OCS to track spending applicable
for a subscriber.
**policy counter identifier:** A reference to a policy counter in the OCS for
a subscriber.
**policy counter status:** A label whose values are not standardized and that
is associated with a policy counter\'s value relative to the spending limit(s)
(the number of possible policy counter status values for a policy counter is
one greater than the number of thresholds associated with that policy counter,
i.e policy counter status values describe the status around the thresholds).
This is used to convey information relating to subscriber spending from OCS to
PCRF. Specific labels are configured jointly in OCS and PCRF.
**spending limit:** A spending limit is the usage limit of a policy counter
(e.g. monetary, volume, duration) that a subscriber is allowed to consume.
**spending limit report:** a notification, containing the current policy
counter status generated from the OCS to the PCRF via the Sy reference point.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
OCS Online charging system
OFCS Offline charging system
PCEF Policy and Charging Enforcement Function
PCRF Policy and Charging Rule Function
SLA Spending-Limit-Answer (SL-Answer)
SLR Spending-Limit-Request (SL- Request)
SNA Spending-Status-Notification-Answer (SN-Answer)
SNR Spending-Status-Notification-Request (SN- Request)
STA Session-Termination-Answer (ST-Answer)
STR Session-Termination-Request (ST- Request)
# 4 Sy reference point
## 4.1 Overview
The Sy reference point is located between the Policy and Charging Rules
Function (PCRF) and the Online Charging System (OCS). The Sy reference point
enables transfer of policy counter status information relating to subscriber
spending from OCS to PCRF and supports the following functions:
\- Request of policy counter status reporting from PCRF to OCS and subscribe
to or unsubscribe from spending limit reports (i.e. notifications of policy
counter status changes).
\- Notification of spending limit reports from OCS to PCRF.
\- Cancellation of spending limit reporting from PCRF to OCS.
Since the Sy reference point resides between the PCRF and OCS in the HPLMN,
roaming with home routed or visited access as well as non-roaming scenarios
are supported in the same manner.
The stage 2 level requirements for the Sy reference point are defined in TS
23.203 [2].
Signalling flows related to the Sy interface are specified in TS 29.213 [8].
## 4.2 Sy Reference model
The Sy reference point is defined between the PCRF and the OCS. The
relationships between the different functional entities involved are depicted
in figures 4.2.1 and 4.2.2.
Figure 4.2.1: Sy reference point at the Policy and Charging Control (PCC)
architecture with SPR
With the UDC-based architecture, as defined in TS 23.335 [9] and applied in TS
23.203 [2], the UDR replaces SPR and the Ud reference point provides access to
the subscription data in the UDR. The Ud interface as defined in TS 29.335
[10] is the interface between the PCRF and the UDR The relationships between
the different functional elements are depicted in figure 4.2.2. When UDC
architecture is used, SPR and Sp, whenever mentioned in this document, is
replaced by UDR and Ud.
Figure 4.2.2: Sy reference point at the Policy and Charging Control (PCC)
architecture with UDR
NOTE 1: The details associated with the Sp reference point are not specified
in this Release. The SPR's relation to existing subscriber databases is not
specified in this Release.
NOTE 2: The UDC Application Informational Model related to the PCRF is not
specified in this Release.
NOTE 3: PCEF is located in the Gateway node implementing the IP access to the
PDN. Refer to annexes of TS 23.203 [2] for application to specific IP-CAN
types.
NOTE 4: Refer to annexes A.5 and H.2 of TS 23.203 [2] for application of AN-
Gateways.
## 4.3 Subscriber Spending Limits
Policy decisions based on spending limits is a function that allows the PCRF
to make policy decisions based on the status of policy counters that are
maintained in the OCS. The PCRF uses the policy counter statuses received from
the OCS as input to its policy decisions, e.g. downgrade the QoS (e.g. APN-
AMBR) or modify the PCC/QoS/ADC Rules.
When the status of policy counters is first required to make a policy decision
for a subscriber, the PCRF uses the Initial Spending Limit Report Request
procedure. The PCRF may request specific or all policy counter statuses to be
reported by the OCS for the user. The OCS provides the status to the PCRF of
the requested policy counters, and will notify the PCRF of any changes in the
status of those policy counters. Optionally, the OCS can provide one or more
pending statuses for a requested policy counter with the times that have to be
applied. The pending status of a policy counter shall autonomously become the
current status of a policy counter at the PCRF when the indicated
corresponding time is reached. Subsequently, the provided information for
pending statuses of a policy counter shall overwrite the previously received
information.
NOTE 1: The mechanism for provisioning the policy counters in the OCS is out
of scope of this document.
NOTE 2: A policy counter in the OCS can represent the spending for one or more
services, one or more devices, one or more subscribers, etc. The
representation is operator dependent. There is no explicit relationship
between Charging-Key and policy counter.
The PCRF may request reporting for specific policy counter(s) that it is not
currently subscribed and/or cancel reporting for specific policy counter
status(es) using the Intermediate Spending Limit Report Request. The PCRF may
cancel spending limit reporting for all policy counter(s) using the Final
Spending Limit Report Request.
The updated subscriber profile may also trigger the PCRF sending the
Initial/Intermediate/Final Spending Limit Report Request to the OCS to
subscribed and/or cancel reporting for policy counter status(es). If spending
limit reporting for a policy counter is enabled, the OCS shall notify the PCRF
of changes in the status of this policy counter (e.g. daily spending limit of
\$2 reached) and optionally pending statuses of this policy counter with the
activation time (e.g. due to a billing period that will expire at midnight).
## 4.4 Functional elements
### 4.4.1 PCRF
The Policy Control and Charging Rules Function (PCRF) is a functional element
that encompasses policy control decision and flow based charging control
functionalities.
The PCRF may take information on the subscriber\'s spending status into
account in its policy decisions. The PCRF may request spending limit reporting
for policy counters from the OCS using the Initial or Intermediate Spending
Limit Report Request procedure as specified in clause 4.5.1. The PCRF may
cancel spending limit reporting for specific policy counter(s) using the
Intermediate Spending Limit Report Request procedure, or for all policy
counter(s) using the Final Spending Limit Report Request procedure as
specified in clause 4.5.3.
The PCRF shall have at least one active IP-CAN session to be able to initiate
an Sy session to be used when required for spending limit reporting for that
subscriber. The PCRF shall terminate the Sy session when the last IP-CAN
session for that subscriber is terminated or no IP-CAN session for the same
user depends on the spending status information provided over Sy reference
point.
The PCRF may use the status of each relevant policy counter as input to its
policy decision as required by the decision logic.
### 4.4.2 OCS
The Online Charging System (OCS), for the purpose of policy decisions based on
the subscriber\'s spending, shall
  * maintain the policy counter statuses applicable for a subscriber
  * report the policy counter status values for the subscriber when requested to the PCRF
  * when a policy counter status changes, report the change to the PCRF
## 4.5 Spending Limits procedures over Sy reference point
### 4.5.1 Initial/Intermediate Spending Limit Report Request
#### 4.5.1.1 General
This procedure shall be used by the PCRF to request the status of policy
counters available at the OCS, and to subscribe or unsubscribe to updates of
policy counters by the OCS.
This procedure is mapped to the Spending-Limit-Request/Answer commands
specified in section 5.6.
Table 4.5.1.1/1: Initial/Intermediate Spending Limit Report Request
* * *
Information element name Mapping to Diameter AVP Cat. Description User
Identity Subscription-Id C This IE shall contain the identity of the user. It
shall be present in the initial request when the SL-Request-
Type=INITIAL_REQUEST. Request Type SL-Request-Type M This IE shall indicate
whether this is the initial or a subsequent request for the user. Subscribed
Policy Counter Identifier List Policy-Counter-Identifier O This IE shall
indicate the list of policy counter identifiers to be subscribed to. In the
intermediate spending limit report request procedure, this list overrides a
previously provisioned list. If omitted in either the Initial or Intermediate
Spending Limit Report Request procedures the PCRF requests subscription to all
available policy counters.
* * *
Table 4.5.1.1/2: Initial/Intermediate Spending Limit Report Response
* * *
Information element name Mapping to Diameter AVP Cat. Description Policy
Counter Status Report Policy-Counter-Status-Report O If present, this
information element shall contain a policy counter identifier, the current
status value and if applicable pending policy counter statuses with the
activation times. Result Result-Code or Experimental-Result M This IE shall
contain the result of the operation.
* * *
#### 4.5.1.2 Detailed behaviour of the PCRF
The PCRF shall make use of this procedure when it determines for a subscriber
that
\- The status of policy counter(s) to which the PCRF does not have an existing
subscription for status change notifications is/are required.
\- The status of one or more, but not all, policy counter(s) to which the PCRF
has an existing subscription for status change notifications are no longer
required.
NOTE: The Final Spending Limit Request procedure in clause 4.5.3 is used to
remove all subscriptions.
In the initial request, i.e. when the request is sent for the first time for
the Subscriber, the PCRF shall set the SL-Request-Type AVP to the value
INITIAL_REQUEST (0). For subsequent requests for the same Subscriber, the PCRF
shall set the SL-Request-Type AVP to INTERMEDIATE_REQUEST (1).
For each policy counter that the PCRF requires the current status and
notifications of future status changes, the PCRF shall indicate the concerned
policy counter identifiers in the request. Alternatively, the policy counter
identifiers may be omitted if the PCRF requires the current status and
notifications of future status changes of all available policy counters.
#### 4.5.1.3 The behaviour of the OCS
Upon reception of the request from the PCRF, the OCS shall check if there is
an ongoing Sy session associated with the received Session-Id AVP. If there is
no Sy session and the SL-Request-Type AVP is set to INITIAL_REQUEST (0), an Sy
session is created on the OCS. If there is an Sy session and the SL-Request-
Type AVP is not set to INTERMEDIATE_REQUEST (1), the OCS shall return a
response with the Result-Code set to DIAMETER_INVALID_AVP_VALUE and with the
Failed-AVP AVP containing the SL-Request-Type AVP. If there is no Sy session
and the SL-Request-Type AVP is not set to INITIAL_REQUEST (0), the OCS shall
return a response with the Result-Code AVP set to DIAMETER_UNKNOWN_SESSION_ID.
Upon reception of the request from the PCRF provided with explicit Policy
Counter Identifier(s):
If all the policy counter identifiers are known to the OCS, the OCS shall be
able to subsequently notify the PCRF of any policy counter state changes
and/or additions, removals or changes of pending policy counter statuses along
with their activation time.
If a policy counter identifier is known by the OCS, but is not applicable to
the subscriber (e.g. not provisioned), the OCS may use an operator configured
policy counter status to indicate this to the PCRF.
If the OCS is configured to accept the request provided with unknown policy
counter identifier(s) , and if the OCS determines that one or more policy
counter identifiers are unknown, an operator configured policy counter status
may be used to indicate the policy counter identifier(s) determined as unknown
by OCS. The status of known policy counter identifier(s) shall be returned to
the PCRF in the same procedure in this case.
Alternatively, if the OCS is configured to reject the request provided with
unknown policy counter identifier(s), and if the OCS determines that one or
more policy counter identifiers are unknown, the OCS shall return a response
with the Experimental-Result-Code AVP set to DIAMETER_ERROR_UNKNOWN
POLICY_COUNTERS and with the Failed-AVP AVP indicating the unknown policy
counter identifiers. When this failure occurs, if the SL-Request-Type AVP is
set to:
\- INITIAL_REQUEST (0), then the Sy session is not created.
\- INTERMEDIATE_REQUEST (1), then none of the changes in the request take
effect but the Sy session is maintained.
NOTE 1: In order to avoid misbehaviors due to the policy counters maintained
in the Sy session, the PCRF can terminate the Sy session invoking the Final
Spending Limit Request procedure in clause 4.5.3.
When the PCRF provides a new subscribed policy counter identifier list, the
OCS shall remove any policy counter identifiers no longer in the list from
association with the Sy session such that the OCS will no longer notify the
PCRF of those policy counter state changes.
If an initial or intermediate request contains no policy counter identifiers,
the OCS shall subsequently notify the PCRF of all available policy counter
state changes and optionally the pending policy counter statuses with the
activation times. If the OCS has no available policy counters for that
subscriber during the Initial or Intermediate Spending Limit Report Request
procedure, it sets the Experimental-Result-Code to
DIAMETER_ERROR_NO_AVAILABLE_POLICY_COUNTERS. When this failure occurs, if the
SL-Request-Type AVP is set to:
\- INITIAL_REQUEST (0), then the Sy session is not created.
\- INTERMEDIATE_REQUEST (1), then none of the changes in the request take
effect but the Sy session is maintained.
NOTE 2: The PCRF can terminate the Sy session invoking the Final Spending
Limit Request procedure in clause 4.5.3, or maintain the Sy session assuming
that further available policy counters will be notified.
If the user identified in an initial request is not known to the OCS, the OCS
shall reject the Spending Limit Report Request by including the result code of
DIAMETER_USER_UNKNOWN in the Spending Limit Report Answer. In this case, the
Sy session is not created.
Upon successful creation of an Sy session, the OCS shall include the current
status of all subscribed policy counters (if any) in the response and set the
Result-Code to DIAMETER_SUCCESS.
### 4.5.2 Spending Limit Report
#### 4.5.2.1 General
This procedure shall be used by the OCS to notify the PCRF of changes in the
status of subscribed policy counter(s).
This procedure is mapped to the Spending-Status-Notification-Request /Answer
commands specified commands specified in section 5.6.
Table 4.5.2.1/1: Spending Limit Report Request
* * *
Information element name Mapping to Diameter AVP Cat. Description Policy
Counter Status Report Policy-Counter-Status-Report M If present, this
information element shall contain a policy counter identifier, the current
status value and if applicable pending policy counter statuses with the
activation times.
* * *
Table 4.5.2.1/2: Spending Limit Report Response
* * *
Information element name Mapping to Diameter AVP Cat. Description Result
Result-Code or Experimental-Result M This IE shall contain the result of the
operation.
* * *
#### 4.5.2.2 The behaviour of the OCS
When the status of a specific policy counter changes or when pending statuses
associated with the policy counter are added, removed or changed, the OCS
shall determine the Sy sessions impacted by the change (i.e. those Sy sessions
that have subscribed to status change notifications for the changed policy
counter) and send a Spending Limit Report request including the current policy
counter status, and if applicable pending policy counter statuses with the
activation times to the PCRF associated with each affected Sy session.
If several policy counters change status at the same time, the OCS may group
the status change notifications into a single Spending Limit Report request to
the PCRF by sending multiple Policy-Counter-Status-Report AVPs in the request.
#### 4.5.2.3 Detailed behaviour of the PCRF
The PCRF shall acknowledge the request by sending a response with a Result-
Code AVP set to DIAMETER_SUCCESS and use the status of the received policy
counter(s) as input to its policy decision to apply operator defined actions,
e.g. downgrade the QoS.
The PCRF shall ignore an unknown policy counter status report for all unknown
policy counter identifiers in an SLA or in an SNR from the OCS.
If the PCRF receives a Policy-Counter-Status-Report with one or more Pending-
Policy-Counter-Information AVPs, then at the time defined by the Pending-
Policy-Counter-Change-Time AVP, the pending Policy-Counter-Status shall
autonomously become the current status of a policy counter. Subsequently
provided information for pending statuses of a policy counter shall overwrite
the previously received information. If the pending policy counter statuses
are applicable to a policy counter identifier but the Pending-Policy-Counter-
Information AVPs are omitted in the new policy counter status report, the PCRF
shall remove all the pending policy counter statuses.
### 4.5.3 Final Spending Limit Report Request
#### 4.5.3.1 General
This procedure shall be used by the PCRF to unsubscribe to any future updates
of policy counters for a given subscriber by the OCS.
This procedure is mapped to the Session-Termination-Request/Answer commands
specified in RFC3588 [3].
Table 4.5.3.1/1: Final Spending Limit Report Request
* * *
Information element name Mapping to Diameter AVP Cat. Description Termination
Cause Termination-Cause M This IE shall contain the reason why the session was
terminated. It shall be set to \"DIAMETER_LOGOUT\".
* * *
Table 4.5.3.1/2: Final Spending Limit Report Response
* * *
Information element name Mapping to Diameter AVP Cat. Description Result
Result-Code M This IE shall contain the result of the operation.
* * *
#### 4.5.3.2 Detailed behaviour of the PCRF
When the PCRF decides that policy decisions for a given user no longer depend
on policy counter(s) to which the PCRF has existing subscriptions for status
change notifications, the PCRF shall send the Final Spending Limit Report
Request to the OCS.
#### 4.5.3.3 The behaviour of the OCS
Upon reception of the request from the PCRF, the OCS shall check that there is
an ongoing Sy session associated with the received Session-Id AVP. If there is
no Sy session, the OCS shall return a response with the Result-Code AVP set to
DIAMETER_UNKNOWN_SESSION_ID.
The OCS shall remove all policy counter subscriptions associated with the Sy
session such that the OCS will no longer notify the PCRF of policy counter
state changes and close the session by returning a response with the Result-
Code AVP set to DIAMETER_SUCCESS.
# 5 Sy protocol
## 5.1 Protocol support
### 5.1.1 Use of Diameter base protocol
The Diameter Base Protocol as specified in IETF RFC 3588 [3] shall apply
except as modified by the defined support of the methods and the defined
support of the commands and AVPs, result and error codes as specified in this
specification. Unless otherwise specified, the procedures (including error
handling and unrecognised information handling) shall be used unmodified.
With regard to the Diameter protocol defined over the Sy interface, the OCS
acts as a Diameter server, in the sense that it is the network element that
handles policy counter status requests for a particular realm. The PCRF acts
as the Diameter client, in the sense that is the network element requesting
policy counter status to the OCS.
A Diameter routing table entry can have a different destination based on the
application identifier of the command. The application identifier stored in
the command header must match the value of any application identifier AVPs in
the command body. Diameter agents (relay, proxy, redirection, translation
agents) should use the application identifier in the command header to route
to a suitable destination.
### 5.1.2 Void
### 5.1.3 Accounting functionality
Accounting functionality (Accounting Session State Machine, related command
codes and AVPs) shall not be used on the Sy interface.
### 5.1.4 Transport protocol
Diameter messages over the Sy interface shall make use of TCP IETF RFC 791
[13] or SCTP IETF RFC 4960 [14].
### 5.1.5 Advertising Application Support
The Diameter application identifier assigned to the Sy interface application
is 16777302.
The PCRF and OCS shall advertise support of the Diameter Sy Application by
including the value of the Sy application identifier in the Auth-Application-
Id AVP within the Vendor-Specific-Application-Id grouped AVP of the
Capabilities-Exchange-Request and Capabilities-Exchange-Answer commands.
The vendor identifier value of 3GPP (10415) shall be included in the
Supported-Vendor-Id AVP of the Capabilities-Exchange-Request and Capabilities-
Exchange-Answer commands, and in the Vendor-Id AVP within the Vendor-Specific-
Application-Id grouped AVP of the Capabilities-Exchange-Request and
Capabilities-Exchange-Answer commands.
The Vendor-Id AVP included in Capabilities-Exchange-Request and Capabilities-
Exchange-Answer commands that is not included in the Vendor-Specific-
Application-Id AVPs as described above shall indicate the manufacturer of the
Diameter node as per RFC 3588 [3].
### 5.1.6 Use of the Supported-Features AVP
The Supported-Features AVP is used during session establishment to inform the
destination host about the required and optional features that the origin host
supports. The client shall, in the first request in a Diameter session
indicate the set of supported features. The server shall, in the first answer
within the Diameter session indicate the set of features that it has in common
with the client and that the server shall support within the same Diameter
session. Any further command messages shall always be compliant with the list
of supported features indicated in the Supported-Features AVPs during session
establishment. Features that are not advertised as supported shall not be used
to construct the command messages for that Diameter session. Unless otherwise
stated, the use of the Supported-Features AVP on the Sy reference point shall
be compliant with the requirements for dynamic discovery of supported features
and associated error handling on the Cx reference point as defined in clause
7.2.1 of TS 29.229 [15].
The base functionality for the Sy reference point is the 3GPP Rel-11 standard
and a feature is an extension to that functionality. If the origin host does
not support any features beyond the base functionality, the Supported-Features
AVP may be absent from the Sy commands. As defined in clause 7.1.1 of TS
29.229 [15], when extending the application by adding new AVPs for a feature,
the new AVPs shall have the M bit cleared and the AVP shall not be defined
mandatory in the command ABNF.
As defined in TS 29.229 [15], the Supported-Features AVP is of type grouped
and contains the Vendor-Id, Feature-List-ID and Feature-List AVPs. On the Sy
reference point, the Supported-Features AVP is used to identify features that
have been defined by 3GPP and hence, for features defined in this document,
the Vendor-Id AVP shall contain the vendor ID of 3GPP (10415). If there are
multiple feature lists defined for the Sy reference point, the Feature-List-ID
AVP shall differentiate those lists from one another.
On receiving an initial request application message, the destination host
shall act as defined in clause 7.2.1 of TS 29.229 [15]. The following
exceptions apply to the initial SLR/SLA command pair:
\- If the PCRF supports post-Rel-11 Sy, the SLR shall include the features
supported by the PCRF within Supported-Features AVP(s) with the \'M\' bit
cleared.
NOTE: One instance of Supported-Features AVP is needed per Feature-List-ID.
\- If the SLR command does not contain any Supported-Features AVP(s) and the
OCS supports Rel-11 Sy functionality, the OCS shall not include the Supported-
Features AVP in the SLA command. In this case, both PCRF and OCS shall behave
as specified in the Rel-11 version of this document.
Once the PCRF and OCS have negotiated the set of supported features during
session establishment, the set of common features shall be used during the
lifetime of the Diameter session.
## 5.2 Initialization and maintenance of connection and session
The Diameter protocol between the PCRF and the OCS, shall always keep the
session state, and use the same Session-Id parameter for the lifetime of each
Diameter session.
Each Diameter session shall identify a Sy session for a given user. In order
to indicate that the session state is to be maintained, the Diameter client
and server shall not include the Auth-Session-State AVP, either in the request
or in the response messages (see IETF RFC 3588 [3]).
The PCRF shall link the Gx session(s) or S9 session with the Sy session at Sy
session initialization and maintain that until the IP-CAN session(s) for that
subscriber are terminated or no IP-CAN session for the same user depends on
the spending status information provided over Sy reference point.
## 5.3 Sy specific AVPs
Table 5.3.1 describes the Diameter AVPs defined for the Sy reference point,
their AVP Code values, types and possible flag values. The Vendor-Id header of
all AVPs defined in the present document shall be set to 3GPP (10415).
Table 5.3.1: Sy specific Diameter AVPs
* * *
                                                                                                                                                                                                                                                                                                       AVP Flag rules (note 1)
Attribute Name AVP Code Clause defined Value Type Must May Should not Must not
Policy-Counter-Identifier 2901 5.3.1 UTF8String M,V P  
Policy-Counter-Status 2902 5.3.2 UTF8String M,V P  
Policy-Counter-Status-Report 2903 5.3.3 Grouped M,V P  
SL-Request-Type 2904 5.3.4 Enumerated M,V P  
Pending-Policy-Counter-Information 2905 5.3.5 Grouped M,V P  
Pending-Policy-Counter-Change-Time 2906 5.3.6 Time M,V P  
NOTE 1: The AVP header bit denoted as \'M\', indicates whether support of the
AVP is required. The AVP header bit denoted as \'V\', indicates whether the
optional Vendor-ID field is present in the AVP header. For further details,
see RFC 3588 [3].
* * *
### 5.3.1 Policy-Counter-Identifier AVP
The Policy-Counter-Identifier AVP (AVP code 2901) is of type UTF8String, and
it uniquely identifies a policy counter that is maintained per subscriber
within the OCS.
### 5.3.2 Policy-Counter-Status AVP
The Policy-Counter-Status AVP (AVP code 2902) is of type UTF8String, and
identifies the policy counter status applicable for a specific policy counter
and subscriber.
NOTE: The valid values for the Policy-Counter-Status AVP are specific for each
Policy-Counter-Identifier value.
### 5.3.3 Policy-Counter-Status-Report AVP
The Policy-Counter-Status-Report AVP (AVP code 2903) is of type Grouped. It is
used by the OCS to report the status of a specific policy counter.
Associated pending policy counter statuses shall always be provided within
Pending-Policy-Counter-Information AVPs if the pending policy counter statuses
are applicable to the policy counter identifier. If there are no Pending-
Policy-Counter-Information AVPs provided within the Policy-Counter-Status-
Report AVP, previously provided pending counter statuses are removed. In
addition, newly provided pending policy counter statuses overwrite previously
provided ones.
AVP Format:
Policy-Counter-Status-Report ::= \
{ Policy-Counter-Identifier }
{ Policy-Counter-Status }
*[ Pending-Policy-Counter-Information ]
*[ AVP ]
### 5.3.4 SL-Request-Type AVP
The SL-Request-Type AVP (AVP code 2904) is of type Enumerated, and informs the
OCS whether the SLR command is being sent as part of the initial or
intermediate spending limit report request procedure.
The following values are defined:
INITIAL_REQUEST (0)
This value indicates that this is the first request in the Diameter session.
INTERMEDIATE_REQUEST (1)
This value indicates that this is the second or subsequent request in the
Diameter session.
### 5.3.5 Pending-Policy-Counter-Information AVP
The Pending-Policy-Counter-Information AVP (AVP code 2905) is of type Grouped,
which contains the pending policy counter status and the active time. If
multiple pending policy counter AVPs are included, they shall be sorted in
order of change time.
AVP Format:
Pending-Policy-Counter-Information ::= \
{ Policy-Counter-Status }
{ Pending-Policy-Counter-Change-Time }
*[ AVP ]
NOTE: The valid values for the Pending-Policy-Counter-Information AVP are
specific for each Policy-Counter-Identifier value.
### 5.3.6 Pending-Policy-Counter-Change-Time AVP
The Pending-Policy-Counter-Change-Time AVP (AVP code 2906) is of type Time.
This value indicates the NTP time at which the pending policy counter status
becomes the current status of a policy counter.
## 5.4 Sy re-used AVPs
Table 5.4 lists the Diameter AVPs re-used by the Sy reference point from
existing Diameter Applications, reference to their respective specifications
and a short description of their usage within the Sy reference point. Other
AVPs from existing Diameter Applications, except for the AVPs from Diameter
base protocol, do not need to be supported. The AVPs from Diameter base
protocol are not included in table 5.4, but they are re-used for the Sy
reference point. Unless otherwise stated, re-used AVPs shall maintain their
\'M\', \'P\' and \'V\' flag settings. Where 3GPP Radius VSAs are re-used,
unless otherwise stated, they shall be translated to Diameter AVPs as
described in RFC 4005 [4] with the exception that the \'M\' flag shall be set
and the \'P\' flag may be set.
Table 5.4: Sy re-used Diameter AVPs
* * *
Attribute Name Reference Description Subscription-Id IETF RFC 4006 [5] The
identification of the subscription (IMSI, MSISDN, etc)
* * *
## 5.5 Sy specific Experimental-Result-Code AVP values
### 5.5.1 General
RFC 3588 [3] specifies the Experimental-Result AVP containing Vendor-ID AVP
and Experimental-Result-Code AVP. The Experimental-Result-Code AVP (AVP Code
298) is of type Unsigned32 and contains a vendor-assigned value representing
the result of processing a request. The Vendor-ID AVP shall be set to 3GPP
(10415).
### 5.5.2 Permanent Failures
Errors that fall within the Permanent Failures category shall be used to
inform the peer that the request failed, and the request should not be
attempted again.
The Result-Code AVP values defined in Diameter base protocol IETF RFC 3588 [3]
are applicable. Also, the following Result-Code AVP value defined in IETF RFC
4006 [5] is applicable:
DIAMETER_USER_UNKNOWN (5030)
This error shall be used by the OCS to indicate to the PCRF that the end user
specified in the request is unknown to the OCS and that the Sy session cannot
be created.
The following specific Sy Experimental-Result-Code value is defined for
permanent failures:
DIAMETER_ERROR_UNKNOWN_POLICY_COUNTERS (5570)
> This error shall be used by the OCS to indicate to the PCRF that the OCS
> does not recognize one or more Policy Counters specified in the request,
> when the OCS is configured to reject the request provided with unknown
> policy counter identifier(s).
### 5.5.3 Transient Failures
Errors that fall within the transient failures category are used to inform a
peer that the request could not be satisfied at the time it was received, but
may be able to satisfy the request in the future.
The Result-Code AVP values defined in Diameter base protocol IETF RFC 3588 [3]
are applicable. Also the following specific Sy Experimental-Result-Code value
is defined for transient failures:
DIAMETER_ERROR_NO_AVAILABLE_POLICY_COUNTERS (4241)
This error shall be used by the OCS to indicate to the PCRF that the OCS has
no available policy counters for the subscriber.
The PCRF may retry the request based on local configuration or operator policy
on receipt of a transient failure.
## 5.6 Sy Messages
### 5.6.1 Command-Code Values
This section defines the Command-Code values for the Sy interface application
as allocated by IANA from the vendor-specific namespace defined in IETF RFC
5719 [6]. Every command is defined by means of the ABNF syntax IETF RFC 2234
[7], according to the rules in IETF RFC 3588 [3].
The following Command Codes are defined in this specification:
Table 5.6.1: Command-Code values for Sy
* * *
Command-Name Abbreviation Code Section Spending-Limit-Request SLR 8388635
5.6.2 Spending-Limit-Answer SLA 8388635 5.6.3 Spending-Status-Notification-
Request SNR 8388636 5.6.4 Spending-Status-Notification-Answer SNA 8388636
5.6.5
* * *
In addition, the Session-Termination-Request and Session-Termination-Answer
commands are reused from IETF RFC 3588 [3].
For the commands defined in this specification and reused commands, the
Application-ID field shall be set to 16777302.
### 5.6.2 Spending-Limit-Request (SLR) command
The SLR command, indicated by the Command-Code field set to 8388635 and the
\'R\' bit set in the Command Flags field, is sent by the PCRF to the OCS as
part of the Initial or Intermediate Spending Limit Report Request procedure.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
[ Destination-Host ]
[ Origin-State-Id ]
{ SL-Request-Type }
*[ Subscription-Id ]
*[ Policy-Counter-Identifier ]
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP ]
NOTE: Multiple instances of the Subscription-Id AVP in the SLR command
correspond to multiple types of identifier for the same subscriber, for
example IMSI and MSISDN.
### 5.6.3 Spending-Limit-Answer (SLA) command
The SLA command, indicated by the Command-Code field set to 8388635 and the
\'R\' bit cleared in the Command Flags field, is sent by the OCS to the PCRF
as part of the Initial or Intermediate Spending Limit Report Request
procedure.
Message Format:
\ ::= \
\
{ Auth-Application-Id }
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
*[ Policy-Counter-Status-Report ]
[ Error-Message ]
[ Error-Reporting-Host ]
*[ Failed-AVP ]
[ Origin-State-Id ]
*[ Redirect-Host ]
[ Redirect-Host-Usage ]
[ Redirect-Max-Cache-Time ]
*[ Proxy-Info ]
*[ AVP ]
### 5.6.4 Spending-Status-Notification-Request (SNR) command
The SNR command, indicated by the Command-Code field set to 8388636 and the
\'R\' bit set in the Command Flags field, is sent by the OCS to the PCRF as
part of the Spending Limit Report procedure.
Message Format:
\ ::= \
\
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
{ Destination-Host }
{ Auth-Application-Id }
[ Origin-State-Id ]
*[ Policy-Counter-Status-Report ]
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP ]
### 5.6.5 Spending-Status-Notification-Answer (SNA) command
The SNA command, indicated by the Command-Code field set to 8388636 and the
\'R\' bit cleared in the Command Flags field, is sent by the PCRF to the OCS
as part of the Spending Limit Report procedure.
Message Format:
\ ::= \
\
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Experimental-Result ]
[ Origin-State-Id ]
[ Error-Message ]
[ Error-Reporting-Host ]
*[ Redirect-Host ]
[ Redirect-Host-Usage ]
[ Redirect-Max-Cache-Time ]
*[ Failed-AVP ]
*[ Proxy-Info ]
*[ AVP ]
### 5.6.6 Session-Termination-Request (STR) command
The STR command, indicated by the Command-Code field set to 275 and the \'R\'
bit set in the Command Flags field, is sent by the PCRF to the OCS as part of
the Final Spending Limit Report Request procedure.
Message Format:
\ ::= \
\
{ Origin-Host }
{ Origin-Realm }
{ Destination-Realm }
{ Auth-Application-Id }
{ Termination-Cause }
[ Destination-Host ]
[ Origin-State-Id ]
*[ Proxy-Info ]
*[ Route-Record ]
*[ AVP ]
### 5.6.7 Session-Termination-Answer (STA) command
The STA command, indicated by the Command-Code field set to 275 and the \'R\'
bit cleared in the Command Flags field, is sent by the OCS to the PCRF as part
of the Final Spending Limit Report Request procedure.
Message Format:
\ ::= \
\
{ Origin-Host }
{ Origin-Realm }
[ Result-Code ]
[ Error-Message ]
[ Error-Reporting-Host ]
*[ Failed-AVP ]
[ Origin-State-Id ]
*[ Redirect-Host ]
[ Redirect-Host-Usage ]
[ Redirect-Max-Cache-Time ]
*[ Proxy-Info ]
*[ AVP ]
#
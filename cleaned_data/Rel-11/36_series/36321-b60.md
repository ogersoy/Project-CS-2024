# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the E-UTRA MAC protocol.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TR 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical Layer Procedures\".
[3] 3GPP TS 36.322: "Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Link Control (RLC) protocol specification".
[4] 3GPP TS 36.323: "Evolved Universal Terrestrial Radio Access (E-UTRA);
Packet Data Convergence Protocol (PDCP) Specification".
[5] 3GPP TS 36.212: "Evolved Universal Terrestrial Radio Access (E-UTRA);
Multiplexing and channel coding".
[6] 3GPP TS 36.214: "Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer; Measurements".
[7] 3GPP TS 36.211: "Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical Channels and Modulation".
[8] 3GPP TS 36.331: "Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification".
[9] 3GPP TS 36.133: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Requirements for support of radio resource management\".
[10] 3GPP TS 36.101: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) radio transmission and reception\".
[11] 3GPP TS 36.216: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer for relaying operation\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Active Time:** Time related to DRX operation, as defined in subclause 5.7,
during which the UE monitors the PDCCH in PDCCH-subframes.
**_mac-ContentionResolutionTimer_** : Specifies the number of consecutive
subframe(s) during which the UE shall monitor the PDCCH after Msg3 is
transmitted.
**DRX Cycle:** Specifies the periodic repetition of the On Duration followed
by a possible period of inactivity (see figure 3.1-1 below).
Figure 3.1-1: DRX Cycle
**_drx-InactivityTimer_** : Specifies the number of consecutive PDCCH-
subframe(s) after the subframe in which a PDCCH indicates an initial UL or DL
user data transmission for this UE.
**_drx-RetransmissionTimer_** : Specifies the maximum number of consecutive
PDCCH-subframe(s) until a DL retransmission is received.
**_drxShortCycleTimer_** : Specifies the number of consecutive subframe(s) the
UE shall follow the Short DRX cycle.
**_drxStartOffset_** : Specifies the subframe where the DRX Cycle starts.
**HARQ information** : HARQ information consists of New Data Indicator (NDI),
Transport Block (TB) size. For DL-SCH transmissions the HARQ information also
includes HARQ process ID. For UL-SCH transmission the HARQ info also includes
Redundancy Version (RV). In case of spatial multiplexing on DL-SCH the HARQ
information comprises a set of NDI and TB size for each transport block.
**HARQ RTT Timer** : This parameter specifies the minimum amount of
subframe(s) before a DL HARQ retransmission is expected by the UE.
**Msg3** : Message transmitted on UL-SCH containing a C-RNTI MAC CE or CCCH
SDU, submitted from upper layer and associated with the UE Contention
Resolution Identity, as part of a random access procedure.
**_onDurationTimer_** : Specifies the number of consecutive PDCCH-subframe(s)
at the beginning of a DRX Cycle.
**PDCCH:** Refers to the PDCCH [7], EPDCCH (in subframes when configured) or,
for an RN with R-PDCCH configured and not suspended, to the R-PDCCH.
**PDCCH-subframe:** Refers to a subframe with PDCCH. For FDD UE operation,
this represents any subframe;\ for TDD UE operation, if UE is capable of
simultaneous reception and transmission in the aggregated cells, this
represents the union of downlink subframes and subframes including DwPTS of
all serving cells, except serving cells that are configured with
_schedulingCellId_ [8]; otherwise, this represents the subframes where the
PCell is configured as a downlink subframe or a subframe including DwPTS.\ For
RNs with an RN subframe configuration configured and not suspended, in its
communication with the E-UTRAN, this represents all downlink subframes
configured for RN communication with the E-UTRAN.
**PRACH Resource Index** : The index of a PRACH within a system frame [7]
**Primary Timing Advance Group:** Timing Advance Group containing the PCell.
**_ra-PRACH-MaskIndex_ :** Defines in which PRACHs within a system frame the
UE can transmit a Random Access Preamble (see subclause 7.3).
**RA-RNTI:** The Random Access RNTI is used on the PDCCH when Random Access
Response messages are transmitted. It unambiguously identifies which time-
frequency resource was utilized by the UE to transmit the Random Access
preamble.
**Secondary Timing Advance Group:** Timing Advance Group not containing the
PCell. A Secondary Timing Advance Group contains at least one Serving Cell
with an UL configured.
**Serving Cell:** A Primary or a Secondary Cell [8].
**Timing Advance Group:** A group of Serving Cells that is configured by RRC
and that, for the cells with an UL configured, using the same timing reference
cell and the same Timing Advance value.
NOTE: A timer is running once it is started, until it is stopped or until it
expires; otherwise it is not running. A timer can be started if it is not
running or restarted if it is running. A Timer is always started or restarted
from its initial value.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
BSR Buffer Status Report
C-RNTI Cell RNTI
CQI Channel Quality Indicator
E-UTRA Evolved UMTS Terrestrial Radio Access
E-UTRAN Evolved UMTS Terrestrial Radio Access Network
MAC Medium Access Control
M-RNTI MBMS RNTI
LCG Logical Channel Group
PCell Primary Cell [8]
PHR Power Headroom Report
PMI Precoding Matrix Index
P-RNTI Paging RNTI
pTAG Primary Timing Advance Group
PTI Precoding Type Indicator
RA-RNTI Random Access RNTI
RI Rank Indicator
RN Relay Node
RNTI Radio Network Temporary Identifier
SCell Secondary Cell [8]
SI-RNTI System Information RNTI
SR Scheduling Request
SRS Sounding Reference Symbols
sTAG Secondary Timing Advance Group
TAG Timing Advance Group
TB Transport Block
TPC-PUCCH-RNTI Transmit Power Control-Physical Uplink Control Channel-RNTI
TPC-PUSCH-RNTI Transmit Power Control-Physical Uplink Shared Channel-RNTI
# 4 General
## 4.1 Introduction
The objective is to describe the MAC architecture and the MAC entity from a
functional point of view. Functionality specified for the UE equally applies
to the RN for functionality necessary for the RN. There is also functionality
which is only applicable to the RN, in which case the specification denotes
the RN instead of the UE. RN‑specific behaviour is not applicable to the UE.
## 4.2 MAC architecture
The description in this sub clause is a model and does not specify or restrict
implementations.
RRC is in control of configuration of MAC.
### 4.2.1 MAC Entities
E-UTRA defines two MAC entities; one in the UE and one in the E-UTRAN. These
MAC entities handle the following transport channels:
\- Broadcast Channel (BCH);
\- Downlink Shared Channel(s) (DL-SCH);
\- Paging Channel (PCH);
\- Uplink Shared Channel(s) (UL-SCH);
\- Random Access Channel(s) (RACH);
\- Multicast Channel(s) (MCH).
The exact functions performed by the MAC entities are different in the UE from
those performed in the E-UTRAN.
The RN includes both MAC entities; one for communication with UEs and one for
communication with the E-UTRAN.
If the UE is configured with one or more SCells, there are multiple DL-SCH and
there may be multiple UL-SCH and RACH per UE; one DL-SCH and UL-SCH on the
PCell, one DL-SCH, zero or one UL-SCH and zero or one RACH for each SCell.
Figure 4.2.1-1 illustrates one possible structure for the UE side MAC entity,
and it should not restrict implementation.
Figure 4.2.1-1: MAC structure overview, UE side
## 4.3 Services
### 4.3.1 Services provided to upper layers
This clause describes the different services provided by MAC sublayer to upper
layers.
\- data transfer
\- radio resource allocation
### 4.3.2 Services expected from physical layer
The physical layer provides the following services to MAC:
\- data transfer services;
\- signalling of HARQ feedback;
\- signalling of Scheduling Request;
\- measurements (e.g. Channel Quality Indication (CQI)).
The access to the data transfer services is through the use of transport
channels. The characteristics of a transport channel are defined by its
transport format (or format set), specifying the physical layer processing to
be applied to the transport channel in question, such as channel coding and
interleaving, and any service-specific rate matching as needed.
## 4.4 Functions
The following functions are supported by MAC sublayer:
\- mapping between logical channels and transport channels;
\- multiplexing of MAC SDUs from one or different logical channels onto
transport blocks (TB) to be delivered to the physical layer on transport
channels;
\- demultiplexing of MAC SDUs from one or different logical channels from
transport blocks (TB) delivered from the physical layer on transport channels;
\- scheduling information reporting;
\- error correction through HARQ;
\- priority handling between UEs by means of dynamic scheduling;
\- priority handling between logical channels of one UE;
\- Logical Channel prioritisation;
\- transport format selection.
The location of the different functions and their relevance for uplink and
downlink respectively is illustrated in Table 4.4-1.
Table 4.4-1: MAC function location and link direction association.
* * *
MAC function UE eNB Downlink Uplink Mapping between logical channels and
transport channels X X X X X X Multiplexing X X X X  
Demultiplexing X X  
X X Error correction through HARQ X X X X X X Transport Format Selection X X X
Priority handling between UEs X X X Priority handling between logical channels
of one UE X X X Logical Channel prioritisation X X Scheduling information
reporting X X
* * *
## 4.5 Channel structure
The MAC sublayer operates on the channels defined below; transport channels
are SAPs between MAC and Layer 1, logical channels are SAPs between MAC and
RLC.
### 4.5.1 Transport Channels
The transport channels used by MAC are described in Table 4.5.1-1 below.
Table 4.5.1-1: Transport channels used by MAC
* * *
Transport channel name Acronym Downlink Uplink Broadcast Channel BCH X  
Downlink Shared Channel DL-SCH X  
Paging Channel PCH X  
Multicast Channel MCH X  
Uplink Shared Channel UL-SCH X Random Access Channel RACH X
* * *
### 4.5.2 Logical Channels
The MAC layer provides data transfer services on logical channels. A set of
logical channel types is defined for different kinds of data transfer services
as offered by MAC.
Each logical channel type is defined by what type of information is
transferred.
MAC provides the control and traffic channels listed in Table 4.5.2-1 below.
Table 4.5.2-1: Logical channels provided by MAC.
* * *
Logical channel name Acronym Control channel Traffic channel Broadcast Control
Channel BCCH X  
Paging Control Channel PCCH X  
Common Control Channel CCCH X  
Dedicated Control Channel DCCH X  
Multicast Control Channel MCCH X  
Dedicated Traffic Channel DTCH X Multicast Traffic Channel MTCH X
* * *
### 4.5.3 Mapping of Transport Channels to Logical Channels
The mapping of logical channels on transport channels depends on the
multiplexing that is configured by RRC.
#### 4.5.3.1 Uplink mapping
The MAC entity is responsible for mapping logical channels for the uplink onto
uplink transport channels. The uplink logical channels can be mapped as
described in Figure 4.5.3.1-1 and Table 4.5.3.1-1.
Figure 4.5.3.1-1
Table 4.5.3.1-1: Uplink channel mapping.
* * *
Transport channel\ UL-SCH RACH Logical channel
CCCH X
DCCH X
DTCH X
* * *
#### 4.5.3.2 Downlink mapping
The MAC entity is responsible for mapping the downlink logical channels to
downlink transport channels. The downlink logical channels can be mapped as
described in Figure 4.5.3.2-1 and Table 4.5.3.2-1.
Figure 4.5.3.2-1
Table 4.5.3.2-1: Downlink channel mapping.
* * *
Transport channel\ BCH PCH DL-SCH MCH Logical channel
BCCH X X
PCCH X
CCCH X
DCCH X
DTCH X
MCCH X
MTCH X
* * *
# 5 MAC procedures
## 5.1 Random Access procedure
### 5.1.1 Random Access Procedure initialization
The Random Access procedure described in this subclause is initiated by a
PDCCH order or by the MAC sublayer itself. Random Access procedure on an SCell
shall only be initiated by a PDCCH order. If a UE receives a PDCCH
transmission consistent with a PDCCH order [5] masked with its C-RNTI, and for
a specific Serving Cell, the UE shall initiate a Random Access procedure on
this Serving Cell. For Random Access on the PCell a PDCCH order or RRC
optionally indicate the _ra-PreambleIndex_ and the _ra-PRACH-MaskIndex; and
for Random Access on an SCell, the PDCCH order indicates the ra-PreambleIndex_
with a value different from 000000 and the _ra-PRACH-MaskIndex_. For the pTAG
preamble transmission on PRACH and reception of a PDCCH order are only
supported for PCell.
Before the procedure can be initiated, the following information for related
Serving Cell is assumed to be available [8]:
\- the available set of PRACH resources for the transmission of the Random
Access Preamble, _prach-ConfigIndex_.
\- the groups of Random Access Preambles and the set of available Random
Access Preambles in each group (PCell only):
The preambles that are contained in Random Access Preambles group A and Random
Access Preambles group B are calculated from the parameters _numberOfRA-
Preambles_ and _sizeOfRA-PreamblesGroupA_ :
If _sizeOfRA-PreamblesGroupA_ is equal to _numberOfRA-Preambles_ then there is
no Random Access Preambles group B. The preambles in Random Access Preamble
group A are the preambles 0 to _sizeOfRA-PreamblesGroupA_ \-- 1 and, if it
exists, the preambles in Random Access Preamble group B are the preambles
_sizeOfRA-PreamblesGroupA_ to _numberOfRA-Preambles_ \-- 1 from the set of 64
preambles as defined in [7].
\- if Random Access Preambles group B exists, the thresholds,
_messagePowerOffsetGroupB_ and _messageSizeGroupA_ , the configured UE
transmitted power of the Serving Cell performing the Random Access Procedure,
P~CMAX,\ c~ [10], and the offset between the preamble and Msg3,
_deltaPreambleMsg3_ , that are required for selecting one of the two groups of
Random Access Preambles (PCell only).
\- the RA response window size _ra-ResponseWindowSize_.
\- the power-ramping factor _powerRampingStep_.
\- the maximum number of preamble transmission _preambleTransMax_.
\- the initial preamble power _preambleInitialReceivedTargetPower_.
\- the preamble format based offset DELTA_PREAMBLE (see subclause 7.6).
\- the maximum number of Msg3 HARQ transmissions _maxHARQ-Msg3Tx_ (PCell
only).
\- the Contention Resolution Timer _mac-ContentionResolutionTimer_ (PCell
only).
NOTE: The above parameters may be updated from upper layers before each Random
Access procedure is initiated.
The Random Access procedure shall be performed as follows:
\- Flush the Msg3 buffer;
\- set the PREAMBLE_TRANSMISSION_COUNTER to 1;
\- set the backoff parameter value in the UE to 0 ms;
\- for the RN, suspend any RN subframe configuration;
\- proceed to the selection of the Random Access Resource (see subclause
5.1.2).
NOTE: There is only one Random Access procedure ongoing at any point in time.
If the UE receives a request for a new Random Access procedure while another
is already ongoing, it is up to UE implementation whether to continue with the
ongoing procedure or start with the new procedure.
### 5.1.2 Random Access Resource selection
The Random Access Resource selection procedure shall be performed as follows:
\- If _ra-PreambleIndex_ (Random Access Preamble) and _ra-PRACH-MaskIndex_
(PRACH Mask Index) have been explicitly signalled and _ra-PreambleIndex_ is
not 000000:
\- the Random Access Preamble and the PRACH Mask Index are those explicitly
signalled.
\- else the Random Access Preamble shall be selected by the UE as follows:
\- If Msg3 has not yet been transmitted, the UE shall:
\- if Random Access Preambles group B exists and if the potential message size
(data available for transmission plus MAC header and, where required, MAC
control elements) is greater than _messageSizeGroupA_ and if the pathloss is
less than P~CMAX,c~ (of the Serving Cell performing the Random Access
Procedure) -- _preambleInitialReceivedTargetPower_ \-- _deltaPreambleMsg3_ \--
_messagePowerOffsetGroupB_ , then:
\- select the Random Access Preambles group B;
\- else:
\- select the Random Access Preambles group A.
\- else, if Msg3 is being retransmitted, the UE shall:
\- select the same group of Random Access Preambles as was used for the
preamble transmission attempt corresponding to the first transmission of Msg3.
\- randomly select a Random Access Preamble within the selected group. The
random function shall be such that each of the allowed selections can be
chosen with equal probability;
\- set PRACH Mask Index to 0.
\- determine the next available subframe containing PRACH permitted by the
restrictions given by the _prach-ConfigIndex,_ the PRACH Mask Index (see
subclause 7.3) and physical layer timing requirements [2] (a UE may take into
account the possible occurrence of measurement gaps when determining the next
available PRACH subframe);
\- if the transmission mode is TDD and the PRACH Mask Index is equal to zero:
\- if _ra-PreambleIndex_ was explicitly signalled and it was not 000000 (i.e.,
not selected by MAC):
\- randomly select, with equal probability, one PRACH from the PRACHs
available in the determined subframe.
\- else:
\- randomly select, with equal probability, one PRACH from the PRACHs
available in the determined subframe and the next two consecutive subframes.
\- else:
\- determine a PRACH within the determined subframe in accordance with the
requirements of the PRACH Mask Index.
\- proceed to the transmission of the Random Access Preamble (see subclause
5.1.3).
### 5.1.3 Random Access Preamble transmission
The random-access procedure shall be performed as follows:
\- set PREAMBLE_RECEIVED_TARGET_POWER to _preambleInitialReceivedTargetPower_
\+ DELTA_PREAMBLE + (PREAMBLE_TRANSMISSION_COUNTER -- 1) * _powerRampingStep_
;
\- instruct the physical layer to transmit a preamble using the selected
PRACH, corresponding RA-RNTI, preamble index and
PREAMBLE_RECEIVED_TARGET_POWER.
### 5.1.4 Random Access Response reception
Once the Random Access Preamble is transmitted and regardless of the possible
occurrence of a measurement gap, the UE shall monitor the PDCCH of the PCell
for Random Access Response(s) identified by the RA-RNTI defined below, in the
RA Response window which starts at the subframe that contains the end of the
preamble transmission [7] plus three subframes and has length _ra-
ResponseWindowSize_ subframes. The RA-RNTI associated with the PRACH in which
the Random Access Preamble is transmitted, is computed as:
RA-RNTI= 1 + t_id+10*f_id
Where t_id is the index of the first subframe of the specified PRACH (0≤ t_id
\ 0 are allocated resources in a
decreasing priority order. If the PBR of a radio bearer is set to "infinity",
the UE shall allocate resources for all the data that is available for
transmission on the radio bearer before meeting the PBR of the lower priority
radio bearer(s);
\- Step 2: the UE shall decrement Bj by the total size of MAC SDUs served to
logical channel j in Step 1
NOTE: The value of Bj can be negative.
\- Step 3: if any resources remain, all the logical channels are served in a
strict decreasing priority order (regardless of the value of Bj) until either
the data for that logical channel or the UL grant is exhausted, whichever
comes first. Logical channels configured with equal priority should be served
equally.
\- The UE shall also follow the rules below during the scheduling procedures
above:
\- the UE should not segment an RLC SDU (or partially transmitted SDU or
retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or
retransmitted RLC PDU) fits into the remaining resources;
\- if the UE segments an RLC SDU from the logical channel, it shall maximize
the size of the segment to fill the grant as much as possible;
\- the UE should maximise the transmission of data.
\- if the UE is given an UL grant size that is equal to or larger than 4 bytes
while having data available for transmission, the UE shall not transmit only
padding BSR and/or padding (unless the UL grant size is less than 7 bytes and
an AMD PDU segment needs to be transmitted).
The UE shall not transmit data for a logical channel corresponding to a radio
bearer that is suspended (the conditions for when a radio bearer is considered
suspended are defined in [8]).
For the Logical Channel Prioritization procedure, the UE shall take into
account the following relative priority in decreasing order:
\- MAC control element for C-RNTI or data from UL-CCCH;
\- MAC control element for BSR, with exception of BSR included for padding;
\- MAC control element for PHR or Extended PHR;
\- data from any Logical Channel, except data from UL-CCCH;
\- MAC control element for BSR included for padding.
NOTE: When the UE is requested to transmit multiple MAC PDUs in one TTI, steps
1 to 3 and the associated rules may be applied either to each grant
independently or to the sum of the capacities of the grants. Also the order in
which the grants are processed is left up to UE implementation. It is up to
the UE implementation to decide in which MAC PDU a MAC control element is
included when UE is requested to transmit multiple MAC PDUs in one TTI.
#### 5.4.3.2 Multiplexing of MAC Control Elements and MAC SDUs
The UE shall multiplex MAC control elements and MAC SDUs in a MAC PDU
according to subclauses 5.4.3.1 and 6.1.2.
### 5.4.4 Scheduling Request
The Scheduling Request (SR) is used for requesting UL-SCH resources for new
transmission.
When an SR is triggered, it shall be considered as pending until it is
cancelled. All pending SR(s) shall be cancelled and _sr-ProhibitTimer_ shall
be stopped when a MAC PDU is assembled and this PDU includes a BSR which
contains buffer status up to (and including) the last event that triggered a
BSR (see subclause 5.4.5), or when the UL grant(s) can accommodate all pending
data available for transmission.
If an SR is triggered and there is no other SR pending, the UE shall set the
SR_COUNTER to 0.
As long as one SR is pending, the UE shall for each TTI:
\- if no UL-SCH resources are available for a transmission in this TTI:
\- if the UE has no valid PUCCH resource for SR configured in any TTI:
initiate a Random Access procedure (see subclause 5.1) on the PCell and cancel
all pending SRs;
\- else if the UE has a valid PUCCH resource for SR configured for this TTI
and if this TTI is not part of a measurement gap and if _sr-ProhibitTimer_ is
not running:
\- if SR_COUNTER \ \- clear any configured downlink assignments and uplink grants;
\- initiate a Random Access procedure (see subclause 5.1) on the PCell and
cancel all pending SRs.
### 5.4.5 Buffer Status Reporting
The Buffer Status reporting procedure is used to provide the serving eNB with
information about the amount of data available for transmission in the UL
buffers of the UE. RRC controls BSR reporting by configuring the two timers
_periodicBSR-Timer_ and _retxBSR-Timer_ and by, for each logical channel,
optionally signalling _logicalChannelGroup_ which allocates the logical
channel to an LCG [8].
For the Buffer Status reporting procedure, the UE shall consider all radio
bearers which are not suspended and may consider radio bearers which are
suspended.
A Buffer Status Report (BSR) shall be triggered if any of the following events
occur:
\- UL data, for a logical channel which belongs to a LCG, becomes available
for transmission in the RLC entity or in the PDCP entity (the definition of
what data shall be considered as available for transmission is specified in
[3] and [4] respectively) and either the data belongs to a logical channel
with higher priority than the priorities of the logical channels which belong
to any LCG and for which data is already available for transmission, or there
is no data available for transmission for any of the logical channels which
belong to a LCG, in which case the BSR is referred below to as \"Regular
BSR\";
\- UL resources are allocated and number of padding bits is equal to or larger
than the size of the Buffer Status Report MAC control element plus its
subheader, in which case the BSR is referred below to as \"Padding BSR\";
\- _retxBSR-Timer_ expires and the UE has data available for transmission for
any of the logical channels which belong to a LCG, in which case the BSR is
referred below to as \"Regular BSR\";
\- _periodicBSR-Timer_ expires, in which case the BSR is referred below to as
\"Periodic BSR\".
For Regular and Periodic BSR:
\- if more than one LCG has data available for transmission in the TTI where
the BSR is transmitted: report Long BSR;
\- else report Short BSR.
For Padding BSR:
\- if the number of padding bits is equal to or larger than the size of the
Short BSR plus its subheader but smaller than the size of the Long BSR plus
its subheader:
\- if more than one LCG has data available for transmission in the TTI where
the BSR is transmitted: report Truncated BSR of the LCG with the highest
priority logical channel with data available for transmission;
\- else report Short BSR.
\- else if the number of padding bits is equal to or larger than the size of
the Long BSR plus its subheader, report Long BSR.
If the Buffer Status reporting procedure determines that at least one BSR has
been triggered and not cancelled:
\- if the UE has UL resources allocated for new transmission for this TTI:
\- instruct the Multiplexing and Assembly procedure to generate the BSR MAC
control element(s);
\- start or restart _periodicBSR-Timer_ except when all the generated BSRs are
Truncated BSRs;
\- start or restart _retxBSR-Timer_.
\- else if a Regular BSR has been triggered:
\- if an uplink grant is not configured or the Regular BSR was not triggered
due to data becoming available for transmission for a logical channel for
which logical channel SR masking (_logicalChannelSR-Mask_) is setup by upper
layers:
\- a Scheduling Request shall be triggered.
A MAC PDU shall contain at most one MAC BSR control element, even when
multiple events trigger a BSR by the time a BSR can be transmitted in which
case the Regular BSR and the Periodic BSR shall have precedence over the
padding BSR.
The UE shall restart _retxBSR-Timer_ upon indication of a grant for
transmission of new data on any UL-SCH.
All triggered BSRs shall be cancelled in case the UL grant(s) in this subframe
can accommodate all pending data available for transmission but is not
sufficient to additionally accommodate the BSR MAC control element plus its
subheader. All triggered BSRs shall be cancelled when a BSR is included in a
MAC PDU for transmission.
The UE shall transmit at most one Regular/Periodic BSR in a TTI. If the UE is
requested to transmit multiple MAC PDUs in a TTI, it may include a padding BSR
in any of the MAC PDUs which do not contain a Regular/Periodic BSR.
All BSRs transmitted in a TTI always reflect the buffer status after all MAC
PDUs have been built for this TTI. Each LCG shall report at the most one
buffer status value per TTI and this value shall be reported in all BSRs
reporting buffer status for this LCG.
NOTE: A Padding BSR is not allowed to cancel a triggered Regular/Periodic BSR.
A Padding BSR is triggered for a specific MAC PDU only and the trigger is
cancelled when this MAC PDU has been built.
### 5.4.6 Power Headroom Reporting
The Power Headroom reporting procedure is used to provide the serving eNB with
information about the difference between the nominal UE maximum transmit power
and the estimated power for UL-SCH transmission per activated Serving Cell and
also with information about the difference between the nominal UE maximum
power and the estimated power for UL-SCH and PUCCH transmission on PCell.
The reporting period, delay and mapping of Power Headroom are defined in
subclause 9.1.8 of [9]. RRC controls Power Headroom reporting by configuring
the two timers _periodicPHR-Timer_ and _prohibitPHR-Timer_ , and by signalling
_dl-PathlossChange_ which sets the change in measured downlink pathloss and
the required power backoff due to power management (as allowed by P-MPR~c~
[10]) to trigger a PHR [8].
A Power Headroom Report (PHR) shall be triggered if any of the following
events occur:
\- _prohibitPHR-Timer_ expires or has expired and the path loss has changed
more than _dl-PathlossChange_ dB for at least one activated Serving Cell which
is used as a pathloss reference since the last transmission of a PHR when the
UE has UL resources for new transmission;
\- _periodicPHR-Timer_ expires;
\- upon configuration or reconfiguration of the power headroom reporting
functionality by upper layers [8], which is not used to disable the function;
\- activation of an SCell with configured uplink.
_\- prohibitPHR-Timer_ expires or has expired, when the UE has UL resources
for new transmission, and the following is true in this TTI for any of the
actived Serving Cells with configured uplink:
\- there are UL resources allocated for transmission or there is a PUCCH
transmission on this cell, and the required power backoff due to power
management (as allowed by P-MPR~c~ [10]) for this cell has changed more than
_dl-PathlossChange_ dB since the last transmission of a PHR when the UE had UL
resources allocated for transmission or PUCCH transmission on this cell.
NOTE: The UE should avoid triggering a PHR when the required power backoff due
to power management decreases only temporarily (e.g. for up to a few tens of
milliseconds) and it should avoid reflecting such temporary decrease in the
values of P~CMAX,c~/PH when a PHR is triggered by other triggering conditions.
If the UE has UL resources allocated for new transmission for this TTI:
\- if it is the first UL resource allocated for a new transmission since the
last MAC reset, start _periodicPHR-Timer_ ;
\- if the Power Headroom reporting procedure determines that at least one PHR
has been triggered and not cancelled, and;
\- if the allocated UL resources can accommodate a PHR MAC control element
plus its subheader if _extendedPHR_ is not configured, or the Extended PHR MAC
control element plus its subheader if _extendedPHR_ is configured, as a result
of logical channel prioritization:
\- if _extendedPHR_ is configured:
\- for each activated Serving Cell with configured uplink:
\- obtain the value of the Type 1 power headroom;
\- if the UE has UL resources allocated for transmission on this Serving Cell
for this TTI:
\- obtain the value for the corresponding P~CMAX,c~ field from the physical
layer;
\- if _simultaneousPUCCH-PUSCH_ is configured:
\- obtain the value of the Type 2 power headroom for the PCell;
\- if the UE has a PUCCH transmission in this TTI:
\- obtain the value for the corresponding P~CMAX,c~ field from the physical
layer;
\- instruct the Multiplexing and Assembly procedure to generate and transmit
an Extended PHR MAC control element as defined in subclause 6.1.3.6a based on
the values reported by the physical layer;
\- else:
\- obtain the value of the Type 1 power headroom from the physical layer;
\- instruct the Multiplexing and Assembly procedure to generate and transmit a
PHR MAC control element as defined in subclause 6.1.3.6 based on the value
reported by the physical layer;
\- start or restart _periodicPHR-Timer_ ;
\- start or restart _prohibitPHR-Timer_ ;
\- cancel all triggered PHR(s).
## 5.5 PCH reception
When the UE needs to receive PCH, the UE shall:
\- if a PCH assignment has been received on the PDCCH for the P-RNTI:
\- attempt to decode the TB on the PCH as indicated by the PDCCH information.
\- if a TB on the PCH has been successfully decoded:
\- deliver the decoded MAC PDU to upper layers.
## 5.6 BCH reception
When the UE needs to receive BCH, the UE shall:
\- receive and attempt to decode the BCH;
\- if a TB on the BCH has been successfully decoded:
\- deliver the decoded MAC PDU to upper layers.
## 5.7 Discontinuous Reception (DRX)
The UE may be configured by RRC with a DRX functionality that controls the
UE's PDCCH monitoring activity for the UE's C-RNTI, TPC-PUCCH-RNTI, TPC-PUSCH-
RNTI and Semi-Persistent Scheduling C-RNTI (if configured). When in
RRC_CONNECTED, if DRX is configured, the UE is allowed to monitor the PDCCH
discontinuously using the DRX operation specified in this subclause; otherwise
the UE monitors the PDCCH continuously. When using DRX operation, the UE shall
also monitor PDCCH according to requirements found in other subclauses of this
specification. RRC controls DRX operation by configuring the timers
_onDurationTimer_ , _drx-InactivityTimer_ , _drx-RetransmissionTimer_ (one per
DL HARQ process except for the broadcast process), the _longDRX-Cycle_ , the
value of the _drxStartOffset_ and optionally the _drxShortCycleTimer_ and
_shortDRX-Cycle_. A HARQ RTT timer per DL HARQ process (except for the
broadcast process) is also defined (see subclause 7.7).
When a DRX cycle is configured, the Active Time includes the time while:
_\- onDurationTimer_ or _drx-InactivityTimer_ or _drx-RetransmissionTimer_ or
_mac-ContentionResolutionTimer_ (as described in subclause 5.1.5) is running;
or
\- a Scheduling Request is sent on PUCCH and is pending (as described in
subclause 5.4.4); or
\- an uplink grant for a pending HARQ retransmission can occur and there is
data in the corresponding HARQ buffer; or
\- a PDCCH indicating a new transmission addressed to the C-RNTI of the UE has
not been received after successful reception of a Random Access Response for
the preamble not selected by the UE (as described in subclause 5.1.4).
When DRX is configured, the UE shall for each subframe:
\- if a HARQ RTT Timer expires in this subframe and the data of the
corresponding HARQ process was not successfully decoded:
\- start the _drx-RetransmissionTimer_ for the corresponding HARQ process.
\- if a DRX Command MAC control element is received:
\- stop _onDurationTimer_ ;
\- stop _drx-InactivityTimer_.
\- if _drx-InactivityTimer_ expires or a DRX Command MAC control element is
received in this subframe:
\- if the Short DRX cycle is configured:
\- start or restart _drxShortCycleTimer_ ;
\- use the Short DRX Cycle.
\- else:
\- use the Long DRX cycle.
\- if _drxShortCycleTimer_ expires in this subframe:
\- use the Long DRX cycle.
> \- If the Short DRX Cycle is used and [(SFN * 10) + subframe number] modulo
> (_shortDRX-Cycle_) = (_drxStartOffset_) modulo (_shortDRX-Cycle_); or
>
> \- if the Long DRX Cycle is used and [(SFN * 10) + subframe number] modulo
> (_longDRX-Cycle_) = _drxStartOffset_ :
>
> \- start _onDurationTimer_.
\- during the Active Time, for a PDCCH-subframe, if the subframe is not
required for uplink transmission for half-duplex FDD UE operation and if the
subframe is not part of a configured measurement gap:
\- monitor the PDCCH;
\- if the PDCCH indicates a DL transmission or if a DL assignment has been
configured for this subframe:
\- start the HARQ RTT Timer for the corresponding HARQ process;
\- stop the _drx-RetransmissionTimer_ for the corresponding HARQ process.
\- if the PDCCH indicates a new transmission (DL or UL):
\- start or restart _drx-InactivityTimer_.
\- in current subframe n, if the UE would not be in Active Time considering
grants/assignments/DRX Command MAC control elements received and Scheduling
Request sent until and including subframe n-5 when evaluating all DRX Active
Time conditions as specified in this subclause, type-0-triggered SRS [2] shall
not be reported.
\- if CQI masking (_cqi-Mask_) is setup by upper layers:
\- in current subframe n, if _onDurationTimer_ would not be running
considering grants/assignments/DRX Command MAC control elements received until
and including subframe n-5 when evaluating all DRX Active Time conditions as
specified in this subclause, CQI/PMI/RI/PTI on PUCCH shall not be reported.
\- else:
\- in current subframe n, if the UE would not be in Active Time considering
grants/assignments/DRX Command MAC control elements received and Scheduling
Request sent until and including subframe n-5 when evaluating all DRX Active
Time conditions as specified in this subclause, CQI/PMI/RI/PTI on PUCCH shall
not be reported.
Regardless of whether the UE is monitoring PDCCH or not, the UE receives and
transmits HARQ feedback and transmits type-1-triggered SRS [2] when such is
expected.
NOTE: The same active time applies to all activated serving cell(s).
NOTE: In case of downlink spatial multiplexing, if a TB is received while the
HARQ RTT Timer is running and the previous transmission of the same TB was
received at least N subframes before the current subframe (where N corresponds
to the HARQ RTT Timer), the UE should process it and restart the HARQ RTT
Timer.
## 5.8 MAC reconfiguration
When a reconfiguration of the MAC entity is requested by upper layers, the UE
shall:
\- upon addition of an SCell, initialize the corresponding HARQ entity;
\- upon removal of an SCell, remove the corresponding HARQ entity;
\- for timers apply the new value when the timer is (re)started;
\- when counters are initialized apply the new maximum parameter value;
\- for other parameters, apply immediately the configurations received from
upper layers.
## 5.9 MAC Reset
If a reset of the MAC entity is requested by upper layers, the UE shall:
\- initialize Bj for each logical channel to zero;
\- stop (if running) all timers;
\- consider all _timeAlignmentTimers_ as expired and perform the corresponding
actions in subclause 5.2;
\- set the NDIs for all uplink HARQ processes to the value 0;
\- stop, if any, ongoing RACH procedure;
\- discard explicitly signalled _ra-PreambleIndex_ and _ra-PRACH-MaskIndex_ ,
if any;
\- flush Msg3 buffer;
\- cancel, if any, triggered Scheduling Request procedure;
\- cancel, if any, triggered Buffer Status Reporting procedure;
\- cancel, if any, triggered Power Headroom Reporting procedure;
\- flush the soft buffers for all DL HARQ processes;
\- for each DL HARQ process, consider the next received transmission for a TB
as the very first transmission;
\- release, if any, Temporary C-RNTI.
## 5.10 Semi-Persistent Scheduling
When Semi-Persistent Scheduling is enabled by RRC, the following information
is provided [8]:
\- Semi-Persistent Scheduling C-RNTI;
\- Uplink Semi-Persistent Scheduling interval _semiPersistSchedIntervalUL_ and
number of empty transmissions before implicit release _implicitReleaseAfter_ ,
if Semi-Persistent Scheduling is enabled for the uplink;
\- Whether _twoIntervalsConfig_ is enabled or disabled for uplink, only for
TDD;
\- Downlink Semi-Persistent Scheduling interval _semiPersistSchedIntervalDL_
and number of configured HARQ processes for Semi-Persistent Scheduling
_numberOfConfSPS-Processes_ , if Semi-Persistent Scheduling is enabled for the
downlink;
When Semi-Persistent Scheduling for uplink or downlink is disabled by RRC, the
corresponding configured grant or configured assignment shall be discarded.
Semi-Persistent Scheduling is supported on the PCell only.
Semi-Persistent Scheduling is not supported for RN communication with the
E-UTRAN in combination with an RN subframe configuration.
### 5.10.1 Downlink
After a Semi-Persistent downlink assignment is configured, the UE shall
consider sequentially that the N^th^ assignment occurs in the subframe for
which:
\- (10 * SFN + subframe) = [(10 * SFN~start\ time~ + subframe~start\ time~) +
N * _semiPersistSchedIntervalDL_] modulo 10240.
Where SFN~start\ time~ and subframe~start\ time~ are the SFN and subframe,
respectively, at the time the configured downlink assignment were
(re-)initialised.
### 5.10.2 Uplink
After a Semi-Persistent Scheduling uplink grant is configured, the UE shall:
\- if _twoIntervalsConfig_ is enabled by upper layer:
\- set the Subframe_Offset according to Table 7.4-1.
> \- else:
\- set Subframe_Offset to 0.
\- consider sequentially that the N^th^ grant occurs in the subframe for
which:
\- (10 * SFN + subframe) = [(10 * SFN~start\ time~ + subframe~start\ time~) +
N * _semiPersistSchedIntervalUL_ \+ Subframe_Offset * (N modulo 2)] modulo
10240.
Where SFN~start\ time~ and subframe~start\ time~ are the SFN and subframe,
respectively, at the time the configured uplink grant were (re-)initialised.
The UE shall clear the configured uplink grant immediately after
_implicitReleaseAfter_ [8] number of consecutive new MAC PDUs each containing
zero MAC SDUs have been provided by the Multiplexing and Assembly entity, on
the Semi-Persistent Scheduling resource.
NOTE: Retransmissions for Semi-Persistent Scheduling can continue after
clearing the configured uplink grant.
## 5.11 Handling of unknown, unforeseen and erroneous protocol data
When a MAC entity receives a MAC PDU for the UE's C-RNTI or Semi-Persistent
Scheduling C-RNTI, or by the configured downlink assignment, containing
reserved or invalid values, the MAC entity shall:
\- discard the received PDU.
When a MAC entity receives a MAC PDU on MCH containing reserved values, the UE
shall:
\- ignore the fields in the PDU header and the control elements containing
reserved values and the corresponding parts indicated by the fields in the
received PDU.
## 5.12 MCH reception
MCH transmission may occur in subframes configured by upper layer for MCCH or
MTCH transmission. For each such subframe, upper layer indicates if
_signallingMCS_ or _dataMCS_ applies. The transmission of an MCH occurs in a
set of subframes defined by _PMCH-Config_. An MCH Scheduling Information MAC
control element is included in the first subframe allocated to the MCH within
the MCH scheduling period to indicate the position of each MTCH and unused
subframes on the MCH. The UE shall assume that the first scheduled MTCH starts
immediately after the MCCH or the MCH Scheduling Information MAC control
element if the MCCH is not present, and the other scheduled MTCH(s) start
immediately after the previous MTCH, at the earliest in the subframe where the
previous MTCH stops. When the UE needs to receive MCH, the UE shall:
\- attempt to decode the TB on the MCH;
\- if a TB on the MCH has been successfully decoded:
\- demultiplex the MAC PDU and deliver the MAC SDU(s) to upper layers.
## 5.13 Activation/Deactivation of SCells
If the UE is configured with one or more SCells, the network may activate and
deactivate the configured SCells. The PCell is always activated. The network
activates and deactivates the SCell(s) by sending the Activation/Deactivation
MAC control element described in subclause 6.1.3.8. Furthermore, the UE
maintains a _sCellDeactivationTimer_ timer per configured SCell and
deactivates the associated SCell upon its expiry. The same initial timer value
applies to each instance of the _sCellDeactivationTimer_ and it is configured
by RRC. The configured SCells are initially deactivated upon addition and
after a handover.
The UE shall for each TTI and for each configured SCell:
\- if the UE receives an Activation/Deactivation MAC control element in this
TTI activating the SCell, the UE shall in the TTI according to the timing
defined in [2]:
\- activate the SCell; i.e. apply normal SCell operation including:
\- SRS transmissions on the SCell;
\- CQI/PMI/RI/PTI reporting for the SCell;
\- PDCCH monitoring on the SCell;
\- PDCCH monitoring for the SCell.
\- start or restart the _sCellDeactivationTimer_ associated with the SCell;
\- trigger PHR according to subclause 5.4.6.
\- else, if the UE receives an Activation/Deactivation MAC control element in
this TTI deactivating the SCell; or
\- if the _sCellDeactivationTimer_ associated with the activated SCell expires
in this TTI:
\- in the TTI according to the timing defined in [2]:
\- deactivate the SCell;
\- stop the _sCellDeactivationTimer_ associated with the SCell;
\- flush all HARQ buffers associated with the SCell.
\- if PDCCH on the activated SCell indicates an uplink grant or downlink
assignment; or
\- if PDCCH on the Serving Cell scheduling the activated SCell indicates an
uplink grant or a downlink assignment for the activated SCell:
\- restart the _sCellDeactivationTimer_ associated with the SCell;
\- if the SCell is deactivated:
\- not transmit SRS on the SCell;
\- not report CQI/PMI/RI/PTI for the SCell;
\- not transmit on UL-SCH on the SCell;
\- not transmit on RACH on the SCell;
\- not monitor the PDCCH on the SCell;
\- not monitor the PDCCH for the SCell.
HARQ feedback for the MAC PDU containing Activation/Deactivation MAC control
element shall not be impacted by PCell interruption due to SCell
activation/deactivation [9].
NOTE: When SCell is deactivated, the ongoing Random Access procedure on the
SCell, if any, is aborted.
# 6 Protocol Data Units, formats and parameters
## 6.1 Protocol Data Units
### 6.1.1 General
A MAC PDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in
length. In the figures in subclause 6.1, bit strings are represented by tables
in which the most significant bit is the leftmost bit of the first line of the
table, the least significant bit is the rightmost bit on the last line of the
table, and more generally the bit string is to be read from left to right and
then in the reading order of the lines. The bit order of each parameter field
within a MAC PDU is represented with the first and most significant bit in the
leftmost bit and the last and least significant bit in the rightmost bit.
MAC SDUs are bit strings that are byte aligned (i.e. multiple of 8 bits) in
length. An SDU is included into a MAC PDU from the first bit onward.
The UE shall ignore the value of Reserved bits in downlink MAC PDUs.
### 6.1.2 MAC PDU (DL-SCH and UL-SCH except transparent MAC and Random Access
Response, MCH)
A MAC PDU consists of a MAC header, zero or more MAC Service Data Units (MAC
SDU), zero, or more MAC control elements, and optionally padding; as described
in Figure 6.1.2-3.
Both the MAC header and the MAC SDUs are of variable sizes.
A MAC PDU header consists of one or more MAC PDU subheaders; each subheader
corresponds to either a MAC SDU, a MAC control element or padding.
A MAC PDU subheader consists of the six header fields R/R/E/LCID/F/L but for
the last subheader in the MAC PDU and for fixed sized MAC control elements.
The last subheader in the MAC PDU and subheaders for fixed sized MAC control
elements consist solely of the four header fields R/R/E/LCID. A MAC PDU
subheader corresponding to padding consists of the four header fields
R/R/E/LCID.
Figure 6.1.2-1: R/R/E/LCID/F/L MAC subheader
Figure 6.1.2-2: R/R/E/LCID MAC subheader
MAC PDU subheaders have the same order as the corresponding MAC SDUs, MAC
control elements and padding.
MAC control elements are always placed before any MAC SDU.
Padding occurs at the end of the MAC PDU, except when single-byte or two-byte
padding is required. Padding may have any value and the UE shall ignore it.
When padding is performed at the end of the MAC PDU, zero or more padding
bytes are allowed.
When single-byte or two-byte padding is required, one or two MAC PDU
subheaders corresponding to padding are placed at the beginning of the MAC PDU
before any other MAC PDU subheader.
A maximum of one MAC PDU can be transmitted per TB per UE. A maximum of one
MCH MAC PDU can be transmitted per TTI.
Figure 6.1.2-3: Example of MAC PDU consisting of MAC header, MAC control
elements, MAC SDUs and padding
### 6.1.3 MAC Control Elements
#### 6.1.3.1 Buffer Status Report MAC Control Elements
Buffer Status Report (BSR) MAC control elements consist of either:
\- Short BSR and Truncated BSR format: one LCG ID field and one corresponding
Buffer Size field (figure 6.1.3.1-1); or
\- Long BSR format: four Buffer Size fields, corresponding to LCG IDs #0
through #3 (figure 6.1.3.1-2).
The BSR formats are identified by MAC PDU subheaders with LCIDs as specified
in table 6.2.1-2.
The fields LCG ID and Buffer Size are defined as follow:
\- LCG ID: The Logical Channel Group ID field identifies the group of logical
channel(s) which buffer status is being reported. The length of the field is 2
bits;
\- Buffer Size: The Buffer Size field identifies the total amount of data
available across all logical channels of a logical channel group after all MAC
PDUs for the TTI have been built. The amount of data is indicated in number of
bytes. It shall include all data that is available for transmission in the RLC
layer and in the PDCP layer; the definition of what data shall be considered
as available for transmission is specified in [3] and [4] respectively. The
size of the RLC and MAC headers are not considered in the buffer size
computation. The length of this field is 6 bits. If _extendedBSR-Sizes_ is not
configured, the values taken by the Buffer Size field are shown in Table
6.1.3.1-1. If _extendedBSR-Sizes_ is configured, the values taken by the
Buffer Size field are shown in Table 6.1.3.1-2.
Figure 6.1.3.1-1: Short BSR and Truncated BSR MAC control element
Figure 6.1.3.1-2: Long BSR MAC control element
Table 6.1.3.1-1: Buffer size levels for BSR
* * *
**Index** **Buffer Size (BS) value [bytes]** **Index** **Buffer Size (BS)
value [bytes]** 0 BS = 0 32 1132 \ 150000
* * *
Table 6.1.3.1-2: Extended Buffer size levels for BSR
* * *
**Index** **Buffer Size (BS) value [bytes]** **Index** **Buffer Size (BS)
value [bytes]** 0 BS = 0 32 4940 \ 3000000
* * *
#### 6.1.3.2 C-RNTI MAC Control Element
The C-RNTI MAC control element is identified by MAC PDU subheader with LCID as
specified in table 6.2.1-2.
It has a fixed size and consists of a single field defined as follows (figure
6.1.3.2-1):
\- C-RNTI: This field contains the C-RNTI of the UE. The length of the field
is 16 bits.
Figure 6.1.3.2-1: C-RNTI MAC control element
#### 6.1.3.3 DRX Command MAC Control Element
The DRX Command MAC control element is identified by a MAC PDU subheader with
LCID as specified in table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.4 UE Contention Resolution Identity MAC Control Element
The UE Contention Resolution Identity MAC control element is identified by MAC
PDU subheader with LCID as specified in table 6.2.1-1. This control element
has a fixed 48-bit size and consists of a single field defined as follows
(figure 6.1.3.4-1)
\- UE Contention Resolution Identity: This field contains the uplink CCCH SDU.
Figure 6.1.3.4-1: UE Contention Resolution Identity MAC control element
#### 6.1.3.5 Timing Advance Command MAC Control Element
The Timing Advance Command MAC control element is identified by MAC PDU
subheader with LCID as specified in table 6.2.1-1.
It has a fixed size and consists of a single octet defined as follows (figure
6.1.3.5-1):
\- TAG Identity (TAG Id): This field indicates the TAG Identity of the
addressed TAG. The TAG containing the PCell has the TAG Identity 0. The length
of the field is 2 bits;
\- Timing Advance Command: This field indicates the index value _T~A~_ (0, 1,
2... 63) used to control the amount of timing adjustment that UE has to apply
(see subclause 4.2.3 of [2]). The length of the field is 6 bits.
Figure 6.1.3.5-1: Timing Advance Command MAC control element
#### 6.1.3.6 Power Headroom MAC Control Element
The Power Headroom MAC control element is identified by a MAC PDU subheader
with LCID as specified in table 6.2.1-2. It has a fixed size and consists of a
single octet defined as follows (figure 6.1.3.6-1):
\- R: reserved bit, set to \"0\";
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 below (the corresponding measured
values in dB can be found in subclause 9.1.8.4 of [9]).
Figure 6.1.3.6-1: Power Headroom MAC control element
Table 6.1.3.6-1: Power Headroom levels for PHR
* * *
PH Power Headroom Level 0 POWER_HEADROOM_0 1 POWER_HEADROOM_1 2
POWER_HEADROOM_2 3 POWER_HEADROOM_3 ... ... 60 POWER_HEADROOM_60 61
POWER_HEADROOM_61 62 POWER_HEADROOM_62 63 POWER_HEADROOM_63
* * *
#### 6.1.3.6a Extended Power Headroom MAC Control Element
The Extended Power Headroom MAC control element is identified by a MAC PDU
subheader with LCID as specified in table 6.2.1-2. It has a variable size and
is defined in Figure 6.1.3.6a-2. When Type 2 PH is reported, the octet
containing the Type 2 PH field is included first after the octet indicating
the presence of PH per SCell and followed by an octet containing the
associated P~CMAX,c~ field (if reported). Then follows in ascending order
based on the _ServCellIndex [8]_ an octet with the Type 1 PH field and an
octet with the associated P~CMAX,c~ field (if reported), for the PCell and for
each SCell indicated in the bitmap.
The Extended Power Headroom MAC Control Element is defined as follows:
\- C~i~: this field indicates the presence of a PH field for the SCell with
_SCellIndex_ i as specified in [8]. The C~i~ field set to \"1\" indicates that
a PH field for the SCell with _SCellIndex_ i is reported. The C~i~ field set
to \"0\" indicates that a PH field for the SCell with _SCellIndex_ i is not
reported;
\- R: reserved bit, set to \"0\";
\- V: this field indicates if the PH value is based on a real transmission or
a reference format. For Type 1 PH, V=0 indicates real transmission on PUSCH
and V=1 indicates that a PUSCH reference format is used. For Type 2 PH, V=0
indicates real transmission on PUCCH and V=1 indicates that a PUCCH reference
format is used. Furthermore, for both Type 1 and Type 2 PH, V=0 indicates the
presence of the octet containing the associated P~CMAX,c~ field, and V=1
indicates that the octet containing the associated P~CMAX,c~ field is omitted;
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 (the corresponding measured
values in dB can be found in subclause 9.1.8.4 of [9]);
\- P: this field indicates whether the UE applies power backoff due to power
management (as allowed by P-MPR~c~ [10]). The UE shall set P=1 if the
corresponding P~CMAX,c~ field would have had a different value if no power
backoff due to power management had been applied;
\- P~CMAX,c~: if present, this field indicates the P~CMAX,c~ or
${\overset{\sim}{P}}_{\text{CMAX},c}$[2] used for calculation of the preceding
PH field. The reported P~CMAX,c~ and the corresponding nominal UE transmit
power levels are shown in Table 6.1.3.6a-1 (the corresponding measured values
in dBm can be found in subclause 9.6.1 of [9]).
Figure 6.1.3.6a-1: Void
Figure 6.1.3.6a-2: Extended Power Headroom MAC Control Element
Table 6.1.3.6a-1: Nominal UE transmit power level for Extended PHR
+-----------+---------------------------------+ | P~CMAX,c~ | Nominal UE transmit power level | +-----------+---------------------------------+ | 0 | > PCMAX_C_00 | +-----------+---------------------------------+ | 1 | > PCMAX_C_01 | +-----------+---------------------------------+ | 2 | > PCMAX_C_02 | +-----------+---------------------------------+ | ... | ... | +-----------+---------------------------------+ | 61 | > PCMAX_C_61 | +-----------+---------------------------------+ | 62 | > PCMAX_C_62 | +-----------+---------------------------------+ | 63 | > PCMAX_C_63 | +-----------+---------------------------------+
#### 6.1.3.7 MCH Scheduling Information MAC Control Element
The MCH Scheduling Information MAC Control Element illustrated in Figure
6.1.3.7-1 is identified by a MAC PDU subheader with LCID as specified in Table
6.2.1-4. This control element has a variable size. For each MTCH the fields
below are included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits;
\- Stop MTCH: this field indicates the ordinal number of the subframe within
the MCH scheduling period, counting only the subframes allocated to the MCH,
where the corresponding MTCH stops. Value 0 corresponds to the first subframe.
The length of the field is 11 bits. The special Stop MTCH value 2047 indicates
that the corresponding MTCH is not scheduled. The value range 2043 to 2046 is
reserved.
Figure 6.1.3.7-1: MCH Scheduling Information MAC control element
#### 6.1.3.8 Activation/Deactivation MAC Control Element
The Activation/Deactivation MAC control element is identified by a MAC PDU
subheader with LCID as specified in table 6.2.1-1. It has a fixed size and
consists of a single octet containing seven C-fields and one R-field. The
Activation/Deactivation MAC control element is defined as follows (figure
6.1.3.8-1).
  * C~i~: if there is an SCell configured with _SCellIndex_ i as specified in [8], this field indicates the activation/deactivation status of the SCell with _SCellIndex_ i , else the UE shall ignore the C~i~ field. The C~i~ field is set to \"1\" to indicate that the SCell with _SCellIndex_ i shall be activated. The C~i~ field is set to \"0\" to indicate that the SCell with _SCellIndex_ i shall be deactivated;
  * R: Reserved bit, set to "0".
Figure 6.1.3.8-1: Activation/Deactivation MAC control element
### 6.1.4 MAC PDU (transparent MAC)
A MAC PDU consists solely of a MAC Service Data Unit (MAC SDU) whose size is
aligned to a TB; as described in figure 6.1.4-1.
Figure 6.1.4-1: Example of MAC PDU (transparent MAC)
### 6.1.5 MAC PDU (Random Access Response)
A MAC PDU consists of a MAC header and zero or more MAC Random Access
Responses (MAC RAR) and optionally padding as described in figure 6.1.5-4.
The MAC header is of variable size.
A MAC PDU header consists of one or more MAC PDU subheaders; each subheader
corresponding to a MAC RAR except for the Backoff Indicator subheader. If
included, the Backoff Indicator subheader is only included once and is the
first subheader included within the MAC PDU header.
A MAC PDU subheader consists of the three header fields E/T/RAPID (as
described in figure 6.1.5-1) but for the Backoff Indicator subheader which
consists of the five header field E/T/R/R/BI (as described in figure 6.1.5-2).
A MAC RAR consists of the four fields R/Timing Advance Command/UL
Grant/Temporary C-RNTI (as described in figure 6.1.5-3).
Padding may occur after the last MAC RAR. Presence and length of padding is
implicit based on TB size, size of MAC header and number of RARs.
Figure 6.1.5-1: E/T/RAPID MAC subheader
Figure 6.1.5-2: E/T/R/R/BI MAC subheader
Figure 6.1.5-3: MAC RAR
Figure 6.1.5-4: Example of MAC PDU consisting of a MAC header and MAC RARs
## 6.2 Formats and parameters
### 6.2.1 MAC header for DL-SCH, UL-SCH and MCH
The MAC header is of variable size and consists of the following fields:
\- LCID: The Logical Channel ID field identifies the logical channel instance
of the corresponding MAC SDU or the type of the corresponding MAC control
element or padding as described in tables 6.2.1-1, 6.2.1-2 and 6.2.1-4 for the
DL-SCH, UL-SCH and MCH respectively. There is one LCID field for each MAC SDU,
MAC control element or padding included in the MAC PDU. In addition to that,
one or two additional LCID fields are included in the MAC PDU, when single-
byte or two-byte padding is required but cannot be achieved by padding at the
end of the MAC PDU. The LCID field size is 5 bits;
\- L: The Length field indicates the length of the corresponding MAC SDU or
variable-sized MAC control element in bytes. There is one L field per MAC PDU
subheader except for the last subheader and subheaders corresponding to fixed-
sized MAC control elements. The size of the L field is indicated by the F
field;
\- F: The Format field indicates the size of the Length field as indicated in
table 6.2.1-3. There is one F field per MAC PDU subheader except for the last
subheader and subheaders corresponding to fixed-sized MAC control elements.
The size of the F field is 1 bit. If the size of the MAC SDU or variable-sized
MAC control element is less than 128 bytes, the value of the F field is set to
0, otherwise it is set to 1;
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate another set of
at least R/R/E/LCID fields. The E field is set to \"0\" to indicate that
either a MAC SDU, a MAC control element or padding starts at the next byte;
\- R: Reserved bit, set to \"0\".
The MAC header and subheaders are octet aligned.
Table 6.2.1-1 Values of LCID for DL-SCH
* * *
Index LCID values 00000 CCCH 00001-01010 Identity of the logical channel
01011-11010 Reserved 11011 Activation/Deactivation 11100 UE Contention
Resolution Identity 11101 Timing Advance Command 11110 DRX Command 11111
Padding
* * *
Table 6.2.1-2 Values of LCID for UL-SCH
* * *
Index LCID values 00000 CCCH 00001-01010 Identity of the logical channel
01011-11000 Reserved 11001 Extended Power Headroom Report 11010 Power Headroom
Report 11011 C-RNTI 11100 Truncated BSR 11101 Short BSR 11110 Long BSR 11111
Padding
* * *
Table 6.2.1-3 Values of F field:
* * *
Index Size of Length field (in bits) 0 7 1 15
* * *
Table 6.2.1-4 Values of LCID for MCH
* * *
Index LCID values 00000 MCCH (see note) 00001-11100 MTCH 11101 Reserved 11110
MCH Scheduling Information 11111 Padding NOTE: If there is no MCCH on MCH, an
MTCH could use this value.
* * *
### 6.2.2 MAC header for Random Access Response
The MAC header is of variable size and consists of the following fields:
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate at least
another set of E/T/RAPID fields follows. The E field is set to \"0\" to
indicate that a MAC RAR or padding starts at the next byte;
\- T: The Type field is a flag indicating whether the MAC subheader contains a
Random Access ID or a Backoff Indicator. The T field is set to "0" to indicate
the presence of a Backoff Indicator field in the subheader (BI). The T field
is set to "1" to indicate the presence of a Random Access Preamble ID field in
the subheader (RAPID);
\- R: Reserved bit, set to \"0\";
\- BI: The Backoff Indicator field identifies the overload condition in the
cell. The size of the BI field is 4 bits;
\- RAPID: The Random Access Preamble IDentitfier field identifies the
transmitted Random Access Preamble (see subclause 5.1.3). The size of the
RAPID field is 6 bits.
The MAC header and subheaders are octet aligned.
### 6.2.3 MAC payload for Random Access Response
The MAC RAR is of fixed size and consists of the following fields:
\- R: Reserved bit, set to \"0\";
\- Timing Advance Command: The Timing Advance Command field indicates the
index value _T~A~_ (0, 1, 2... 1282) used to control the amount of timing
adjustment that UE has to apply (see subclause 4.2.3 of [2]). The size of the
Timing Advance Command field is 11 bits;
\- UL Grant: The UpLink Grant field indicates the resources to be used on the
uplink (see subclause 6.2 of [2]). The size of the UL Grant field is 20 bits;
\- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary
identity that is used by the UE during Random Access. The size of the
Temporary C-RNTI field is 16 bits.
The MAC RAR is octet aligned.
# 7 Variables and constants
## 7.1 RNTI values
RNTI values are presented in Table 7.1-1 and their usage and associated
Transport Channels and Logical Channels are presented in Table 7.1-2.
Table 7.1-1: RNTI values.
* * *
Value (hexa-decimal) RNTI 0000 N/A 0001-003C RA-RNTI, C-RNTI, Semi-Persistent
Scheduling C-RNTI, Temporary C-RNTI, TPC-PUCCH-RNTI and TPC-PUSCH-RNTI (see
note) 003D-FFF3 C-RNTI, Semi-Persistent Scheduling C-RNTI, Temporary C-RNTI,
TPC-PUCCH-RNTI and TPC-PUSCH-RNTI FFF4-FFFC Reserved for future use FFFD
M-RNTI FFFE P-RNTI FFFF SI-RNTI
* * *
NOTE: A UE uses the same C-RNTI on all Serving Cells.
Table 7.1-2: RNTI usage.
+----------------+----------------+----------------+----------------+ | RNTI | Usage | Transport | Logical | | | | Channel | Channel | +----------------+----------------+----------------+----------------+ | P-RNTI | Paging and | PCH | PCCH | | | System | | | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | SI-RNTI | Broadcast of | DL-SCH | BCCH | | | System | | | | | Information | | | +----------------+----------------+----------------+----------------+ | M-RNTI | MCCH | N/A | N/A | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | RA-RNTI | Random Access | DL-SCH | N/A | | | Response | | | +----------------+----------------+----------------+----------------+ | Temporary | Contention | DL-SCH | CCCH | | C-RNTI | Resolution\ | | | | | (when no valid | | | | | C-RNTI is | | | | | available) | | | +----------------+----------------+----------------+----------------+ | Temporary | Msg3 | UL-SCH | CCCH, DCCH, | | C-RNTI | transmission | | DTCH | +----------------+----------------+----------------+----------------+ | C-RNTI | Dynamically | UL-SCH | DCCH, DTCH | | | scheduled | | | | | unicast | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | C-RNTI | Dynamically | DL-SCH | CCCH, DCCH, | | | scheduled | | DTCH | | | unicast | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | C-RNTI | Triggering of | N/A | N/A | | | PDCCH ordered | | | | | random access | | | +----------------+----------------+----------------+----------------+ | S | Sem | DL-SCH, UL-SCH | DCCH, DTCH | | emi-Persistent | i-Persistently | | | | Scheduling | scheduled | | | | C-RNTI | unicast | | | | | transmission | | | | | | | | | | (activation, | | | | | reactivation | | | | | and | | | | | r | | | | | etransmission) | | | +----------------+----------------+----------------+----------------+ | S | Sem | N/A | N/A | | emi-Persistent | i-Persistently | | | | Scheduling | scheduled | | | | C-RNTI | unicast | | | | | transmission | | | | | | | | | | (deactivation) | | | +----------------+----------------+----------------+----------------+ | TPC-PUCCH-RNTI | Physical layer | N/A | N/A | | | Uplink power | | | | | control | | | +----------------+----------------+----------------+----------------+ | TPC-PUSCH-RNTI | Physical layer | N/A | N/A | | | Uplink power | | | | | control | | | +----------------+----------------+----------------+----------------+
## 7.2 Backoff Parameter values
Backoff Parameter values are presented in Table 7.2-1.
Table 7.2-1: Backoff Parameter values.
* * *
Index Backoff Parameter value (ms) 0 0 1 10 2 20 3 30 4 40 5 60 6 80 7 120 8
160 9 240 10 320 11 480 12 960 13 Reserved 14 Reserved 15 Reserved
* * *
The reserved values of the backoff parameter if received by the current
release version UEs shall be taken as 960 ms.
## 7.3 PRACH Mask Index values
Table 7.3-1: PRACH Mask Index values
+------------------+------------------------+------------------------+ | PRACH Mask Index | Allowed PRACH (FDD) | Allowed PRACH (TDD) | +------------------+------------------------+------------------------+ | 0 | All | All | +------------------+------------------------+------------------------+ | 1 | PRACH Resource Index 0 | PRACH Resource Index 0 | +------------------+------------------------+------------------------+ | 2 | PRACH Resource Index 1 | PRACH Resource Index 1 | +------------------+------------------------+------------------------+ | 3 | PRACH Resource Index 2 | PRACH Resource Index 2 | +------------------+------------------------+------------------------+ | 4 | PRACH Resource Index 3 | PRACH Resource Index 3 | +------------------+------------------------+------------------------+ | 5 | PRACH Resource Index 4 | PRACH Resource Index 4 | +------------------+------------------------+------------------------+ | 6 | PRACH Resource Index 5 | PRACH Resource Index 5 | +------------------+------------------------+------------------------+ | 7 | PRACH Resource Index 6 | Reserved | +------------------+------------------------+------------------------+ | 8 | PRACH Resource Index 7 | Reserved | +------------------+------------------------+------------------------+ | 9 | PRACH Resource Index 8 | Reserved | +------------------+------------------------+------------------------+ | 10 | PRACH Resource Index 9 | Reserved | +------------------+------------------------+------------------------+ | 11 | Every, in the time | Every, in the time | | | domain, even PRACH | domain, even PRACH | | | opportunity | opportunity | | | | | | | 1^st^ PRACH Resource | 1^st^ PRACH Resource | | | Index in subframe | Index in subframe | +------------------+------------------------+------------------------+ | 12 | Every, in the time | Every, in the time | | | domain, odd PRACH | domain, odd PRACH | | | opportunity | opportunity | | | | | | | 1^st^ PRACH Resource | 1^st^ PRACH Resource | | | Index in subframe | Index in subframe | +------------------+------------------------+------------------------+ | 13 | Reserved | 1^st^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+ | 14 | Reserved | 2^nd^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+ | 15 | Reserved | 3^rd^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+
## 7.4 Subframe_Offset values
Subframe_Offset values are presented in Table 7.4-1.
Table 7.4-1: Subframe_Offset values
* * *
TDD UL/DL configuration Position of initial Semi-Persistent grant
Subframe_Offset value (ms) 0 N/A 0 1 Subframes 2 and 7 1 Subframes 3 and 8 -1
2 Subframe 2 5 Subframe 7 -5 3 Subframes 2 and 3 1 Subframe 4 -2 4 Subframe 2
1 Subframe 3 -1 5 N/A 0 6 N/A 0
* * *
## 7.5 TTI_BUNDLE_SIZE value
The parameter TTI_BUNDLE_SIZE is 4.
## 7.6 DELTA_PREAMBLE values
The DELTA_PREAMBLE preamble format based power offset values are presented in
Table 7.6-1.
Table 7.6-1: DELTA_PREAMBLE values.
* * *
Preamble Format DELTA_PREAMBLE value 0 0 dB 1 0 dB 2 -3 dB 3 -3 dB 4 8 dB
* * *
Where the Preamble Format is given by _prach-ConfigIndex_ [7].
## 7.7 HARQ RTT Timer
For FDD the HARQ RTT Timer is set to 8 subframes. For TDD the HARQ RTT Timer
is set to k + 4 subframes, where k is the interval between the downlink
transmission and the transmission of associated HARQ feedback, as indicated in
Table 10.1.3.1-1 of [2] , and for an RN configured with _rn-SubframeConfig_
[8] and not suspended, as indicated in Table 7.5.1-1 of [11].
###### ## Annex A (normative): Handling of measurement gaps
In this specification, the subframes which cannot be used for transmission
according to subclause 8.1.2.1 of [9] are also considered as part of
measurement gaps in uplink. Measurement gaps are defined in [9].
In a subframe that is part of a measurement gap, the UE shall not perform the
transmission of HARQ feedback and CQI/PMI/RI/PTI, and SRS shall not be
reported.
###### ## Annex B (normative): Contention resolution for RACH access
When checking whether contention resolution was successful a UE considers the
MAC header structures shown below for the processing of a MAC PDU containing a
UE Contention Resolution Identity MAC control element.
###### ## Annex C (informative): Intended UE behaviour for DRX Timers
When a DRX timer is set to a value of _X_ , and _n_ denotes the subframe in
which the related event is triggered according to the section 5.7, the
intended behaviours of each DRX timer are presented in the Table C-1 below:
Table C-1: Intended UE behaviour for DRX timers
+----------------------------------+----------------------------------+ | DRX Timers | Intended UE behaviour\ | | | ([x, y] means including | | | subframe x and y) | +----------------------------------+----------------------------------+ | drx-InactivityTimer | The UE monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n+1, n+m]. | | | | | | The UE starts or restarts | | | drxShortCycleTimer, and uses | | | Short DRX Cycle in the subframe | | | n+m+1, if configured. | +----------------------------------+----------------------------------+ | mac-ContentionResolutionTimer | The UE monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n+1, n+X]. | +----------------------------------+----------------------------------+ | drx-RetransmissionTimer | The UE monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n, n+m-1]. | +----------------------------------+----------------------------------+ | onDurationTimer | The UE monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n, n+m-1]. | +----------------------------------+----------------------------------+ | drxShortCycleTimer | The UE uses the Short DRX Cycle | | | during the subframes [n, | | | n+X-1]. | | | | | | The UE starts to use the Long | | | DRX Cycle in the subframe n+X. | +----------------------------------+----------------------------------+ | HARQ RTT Timer | The UE starts | | | drx-RetransmissionTimer in the | | | subframe n+X, if needed. | +----------------------------------+----------------------------------+ | NOTE: For FDD, m is equal to X; | | | for TDD, m is equal to the | | | minimum number of subframes so | | | that X PDCCH-subframes are | | | included during the subframes | | | [x, y]. | | +----------------------------------+----------------------------------+
For _drx-InactivityTimer_ and _drx-RetransmissionTimer_ , if _X_ =0, the timer
does not make the UE to monitor the PDCCH.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the security architecture, i.e., the security
feature groups and the security mechanisms performed during inter working
between non-3GPP accesses and the Evolved Packet System (EPS).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] IETF RFC 4877: \"Mobile IPv6 Operation with IKEv2 and the Revised IPsec
Architecture\".
[3] Void.
[4] IETF RFC 5778: \"Diameter Mobile IPv6: Support for Home Agent to Diameter
Server Interaction\".
[5] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[6] 3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network
layer security\".
[7] IETF RFC 4187 (January 2006): \"Extensible Authentication Protocol Method
for 3rd Generation Authentication and Key Agreement (EAP-AKA)\".
[8] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[9] 3GPP TS 33.234: \"3G: security; Wireless Local Area Network (WLAN)
interworking security\".
[10] IETF RFC 4072 (August 2005): \"Diameter Extensible Authentication
Protocol (EAP) Application\".
[11] 3GPP TS 33.102: \"3G security; Security architecture\".
[12] 3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework
(AF)\".
[13] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[14] 3GPP TS 23.203: \"Policy and charging control architecture\".
[15] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access (E-UTRAN); Overall description;
Stage 2\".
[16] 3GPP TS 33.401: \"3GPP System Architecture Evolution (SAE); Security
Architecture\".
[17] IETF RFC 3344: \"IP Mobility Support for IPv4\".
[18] IETF RFC 4555: \"IKEv2 Mobility and Multihoming Protocol (MOBIKE)\".
[19] IETF RFC 5295: \"Specification for the Derivation of Root Keys from an
Extended Master Session Key (EMSK)\".
[20] 3GPPP TS 24.303: \"Mobility Management based on Dual-Stack Mobile IPv6;
Stage 3\".
[21] IETF RFC 4433: \"Mobile IPv4 Dynamic Home Agent (HA) Assignment\".
[22] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3; (Release 8) \".
[23] IETF RFC 5448: \"Improved Extensible Authentication Protocol Method for
3rd Generation Authentication and Key Agreement (EAP-AKA\') \".
[24] 3GPP TS 33.222: \"Generic Authentication Architecture (GAA); Access to
network application functions using Hypertext Transfer Protocol over Transport
Layer Security (HTTPS)\".
[25] 3GPP TS 29.109: \"3rd Generation Partnership Project; Technical
Specification Group Core Network and Terminals; Generic Authentication
Architecture (GAA); Zh and Zn Interfaces based on the Diameter protocol; Stage
3\".
[26] - [28] Void.
[29] 3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA) Push function\".
[30] IETF RFC 5996: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".
[31] 3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General
Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C);
Stage 3\".
[32] 3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and
Tunnelling protocols; Stage 3\".
[33] IETF RFC 4739: \"Multiple Authentication Exchanges in the Internet Key
Exchange (IKEv2) Protocol\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**IPsec Security Association (IPsec SA):** A unidirectional logical connection
created for security purposes. All traffic traversing an IPsec SA is provided
the same security protection. The IPsec SA itself is a set of parameters to
define security protection between two entities. An IPsec SA includes the
cryptographic algorithms, the keys, the duration of the keys, and other
parameters.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
S2a This interface is defined in TS 23.402 [05].
S7a Interface between a PCRF and a HS-GW
S101 Interface between a MME and a HRPD AN
S103 Interface between a SGW and a HS-GW
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AAA Authentication Authorisation Accounting
AES Advanced Encryption Standard
AKA Authentication and Key Agreement
ANDSF Access Network Discovery and Selection Function
DSMIPv6 Dual-Stack MIPv6
EAP Extensible Authentication Protocol
EPC Evolved Packet Core
ePDG Evolved Packet Data Gateway
EPS Evolved Packet System
ESP Encapsulating Security Payload
E-UTRAN Evolved UTRAN
HS-GW HRPD Serving GW
IKEv2 Internet Key Exchange Version 2
IPsec IP security protocols, algorithms, and key management methods
LMA Local Mobility Anchor
MAG Mobile Access Gateway
MIPv4 Mobile IP version 4
MIPv6 Mobile IP version 6
MME Mobility Management Entity
MSK Master Session Key
NDS Network Domain Security
NDS/IP NDS for IP based protocols
PMIP/PMIPv6 Proxy Mobile IP version 6
SA Security Association
TWAN Trusted WLAN Access Network
UICC Universal Integrated Circuit Card
USIM Universal Subscriber Identity Module
## 3.4 Conventions
All data variables in the present document are presented with the most
significant substring on the left hand side and the least significant
substring on the right hand side. A substring may be a bit, byte or other
arbitrary length bitstring. Where a variable is broken down into a number of
substrings, the leftmost (most significant) substring is numbered 0, the next
most significant is numbered 1, and so on through to the least significant.
# 4 Overview of Security Architecture for non-3GPP Accesses to EPS
## 4.1 General
The following subclauses outline an overview of the security architecture for
trusted and untrusted non-3GPP accesses to connect to 3GPP EPS. It outlines
the needed security features to connect such a non-3GPP access to the 3GPP
EPS. Non-3GPP access specific security is outside the scope of the present
document.
Figure 4.1-1 gives an overview of the security architecture of a typical
non-3GPP access while connected to the 3GPP EPC.
Figure 4.1-1: Security Architecture of Non-3GPP Access and 3GPP EPS
NOTE: USIM applies in case of terminal with 3GPP access capabilities, cf.
clause 6.1.
Five security feature groups are defined. Each of these feature groups
accomplishes certain security objectives:
**\- Network access security (I):** the set of security features that provide
users with secure access to services while terminated at 3GPP EPC. Radio
Access protection is a non-3GPP access specific and outside the scope of the
present document.
**\- Network domain security (II):** the set of security features that enable
nodes to securely exchange signaling data, and protect against attacks on the
wireline network.
**\- Non-3GPP domain security (III):** the set of security features are a
non-3GPP access specific and outside the scope of the present document.
**\- Application domain security (IV):** the set of security features that
enable applications in the user and in the provider domain to securely
exchange messages.
\- **User domain security (V)** : the set of security features that secure
access to the mobile station. If the terminal does not support 3GPP access
capabilities, 3GPP does not specify how user domain security is achieved.
## 4.2 Trusted non-3GPP Access
As defined in clause 4.3.1.2 of TS 23.402[5] it is the home operator policy
decision if a non-3GPP access network is treated as trusted non-3GPP access
network.When all of the security feature groups provided by the non-3GPP
access network are considered sufficiently secure by the home operator, the
non-3GPP access may be identified as a trusted non-3GPP access for that
operator. However, this policy decision may additionally be based on reasons
not related to security feature groups.
NOTE: It is specified in clause 6.1 of the current specification how the UE
gets the operator policy and how it will behave accordingly
## 4.3 Untrusted non-3GPP Access
As defined in clause 4.3.1.2 of TS 23.402[5] it is the home operator policy
decision if a non-3GPP access network is treated as untrusted non-3GPP access
network. When one or more of the security feature groups provided by the
non-3GPP access network are considered not sufficiently secure by the home
operator, the non-3GPP access may be identified as an untrusted non-3GPP
access for that operator. However, this policy decision may additionally be
based on reasons not related to security feature groups.
NOTE: It is specified in clause 6.1 of the current specification how the UE
gets the operator policy and how it will behave accordingly.
# 5 Security Features Provided by EPS for non-3GPP Accesses
## 5.1 User-to-Network security
### 5.1.1 User identity and device identity confidentiality
User identity confidentiality for procedures between the UE and the Evolved
Packet Core is provided as defined in clauses 6, 8 and 9 of the present
document.
The protection of user identity confidentiality at the non-3GPP access network
level is outside the scope of 3GPP specifications.
Device identity confidentiality is outside the scope of 3GPP specifications.
### 5.1.2 Entity authentication
Entity authentication is provided as defined in clauses 6, 8 and 9 of the
present document.
## 5.2 User data and signalling data confidentiality
Signaling data confidentiality between the UE and an entity in the Evolved
Packet Core is provided as defined in clauses 6, 8 and 9 of the present
document.
Optionally, user data confidentiality between the UE and the PDN GW is
provided as defined in clause 9.2.2 of the present document when DS-MIPv6 is
used,
The establishment of security contexts for user data and signaling data
confidentiality between the UE and an entity in a non-3GPP access network is
defined in clause 7 of the present document. The detailed definition of the
corresponding confidentiality mechanisms is, however, outside the scope of
3GPP specifications.
Signaling data confidentiality between an entity in the non-3GPP access
network and an entity in the Evolved Packet Core, or between two entities in
the Evolved Packet Core, is provided as defined in clause 11 (Network Domain
Security) of the present document.
User data and signaling data confidentiality between two entities in a
non-3GPP access network is outside the scope of 3GPP specifications.
## 5.3 User data and signalling data integrity
Signaling data integrity between the UE and an entity in the Evolved Packet
Core is provided as defined in clauses 6, 8 and 9 of the present document.
Optionally, user data integrity between the UE and the PDN GW is provided as
defined in clause 9.2.2 of the present document when DS-MIPv6 is used,
The establishment of security contexts for user data and signaling data
integrity between the UE and an entity in a non-3GPP access network is defined
in clause 7 of the present document. The detailed definition of the
corresponding integrity mechanisms is, however, outside the scope of 3GPP
specifications.
Signaling data integrity between an entity in the non-3GPP access network and
an entity in the Evolved Packet Core, or between two entities in the Evolved
Packet Core, is provided as defined in clause 11 (Network Domain Security) of
the present document.
User data and signaling data integrity between two entities in a non-3GPP
access network is outside the scope of 3GPP specifications.
# 6 Authentication and key agreement procedures
## 6.1 General
Access authentication for non-3GPP access in EPS shall be based on EAP-AKA
(RFC 4187 [7]) or on EAP-AKA\' (RFC 5448 [23]). The EAP server for EAP-AKA and
EAP-AKA\' shall be the 3GPP AAA server residing in the EPC.
The UE and 3GPP AAA server shall implement both EAP-AKA and EAP-AKA\'. It is
specified in this specification in which cases EAP-AKA and EAP-AKA\'
respectively shall be used.
If the terminal supports 3GPP access capabilities, the credentials used with
EAP-AKA and EAP-AKA\' shall reside on the UICC.
If the terminal does not support 3GPP access capabilities, 3GPP does not
specify where the credentials used with EAP-AKA and EAP-AKA\' reside.
NOTE: EAP-AKA and EAP-AKA\' may use the same credentials.
The procedure in clause 6.2 shall be performed whenever the procedure in
clause 8 of the present document is not performed with the following
exception:
  * if the security procedure in clause 9.2.2.2 for DS-MIPv6 is performed over a trusted access network and
  * if the trusted access network has the properties listed in clause 9.2.2.1
then the procedure in clause 6.2 may be skipped.
However, it is recommended to use the procedure in clause 6.2 unless another
strong authentication and key establishment method is used, which is
documented in a standard covering the non-3GPP access network.
NOTE 1: There are cases when the procedure in clause 6.2 cannot be performed
due to lack of support for EAP in the access network. DSL-based access
networks are examples of such access networks.
In cases where it is difficult to assess whether a given access network has
the properties listed in clauses 9.2.2.1 and 9.3.1.2, it is strongly
recommended to use the procedures for untrusted access in clause 8.
The HSS shall send an authentication vector with AMF separation bit = 1 (cf.
TS 33.401 [16]) to a 3GPP AAA server as specified for the EAP-AKA\' procedures
defined in the present document. For authentication vectors with the
\"separation bit\" set to 1, the secret keys CK and IK generated during AKA
shall never leave the HSS, and shall not be used in a non-EPS context.
The non-3GPP access networks, which are trusted, can be pre-configured in the
UE. The UE can e.g. have a list with non-3GPP access technologies, or access
networks, or serving network operators that allow procedures for trusted
non-3GPP IP access. Additionally, during 3GPP-based access authentication the
UE may receive an indication whether the non-3GPP IP access is trusted or not.
If such an indication is sent it shall be sent by the 3GPP AAA server as part
of an EAP-AKA or EAP-AKA\' request. If no such indication is received by the
UE, and there is no pre-configured information in the UE, the UE shall
consider the non-3GPP IP access as untrusted. In case of pre-configured
information and indication received as part of an EAP-AKA or EAP-AKA\' request
are in conflict, the received indication shall take precedence.
NOTE 2: The protection mechanisms of EAP-AKA and EAP-AKA\' prevent that an
indication sent as part of an EAP-AKA request could be forged.
Additionally, in roaming situations the visited 3GPP network may send an
indication about the trust status of the non-3GPP access network to the 3GPP
AAA server. The 3GPP AAA server may take this indication from the visited
network into account in its decision about sending a trust indication to the
UE.
EAP-AKA and EAP-AKA' use pseudonyms and re-authentication identities.
Pseudonyms and re-authentication identities should be generated using the
method defined in TS 33.234 [9].
NOTE 3: When using the method in TS 33.234 [9] for the generation of
pseudonyms and re-authentication identities the AAA server can resolve these
identities without having to store them. In particular, they can be resolved
even when the UE is not registered.
NOTE 4: TS 33.234 [9] defines Temporary Identities such that the leading six
bits form the Temporary Identity Tag. This tag is converted to a printable
character using the BASE64 method, according to TS 33.234 [9]. Compatibility
with the NAI format defined in TS 23.003 [8] is achieved by choosing the
temporary identity tag such that the printable character equals the leading
digit for the NAI defined in TS 23.003.
The authentication and authorization of the UE\'s access over S2b to external
networks from non-3GPP access networks can be based on PAP and CHAP procedures
as specified further down in the present document. The corresponding
procedures for DS-MIPv6 are given in TS 24.303 [20].
## 6.2 Authentication and key agreement for trusted access
**Figure 6.2-1: Non-3GPP Access Authentication**
EAP-AKA\' as defined in RFC 5448 [23] shall be used for mutual authentication
and key agreement.
1\. A connection is established between the UE and the trusted non-3GPP access
network, using a procedure specific to the non-3GPP access network (which is
out of scope for the present document).
2\. The authenticator in the trusted non-3GPP access network sends an EAP
Request/Identity to the UE.
NOTE 1: EAP packets are transported over this access network using a protocol
specific to this access network (which is out of scope for the present
document).
3\. The UE sends an EAP Response/Identity message. The UE shall send its
identity complying with Network Access Identifier (NAI) format specified in TS
23.003 [8]. NAI contains either a pseudonym allocated to the UE in a previous
run of the authentication procedure or, in the case of first authentication,
the IMSI. In the case of first authentication, the NAI shall indicate EAP-
AKA\' as specified in TS 23.003 [8].
4\. The message is routed towards the proper 3GPP AAA Server based on the
realm part of the NAI as specified in TS 23.003 [8]. The routing path may
include one or several AAA proxies. The access type and the identity of the
access network in which the authenticator resides, shall be included by the
authenticator in the Diameter message. In the case of roaming, the visited
network AAA proxy shall also include the visited network identifier in the
same Diameter message.\ The access network identity is defined separately for
each access network type. For each access network type, the access network
identity shall be documented in TS 24.302 [22] to ensure that UE and HSS use
the same access network identities as input for key derivation.
NOTE 2: Diameter referral can also be applied to find the AAA server.
NOTE 3: The visited network identifier identifies a visited 3GPP network, and
is to be distinguished from the access network identifier, which relates to a
non-3GPP access network.
5\. The 3GPP AAA Server receives the EAP Response/Identity message that
contains the subscriber identity and the access type over the STa/SWd
interface. In the case of roaming, the 3GPP AAA server also receives the
visited network identifier in the same Diameter message that carried the EAP
Response/Identity message.
6\. The 3GPP AAA Server requests again the user identity, using the EAP
Request/AKA\' Identity message. This identity request is performed as the
intermediate nodes may have changed or replaced the user identity received in
the EAP Response Identity message, as specified in RFC 5448 [23]. However, in
order to avoid this new request of the user identity, the home operator should
ensure that the Authenticator and all AAA entities between the EAP peer and
EAP server process the EAP-Response/Identity message inline with EAP-AKA\' as
specified in the present document and TS 23.003. Consequently, if the EAP
server knows that the EAP-Response/Identity message was processed accordingly,
the EAP server shall use the user identity which was received in the EAP-
Response/Identity message in step 5 and skip this EAP Request/AKA\' Identity
request in steps 6 through 9.
7\. The authenticator in the access network forwards the EAP Request/AKA\'
Identity message to the UE.
8\. The UE responds with an identity that depends on the parameters contained
in the EAP Request/AKA\' Identity message; for details cf. TS 24.302 [22].
9\. The authenticator in the access network forwards the EAP Response/AKA\'
Identity to the 3GPP AAA Server. The access type and the identity of the
access network in which the authenticator resides, shall be included by the
authenticator in this message. In the case of roaming, the visited network AAA
proxy shall also include the visited network identifier in the same
message.The identity received in this message will be used by the 3GPP AAA
Server in the rest of the authentication process.
10\. The 3GPP AAA Server shall identify the subscriber as a candidate for
authentication with EAP-AKA', based on the received identity in the EAP-
Response/Identity or EAP Response/AKA\' Identity message, If the leading
digits in the NAI do not indicate that the UE supports EAP-AKA', the 3GPP AAA
server shall abort the authentication. If the UE does indicate that it
supports EAP-AKA', the 3GPP AAA server then checks whether it has an unused
authentication vector with AMF separation bit = 1 and the matching access
network identifier available for that subscriber. If not, a set of new
authentication vectors is retrieved from HSS. The 3GPP AAA server includes an
indication that the authentication vector is for EAP-AKA\', as defined RFC
5448 [23], and the identity of the access network in which the authenticator
resides in a message sent to the HSS. A mapping from the temporary identifier
(pseudonym in the sense of RFC 4187 EAP-AKA [7]) to the IMSI is required.
NOTE 7a: As the UE moves around the access network identifier may change. But
an authentication vector stored in the 3GPP AAA server can only be used if it
is associated with the access network identifier of the current access
network. This may make stored authentication vectors unusable. Furthermore, as
the 3GPP AAA server resides in the home network there is no significant
performance advantage in fetching batches of authentication vectors. It is
therefore recommended that the 3GPP AAA server fetches only one authentication
vector at a time.
> Upon receiving from the 3GPP AAA server an indication that the
> authentication vector is for EAP-AKA\' as defined in RFC 5448 [23], the HSS
> generates an authentication vector with AMF separation bit = 1\. The HSS
> then transforms this authentication vector into a new authentication vector
> by computing\ CK\' and IK\' per Clauses A.1 and A.2 of the Normative Annex A
> with \ being one of the input parameters. The HSS
> then sends this transformed authentication vector to the 3GPP AAA server.
NOTE 7b: The 3GPP AAA server does not notice the transformation and treats
this authentication vector like any other authentication vector.
The HSS and/or 3GPP AAA server need to ensure, based on local policy, that the
non-3GPP access requesting the authentication data, which is identified by the
information transmitted by the authenticator in step 4, is authorized to use
the access network identity used to calculate CK\' and IK\'. The 3GPP AAA
server shall have assurance of the origin of this information. The exact
details of how to achieve this are not covered in this specification.
The HSS shall check if there is a 3GPP AAA Server already registered to serve
for this subscriber. In case the HSS detects that another 3GPP AAA Server has
already registered for this subscriber, it shall provide the current 3GPP AAA
Server with the previously registered 3GPP AAA Server address. The
authentication signalling is then routed to the previously registered 3GPP AAA
Server with Diameter-specific mechanisms, e.g., the current 3GPP AAA Server
transfers the previously registered 3GPP AAA Server address to the 3GPP AAA
proxy or the AAA entity in the trusted non-3GPP access network, or the current
3GPP AAA Server acts as a AAA proxy and forwards the authentication message to
the previously registered 3GPP AAA Server.
11\. 3GPP AAA Server checks that it has the EPS access profile of the
subscriber available. If not, the profile is retrieved from HSS. 3GPP AAA
Server verifies that the subscriber is authorized to use the EPS.
NOTE 8: This step could be performed at some other point, after step 5 and
before step 13.
12\. New keying materials MSK and EMSK are derived from CK\' and IK\'
according to RFC 5448 [23].
NOTE 9: The use of EMSK can refer to subclause 9.2.1 MIPv4.
A new pseudonym and/or re-authentication ID may be chosen and if chosen they
shall be protected (i.e. encrypted and integrity protected) using keying
material generated from EAP-AKA'.
13\. The 3GPP AAA Server sends RAND, AUTN, a message authentication code (MAC)
and two user identities (if they are generated), protected pseudonym and/or
protected re-authentication id, to the authenticator in the access network in
EAP Request/AKA\'-Challenge message. The 3GPP AAA Server shall also include
the access network identity in this message. The access network identity is
defined in TS 24.302 [22]. The sending of the re-authentication id depends on
3GPP operator\'s policies on whether to allow fast re-authentication processes
or not. It implies that, at any time, the 3GPP AAA Server decides (based on
policies set by the operator) to include the re-authentication id or not, thus
allowing or disallowing the triggering of the fast re-authentication process.
The 3GPP AAA Server may send as well a result indication to the authenticator
in the access network, in order to indicate that it wishes to protect the
success result message at the end of the process (if the outcome is
successful). The protection of result messages depends on home operator\'s
policies.
14\. The authenticator in the access network sends the EAP
Request/AKA'-Challenge message to the UE.
15\. The UE first checks whether the AMF separation bit is set to 1. If this
is not the case the UE shall reject the authentication. Otherwise, the UE runs
AKA algorithms. The UE verifies that AUTN is correct and hereby authenticates
the network. If AUTN is incorrect, the UE rejects the authentication (not
shown in this example). If the sequence number is out of synch, the UE
initiates a synchronization procedure, c.f. RFC 5448 [23]. If AUTN is correct,
the UE computes RES, IK and CK.
The UE then computes CK\' and IK\' in the same way as the HSS, per Clauses A.1
and A.2 of the Normative Annex A with \ being one of
the input parameters. The UE derives required additional new keying material,
including the key MSK and EMSK, according to RFC 5448 [23] from the new
computed CK\', IK\' and checks the received MAC with the new derived keying
material.
If a protected pseudonym and/or re-authentication identity were received, then
the UE stores the temporary identity(s) for future authentications.
> The access network identity, which is input to key derivation to obtain CK',
> IK', shall be sent by the 3GPP AAA server in the EAP-request /
> AKA'-Challenge message as defined in RFC 5448 [23].
>
> RFC 5448 [23] specifies a possibility for the UE to compare the access
> network identity received from the 3GPP AAA server with the access network
> identity received locally, e.g. from the link layer. It is defined in 3GPP
> TS 24.302 [22] for which access networks the comparison is done, how the UE
> shall determine the locally received network name and what the UE shall do
> if the check fails. If the comparison is done for a specific access network,
> it shall be done according to the rules specified in RFC 5448 [23]. The UE -
> or the human user - may use the network name as a basis for an authorization
> decision. E.g. the UE may compare the network name against a list of
> preferred or barred network names.
16\. The UE calculates a new MAC value covering the EAP message with the new
keying material. UE sends EAP Response/AKA\'-Challenge containing calculated
RES and the new calculated MAC value to the authenticator in the access
network.
The UE shall include in this message the result indication if it supports such
indications and if it received the same indication from the 3GPP AAA Server.
Otherwise, the UE shall omit this indication.
17\. The authenticator in the access network sends the EAP
Response/AKA\'-Challenge packet to 3GPP AAA Server.
18\. The 3GPP AAA Server checks the received MAC and compares XRES to the
received RES.
19\. If all checks in step 18 are successful, the 3GPP AAA Server shall send
the message EAP Request/AKA\'-Notification, previous to the EAP Success
message, if the 3GPP AAA Server and the UE have indicated the use of protected
successful result indications as in RFC 5448 [23]. This message is MAC
protected.
NOTE 11: Steps 19 to 22 are conditional based on the EAP Server and the UE
having indicated the use of protected successful result indications.
20\. The authenticator in the access network forwards the message to the UE.
21\. The UE sends the EAP Response/AKA\'-Notification.
22\. The authenticator in the access network forwards the EAP
Response/AKA\'-Notification message to the 3GPP AAA Server. The 3GPP AAA
Server shall ignore the contents of this message
23\. The 3GPP AAA Server sends the EAP Success message to the authenticator in
the access network (perhaps preceded by an EAP Notification, as explained in
step 19). The 3GPP AAA Server also includes the key MSK, RFC 5448 [23], in the
underlying AAA protocol message (i.e. not at the EAP level). The authenticator
in the access network stores the keying material to be used in communication
with the authenticated UE as required by the access network.
24\. The authenticator in the access network informs the UE about the
successful authentication with the EAP Success message. Now the EAP AKA\'
exchange has been successfully completed, and the UE and the authenticator in
the access network share keying material derived during that exchange.
25\. The 3GPP AAA Server shall initiate the registration to the HSS. The 3GPP
AAA Server shall keep access session information related to the subscriber
including the access network identity. The 3GPP AAA Server shall implement a
policy to limit the number of active access sessions.
NOTE 12: It may happen in handover situations that, due to pre-registration, a
subscriber is authenticated in a target access network while still being
attached to the source access network.
NOTE 13: More detailed provisions may be required for particular access
networks, similar to those in bullet 25 in TS 33.234 [9], subclause 6.1.1.1
for WLAN access networks.
The authentication process may fail at any moment, for example because of
unsuccessful checking of MACs or no response from the UE after a network
request. In that case, the EAP AKA\' process will be terminated as specified
in RFC 5448 [23] and an indication shall be sent to HSS.
## 6.3 Fast re-authentication procedure for trusted access
Fast re-authentication for EAP-AKA\' is specified in RFC 5448 [23]. Fast re-
authentication re-uses keys derived on the previous full authentication. Fast
re-authentication does not involve the HSS nor the credentials used with EAP-
AKA' (e.g USIM application in case of terminal with 3GPP access capabilities),
and does not involve the handling of AKA authentication vectors, which makes
the procedure faster and reduces the load on the HSS and, in particular, the
Authentication Centre.
UE and 3GPP AAA server shall implement fast re-authentication for EAP-AKA\'.
Its use is optional and depends on operator policy. If fast re-authentication
for EAP-AKA\' is used the 3GPP AAA server shall indicate this to the UE by
means of sending the re-authentication identity to the UE as in step 13 of
subclause 6.2.
The security level of fast re-authentication for EAP-AKA\' is lower as it does
not prove the presence of the credentials used with EAP-AKA' (e.g. presence of
USIM application in case of terminal with 3GPP access capabilities) on the
user side. The operator should take this into account when defining the policy
on fast re-authentication.
Fast re-authentications for EAP-AKA\' generates new keys MSK, which may be
used for renewing session key used for protection in the non-3GPP access
network.
The access network identity shall not change when going from the full to the
fast re-authentication process. If this happens, the re-authentication process
shall be terminated as defined in RFC 5448 [23].
In this section it is described how the process works for trusted non-3GPP
access to EPS.
Figure 6.3-1: Non-3GPP Fast Re-authentication
  1. Non-3GPP Access Network sends an EAP Request/Identity to the UE.
  2. UE replies with an EAP Response/Identity containing a re-authentication identity (this identity was previously delivered by AAA server in a full authentication procedure).
  3. The Non-3GPP Access Network forwards the EAP Response/Identity to the AAA server. Intermediate Proxy AAA\'s may perform routing and forwarding functions.
  4. The AAA server initiates the Counter (which was initialized to one in the full authentication process) and sends it in the EAP Request message, together with the NONCE, the MAC (calculated over the NONCE) and a protected re-authentication ID for a next fast re-authentication. If the AAA server is not able to deliver a re-authentication identity, next time the UE shall force a full-authentication (to avoid the use of the re-authentication identity more than once).
> The 3GPP AAA Server may send a result indication to the UE, in order to
> indicate that the success result message at the end of the process shall be
> protected (if the outcome is successful). The protection of result messages
> depends on home operator\'s policies.
>
> The 3GPP AAA server may fail to recognize the identity as it may have been
> altered by proxies. In this case, the 3GPP AAA server may, as in the case of
> a full authentication, instead perform an EAP AKA\' method specific identity
> request; i.e. \"EAP-Request/AKA\' identity [Any identity]\" in order to
> obtain a more reliable identity, in analogy of step 7 of the full EAP AKA\'
> authentication. This should however only be used in case the server fails to
> recognize the identity, as otherwise the purpose of fast re-authentication
> is defeated.
  1. The Non-3GPP Access Network forwards the EAP Request message to the UE.
  2. The UE verifies that the Counter value is fresh and the MAC is correct, and it sends the EAP Response message with the same Counter value (it is up to the AAA server to step it up) and a calculated MAC.
> The UE shall include in this message the result indication if it received
> the same indication from the 3GPP AAA. Otherwise, the UE shall omit this
> indication.
  1. The Non-3GPP Access Network forwards the response toward the AAA server.
  2. The AAA server verifies that the Counter value is the same as it sent, and the MAC is correct, and sends the message EAP Request/AKA\'-Notification, previous to the EAP Success message, if the 3GPP AAA Server requested previously to use protected success result indications. The message EAP Request/AKA\'-Notification is MAC protected, and includes an encrypted copy the Counter used in the present re-authentication process.
  3. The Non-3GPP Access Network forwards the EAP Request/AKA\'-Notification message to the UE.
  4. The UE sends the EAP Response/AKA\'-Notification.
  5. The Non-3GPP Access Network forwards the EAP Response/AKA\'-Notification message toward the 3GPP AAA server. The 3GPP AAA Server shall ignore the contents of this message.
  6. The AAA server sends an EAP Success message. If some extra keying material was generated for Access Network specific confidentiality and/or integrity protection, then the 3GPP AAA Server includes this derived keying material in the underlying AAA protocol message. (i.e., not at EAP level). The Non-3GPP Access Network stores the keying material which may be used in communication with the authenticated UE.
  7. The EAP Success message is forwarded to the UE.
The re-authentication process may fail at any moment, for example because of
unsuccessful checking of MACs or no response from the UE after a network
request. In that case, the EAP AKA\' process will be terminated as specified
in RFC 5448 [23] and an indication shall be sent to HSS/HLR.
## 6.4 Authentication and key agreement for untrusted access
For untrusted access, UE and the ePDG shall perform mutual authentication
during the IPsec tunnel establishment between the UE and the ePDG (SWu
reference point). This procedure is specified in clause 8 of the present
document.
In addition, before the IPsec tunnel establishment between the UE and the ePDG
can be performed, the UE needs to obtain IP connectivity across the access
network, which may require an access authentication, which is independent of
the EAP-AKA authentication run in conjunction with the IPsec tunnel
establishment. This additional access authentication and key agreement is not
required for the security of the Evolved Packet Core. However, it may be
required for the security of the untrusted non-3GPP access network. Any
authentication and key agreement procedure deemed appropriate by the access
network provider, including EAP-AKA', may be used.
## 6.5 Authentication and authorization with S2b for Private network access
from Untrusted non-3GPP Access networks
### 6.5.1 General
Two procedures for the authentication and authorization for the Private
network access are possible with S2b. The first procedure described in clause
6.5.2 is applicable in the scenario where the External AAA Server supports the
PAP procedure. The second procedure described in clause 6.5.3 is applicable in
the scenario where the External AAA Server supports the CHAP procedure.
NOTE 1: TS 33.234 [9] also covers the case of the External AAA Server
supporting the EAP procedure, but EAP is only supported for I-WLAN, not for
S2b (nor for S2a or 3GPP accesses).
NOTE 2: External network operators wanting to use PAP for authentication are
warned that PAP is an obsolete protocol from a security point of view. CHAP
provides stronger security than PAP.
### 6.5.2 Authentication and authorization for the Private network access (the
External AAA Server performs PAP procedure)
The signalling sequence when the External AAA server performs the PAP
procedures in a network based mobility system to authenticate and authorize
the UE\'s access to a Private network over an Untrusted non-3GPP Acess network
using S2b is illustrated in Figure 6.5.3-1. In this procedure, the External
AAA Server supports the PAP procedure.
Figure 6.5.2-1: Authentication and authorization for the Private network
access over S2b\ (The External AAA Server performs PAP procedure)
NOTE: The parameters indicated with bold character denote support for \"the
multiple authentication and authorization\", as specified in RFC 4739 [30].
1\. The UE and the ePDG exchange the first pair of IKE_SA_INIT messages, in
which the ePDG and the UE negotiate cryptographic algorithms, exchange nonces
and perform a Diffie-Hellman exchange. If the ePDG supports multiple
authentication procedures, it indicates MULTIPLE_AUTH_SUPPORTED in step 1b.
> 2\. The UE sends the user identity (in the IDi payload) and the APN
> information (in the IDr payload) to the ePDG and begins negotiation of child
> security associations. The UE omits the AUTH parameter in order to indicate
> to the ePDG that it wants to use EAP over IKEv2. The user identity shall be
> compliant with the Network Access Identifier (NAI) format specified in 3GPP
> TS 23.003[8], containing the IMSI or the pseudonym as defined for EAP-AKA in
> RFC 4187 [7]).\ If the UE's Remote IP address needs to be configured
> dynamically, then the UE shall send the configuration payload (CFG_REQUEST)
> within the IKE_AUTH request message to obtain a Remote IP Address. If the
> APN requires authentication and authorization with the External AAA Server
> and the ePDG indicated that multiple authentication procedures are supported
> in step 1b, then MULTIPLE_AUTH_SUPPORTED is included.
>
> 3.-11. The steps 3 to 11 clause 8.2.2 apply here.
>
> 12\. The UE shall take its own copy of the MSK as input to generate the AUTH
> parameter to authenticate the first IKE_SA_INIT message. The AUTH parameter
> is sent to the ePDG. The UE includes a Notify payload ANOTHER_AUTH_FOLLOWS
> indicating to the ePDG that another authentication and authorization round
> will follow.
13\. The ePDG checks the correctness of the AUTH received from the UE and
calculates the AUTH parameter which authenticates the second IKE_SA_INIT
message. The AUTH parameter is sent to the UE.
NOTE: At this point the UE is authenticated from EPC point of view. PMIP/GTP
signalling between ePDG and PDN GW could start anytime after this step but
since an additional authentication with the external network was indicated in
step 12, the ePDG needs to collect additional authentication parameters from
the UE before initiating the PMIP binding update / GTP session creation
procedure in Step 15.
14\. The UE sends the identity in the private network in IDi payload that is
used for the next authentication and authorization with the External AAA
Server and without an AUTH payload.
15\. If the External AAA Server supports the PAP procedure, the ePDG sends an
EAP-GTC request to the UE for the next authentication.
16\. The UE returns an EAP-GTC response containing the user's password to the
ePDG.
17\. The ePDG includes the user-name and user-password as Additional
Parameters in the PBU it sends to PGW as defined in 3GPP TS 29.275 [32]. The
corresponding message in GTP for S2b is Create Session Request as defined in
3GPP TS 29.274 [31].
18\. The PGW sends a AAA Access request message with user-name and user-
password attributes which are copied from the PBU Additional Parameters to the
external AAA server.
19\. The external AAA server returns the Access accept to the PGW.
20\. The PGW sends PBA (PMIP) /Create Session Response (GTP) to the ePDG with
the Additional Parameters indicating authentication success.
21\. The EAP-success message is sent to the UE over IKEv2.
22.-23. The PGW sends the Accounting request (Start) message to the External
AAA Server and the External AAA Server returns the Accounting response (Start)
message to the PGW if needed.
24\. The UE shall generate the AUTH parameter calculated by the SK_pi as a
shared secret as specified in RFC 5996 [30] in order to authenticate the first
IKE_SA_INIT message. The AUTH parameter is sent to the ePDG.
25\. The ePDG checks the correctness of the AUTH received from the WLAN UE and
calculates the AUTH parameter which authenticates the second IKE_SA_INIT
message. The ePDG shall send the assigned Remote IP address in the
configuration payload (CFG_REPLY), if the WLAN UE requested a Remote IP
address through the CFG_REQUEST. Then the AUTH parameter calculated by the
SK_pr as a shared secret (see RFC 5996 [30]) is sent to the WLAN UE together
with the configuration payload, security associations and the rest of the
IKEv2 parameters and the IKEv2 negotiation terminates.
#### 6.5.3 Authentication and authorization for the Private network access
(the External AAA Server performs CHAP procedure)
The signalling sequence when the External AAA server performs the CHAP
procedures in a network based mobility system to authenticate and authorize
the UE\'s access to a Private network over an Untrusted non-3GPP Acess network
is illustrated in Figure 6.5.3-1. In this procedure, the External AAA Server
supports the CHAP procedure.
Figure 6.5.3-1: Authentication and authorization for the Private network
access over S2b\ (The External AAA Server performs CHAP procedure)
NOTE 1: The parameters indicated with bold character denote support for \"the
multiple authentication and authorization\", as specified in RFC 4739 [33].
Only the PMIP case is shown in this figure for the sake of clarity, but the
text below also covers the GTP case.
> 1\. The UE and the ePDG exchange the first pair of IKE_SA_INIT messages, in
> which the ePDG and the UE negotiate cryptographic algorithms, exchange
> nonces and perform a Diffie-Hellman exchange. If the ePDG supports multiple
> authentication procedures, it indicates MULTIPLE_AUTH_SUPPORTED in step 1b.
>
> 2\. The UE sends the user identity (in the IDi payload) and the APN
> information (in the IDr payload) to the ePDG and begins negotiation of child
> security associations. The UE omits the AUTH parameter in order to indicate
> to the ePDG that it wants to use EAP over IKEv2. The user identity shall be
> compliant with the Network Access Identifier (NAI) format specified in 3GPP
> TS 23.003 [8], containing the IMSI or the pseudonym as defined for EAP-AKA
> in RFC 4187 [7]).\ If the UE's Remote IP address needs to be configured
> dynamically, then the UE shall send the configuration payload (CFG_REQUEST)
> within the IKE_AUTH request message to obtain a Remote IP Address. If the
> APN requires authentication and authorization with the External AAA Server
> and the ePDG indicated that multiple authentication procedures are supported
> in step 1b, then MULTIPLE_AUTH_SUPPORTED is included.
>
> 3.-11. The steps 3 to 11 in clause 8.2.2 apply here.
>
> 12\. The UE shall take its own copy of the MSK as input to generate the AUTH
> parameter to authenticate the first IKE_SA_INIT message. The AUTH parameter
> is sent to the ePDG. The UE includes a Notify payload ANOTHER_AUTH_FOLLOWS
> indicating to the ePDG that another authentication and authorization round
> will follow.
13\. The ePDG checks the correctness of the AUTH received from the UE and
calculates the AUTH parameter which authenticates the second IKE_SA_INIT
message. The AUTH parameter is sent to the UE.
NOTE 2: At this point the UE is authenticated from EPC point of view. PMIP/GTP
signalling between ePDG and PDN GW could start anytime after this step but
since an additional authentication with the external network was indicated in
step 12, the ePDG needs to collect additional authentication parameters from
the UE before initiating the PMIP binding update / GTP session creation
procedure in Step 15.
14\. The UE sends the identity in the private network in IDi payload that is
used for the next authentication and authorization with the External AAA
Server and without an AUTH payload.
15\. If the External AAA Server supports the CHAP procedure, the PDG sends an
EAP MD5-challenge request to the UE for the next authentication.
16\. The UE returns an EAP MD5-Challenge response to the ePDG.
17\. The ePDG includes the user-name, CHAP-password and CHAP-Challenge as
Additional Parameters in the PBU it sends to PGW as defined in 3GPP TS 29.275
[32]. The corresponding message in GTP for S2b is Create Session Request as
defined in 3GPP TS 29.274 [31].
18\. The PGW sends a AAA Access request message with user-name, CHAP-password
and CHAP-Challenge attributes, which are copied from the Additional Parameters
in the PBU, to the External AAA server.
19\. The External AAA server returns the Access accept to the PGW.
20\. The PGW sends PBA (PMIP) /Create Session Response (GTP) to the ePDG with
the Additional Paramters indicating authentication success.
21\. The EAP success message is sent to the UE over IKEv2.
22.-23. The PGW sends the Accounting request (Start) message to the External
AAA Server and the External AAA Server returns the Accounting response (Start)
message to the PGW if needed.
24\. The UE shall generate the AUTH parameter calculated by the SK_pi as a
shared secret as specified in RFC 5996 [30] in order to authenticate the first
IKE_SA_INIT message. The AUTH parameter is sent to the ePDG.
25\. The ePDG checks the correctness of the AUTH received from the UE and
calculates the AUTH parameter which authenticates the second IKE_SA_INIT
message. The ePDG shall send the assigned Remote IP address in the
configuration payload (CFG_REPLY), if the UE requested a Remote IP address
through the CFG_REQUEST. Then the AUTH parameter calculated by the SK_pr as a
shared secret (see RFC 5996 [30]) is sent to the UE together with the
configuration payload, security associations and the rest of the IKEv2
parameters and the IKEv2 negotiation terminates.
# 7 Establishment of security contexts in the target access system
## 7.1 General assumptions
The following sub-clauses describe all the specifics that are related to the
establishment of the security context of the non-3GPP target access for the
purpose of Interworking with EPS system. The target access system may have
other specifics that are used for the establishment of the security context
while interworking with EPS system is not considered. These specifics are
outside the scope of the present document.
## 7.2 Establishment of security context for Trusted non-3GPP Access
In this case, the credentials the UE shares with the 3GPP AAA server are used
to establish security contexts in the access system.
It is assumed that the EPS user always uses EAP-AKA' credentials (e.g. a USIM
application in case of terminal with 3GPP access capabilities) to perform
mutual authentication and establish security contexts with the Home Network.
### 7.2.1 CDMA-2000 HRPD EPS Interworking
NOTE: General Concepts for Interworking between E-UTRAN and CDMA2000 are
described in TS 23.402 [5] subclause 4.1.1.
#### 7.2.1.1 EPS-HRPD Architecture
Figure 7.2.1.1-1 depicts the basic non-roaming architecture for HRPD-LTE
Interworking.
Figure 7.2.1.1-1: Basic non-roaming architecture for HRPD-LTE Interworking.
Interworking\ reference points are highlighted.
#### 7.2.1.2 Network Elements
##### 7.2.1.2.1 E-UTRAN
E-UTRAN is described in detail in TS 36.300 [15] with additional functions
listed in TS 23.401 [13].
##### 7.2.1.2.2 MME
The details of the MME functionality are described in the TS 23.401 [13],
while additional MME functionality, related to the interoperability with
non-3GPP systems is described in the TS 23.402 [5].
The following are additional MME functions:
In the EPS, the security functions of the MME are described in TS 33.401 [16].
During the pre-registration towards the EPS from HRPD (as part of HRPD to
EUTRAN HO), the procedures and functions are as defined in TS 33.401 [16],
with the exception the NAS procedures will occur over S101. This is described
in greater detail in clause 10.
##### 7.2.1.2.3 Gateway
###### 7.2.1.2.3.1 General
The functional split of PDN GW and Serving GW is described in TS 23.401 [13].
###### 7.2.1.2.3.2 Serving GW
The details of the Serving GW functionality are described in the TS 23.401
[13], while additional Serving GW functionality, related to the
interoperability with non-3GPP systems is described in the TS 23.402 [5].
###### 7.2.1.2.3.3 PDN GW
The details of the PDN GW functionality are described in the TS 23.401 [13],
while additional PDN GW functionality, related to the interoperability with
non-3GPP systems is described in the TS 23.402 [5].
##### 7.2.1.2.4 PCRF
The details of the PCRF functionality are described in the TS 23.401 [13] and
TS 23.203 [14], while additional PCRF functionality, related to the roaming
scenario is described in the TS 23.402 [5].
#### 7.2.1.3 Reference Points
##### 7.2.1.3.1 List of Reference Points
NOTE: S1-MME, S1-U, S2a, S2b, S2c, ,S3, S4, S5-MIP, S6a, Gx, S8, S9, S10, S11,
S101, S103 are defined in TS 23.401 [13].
Additional reference points descriptions, related to the interoperability with
non-3GPP systems are presented in the TS 23.402 [5].
##### 7.2.1.3.2 Protocol assumptions
The protocol assumptions are described in the TS 23.402 [5].
NOTE: S103 is expected to be based on GRE, and as such does not involve any
secure signalling to exchange GRE keys.
#### 7.2.1.4 Security of the initial access to EPS via HRPD
EAP-AKA\' access authentication shall be used according to section 6. As a
result of EAP-AKA\', the two keys, MSK and EMSK, are generated, cf. RFC 5448
[23].
In addition, according to subclause 6.2 of the present document, the 3GPP AAA
Server sends the key MSK to the authenticator in the access network. The 3GPP
AAA server shall retain the EMSK either until the subsequent EAP-AKA\'
authentication, or until it receives an indication that the current
authenticated session is finished.
The security contexts in the HRPD access network may be based on keys derived
from MSK. The HRPD access network is required to ensure that the identity of a
user with whom a security context is established is securely tied to the
identity of a user authenticated by EAP-AKA\'.
The further details of the establishment of security contexts in the HRPD
access network are outside the scope of the present document.
NOTE: Initial access to the EPS via HRPD is described in the TS 23.402 [5].
#### 7.2.1.5 Security of handoff and pre-registration
NOTE: Security of handoff and pre-registration is described in the Section 10
of the present document.
### 7.2.2 WIMAX EPS Interworking
General Concepts for interworking between EPS and WIMAX are described in TS
23.402 [5].Computation of mobility keys used for MIPv4 interworking with WiMAX
access system is specified in clause 9.2.1
### 7.2.3 Trusted WLAN Access (TWAN)
A Trusted WLAN Access Network (TWAN) is interfaced with the EPC as a trusted
non-3GPP access via the STa interface to the 3GPP AAA Server/Proxy and the S2a
interface to the PDN GW as described in clause 16 of TS 23.402 [5].
Authentication and key agreement shall be performed as described in clause 6
of the present document for trusted non-3GPP access. The authenticator shall
reside in the TWAN.
According to subclause 6.2 of the present document, the 3GPP AAA Server sends
the key MSK to the authenticator in the TWAN. The security contexts in the
TWAN are based on MSK.
## 7.3 Establishment of security context between UE and untrusted non-3GPP
Access
If authentication and key agreement procedure as described optional in
subclause 6.4 is performed then also security contexts may be established
between UE and non-3GPP access network. However, such additional establishment
of security contexts is not required for the security of the Evolved Packet
Core in the case of untrusted access.
# 8 Establishment of security between UE and ePDG
## 8.1 General
This section details the security mechanisms for procedures for untrusted
Non-3GPP IP Accesses specified in TS 23.402 [5].
## 8.2 Mechanisms for the set up of UE-initiated IPsec tunnels
### 8.2.1 General
\- The UE and the ePDG shall use IKEv2, as specified in RFC 5996 [30],in order
to establish IPSec security associations.
\- Public key signature based authentication with certificates, as specified
in RFC 5996 [30], shall be used to authenticate the ePDG. The ePDG shall
authenticate itself to the UE with an identity. This identity shall be the
same as the FQDN of the ePDG determined by the ePDG selection procedures
defined in TS 23.402 [5]. This identity shall be contained in the IKEv2
ID_FQDN payload and shall match a dNSName SubjectAltName component in the
ePDG\'s certificate.
\- EAP-AKA, as specified in RFC 4187 [7], within IKEv2, as specified in RFC
5996 [30], shall be used to authenticate UEs.
\- For profile for IKEv2, IPsec ESP and certificate contents and processing
refer to subclause 8.2.4.
\- For the security aspects of emergency calls, cf. clause 13 of this
specification.
### 8.2.2 Tunnel full authentication and authorization
The tunnel end point in the network is the ePDG. As part of the tunnel
establishment attempt the use of a certain APN is requested. When a new
attempt for tunnel establishment is performed by the UE the UE shall use IKEv2
as specified in RFC 5996 [30]. The authentication of the UE in its role as
IKEv2 initiator terminates in the 3GPP AAA Server. The UE shall send EAP
messages over IKEv2 to the ePDG. The ePDG shall extract the EAP messages
received from the UE over IKEv2, and send them to the 3GPP AAA Server. The UE
shall use the Configuration Payload of IKEv2 to obtain the Remote IP address.
The EAP-AKA message parameters and procedures regarding authentication are
omitted. Only decisions and processes relevant to the use of EAP-AKA within
IKEv2 are explained.
The message flow for the full authentication is depicted in the Figure
8.2.2-1.
Figure 8.2.2-1: Tunnel full authentication and authorization
As the UE and ePDG generate nonces as input to derive the encryption and
authentication keys in IKEv2, replay protection is provided. For this reason,
there is no need for the 3GPP AAA Server to request the user identity again
using the EAP-AKA specific methods (as specified in RFC 4187 [7]), because the
3GPP AAA Server is certain that no intermediate node has modified or changed
the user identity.
1\. The UE and the ePDG exchange the first pair of messages, known as
IKE_SA_INIT, in which the ePDG and UE negotiate cryptographic algorithms,
exchange nonces and perform a Diffie_Hellman exchange.
> 2\. The UE sends the user identity (in the IDi payload) and the APN
> information (in the IDr payload) in this first message of the IKE_AUTH
> phase, and begins negotiation of child security associations. The UE omits
> the AUTH parameter in order to indicate to the ePDG that it wants to use EAP
> over IKEv2. The user identity shall be compliant with Network Access
> Identifier (NAI) format specified in TS 23.003 [8], containing the IMSI or
> the pseudonym, as defined for EAP-AKA in RFC 4187 [7]). The UE shall send
> the configuration payload (CFG_REQUEST) within the IKE_AUTH request message
> to obtain an IPv4 and/or IPV6 home IP Address and/or a Home Agent Address.
3\. The ePDG sends the Authentication and Authorization Request message to the
3GPP AAA Server, containing the user identity and APN. The UE shall use the
NAI as defined in accordance with clause 19.3 of 3GPP TS 23.003 [8], the 3GPP
AAA server shall identify based on the realm part of the NAI that combined
authentication and authorization is being performed for tunnel establishment
with an ePDG which allows only EAP-AKA (and not an I-WLAN PDG as defined in TS
33.234 [9], which would allow also EAP-SIM). The different Diameter
application IDs will help the 3GPP AAA Server distinguish among
authentications for trusted access, as specified in clause 6 of the present
document (which requires EAP-AKA\' authentication), and authentications for
tunnel setup in EPS (which allows only EAP-AKA).
4\. The 3GPP AAA Server shall fetch the user profile and authentication
vectors from HSS/HLR (if these parameters are not available in the 3GPP AAA
Server). The 3GPP AAA Server shall lookup the IMSI of the authenticated user
based on the received user identity (root NAI or pseudonym) and include the
EAP-AKA as requested authentication method in the request sent to the HSS. The
HSS shall then generate authentication vectors with AMF separation bit = 0 and
send them back to the 3GPP AAA server.\ The 3GPP AAA Server checks in user\'s
subscription if he/she is authorized for non-3GPP access.
5\. The 3GPP AAA Server initiates the authentication challenge. The user
identity is not requested again.
6\. The ePDG responds with its identity, a certificate, and sends the AUTH
parameter to protect the previous message it sent to the UE (in the
IKE_SA_INIT exchange). The EAP message received from the 3GPP AAA Server (EAP-
Request/AKA-Challenge) is included in order to start the EAP procedure over
IKEv2.
7\. The UE checks the authentication parameters and responds to the
authentication challenge. The only payload (apart from the header) in the
IKEv2 message is the EAP message.
8\. The ePDG forwards the EAP-Response/AKA-Challenge message to the 3GPP AAA
Server.
8.a The AAA checks, if the authentication response is correct.
8.b-e If dynamic IP mobility selection is executed embedded to the
authentication and authorization, the selected mobility mode is sent to the
user in an AKA-Notification request, over Diameter A&A answer and IKE_AUTH
message. The UE responds to this over IKEv2 and the ePDG forwards the response
to the 3GPP AAA Server.
9\. When all checks are successful, the 3GPP AAA Server sends the final
Authentication and Authorization Answer (with a result code indicating
success) including the relevant service authorization information, an EAP
success and the key material to the ePDG. This key material shall consist of
the MSK generated during the authentication process. When the SWm and SWd
interfaces between ePDG and 3GPP AAA Server are implemented using Diameter,
the MSK shall be encapsulated in the EAP-Master-Session-Key-AVP, as defined in
RFC 4072 [10].
10\. The MSK shall be used by the ePDG to generate the AUTH parameters in
order to authenticate the IKE_SA_INIT phase messages, as specified for IKEv2
in RFC 5996 [30]. These two first messages had not been authenticated before
as there was no key material available yet. According to RFC 5996 [30], the
shared secret generated in an EAP exchange (the MSK), when used over IKEv2,
shall be used to generated the AUTH parameters.
11\. The EAP Success/Failure message is forwarded to the UE over IKEv2.
12\. The UE shall take its own copy of the MSK as input to generate the AUTH
parameter to authenticate the first IKE_SA_INIT message. The AUTH parameter is
sent to the ePDG.
13\. The ePDG checks the correctness of the AUTH received from the UE. At this
point the UE is authenticated. In case S2b is used, PMIP signalling between
ePDG and PDN GW can now start, as specified in TS 23.402 [5]. The ePDG
continues with the next step in the procedure described here only after
successful completion of the PMIP binding update procedure.
14\. The ePDG calculates the AUTH parameter which authenticates the second
IKE_SA_INIT message. The ePDG shall send the assigned Remote IP address in the
configuration payload (CFG_REPLY).
15 The AUTH parameter is sent to the UE together with the configuration
payload, security associations and the rest of the IKEv2 parameters and the
IKEv2 negotiation terminates.
### 8.2.3 Tunnel fast re-authentication and authorization
Fast re-authentication for EAP-AKA is specified in RFC 4187 [7]. Fast re-
authentication re-uses keys derived on the previous full authentication. Fast
re-authentication does not involve the HSS nor the credentials used with EAP-
AKA (e.g. USIM application in case of terminal with 3GPP access capabilities),
and does not involve the handling of AKA authentication vectors, which makes
the procedure faster and reduces the load on the HSS and, in particular, the
Authentication Centre.
The UE and the 3GPP AAA server shall implement fast re-authentication for EAP-
AKA. Its use is optional and depends on operator policy.
The security level of fast re-authentication for EAP-AKA is lower as it does
not prove the presence of the credentials used with EAP-AKA (e.g.presence of
USIM application in case of terminal with 3GPP access capabilities) on the
user side. The operator should take this into account when defining the policy
on fast reâ€‘authentication.
Fast re-authentications for EAP-AKA generates new keys MSK, which may be used
for renewing session key used for protection in the non-3GPP access network.
The procedure is very similar to the tunnel full authentication and
authorization. The only difference is that EAP fast re-authentication is used
in this case.
Figure 8.2.3-1: Untrusted Tunnel - Fast Re-authentication
  1. The UE and the ePDG exchange the first pair of messages, known as IKE_SA_INIT, in which the ePDG and UE negotiate cryptographic algorithms, exchange nonces and perform a Diffie_Hellman exchange.
  2. The UE sends the fast re-authentication identity (in the IDi payload) and the APN information (in the IDr payload) in this first message of the IKE_AUTH phase, and begins negotiation of child security associations. The UE omits the AUTH parameter in order to indicate to the ePDG that it wants to use EAP over IKEv2. The fast re-authentication identity used by the UE shall be the one received in the previous authentication process. If the UE\'s Remote IP address needs to be configured dynamically, then the UE shall send the configuration payload (CFG_REQUEST) within the IKE_AUTH request message to obtain a Remote IP Address.
  3. The ePDG sends the Authentication and Authorization Request message with an EAP-Payload AVP toward the 3GPP AAA Server, containing the fast re-authentication identity. The UE shall use the fast-re-identity to create an NAI, as defined in clause 19.3 of 3GPP TS 23.003 [8]. The 3GPP AAA server shall identify based on the realm part of the NAIthat the combined authentication and authorization is being performed for tunnel establishment with an ePDG (and not an I-WLAN PDG as defined in TS 33.234 [9] , which would allow also EAP-SIM). The different Diameter application IDs will help the 3GPP AAA Server distinguish among authentications for trusted access, as specified in clause 6 of the present document(which requires EAP-AKA' authentication), and authentications for tunnel setup in EPS (which allows only EAP-AKA).
  4. The 3GPP AAA Server initiates the fast re-authentication challenge.
  5. The ePDG sends an IKE_AUTH Response message to the UE, containing its identity, a certificate, and the AUTH parameter to protect the previous message it sent to the UE (in the IKE_SA_INIT exchange). The EAP message (EAP-Request/AKA-Reauthentication) received from the 3GPP AAA Server is included in order to start the EAP procedure over IKEv2.
  6. The UE checks the authentication parameters and responds to the fast re-authentication challenge. The only payload (apart from the header) in the IKEv2 message is the EAP message.
  7. The ePDG forwards the EAP-Response/AKA-Reauthentication message toward the 3GPP AAA Server.
  8. When all checks are successful, if dynamic IP mobility mode selection is executed during the tunnel setup, the selected IP mobility mode is sent via Diameter and IKv2 signaling to the UE.
  9. When all checks are successful, the 3GPP AAA Server sends the Authentication Answer including the user\'s IMSI, the relevant service authorization information, an EAP success and the key material toward the ePDG. This key material shall consist of the MSK generated during the fast re-authentication process. When the SWm interface (ePDG-AAA) is implemented using Diameter, the MSK shall be encapsulated in the EAP-Master-Session-Key AVP, as defined in RFC 4072 [10].
  10. The MSK shall be used by the ePDG to generate the AUTH parameters in order to authenticate the IKE_SA_INIT phase messages, as specified in RFC 5996 [30]. These two first messages had not been authenticated before as there were no key material available yet. According to RFC 5996 [30], the shared secret generated in an EAP exchange (the MSK), when used over IKEv2, shall be used to generated the AUTH parameters.
  11. The EAP Success message is forwarded to the UE over IKEv2.
  12. The UE shall take its own copy of the MSK as input to generate the AUTH parameter to authenticate the first IKE_SA_INIT message. The AUTH parameter is sent to the ePDG.
  13. The ePDG checks the correctness of the AUTH received from the UE and calculates the AUTH parameter which authenticates the second IKE_SA_INIT message. The ePDG shall send the assigned Remote IP address in the configuration payload (CFG_REPLY), if the UE requested for a Remote IP address through the CFG_REQUEST. Then the AUTH parameter is sent to the UE together with the configuration payload, security associations and the rest of the IKEv2 parameters and the IKEv2 negotiation terminates.
### 8.2.4 Security profiles
The profiles for IKEv2 and IPsec ESP as defined in TS 33.234 [9] shall be
used.
For ePDG certificates, the certificate profiles as defined in TS 33.234 [9]
shall be used.
### 8.2.5 Handling of IPsec tunnels in mobility events
#### 8.2.5.1 General
The below sections describe the handling of IPsec tunnels in the idle and
active mode mobility events when the target access has a UE and an ePDG, e.g.
I-WLAN 3GPP IP Access System. In general, the IPsec tunnel handling during
mobility events is managed by the end nodes where the IPsec tunnel is
terminated, i.e. the UE and the ePDG.
In the case when the UE moves from the coverage area of the source ePDG and
connect to another ePDG or a different access, the management of the IPsec
tunnel between the UE and the source ePDG should be handled as follows:
  1. The UE may keep all related IPsec tunnel security association parameters until its lifetime expires.
  2. If after repeated attempts to contact the UE, the source ePDG concludes that the other endpoint (UE) has failed and all of its attempts have gone unanswered for a timeout period as specified in RFC 5996 [30], the source ePDG may delete all the UE IPsec tunnel SA parameters.
  3. If the source ePDG receieves an indication from a trusted network element that the UE has moved outside its coverage area, e.g. 3GPP AAA server, the source ePDG can delete all of the UE IPsec tunnel security association parameters.
#### 8.2.5.2 Idle mode mobility
When the UE moves from a source access where the UE is connected to an ePDG to
a target access that involves the UE and the same ePDG, the UE shall use
MOBIKE as per RFC 4555 [18] to update the ePDG with its new IP address.
However, when the UE moves where the target access involves the UE and a
different ePDG, the UE shall establish a new IPsec tunnel with the new ePDG as
described in subclause 8.2.2.
On the other hand, if the UE is connected to EPS without being connected to an
ePDG and then moves to a target access which involves the UE and an ePDG, the
UE SHALL establish a new IPsec tunnel with the new ePDG as described in
subclause 8.2.2.
#### 8.2.5.3 Active mode mobility
When the UE moves from a source access where the UE is connected to an ePDG to
a target access that involves the UE and the same ePDG, the UE shall use
MOBIKE as per RFC 4555 [18] to update the ePDG with its new IP address.
However, when the UE moves where the target access involves the UE and a
different ePDG, the UE shall establish a new IPsec tunnel with the new ePDG as
described in subclause 8.2.2.
On the other hand, if the UE is connected to EPS without being connected to an
ePDG and then moves to a target access which involves the UE and an ePDG, the
UE SHALL establish a new IPsec tunnel with the new ePDG as described in
subclause 8.2.2.
# 9 Security for IP based mobility signalling
## 9.1 General
Clause 9.2 covers security for host based mobility and section 9.3 covers
security for network based mobility.
## 9.2 Host based Mobility
### 9.2.1 MIPv4
#### 9.2.1.1 General
MIPv4 FACoA and DSMIPv6 host based mobility protocols are supported over S2a
and S2c interfaces respectively TS 23.402 [5].
The MIPv4 security is based on MIP Authentication extensions as defined in RFC
3344 [17]. The MIPv4 signalling messages shall be protected between the UE and
the node acting as HA (i.e PDN GW) using MIP authentication extensions and
optionally between the UE and the node acting as FA (non-3GPP access
specific).
#### 9.2.1.2 Bootstrapping of MIPv4 FACoA parameters
##### 9.2.1.2.1 Procedures
Figure 9.2.1.2.1-1: MIPv4 bootstrapping
The event that triggers Authentication and Authorization in step 1 between the
Trusted Non-3GPP IP Access and the EAP Server, depends on the specific access
technology cfr.TS 23.402 [5].
1) The Non-3GPP access specific authentication procedure based on EAP-AKA\' is
performed as specified in clause 6.2. Depending on the type of non-3GPP access
system, the PDN GW address (HA address) may be determined at this point. The
details of this procedure and IPMM protocol selection procedure are specified
in TS 23.402 [5]. If the network selects mobility management protocol as MIPv4
FACoA for the UE, then the UE and the EPC derive the keys required for MIPv4
bootstrapping.
> The key EMSK that result from the EAP-AKA\' authentication procedure is used
> to derive MIPv4 bootstrapping keys. Section 9.2.1.2.2 shows the derivation
> of MIPv4 bootstrapping keys in the UE and in the 3GPP AAA server and the key
> distribution from the 3GPP AAA server to the mobility agents. The trusted
> non-3GPP network receives a set of mobility keys and other keys in the
> Access-Accept message as a result of successful authentication.
2) The UE sends a Registration Request (RRQ) message to the FA as specified in
TS 23.402 [5]. The UE includes the MN-HA Authentication Extension (AE) and
optionally the MN-FA Authentication Extension (AE) as specified in RFC 3344
[17].
3) The FA processes the message according to RFC 3344 [17] and validates the
MN-FA Authentication extension if present. The FA then forwards the RRQ
message to the PDN GW. The RRQ message shall be protected between the FA and
the PDN GW according to TS 33.210 [6].
4) The selected PDN GW obtains Authentication and Authorization information
from the AAA/HSS.
5) The PDN GW validates the MN-HA authentication extension. After successful
authentication extension validation, the PDN GW sends a Registration Reply
(RRP) to the UE through the FA. The RRP message shall be protected between the
PDN GW and the FA according to TS 33.210 [6].
6) The FA processes the RRP according to RFC 3344 [17]. The FA then forwards
the RRP message to the UE. The FA includes the MN-FA authentication extension,
if the FA received MN-FA authentication extension in the RRQ message.
7) The UE validates the MN-HA authentication extension and MN-FA
authentication extension, if present.
##### 9.2.1.2.2 MIPv4 Key Derivation
The Mobile IP Root Key (MIP-RK) is generated at the 3GPP AAA Server and the
UE. The MIP-RK is generated from the EMSK according to RFC 5295[19] using the
following formula:
> MIP-RK-1 = HMAC-SHA256(EMSK , usage-data \| 0x01)
>
> MIP-RK-2 = HMAC-SHA256(EMSK, MIP-RK-1 \| usage data \| 0x02)
>
> MIP-RK = MIP-RK-1 \| MIP-RK-2
>
> where:
>
> \"\|\"denotes concatenation
>
> usage-data = key label + \"\0\" + length
>
> key label = miprk\@wimaxforum.org in ASCII
>
> length = 0x0200 the length in bits of the MIP-RK expressed as a 2 byte
> unsigned integer in network order
The length of the MIP-RK is 64 octets. The lifetime of MIP-RK is set to the
lifetime of EMSK. The MIP-RK is stored in the 3GPP AAA Server. At the 3GPP AAA
Server each user session is associated with a single MIP-RK. The MIP-RK is
used to generate mobility keys. The MIPv4 keys are generated at the 3GPP AAA
Server and at the UE. The keys generated at the 3GPP AAA Server are
transported to the HA and the Authenticator in the trusted non-3GPP network by
the use of the AAA protocol.
Security Parameter Indices (SPI) is generated from the MIP-RK as follows:
> MIP-SPI = the 4 most significant bytes of HMAC-SHA256 (MIP-RK, \"SPI CMIP
> PMIP \"\| APN))
>
> SPI-CMIP4 = MIP-SPI,
>
> Values MIP-SPI+1, MIP-SPI+2, and MIP-SPI+3 are reserved.
APN is used as an input parameter for deriving unique MIP-SPI, MN-HA key and
MN-FA key per PDN connection. For default PDN connection, the UE does not
provide an APN. In this case APN shall be omitted from the derivation of MIP-
SPI, MN-HA key and MN-FA key.
The MIP-SPI and SPI-CMIP4 are derived at the UE and at the 3GPP AAA server.
The following procedure prevents collision between SPI values used for
different Mobility keys, for example, mobility keys used by other access
technologies, during the same Mobile IP session. The procedure SHALL be
executed as follows:
a. First, if the absolute value of the difference between the MIP-SPI and any
currently active SPI is less than 4, the MIP-SPI value SHALL be incremented by
FOUR until the current condition is satisfied.
b. Next, if the MIP-SPI value is less than THREE smaller than the maximum
possible value of SPI (2^32^ - 1), the MIP-SPI value SHALL be incremented by
259.
c. Last, the process specified in Step 1 SHALL be applied again until the
condition specified in Step 1 is satisfied.
The SPI value is used by the UE, HA, and 3GPP AAA server to identify the MN-HA
key used to compute the MN-HA Authentication Extension in the RRQ message. In
addition, MIP-SPI is distributed to the authenticator during Access
Authentication, in AAA protocol attribute FA-RK-SPI, to identify the FA-RK
key. FA-RK key and FA-RK-SPI will be used to further derive MN-FA key and MN-
FA-SPI, to compute the MN-FA Authentication Extension in the RRQ message. When
the lifetime of the MIP-RK expires the lifetime of the SPIs derived from it
shall also expire.
The derivation of mobility key is given below:
> MN-HA = HMAC-SHA1(MIP-RK,\" CMIP4 MN HA\" \| HA-IPv4 \| MN-NAI \| APN)
The lifetime of all MN-HA keys shall be set to the lifetime of the MIP-RK.
During the initial attach or additional PDN connectivity, the UE may not know
the HA IP address. In this case, the UE use ALL-ZERO-ONE-ADDR [21] in the RRQ
message to request for dynamic HA assignment. Under this case, the UE shall
derive the MN-HA key using the ALL-ZERO-ONE-ADDR as the HA-IPv4 address and
use this key for deriving MN-HA Authentication Extension and send in the RRQ.
Then the HA informs this to the 3GPP AAA server in the AAA protocol message.
In response from the 3GPP AAA server, the HA will receive RRQ-MN-HA-KEY that
is calculated based on ALL-ZERO-ONE-ADDR address and also MN-HA key that is
calculated based on HA IP address. The HA shall use the RRQ-MN-HA-KEY for
validation of MN-HA Authentication Extension in the received RRQ. The HA then
use MN-HA key for deriving RRP MN-HA Authentication Extension and sends the HA
IP address as part of the RRP message. The UE shall recalculate the MN-HA key
using the HA IP address received in the RRP and use this key for MN-HA
Authentication Extension validation for the RRP. If the MN-HA authentication
extension is valid, the new MN-HA key shall be in effect.
The derivation of FA-RK and MN-FA mobility keys are given below:
FA-RK = HMAC-SHA1(MIP-RK, \"FA-RK\")
MN-FA = HMAC-SHA1(FA-RK, \"MN FA\" \| FA-IP \| MN-NAI \| APN)
The FA-RK is generated by the 3GPP AAA Server and distributed to the
Authenticator. It is used by the Authenticator to derive MN-FA keys as
requested by the FA. The MN-FA key is derived based on the FA-IP address to
separate keys between different FAs for the same authentication session. The
lifetime of FA-RK and MN-FA shall be set to the lifetime of the MIP-RK. The
SPI associated with the MN-FA (MN-FA-SPI) is set to the same value of FA-RK-
SPI distributed during Access Authentication.
During EAP-Re-authentication, the 3GPP AAA server and the UE generate new MIP-
RK, SPI, MN-HA and FA-RK. The old MIP-RK and its derivatives (MN-HA, FA-RK,
MN-FA) shall be deprecated after confirming that the newly generated mobility
keys in the 3GPP AAA server and the UE are the same. Upon receipt of an MIP-
RRQ from the UE, the HA shall determine whether re-authentication has occurred
since the last MIP-RRQ by comparing the SPI contained in the MN-HA
Authentication extension of the received MIP-RRQ to the locally stored value.
If the two SPIs are different, the HA shall assume that re-authentication has
occurred, and the new MN-HA key shall be retrieved from the 3GPP AAA server.
After verifying the MIP-RRQ message with the new MN-HA key and creating the
MIP-RRP Authentication Extension, the HA deprecate the old key. The UE shall
deprecate the old key, once it successfully verifies the MIP-RRP using the new
key.
##### 9.2.1.2.3 Key Usage
* * *
Key Generated by Used at MN-HA UE and 3GPP AAA server HA and UE FA-RK UE and
3GPP AAA server UE and Authenticator MN-FA UE and Authenticator FA and UE
* * *
The keys that are used by the UE are generated by the UE and shall not be
transported outside the UE. The keys generated by the 3GPP AAA Server are
transported to the HA or the Authenticator using AAA protocols.
##### 9.2.1.2.4 Key Distribution for MIPv4
In this section, key distribution for MIP4 is described. Two scenarios are
possible, where in the first scenario Authenticator and FA are co-located and
in the case of FA relocation, also the Authenticator changes based on EAP re-
authentication. In the second scenario, no re-authentication takes place when
the FA is relocated, so the anchor Authenticator is continued to be used, and
provisions the new FA with the required mobility keys. However key handling
between Authenticator and FA is out of scope of the present document.
The Authenticator receives FA_RK in the RADIUS/DIAMETER Access-Accept message
as a result of successful authentication. The keys are stored at the
authenticator.
The 3GPP AAA Server distributes the MN-HA key, if requested, to the HA using
RADIUS/DIAMETER Access-Accept.
### 9.2.2 DS-MIPv6
#### 9.2.2.1 General
The DS-MIPv6 security is based on IPsec as defined in RFC 4877 [2]. The IPsec
security association is established between the UE and the node acting as HA
(i.e. PDN GW).
The following principles apply:
  * The UE and the HA shall use IKEv2, as specified in RFC 5996 [30], in order to establish IPsec security associations.
  * Public key signature based authentication with certificates, as specified in RFC 5996 [30], is used to authenticate the HA. The HA shall authenticate itself to the UE with an identity. This identity shall be the same as the FQDN of the HA if the HA is found via DNS cfr. TS 23.402 [5].
  * EAP-AKA, as specified in RFC 4187 [7], within IKEv2, as specified in RFC 4877 [2] and RFC 5996 [30], is used to authenticate UEs.
The following properties are needed to provide secure S2c over a Trusted
Non-3GPP Access:
  * The Trusted Access will authenticate the UE and provide a secure link for the data to be transferred from the UE to the Trusted Access.
  * The Trusted Access protects against source IP address spoofing.
  * The Trusted Access and PDN GW will have a secure link between them to transfer the user\'s data across.
  * The Trusted Access and EPC need to co-ordinate when the UE detaches from the Trusted Access in order to ensure that the IP address that was assigned to the UE is not be used by another UE without EPC being aware of the change (i.e. enable the PDN GW to remove the CoA address binding for the old UE).
These properties ensure that the traffic the PDN GW is receiving has
originated at the UE while UE is attached to the Trusted Access. These
properties may be provided using enhanced security mechanisms defined in
clause 9.2.2.4.
NOTE 1: If Trusted Access and EPC do not co-ordinate regarding UE detachment
then the UE that was re-assigned the IP address would be capable of
impersonating traffic until the binding in PDN GW timed out. NOTE 2:
Procedures internal to the Trusted Access are outside the scope of the present
document.
The allocation of IP addresses in the access network may provide the last
property listed above. If the IP address is not re-allocated until after the
MIP Binding has expired or IKE Dead Peer Detection has been run. This means
that the PDN GW will no longer associate the old UE to the IP address once the
new UE gets the IP address and hence there is no risk of impersonation
attacks.
PCC may also be used to provide the last property listed above in access
networks that support it. In the case that PCC is used, a GW control session
is established between the Trusted Access and the PCRF. This GW control
session is identified by the UE ID and the IP address allocated to the UE
(i.e. CoA if DSMIPv6 is used). Using the GW control session, the UE is
restricted to limited access; in particular, the Trusted Access restricts the
forwarding of the packets only to IKEv2 and BU messages until the binding at
the PDN GW is established. The Trusted Access knows when the binding is
established at the PDN GW because it receives an update of the GW control
session. The flows for this control of policy are given in section(s) 6.3 and
6.6.2 of TS 23.402. This prevents a UE that attaches to the Trusted Access
from sending non-signalling traffic to the PDN GW until it has completed a BU
with the PDN GW and prevents an impersonation attack.
#### 9.2.2.2 Bootstrapping of DSMIPv6 parameters
##### 9.2.2.2.1 Full Authentication and authorization
The first procedure that must be performed by the MN is the discovery of the
HA address, which in case of EPS is the IP address of the PDN GW. The detailed
of this procedure are specified in TS 23.402 [5] and TS 24.303 [20].
As soon as the Mobile Node has discovered the PDN GW address, it establishes
an IPsec Security Association with the Home Agent itself through IKEv2. The
detailed description of this procedure is provided in RFC4877 [2]. The IKEv2
Mobile Node to Home Agent authentication is performed using Extensible
Authentication Protocol (EAP).
When the Mobile Node runs IKEv2 with its Home Agent, it shall request an IPv6
Home Network Prefix through the Configuration Payload in the IKE_AUTH exchange
by including an MIP6_HOME_PREFIXattribute.
When the Home Agent processes the message, it allocates a Home Network Prefix
and sends it a CFG_REPLY message. The UE shall then auto-configure a Home
Address from the IPv6 prefix received from the HA.
The IPv6 Home Network Prefix allocation through IKEv2 allows to bind the Home
Address with the IPsec security association so that the MN can only send
Binding Updates for its own Home Address and not for other MN\'s Home
Addresses.
Figure 9.2.2.2.1-1 provides the flow for the initial DS-MIPv6 bootstrapping,
focusing on the security aspects of the flow.
Figure 9.2.2.2.1-1: DS-MIPv6 bootstrapping based on IKEv2
1) The UE discovers the PDN GW address based on the procedure specified in TS
23.402 [5].
2) The UE starts an IKEv2 exchange with the PDN GW. The first part of this
exchange is an IKE_SA_INIT exchange. In this phase the PDN GW and UE negotiate
cryptographic algorithms, exchange nonces and perform a Diffie-Hellman
exchange.
3) The UE sends the user identity (in the IDi payload) and the APN identifier
(in the IDr payload) in this first message of the IKE_AUTH phase, and begins
negotiation of child security associations. The UE omits the AUTH parameter in
order to indicate to the PDN GW that it wants to use EAP over IKEv2. The user
identity shall be compliant with Network Access Identifier (NAI) format
specified in TS 23.003 [8], containing the IMSI or the pseudonym, as defined
for EAP-AKA in RFC 4187 [7]). The UE shall send the configuration payload
(CFG_REQUEST) within the IKE_AUTH request message to obtain an IPv6 Home
Network Prefix as specified in 3GPP TS 24.303 [20]. The UE shall include the
Traffic Selectors to protect DS-MIPv6 signalling as specified in RFC4877 [2].
4) The PDN GW sends the Authentication Request message with an EAP AVP to the
3GPP AAA Server, containing the user identity, APN and a parameter indicating
that the authentication is being performed for DS-MIPv6 security. For the
communication between PDN GW and 3GPP AAA server, cf. also [4].
5) The 3GPP AAA Server shall fetch the user profile and authentication vectors
from HSS/HLR (if these parameters are not available in the 3GPP AAA Server).
The 3GPP AAA Server shall include the parameter received in step 4 indicating
that the authentication is being performed for DSMIPv6 in the request to the
HSS. The HSS shall then generate authentication vectors with AMF separation
bit = 0 and send them back to the 3GPP AAA server. The AAA checks that the UE
is authorised to use the APN.
6) Based on the identity received, the 3GPP AAA server selects an
Authentication Vector (RAND, AUTN, CK, IK, XRES) for the UE. The 3GPP AAA
Server then initiates the authentication challenge by sending the EAP-
Request/AKA-Challenge containing RAND and AUTN as described by RFC 4187 [7].
The user identity is not requested again, as in a normal authentication
process, because there is the certainty that the user identity received in the
EAP Identity Response message has not been modified or replaced by any
intermediate node. The reason is that the user identity was received via an
IKEv2 secure channel which can only be decrypted and authenticated by the end
points (the PDN GW and the UE).
7) The PDN GW responds to the UE with its identity, a certificate, and sends
the AUTH parameter to protect the previous message it sent to the UE (in the
IKE_SA_INIT exchange). The EAP message received from the 3GPP AAA Server (EAP-
Request/AKA-Challenge), which contains RAND and AUTN, is included in order to
start the EAP procedure over IKEv2.
8) The UE checks whether the AUTN is correct [11] and if so calculates CK, IK
and RES and passes these to the UE. The UE checks the IKE authentication
parameters and responds to the authentication challenge. The only payload
(apart from the header) in the IKEv2 message is the EAP message which contains
the AKA response, RES.
9) The PDN GW forwards the EAP-Response/AKA-Challenge message to the 3GPP AAA
Server.
10) The 3GPP AAA Server checks the EAP message including that RES = XRES and
then calculates MSK from CK and IK as described in RFC 4187 [7]. The 3GPP AAA
Server sends the Authentication Answer including an EAP success and the key
material to the PDN GW. This key material shall consist of the MSK generated
during the authentication process. In case of PDN GW reallocation upon attach
on S2c, the AAA shall include the target PDN GW's identity as specified in
3GPP TS 23.402 [5].
11) The AUTH payload is computed using the received MSK.
12) The EAP Success message is forwarded to the UE over IKEv2.
13) The UE also generates MSK as input to generate the AUTH parameter to
authenticate the first IKE_SA_INIT message. The AUTH parameter is sent to the
PDN GW.
14) The PDN GW checks the correctness of the AUTH received from the UE and
calculates the AUTH parameter which authenticates the second IKE_SA_INIT
message. The PDN GW shall send the assigned Home Network prefix in the
configuration payload (CFG_REPLY) as specified in 3GPP TS 24.303 [20], except
in the case of PDN GW reallocation upon attach on S2c, when the PDN GW shall
send to the UE the target PDN GW's address as specified in 3GPP TS 23.402 [5].
Then the AUTH parameter is sent to the UE together with the configuration
payload, security associations and the rest of the IKEv2 parameters and the
IKEv2 negotiation terminates.
> In the case PDN GW reallocation, the UE shall begin a new DSMIPv6
> bootstrapping with the target PDN GW.
##### 9.2.2.2.2 Fast re-authentication and authorization
Fast re-authentication for EAP-AKA is specified in RFC 4187 [7]. Fast re-
authentication re-uses keys derived on the previous full authentication. Fast
re-authentication does not involve the HSS nor the credentials used with EAP-
AKA (e.g. USIM application in case of terminal with 3GPP access capabilities),
and does not involve the handling of AKA authentication vectors, which makes
the procedure faster and reduces the load on the HSS and, in particular, the
Authentication Centre.
The UE and the 3GPP AAA server shall implement fast re-authentication for the
use of EAP-AKA with DSMIPv6. Its use is optional and depends on operator
policy.
The security level of fast re-authentication for EAP-AKA is lower as it does
not prove the presence of the EAP-AKA credentials (e.g. USIM application in
case of terminal with 3GPP access capabilities) on the user side. The operator
should take this into account when defining the policy on fast
reâ€‘authentication.
Fast re-authentications for EAP-AKA generates new keys MSK, which may be used
for renewing session key used for protection in the non-3GPP access network.
The procedure is very similar to the tunnel full authentication and
authorization. The only difference is that EAP fast re-authentication is used
in this case.
Figure 9.2.2.2.2-1: Fast Re-authentication for DSMIPv6
  1. The UE and the PDN GW exchange the first pair of messages, known as IKE_SA_INIT, in which the PDN GW and UE negotiate cryptographic algorithms, exchange nonces and perform a Diffie_Hellman exchange.
  2. The UE sends the re-authentication identity (in the IDi payload) and the APN information (in the IDr payload) in this first message of the IKE_AUTH phase, and begins negotiation of child security associations. The UE omits the AUTH parameter in order to indicate to the PDN GW that it wants to use EAP over IKEv2. The re-authentication identity used by the UE shall be the one received in the previous authentication process. If the UE\'s Remote IP address needs to be configured dynamically, then the UE shall send the configuration payload (CFG_REQUEST) within the IKE_AUTH request message to obtain a Remote IP Address.
  3. The PDN GW sends the Authentication Request message with an EAP AVP toward the 3GPP AAA Server, containing the re-authentication identity. The PDN GW shall include the APN and a parameter indicating that the authentication is being performed for DSMIPv6 with a PDN GW. This will help the 3GPP AAA Server distinguish among authentications for DSMIPv6, trusted access, as specified in clause 6 of the present document, authentications for tunnel setup in I-WLAN (which would allow also EAP-SIM) and authentications for tunnel setup in EPS (which allow only EAP-AKA). The AAA checks that the UE is authorised to use the APN.
  4. The 3GPP AAA Server initiates the fast re-authentication challenge.
  5. The PDN GW sends an IKE_AUTH Response message to the UE, containing its identity, a certificate, and the AUTH parameter to protect the previous message it sent to the UE (in the IKE_SA_INIT exchange). The EAP message (EAP-Request/AKA-Reauthentication) received from the 3GPP AAA Server is included in order to start the EAP procedure over IKEv2.
  6. The UE checks the authentication parameters and responds to the fast re-authentication challenge. The only payload (apart from the header) in the IKEv2 message is the EAP message.
  7. The PDN GW forwards the EAP-Response/AKA-Reauthentication message toward the 3GPP AAA Server.
  8. When all checks are successful, the 3GPP AAA Server sends the Authentication Answer including an EAP success and the key material toward the PDN GW. This key material shall consist of the MSK generated during the fast re-authentication process. When the Wm interface (ePDG-AAA) is implemented using Diameter, the MSK shall be encapsulated in the EAP-Master-Session-Key parameter, as defined in RFC 4072 [10].
  9. The MSK shall be used by the PDN GW to generate the AUTH parameters in order to authenticate the IKE_SA_INIT phase messages, as specified in RFC 5996 [30]. These two first messages had not been authenticated before as there was no key material available yet. According to RFC 5996 [30], the shared secret generated in an EAP exchange (the MSK), when used over IKEv2, shall be used to generated the AUTH parameters.
  10. The EAP Success message is forwarded to the UE over IKEv2.
  11. The UE shall take its own copy of the MSK as input to generate the AUTH parameter to authenticate the first IKE_SA_INIT message. The AUTH parameter is sent to the PDN GW.
  12. The PDN GW checks the correctness of the AUTH received from the UE and calculates the AUTH parameter which authenticates the second IKE_SA_INIT message. The PDN GW shall send the assigned Remote IP address in the configuration payload (CFG_REPLY), if the UE requested for a Remote IP address through the CFG_REQUEST. Then the AUTH parameter is sent to the UE together with the configuration payload, security associations and the rest of the IKEv2 parameters and the IKEv2 negotiation terminates.
#### 9.2.2.3 Security Profiles
The profiles for IKEv2 and IPsec ESP as defined in TS 33.234 [9] shall be used
with the exception that ESP in transport mode shall be used.
For PDN GW certificates, the certificate profiles as defined in TS 33.234 [9]
shall be used.
#### 9.2.2.4 Enhanced Security Support
The UE and the PDN GW may support integrity protection and/or confidentiality
protection of user plane traffic exchanged over the S2c tunnel when the UE is
in a trusted non-3GPP access.This is achieved as follows: after the
establishment of the s2c tunnel, the UE or the PDN GW may trigger the creation
of a pair of IPsec child SAs as specified in RFC 4877 [2]. This may be
deactivated by the UE or the PDN GW by initiating the deletion of the
corresponding child SAs.
The profiles for IKEv2 and IPsec ESP in tunnel mode as defined in TS 33.234
[9] shall be used.
## 9.3 Network based Mobility
### 9.3.1 Proxy Mobile IP
#### 9.3.1.1 Introduction
Subclause 9.3.1.2 defines the security requirements and mechanisms for Proxy
Mobile IP (PMIP) when used in EPS. In particular, it addresses how PMIP
messages need to be protected within the Evolved Packet Core and how PMIP
protection needs to be handled if the PMIP messages originate from a trusted
non-3GPP network node.
#### 9.3.1.2 PMIP security requirements
_Trust model:_
  * For the reference points S2a (MAG in trusted non-3GPP access network) and S2b, S5 and S8 (MAG in ePDG or Serving GW), the MAG shall be trusted by the LMA to register only those Mobile Nodes that are attached.
_Requirements on mechanisms for securing PMIP messages on the reference points
S2a, S2b, S5 and S8:_
Security for PMIP messages between MAG and LMA shall be provided:
  * either by a chain of security associations in a hop-by-hop fashion according to TS 33.210 [6]. For each hop in such a chain, one security association per direction shall be used for all PMIP messages relating to any user, or
  * by one security association per direction for all PMIP messages relating to any user in an end-to-end fashion according to TS 33.210 [6] for the intra-domain case.
In order to protect PMIP messages, integrity protection is required,
confidentiality protection is optional.
_Strong access authentication:_
  * PMIP shall be used only in conjunction with AKA-based access authentication.
#### 9.3.1.3 PMIP security mechanisms
TS 33.210 [6] shall be applied to secure PMIP messages on the reference points
S2a, S2b, S5 and S8. TS 33.310 [12] may be applied regarding the use of
certificates with the security mechanisms of TS 33.210 [6].
NOTE: For the case of an interface between two entities in the same security
domain, TS 33.210 [6] does not mandate the protection of the interface by
means of IPsec.
# 10 Security interworking between 3GPP access networks and non-3GPP access
networks
## 10.1 General
The requirements and specifics for the security interworking of 3GPP access
networks with different non-3GPP access networks during idle mode and active
mode mobility are described in the following subclauses.
## 10.2 CDMA2000 Access Network
This clause captures all the security requirements for the interworking
between HRPD and E-UTRAN during idle mode and active mode mobility. The
present document assumes that no security context exchange is performed
between E-UTRAN and HRPD access systems.
### 10.2.1 Idle Mode Mobility
The security interworking specifics between E-UTRAN and HRPD during idle mode
mobility are defined in this clause which covers the UE idle mobility in both
directions, i.e. from E-UTRAN to HRPD and HRPD to E-UTRAN.
#### 10.2.1.1 E-UTRAN to HRPD Interworking
For pre-registration, the UE interacts directly with HRPD system to perform
authentication through the HS-GW and establish security association with this
system directly. The procedures are the same as in the case when the UE
connects directly to the HRPD access network except that it is tunneled over
the E-UTRAN/EPS. In these procedures, the UE follows the authentication and
key agreement procedure described in subclause 6.2. Tunneled signaling is
exchanged over S101 interface which shall be secured as described in clause
11.
NOTE: Network domain security as specified in TS 33.210 [6] and TS 33.310 [12]
applies to secure signalling between eAN/PCF in the HRPD access network and
MME in the serving network.
In the case when the UE is not aware of its movement from E-UTRAN to HRPD, the
UE may access the HRPD system directly without performing a pre-registration
through E-UTRAN/EPS system.
For UEs with an established emergency call the authentication is subject to
the requirements in clause 13.
#### 10.2.1.2 HRPD to E-UTRAN Interworking
The security interworking specifics of the UE idle mode mobility from HRPD to
E-UTRAN follows the EPS network entry procedures as described in TS 33.401
[16].
### 10.2.2 Active mode mobility
The security interworking specifics during active mode mobility between
E-UTRAN and HRPD are defined in this clause which covers the UE active
mobility in both directions, i.e. from E-UTRAN to HRPD and HRPD to E-UTRAN.
#### 10.2.2.1 E-UTRAN to HRPD Interworking
The UE behaviour is the same as in E-UTRAN-HRPD security Interworking for idle
mode mobility described in subclause 10.2.1.
#### 10.2.2.2 HRPD to E-UTRAN Interworking
The UE interacts directly with the MME to perform authentication with EPS and
establish a security association with this system directly. The procedures are
the same as in the case when the UE connects directly to the E-UTRAN system,
except that it is tunneled over the HRPD AN. In these procedures, the UE uses
EPS-AKA with the MME.
# 11 Network Domain Security
For all interfaces between network elements relevant in the context of the
present document,
  * TS 33.210 [6] shall be applied to secure signalling messages on the reference points unless specified otherwise, and
  * TS 33.310 [12] may be applied regarding the use of certificates with the security mechanisms of TS 33.210 [6] unless specified otherwise in the present document.
NOTE: For the case of an interface between two entities in the same security
domain, TS 33.210 [6] does not mandate the protection of the interface by
means of IPsec.
# 12 UE-ANDSF communication security
## 12.1 UE-ANDSF communication security requirements
In order to address the security of communication over S14 reference point
(i.e. between UE and ANDSF), the following requirements apply:
  * UE and ANDSF shall be mutually authenticated;
  * The UE shall be able to verify that the ANDSF is authorized to serve it.
  * Signalling over S14 reference point shall be integrity protected
  * Signalling over S14 reference point shall be confidentiality protected.
  * Signalling over S14 reference point shall be protected against possible replay attacks.
## 12.2 UE-ANDSF communication security solution
UE and ANDSF server shall establish a security association to protect the
messages of Access Network Info Request and Access Network Info Response. UE
and ANDSF server shall mutually authenticate each other. UE and ANDSF server
shall use the following mechanism to meet the security requirements as
specified in clause 12.1:
For ANDSF pull messages, PSK TLS with GBA based shared key-based mutual
authentication between UE and ANDSF server as specified by clause 5.4 of
TS33.222 [24].
For ANDSF push messages one of the following mechanisms shall be used:
\- If a PSK TLS connection has been established as a part of a pull message
and is still available, the available PSK TLS session shall be used.
\- Otherwise, PSK TLS with GBA push based shared key-based mutual
authentication between the UE and the ANDSF server shall be used. GBA push is
specified in TS 33.223 [29].
NOTE: If a TLS connection is released, it can only be re-established by the
client side, i.e. UE, even though the TLS session including security
association would be alive on both sides. TLS connection, in turn, is
dependent on the underlying TCP connection.
The ANDSF shall request the User Security Settings (USS) from the BSF and
deducts the authorization information for this UE from USS as specified in TS
29.109 [25].
For the authorization of the ANDSF server to the UE, the UE shall check that
the ANDSF that the UE discovered and is connecting to is on the configured
list of ANDSF names.
# 13 Security Aspects of Emergency Call Handling
## 13.1 General
NOTE: Support for EPS emergency calling is defined in the TS 23.402 [5]. Per
TS 23.402 [5], this release of this specification is limited to support of
handover of emergency sessions from Eâ€‘UTRAN access to HRPD access only. In
this release of this specification, handover of IMS Emergency Sessions from
HRPD access to E-UTRAN access is not supported.
## 13.2 Requirements for Emergency Call handling
If the UE is authenticated in E-UTRAN and has an emergency call established
and at that point attempts a hand over to HRPD, authentication and
authorization of the UE to HRPD is executed according to operator policy and
local regulatory requirements. If the HRPD network chooses to perform
authentication and authorization at the handover and either one of them fail,
then it is up to operator policy and local regulatory requirements whether the
UE shall be allowed to get service from the HRPD network.
If the UE has established an unauthenticated emergency call in E-UTRAN and
attempts a handover to HRPD, then it is up to local regulations and operator
policy if the UE shall receive service from HRPD network. E-UTRAN provides an
indication to HRPD access whether the UE has been authenticated in E-UTRAN or
not, as described in TS 23.402 [5].
###### ## Annex A (normative): Key derivation functions
## A.1 KDF interface and input parameter construction
All key derivations (including input parameter encoding) shall be performed
using the key derivation function (KDF) specified in TS 33.220 [8]. This
clause specifies how to construct the input string, S, to the KDF (which is
input together with the relevant key). For each of the distinct usages of the
KDF, the input parameters S are specified below.
The FC number space used is controlled by TS 33.220 [8], FC values allocated
for this specification are in range of 0x20 -- 0x2F.
## A.2 Function for the derivation of CK', IK' from CK, IK
When deriving CK', IK' from CK, IK and the access network identity as defined
in clause 6 of this specification , the following parameters shall be used to
form the input S to the KDF.
\- FC = 0x20,
\- P0 = value of access network identity, as defined in 3GPP TS 24.302 [22],
\- L0 = length of value of access network identity (variable, depending on
access network type),
\- P1 = SQN âŠ• AK
\- L1 = length of SQN âŠ• AK (i.e. 0x00 0x06)
If AK is not used, AK shall be treated in accordance with TS 33.102, i.e. as
000...0.
The access network identity is defined separately for each access network
type. For each access network type, the access network identity is documented
in TS 24.302 [22] to ensure that UE and HSS use the same access network
identities as input for key derivation.
The input key shall be the concatenation CK \|\| IK of CK and IK.
The KDF returns a 256-bit output, where the 128 most significant bits are
identified with CK\' and the 128 least significant bits are identified with
IK\'.
#
# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the MAC protocol.
The specification describes:
\- MAC architecture;
\- MAC entities;
\- channel structure;
\- services provided to upper layers;
\- MAC functions;
\- services expected from the physical layer;
\- elements for layer-to-layer communication including primitives between MAC
and RLC;
\- elements for peer-to-peer communication;
\- protocol data units, formats and parameters;
\- elementary procedures.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 25.301: \"Radio Interface Protocol Architecture\".
[3] 3GPP TS 25.302: \"Services provided by the Physical Layer\".
[4] 3GPP TS 25.303: \"Interlayer Procedures in Connected Mode\".
[5] 3GPP TS 25.304: \"UE Procedures in Idle Mode and Procedures for Cell
Reselection in Connected Mode\".
[6] 3GPP TS 25.322: \"RLC Protocol Specification\".
[7] 3GPP TS 25.331: \"Radio Resource Control (RRC); protocol specification\".
[8] 3GPP TR 25.921: \"Guidelines and Principles for Protocol Description and
Error Handling\".
[9] 3GPP TR 25.990: \"Vocabulary for the UTRAN\".
[10] 3GPP TS 33.102: \"Security architecture\".
[11] 3GPP TS 25.425: \"UTRAN Iur Interface User Plane Protocols for Common
Transport Channel Data Streams\".
[12] 3GPP TS 25.133: \"Requirements for support of radio resource management
(FDD)\".
[13] 3GPP TS 25.214: \"Physical layer procedures (FDD)\".
[14] 3GPP TS 25.123: \"Requirements for support of radio resource management
(TDD)\".
[15] 3GPP TS 33.105: \"Cryptographic Algorithm Requirements\".
[16] 3GPP TS 25.212: \"Multiplexing and Channel Coding (FDD)\".
[17] 3GPP TS 25.215: \"Physical layer - Measurements (FDD)\".
[18] 3GPP TS 25.224: \"Physical layer procedures (TDD)\".
[19] 3GPP TS 25.222: \"Multiplexing and Channel Coding (TDD)\".
[20] 3GPP TS 25.225: \"Physical layer -- Measurements (TDD)\".
[21] 3GPP TS 25.221 \"Physical Channels and Mapping of Transport Channels onto
Physical Channels (TDD)\"
[22] 3GPP TS 25.213: \"Spreading and modulation (FDD)\".
[23] 3GPP TS 25.306: \"UE Radio Access Capabilities\".
[24] 3GPP TS 25.211: \"Physical channels and mapping of transport channels
onto physical channels (FDD)\"
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given
below and in [9] and [1] apply.
### 3.1.1 HS-DSCH Specific Definitions
**Multiflow (FDD):** A mode of operation with two simultaneous HS-DSCH
transport channels per carrier frequency, where the HS-DSCH transport channels
may belong to the same or different Node Bs.
### 3.1.2 E-DCH Specific Definitions
#### **3.1.2.1 General**
**E-DCH:** The Enhanced Dedicated Channel (E-DCH) is an uplink transport
channel.
**HARQ profile:** One HARQ profile consists of a power offset attribute and
maximum number of transmissions. For 1.28 Mcps TDD, it also includes a
retransmission timer attribute.
**Power offset attribute (FDD):** This represents the power offset between
E-DPDCH(s) and reference E-DPDCH power level for a given E-TFC. This power
offset attribute is set to achieve the required QoS in this MAC-d flow when
carried alone in a MAC-e or MAC-i PDU and subsequently in the corresponding
CCTrCh of E-DCH type. Details on the mapping on Beta factors can be found in
[13]. The reference E-DPDCH power offset is signalled to the UE for one (or
several) reference E-TFC(s) (see details in subclause 11.1).
**Power offset attribute (TDD):** The power offset attribute is set to achieve
the required QoS in this MAC-d flow when carried alone in a MAC-e or MAC-i PDU
and subsequently in the corresponding CCTrCh of E-DCH type. Details on the
power offset can be found in [18].
**Primary Absolute Grant** : Absolute Grant received with the primary E-RNTI.
Note that the primary E-RNTI is the only E-RNTI for TDD.
**Serving E-DCH cell:** Cell from which the UE receives Absolute Grants from
the Node-B scheduler. A UE has one Serving E-DCH cell.
**Serving_Grant (FDD):** The state variable Serving_Grant indicates the
maximum E-DPDCH to DPCCH power ratio that the UE is allowed to use for
scheduled data in the following transmission. The value in the appropriate
state variable will be provided to the E-TFC selection function to help in
selecting the best format for the upcoming transmission. Possible values are:
\"Zero_Grant\" and numerical values. The DPCCH power assumed for the
Serving_Grant in a compressed frame is the actual DPCCH power in the
compressed frame minus 10Log~10~ (N~pilot,N~/N~pilot,C~) as defined in [13].
**Serving_Grant (TDD):** The state variable Serving_Grant indicates the power
ratio of maximum E-PUCH power level per TDD resource unit relative to a
reference E-PUCH power level P~e-ref~ that the UE is allowed to use for
scheduled data on the physical resources associated with the E-AGCH grant.
P~e-ref~ is defined as the calculated E-PUCH transmit power (P~E-PUCH~) in
[18] with β~e~=0. The value in the appropriate state variable will be provided
to the E-TFC selection function to help in selecting the best format for the
upcoming transmission. Possible values are: \"Zero_Grant\" and numerical
values.
**UL Common MAC Flow(1.28 Mcps TDD):** an UL Common MAC Flow is a flow of
MAC-c PDU mapped to E-DCH configured for UEs in Cell_FACH state and IDLE mode.
#### **3.1.2.2 FDD**
**Active Process** : HARQ process for which Scheduling Grant are applicable,
i.e. scheduled data can be sent.
**AG_Timer** : This timer is set to one HARQ RTT (40ms in the case of 10ms
TTI, 16ms in the case of 2ms TTI).
**Common E-DCH resource:** Common E-DCH resources are under direct control of
the Node B and are shared by UEs in CELL_FACH state and IDLE mode.
**Common E-RGCH RL:** Cell which is not the serving E-DCH radio link and from
which the UE can receive one Relative Grant in CELL_FACH state. The UE can
have zero, one or up to 3 Common E-RGCH RL(s).
**E-DCH active set:** The set of cells which carry the E-DCH for one UE. For
FDD, in CELL_FACH state and Idle mode, the E-DCH active set consists of the
Serving E-DCH cell only.
**Inactive Process** : HARQ process for which Scheduling Grants are not
applicable, i.e. scheduled data cannot be sent.
**INACTIVE** : Absolute Grant value that can be sent by the serving cell\'s
scheduler on the E-AGCH to deactivate a process or to switch the UE to its
secondary E-RNTI. In CELL_FACH state, this absolute grant value is used to
release a common E-DCH resource when the Absolute Grant Scope is set to \"All
HARQ processes\".
**Lowest Configured Serving Grant Value** : The serving grant value indicated
by index 0 of the SG table in use.
**Maximum_Serving_Grant:** The variable Maximum_Serving_Grant indicates the
maximum E-DPDCH to DPCCH power ratio that the UE is allowed to use for
scheduled data while the timer Non_Serving_RG_Timer has not expired.
**Maximum number of re-transmissions, Maximum number of transmissions:**
Maximum number of re-transmissions = maximum number of transmissions - 1\.
Both these notations are used.
**Minimum_Grant** : The value Minimum_Grant corresponds to the minimum E-DPDCH
to DPCCH power ratio that the UE considers. This value is in index 0 of the
configured scheduling grant table described in subclause 9.2.5.2.1.
**NodeB triggered HS-DPCCH transmission:** Transmission on a common E-DCH
resource to provide HS-DPCCH feedback in CELL_FACH state, which is triggered
by the reception of an HS-SCCH order as defined in [16].
**Non-serving E-DCH RL or Non-serving RL:** Cell which belongs to the E-DCH
active set but does not belong to the Serving E-DCH RLS and from which the UE
can receive one Relative Grant. The UE can have zero, one or several Non-
serving E-DCH RL(s).
**Non_Serving_RG_Timer** : This timer is set to one HARQ RTT (40ms in the case
of 10ms TTI, 16ms in the case of 2ms TTI).
**Primary Absolute Grant** : Absolute Grant received with the primary E-RNTI.
**Primary_Grant_Available:** This state variable is a Boolean, indicating
whether the UE's serving grant is only affected by Primary Absolute Grants and
Relative Grants (i.e. not by Secondary Absolute Grants).
**Primary Uplink Frequency:** If a single uplink frequency is configured for
the UE, then it is the primary uplink frequency. In case more than one uplink
frequencies are configured for the UE, then the primary uplink frequency is
the frequency on which the E-DCH corresponding to the serving E-DCH cell
associated with the serving HS-DSCH cell is transmitted. The association
between a pair of uplink and downlink frequencies is indicated by higher
layers.
**reference_ETPR:** The state variable reference_ETPR holds the E-DPDCH to
DPCCH power ratio used as reference for relative grant commands. This variable
is set to the E-DPDCH to DPCCH power ratio used for the E-TFC selected for the
previous TTI on this HARQ process, calculated using the amplitude ratios prior
to the quantization according to subclause 5.1.2.5B.2.3 or 5.1.2.5B.2.4 of
[13], excluding non-scheduled transmissions, excluding any scaling applied
according to subclause 5.1.2.6 of [13] and is obtained from the physical
layer. In case no scheduled transmission took place on a HARQ process in the
previous TTI, reference_ETPR shall be set to Minimum_Grant for this HARQ
process.
**reference_ETPR2:** The state variable reference_ETPR2 holds the E-DPDCH to
DPCCH power ratio used as reference for non serving relative grant commands.
This variable is set to the previously stored **reference_ETPR** on this HARQ
process when the reference_ETPR is updated with a new value.
**Secondary Absolute Grant** : Absolute Grant received with the secondary
E-RNTI.
**Serving E-DCH RLS or Serving RLS:** Set of cells which contains at least the
Serving E-DCH cell and from which the UE can receive and combine one Relative
Grant. The UE has only one Serving E-DCH RLS. For FDD, in CELL_FACH state and
Idle mode, the Serving E-DCH RLS or Serving RLS contains the Serving E-DCH
cell only, from which the UE can receive one Relative Grant.
**Stored_Secondary_Grant:** This state variable is used to store the value
derived from the last received Secondary Absolute Grant Value. Possible values
are: \"Zero_Grant\" and numerical values.
**UL Common MAC Flow:** an UL Common MAC Flow is a flow of MAC-c PDU mapped to
E-DCH configured for UEs in Cell_FACH state and IDLE mode.
### 3.1.3 DTX-DRX and HS-SCCH less Specific definitions (FDD only)
**MAC DTX cycle** : Defines the pattern of time instances where the start the
uplink E-DCH transmission after inactivity is allowed.
**MAC Inactivity Threshold:** E-DCH inactivity time after which the UE can
start E-DCH transmission only at given times.
**UE DTX DRX Offset** : Uplink DPCCH burst pattern and HS-SCCH reception
pattern offset in subframes.
**HS-SCCH less mode of operation: HS-SCCH less mode of operation is enabled
when the variable** HS_SCCH_LESS_STATUS defined in [7] is set to TRUE.
**Inactivity Threshold for UE Grant Monitoring** : Determines the number of
E-DCH TTIs after an E-DCH scheduled transmission during which the UE is
required to monitor the full E-AGCH transmissions from the serving radio link
and the full E-RGCH(s) from all the cells in the E-DCH active set.
**Inactivity Threshold for UE DTX cycle 2** : Defines a number of consecutive
E-DCH TTIs without an E-DCH transmission, after which the UE shall immediately
move from UE_DTX_cycle_1 to using UE_DTX_cycle_2.
**Default-SG-in-DTX-Cycle-2:** Defines the default E-DCH Serving Grant used in
the case when the UE moves from UE DTX cycle 1 to UE DTX cycle 2 after
Inactivity Threshold for UE DTX cycle 2 triggers.
### 3.1.4 HS-DSCH/E-DCH SPS Specific definitions (1.28 Mcps TDD only)
**HS-DSCH SPS operation** : HS-DSCH SPS operation is enabled when the variable
HS_DSCH_SPS_STATUS defined in [7] is set to TRUE.
**HS-DSCH SPS resources** : Defines the downlink physical resources in term of
timeslots and codes on which the first HS-DSCH transmission of transport
blocks is performed without the accompanying HS-SCCH and HARQ retransmission
of the first HS-DSCH transmission are accompanied by HS-SCCH.
**E-DCH SPS operation** : E-DCH SPS operation is enabled when the variable
E_DCH_SPS_STATUS defined in [7] is set to TRUE.
**E-DCH SPS resources** : Defines the uplink physical resources in term of
granted timeslots, codes and power on which the UE may transmit transport
blocks without receiving other grants on E-AGCH.
### 3.1.5 Dual Cell E-DCH Specific definitions (FDD only)
**Activated Uplink Frequency:** For a specific UE, an uplink frequency is said
to be activated if the UE is allowed to transmit on that frequency. The
primary uplink frequency is always activated when configured while a secondary
uplink frequency has to be activated by means of an HS-SCCH order in order to
become activated.
**Configured Uplink Frequency:** For a specific UE, an uplink frequency is
said to be configured if the UE has received all relevant information from RRC
in order to perform transmission on that frequency.
**Secondary Uplink Frequency:** A secondary uplink frequency is a frequency on
which an E-DCH corresponding to a serving E-DCH cell associated with a
secondary serving HS-DSCH cell is transmitted. The association between a pair
of uplink and downlink frequencies is indicated by higher layers.
**Secondary E-DCH Active Set** : The set of cells on the secondary downlink
frequency where E-DCH is carried for one UE.
**Secondary Serving E-DCH cell:** Cell from which the UE can receive Absolute
Grants from the Node-B scheduler on the secondary downlink. A UE has one
configured Serving E-DCH cell on the secondary uplink frequency.
**Secondary Serving E-DCH RLS or Secondary Serving RLS:** The set of cells
which contains at least the Secondary Serving E-DCH cell and from which the UE
can receive and combine one Relative Grant. A UE can have zero or one
Secondary Serving E-DCH RLS.
**Secondary Non-serving E-DCH RL or Secondary Non-serving RL:** The cell which
belongs to the Secondary E-DCH active set but does not belong to the Secondary
Serving E-DCH RLS and from which the UE in CELL_DCH can receive one Relative
Grant. The UE can have zero, one or several Secondary Non-serving E-DCH RL(s).
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AG Absolute Grant
ASC Access Service Class
BCCH Broadcast Control Channel
BCH Broadcast Channel
C- Control-
CCCH Common Control Channel
DCCH Dedicated Control Channel
DCH Dedicated Channel
DL Downlink
DSCH Downlink Shared Channel
DTCH Dedicated Traffic Channel
E-AGCH E-DCH Absolute Grant Channel
E-DCH Enhanced Dedicated Transport Channel
E-DPCCH E-DCH Dedicated Physical Control Channel (FDD only)
ENI E-UCCH Number Indication (1.28Mcps TDD only)
E-HICH E-DCH HARQ Acknowledgement Indicator Channel
E-PUCH Enhanced Uplink Physical Channel (TDD only)
E-RGCH E-DCH Relative Grant Channel
E-RGCH E-DCH Relative Grant Channel (FDD only)
E-RNTI E-DCH Radio Network Temporary Identifier
E-ROCH E-DCH Rank and Offset Channel (FDD only)
E-RUCCH E-DCH Random Access Uplink Control Channel (TDD only)
E-TFC E-DCH Transport Format Combination
E-TFCI E-DCH Transport Format Combination Indicator
E-UCCH E-DCH Uplink Control Channel (TDD only)
FACH Forward Link Access Channel
FDD Frequency Division Duplex
HARQ Hybrid Automatic Repeat Request
HCSN HS-SCCH Cyclic Sequence Number
HSDPA High Speed Downlink Packet Access
HS-DSCH High Speed Downlink Shared Channel
L1 Layer 1 (physical layer)
L2 Layer 2 (data link layer)
L3 Layer 3 (network layer)
MAC Medium Access Control
> MBMS Multimedia Broadcast Multicast Service
>
> MCCH MBMS point-to-multipoint Control Channel
>
> MTCH MBMS point-to-multipoint Traffic Channel
>
> MSCH MBMS point-to-multipoint Scheduling Channel
PCCH Paging Control Channel
PCH Paging Channel
PDU Protocol Data Unit
PHY Physical layer
PhyCH Physical Channels
RACH Random Access Channel
RG Relative Grant
RLC Radio Link Control
RLS Radio Link Set
RNC Radio Network Controller
RNS Radio Network Subsystem
RNTI Radio Network Temporary Identity
RRC Radio Resource Control
RSN Retransmission Sequence Number
SAP Service Access Point
SDU Service Data Unit
SHCCH Shared Channel Control Channel
SRNC Serving Radio Network Controller
SRNS Serving Radio Network Subsystem
TDD Time Division Duplex
TFCI Transport Format Combination Indicator
TFI Transport Format Indicator
TSN Transmission Sequence Number
U- User-
UE User Equipment
UL Uplink
UMTS Universal Mobile Telecommunications System
USCH Uplink Shared Channel
UTRA UMTS Terrestrial Radio Access
UTRAN UMTS Terrestrial Radio Access Network
# 4 General
## 4.1 Objective
The objective is to describe the MAC architecture and the different MAC
entities from a functional point of view.
## 4.2 MAC architecture
The description in this subclause is a model and does not specify or restrict
implementations.
According to the RRC functions the RRC is generally in control of the internal
configuration of the MAC.
Both MAC-hs and MAC-ehs are responsible for handling the data transmitted on
the HS-DSCH. Furthermore they are responsible for the management of the
physical resources allocated to HS-DSCH. Upper layers configure which of the
two entities, MAC-hs or MAC-ehs, is to be applied to handle HS-DSCH
functionality.
Both MAC-e/es and MAC-i/is are responsible for handling the data transmitted
on the E-DCH. Upper layers configure which of the two entities, MAC-e/es or
MAC-i/is, is to be applied to handle E-DCH functionality.
### 4.2.1 MAC Entities
The diagrams that describe the MAC architecture are constructed from MAC
entities.
The entities are assigned the following names.
\- MAC-b is the MAC entity that handles the following transport channels:
\- broadcast channel (BCH)
\- MAC-c/sh/m, is the MAC entity that handles the following transport
channels:
\- paging channel (PCH)
\- forward access channel (FACH)
\- random access channel (RACH)
\- downlink shared channel (DSCH). The DSCH exists only in TDD mode.
\- uplink shared channel (USCH). The USCH exists only in TDD mode.
\- MAC-d is the MAC entity that handles the following transport channels:
\- dedicated transport channel (DCH)
\- MAC-hs/ehs is the MAC entity that handles the following transport channels:
\- high speed downlink shared channel (HS-DSCH)
> \- MAC-m is the MAC entity that handles the following transport channels:
\- forward access channel (FACH).
\- MAC-e/es and MAC-i/is are the MAC entities that handle the following
transport channels:
\- enhanced dedicated transport channel (E-DCH).
The exact functions completed by the entities are different in the UE from
those completed in the UTRAN.
NOTE: When a UE is allocated resources for exclusive use by the bearers that
it supports the MAC-d entities dynamically share the resources between the
bearers and are responsible for selecting the TFI/ TFCI that is to be used in
each transmission time interval.
### 4.2.2 MAC-b
The following diagram illustrates the connectivity of the MAC-b entity in a UE
and in each cell of the UTRAN.
MAC-b represents the control entity for the broadcast channel (BCH).
There is one (current cell) or multiple (current and neighbour cells) MAC-b
entities in each UE and one MAC-b in the UTRAN for each cell.
The MAC Control SAP is used to transfer Control information to MAC-b.
The MAC-b entity is located in the Node B.
Figure 4.2.2.1: UE side and UTRAN side architecture
### 4.2.3 Traffic Related Architecture - UE Side
Figure 4.2.3.1 illustrates the connectivity of MAC entities.
The MAC-c/sh/m controls access to all common transport channels, except the
HS-DSCH transport channel and the E-DCH transport channel (FDD and 1.28Mcps
TDD only).
The MAC-d controls access to all dedicated transport channels, to MAC-c/sh/m
and MAC-hs/ehs.
The MAC-c/sh/m controls access to MAC-is/i. (FDD and 1.28Mcps TDD only for UEs
in CELL_FACH state and Idle mode).
The MAC-hs/ehs handles the HSDPA specific functions and controls access to the
HS-DSCH transport channel. Upper layers configure which of the two entities,
MAC-hs or MAC-ehs, is to be applied to handle HS-DSCH functionality.
The MAC-e/es or MAC-i/is controls access to the E-DCH transport channel. Upper
layers configure which of the two entities, MAC-e/es or MAC-i/is, is to be
applied to handle E-DCH functionality.
In case of selective combining of MTCH channels from multiple cells, the MAC-m
controls access to the FACH transport channels used to carry MTCH and MSCH.
In the downlink, if logical channels of dedicated type are mapped to common
transport channels then MAC-d receives the data from MAC-c/sh/m or MAC-hs/ehs
via the illustrated connection between the functional entities.
In the downlink, if logical channels of common type are mapped to HS-DSCH then
MAC-c/sh/m receives the data from MAC-ehs via the illustrated connection
between the functional entities (FDD and 1.28 Mcps TDD only).
In the uplink, if logical channels of dedicated type are mapped to common
transport channels then MAC-d submits the data to MAC-c/sh/m and MAC-is/i via
the illustrated connection between the functional entities.
The mapping of logical channels on transport channels depends on the
multiplexing that is configured by RRC.
The MAC Control SAP is used to transfer Control information to each MAC
entity.
The associated signalling shown in the figure illustrates the exchange of
information between layer 1 and layer 2 provided by primitives shown in [3].
Figure 4.2.3.1: UE side MAC architecture
#### 4.2.3.1 MAC-c/sh/m entity -- UE Side
Figure 4.2.3.1.1 shows the UE side MAC-c/sh/m entity.
The following functionality is covered:
\- TCTF MUX:
\- this function represents the handling (insertion for uplink channels and
detection and deletion for downlink channels) of the TCTF field in the MAC
header, and the respective mapping between logical and transport channels.\
The TCTF field indicates the common logical channel type, or if a dedicated
logical channel is used;
\- add/read UE Id:
\- the UE Id is added for RACH transmissions;
\- the UE Id, when present, identifies data to this UE.
> \- read MBMS Id:
>
> \- the MBMS Id is read in case of MTCH reception;
\- the MBMS Id identifies received data to an MBMS service.
\- UL: TF selection:
\- in the uplink, the possibility of transport format selection exists.
\- ASC selection:
\- For RACH, MAC indicates the ASC associated with the PDU to the physical
layer. This is to ensure that RACH messages associated with a given Access
Service Class (ASC) are sent on the appropriate signature(s) and time slot(s).
MAC also applies the appropriate back-off parameter(s) associated with the
given ASC. When sending an RRC CONNECTION REQUEST message, RRC will determine
the ASC; in all other cases MAC selects the ASC;
\- scheduling /priority handling
\- this functionality is used to transmit the information received from MAC-d
on RACH based on logical channel priorities. This function is related to TF
selection.
\- TFC selection
\- transport format and transport format combination selection according to
the transport format combination set (or transport format combination subset)
configured by RRC is performed,
The RLC provides RLC-PDUs to the MAC, which fit into the available transport
blocks on the transport channels.
There is one MAC-c/sh/m entity in each UE.
Figure 4.2.3.1.1: UE side MAC architecture / MAC-c/sh/m details
4.2.3.1b MAC-m entity -- UE Side
Figure 4.2.3.1b.1 shows the UE side MAC-m entity.
The following functionality is covered:
> \- TCTF DEMUX:
>
> \- this function represents the handling (detection and deletion for
> downlink channels) of the TCTF field in the MAC header, and the respective
> mapping between logical and transport channels.\ The TCTF field indicates
> the common logical channel type;
>
> \- read MBMS Id
>
> \- the MBMS Id is read in case of MTCH reception;
>
> \- the MBMS Id identifies received data to an MBMS service.
The MAC Control SAP is used to transfer control information to MAC-m.
If MTCH channels are selectively combined, the MAC-m entity exists in the UE.
Otherwise, the MAC-m entity does not exist.
In case of selective combining of MTCH channels from multiple cells, there are
one MAC-c/sh/m for the current cell and one MAC-m entity for each neighboring
cell in the UE.
Figure 4.2.3.1b.1: UE side MAC architecture / MAC-m details
#### 4.2.3.2 MAC-d entity -- UE Side
Figure 4.2.3.2.1 shows the UE side MAC-d entity.
The following functionality is covered:
\- Transport Channel type switching
\- Transport Channel type switching is performed by this entity, based on
decision taken by RRC. This is related to a change of radio resources. If
requested by RRC, MAC shall switch the mapping of one designated logical
channel between common and dedicated transport channels.
\- C/T MUX:
\- The C/T MUX is used when multiplexing of several dedicated logical channels
onto one transport channel (other than HS-DSCH) or one MAC-d flow (HS-DSCH) is
used. An unambiguous identification of the logical channel is included. If
MAC-ehs is configured, C/T MUX toward MAC-ehs is not used.
\- Ciphering:
\- Ciphering for transparent mode data to be ciphered is performed in MAC-d.
Details about ciphering can be found in [10].
\- Deciphering:
\- Deciphering for ciphered transparent mode data is performed in MAC-d.
Details about ciphering can be found in [10].
\- UL TFC selection:
\- Transport format and transport format combination selection according to
the transport format combination set (or transport format combination subset)
configured by RRC is performed.
The MAC-d entity is responsible for mapping dedicated logical channels for the
uplink either onto dedicated transport channels or to transfer data to
MAC-c/sh/m to be transmitted via common channels.
One dedicated logical channel can be mapped simultaneously onto DCH and DSCH
in TDD mode.
One dedicated logical channel can be simultaneously mapped onto DCH and HS-
DSCH.
The MAC-d entity has a connection to the MAC-c/sh/m entity. This connection is
used to transfer data to the MAC-c/sh/m to transmit data on transport channels
that are handled by MAC-c/sh/m (uplink) or to receive data from transport
channels that are handled by MAC-c/sh/m (downlink).
The MAC-d entity has a connection to the MAC-hs or MAC-ehs entity. This
connection is used to receive data from the HS-DSCH transport channel which is
handled by MAC-hs or MAC-ehs (downlink).
The MAC-d entity has a connection to the MAC-e/es or MAC-i/is entity. This
connection is used to transmit data on the E-DCH transport channel which is
handled by the MAC-e/es or MAC-i/is (uplink).
There is one MAC-d entity in the UE.
Figure 4.2.3.2.1: UE side MAC architecture / MAC-d details
#### 4.2.3.3 MAC-hs entity -- UE Side
In the model below the MAC-hs comprises the following entities. In 1.28 Mcps
TDD multi-frequency HS-DSCH cell, the associated downlink control channel and
uplink control channel pair controlling the HS-DSCH transmission on the
certain carrier shall be allocated on the same carrier. The downlink control
channel carries the HS-DSCH operation related info and the uplink control
channel carries the feedback info from the UE side.
\- HARQ:\ The HARQ entity is responsible for handling the MAC functions
relating to the HARQ protocol. The HARQ functional entity handles all the
tasks that are required for hybrid ARQ. It is responsible for generating ACKs
or NACKs. The detailed configuration of the hybrid ARQ protocol is provided by
RRC over the MAC-Control SAP. In 1.28 Mcps TDD multi-frequency HS-DSCH cell,
multiple HARQ processes are assigned for HS-DSCH operaton on every carrier
independently, namely HARQ sub-entity; only one HARQ process is allowed to
receive HS-DSCH in one TTI for each carrier. The maximum number of HARQ
process per HS-DSCH per TTI on which an HS-DSCH transmission can be received
is one.
\- Reordering Queue distribution:\ The reordering queue distribution function
routes the MAC-hs PDUs to the correct reordering buffer based on the Queue
ID.For 1.28 Mcps TDD, the reordering queue distribution function discards the
MAC-hs PDU if the N field in MAC-hs header is zero.
\- Reordering:\ The reordering entity reorders received MAC-hs PDUs according
to the received TSN. MAC-hs PDUs with consecutive TSNs are delivered to the
disassembly function upon reception. MAC-hs PDUs are not delivered to the
disassembly function if MAC-hs PDUs with lower TSN are missing. There is one
reordering entity for each Queue ID configured at the UE.
\- Disassembly:\ The disassembly entity is responsible for the disassembly of
MAC-hs PDUs. When a MAC-hs PDU is disassembled the MAC-hs header is removed,
the MAC-d PDUs are extracted and any present padding bits are removed. Then
the MAC-d PDUs are delivered to higher layer.
The associated signalling shown in the figure illustrates the exchange of
information between layer 1 and layer 2 provided by primitives shown in [3].
Figure 4.2.3.3.1: UE side MAC architecture / MAC-hs details
Figure 4.2.3.3.2: UE side MAC architecture/MAC-hs details (1.28Mcps TDD multi-
frequency HS-DSCH operation mode only)
#### 4.2.3.4 MAC-e/es entity -- UE Side
The split between MAC-e and MAC-es in the UE is not detailed. In the model
below the MAC-e/es comprises the following entities:
\- HARQ:\ The HARQ entity is responsible for handling the MAC functions
relating to the HARQ protocol. It is responsible for storing MAC-e payloads
and re-transmitting them. The detailed configuration of the hybrid ARQ
protocol is provided by RRC over the MAC-Control SAP.
> \- For FDD: The HARQ entity provides the E-TFC, the retransmission sequence
> number (RSN), and the power offset to be used by L1. Redundancy version (RV)
> of the HARQ transmission is derived by L1 from RSN, CFN and in case of 2 ms
> TTI from the sub-frame number.
>
> \- For TDD: The HARQ entity provides the HARQ process identity, the E-TFC,
> the retransmission sequence number (RSN) and an indication of the power
> offset to be used by L1. The redundancy version (RV) of the HARQ
> transmission is derived by L1 from RSN. RRC signalling can also configure
> the L1 to use RV=0 for every transmission.
\- Multiplexing and TSN setting:\ The multiplexing and TSN setting entity is
responsible for concatenating multiple MAC-d PDUs into MAC-es PDUs, and to
multiplex one or multiple MAC-es PDUs into a single MAC-e PDU, to be
transmitted in the next TTI, as instructed by the E-TFC selection function. It
is also responsible for managing and setting the TSN per logical channel for
each MAC-es PDU.
\- E-TFC selection:\ This entity is responsible for E-TFC selection according
to the scheduling information, Relative Grants (FDD only) and Absolute Grants,
received from UTRAN via L1 and Serving Grant value signalled through RRC, and
for arbitration among the different flows mapped on the E-DCH. The detailed
configuration of the E-TFC entity is provided by RRC over the MAC-Control SAP.
The E-TFC selection function controls the multiplexing function.
\- Scheduling Access Control (TDD only):
> The Scheduling Access Control entity is responsible for routing associated
> uplink signalling via E-UCCH and MAC-e PDU (in the case that E-DCH resources
> are assigned) or via E-RUCCH (in the case that no E-DCH resources are
> assigned). It is also responsible for obtaining and formatting the
> appropriate information to be carried on E-UCCH/E-RUCCH.
>
> NOTE: HARQ process ID and RSN are carried on E-UCCH.
Figure 4.2.3.4.1a: UE side MAC architecture / MAC-e/es details (FDD)
Figure 4.2.3.4.1b: UE side MAC architecture / MAC-e/es details (TDD)
#### 4.2.3.5 MAC-ehs entity -- UE Side
In the model below the MAC-ehs comprise the following entities, In 1.28 Mcps
TDD multi-frequency HS-DSCH cell, the associated downlink control channel and
uplink control channel pair controlling the HS-DSCH transmission on the
certain carrier shall be allocated on the same carrier. The downlink control
channel carries the HS-DSCH operation related info and the uplink control
channel carries the feedback info from the UE side.
  * HARQ:\ The HARQ entity is responsible for handling the HARQ protocol. There shall be one HARQ process per HS-DSCH per TTI for single stream transmission, two HARQ processes per HS-DSCH per TTI for dual stream transmission, three HARQ processes per HS-DSCH per TTI for three stream transmission (FDD only) and four HARQ processes per HS-DSCH per TTI for four stream transmission (FDD only). There shall be one HARQ entity per HS-DSCH (FDD only). The HARQ functional entity handles all the tasks that are required for hybrid ARQ. It is for example responsible for generating ACKs or NACKs. The detailed configuration of the hybrid ARQ protocol is provided by RRC over the MAC-Control SAP.In 1.28 Mcps TDD multi-frequency HS-DSCH cell, multiple HARQ processes are assigned for HS-DSCH operaton on every carrier independently, namely HARQ sub-entity; only one HARQ process is allowed to receive HS-DSCH in one TTI for each carrier. The maximum number of HARQ process per HS-DSCH per TTI on which an HS-DSCH transmission can be received is one.
\- Disassembly
The disassembly entity disassembles the MAC-ehs PDUs by removing the MAC-ehs
header and possible padding. For 1.28 Mcps TDD, the disassembly entity
discards the MAC-ehs PDU if the L field in MAC-ehs header is zero.
\- Reordering queue distribution
The reordering queue distribution function routes the received reordering PDUs
to correct reordering queues based on the received logical channel identifier.
\- Reordering:\ The reordering entity organises received reordering PDUs
according to the received TSN. Data blocks with consecutive TSNs are delivered
to reassembly entity upon reception. A timer mechanism determines delivery of
non-consecutive data blocks to higher layers. There is one reordering entity
for each MAC-ehs Queue ID configured at the UE. For the logical channels BCCH
and PCCH no re-ordering is applied.
\- Reassembly:\ The reassembly entity reassembles segmented MAC-ehs SDUs
(corresponding to either MAC-c or MAC-d PDUs) and forwards the MAC PDUs to
LCH-ID demultiplexing entity.
\- LCH-ID demultiplexing:\ The demultiplexing entity routes the MAC-ehs SDUs
to correct logical channel based on the received logical channel identifier.
The following is allowed:
The MAC-ehs SDUs included in a MAC-ehs PDU can have a different size and a
different priority and can be mapped to different priority queues.
In case of Multiflow, there can be two MAC-ehs entities, if so configured by
upper layers.
Figure 4.2.3.5-1: UE side MAC architecture/MAC-ehs details.
Figure 4.2.3.5-2: UE side MAC architecture/MAC-ehs details (1.28Mcps TDD
multi-frequency HS-DSCH operation mode only)
#### 4.2.3.6 MAC-i/is entity -- UE Side
The split between MAC-i and MAC-is in the UE is not detailed. In the model
below the MAC-i/is comprises the following entities:
\- HARQ:\ The HARQ entity is responsible for handling the MAC functions
relating to the HARQ protocol. It is responsible for storing MAC-i payloads
and re-transmitting them. The detailed configuration of the hybrid ARQ
protocol is provided by RRC over the MAC-Control SAP.
\- For FDD: There shall be one HARQ entity per E-DCH. The HARQ entity provides
the E-TFC, the retransmission sequence number (RSN), and the power offset to
be used by L1. If uplink MIMO is configured by upper layers, then this
information is provided independently for the primary and secondary stream.
Redundancy version (RV) of the HARQ transmission is derived by L1 from RSN,
CFN and in case of 2 ms TTI from the sub-frame number.
\- For TDD: There shall be one HARQ entity per E-DCH for 1.28Mcps TDD. The
HARQ entity provides the HARQ process identity, the E-TFC, the retransmission
sequence number (RSN) and an indication of the power offset to be used by L1.
The redundancy version (RV) of the HARQ transmission is derived by L1 from
RSN. RRC signalling can also configure the L1 to use RV=0 for every
transmission.
\- Multiplexing and TSN setting:\ The multiplexing and TSN setting entity is
responsible for concatenating multiple MAC-d PDUs into MAC-is PDUs, and to
multiplex one or multiple MAC-is PDUs into a single MAC-i PDU, or, for FDD
when more than one uplink frequency or uplink MIMO is activated, one or two
MAC-i PDUs, to be transmitted in the next TTI, as instructed by the E-TFC
selection function, and for 1.28Mcps TDD when multi-carrier E-DCH operation is
activated, one or up to 6 MAC-i PDUs, to be transmitted in the next TTI, as
instructed by the E-TFC selection function. It is also responsible for
managing and setting the TSN per logical channel for each MAC-is PDU.\ In FDD
and 1.28 Mcps TDD, the multiplexing and TSN setting entity is responsible for
multiplexing MAC-c PDUs or segments of MAC-c PDUs into a single MAC-is PDU,
and for multiplexing MAC-is PDUs into a single MAC-i PDU, to be transmitted in
the next TTI, as instructed by the E-TFC selection function. It is also
responsible for managing and setting the TSN for the common control channel
for each MAC-is PDU.
\- Segmentation:\ The segmentation function is responsible for segmenting
MAC-d PDUs and MAC-c PDUs (FDD and 1.28 Mcps TDD only).
\- CRC Attachment (FDD and 1.28 Mcps TDD only):\ If segmentation is performed
for MAC-c PDUs, a CRC is appended to the MAC-c PDU and segmentation is then
performed for the entire MAC-c PDU including CRC. The size of the CRC field is
8 bits and the CRC is calculated as specified in section 4.2.1.1 in [16] or
[19]. In the CRC field, the generated parity bits, denoted as _p~im1~, p~im2~,
p~im3~, ..., p~im8~_ , shall be appended to the MAC-c PDU sequentially such
that _p~im1~_ is the leftmost bit and _p~im8~_ is the rightmost bit (see
Figure 9.1.5.4d).
\- Add UE ID (FDD only):\ In CELL_DCH state, no E-RNTI is included in the MAC-
PDU header.\ In CELL_FACH, the E-RNTI is added in all MAC-i PDUs for DCCH/DTCH
and NodeB triggered HS-DPCCH transmission at the UE side until the UE receives
an E-AGCH with its E-RNTI (through an E-RNTI-specific CRC attachment).\ In
CELL_FACH state and in Idle mode, no E-RNTI is added in MAC-i PDUs for CCCH
data transmission.
\- E-TFC selection:\ This entity is responsible for E-TFC selection according
to the scheduling information, Relative Grants (FDD only) and Absolute Grants,
transmission rank indication and offset received from UTRAN via L1 and Serving
Grant value signalled through RRC, and for arbitration among the different
flows mapped on the E-DCH. The detailed configuration of the E-TFC entity is
provided by RRC over the MAC-Control SAP. The E-TFC selection function
controls the multiplexing function.
\- ASC selection (FDD and 1.28 Mcps TDD only):\ At the start of the Enhanced
Uplink in CELL_FACH state and Idle mode, MAC-is/i applies the appropriate
back-off parameter(s) associated with the given ASC. When sending an RRC
CONNECTION REQUEST message, RRC will determine the ASC; in all other cases
MAC-is/i selects the ASC.
\- Scheduling Access Control (TDD only):
> The Scheduling Access Control entity is responsible for routing associated
> uplink signalling via E-UCCH and MAC-i PDU (in the case that E-DCH resources
> are assigned) or via E-RUCCH (in the case that no E-DCH resources are
> assigned). It is also responsible for obtaining and formatting the
> appropriate information to be carried on E-UCCH/E-RUCCH.
>
> NOTE: HARQ process ID and RSN are carried on E-UCCH.
{width="5.696527777777778in" height="4.271527777777778in"}
Figure 4.2.3.6-1: UE side MAC architecture / MAC-i/is details (FDD)
Figure 4.2.3.6-1a: UE side MAC architecture / MAC-i/is details (uplink MIMO is
configured, FDD)
Figure 4.2.3.6-2: UE side MAC architecture / MAC-i/is details (TDD)
Figure 4.2.3.6-2a：UE side MAC architecture/MAC-i/is details (1.28Mcps TDD
multi-carrier E-DCH carrier is configured)
### 4.2.4 Traffic Related Architecture - UTRAN Side
Figure 4.2.4.1 illustrates the connectivity between the MAC entities from the
UTRAN side.
It is similar to the UE case with the exception that there will be one MAC-d
for each UE and each UE (MAC-d) that is associated with a particular cell may
be associated with that cell\'s MAC-c/sh/m.
MAC-c/sh/m is located in the controlling RNC while MAC-d is located in the
serving RNC. MAC-hs/ehs is located in the Node B. The MAC-d PDUs to be
transmitted are transferred from MAC-c/sh/m to the MAC-hs/ehs via the Iub
interface in case of configuration with MAC-c/sh/m, or from the MAC-d via
Iur/Iub in case of configuration without MAC-c/sh/m.
For TDD, and for FDD in CELL_DCH, for each UE that uses E-DCH, one MAC-e or
MAC-i entity per Node-B and one MAC-es or MAC-is entity in the SRNC are
configured. MAC-e or MAC-i, located in the Node B, controls access to the
E-DCH and is connected to MAC-es or MAC-is, located in the SRNC. MAC-es or
MAC-is is further connected to MAC-d. There is one transport bearer set up per
E-DCH MAC-d flow.
For FDD and 1.28 Mcps TDD, for DTCH and DCCH transmission in CELL_FACH, for
each UE that uses E-DCH, one MAC-i entity per Node-B and one MAC-is entity in
the SRNC are configured. MAC-i, located in the Node B, controls access to the
E-DCH and is connected to MAC-is, located in the SRNC. MAC-is is further
connected to MAC-d.
For FDD, for CCCH transmission, for each UE that uses E-DCH, one MAC-i entity
per Node-B and one MAC-is entity in the CRNC are configured. MAC-i, located in
the Node B, controls access to the E-DCH and is connected to MAC-is in the
CRNC.
For 1.28 Mcps TDD, for CCCH transmission, for each UE that uses E-DCH, one
MAC-i entity per common E-RNTI in Node-B and one MAC-is entity in the CRNC are
configured. MAC-i, located in the Node B, controls access to the E-DCH and is
connected to MAC-is in the CRNC.
The MAC Control SAP is used to transfer Control information to each MAC entity
belonging to one UE.
The associated signalling shown in the figure illustrates the exchange of
information between layer 1 and layer 2 provided by primitives shown in [3].
Figure 4.2.4.1: UTRAN side MAC architecture
#### 4.2.4.1 MAC-c/sh/m entity -- UTRAN Side
Figure 4.2.4.1.1 shows the UTRAN side MAC-c/sh/m entity. The following
functionality is covered:
\- Scheduling -- Buffering -- Priority Handling;
\- this function manages FACH and for TDD DSCH resources between the UEs and
between data flows according to their priority and delay requirements set by
higher layers.
\- TCTF MUX
\- this function represents the handling (insertion for downlink channels and
detection and deletion for uplink channels) of the TCTF field in the MAC
header, and the respective mapping between logical and transport channels.\
The TCTF field indicates the common logical channel type, or if a dedicated
logical channel is used;
\- UE Id Mux;
\- for dedicated type logical channels, the UE Id field in the MAC header is
used to distinguish between UEs;
> \- MBMS Id Mux;
>
> \- for MTCH channels, the MBMS Id field in the MAC header is used to
> distinguish between MBMS services;
\- TFC selection:
\- in the downlink, transport format combination selection is done for FACH
and PCH and for TDD DSCHs;
\- Demultiplex;
\- for TDD operation the demultiplex function is used to separate USCH data
from different UEs, i.e. to be transferred to different MAC-d entities;
\- DL code allocation;
\- for TDD this function is used to indicate the code used on the DSCH;
\- Flow control;
\- a flow control function exists toward MAC-d to limit buffering between
MAC-d and MAC-c/sh/m entities. a flow control function also exists towards
MAC-hs/ehs in case of configuration with MAC-c/sh/m.
The RLC provides RLC-PDUs to the MAC, which fit into the available transport
blocks on the transport channels.
There is one MAC-c/sh/m entity in the UTRAN for each cell;
Figure 4.2.4.1.1: UTRAN side MAC architecture / MAC-c/sh/m details
#### 4.2.4.2 MAC-d entity -- UTRAN Side
Figure 4.2.4.2.1 shows the UTRAN side MAC-d entity.
The following functionality is covered:
\- Transport Channel type switching:
\- Transport Channel type switching is performed by this entity, based on
decision taken by RRC; this is related to a change of radio resources. If
requested by RRC, MAC shall switch the mapping of one designated logical
channel between common and dedicated transport channels.
\- C/T MUX box;
\- the function includes the C/T field when multiplexing of several dedicated
logical channels onto one transport channel (other than HS-DSCH) or one MAC-d
flow (HS-DSCH) is used. If MAC-ehs is configured, C/T MUX toward MAC-ehs is
not used.
\- LCH MUX box;
\- If MAC-ehs is configured, the LCH MUX function associates each block of
MAC-d PDUs of a logical channel with the related LCH-ID, regardless whether
one or several logical channels are multiplexed onto one MAC-d flow.
\- Priority setting;
\- This function is responsible for priority setting on data received from
DCCH / DTCH;
\- Ciphering;
\- Ciphering for transparent mode data to be ciphered is performed in MAC-d.
Details about ciphering can be found in [10].
\- Deciphering;
\- Deciphering for ciphered transparent mode data is performed in MAC-d.
Details about ciphering can be found in [10].
\- DL Scheduling/Priority handling;
\- in the downlink, scheduling and priority handling of transport channels is
performed within the allowed transport format combinations of the TFCS
assigned by the RRC.
\- Flow Control;
\- a flow control function exists toward MAC-c/sh/m to limit buffering between
MAC-d and MAC-c/sh/m entities. This function is intended to limit layer 2
signalling latency and reduce discarded and retransmitted data as a result of
FACH or for TDD DSCH congestion. For the Iur interface this is specified in
[11]. A flow control function also exists towards MAC-hs/ehs in case of
configuration without MAC-c/sh/m, see subclause 4.2.4.2.
A MAC-d entity using common channels other than the high speed downlink shared
channel is connected to a MAC-c/sh/m entity that handles the scheduling of the
common channels to which the UE is assigned and DL (FACH) priority
identification to MAC-c/sh/m;
A MAC-d entity using downlink shared channel is connected to a MAC-c/sh/m
entity that handles the shared channels to which the UE is assigned and
indicates the level of priority of each PDU to MAC-c/sh/m;
A MAC-d entity using the high speed downlink shared channel may be connected
to a MAC-c/sh/m entity that in turn is connected to the MAC-hs/ehs entity in
the Node B (configuration with MAC-c/sh/m); alternately, a MAC-d entity using
the high speed downlink shared channel may be connected to the MAC-hs/ehs
entity in the Node B in case of configuration without MAC-c/sh/m.
A MAC-d entity using the enhanced dedicated transport channel (Uplink only) is
connected to a MAC-es or MAC-is entity that handles the re-ordering and
combining of data received from different Node Bs. Given that the MAC-es or
MAC-is is collocated in the SRNC, it is not necessary to flow control this
connection. The MAC-es or MAC-is indicates the logical channel for which the
data is intended, to allow the MAC-d to route it appropriately.
A MAC-d entity is responsible for mapping dedicated logical channels onto the
available dedicated transport channels or routing the data received on a DCCH
or DTCH to MAC-c/sh/m or to MAC-hs/ehs.
One dedicated logical channel can be mapped simultaneously on DCH and DSCH in
TDD mode. Different scheduling mechanisms apply for DCH and DSCH. One
dedicated logical channel can be mapped simultaneously on DCH and HS-DSCH.
There is one MAC-d entity in the UTRAN for each UE that has one or more
dedicated logical channels to or from the UTRAN.
Figure 4.2.4.2.1: UTRAN side MAC architecture / MAC-d details
#### 4.2.4.3 MAC-hs entity -- UTRAN Side
There is one MAC-hs entity in the UTRAN for each cell that supports HS-DSCH
transmission. The MAC-hs is responsible for handling the data transmitted on
the HS-DSCH when configured by upper layers. Furthermore, when configured by
upper layers, it is responsible for the management of the physical resources
allocated to HSDPA. There should be priority handling per MAC-d PDU in the
MAC-hs. The MAC-hs is comprised of four different functional entities:
\- Flow Control:\ This is the companion flow control function to the flow
control function in the MAC-c/sh/m in case of configuration with MAC-c/sh/m
and MAC-d in case of configuration without MAC-c/sh/m. Both entities together
provide a controlled data flow between the MAC-c/sh/m and the MAC-hs
(Configuration with MAC-c/sh/m) or the MAC-d and MAC-hs (Configuration without
MAC-c/sh/m) taking the transmission capabilities of the air interface into
account in a dynamic manner. This function is intended to limit layer 2
signalling latency and reduce discarded and retransmitted data as a result of
HS-DSCH congestion. Flow control is provided independently by MAC-d flow for a
given MAC-hs entity.
\- Scheduling/Priority Handling:\ This function manages HS-DSCH resources
between HARQ entities and data flows according to their priority. Based on
status reports from associated uplink signalling either new transmission or
retransmission is determined. Further it determines the Queue ID and TSN for
each new MAC-hs PDU being serviced, and in the case of TDD the HCSN is
determined. A new transmission can be initiated instead of a pending
retransmission at any time to support the priority handling.
> In 1.28 Mcps TDD multi-frequency HS-DSCH cell:
  * multiple HARQ processes are assigned for HS-DSCH operaton on every carrier for every user, namely HARQ sub-entity; only one HARQ process in HARQ sub-entity is allowed to receive HS-DSCH in one TTI for each carrier.
  * choice of 6bit or 9bit TSN is configured by upper layer signalling
\- HARQ:\ One HARQ entity handles the hybrid ARQ functionality for one user.
One HARQ entity is capable of supporting multiple instances (HARQ process) of
stop and wait HARQ protocols. There shall be one HARQ process per HS-DSCH per
TTI. In 1.28 Mcps TDD multi-frequency HS-DSCH cell, multiple HARQ processes
are assigned independently for HS-DSCH operation on every carrier for every
user, namely HARQ sub-entity. Only one HARQ process in HARQ sub-entity is
allowed to receive HS-DSCH in one TTI for each carrier.
\- TFRC selection:\ Selection of an appropriate transport format and resource
for the data to be transmitted on HS-DSCH.
The associated signalling shown in the figure illustrates the exchange of
information between layer 1 and layer 2 provided by primitives shown in [3].
Figure 4.2.4.3.1: UTRAN side MAC architecture / MAC-hs details
Figure 4.2.4.3.2: UTRAN side MAC architecture/MAC-hs details (1.28Mcps TDD
multi-frequency HS-DSCH operation mode only)
#### 4.2.4.4 MAC-es entity -- UTRAN Side
For each UE, there is one MAC-es entity in the SRNC. When configured by the
upper layers, the MAC-es sublayer handles E-DCH specific functionality, which
is not covered in the MAC-e entity in Node B. In the model below, the MAC-es
comprises the following entities:
  * Reordering Queue Distribution:
> The reordering queue distribution function routes the MAC-es PDUs to the
> correct reordering buffer based on the SRNC configuration.
  * Reordering:
> This function reorders received MAC-es PDUs according to the received TSN
> and Node-B tagging i.e. (CFN, subframe number). MAC-es PDUs with consecutive
> TSNs are delivered to the disassembly function upon reception. Mechanisms
> for reordering MAC-es PDUs received out-of-order are left up to the
> implementation. There is one Re-ordering Process per logical channel.
  * Macro diversity selection (FDD only):
> The function is performed in the MAC-es, in case of soft handover with
> multiple Node-Bs (The soft combining for all the cells of a Node-B takes
> place in the Node-B). This means that the reordering function receives MAC-
> es PDUs from each Node-B in the E-DCH active set. The exact implementation
> is not specified. However the model below is based on one Reordering Queue
> Distribution entity receiving all the MAC-d flow from all the Node-Bs, and
> one MAC-es entity per UE.
  * Disassembly:
> The disassembly function is responsible for disassembly of MAC-es PDUs. When
> a MAC-es PDU is disassembled the MAC-es header is removed, the MAC-d PDU's
> are extracted and delivered to MAC-d.
Figure 4.2.4.4-1: UTRAN side MAC architecture / MAC-es details (SHO case, FDD
only)
Figure 4.2.4.4-1b: UTRAN side MAC architecture / MAC-es details (TDD)
#### 4.2.4.5 MAC-e entity -- UTRAN Side
There is one MAC-e entity in the Node B for each UE and one E-DCH scheduler
function in the Node-B. When configured by the upper layers the MAC-e and
E-DCH scheduler handle HSUPA specific functions in the Node B. In the model
below, the MAC-e and E-DCH scheduler comprises the following entities:
  * E-DCH Scheduling:
> This function manages E-DCH cell resources between UEs. Based on scheduling
> requests, Scheduling Grants are determined and transmitted. The general
> principles of the E-DCH scheduling are described in subclauses 11.8.2.3 and
> 11.9.2.3 below. However implementation is not specified (i.e. depends on RRM
> strategy).
  * E-DCH Control:
> The E-DCH control entity is responsible for reception of scheduling requests
> and transmission of Scheduling Grants. The general principles of the E-DCH
> schedulling are described in subclauses 11.8.2.3 and 11.9.2.3 below.
  * De-multiplexing:
> This function provides de-multiplexing of MAC-e PDUs. MAC-es PDUs are
> forwarded to the associated MAC-d flow.
  * HARQ:
> One HARQ entity is capable of supporting multiple instances (HARQ processes)
> of stop and wait HARQ protocols. Each process is responsible for generating
> ACKs or NACKs indicating delivery status of E-DCH transmissions. The HARQ
> entity handles all tasks that are required for the HARQ protocol.
The associated signalling shown in the figures illustrates the exchange of
information between layer 1 and layer 2 provided by primitives.
Figure 4.2.4.5-1a: UTRAN side MAC architecture / MAC-e details (FDD)
Figure 4.2.4.5-1b: UTRAN side MAC architecture / MAC-e details (TDD)
#### 4.2.4.6 MAC-ehs entity UTRAN Side
There is one MAC-ehs entity in the UTRAN for each cell that supports HS-DSCH
transmission. The same MAC-ehs entity may support HS-DSCH transmission in more
than one cell served by the same Node-B (FDD only). The MAC-ehs is responsible
for handling the data transmitted on the HS-DSCH when configured. There should
be priority handling per MAC-ehs SDU in the MAC-ehs. The MAC-ehs is comprised
of six different functional entities:
> \- Flow Control:\ The flow control for MAC-ehs is identical to the flow
> control for MAC-hs.
>
> \- Scheduling/Priority Handling:\ This function manages HS-DSCH resources
> between HARQ entities and data flows according to their priority class. In
> FDD and 1.28Mcps TDD, the scheduler determines for each TTI if single or
> dual stream transmission should be used. Based on status reports from
> associated uplink signalling either new transmission or retransmission is
> determined when operating in CELL_DCH state. In FDD, when operating in
> CELL_FACH, CELL_PCH and URA_PCH state HS-DSCH reception, the MAC-ehs can
> perform retransmission without uplink signalling. In 1.28 Mcps TDD, when
> operating in CELL_FACH, CELL_PCH and URA_PCH state and HS-DSCH reception
> without dedicated H-RNTI, the MAC-ehs can perform retransmission without
> uplink signalling. Further it sets the logical channel identifiers for each
> new reordering SDU and TSNs for each new reordering PDU being serviced. To
> maintain proper transmission priority a new transmission can be initiated on
> a HARQ process at any time. The TSN is unique to each MAC-ehs Queue ID
> within a HS-DSCH. It is not permitted to schedule new transmissions,
> including retransmissions originating in the RLC layer, along with
> retransmissions originating from the HARQ layer within the same TTI over the
> same HS-DSCH, and HARQ process (FDD only). It is not permitted to schedule
> new transmissions, including retransmissions originating in the RLC layer,
> along with retransmissions originating from the HARQ layer within the same
> TTI, and HARQ process (TDD only).
>
> \- HARQ:\ One HARQ entity handles the hybrid ARQ functionality for one user
> and per HS-DSCH transport channel (FDD only). One HARQ entity handles the
> hybrid ARQ functionality for one user (TDD only). One HARQ entity is capable
> of supporting multiple instances (HARQ process) of stop and wait HARQ
> protocols. There shall be one HARQ entity per HS-DSCH, one HARQ process per
> HS-DSCH per TTI for single stream transmission, two HARQ processes per HS-
> DSCH per TTI for dual stream transmission (FDD only), three HARQ processes
> per HS-DSCH per TTI for three stream transmission (FDD only)and four HARQ
> processes per HS-DSCH per TTI for four stream transmission (FDD only). There
> shall be one HARQ process per TTI for single stream transmission and two
> HARQ processes per TTI for dual stream transmission (TDD only).
>
> In 1.28 Mcps TDD multi-frequency HS-DSCH cell:
  * multiple HARQ processes are assigned for HS-DSCH operaton on every carrier for every user, namely HARQ sub-entity; only one HARQ process in HARQ sub-entity is allowed to receive HS-DSCH in one TTI for each carrier.
  * choice of 6bit or 9bit TSN is configured by upper layer signalling.
\- TFRC selection:\ The TFRC selection for MAC-ehs is identical to the TFRC
selection of the MAC-hs. In case of three stream transmission, the MAC-ehs PDU
belonging to the second stream and the MAC-ehs PDU belonging to the third
stream should be of equal size. In case of four stream transmission, the MAC-
ehs PDU belonging to the first stream and the MAC-ehs PDU belonging to the
fourth stream should be of equal size, the MAC-ehs PDU belonging to the second
stream and the MAC-ehs PDU belonging to the third stream should be of equal
size.
  * Priority Queue MUX:\ This function determinates the number of octets to be included in a MAC-ehs PDU from each priority queue based on the scheduling decision and available TFRC for this function.
> \- Segmentation:\ This function performs necessary segmentation of MAC-ehs
> SDUs.
The following is allowed:
The MAC-ehs SDUs included in a MAC-ehs PDU can have a different size and a
different priority and can be mapped to different logical channels.
The associated signalling shown in the figure illustrates the exchange of
information between layer 1 and layer 2 provided by primitives shown in [3].
Figure 4.2.4.6-1: UTRAN side MAC architecture / MAC-ehs details
Figure 4.2.4.6-2: UTRAN side MAC architecture/MAC-ehs details (1.28Mcps TDD
multi-frequency HS-DSCH operation mode only)
#### 4.2.4.7 MAC-is entity -- UTRAN Side
For TDD, and for FDD in CELL_DCH and CELL_FACH, for each UE, there is one MAC-
is entity in the SRNC. For FDD, for CCCH transmission in CELL_FACH state and
Idle mode, there is one MAC-is entity per common E-DCH resource configured in
the controlling RNC. For 1.28 Mcps TDD, for CCCH transmission in CELL_FACH
state and Idle mode, there is one MAC-is entity per UE in the controlling RNC.
When configured by the upper layers. the MAC-is sublayer handles E-DCH
specific functionality, which is not covered in the MAC-i entity in Node B. In
the model below, the MAC-is comprises the following entities:
> \- Disassembly:
>
> The disassembly function is responsible for disassembly of MAC-is PDUs. When
> a MAC-is PDU is disassembled the MAC-is header is removed.
>
> \- Reordering Queue Distribution:
>
> For DCCH and DTCH transmission, the reordering queue distribution function
> routes the MAC-is PDUs to the correct reordering buffer based on the SRNC
> configuration.
>
> \- Reordering:
>
> This function reorders received MAC-is PDUs according to the received TSN
> and Node-B tagging i.e. (CFN, subframe number). MAC-is PDUs with consecutive
> TSNs are delivered to the disassembly function upon reception. Mechanisms
> for reordering MAC-is PDUs received out-of-order are left up to the
> implementation. There is one Re-ordering Process per logical channel.
\- Macro diversity selection (FDD only):
> The function is performed in the MAC-is, in case of soft handover with
> multiple Node-Bs (The soft combining for all the cells of a Node-B takes
> place in the Node-B). This means that the reordering function receives MAC-
> is PDUs from each Node-B in the E-DCH active set and in the Secondary E-DCH
> Active Set. The exact implementation is not specified. However the model
> below is based on one Reordering Queue Distribution entity receiving all the
> MAC-d flow from all the Node-Bs, and one MAC-is entity per UE.
\- Reassembly:
> For DTCH/DCCH transmission, the reassembly function reassembles segmented
> MAC-d PDUs, and delivers the MAC-d PDUs to the correct MAC-d entity. For
> CCCH transmission, the reassembly function reassembles segmented MAC-c PDUs,
> and delivers it to the CRC Error Detection function.
  * CRC Error Detection (FDD and 1.28 Mcps TDD only):
> When the MAC-c PDU is received correctly after reassembly is performed for
> CCCH, then the CRC field is removed and the resulting data is delivered to
> the MAC-c. However, if a MAC-c PDU has been received with an incorrect CRC,
> the MAC-c PDU is discarded. The size of the CRC field is 8 bits and the CRC
> is calculated as specified in section 4.2.1.1 in [16] or [19].
{width="4.868055555555555in" height="4.71875in"}
Figure 4.2.4.7-1: UTRAN side MAC architecture / MAC-is details for DCCH/DTCH
transmission (SHO case, FDD only)
{width="5.1305555555555555in" height="4.831944444444445in"}
Figure 4.2.4.7-1a: UTRAN side MAC architecture / MAC-is details for 2
configured uplink frequencies (for DTCH and DCCH transmission, SHO case, FDD
only)
{width="4.863888888888889in" height="4.725in"}
Figure 4.2.4.7-2: UTRAN side MAC architecture / MAC-is details (TDD)
{width="3.1118055555555557in" height="4.278472222222222in"}
Figure 4.2.4.7-3: UTRAN side MAC architecture / MAC-is details (for CCCH
transmission, FDD and 1.28 Mcps TDD only)
#### 4.2.4.8 MAC-i entity -- UTRAN Side
For TDD, and for FDD in CELL_DCH, there is one MAC-i entity in the Node B for
each UE. For FDD, there is one MAC-i entity in the Node B for each common
E-DCH resource. For 1.28 Mcps TDD in CELL-FACH state, there is one MAC-i
entity in the Node B for each UE with dedicated E-RNTI, and one MAC-i entity
in the Node B for each common E-RNTI. And there is one E-DCH scheduler
function in the Node-B. When configured by the upper layers, the MAC-i and
E-DCH scheduler handle HSUPA specific functions in the Node B. In the model
below, the MAC-i and E-DCH scheduler comprises the following entities:
> \- E-DCH Scheduling:
>
> This function manages E-DCH cell resources between UEs. Based on scheduling
> requests, Scheduling Grants are determined and transmitted. The general
> principles of the E-DCH scheduling are described in subclauses 11.8.2.3 and
> 11.9.2.3 below. However implementation is not specified (i.e. depends on RRM
> strategy).
>
> \- E-DCH Control:
>
> The E-DCH control entity is responsible for reception of scheduling requests
> and transmission of Scheduling Grants. In FDD, for UEs in CELL_FACH state
> and Idle mode, the E-DCH control entity is additionally responsible for
> collision resolution and common E-DCH resource release by transmitting
> Scheduling Grants. The general principles of the E-DCH schedulling are
> described in subclauses 11.8.2.3 and 11.9.2.3 below.
>
> \- De-multiplexing:
>
> This function provides de-multiplexing of MAC-i PDUs per E-DCH. For
> DTCH/DCCH transmission, MAC-is PDUs are forwarded to the associated MAC-d
> flow. For CCCH transmission (FDD and 1.28 Mcps TDD only), MAC-is PDUs are
> forwarded to the associated UL Common MAC flow.
  * Read UE id (FDD only):
> In CELL_DCH state, no UE ID is included in the MAC-PDU header.\ In
> CELL_FACH, the E-RNTI is added in all MAC-i PDUs for DTCH/DCCH and NodeB
> triggered HS-DPCCH transmission at the UE side until the UE receives an
> E-AGCH with its E-RNTI (through an E-RNTI-specific CRC attachment).\ In
> CELL_FACH state and in Idle mode, CCCH data can be transmitted only as no
> E-RNTI has been added in the MAC-i PDU for transmission from the UE.
>
> \- HARQ:
>
> One HARQ entity is capable of supporting multiple instances (HARQ processes)
> of stop and wait HARQ protocols. Each process is responsible for generating
> ACKs or NACKs indicating delivery status of E-DCH transmissions. The HARQ
> entity handles all tasks that are required for the HARQ protocol. For FDD,
> there shall be one HARQ entity per E-DCH. For 1.28 Mcps TDD multi-carrier
> E-DCH operation, there is one HARQ entity per E-DCH transport channel.
The associated signalling shown in the figures illustrates the exchange of
information between layer 1 and layer 2 provided by primitives.
{width="5.480555555555555in" height="4.219444444444444in"}
Figure 4.2.4.8-1: UTRAN side MAC architecture / MAC-i details (FDD)
Figure 4.2.4.8-2: UTRAN side MAC architecture / MAC-i details (TDD)
Figure 4.2.4.8-2a: UTRAN side MAC architecture / MAC-i details for muliti-
carrier E-DCH operation (for 1.28Mcps TDD)
## 4.3 Channel structure
The MAC operates on the channels defined below; the transport channels are
described between MAC and Layer 1, the logical channels are described between
MAC and RLC.
The following subclauses provide an overview, the normative description can be
found in [2] and [3] respectively.
### 4.3.1 Transport channels
Common transport channel types are:
\- Random Access Channel(s) (RACH);
\- Forward Access Channel(s) (FACH);
\- Downlink Shared Channel(s) (DSCH), for TDD operation only;
\- High Speed Downlink Shared Channel(s) (HS-DSCH);
\- Uplink Shared Channel(s) (USCH), for TDD operation only;
\- Broadcast Channel (BCH);
\- Paging Channel (PCH);
\- Enhanced Dedicated Channel (E-DCH) for UL operation only (FDD and 1.28 Mcps
TDD only).
Dedicated transport channel types are:
  * Dedicated Channel (DCH);
\- Enhanced Dedicated Channel (E-DCH) for UL operation only.
### 4.3.2 Logical Channels
The MAC layer provides data transfer services on logical channels. A set of
logical channel types is defined for different kinds of data transfer services
as offered by MAC.
Each logical channel type is defined by what type of information is
transferred.
#### 4.3.2.1 Logical channel structure
The configuration of logical channel types is depicted in figure 4.3.2.1.
Figure 4.3.2.1: Logical channel structure
#### 4.3.2.2 Control Channels
Following control channels are used for transfer of control plane information
only:
\- Broadcast Control Channel (BCCH);
\- Paging Control Channel (PCCH);
\- Common Control Channel (CCCH);
\- Dedicated Control Channel (DCCH);
> \- Shared Channel Control Channel (SHCCH);
>
> \- MBMS point-to-multipoint Control Channel (MCCH);
>
> \- MBMS point-to-multipoint Scheduling Channel (MSCH)
#### 4.3.2.3 Traffic Channels
Following traffic channels are used for the transfer of user plane information
only:
\- Dedicated Traffic Channel (DTCH);
\- Common Traffic Channel (CTCH);
\- MBMS point-to-multipoint Traffic Channel (MTCH).
# 5 Services provided to upper layers
This clause describes the different services provided by the MAC to higher
layers. For a detailed description of the following functions see [2].
## 5.1 Description of Services provided to upper layers
\- Data transfer: This service provides unacknowledged transfer of MAC SDUs
between peer MAC entities without data segmentation.
\- Reallocation of radio resources and MAC parameters: This service performs
on request of RRC execution of radio resource reallocation and change of MAC
parameters.
\- Reporting of measurements: Local measurements are reported to RRC.
# 6 Functions
## 6.1 Description of the MAC functions
The functions of MAC include:
\- mapping between logical channels and transport channels;
\- selection of appropriate Transport Format for each Transport Channel
depending on instantaneous source rate;
\- priority handling between data flows of one UE;
\- priority handling between UEs by means of dynamic scheduling;
\- identification of UEs on common transport channels;
\- identification of MBMS services on common transport channels;
\- multiplexing/demultiplexing of upper layer PDUs into/from transport blocks
delivered to/from the physical layer on common transport channels;
\- multiplexing/demultiplexing of upper layer PDUs into/from transport block
sets delivered to/from the physical layer on dedicated transport channels;
\- segmentation and reassembly of upper layer PDUs
\- traffic volume measurement;
\- Transport Channel type switching;
\- ciphering for transparent mode RLC;
\- Access Service Class selection for RACH transmission;
\- control of HS-DSCH transmission and reception including support of HARQ;
> \- HS-DSCH Provided Bit Rate measurement;
\- control of E-DCH transmission and reception including support of HARQ;
\- generation of uplink scheduling information to assist with E-DCH resource
allocation;
\- E-DCH Provided Bit-rate measurement.
## 6.2 Relation between MAC Functions and Transport Channels
### 6.2.1 Relation between MAC Functions and Transport Channels in UTRAN
Table 6.2.1.1: UTRAN MAC functions corresponding to the transport channel
Associated  
MAC  
Functions | Logical  
Ch | Trans  
port  
Ch | TF  
Selection | Priority handling between UEs | Priority handling (one UE) | Scheduling | Identification of UEs or MBMS services | Mux/  
Demux on common transport channels | Mux/  
Demux on dedicated transport channels | HARQ support | Segmentation | CRC detection  
---|---|---|---|---|---|---|---|---|---|---|---|---  
Uplink (Rx) | 
> CCCH
| RACH |  |  |  |  |  | X |  |  |  |   
|
> CCCH
| E-DCH |  |  |  |  |  | X |  | X | X | X  
|
> DCCH
| RACH |  |  |  |  | X | X |  |  |  |   
|
> DCCH
| DCH |  |  |  |  |  |  | X |  |  |   
|
> DTCH
| RACH |  |  |  |  | X | X |  |  |  |   
|
> DTCH
| DCH |  |  |  |  |  |  | X |  |  |   
|
> SHCCH
| RACH |  |  |  |  | X | X |  |  |  |   
|
> SHCCH
| USCH |  |  |  |  |  | X |  |  |  |   
|
> DTCH
| USCH |  |  |  |  |  | X |  |  |  |   
|
> DCCH
| USCH |  |  |  |  |  | X |  |  |  |   
|
> DTCH
| E-DCH |  |  |  | X |  |  | X | X | X |   
|
> DCCH
| E-DCH |  |  |  | X |  |  | X | X | X |   
Downlink (Tx) | 
> BCCH
| BCH |  |  |  | X |  |  |  |  |  |   
|
> BCCH
| FACH | X |  |  | X |  | X |  |  |  |   
|
> BCCH
| HS-DSCH | X (1) |  |  | X |  | X |  | X | (2) |   
|
> PCCH
| PCH | X |  |  | X |  |  |  |  |  |   
|
> PCCH
| HS-DSCH | X (1) |  |  | X |  | X |  | X | (2) |   
|
> CCCH
| FACH | X | X |  | X |  | X |  |  |  |   
|
> CCCH
| HS-DSCH | X (1) |  |  | X |  | X |  | X | X |   
|
> CTCH
| FACH | X |  |  | X |  | X |  |  |  |   
|
> MCCH
| FACH | X |  |  | X |  | X |  |  |  |   
|
> MSCH
| FACH | X |  |  | X |  | X |  |  |  |   
|
> MTCH
| FACH | X |  |  | X | X | X |  |  |  |   
|
> CTCH
| FACH | X |  |  | X |  | X |  |  |  |   
|
> DCCH
| FACH | X | X |  | X | X | X |  |  |  |   
|
> DCCH
| DSCH | X | X |  |  | X | X |  |  |  |   
|
> DCCH
| DCH | X |  | X |  |  |  | X |  |  |   
|
> DCCH
| HS-DSCH | X (1) | X | X | X | X | X |  | X | X |   
|
> DTCH
| FACH | X | X |  | X | X | X |  |  |  |   
|
> DTCH
| DSCH | X | X |  |  | X | X |  |  |  |   
|
> DTCH
| DCH | X |  | X |  |  |  | X |  |  |   
|
> DTCH
| HS-DSCH | X (1) | X | X | X | X | X |  | X | X |   
|
> SHCCH
| FACH | X | X |  | X |  | X |  |  |  |   
|
> SHCCH
| DSCH | X | X |  |  |  | X |  |  |  |   
NOTE 1: In case of HS-DSCH the TF selection is replaced by TFRC selection.
NOTE 2: The UTRAN should not perform MAC-ehs segmentation for MAC-ehs SDUs
from BCCH and PCCH logical channels.
### 6.2.2 Relation of MAC Functions and Transport Channels in UE
Table 6.2.2.1: UE MAC functions corresponding to the transport channel
Associated  
MAC  
Functions | Logical Ch | Transport Ch | TF Selection | Priority handling (one UE) | Identification | Mux/Demux on common transport channels | Mux/Demux on dedicated transport channels | HARQ support | Segmentation | CRC attechment  
---|---|---|---|---|---|---|---|---|---|---  
Uplink (Tx) | CCCH | RACH |  |  |  | X |  |  |  |   
| CCCH | E-DCH | X |  |  | X |  | X | X | X  
| DCCH | RACH | X | X | X | X |  |  |  |   
| DCCH | DCH | X | X |  |  | X |  |  |   
| DTCH | RACH | X | X | X | X |  |  |  |   
| DTCH | DCH | X | X |  |  | X |  |  |   
| SHCCH | RACH |  |  |  | X |  |  |  |   
| SHCCH | USCH | X | X |  | X |  |  |  |   
| DCCH | USCH | X | X |  | X |  |  |  |   
| DTCH | USCH | X | X |  | X |  |  |  |   
| DCCH | E-DCH | X | X |  |  | X | X | X |   
| DTCH | E-DCH | X | X |  |  | X | X | X |   
Downlink (Rx) | BCCH | BCH |  |  |  |  |  |  |  |   
| BCCH | FACH |  |  |  | X |  |  |  |   
| BCCH | HS-DSCH |  |  |  | X |  | X |  |   
| PCCH | PCH |  |  |  |  |  |  |  |   
| PCCH | HS-DSCH |  |  |  | X |  | X |  |   
| CCCH | FACH |  |  |  | X |  |  |  |   
| CCCH | HS-DSCH |  |  |  | X |  | X | X |   
| CTCH | FACH |  |  |  | X |  |  |  |   
| MCCH | FACH |  |  |  | X |  |  |  |   
| MSCH | FACH |  |  |  | X |  |  |  |   
| MTCH | FACH |  |  | X | X |  |  |  |   
| DCCH | FACH |  |  | X | X |  |  |  |   
| DCCH | DSCH |  |  |  | X |  |  |  |   
| DCCH | DCH |  |  |  |  | X |  |  |   
| DCCH | HS-DSCH |  |  | X | X |  | X | X |   
| DTCH | FACH |  |  | X | X |  |  |  |   
| DTCH | DSCH |  |  |  | X |  |  |  |   
| DTCH | DCH |  |  |  |  | X |  |  |   
| DTCH | HS-DSCH |  |  | X | X |  | X | X |   
| SHCCH | FACH |  |  |  | X |  |  |  |   
| SHCCH | DSCH |  |  |  | X |  |  |  |   
# 7 Services expected from physical layer
The physical layer offers information transfer services to MAC. For detailed
description, see [3].
# 8 Elements for layer-to-layer communication
The interaction between the MAC layer and other layers are described in terms
of primitives where the primitives represent the logical exchange of
information and control between the MAC layer and other layers. The primitives
shall not specify or constrain implementations. The MAC is connected to layer
1, RLC and RRC. The following subclauses describe the primitives between these
layers.
## 8.1 Primitives between layers 1 and 2
### 8.1.1 Primitives
The primitives are described in [3].
### 8.1.2 Parameters
a) Transport Format Resource Indicator (TFRI) for HS-DSCH:
> \- For HS-DSCH the Transport Block size is derived from the TFRI value
> signalled on the HS-SCCH. The mapping between TFRI value and Transport Block
> size is specified in subclause 9.2.3.
b) HARQ information for E-DCH:
\- ACK/NACK information (details specified in subclause 9.2.5.1).
\- RSN information (details specified in subclause 9.2.5.1).
\- Power offset (details specified in subclauses 11.8.1.4 and 11.9.1.4).
\- E-TFCI (details specified in subclauses 11.8.1.4 and 11.9.1.4).
c) Relative Grant information for E-DCH (FDD only):
\- Serving Relative Grant information (details specified in subclause
9.2.5.2.1).
\- Non-serving Relative Grant information (details specified in subclause
9.2.5.2.1).
d) Absolute Grant information for E-DCH (details specified in subclause
9.2.5.2.2 for FDD and in 9.2.6.2.1 for TDD).
> \- Identity Type for E-DCH (FDD only).
>
> \- Absolute Grant Value.
>
> \- Absolute Grant Scope (FDD only).
>
> \- Absolute Grant Code Resource (TDD only)
>
> \- Absolute Grant Timeslot Resource (TDD only)
>
> \- Absolute Grant Resource Duration (TDD only)
>
> \- E-HICH Indicator (1.28 Mcps TDD only)
>
> \- E-UCCH Number Indicator (1.28 Mcps TDD only)
e) Happy Bit (FDD only, details specified in subclause 9.2.5.2.2).
f) Synchronization Command ( 1.28 Mcps TDD only, details specified in
subclause 11.6.3.1).
## 8.2 Primitives between MAC and RLC
### 8.2.1 Primitives
The primitives between MAC layer and RLC layer are shown in table 8.2.1.1.
Table 8.2.1.1: Primitives between MAC layer and RLC layer
+--------------+--------------+--------------+--------------+---------+ | Generic Name | Parameter | | | | +--------------+--------------+--------------+--------------+---------+ | | Request | Indication | Response | Confirm | +--------------+--------------+--------------+--------------+---------+ | MAC-DATA | Data, BO, | Data, | | | | | UE-ID type | No_TB, | | | | | indicator, | | | | | | RLC Entity | TD (note), | | | | | Info | Error | | | | | | indication | | | +--------------+--------------+--------------+--------------+---------+ | MAC-STATUS | | No_PDU, | BO, | | | | | PDU_Size, | | | | | | TX status | RLC Entity | | | | | | Info | | +--------------+--------------+--------------+--------------+---------+ | NOTE: TDD | | | | | | only. | | | | | +--------------+--------------+--------------+--------------+---------+
MAC-DATA-Req/Ind:
\- MAC-DATA-Req primitive is used to request that an upper layer PDU be sent
using the procedures for the information transfer service;
\- MAC-DATA-Ind primitive indicates the arrival of upper layer PDUs received
within one transmission time interval by means of the information transfer
service.
MAC-STATUS-Ind/Resp:
\- MAC-STATUS-Ind primitive indicates to RLC for each logical channel the rate
at which it may transfer data to MAC. Parameters are the number of PDUs that
can be transferred in each transmission time interval and the PDU size; it is
possible that MAC would use this primitive to indicate that it expects the
current buffer occupancy of the addressed logical channel in order to provide
for optimised TFC selection on transport channels with long transmission time
interval. At the UE, MAC-STATUS-Ind primitive is also used to indicate from
MAC to RLC that MAC has requested data transmission by PHY (i.e. PHY-DATA-REQ
has been submitted, see Fig. 11.2.2.1), or that transmission of an RLC PDU on
RACH or that the common E-DCH resource acquisition of Enhanced Uplink in
CELL_FACH state or Idle mode has failed due to exceeded preamble ramping cycle
counter.
\- MAC-STATUS-Resp primitive enables RLC to acknowledge a MAC-STATUS-Ind. It
is possible that RLC would use this primitive to indicate that it has nothing
to send or that it is in a suspended state or to indicate the current buffer
occupancy to MAC.
### 8.2.2 Parameters
a) Data:
\- it contains the RLC layer messages (RLC-PDU) to be transmitted, or the RLC
layer messages that have been received by the MAC sub-layer.
b) Number of transmitted transport blocks (No_TB) :
\- indicates the number of transport blocks transmitted by the peer entity
within the transmission time interval, based on the TFI value.
c) Buffer Occupancy (BO):
\- the parameter Buffer Occupancy (BO) indicates for each logical channel the
amount of data in number of bytes that is available for transmission and
retransmission in RLC layer. When MAC is connected to an AM RLC entity,
control PDUs to be transmitted and RLC PDUs outside the RLC Tx window shall
also be included in the BO. RLC PDUs that have been transmitted but not
negatively acknowledged by the peer entity shall not be included in the BO.
d) RX Timing Deviation (TD), TDD only:
\- it contains the RX Timing Deviation as measured by the physical layer for
the physical resources carrying the data of the Message Unit. This parameter
is optional and only for Indication. It is needed for the transfer of the RX
Timing Deviation measurement of RACH transmissions carrying CCCH data to RRC.
e) Number of PDU (No_PDU):
\- specifies the number of PDUs that the RLC is permitted to transfer to MAC
within a transmission time interval.
f) PDU Size (PDU_Size):
\- specifies the size of PDU that can be transferred to MAC within a
transmission time interval.
g) UE-ID Type Indicator:
\- indicates the UE-ID type to be included in MAC for a DCCH and DTCH when
they are mapped onto a common transport channel (i.e. FACH, RACH in FDD). On
the UE side UE-ID Type Indicator shall always be set to C-RNTI.
h) TX status:
\- when set to value \"transmission unsuccessful\" this parameter indicates to
RLC that transmission of an RLC PDU failed in the previous Transmission Time
Interval, when set to value \"transmission successful\" this parameter
indicates to RLC that the requested RLC PDU(s) has been submitted for
transmission by the physical layer.
i) RLC Entity Info
\- indicates to MAC the configuration parameters that are critical to TFC
selection depending on its mode and the amount of data that could be
transmitted at the next TTI. This primitive is meant to insure that MAC can
perform TFC selection (see subclause 11.4).
j) Error indication
\- When a MAC SDU is delivered to upper layer, an error indication is given
for the SDU to upper layer if an error indication for the SDU has been
received from lower layer.
k) (Void)
## 8.3 Primitives between MAC and RRC
### 8.3.1 Primitives
The primitives between MAC and RRC are shown in table 8.3.1.1.
Table 8.3.1.1: Primitives between MAC sub-layer and RRC
+---------------+---------------+---------------+----------+---------+ | Generic Name | Parameter | | | | +---------------+---------------+---------------+----------+---------+ | | Request | Indication | Response | Confirm | +---------------+---------------+---------------+----------+---------+ | CMAC-CONFIG | UE | | | | | | information | | | | | | elements, | | | | | | | | | | | | RB | | | | | | information | | | | | | elements, | | | | | | | | | | | | TrCH | | | | | | information | | | | | | elements, | | | | | | | | | | | | RACH | | | | | | transmission | | | | | | control | | | | | | elements, | | | | | | | | | | | | Ciphering | | | | | | elements, | | | | | | | | | | | | MBMS | | | | | | information | | | | | | elements, | | | | | | | | | | | | E-DCH | | | | | | configuration | | | | | | elements, | | | | | | | | | | | | Idle interval | | | | | | information | | | | | | elements (TDD | | | | | | only) | | | | +---------------+---------------+---------------+----------+---------+ | CMA | Measurement | Measurement | | | | C-MEASUREMENT | information | result | | | | | elements | | | | +---------------+---------------+---------------+----------+---------+ | CMAC-STATUS | Cell | Status info, | | | | | Res | | | | | | election(1.28 | E-DCH | | | | | Mcps TDD | resource | | | | | only) | index, | | | | | | Enhanced | | | | | | Uplink in | | | | | | CELL_FACH | | | | | | and Idle mode | | | | | | process | | | | | | termination, | | | | | | | | | | | | E-RUCCH | | | | | | failure(only | | | | | | for 1.28Mcps | | | | | | TDD), | | | | | | | | | | | | Cell | | | | | | Reselection | | | | | | Indication | | | | | | process | | | | | | termination | | | | | | (1.28 Mcps | | | | | | TDD only), | | | | | | Fallback | | | | | | transmission | | | | | | initiation | | | | | | (FDD only), | | | | | | Fallback | | | | | | transmission | | | | | | termination | | | | | | (FDD only) | | | +---------------+---------------+---------------+----------+---------+
CMAC-CONFIG-Req:
\- CMAC-CONFIG-Req is used to request for setup, release and configuration of
a logical channel, e.g. RNTI allocation, switching the connection between
logical channels and transport channels, TFCS update or scheduling priority of
logical channel.
CMAC-MEASUREMENT-Req/Ind:
\- CMAC-MEASUREMENT-Req is used by RRC to request MAC to perform measurements,
e.g. traffic volume measurements;
\- CMAC-MEASUREMENT-Ind is used to notify RRC of the measurement result.
**CMAC-STATUS-Req:**
\- CMAC-STATUS-Req primitive notifies MAC of status information.
CMAC-STATUS-Ind:
\- CMAC-STATUS-Ind primitive notifies RRC of status information, Fallback
transmission initiation and Fallback transmission termination.
### 8.3.2 Parameters
See [7] for a detailed description of the UE, RB and TrCH information
elements.
a) UE information elements\ S-RNTI\ SRNC identity\ C-RNTI\ Activation time\
Primary E-RNTI configured per Configured Uplink Frequency\ Secondary E-RNTI
configured per Configured Uplink Frequency (for FDD only)
b) RB information elements\ RB multiplexing info (Transport channel identity,
Logical channel identity, MAC logical channel priority)\ DDI mapping table for
E-DCH transmission\ Indication whether the Logical channel is considered when
the Scheduling Information is generated
c) TrCH information elements\ Transport Format Combination Set\ MAC-hs/ehs
reset indicator\ MAC-es/e/i/is reset indicator\ Re-ordering release timer
(T1)\ HARQ Profile parameters (power offset, maximum number of re-
transmissions and for 1.28 Mcps TDD retransmission timer)\ E-DCH TTI duration
(FDD only)\ Allowed combinations for multiplexing of MAC-d flows into MAC-e
PDUs or MAC-i PDUs\ E-DCH grant type of MAC-d flows (scheduled or non-
scheduled)\ List of HARQ processes on which non-scheduled grants are allowed
(for FDD only, this is if the grant type is non-scheduled and the E-DCH TTI
duration is 2ms) in the Primary Uplink Frequency.\ TSN field extension for
MAC-ehs entity (for FDD only)\ TSN field extension for MAC-i/is entity (for
FDD and 1.28Mcps TDD only)
d) Measurement information elements\ Reporting Quantity identifiers\ Time
interval to take an average or a variance (applicable when Average or Variance
is Reporting Quantity) CELL_DCH measurement occasion info LCR.
e) Measurement result\ Reporting Quantity
f) Status info\ when set to value \"transmission unsuccessful\" this parameter
indicates to RRC that transmission of a TM RLC PDU failed (due to e.g. Maximum
number of preamble ramping cycles reached for RACH in FDD), when set to value
\"transmission successful\" this parameter indicates to RRC that the requested
TM RLC PDU(s) has been submitted for transmission by the physical layer.
g) RACH transmission control\ Set of ASC parameters (identifier for PRACH
partitions, persistence values)\ Maximum number of preamble ramping cycles
(FDD) or synchronisation attempts (1.28 Mcps TDD) M~max\ ~Minimum and maximum
number of time units between two preamble ramping cycles, N~BO1min~ and
N~BO1max~ (FDD only)\ ASC for RRC CONNECTION REQUEST message
> Type of random access procedure (1.28 Mcps only)\ Enhanced Uplink in
> CELL_FACH and Idle mode support indicator (FDD and 1.28 Mcps TDD only)
h) Ciphering elements\ Ciphering mode\ Ciphering key\ Ciphering sequence
number
i) (Void)
j) MBMS information elements\ MBMS Id
> k) E-DCH configuration elements\ E-DPCCH to DPCCH power offset (FDD only)\
> Happy bit delay condition (FDD only)\ E-TFCI table index\ minimum set E-TFCI
> per Configured Uplink Frequency (FDD only)\ Reference E-TFCI (FDD only)\
> Periodicities for Scheduling Information with and without grant (FDD only)\
> The code, timeslots and maximum power available per TDD resource unit per
> slot in TTIs designated for non-scheduled use by a given UE (TDD only)\ The
> frames designated for non-scheduled use by a given UE (specified by means of
> a start frame number, repetition period and repetition length) (3.84/7.68
> Mcps TDD only)
>
> The subframes designated for non-scheduled use by a given UE (specified by
> means of a start subframe number, repetition period and repetition length)
> (1.28 Mcps TDD only)\ Scheduling Information power offset\ List of HARQ
> processes on which scheduled grants are allowed per Configured Uplink
> Frequency (for FDD only, this is if the E-DCH TTI duration is 2ms)\ List of
> HARQ processes on which grants are allowed (FDD only in CELL_FACH state and
> Idle mode, this is if the E-DCH TTI duration is 2ms)
>
> Initial Serving Grant value and type (FDD only)\ E-DCH maximum and minimum
> allowed coderates (TDD only)
>
> A table of paired values, each pair consists of code rate and β normative
> value (TDD only).
>
> Parameters controlling E-RUCCH operation, such as T-RUCCH, T-SCHED, and a
> set of persistence values (one for each ASC) associated with E-RUCCH
> (3.84/7.68 Mcps TDD only)\ Symbol offset S~offset~ (FDD only in CELL_FACH
> state and Idle mode)\ Cell offset C~offset~ (FDD only in CELL_FACH state and
> Idle mode)\ Additional E-DCH transmission back off (FDD only in CELL_FACH
> state or Idle mode)\ E-DCH transmission continuation back off (FDD only in
> CELL_FACH state or Idle mode)\ HS-DPCCH transmission continuation back off
> (FDD only in CELL_FACH state)\ Maximum period for collision resolution phase
> (FDD only in CELL_FACH state and Idle mode)\ Maximum E-DCH resource
> allocation for CCCH (FDD only in CELL_FACH state and Idle mode)\ Minimum
> Serving Grant (FDD only in CELL_FACH state)\ Parameters controlling E-RUCCH
> operation, such as T-RUCCH, N-RUCCH, T-WAIT, T-SI associated with E-RUCCH,
> the carrier on which the E-RUCCH is transmitted for multi-carrier E-DCH
> operation (1.28 Mcps TDD only)\ Common E-RNTIs list for CCCH transmission
> (1.28 Mcps TDD only in CELL_FACH state and Idle mode)\ Parameters for
> carrier groups and the related carrier information (1.28Mcps TDD only in
> multi-carrier E-DCH operation)\ Minimum transport block size for rank2
> transmission\ CCCH Fallback (FDD only)\ DCCH Fallback (FDD only)
>
> l) DTX-DRX and HS-SCCH less Information Elements (FDD only)
>
> MAC DTX Cycle\ MAC Inactivity Threshold\ UE DTX DRX Offset\ HS-SCCH less
> mode of operation\ Inactivity Threshold for UE Grant Monitoring\ Inactivity
> Threshold for UE DTX cycle 2\ Default SG in DTX Cycle 2
>
> m) E-DCH resource index (FDD only).
>
> n) Enhanced Uplink in CELL_FACH and Idle mode process termination (FDD only)
>
> o) Cell Reselection Indication process termination (1.28 Mcps TDD only)
p) E-RUCCH failure(only for 1.28Mcps TDD)
q) HS-DSCH/E-DCH SPS Information Elements (1.28 Mcps TDD only)
HS-DSCH SPS operation\ E-DCH SPS operation
r) Idle interval information elements (TDD only)
Idle interval period\ Idle interval offset
> s) Cell Reselection (1.28 Mcps TDD only)
>
> t) MIMO operation (1.28 Mcps TDD only)
u) Fallback transmission termination (FDD only)
v) Fallback transmission initiation (FDD only)
# 9 Elements for peer-to-peer communication
## 9.1 Protocol data units
### 9.1.1 General
A MAC PDU is a bit string, with a length not necessarily a multiple of 8 bits.
In the drawings in clause 9.1, bit strings are represented by tables in which
the first bit is the leftmost one on the first line of the table, the last bit
is the rightmost on the last line of the table, and more generally the bit
string is to be read from left to right and then in the reading order of the
lines.
Depending on the provided service, MAC SDUs are bit strings with any non-null
length, or bit strings with an integer number of octets in length. An SDU is
included into a MAC PDU from first bit onward.
In the UE for the uplink, all MAC PDUs delivered to the physical layer within
one TTI are defined as Transport Block Set (TBS). It consists of one or
several Transport Blocks, each containing one MAC PDU. The Transport Blocks,
shall be transmitted in the order as delivered from RLC. When multiplexing of
RLC PDUs from different logical channels is performed on MAC, the order of all
Transport Blocks originating from the same logical channel shall be the same
as the order of the sequence delivered from RLC. The order of the different
logical channels in a TBS is set by the MAC protocol.
### 9.1.2 MAC PDU (not HS-DSCH or E-DCH)
A MAC PDU consists of an optional MAC header and a MAC Service Data Unit (MAC
SDU), see figure 9.1.2.1. Both the MAC header and the MAC SDU are of variable
size.
The content and the size of the MAC header depends on the type of the logical
channel, and in some cases none of the parameters in the MAC header are
needed.
The size of the MAC-SDU depends on the size of the RLC-PDU, which is defined
during the setup procedure.
Figure 9.1.2.1: MAC PDU
### 9.1.3 MAC-d PDU (HS-DSCH)
For HS-DSCH the MAC-d PDU format equals the MAC PDU format for the non HS-DSCH
case.
### 9.1.4 MAC PDU (HS-DSCH)
There are two different MAC PDU formats for HS-DSCH. Depending on
configuration by higher layers the format is either MAC-hs or MAC-ehs. The MAC
PDU format is determined by upper layer signalling [7].
When MAC-hs is configured, a MAC PDU for HS-DSCH consists of one MAC-hs header
and one or more MAC-hs SDUs where each MAC-hs SDU equals a MAC-d PDU. A
maximum of one MAC-hs PDU can be transmitted in a TTI per UE. The MAC-hs
header is of variable size. The MAC-hs SDUs in one TTI belongs to the same
reordering queue. If the UE receives successive MAC-hs SDUs of the same size
in the MAC-hs PDU, represented by multiple (SID, N) combinations, the UE
behaviour is not specified. In 1.28 Mcps TDD multi-frequency HS-DSCH cell, TSN
can be extended to 9bit as indicated by RRC signalling. When TSN is extended
to 9bit, the 3 least significant bits are placed after the last MAC-hs SDU.
Figure 9.1.4.1: MAC-hs PDU
When MAC-ehs is configured, a MAC PDU for HS-DSCH consists of one MAC-ehs
header and one or more reordering PDUs. Each reordering PDU consists of one or
more reordering SDUs belonging to the same priority queue. All reordering SDUs
belonging to the same priority queue in one TTI shall be mapped to the same
reordering PDU. Each reordering SDU equals a complete MAC-ehs SDU or a segment
of a MAC-ehs SDU. Each MAC-ehs SDU equals a MAC-d PDU or a MAC-c PDU (FDD and
1.28 Mcps TDD only). The LCH-ID and L fields are repeated per reordering SDU.
The TSN and SI fields are repeated per reordering PDU. In 1.28 Mcps TDD multi-
frequency HS-DSCH cell, TSN can be extended to 9bit as indicated by RRC
signalling. When TSN is extended to 9bit, the 3 least significant bits are
placed after the last reordering PDU. If several TSNs is included in MAC-ehs
header, the extented bits of TSN should be concatenated in the same order as
that of the TSN occurrrence in the MAC-ehs header. For FDD, the size of the
TSN field is configurable by upper layers [7].
The presence of the TSN~i~ and SI~i~ fields is based on the value of the LCH-
ID~i~; if the LCH-ID~i~ is mapped to the same reordering queue as LCH-ID~i-1~
or if the value of LCH-ID~i-1~ is equal to the value of LCH-ID~i~, there is no
TSN~i~ or SI~i~ field. The mapping of the LCH-ID to the reordering queue is
provided by upper layers [7], except for BCCH or PCCH where no reordering is
applied. The TSN~1~ and SI~1~ fields are always present. For BCCH or PCCH the
TSN field, if present, is always set to zero, the SI field, if present, is
always set to \'00\' and the TSN and SI fields shall be ignored by the
receiver.
Depending on the HS-DSCH physical layer category, the maximum number of MAC-
ehs PDUs that can be transmitted in a TTI per UE is one or two per HS-DSCH
transport channel.
The reordering SDUs in one TTI can belong to different priority queues. The
MAC-ehs header is of variable size.
The UE behaviour is unspecified, if any of the following conditions are met
when Multiflow is not configured or when intra-Node B Multiflow is configured:
\- if reordering SDUs in one TTI belong to more than 3 priority queues,
\- if the TSN field extension for MAC-ehs entity is not configured and MAC-ehs
PDU(s) received during one TTI contain more than 26 reordering SDUs, or,
\- if the TSN field extension for MAC-ehs entity is configured and
\- up to 3 secondary serving HS-DSCH cells are configured and MAC-ehs PDU(s)
received during one TTI contain more than 44 reordering SDUs; or
\- more than 3 secondary serving HS-DSCH cells are configured and MAC-ehs
PDU(s) received during one TTI contain more than 64 reordering SDUs.
The UE behaviour is unspecified, if any of the following conditions are met
for each of the MAC-ehs entities when inter-Node B Multiflow is configured:
\- if reordering SDUs in one TTI belong to more than 2 priority queues,
\- if MIMO is not configured for this MAC-ehs entity and
\- if one HS-DSCH cell is configured for this MAC-ehs entity and MAC-ehs
PDU(s) received during one TTI contain more than 16 reordering SDUs, or,
\- if more than one HS-DSCH cell is configured for this MAC-ehs entity and
MAC-ehs PDU(s) received during one TTI contain more than 26 reordering SDUs,
or,
\- if MIMO is configured for this MAC-ehs entity and
\- MAC-ehs PDU(s) received during one TTI contain more than 26 reordering
SDUs.
Figure 9.1.4.2: MAC-ehs PDU
Figure 9.1.4.3: MAC-hs PDU (1.28Mcps TDD multi-frequency HS-DSCH operation
mode only)
Figure 9.1.4.4: MAC-ehs PDU (1.28Mcps TDD multi-frequency HS-DSCH operation
mode only)
### 9.1.5 MAC PDU (E-DCH)
There are two different MAC PDU formats for E-DCH. Depending on configuration
by upper layers the format is either MAC-e/es or MAC-i/is. The MAC PDU format
is determined by upper layer signalling [7].
When MAC-e/es is configured, there are two MAC sublayers, MAC-e and MAC-es.
MAC-es sits on top of MAC-e and receives PDUs directly from MAC-d. MAC-es SDUs
(i.e. MAC-d PDUs) of the same size, coming from a particular logical channel
are multiplexed together into a single MAC-es payload. There is one and only
one MAC-es PDU per logical channel per TTI (since only one MAC-d PDU size is
allowed per logical channel per TTI). To this payload is prepended the MAC-es
header (see subclause 9.2.4.1). The number of PDUs, as well as the one DDI
value identifying the logical channel, the MAC-d flow and the MAC-es SDU size
are included as part of the MAC-e header. In case sufficient space is left in
the E-DCH transport block or if Scheduling Information needs to be
transmitted, an SI will be included at the end of the MAC-e PDU (see subclause
9.2.4.2). Multiple MAC-es PDUs from multiple logical channels, but only one
MAC-e PDU can be transmitted in a TTI.
In the example MAC-e PDU shown in figure 9.1.5.2a, the field DDI~0~ is
referring to the specific DDI value that indicates that there is an SI
included in the MAC-e PDU (see subclause 9.2.4.2). This header will not be
associated with a new MAC-es payload. Figure 9.1.5.2b shows the MAC-e PDU
format when SI is sent alone. In this case DDI~0~ is not included in the MAC-e
PDU and E-TFCI value 0 is used.
Figure 9.1.5.1 MAC-es PDU
Figure 9.1.5.2a: MAC-e PDU
Figure 9.1.5.2b: MAC-e PDU (SI is sent alone)
When MAC-i/is is configured, there are two MAC sublayers, MAC-i and MAC-is.
MAC-is sits on top of MAC-i and receives PDUs directly from MAC-d and MAC-c
(FDD and 1.28 Mcps TDD only). When MAC-i/is is configured, a MAC PDU for E-DCH
consists of one MAC-i header and one or more MAC-is PDUs. Each MAC-is PDU
consists of one or more MAC-is SDUs belonging to the same logical channel.
Each MAC-is SDU equals a complete or a segment of a MAC-d PDU or a MAC-c PDU
(FDD and 1.28 Mcps TDD only). The MAC-is SDUs can have different sizes. The
LCH-ID and L fields are repeated per MAC-is SDU (see subclause 9.2.4.4). The
TSN and SS fields are repeated per MAC-is PDU (see subclause 9.2.4.3).
Multiple MAC-is PDUs from multiple logical channels, but only one MAC-i PDU
can be transmitted in a TTI per E-DCH. In case sufficient space is left in the
E-DCH transport block or if Scheduling Information needs to be transmitted, an
SI will be included at the end of the MAC-i PDU (see Figure 9.1.5.4a and
subclause 11.8.1.6 and subclause 11.9.1.5). For 1.28Mcps TDD multi-carrier
E-DCH operation with more than one carrier group(defined in subclause 9.2.6.3)
configured by high layer ,the sufficient space is more than 33 bits in the
E-DCH transport block or if Scheduling Information needs to be transmitted, an
extend SI (see Figure 9.2.6.3.-1a) will be included at the end of the MAC-i
PDU(see Figure 9.1.5.4a and subclause 11.9.1.5), and if the sufficient space
is more than 23 bits and less than 33 bits or only one carrier group is
configured by high layer, the legacy SI(see Figure 9.2.6.3.-1) will be
included at the end of MAC-i PDU(see Figure 9.1.5.4a and subclause 11.9.1.5).
For FDD and in CELL_FACH state only, the UE's E-RNTI can be included in the
MAC-i header. Its inclusion is signalled with a reserved LCH-ID value.
Figure 9.1.5.3 MAC-is PDU.
Figure 9.1.5.4a: MAC-i PDU.
Figure 9.1.5.4b: MAC-i PDU (SI is sent alone)
Figure 9.1.5.4c: MAC-i header part for E-RNTI transmission (FDD only)
Figure 9.1.5.4c-1: MAC-i PDU (SI is sent alone before contention resolution)
(FDD only)
Figure 9.1.5.4d: MAC-c PDU with CRC for CCCH transmissions (FDD and 1.28
McpsTDD only)
## 9.2 Formats and parameters
NOTE: MAC header field encodings as specified in this clause with designation
\"Reserved\" are forbidden to be used by a sender in this version of the
protocol.
### 9.2.1 MAC PDU: Parameters of the MAC PDU header (not HS-DSCH or E-DCH) and
MAC-d PDU header (HS-DSCH and E-DCH)
The following fields are defined for the MAC header for transport channels
other than HS-DSCH and for the MAC-d PDU header for HS-DSCH:
\- Target Channel Type Field\ The TCTF field is a flag that provides
identification of the logical channel class on FACH, USCH (TDD only), DSCH
(TDD only) and RACH transport channels, i.e. whether it carries BCCH, CCCH,
CTCH, SHCCH, MCCH, MTCH, MSCH or dedicated logical channel information. The
size and coding of TCTF for FDD and TDD are shown in tables 9.2.1.1, 9.2.1.2,
9.2.1.3, 9.2.1.4 and 9.2.1.5. Note that the size of the TCTF field of FACH for
FDD is 2,4 or 8 bits and for TDD is either 3 or 5 bits depending on the value
of the 3 most significant bits. The TCTF of the RACH for TDD is either 2 or 4
bits depending on the value of the 2 most significant bits. Note that for 3.84
Mcps TDD IMB MBSFN the size and coding of the TCTF field follows the
definition in Table 9.2.1.2, i.e. as per the coding for TCTF on FACH for FDD.
Table 9.2.1.1: Coding of the Target Channel Type Field on FACH for TDD
+----------------+----------------------------------------------------+ | TCTF | Designation | +----------------+----------------------------------------------------+ | 000 | BCCH | +----------------+----------------------------------------------------+ | 001 | CCCH | +----------------+----------------------------------------------------+ | 010 | CTCH | +----------------+----------------------------------------------------+ | 01100 | DCCH or DTCH | | | | | | over FACH | +----------------+----------------------------------------------------+ | 01101 | MCCH | +----------------+----------------------------------------------------+ | 01110 | MTCH | +----------------+----------------------------------------------------+ | []{.underline} | MSCH | | | | | 01111 | | +----------------+----------------------------------------------------+ | 100 | SHCCH | +----------------+----------------------------------------------------+ | 101-111 | Reserved | | | | | | (PDUs with this coding will be discarded by this | | | version of the protocol) | +----------------+----------------------------------------------------+
Table 9.2.1.2: Coding of the Target Channel Type Field on FACH for FDD
+-------------------+-------------------------------------------------+ | TCTF | Designation | +-------------------+-------------------------------------------------+ | 00 | BCCH | +-------------------+-------------------------------------------------+ | 01000000 | CCCH | +-------------------+-------------------------------------------------+ | 01000001-01001111 | Reserved | | | | | | (PDUs with this coding will be discarded by | | | this version of the protocol) | +-------------------+-------------------------------------------------+ | 01010000 | MCCH | +-------------------+-------------------------------------------------+ | 01010001-01011110 | Reserved | | | | | | (PDUs with this coding will be discarded by | | | this version of the protocol) | +-------------------+-------------------------------------------------+ | 01011111 | MSCH | +-------------------+-------------------------------------------------+ | 0110 | MTCH | +-------------------+-------------------------------------------------+ | 0111 | Reserved | | | | | | (PDUs with this coding will be discarded by | | | this version of the protocol) | +-------------------+-------------------------------------------------+ | 10000000 | CTCH | +-------------------+-------------------------------------------------+ | 10000001- | Reserved | | | | | 10111111 | (PDUs with this coding will be discarded by | | | this version of the protocol) | +-------------------+-------------------------------------------------+ | 11 | DCCH or DTCH | | | | | | over FACH | +-------------------+-------------------------------------------------+
Table 9.2.1.3: Coding of the Target Channel Type Field on USCH or DSCH (TDD
only)
* * *
TCTF Designation 0 SHCCH 1 DCCH or DTCH over USCH or DSCH
* * *
Table 9.2.1.4: Coding of the Target Channel Type Field on RACH for FDD
+-------+-------------------------------------------------------------+ | TCTF | Designation | +-------+-------------------------------------------------------------+ | 00 | CCCH | +-------+-------------------------------------------------------------+ | 01 | DCCH or DTCH | | | | | | over RACH | +-------+-------------------------------------------------------------+ | 10-11 | Reserved | | | | | | (PDUs with this coding will be discarded by this version of | | | the protocol) | +-------+-------------------------------------------------------------+
Table 9.2.1.5: Coding of the Target Channel Type Field on RACH for TDD
+-------+-------------------------------------------------------------+ | TCTF | Designation | +-------+-------------------------------------------------------------+ | 00 | CCCH | +-------+-------------------------------------------------------------+ | 0100 | DCCH or DTCH | | | | | | Over RACH | +-------+-------------------------------------------------------------+ | 0101- | Reserved | | | | | 0111 | (PDUs with this coding will be discarded by this version of | | | the protocol) | +-------+-------------------------------------------------------------+ | 10 | SHCCH | +-------+-------------------------------------------------------------+ | 11 | Reserved | | | | | | (PDUs with this coding will be discarded by this version of | | | the protocol) | +-------+-------------------------------------------------------------+
\- C/T field\ The C/T field provides identification of the logical channel
instance when multiple logical channels are carried on the same transport
channel (other than HS-DSCH) or same MAC-d flow (HS-DSCH). The C/T field is
used also to provide identification of the logical channel type on dedicated
transport channels and on FACH and RACH when used for user data transmission.
The size of the C/T field is fixed to 4 bits for both common transport
channels and dedicated transport channels. Table 9.2.1.5a shows the 4-bit C/T
field.
Table 9.2.1.5a: Structure of the C/T field
+-----------+---------------------------------------------------------+ | C/T field | Designation | +-----------+---------------------------------------------------------+ | 0000 | Logical channel 1 | +-----------+---------------------------------------------------------+ | 0001 | Logical channel 2 | +-----------+---------------------------------------------------------+ | ... | ... | +-----------+---------------------------------------------------------+ | 1110 | Logical channel 15 | +-----------+---------------------------------------------------------+ | 1111 | Reserved | | | | | | (PDUs with this coding will be discarded by this | | | version of the protocol) | +-----------+---------------------------------------------------------+
\- UE-Id\ The UE-Id field provides an identifier of the UE on common transport
channels. The following types of UE-Id used on MAC are defined:
\- UTRAN Radio Network Temporary Identity (U-RNTI) may be used in the MAC
header of DCCH using RLC UM (SRB1), when mapped onto common transport channels
in downlink direction; the U-RNTI is never used in uplink direction;
\- Cell Radio Network Temporary Identity (C-RNTI) is used on DTCH and DCCH in
uplink, and may be used on DCCH in downlink and is used on DTCH in downlink
when mapped onto common transport channels, except when mapped onto DSCH
transport channel in TDD;
Table 9.2.1.6: Lengths of UE Id field
* * *
UE Id type Length of UE Id field U-RNTI 32 bits C-RNTI 16 bits
* * *
\- UE-Id Type\ The UE-Id Type field is needed to ensure correct decoding of
the UE-Id field in MAC Headers.
Table 9.2.1.7: UE-Id Type field definition
+-------------------------+-------------------------------------------+ | UE-Id Type field 2 bits | UE-Id Type | +-------------------------+-------------------------------------------+ | 00 | U-RNTI | +-------------------------+-------------------------------------------+ | 01 | C-RNTI | +-------------------------+-------------------------------------------+ | 10 | Reserved | | | | | | (PDUs with this coding will be discarded | | | by this version of the protocol) | +-------------------------+-------------------------------------------+ | 11 | Reserved | | | | | | (PDUs with this coding will be discarded | | | by this version of the protocol) | +-------------------------+-------------------------------------------+
  * MBMS-Id\ The MBMS-Id field provides an identifier of MTCH for an MBMS service carried on FACH. The MBMS-Id is used in the MAC header of MTCH mapped onto FACH in downlink direction; the MBMS-Id is never used in uplink direction. The MBMS Id to be used by MAC is configured through the MAC control SAP. The length of the MBMS-Id field is 4 bits. Table 9.2.1.7a shows the 4-bit MBMS-Id field.
Table 9.2.1.8: Structure of the MBMS-Id field
+-------------------+-------------------------------------------------+ | **MBMS-Id field** | **MBMS logical channel identity [7]** | +-------------------+-------------------------------------------------+ | 0000 | 1 | +-------------------+-------------------------------------------------+ | 0001 | 2 | +-------------------+-------------------------------------------------+ | ... | ... | +-------------------+-------------------------------------------------+ | 1110 | 15 | +-------------------+-------------------------------------------------+ | 1111 | Reserved | | | | | | (PDUs with this coding will be discarded by | | | this version of the protocol) | +-------------------+-------------------------------------------------+
#### 9.2.1.1 MAC header for DTCH and DCCH (not mapped on HS-DSCH or E-DCH)
a) DTCH or DCCH mapped to DCH, no multiplexing of dedicated channels on MAC:
\- no MAC header is required.
b) DTCH or DCCH mapped to DCH, with multiplexing of dedicated channels on MAC:
\- C/T field is included in MAC header.
c) DTCH or DCCH mapped to RACH/FACH:
\- TCTF field, C/T field, UE-Id type field and UE-Id are included in the MAC
header. For FACH, the UE-Id type field used is the C-RNTI or U-RNTI. For RACH,
the UE-Id type field used is the C-RNTI.
d) DTCH or DCCH mapped to DSCH or USCH:
\- the TCTF field is included in the MAC header. The C/T field is included if
multiplexing on MAC is applied.
e) DTCH or DCCH mapped to DSCH or USCH where DTCH or DCCH are the only logical
channels:
\- The C/T field is included in the MAC header if multiplexing on MAC is
applied.
Figure 9.2.1.1.1: MAC PDU formats for DTCH and DCCH
#### 9.2.1.1a MAC-d Header for DTCH and DCCH (mapped on HS-DSCH)
In CELL_DCH state, the MAC-d PDU header for DTCH and DCCH mapped on HS-DSCH is
as shown in figure 9.2.1.1a.1.
\- C/T field is included in the MAC-d PDU header if multiplexing on MAC is
applied.
\- If MAC-ehs is configured by upper layers [7], no MAC-d PDU header is
required.
Figure 9.2.1.1a.1 MAC-d PDU format for DTCH and DCCH mapped on HS-DSCH
#### 9.2.1.1b MAC-d Header for DTCH and DCCH (mapped on E-DCH)
For DTCH and DCCH mapped on E-DCH there is no need for a MAC-d header.
Therefore, the MAC-d PDU is as shown in figure 9.2.1.1b.1.
Figure 9.2.1.1b.1 MAC-d PDU format for DTCH and DCCH mapped on E-DCH
#### 9.2.1.1c MAC-d or MAC-c headers for DTCH and DCCH (mapped on HS-DSCH, FDD
and 1.28 Mcps TDD only)
In FDD and 1.28 Mcps TDD, the MAC-c/MAC-d PDU header for DTCH and DCCH mapped
on HS-DSCH CELL_FACH, CELL_PCH state is as shown in figure 9.2.1.1c-1.
\- there is no MAC-d header included for DTCH and DCCH.
\- there is no MAC-c header included for DTCH and DCCH when UE dedicated
H-RNTI is used.
\- the U-RNTI is only included as MAC-c header to MAC-d PDU for DCCH (SRB#1
only)when common H-RNTI is used
Figure 9.2.1.1c-1: MAC-d/MAC-c PDU format for DTCH and DCCH mapped on HS-DSCH
(FDD and 1.28 McpsTDD only)
#### 9.2.1.2 MAC header for BCCH
a) BCCH mapped to BCH:
\- no MAC header is included.
b) BCCH mapped to FACH:
\- the TCTF field is included in MAC header.
c) in FDD and 1.28 Mcps TDD, when BCCH mapped to HS-DSCH
\- the MAC-ehs header is included.
Figure 9.2.1.2.1: MAC PDU formats for BCCH
#### 9.2.1.3 MAC header for PCCH
There is no MAC header for PCCH when mapped on PCH.
In FDD and 1.28 Mcps TDD when PCCH is mapped on HS-DSCH:
\- the MAC-ehs header is included as depicted in Figure 9.2.1.3-1.
Figure 9.2.1.3-1: MAC PDU format for PCCH (FDD and 1.28 Mcps TDD only)
#### 9.2.1.4 MAC header for CCCH
CCCH mapped to RACH/FACH:
\- TCTF field is included in MAC header.
In FDD and 1.28 Mcps TDD, CCCH mapped to HS-DSCH and to E-DCH:
\- no MAC-c header is included.
Figure 9.2.1.4-1: MAC PDU format for CCCH mapped to RACH/FACH
Figure 9.2.1.4-2: MAC-c PDU format for CCCH mapped to HS-DSCH or E-DCH (FDD
and 1.28 Mcps TDD only)
#### 9.2.1.5 MAC Header for CTCH
The TCTF field is included as MAC header for CTCH as shown in figure
9.2.1.5.1.
Figure 9.2.1.5.1: MAC PDU format for CTCH
#### 9.2.1.6 MAC Header for SHCCH
The MAC header for SHCCH is as shown in figure 9.2.1.6.1.
a) SHCCH mapped to RACH and USCH/FACH and DSCH:
\- TCTF has to be included.
b) SHCCH mapped to RACH and USCH/FACH and DSCH, where SHCCH is the only
channel.
{width="4.667361111111111in" height="0.8236111111111111in"}
Figure 9.2.1.6.1: MAC PDU format for SHCCH
9.2.1.7 MAC Header for MCCH
The MAC PDU format for MCCH is as shown in figure 9.2.1.7.1.
> a) If the MAC header for MCCH is not configured through the MAC control SAP:
>
> \- there is no MAC header for MCCH.
>
> b) If the MAC header for MCCH is configured through the MAC control SAP:
>
> \- TCTF field is included in the MAC header for MCCH.
NOTE: If MCCH is not the only channel on the FACH, the MAC header shall be
configured for the MCCH.
{width="4.552083333333333in" height="0.84375in"}
Figure 9.2.1.7.1: MAC PDU format for MCCH
9.2.1.8 MAC Header for MTCH
The TCTF field and MBMS-Id field are included in the MAC header for MTCH as
shown in figure 9.2.1.8.1.
Figure 9.2.1.8.1: MAC PDU format for MTCH
9.2.1.9 MAC Header for MSCH
The MAC PDU format for MSCH is as shown in figure 9.2.1.9.1.
> a) If the MAC header for MSCH is not configured through the MAC control SAP:
>
> \- there is no MAC header for MSCH.
>
> b) If the MAC header for MSCH is configured through the MAC control SAP:
>
> \- TCTF field is included in the MAC header for MSCH.
>
> NOTE: If MSCH is not the only channel on the FACH, the MAC header shall be
> configured for the MSCH.
{width="4.552083333333333in" height="0.84375in"}
Figure 9.2.1.9.1: MAC PDU format for MSCH
### 9.2.2 MAC PDU: Parameters of the MAC header (HS-DSCH)
If MAC-hs is configured by upper layers [7], the parameters for the MAC header
are:
\- Version Flag (VF):\ The VF field is a one bit flag providing extension
capabilities of the MAC-hs PDU format. The VF field shall be set to zero and
the value one is reserved in this version of the protocol.
\- Queue identifier (Queue ID):\ The Queue ID field provides identification of
the reordering queue in the receiver, in order to support independent buffer
handling of data belonging to different reordering queues. The length of the
Queue ID field is 3 bit.
\- Transmission Sequence Number (TSN):\ The TSN field provides an identifier
for the transmission sequence number on the HS-DSCH. The TSN field is used for
reordering purposes to support in-sequence delivery to higher layers. For 1.28
Mcps TDD multi-frequency HS-DSCH operation mode, the length of the TSN field
can be 6 bits or 9 bits, which is configured by higher layer. For other
operation modes, the length of the TSN field is 6 bit.
\- Size index identifier (SID):\ The SID fields identifies the size of a set
of consecutive MAC-d PDUs. The MAC-d PDU size for a given SID is configured by
higher layers and is independent for each Queue ID. The length of the SID
field is 3 bit.
\- Number of MAC-D PDUs (N):\ The number of consecutive MAC-d PDUs with equal
size is identified with the N field. The length of the N field is 7 bits. In
FDD mode, the maximum number of PDUs transmitted in a single TTI shall be
assumed to be 70. In 1.28 Mcps TDD mode, the maximum number of PDUs
transmitted in a single TTI shall be assumed to be 45. In 3.84 Mcps TDD mode,
the maximum number of PDUs transmitted in a single TTI shall be assumed to be
318. In 7.68 Mcps TDD mode, the maximum number of PDUs transmitted in a single
TTI shall be assumed to be 636. If more PDUs than the defined maximum number
of PDUs for the corresponding mode are received, the UE behaviour is
unspecified.
\- Flag (F):\ The F field is a flag indicating if more fields are present in
the MAC-hs header or not. If the F field is set to \"0\" the F field is
followed by an additional set of SID, N and F fields. If the F field is set to
\"1\" the F field is followed by a MAC-d PDU. The maximum number of MAC-hs
header extensions, i.e. number of fields F set to \"0\", in a single TTI shall
be assumed to be 7. If more extensions than the maximum defined for the
corresponding mode are included in a TTI, the UE behaviour is unspecified.
If MAC-ehs is configured by upper layers [7], the parameters for the MAC
header are:
\- Logical channel identifier (LCH-ID):
> The LCH-ID field provides identification of the logical channel at the
> receiver and the re-ordering buffer destination of a reordering SDU.\ The
> length of the LCH-ID is 4 bits.
>
> In FDD and 1.28 Mcps TDD, when SDU from BCCH or PCCH logical channel is
> transmitted on HS-DSCH the LCH-ID field in MAC-ehs header is set to 1111\.
> The identification of the logical channel is done based on H-RNTI value used
> for broadcast information in or for paging in HS-SCCH. Table 9.2.2-0 shows
> the 4-bit LCH-ID field.
Table 9.2.2-0: Structure of the LCH-ID field
* * *
LCH-ID field Designation 0000 Logical channel 1 0001 Logical channel 2 ... ...
1110 Logical channel 15 1111 Used when SDU from BCCH or PCCH logical channel
is transmitted on HS-DSCH
* * *
\- Transmission Sequence Number (TSN):\ \ The TSN field provides an identifier
for the transmission sequence number on the HS-DSCH. The TSN field is used for
reordering purposes to support in-sequence delivery to higher layers.\ For
FDD, the length of the TSN field is either 6 or 14 bits, depending on
configuration of TSN field extension for MAC-ehs entity by upper layers [7].
> \- Segmentation Indication (SI)
>
> The SI field indicates if the MAC-ehs SDU has been segmented. Table 9.2.2-1
> shows the 2 bit SI field.
Table 9.2.2-1: Structure of the SI field
+--------------+------------------------------------------------------+ | **SI Field** | **Segmentation indication** | +--------------+------------------------------------------------------+ | 00 | The first reordering SDU of the reordering PDU is a | | | completeMAC-ehs SDU. | | | | | | The last reordering SDU of the reordering PDU is a | | | complete MAC-ehs SDU. | +--------------+------------------------------------------------------+ | 01 | If there are more than one reordering SDUs in the | | | reordering PDU, the last reordering SDU of the | | | reordering PDU is a complete MAC-ehs SDU. | | | | | | The first reordering SDU of the reordering PDU is | | | the last segment of a MAC-ehs SDU. | +--------------+------------------------------------------------------+ | 10 | If there are more than one reordering SDUs in the | | | reordering PDU, the first reordering SDU of the | | | reordering PDU is a complete MAC-ehs SDU. | | | | | | The last reordering SDU of the reordering PDU is the | | | first segment of a MAC-ehs SDU. | +--------------+------------------------------------------------------+ | 11 | If there are more than one reordering SDUs in the | | | reordering PDU, the first reordering SDU of the | | | reordering PDU is the last segment of a MAC-ehs SDU | | | and the last reordering SDU of reordering PDU is the | | | first segment of a MAC-ehs SDU. | | | | | | If there is only one reordering SDU in the | | | reordering PDU, the reordering SDU is a middle | | | segment of a MAC-ehs SDU. | +--------------+------------------------------------------------------+
> \- Length (L)
>
> The L field provides the length of the reordering SDU in octets. The
> reordering SDU size can vary for each reordering SDU in the MAC-ehs PDU, and
> is set for each reordering SDU individually. The length of the Length field
> is 11 bits.
\- Flag (F)
The F field is a flag indicating if more fields are present in the MAC-ehs
header or not. If the F field is set to \"0\" the F field is followed by an
additional set of LCH-ID and L fields and optionally (as described in section
9.1.4) TSN and SI fields. If the F field is set to \"1\" the F field is
followed by a reordering PDU. Each header extension corresponds to one
reordering SDU.
#### 9.2.2.1 MAC header for DTCH and DCCH
If MAC-hs is configured by upper layers [7]:
a) DTCH or DCCH mapped to HS-DSCH:
\- The Queue ID field and TSN field are always included in the MAC-hs header.
One SID field, N field and F field is included for each MAC-d PDU size
included in the MAC-hs PDU. Padding is not explicitly indicated but is
included in the end of the MAC-hs PDU if the total size of the MAC-hs payload
plus the MAC-hs header is smaller than the transport block set size.
If MAC-ehs is configured by upper layers [7]:
a) DTCH or DCCH mapped to HS-DSCH:
\- There is always one LCH ID field and L field for each reordering SDU
included in the MAC-ehs PDU and one TSN and SI field for each reordering PDU
included in the MAC-ehs PDU. Padding is not explicitly indicated but is
included in the end of the MAC-ehs PDU if the total size of the MAC-ehs
payload plus the MAC-ehs header is smaller than the transport block set size.
### 9.2.3 Signalling of Transport Block size for HS-DSCH
For HS-DSCH the transport block size is derived from the TFRI value signalled
on the HS-SCCH. The mapping between the TFRI value and the transport block
size for each mode is specified below:
#### 9.2.3.1 Transport block size for FDD
For all transmissions of a transport block, the transport block size is
derived from the TFRI value as specified below, except only in those cases of
retransmissions where the Node-B selects a combination for which no mapping
exists between the original transport block size and the selected combination
of channelisation Code set and modulation type. In such cases, the transport
block size index value signalled to the UE shall be set to 111111, i.e.,
_k~i~_ =63.
Let _k~i~_ be the TFRI signalled on the HS-SCCH value and let _k~0,i~_ be the
value in table 9.2.3.1 or table 9.2.3.2 (as configured by higher layers)
corresponding to the modulation and the number of codes signalled on the HS-
SCCH. Let _k~t~_ be the sum of the two values: _k~t~_ = _k~i~_ \+ _k~0,i~_.
The transport block size _L_(_k~t~_) can be obtained by accessing the position
_k~t~_ in one of the tables in Annex A (normative) or by using one of the
corresponding formulas below (informative).
The use of table 9.2.3.2 requires MAC-ehs.
Formula corresponding to table 9.2.3.1:
If _k~t~_ \ $p = \frac{\text{6214}}{\text{5973}}$ if the HS-DSCH physical layer category
> is between 1 and 3 inclusively,
>
> $p = \frac{\text{1292}}{\text{1228}}$ if the HS-DSCH physical layer category
> is between 4 and 6 inclusively,
>
> $p = \frac{\text{1901}}{\text{1795}}$ if the HS-DSCH physical layer category
> is between 7 and 9 inclusively,
>
> $p = \frac{\text{9445}}{\text{8877}}$ if the HS-DSCH physical layer category
> is between 10 and 12 inclusively,
>
> $p = \frac{\text{2345}}{\text{2196}}$ if the HS-DSCH physical layer category
> is between 13 and 15 inclusively,
and
If _k_ = 63 then,
> _L~k~_ = 2788 if the HS-DSCH physical layer category is between 1 and 3
> inclusively,
>
> 5600 if the HS-DSCH physical layer category is between 4 and 6 inclusively,
>
> 8416 if the HS-DSCH physical layer category is between 7 and 9 inclusively,
>
> 11226 if the HS-DSCH physical layer category is between 10 and 12
> inclusively,
>
> 14043 if the HS-DSCH physical layer category is between 13 and 15
> inclusively.
If _k_ =0, _L~k~_ indicates NULL and shall not be used to signal a transport
block size in the TFRI.
Transport block sizes calculated by this formula shall equal the values
indicated in the following tables: --
Table 9.2.3.3.1: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [1, 3], bit aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 434 32 817 48 1540
1 240 17 451 33 851 49 1602
2 249 18 470 34 885 50 1667
3 259 19 489 35 921 51 1734
4 270 20 508 36 958 52 1804
5 281 21 529 37 996 53 1877
6 292 22 550 38 1037 54 1952
7 304 23 572 39 1078 55 2031
8 316 24 596 40 1122 56 2113
9 329 25 620 41 1167 57 2198
10 342 26 645 42 1214 58 2287
11 356 27 671 43 1263 59 2380
12 370 28 698 44 1314 60 2476
13 385 29 726 45 1367 61 2575
14 401 30 755 46 1423 62 2679
15 417 31 786 47 1480 63 2788
* * *
Table 9.2.3.3.2: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [4, 6], bit aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 514 32 1159 48 2613
1 240 17 541 33 1219 49 2749
2 252 18 569 34 1283 50 2893
3 265 19 598 35 1350 51 3043
4 279 20 630 36 1420 52 3202
5 294 21 662 37 1494 53 3369
6 309 22 697 38 1572 54 3544
7 325 23 733 39 1654 55 3729
8 342 24 772 40 1740 56 3924
9 360 25 812 41 1831 57 4128
10 379 26 854 42 1926 58 4343
11 398 27 899 43 2027 59 4570
12 419 28 946 44 2132 60 4808
13 441 29 995 45 2244 61 5058
14 464 30 1047 46 2361 62 5322
15 488 31 1101 47 2484 63 5600
* * *
Table 9.2.3.3.3: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [7, 9], bit aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 567 32 1421 48 3559
1 240 17 601 33 1505 49 3769
2 254 18 636 34 1594 50 3991
3 269 19 674 35 1688 51 4227
4 285 20 713 36 1787 52 4477
5 301 21 756 37 1893 53 4741
6 319 22 800 38 2005 54 5021
7 338 23 848 39 2123 55 5318
8 358 24 898 40 2249 56 5632
9 379 25 951 41 2381 57 5964
10 402 26 1007 42 2522 58 6317
11 425 27 1066 43 2671 59 6690
12 451 28 1129 44 2829 60 7085
13 477 29 1196 45 2996 61 7503
14 505 30 1267 46 3173 62 7946
15 535 31 1341 47 3360 63 8416
* * *
Table 9.2.3.3.4: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [10, 12], bit aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 608 32 1641 48 4427
1 240 17 647 33 1746 49 4711
2 255 18 688 34 1858 50 5012
3 271 19 732 35 1977 51 5333
4 289 20 779 36 2103 52 5674
5 307 21 829 37 2238 53 6037
6 327 22 882 38 2381 54 6424
7 348 23 939 39 2533 55 6835
8 370 24 999 40 2695 56 7272
9 394 25 1063 41 2868 57 7737
10 419 26 1131 42 3051 58 8232
11 446 27 1203 43 3247 59 8759
12 474 28 1280 44 3455 60 9320
13 505 29 1362 45 3676 61 9916
14 537 30 1449 46 3911 62 10550
15 571 31 1542 47 4161 63 11226
* * *
Table 9.2.3.3.5: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [13,15], bit aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 642 32 1836 48 5250
1 240 17 686 33 1961 49 5606
2 256 18 732 34 2094 50 5987
3 273 19 782 35 2236 51 6393
4 292 20 835 36 2388 52 6827
5 312 21 892 37 2550 53 7290
6 333 22 952 38 2723 54 7785
7 355 23 1017 39 2908 55 8313
8 380 24 1086 40 3105 56 8877
9 405 25 1160 41 3316 57 9479
10 433 26 1238 42 3541 58 10123
11 462 27 1322 43 3781 59 10809
12 494 28 1412 44 4037 60 11543
13 527 29 1508 45 4311 61 12326
14 563 30 1610 46 4604 62 13162
15 601 31 1719 47 4916 63 14043
* * *
When MAC-ehs is used, or when MAC-hs is used and HS-DSCH SPS operation or
E-DCH SPS operation is enabled, the octet aligned table of transport block
size defined as following shall be used.
NOTE: When in CELL_FACH, CELL_PCH or URA_PCH state with HS-DSCH reception, the
octet aligned table of transport block size for the HS-DSCH physical layer
category 9 shall be used.
If k is the signalled TFRI value then the corresponding HS-DSCH transport
block size Lk is given by:
If k = 1..M
If k = M+1..62
where
> $p = \left( \frac{\text{348}}{\text{30}} \right)^{\frac{1}{\text{63} - 1}}$,
> M=10, step=24 if the HS-DSCH physical layer category is between 1 and 3
> inclusively,
>
> $p = \left( \frac{\text{700}}{\text{30}} \right)^{\frac{1}{\text{63} - 1}}$,
> M=7, step=32 if the HS-DSCH physical layer category is between 4 and 6
> inclusively,
>
> $p = \left( \frac{\text{1052}}{\text{30}} \right)^{\frac{1}{\text{63} -
> 1}}$, M=9, step=32 if the HS-DSCH physical layer category is between 7 and 9
> inclusively,
>
> $p = \left( \frac{\text{1403}}{\text{30}} \right)^{\frac{1}{\text{63} -
> 1}}$, M=10, step=33 if the HS-DSCH physical layer category is between 10 and
> 12 inclusively,
>
> $p = \left( \frac{\text{1755}}{\text{30}} \right)^{\frac{1}{\text{63} -
> 1}}$, M=10, step=35 if the HS-DSCH physical layer category is between 13 and
> 15 inclusively,
>
> $p = \left( \frac{\text{1579}}{\text{30}} \right)^{\frac{1}{\text{63} -
> 1}}$, M=10, step=34 if the HS-DSCH physical layer category is between 16 and
> 18 inclusively,
>
> $p = \left( \frac{\text{2107}}{\text{30}} \right)^{\frac{1}{\text{63} -
> 1}}$, M=10, step=36 if the HS-DSCH physical layer category is between 19 and
> 21 inclusively,
>
> $p = \left( \frac{\text{2634}}{\text{30}} \right)^{\frac{1}{\text{63} -
> 1}}$, M=10, step=38 if the HS-DSCH physical layer category is between 22 and
> 24 inclusively,
and
> $L_{\text{min}} = \text{30}$, $L_{0} = \text{112}$
If _k_ = 63 then,
> _L~k~_ = 2784 if the HS-DSCH physical layer category is between 1 and 3
> inclusively,
>
> 5600 if the HS-DSCH physical layer category is between 4 and 6 inclusively,
>
> 8416 if the HS-DSCH physical layer category is between 7 and 9 inclusively,
> or 25(if MIMO operation is enabled)
>
> 11224 if the HS-DSCH physical layer category is between 10 and 12
> inclusively, or 26(if MIMO operation is enabled)
>
> 14040 if the HS-DSCH physical layer category is between 13 and 15
> inclusively, or 27(if MIMO operation is enabled)
>
> 12632 if the HS-DSCH physical layer category is between 16 and 18
> inclusively, 25(if MIMO operation is not enabled) or 28
>
> 16856 if the HS-DSCH physical layer category is between 19 and 21
> inclusively, 26(if MIMO operation is not enabled) or 29
>
> 21072 if the HS-DSCH physical layer category is between 22 and 24
> inclusively, 27(if MIMO operation is not enabled) or 30
If _k_ =0, _L~k~_ indicates NULL and shall not be used to signal a transport
block size in the TFRI.
Transport block sizes calculated by this formula shall equal the values
indicated in the following tables:
Table 9.2.3.3.6: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [1, 3], octet aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 432 32 816 48 1536
1 112 17 448 33 848 49 1600
2 136 18 464 34 880 50 1664
3 160 19 488 35 920 51 1728
4 184 20 504 36 952 52 1800
5 208 21 528 37 992 53 1872
6 232 22 544 38 1032 54 1944
7 256 23 568 39 1072 55 2024
8 280 24 592 40 1120 56 2104
9 304 25 616 41 1160 57 2192
10 328 26 640 42 1208 58 2280
11 352 27 664 43 1256 59 2376
12 368 28 696 44 1312 60 2472
13 384 29 720 45 1360 61 2568
14 400 30 752 46 1416 62 2672
15 416 31 784 47 1472 63 2784
* * *
Table 9.2.3.3.7: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [4, 6], octet aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 512 32 1152 48 2608
1 112 17 536 33 1216 49 2744
2 144 18 568 34 1280 50 2888
3 176 19 592 35 1344 51 3040
4 208 20 624 36 1416 52 3200
5 240 21 656 37 1488 53 3368
6 272 22 696 38 1568 54 3544
7 304 23 728 39 1648 55 3728
8 336 24 768 40 1736 56 3920
9 360 25 808 41 1824 57 4128
10 376 26 848 42 1920 58 4336
11 392 27 896 43 2024 59 4568
12 416 28 944 44 2128 60 4808
13 440 29 992 45 2240 61 5056
14 464 30 1040 46 2360 62 5320
15 488 31 1096 47 2480 63 5600
* * *
Table 9.2.3.3.8: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [7, 9], 25(if MIMO operation is enabled), octet
aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 560 32 1416 48 3552
1 112 17 600 33 1504 49 3768
2 144 18 632 34 1592 50 3984
3 176 19 672 35 1688 51 4224
4 208 20 712 36 1784 52 4472
5 240 21 752 37 1888 53 4736
6 272 22 800 38 2000 54 5016
7 304 23 848 39 2120 55 5312
8 336 24 896 40 2248 56 5632
9 368 25 944 41 2376 57 5960
10 400 26 1000 42 2520 58 6312
11 424 27 1064 43 2664 59 6688
12 448 28 1128 44 2824 60 7080
13 472 29 1192 45 2992 61 7496
14 504 30 1264 46 3168 62 7944
15 528 31 1336 47 3360 63 8416
* * *
Table 9.2.3.3.9: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [10, 12], 26(if MIMO operation is enabled), octet
aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 608 32 1640 48 4424
1 112 17 640 33 1744 49 4704
2 144 18 688 34 1856 50 5008
3 176 19 728 35 1976 51 5328
4 208 20 776 36 2096 52 5672
5 240 21 824 37 2232 53 6032
6 272 22 880 38 2376 54 6416
7 304 23 936 39 2528 55 6832
8 336 24 992 40 2688 56 7264
9 376 25 1056 41 2864 57 7736
10 408 26 1128 42 3048 58 8224
11 440 27 1200 43 3240 59 8752
12 472 28 1280 44 3448 60 9312
13 504 29 1360 45 3672 61 9912
14 536 30 1448 46 3904 62 10544
15 568 31 1536 47 4160 63 11224
* * *
Table 9.2.3.3.10 : HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [13,15], 27(if MIMO operation is enabled), octet
aligned
* * *
**TB index (k)** **TB size\** TB index (k)**** TB size\ TB index (k) **TB
size\** TB index (k)**** TB size\ [bits]**[bits]** [bits]**[bits]**
0 NULL 16 640 32 1832 48 5240
1 112 17 680 33 1960 49 5600
2 144 18 728 34 2088 50 5976
3 176 19 776 35 2232 51 6384
4 216 20 832 36 2384 52 6816
5 248 21 888 37 2544 53 7280
6 280 22 952 38 2720 54 7776
7 320 23 1016 39 2904 55 8304
8 352 24 1080 40 3096 56 8864
9 392 25 1152 41 3312 57 9464
10 424 26 1232 42 3536 58 10112
11 456 27 1320 43 3776 59 10792
12 488 28 1408 44 4032 60 11528
13 520 29 1504 45 4304 61 12312
14 560 30 1608 46 4600 62 13144
15 600 31 1712 47 4912 63 14040
* * *
Table 9.2.3.3.11: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [16,18], 25(if MIMO operation is not enabled), 28,
octet aligned
+-------+-------+-------+-------+-------+-------+-------+-------+ | TB | TB | TB | TB | TB | TB | TB | TB | | index | size | index | size | index | size | index | size | | (k) | | (k) | | (k) | | (k) | | | | [b | | [b | | [b | | [b | | | its] | | its] | | its] | | its] | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | NULL | 16 | 624 | 32 | 1736 | 48 | 4840 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 1 | 112 | 17 | 664 | 33 | 1856 | 49 | 5160 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 2 | 144 | 18 | 704 | 34 | 1976 | 50 | 5496 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 3 | 176 | 19 | 752 | 35 | 2104 | 51 | 5864 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 4 | 208 | 20 | 808 | 36 | 2248 | 52 | 6248 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 248 | 21 | 856 | 37 | 2392 | 53 | 6664 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 6 | 280 | 22 | 912 | 38 | 2552 | 54 | 7104 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 7 | 312 | 23 | 976 | 39 | 2720 | 55 | 7568 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 344 | 24 | 1040 | 40 | 2896 | 56 | 8072 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 9 | 384 | 25 | 1112 | 41 | 3088 | 57 | 8600 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 10 | 416 | 26 | 1184 | 42 | 3296 | 58 | 9176 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 11 | 448 | 27 | 1264 | 43 | 3512 | 59 | 9776 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 12 | 480 | 28 | 1344 | 44 | 3744 | 60 | 10424 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 13 | 512 | 29 | 1432 | 45 | 3992 | 61 | 11112 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 14 | 544 | 30 | 1528 | 46 | 4256 | 62 | 11848 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 15 | 584 | 31 | 1632 | 47 | 4536 | 63 | 12632 | +-------+-------+-------+-------+-------+-------+-------+-------+
Table 9.2.3.3.12: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [19,21], 26(if MIMO operation is not enabled), 29,
octet aligned
+-------+-------+-------+-------+-------+-------+-------+-------+ | TB | TB | TB | TB | TB | TB | TB | TB | | index | size | index | size | index | size | index | size | | (k) | | (k) | | (k) | | (k) | | | | [b | | [b | | [b | | [b | | | its] | | its] | | its] | | its] | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | NULL | 16 | 664 | 32 | 2008 | 48 | 6024 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 1 | 112 | 17 | 712 | 33 | 2152 | 49 | 6448 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 2 | 144 | 18 | 768 | 34 | 2304 | 50 | 6904 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 3 | 184 | 19 | 824 | 35 | 2464 | 51 | 7400 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 4 | 216 | 20 | 880 | 36 | 2640 | 52 | 7920 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 256 | 21 | 944 | 37 | 2832 | 53 | 8488 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 6 | 288 | 22 | 1008 | 38 | 3032 | 54 | 9088 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 7 | 328 | 23 | 1080 | 39 | 3248 | 55 | 9736 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 360 | 24 | 1160 | 40 | 3480 | 56 | 10424 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 9 | 400 | 25 | 1240 | 41 | 3728 | 57 | 11168 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 10 | 432 | 26 | 1328 | 42 | 3992 | 58 | 11960 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 11 | 472 | 27 | 1424 | 43 | 4272 | 59 | 12808 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 12 | 504 | 28 | 1528 | 44 | 4576 | 60 | 13720 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 13 | 544 | 29 | 1632 | 45 | 4904 | 61 | 14688 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 14 | 584 | 30 | 1752 | 46 | 5248 | 62 | 15736 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 15 | 624 | 31 | 1872 | 47 | 5624 | 63 | 16856 | +-------+-------+-------+-------+-------+-------+-------+-------+
Table 9.2.3.3.13: HSDPA Transport Block Sizes for 1.28 Mcps TDD, for HS-DSCH
physical layer category [22,24], 27(if MIMO operation is not enabled), 30,
octet aligned
+-------+-------+-------+-------+-------+-------+-------+-------+ | TB | TB | TB | TB | TB | TB | TB | TB | | index | size | index | size | index | size | index | size | | (k) | | (k) | | (k) | | (k) | | | | [b | | [b | | [b | | [b | | | its] | | its] | | its] | | its] | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | NULL | 16 | 704 | 32 | 2248 | 48 | 7136 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 1 | 112 | 17 | 760 | 33 | 2416 | 49 | 7664 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 2 | 144 | 18 | 816 | 34 | 2592 | 50 | 8240 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 3 | 184 | 19 | 872 | 35 | 2792 | 51 | 8856 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 4 | 224 | 20 | 944 | 36 | 3000 | 52 | 9520 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 264 | 21 | 1016 | 37 | 3224 | 53 | 10232 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 6 | 296 | 22 | 1088 | 38 | 3464 | 54 | 11000 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 7 | 336 | 23 | 1168 | 39 | 3720 | 55 | 11824 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 376 | 24 | 1256 | 40 | 4000 | 56 | 12712 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 9 | 416 | 25 | 1352 | 41 | 4304 | 57 | 13664 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 10 | 448 | 26 | 1456 | 42 | 4624 | 58 | 14688 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 11 | 488 | 27 | 1560 | 43 | 4968 | 59 | 15784 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 12 | 528 | 28 | 1680 | 44 | 5344 | 60 | 16968 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 13 | 568 | 29 | 1808 | 45 | 5744 | 61 | 18232 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 14 | 608 | 30 | 1944 | 46 | 6176 | 62 | 19600 | +-------+-------+-------+-------+-------+-------+-------+-------+ | 15 | 656 | 31 | 2088 | 47 | 6632 | 63 | 21072 | +-------+-------+-------+-------+-------+-------+-------+-------+
### 9.2.4 MAC PDU: Parameters of the MAC header (E-DCH)
#### 9.2.4.1 MAC-es header parameters
\- Transmission Sequence Number (TSN):\ The TSN field provides the
transmission sequence number for the MAC-es PDU. This information is used for
reordering purposes to support in-sequence delivery to higher layers. The
length of the TSN field is 6 bits.
#### 9.2.4.2 MAC-e header parameters
\- Data description indicator (DDI):\ The DDI field identifies the logical
channel, MAC-d flow and size of the MAC-d PDUs concatenated into the
associated MAC-es PDU. The mapping between the DDI values and the logical
channel ID, MAC-d flow and PDU size is provided by higher layers. The length
of the DDI field is 6 bits.
> \- For FDD: When, due to the quantization in the transport block sizes that
> can be supported or triggering of the Scheduling Information, the size of
> the data plus header is less than or equal to the TB size of the E-TFC
> selected by the UE minus 24 bits, the DDI value [111111] shall be appended
> at the end of the MAC-e header and a Scheduling Information shall be
> concatenated into this MAC-e PDU, where DDI value [111111] indicates that
> there is a Scheduling Information concatenated in this MAC-e PDU. Otherwise,
> if the size of the data plus header is less than or equal to the TB size of
> the E-TFC selected by the UE minus 18 bits, a Scheduling Information shall
> be concatenated into this MAC-e PDU. In any other case it is understood that
> another MAC-es PDU or Scheduling Information does not fit and it is
> therefore not necessary to reserve room in the transport block for an
> additional DDI field.
>
> \- For TDD: When, due to the quantization in the transport block sizes that
> can be supported or triggering of the Scheduling Information (due to timer
> expiry, see subclauses 11.9.1.4a and 11.9.1.5), the size of the data plus
> header is less than or equal to the TB size of the E-TFC selected by the UE
> minus 29bits, the DDI value [111111] shall be appended at the end of the
> MAC-e header and a Scheduling Information shall be concatenated into this
> MAC-e PDU, where DDI value [111111] indicates that there is a Scheduling
> Information concatenated in this MAC-e PDU. Otherwise, if the size of the
> data plus header is less than or equal to the TB size of the E-TFC selected
> by the UE minus 23 bits, a Scheduling Information shall be concatenated into
> this MAC-e PDU. In any other case it is understood that another MAC-es PDU
> or Scheduling Information does not fit and it is therefore not necessary to
> reserve room in the transport block for an additional DDI field.
\- Number of MAC-d PDUs (N):\ The number of consecutive MAC-d PDUs
corresponding to the same DDI value. The length of the N field is 6 bits.
#### 9.2.4.3 MAC-is header parameters
\- Transmission Sequence Number (TSN):\ The TSN field provides the
transmission sequence number for the MAC-is PDU. This information is used for
reordering purposes to support in-sequence delivery to higher layers. For TDD,
the length of the TSN field is 6 bits. For FDD and 1.28Mcps TDD, the length of
the TSN field is either 6 or 14 bits, depending on configuration of TSN field
extension for MAC-i/is entity by upper layers [7].
\- Segmentation Status (SS):\ The Segmentation Status (SS) field provides
indication of the segmentation status of the MAC SDU or segment of MAC SDU
belonging to the logical channel identified by the LCH-ID field. The length of
the SS field is 2 bits.
Table 9.2.4.3-1: Structure of the SS field
+--------------+------------------------------------------------------+ | **SS Field** | **Segmentation status** | +--------------+------------------------------------------------------+ | **00** | **The first MAC-is SDU of the MAC-is PDU is a | | | complete MAC-d PDU or MAC-c PDU.** | | | | | | **The last MAC-is SDU of the MAC-is PDU is a | | | complete MAC-d PDU or MAC-c PDU.** | +--------------+------------------------------------------------------+ | **01** | **If there are more than one MAC-is SDUs in the | | | MAC-is PDU, the last MAC-is SDU of the MAC-is PDU is | | | a complete MAC-d PDU or MAC-c PDU.** | | | | | | **The first MAC-is SDU of the MAC-is PDU is the last | | | segment of a MAC-d PDU or MAC-c PDU.** | +--------------+------------------------------------------------------+ | **10** | **If there are more than one MAC-is SDUs in the | | | MAC-is PDU, the first MAC-is SDU of the MAC-is PDU | | | is a complete MAC-d PDU or MAC-c PDU.** | | | | | | **The last MAC-is SDU of the MAC-is PDU is the first | | | segment of a MAC-d PDU or MAC-c PDU.** | +--------------+------------------------------------------------------+ | **11** | **If there are more than one MAC-is SDUs in the | | | MAC-is PDU, the first MAC-is SDU of the MAC-is PDU | | | is the last segment of a MAC-d PDU or MAC-c PDU and | | | the last MAC-is SDU of MAC-is PDU is the first | | | segment of a MAC-d PDU or MAC-c PDU.** | | | | | | **If there is only one MAC-is SDU in the MAC-is PDU, | | | the MAC-is SDU is a middle segment of a MAC-d PDU or | | | MAC-c PDU.** | +--------------+------------------------------------------------------+
#### 9.2.4.4 MAC-i header parameters
\- Length (L):\ The L field provides the length of the MAC-is SDU in octets.
The size can vary for each SDU in the MAC-is PDU, and is set for each SDU
individually. The length of the Length field is 11 bits.
\- Logical channel identifier (LCH-ID):\ The LCH-ID field provides
identification of the logical channel at the receiver and the re-ordering
buffer destination of a MAC-is SDU. In FDD, one LCH-ID value is reserved to
indicate that the UE's E-RNTI is included in the MAC-i header. The length of
the LCH-ID is 4 bits.
Table 9.2.4.4-1: Structure of the LCH-ID field (FDD only)
* * *
**LCH-ID Field** **Designation** **0000** **Logical channel 1** **0001**
**Logical channel 2** **...** **...** **1101** **Logical channel 14** **1110**
**Identification of CCCH (SRB0)** **1111** **Identification of E-RNTI being
included.**
* * *
Table 9.2.4.4-2: Structure of the LCH-ID field (1.28 Mcps TDD only)
* * *
LCH-ID Field Designation 0000 Logical channel 1 0001 Logical channel 2 ... ...
1101 Logical channel 14 1110 Identification of CCCH (SRB0) 1111 Reserved
* * *
\- Flag (F):\ The F field is a flag indicating if more fields are present in
the MAC-i header or not. If the F field is set to \"0\" the F field is
followed by an additional set of LCH-ID, L and F fields. If the F field is set
to \"1\" the F field is followed by a MAC-is PDU. Each header extension
corresponds to one MAC-is SDU.
\- E-RNTI (FDD only)\ The E-RNTI field provides the UE's E-RNTI value.
\- Spare (S) (FDD only):\ The S field is needed to achieve octet alignment in
case the UE's E-RNTI is included in the MAC-i header. In this version of the
specification, the spare field shall be set to \"0000\".
### 9.2.5 Signaling of control information for FDD E-DCH
#### 9.2.5.1 HARQ information
This control information is used in support of the uplink hybrid ARQ
functionality.
\- ACK/NACK information:\ Transmitted on the E-HICH, on the downlink frequency
associated with the uplink frequency where the uplink transmission was made,
from each cell in the E-DCH active set of each Activated Uplink Frequency, the
ACK/NACK information indicates the successful or un-successful decoding of the
corresponding uplink transmission. This information allows the UE to know
whether to make another transmission for the same MAC-e or MAC-i PDU or to
start the transmission of a new one. The length of the ACK/NACK field is 1
bit.
\- RSN:\ Transmitted on the E-DPCCH, the RSN is used to convey the uplink HARQ
transmission number. Because of the limitation in the field size, the RSN
saturates to the maximum value once that is reached. The combination of the
RSN and the transmission timing allows the receiver to determine the exact
transmission number (see [16]). The length of the RSN field is 2 bits.
#### 9.2.5.2 DL Scheduling information
This control information is used by Node-Bs in a UE\'s E-DCH active set in
order to control its use of E-DCH system resources.
##### 9.2.5.2.1 Relative Grants
\- Serving Relative Grant:\ The Serving Relative Grant is defined per
Configured Uplink Frequency. The Serving Relative Grant is transmitted on the
downlink frequency associated with the uplink frequency where the uplink
transmission will be made. The Serving Relative Grant is transmitted on the
E-RGCH from all cells in the serving E-DCH RLS, and from all cells in the
Secondary Serving E-DCH RLS, when the Secondary Uplink Frequency is activated.
The serving relative grant allows the Node B scheduler to incrementally adjust
the serving grant of UEs under its control. By definition, there can only be
one serving relative grant command received at any one time per Activated
Uplink Frequency. This indication can take three different values, \"UP\",
\"DOWN\" or \"HOLD\".
\- Non-serving Relative Grant:\ The Non-serving Relative Grant is defined per
Configured Uplink Frequency. The Non-Serving Relative Grant is transmitted on
the downlink frequency associated with the uplink frequency where the uplink
transmission will be made. In CELL_DCH state, the Non-Serving Relative Grant
is transmitted on the E-RGCH from a non-serving E-DCH RL and from Secondary
Non-Serving E-DCH RL. In CELL_FACH state, the Non-Serving Relative Grant is
transmitted on the E-RGCH from a Common E-RGCH RL. The non-serving relative
grant allows neighboring Node Bs to adjust the transmitted rate of UEs that
are not under their control in order to avoid overload situations. By
definition, there could be multiple non-serving relative grant commands
received by MAC at any time per Activated Uplink Frequency. This indication
can take two different values, \"DOWN\" or \"HOLD\".
The handling of the Relative Grant signalling is based on the Scheduling Grant
table configured by higher layers and shown in Tables 9.2.5.2.1.1and
9.2.5.2.1.2. One table is used for all Configured Uplink Frequencies.
Table 9.2.5.2.1.1: Scheduling Grant Table 1 (SG-table)
* * *
Index Scheduled Grant 37 (168/15)^2^*6 36 (150/15)^2^*6 35 (168/15)^2^*4 34
(150/15)^2^*4 33 (134/15)^2^*4 32 (119/15)^2^*4 31 (150/15)^2^*2 30
(95/15)^2^*4 29 (168/15)^2^ 28 (150/15)^2^ 27 (134/15)^2^ 26 (119/15)^2^ 25
(106/15)^2^ 24 (95/15)^2^ 23 (84/15)^2^ 22 (75/15)^2^ 21 (67/15)^2^ 20
(60/15)^2^ 19 (53/15)^2^ 18 (47/15)^2^ 17 (42/15)^2^ 16 (38/15)^2^ 15
(34/15)^2^ 14 (30/15)^2^ 13 (27/15)^2^ 12 (24/15)^2^ 11 (21/15)^2^ 10
(19/15)^2^ 9 (17/15)^2^ 8 (15/15)^2^ 7 (13/15)^2^ 6 (12/15)^2^ 5 (11/15)^2^ 4
(9/15)^2^ 3 (8/15)^2^ 2 (7/15)^2^ 1 (6/15)^2^ 0 (5/15)^2^
* * *
Table 9.2.5.2.1.2: Scheduling Grant Table 2 (SG-table)
* * *
Index Scheduled Grant 37 (377/15)^2^x4 36 (336/15)^2^x4 35 (237/15)^2^x6 34
(212/15)^2^x6 33 (237/15)^2^x4 32 (168/15)^2^*6 31 (150/15)^2^*6 30
(168/15)^2^*4 29 (150/15)^2^x4 28 (134/15)^2^x4 27 (119/15)^2^x4 26
(150/15)^2^x2 25 (95/15)^2^x4 24 (168/15)^2^ 23 (150/15)^2^ 22 (134/15)^2^ 21
(119/15)^2^ 20 (106/15)^2^ 19 (95/15)^2^ 18 (84/15)^2^ 17 (75/15)^2^ 16
(67/15)^2^ 15 (60/15)^2^ 14 (53/15)^2^ 13 (47/15)^2^ 12 (42/15)^2^ 11
(38/15)^2^ 10 (34/15)^2^ 9 (30/15)^2^ 8 (27/15)^2^ 7 (24/15)^2^ 6 (21/15)^2^ 5
(19/15)^2^ 4 (17/15)^2^ 3 (15/15)^2^ 2 (13/15)^2^ 1 (12/15)^2^ 0 (11/15)^2^
* * *
When the Serving_Grant for each Activated Uplink Frequency needs to be
determined due to E-RGCH signalling (see subclause 11.8.1.3.2), the UE shall:
\- if the UE received a Serving Relative Grant in CELL_DCH state or in
CELL_FACH state after collision resolution (FDD only):
\- Determine the lowest power ratio in the configured SG-table (table
9.2.5.2.1.1 or table 9.2.5.2.1.2) that is equal or higher to the
reference_ETPR, and determine the corresponding index in the SG-table:
SG~LUPR;~
\- If the UE received a Serving Relative Grant \"UP\", based on the thresholds
\"3-index-step threshold\" and \"2-index-step threshold\" configured by higher
layers, determine the Serving_Grant as follows:
\- if SG~LUPR~ \ \"Minimum Serving Grant\":
\- Serving_Grant = SG[MAX(SG~LUPR2~ -1 , \"Minimum Serving Grant\")].
\- if SG~LUPR2~ \ \- Identity Type:\ This variable will take the value \"Primary\" or
> \"Secondary\" respectively based on whether the message was addressed to the
> primary or the secondary E-RNTI.
The absolute grant message itself includes multiple fields that are
multiplexed together into 6 bits inside the MAC-e or MAC-i of the Node B and
then submitted to the physical layer for transmission on the E-AGCH. These
fields are:
\- Absolute Grant Value:\ This field is used to determine the maximum E-DCH
traffic to pilot ratio (E-DPDCH/DPCCH) that the UE is allowed to use in the
next transmission. The length of the Absolute Grant Value field is 5 bits.
\- Absolute Grant Scope:\ This field indicates the applicability of the
Absolute Grant. It can take two different values, \"Per HARQ process\" or
\"All HARQ processes\", allowing to indicate whether the HARQ process
activation/de-activation will affect one or all processes. The Absolute Grant
Scope is encoded in 1 bit. In CELL_DCH state, when the E-DCH is configured
with 10ms TTI, only the value \"All HARQ processes\" is valid (see subclause
10). In case Identity Type is \"Secondary\", only the value \"All HARQ
processes\" is valid in this version of the protocol.\ In CELL_FACH state, if
\"Per HARQ process\" scope is enabled by higher layers and when the E-DCH is
configured with 2 ms TTI, the absolute grant scope can take two different
values, \"Per HARQ process\" or \"All HARQ processes\", allowing to indicate
whether the HARQ process activation/de-activation will affect a HARQ process,
and to indicate the release of the common E-DCH resources. Otherwise, in
CELL_FACH state, the only valid value is \"All HARQ processes\" (see subclause
10).
\- Common E-DCH resource release (FDD only in CELL_FACH):\ An AG with value
set to \'INACTIVE\' is used by the Node B to release common E-DCH resources.
##### 9.2.5.2.2a UL MIMO rank and offset
The rank and offset message is sent on the downlink frequency on the
configured E-ROCH from the serving E-DCH cell. The E-ROCH is a shared channel
that uses the E-ROCH E-RNTI specific CRC in order to address messages to
specific users (see [16]). The E-ROCH channel allows the Node B to directly
adjust the maximum transmission rank and the secondary stream rate of UEs
under its control. A UE shall keep and use information provided over the
E-ROCH channel until the next E-ROCH message is received.
The E-ROCH includes multiple fields that are multiplexed together into 6 bits
inside the MAC-i of the Node B and then submitted to the physical layer for
transmission on the E-ROCH. These fields are:
\- S-ETFC offset:\ This field determines an offset to calculate the virtual
serving grant that the UE is allowed to use in the next transmission of the
secondary stream. The length of S-ETFC offset field is 5 bits.
\- Rank Indication:\ This field indicates the maximum allowed rank that the UE
can use in the next transmissions. It can take two different values, \"rank2
allowed\" or \"rank2 not allowed\", indicating whether the UE may use rank2
transmissions or not. The rank indication is encoded in 1 bit.
#### 9.2.5.3 UL Scheduling information
This control information is used by UEs to indicate to their serving E-DCH
Node-B the amount of resources they require.
##### 9.2.5.3.1 Happy Bit
The happy bit is a single bit field that is passed from MAC to the physical
layer for inclusion on the E-DPCCH. This field takes two values, \"Not Happy\"
and \"Happy\" indicating respectively whether the UE could use more resources
or not. The setting of the Happy Bit is defined in subclause 11.8.1.5.
A happy bit is reported on each of the Activated Uplink Frequencies.
##### 9.2.5.3.2 Scheduling Information
The Scheduling Information is located at the end of the MAC-e or MAC-i PDU and
is used to provide the serving Node B with a better view of the amount of
system resources needed by the UE and the amount of resources it can actually
make use of. The transmission of this information will be initiated due to the
quantization of the transport block sizes that can be supported or based on
the triggers defined in subclause 11.8.1.6. When a Scheduling Information is
transmitted, its contents shall always be updated in new transmissions with
the buffer status after application of the E-TFC selection procedure described
in subclause 11.8.1.4. The logical channels for which a non-scheduled grant is
configured shall never be taken into account when putting together this
information. In addition, the RRC may restrict applicability for logical
channels for which no non-scheduled grant was configured.
A Scheduling Information is reported independently on each of the Activated
Uplink Frequencies.
This information includes the following fields:
\- Highest priority Logical channel ID (HLID):\ The HLID field identifies
unambiguously the highest priority logical channel with available data. If
multiple logical channels exist with the highest priority, the one
corresponding to the highest buffer occupancy will be reported. The length of
the HLID is 4 bits. In case the TEBS is indicating index 0 (0 byte), the HLID
shall indicate the value \"0000\".
\- Fields related to amount of available data:
> \- Total E-DCH Buffer Status (TEBS):\ The TEBS field identifies the total
> amount of data available across all logical channels for which reporting has
> been requested by the RRC and indicates the amount of data in number of
> bytes that is available for transmission and retransmission in RLC layer. If
> MAC-i/is is configured, it also includes the amount of data that is
> available for transmission in the MAC-i/is segmentation entity. When MAC is
> connected to an AM RLC entity, control PDUs to be transmitted and RLC PDUs
> outside the RLC Tx window shall also be included in the TEBS. RLC PDUs that
> have been transmitted but not negatively acknowledged by the peer entity
> shall not be included in the TEBS.
The length of this field is 5 bits. The values taken by TEBS are shown in
Table 9.2.5.3.2.1.
Table 9.2.5.3.2-1: TEBS Values
* * *
Index TEBS Value (bytes) 0 TEBS = 0 1 0 \ slot)
  * The physical resources to be used for transmission
> \- Channelisation Code
>
> \- Timeslots
>
> \- Resource Duration (optional)
The absolute grant message itself includes multiple fields that are
multiplexed together into between 14 and 28 bits for 3.84/7.68 Mcps TDD and
between 23 and 26 bits for 1.28 Mcps TDD (depending on the system
configuration) inside the MAC-e or MAC-i of the Node B and then submitted to
the physical layer for transmission on the E-AGCH. These fields are:
\- Absolute Grant Value:\ For TDD, this field indicates the maximum E-PUCH
transmission power to reference power ratio per TDD resource unit that the UE
is allowed to use on the E-DCH resources associated with the Absolute Grant. A
TDD resource unit is defined as one sixteenth of the OVSF codespace in one
timeslot. The length of the Absolute Grant Value field for TDD is 5 bits.
\- Channelisation Code:\ This field describes the code component of the
physical resource grant. For 1.28/3.84 Mcps TDD it comprises an enumerated
value of length 5 bits indicating which node on the OVSF code tree has been
allocated. For 7.68 Mcps TDD it comprises an enumerated value of length 6 bits
indicating which node on the OVSF tree has been allocated. The mapping between
the allocated OVSF and the enumerated node 0...30 for 1.28/3.84 Mcps and
0...62 for 7.68 Mcps is as given in [19].
\- Timeslot Resource Related Information:\ This field describes the timeslot
component of the physical resource grant and comprises a bitmap of length
n~TRRI~. For 3.84/7.68 Mcps TDD, the TRRI field indicates which of the
timeslots configured for E-DCH use by RRC have been allocated with the LSB
corresponding to the lowest numbered E-DCH timeslot and the MSB corresponding
to the highest numbered timeslot. The length of the TRRI field (n~TRRI~) is 5
bits and is configurable by RRC on a per-cell basis between 1 and 12 bits for
3.84/7.68 Mcps TDD. For 1.28 Mcps TDD, the length of the TRRI field (n~TRRI~)
is 5 bits with MSB corresponding to TS1 and LSB corresponding to TS5.
\- Resource Duration Indicator:\ Optionally, RRC may configure, on a per-cell
basis the presence of a resource duration indicator field on E-AGCH for TDD.
If configured as present in a cell, 3 bits are used to indicate the number of
TTI's allocated and the spacing between the allocated TTIs via a single grant
according to table 9.2.6.2.1-2. If the field is configured as not present on
E-AGCH in the cell, a value of 0 is implicitly assumed by the UE corresponding
to 1 TTI.
Table 9.2.6.2.1-2 -- Resource Duration Indicator (RDI) interpetation
* * *
**Resource Duration Indicator (3 bits)** **TTIs allocated** **TTI spacing** 0
1 1 1 2 1 2 2 2 3 2 4 4 4 1 5 4 2 6 4 4 7 8 1
* * *
\- E-AGCH Cyclic Sequence Number (ECSN):\ The ECSN is a 3-bit field used to
assist the UE with outer-loop power control of E-AGCH (cf. HCSN for HS-SCCH).
  * E-HICH Indicator(EI) (1.28 Mcps TDD only)\ > The E-HICH indicator (EI) consists of 2 bits and is used to > indicate which E-HICH will convey the acknowledgement indicator > for the scheduled UEs.
  * E-UCCH Number Indicator (ENI) (1.28 Mcps TDD only)\ > The E-UCCH Number Indicator (ENI) is a 3-bit field used to > indicate the detailed number of E-UCCH.
#### 9.2.6.3 UL Scheduling Information
This control information is used by UEs to indicate to the Node B the amount
of resources they require. Scheduling Information is sent via the E-PUCH in
the MAC-e or MAC-i header when the UE is granted resource and by the E-RUCCH
when no resource has been granted. Scheduling Information consists of three
components for single carrier HSUPA or only one carrier group is configured
for multi-carrier E-DCH operation, otherwise five components for multi-carrier
E-DCH operation as defined below.
\- Buffer Information: This consists of:
\- Highest priority Logical Channel (HLID)
> The HLID field identifies unambiguously the highest priority logical channel
> with available data. If multiple logical channels exist with the highest
> priority, the one corresponding to the highest buffer occupancy will be
> reported. The length of the HLID is 4 bits. In case the TEBS is indicating
> index 0 (0 byte), the HLID shall indicate the value \"0000\".
\- Total E-DCH Buffer Status (TEBS)
> The TEBS field identifies the total amount of data available across all
> logical channels for which reporting has been requested by the RRC and
> indicates the amount of data in number of bytes that is available for
> transmission and retransmission in RLC layer. If MAC-i/is is configured, it
> also includes the amount of data that is available for transmission in the
> MAC-i/is segmentation entity. When MAC is connected to an AM RLC entity,
> control PDUs to be transmitted and RLC PDUs outside the RLC Tx window shall
> also be included in the TEBS. RLC PDUs that have been transmitted but not
> negatively acknowledged by the peer entity shall not be included in the
> TEBS.
\- Highest priority Logical channel Buffer Status (HLBS)
> The HLBS field indicates the amount of data available from the logical
> channel identified by HLID, relative to the highest value of the buffer size
> range reported by TEBS when the reported TEBS index is not 31, and relative
> to 50000 bytes when the reported TEBS index is 31.
\- UE Power Headroom (UPH): The UPH field of a carrier on which the scheduling
information will be transmitted indicates the ratio of the maximum UE
transmission power and the calculated UE transmit power of that frequency
defined as in [18] that would result for β~e~ equal to 0\. The length of UPH
is 5 bits.
> \- Serving and Neighbour Cell Pathloss (SNPL): The field indicates the SNPL
> value of a carrier on which the scheduling information will be transmitted.
> This may be used by the Node-B to assist with its estimation of the degree
> of intercell interference each UE will generate and hence the absolute grant
> power value and physical resources to assign . The length of SNPL is 5 bits.
\- If the UE is configured with multiple carriers E-DCH operation and multi
carrier groups are configured, the following components may be included in the
scheduling information:
\- SNPL(Serving and neighbour cell pathloss) bitmap: This field indicates how
much carrier groups SNPL should be included in the scheduling information
except the SNPL of the carrier group on which the scheduling information is
transmitted, 1 indicates the carrier group SNPL should be include in the
scheduling information. The length of SNPL bitmap is 5 bits. The carrier group
index is ranked by the smallest frequency value Fsmallest of the carrier
group.The smaller the frequency Fsmallest in one carrier group is, the index
in the SNPL bitmap is more near leftmost bit.
\- SNPLi value: This indicates the i-th carrier group SNPL value, i=2..n,
n\ If the MAC entity receives inconsistent information on the E-AGCH, it shall
> ignore the entire message. The following conditions constitute inconsistent
> information:
\- The Absolute Grant Scope is \"Per HARQ process\" and the E-DCH TTI is
configured to 10ms.
\- The UE is in CELL_DCH, the Identity Type is \"Secondary\" and the Absolute
Grant Value is \"INACTIVE\".
\- The Identity Type is \"Secondary\" and the Absolute Grant Scope is \"Per
HARQ process\" in this version of the protocol.
\- The UE is in CELL_DCH, the Identity type is \"Primary\", the Absolute Grant
value is \"INACTIVE\", the Absolute Grant Scope is \"All HARQ processes\", the
E-DCH TTI is configured to 10ms and a secondary E-RNTI was not configured.
\- The UE is in CELL_FACH and the Absolute Grant Scope is \"Per HARQ process\"
and \"Per HARQ process\" scoped is not enabled by higher layers.
\- The UE is in CELL_FACH state, if \"Per HARQ process\" scope is enabled by
higher layers, the Absolute Grant Scope is \"Per HARQ process\" and the E-DCH
TTI is configured to 10 ms.
# 11 Specific functions
## 11.1 Traffic volume measurement for dynamic radio bearer control
Dynamic radio bearer control is performed by RRC, based on the traffic volume
measurements reported by MAC. Traffic volume information is measured in MAC
layer and the results are reported from MAC layer to RRC layer.
At least every TTI, the MAC layer shall receive from each RLC entity the value
of its Buffer Occupancy (BO), expressed in bytes. RRC can configure MAC to
keep track of statistics (i.e. raw BO, average of BO and variance of BO) on
the BO (see [7]) values of all Radio Bearers mapped onto a given transport
channel. When the average or variance are requested, an averaging interval
duration will also be provided.
Every time the BO values are reported to MAC, the UE shall verify whether an
event was triggered or if a periodic report is required (see [7]). If
reporting is required (multiple reports may be triggered in a single TTI), the
MAC shall deliver to RRC the reporting quantities required for the
corresponding RBs. In the case of average and variance of BO, the averaging
should be performed for the interval with the configured duration ending at
the time when the event was triggered.
RRC requests MAC measurement report with the primitive CMAC-Measure-REQ
including following parameters.
Measurement information elements.
\- Reporting Quantity identifiers\ Indicates what should be reported to RRC
layer\ For each RB, BO (optional), Average of BO (optional), or Variance of
BO(optional)
\- Time interval to take an average or a variance (applicable when Average or
Variance is Reporting Quantity)\ Indicates time interval to take an average or
a variance of BO\ The calculation of average and variance of BO shall be based
on one sample of BO per 10ms during the time interval given in this
information element. All samples taken in the time interval shall have equal
weight in the calculation.
MAC receives RLC PDUs with the primitive MAC-Data-REQ including following
parameters.
\- Buffer Occupancy (BO)\ The parameter Buffer Occupancy (BO) indicates for
each logical channel the amount of data in number of bytes that is available
for transmission and retransmission in RLC layer. When MAC is connected to an
AM RLC entity, control PDUs to be transmitted and RLC PDUs outside the RLC Tx
window shall also be included in the BO. RLC PDUs that have been transmitted
but not negatively acknowledged by the peer entity shall not be included in
the BO.
## 11.2 Control of RACH transmissions and Enhanced Uplink in CELL_FACH state
and Idle mode transmissions
The MAC sublayer is in charge of controlling the timing of RACH transmissions
on transmission time interval level (the timing on access slot level is
controlled by L1). Note that retransmissions in case of erroneously received
RACH message part are under control of higher layers, i.e. RLC, or RRC for
CCCH (and SHCCH for TDD).
In FDD, the MAC sublayer is in charge of controlling the timing of Enhanced
Uplink transmissions in CELL_FACH state and Idle mode on transmission time
interval level (the timing on access slot level is controlled by L1). Note
that after common EDCH resource allocation the transmission, retransmission
and collision resolution of MAC-i PDUs is under control of MAC.
Retransmissions in case of erroneously received MAC-is PDUs are under control
of higher layers, i.e. RLC, or RRC for CCCH.
### 11.2.1 Access Service Class selection
The physical RACH resources (i.e. access slots and preamble signatures for
FDD, timeslot and channelisation code for 3.84 Mcps TDD and 7.68 Mcps TDD,
SYNC1 code for 1.28 Mcps TDD) may be divided between different Access Service
Classes in order to provide different priorities of RACH usage. In FDD, the
physical resources for Enhanced Uplink in CELL_FACH state and Idle mode (i.e.
access slots and preamble signatures) may be divided between different Access
Service Classes in order to provide different priorities of the usage of the
Enhanced Uplink in CELL_FACH state and Idle mode. It is possible for more than
one ASC or for all ASCs to be assigned to the same access slot/signature space
or SYNC1 code.
Access Service Classes are numbered in the range 0 ≤ _i_ ≤ NumASC ≤ 7 (i.e.
the maximum number of ASCs is 8). An ASC is defined by an identifier _i_ that
defines a certain partition of the PRACH resources and an associated
persistence value _P~i~_. A set of ASC parameters consists of NumASC+1 such
parameters (_i_ , _P~i~_), _i_ = 0, ..., NumASC. The PRACH partitions and the
persistence values _P~i~_ are derived by the RRC protocol from system
information (see [7]). The set of ASC parameters is provided to MAC with the
CMAC-Config-REQ primitive. The ASC enumeration is such that it corresponds to
the order of priority (ASC 0 = highest priority, ASC 7 = lowest priority). ASC
0 shall be used in case of Emergency Call or for reasons with equivalent
priority.
At radio bearer setup/reconfiguration each involved logical channel is
assigned a MAC Logical channel Priority (MLP) in the range 1,...,8. When the
MAC sublayer is configured for RACH or common E-DCH transmission in the UE,
these MLP levels shall be employed for ASC selection on MAC.
The following ASC selection scheme shall be applied, where NumASC is the
highest available ASC number and MinMLP the highest logical channel priority
assigned to one logical channel:
\- in case all TBs in the TB set have the same MLP, select ASC = min(NumASC,
MLP);
\- in case TBs in a TB set have different priority, determine the highest
priority level MinMLP and select ASC = min(NumASC, MinMLP);
\- in case of indication of reception of HS-SCCH order for NodeB triggered HS-
DPCCH transmission from layer 1, select ASC 0.
When an RRC CONNECTION REQUEST message is sent RRC determines ASC by means of
the access class [7]. The ASC to be used in these circumstances is signalled
to MAC by means of the CMAC-CONFIG-REQ message.
If MAC has knowledge of a U-RNTI then the ASC is determined in the MAC entity.
If no U-RNTI has been indicated to MAC then MAC will use the ASC indicated in
the CMAC-CONFIG-REQ primitive.
### 11.2.2 Control of RACH transmissions for FDD mode
The RACH transmissions are controlled by the UE MAC sublayer as outlined in
figure 11.2.2.1.
NOTE: The figure shall illustrate the operation of the transmission control
procedure as specified below. It shall not impose restrictions on
implementation. MAC controls the timing of each initial preamble ramping cycle
as well as successive preamble ramping cycles in case that none or a negative
acknowledgement is received on AICH.
NOTE: In Cell-FACH state, the UE should co-ordinate the UL transmission
schedule with the measurement schedule in FACH measurement occasions so as to
minimise any delays associated with inter-frequency measurements.
MAC receives the following RACH transmission control parameters from RRC with
the CMAC-CONFIG-Req primitive:
\- a set of Access Service Class (ASC) parameters, which includes for each
ASC, i=0,...,NumASC an identification of a PRACH partition and a persistence
value _P~i~_ (transmission probability);
\- maximum number of preamble ramping cycles M~max~;
\- range of backoff interval for timer T~BO1,~ given in terms of numbers of
transmission 10 ms time intervals N~BO1max~ and N~BO1min~, applicable when
negative acknowledgement on AICH is received.
\- Fallback R99 PRACH parameters.
When there is data to be transmitted, MAC selects the ASC from the available
set of ASCs, which consists of an identifier _i_ of a certain PRACH partition
and an associated persistence value _P~i~_. The procedure to be applied for
ASC selection is described in subclause 11.2.1.
Based on the persistence value _P~i~_ , the UE decides whether to start the L1
PRACH transmission procedure (see [13]) in the present transmission time
interval or not. If transmission is allowed, the PRACH transmission procedure
(starting with a preamble power ramping cycle) is initiated by sending of a
PHY-ACCESS-REQ primitive. MAC then waits for access information from L1 via
PHY-ACCESS-CNF primitive. If transmission is not allowed, a new persistency
check is performed in the next transmission time interval. The persistency
check is repeated until transmission is permitted.
When the preamble has been acknowledged on AICH, L1 access information with
parameter value \"ready for data transmission\" is indicated to MAC with PHY-
ACCESS-CNF primitive. Also, if CCCH or DCCH fallback is configured, Fallback
transmission initiation is reported to higher layers with a CMAC-STATUS-Ind
primitive. Then data transmission is requested with PHY-DATA-REQ primitive,
and the PRACH transmission procedure shall be completed with transmission of
the PRACH message part according to L1 specifications. Successful completion
(TX status) of the MAC transmission control procedure shall be indicated to
higher layer.
When PHY indicates that no acknowledgement on AICH is received while the
maximum number of preamble retransmissions is reached (defined by parameter
Preamble_Retrans_Max on L1), a new persistency test is performed in the next
transmission time interval. The timer T~2~ ensures that two successive
persistency tests are separated by at least one 10 ms time interval.
In case that a negative acknowledgement has been received on AICH a backoff
timer T~BO1~ is started. After expiry of the timer, persistence check is
performed again. Backoff timer T~BO1~ is set to an integer number N~BO1~ of 10
ms time intervals, randomly drawn within an interval 0 ≤ N~BO1min~ ≤ N~BO1~ ≤
N~BO1max~ (with uniform distribution). N~BO1min~ and N~BO1max~ may be set
equal when a fixed delay is desired, and even to zero when no delay other than
the one due to persistency is desired.
Before a persistency test is performed it shall be checked whether any new
RACH transmission control parameters have been received from RRC with CMAC-
CONFIG-Req primitive. The latest set of RACH transmission control parameters
shall be applied.
If the maximum number of preamble ramping cycles M~max~ is exceeded, failure
of RACH transmission shall be reported to higher layer.
Both, transmission failure and successful completion of the MAC transmission
control procedure, shall be indicated individually for each logical channel of
which data was included in the transport block set of that access attempt.
When transparent mode RLC is employed (i.e. for CCCH), transmission status is
reported to RRC with CMAC-STATUS-Ind primitive. For logical channels employing
acknowledged or unacknowledged mode RLC, transmission status is reported to
RLC with MAC-STATUS-Ind primitive.
If CCCH or DCCH fallback is configured, both transmission failure of the MAC
transmission control procedure (due to e.g. Maximum number of preamble ramping
cycles reached for RACH in FDD) and transmission success upon finishing
transmission of the PRACH message part according to L1 specifications trigger
a CMAC-STATUS-Ind which informs the RRC about the Fallback transmission
termination.
Figure 11.2.2.1: RACH transmission control procedure (UE side, informative)
### 11.2.2A Control of Enhanced Uplink in CELL_FACH state and Idle mode for
FDD mode
The transmissions in Enhanced Uplink in CELL_FACH state and Idle mode are
controlled by the UE MAC sublayer as outlined in figures 11.2.2A-1, 11.2.2A-2
and 11.2.2A-3.
NOTE: The figures shall illustrate the operation of the transmission control
procedure as specified below. It shall not impose restrictions on
implementation. MAC controls the timing of each initial preamble ramping cycle
as well as successive preamble ramping cycles in case that no or a negative
acknowledgement is received carried with an AI on AICH, if the use of E-AIs is
not configured, and in case that none is received carried with an AI or a
negative acknowledgement is received carried with an E-AI, if the use of E-AIs
is configured.
MAC receives the following random access transmission control parameters from
RRC with the CMAC-CONFIG-Req primitive:
\- a set of Access Service Class (ASC) parameters, which includes for each
ASC, i=0,...,NumASC an identification of a PRACH partition and a persistence
value _P~i~_ (transmission probability);
\- maximum number of preamble ramping cycles M~max~;
\- range of backoff interval for timer T~BO1,~ given in terms of numbers of
transmission 10 ms time intervals N~BO1max~ and N~BO1min~, applicable when
negative acknowledgement is received carried with an E-AI, or carried with an
AI, when the use of E-AIs is not configured;
\- Fallback R99 PRACH parameters.
When there is data to be transmitted, or upon indication of reception of an
HS-SCCH order for NodeB triggered HS-DPCCH transmission from layer 1 and
provided there is no MAC transmission (as per subclause 11.2.2) or Enhanced
Uplink transmission (as per subclause 11.2.2A) on-going, MAC selects the ASC
from the available set of ASCs, which consists of an identifier _i_ of a
certain PRACH partition for Enhanced Uplink in CELL_FACH state and Idle mode
and an associated persistence value _P~i~_. The procedure to be applied for
ASC selection is described in subclause 11.2.1.
Based on the persistence value _P~i~_ , the UE decides whether to start the L1
physical random access procedure for E-DCH (see [13]) in the present
transmission time interval. If transmission is allowed, the physical random
access procedure for E-DCH (starting with a preamble power ramping cycle) is
initiated by sending of a PHY-ACCESS-REQ primitive. MAC then waits for access
information from L1 via PHY-ACCESS-CNF primitive. If transmission is not
allowed, a new persistency check is performed in the next transmission time
interval. The persistency check is repeated until transmission is permitted.
When PHY indicates that neither a positive nor negative acknowledgement on
AICH is received while the maximum number of preamble retransmissions is
reached (defined by parameter Preamble_Retrans_Max on L1), a new persistency
test is performed in the next transmission time interval. The timer T~2~
ensures that two successive persistency tests are separated by at least one 10
ms time interval.
In case that a negative acknowledgement has been received with an AI on AICH
if the use of E-AIs is not configured, or in case a negative acknowledgement
has been received with an E-AI on AICH if the use of E-AI is configured, after
the expiry of T~2~ a backoff timer T~BO1~ is started. After expiry of the
timer, persistence check is performed again. Backoff timer T~BO1~ is set to an
integer number N~BO1~ of 10 ms time intervals, randomly drawn within an
interval 0 ≤ N~BO1min~ ≤ N~BO1~ ≤ N~BO1max~ (with uniform distribution).
N~BO1min~ and N~BO1max~ may be set equal when a fixed delay is desired, and
even to zero when no delay other than the one due to persistency is desired.
Before a persistency test is performed it shall be checked whether any new
access transmission control parameters for Enhanced Uplink in CELL_FACH and
Idle mode have been received from RRC with the CMAC-CONFIG-Req primitive. The
latest set of random access transmission control parameters shall be applied.
If the maximum number of preamble ramping cycles M~max~ is exceeded, failure
of an Enhanced Uplink transmission in CELL_FACH state or Idle mode shall be
reported to higher layer.
If not triggered due to reception of HS-SCCH order for NodeB triggered HS-
DPCCH transmission, the procedure ends if a negative acknowledgement has been
received with an E-AI on AICH if the use of E-AI is configured, and the UE has
CCCH data to transmit on the uplink when CCCH fallback is configured or the UE
has DCCH data to transmit on the uplink when DCCH fallback is configured. MAC
provides an \"E-DCH resource index\" equal to -1 with the CMAC-STATUS-Ind
primitive to the RRC.
When the preamble has been acknowledged on AICH, then L1 access information
with parameter \"E-DCH resource index\" corresponding to the selected
signature as defined in [24] is indicated to MAC with PHY-ACCESS-CNF primitive
and the timer T~2~ is stopped. MAC provides the \"E-DCH resource index\" with
the CMAC-STATUS-Ind primitive to the RRC and receives following control
parameters from RRC with the CMAC-CONFIG-Req primitive:
\- Symbol offset S~offset~;
> \- Cell offset C~offset~;
\- Additional E-DCH transmission back off;
\- E-DCH and UL DPCCH configuration elements;
\- the maximum period for collision resolution phase, where a common E-DCH
resource can be used before collision resolution;
\- the maximum E-DCH resource allocation for CCCH;
\- E-DCH transmission continuation back off.
For transmissions due to the reception of an HS-SCCH order for NodeB triggered
HS-DPCCH transmission, the following additional parameter is received from RRC
with the CMAC-CONFIG-Req primitive:
\- HS-DPCCH transmission continuation back off.
Then DPCCH/E-DPCCH/E-DPDCH transmission is started with sending the PHY-DATA-
REQ primitive every Transmission Time Interval. The PHY-Data-REQ primitive is
used to request SDUs used for communications passed to the physical layer.
Hereby, if TTI length is 10 ms, then for the first (1 + \"Additional E-DCH
transmission back off\") Transmission Time Intervals no SDU is passed to the
physical layer, i.e. only DPCCH transmission takes place. If TTI length is 2
ms, then for the first (2 + \"Additional E-DCH transmission back off\")
Transmission Time Intervals no SDU is passed to the physical layer.
The allocated common E-DCH resource shall be used by MAC to carry either only
CCCH transmission or only DTCH/DCCH transmission, but not both. For NodeB
triggered HS-DPCCH transmission, the allocated common E-DCH resource shall be
used by MAC to carry DTCH/DCCH transmission if uplink data arrives in the UE
buffer. In case of CCCH transmission, the maximum E-DCH resource allocation
for CCCH, and in case of DCCH/DTCH or NodeB triggered HS-DPCCH transmissions,
the maximum period for collision resolution phase is calculated from the
allowed start time of the E-DCH transmission. The allowed start time of the
E-DCH transmission is (1 + \"Additional E-DCH transmission back off\") TTIs
for 10 ms TTI and (2 + \"Additional E-DCH transmission back off\") TTIs for 2
ms TTI after the start of the DPCCH transmission.
The E-DCH enhanced physical random access transmission procedure is completed
with release of the allocated common E-DCH resource, if one of the following
conditions is fullfilled:
\- If the UE according to subclause 8.5.4A in [7] failed to establish the
physical channels, or if the criteria for radio link failure are met as
specified in subclause 8.5.6 in [7], then the timer T~2~ is started. After the
expiry of T~2~ a backoff timer T~BO1~ is started. Backoff timer T~BO1~ is set
to an integer number N~BO1~ of 10 ms time intervals, randomly drawn within an
interval 0 ≤ N~BO1min~ ≤ N~BO1~ ≤ N~BO1max~ (with uniform distribution).
N~BO1min~ and N~BO1max~ may be set equal when a fixed delay is desired, and
even to zero when no delay other than the one due to persistency is desired.
The procedure ends if timer T~BO1~ expires or the UE performs cell reselection
while timer T~BO1~ is running, whatever occurs first. In case of a cell
reselection, the timer T~BO1~ is stopped.
\- In case of CCCH transmission, if the maximum E-DCH resource allocation for
CCCH has been reached, then this triggers a CMAC-STATUS-Ind which informs the
RRC about the Enhanced Uplink in CELL_FACH state and Idle mode process
termination.
\- In case of CCCH transmission, when the MAC-i PDU containing the last MAC-c
PDU is being transmitted, TEBS = 0 byte is reported to the Node B MAC as SI in
a MAC-i PDU and the MAC-STATUS-Ind primitive indicates to RLC for each logical
channel that no PDU shall be transferred to MAC. When the empty buffer status
has been reported and no MAC-i PDUs are left for (re-)transmission in MAC,
then this triggers a CMAC-STATUS-Ind which informs the RRC about the Enhanced
Uplink in CELL_FACH state and Idle mode process termination.
\- In case of DTCH/DCCH or NodeB triggered HS-DPCCH transmission, if no E-AGCH
with UE's E-RNTI has been received (through an E-RNTI-specific CRC attachment)
within the maximum period for collision resolution phase, then this triggers a
CMAC-STATUS-Ind which informs the RRC about the Enhanced Uplink in CELL_FACH
state and Idle mode process termination. Then the timer T~2~ is started. After
the expiry of T~2~ a backoff timer T~BO1~ is started. Backoff timer T~BO1~ is
set to an integer number N~BO1~ of 10 ms time intervals, randomly drawn within
an interval 0 ≤ N~BO1min~ ≤ N~BO1~ ≤ N~BO1max~ (with uniform distribution).
N~BO1min~ and N~BO1max~ may be set equal when a fixed delay is desired, and
even to zero when no delay other than the one due to persistency is desired.
The procedure ends when T~BO1~ expires.
\- Explicit common E-DCH resource release:\ In case of DTCH/DCCH or NodeB
triggered HS-DPCCH transmission, if an E-AGCH with UE's E-RNTI has been
received (through an E-RNTI-specific CRC attachment) with absolute grant value
set to \'INACTIVE\', then this triggers a CMAC-STATUS-Ind which informs the
RRC about the Enhanced Uplink in CELL_FACH state and Idle mode process
termination.
\- Implicit release with E-DCH transmission continuation backoff\ For NodeB
triggered HS-DPCCH transmission, or for DTCH/DCCH transmission upon indication
of reception of HS-SCCH order for NodeB triggered HS-DPCCH transmission from
layer 1, the UE shall:
\- If \"HS-DPCCH transmission continuation back off\" is present, set \"E-DCH
transmission continuation back off\" equal to MAX(\"E-DCH transmission
continuation back off\", \"HS-DPCCH transmission continuation back off\") and
use this value instead for the ongoing transmission
NOTE: MAX(\"infinity\", any numerical value) = \"infinity\".
\- If \"HS-DPCCH transmission continuation back off\" is not present, set
\"E-DCH transmission continuation back off\" equal to \"infinity\" and use
this value instead for the ongoing transmission
Implicit resource release is enabled only if \"E-DCH transmission continuation
back off\" is not set to \"infinity\".\ If implicit resource release is
enabled, then in case of DTCH/DCCH transmission, the timer Tb is set to
\"E-DCH transmission continuation back off\" value, when TEBS is 0 byte and
the last generated MAC-i PDU with higher layer data is provided with the PHY-
data-REQ primitive to the physical layer for transmission.\ If TEBS \<> 0 byte
is detected while timer Tb is running, then the timer is stopped and uplink
data transmission on the common E-DCH resource continues.\ If a MAC-ehs PDU is
received while timer Tb is running, then the timer is re-started.\ If the
transmission procedure is triggered due to data on the uplink, then upon
indication of reception of HS-SCCH order for NodeB triggered HS-DPCCH
transmission from layer 1, the timer Tb is re-started, if running.\ If the
\"E-DCH transmission continuation back off\" value is set to \"0\" or if timer
Tb expires the MAC-STATUS-Ind primitive indicates to RLC for each logical
channel that no PDUs shall be transferred to MAC. TEBS = 0 byte is reported to
the Node B MAC as SI in a MAC-i PDU. If the \"E-DCH transmission continuation
back off\" value is set to \"0\", then the SI shall be transmitted with the
MAC-i PDU carrying the last DCCH/DTCH data, given the serving grant is
sufficient to carry the SI in the same MAC-i PDU together with the remaining
DCCH/DTCH data. Otherwise, the empty buffer status report is transmitted
separately with the next MAC-i PDU.\ CMAC-STATUS-Ind which informs the RRC
about the Enhanced Uplink in CELL_FACH state and Idle mode process termination
is triggered when the empty buffer status has been reported and no MAC-i PDU
is left in any HARQ process for (re-)transmission.
\- Implicit release with HS-DPCCH transmission continuation backoff\ If the
common E-DCH resource is allocated for NodeB triggered HS-DPCCH transmission,
then implicit resource release is additionally enabled if \"HS-DPCCH
transmission continuation back off\" is present.\ The timer Tbhs is set to
\"HS-DPCCH transmission continuation back off\" value at the allowed start
time of the E-DCH transmission.\ If TEBS \<> 0 byte is detected while timer
Tbhs is running, then the timer Tbhs is stopped.\ If a MAC-ehs PDU is received
while timer Tbhs is running, then the timer is re-started.\ Once timer Tbhs is
stopped, it is not started anymore for the duration of that E-DCH enhanced
physical random access transmission procedure.\ If timer Tbhs expires, the
MAC-STATUS-Ind primitive indicates to RLC for each logical channel that no
PDUs shall be transferred to MAC. TEBS = 0 byte is reported to the Node B MAC
as SI in a MAC-i PDU.\ CMAC-STATUS-Ind which informs the RRC about the
Enhanced Uplink in CELL_FACH state and Idle mode process termination is
triggered when the empty buffer status has been reported and no MAC-i PDU is
left in any HARQ process for (re-)transmission.
Figure 11.2.2A-1: Enhanced Uplink in CELL_FACH state and Idle mode
transmission control procedure (UE side, informative) with Fallback to R99
PRACH, Part I
Figure 11.2.2A-2: Enhanced Uplink in CELL_FACH state and Idle mode
transmission control procedure (UE side, informative), Part II for CCCH
transmission
Figure 11.2.2A-3: Enhanced Uplink in CELL_FACH state and Idle mode
transmission control procedure (UE side, informative), Part II for DTCH/DCCH
transmission
### 11.2.3 Control of RACH transmissions for TDD
#### 11.2.3.1 Control of RACH transmissions for 3.84 Mcps TDD and 7.68 Mcps
TDD
The RACH transmissions are performed by the UE as shown in figure 11.2.3.2.
NOTE: The figure shall illustrate the operation of the transmission control
procedure as specified below. It shall not impose restrictions on
implementation.
MAC receives the following RACH transmission control parameters from RRC with
the CMAC-Config-REQ primitive:
\- a set of Access Service Class (ASC) parameters, which includes for each
ASC, i=0,...,NumASC an identification of a PRACH partition and a persistence
value _P~i~_ (transmission probability).
When there is data to be transmitted, MAC selects the ASC from the available
set of ASCs, which consists of an identifier _i_ of a certain PRACH partition
and an associated persistence value _P~i~_. The procedure to be applied for
ASC selection is described in subclause 11.2.1.
In order to separate different ASCs each PRACH has N sub-channels associated
with it (numbered from 0 to N-1). N may be assigned the value 1,2,4, or 8 by
higher layer signalling. Sub-channel i for a PRACH defined in timeslot k is
defined as the k:th slot in the frames where SFN mod N = i. Therefore follows
the definition:
\- Sub-channel i associated to a PRACH defined in timeslot k is defined as the
k:th timeslot in the frames where SFN mod N = i.
Figure 11.2.3.1 illustrates the eight possible subchannels for the case, N=8.
For illustration, the figure assumes that the PRACH is assigned timeslot 3.
Figure 11.2.3.1 Eight sub-channels for timeslot 3
Based on the persistence value P, the UE decides whether to send the message
on the RACH. If transmission is not allowed, a new persistency check is
performed in the next transmission time interval. The persistency check is
repeated until transmission is permitted. If transmission is allowed, a
subchannel is randomly selected from the set of available subchannels for this
ASC. The random subchannel selection shall be such that each of the allowed
selections is chosen with equal probability. If an available subchannel is not
found, the persistency check and subchannel assignment is repeated for the
next subchannel period. If an available subchannel is found the PRACH
transmission procedure is initiated by sending of a PHY-Data-REQ primitive.
Successful completion (TX status) of the MAC transmission control procedure
shall be indicated to higher layer individually for each logical channel of
which data was included in the transport block set of that access attempt.
When transparent mode RLC is employed (i.e. for CCCH), transmission status is
reported to RRC with CMAC-STATUS-Ind primitive. For logical channels employing
acknowledged or unacknowledged mode RLC, transmission status is reported to
RLC with MAC-STATUS-Ind primitive.
Figure 11.2.3.2: RACH transmission control procedure for TDD (UE side,
informative)
##### 11.2.3.1.1 Control of E-RUCCH transmissions
The MAC-e sublayer is in charge of controlling the timing of E-RUCCH
transmission.
MAC receives the following E-RUCCH transmission control parameters from RRC
with the CMAC-Config-REQ primitive:
\- a set of Access Service Class (ASC) parameters, which includes for each
ASC, i=0,...,NumASC a persistence value _P~i~_ (transmission probability).
When there is data to be transmitted, MAC selects the ASC from the available
set of ASCs, which consists of an identifier _i_ of a persistence value
_P~i~_. The procedure to be applied for ASC selection is described in
subclause 11.2.3.1.1.1.
If this is the first transmission of the E-RUCCH, i.e. timer T-RUCCH (as
described in 11.9.1.4a) is not currently running, then the persistence value
will be assumed to be 1, otherwise it will be the value associated with the
chosen ASC. The persistence value will then be used in the same way as
described for RACH transmissions as defined in section 11.2.3.1.
> Note that unlike RACH transmissions no partitioning of the E-RUCCH resource
> based on ASC will be implemented..
##### 11.2.3.1.1.1 Access Service Class selection {#access-service-class-
selection-1 .H6}
For E-RUCCH transmission, the following ASC selection scheme shall be applied:
\- select ASC = min (NumASC, MinMLP);
Where NumASC is the highest available ASC number and MinMLP is the highest
priority level of the logical channels which have data buffered for
transmission.
#### 11.2.3.2 Control of RACH Transmissions for 1.28 Mcps TDD
The RACH transmissions are performed by the UE as shown in figure 11.2.3.3.
NOTE: The figure shall illustrate the operation of the transmission control
procedure as specified below. It shall not impose restrictions on
implementation.
UE MAC receives the following RACH transmission control parameters from RRC
with the CMAC-Config-REQ primitive:
\- a set of Access Service Class (ASC) parameters, which includes for each
ASC, i=0,...,NumASC an identification of a PRACH partition and a persistence
value _P~i~_ (transmission probability),
\- maximum number of synchronisation attempts Mmax.
When there is data to be transmitted, MAC selects the ASC from the available
set of ASCs, which consists of an identifier _i_ of a certain PRACH partition
and an associated persistence value _P~i~_.
Based on the persistence value P~i~, MAC decides whether to start the L1 PRACH
procedure in the present transmission time interval or not. If transmission is
allowed, the PRACH transmission procedure (starting with the SYNC_UL/FPACH
power ramping sequence) is initiated by the sending of a PHY-ACCESS-REQ
primitive. MAC then waits for access information from L1 via the PHY-ACCESS-
CNF primitive. If transmission is not allowed, a new persistency check is
performed in the next transmission time interval. The persistency check is
repeated until transmission is permitted.
If a synchronisation burst has been acknowledged on its associated FPACH, PHY
will inform MAC by a PHY-ACCESS-CNF primitive indicating \"ready for RACH data
transmission\". Then MAC requests data transmission with a PHY-DATA-REQ
primitive, and the PRACH transmission procedure will be completed with
transmission on the PRACH resources associated with the FPACH.
Successful completion of the MAC procedure is indicated to higher layer
individually for each logical channel of which data was included in the
transport block set of that access attempt. When transparent mode RLC is
employed (i.e. for CCCH), transmission status is reported to RRC with CMAC-
STATUS-Ind primitive. For logical channels employing acknowledged or
unacknowledged mode RLC, transmission status is reported to RLC with MAC-
STATUS-Ind primitive.
If no synchronisation burst received an acknowledgement on the FPACH within
the maximum number of transmissions permitted in a power ramping cycle, PHY
will inform MAC by a PHY-ACCESS-CNF primitive indicating \"no response
received on FPACH\". If the maximum number of synchronisation attempts
permitted, Mmax, has not been exceeded, then MAC commences a new persistency
test sequence in the next transmission time interval and the PHY-ACCESS-REQ
procedure is repeated. The timer T~2~ ensures that two successive persistency
tests are separated by at least one transmission time interval. If the maximum
number of synchronisation attempts is exceeded then MAC abandons the RACH
procedure. Failure to complete the MAC procedure is indicated to higher layer
by the CMAC-STATUS-Ind or MAC-STATUS-Ind primitives.
Figure 11.2.3.3: RACH transmission control procedure for 1.28 Mcps TDD\ (UE
side, informative)
##### 11.2.3.2.1 Control of E-RUCCH transmissions
The MAC-e or MAC-i sublayer is in charge of controlling the timing of E-RUCCH
transmission.
MAC receives the following E-RUCCH transmission control parameters from RRC
with the CMAC-Config-REQ primitive:
\- a set of Access Service Class (ASC) parameters, which includes for each
ASC, i=0,...,NumASC a persistence value Pi (transmission probability).
\- maximum number of synchronisation attempts Mmax.
When there is E-RUCCH transmission to be initiated, MAC selects the ASC from
the available set of ASCs, which consists of an identifier i of a persistence
value Pi. The procedure to be applied for ASC selection is described in
subclause 11.2.3.2.1.1.
The persistence value will be the value associated with the chosen ASC. The
persistence value will then be used in the same way as described for RACH
transmissions as defined in section 11.2.3.2.
If an E-RNTI change occurs in the serving cell and the Scheduling Information
reporting via E-RUCCH is needed (described in 11.9.1.5), the ongoing E-RUCCH
transmission shall be cancelled and a new E-RUCCH transmission shall be
triggered.
For UE in CELL_FACH state with E-DCH transmission, in case of Cell Reselection
Indication sending via E-RUCCH or response to synchronization establishment
command via E-RUCCH [18], N_RUCCH shall be assumed to zero, i.e, E-RUCCH
retransmission is not needed. In case of Cell Reselection Indication sending
via E-RUCCH, the maximum number of synchronisation attempts Mmax shall be
assumed to 1.
For UE in CELL_FACH state with E-DCH transmission, control of E-RUCCH
transmission procedure triggered by different events shall be co-operated as
below:
\- If Cell Reselection Indication via E-RUCCH is involved:
\- During the E-RUCCH transmission procedure triggered by Cell Reselection
Indication (described in 11.9.1.5a) ongoing, another E-RUCCH transmission
shall not be triggered by any event.
\- During the E-RUCCH transmission procedure triggered by any event other than
Cell Reselection Indication ongoing, if Cell Reselection Indication via
E-RUCCH needs to be sent, the ongoing E-RUCCH transmission shall be cancelled
and a new E-RUCCH transmission triggered by Cell Reselection Indication shall
be initiated.
\- Else
\- During the E-RUCCH transmission procedure triggered by Scheduling
Information reporting (described in 11.9.1.5) ongoing, E-RUCCH transmission
shall not be triggered by synchronization establishment command.
\- During the E-RUCCH transmission procedure triggered as response to
synchronization establishment command, if Scheduling Information reporting via
E-RUCCH is needed, the ongoing E-RUCCH transmission shall be cancelled and
Scheduling Information reporting via E-RUCCH shall be initiated according to
the UE's current status as described in 11.9.1.5.
If one of the following criteria for E-RUCCH transmission are met, failure
indication of the E-RUCCH transmission is sent to RRC by the CMAC-STATUS-Ind
primitive with E-RUCCH failure:
\- The maximum number Mmax of synchronisation attempts is reached;
\- When the hysteresis timer with the value of N-RUCCH times of T-RUCCH
period, which is started when the E-RUCCH transmission counter is reached to
N_RUCCH, is expired.
###### 11.2.3.2.1.1 Access Service Class selection
For E-RUCCH transmission, the following ASC selection scheme shall be applied:
\- select ASC = min (NumASC, MinMLP);
Where NumASC is the highest available ASC number and MinMLP is the highest
logical channel priority of the logical channel which has data buffered for
transmission. In case that there is no data buffered for transmission, MinMLP
shall be assumed to the highest logical channel priority of all the logical
channels configured for the UE.
###### 11.2.3.2.1.2 Void
## 11.3 Void
## 11.4 Transport format combination selection in UE (non E-DCH)
RRC can control the scheduling of uplink data by giving each logical channel a
priority between 1 and 8, where 1 is the highest priority and 8 the lowest.
TFC selection in the UE shall be done in accordance with the priorities
indicated by RRC. Logical channels have absolute priority, i.e. the UE shall
maximise the transmission of higher priority data.
If the uplink TFCS or TFC Subset configured by UTRAN follows the guidelines
described in [7] the UE shall perform the TFC selection according to the rules
specified below. If these guidelines are not followed then the UE behaviour is
not specified.
A given TFC can be in any of the following states:
\- Supported state;
\- Excess-power state;
\- Blocked state.
TDD mode UEs in CELL_FACH state using the USCH transport channel and UEs in
CELL_DCH state using a DCH shall continuously monitor the state of each TFC
based on its required transmit power versus the maximum UE transmit power (see
[7]). The state transition criteria and the associated requirements are
described in [12, 14]. The UE shall consider that the Blocking criterion is
never met for TFCs included in the minimum set of TFCs (see [7]).
The following diagram illustrates the state transitions for the state of a
given TFC:
Figure 11.4.1: State transitions for the state of a given TFC
FDD Mode UEs in CELL_FACH state may estimate the channel path loss and set to
excess power state all the TFCs requiring more power than the Maximum UE
transmitter power (see [7]). All other TFCs shall be set to Supported state.
Every time the set of supported TFCs changes, the available bitrate shall be
indicated to upper layers for each logical channel in order to facilitate the
adaptation of codec data rates when codecs supporting variable-rate operation
are used. The details of the computation of the available bitrate and the
interaction with the application layer are not further specified.
Before selecting a TFC, i.e. at every boundary of the shortest TTI, or prior
to each transmission on PRACH the set of valid TFCs shall be established. All
TFCs in the set of valid TFCs shall:
1\. belong to the TFCS.
1a. not be restricted by higher layer signalling (e.g. TFC Control, see [7]).
2\. not be in the Blocked state.
3\. be compatible with the RLC configuration.
4\. not require RLC to produce padding PDUs (see [6] for definition).
5\. not carry more bits than can be transmitted in a TTI (e.g. when compressed
mode by higher layer scheduling is used and the presence of compressed frames
reduces the number of bits that can be transmitted in a TTI using the Minimum
SF configured).
The UE may remove from the set of valid TFCs, TFCs in Excess-power state in
order to maintain the quality of service for sensitive applications (e.g.
speech). However, this shall not apply to TFCs included in the minimum set of
TFCs (see [7]). Additionally, if compressed frames are present within the
longest configured TTI to which the next transmission belongs, the UE may
remove TFCs from the set of valid TFCs in order to account for the higher
power requirements.
The chosen TFC shall be selected from within the set of valid TFCs and shall
satisfy the following criteria in the order in which they are listed below:
1\. No other TFC shall allow the transmission of more highest priority data
than the chosen TFC.
2\. No other TFC shall allow the transmission of more data from the next lower
priority logical channels. Apply this criterion recursively for the remaining
priority levels.
3\. No other TFC shall have a lower bit rate than the chosen TFC.
In FDD mode the above rules for TFC selection in the UE shall apply to DCH,
and the same rules shall apply for TF selection on RACH.
In 3.84 Mcps TDD mode and in 7.68 Mcps TDD mode the above rules for TFC
selection in the UE shall apply to DCH and USCH.
## 11.5 Ciphering
The ciphering function is performed in MAC (i.e. only in MAC-d) if a radio
bearer is using the transparent RLC mode. The part of the MAC PDU that is
ciphered is the MAC SDU and this is shown in Figure 11.5.1 below.
Figure 11.5.1: Ciphered part unit for a MAC PDU
In case a TTI contains multiple MAC PDUs for a given Transparent mode RB, the
ciphering unit for this RB is the bitstring concatenation of all the MAC SDUs,
resulting in the PLAINTEXT BLOCK, as defined in [15]. In case there is only
one MAC PDU for a given Transparent mode RB, the ciphering unit is the MAC
SDU, resulting in the PLAINTEXT BLOCK. The concatenation order is the same as
the order of transmission of the Transport Blocks between MAC and Physical
layer.
The KEYSTREAM BLOCK as defined in [10] is applied to the PLAINTEXT BLOCK, and
the end result, CIPHERTEXT BLOCK, becomes the ciphered part for the MAC PDU,
in case there is only one MAC PDU per RB. In case there is more than one MAC
PDU per RB, the CIPHERTEXT BLOCK is split into the corresponding ciphered
parts for each MAC PDU. The split order is the same as the order of
transmission of the Transport Blocks between MAC and Physical layer.
The ciphering algorithm and key to be used are configured by upper layers [7]
and the ciphering method shall be applied as specified in [10].
The parameters that are required by MAC for ciphering are defined in [10] and
are input to the ciphering algorithm. The parameters required by MAC which are
provided by upper layers [7] are listed below:
\- MAC-d HFN (Hyper frame number for radio bearers that are mapped onto
transparent mode RLC)
\- BEARER defined as the radio bearer identifier in [10]. It will use the
value RB identity --1 as in [7])
\- CK (Ciphering Key)
If the TTI consists of more than one 10 ms radio frame, the CFN of the first
radio frame in the TTI shall be used as input to the ciphering algorithm for
all the data in the TTI.
## 11.6 Control of HS-DSCH transmission and reception
If MAC-hs is configured by upper layers [7], the control of HS-DSCH
transmission and reception is defined in subclauses 11.6.1 and 11.6.2.
If MAC-ehs version is configured by upper layers [7], the control of HS-DSCH
transmission and reception is defined in subclauses 11.6.3 and 11.6.4.
### 11.6.1 Network operation
The following are the functions of the various functional entities at the
network in support of the HARQ protocol used on HS-DSCH when MAC-hs is
configured by upper layers [7].
#### 11.6.1.1 Scheduler
The scheduler performs the following functions:
\- Schedules all UEs within a cell;
\- Services priority queues:
\- The scheduler schedules MAC-hs SDUs based on information from upper layers.
One UE may be associated with one or more MAC-d flows. Each MAC-d flow
contains HS-DSCH MAC-d PDUs for one or more priority queues.
\- Determines the HARQ Entity and the queue to be serviced;
  * Sets the TSN for new data blocks being transferred from the selected queue;
> \- set the TSN to value 0 for the first MAC-hs PDU transmitted for each
> Queue ID within an HS-DSCH;
>
> \- increment the TSN with one for each transmitted MAC-hs PDU on each Queue
> ID within an HS-DSCH.
NOTE: In 1.28 Mcps TDD multi-frequency HS-DSCH cell, the length of TSN can be
6 bits or 9 bits based on the configuration of higher layer.
NOTE: The scheduler may re-use TSNs by toggling the NDI bit in order to resume
pre-empted transmissions or to force the UE to flush the soft buffer. In this
case the content of the payload may be changed but care should be taken to
preserve the higher layer data order.
\- Indicates the Queue ID and TSN to the HARQ entity for each MAC-hs PDU to be
transmitted;
\- Schedules new transmissions and retransmissions:
\- Based on the status reports from HARQ Processes the scheduler determines if
either a new transmission or a retransmission should be made. A new
transmission can however be initiated on a HARQ process at any time. Based on
a delay attribute provided by upper layers, the scheduler may decide to
discard any \'out-of-date\' MAC-hs SDU.
\- Determines the redundancy version:
\- The scheduler determines a suitable redundancy version for each transmitted
and retransmitted MAC-hs PDU and indicates the redundancy version to lower
layer.
> \- Determines the TDD HCSN:
\- Increment UE specific HCSN for each HS-SCCH transmission. In 1.28Mcps TDD
multi-frequency HS-DSCH cell, UE maintains the respective HCSN for each
carrier independently.
NOTE: For TDD, the scheduler should not schedule the UE who is in the idle
interval. For 1.28Mcps TDD, the scheduler should not schedule the UE who is in
the measurement occasion.
#### 11.6.1.2 HARQ entity
\- There is one HARQ entity per UE in UTRAN. In 1.28 Mcps TDD multi-frequency
HS-DSCH cell, HARQ entity consists of some HARQ sub-entities, each sub-entity
is associated with one carrier.
\- The HARQ entity sets the Queue ID in transmitted MAC-hs PDUs to the value
indicated by the UTRAN scheduler.
\- The HARQ entity sets the transmission sequence number (TSN) in transmitted
MAC-hs PDUs to the value indicated by the UTRAN scheduler.
\- The HARQ entity sets the HARQ process identifier in transmitted MAC-hs
PDUs. UTRAN should:
\- determine a suitable HARQ process to service the MAC-hs PDU and set the
HARQ process identifier accordingly.
#### 11.6.1.3 HARQ process
\- The HARQ process sets the New data indicator in transmitted MAC-hs PDUs.
UTRAN should:
\- set the New Data Indicator to the value \"0\" for the first MAC-hs PDU
transmitted by a HARQ process;
\- not increment the New Data Indicator for retransmissions of a MAC-hs PDU;
\- increment the New Data Indicator with one for each transmitted MAC-hs PDU
containing new data.
\- The HARQ process processes received status messages. UTRAN should:
\- deliver received status messages to the scheduler.
### 11.6.2 UE operation
The UE operation in support of the HARQ protocol used on HS-DSCH is split
among the following four functional units with their associated functions.
#### 11.6.2.1 HARQ Entity
There is one HARQ entity at the UE which processes the HARQ process
identifiers received on the HS-SCCH transmissions associated with MAC-hs PDUs
received on the HS-DSCH.
In 1.28 Mcps TDD multi-frequency HS-DSCH cell, HARQ sub-entity is configured
at UE per carrier where HS-DSCH is configured. The associated downlink control
channel and uplink control channel pair controlling the HS-DSCH transmission
on the certain carrier shall be allocated on the same carrier. The downlink
control channel carries the HS-DSCH operation related info and the uplink
control channel carries the feedback info from the UE side. In 1.28 Mcps TDD
single frequency or multi-frequency HS-DSCH cell, HARQ entity or HARQ sub-
entity is configured to handle the HARQ identity associated with the received
MAC-hs PDU from every carrier where HS-DSCH is configured at UE side.
A number of parallel HARQ processes are used in the UE to support the HARQ
entity. The number of HARQ processes is configured by upper layers:
\- Each received MAC-hs PDU shall be allocated to the HARQ process indicated
by the HARQ process identifier of the MAC-hs PDU.
#### 11.6.2.2 HARQ process
The HARQ process processes the New Data Indicator indicated by lower layers
for each received MAC-hs PDU.
The UE may:
\- for FDD, if the MAC-hs PDU is received within 5 sub-frames from the
reception of the previous MAC-hs PDU intended for this HARQ process; or
\- for TDD, if the MAC-hs PDU is received before generation of feedback
resulting from reception of a previous MAC-hs PDU for the same H-ARQ process:
\- discard the MAC-hs PDU.
The UE shall:
\- if the New Data Indicator has been incremented compared to the value in the
previous received transmission in this HARQ process or this is the first
received transmission in the HARQ process:
\- replace the data currently in the soft buffer for this HARQ process with
the received data.
\- if the Transport Block Size index value is equal to 111111 (FDD only):
\- generate a positive acknowledgement (ACK) of the data in this HARQ process;
\- discard the received data;
> \- assume that the data has been successfully decoded.
\- if the New Data Indicator is identical to the value used in the previous
received transmission in the HARQ process:
\- if the Transport Block Size index value is equal to 111111 (FDD only):
\- assume that the transport block size is identical to the last valid
transport block size signalled for this HARQ process.
\- if the data has not yet been successfully decoded:
\- combine the received data with the data currently in the soft buffer for
this HARQ process.
\- if the transport block size is different from the last valid transport
block size signalled for this HARQ process:
\- the UE may replace the data currently in the soft buffer for this HARQ
process with the received data.
\- if the data in the soft buffer has been successfully decoded and no error
was detected:
\- deliver the decoded MAC-hs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data in this HARQ process.
\- else:
\- generate a negative acknowledgement (NAK) of the data in this HARQ process;
\- For FDD, schedule the generated positive or negative acknowledgement for
transmission and the time of transmission relative to the reception of data in
a HARQ process is configured by upper layer.
\- For TDD, if UE is not in the idle interval, schedule the generated positive
or negative acknowledgement for transmission and the time of transmission
relative to the reception of data in a HARQ process is configured by upper
layer.
\- For 1.28Mcps TDD, if UE is not in the measurement occasion, schedule the
generated positive or negative acknowledgement for transmission and the time
of transmission relative to the reception of data in a HARQ process is
configured by upper layer.
The HARQ process processes the Queue ID in the received MAC-hs PDUs. The UE
shall:
\- arrange the received MAC-hs PDUs in queues based on the Queue ID.
#### 11.6.2.3 Reordering entity
##### 11.6.2.3.1 Definitions
In the functions described in this section the following definitions apply:
**Parameters**
\- Transmitter window size (TRANSMIT_WINDOW_SIZE)\ TRANSMIT_WINDOW_SIZE is the
size of the transmitter window according to the definition below. This is a
parameter in the Node B and the value of the parameter is configured by higher
layers.
> \- Receiver window size (RECEIVE_WINDOW_SIZE)\ RECEIVE_WINDOW_SIZE is the
> size of the receiver window according to the definition below. This is a
> parameter in the UE and the value of the parameter is configured by higher
> layers.
**State variables**
All state variables are non-negative integers. MAC-hs PDUs are numbered by
modulo integer Transmission sequence numbers (TSN) cycling through the field 0
to 63. All arithmetic operations contained in the present document on
next_expected_TSN, RcvWindow_UpperEdge, T1_TSN and TSN_flush are affected by
the 64 modulus. When performing arithmetic comparisons of state variables or
Transmission sequence number values a 64 modulus base shall be used. This
modulus base is subtracted (within the appropriate field) from all the values
involved and then an absolute comparison is performed. RcvWindow_UpperEdge --
RECEIVE_WINDOW_SIZE + 1 shall be assumed to be the modulus base. For 1.28 Mcps
TDD multi-frequency HS-DSCH operation operation mode, TSN_MAX represents
period length of TSN; the arithmetic operations and comparisons of state
variables in multi-frequency mode are performed on TSN_MAX modulus base.
\- next_expected_TSN:\ The next_expected_TSN is the Transmission sequence
number (TSN) following the TSN of the last in-sequence MAC-hs PDU received. It
shall be updated according to the procedures given in subclauses 11.6.2.3.2,
11.6.2.5 and 11.6.2.6. The initial value of next_expected_TSN =0.
\- RcvWindow_UpperEdge:\ The RcvWindow_UpperEdge represents the TSN, which is
at the upper edge of the receiver window. After the first MAC-hs PDU has been
received successfully, it also corresponds to the MAC-hs PDU with the highest
TSN of all received MAC-hs PDUs. The initial RcvWindow_UpperEdge equals 63.
RcvWindow_UpperEdge is updated based on the reception of new MAC-hs PDU
according to the procedure given below.
\- T1_TSN:\ The TSN of the latest MAC-hs PDU that cannot be delivered to the
disassembly entity, when the timer T1 is started.
\- TSN_MAX (1.28Mcps TDD multi-frequency HS-DSCH operation mode only):
TSN_MAX represents the periodicty of TSN for 1.28Mcps TDD multi-frequency HS-
DSCH operation mode, the possible value is 64 or 512.
**Timers**
\- Re-ordering release timer (T1):\ The Re-ordering release timer T1 controls
the stall avoidance in the UE reordering buffer as described below. The value
of T1 is configured by upper layers.
**Other definitions**
\- Receiver window:\ The receiver window defines TSNs of those MAC-hs PDUs
that can be received in the receiver without causing an advancement of the
receiver window according to the procedure below. The size of the receiver
window equals RECEIVE_WINDOW_SIZE and spans TSNs going from
RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE + 1 to RcvWindow_UpperEdge
included.
##### 11.6.2.3.2 Reordering functionality
If no timer T1 is active:
\- the timer T1 shall be started when a MAC-hs PDU with TSN >
next_expected_TSN is correctly received.
\- T1_TSN shall be set to the TSN of this MAC-hs PDU.
If a timer T1 is already active:
\- no additional timer shall be started, i.e. only one timer T1 may be active
at a given time.
The timer T1 shall be stopped if:
\- the MAC-hs PDU with TSN = T1_TSN can be delivered to the disassembly entity
before the timer expires.
When the timer T1expires and T1_TSN > next_expected_TSN:
\- all correctly received MAC-hs PDUs with TSN > next_expected_TSN up to and
including T1_TSN-1 shall be delivered to the disassembly entity;
\- all correctly received MAC-hs PDUs up to the next not received MAC-hs PDU
shall be delivered to the disassembly entity.
\- next_expected_TSN shall be set to the TSN of the next not received MAC-hs
PDU.
When the timer T1 is stopped or expires, and there still exist some received
MAC-hs PDUs that can not be delivered to higher layer:
\- timer T1 is started
\- set T1_TSN to the highest TSN among those of the MAC-hs PDUs that can not
be delivered.
**Transmitter operation:**
After the transmitter has transmitted a MAC-hs PDU with TSN=SN, any MAC-hs PDU
with TSN ≤ SN -- TRANSMIT_WINDOW_SIZE should not be retransmitted to avoid
sequence number ambiguity in the receiver.
**Receiver operation:**
When a MAC-hs PDU with TSN = SN is received:
\- if SN is within the receiver window:
\- if SN \ \- deliver all correctly received MAC-hs PDUs with TSN \ disassembly entity;
\- if the MAC-hs PDU with TSN=TSN_flush has previously been received:
\- deliver all received MAC-hs PDUs with consecutive TSNs from TSN_flush
(included) up to the first not received MAC-hs PDU to the disassembly entity;
\- advance next_expected_TSN to the TSN of this first not received MAC-hs PDU.
\- else:
\- set next_expected_TSN to TSN_flush.
#### 11.6.2.4 Disassembly entity
For each MAC-hs PDU that is delivered to the disassembly entity, the UE shall:
\- remove any padding bits if present;
\- remove the MAC-hs header;
\- deliver the MAC-d PDUs in the MAC-hs PDU to MAC-d.
#### 11.6.2.5 MAC-hs Reset
If a reset of the MAC-hs entity is requested by upper layers, the UE shall at
the activation time indicated by higher layers:
\- flush soft buffer for all configured HARQ processes;
\- stop all active re-ordering release timer (T1) and set all timer T1 to
their initial value;
\- start TSN with value 0 for the next transmission on every configured HARQ
process;
\- initialise the variables RcvWindow_UpperEdge and next_expected_TSN to their
initial values;
\- disassemble all MAC-hs PDUs in the re-ordering buffer and deliver all MAC-d
PDUs to the MAC-d entity;
\- flush the re-ordering buffer;
\- treat next received Transport Block as new data.
#### 11.6.2.6 Reconfiguration of MAC-hs parameters
The parameters for a MAC-hs entity may be reconfigured (modifed) by upper
layers.
When a parameter is reconfigured by the upper layer, the UE shall:
\- start using the reconfigured value of the parameter at the activation time
indicated by higher layers.
If the parameter T1 is reconfigured for an already existing re-ordering queue,
the UE shall:
> \- start to use the new value of T1 the next time T1 is started.
If the MAC-d PDU size info (i.e. mapping of MAC-d PDU size index to MAC-d PDU
size) is reconfigured for an already existing re-ordering queue, at the
activation time indicated by higher layers, the UE shall:
> \- stop timer T1 if running;
\- set next_expected_TSN to (highest TSN of received MAC-hs PDU of this re-
ordering queue + 1);
\- deliver all correctly received MAC-hs PDUs in this re-ordering queue to the
disassembly entity and use the old MAC-d PDU size info for these MAC-hs PDUs.
If the parameter RECEIVE_WINDOW_SIZE is reconfigured for a re-ordering queue,
the UE shall:
\- set RECEIVE_WINDOW_SIZE to the new value;
\- remove any MAC-hs PDUs in this re-ordering queue with TSN ≤
RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE (i.e. outside the receiver window
after its size is updated) from the reordering buffer and deliver these MAC-hs
PDUs to the disassembly entity;
\- if next_expected_TSN is below the receiver window after its size is
updated:
\- set next_expected_TSN to RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE + 1;
\- deliver all received MAC-hs PDUs in this re-ordering queue with consecutive
TSNs from next_expected_TSN (included) up to the first not received MAC-hs PDU
to the disassembly entity;
\- advance next_expected_TSN to the TSN of this first not received MAC-hs PDU.
If the \"Memory Partitioning\" (see [7]) for soft buffer is reconfigured, the
UE shall:
\- flush soft buffer for all configured HARQ processes.
If the \"TSN-Length\" is reconfigured, the UE shall:
\- perform the operation as per subclause 11.6.2.5.
#### 11.6.2.7 HARQ procedure for HS-SCCH less operation (FDD only)
When the HS-SCCH less mode of operation is enabled, the UE shall be able to
strore 13 TTIs in a cyclic soft buffer.
For each received MAC-hs PDU provided by the lower layers the UE shall:
\- If the associated HS-SCCH corresponds to an HS-SCCH less retransmission as
defined in subclause 4.6A.2.2.1 of [16]:
\- If the data in the soft buffer identified by the TTI [5*CFN + subframe
number - 6 -- PTR]**mod** 13 has been decoded successfully:
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- consider the data in the soft buffer identified by the TTI [5*CFN +
subframe number]**mod** 13 has been decoded successfully.
\- Else:
> \- combine the received data with the data currently in the soft buffer
> identified by [5*CFN + subframe number - 6 -- PTR]**mod** 13 where PTR is
> the value of the pointer to the previous transmission as defined in
> subclause 4.6A.2.2.1.2 of [16];
\- If the combined data in the soft buffer has been successfully decoded and
no error was detected;
\- deliver the decoded MAC-hs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- consider the data in the soft buffer identified by the TTI [5*CFN +
subframe number]**mod** 13 has been decoded successfully.
\- Else:
\- place the combined data for the HS-SCCH less TTI in the soft buffer
identified by [5*CFN + subframe number]**mod** 13, replacing any data
previously stored in that buffer.
\- generate a negative acknowledgement (NACK) of the data corresponding to
this TTI.
\- Else if the associated HS-SCCH corresponds to a HS-SCCH type 1 as defined
in subclause 4.6 of [16];
\- process the received MAC-hs PDU provided by the lower layers as per
subclause 11.6.2.2.
\- Else if HS-SCCH less operation is active according to the definition in
[13];
\- If the data has been successfully decoded and no error was detected;
\- deliver the decoded MAC-hs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- consider the data in the soft buffer identified by the TTI [5*CFN +
subframe number]**mod** 13 has been decoded successfully.
\- Else:
\- place the data for the HS-SCCH less TTI in the soft buffer identified by
[5*CFN + subframe number]**mod** 13, replacing any data previously stored in
that buffer.
#### 11.6.2.8 HARQ procedure for HS-DSCH SPS operation (1.28 Mcps TDD only)
When the HS-DSCH SPS operation is enabled, the UE shall maintain cyclic
virtual IR buffers with number of N where N is configured by higher layer as
in [7]. And the value tagged to the virtual IR buffers should be all set to
NULL.
For each received MAC-hs PDU provided by the lower layers the UE shall:
\- If the associated HS-SCCH corresponds to an HS-SCCH SPS retransmission as
defined in subclause 4.6C of [19]:
\- if the data in the virtual IR buffer tagged with the value [2*CFN +
subframe number - 4 -- PTR] mod 512 has not been decoded successfully:
\- combine the received data with the data currently in the virtual IR buffer
tagged with the value [2*CFN + subframe number - 4 - PTR] mod 512, where PTR
is the value of the pointer to the previous transmission as defined in
subclause 4.6C of [19].
\- If the data in the virtual IR buffer has been successfully decoded and no
error was detected:
\- deliver the decoded MAC-hs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- tag the virtual IR buffer with the value NULL.
\- else:
\- generate a negative acknowledgement (NACK) of the data corresponding to
this TTI;
\- tag the virtual IR buffer with the value [2*CFN + subframe number].
\- else:
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- discard the received data.
\- Else if the associated HS-SCCH corresponds to a HS-SCCH as defined in
subclause 4.6 of [19]:
\- process the received MAC-hs PDU provided by the lower layers as per
subclause 11.6.2.2.
\- Else if the TTI is allocated to the UE with HS-DSCH SPS resources:
\- if there is virtual IR buffer of which the tagged value is set to NULL:
\- place the received data for the HS-DSCH SPS TTI in any of the virtual IR
buffers of which the tagged value is set to NULL.
\- else:
\- place the received data for the HS-DSCH SPS TTI in the virtual IR buffer
which contains the oldest MAC-hs PDU, replacing any data previously stored in
this buffer.
\- If the received data has been successfully decoded and no error was
detected;
\- deliver the decoded MAC-hs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- tag the virtual IR buffer with the value NULL.
\- else:
\- generate a negative acknowledgement (NACK) of the data corresponding to
this TTI;
\- tag the virtual IR buffer with the value [2*CFN + subframe number].
\- For the data stored in each virtual IR buffer of which the tagged value is
not set to NULL, if the time waiting for retransmission has been longer than
4+PTRmax TTIs, where PTRmax is the maximum value that can be indicated by PTR:
\- tag the virtual IR buffer with the value NULL.
### 11.6.3 Network operation
The following are the functions of the various functional entities at the
network in support of the HARQ protocol used on HS-DSCH when MAC-ehs is
configured by upper layers [7].
#### 11.6.3.1 Scheduler
The scheduler performs the following functions:
\- Schedules all UEs within its cell(s);
\- Services priority queues:
\- The scheduler schedules reordering PDUs (see subsection 9.1.4) based on
information from upper layers. One UE operating in CELL_DCH may be associated
with one or more priority queues.
\- In FDD and 1.28 Mcps TDD, when transmitting to the UE in CELL_FACH or
CELL_PCH or URA_PCH state there can be multiple service priority queues. One
service priority queue can be associated to multiple H-RNTIs.
\- Determines the HARQ Entity and the queues to be serviced;
  * Sets the TSN values for new data blocks being transferred from the selected queue;
\- set the TSN to value 0 for the first reordering PDU transmitted from the
selected queue;
\- increment the TSN with one for each subsequent reordering PDU transmitted
from the selected queue.
\- increment the TSN with one for each subsequent reordering PDU transmitted
from the selected queue per H-RNTI within an HS-DSCH, when transmitting to the
UEs in CELL_FACH, CELL_PCH or URA_PCH state.
NOTE: In 1.28 Mcps TDD multi-frequency HS-DSCH cell, the length of TSN can be
6 bits or 9 bits based on the configuration of higher layer.
NOTE: The scheduler may re-use TSNs by toggling the NDI bit in order to resume
pre-empted transmissions or to force the UE to flush the soft buffer. In this
case the content of the payload may be changed but care should be taken to
preserve the higher layer data order.
\- Indicates the LCH ID and L field values for each reordering SDU to be
transmitted and the TSN field and SI field values for each reordering PDU to
be transmitted to the HARQ entity;
\- Schedules new transmissions and retransmissions:
\- When transmitting for a UE in CELL_DCH state the scheduler determines based
on the status reports from HARQ Processes if either a new transmission or a
retransmission should be made. A new transmission can however be initiated on
a HARQ process at any time. Based on a delay attribute provided by upper
layers, the scheduler may decide to discard any \'out-of-date\' MAC-ehs SDU.
\- In FDD when transmitting for a UE in CELL_FACH state the scheduler
determines based on RRM and IE \"RACH Measurement Result\" received on Iub FP
the number of retransmission that should be made after new transmission. If
HARQ feedback is configured, the scheduler may stop retransmission based on
the status reports from HARQ processes. A new transmission can however be
initiated on a HARQ process at any time. Based on a delay attribute provided
by upper layers, the scheduler may decide to discard any \'out-of-date\' MAC-
ehs SDU.
\- In 1.28Mcps TDD, when transmitting CCCH or DCCH with common H-RNTI for a UE
in CELL_FACH state the scheduler determines the number of retransmission that
should be made after new transmission based on RRM. Based on a delay attribute
provided by upper layers, the scheduler may decide to discard any \'out-of-
date\' MAC-ehs SDU.
\- In 1.28Mcps TDD, When transmitting or retransmitting DCCH/DTCH with
dedicated H-RNTI for a UE in CELL_FACH state, if In SYNC state is not
indicated by physical layer as in [18], then the synchronization Command via
HS-SCCH shall be sent to the UE firstly, the transmitting or retransmitting
DCCH/DTCH shall not be initiated or resumed until In-SYNC state is detected as
in [18]. The scheduler determines based on the status reports from HARQ
Processes if either a new transmission or a retransmission should be made.
Based on a delay attribute provided by upper layers, the scheduler may decide
to discard any \'out-of-date\' MAC-ehs SDU.
\- In 1.28Mcps TDD, when transmissing DCCH/DTCH for a UE in CELL_PCH state,
synchronization command via HS-SCCH shall be sent to the UE firstly. The
transmitting DCCH/DTCH shall not be initiated until In-SYNC state is detected
as in [18]. The scheduler determines based on the status reports from HARQ
Processes if either a new transmission or a retransmission should be made.
Based on a delay attribute provided by upper layers, the scheduler may decide
to discard any \'out-of-date\' MAC-ehs SDU.
NOTE: When operating in MIMO mode, the scheduler uses the redundancy version
coding to indicate whether a transmission is a new transmission or a
retransmission, otherwise, the New Data Indicator field is used.
\- Determines the redundancy version:
\- The scheduler determines a suitable redundancy version for each transmitted
and retransmitted MAC-ehs PDU and indicates the redundancy version to lower
layer.
> \- Determines the TDD HCSN;
\- Increment UE specific HCSN for each HS-SCCH transmission. In 1.28Mcps TDD
multi-frequency HS-DSCH cell, UE maintains the respective HCSN for each
carrier independently.
\- In 1.28 Mcps TDD, the operation of HSCN on HS-SCCH with common H-RNTI and
BCCH specific H-RNTI is unspecified.
#### 11.6.3.2 HARQ entity
\- There is one HARQ entity per HS-DSCH for each UE operating in CELL_DCH
state in UTRAN(FDD only).
\- There is one HARQ entity per UE operating in CELL_DCH state in UTRAN (TDD
only). In 1.28 Mcps TDD multi-frequency HS-DSCH cell, HARQ entity consists of
some HARQ sub-entities, each sub-entity is associated with one carrier.
\- In FDD and 1.28 Mcps TDD, there is one HARQ entity per H-RNTI in UTRAN used
for transmitting data for UE(s) in CELL_FACH state.
\- The HARQ entity sets the logical channel ID (LCH ID) fields in transmitted
MAC-ehs PDUs to the values indicated by the UTRAN scheduler.
\- The HARQ entity sets the Length (L) fields in transmitted MAC-ehs PDUs to
the values indicated by the UTRAN scheduler.
\- The HARQ entity sets the Segmentation Indication (SI) fields in transmitted
MAC-ehs PDUs to the values indicated by the UTRAN scheduler.
\- The HARQ entity sets the transmission sequence number (TSN) fields in
transmitted MAC-ehs PDUs to the values indicated by the UTRAN scheduler.
\- The HARQ entity sets the HARQ process identifier in transmitted MAC-ehs
PDUs. UTRAN should:
\- determine a suitable HARQ process to service the MAC-ehs PDU and set the
HARQ process identifier accordingly.
\- when operating in CELL_DCH state and MIMO mode with four transmit antennas
is configured by higher layers:
\- in case of three stream transmission, the HARQ entity sets the same HARQ
process identifier for the MAC-ehs PDU of the second stream and the MAC-ehs
PDU of the third stream; two ACKs/NAKs are received per HS-DSCH per TTI, the
first ACK/NACK is mapped to the first stream while the second ACK/NAK is
mapped to both second and third streams
\- in case of four stream transmission, the HARQ entity sets the same HARQ
process identifier for the MAC-ehs PDU of the first stream and the MAC-ehs PDU
of the fourth stream, and sets the same HARQ process identifier for the MAC-
ehs PDU of the second stream and the MAC-ehs PDU of the third stream; two
ACKs/NAKs are received per HS-DSCH per TTI, the first ACK/NACK is mapped to
both the first and fourth streams while the second ACK/NAK is mapped to both
second and third streams.
#### 11.6.3.3 HARQ process
\- If the New Data Indicator field exists, the HARQ process sets the New Data
indicator in transmitted MAC-ehs PDUs. UTRAN should:
\- set the New Data Indicator to the value \"0\" for the first MAC-ehs PDU
transmitted by a HARQ process;
\- not increment the New Data Indicator for retransmissions of a MAC-ehs PDU;
\- increment the New Data Indicator with one for each transmitted MAC-ehs PDU
containing new data.
\- If the New Data Indicator field doesn't exist, UTRAN should:
\- instruct the physical layer to set the appropriate redundancy version
coding when indicating the MAC-ehs PDU is either an initial transmission or a
retransmission.
\- The HARQ process processes received status messages. UTRAN should:
\- deliver received status messages to the scheduler.
### 11.6.4 UE operation
The UE operation in support of the HARQ protocol used on HS-DSCH is split
among the following five functional units with their associated functions.
#### 11.6.4.1 HARQ Entity
There is one HARQ entity per HS-DSCH at the UE which processes the HARQ
process identifiers received on the HS-SCCH transmissions associated with MAC-
ehs PDUs received on the HS-DSCH (FDD only).
There is one HARQ entity at the UE which processes the HARQ process
identifiers received on the HS-SCCH transmissions associated with MAC-ehs PDUs
received on the HS-DSCH (TDD only).
In 1.28 Mcps TDD multi-frequency HS-DSCH cell, HARQ sub-entity is configured
at UE per carrier where HS-DSCH is configured. The associated downlink control
channel and uplink control channel pair controlling the HS-DSCH transmission
on the certain carrier shall be allocated on the same carrier. The downlink
control channel carries the HS-DSCH operation related info and the uplink
control channel carries the feedback info from the UE side. In 1.28 Mcps TDD
single frequency or multi-frequency HS-DSCH cell, HARQ entity or HARQ sub-
entity is configured to handle the HARQ identity associated with the received
MAC-ehs PDU from every carrier where HS-DSCH is configured at UE side.
A number of parallel HARQ processes are used in the UE to support the HARQ
entity. The number of HARQ processes is configured by upper layers:
\- Each received MAC-ehs PDU shall be allocated to the HARQ process indicated
by the HARQ process identifier of the MAC-ehs PDU.
For FDD, upon deactivation of a secondary serving HS-DSCH cell, the UE shall:
\- flush soft buffer for all configured HARQ processes associated to that
secondary serving HS-DSCH cell;
For FDD, upon activation of a secondary serving HS-DSCH cell, the UE shall:
\- treat next received Transport Blocks on all HARQ processes associated to
that secondary serving HS-DSCH cell as new data.
#### 11.6.4.2 HARQ process
The HARQ process processes the New Data Indicator (if any) indicated by lower
layers for each received MAC-ehs PDU.
The UE may:
\- for FDD, when operating in CELL_DCH state, if the MAC-ehs PDU is received
within 5 sub-frames from the reception of the previous MAC-ehs PDU intended
for this HARQ process; or
\- for FDD, when operating in CELL_FACH state with a dedicated H-RNTI, if the
MAC-ehs PDU is not received during the sub-frames associated with the PICH (as
described in section 7.2A of [24]) and the MAC-ehs PDU is received within 5
sub-frames from the reception of the previous MAC-ehs PDU intended for this
HARQ process and with the same H-RNTI; or
\- for TDD, when operating in CELL_DCH state, or in CELL_FACH state with a
dedicated H-RNTI (1.28 Mcps TDD only), if the MAC-ehs PDU is received before
generation of feedback resulting from reception of a previous MAC-ehs PDU for
the same H-ARQ process: or
\- discard the MAC-ehs PDU.
The UE shall:
> \- when operating in CELL_FACH or CELL_PCH state with a dedicated H-RNTI, if
> the MAC-ehs PDU is received with a different H-RNTI compared to the H-RNTI
> in the previous received transmission in this HARQ process; or
\- if the New Data Indicator (if any) has been incremented compared to the
value in the previous received transmission in this HARQ process or in absence
of a New Data Indicator field, the physical layer redundancy version coding
indicates it is an initial transmission:
\- replace the data currently in the soft buffer for this HARQ process with
the received data.
NOTE: The UTRAN may, when transmitting a MAC-ehs PDU with a different H-RNTI
compared to the H-RNTI used in the previous transmission in this HARQ process,
not increment the New Data Indicator.
\- if the Transport Block Size index value is equal to 111111 (FDD only):
\- generate a positive acknowledgement (ACK) of the data in this HARQ process;
\- discard the received data;
\- assume that the data has been successfully decoded.
\- if the New Data Indicator is not present and the physical layer redundancy
version coding indicates it is a retransmission and the UE had positively
acknowledged the earlier transmission:
\- discard received data and generate a positive acknowledgement (ACK).
\- if the New Data Indicator (if any) is identical to the value used in the
previous received transmission in the HARQ process or in absence of a New Data
Indicator field, the physical layer redundancy version coding indicates it is
a retransmission and the UE had negatively acknowledged the earlier
transmission:
\- if the Transport Block Size index value is equal to 111111 (FDD only):
\- assume that the transport block size is identical to the last valid
transport block size signalled for this HARQ process.
\- if the data has not yet been successfully decoded:
\- combine the received data with the data currently in the soft buffer for
this HARQ process.
\- if the transport block size is different from the last valid transport
block size signalled for this HARQ process:
\- the UE may replace the data currently in the soft buffer for this HARQ
process with the received data.
\- if the data in the soft buffer has been successfully decoded and no error
was detected:
\- deliver the decoded MAC-ehs PDU to the disassembly entity;
\- when operating in CELL_DCH state, or operating in CELL_FACH state with
dedicated H-RNTI for 1.28 Mcps TDD, generate a positive acknowledgement (ACK)
of the data in this HARQ process, if the decoded MAC-ehs PDU has not been
received with the BCCH specific H-RNTI.
\- when operating in CELL_FACH state (FDD only):
\- if the UE is using a common E-DCH resource which is triggered due to
reception of HS-SCCH order for NodeB triggered HS-DPCCH transmission:
\- after the allowed start time of E-DCH transmission, generate a positive
acknowledgement (ACK) of the data in this HARQ process, if the decoded MAC-ehs
PDU has not been received with the BCCH specific H-RNTI.
\- else:
\- if configured by higher layers, after collision resolution, generate a
positive acknowledgement (ACK) of the data in this HARQ process, if the
decoded MAC-ehs PDU has not been received with the BCCH specific H-RNTI.
\- when operating in CELL_DCH state and MIMO mode with four transmit antennas
is configured by higher layers, if both MAC-ehs PDUs that have the same HARQ
process identifier have been successfully decoded, generate a positive
acknowledgement (ACK).
\- It is not necessary that the two successfully decoded MAC-ehs PDUs that
have the same HARQ process identifier belong to the same transmission or
retransmission.
\- else:
\- when operating in CELL_DCH state, or operating in CELL_FACH state with
dedicated H-RNTI for 1.28 Mcps TDD, generate a negative acknowledgement (NAK)
of the data in this HARQ process, if the decoded MAC-ehs PDU has not been
received with the BCCH specific H-RNTI;
\- when operating in CELL_FACH state (FDD only):
\- if the UE is using a common E-DCH resource which is triggered due to
reception of HS-SCCH order for NodeB triggered HS-DPCCH transmission:
\- after the allowed start time of common E-DCH transmission, generate a
negative acknowledgement (NAK) of the data in this HARQ process, if the
decoded MAC-ehs PDU has not been received with the BCCH specific H-RNTI.
\- else:
\- if configured by higher layers, after collision resolution, generate a
negative acknowledgement (NAK) of the data in this HARQ process, if the
decoded MAC-ehs PDU has not been received with the BCCH specific H-RNTI.
\- when operating in CELL_DCH state and MIMO mode with four transmit antennas
is configured by higher layers, if one or both MAC-ehs PDUs that have the same
HARQ process identifier have not been successfully decoded, generate a
negative acknowledgement (NAK).
\- schedule the generated positive or negative acknowledgement for
transmission and the time of transmission relative to the reception of data in
a HARQ process is configured by upper layer.
#### 11.6.4.3 Disassembly entity
For each MAC-ehs PDU that is delivered to the disassembly entity, the UE
shall:
\- for 1.28 Mcps TDD, discard the MAC-ehs PDU if the L field in MAC-ehs header
is zero;
\- remove any padding bits if present;
\- remove the MAC-ehs header;
\- deliver the reordering PDUs in the MAC-ehs PDU to reordering distribution
entity.
#### 11.6.4.4 Reordering queue distribution entity
Reordering shall be applied to all logical channels except for BCCH and PCCH.
For each reordering PDU in the MAC-ehs PDU, except for BCCH and PCCH, the UE
shall:
\- route the reordering PDU to the correct reordering queue based on the
received LCH ID. The mapping of the LCH ID to queue is provided by upper
layers [7].
#### 11.6.4.5 Reordering entity
##### 11.6.4.5.1 Definitions
In the functions described in this section the following definitions apply:
**Parameters**
\- Transmitter window size (TRANSMIT_WINDOW_SIZE)\ TRANSMIT_WINDOW_SIZE is the
size of the transmitter window according to the definition below. This is a
parameter in the Node B and the value of the parameter is configured by higher
layers.
\- Receiver window size (RECEIVE_WINDOW_SIZE)\ RECEIVE_WINDOW_SIZE is the size
of the receiver window according to the definition below. This is a parameter
in the UE and the value of the parameter is configured by higher layers.
\- TSN field length (TSN_LEN)\ TSN_LEN is the length of TSN field in bits.
This is a parameter in both the Node B and the UE. Value of the parameter is
configured by higher layers.
**State variables**
All state variables are non-negative integers. Reordering PDUs are numbered by
modulo integer Transmission sequence numbers (TSN) cycling through the field 0
to 2^TSN_LEN^-1. All arithmetic operations contained in the present document
on next_expected_TSN, RcvWindow_UpperEdge, T1_TSN and TSN_flush are affected
by the 2^TSN_LEN^ modulus. When performing arithmetic comparisons of state
variables or Transmission sequence number values a 2^TSN_LEN^ modulus base
shall be used. This modulus base is subtracted (within the appropriate field)
from all the values involved and then an absolute comparison is performed.
RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE + 1 shall be assumed to be the
modulus base. For 1.28 Mcps TDD multi-frequency HS-DSCH operation operation
mode, TSN_MAX represents period length of TSN; the arithmetic operations and
comparisons of state variables in multi-frequency mode are performed on
TSN_MAX modulus base.
\- next_expected_TSN:\ The next_expected_TSN is the Transmission sequence
number (TSN) following the TSN of the last in-sequence reordering PDU
received. It shall be updated according to the procedures given in subclauses
11.6.4.5.2, 11.6.4.8 and 11.6.4.9. For CELL_DCH, the initial value of
next_expected_TSN =0. For states other than CELL_DCH the initial value of the
next_expected_TSN = RcvWindow_UpperEdge - RECEIVE_WINDOW_SIZE + 1.
\- RcvWindow_UpperEdge:\ The RcvWindow_UpperEdge represents the TSN, which is
at the upper edge of the receiver window. After the first reordering PDU has
been received successfully, it also corresponds to the reordering PDU with the
highest TSN of all received reordering PDUs. The initial RcvWindow_UpperEdge
equals 2^TSN_LEN^-1. RcvWindow_UpperEdge is updated based on the reception of
new reordering PDU according to the procedure given below.
\- T1_TSN:\ The TSN of the latest reordering PDU that cannot be delivered to
the reassembly entity, when the timer T1 is started.
**Timers**
\- Re-ordering release timer (T1):\ The Re-ordering release timer T1 controls
the stall avoidance in the UE reordering buffer as described below. The value
of T1 is configured by upper layers.
\- Reset timer (Treset) (FDD and 1.28 Mcps TDD)\ Treset controls the reset of
the MAC-ehs reordering functionality. This timer is not used when the UE is in
CELL_DCH state. For 1.28 McpsTDD, this timer is also not used when usage of
Treset is disabled indicated by upper layers for the UE in CELL_FACH and
CELL_PCH state with dedicated H-RNTI.
**Other definitions**
\- Receiver window:\ The receiver window defines TSNs of those reordering PDUs
that can be received in the receiver without causing an advancement of the
receiver window according to the procedure below. The size of the receiver
window equals RECEIVE_WINDOW_SIZE and spans TSNs going from
RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE + 1 to RcvWindow_UpperEdge
included.
##### 11.6.4.5.2 Reordering functionality
If no timer T1 is active:
\- the timer T1 shall be started when a reordering PDU with TSN >
next_expected_TSN is correctly received.
\- T1_TSN shall be set to the TSN of this reordering PDU.
If a timer T1 is already active:
\- no additional timer shall be started, i.e. only one timer T1 may be active
at a given time.
The timer T1 shall be stopped if:
\- the reordering PDU with TSN = T1_TSN can be delivered to the reassembly
entity before the timer expires.
When the timer T1expires and T1_TSN > next_expected_TSN:
\- all correctly received reordering PDUs with TSN > next_expected_TSN up to
and including T1_TSN-1 shall be delivered to the reassembly entity;
\- all correctly received reordering PDUs up to the next not received
reordering PDU shall be delivered to the reassembly entity.
\- next_expected_TSN shall be set to the TSN of the next not received
reordering PDU.
When the timer T1 is stopped or expires, and there still exist some received
reordering PDUs that can not be delivered to higher layer:
\- timer T1 is started
\- set T1_TSN to the highest TSN among those of the reordering PDUs that can
not be delivered.
For FDD and 1.28 Mcps TDD, if the UE is not in CELL_DCH state and if the timer
Treset is not active, and for 1.28 Mcps TDD, except that usage of Treset is
disabled indicated by upper layers for the UE in CELL_FACH and CELL_PCH state
with dedicated H-RNTI:
\- the timer Treset shall be started when a reordering PDU is correctly
received.
For FDD and 1.28 Mcps TDD, if the UE is in any state other than CELL_DCH state
and if a timer Treset is already active:
\- the timer Treset shall be restarted when a reordering PDU is correctly
received.
\- no additional timer shall be started, i.e. only one timer Treset may be
active at a given time.
When the timer Treset expires:
\- perform a MAC-ehs reset.
For FDD and 1.28 Mcps TDD, if the UE enters CELL_DCH state:
\- stop all configured Treset timers.
For 1.28 Mcps TDD, when the UE is allocated with dedicated H-RNTI in CELL_FACH
and CELL_PCH state, if usage of Treset is disabled indicated by upper layers:
  * if there is timer Treset being active,
> \- stop all active Treset timers,
>
> \- consider these Treset timers have expired,
>
> \- perform MAC-ehs reset due to the expiry of Treset timers.
**Transmitter operation:**
After the transmitter has transmitted a reordering PDU with TSN=SN, any
reordering PDU with TSN ≤ SN -- TRANSMIT_WINDOW_SIZE should not be
retransmitted to avoid sequence number ambiguity in the receiver.
**Receiver operation:**
When a reordering PDU with TSN = SN is received:
\- if SN is within the receiver window:
\- if SN \ \- deliver all correctly received reordering PDUs with TSN \ the reassembly entity;
\- if the reordering PDU with TSN=TSN_flush has previously been received:
\- deliver all received reordering PDUs with consecutive TSNs from TSN_flush
(included) up to the first not received reordering PDU to the reassembly
entity;
\- advance next_expected_TSN to the TSN of this first not received reordering
PDU.
\- else:
> \- set next_expected_TSN to TSN_flush.
#### 11.6.4.6 Reassembly unit
The reassembly unit processes the SI field associated with a reordering PDU.
The UE shall:
\- if SI field is set to \"00\":
\- deliver all MAC-d or MAC-c PDUs corresponding to MAC-ehs SDUs in the
reordering PDU to demultiplexing entity;
\- discard any previously stored segment of MAC-ehs SDU.
\- if SI field is set to \"01\":
\- if the received and stored segments of a MAC-ehs SDU are consecutive:
\- combine the first reordering SDU with the stored segment of MAC-ehs SDU;
\- deliver the MAC-d or MAC-c PDU corresponding to the combined MAC-ehs SDU to
demultiplexing entity.
\- if the received and stored segments of MAC-ehs SDU are not consecutive
\- discard the first received reordering SDU and the stored segment of MAC-ehs
SDU.
\- deliver all MAC-d or MAC-c PDUs corresponding to subsequent MAC-ehs SDUs in
the reordering queue to demultiplexing entity;
\- if SI field is set to \"10\":
\- deliver all MAC-d or MAC-c PDUs corresponding to all but last reordering
SDU in the reordering PDU to the demultiplexing entity;
\- discard any previously stored segment of MAC-ehs SDU and store the last
reordering SDU of the received reordering PDU
\- if SI field is set to \"11\":
\- if the received and stored MAC-ehs SDUs are consecutive:
\- if there is only one reordering SDU in the reordering PDU:
\- combine the received reordering SDU with the stored segment of MAC-ehs SDU:
\- if there is more than one reordering SDU in the reordering PDU:
\- combine the first received reordering SDU with the stored segment MAC-ehs
SDU;
\- deliver the MAC-d or MAC-c PDU corresponding to the combined MAC-ehs SDU to
demultiplexing entity.
\- deliver all MAC-d or MAC-c PDUs corresponding to all but last reordering
SDU in the reordering PDU to demultiplexing entity;
\- discard any previously stored segment of MAC-ehs SDU and store the last
reordering SDU of the received reordering PDU.
\- if the received and stored segments of the MAC-ehs SDU are not consecutive:
\- discard the first received reordering SDU and the stored segment of MAC-ehs
SDU;
\- if there is more than one reordering SDU in the reordering PDU:
\- deliver all MAC-d or MAC-c PDUs corresponding to all but first and last
reordering SDUs in the reordering PDU to demultiplexing entity and store the
last reordering SDU of the received reordering PDU.
#### 11.6.4.7 Demultiplexing entity
For each MAC-d or MAC-c PDU that is delivered to the demultiplexing entity,
the UE shall:
\- route MAC-d or MAC-c PDU to the correct logical channel based on the
corresponding LCH ID field.
#### 11.6.4.8 MAC-ehs Reset
If a reset of the MAC-ehs entity is requested by upper layers, the UE shall at
the activation time indicated by higher layers:
\- flush soft buffer for all configured HARQ processes;
\- stop all active re-ordering release timer (T1) and set all timer T1 to
their initial value;
\- stop all active reset timers (Treset) and set all timers Treset to their
initial value;
\- start TSN with value 0 for the next transmission on every configured HARQ
process;
\- initialise the variables RcvWindow_UpperEdge and next_expected_TSN to their
initial value;
\- deliver all reordering PDUs in the re-ordering buffer to the reassembly
entity;
\- deliver any successfully reassembled MAC-ehs SDUs to logical channel
demultiplexing entity;
\- route any MAC-d or MAC-c PDUs delivered to the demultiplexing entity to the
correct logical channel;
\- flush the re-ordering buffer;
\- discard any stored segment in the reassembly entity;
\- treat next received Transport Block as new data.
If a reset of the MAC-ehs entity is required by the expiry of Treset, the UE
shall:
\- if the Treset has expired for all the configured reordering queues:
\- flush soft buffer for all configured HARQ processes;
\- treat next received Transport Block as new data.
\- for each reordering queue where Treset has expired:
\- stop the active re-ordering release timer (T1) and set the timer T1 to its
initial value;
\- start TSN with value 0 for the next transmission on every configured HARQ
process;
\- initialise the variable RcvWindow_UpperEdge to its initial value;
\- initialise the variable next_expected_TSN to its initial value;
\- deliver all reordering PDUs in the re-ordering buffer to the reassembly
entity;
\- deliver any successfully reassembled MAC-ehs SDUs to logical channel
demultiplexing entity;
\- route any MAC-d or MAC-c PDUs delivered to the demultiplexing entity to the
correct logical channel;
\- flush the re-ordering buffer;
\- discard any stored segment in the reassembly entity;
#### 11.6.4.9 Reconfiguration of MAC-ehs parameters
The parameters for a MAC-ehs entity may be reconfigured (modifed) by upper
layers.
When a parameter is reconfigured by the upper layer, the UE shall:
\- start using the reconfigured value of the parameter at the activation time
indicated by higher layers.
If the parameter T1 is reconfigured for an already existing re-ordering queue,
the UE shall:
> \- start to use the new value of T1 the next time T1 is started.
If the parameter RECEIVE_WINDOW_SIZE is reconfigured for a re-ordering queue,
the UE shall:
\- set RECEIVE_WINDOW_SIZE to the new value;
\- remove any reordering PDUs in this re-ordering queue with TSN ≤
RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE (i.e. outside the receiver window
after its size is updated) from the reordering buffer and deliver these
reordering PDUs to the reassembly entity;
\- if next_expected_TSN is below the receiver window after its size is
updated:
\- set next_expected_TSN to RcvWindow_UpperEdge -- RECEIVE_WINDOW_SIZE + 1;
\- deliver all received reordering PDUs in this re-ordering queue with
consecutive TSNs from next_expected_TSN (included) up to the first not
received reordering PDU to the reassembly entity;
\- advance next_expected_TSN to the TSN of this first not received reordering
PDU.
If the \"Memory Partitioning\" (see [7]) for soft buffer is reconfigured, the
UE shall:
\- flush soft buffer for all configured HARQ processes.
For 1.28Mcps TDD, if the \"TSN-Length\" is reconfigured, the UE shall:
\- perform the operation as per subclause 11.6.4.8.
#### 11.6.4.10 HARQ procedure for HS-SCCH less operation (FDD only)
When the HS-SCCH less mode of operation is enabled, the UE shall be able to
store 13 TTIs in a cyclic soft buffer.
For each received MAC-ehs PDU provided by the lower layers the UE shall:
\- If the associated HS-SCCH corresponds to an HS-SCCH less retransmission as
defined in subclause 4.6A.2.2.1 of [16]:
\- If the data in the soft buffer identified by the TTI [5*CFN + subframe
number - 6 -- PTR]**mod** 13 has been decoded successfully:
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- consider the data in the soft buffer identified by the TTI [5*CFN +
subframe number]**mod** 13 has been decoded successfully.
\- Else:
\- combine the received data with the data currently in the soft buffer
identified by [5*CFN + subframe number - 6 -- PTR]**mod** 13 where PTR is the
value of the pointer to the previous transmission as defined in subclause
4.6A.2.2.1.2 of [16].
\- If the combined data in the soft buffer has been successfully decoded and
no error was detected;
\- deliver the decoded MAC-ehs PDU to the disassembly entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI.
\- consider the data in the soft buffer identified by the TTI [5*CFN +
subframe number]**mod** 13 has been decoded successfully.
\- Else:
\- place the combined data for the HS-SCCH less TTI in the soft buffer
identified by [5*CFN + subframe number]**mod** 13, replacing any data
previously stored in that buffer.
\- generate a negative acknowledgement (NACK) of the data corresponding to
this TTI.
\- Else if the associated HS-SCCH corresponds to a HS-SCCH type 1 as defined
in subclause 4.6 of [16];
\- process the received MAC-ehs PDU provided by the lower layers as per
subclause 11.6.4.2.
\- Else if HS-SCCH less operation is active according to the definition in
[13]:
\- If the data has been successfully decoded and no error was detected;
\- deliver the decoded MAC-ehs PDU to the disassembly entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- consider the data in the soft buffer identified by the TTI [5*CFN +
subframe number]**mod** 13 has been decoded successfully.
\- Else:
\- place the data for the HS-SCCH less TTI in the soft buffer identified by
[5*CFN + subframe number]**mod** 13, replacing any data previously stored in
that buffer.
#### 11.6.4.11 HARQ procedure for HS-DSCH SPS operation (1.28 Mcps TDD only)
When the HS-DSCH SPS operation is enabled, the UE shall maintain cyclic
virtual IR buffers with number of N where N is configured by higher layer as
in [7]. And the value tagged to the virtual IR buffers should be all set to
NULL.
For each received MAC-ehs PDU provided by the lower layers the UE shall:
\- If the associated HS-SCCH corresponds to an HS-SCCH SPS retransmission as
defined in subclause 4.6C or 4.6G of [19]:
\- if the data in the virtual IR buffer tagged with the value [2*CFN +
subframe number - 4 - PTR] **mod** 512 has not been decoded successfully:
\- combine the received data with the data currently in the virtual IR buffer
tagged with the value [2*CFN + subframe number - 4 - PTR] **mod** 512, where
PTR is the value of the pointer to the previous transmission as defined in
subclause 4.6C or 4.6G of [19].
\- If the data in the virtual IR buffer has been successfully decoded and no
error was detected:
\- deliver the decoded MAC-ehs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- tag the virtual IR buffer with the value NULL.
\- else:
\- generate a negative acknowledgement (NACK) of the data corresponding to
this TTI;
\- tag the virtual IR buffer with the value [2*CFN + subframe number].
\- else:
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- discard the received data.
\- Else if the associated HS-SCCH corresponds to a HS-SCCH as defined in
subclause 4.6 of [19]:
\- process the received MAC-ehs PDU provided by the lower layers as per
subclause 11.6.2.2.
\- Else if the TTI is allocated to the UE with HS-DSCH SPS resources:
\- if there is virtual IR buffer of which the tagged value is set to NULL:
\- place the received data for the HS-DSCH SPS TTI in any of the virtual IR
buffers of which the tagged value is set to NULL.
\- else:
\- place the received data for the HS-DSCH SPS TTI in the virtual IR buffer
which contains the oldest MAC-ehs PDU, replacing any data previously stored in
this buffer.
\- If the received data has been successfully decoded and no error was
detected;
\- deliver the decoded MAC-ehs PDU to the reordering entity;
\- generate a positive acknowledgement (ACK) of the data corresponding to this
TTI;
\- tag the virtual IR buffer with the value NULL.
\- else:
\- generate a negative acknowledgement (NACK) of the data corresponding to
this TTI;
\- tag the virtual IR buffer with the value [2*CFN + subframe number].
\- For the data stored in each virtual IR buffer of which the tagged value is
not set to NULL, if the time waiting for retransmission has been longer than
4+PTRmax TTIs, where PTRmax is the maximum value that can be indicated by PTR:
\- tag the virtual IR buffer with the value NULL.
## 11.7 HS-DSCH Provided Bit Rate measurement
The HS-DSCH Provided Bit Rate measurements is defined as follows:
\- for each priority class the MAC-hs/ehs entity measures the total number of
MAC-d PDU bits whose transmission over the radio interface has been considered
successful by MAC-hs in Node-B during the last measurement period, divided by
the duration of the measurement period;
\- the values reported by MAC-hs/ehs shall be raw samples;
\- the measurement period shall be [100 ms];
\- when the cell portions are defined in a cell, the HS-DSCH Provided Bit Rate
shall be measured for each cell portion.
## 11.8 Control of E-DCH transmission and reception (FDD)
### 11.8.1 UE operation
##### 11.8.1.1 HARQ Operation
##### 11.8.1.1.1 HARQ entity
There is one HARQ entity per E-DCH at the UE. A number of parallel HARQ
processes are used in the UE to support the HARQ entity, allowing
transmissions to take place continuously while waiting for the feedback on the
successful or unsuccessful reception of previous transmissions.
At a given TTI, the HARQ entity identifies the HARQ process for which a
transmission should take place. Also, based on the timing, it routes the
receiver feedback (ACK/NACK information), relayed by the physical layer, to
the appropriate HARQ process. If uplink MIMO is configured by higher layers,
then HARQ entity identifies HARQ processes for which transmission should take
place according to sub-clause 11.8.1.1.3, and routes accordingly the ACK/NACK
information to the appropriate HARQ processes.
The number of HARQ processes per HARQ entity is equal to the HARQ round-trip-
time (HARQ_RTT). The HARQ_RTT is equal to 4 for 10ms TTI and 8 for 2ms TTI.
The TTI duration shall be configured by the higher layers. Each process is
associated with a number from 0 to HARQ_RTT-1. If uplink MIMO is configured,
then the number of HARQ processes per HARQ entity is equal HARQ_RTT*2, where
processes 0..7 map to the primary MIMO stream and processes 8..15 to the
secondary MIMO stream. According to the rules specified in sub-clause
11.8.1.1.3, any of the processes 8..15 might be mapped on the primary stream
as a result of retransmission.
After each TTI, the HARQ entity shall for each HARQ process:
\- if the buffer of the HARQ process corresponding to the next TTI is empty:
\- notify the E-TFC selection entity that the next TTI is available for a new
transmission;
\- if the \"E-TFC Selection\" entity indicates the need for a new
transmission:
\- obtain the transmission information (i.e. HARQ profile, whether triggered
Scheduling Information is included and whether it is sent alone) from the
\"E-TFC Selection\" entity;
\- obtain the MAC-e or MAC-i PDU to transmit from the \"Multiplexing and TSN
setting\" entity;
\- instruct the HARQ process corresponding to this TTI to trigger the
transmission of this new payload using the identified HARQ profile parameters.
\- else:
\- instruct the HARQ process to generate a re-transmission.
##### 11.8.1.1.2 HARQ process
Each HARQ process is associated with a physical buffer (HARQ buffer).
Each HARQ process maintains the state variable CURRENT_TX_NB, which indicates
the number of transmissions that have taken place for the MAC-e or MAC-i PDU
currently in the buffer. When the HARQ process is established, CURRENT_TX_NB
shall be initialized to 0.
At the time of a new transmission, the HARQ entity provides the HARQ profile
to use for all transmissions and re-transmissions of this MAC-e or MAC-i PDU.
This HARQ profile includes information on the maximum number of transmissions
to perform, and the power offset with which to configure the physical layer.
If the HARQ entity provides a new PDU, the HARQ process shall:
\- set CURRENT_TX_NB to 0;
\- set CURRENT_RSN to 0;
\- store the MAC-e or MAC-i PDU in the associated HARQ buffer;
\- generate a transmission as described below.
If the HARQ entity requests a re-transmission, the HARQ process shall:
\- generate a transmission as described below.
To generate a transmission, the HARQ process shall, regardless of any
overlapping with a compressed mode gap:
\- instruct the physical layer to set the RSN field on the E-DPCCH to
CURRENT_RSN;
\- instruct the physical layer to generate a transmission with the power
offset corresponding to the HARQ profile and the redundancy version
corresponding to the RSN value and the transmission timing (i.e. the CFN and
in the case of 2ms TTI, sub-frame number as described in [16]);
\- if CURRENT_RSN \ 63:
\- set CURRENT_TSN = 0.
When more than one uplink frequency is configured, after each MAC-is PDU is
multiplexed:
\- increment CURRENT_TSN by 1;
\- if CURRENT_TSN > 16383:
\- set CURRENT_TSN = 0.
#### 11.8.1.2a Segmentation entity
There is one segmentation entity per logical channel in the UE.
When the MAC-d PDU size, the untransmitted part of the MAC-d PDU, the MAC-c
PDU size (FDD only) or the untransmitted part of the MAC-c PDU (FDD only)
exceeds available space in the transport block according to the E-TFC
selection, the segmentation entity shall:
\- segment the MAC-d PDU, the untransmitted part of the MAC-d PDU, the MAC-c
PDU or the untransmitted part of the MAC-c PDU to fit the available space in
the transport block according to the E-TFC selection and store the
untransmitted part of the MAC-d PDU or MAC-c PDU;
\- set the segmentation status (SS) field of the transmission to indicate the
segmentation status as described in subclause 9.2.4.3.
#### 11.8.1.3 Serving Grant Update
UEs in CELL_DCH state, configured with an E-DCH transport channel shall
maintain a Serving Grant and the list of active HARQ processes based on the
absolute and relative grant commands decoded on the configured E-AGCH and
E-RGCH(s).
UEs in CELL_DCH state, configured with more than one E-DCH transport channel,
shall maintain per Activated Uplink Frequency, a Serving Grant and the list of
active HARQ processes, based on the absolute and relative grant commands
decoded on the configured E-AGCH and E-RGCH(s) associated with each of the
Activated Uplink Frequencies.
Each Absolute Grant or Relative Grant command is applied at a specific TTI.
This association is implicit based on the timing of the E-AGCH and E-RGCH (see
[13]). The timing is tight enough that this relationship is un-ambiguous.
The activation/deactivation of one or all processes is only applicable to
processes for which transmission of scheduled data is allowed according to RRC
signalling. If uplink MIMO is configured by higher layers, then HARQ process
activation/deactivation applies to both the first and the second stream.
Process activation of an active process does not result in any action taken by
the UE.
UEs in CELL_FACH state and Idle mode, allocated with a common E-DCH transport
channel, shall maintain a Serving Grant. For DCCH/DTCH and for NodeB triggered
HS-DPCCH transmission in CELL_FACH state the Serving Grant is maintained based
on the absolute and relative grant commands decoded on the configured E-AGCH
and E-RGCH. For CCCH transmission in CELL_FACH state and Idle mode the Serving
Grant is maintained based only on the initial serving grant value provided by
higher layers.
Unless specified otherwise, the following procedures are run independently for
each of the Activated Uplink Frequencies. For example, the Absolute Grant,
Serving Relative Grant, and non-serving Relative grants are used in
conjunction with the scheduled transmission on the associated Activated Uplink
Frequency (along with other parameters and events), to determine the
Serving_Grant on that frequency.
##### 11.8.1.3.1 Baseline Procedure
For UEs in CELL_DCH state the Serving Grant Update procedure shall be applied
at every TTI boundary and shall take into account the Absolute Grant message,
Serving Relative Grant and non-serving Relative Grants that apply to the TTI.
The UE shall:
1> set reference_ETPR2 to reference_ETPR as defined in subclause 3.1.2;
1> set reference_ETPR to the E-DPDCH to DPCCH power ratio as defined in
subclause 3.1.2;
1> if an Absolute Grant was received for this TTI:
2> if the Identity type is \"Primary\", and the Absolute Grant value is set to
\"INACTIVE\":
3> if Absolute Grant Scope indicates \"Per HARQ process\" and a 2ms TTI is
configured:
4> if uplink MIMO is not configured, de-activate the process given by the
value of CURRENT_HARQ_PROCESS;
4> if uplink MIMO is configured, de-activate the process given by the value of
CURRENT_HARQ_PROCESS for the primary and secondary stream.
> 3> if Absolute Grant Scope indicates \"All HARQ processes\" and a secondary
> E-RNTI was configured by higher layers:
4> activate all HARQ processes;
4> set Serving_Grant = Stored_Secondary_Grant;
4> set Primary_Grant_Available to \"False\".
3> if Absolute Grant Scope indicates \"All HARQ processes\", a 2ms TTI is
configured and a secondary E-RNTI was not configured by higher layers:
4> deactivate all HARQ processes (if a process was inactive it remains
inactive, if a process was active it becomes inactive).
2> else if the Absolute Grant Value is different from \"INACTIVE\":
3> if the Identity Type is \"Secondary\":
4> if the Absolute Grant Value is different from \"Zero_Grant\":
5> set Stored_Secondary_Grant = MAX(Absolute Grant Value, Lowest Configured
Serving Grant Value).
4> else:
5> set Stored_Secondary_Grant = \"Zero_Grant\".
3> if the Identity Type is \"Primary\" or Primary_Grant_Available is set to
\"False\":
4> if the Absolute Grant Value is different from \"Zero_Grant\":
5> set Serving_Grant = MAX(Absolute Grant Value, Lowest Configured Serving
Grant Value).
4> else:
5> set Serving_Grant = \"Zero_Grant\".
4> if the Identity Type is \"Primary\":
5> set Primary_Grant_Available to \"True\";
5> if Absolute Grant Scope indicates \"Per HARQ process\":
> 6> if uplink MIMO is not configured, activate the process given by the value
> of CURRENT_HARQ_PROCESS;
>
> 6> if uplink MIMO is configured, activate the process given by the value of
> CURRENT_HARQ_PROCESS for the primary and secondary stream.
5> if Absolute Grant Scope indicates \"All HARQ processes\":
> 6> activate all HARQ processes.
5> if AG_Timer is not active, it shall be started, otherwise it shall be
restarted.
1> else (no Absolute Grant received):
2> if the HARQ process given by the value of CURRENT_HARQ_PROCESS is active;
and
2> if Primary_Grant_Available is equal to \"True\"; and
2> if Serving_Grant \<> \"Zero_Grant\" ; and
2> if AG_Timer has expired; and
2> if there was a scheduled transmission (see NOTE 2) in the previous TTI of
the HARQ process given by the value of CURRENT_HARQ_PROCESS:
3> if the Serving Relative Grant indicates \"UP\":
4> determine the Serving_Grant in accordance with subclause 9.2.5.2.1.
3> else, if the Serving Relative Grant indicates \"DOWN\":
4> determine the Serving_Grant in accordance with subclause 9.2.5.2.1.
3> else:
4> the Serving_Grant is unchanged (i.e. kept from previous TTI).
1> if any Non-Serving Relative Grants indicate \"DOWN\" for this TTI and
Serving_Grant \<> \"Zero_Grant\":
2> Serving_Grant = MIN(Serving_Grant, Maximum_Serving_Grant, Serving_Grant
determined in accordance with subclause 9.2.5.2.1);
2> Maximum_Serving_Grant = Serving_Grant.
2> if Non_Serving_RG_Timer is not active it shall be started, otherwise it
shall be restarted;
1> else if no Non-Serving Relative Grants indicate \"DOWN\" for this TTI:
2> if Non_Serving_RG_Timer has not expired:
3> Serving_Grant = MIN(Maximum_Serving_Grant, Serving_Grant).
1> if Non_Serving_RG_Timer expires:
2> set the Maximum_Serving_Grant to the highest possible value (i.e. index 37
in table 9.2.5.2.1.1 or 9.2.5.2.1.2 as configured by higher layers).
For UEs in CELL_FACH state for which \"Per HARQ process\" scope is not enabled
by higher layers, and in case of DCCH/DTCH or for NodeB triggered HS-DPCCH
transmission the Serving Grant Update procedure shall be applied at every TTI
boundary and shall take into account the Absolute Grant message and Serving
Relative Grant and non-serving Relative Grants that apply to the TTI.
The UE shall:
1> if configured by higher layers, set reference_ETPR2 to reference_ETPR as
defined in subclause 3.1.2;
1> set reference_ETPR to the E-DPDCH to DPCCH power ratio as defined in
subclause 3.1.2;
1> if an Absolute Grant was received for this TTI:
2> if the Absolute Grant value is set to \"INACTIVE\":
3> deactivate all HARQ processes (and act as described section 11.2.2A).
2> else if the Absolute Grant Value is different from \"INACTIVE\":
3> set Serving_Grant = Absolute Grant Value;
3> if AG_Timer is not active, it shall be started, otherwise it shall be
restarted.
1> else (no Absolute Grant received):
2> if Serving_Grant \<> \"Zero_Grant\"; and
2> if AG_Timer has expired; and
2> if there was a scheduled transmission (see NOTE 2) in the previous TTI of
the HARQ process given by the value of CURRENT_HARQ_PROCESS:
3> if the Serving Relative Grant indicates \"UP\":
4> determine the Serving_Grant in accordance with subclause 9.2.5.2.1.
3> else, if the Serving Relative Grant indicates \"DOWN\":
4> determine the Serving_Grant in accordance with subclause 9.2.5.2.1.
3> else:
4> the Serving_Grant is unchanged (i.e. kept from previous TTI).
1> if any Non-Serving Relative Grants indicate \"DOWN\" for this TTI and
Serving_Grant \<> \"Zero_Grant\":
2> Serving_Grant = MIN(Serving_Grant, Maximum_Serving_Grant, Serving_Grant
determined in accordance with subclause 9.2.5.2.1);
2> Maximum_Serving_Grant = Serving_Grant.
2> if Non_Serving_RG_Timer is not active it shall be started, otherwise it
shall be restarted;
1> else if no Non-Serving Relative Grants indicate \"DOWN\" for this TTI:
2> if Non_Serving_RG_Timer has not expired:
3> Serving_Grant = MIN(Maximum_Serving_Grant, Serving_Grant).
1> if Non_Serving_RG_Timer expires:
2> set the Maximum_Serving_Grant to the highest possible value (i.e. index 37
in table 9.2.5.2.1.1 or 9.2.5.2.1.2 as configured by higher layers).
NOTE 1: MIN(\"Zero_Grant\", any numerical value) = \"Zero_Grant\".
NOTE 2: Scheduling Information sent alone is not considered as a scheduled
transmission.
For UEs in CELL_FACH state for which \"Per HARQ process\" scope is enabled by
higher layers and in case of DCCH/DTCH or for NodeB triggered HS-DPCCH
transmission, the Serving Grant Update procedure shall be applied at every TTI
boundary and shall take into account the Absolute Grant message and Serving
Relative Grant and non-serving Relative Grants that apply to the TTI.
The UE shall:
1> if configured by higher layers, set reference_ETPR2 to reference_ETPR as
defined in subclause 3.1.2;
1> set reference_ETPR to the E-DPDCH to DPCCH power ratio as defined in
subclause 3.1.2;
1> if an Absolute Grant was received for this TTI:
2> if the Absolute Grant value is set to \"INACTIVE\":
3> if Absolute Grant Scope indicates \"Per HARQ process\" and a 2ms TTI is
configured:
4> de-activate the process given by the value of CURRENT_HARQ_PROCESS.
3> if Absolute Grant Scope indicates \"All HARQ processes\":
4> deactivate all HARQ processes (and act as described section 11.2.2A)
2> else if the Absolute Grant Value is different from \"INACTIVE\":
3> set Serving_Grant = Absolute Grant Value.
3> if Absolute Grant Scope indicates \"Per HARQ process\":
4> activate the process given by the value of CURRENT_HARQ_PROCESS.
3> if Absolute Grant Scope indicates \"All HARQ processes\":
4> activate all HARQ processes.
3> if AG_Timer is not active, it shall be started, otherwise it shall be
restarted.
1> else (no Absolute Grant received):
2> if in CELL_FACH state and DCCH/DTCH or NodeB triggered HS-DPCCH
transmission; and
2> if the HARQ process given by the value of CURRENT_HARQ_PROCESS is active;
and
2> if Serving_Grant \<> \"Zero_Grant\" ; and
2> if AG_Timer has expired; and
2> if there was a scheduled transmission (see NOTE 1) in the previous TTI of
the HARQ process given by the value of CURRENT_HARQ_PROCESS:
3> if the Serving Relative Grant indicates \"UP\":
4> determine the Serving_Grant in accordance with subclause 9.2.5.2.1.
3> else, if the Serving Relative Grant indicates \"DOWN\":
4> determine the Serving_Grant in accordance with subclause 9.2.5.2.1.
3> else:
4> the Serving_Grant is unchanged (i.e. kept from previous TTI).
1> if any Non-Serving Relative Grants indicate \"DOWN\" for this TTI and
Serving_Grant \<> \"Zero_Grant\":
2> Serving_Grant = MIN(Serving_Grant, Maximum_Serving_Grant, Serving_Grant
determined in accordance with subclause 9.2.5.2.1);
2> Maximum_Serving_Grant = Serving_Grant.
2> if Non_Serving_RG_Timer is not active it shall be started, otherwise it
shall be restarted;
1> else if no Non-Serving Relative Grants indicate \"DOWN\" for this TTI:
2> if Non_Serving_RG_Timer has not expired:
3> Serving_Grant = MIN(Maximum_Serving_Grant, Serving_Grant).
1> if Non_Serving_RG_Timer expires:
2> set the Maximum_Serving_Grant to the highest possible value (i.e. index 37
in table 9.2.5.2.1.1 or 9.2.5.2.1.2 as configured by higher layers).
NOTE 1: MIN(\"Zero_Grant\", any numerical value) = \"Zero_Grant\".
NOTE 2: Scheduling Information sent alone is not considered as a scheduled
transmission.
##### 11.8.1.3.2 Handling at start of E-DCH transmission
In CELL_DCH state when E-DCH transmission is started on an Activated Uplink
Frequency, the UE shall, on that frequency:
  * activate all HARQ processes;
  * if the IE\'s \"Serving Grant value\" and \"Primary/Secondary Grant Selector\" are provided by higher layers:
\- update the state variables and timers according to subclause 11.8.1.3.5.
> \- else:
\- initialise the state variable Serving_Grant to Zero_Grant;
\- initialise the state variable Primary_Grant_Available to \"False\";
\- initialise the state variable Stored_Secondary_Grant to \"Zero_Grant\".
\- initialise the state variables reference_ETPR and reference_ETPR2 to
\"Minimum_Grant\";
\- initialise the state variable Maximum_Serving_Grant to the highest possible
value (i.e. index 37 in table 9.2.5.2.1.1 or 9.2.5.2.1.2 as configured by
higher layers).
For DCCH/DTCH and for NodeB triggered HS-DPCCH transmission in CELL_FACH state
when common E-DCH transmission is started, the UE shall:
\- activate all HARQ processes indicated in the list of activated HARQ
processes or activate all HARQ processes if no list has been indicated by
higher layers;
\- initialise the state variable Serving_Grant according to subclause
11.8.1.3.5;
\- initialise the state variable reference_ETPR to \"Minimum_Grant\";
\- if configured by higher layers, initialise the state variable
reference_ETPR2 to \"Minimum_Grant\";
\- start AG_Timer.
For CCCH transmission in CELL_FACH state and Idle Mode when common E-DCH
transmission is started, the UE shall:
\- activate all HARQ processes indicated in the list of activated HARQ
processes or activate all HARQ processes if no list has been indicated by
higher layers;
\- initialise the state variable Serving_Grant according to subclause
11.8.1.3.5.
##### 11.8.1.3.3 Handling at serving cell change
At E-DCH serving cell change, the UTRAN may configure the UE with the grant
value to use in the new cell and shall indicate whether the UE should monitor
Absolute Grant Messages with the secondary E-RNTI.
The UE shall:
\- activate all HARQ processes;
  * if the IE\'s \"Serving Grant value\" and \"Primary/Secondary Grant Selector\" are provided by higher layers:
\- update the state variables and timers according to subclause 11.8.1.3.5.
> \- else:
\- continue to use the current values of state variables Serving_Grant and
Primary_Grant_Available;
\- initialise the state variable Stored_Secondary_Grant to \"Zero_Grant\".
##### 11.8.1.3.4 Handling at TTI change
At E-DCH TTI change, the UE shall:
\- activate all HARQ processes;
\- initialise the state variables reference_ETPR and reference_ETPR2 to
\"Minimum_Grant\";
\- reset Non_Serving_RG_Timer and AG_Timer;
\- set the state variable Maximum_Serving_Grant to the highest possible value
(i.e. index 37 in table 9.2.5.2.1.1 or 9.2.5.2.1.2 as configured by higher
layers).
> \- if the IE\'s \"Serving Grant value\" and \"Primary/Secondary Grant
> Selector\" are provided by higher layers:
\- update the state variables and timers according to subclause 11.8.1.3.5.
> \- else:
\- continue to use the current values of state variables Serving_Grant and
Primary_Grant_Available;
\- initialise the state variable Stored_Secondary_Grant to \"Zero_Grant\".
##### 11.8.1.3.5 Higher Layer Signalling
In CELL_DCH state when the IE\'s \"Serving Grant value\" and
\"Primary/Secondary Grant Selector\" are provided by higher layers:
\- set the state variable Serving_Grant to the value of the IE\'s \"Serving
Grant value\" provided by higher layers;
\- if the IE\'s \"Primary/Secondary Grant Selector\" is provided by higher
layers as \"Primary\":
> \- if AG_Timer is not active, it shall be started, otherwise it shall be
> restarted;
\- set the state variable Primary_Grant_Available to \"True\";
\- set the state variable Stored_Secondary_Grant to \"Zero_Grant\".
\- if the IE\'s \"Primary/Secondary Grant Selector\" is provided by higher
layers as \"Secondary\":
\- set the state variable Primary_Grant_Available to \"False\";
\- set the state variable Stored_Secondary_Grant to the value of the IE\'s
\"Serving Grant value\" provided by higher layers.
In CELL_FACH state and Idle Mode when the IE \"Initial Serving grant value\"
is provided by higher layers:
\- set the state variable Serving_Grant to the value of the IE \"Initial
Serving grant value\" provided by higher layers.
##### 11.8.1.3.6 Handling in UE DTX Cycle 2
In FDD, for each Activated Uplink Frequency, in case the DTX feature is
configured by higher layers, and there has not been any E-DCH transmission for
the last \"Inactivity Threshold for UE DTX cycle 2\" E-DCH TTIs on the
corresponding Activated Uplink Frequency:
\- If Default-SG-in-DTX-Cycle-2 has been signalled by higher layers:
\- set the state variable Serving_Grant to the value of Default-SG-in-DTX-
Cycle-2 at the TTI boundary when the UE moves from UE DTX cycle 1 to UE DTX
cycle 2.
#### 11.8.1.3a UL MIMO rank and offset update
UEs in CELL_DCH state, configured with an E-DCH transport channel and UL MIMO
shall maintain a rank indication and a S-ETFC offset based on the UL MIMO
commands decoded on the configured E-ROCH.
Each rank and offset command is applied at a specific TTI. This association is
implicit based on the timing of the E-ROCH (see [13]). The timing is tight
enough that this relationship is un-ambiguous.
##### 11.8.1.3a.1 Baseline procedure
For UEs in CELL_DCH state the rank and power offset update procedure shall be
applied at every TTI boundary and shall take into account the rank and offset
message that applies to the TTI.
The UE shall:
1> if a rank and offset message was received for this TTI:
2> if the Rank Indication indicated \"rank2 allowed\":
3> set maximum allowed rank = 2;
3> set Offset = S-ETFC Offset value.
2> else if the Rank Indication indicated \"rank2 not allowed\":
3> set maximum allowed rank = 1;
3> set Offset = 0.
##### 11.8.1.3a.2 Handling at initiation of UL MIMO
In CELL_DCH state when UL MIMO is initially configured the UE shall:
1> set maximum allowed rank = 1;
1> set Offset = 0.
##### 11.8.1.3a.3 Handling at serving cell change
At E-DCH serving cell change, the UTRAN may configure the UE with UL MIMO
configuration to use in the new cell.
The UE shall:
1> set maximum allowed rank = 1;
1> set Offset = 0.
#### 11.8.1.4 E-TFC Selection
In FDD mode, the rules for E-TFC selection provided below shall apply to UEs
in CELL_DCH state, CELL_FACH state and Idle Mode with an E-DCH transport
channel configured. These UEs shall apply the E-TFC selection procedure when
invoked by the HARQ entity (see subclause 11.8.1.1.1). In the case where a 2ms
TTI is configured, E-TFC selection shall not be performed for TTIs that
overlap with an uplink compressed mode gap. The E-TFC restriction procedure
described in [12] shall always be applied before the E-TFC selection process
below. When the UE has more than one Activated Uplink Frequency, the E-TFC
restriction procedure described in [12] shall always be applied after the
power for each uplink frequency has been determined. E-TFCs which (according
to calculations in [16]) require channelisation codes which are not allowed by
the value given by the Maximum channelisation codes for E-DPDCH or are not
supported by the UE capability shall be considered as blocked. Furthermore,
for UEs that are also configured with a DCH transport channel on uplink, the
TFC selection procedure shall be applied before either of these.
For each MAC-d flow, RRC configures MAC with a HARQ profile and a multiplexing
list. Additionally, RRC configures MAC with a power offset for \"Control-
only\" transmissions. This power offset and a maximum number of HARQ
transmissions of 8 will be used to define a HARQ profile for \"Control-only\"
transmissions which will be used, in case the Scheduling Information needs to
be transmitted without any higher-layer data. The HARQ profile includes the
power offset and maximum number of HARQ transmissions to use for this MAC-d
flow. The multiplexing list identifies for each MAC-d flow(s), the other MAC-d
flows from which data can be multiplexed in a transmission that uses the power
offset included in its HARQ profile.
RRC can control the scheduling of uplink data by giving each logical channel a
priority between 1 and 8, where 1 is the highest priority and 8 the lowest.
E-TFC selection in the UE shall be done in accordance with the priorities
indicated by RRC. Logical channels have absolute priority, i.e. the UE shall
maximise the transmission of higher priority data.
RRC can allocate non-scheduled transmission grants to individual MAC-d flows
in order to reduce the transmission delays. Non-scheduled transmissions are
only allowed on the Primary Uplink Frequency and the primary stream if uplink
MIMO is configured by higher layers. When a 2ms TTI is configured each non-
scheduled grant is applicable to the specific set of HARQ processes indicated
by RRC. The applicability of scheduled grants can be also restricted to a
specific set of HARQ processes when a 2ms TTI is configured. HARQ process
restriction and reservation is under the control of the serving cell Node B
and indicated to the UE by RRC.
In CELL_FACH state and Idle mode, the applicability of scheduled grants can be
also restricted to a specific set of HARQ processes when a 2ms TTI is
configured and \"Per HARQ process\" scope is enabled by higher layers. HARQ
process restriction and reservation is under the control of the serving cell
Node B and indicated to the UE by RRC.
When the UE has more than one Activated Uplink Frequency, if the E-TFC
selection in this TTI is invoked by a HARQ entity on only one of the Activated
Uplink Frequency, then the maximum remaining power allowed for E-DCH
transmission is determined according to the procedures specified in [12].
When the UE has more than one Activated Uplink Frequency, if the E-TFC
selection in this TTI is invoked by HARQ entities on more than one of the
Activated Uplink Frequencies or if the HARQ entities on all Activated Uplink
Frequencies in this TTI are generating retransmissions, the maximum remaining
power allowed for E-DCH transmission on each Activated Uplink Frequency is
determined by:
\- The power pre-allocated for non-empty non-scheduled MAC-d flows. The amount
of power pre-allocated for a non-empty non-scheduled flow shall be the minimum
of the power necessary to transmit data up to the non-scheduled grant for this
flow, and the power necessary to transmit all the data in the queue for this
flow taking into account the power offset for a transmission of the HARQ
profile of the MAC-d flow with the highest-priority among "non-scheduled" non-
empty MAC-d flows.
\- The power allocation to a frequency i, P~i~, is calculated as:
> where P~remaining,s~ is the remaining power for scheduled transmissions once
> the power for non-scheduled transmissions has been taken into account,
> P~DPCCH,target,i~ is the filtered DPCCH power defined in [12], and SG~i~ is
> the Serving Grant on frequency i.
\- For the Primary Uplink Frequency, the maximum remaining power allowed for
E-DCH transmission is the sum of the total power pre-allocated for all the
non-empty non-scheduled MAC-d flows and the power P~i~ allocated to the
Primary Uplink Frequency . For the Secondary Uplink Frequency, the maximum
remaining power allowed for E-DCH transmission is the power P~i~ for this
frequency.
The E-TFC restriction procedure described in [12] shall be applied on each
frequency based on the maximum remaining power allowed for E-DCH transmission
on that frequency.
When the UE has more than one Activated Uplink Frequency and E-TFC selection
is invoked by more than one HARQ entity, the following E-TFC selection
procedure is first applied to the Secondary Uplink Frequency and then to
Primary Uplink Frequency.
For each configured MAC-d flow, a given E-TFC can be in any of the following
states on each of the Activated Uplink Frequencies:
\- Supported state;
\- Blocked state.
When the UE has only one Activated Uplink Frequency, at each TTI boundary, UEs
in CELL_DCH state, CELL_FACH state and Idle mode with an E-DCH transport
channel configured shall determine the state of each E-TFC for every MAC-d
flow configured based on its required transmit power versus the maximum UE
transmit power (see [7] and [12]). The UE shall consider that E-TFCs included
in the minimum set of E-TFCs are always in supported state (see [7]).
When the UE has more than one Activated Uplink Frequency, at each TTI
boundary, UEs shall determine the state of each E-TFC for every MAC-d flow
configured on each uplink frequency, based on its required transmit power
versus the maximum remaining power allowed for E-DCH transmission on that
frequency (see [7] and [12]). The UE shall consider that E-TFCs included in
the minimum set of E-TFCs are always in supported state (see [7]).
When UL MIMO is configured and the UE maximum allowed rank is set to 2, at
each TTI boundary, UEs shall determine for the primary stream the state of
each E-TFC for every MAC-d flow configured based on its required transmit
power versus the maximum power allowed for rank2 transmission on the primary
stream (see [7] and [12]). The UE shall consider that E-TFCs included in the
minimum set of E-TFCs are always in supported state for the primary stream
(see [7]). For the secondary stream, the UE shall consider that all E-TFCs
smaller than or equal to the maximum number of bits of scheduled data
according to the virtual serving grant (see Section 11.8.1.4a) are in
supported state.
At every TTI boundary for which a new transmission is requested by the HARQ
entity (see subclause 11.8.1.1.1), the UE shall perform the operations
described below. UEs configured both with DCH and E-DCH transport channels
shall perform TFC selection before performing E-TFC selection.
When the UE has more than one Activated Uplink Frequency and E-TFC selection
is invoked by one HARQ entity, the following E-TFC selection procedure is
applied to the uplink frequency where the E-TFC selection is invoked. The
Serving Grant Update function provides the E-TFC selection function with the
maximum E-DPDCH to DPCCH power ratio that the UE is allowed to allocate for
the upcoming transmission for scheduled data (held in the Serving Grant state
variable -- see subclause 11.8.1.3). This power ratio shall be used to
determine a maximum number of bits of scheduled data with a 1 bit granularity
for the upcoming transmission, calculated from number of bits corresponding to
the reference E-TFCs (E-TFC~ref,m~), and that the highest value is lower or
equal to:
If E-DPDCH power extrapolation formula is configured:
This maximum number of bits shall be lower than $K_{e,\text{ref},n}$ bits,
where $K_{e,\text{ref},n}$ corresponds to any higher n^th^ reference E-TFC
(E-TFC~ref,n~ ) and shall be higher or equal to $K_{e,\text{ref},m}$ of
E-TFC~ref,m~ except if m=1.
Else if E-DPDCH power interpolation formula is configured:
> This maximum number of bits shall be lower than $K_{e,\text{ref},m + 1}$
> bits except if $K_{e,\text{ref},m + 1}$ corresponds to the number of bits of
> the highest reference E-TFC (E-TFC~ref,\ M~ ) and shall be higher or equal
> to $K_{e,\text{ref},m}$ of E-TFC~ref,m~ except if m=1.
$K_{e,\text{ref},m}$ and $L_{e,\text{ref},m}$ above are given in [13].
$A_{\text{ed},m}$ denotes the quantized amplitude ratio assigned to
E-TFC~ref,m~ and is defined in [22].
The HARQ process ID for the upcoming transmission on each Activated Uplink
Frequency is determined using the following formulae:
\- For 2ms TTI: CURRENT_HARQ_PROCESS_ID = [5*CFN + subframe number] **mod**
HARQ_RTT
\- For 10ms TTI: CURRENT_HARQ_PROCESS_ID = [CFN] **mod** HARQ_RTT
\- For 2ms TTI when uplink MIMO is configured:
\- For the primary stream: CURRENT_HARQ_PROCESS_ID = [5*CFN + subframe number]
mod HARQ_RTT;
\- For the secondary stream: CURRENT_HARQ_PROCESS_ID = HARQ_RTT + [5*CFN +
subframe number] mod HARQ_RTT.
Based on this current HARQ process ID and the RRC configuration, the UE shall
determine whether to take the scheduled and non-scheduled grants into account
in the upcoming transmission. If they are not supposed to be taken into
account, then the corresponding grant shall be assumed to not exist. If the
variable Serving_Grant has the value \"Zero_Grant\" after the Serving Grant
Update, then the Serving Grant shall not be taken into account in the upcoming
transmission.
For CELL_DCH state, when Scheduling Information is triggered per subclause
11.8.1.6, the E-TFC selection and data-allocation process shall assume that a
non-scheduled grant is available for its transmission and that Scheduling
Information has a priority higher then any other logical channel. Furthermore
the HARQ process used for the upcoming transmission shall be assumed to be
active and not L3 restricted for the transmission of the Scheduling
Information, i.e. transmission of Scheduling Information can take place on
this process.
For CELL_FACH state and Idle mode, when Scheduling Information is triggered
per subclause 11.8.1.6, the E-TFC selection and data-allocation process shall
not assume that a non-scheduled grant is available for its transmission,
unless the Scheduling Information is triggered by a periodic Scheduling
Information triggering mechanism or the Scheduling Information is sent as a
stand-alone in which case the E-TFC selection and data-allocation process
shall assume that a non-scheduled grant is available for its transmission. In
this case and when a 2ms TTI is configured and \"Per HARQ process\" scope is
enabled by higher layers, the non-scheduled grant is available to the same set
of HARQ processes as those applicable for scheduled grants.
The transmission format and data allocation shall follow the requirements
below:
\- Only E-TFCs from the configured E-TFCS shall be considered for the
transmission;
\- For all logical channels, if the logical channel belongs to a non-scheduled
MAC-d flow, its data shall be considered as available up to the corresponding
non-scheduled grant, if the logical channel does not belong to a non-scheduled
MAC-d flow, its data shall be considered as available up to the Serving Grant;
\- The power offset for the transmission is the one from the HARQ profile of
the MAC-d flow that allows highest-priority data to be transmitted on the
Uplink Frequency for which E-TFC selection is being performed. If more than
one MAC-d flow allows data of the same highest priority to be transmitted, it
is left to implementation to select which MAC-d flow to prefer);
\- In case the variable Serving_Grant has the value \"Zero_Grant\" after the
Serving Grant Update function and there is no data available for MAC-d flows
for which non-scheduled grants were configured and the transmission of
Scheduling Information has been triggered, the "Control-only" HARQ profile
configured by the higher layers shall be used.
\- The Nominal Power Offset shall be set to the power offset included in the
transmission HARQ profile;
\- The UE shall not use the following E-TFCIs;
\- If the UE is configured with E-TFCI table 0 (see [7]) and 2ms TTI, it shall
not use E-TFCI 120 in the mapping defined in Annex B.1
\- If the UE is configured with E-TFCI table 1 (see [7]) and 2ms TTI, it shall
not use E-TFCI 115 in the mapping defined in Annex B.2
\- If the UE is configured with E-TFCI table 2 (see [7]) and 2ms TTI, it shall
not use E-TFCI 121 in the mapping defined in Annex B.2a
\- If the UE is configured with E-TFCI table 3 (see [7]) and 2ms TTI, it shall
not use E-TFCIs 101 and 102 in the mapping defined in Annex B.2b
\- The data allocation shall maximize the transmission of higher priority
data. When scheduled and non-scheduled grants are taken into account for the
upcoming transmission:
\- Data of a given priority belonging to a scheduled MAC-d flow shall have
precedence over any lower priority data, whether they belong to a scheduled or
a non-scheduled MAC-d flow;
\- Data of a given priority belonging to a non-scheduled MAC-d flow shall have
precedence over any lower priority data, whether they belong to a scheduled or
a non-scheduled MAC-d flow;
\- If several MAC-d flows are associated with logical channels of equal
priority, the data allocation should ensure that all equal priority flows are
served.
\- The amount of data and corresponding MAC-e/es or MAC-i/is headers from
MAC-d flows for which non-scheduled grants were configured shall not exceed
the value of the non-scheduled grant.
\- If a 10ms TTI is configured and the TTI for the upcoming transmission
overlaps with a compressed mode gap, the Serving_Grant provided by the Serving
Grant Update function shall be scaled back as follows:
> where SG' represents the modified serving grant considered by the E-TFC
> selection algorithm and N~C~ represents the number of non DTX slots in the
> compressed TTI;
\- For CELL_DCH state, if the transmission contains any scheduled data, the
size of the selected MAC-e or MAC-i PDU shall not exceed the total of:
\- all non-scheduled grants which are applicable for transmission in this TTI;
\- the maximum number of scheduled bits based on the Serving Grant (after
adjustment for compressed frames) and the power offset from the selected HARQ
profile;
\- the size of the triggered scheduling information (if any).
\- For CELL_FACH state and Idle mode, if the transmission contains any
scheduled data, the size of the selected MAC-i PDU shall not exceed the total
of:
\- the maximum number of scheduled bits based on the Serving Grant and the
power offset from the selected HARQ profile;
\- the size of the triggered scheduling information (only if Scheduling
Information is triggered by a periodic Scheduling Information reporting as
specified in subclause 11.8.1.6).
\- In the case a 2ms TTI is configured and the HARQ process is inactive, the
UE shall not include in the transmission any data from MAC-d flows for which
no non-scheduled grants were configured;
\- For CELL_DCH state, the Scheduling Information is always sent when
triggered (see subclause 11.8.1.6);
\- Only E-TFCs in supported state shall be considered;
\- Once all other requirements have been fulfilled, the E-TFC resulting in the
smallest amount of padding for the selected MAC-es or MAC-is PDUs and
corresponding MAC-e/es or MAC-i/is headers, shall be selected including the
case when the Scheduling Information needs to be transmitted.
While respecting all the above listed requirements, for each logical channel
using RLC-UM, at every TTI, the UE may select the RLC PDU size so as to
maximise the amount of data of this logical channel that can be transmitted.
Once an appropriate E-TFC and data allocation are found according to the rules
above, the \"Multiplexing and TSN Setting" entity shall generate the
corresponding MAC-e or MAC-i PDU.
The E-TFC selection function shall provide this MAC-e or MAC-i PDU and
transmission HARQ profile to the HARQ entity. The maximum number of HARQ
transmissions and the power offset in this profile, shall be set respectively
to the maximum of the Max Number of HARQ Transmissions of the HARQ profiles
from all the MAC-d flows from which data is multiplexed into the transmission
and to the Nominal Power Offset. The HARQ entity shall also be informed of
whether the transmission includes Scheduling Information and whether this
information is sent by itself or with higher-layer data. The E-TFC selection
function shall provide the E-TFCI for the selected E-TFC to the HARQ entity.
In FDD, for each Activated Uplink Frequency, in case the DTX feature is
configured by higher layers and no E-DCH transmission is performed in this TTI
on that Activated Uplink Frequency:
\- if _MAC_ _Inactivity Threshold_ > 1 and no E-DCH transmission has been
performed for _MAC_ _Inactivity Threshold_ \- 1 previous TTIs or,
\- if _MAC Inactivity Threshold_ = 1:
\- E-TFC selection shall only be performed for the TTIs where the following
conditions are fulfilled:
\- For 2ms TTI: [5*CFN + subframe number - _UE DTX DRX Offset_] **mod** _MAC
DTX Cycle_ = 0;
\- For 10ms TTI: [5*CFN - _UE DTX DRX Offset_] **mod** _MAC DTX Cycle_ = 0.
> In 2ms TTI case, if the TTI that fulfilled [5*CFN + subframe number \- UE
> DTX DRX Offset] mod MAC DTX Cycle = 0 overlapped with an uplink compressed
> mode transmission gap, the E-TFC selection shall be performed for the first
> TTI not overlapping with an uplink compressed mode transmission gap.
#### 11.8.1.4a E-TFC Selection for uplink MIMO
When the maximum allowed rank is 1 and the HARQ entity invokes the E-TFC
selection procedure for the primary stream, then the E-TFC selection procedure
is applied as specified in sub-clause 11.8.1.4.
When the maximum allowed rank is 2, then the E-TFC selection procedure is as
follows:
\- If the HARQ entity has invoked E-TFC selection procedure for both streams:
\- For the primary stream, the E-TFC selection procedure is applied as
specified in sub-clause 11.8.1.4 assuming rank2 transmission parameters.
\- If E-TFCI selected for the primary stream is equal to or greater than the
minimum TB size for rank2 transmissions, then for the secondary stream, the
E-TFC selection procedure is applied as specified in sub-clause 11.8.1.4,
where the virtual serving grant is used, which is calculated according to the
formula below and is based on the transmit power chosen for the primary stream
and the Node B signalled offset _S-ETFC Offset Value_ as defined in table 16D
of [16].
\- If either the primary or the secondary stream E-TFCI is less than the
minimum TB size for rank2, then a UE shall perform again the E-TFC selection
procedure for rank1 transmission as specified in 11.8.1.4. Indicate to HARQ
entity that rank1 transmission shall take place.
\- If the HARQ entity has invoked E-TFC selection only for the primary stream:
\- Perform the E-TFC selection procedure as specified in sub-clause 11.8.1.4
assuming rank2 transmission parameters.
\- If E-TFCI selected for the primary stream is less than the minimum TB size
for rank2 transmission configured by higher layers, the pending secondary
stream retransmission shall be transmitted on the primary stream using rank1
transmission and gain factors that would be used for that E-TFC on the primary
stream.
\- If the HARQ entity has invoked E-TFC selection only for the secondary
stream:
\- If according to the E-TFC restriction procedure for rank2 transmission as
described in [12], the maximum E-TFC in supported state on the primary stream
is smaller than the retransmission block size on the primary stream:
\- Indicate to HARQ entity that rank1 transmission shall take place. The
pending primary stream retransmission shall be transmitted on the primary
stream using rank1 transmission and gain factors that would be used for that
E-TFC on the primary stream.
\- Else:
\- Determine the maximum allowed number of bits of scheduled data according to
the Serving_Grant in the primary stream as described in sub-clause 11.8.1.4
using the power offset from the HARQ profile used for the retransmission in
the primary stream.
\- If the maximum allowed number of bits of scheduled data according the
serving grant on the primary stream is equal to or larger than the minimum TB
size for rank2 transmission, perform the E-TFC selection procedure for the
second stream as specified in sub-clause 11.8.1.4, where the virtual serving
grant is used, which is calculated based on the transmit power chosen for the
primary stream and the Node B signalled offset _S-ETFC Offset Value_ as
defined in table 16D of [16] (see formula above).
\- If the selected E-TFCI for the secondary stream is less than the minimum TB
size for rank2 transmission, then indicate to the HARQ entity that rank1
transmission shall take place on the primary stream. The pending primary
stream retransmission shall be transmitted on the primary stream using rank1
transmission and gain factors that would be used for that E-TFC on the primary
stream.
#### 11.8.1.5 Happy Bit Setting
The Happy Bit is included on the E-DPCCH for every E-DCH transmission on each
Activated Uplink Frequency. E-DCH transmissions shall not be triggered
specifically to allow the transmission of the happy bit.
RRC configures MAC with the duration Happy_Bit_Delay_Condition, over which to
evaluate the current grant relative to the TEBS after application of the E-TFC
selection procedure described in subclause 11.8.1.4.
For every E-DCH transmission and for each Activated Uplink Frequency, the
Happy Bit on a frequency shall be set to \"unhappy\" if the three following
criteria are met on that frequency:
1) UE is transmitting as much scheduled data as allowed by the current
Serving_Grant, and as allowed by Virtual_Serving_Grant if the maximum allowed
rank is 2, in E-TFC selection on that frequency; and
2) UE has enough power available to transmit at higher data rate on that
frequency if uplink MIMO is not configured; if uplink MIMO is configured, if
UE has enough power available to transmit at higher data rate on the primary
stream; and
3) Based on the same power offset as the one selected in E-TFC selection to
transmit data in the same TTI as the Happy Bit, TEBS would require more than
Happy_Bit_Delay_Condition ms to be transmited with the current Serving_Grant ×
the ratio of active processes to the total number of processes.
If there is more than one Activated Uplink Frequency, based on the same power
offset as the one selected in E-TFC selection on each Activated Uplink
Frequency to transmit data in the same TTI as the Happy Bit, TEBS would
require more than Happy_Bit_Delay_Condition ms to be transmited with the
current (Serving_Grant × the ratio of active processes to the total number of
processes on the Primary Uplink Frequency) plus (Serving_Grant × the ratio of
active processes to the total number of processes on the Secondary Uplink
Frequency).
> If maximum allowed rank is 2, based on the same power offset as the one
> selected in E-TFC selection to transmit data in the same TTI as the Happy
> Bit, TEBS would require more than Happy_Bit_Delay_Condition ms to be
> transmited with the current (Serving_Grant × the ratio of active processes
> to the total number of processes on the primary stream) plus
> (Virtual_Serving_Grant × the ratio of active processes to the total number
> of processes on the secondary stream).
The first criteria is always true for a deactivated process and the ratio of
the third criteria is always 1 for 10ms TTI.
Otherwise, the Happy Bit shall be set to \"happy\". When the UE has more than
one Activated Uplink Frequency, the power used to assess whether the UE has
enough power to transmit at a higher data rate on one Activated Uplink
Frequency is based on the maximum remaining power allowed for E-DCH
transmission on that Activated Uplink Frequency as determined by E-TFC
selection described in subclause 11.8.1.4 and in [12].
In order to assess if it has enough power available to transmit at higher data
rate on an Activated Uplink Frequency, the UE shall:
1) If MAC-i/is is configured, identify the E-TFC that has a transport block
size at least 32 bits larger than the transport block size of the E-TFC
selected for transmission in the same TTI as the Happy Bit. Otherwise,
identify the E-TFC that has a transport block size at least _x_ bits larger
than the transport block size of the E-TFC selected for transmission in the
same TTI as the Happy Bit, where _x_ is the smallest RLC PDU size configured
among all the logical channels that do not belong to non-scheduled MAC-d flows
and which have data in the buffer; and
2) Based on the same power offset as the one selected in E-TFC selection to
transmit data in the same TTI as the Happy Bit, check that the identified
E-TFC is supported i.e. not blocked.
#### 11.8.1.6 Scheduling Information reporting
Scheduling information reports will be triggered differently depending on the
value of the variable Serving_Grant after the Serving Grant Update function.
The triggering of a report shall be indicated to the E-TFC selection function
at the first new transmission opportunity.
Even if multiple events are triggered by the time a new transmission can take
place, only a single scheduling information header will be included in the
payload.
Even if multiple events are triggered on an Activated Uplink Frequency by the
time a new transmission can take place, only a single scheduling information
header will be included in the payload on that frequency.
If uplink MIMO is configured, even if multiple events are triggered by the
time a new transmission can take place, only a single scheduling information
header shall be included in the payload on the primary stream. If the primary
stream has a pending retransmission, then the scheduling information is
included only on the secondary stream.
In CELL_DCH state, when MAC-e or MAC-i is configured, the Scheduling
Information shall not be transmitted if the TEBS is zero, even if it was
triggered by one of the configured triggering mechanisms.
In CELL_DCH state, when MAC-i is configured, and in CELL_FACH state for FDD
and for DCCH/DTCH or NodeB triggered HS-DPCCH transmission, if the size of the
data plus header is less than or equal to the TB size of the E-TFC selected by
the UE minus 18 bits, a Scheduling Information shall be concatenated into this
MAC-i PDU. If uplink MIMO is configured, then it applies to both streams.
Otherwise a Scheduling Information is not included.
For FDD and for CCCH transmission in CELL_FACH state and Idle mode, the
transmission of Scheduling Information shall only be triggered when TEBS
becomes zero and the MAC-i PDU containing the last data is being transmitted.
The SI is transmitted with the MAC-i PDU carrying the last data, given the
serving grant is sufficient to carry the SI with the last remaining data.
Otherwise, the empty buffer status report is transmitted separately with the
next MAC-i PDU.\ For FDD and for DTCH/DCCH transmission in CELL_FACH state,
the transmission of Scheduling Information shall be triggered once, if the
TEBS remains zero and no higher layer data remains in MAC to be transmitted
for a period given by the E-DCH transmission continuation back off period
unequal \"infinity\". For FDD and for DTCH/DCCH transmission in CELL_FACH
state with E-DCH transmission continuation back off period set to \"infinity\"
or \"zero\", the transmission of Scheduling Information shall be triggered
each time when the TEBS becomes zero and no higher layer data remains in MAC
to be transmitted after the transmission of the MAC-i PDU containing the
scheduling information with the empty buffer status report. When \"E-DCH
transmission continuation back off\" is set to \"infinity\", the Scheduling
Information with empty buffer status report shall be transmitted with the
MAC-i PDU carrying the last DCCH/DTCH data, given the serving grant is
sufficient to carry the SI in the same MAC-i PDU together with the remaining
DCCH/DTCH data. Otherwise, the Scheduling Information with empty buffer status
report is transmitted separately with the next MAC-i PDU.
For FDD and for DTCH/DCCH transmission in CELL_FACH state when \"E-DCH
transmission continuation back off\" is not set to \"infinity\", a periodic
Scheduling Information with empty buffer status report shall not be
transmitted.
In FDD, for NodeB triggered HS-DPCCH transmission in CELL_FACH state during
collision resolution phase, if there is no on-going or previous E-DCH
transmission on the allocated common E-DCH resource, the transmission of
Scheduling Information shall be triggered. The transmission of scheduling
information shall also be triggered upon expiration of timer Tbhs.
In FDD, during collision resolution phase in CELL_FACH state, for DCCH/DTCH or
NodeB triggered HS-DPCCH transmission, a Scheduling Information with TEBS
value different from zero can only be transmitted at the end of a MAC-is SDU.
If the Scheduling Information needs to be included in the MAC-e according to
subclause 9.2.4.2, it shall be transmitted regardless of TEBS status.
The transmission of Scheduling Information can take place on every HARQ
process, even on those processes for which transmission is restricted
according to RRC or deactivated by absolute grants, i.e. processes on which
scheduled and/or non-scheduled transmission can not take place. In CELL_FACH
state and Idle mode, when 2ms TTI is configured and \"Per HARQ process\" scope
is enabled by higher layers, the transmission of Scheduling Information shall
take place on those processes for which transmission is allowed, i.e.
processes on which scheduled transmission can take place.
The description of the behaviour in the two cases is provided below. When more
than one uplink frequency is configured, the Scheduling Information reporting
mechanisms are evaluated independently per Activated Uplink Frequency.
##### 11.8.1.6.1 Report Triggering when SG = "Zero_Grant" or all processes are
deactivated
If the Serving_Grant has the value \"Zero_Grant\" or all processes are
deactivated on that frequency, and the TEBS becomes larger than zero, the
transmission of Scheduling Information shall be triggered on that frequency.
If data with higher priority than the data already in the transmission buffer
arrives, the transmission of a Scheduling Information shall be triggered on
that frequency.
RRC can also configure MAC with periodic Scheduling Information triggering.
The periodic trigger timer T_SING (Timer Scheduling Information --
\"Zero_Grant\") on a frequency shall be started once the Serving_Grant
variable becomes \"Zero_Grant\" or all processes are deactivated on that
frequency and TEBS is larger than zero. The T_SING timers for all the
Activated Uplink Frequencies shall have the same value.
When T_SING expires, the transmission of a Scheduling Information shall be
triggered on that frequency.
T_SING timer on a frequency shall be restarted when the transmission of a
Scheduling Information is triggered on that frequency.
T_SING on a frequency shall be stopped and reset once the Serving_Grant
variable in the Serving Grant Update function takes a value other than
\"Zero_Grant\" and at least one process is activated on that frequency.
When the secondary uplink frequency is deactivated, the T_SING timer
corresponding to the secondary uplink frequency shall be stopped and reset, if
running.
##### 11.8.1.6.2 Report Triggering when SG \<> "Zero_Grant" and at least one
process is activated
If SG becomes too small to allow transmission of a single PDU from any
scheduled MAC-d flow or if the SG is too small to allow transmission of a
single PDU from any scheduled MAC-d flow on that frequency and TEBS becomes
larger than zero, the transmission of Scheduling Information should be
triggered on that frequency .
If an E-DCH serving cell change occurs and if the new E-DCH serving cell was
not part of the previous Serving E-DCH RLS, the transmission of a Scheduling
Information shall be triggered on that frequency.
RRC can configure MAC with periodic triggering also for the case when the
variable Serving_Grant \<> \"Zero_Grant\" and at least one process is
activated on that frequency. The periodic trigger timer T_SIG (Timer
Scheduling Information -- different from \"Zero_Grant\") can be configured to
a different value than T_SING. The T_SIG timers for all the Activated Uplink
Frequencies shall have the same value.
T_SIG shall be started once the Serving_Grant variable becomes \<>
\"Zero_Grant\" and at least one process is activated on that frequency.
When T_SIG expires, the transmission of a new Scheduling Information shall be
triggered on that frequency and on the rest of the Activated Uplink
Frequencies which T_SIG timer is running.
T_SIG timer on a frequency shall be stopped and reset once the Serving_Grant
variable in the Serving Grant Update function becomes equal to \"Zero_Grant\"
or all processes are deactivated on that frequency.
When the secondary uplink frequency is deactivated, the T_SIG timer
corresponding to the secondary uplink frequency shall be stopped and reset, if
running.
T_SIG on a frequency shall be restarted when the transmission of a Scheduling
Information is triggered on that frequency.
Once the Serving_Grant variable in the Serving Grant Update function becomes
equal to \"Zero_Grant\" or all processes are deactivated on a frequency and
TEBS is larger than zero, the transmission of a Scheduling Information shall
be triggered on that frequency.
11.8.1.6.3 HARQ delivery failure for triggered Scheduling Information
If the HARQ process fails to deliver a MAC-e or MAC-i PDU containing a
triggered Scheduling Information to the RLS containing the serving cell:
\- if the TEBS field of the SI for which the HARQ transmission failed is set
to zero and if UE is in CELL_FACH state or idle mode:
\- if this is a DTCH/DCCH transmission and \"E-DCH transmission continuation
back-off\" is set to \"infinite\":
\- the transmission of a new Scheduling Information shall be triggered
\- else
\- no further action is required.
\- else, if the Scheduling Information was transmitted without any higher
layer data multiplexed in the same MAC-e or MAC-i PDU:
\- no further action is required (rely on periodic triggering).
\- else (Scheduling Information was transmitted together with higher layer
data multiplexed in the same MAC-e or MAC-i PDU):
\- the transmission of a new Scheduling Information shall be triggered on the
same uplink frequency associated to the serving cell.
#### 11.8.1.7 MAC-es/e Reset
If a reset of the MAC-es/e or MAC-is/i entity is requested by upper layers,
the UE shall at the activation time indicated by higher layers:
\- flush all HARQ processes;
\- set CURRENT_TSN to 0 for all the logical channels mapped to E-DCH;
\- if MAC-i/is is configured by upper layers:
\- discard all segments stored in segmentation entities.
NOTE: In this case, the HARQ entity will not notify the Scheduling Information
Reporting function if a flushed MAC-e or MAC-i PDU contained a triggered
Scheduling Information (rely on periodic triggering).
#### 11.8.1.8 Monitoring of Absolute and Relative Grant Channels {#monitoring-
of-absolute-and-relative-grant-channels .list-paragraph}
When the DRX feature is enabled by higher layers, and in addition to the
conditions defined in subclause 6C.3 of [13] the downlink monitoring of E-AGCH
and E-RGCH sets on a frequency is required in the following conditions:
\- At least one MAC-d flow is configured with a scheduled transmission and
TEBS > 0 or;
\- a scheduled E-DCH transmission has been performed in any of the _Inactivity
Threshold for UE Grant Monitoring_ previous uplink TTIs on the associated
uplink frequency or;
\- the start of E-AGCH or E-RGCH commands overlap in time with an E-HICH
corresponding to a scheduled E-DCH transmission on the associated uplink
frequency.
#### 11.8.1.9 Release of common E-DCH resources (FDD only) {#release-of-
common-e-dch-resources-fdd-only .list-paragraph}
If the UE is sending CCCH data in CELL_FACH state or Idle mode, the UE shall
release the common E-DCH resource under following conditions:
\- the empty buffer status (TEBS = 0 byte) has been reported and no MAC-i PDU
is left in a HARQ process for (re-)transmission; or
\- the maximum E-DCH resource allocation for CCCH is reached, or;
\- a L1 synchronisation failure is reported.
If the UE is sending DTCH or DCCH data, the UE shall release the common E-DCH
resource under following conditions:
\- a L1 synchronization failure occurs; or
\- the maximum period for collision resolution is reached and no E-AGCH with
the UE's E-RNTI (through an E-RNTI specific CRC attachment) has been reached;
or
\- an E-AGCH is received with a common E-DCH resource release command
(INACTIVE and Absolute Grant Scope set to \"All HARQ processes\") (explicit
common E-DCH resource release) or;
\- \"E-DCH transmission continuation back off\" is not set to \"infinity\",
the empty buffer status (TEBS = 0 byte) has been reported and no MAC-i PDU is
left in a HARQ process for (re-)transmission.
If the UE is allocated the common E-DCH resource for NodeB triggered HS-DPCCH
transmission, the UE shall release the common E-DCH resource under following
conditions:
\- a L1 synchronization failure occurs; or
\- the maximum period for collision resolution is reached and no E-AGCH with
the UE's E-RNTI (through an E-RNTI specific CRC attachment) has been reached;
or
\- an E-AGCH is received with a common E-DCH resource release command
(INACTIVE and Absolute Grant Scope set to \"All HARQ processes\") (explicit
common E-DCH resource release); or
\- \"E-DCH transmission continuation back off\" is not set to \"infinity\",
timer Tb has expired and empty buffer status (TEBS = 0 byte) has been reported
and no MAC-i PDU is left in a HARQ process for (re-)transmission; or
\- \"HS-DPCCH transmission continuation back off\" is present, timer Tbhs has
expired and empty buffer status (TEBS = 0 byte) has been reported and no MAC-i
PDU is left in a HARQ process for (re-)transmission.
### 11.8.2 Node B operation
#### 11.8.2.1 HARQ Operation
##### 11.8.2.1.1 HARQ entity
There is one HARQ entity per UE per E-DCH in each Node-B in its E-DCH active
set. The HARQ entity routes the payload and the associated RSN value to the
appropriate HARQ process based on the transmission timing. Based on the
outcome of the decoding, the HARQ entity transmits an ACK or a NACK in return.
##### 11.8.2.1.2 HARQ process
The HARQ process uses the RSN and the transmission timing (CFN, sub-frame) to
establish the transmission number. Based on this it identifies the
transmission redundancy version and attempts to decode the transmission. The
outcome of the decoding is reported to the HARQ entity, so that it may be fed
back to the UE.
#### 11.8.2.2 De-multiplexing
There is one de-multiplexing entity per E-DCH transport channel per UE in the
Node B. If the MAC-e/es is configured by upper layers, the SRNC configures the
Node B with the mapping between the active DDI values and the corresponding
MAC-d flow and PDU size. If the MAC-i/is if configured by upper layers, the
SRNC configured the Node B with the mapping between the LCH-ID and the
corresponding MAC-d flow. Also, it provides it with the mapping between MAC-d
flow IDs and the corresponding Iub bearer.
If MAC-e/es is configured by upper layers, the de-multiplexing entity uses the
MAC-e header information (DDI, N) to determine the size of each MAC-es PDU and
based on this it segments the MAC-e payload into MAC-es PDUs. If MAC-i/is is
configured by upper layers, the de-multiplexing entity uses the MAC-i header
information (L) to determine the size of each MAC-is SDU and based on this it
segments the MAC-i payload into MAC-is PDUs. These are then routed onto the
Iub bearer indicated by the DDI value.
With each MAC-es PDU, the Node B will send to the SRNC:
\- the associated DDI and N values;
\- the CFN and sub-frame numberwhen the payload including the MAC-es PDU was
decoded correctly;
\- the total number of transmissions that were needed for the MAC-e PDU to be
decoded correctly.
With each MAC-is PDU, the Node B will send to the SRNC:
\- the associated LCH-ID and L values for each MAC-is SDU;
\- the CFN and sub-frame number when the payload including the MAC-is PDU was
decoded correctly;
\- the total number of transmissions that were needed for the MAC-i PDU to be
decoded correctly.
#### 11.8.2.3 Scheduler
There is one E-DCH Node B scheduler per Node B. The Node B scheduler is
responsible for the following functions:
\- Allocating uplink resources to UEs for which it acts as the serving Node B;
\- Monitoring other-cell interference and accordingly sending relative grants
to UEs for which it does not act as the serving Node B;
\- Reporting to the SRNC on the lack of processing resources;
#### 11.8.2.4 E-DCH Provided Bit Rate measurement
The E-DCH Provided Bit Rate measurement is defined as follows:
\- for each priority class the MAC-e or MAC-i function in the Node B measures
the total number of MAC-d PDU bits whose transmission over the radio interface
has been considered successful by MAC-e or MAC-i in Node-B during the last
measurement period, divided by the duration of the measurement period;
\- the number of MAC-d PDU bits from UEs in softer handover shall be
considered after soft combining;
\- the Node-B shall allocate the bit rate received over an RLS equally divided
among all cells in the RLS regardless of whether the RLS contains the E-DCH
serving cell or not;
\- the values reported shall be raw samples;
\- the measurement period shall be 100 ms.
#### 11.8.2.5 Determination of UE-ID (FDD only) and collision resolution
For UEs in CELL_FACH state or Idle mode, the Node B determines whether the UE
id (E-RNTI) was included by the UE.
If the Node B receives a MAC-i PDU with an E-RNTI included in the MAC-i
header, then the Node B is aware of the user performing a collision resolution
phase using a common E-DCH resource. The presence of the E-RNTI during the
collision resolution phase identifies DCCH/DTCH data or NodeB triggered HS-
DPCCH transmission by the UE. By sending a received E-RNTI on the E-AGCH, the
Node B grants the common E-DCH resource explicitly to the UE with this UE id,
resolving any potential collision. A UE adds its E-RNTI in all MAC-i PDUs at
its side until the UE receives an E-AGCH with its E-RNTI (through an E-RNTI-
specific CRC attachment).
For CCCH data transmission, no E-RNTI is included in any MAC-i header and no
collision resolution is performed.
### 11.8.3 RNC operation
#### 11.8.3.1 Re-ordering entity for DTCH/DCCH transmission
The re-ordering entity is part of the MAC-es or MAC-is sublayer in the SRNC.
There is one re-ordering entity per UE. Each re-ordering entity will support
one re-ordering process per logical channel. If MAC-es is configured by upper
layers, the DDI value is used to determine the logical channel for which each
MAC-es PDU is meant. If MAC-is is configured by upper layers, the LCH-ID value
is used to determine the logical channel for which each MAC-is SDU is meant.
Based on this information, the MAC-es or MAC-is PDUs are routed to the proper
re-ordering process. The re-ordering process may use the explicit TSN
indication as well as the timing information provided by the Node B in order
to eliminate duplicates and deliver the packets in order to RLC. The details
of the re-ordering mechanism are left up to the implementation.
#### 11.8.3.2 Re-ordering and CRC entity for CCCH transmission
The re-ordering entity is part of MAC-is sublayer in the CRNC. There is one
re-ordering entity per common E-DCH resource. Each re-ordering entity will
support one re-ordering process. If MAC-is is configured by upper layers, the
LCH-ID value is used to determine the logical channel for which each MAC-is
SDU is meant. Based on this information, the received TSN and Node-B tagging
i.e. (CFN, subframe number), the MAC-is PDUs are routed to the proper re-
ordering process. The re-ordering process may use the explicit TSN indication
as well as the timing information provided by the Node B in order to eliminate
duplicates. When the MAC-c PDU is received correctly then after reassembly the
CRC field is removed and the resulting data is delivered to the MAC-c.
However, if a MAC-c PDU has been received with an incorrect CRC, the MAC-c PDU
is discarded. The details of the re-ordering mechanism are left up to the
implementation.
Note: A CRC sequence is added to a MAC-c PDU only, if the MAC-c PDU is not
sent completely in one MAC-i PDU.
## 11.9 Control of E-DCH transmission and reception (TDD)
### 11.9.1 UE operation
#### 11.9.1.1 HARQ Operation
The TDD HARQ protocol is a stop and wait protocol based on synchronous
downlink ACK/NACKs with asynchronous retransmissions in the uplink. If NACK is
received then the UE may only retransmit the previously transmitted MAC-e or
MAC-i PDU if suitable physical resources are available, otherwise it must wait
until it receives an appropriate Absolute Grant (or in the case of non-
scheduled transmission, the UE must wait until resource is next designated as
available for non-scheduled transmission/retransmission). There are a maximum
of 8 HARQ processes (instances of the HARQ entity). For 1.28 Mcps TDD, there
are a maximum of 4 HARQ processes employed for the UEs in CELL-FACH state and
idle mode as non-scheduled transmission is not allowed. Operation of the HARQ
protocol is as follows:
\- If an Absolute Grant is received in Frame (i) then the UE transmits a data
block (MAC-e or MAC-i PDU) in Frame (i+T1)
\- For a MAC-e or MAC-i PDU transmitted in Frame (i+T1) the UE receives an
ACK/NACK in Frame (i+T1+T2)
\- If NACK is received in Frame (i+T1+T2) then the UE cannot retransmit the
MAC-e or MAC-i PDU previously transmitted in Frame (i+T1) (now stored for
potential retransmission) until suitable physical resources are available
(e.g. until Absolute Grant received)
\- The interval T3 between reception of NACK and the availability of suitable
resources via reception of a Grant for a subsequent retransmission is variable
and depends on Node B scheduling decisions
\- If an ACK is received in Frame (i+T1+T2) then the MAC-e or MAC-i PDU
previously transmitted in Frame (i+T1) (stored for potential retransmission)
is discarded and the HARQ process identity associated with the previously
transmitted data block can now be reassigned.
NOTE: For 1.28 Mcps TDD, \"subframe\" should be used to describe the above
timing relation.T1 and T2 may be derived from the physical layer timings given
in [21]. For 1.28Mcps multi-carrier E-DCH operation, operation of the HARQ
protocol on each carrier configured by RNC is independent and same as the
description above for the single-carrier case.
Operation of the TDD HARQ protocol is illustrated by Figure 11.9.1.1.
Figure 11.9.1.1: TDD E-DCH HARQ Operation
##### 11.9.1.1.1 HARQ entity
There is one HARQ entity per E-DCH in the UE. A number of parallel HARQ
processes (identified by a HARQ process identifier) are used in the UE to
support the HARQ entity, allowing transmissions to take place continuously
while the UE is granted resources.The HARQ entity identifies the HARQ process
for which transmission should take place if resources are available. Also,
based on timing with respect to a previously-transmitted MAC-e or MAC-i PDU it
routes the receiver feedback (ACK/NACK information), relayed by the physical
layer, to the appropriate HARQ process.
The minimum number of HARQ processes per HARQ entity is a function of T1 and
T2 (see subclause 11.9.1.1). The maximum number of HARQ process identifiers
per HARQ entity is 8. Each process is associated with a HARQ process
identifier numbered from 0 to 7. For multi-carrier E-DCH operation, the
maximum number of HARQ process per HARQ entity is 4.
The HARQ entity is responsible for determining which HARQ process will use the
assigned resources in a given TTI (for both scheduled and non-scheduled
resource types). It is further responsible for determining for each HARQ
process whether new data or existing data should be transmitted from the HARQ
process buffer, including the case in which new data is transmitted before
successful delivery of the existing data.
For transmission in a given TTI, the HARQ entity shall only consider those
HARQ processes associated with the resource grant type (scheduled / non-
scheduled). HARQ processes 0 to 3 per HARQ entity are associated with
scheduled transmission whilst HARQ processes 4 to 7 are associated with non-
scheduled transmission. In the following, the set of HARQ processes associated
with the resource grant type is denoted the \"associated set\".
When the E-DCH SPS operation is enabled, the grant should include E-DCH SPS
resources, and the E-DCH SPS resource is only mapped on one carrier configured
by higher layer.
The following rules control the operation of the HARQ entity:
  * If retransmissions are pending for any of the HARQ processes of the associated set:
    * the HARQ entity shall determine for each HARQ process of the associated set whether the current resource grant is sufficient to allow retransmission of the data. The grant is deemed to be sufficient if the corresponding transport block size is supportable within the allocated resources as determined by the E-TFC selection entity (see subclause 11.9.1.4);
    * if the grant is sufficient for retransmission by at least one of the HARQ processes of the associated set, select the HARQ process containing the oldest MAC-e or MAC-i PDU for retransmission and notify the E-TFC selection entity that the TTI shall be used for retransmission;
    * if the grant is not sufficient for retransmission by any of the HARQ processes of the associated set, the HARQ entity shall select an available HARQ process from the associated set for transmission of new data. In the case that none of the HARQ processes in the associated set are available (all contain data for retransmission) the HARQ entity shall discard the data from the HARQ process in the associated set containing the oldest MAC-e or MAC-i PDU and shall select that HARQ process for transmission of new data. In either case, the HARQ entity shall notify the E-TFC selection entity that the TTI shall be used for a new transmission.
  * else:
    * the HARQ entity shall select an available HARQ process from the associated set for transmission of new data and shall notify the E-TFC selection entity that the TTI shall be used for a new transmission of scheduled data.
##### 11.9.1.1.2 HARQ process
Each HARQ process is associated with a physical buffer (HARQ buffer).
Each HARQ process maintains the state variable CURRENT_TX_NB, which indicates
the number of transmissions that have taken place for the MAC-e or MAC-i PDU
currently in the buffer. For 1.28 Mcps TDD, each HARQ process also maintains
the timer RTX_TIMER used to determine whether a pending retransmission should
be discarded. When the HARQ process is established, CURRENT_TX_NB shall be
initialized to 0.
At the time of a new transmission, the HARQ entity provides the HARQ profile
to use for all transmissions and re-transmissions of this MAC-e or MAC-i PDU.
This HARQ profile includes information on the maximum number of transmissions
to perform, and the power offset with which to configure the physical layer.
For 1.28 Mcps TDD, the HARQ profile also includes a retransmission timer
attribute.
If the HARQ entity provides a new PDU, the HARQ process shall:
\- set CURRENT_TX_NB to 0;
\- set CURRENT_RSN to 0;
\- store the MAC-e or MAC-i PDU in the associated HARQ buffer;
\- for 1.28 Mcps TDD, if RTX_TIMER is active, it shall be stopped;
\- generate a transmission as described below.
If the HARQ entity requests a re-transmission, the HARQ process shall:
\- generate a transmission as described below.
\- for 1.28 Mcps TDD, start RTX_TIMER for this MAC-e or MAC-i PDU if NACK is
received for the initial transmission.
To generate a transmission, the HARQ process shall:
\- instruct the physical layer to set the RSN field on the E-UCCH to
CURRENT_RSN;
\- instruct the physical layer to generate a transmission with the power
offset corresponding to the HARQ profile and the redundancy version
corresponding to the RSN value
\- if CURRENT_RSN \ T-SCHED + T-RUCCH /2 then the UE shall
send scheduling information via the E-RUCCH and shall stop and reset the
scheduling information delay timer.
#### 11.9.1.5 Scheduling Information reporting (1.28 Mcps TDD only)
A \"Grant Request\" type Scheduling Information can be triggered if any of the
following events occur:
\- The TEBS becomes larger than zero;
\- An E-DCH serving cell change occurs and the TEBS is larger than zero;
\- An E-DCH working frequency change occurs in the serving cell and the TEBS
is larger than zero;
\- An E-RNTI change occurs in the serving cell;
An optional Extended Estimation Window (defined by RRC in TTIs) may be used to
prevent the UE from triggering unnecessary E-RUCCH transmission in case the UE
potentially has an available Grant a short time in the future. The UE may
perform a persistent check through the Extended Estimation Window to evaluate
whether there is a Grant available for new data transmission when the UE can
not take the decision just according to the related HARQ information, e.g,
HARQ timing, HARQ retransmission numbers and so on. If an E-RNTI change occurs
in the serving cell, the UE shall ignore the Grant with the previous E-RNTI
for \"Grant Request\" type Scheduling Information reporting.
If a UE has no Grant (including scheduled grant or non-scheduled grant)
available for a new MAC-e or MAC-i PDU transmission in current TTI or in the
Extended Estimation Window (if configured by RRC), as the \"Grant Request\"
type Scheduling Information is triggered, the transmission of Scheduling
Information shall be triggered via E-RUCCH.
Else if the UE has a Grant (including scheduled grant or non-scheduled grant)
available for a new MAC-e or MAC-i PDU transmission in current TTI or in
Extended Estimation Window (if configured by RRC), as the \"Grant Request\"
type Scheduling Information is triggered, the scheduling information should be
included in a MAC-e or MAC-i PDU via the Grant. If the HARQ process fails to
deliver the MAC-e or MAC-i PDU containing the triggered the \"Grant Request\"
type Scheduling Information, another \"Grant Request\" type Scheduling
Information shall be triggered.
When MAC-e is configured and assembling a MAC-e PDU, if the scheduling
information needs to be included in the MAC-e PDU according to subclause
9.2.4.2 and it shall be transmitted regardless of TEBS status.
When MAC-i is configured and assembling a MAC-i PDU, if the size of the data
plus header is less than or equal to the TB size of the E-TFC selected by the
UE minus 23 bits, a Scheduling Information shall be concatenated into this
MAC-i PDU and it shall be transmitted regardless of TEBS status.
Additional periodic timer T-SI is used to avoid long pause duration of
scheduling information reporting (defined by RRC). Once the grant is
designated, T-SI shall be started. The T-SI is maintained per UE for multi-
carrier E-DCH operation. And if the UE is in multi-carrier E-DCH operation
with more than one carrier group, and an extend SI with all E-DCH carriers
information (see subclause 9.2.6.3) is included at the end of the MAC-i PDU
and sent, the timer shall be restarted immediately. Otherwise the legacy
Scheduling information (see Figure 9.2.6.3 1-a) is included at the end of the
MAC-I PDU and sent for single carrier E-DCH and only one carrier group is
configured , the timer shall be restarted immediately. When the scheduling
information is included in MAC-e or MAC-i PDU and sent, the timer shall be
restarted immediately. When the timer expires, if there is a grant to send a
new MAC-e or MAC-i PDU, it should include scheduling information, otherwise
the UE shall wait for a grant to send scheduling information in a new MAC-e or
MAC-i PDU.
Additionally if data with higher priority than the data already in the
transmission buffer arrives, the Scheduling Information shall be triggered and
included in next available MAC-e or MAC-i PDU, i.e. higher priority data
arrival event shall not trigger a E-RUCCH procedure.
RRC can configure MAC with a delay timer to be used when the UE transits from
having a Grant on any configured E-DCH carrier to not having a Grant on any
configured E-DCH carrier and the TEBS is still larger than zero. The delay
timer T_WAIT shall be started once the Grant expires and shall be stopped and
reset when a Grant is received. When T_WAIT expires, the transmission of a
Scheduling Information shall be triggered via E-RUCCH (T_WAIT shall be stopped
and reset).
Even if multiple events are triggered by the time a new Scheduling Information
reporting can take place, only single scheduling information with newly
updated content shall be sent via E-RUCCH or included in a MAC-e or MAC-i PDU.
In the case that only non-scheduled transmission is configured without
scheduled transmission, the Scheduling Information reporting mechanism above
is not applicable, and Scheduling Information reporting procedure is defined
as below:
\- The Scheduling Information shall be included in the MAC-e PDU or MAC-i PDU
due to the quantization of the transport block sizes that can be supported as
defined in subclause 9.2.4.2;
\- If the periodic timer T-SI-NST is configured by RRC, the Scheduling
Information shall be triggered upon the expiriration of the periodic timer
T-SI-NST, and the triggered Scheduling Information shall be included in the
next new MAC-e PDU or MAC-i PDU, the maintenance of timer T-SI-NST is the same
as T-SI;
\- If both events are triggered by the time a new Scheduling Information
reporting can take place, only single scheduling information with newly
updated content shall be included in a MAC-e PDU or MAC-i PDU.
\- E-RUCCH procedure shall not be iniatiated for non-scheduled transmission
only case.
#### 11.9.1.5a Cell Reselection Indication in CELL_FACH state (1.28 Mcps TDD
only)
UE in CELL_FACH state with E-DCH transmission and HS-DSCH reception and having
available dedicated E-RNTI and H-RNTI may send Cell Reselection Indication to
the Node B scheduler of the serving cell in order to notify the scheduler that
the UE is to leave from this cell.
When the Cell Reselection criteria are met as in [5] and if any of the
condition is fulfilled, the Cell Reselection Indication procedure shall be
triggered and performed as below:
\- when the UE has sent the scheduling information with TEBS > 0 byte to Node
B scheduler, i.e. Node B may think the UE has data pending for transmission:
\- The Cell Reselection Indication is presented by the scheduling information
with TEBS = 0 and HLBS = \"1111\";
\- if the UE has a grant in next TTI or within Extended Estimation Window:
\- include the Cell Reselection Indication in next MAC-i PDU;
\- else
\- initiate E-RUCCH procedure to transmit the Cell reselection Indication,
regarding Mmax = 1. Upon reception of PHY-ACCESS-CNF primitive, MAC sends the
indication to RRC. The Control of E-RUCCH transmission is described in
11.9.2.3.2.1.
\- when the UE is during synchronization procedure;
\- The Cell Reselection Indication is presented by the scheduling information
with TEBS = 0 and HLBS = \"1111\";
\- initiate E-RUCCH procedure to transmit the Cell reselection Indication,
regarding Mmax = 1, Upon reception of PHY-ACCESS-CNF primitive, MAC send the
indication to RRC. The Control of E-RUCCH transmission is described in
11.9.2.3.2.1.
\- when the UE is during the downlink data receiving procedure;
\- The Cell Reselection Indication is carried in associated HS-SICH by setting
RTBS field to 0.
Once the Cell Reselection Indication procedure was accomplished or terminated,
then MAC informs RRC the termination of Cell Reselection Indication procedure
with CMAC-STATUS-Ind primitive.
#### 11.9.1.5b Common E-RNTI selection in CELL_FACH state and idle mode (1.28
Mcps TDD only)
RRC may configure MAC a common E-RNTIs list associated to each E-RUCCH on
which common E-RNTI may be used with the CMAC-CONFIG-Req primitive, each
common E-RNTIs list related for an E-RUCCH is divided into K groups and there
is N E-RNTIs in each group as configured by RRC. The K groups are numbered in
(0...k) as indicated by RRC.
Common E-RNTI selection procedure is invoked in case of sending E-RUCCH with
common E-RNTI for CCCH transmission, when performing common E-RNTI selection,
the SFN or the SFN' on which the E-RUCCH shall be sent and the TTI length of
E-RUCCH shall be provided. Common E-RNTI Selection procedure is performed as
below:
k= SFN~E-RUCCH~ mod K, for TTI of E-RUCCH = 10ms;
or k = SFN'~E-RUCCH~ mod K, for TTI of E-RUCCH = 5ms;
Where k is the \"Index of selected Common E-RNTI group\" and K is the total
number of E-RNTI groups related to this E-RUCCH; SFN~E-RUCCH~ or SFN'~E-RUCCH~
is the frame or sub-frame on which the E-RUCCH shall be sent which is
indicated by physical layer as the response of physical random access
procedure.
Upon the common E-RNTI group was determined as above, the UE shall randomly
select a common E-RNTI within the group.
The Available Scheduling Window of each CCCH transmission is equal to the
length of K E-RUCCH TTIs, which means that the CCCH only can be scheduled
within the consecutive K frames (in case of 10ms E-RUCCH) or sub-frames(in
case of 5ms E-RUCCH) upon receiving the E-RUCCH by the Node B scheduler. The
start point of the Available Scheduling Window associated with a common E-RNTI
corresponds to the frame on which the common E-RNTI is correctly received on
E-RUCCH.
#### 11.9.1.6 MAC-es/e Reset (1.28 Mcps TDD only)
If a reset of MAC-es/e or MAC-is/i entity is requested by upper layers, the UE
shall at the activation time indicated by higher layer:
\- flush all HARQ processes;
\- set CURRENT_TSN to 0 for all the logical channels mapped to E-DCH;
\- stop all active timers (the timers include Retransmisstion timer, T_SI,
T_WAIT, T_RUCCH);
\- set CURRENT_RUCCH to 0;
\- if MAC-i/is is configured by upper layers:
\- discard all segments stored in segmentation entities.
### 11.9.2 Node B operation
#### 11.9.2.1 HARQ Operation
##### 11.9.2.1.1 HARQ entity
There is one HARQ entity per E-DCH transport channel per UE in the Node-B. The
HARQ entity routes the payload and the associated RSN value to the indicated
HARQ process (the HARQ procees identifier is signalled to the Node B via the
E-UCCH). Based on the outcome of the decoding, the HARQ entity transmits an
ACK or a NACK in return.
##### 11.9.2.1.2 HARQ process
The HARQ process uses the RSN to identify the redundancy version, The Node B
uses the identified redundancy version to attempt to decode the transmission.
The outcome of the decoding is reported to the HARQ entity, so that it may be
fed back to the UE as ACK or NACK.
#### 11.9.2.2 De-multiplexing
There is one de-multiplexing entity per UE in the Node B. If the MAC-e/es is
configured by upper layers, the SRNC configures the Node B with the mapping
between the active DDI values and the corresponding MAC-d flow and PDU size.
If the MAC-i/is is configured by upper layers, the SRNC configured the Node B
with the mapping between the LCH-ID and the corresponding MAC-d flow. Also, it
provides it with the mapping between MAC-d flow IDs and the corresponding Iub
bearer.
If MAC-e/es is configured by upper layers, the de-multiplexing entity uses the
MAC-e header information (DDI, N) to determine the size of each MAC-es PDU and
based on this it segments the MAC-e payload into MAC-es PDUs. These are then
routed onto the Iub bearer indicated by the DDI value. If MAC-i/is is
configured by upper layers, the de-multiplexing entity uses the MAC-i header
information (L) to determine the size of each MAC-is SDU and based on this it
segments the MAC-i payload into MAC-is PDUs.
With each MAC-es PDU, the Node B will send to the SRNC:
\- the associated DDI and N values;
\- the CFN when the payload including the MAC-es PDU was decoded correctly
(3.84/7.68 Mcps only);
\- the CFN and sub-frame number when the payload including the MAC-es PDU was
decoded correctly (1.28 Mcps TDD only);
\- the total number of transmissions that were needed for the MAC-e PDU to be
decoded correctly.
With each MAC-is PDU, the Node B will send to the SRNC:
\- the associated LCH-ID and L values for each MAC-is SDU;
\- the CFN when the payload including the MAC-is PDU was decoded correctly
(3.84/7.68 Mcps only);
\- the CFN and sub-frame number when the payload including the MAC-is PDU was
decoded correctly (1.28 Mcps TDD only);
\- the total number of transmissions that were needed for the MAC-i PDU to be
decoded correctly.
#### 11.9.2.3 Scheduler
There is one E-DCH Node B scheduler per Node B. The Node B scheduler is
responsible for the following functions:
\- Allocating uplink resources to UEs and signalling these to UEs via Absolute
Grants;
\- Reporting uplink interference measurements to the SRNC
\- Reporting to the SRNC on the lack of processing resources
\- Determining the TDD ECSN (the TDD ECSN per carrier is incremented for each
E-AGCH transmission on the same carrier)
\- Determining which E-HICH will be used for the incoming transmission and the
value of the associated E-HICH Indicator (1.28 Mcps TDD only)
\- Determining how many E-UCCHs should be carried on the incoming E-PUCHs and
the value of the associated E-UCCH Number Indicator (1.28 Mcps TDD only).
\- Determining how many E-DCH carriers should be scheduled for one UE which is
configured multiple E-DCH carriers.
NOTE: The scheduler should not schedule the UE who is in the idle interval.
For 1.28Mcps TDD, the scheduler should not schedule the UE who is in the
measurement occasion.
#### 11.9.2.4 E-DCH Provided Bit Rate measurement
The E-DCH Provided Bit Rate measurement is defined as follows:
\- for each priority class the MAC-e or MAC-i function in the Node B measures
the total number of MAC-d PDU bits whose transmission over the radio interface
has been considered successful by MAC-e or MAC-i in Node-B during the last
measurement period, divided by the duration of the measurement period;
\- the measurement period shall be [100 ms].
### 11.9.3 RNC operation
#### 11.9.3.1 Re-ordering entity for DTCH/DCCH transmission
The re-ordering entity is part of the MAC-es or MAC-is sublayer in the SRNC.
There is one re-ordering entity per UE. Each re-ordering entity will support
one re-ordering process per logical channel. If MAC-es is configured by upper
layers, the DDI value is used to determine the logical channel for which each
MAC-es PDU is meant. If MAC-is is configured by upper layers, the LCH-ID value
is used to determine the logical channel for which each MAC-is SDU is meant.
Based on this information, the MAC-es or MAC-is PDUs are routed to the proper
re-ordering process. The re-ordering process may use the explicit TSN
indication as well as the timing information provided by the Node B in order
to eliminate duplicates and deliver the packets in order to RLC. The details
of the re-ordering mechanism are left up to the implementation.
#### 11.9.3.2 Re-ordering entity for CCCH transmissio (1.28 Mcps TDD only)
The re-ordering entity is part of MAC-is sublayer in the CRNC. There is one
re-ordering entity per UE. Each re-ordering entity will support one re-
ordering process. If MAC-is is configured by upper layers, the LCH-ID value is
used to determine the logical channel for which each MAC-is SDU is meant.
Based on this information, the received TSN and Node-B tagging i.e. (CFN,
subframe number), the MAC-is PDUs are routed to the proper re-ordering
process. The re-ordering process may use the explicit TSN indication as well
as the timing information provided by the Node B in order to eliminate
duplicates. When the MAC-c PDU is received correctly then after reassembly the
resulting data is delivered to the MAC-c. The details of the re-ordering
mechanism are left up to the implementation.
###### ## Annex A (normative): HS-DSCH Transport Block Size Table for FDD
The following table provides the mapping between _k~t~_ (as per the definition
in subclause 9.2.3.1) and the HS-DSCH Transport Block Size (L(_k~t~_))
corresponding to table 9.2.3.1:
* * *
**Index** **TB Size** **Index** **TB Size** **Index** **TB Size** 1 137 86
1380 171 6324 2 149 87 1405 172 6438 3 161 88 1430 173 6554 4 173 89 1456 174
6673 5 185 90 1483 175 6793 6 197 91 1509 176 6916 7 209 92 1537 177 7041 8
221 93 1564 178 7168 9 233 94 1593 179 7298 10 245 95 1621 180 7430 11 257 96
1651 181 7564 12 269 97 1681 182 7700 13 281 98 1711 183 7840 14 293 99 1742
184 7981 15 305 100 1773 185 8125 16 317 101 1805 186 8272 17 329 102 1838 187
8422 18 341 103 1871 188 8574 19 353 104 1905 189 8729 20 365 105 1939 190
8886 21 377 106 1974 191 9047 22 389 107 2010 192 9210 23 401 108 2046 193
9377 24 413 109 2083 194 9546 25 425 110 2121 195 9719 26 437 111 2159 196
9894 27 449 112 2198 197 10073 28 461 113 2238 198 10255 29 473 114 2279 199
10440 30 485 115 2320 200 10629 31 497 116 2362 201 10821 32 509 117 2404 202
11017 33 521 118 2448 203 11216 34 533 119 2492 204 11418 35 545 120 2537 205
11625 36 557 121 2583 206 11835 37 569 122 2630 207 12048 38 581 123 2677 208
12266 39 593 124 2726 209 12488 40 605 125 2775 210 12713 41 616 126 2825 211
12943 42 627 127 2876 212 13177 43 639 128 2928 213 13415 44 650 129 2981 214
13657 45 662 130 3035 215 13904 46 674 131 3090 216 14155 47 686 132 3145 217
14411 48 699 133 3202 218 14671 49 711 134 3260 219 14936 50 724 135 3319 220
15206 51 737 136 3379 221 15481 52 751 137 3440 222 15761 53 764 138 3502 223
16045 54 778 139 3565 224 16335 55 792 140 3630 225 16630 56 806 141 3695 226
16931 57 821 142 3762 227 17237 58 836 143 3830 228 17548 59 851 144 3899 229
17865 60 866 145 3970 230 18188 61 882 146 4042 231 18517 62 898 147 4115 232
18851 63 914 148 4189 233 19192 64 931 149 4265 234 19538 65 947 150 4342 235
19891 66 964 151 4420 236 20251 67 982 152 4500 237 20617 68 1000 153 4581 238
20989 69 1018 154 4664 239 21368 70 1036 155 4748 240 21754 71 1055 156 4834
241 22147 72 1074 157 4921 242 22548 73 1093 158 5010 243 22955 74 1113 159
5101 244 23370 75 1133 160 5193 245 23792 76 1154 161 5287 246 24222 77 1175
162 5382 247 24659 78 1196 163 5480 248 25105 79 1217 164 5579 249 25558 80
1239 165 5680 250 26020 81 1262 166 5782 251 26490 82 1285 167 5887 252 26969
83 1308 168 5993 253 27456 84 1331 169 6101 254 27952 85 1356 170 6211
* * *
The following table provides the mapping between _k~t~_ (as per the definition
in subclause 9.2.3.1) and the HS-DSCH Transport Block Size (L(_k~t~_))
corresponding to table 9.2.3.2:
* * *
**Index** **TB Size** **Index** **TB Size** **Index** **TB Size** **Index**
**TB Size** 1 120 86 1000 171 4592 256 21000 2 128 87 1016 172 4672 257 21384
3 136 88 1040 173 4760 258 21768 4 144 89 1056 174 4848 259 22160 5 152 90
1072 175 4936 260 22560 6 160 91 1096 176 5024 261 22968 7 168 92 1112 177
5112 262 23384 8 176 93 1136 178 5208 263 23808 9 184 94 1152 179 5296 264
24232 10 192 95 1176 180 5392 265 24672 11 200 96 1200 181 5488 266 25120 12
208 97 1216 182 5592 267 25568 13 216 98 1240 183 5688 268 26032 14 224 99
1264 184 5792 269 26504 15 232 100 1288 185 5896 270 26976 16 240 101 1312 186
6008 271 27464 17 248 102 1336 187 6112 272 27960 18 256 103 1360 188 6224 273
28464 19 264 104 1384 189 6336 274 28976 20 272 105 1408 190 6448 275 29504 21
280 106 1432 191 6568 276 30032 22 288 107 1456 192 6688 277 30576 23 296 108
1488 193 6808 278 31128 24 304 109 1512 194 6928 279 31688 25 312 110 1536 195
7056 280 32264 26 320 111 1568 196 7184 281 32848 27 328 112 1600 197 7312 282
33440 28 336 113 1624 198 7440 283 34040 29 344 114 1656 199 7576 284 34656 30
352 115 1688 200 7712 285 35280 31 360 116 1712 201 7856 286 35920 32 368 117
1744 202 7992 287 36568 33 376 118 1776 203 8136 288 37224 34 384 119 1808 204
8288 289 37896 35 392 120 1840 205 8440 290 38576 36 400 121 1872 206 8592 291
39272 37 408 122 1912 207 8744 292 39984 38 416 123 1944 208 8904 293 40704 39
424 124 1976 209 9064 294 41440 40 440 125 2016 210 9224 295 42192 41 448 126
2048 211 9392  
42 456 127 2088 212 9560  
43 464 128 2128 213 9736  
44 472 129 2168 214 9912  
45 480 130 2200 215 10088  
46 488 131 2240 216 10272  
47 496 132 2288 217 10456  
48 504 133 2328 218 10648  
49 512 134 2368 219 10840  
50 528 135 2408 220 11032  
51 536 136 2456 221 11232  
52 544 137 2496 222 11432  
53 552 138 2544 223 11640  
54 560 139 2592 224 11848  
55 576 140 2632 225 12064  
56 584 141 2680 226 12280  
57 592 142 2736 227 12504  
58 608 143 2784 228 12728  
59 616 144 2832 229 12960  
60 624 145 2880 230 13192  
61 640 146 2936 231 13432  
62 648 147 2984 232 13672  
63 664 148 3040 233 13920  
64 672 149 3096 234 14168  
65 688 150 3152 235 14424  
66 696 151 3208 236 14688  
67 712 152 3264 237 14952  
68 728 153 3328 238 15224  
69 736 154 3384 239 15496  
70 752 155 3448 240 15776  
71 768 156 3512 241 16064  
72 776 157 3576 242 16352  
73 792 158 3640 243 16648  
74 808 159 3704 244 16944  
75 824 160 3768 245 17256  
76 840 161 3840 246 17568  
77 848 162 3912 247 17880  
78 864 163 3976 248 18200  
79 880 164 4048 249 18536  
80 896 165 4120 250 18864  
81 912 166 4200 251 19208  
82 928 167 4272 252 19552  
83 952 168 4352 253 19904  
84 968 169 4432 254 20264  
85 984 170 4512 255 20632
* * *
###### ## Annex B (normative): E-DCH Transport Block Size Tables for FDD
The mapping between the chosen E-TFCI and the corresponding E-DCH transport
block size is given in the following tables:
## B.1 2ms TTI E-DCH Transport Block Size Table 0
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB
Size (bits) E-TFCI TB Size (bits) 0 18 30 342 60 1015 90 3008 120 N/A 1 120 31
355 61 1053 91 3119 121 9241 2 124 32 368 62 1091 92 3234 122 9582 3 129 33
382 63 1132 93 3353 123 9935 4 133 34 396 64 1173 94 3477 124 10302 5 138 35
410 65 1217 95 3605 125 10681 6 143 36 426 66 1262 96 3738 126 11075 7 149 37
441 67 1308 97 3876 127 11484 8 154 38 458 68 1356 98 4019  
9 160 39 474 69 1406 99 4167  
10 166 40 492 70 1458 100 4321  
11 172 41 510 71 1512 101 4480  
12 178 42 529 72 1568 102 4645  
13 185 43 548 73 1626 103 4816  
14 192 44 569 74 1685 104 4994  
15 199 45 590 75 1748 105 5178  
16 206 46 611 76 1812 106 5369  
17 214 47 634 77 1879 107 5567  
18 222 48 657 78 1948 108 5772  
19 230 49 682 79 2020 109 5985  
20 238 50 707 80 2094 110 6206  
21 247 51 733 81 2172 111 6435  
22 256 52 760 82 2252 112 6672  
23 266 53 788 83 2335 113 6918  
24 275 54 817 84 2421 114 7173  
25 286 55 847 85 2510 115 7437  
26 296 56 878 86 2603 116 7711  
27 307 57 911 87 2699 117 7996  
28 318 58 944 88 2798 118 8290  
29 330 59 979 89 2901 119 8596
* * *
NOTE: Non applicable E-TFCI values are marked as N/A.
## B.2 2ms TTI E-DCH Transport Block Size Table 1
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) 0 18 43 2724
86 7252 1 186 44 2742 87 7288 2 204 45 3042 88 7428 3 354 46 3060 89 7464 4
372 47 3078 90 7764 5 522 48 3298 91 7800 6 540 49 3316 92 7908 7 674 50 3334
93 7944 8 690 51 3378 94 8100 9 708 52 3396 95 8136 10 726 53 3414 96 8436 11
858 54 3732 97 8472 12 876 55 3750 98 8564 13 1026 56 3972 99 8600 14 1044 57
3990 100 8772 15 1062 58 4068 101 8808 16 1194 59 4086 102 9108 17 1212 60
4404 103 9144 18 1330 61 4422 104 9220 19 1348 62 4628 105 9256 20 1362 63
4646 106 9444 21 1380 64 4740 107 9480 22 1398 65 4758 108 9780 23 1530 66
5076 109 9816 24 1548 67 5094 110 9876 25 1698 68 5284 111 9912 26 1716 69
5302 112 10116 27 1734 70 5412 113 10152 28 1866 71 5430 114 10452 29 1884 72
5748 115 N/A 30 1986 73 5766 116 10532 31 2004 74 5940 117 10568 32 2022 75
5958 118 10788 33 2034 76 6084 119 10824 34 2052 77 6102 120 11124 35 2070 78
6420 121 11178 36 2370 79 6438 122 11188 37 2388 80 6596 123 11242 38 2406 81
6614 124 11460 39 2642 82 6756 125 11478 40 2660 83 6774  
41 2678 84 7092  
42 2706 85 7110
* * *
NOTE: Non applicable E-TFCI values are marked as N/A.
## B.2a 2ms TTI E-DCH Transport Block Size Table 2
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB
Size (bits) E-TFCI TB Size (bits) 0 18 30 402 60 1405 90 4913 120 17173 1 120
31 419 61 1465 91 5122 121 N/A 2 125 32 437 62 1528 92 5341 122 18667 3 130 33
455 63 1593 93 5568 123 19462 4 135 34 475 64 1661 94 5805 124 20291 5 141 35
495 65 1731 95 6053 125 21155 6 147 36 516 66 1805 96 6310 126 22056 7 154 37
538 67 1882 97 6579 127 22995 8 160 38 561 68 1962 98 6859  
9 167 39 585 69 2046 99 7152  
10 174 40 610 70 2133 100 7456  
11 182 41 636 71 2224 101 7774  
12 189 42 663 72 2319 102 8105  
13 197 43 691 73 2417 103 8450  
14 206 44 721 74 2520 104 8810  
15 215 45 752 75 2628 105 9185  
16 224 46 784 76 2740 106 9577  
17 233 47 817 77 2856 107 9985  
18 243 48 852 78 2978 108 10410  
19 254 49 888 79 3105 109 10853  
20 265 50 926 80 3237 110 11316  
21 276 51 965 81 3375 111 11798  
22 288 52 1007 82 3519 112 12300  
23 300 53 1049 83 3669 113 12824  
24 313 54 1094 84 3825 114 13370  
25 326 55 1141 85 3988 115 13940  
26 340 56 1189 86 4158 116 14534  
27 354 57 1240 87 4335 117 15153  
28 370 58 1293 88 4520 118 15798  
29 385 59 1348 89 4712 119 16471
* * *
NOTE: Non applicable E-TFCI values are marked as N/A.
## B.2b 2ms TTI E-DCH Transport Block Size Table 3
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB
Size (bits) E-TFCI TB Size (bits) 0 18 30 1902 60 6614 90 14184 120 21966 1
186 31 1986 61 6774 91 14538 121 22302 2 204 32 2004 62 7110 92 14874 122
22430 3 354 33 2034 63 7270 93 15210 123 22638 4 372 34 2052 64 7446 94 15546
124 22996 5 522 35 2370 65 7782 95 15882  
6 540 36 2388 66 7926 96 16218  
7 558 37 2642 67 8118 97 16554  
8 674 38 2660 68 8454 98 16890  
9 692 39 2706 69 8582 99 17226  
10 708 40 2724 70 8790 100 17562  
11 858 41 3042 71 9126 101 N/A  
12 876 42 3060 72 9238 102 N/A  
13 894 43 3298 73 9462 103 18252  
14 1026 44 3316 74 9798 104 18476  
15 1044 45 3378 75 9894 105 18588  
16 1194 46 3396 76 10134 106 18924  
17 1212 47 3750 77 10470 107 19132  
18 1230 48 3990 78 10550 108 19260  
19 1330 49 4086 79 10806 109 19596  
20 1348 50 4422 80 11160 110 19788  
21 1362 51 4646 81 11224 111 19932  
22 1380 52 4758 82 11496 112 20268  
23 1530 53 5094 83 11880 113 20444  
24 1548 54 5302 84 12168 114 20604  
25 1566 55 5430 85 12536 115 20940  
26 1698 56 5766 86 12840 116 21100  
27 1716 57 5958 87 13192 117 21276  
28 1866 58 6102 88 13512 118 21612  
29 1884 59 6438 89 13848 119 21774
* * *
NOTE: Non applicable E-TFCI values are marked as N/A.
## B.2c 2ms TTI E-DCH Transport Block Size Table 4
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB
Size (bits) E-TFCI TB Size (bits) 0 18 30 441 60 1700 90 6544 120 25194 1 120
31 461 61 1778 91 6845 121 26352 2 125 32 483 62 1860 92 7160 122 27563 3 131
33 505 63 1945 93 7489 123 28830 4 137 34 528 64 2034 94 7833 124 30400 5 143
35 552 65 2128 95 8193 125 31600 6 150 36 578 66 2226 96 8570 126 32990 7 157
37 604 67 2328 97 8963 127 34507 8 164 38 632 68 2435 98 9375  
9 171 39 661 69 2547 99 9806  
10 179 40 692 70 2664 100 10257  
11 188 41 723 71 2787 101 10728  
12 196 42 757 72 2915 102 11221  
13 205 43 792 73 3049 103 11737  
14 215 44 828 74 3189 104 12276  
15 225 45 866 75 3335 105 12841  
16 235 46 906 76 3489 106 13431  
17 246 47 948 77 3649 107 14048  
18 257 48 991 78 3817 108 14694  
19 269 49 1037 79 3992 109 15369  
20 281 50 1084 80 4176 110 16075  
21 294 51 1134 81 4367 111 16814  
22 308 52 1186 82 4568 112 17587  
23 322 53 1241 83 4778 113 18395  
24 337 54 1298 84 4998 114 19241  
25 352 55 1358 85 5227 115 20125  
26 368 56 1420 86 5468 116 21050  
27 385 57 1485 87 5719 117 22017  
28 403 58 1554 88 5982 118 23029  
29 422 59 1625 89 6257 119 24087
* * *
## B.3 10ms TTI E-DCH Transport Block Size Table 0
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB
Size (bits) E-TFCI TB Size (bits) 0 18 30 389 60 1316 90 4452 120 15051 1 120
31 405 61 1371 91 4636 121 15675 2 124 32 422 62 1428 92 4828 122 16325 3 130
33 440 63 1487 93 5029 123 17001 4 135 34 458 64 1549 94 5237 124 17706 5 141
35 477 65 1613 95 5454 125 18440 6 147 36 497 66 1680 96 5680 126 19204 7 153
37 517 67 1749 97 5915 127 20000 8 159 38 539 68 1822 98 6161  
9 166 39 561 69 1897 99 6416  
10 172 40 584 70 1976 100 6682  
11 180 41 608 71 2058 101 6959  
12 187 42 634 72 2143 102 7247  
13 195 43 660 73 2232 103 7547  
14 203 44 687 74 2325 104 7860  
15 211 45 716 75 2421 105 8186  
16 220 46 745 76 2521 106 8525  
17 229 47 776 77 2626 107 8878  
18 239 48 809 78 2735 108 9246  
19 249 49 842 79 2848 109 9629  
20 259 50 877 80 2966 110 10028  
21 270 51 913 81 3089 111 10444  
22 281 52 951 82 3217 112 10877  
23 293 53 991 83 3350 113 11328  
24 305 54 1032 84 3489 114 11797  
25 317 55 1074 85 3634 115 12286  
26 331 56 1119 86 3784 116 12795  
27 344 57 1165 87 3941 117 13325  
28 359 58 1214 88 4105 118 13877  
29 374 59 1264 89 4275 119 14453
* * *
## B.4 10ms TTI E-DCH Transport Block Size Table 1
* * *
E-TFCI TB Size (bits) E-TFCI TB Size (bits) E-TFCI TB Size (bits) 0 18 41 5076
82 11850 1 186 42 5094 83 12132 2 204 43 5412 84 12186 3 354 44 5430 85 12468
4 372 45 5748 86 12522 5 522 46 5766 87 12804 6 540 47 6084 88 12858 7 690 48
6102 89 13140 8 708 49 6420 90 13194 9 858 50 6438 91 13476 10 876 51 6756 92
13530 11 1026 52 6774 93 13812 12 1044 53 7092 94 13866 13 1194 54 7110 95
14148 14 1212 55 7428 96 14202 15 1362 56 7464 97 14484 16 1380 57 7764 98
14556 17 1530 58 7800 99 14820 18 1548 59 8100 100 14892 19 1698 60 8136 101
15156 20 1716 61 8436 102 15228 21 1866 62 8472 103 15492 22 1884 63 8772 104
15564 23 2034 64 8808 105 15828 24 2052 65 9108 106 15900 25 2370 66 9144 107
16164 26 2388 67 9444 108 16236 27 2706 68 9480 109 16500 28 2724 69 9780 110
16572 29 3042 70 9816 111 17172 30 3060 71 10116 112 17244 31 3378 72 10152
113 17844 32 3396 73 10452 114 17916 33 3732 74 10488 115 18516 34 3750 75
10788 116 18606 35 4068 76 10824 117 19188 36 4086 77 11124 118 19278 37 4404
78 11178 119 19860 38 4422 79 11460 120 19950 39 4740 80 11514  
40 4758 81 11796
* * *
###### ## Annex BA (normative): E-DCH Transport Block Size Tables for 3.84
Mcps TDD
The mapping between the chosen E-TFC index and the corresponding E-DCH
transport block size is given in the following tables:
## BA.1 10ms TTI E-DCH Transport Block Size Table 0
* * *
**_N~slots~_** **1** **2** **3** **4** **5** **6** **7** **8** **9** **10**
**11** **12** **_K~n~_** **0** **18** **28** **36** **42** **46** **50**
**54** **57** **60** **62** **65** **TBS index**  
0 60 119 174 237 298 347 405 472 529 593 641 718 1 62 123 181 246 310 361 421
490 550 616 665 746 2 64 128 188 256 322 375 437 509 571 641 691 775 3 67 133
196 266 334 390 454 529 593 665 718 806 4 69 139 203 276 347 405 472 550 616
691 746 837 5 72 144 211 287 361 421 490 571 641 718 775 870 6 75 150 219 298
375 437 509 593 665 746 806 904 7 78 155 228 310 390 454 529 616 691 775 837
939 8 81 162 237 322 405 472 550 641 718 806 870 975 9 84 168 246 334 421 490
571 665 746 837 904 1013 10 87 174 256 347 437 509 593 691 775 870 939 1053 11
91 181 266 361 454 529 616 718 806 904 975 1094 12 94 188 276 375 472 550 641
746 837 939 1013 1136 13 98 196 287 390 490 571 665 775 870 975 1053 1181 14
102 203 298 405 509 593 691 806 904 1013 1094 1227 15 106 211 310 421 529 616
718 837 939 1053 1136 1275 16 110 219 322 437 550 641 746 870 975 1094 1181
1324 17 114 228 334 454 571 665 775 904 1013 1136 1227 1376 18 119 237 347 472
593 691 806 939 1053 1181 1275 1429 19 123 246 361 490 616 718 837 975 1094
1227 1324 1485 20 128 256 375 509 641 746 870 1013 1136 1275 1376 1543 21 133
266 390 529 665 775 904 1053 1181 1324 1429 1603 22 139 276 405 550 691 806
939 1094 1227 1376 1485 1665 23 144 287 421 571 718 837 975 1136 1275 1429
1543 1730 24 150 298 437 593 746 870 1013 1181 1324 1485 1603 1798 25 155 310
454 616 775 904 1053 1227 1376 1543 1665 1868 26 162 322 472 641 806 939 1094
1275 1429 1603 1730 1941 27 168 334 490 665 837 975 1136 1324 1485 1665 1798
2016 28 174 347 509 691 870 1013 1181 1376 1543 1730 1868 2095 29 181 361 529
718 904 1053 1227 1429 1603 1798 1941 2176 30 188 375 550 746 939 1094 1275
1485 1665 1868 2016 2261 31 196 390 571 775 975 1136 1324 1543 1730 1941 2095
2349 32 203 405 593 806 1013 1181 1376 1603 1798 2016 2176 2441 33 211 421 616
837 1053 1227 1429 1665 1868 2095 2261 2536 34 219 437 641 870 1094 1275 1485
1730 1941 2176 2349 2634 35 228 454 665 904 1136 1324 1543 1798 2016 2261 2441
2737 36 237 472 691 939 1181 1376 1603 1868 2095 2349 2536 2844 37 246 490 718
975 1227 1429 1665 1941 2176 2441 2634 2954 38 256 509 746 1013 1275 1485 1730
2016 2261 2536 2737 3070 39 266 529 775 1053 1324 1543 1798 2095 2349 2634
2844 3189 40 276 550 806 1094 1376 1603 1868 2176 2441 2737 2954 3313 41 287
571 837 1136 1429 1665 1941 2261 2536 2844 3070 3442 42 298 593 870 1181 1485
1730 2016 2349 2634 2954 3189 3576 43 310 616 904 1227 1543 1798 2095 2441
2737 3070 3313 3716 44 322 641 939 1275 1603 1868 2176 2536 2844 3189 3442
3861 45 334 665 975 1324 1665 1941 2261 2634 2954 3313 3576 4011 46 347 691
1013 1376 1730 2016 2349 2737 3070 3442 3716 4167 47 361 718 1053 1429 1798
2095 2441 2844 3189 3576 3861 4329 48 375 746 1094 1485 1868 2176 2536 2954
3313 3716 4011 4498 49 390 775 1136 1543 1941 2261 2634 3070 3442 3861 4167
4673 50 405 806 1181 1603 2016 2349 2737 3189 3576 4011 4329 4855 51 421 837
1227 1665 2095 2441 2844 3313 3716 4167 4498 5044 52 437 870 1275 1730 2176
2536 2954 3442 3861 4329 4673 5241 53 454 904 1324 1798 2261 2634 3070 3576
4011 4498 4855 5445 54 472 939 1376 1868 2349 2737 3189 3716 4167 4673 5044
5657 55 490 975 1429 1941 2441 2844 3313 3861 4329 4855 5241 5877 56 509 1013
1485 2016 2536 2954 3442 4011 4498 5044 5445 6106 57 529 1053 1543 2095 2634
3070 3576 4167 4673 5241 5657 6344 58 550 1094 1603 2176 2737 3189 3716 4329
4855 5445 5877 6591 59 571 1136 1665 2261 2844 3313 3861 4498 5044 5657 6106
6848 60 593 1181 1730 2349 2954 3442 4011 4673 5241 5877 6344 7115 61 616 1227
1798 2441 3070 3576 4167 4855 5445 6106 6591 7392 62 641 1275 1868 2536 3189
3716 4329 5044 5657 6344 6848 7680 63 665 1324 1941 2634 3313 3861 4498 5241
5877 6591 7115 7979 64 691 1376 2016 2737 3442 4011 4673 5445 6106 6848 7392
8289 65 718 1429 2095 2844 3576 4167 4855 5657 6344 7115 7680 8612 66 746 1485
2176 2954 3716 4329 5044 5877 6591 7392 7979 8948 67 775 1543 2261 3070 3861
4498 5241 6106 6848 7680 8289 9296 68 806 1603 2349 3189 4011 4673 5445 6344
7115 7979 8612 9658 69 837 1665 2441 3313 4167 4855 5657 6591 7392 8289 8948
10034 70 870 1730 2536 3442 4329 5044 5877 6848 7680 8612 9296 10425 71 904
1798 2634 3576 4498 5241 6106 7115 7979 8948 9658 10831 72 939 1868 2737 3716
4673 5445 6344 7392 8289 9296 10034 11253 73 975 1941 2844 3861 4855 5657 6591
7680 8612 9658 10425 11691 74 1013 2016 2954 4011 5044 5877 6848 7979 8948
10034 10831 12146 75 1053 2095 3070 4167 5241 6106 7115 8289 9296 10425 11253
12620 76 1094 2176 3189 4329 5445 6344 7392 8612 9658 10831 11691 13111 77
1136 2261 3313 4498 5657 6591 7680 8948 10034 11253 12146 13622 78 1181 2349
3442 4673 5877 6848 7979 9296 10425 11691 12620 14152 79 1227 2441 3576 4855
6106 7115 8289 9658 10831 12146 13111 14703 80 1275 2536 3716 5044 6344 7392
8612 10034 11253 12620 13622 15276 81 1324 2634 3861 5241 6591 7680 8948 10425
11691 13111 14152 15871 82 1376 2737 4011 5445 6848 7979 9296 10831 12146
13622 14703 16489 83 1429 2844 4167 5657 7115 8289 9658 11253 12620 14152
15276 17131 84 1485 2954 4329 5877 7392 8612 10034 11691 13111 14703 15871
17798 85 1543 3070 4498 6106 7680 8948 10425 12146 13622 15276 16489 18491 86
1603 3189 4673 6344 7979 9296 10831 12620 14152 15871 17131 19212 87 1665 3313
4855 6591 8289 9658 11253 13111 14703 16489 17798 19960 88 1730 3442 5044 6848
8612 10034 11691 13622 15276 17131 18491 20737 89 1798 3576 5241 7115 8948
10425 12146 14152 15871 17798 19212 21545 90 1868 3716 5445 7392 9296 10831
12620 14703 16489 18491 19960 22384 91 1941 3861 5657 7680 9658 11253 13111
15276 17131 19212 20737 23256 92 2016 4011 5877 7979 10034 11691 13622 15871
17798 19960 21545 24161 93 2095 4167 6106 8289 10425 12146 14152 16489 18491
20737 22384 25102 94 2176 4329 6344 8612 10831 12620 14703 17131 19212 21545
23256 26080 95 2261 4498 6591 8948 11253 13111 15276 17798 19960 22384 24161
27095 96 2349 4673 6848 9296 11691 13622 15871 18491 20737 23256 25102 28151
97 2441 4855 7115 9658 12146 14152 16489 19212 21545 24161 26080 29247 98 2536
5044 7392 10034 12620 14703 17131 19960 22384 25102 27095 30386 99 2634 5241
7680 10425 13111 15276 17798 20737 23256 26080 28151 31569 100 2737 5445 7979
10831 13622 15871 18491 21545 24161 27095 29247 32799 101 2844 5657 8289 11253
14152 16489 19212 22384 25102 28151 30386 34076 102 2954 5877 8612 11691 14703
17131 19960 23256 26080 29247 31569 35403 103 3070 6106 8948 12146 15276 17798
20737 24161 27095 30386 32799 36782 104 3189 6344 9296 12620 15871 18491 21545
25102 28151 31569 34076 38214 105 3313 6591 9658 13111 16489 19212 22384 26080
29247 32799 35403 39703 106 3442 6848 10034 13622 17131 19960 23256 27095
30386 34076 36782 41249 107 3576 7115 10425 14152 17798 20737 24161 28151
31569 35403 38214 42855 108 3716 7392 10831 14703 18491 21545 25102 29247
32799 36782 39703 44524 109 3861 7680 11253 15276 19212 22384 26080 30386
34076 38214 41249 46258 110 4011 7979 11691 15871 19960 23256 27095 31569
35403 39703 42855 48060 111 4167 8289 12146 16489 20737 24161 28151 32799
36782 41249 44524 49932 112 4329 8612 12620 17131 21545 25102 29247 34076
38214 42855 46258 51876 113 4498 8948 13111 17798 22384 26080 30386 35403
39703 44524 48060 53896 114 4673 9296 13622 18491 23256 27095 31569 36782
41249 46258 49932 55995 115 4855 9658 14152 19212 24161 28151 32799 38214
42855 48060 51876 58176 116 5044 10034 14703 19960 25102 29247 34076 39703
44524 49932 53896 60442 117 5241 10425 15276 20737 26080 30386 35403 41249
46258 51876 55995 62796 118 5445 10831 15871 21545 27095 31569 36782 42855
48060 53896 58176 65241 119 5657 11253 16489 22384 28151 32799 38214 44524
49932 55995 60442 67782 120 5877 11691 17131 23256 29247 34076 39703 46258
51876 58176 62796 70422 121 6106 12146 17798 24161 30386 35403 41249 48060
53896 60442 65241 73164 122 6344 12620 18491 25102 31569 36782 42855 49932
55995 62796 67782 76013 123 6591 13111 19212 26080 32799 38214 44524 51876
58176 65241 70422 78974 124 6848 13622 19960 27095 34076 39703 46258 53896
60442 67782 73164 82049 125 7115 14152 20737 28151 35403 41249 48060 55995
62796 70422 76013 85245 126 7392 14703 21545 29247 36782 42855 49932 58176
65241 73164 78974 88565 127 7680 15276 22384 30386 38214 44524 51876 60442
67782 76013 82049 92014
* * *
###### ## Annex BB (normative): E-DCH Transport Block Size Tables for 7.68
Mcps TDD
The mapping between the chosen E-TFC index and the corresponding E-DCH
transport block size is given in the following tables:
## BB.1 10ms TTI E-DCH Transport Block Size Table 0
* * *
**Nslots** **1** **2** **3** **4** **5** **6** **7** **8** **9** **10** **11**
**12** **kn** **0** **15** **25** **31** **36** **41** **44** **47** **50**
**52** **54** **56** **TBS index** ** ** ** ** ** ** ** ** ** ** ** ** ** **
** ** ** ** ** ** ** ** ** ** 0 60 115 178 232 288 359 409 467 532 581 634 691
1 62 120 186 242 301 375 428 487 556 606 662 722 2 65 126 195 253 315 392 447
509 581 634 691 755 3 68 131 203 264 329 409 467 532 606 662 722 788 4 71 137
212 276 344 428 487 556 634 691 755 823 5 74 143 222 288 359 447 509 581 662
722 788 860 6 77 150 232 301 375 467 532 606 691 755 823 899 7 81 156 242 315
392 487 556 634 722 788 860 939 8 85 163 253 329 409 509 581 662 755 823 899
981 9 88 171 264 344 428 532 606 691 788 860 939 1024 10 92 178 276 359 447
556 634 722 823 899 981 1070 11 96 186 288 375 467 581 662 755 860 939 1024
1118 12 101 195 301 392 487 606 691 788 899 981 1070 1168 13 105 203 315 409
509 634 722 823 939 1024 1118 1220 14 110 212 329 428 532 662 755 860 981 1070
1168 1275 15 115 222 344 447 556 691 788 899 1024 1118 1220 1331 16 120 232
359 467 581 722 823 939 1070 1168 1275 1391 17 126 242 375 487 606 755 860 981
1118 1220 1331 1453 18 131 253 392 509 634 788 899 1024 1168 1275 1391 1518 19
137 264 409 532 662 823 939 1070 1220 1331 1453 1586 20 143 276 428 556 691
860 981 1118 1275 1391 1518 1656 21 150 288 447 581 722 899 1024 1168 1331
1453 1586 1730 22 156 301 467 606 755 939 1070 1220 1391 1518 1656 1808 23 163
315 487 634 788 981 1118 1275 1453 1586 1730 1888 24 171 329 509 662 823 1024
1168 1331 1518 1656 1808 1973 25 178 344 532 691 860 1070 1220 1391 1586 1730
1888 2061 26 186 359 556 722 899 1118 1275 1453 1656 1808 1973 2153 27 195 375
581 755 939 1168 1331 1518 1730 1888 2061 2249 28 203 392 606 788 981 1220
1391 1586 1808 1973 2153 2349 29 212 409 634 823 1024 1275 1453 1656 1888 2061
2249 2454 30 222 428 662 860 1070 1331 1518 1730 1973 2153 2349 2564 31 232
447 691 899 1118 1391 1586 1808 2061 2249 2454 2678 32 242 467 722 939 1168
1453 1656 1888 2153 2349 2564 2798 33 253 487 755 981 1220 1518 1730 1973 2249
2454 2678 2922 34 264 509 788 1024 1275 1586 1808 2061 2349 2564 2798 3053 35
276 532 823 1070 1331 1656 1888 2153 2454 2678 2922 3189 36 288 556 860 1118
1391 1730 1973 2249 2564 2798 3053 3331 37 301 581 899 1168 1453 1808 2061
2349 2678 2922 3189 3480 38 315 606 939 1220 1518 1888 2153 2454 2798 3053
3331 3636 39 329 634 981 1275 1586 1973 2249 2564 2922 3189 3480 3798 40 344
662 1024 1331 1656 2061 2349 2678 3053 3331 3636 3967 41 359 691 1070 1391
1730 2153 2454 2798 3189 3480 3798 4144 42 375 722 1118 1453 1808 2249 2564
2922 3331 3636 3967 4329 43 392 755 1168 1518 1888 2349 2678 3053 3480 3798
4144 4523 44 409 788 1220 1586 1973 2454 2798 3189 3636 3967 4329 4725 45 428
823 1275 1656 2061 2564 2922 3331 3798 4144 4523 4935 46 447 860 1331 1730
2153 2678 3053 3480 3967 4329 4725 5156 47 467 899 1391 1808 2249 2798 3189
3636 4144 4523 4935 5386 48 487 939 1453 1888 2349 2922 3331 3798 4329 4725
5156 5626 49 509 981 1518 1973 2454 3053 3480 3967 4523 4935 5386 5877 50 532
1024 1586 2061 2564 3189 3636 4144 4725 5156 5626 6140 51 556 1070 1656 2153
2678 3331 3798 4329 4935 5386 5877 6414 52 581 1118 1730 2249 2798 3480 3967
4523 5156 5626 6140 6700 53 606 1168 1808 2349 2922 3636 4144 4725 5386 5877
6414 6999 54 634 1220 1888 2454 3053 3798 4329 4935 5626 6140 6700 7311 55 662
1275 1973 2564 3189 3967 4523 5156 5877 6414 6999 7638 56 691 1331 2061 2678
3331 4144 4725 5386 6140 6700 7311 7979 57 722 1391 2153 2798 3480 4329 4935
5626 6414 6999 7638 8335 58 755 1453 2249 2922 3636 4523 5156 5877 6700 7311
7979 8707 59 788 1518 2349 3053 3798 4725 5386 6140 6999 7638 8335 9095 60 823
1586 2454 3189 3967 4935 5626 6414 7311 7979 8707 9501 61 860 1656 2564 3331
4144 5156 5877 6700 7638 8335 9095 9925 62 899 1730 2678 3480 4329 5386 6140
6999 7979 8707 9501 10368 63 939 1808 2798 3636 4523 5626 6414 7311 8335 9095
9925 10831 64 981 1888 2922 3798 4725 5877 6700 7638 8707 9501 10368 11314 65
1024 1973 3053 3967 4935 6140 6999 7979 9095 9925 10831 11819 66 1070 2061
3189 4144 5156 6414 7311 8335 9501 10368 11314 12347 67 1118 2153 3331 4329
5386 6700 7638 8707 9925 10831 11819 12898 68 1168 2249 3480 4523 5626 6999
7979 9095 10368 11314 12347 13474 69 1220 2349 3636 4725 5877 7311 8335 9501
10831 11819 12898 14075 70 1275 2454 3798 4935 6140 7638 8707 9925 11314 12347
13474 14703 71 1331 2564 3967 5156 6414 7979 9095 10368 11819 12898 14075
15360 72 1391 2678 4144 5386 6700 8335 9501 10831 12347 13474 14703 16045 73
1453 2798 4329 5626 6999 8707 9925 11314 12898 14075 15360 16761 74 1518 2922
4523 5877 7311 9095 10368 11819 13474 14703 16045 17509 75 1586 3053 4725 6140
7638 9501 10831 12347 14075 15360 16761 18291 76 1656 3189 4935 6414 7979 9925
11314 12898 14703 16045 17509 19107 77 1730 3331 5156 6700 8335 10368 11819
13474 15360 16761 18291 19960 78 1808 3480 5386 6999 8707 10831 12347 14075
16045 17509 19107 20851 79 1888 3636 5626 7311 9095 11314 12898 14703 16761
18291 19960 21781 80 1973 3798 5877 7638 9501 11819 13474 15360 17509 19107
20851 22753 81 2061 3967 6140 7979 9925 12347 14075 16045 18291 19960 21781
23769 82 2153 4144 6414 8335 10368 12898 14703 16761 19107 20851 22753 24830
83 2249 4329 6700 8707 10831 13474 15360 17509 19960 21781 23769 25938 84 2349
4523 6999 9095 11314 14075 16045 18291 20851 22753 24830 27095 85 2454 4725
7311 9501 11819 14703 16761 19107 21781 23769 25938 28305 86 2564 4935 7638
9925 12347 15360 17509 19960 22753 24830 27095 29568 87 2678 5156 7979 10368
12898 16045 18291 20851 23769 25938 28305 30888 88 2798 5386 8335 10831 13474
16761 19107 21781 24830 27095 29568 32266 89 2922 5626 8707 11314 14075 17509
19960 22753 25938 28305 30888 33706 90 3053 5877 9095 11819 14703 18291 20851
23769 27095 29568 32266 35211 91 3189 6140 9501 12347 15360 19107 21781 24830
28305 30888 33706 36782 92 3331 6414 9925 12898 16045 19960 22753 25938 29568
32266 35211 38424 93 3480 6700 10368 13474 16761 20851 23769 27095 30888 33706
36782 40139 94 3636 6999 10831 14075 17509 21781 24830 28305 32266 35211 38424
41930 95 3798 7311 11314 14703 18291 22753 25938 29568 33706 36782 40139 43801
96 3967 7638 11819 15360 19107 23769 27095 30888 35211 38424 41930 45756 97
4144 7979 12347 16045 19960 24830 28305 32266 36782 40139 43801 47798 98 4329
8335 12898 16761 20851 25938 29568 33706 38424 41930 45756 49932 99 4523 8707
13474 17509 21781 27095 30888 35211 40139 43801 47798 52160 100 4725 9095
14075 18291 22753 28305 32266 36782 41930 45756 49932 54488 101 4935 9501
14703 19107 23769 29568 33706 38424 43801 47798 52160 56920 102 5156 9925
15360 19960 24830 30888 35211 40139 45756 49932 54488 59460 103 5386 10368
16045 20851 25938 32266 36782 41930 47798 52160 56920 62114 104 5626 10831
16761 21781 27095 33706 38424 43801 49932 54488 59460 64886 105 5877 11314
17509 22753 28305 35211 40139 45756 52160 56920 62114 67782 106 6140 11819
18291 23769 29568 36782 41930 47798 54488 59460 64886 70807 107 6414 12347
19107 24830 30888 38424 43801 49932 56920 62114 67782 73967 108 6700 12898
19960 25938 32266 40139 45756 52160 59460 64886 70807 77268 109 6999 13474
20851 27095 33706 41930 47798 54488 62114 67782 73967 80717 110 7311 14075
21781 28305 35211 43801 49932 56920 64886 70807 77268 84319 111 7638 14703
22753 29568 36782 45756 52160 59460 67782 73967 80717 88082 112 7979 15360
23769 30888 38424 47798 54488 62114 70807 77268 84319 92014 113 8335 16045
24830 32266 40139 49932 56920 64886 73967 80717 88082 96120 114 8707 16761
25938 33706 41930 52160 59460 67782 77268 84319 92014 100410 115 9095 17509
27095 35211 43801 54488 62114 70807 80717 88082 96120 104891 116 9501 18291
28305 36782 45756 56920 64886 73967 84319 92014 100410 109573 117 9925 19107
29568 38424 47798 59460 67782 77268 88082 96120 104891 114463 118 10368 19960
30888 40139 49932 62114 70807 80717 92014 100410 109573 119572 119 10831 20851
32266 41930 52160 64886 73967 84319 96120 104891 114463 124908 120 11314 21781
33706 43801 54488 67782 77268 88082 100410 109573 119572 130483 121 11819
22753 35211 45756 56920 70807 80717 92014 104891 114463 124908 136306 122
12347 23769 36782 47798 59460 73967 84319 96120 109573 119572 130483 142390
123 12898 24830 38424 49932 62114 77268 88082 100410 114463 124908 136306
148744 124 13474 25938 40139 52160 64886 80717 92014 104891 119572 130483
142390 155383 125 14075 27095 41930 54488 67782 84319 96120 109573 124908
136306 148744 162318 126 14703 28305 43801 56920 70807 88082 100410 114463
130483 142390 155383 169562 127 15360 29568 45756 59460 73967 92014 104891
119572 136306 148744 162318 177130
* * *
###### ## Annex BC (normative): E-DCH Transport Block Size Tables for 1.28
Mcps TDD
The mapping between the TB index k (k = {0,1,...63}) and the corresponding
E-DCH transport block size is given in the following tables.
## BC.1 5ms TTI E-DCH Transport Block Size Table 0
* * *
                 **Category 1-2**     **Category 3-6**
**TB index** **1 Timeslot TBS** **2 Timeslots TBS** **3 Timeslots TBS** **1
Timeslot TBS** **2 Timeslots TBS** **3 Timeslots TBS** **4 Timeslots TBS** **5
Timeslots TBS** 0 23 23 23 23 23 23 23 23 1 116 116 116 116 116 116 116 116 2
162 162 162 162 162 162 162 162 3 167 169 170 169 171 172 173 173 4 173 177
180 177 181 184 186 186 5 179 186 190 186 192 196 199 199 6 186 195 200 194
204 209 213 213 7 192 204 211 204 216 223 229 229 8 199 214 222 213 229 238
245 245 9 206 224 235 223 242 254 263 263 10 213 234 247 234 257 271 282 282
11 221 246 261 245 272 289 302 302 12 229 257 275 257 288 309 324 324 13 237
270 290 269 306 329 347 347 14 245 282 306 282 324 351 372 372 15 254 296 323
295 343 375 399 399 16 263 310 341 309 364 400 427 427 17 272 325 359 324 385
427 458 458 18 282 340 379 339 408 455 491 491 19 292 356 400 355 433 486 526
526 20 302 373 422 372 459 518 564 564 21 313 391 445 390 486 553 605 605 22
324 410 469 408 515 589 648 648 23 335 429 495 427 546 629 695 695 24 347 450
522 448 578 671 745 745 25 359 471 550 469 613 716 799 799 26 372 493 581 491
649 764 856 856 27 385 517 612 514 688 815 918 918 28 399 541 646 539 729 869
983 983 29 413 567 681 564 773 927 1054 1054 30 428 594 718 591 819 989 1130
1130 31 443 622 758 619 867 1055 1211 1211 32 458 652 799 648 919 1125 1298
1298 33 475 683 843 679 974 1201 1392 1392 34 491 716 889 711 1032 1281 1492
1492 35 509 750 937 745 1094 1366 1599 1599 36 527 785 989 780 1159 1458 1714
1714 37 545 823 1043 817 1228 1555 1837 1837 38 565 862 1100 856 1301 1659
1969 1969 39 585 903 1160 896 1379 1770 2110 2110 40 605 946 1223 938 1461
1888 2262 2262 41 627 991 1290 983 1548 2014 2425 2425 42 649 1038 1361 1029
1640 2148 2599 2599 43 672 1087 1435 1078 1738 2292 2786 2786 44 696 1139 1514
1129 1841 2445 2986 2986 45 720 1193 1596 1183 1951 2608 3200 3200 46 746 1250
1684 1239 2067 2782 3430 3430 47 772 1309 1776 1297 2191 2968 3677 3677 48 799
1372 1873 1359 2321 3166 3941 3941 49 827 1437 1975 1423 2460 3377 4224 4224
50 857 1505 2083 1491 2606 3603 4528 4528 51 887 1577 2197 1561 2762 3843 4853
4853 52 918 1652 2317 1635 2926 4100 5202 5202 53 951 1730 2444 1712 3101 4374
5576 5576 54 984 1813 2578 1794 3285 4666 5976 5976 55 1019 1899 2719 1878
3481 4977 6406 6406 56 1055 1989 2867 1967 3689 5310 6866 6866 57 1092 2084
3024 2060 3908 5664 7359 7359 58 1131 2183 3189 2158 4141 6042 7888 7888 59
1171 2287 3364 2260 4388 6446 8455 8455 60 1212 2395 3547 2367 4650 6876 9062
9062 61 1255 2509 3741 2479 4927 7335 9713 9713 62 1300 2629 3946 2597 5220
7825 10411 10411 63 1346 2754 4162 2720 5532 8348 11160 11160
* * *
###### ## Annex C (informative): Pseudo-Code for E-TFC Selection (FDD)
The pseudo-code below describes one possible implementation of the E-TFC
Selection when there is one Activated Uplink Frequency in CELL_DCH state as
described in subclause 11.8.1.4:
1> determine whether to take the scheduled and non-scheduled grants into
account in the upcoming transmission.
1> if scheduled and/or non-scheduled data can be transmited:
2> select a MAC-d flow that allows highest-priority data to be transmitted
(when more than one MAC-d flow allows data of the same highest priority to be
transmitted, it is left to implementation to select which MAC-d flow to
prefer);
2> identify the MAC-d flow(s) whose multiplexing lists allow them to be
transmitted in the same TTI as this MAC-d flow, and whose grants allow them to
transmit in this TTI and ignore the one(s) that cannot.
2> based on the HARQ profile of this MAC-d flow, identify the power offset to
use;
2> based on this power offset and the E-TFC restriction procedure, determine
the \"Maximum Supported Payload\" (i.e. maximum MAC-e or MAC-i PDU size or
E-TFC that can be sent by the UE during the upcoming transmission);
2> if the upcoming transmission overlaps with a compressed mode gap on 10ms
TTI, scale down the current serving grant (SG);
2> set \"Remaining Scheduled Grant Payload\" to the highest payload that could
be transmitted according to SG and selected power offset;
2> for each MAC-d flow with a non-scheduled grant, set the \"Remaining Non-
scheduled Payload\" to the value of the grant;
2> if Scheduling Information needs to be transmitted:
3> set \"Total Granted Payload\" to the sum of \"Remaining Non Scheduled
Payload\" for all non-scheduled MAC-d flows + \"Remaining Scheduled Grant
Payload\" + size of the scheduling information.
2> else:
3> set \"Total Granted Payload\" to the sum of \"Remaining Non Scheduled
Payload\" for all non-scheduled MAC-d flows + \"Remaining Scheduled Grant
Payload\".
2> set \"Remaining Available Payload\" to MIN (\"Max Supported Payload\",
\"Total Granted Payload\");
2> if \"Remaining Available Payload\"= an ETFC size:
3> set \"Quantisation Loss\" to zero.
2> else:
3> set \"Quantization Loss\" to the value of \"Remaining Available Payload\"
-- (\"Remaining Available Payload\" rounded down to the next smaller E-TFC).
> 2> if scheduling information needs to be transmitted:
>
> 3> subtract the size of scheduling information from \"Remaining Available
> Payload\".
2> set \"Quantisation Applied\" to FALSE;
2> perform the following loop for each logical channel, in the order of their
priorities:
3> if this logical channel belongs to a MAC-d flow with a non-scheduled grant,
then:
4> consider the \"Remaining Non-scheduled Payload\" corresponding to the MAC-d
flow on which this logical channel is mapped;
4> fill the MAC-e or MAC-i PDU with SDU(s) from this logical channel up to MIN
(\"Remaining Non-scheduled Payload\" taking into account the MAC-e/es or
MAC-i/is headers, Available Data for this logical channel, \"Remaining
Available Payload\" taking into account the MAC-e/es or MAC-i/is headers);
4> subtract the corresponding bits if any from \"Remaining Available Payload\"
and \"Remaining Non-scheduled Payload\" taking into account the MAC-e/es or
MAC-i/is headers.
3> else:
4> If \"Quantisation Applied\" is TRUE:
5> fill the MACe PDU with SDU(s) from this logical channel up to MIN
(\"Remaining Scheduled Grant Payload\" taking into account the MAC-e/es or
MAC-i/is headers, Available Data for this logical channel, \"Remaining
Available Payload\" taking into account the MAC-e/es or MAC-i/is headers);
5> subtract the corresponding bits if any from \"Remaining Available Payload\"
and \"Remaining Scheduled Grant Payload\" taking into account the MAC-e/es or
MAC-i/is headers.
> 4> else:
5> fill the MAC-e or MAC-i PDU with SDU(s) from this logical channel up to MIN
(\"Remaining Scheduled Grant Payload\" taking into account the MAC-e/es or
MAC-i/is headers, Available Data for this logical channel, \"Remaining
Available Payload\" -- \"Quantisation Loss\" taking into account the MAC-e/es
or MAC-i/is headers);
5> if bits can be transmitted on this logical channel:
6> set \"Remaining Available Payload\" to (\"Remaining Available Payload\" --
\"Quantisation Loss\");
6> subtract the corresponding bits from \"Remaining Available Payload\" and
\"Remaining Scheduled Grant Payload\" taking into account the MAC-e/es or
MAC-i/is headers;
6> set \"Quantisation Applied\" to TRUE.
2> if Scheduling Information needs to be transmitted:
3> add Scheduling Information to the MAC-e or MAC-i PDU;
3> determine the smallest E-TFC that can carry the resulting MAC-e or MAC-i
PDU;
3> if the padding allows a DDI~0~ to be sent, add it to the end of the MAC-e
header.
2> else:
3> determine the smallest E-TFC that can carry the resulting MAC-e or MAC-i
PDU;
3> if the padding allows a Scheduling Information to be sent, add it to the
MAC-e or MAC-i PDU;
3> if a Scheduling Information was added to the PDU and if the padding allows
a DDI~0~ or LCH-ID~0~ to be sent, add it to the end of the MAC-e or MAC-i
header.
2> set the maximum number of HARQ transmissions to the maximum among the
maximum number of HARQ transmissions of the HARQ profiles of the MAC-d flows
selected for transmissions.
1> else if Scheduling Information needs to be transmitted:
2> select the \"control-only\" HARQ profile;
2> fill the MAC-e or MAC-i PDU with the scheduling information;
2> select the smallest E-TFC.
###### ## Annex CA (informative): Pseudo-Code for E-TFC Selection (TDD)
The pseudo-code below describes one possible implementation of UE E-TFC
Selection as described in subclause 11.9.1.4. It consists of three separate
procedures which are normally executed Procedure 1, 2 and then 3:
**Procedure 1:**
1> Determine set B, the set of logical channels which consist of a) the
highest priority logical channel which has data buffered for transmission b)
the set of logical channels which have data buffered for transmission and
which may be multiplexed with the highest priority channel. The detailed steps
involved are as follows:
2> Determine whether or not a TTI is designated for scheduled or non scheduled
transmission.
2> Determine the set A of logical channels which have data buffered for
transmission and which are consistent with the TTI designation (scheduled or
non-scheduled).
2> Determine X, the highest priority logical channel in set A.
2> For 3.84 and 7.68Mcps TDD, select the HARQ profile of the MAC-d flow, flow
Y, to which logical channel X belongs. _(Note: A logical channel can only
belong to one MAC-d flow and can therefore only have one HARQ profile)._ For
1.28Mcps TDD, for the UE which uses dedicated E-RNTI, the HARQ power offset
shall be set to the maximum of HARQ power offset of all the MAC-d flows mapped
to the same type of resource (for CELL_DCH state, the resource can be
scheduled or non-scheduled resource, for CELL_FACH state, the resource can
only be scheduled resource), for the UE which uses common E-RNTI, the HARQ
power offset shall be set to the maximum of HARQ power offset of all the MAC-c
flows mapped to the scheduled resource.
2> Determine set B, the set of logical channels which are in set A and which
belong to flow Y or to a flow which may be multiplexed with flow Y
**Procedure 2:**
1> Generate the largest block size that can be supported by the resources
granted. The detailed steps involved are as follows:
2> Determine the sets of TFCs C~1~ (QPSK) and C~2~ (16-QAM) whose code rates
fall within the allowed maximum and minimum (inclusive) coderates specified by
RRC for the assigned number of time slots and the assigned channelisation code
(the UE is not allowed to use more or less slots than are assigned nor to use
a code associated with a lower spreading factor). For 1.28 Mcps TDD, the
spreading factor can not be changed by the UE and the current value of ENI
should be considered when choosing the allowed maximum and minimum code rates
if a scheduled transmission is designated.
2> Determine the subsets D~1~ and D~2~ of C~1~ and C~2~ respectively which
require transmit power that is less than or equal to the power available
taking into account of the power offset of the HARQ profile (the power offset
is determined in procedure 1), P~e-base~, Pathloss and beta values (see [18])
associated with TFCs for QPSK and 16QAM.
2> For 1.28Mcps TDD,
\- If the data of other type physical channel within the E-PUCH timeslots in
the TTI shall be transmitted, the UE selects QPSK modulation. Determine k, the
largest MAC-e / MAC-i PDU block size that can be supported from the set D1,
which require transmit power by QPSK modulation that is less than or equal to
the power by 16-QAM and the power that consider other type physical channel
transmit power.
\- Otherwise determine K, the largest MAC-e / MAC-i PDU block size that can be
supported, from the sets D1 and D2.
2> For 3.84Mcps and 7.68Mcps TDD, determine k, the largest MAC-e / MAC-i PDU
block size that can be supported, from the sets D~1~ and D~2~
2> If k belongs exclusively to set D~1~, select QPSK modulation. If k belongs
exclusively to set D~2~, select 16-QAM modulation. If k appears in both sets
D~1~ and D~2~, select 16-QAM modulation only if it offers a lower power
requirement than QPSK, otherwise select QPSK modulation.
**Procedure 3:**
1> Generate the largest MAC-e / MAC-i PDU, having a size ≤ k, by taking MAC-d
PDUs from logical channels in set B (in order of priority) and select SF (for
1.28 Mcps TDD, the SF can not be changed) and modulation so as to minimise the
power used. The detailed steps are as follows:
2> For 3.84Mcps and 7.68Mcps TDD, generate the largest MAC-e / MAC-i PDU ≤ k,
taking MAC-d PDUs from logical channels belonging to set B (in priority
order); For 1.28Mcps TDD, generate the largest MAC-e / MAC-i PDU =k, taking
MAC-d PDUs from logical channels belonging to set B(in priority order),
Padding is included in the end of the MAC-e / MAC-i PDU if the total size of
the MAC-e / MAC-i payload plus the MAC-e / MAC-i header is smaller than k;
2> If this is successful (i.e. sufficient resources granted):
3> select the SF (for 1.28 Mcps TDD, the SF cannot be changed) and modulation
according to the result of Procedure 2 to use.
2> If this is not successful (i.e. the MAC-e / MAC-i PDU is empty due to
insufficient resources granted):
3> A := A -- B;
3> if A is not empty (i.e. other logical channels have data buffered for
transmission):
4> determine a new set B (repeat Procedure 1 and then Procdure 3).
3> if A is empty (i.e. no other logical channels have data buffered for
transmission):
4> transmit scheduling information only in the MAC-e / MAC-i PDU. For 1.28Mcps
TDD,select the QPSK modulation and the transmit power uses the lower power of
the granted power and the available maximum E-PUCH power.
#
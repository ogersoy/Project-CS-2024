# Foreword
This Technical Specification (TS) has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of this present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies and establishes the characteristics of the
physicals layer procedures in the FDD mode of UTRA.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 25.211: \"Physical channels and mapping of transport channels onto
physical channels (FDD)\".
[2] 3GPP TS 25.212: \"Multiplexing and channel coding (FDD)\".
[3] 3GPP TS 25.213: \"Spreading and modulation (FDD)\".
[4] 3GPP TS 25.215: \"Physical layer -- Measurements (FDD)\".
[5] 3GPP TS 25.331: \"RRC Protocol Specification\".
[6] 3GPP TS 25.433: \"UTRAN Iub Interface NBAP Signalling\".
[7] 3GPP TS 25.101: \"UE Radio transmission and Reception (FDD)\".
[8] 3GPP TS 25.133: \"Requirements for Support of Radio Resource Management
(FDD)\".
[9] 3GPP TS 25.321: \"MAC protocol specification\".
[10] 3GPP TS 25.306: \"UE Radio Access Capabilities\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**Activated uplink frequency:** For a specific UE, an uplink frequency is said
to be activated if the UE is allowed to transmit on that frequency. The
primary uplink frequency is always activated when configured while a secondary
uplink frequency has to be activated by means of an HS-SCCH order in order to
become activated. Similarly, for a specific UE, an uplink frequency is said to
be deactivated if it is configured but disallowed by the NodeB to transmit on
that frequency.
**Assisting secondary serving HS-DSCH Cell:** In addition to the serving HS-
DSCH cell, a cell in the secondary downlink frequency, where the UE is
configured to simultaneously monitor a HS-SCCH set and receive HS-DSCH if it
is scheduled in that cell.
**Assisting serving HS-DSCH Cell:** In addition to the serving HS-DSCH cell, a
cell in the same frequency, where the UE is configured to simultaneously
monitor a HS-SCCH set and receive HS-DSCH if it is scheduled in that cell.
**Cell group** : A group of (one or two) Multiflow mode cells that have the
same CPICH timing. The CQI reports for all the cells in a cell group are
reported together in the same sub frame. The cells that belong to a cell group
are indicated by higher layers.
**Configured uplink frequency** : For a specific UE, an uplink frequency is
said to be configured if the UE has received all relevant information from
higher layers in order to perform transmission on that frequency.
**L1 combining period** : An interval of contiguous TTIs when S-CCPCHs, each
on different RLs, may be soft combined.
**MIMO mode:** This term refers to the downlink MIMO configuration with two
transmit antennas.
**MIMO mode with four transmit antennas:** This term refers to the downlink
MIMO configuration with four transmit antennas.
**Multiflow mode:** The UE is configured in Multiflow mode when it is
configured with an assisting serving HS-DSCH cell.
**Non-time reference cell:** An HS-DSCH cell configured for a UE in Multiflow
mode that has a different timing than the time reference cell. If the time
reference cell is the Assisting Serving HS-DSCH cell then the non-time
reference cell is the Serving HS-DSCH cell. If the time reference cell is the
Serving HS-DSCH Cell, then the non-time reference cell is the Assisting
Serving HS-DSCH cell.
**Primary uplink frequency:** If a single uplink frequency is configured for
the UE, then it is the _primary uplink frequency_. In case more than one
uplink frequency is configured for the UE, then the primary uplink frequency
is the frequency on which the E-DCH corresponding to the serving E-DCH cell
associated with the serving HS-DSCH cell is transmitted. The association
between a pair of uplink and downlink frequencies is indicated by higher
layers.
**Secondary uplink frequency:** A _secondary uplink frequency_ is a frequency
on which an E-DCH corresponding to a serving E-DCH cell associated with a
secondary serving HS-DSCH cell is transmitted. The association between a pair
of uplink and downlink frequencies is indicated by higher layers.
**Time reference cell:** The (Serving or Assisting Serving, but not Secondary
Serving or Assisting Secondary Serving) HS-DSCH cell that carries the HS-PDSCH
acting as the time reference for the uplink HS-DPCCH when in Multiflow mode.
There is one and only one Time reference cell.
**1^st^ secondary serving HS-DSCH cell:** If the UE is configured with two
uplink frequencies, the 1^st^ secondary serving HS-DSCH cell is the secondary
serving HS-DSCH cell that is associated with the secondary uplink frequency.
If the UE is configured with a single uplink frequency, the 1^st^ secondary
serving HS-DSCH cell is a secondary serving HS-DSCH cell whose index is
indicated by higher layers.
**2^nd^ secondary serving HS-DSCH cell:** If the UE is configured with more
than two serving HS-DSCH cells, the 2^nd^ secondary serving HS-DSCH cell is a
secondary serving HS-DSCH cell whose index is indicated by higher layers.
**3^rd^ secondary serving HS-DSCH cell:** If the UE is configured with more
than three serving HS-DSCH cells, the 3rd secondary serving HS-DSCH cell is a
secondary serving HS-DSCH cell whose index is indicated by higher layers.
**4^th^ secondary serving HS-DSCH cell:** If the UE is configured with more
than four serving HS-DSCH cells, the 4th secondary serving HS-DSCH cell is a
secondary serving HS-DSCH cell whose index is indicated by higher layers.
**5^th^ secondary serving HS-DSCH cell:** If the UE is configured with more
than five serving HS-DSCH cells, the 5th secondary serving HS-DSCH cell is a
secondary serving HS-DSCH cell whose index is indicated by higher layers.
**6^th^ secondary serving HS-DSCH cell:** If the UE is configured with more
than six serving HS-DSCH cells, the 6th secondary serving HS-DSCH cell is a
secondary serving HS-DSCH cell whose index is indicated by higher layers.
**7^th^ secondary serving HS-DSCH cell:** If the UE is configured with eight
serving HS-DSCH cells, the 7th secondary serving HS-DSCH cell is a secondary
serving HS-DSCH cell whose index is indicated by higher layers.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
ACK Acknowledgement
AICH Acquisition Indicator Channel
ASC Access Service Class
BCH Broadcast Channel
CCPCH Common Control Physical Channel
CCTrCH Coded Composite Transport Channel
CLTD Closed Loop Transmit Diversity
CPICH Common Pilot Channel
CQI Channel Quality Indicator
CRC Cyclic Redundancy Check
DCH Dedicated Channel
DL Downlink
DPCCH Dedicated Physical Control Channel
DPCH Dedicated Physical Channel
DPDCH Dedicated Physical Data Channel
DTX Discontinuous Transmission
E-AGCH E-DCH Absolute Grant Channel
E-DCH Enhanced Dedicated Channel
E-DPCCH E-DCH Dedicated Physical Control Channel
E-DPDCH E-DCH Dedicated Physical Data Channel
E-HICH E-DCH HARQ Acknowledgement Indicator Channel
E-RGCH E-DCH Relative Grant Channel
E-ROCH E-DCH Rank and Offset Channel
F-DPCH Fractional Dedicated Physical Channel
F-TPICH Fractional Transmitted Precoding Indicator Channel
HSDPA High Speed Downlink Packet Access
HS-DPCCH Dedicated Physical Control Channel (uplink) for HS-DSCH
HS-DPCCH~2~ Secondary Dedicated Physical Control Channel (uplink) for HS-DSCH,
when Secondary_Cell_Enabled is greater than 3 when the UE is not configured in
MIMO mode with four transmit antennas and is greater than 1 when the UE is
configured in MIMO mode with four transmit antennas
HS-DSCH High Speed Downlink Shared Channel
HS-PDSCH High Speed Physical Downlink Shared Channel
HS-SCCH High Speed Physical Downlink Shared Control Channel
MBSFN MBMS over a Single Frequency Network
MICH MBMS Indicator Channel
MIMO Multiple Input Multiple Output
NACK Negative Acknowledgement
NT-HS-DPCCH NodeB Triggered HS-DPCCH
P-CCPCH Primary Common Control Physical Channel
PCA Power Control Algorithm
PICH Paging Indicator Channel
PRACH Physical Random Access Channel
RACH Random Access Channel
RL Radio Link
RPL Recovery Period Length
RSCP Received Signal Code Power
S-CCPCH Secondary Common Control Physical Channel
SCH Synchronization Channel
S-DPCCH Secondary Dedicated Physical Control Channel
S-E-DPCCH Secondary Dedicated Physical Control Channel for E-DCH
S-E-DPDCH Secondary Dedicated Physical Data Channel for E-DCH
SFN System Frame Number
SIR Signal-to-Interference Ratio
SNIR Signal to Noise Interference Ratio
TFC Transport Format Combination
TFRI Transport Format and Resource Indicator
TPC Transmit Power Control
TPI Transmitted Precoding Indicator
TrCH Transport Channel
TTI Transmission Time Interval
UE User Equipment
UL Uplink
UTRAN UMTS Terrestrial Radio Access Network
# 4 Synchronization procedures
## 4.1 Cell search
During the cell search, the UE searches for a cell and determines the downlink
scrambling code and common channel frame synchronization of that cell. How
cell search is typically done is described in Annex C.
## 4.2 Common physical channel synchronization
The radio frame timing of all common physical channels can be determined after
cell search.
### 4.2.1 P-CCPCH radio frame timing
The P-CCPCH radio frame timing is found during cell search and the radio frame
timing of all common physical channel are related to that timing as described
in [1].
### 4.2.2 S-CCPCH soft combining timing
Higher layers will provide timing information when S-CCPCHs, each on different
RLs,can be soft combined. The timing information allows the UE to determine
the L1 combining period that applies to each S-CCPCH. The information also
identifies the S-CCPCHs and the RLs that can be soft combined. The set of
S-CCPCHs that can be combined does not change during an L1 combining period.
When S-CCPCHs can be soft combined, all S-CCPCHs shall contain identical bits
in their data fields, although the TFCI fields of the S-CCPCHs may be
different. (TFC detection when S-CCPCHs may be soft combined is discussed in
[2].) The maximum delay between S-CCPCHs that the UE may combine is set by UE
performance requirements. The maximum number of S-CCPCHs that UE may
simultaneously combine is defined by the UE capability in [10].
### 4.2.3 Radio frame timing on the MBSFN layer
MBSFN cluster search and radio frame synchronization on the MBSFN layer can be
performed via SCH and follow the same principles as described in Annex C.
After the primary scrambling code has been identified, the P-CCPCH can be
detected and MBSFN system information can be read.
### 4.2.4 Secondary serving HS-DSCH cell timing
When the UE is configured with one or more secondary serving HS-DSCH cells, it
shall not assume the presence of any common physical channel from these cells
other than CPICH. The radio frame timing and timing reference for each of the
secondary serving HS-DSCH cells are defined in [1].
### 4.2.5 HS-DSCH cell timing when Multiflow is configured
When the UE is configured in Multiflow mode, the UE shall not assume any
timing relation between the serving HS-DSCH cell and the assisting serving HS-
DSCH cell. The UE can only be configured with an assisting serving HS-DSCH
cell if that cell is contained in the UE's active set. If the UE is also
configured with multiple uplink frequencies, then the UE can only be
configured with an assisting secondary serving HS-DSCH cell if that cell is
contained in the UE's active set on the secondary uplink frequency.
The UE may assume that the serving HS-DSCH cell and the secondary serving HS-
DSCH cell, if present, have the same radio frame timing.
The UE may assume that the assisting serving HS-DSCH cell and the assisting
secondary serving HS-DSCH cell, if present, have the same radio frame timing.
## 4.3 DPCCH/DPDCH/F-DPCH synchronization
### 4.3.1 Synchronization primitives
#### 4.3.1.1 General
For the dedicated channels, synchronization primitives are used to indicate
the synchronization status of radio links, both in uplink and downlink. The
definition of the primitives is given in the following subclauses.
#### 4.3.1.2 Downlink synchronization primitives
If UL_DTX_Active is FALSE (see clause 6C), layer 1 in the UE shall every radio
frame check synchronization status of either the DPCH or the F‑DPCH depending
on which is configured. If UL_DTX_Active is TRUE (see clause 6C), the layer 1
in the UE shall check synchronization status of the F-DPCH for each radio
frame in which the F-DPCH transmission is known to be present in at least one
slot, and for the other radio frames, the layer 1 will not indicate any
synchronization status to the higher layers. Synchronization status is
indicated to higher layers using the CPHY-Sync-IND and CPHY-Out-of-Sync-IND
primitives.
The criteria for reporting synchronization status are defined in two different
phases. Each phase is performed by the UE for each individual downlink
frequency associated with the activated uplink frequencies. The downlink
synchronization primitives are also reported to higher layers for each
individual downlink frequency associated with the activated uplink
frequencies.
The first phase starts when higher layers initiate physical dedicated channel
establishment (as described in [5]) or whenever the UE initiates
synchronization procedure A or synchronization procedure AA (as described in
subclauses 4.3.2.1 and 4.3.2.3A) and lasts until 160 ms after the downlink
dedicated channel is considered established by higher layers (physical channel
establishment is defined in [5]). During this time out-of-sync shall not be
reported and in-sync shall be reported using the CPHY-Sync-IND primitive if
the following criterion is fulfilled:
  * The UE estimates the DPCCH quality or the quality of the TPC fields of the F-DPCH frame received from the associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the previous 40 ms period to be better than a threshold Q~in~. This criterion shall be assumed not to be fulfilled before 40 ms of DPCCH quality measurements have been collected. Q~in~ is defined implicitly by the relevant tests in [7].
The second phase starts 160 ms after the downlink dedicated channel is
considered established by higher layers. During this phase both out-of-sync
and in-sync are reported as follows.
Out-of-sync shall be reported using the CPHY-Out-of-Sync-IND primitive if any
of the following criteria is fulfilled:
\- UL_DTX_Active is FALSE (see clause 6C) and the UE estimates the DPCCH
quality or the quality of the TPC fields of the F-DPCH frame received from the
associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the
previous 160 ms period to be worse than a threshold Q~out~. Q~out~ is defined
implicitly by the relevant tests in [7].
  * UL_DTX_Active is TRUE (see clause 6C) and the UE estimates the quality of the TPC fields of the F-DPCH from the associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the previous 240 slots in which the TPC symbols are known to be present to be worse than a threshold Q~out~. Q~out~ is defined implicitly by the relevant tests in [7].
\- The 20 most recently received transport blocks with a non-zero length CRC
attached, as observed on all TrCHs using non-zero length CRC mapped to the
DPDCH, have been received with incorrect CRC. In addition, over the previous
160 ms, all transport blocks with a non-zero length CRC attached have been
received with incorrect CRC. In case no TFCI is used this criterion shall not
be considered for the TrCH(s) not using guided detection if they do not use a
non-zero length CRC in all transport formats. If no transport blocks with a
non-zero length CRC attached are received over the previous 160 ms this
criterion shall not be assumed to be fulfilled.
For a DPCH, in-sync shall be reported using the CPHY-Sync-IND primitive if
both of the following criteria are fulfilled:
\- The UE estimates the DPCCH quality over the previous 160 ms period to be
better than a threshold Q~in~. Q~in~ is defined implicitly by the relevant
tests in [7].
\- At least one transport block with a non-zero length CRC attached, as
observed on all TrCHs using non-zero length CRC mapped to the DPDCH, is
received in a TTI ending in the current frame with correct CRC. If no
transport blocks are received, or no transport block has a non-zero length CRC
attached in a TTI ending in the current frame and in addition over the
previous 160 ms at least one transport block with a non-zero length CRC
attached has been received with a correct CRC, this criterion shall be assumed
to be fulfilled. If no transport blocks with a non-zero length CRC attached
are received over the previous 160 ms this criterion shall also be assumed to
be fulfilled. In case no TFCI is used this criterion shall not be considered
for the TrCH(s) not using guided detection if they do not use a non-zero
length CRC in all transport formats.
For a F-DPCH, in-sync shall be reported using the CPHY-Sync-IND primitive if
any of the following criteria is fulfilled:
\- UL_DTX_Active is FALSE (see clause 6C) and the UE estimates the quality of
the TPC fields of the F-DPCH frame received from the associated serving HS-
DSCH cell (or secondary serving HS-DSCH cell) over the previous 160 ms period
to be better than a threshold Q~in~. Q~in~ is defined implicitly by the
relevant tests in [7].
  * UL_DTX_Active is TRUE (see clause 6C) and the UE estimates the quality of the TPC fields of the F-DPCH from the associated serving HS-DSCH cell (or secondary serving HS-DSCH cell) over the previous 240 slots in which the TPC symbols are known to be present to be better than a threshold Q~in~. Q~in~ is defined implicitly by the relevant tests in [7].
How the primitives are used by higher layers is described in [5]. The above
definitions may lead to radio frames where neither the in-sync nor the out-of-
sync primitives are reported.
#### 4.3.1.3 Uplink synchronization primitives
Layer 1 in the Node B shall every radio frame check synchronization status of
all radio link sets. Synchronization status is indicated to the RL
Failure/Restored triggering function using either the CPHY-Sync-IND or CPHY-
Out-of‑Sync‑IND primitive. Hence, only one synchronization status indication
shall be given per radio link set.
The exact criteria for indicating in-sync/out-of-sync is not subject to
specification, but could e.g. be based on received DPCCH quality or CRC
checks. One example would be to have the same criteria as for the downlink
synchronization status primitives.
### 4.3.2 Radio link establishment and physical layer reconfiguration for
dedicated channels
#### 4.3.2.1 General
Three synchronization procedures are defined in order to obtain physical layer
synchronization of dedicated channels between UE and UTRAN:
\- Synchronization procedure A: This procedure shall be used when at least one
downlink dedicated physical channel (i.e. a DPCH or F-DPCH) and one uplink
dedicated physical channel are to be set up on a frequency and none of the
radio links after the establishment/reconfiguration existed on that frequency
prior to the establishment/reconfiguration which also includes the following
cases :
\- the UE was previously on another RAT i.e. inter-RAT handover
\- the UE was previously on another frequency i.e. inter-frequency hard
handover
\- the UE has all its previous radio links removed and replaced by other radio
links i.e. intra-frequency hard-handover
\- after it fails to complete an inter-RAT, intra- or inter-frequency hard-
handover [8], the UE attempts to re-establish [5] all the dedicated physical
channels which were already established immediately before the hard-handover
attempt. In this case only steps c) and d) of synchronization procedure A are
applicable.
\- the UE receives an HS-SCCH order to activate the secondary uplink frequency
as specified in [2] and the UE is configured with multiple frequencies on the
uplink.
> For transitions from the CELL_FACH state of a cell to the CELL_DCH state of
> the same cell,, when synchronization has already been achieved by a
> synchronization procedure AA and the UE has not already released its uplink
> common E-DCH resource before the time of transition to CELL_DCH, the
> synchronization procedure A shall not be executed. Else, the synchronization
> procedure A shall be executed.
>
> \- Synchronization procedure AA: This procedure shall be used when one
> downlink F-DPCH and uplink dedicated physical channels are to be set up on a
> frequency as a consequence of an Enhanced Uplink in CELL_FACH procedure.
\- Synchronization procedure B: This procedure shall be used when one or
several radio links are added to the active set on a frequency and at least
one of the radio links prior to the establishment/reconfiguration still exists
on that frequency after the establishment/reconfiguration.
  * If higher layers indicate that the UE shall not perform any > synchronization procedure for timing maintained intra- and > inter-frequency hard handover, the UE shall not perform any of the > synchronization procedures A or B. If higher layers indicate to > the Node B timing maintained intra- or inter-frequency hard > handover where the UE does not perform any of the synchronization > procedures A, AA or B, the Node B shall perform steps a) and b) of > synchronization procedure B.
For all physical layer reconfigurations not listed above, the UE and UTRAN
shall not perform any of the synchronization procedures listed above.
The three synchronization procedures are described in subclauses 4.3.2.3,
4.3.2.3A and 4.3.2.4 respectively.
#### 4.3.2.2 Node B radio link set state machine
In Node B, each radio link set can be in three different states: initial
state, out-of-sync state and in-sync state. Transitions between the different
states are shown in figure 1 below. The state of the Node B at the start of
radio link establishment is described in the following subclauses. Transitions
between initial state and in-sync state are described in subclauses 4.3.2.3,
4.3.2.3A and 4.3.2.4 and transitions between the in-sync and out-of-sync
states are described in subclause 4.3.3.2.
Figure 1: Node B radio link set states and transitions
#### 4.3.2.3 Synchronization procedure A
For each configured uplink frequency, the synchronization establishment
procedure, which begins at the time indicated by higher layers (either
immediately at receipt of upper layer signalling, or at an indicated
activation time), or by an HS-SCCH order to activate the secondary uplink
frequency (in the case multiple frequencies are configured on the uplink) is
as follows:
a) Each Node B involved in the procedure sets all the radio link sets which
are to be set-up for this UE in the initial state.
b) UTRAN shall start the transmission of the downlink DPCCH or F-DPCH
corresponding to the activated uplink frequency and may start the transmission
of DPDCH if any data is to be transmitted. The initial downlink DPCCH or
F-DPCH transmit power is set by higher layers [6]. Downlink TPC commands are
generated as described in 5.1.2.2.1.2.
c) The UE establishes downlink chip and frame synchronization of DPCCH or
F-DPCH corresponding to the activated uplink frequency, using the P-CCPCH
timing and timing offset information notified from UTRAN. For DPCH, frame
synchronization can be confirmed using the frame synchronization word.
Downlink synchronization status is reported to higher layers every radio frame
according to subclause 4.3.1.2.
d) If higher layers indicate the usage of a post-verification period for the
primary uplink frequency the UE shall start transmission on the primary uplink
frequency immediately when the physical dedicated channel establishment is
initiated by the UE. Post-verification period is always used for the secondary
uplink frequency.
> If higher layers do not indicate the usage of a post-verification period for
> the primary uplink frequency, or if higher layers do indicate the usage of a
> post-verification period (as specified in 5.1.2.2.1.1) and the post-
> verification has failed, the UE shall not transmit on the activated uplink
> frequency until higher layers consider the downlink physical channel
> established;
  * If no activation time for uplink DPCCH has been signalled to the UE or if the UE attempts to re-establish the DPCH after an inter-RAT, intra- or inter-frequency hard-handover failure [5], uplink DPCCH transmission shall start on the activated uplink frequency when higher layers consider the downlink physical channel established;
  * If an activation time has been given, uplink DPCCH transmission shall not start on the activated uplink frequency before the downlink physical channel has been established and the activation time has been reached. Physical channel establishment and activation time are defined in [5].
> The initial uplink DPCCH transmit power is set by higher layers [5]. In case
> the synchronization procedure A is executed because the UE receives an HS-
> SCCH order to activate the secondary uplink frequency, then the initial
> DPCCH transmit power on the secondary uplink frequency is computed (in dB)
> as
>
> Uplink DPCCH transmit power = P~DPCCH,1~ -- UE_Sec_Tx_Power_Backoff
>
> where P~DPCCH,1~ is the DPCCH transmit power on the primary uplink frequency
> at the start of the transmission on the secondary uplink frequency and
> UE_Sec_Tx_Power_Backoff is set by higher layers.
>
> In case the UE attempts to re-establish the DPCH after an inter-RAT, intra-
> or inter-frequency hard-handover failure [5] the initial uplink DPCCH power
> shall be the same as the one used immediately preceding the inter-RAT,
> intra- or inter-frequency hard-handover attempt. In case of physical layer
> reconfiguration the uplink DPCCH power is kept unchanged between before and
> after the reconfiguration except for inner loop power control adjustments.
>
> A power control preamble shall be applied on the activated uplink frequency
> as indicated by higher layers. The transmission of the uplink DPCCH power
> control preamble shall start N~pcp~ radio frames prior to the radio frame
> where the uplink DPDCH/E-DPCCH/E-DPDCH transmission starts, where N~pcp~ is
> a higher layer parameter set by UTRAN [5]; in case the UE attempts to re-
> establish the DPCH after an inter-RAT, intra- or inter-frequency hard-
> handover failure [5] the UE shall use the value of N~pcp~ as specified in
> [5] for this case. Note that the transmission start delay between DPCCH and
> DPDCH/E-DPCCH/E-DPDCH may be cancelled using a power control preamble of 0
> length. If higher layers indicate the usage of a post-verification period,
> and the start of the uplink DPCCH power control preamble with a length of
> N~pcp~ radio frames would be in a radio frame later than the first uplink
> radio frame after physical dedicated channel establishment is initiated by
> the UE, then the duration of the uplink DPCCH power control preamble shall
> be equal to or longer than N~pcp~ radio frames such that the uplink DPCCH
> power control preamble is transmitted from the first uplink radio frame
> after physical dedicated channel establishment is initiated by the UE.
>
> The starting time for transmission of DPDCHs/E-DPCCH/E-DPDCHs shall also
> satisfy the constraints on adding transport channels to a CCTrCH, as defined
> in [2] subclause 4.2.14, independently of whether there are any bits mapped
> to the DPDCHs/E-DPCCH/E-DPDCHs. During the uplink DPCCH power control
> preamble, independently of the selected TFC, no transmission is done on the
> DPDCH/E-DPCCH/E-DPDCH.
e) UTRAN establishes uplink chip and frame synchronization on the activated
uplink frequency. Frame synchronization can be confirmed using the frame
synchronization word. Radio link sets remain in the initial state until
N_INSYNC_IND successive in-sync indications are received from layer 1, when
Node B shall trigger the RL Restore procedure indicating which radio link set
has obtained synchronization. When RL Restore has been triggered the radio
link set shall be considered to be in the in-sync state. The parameter value
of N_INSYNC_IND is configurable, see [6]. The RL Restore procedure may be
triggered several times, indicating when synchronization is obtained for
different radio link sets.
Note: The total signalling response delay for the establishment of a new DPCH
shall not exceed the requirements given in [5] subclause 13.5.
#### 4.3.2.3A Synchronization procedure AA {#a-synchronization-procedure-aa
.list-paragraph}
The synchronization establishment procedure, which begins at the time defined
in [1] for the Enhanced Uplink in CELL_FACH state and IDLE mode, is as
follows:
a) The Node B involved in the procedure sets the radio link which is to be
set-up for this UE in the initial state.
b) UTRAN shall start the transmission of the downlink F-DPCH at the time
defined for the Enhanced Uplink in CELL_FACH state and IDLE mode in [1].
c) The UE establishes downlink chip and frame synchronization of F-DPCH, using
the P-CCPCH timing and timing offset information notified from UTRAN and based
on the timing definition for the Enhanced Uplink in CELL_FACH state and IDLE
mode as defined in [1]. Downlink synchronization status is reported to higher
layers every radio frame according to subclause 4.3.1.2.
d) The UE shall start transmission on uplink at the time defined for the
Enhanced Uplink in CELL_FACH state and IDLE mode in [1] and shall use a post-
verification period for confirming the establishment of the downlink physical
channel as follows: During the first 40 ms period of the first phase of the
downlink synchronization procedure the UE shall control its transmitter
according to a downlink F-DPCH quality criterion as follows:
> \- When the UE estimates the F-DPCH quality over the first 40 ms period of
> the first phase of the downlink synchronization status evaluation to be
> worse than a threshold Q~in~, the UE shall shut its transmitter off and
> consider post-verification failed. Q~in~ is defined implicitly by the
> relevant tests in [7].
>
> If the post-verification has failed, the UE shall not transmit on uplink and
> await higher layer orders.
e) UTRAN establishes uplink chip and frame synchronization. Frame
synchronization can be confirmed using the frame synchronization word.
#### 4.3.2.4 Synchronization procedure B
For each configured uplink frequency, the synchronization procedure B, which
begins at the time indicated by higher layers (either immediately at receipt
of upper layer signalling, or at an indicated activation time) is as follows:
a) The following applies to each Node B involved in the procedure:
\- New radio link sets are set up to be in initial state.
\- If one or several radio links are added to an existing radio link set, this
radio link set shall be considered to be in the state the radio link set was
prior to the addition of the radio link, i.e. if the radio link set was in the
in-sync state before the addition of the radio link it shall remain in that
state.
b) UTRAN starts the transmission of the downlink DPCCH/DPDCH or F-DPCH for
each new radio link corresponding to the activated uplink frequency at a frame
timing such that the frame timing received at the UE will be within T~0~ ± 148
chips prior to the frame timing of the uplink DPCCH/DPDCH at the UE.
Simultaneously, UTRAN establishes uplink chip and frame synchronization of
each new radio link. Frame synchronization can be confirmed using the frame
synchronization word. Radio link sets considered to be in the initial state
shall remain in the initial state until N_INSYNC_IND successive in-sync
indications are received from layer 1, when Node B shall trigger the RL
Restore procedure indicating which radio link set has obtained
synchronization. When RL Restore is triggered the radio link set shall be
considered to be in the in-sync state. The parameter value of N_INSYNC_IND is
configurable, see [6]. The RL Restore procedure may be triggered several
times, indicating when synchronization is obtained for different radio link
sets.
c) The UE establishes chip and frame synchronization of each new radio link.
Layer 1 in the UE keeps reporting downlink synchronization status to higher
layers every radio frame according to the second phase of subclause 4.3.1.2.
For DPCH, frame synchronization can be confirmed using the frame
synchronization word.
### 4.3.3 Radio link monitoring
#### 4.3.3.1 Downlink radio link failure
The downlink radio links shall be monitored by the UE, to trigger radio link
failure procedures. The downlink radio link failure criteria is specified in
[5], and is based on the synchronization status primitives CPHY-Sync-IND and
CPHY-Out-of-Sync-IND, indicating in-sync and out-of-sync respectively.
#### 4.3.3.2 Uplink radio link failure/restore in CELL_DCH state
The uplink radio link sets are monitored by the Node B, to trigger radio link
failure/restore procedures. Once the radio link sets have been established,
they will be in the in-sync or out-of-sync states as shown in figure 1 in
subclause 4.3.2.1. Transitions between those two states are described below.
The uplink radio link failure/restore criteria is based on the synchronization
status primitives CPHY-Sync-IND and CPHY-Out-of-Sync-IND, indicating in-sync
and out-of-sync respectively. Note that only one synchronization status
indication shall be given per radio link set.
When the radio link set is in the in-sync state, Node B shall start timer
T_RLFAILURE after receiving N_OUTSYNC_IND consecutive out-of-sync indications.
Node B shall stop and reset timer T_RLFAILURE upon receiving successive
N_INSYNC_IND in-sync indications. If T_RLFAILURE expires, Node B shall trigger
the RL Failure procedure and indicate which radio link set is out-of-sync.
When the RL Failure procedure is triggered, the state of the radio link set
change to the out-of-sync state.
When the radio link set is in the out-of-sync state, after receiving
N_INSYNC_IND successive in-sync indications Node B shall trigger the RL
Restore procedure and indicate which radio link set has re-established
synchronization. When the RL Restore procedure is triggered, the state of the
radio link set change to the in-sync state.
The specific parameter settings (values of T_RLFAILURE, N_OUTSYNC_IND, and
N_INSYNC_IND) are configurable, see [6].
#### 4.3.3.2A Uplink radio link failure/restore in CELL_FACH state and IDLE
mode {#a-uplink-radio-link-failurerestore-in-cell_fach-state-and-idle-mode
.list-paragraph}
The uplink radio link failure/restore is under the control of the Node B.
### 4.3.4 Transmission timing adjustments
During a connection the UE may adjust its DPDCH/DPCCH transmission time
instant.
When the UE autonomously adjusts its DPDCH/DPCCH transmission time instant, it
shall simultaneously adjust the HS-DPCCH, E-DPCCH, E-DPDCH, S-DPCCH, S-E-DPCCH
and S-E-DPDCH transmission time instant by the same amount so that the
relative timing between DPCCH/DPDCH and HS-DPCCH is kept constant and that
DPCCH/DPDCH and E-DPCCH/E-DPDCH and S-DPCCH and S-E-DPCCH/S-E-DPDCH remain
time aligned.
If the receive timing for any downlink DPCCH/DPDCH or F-DPCH in the current
active set has drifted, so the time between reception of the downlink
DPCCH/DPDCH in question and transmission of uplink DPCCH/DPDCH lies outside
the valid range, L1 shall inform higher layers of this, so that the network
can be informed of this and downlink timing can be adjusted by the network.
The maximum rate of uplink TX time adjustment, and the valid range for the
time between downlink DPCCH/DPDCH or F-DPCH reception and uplink DPCCH/DPDCH
transmission in the UE are defined by the requirements specified in [8].
When the UE's time reference cell for HSDPA Multiflow is changed, the UE shall
adjust its HS-DPCCH transmission timing to comply with the definitions in [1].
# 5 Power control
## 5.1 Uplink power control
### 5.1.1 PRACH
#### 5.1.1.1 General
The power control during the physical random access procedure is described in
clause 6. The setting of power of the message control and data parts is
described in the next subclause.
#### 5.1.1.2 Setting of PRACH control and data part power difference
The message part of the uplink PRACH channel shall employ gain factors to
control the control/data part relative power similar to the uplink dedicated
physical channels. Hence, subclause 5.1.2.5 applies also for the RACH message
part, with the differences that:
\- _β~c~_ is the gain factor for the control part (similar to DPCCH);
\- _β~d~_ is the gain factor for the data part (similar to DPDCH);
\- no inner loop power control is performed.
### 5.1.2 DPCCH/DPDCH
#### 5.1.2.1 General
The initial uplink DPCCH transmit power is set by higher layers. Subsequently
the uplink transmit power control procedure simultaneously and independently
controls the power of a DPCCH on each activated uplink frequency and its
corresponding DPDCHs (if present). The relative transmit power offset between
DPCCH and DPDCHs is determined by the network and is computed according to
subclause 5.1.2.5 using the gain factors signalled to the UE using higher
layer signalling.
The operation of the inner power control loop, described in sub clause
5.1.2.2, adjusts the power of the DPCCH and DPDCHs by the same amount,
provided there are no changes in gain factors. Additional adjustments to the
power of the DPCCH associated with the use of compressed mode are described in
sub clause 5.1.2.3.
Any change in the uplink DPCCH transmit power shall take place immediately
before the start of the pilot field on the DPCCH. The change in DPCCH power
with respect to its previous value is derived by the UE and is denoted by
∆~DPCCH~ (in dB). The previous value of DPCCH power shall be that used in the
previous slot, except in the event of an interruption in transmission due to
the use of compressed mode or discontinuous uplink DPCCH transmission
operation, when the previous value shall be that used in the last slot before
the transmission gap.
During the operation of the uplink power control procedure the UE transmit
power shall not exceed a maximum allowed value which is the lower out of the
maximum output power of the terminal power class and a value which may be set
by higher layer signalling.
Uplink power control shall be performed while the UE transmit power is below
the maximum allowed output power.
The provisions for power control at the maximum allowed value and below the
required minimum output power (as defined in [7]) are described in subclause
5.1.2.6.
#### 5.1.2.2 Ordinary transmit power control
##### 5.1.2.2.1 General
For each activated uplink frequency, the uplink inner-loop power control
adjusts the UE transmit power in order to keep the received uplink
signal‑to‑interference ratio (SIR) on that frequency at a given SIR target,
SIR~target~.
The cells in the active set should estimate signal-to-interference ratio
SIR~est~ of the received uplink DPCH. The cells in the active set should then
generate TPC commands and transmit the commands once per slot according to the
following rule: if SIR~est~ > SIR~target~ then the TPC command to transmit is
\"0\", while if SIR~est~ \ 0\text{.}5$.
  * Otherwise, TPC_cmd is set to 0.
#### 5.1.2.3 Transmit power control in compressed mode
NOTE: "Transmission gaps" correspond to transmission gaps created as a result
of compressed mode. Another type of transmission gap may exist if DPCCH
discontinuous transmission is applied (as described in clause 6C), however
these gaps are named "uplink DPCCH transmission gaps".
In compressed mode, one or more transmission gap pattern sequences are active.
Therefore some frames are compressed and contain transmission gaps. The uplink
power control procedure is as specified in subclause 5.1.2.2, using the same
UTRAN supplied parameters for Power Control Algorithm and step size (∆~TPC~),
but with additional features which aim to recover as rapidly as possible a
signal-to-interference ratio (SIR) close to the target SIR after each
transmission gap.
The cells in the active set should estimate signal-to-interference ratio
SIR~est~ of the received uplink DPCH. The cells in the active set should then
generate TPC commands and transmit the commands once per slot, except during
downlink transmission gaps, according to the following rule: if SIR~est~ >
SIR~cm_target~ then the TPC command to transmit is \"0\", while if SIR~est~ \ If DPCH is configured in the downlink then TPC_cmd~gap~ shall be the value
> of TPC_cmd derived in the first slot of the uplink transmission gap, if a
> downlink TPC_command is transmitted in that slot. Otherwise TPC_cmd~gap~
> shall be zero if no downlink TPC_command is transmitted in that slot.
>
> If F-DPCH is configured in the downlink then TPC_cmd~gap~ shall be equal to
> the sum of the values of TPC_cmd derived from each TPC command combining
> period in which a TPC command is known to be present and is not ignored as
> described below and which cannot be applied before the uplink transmission
> gap. The UE shall ignore any TPC commands received in an F-DPCH slot
> starting during an uplink DPCCH slot which is in an uplink transmission gap.
> In case there are no TPC commands to be summed TPC_cmd~gap~ shall be zero.
δ ~last~ shall be equal to the most recently computed value of δ~i~. δ~i~
shall be updated according to the following recursive relations, which shall
be executed in all slots in which both the uplink DPCCH and a downlink TPC
command are transmitted, and in the first slot of an uplink transmission gap
if a downlink TPC command is transmitted in that slot:
$\begin{matrix} \delta_{i} = 0\text{.}\text{9375}\delta_{i - 1} -
0\text{.}\text{96875}\text{TPC}_{\text{cmd}_{i}}\Delta_{\text{TPC}}k_{\text{sc}}
\ \delta_{i - 1} = \delta_{i} \ \end{matrix}$
where: TPC_cmd~i~ is the power control command derived by the UE in that slot;
> _k~sc~_ = 0 if additional scaling is applied in the current slot and the
> previous slot as described in subclause 5.1.2.6, and _k~sc~_ = 1 otherwise.
δ~i-1~ is the value of δ~i~ computed for the previous slot. The value of
δ~i-1~ shall be initialised to zero when the uplink DPCCH is activated, and
also at the end of the first slot after each uplink transmission gap, and also
at the end of the first slot after each downlink transmission gap. The value
of δ~i~ shall be set to zero at the end of the first slot after each uplink
transmission gap.
After a transmission gap in either the uplink or the downlink, the period
following resumption of simultaneous uplink and downlink DPCCH or F-DPCH
transmission is called a recovery period. RPL is the recovery period length
and is expressed as a number of slots. RPL is equal to the minimum value out
of the transmission gap length and 7 slots. If a transmission gap or an Uplink
DPCCH burst pattern gap as defined in subclause 6C.2 is scheduled to start
before RPL slots have elapsed, then the recovery period shall end at the start
of the gap, and the value of RPL shall be reduced accordingly.
During the recovery period, 2 modes are possible for the power control
algorithm. The Recovery Period Power control mode (RPP) is signalled with the
other compressed mode parameters (see [4]). The different modes are summarised
in the table 2:
Table 2: Recovery Period Power control modes during compressed mode
* * *
Recovery Period power control mode Description 0 Transmit power control is
applied using the algorithm determined by the value of PCA, as in subclause
5.1.2.2 with step size ∆~TPC.~ 1 Transmit power control is applied using
algorithm 1 (see subclause 5.1.2.2.2) with step size ∆~RP-TPC~ during RPL
slots after each transmission gap.
* * *
If UE_DTX_DRX_Enabled is TRUE, the UE shall behave as if the RPP mode is 0.
For RPP mode 0, the step size is not changed during the recovery period and
ordinary transmit power control is applied (see subclause 5.1.2.2), using the
algorithm for processing TPC commands determined by the value of PCA (see sub
clauses 5.1.2.2.2 and 5.1.2.2.3).
For RPP mode 1, during RPL slots after each transmission gap, power control
algorithm 1 is applied with a step size ∆~RP-TPC~ instead of ∆~TPC~,
regardless of the value of PCA. Therefore, the change in uplink DPCCH transmit
power at the start of each of the RPL+1 slots immediately following the
transmission gap (except for the first slot after the transmission gap) is
given by:
∆~DPCCH~ = ∆~RP-TPC~ × TPC_cmd + $\Delta$~PILOT~
∆~RP-TPC~ is called the recovery power control step size and is expressed in
dB. If PCA has the value 1, ∆~RP-TPC~ is equal to the minimum value of 3 dB
and 2∆~TPC~. If PCA has the value 2 , ∆~RP-TPC~ is equal to 1 dB.
After the recovery period, ordinary transmit power control resumes using the
algorithm specified by the value of PCA and with step size ∆~TPC~.
If PCA has the value 2 , the sets of slots over which the TPC commands are
processed shall remain aligned to the frame boundaries in the compressed
frame. For both RPP mode 0 and RPP mode 1, if the transmission gap or the
recovery period results in any incomplete sets of TPC commands, TPC_cmd shall
be zero for those sets of slots which are incomplete.
#### 5.1.2.4 Transmit power control in the uplink DPCCH power control preamble
An uplink DPCCH power control preamble is a period of uplink DPCCH
transmission prior to the start of the uplink DPDCH transmission. The downlink
DPCCH or F-DPCH shall also be transmitted during an uplink DPCCH power control
preamble.
The length of the uplink DPCCH power control preamble is a higher layer
parameter signalled by the network as defined in [5]. The uplink DPDCH
transmission shall commence after the end of the uplink DPCCH power control
preamble.
During the uplink DPCCH power control preamble the change in uplink DPCCH
transmit power shall be given by:
∆~DPCCH~ = ∆~TPC~ × TPC_cmd.
During the uplink DPCCH power control preamble TPC_cmd is derived according to
algorithm 1 as described in sub clause 5.1.2.2.1, regardless of the value of
PCA.
Ordinary power control (see subclause 5.1.2.2), with the power control
algorithm determined by the value of PCA and step size ∆~TPC,~ shall be used
after the end of the uplink DPCCH power control preamble.
#### 5.1.2.5 Setting of the uplink DPCCH/DPDCH relative powers
##### 5.1.2.5.1 General
The uplink DPCCH and DPDCH(s) are transmitted on different codes as defined in
subclause 4.2.1 of [3]. In the case that at least one DPDCH is configured, the
gain factors β~c~ and β~d~ may vary for each TFC. There are two ways of
controlling the gain factors of the DPCCH code and the DPDCH codes for
different TFCs in normal (non-compressed) frames:
− _β~c~_ and _β~d~_ are signalled for the TFC, or
− _β~c~_ and _β~d~_ is computed for the TFC, based on the signalled settings
for a reference TFC.
Combinations of the two above methods may be used to associate _β~c~_ and
_β~d~_ values to all TFCs in the TFCS. The two methods are described in
subclauses 5.1.2.5.2 and 5.1.2.5.3 respectively. Several reference TFCs may be
signalled from higher layers.
The gain factors may vary on radio frame basis depending on the current TFC
used. Further, the setting of gain factors is independent of the inner loop
power control.
After applying the gain factors, the UE shall scale the total transmit power
of the DPCCH and DPDCH(s), such that the DPCCH output power follows the
changes required by the power control procedure with power adjustments of
∆~DPCCH~ dB, subject to the provisions of subclause 5.1.2.6.
The gain factors during compressed frames are based on the nominal power
relation defined in normal frames, as specified in subclause 5.1.2.5.4.
##### 5.1.2.5.2 Signalled gain factors
When the gain factors _β~c~_ and _β~d~_ are signalled by higher layers for a
certain TFC, the signalled values are used directly for weighting of DPCCH and
DPDCH(s). The variable _A~j~_ , called the nominal power relation is then
computed as:
$A_{j} = \frac{\beta_{d}}{\beta_{c}}$.
##### 5.1.2.5.3 Computed gain factors
The gain factors  _β~c~_ and _β~d~_ may also be computed for certain TFCs,
based on the signalled settings for a reference TFC.
Let _β~c,ref~_ and _β~d,ref~_ denote the signalled gain factors for the
reference TFC. Further, let _β~c,j~_ and _β~d,j~_ denote the gain factors used
for the _j_ :th TFC. Also let _L~ref~_ denote the number of DPDCHs used for
the reference TFC and _L~,j~_ denote the number of DPDCHs used for the _j_ :th
TFC.
[Define the variable]{.underline}
$K_{\text{ref}} = \sum_{i}^{}{\text{RM}_{i} \cdot N_{i}}$;
where _RM_ ~i~ is the semi-static rate matching attribute for transport
channel _i_ (defined in [2] subclause 4.2.7), _N~i~_ is the number of bits
output from the radio frame segmentation block for transport channel _i_
(defined in [2] subclause 4.2.6.1), and the sum is taken over all the
transport channels _i_ in the reference TFC.
[Similarly, define the variable]{.underline}
$K_{j} = \sum_{i}^{}{\text{RM}_{i} \cdot N_{i}}$;
where the sum is taken over all the transport channels _i_ in the _j_ :th TFC.
The variable _A~j~_ , called the nominal power relation is then computed as:
$A_{j} = \frac{\beta_{d,\text{ref}}}{\beta_{c,\text{ref}}} \cdot
\sqrt{\frac{L_{\text{ref}}}{L_{j}}}\sqrt{\frac{K_{j}}{K_{\text{ref}}}}$.
The gain factors for the _j_ :th TFC are then computed as follows:
\- If _A~j~_ > 1, then $\beta_{d,j} = 1\text{.}0$ and$\beta_{c,j}$ is the
largest quantized$\beta$-value, for which the condition $\beta_{c,j}$≤ 1 /
_A~j~_ holds. Since $\beta_{c,j}$ may not be set to zero, if the above
rounding results in a zero value, $\beta_{c,j}$ shall be set to the lowest
quantized amplitude ratio of 1/15 as specified in [3].
\- If _A~j~_ ≤ 1, then $\beta_{d,j}$ is the smallest quantized$\beta$-value,
for which the condition $\beta_{d,j}$≥ _A~j~_ holds and $\beta_{c,j} =
1\text{.}0$.
The quantized β-values are defined in [3] subclause 4.2.1, table 1.
##### 5.1.2.5.4 Setting of the uplink DPCCH/DPDCH relative powers in
compressed mode
The gain factors used during a compressed frame for a certain TFC are
calculated from the nominal power relation used in normal (non-compressed)
frames for that TFC. Let _A~j~_ denote the nominal power relation for the _j_
:th TFC in a normal frame. Further, let _β~c,C,j~_ and _β~d,C,j~_ denote the
gain factors used for the _j_ :th TFC when the frame is compressed. The
variable _A~C,j~_ is computed as:
$A_{C,j} = A_{j} \cdot \sqrt{\frac{\text{15} \cdot
N_{\text{pilot},C}}{N_{\text{slots},C} \cdot N_{\text{pilot},N}}}$;
where _N~pilot,C~_ is the number of pilot bits per slot when in compressed
mode, and _N~pilot,N~_ is the number of pilot bits per slot in normal mode.
_N~slots,C~_ is the number of slots in the compressed frame used for
transmitting the data.
The gain factors for the _j_ :th TFC in a compressed frame are computed as
follows:
If _A~C,j~_ > 1, then $\beta_{d,C,j} = 1\text{.}0$ and $\beta_{c,C,j}$ is the
largest quantized$\beta$-value, for which the condition $\beta_{c,C,j}$≤ 1 /
_A~C,j~_ holds. Since $\beta_{c,C,j}$ may not be set to zero, if the above
rounding results in a zero value, $\beta_{c,C,j}$ shall be set to the lowest
quantized amplitude ratio of 1/15 as specified in [3].
If _A~C,j~_ ≤ 1, then $\beta_{d,C,j}$ is the smallest quantized$\beta$-value,
for which the condition $\beta_{d,C,j}$≥ _A~C,j~_ holds and $\beta_{c,C,j} =
1\text{.}0$.
The quantized β-values are defined in [3] subclause 4.2.1, table 1.
#### 5.1.2.5A Setting of the uplink HS-DPCCH power relative to DPCCH power
When one or two HS-DPCCH are active, the values for ∆~ACK~, ∆~NACK~ and ∆~CQI~
set by higher layers are translated to the quantized amplitude ratios _A~hs~_
as specified in [3] subclause 4.2.1.2, and shall be set for each HS-DPCCH slot
as follows.
When only one activated cell's HARQ-ACK information is mapped to a HS-DPCCH,
for each HS-DPCCH and each slot carrying HARQ Acknowledgement, the HS-DPCCH
power settings are described in Table 2a. When more than one activated cell
whose HARQ-ACK information are mapped to a specific HS-DPCCH, the HS-DPCCH
power settings are described in Table 2b. When the UE is configured in
Multiflow mode, the HARQ-ACK slot power settings of the HS-DPCCH are described
in table 2b.1.
Table 2a: HARQ-ACK power offset setting when Secondary_Cell_Active is 0 or
when Secondary_Cell_Enabled is more than 3 in case UE is not configured in
MIMO mode with four transmit antennas in any cell, is more than 1 in case the
UE is configured in MIMO mode with four transmit antennas in at least one cell
and only HARQ-ACK information of one active downlink cell is mapped to either
HS-DPCCH or HS-DPCCH~2~
* * *
**HARQ-ACK message sent in one time slot** **A~hs~ equals the quantized
amplitude ratio translated from** ACK Δ~ACK~ NACK Δ~NACK~ PRE before single
transport block or POST after a single transport block MAX( Δ~ACK~ , Δ~NACK~)
ACK/ACK Δ~ACK~ +1 NACK/NACK Δ~NACK~ +1 ACK/NACK or NACK/ACK or PRE before a
dual transport block or POST after a dual transport block MAX( Δ~ACK~ +1,
Δ~NACK~ +1)
* * *
Table 2b: HARQ-ACK power offset setting when the HARQ-ACK information of more
than one active downlink cell is mapped to either HS-DPCCH or HS-DPCCH~2~
* * *
**Number of active cells mapped to the HS-DPCCH or HS-DPCCH~2~** **Condition**
**A~hs~ equals the quantized amplitude ratio translated from**  
**Composite HARQ-ACK message(s) sent in one time slot**  
**contains at least one ACK but no NACK** **contains at least one NACK but no
ACK** **contains both ACK and NACK or is a PRE or is a POST** 2 **MIMO mode
with four transmit antennas is not configured in any cell** **Δ~ACK~ +1**
**Δ~NACK~ +1** **MAX( Δ~ACK~ +1, Δ~NACK~ +1)** 2 **MIMO mode with four
transmit antennas is configured in at least one cell** **Δ~ACK~ +2** **Δ~NACK~
+2** **MAX( Δ~ACK~ +2, Δ~NACK~ +2)** 3 Secondary_Cell_Enabled is 2 and MIMO or
MIMO mode with four transmit antennas is not configured in any cell **Δ~ACK~
+1** **Δ~NACK~ +1** **MAX( Δ~ACK~ +1, Δ~NACK~ +1)** 3 **Otherwise** **Δ~ACK~
+2** **Δ~NACK~ +2** **MAX( Δ~ACK~ +2, Δ~NACK~ +2)** 4 **Δ~ACK~ +2** **Δ~NACK~
+2** **MAX( Δ~ACK~ +2, Δ~NACK~ +2)**
* * *
Table 2b.1: HARQ-ACK power offset setting when the UE is configured in
Multiflow mode
* * *
**Number of cells configured to the UE\** Condition**** A~hs~ equals the
quantized amplitude ratio translated from**  
(Note 1)**
                                                                                       **Composite HARQ-ACK message(s) sent in one time slot**
                                                                                       **contains at least one ACK but no NACK**                        **contains at least one NACK but no ACK**   **contains both ACK and NACK or is a PRE or is a POST**
2 **Δ~ACK~ +1** **Δ~NACK~ +1** **MAX( Δ~ACK~ +1, Δ~NACK~ +1)**
3 **MIMO not configured in any cell** **Δ~ACK~ +1** **Δ~NACK~ +1** **MAX(
Δ~ACK~ +1, Δ~NACK~ +1)**
3 **MIMO configured in at least one cell** **Δ~ACK~ +2** **Δ~NACK~ +2** **MAX(
Δ~ACK~ +2, Δ~NACK~ +2)**
4 **Δ~ACK~ +2** **Δ~NACK~ +2** **MAX( Δ~ACK~ +2, Δ~NACK~ +2)**
* * *
Note 1: When the UE is configured in the Multiflow mode, the cell deactivation
with HS-SCCH orders do not impact the HARQ-ACK power offset used.
For each HS-DPCCH and each slot carrying CQI, the HS-DPCCH power setting is
described in Tables 2c and 2d:
Table 2c: CQI power offset setting when the UE is not in Multiflow mode
* * *
                                                                 **Condition**                                                                                               **A~hs~ equals the quantized amplitude ratio translated from**
**Number of active cells mapped to HS-DPCCH or HS-DPCCH~2~** **MIMO or MIMO
with four transmit antennas is not configured in a cell** **MIMO or MIMO with
four transmit antennas is configured in a cell**  
**CQI of Type A** **CQI of Type B** 1 **-** **Δ~CQI~** **Δ~CQI~ +1** **Δ~CQI\
~** 2 Secondary_Cell_Enabled is 1, and MIMO or MIMO with four transmit
antennas is not configured in any cell **Δ~CQI~ +1** N/A N/A 2 Otherwise
**Δ~CQI~** **Δ~CQI~ +1** **Δ~CQI\ ~** 3 (Note 1) Secondary_Cell_Enabled is 2
and MIMO is not configured in any cell **Δ~CQI~** **N/A** **N/A** 3 (Note 2)
**Δ~CQI~ +1** **N/A** **N/A** 3 **Otherwise** **Δ~CQI~ +1** **Δ~CQI~ +2**
**Δ~CQI~ +1** 4 **Δ~CQI~ +1** **Δ~CQI~ +2** **Δ~CQI~ +1**
* * *
Note 1: When the UE transmits a CQI report for the serving HS-DSCH cell in a
subframe
Note 2: When the UE transmits a composite CQI report for 1^st^ and 2^nd^
secondary serving HS-DSCH cells in a subframe.
Table 2d: CQI power offset setting when the UE is in Multiflow mode
* * *
                                            **MIMO configured in at least one cell**   **A~hs~ equals the quantized amplitude ratio translated from**
**Number of cells configured to the UE\** MIMO is not configured in a cell****
MIMO is configured in a cell**  
(Note 1)**
                                                                                                                                                        **CQI of Type A**                  **CQI of Type B**
2 **No** **Δ~CQI~ +1** N/A
2 Yes **Δ~CQI~** **Δ~CQI~ +1** **Δ~CQI\ ~**
3 (Note 2) **No** **Δ~CQI~** **N/A**
3 (Note 3) **Δ~CQI~ +1**
3 **Yes** **Δ~CQI~ +1** **Δ~CQI~ +2** **Δ~CQI~ +1**
4 **No** **Δ~CQI~ +1** **N/A**
4 **Yes** **Δ~CQI~ +1** **Δ~CQI~ +2** **Δ~CQI~ +1**
* * *
Note 1: When the UE is configured in the Multiflow mode, the cell activations
and deactivations with HS-SCCH orders do not impact the CQI power offsets
used.
Note 2: When the UE transmits a CQI report for the cell group consisting of
one cell only
Note 3: When the UE transmits a composite CQI report of the cell group
consisting of two cells, or a CQI report of the remaining active cell if the
secondary cell of this cell group was deactivated by a HS-SCCH order.
Then, in non-compressed frames _β~hs~_ , which is the gain factor defined in
[3] subclause 4.2.1.2, is calculated according to
$\beta_{\text{hs}} = \beta_{c} \cdot A_{\text{hs}}$,
where _β~c\ ~_ value is signalled by higher-layer or calculated as described
in subclause 5.1.2.5.2 or 5.1.2.5.3 if at least one DPDCH is configured. In
case no DPDCH is configured, _β~c\ ~_ value is set as described in subclause
5.1.2.5C.
With the exception of the start and end of compressed frames, any DPCCH power
change shall not modify the power ratio between the DPCCH and the HS-DPCCH.
The power ratio between the DPCCH and the HS-DPCCH during compressed DPCCH
frames is described below.
During the period between the start and end of a compressed DPCCH frame, when
HS-DPCCH is transmitted, _β~hs~_ is calculated according to
$\beta_{\text{hs}} = \beta_{c,C,j} \cdot A_{\text{hs}} \cdot
\sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}$,
where $\beta_{c,C,j}$ is calculated as described in subclause 5.1.2.5.4 if at
least one DPDCH is configured. In case no DPDCH is configured, _β~c,C,j\ ~_
value is set as described in subclause 5.1.2.5C. _N~pilot,C~_ is the number of
pilot bits per slot on the DPCCH in compressed frames, and _N~pilot,N~_ is the
number of pilot bits per slot in non-compressed frames.
Thus the gain factor _β~hs~_ varies depending on the current quantized
amplitude ratio A~hs~ and on whether the UL DPCCH is currently in a compressed
frame.
#### 5.1.2.5B Setting of the uplink E-DPCCH and E-DPDCH powers relative to
DPCCH power
##### 5.1.2.5B.1 E-DPCCH/DPCCH when one transport block is transmitted on
E-DCH
The E-DPCCH gain factor computation depends on the transmitted E-TFC at a
given TTI.
In non compressed frames, if E-TFCI _~i~_ is smaller than or equal to _E-
TFCI~ec,boost~_ , where _E-TFCI~i~_ denotes the E-TFCI of the _i_ :th E-TFC,
the E-DPCCH gain factor, _β~ec~_ , which is defined in [3] subclause 4.2.1.3,
is calculated according to
where _β~c~_ value is signalled by higher-layers or calculated as described in
subclause 5.1.2.5.2 or 5.1.2.5.3 if at least one DPDCH is configured. In case
no DPDCH is configured, _β~c\ ~_ value is set as described in subclause
5.1.2.5C. _A~ec~_ is defined in [3] subclause 4.2.1.3. The _E-TFCI~ec,boost\
~_ value is signalled by higher layers.
In non compressed frames if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ ,
the unquantized E-DPCCH gain factor for the _i_ :th E-TFC, _β~ec,i,uq~_ ~,,~
is calculated according to
where ∆ _~T2TP~_ is signalled by higher layers and is defined in [3] subclause
4.2.1.3,$\beta_{\text{ed},i,k}$ is the E-DPDCH gain factor for the _i_ :th
E-TFC on the _k_ :th physical channel and _k~max,i~_ is the number of physical
channels used for the _i_ :th E-TFC.
If _β~ec,i,uq~_ is less than the smallest quantized value of Table 1B.0A in
[3] subclause 4.2.1.3, then the E-DPCCH gain factor of _E-TFCI~i~_ , _β~ec,i\
~_ is set such that _β~ec,i~_ /_β~c~_ is the smallest quantized value of Table
1B.0A in [3] subclause 4.2.1.3. Otherwise, _β~ec,i~_ is selected from Table
1B.0A in [3] subclause 4.2.1.3, such that 20*log10(_β~ec,i~_ /_β~c~_) is the
nearest quantized value to 20*log10(_β~ec,i,uq~_ /_β~c~_).
During compressed frames where the E-DCH TTI is 2msec, the E-DPCCH gain
factor, _β~ec~_ , which is defined in [3] subclause 4.2.1.3, is calculated
according to:
> $\beta_{\text{ec}} = \beta_{c,C,j} \cdot A_{\text{ec}} \cdot
> \sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}$ if _E-TFCI~i~_ is
> smaller than or equal to _E-TFCI~ec,boost.~_
_and according to_
$\beta_{\text{ec},i,\text{uq}} = \beta_{c,C,j} \cdot \sqrt{\text{max}\left(
A_{\text{ec}}^{2},\frac{\sum_{k = 1}^{k_{\text{max,}i}}\left(
\frac{\beta_{\text{ed},i,k}}{\beta_{c}}
\right)^{2}}{\text{10}^{\frac{{}^{\Delta_{T2\text{TP}}}}{\text{10}}}} - 1
\right)} \cdot \sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}$ if _E-
TFCI~i~_ is greater than _E‑TFCI~ec,boost.~_
where $\beta_{c,C,j}$ is calculated as described in subclause 5.1.2.5.4 if at
least one DPDCH is configured. In case no DPDCH is configured, the
$\beta_{c,C,j}$ value is set as described in subclause 5.1.2.5C.
$\beta_{\text{ed},i,k}$ is the E-DPDCH gain factor for the _i_ :th E-TFC on
the _k_ :th physical channel in non-compressed frames. _N~pilot,C~_ is the
number of pilot bits per slot on the DPCCH in compressed frames, and
_N~pilot,N~_ is the number of pilot bits per slot in non-compressed frames.
_N~slots,C~_ is the number of non DTX slots in the compressed frame.
During compressed frames and where the E-DCH TTI is 10msec, the E-DPCCH gain
factor, _β~ec~_ , which is defined in [3] subclause 4.2.1.3, is calculated
according to:
> $\beta_{\text{ec}} = \beta_{c,C,j} \cdot A_{\text{ec}} \cdot
> \sqrt{\frac{\text{15} \cdot N_{\text{pilot},C}}{N_{\text{slots},C} \cdot
> N_{\text{pilot},N}}}$ if _E-TFCI~i~_ is smaller than or equal to
> _E‑TFCI~ec,boost~_
_and according to_
$\beta_{\text{ec},i,\text{uq}} = \beta_{c,C,j} \cdot \sqrt{\text{max}\left(
A_{\text{ec}}^{2},\frac{\sum_{k = 1}^{k_{\text{max,}i}}\left(
\frac{\beta_{\text{ed},i,k}}{\beta_{c}}
\right)^{2}}{\text{10}^{\frac{{}^{\Delta_{T2\text{TP}}}}{\text{10}}}} - 1
\right)} \cdot \sqrt{\frac{\text{15} \cdot
N_{\text{pilot},C}}{N_{\text{slots},C}N_{\text{pilot},N}}}$ if _E-TFCI~i~_ is
greater than _E‑TFCI~ec,boost~._
where, _N~slots,C~_ is the number of non DTX slots in the compressed frame.
##### 5.1.2.5B.1A E-DPCCH/DPCCH when two transport blocks are transmitted on
E-DCH (rank-2)
When UL_MIMO_Enabled is TRUE, and the UE is transmitting two transport blocks,
the E-DPCCH/DPCCH power ratio is calculated according to the definitions in
subclause 5.1.2.5B.1 assuming _E-TFCI~ec,boost~_ = -1.
##### 5.1.2.5B.2 E-DPDCH/DPCCH
##### 5.1.2.5B.2.1 General {#b.2.1-general .H6}
The E-DPDCH gain factor, _β~ed~_ , which is defined in [3] subclause 4.2.1.3,
may take a different value for each E-TFC and HARQ offset. The gain factors
for different E-TFCs and HARQ offsets are computed as described in subclause
5.1.2.5B.2.3 based on reference gain factor(s) _β~ed,ref~_ of E-TFC(s)
signalled as reference E-TFC(s). The _β~ed,ref~ are_ computed as described in
subclause 5.1.2.5B.2.2. At least one E-TFC of the set of E-TFCs configured by
the network shall be signalled as a reference E-TFC.
The gain factors may vary on radio frame basis or sub-frame basis depending on
the E-DCH TTI used. Further, the setting of gain factors is independent of the
inner loop power control.
##### 5.1.2.5B.2.2 Computation of reference gain factors {#b.2.2-computation-
of-reference-gain-factors .H6}
Let _E-TFCI~ref,m~_ denote the E-TFCI of the _m_ :th reference E-TFC, where
_m_ =1,2,...,_M_ and _M_ is the number of signalled reference E-TFCs and _E-
TFCI~ref,~_ ~1~ \ if _E-TFCI~i~_ ≥ _E-TFCI~ref,M~,_ the primary and secondary reference E-TFCs
> are the (_M_ -1):th and _M_ :th reference E-TFCs respectively.
>
> if _E-TFCI~i~_ \ E-TFCs are the 1^st^ and 2^nd^ reference E-TFCs respectively.
>
> if _E-TFCI~ref,~_ ~1~ ≤ _E-TFCI~i~_ \ secondary reference E-TFCs are the _m_ :th and (_m_ +1):th reference E-TFCs
> respectively, such that _E‑TFCI~ref,m~_ ≤ _E-TFCI~i~_ \ ~1~.
When E-DPDCH power extrapolation formula is configured, let _β~ed,ref~_ denote
the reference gain factor of the reference E-TFC. Let _L~e,ref~_ denote the
number of E-DPDCHs used for the reference E-TFC and _L~e,i~_ denote the number
of E-DPDCHs used for the _i_ :th E-TFC. If SF2 is used, _L~e,ref~_ and
_L~e,i~_ are the equivalent number of physical channels assuming SF4. Let
_K~e,ref~_ denote the transport block size of the reference E-TFC and _K~e,i~_
denote the transport block size of the _i_ :th E-TFC, where the mapping
between the E-TFCI and the E-DCH transport block size is defined in [9]. For
the _i_ :th E-TFC, the temporary variable _β~ed,i,harq~_ is then computed as:
where the HARQ offset ∆~harq~ is defined in [3] subclause 4.2.1.3.
When E-DPDCH power interpolation formula is configured, let _β~ed,ref,1~ and
β~ed,ref~_ ~,2~ denote the reference gain factors of the primary and secondary
reference E-TFCs respectively. Let _L~e,ref,1~_ and _L~e,ref~,~2~_ denote the
number of E-DPDCHs used for the primary and secondary reference E-TFCs
respectively. Let _L~e,i~_ denotes the number of E-DPDCHs used for the _i_ :th
E-TFC. If SF2 is used, _L~e,ref,1~_ , _L~e,ref,2~_ and _L~e,i~_ are the
equivalent number of physical channels assuming SF4. Let _K~e,ref,1~_ and
_K~e,ref~,~2~_ denote the transport block sizes of the primary and secondary
reference E-TFCs respectively. Let _K~e,i~_ denotes the transport block size
of the _i_ :th E-TFC, where the mapping between the E-TFCI and the E-DCH
transport block size is defined in [9]. For the _i_ :th E-TFC, the temporary
variable _β~ed,i,harq~_ is computed as:
$\beta_{\text{ed},i,\text{harq}} = \sqrt{\frac{L_{e,\text{ref},1}}{L_{e,i}}}
\cdot \sqrt{\left( \left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}\beta_{\text{ed},\text{ref},2}^{2}
- \beta_{\text{ed},\text{ref},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}}
\right)\left( K_{e,i} - K_{e,\text{ref},1} \right) +
\beta_{\text{ed},\text{ref},1}^{2} \right)} \cdot \text{10}^{\left(
\frac{\Delta\text{harq}}{\text{20}} \right)}$with the exception that
_β~ed,i,harq\ ~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}\beta_{\text{ed},\text{ref},2}^{2}
- \beta_{\text{ed},\text{ref},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}}
\right)\left( K_{e,i} - K_{e,\text{ref},1} \right) +
\beta_{\text{ed},\text{ref},1}^{2} \leq 0$.
For the _i_ :th E-TFC, the unquantized gain factor _β~ed,k,i,uq~_ for the _k_
:th E-DPDCH (denoted E‑DPDCH~k~ in [3] subclause 4.2.1.3) shall be set to
$\sqrt{2} \times \beta_{\text{ed},i,\text{harq}}$ if the spreading factor for
E-DPDCH~k~ is 2 and to $\beta_{\text{ed},i,\text{harq}}$ otherwise.
The following applies:
\- For E-TFCI smaller than or equal to _E-TFCI~ec,boost~_ ,
> \- If _β~ed,k,i,uq~_ /_β~c~_ is less than the smallest quantized value of
> Table 1B.2 in [3] subclause 4.2.1.3, then the gain factor of E-DPDCH~k~,
> _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the smallest quantized value
> of Table 1B.2 in [3] subclause 4.2.1.3.
>
> \- Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the largest
> quantized value of Table 1B.2 in [3] subclause 4.2.1.3, for which the
> condition _β~ed,k~_ ≤ _β~ed,k,i,uq~_ holds.
\- For E-TFCI greater than _E-TFCI~ec,boost~_ ,
> \- If _β~ed,k,i,uq~_ /_β~c~_ is less than the smallest quantized value of
> Table 1B.2B in [3] subclause 4.2.1.3, then the gain factor of E-DPDCH~k~,
> _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the smallest quantized value
> of Table 1B.2B in [3] subclause 4.2.1.3.
>
> \- Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the largest
> quantized value of Table 1B.2B in [3] subclause 4.2.1.3, for which the
> condition _β~ed,k~_ ≤ _β~ed,k,i,uq~_ holds.
##### 5.1.2.5B.2.4 E-DPDCH/DPCCH adjustments relating to compressed mode
{#b.2.4-e-dpdchdpcch-adjustments-relating-to-compressed-mode .H6}
The gain factor applied to E-DPDCH is adjusted as a result of compressed mode
operation in the following cases:
• E-DCH transmissions that overlap a compressed frame
• For 10msec E-DCH TTI case, retransmissions that do not themselves overlap a
compressed frame, but for which the corresponding initial transmission
overlapped a compressed frame.
The gain factors used during a compressed frame for a certain E-TFC are
calculated from the nominal power relation used in normal (non-compressed)
frames for that E-TFC. When the frame is compressed, the gain factor used for
the _i_ :th E-TFC is derived from _β~ed,C,i~_ as described below.
When the E-DCH TTI is 2msec, _β~ed,C,i~_ shall be calculated as follows:
If E-DPDCH power extrapolation formula is configured,
$\beta_{\text{ed},C,i} = \beta_{c,C,j} \cdot A_{\text{ed}} \cdot
\sqrt{\frac{L_{e,\text{ref}}}{L_{e,i}}} \cdot
\sqrt{\frac{K_{e,i}}{K_{e,\text{ref}}} \cdot \text{10}^{\left(
\frac{\Delta_{\text{harq}}}{\text{20}} \right)} \cdot
\sqrt{\frac{N_{\text{pilot},C}}{N_{\text{pilot},N}}}}$,
Else if E-DPDCH power interpolation formula is configured _~,~_
with the exception that _β~ed,C,i~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}A_{\text{ed},2}^{2} -
A_{\text{ed},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}} \right)\left(
K_{e,i} - K_{e,\text{ref},1} \right) + A_{\text{ed},1}^{2} \leq 0$
where $\beta_{c,C,j}$ is calculated for the _j_ :th TFC as described in
subclause 5.1.2.5.4 if at least one DPDCH is configured. In case no DPDCH is
configured, the $\beta_{c,C,j}$ value is set as described in subclause
5.1.2.5C. _A~ed~_  _, A~ed,1\ ~_ and _A~ed,2\ ~_ are as defined in [3]
subclause 4.2.1.3. _A~ed,1\ ~_ and _A~ed,2\ ~_ denote the quantized amplitude
ratios assigned to the primary and secondary reference E-TFCs respectively _._
_L~e,ref~, L~e,i~, K~e,ref~ , K~e,i~ ,L~,e,ref,1~ , L~e,ref,2~ , K~e,ref,1~
and K~e,ref,2~ are as defined in subclause 5.1.2.5B.2.3,_ ∆~harq~ is as
defined in [3] subclause 4.2.1.3, _N~pilot,C~_ is the number of pilot bits per
slot on the DPCCH in compressed frames, and _N~pilot,N~_ is the number of
pilot bits per slot in non-compressed frames.
When the E-DCH TTI is 10msec and the current frame is compressed, _β~ed,C,i~_
shall be calculated as follows:
If E-DPDCH power extrapolation formula is configured
$\beta_{\text{ed},C,i} = \beta_{c,C,j} \cdot A_{\text{ed}} \cdot
\sqrt{\frac{L_{e,\text{ref}}}{L_{e,I,i}}} \cdot
\sqrt{\frac{K_{e,i}}{K_{e,\text{ref}}} \cdot \text{10}^{\left(
\frac{\Delta_{\text{harq}}}{\text{20}} \right)} \cdot \sqrt{\frac{\text{15}
\cdot N_{\text{pilot},C}}{N_{\text{slots},I}N_{\text{pilot},N}}}}$,
Else if E-DPDCH power interpolation formula is configured
with the exception that _β~ed,C,i~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}A_{\text{ed},2}^{2} -
A_{\text{ed},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}} \right)\left(
K_{e,i} - K_{e,\text{ref},1} \right) + A_{\text{ed},1}^{2} \leq 0$
_where L~e,I,i~ denotes the number of E-DPDCHs used for the i:th E-TFC in the
first frame used for transmitting the data and N~slots,I~_ is the number of
non DTX slots in the first frame used for transmitting the data.
For the _i_ :th E-TFC, the unquantized gain factor _β~ed,\ k,i,uq~_ for the
_k_ :th E-DPDCH (denoted E‑DPDCH~k~ in [3] subclause 4.2.1.3) shall be set to
$\sqrt{2} \times \beta_{\text{ed},C,i}$if the spreading factor for E-DPDCH~k~
is 2 and to $\beta_{\text{ed},C,i}$ otherwise.
Quantization may be applied as follows:
  * For E-TFCI smaller than or equal to _E-TFCI~ec,boost~_ ,
    * If _β~ed\ ,k,i,uq~_ /_β~c,C,j~_ is less than the smallest > quantized value of Table 1B.2 in [3] subclause 4.2.1.3, then > the gain factor of E-DPDCH~k~, _β~ed,k~_ is set such that > _β~ed,k~_ /_β~c,C,j~_ is the smallest quantized value of Table > 1B.2 in [3] subclause 4.2.1.3.
    * Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c,C,j~_ is > the largest quantized value of Table 1B.2 in [3] subclause > 4.2.1.3, for which the condition _β~ed,k~_ ≤ _β~ed,\ k,i,uq~_ > holds.
```{=html}
``` \- For E-TFCI greater than _E-TFCI~ec,boost~_ ,
    -   If *β~ed,k,i,uq~*/*β~c,C,j~* is less than the smallest quantized
        > value of Table 1B.2B in \[3\] subclause 4.2.1.3, then the gain
        > factor of E-DPDCH~k~, *β~ed,k~* is set such that
        > *β~ed,k~*/*β~c,C,j~* is the smallest quantized value of Table
        > 1B.2B in \[3\] subclause 4.2.1.3.
    -   Otherwise, *β~ed,k~* is set such that *β~ed,k~*/*β~c,C,j~* is
        > the largest quantized value of Table 1B.2B in \[3\] subclause
        > 4.2.1.3, for which the condition *β~ed,k~* ≤ *β~ed,k,i,uq~*
        > holds.
If quantization is not applied, _β~ed,k~_ shall be set to _β~ed,\ k,i,uq.~_
When the E-DCH TTI is 10msec and the current frame is not compressed, but is a
retransmission for which the corresponding first transmission was compressed,
the gain factor used for the _k_ :th E-DPDCH for the _i_ :th E-TFC is derived
from _β~ed,R,i~_ as follows:
If E-DPDCH power extrapolation formula is configured
Else if E-DPDCH power interpolation formula is configured
with the exception that _β~ed,R,i~_ is set to 0 if $\left(
\frac{\frac{L_{e,\text{ref},2}}{L_{e,\text{ref},1}}\beta_{\text{ed},\text{ref},2}^{2}
- \beta_{\text{ed},\text{ref},1}^{2}}{K_{e,\text{ref},2} - K_{e,\text{ref},1}}
\right)\left( K_{e,i} - K_{e,\text{ref},1} \right) +
\beta_{\text{ed},\text{ref},1}^{2} \leq 0$
where _β~ed,ref~_ ,_β~ed,ref,1,~ , β~ed,ref~_ ~,2~, _L~e,ref~, K~e,ref~,
K~e,i~ ,L~,e,ref,1~ , L~e,ref,2~ , K~e,ref,1~ and K~e,ref,2\ ~_ are as defined
in subclause 5.1.2.5B.2.3 _,_ ∆~harq~ is as defined in [3] subclause 4.2.1.3,
and _L~e,I,i~ and N~slots,I~_ are as defined above.
For the _i_ :th E-TFC, the unquantized gain factor _β~ed,\ k,i,uq~_ for the
_k_ :th E-DPDCH (denoted E‑DPDCH~k~ in [3] subclause 4.2.1.3) shall be set to
$\sqrt{2} \times \beta_{\text{ed},R,i}$ if the spreading factor for E-DPDCH~k~
is 2 and to $\beta_{\text{ed},R,i}$ otherwise.
Quantization may be applied as follows:
  * For E-TFCI smaller than or equal to _E-TFCI~ec,boost~_ ,
    * If _β~ed,\ k,i,uq~_ /_β~c~_ is less than the smallest quantized > value of Table 1B.2 in [3] subclause 4.2.1.3, then the gain > factor of E-DPDCH~k~, _β~ed,k~_ is set such that > _β~ed,k~_ /_β~c~_ is the smallest quantized value of Table 1B.2 > in [3] subclause 4.2.1.3.
    * Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the > largest quantized value of Table 1B.2 in [3] subclause > 4.2.1.3, for which the condition _β~ed,k~_ ≤ _β~ed,\ k,i,uq~_ > holds.
  * For E-TFCI greater than _E-TFCI~ec,boost~_ ,
    * If _β~ed,k,i,uq~_ /_β~c~_ is less than the smallest quantized > value of Table 1B.2B in [3] subclause 4.2.1.3, then the gain > factor of E-DPDCH~k~, _β~ed,k~_ is set such that > _β~ed,k~_ /_β~c~_ is the smallest quantized value of Table > 1B.2B in [3] subclause 4.2.1.3.
    * Otherwise, _β~ed,k~_ is set such that _β~ed,k~_ /_β~c~_ is the > largest quantized value of Table 1B.2B in [3] subclause > 4.2.1.3, for which the condition _β~ed,k~_ ≤ _β~ed,k,i,uq~_ > holds.
If quantization is not applied, _β~ed,k~_ shall be set to _β~ed,\ k,i,uq~_.
#### 5.1.2.5C Setting of the uplink DPCCH gain factor when no DPDCH is
configured
In the case that no DPDCH is configured, the gain factor _β~c~_ is equal to 1.
During a compressed frame, the gain factor _β~c,C,j~_ is also equal to 1.
#### 5.1.2.5D Setting of the uplink S-DPCCH power relative to DPCCH power
##### 5.1.2.5D.1 Setting of the uplink S-DPCCH/DPCCH power ratio when less
than two transport blocks are transmitted on E-DCH
If UL_CLTD_Enabled is set to TRUE and UL_CLTD_Active is 1, or if
UL_MIMO_Enabled is set to TRUE and UL_CLTD_Active is 1 and the UE is
transmitting either one or zero transport blocks on E-DCH, the S-DPCCH gain
factor, _β~sc~_ , which is defined in [3] subclause 4.2.1.4, is calculated
depending on the transmitted E-TFC at a given TTI.
In non compressed frames, if no transmission on E-DCH is taking place, or if
E-DCH transmission is taking place and E-TFCI _~i~_ is smaller than or equal
to _E-TFCI~ec,boost~_ , where _E-TFCI~i~_ denotes the E-TFCI of the _i_ :th
E-TFC, _β~sc~_ is calculated according to
Where the _β~c~_ value is signalled by higher layers or calculated as
described in subclause 5.1.2.5.2 or 5.1.2.5.3 if at least one DPDCH is
configured. In the case that no DPDCH is configured, the _β~c\ ~_ value is set
as described in subclause 5.1.2.5C._A~sc~_ is defined in [3] subclause 4.2.1.4
Table 1C.1. The _E-TFCI~ec,boost\ ~_ value is signalled by higher layers.
In non compressed frames if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ ,
the unquantized S-DPCCH gain factor for the _i_ :th E-TFC, _β~sc~_ is
calculated according to
,
where ∆ _~T2SP~_ is signalled by higher layers and is defined in [3] subclause
4.2.1.4,$\beta_{\text{ed},i,k}$ is the E-DPDCH gain factor for the _i_ :th
E-TFC on the _k_ :th physical channel and _k~max,i~_ is the number of physical
channels used for the _i_ :th E-TFC, and the quantization of _β~sc,i,uq~_
follows the quantization according to the definition of _β~ec~_ quantization
in table 1B.0A of [3].
If _β~sc,i,uq~_ is less than the smallest quantized value of Table 1B.0A in
[3], then the S-DPCCH gain factor of _E-TFCI~i~_ , _β~sc,i\ ~_ is set such
that _β~sc,i~_ /_β~c~_ is the smallest quantized value of Table 1B.0A in [3].
Otherwise, _β~sc,i~_ is selected from that table such that 20*log10(_β~sc,i~_
/_β~c~_) is the nearest quantized value to 20*log10(_β~sc,i,uq~_ /_β~c~_).
During the period between the start and end of a compressed DPCCH frame, when
S-DPCCH is transmitted, _β~sc~_ is calculated according to
> ,
if no transmission on E-DCH is taking place, or _E-TFCI~i~_ is smaller than or
equal to _E-TFCI~ec,boost,~_
_and according to_
, if _E-TFCI~i~_ is greater than _E‑TFCI~ec,boost,~_
where $\beta_{c,C,j}$ is calculated as described in subclause 5.1.2.5.4 if at
least one DPDCH is configured. In case no DPDCH is configured, _β~c,C,j\ ~_
value is set as described in subclause 5.1.2.5C. _N~pilot,C~_ is the number of
pilot bits per slot on the DPCCH in compressed frames, and _N~pilot,N~_ is the
number of pilot bits per slot in non-compressed frames.
##### 5.1.2.5D.2 Setting of the uplink S-DPCCH/DPCCH power ratio when two
transport blocks are transmitted on E-DCH (rank-2)
When two transport blocks are transmitted on uplink E-DCH, the S-DPCCH gain
factor setting, _β~sc~_ , is defined in [3] subclause 4.2.1.4.2.
#### 5.1.2.5E Setting of the uplink S-E-DPCCH power relative to DPCCH power
When two transport blocks are transmitted on uplink E-DCH, the S-E-DPCCH gain
factor setting, _β~sec~_ , is defined in [3] subclause 4.2.1.5. When one or
zero transport blocks are transmitted on uplink E-DCH, the S-E-DPCCH is not
transmitted.
#### 5.1.2.5F Setting of the uplink S-E-DPDCH power relative to E-DPDCH power
When two transport blocks are transmitted on uplink E-DCH, the S-E-DPDCH gain
factor setting, _β~sed~_ , is defined in [3] subclause 4.2.1.6 _._
When only one or zero transport blocks are transmitted on uplink E-DCH, the
S-E-DPDCH is not transmitted.
#### 5.1.2.6 Maximum and minimum power limits
When E-DCH is not configured, in the case that the total UE transmit power
(after applying DPCCH power adjustments and gain factors) would exceed the
maximum allowed value, the UE shall apply additional scaling to the total
transmit power so that it is equal to the maximum allowed power. This
additional scaling shall be such that the power ratio between DPCCH and DPDCH,
between DPCCH and HS-DPCCH, and between DPCCH and S-DPCCH remains as required
by subclause 5.1.2.5, 5.1.2.5A, and 5.1.2.5D.
**Single uplink frequency configured for E-DCH**
> When E-DCH is configured on a single frequency or E-DCH is configured on
> multiple frequencies but Secondary_EDCH_Cell_Active is 0,
>
> **Single transport block transmission (no MIMO)**
>
> \- If the total UE transmit power (after applying DPCCH power adjustments
> and gain factors) would exceed the maximum allowed value, the UE shall
> firstly reduce all the E-DPDCH gain factors _β~ed,k~_ by an equal scaling
> factor to respective values _β~ed,k,reduced~_ so that the total transmit
> power would be equal to the maximum allowed power.
>
> \- Also if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ , UE shall reduce
> only E-DPDCH gain factors to respective values _β~ed,k,reduced~_ and E-DPCCH
> is transmitted using original _β~ec~_ which is not recalculated according to
> the reduced E-DPDCH gain factors**.**
>
> \- After calculating the reduced E-DPDCH gain factors, if _E-TFCI~i~_ is
> smaller than or equal to _E-TFCI~ec,boost~_ , quantization according to
> table 1B.2 in [3] subclause 4.2.1.3 may be applied, or if _E-TFCI~i~_ is
> greater than _E-TFCI~ec,boost~_ , quantization according to table 1B.2B in
> [3] subclause 4.2.1.3 may be applied, where each _β~ed,k,reduced~_ is
> quantized such that _β~ed,k~/β~c~_ is the largest quantized value for which
> the condition _β~ed,k~_ ≤  _β~ed,k,reduced~_ holds.
>
> \- In case a DPDCH is transmitted, if any _β~ed,k,reduced~/β~c~_ is less
> than the smallest quantized value of Table 1B.2 in [3] subclause 4.2.1.3,
> DTX may be used on that E-DPDCH (E-DPCCH is, however still transmitted using
> _β~ec~_).
>
> \- In case no DPDCH is transmitted and regardless of the applied uplink
> modulation, if any _β~ed,k,reduced~/β~c~_ is less than _β~ed,k,reduced,min~_
> /_β~c~_ , that _β~ed,k~_ shall be set to _β~ed,k,min~_ such that
> _β~ed,k,min~/β~c~_ = min (_β~ed,k,reduced,min~_ /_β~c~_ ,
> _β~ed,k,original~/β~c~_), where _β~ed,k,original~_ denotes the E-DPDCH gain
> factor before reduction.
>
> **Dual transport block transmission (MIMO)**
>
> \- Also if the UE is transmitting both a set of E-DPDCHs and a set of S-E-
> DPDCHs, the UE shall reduce all the E-DPDCH and S-E-DPDCH gain factors
> _β~ed,k~_ and _β~sed,k~_ by an equal scaling factor to respective values
> _β~ed,k,reduced~_ and _β~sed,k,reduced~_ so that the total transmit power
> would be equal to the maximum allowed power.
>
> \- After calculating the reduced E-DPDCH and S-E-DPDCH gain factors,
> quantization according to table 1B.2B in [3] subclause 4.2.1.3 may be
> applied, where each _β~ed,k,reduced~_ is quantized such that _β~ed,k~/β~c~_
> is the largest quantized value for which the condition _β~ed,k~_ ≤
> _β~ed,k,reduced~_ holds, and _β~sed,k,reduced~_ is set to the same value as
> the quantized _β~ed,k,reduced~_.
>
> \- if any _β~ed,k,reduced~/β~c~_ is less than _β~ed,k,reduced,min~_ /_β~c~_
> , that _β~ed,k~_ shall be set to _β~ed,k,min~_ such that _β~ed,k,min~/β~c~_
> = min (_β~ed,k,reduced,min~_ /_β~c~_ , _β~ed,k,original~/β~c~_), where
> _β~ed,k,original~_ denotes the E-DPDCH gain factor before reduction,
>
> \- if any _β~sed,k,reduced~/β~c~_ is less than _β~ed,k,reduced,min~_ /_β~c~_
> , that _β~sed,k~_ shall be set to _β~sed,k,min~_ such that
> _β~sed,k,min~/β~c~_ = min (_β~ed,k,reduced,min~_ /_β~c~_ ,
> _β~sed,k,original~/β~c~_), where _β~sed,k,original~_ denotes the S-E-DPDCH
> gain factor before reduction,
>
> \- _β~ed,k,reduced,min~_ is configurable by higher layers.
>
> **Addional scaling rules applicable to both non-MIMO and MIMO
> transmissions**
>
> \- In the following cases, the UE shall then apply additional scaling to the
> total transmit power so that it is equal to the maximum allowed power:
  * if a DPDCH is transmitted and the total UE transmit power would > still exceed the maximum allowed value even though DTX is used on > all E-DPDCHs;
  * if no DPDCH is transmitted and the total UE transmit power would > still exceed the maximum allowed value even though _β~ed,k~_ is > equal to _β~ed,k,min~ for all k_.
> \- Any additional scaling of the total transmit power as described above
> shall be such that the power ratio between DPCCH and DPDCH, between DPCCH
> and HS-DPCCH, between DPCCH and E-DPCCH, and between DPCCH and S-DPCCH,
> remains as required by subclauses 5.1.2.5, 5.1.2.5A, 5.1.2.5B.1, and
> 5.1.2.5D, and such that the power ratio between each E-DPDCH and DPCCH
> remains as required by _β~ed,k,min~/β~c~_ if DTX is not used on E-DPDCH. Any
> slot-level scaling of _β~ed~_ or DTX of E-DPDCH as described above is
> applied at layer 1 only and is transparent to higher layers.
>
> \- If the UE is transmitting both a set of E-DPDCHs and a set of S-E-DPDCHs,
> the UE shall reduce all the E-DPDCH and S-E-DPDCH gain factors _β~ed,k~_ and
> _β~sed,k~_ by an equal scaling factor to respective values _β~ed,k,reduced~_
> and _β~sed,k,reduced~_ so that the total transmit power would be equal to
> the maximum allowed power and the rule that _β~sed,k,reduced~_ is equal to
> _β~ed,k,reduced~_ is always kept.
**Two uplink frequencies configured for E-DCH**
> When Secondary_EDCH_Cell_Active is 1,
  * If the total UE transmit power (after applying DPCCH power > adjustments and gain factors) would exceed the maximum allowed > value, the UE shall start by reducing all the E-DPDCH gain factors > _β~ed,k~_ on the frequency with highest DPCCH power by an equal > scaling factor to respective values _β~ed,k,reduced~_ so that the > total transmit power would be equal to the maximum allowed power.
  * Also if _E-TFCI~i~_ is greater than _E-TFCI~ec,boost~_ , UE shall > reduce only E-DPDCH gain factors to respective values > _β~ed,k,reduced~_ and E-DPCCH is transmitted using original > _β~ec~_ which is not recalculated according to the reduced E-DPDCH > gain factors. After calculating the reduced E-DPDCH gain factors, > if _E-TFCI~i~_ is smaller than or equal to _E-TFCI~ec,boost~_ , > quantization according to table 1B.2 in [3] subclause 4.2.1.3 > may be applied, or if _E-TFCI~i~_ is greater than > _E-TFCI~ec,boost~_ , quantization according to table 1B.2B in [3] > subclause 4.2.1.3 may be applied, where each _β~ed,k,reduced~_ is > quantized such that _β~ed,k~/β~c~_ is the largest quantized value > for which the condition _β~ed,k~_ ≤  _β~ed,k,reduced~_ holds.
  * If _β~ed,k,reduced~/β~c~_ is less than _β~ed,k,reduced,min~_ /_β~c~_ > then _β~ed,k~_ shall be set to _β~ed,k,min~_ such that > _β~ed,k,min~/β~c~_ = min (_β~ed,k,reduced,min~_ /_β~c~_ , > _β~ed,k,original~/β~c~_), where _β~ed,k,original~_ denotes the > E-DPDCH gain factor before reduction and _β~ed,k,reduced,min~_ is > individually configured by higher layers for each frequency.
  * The UE shall then apply the same procedure on the uplink frequency > with second highest DPCCH power.
  * If _β~ed,k,min~/β~c~_ = min (_β~ed,k,reduced,min~_ /_β~c~_ , > _β~ed,k,original~/β~c~_) for all activated uplink frequencies, any > additional scaling of the total transmit power shall be such that
  * the power ratio between DPCCH and HS-DPCCH, and between DPCCH and > E-DPCCH, for each activated uplink frequency remains as required > by subclauses 5.1.2.5, 5.1.2.5A and 5.1.2.5B.1, and such that the > power ratio between each E-DPDCH and DPCCH remains as required by > _β~ed,k,min~/β~c~_ and
  * the power ratio between DPCCH on the activated frequencies remains > unchanged.
**Additional generic power scaling rules**
Any scaling, and any reduction in the E-DPDCH gain factor as described above,
shall only be applied or changed at a DPCCH slot boundary. In order that the
total UE transmit power does not exceed the maximum allowed value the scaling
or E-DPDCH gain factor reduction shall be computed using the maximum HS-DPCCH
power transmitted in the next DPCCH slot. In the case that either an ACK or a
NACK transmission will start during the next DPCCH slot, the maximum HS-DPCCH
power shall be computed using one of the following:
(a) whichever of ∆~ACK~ and ∆~NACK~ will be used according to whether the
transmission will be ACK or NACK, _or_
(b) whichever of ∆~ACK~ and ∆~NACK~ is the largest.
When transmitting on a DPCH the UE is not required to be capable of reducing
its total transmit power below the minimum level required in [7]. However, it
may do so, provided that the power ratio between DPCCH and DPDCH, between
DPCCH and HS-DPCCH, and between DPCCH and S-DPCCH remains as specified in sub
clause 5.1.2.5, 5.1.2.5A, and 5.1.2.5D. Some further regulations also apply as
follows: In the case that the total UE transmit power (after applying DPCCH
power adjustments and gain factors) would be at or below the total transmit
power in the previously transmitted slot and also at or below the required
minimum power specified in [7], the UE may apply additional scaling to the
total transmit power, subject to the following restrictions:
\- The total transmit power after applying any additional scaling shall not
exceed the required minimum power, nor the total transmit power in the
previously transmitted slot;
\- The magnitude of any reduction in total transmit power between slots after
applying any additional scaling shall not exceed the magnitude of the
calculated power reduction before the additional scaling.
In the case that the total UE transmit power in the previously transmitted
slot is at or below the required minimum power specfied in [7] and the DPCCH
power adjustment and gain factors for the current slot would result in an
increase in total power, then no additional scaling shall be used (i.e. power
control shall operate as normal).
If the UE applies any additional scaling to the total transmit power as
described above, this scaling shall be included in the computation of any
DPCCH power adjustments to be applied in the next transmitted slot.
### 5.1.3 Void
## 5.2 Downlink power control
The transmit power of the downlink channels is determined by the network. In
general the ratio of the transmit power between different downlink channels is
not specified and may change with time. However, regulations exist as
described in the following subclauses.
Higher layer power settings shall be interpreted as setting of the total
power, i.e. the sum of the power from the two antennas in case of transmit
diversity.
### 5.2.1 DPCCH/DPDCH/F-DPCH
#### 5.2.1.1 General
The downlink transmit power control procedure controls simultaneously the
power of a DPCCH and its corresponding DPDCHs. The power control loop adjusts
the power of the DPCCH and DPDCHs with the same amount, i.e. the relative
power difference between the DPCCH and DPDCHs is not changed. In case of
F-DPCH, the power control loop adjusts the F-DPCH power. If multiple
frequencies are activated in the uplink, then the downlink transmit power
control procedure shall be followed independently for each associated downlink
frequency.
For DPCH, the relative transmit power offset between DPCCH fields and DPDCHs
is determined by the network. The TFCI, TPC and pilot fields of the DPCCH are
offset relative to the DPDCHs power by PO1, PO2 and PO3 dB respectively. The
power offsets may vary in time. The method for controlling the power offsets
within UTRAN is specified in [6]. The power offsets PO1, PO2 and PO3 do not
apply to F-DPCH.
#### 5.2.1.2 Ordinary transmit power control
##### 5.2.1.2.1 UE behaviour
The UE shall generate TPC commands to control the network transmit power and
send them in the TPC field of the uplink DPCCH. An example on how to derive
the TPC commands in given in Annex B.2.
The UE shall check the downlink power control mode (DPC_MODE) before
generating the TPC command:
\- if DPC_MODE = 0 : the UE sends a unique TPC command in each slot and the
TPC command generated is transmitted in the first available TPC field in the
uplink DPCCH. In case uplink DPCCH slot format #4 is used then UE may delay
transmitting generated TPC command to the next available TPC field
\- if DPC_MODE = 1 : the UE repeats the same TPC command over 3 slots and the
new TPC command is transmitted such that there is a new command at the
beginning of the frame, unless UE_DTX_DRX_Enabled is TRUE, in which case the
UE shall behave as for DPC_MODE=0. If DPC_MODE=1 when uplink DPCCH slot format
#4 is configured, the UE behaviour is undefined.
The DPC_MODE parameter is a UE specific parameter controlled by the UTRAN.
The UE shall not make any assumptions on how the downlink power is set by
UTRAN, in order to not prohibit usage of other UTRAN power control algorithms
than what is defined in subclause 5.2.1.2.2.
##### 5.2.1.2.1.1 F-DPCH quality target control {#f-dpch-quality-target-
control .H6}
The UTRAN sets a quality target for the F-DPCH. The UE autonomously sets a SIR
target value and adjusts it in order to achieve the same quality as the
quality target set by UTRAN. The quality target is set as a downlink TPC
command error rate target value for the F-DPCH belonging to the radio link
from the HS-DSCH serving cell as signalled by the UTRAN. The UE shall set the
SIR target when the F-DPCH has been setup or reconfigured. It shall not
increase the SIR target value before the power control has converged on the
current value. The UE may estimate whether the power control has converged on
the current value, by comparing the averaged measured SIR to the SIR target
value. When UL_DTX_Active is TRUE, the UE shall ignore in the SIR target value
adjustment any TPC commands received in F-DPCH slot starting during an uplink
DPCCH slot which is in an uplink DPCCH transmission gap.
##### 5.2.1.2.2 UTRAN behaviour
Upon receiving the TPC commands UTRAN shall adjust its downlink DPCCH/DPDCH or
F-DPCH power accordingly. For DPC_MODE = 0, and for DPC_MODE=1 if
UE_DTX_DRX_Enabled is TRUE,UTRAN shall estimate the transmitted TPC command
TPC~est~ to be 0 or 1, and shall update the power every transmitted slot. If
DPC_MODE = 1 and UE_DTX_DRX_Enabled is FALSE, UTRAN shall estimate the
transmitted TPC command TPC~est~ over three slots to be 0 or 1, and shall
update the power every three slots.
After estimating the _k_ :th TPC command, UTRAN shall adjust the current
downlink power _P_(_k_ -1) [dB] to a new power _P_(_k_) [dB] according to the
following formula:
_P_(_k_) = _P_(_k_ \- 1) + _P~TPC~_(_k_) + _P~bal~_(_k_),
where _P~TPC~_(_k_) is the _k_ :th power adjustment due to the inner loop
power control, and _P~bal~_(_k_) [dB] is a correction according to the
downlink power control procedure for balancing radio link powers towards a
common reference power. The power balancing procedure and control of the
procedure is described in [6].
_P~TPC~_(_k_) is calculated according to the following.
If the value of _Limited Power Increase Used_ parameter is \'Not used\', then
$P_{\text{TPC}}(k) = \left{ \begin{matrix} \+ \Delta_{\text{TPC}} & \text{if}\
\text{TPC}_{\text{est}}(k) = 1 \ \- \Delta_{\text{TPC}} & \text{if}\
\text{TPC}_{\text{est}}(k) = 0 \ \end{matrix} \right.\ $ , [dB]. (1)
If the value of _Limited Power Increase Used_ parameter is \'Used\', then the
_k:_ th inner loop power adjustment shall be calculated as:
$P_{\text{TPC}}(k) = \left{ \begin{matrix} \begin{matrix} \+
\Delta_{\text{TPC}} \ 0 \ \- \Delta_{\text{TPC}} \ \end{matrix} &
\begin{matrix} \text{if\ TPC}_{\text{est}}(k) = 1\text{\ \ \ and\ \ \
}\Delta_{\text{sum}}(k) + \Delta_{\text{TPC}}  0].
\- The parameter Preamble Retrans Max [integer > 0].
\- The initial preamble power Preamble_Initial_Power.
\- The Power offset P p-m = P~message-control~ -- P~preamble~, measured in dB,
between the power of the last transmitted preamble and the control part of the
random-access message.
\- The set of Transport Format parameters. This includes the power offset
between the data part and the control part of the random-access message for
each Transport Format.
Note that the above parameters may be updated from higher layers before each
physical random access procedure is initiated.
At each initiation of the physical random access procedure, Layer 1 shall
receive the following information from the higher layers (MAC):
\- The Transport Format to be used for the PRACH message part.
\- The ASC of the PRACH transmission.
\- The data to be transmitted (Transport Block Set).
The physical random-access procedure shall be performed as follows:
1 Derive the available uplink access slots, in the next full access slot set
or in the next 8 access slots, for the set of available RACH sub-channels
within the given ASC with the help of subclauses 6.1.1. and 6.1.2. Randomly
select one access slot among the ones previously determined. If there is no
access slot available in the selected set, randomly select one uplink access
slot corresponding to the set of available RACH sub-channels within the given
ASC from the next access slot set or in the next 7 access slots. The random
function shall be such that each of the allowed selections is chosen with
equal probability.
2 Randomly select a signature from the set of available signatures within the
given ASC. The random function shall be such that each of the allowed
selections is chosen with equal probability.
3 Set the Preamble Retransmission Counter to Preamble Retrans Max.
4 If the Preamble_Initial_Power is below the minimum level required in [7],
set the Commanded Preamble Power to a value, which shall be at or above the
Preamble_Initial_Power and at or below the required minimum power specified in
[7]. Otherwise set the parameter Commanded Preamble Power to
Preamble_Initial_Power.
5 In the case that the Commanded Preamble Power exceeds the maximum allowed
value, set the preamble transmission power to the maximum allowed power. In
the case that the Commanded Preamble Power is below the minimum level required
in [7], set the preamble transmission power to a value, which shall be at or
above the Commanded Preamble Power and at or below the required minimum power
specified in [7]. Otherwise set the preamble transmission power to the
Commanded Preamble Power. Transmit a preamble using the selected uplink access
slot, signature, and preamble transmission power.
6 If no positive or negative acquisition indicator (AI ≠ +1 nor --1)
corresponding to the selected signature is detected in the downlink access
slot corresponding to the selected uplink access slot:
6.1 Select the next available access slot in the set of available RACH sub-
channels within the given ASC.
6.2 Randomly select a new signature from the set of available signatures
within the given ASC. The random function shall be such that each of the
allowed selections is chosen with equal probability.
6.3 Increase the Commanded Preamble Power by ∆P~0~ = Power Ramp Step [dB]. If
the Commanded Preamble Power exceeds the maximum allowed power by 6dB, the UE
may pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and exit
the physical random access procedure.
6.4 Decrease the Preamble Retransmission Counter by one.
6.5 If the Preamble Retransmission Counter > 0 then repeat from step 5.
Otherwise pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and
exit the physical random access procedure.
7 If a negative acquisition indicator corresponding to the selected signature
is detected in the downlink access slot corresponding to the selected uplink
access slot, pass L1 status (\"Nack on AICH received\") to the higher layers
(MAC) and exit the physical random access procedure.
8 Transmit the random access message three or four uplink access slots after
the uplink access slot of the last transmitted preamble depending on the AICH
transmission timing parameter. Transmission power of the control part of the
random access message should be P p-m [dB] higher than the power of the last
transmitted preamble. Transmission power of the data part of the random access
message is set according to subclause 5.1.1.2.
9 Pass L1 status \"RACH message transmitted\" to the higher layers and exit
the physical random access procedure.
### 6.1.1 RACH sub-channels
A RACH sub-channel defines a sub-set of the total set of uplink access slots.
There are a total of 12 RACH sub-channels. RACH sub-channel #i (i = 0, ...,
11) consists of the following uplink access slots:
\- Uplink access slot #i leading by τ~p-a~ chips the downlink access slot #i
contained within the 10 ms interval that is time aligned with P-CCPCH frames
for which SFN mod 8 = 0 or SFN mod 8 = 1.
\- Every 12^th^ access slot relative to this access slot.
The access slots of different RACH sub-channels are also illustrated in Table
7.
Table 7: The available uplink access slots for different RACH sub-channels
* * *
SFN modulo 8 of corresponding P-CCPCH frame Sub-channel number  
0 1 2 3 4 5 6 7 8 9 10 11 0 0 1 2 3 4 5 6 7  
1 12 13 14 8 9 10 11 2 0 1 2 3 4 5 6 7  
3 9 10 11 12 13 14 8 4 6 7 0 1 2 3 4 5 5 8 9 10 11 12 13 14  
6 3 4 5 6 7 0 1 2 7 8 9 10 11 12 13 14
* * *
### 6.1.2 RACH access slot sets
The PRACH contains two sets of access slots as shown in Figure 2. Access slot
set 1 contains PRACH slots 0 -- 7 and starts τ~p-a~ chips before the downlink
P-CCPCH frame for which SFN mod 2 = 0. Access slot set 2 contains PRACH slots
8 - 14 and starts (τ~p-a~ --2560) chips before the downlink P-CCPCH frame for
which SFN mod 2 = 1.
Figure 2: PRACH access slot and downlink AICH relation (τ~p-a~ = 7680 chips)
## 6.1A Physical random access procedure for Enhanced Uplink in CELL_FACH
state and IDLE mode {#a-physical-random-access-procedure-for-enhanced-uplink-
in-cell_fach-state-and-idle-mode .list-paragraph}
The physical random access procedure described in this subclause is initiated
upon request from the MAC sublayer (cf. [9]).
Before the physical random-access procedure can be initiated, Layer 1 shall
receive the following information from the higher layers (RRC):
\- Preamble scrambling code(s) for 2 and 10ms TTI.
\- The AICH_Transmission_Timing parameter [0 or 1].
\- The set of available signatures and the set of available RACH sub-channels
corresponding to E-DCH resources for each Access Service Class (ASC). Sub-
channels are defined in subclause 6.1.1.
\- The total number of E-DCH resources configured in the cell.
\- The power-ramping factor Power Ramp Step [integer > 0].
\- The parameter Preamble Retrans Max [integer > 0].
\- The initial preamble power Preamble_Initial_Power.
\- The Power offset Pp-e = P~dpcch~ -- P~preamble~, measured in dB, between
the power of the last transmitted preamble and the initial DPCCH transmission
power.
\- The number of TTIs in which only the uplink DPCCH is sent before the E-DCH
transmission may start for 2 and 10ms TTI.
Note that the above parameters may be updated from higher layers before each
physical random access procedure is initiated.
At each initiation of the physical random access procedure, Layer 1 shall
receive the following information from the higher layers (MAC):
\- The ASC of the PRACH transmission.
If Concurrent_TTI_Deployment_Enabled is TRUE, Layer 1 shall also receive the
following additional parameters from the higher layers (MAC):
\- TTI length, either 2 or 10ms.
The procedure for the selection of the TTI length is defined in subclause
8.5.b1 in [5]. The TTI length may be updated by higher layers before each
preamble retransmission.
The physical random-access procedure shall be performed as follows:
1 If NT-HS-DPCCH_Enabled is FALSE, or if NT-HS-DPCCH_Enabled is TRUE and the
physical random-access procedure is not triggered by an HS-SCCH order, then
derive the available uplink access slots, in the next full access slot set or
in the next 8 access slots, for the set of available RACH sub-channels within
the given ASC with the help of subclauses 6.1.1. and 6.1.2. Randomly select
one access slot among the ones previously determined. If there is no access
slot available in the selected set, randomly select one uplink access slot
corresponding to the set of available RACH sub-channels within the given ASC
from the next access slot set or in the next 7 access slots. The random
function shall be such that each of the allowed selections is chosen with
equal probability. If NT-HS-DPCCH_Enabled is TRUE and the physical random-
access procedure is triggered by an HS-SCCH order, then the next available
access slot is chosen.
2 If Concurrent_TTI_Deployment_Enabled is TRUE, the scrambling code
corresponding to the indicated TTI length is chosen.
2a Randomly select a signature from the set of available signatures within the
given ASC and indicated scrambling code. The random function shall be such
that each of the allowed selections is chosen with equal probability. If
Concurrent_TTI_Deployment_Enabled is TRUE, the set of available signatures
corresponds to the indicated TTI length.
3 Set the Preamble Retransmission Counter to Preamble Retrans Max.
4 If the Preamble_Initial_Power is below the minimum level required in [7],
set the Commanded Preamble Power to a value, which shall be at or above the
Preamble_Initial_Power and at or below the required minimum power specified in
[7]. Otherwise set the parameter Commanded Preamble Power to
Preamble_Initial_Power.
5 In the case that the Commanded Preamble Power exceeds the maximum allowed
value, set the preamble transmission power to the maximum allowed power. In
the case that the Commanded Preamble Power is below the minimum level required
in [7], set the preamble transmission power to a value, which shall be at or
above the Commanded Preamble Power and at or below the required minimum power
specified in [7]. Otherwise set the preamble transmission power to the
Commanded Preamble Power. Transmit a preamble using the selected uplink access
slot, signature, and preamble transmission power.
6 If no positive or negative acquisition indicator (AI ≠ +1 nor --1)
corresponding to the selected signature is detected in the downlink access
slot corresponding to the selected uplink access slot:
6.1 Select the next available access slot in the set of available RACH sub-
channels within the given ASC.
6.2 Randomly select a new signature from the set of available signatures
within the given ASC. The random function shall be such that each of the
allowed selections is chosen with equal probability. If an update to the TTI
length is indicated by higher layers, then the set of available signatures and
the preamble scrambling code are also updated correspondingly.
6.3 Increase the Commanded Preamble Power by ∆P~0~ = Power Ramp Step [dB]. If
the **Commanded Preamble Power** exceeds the maximum allowed power by 6dB, the
UE may pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and exit
the physical random access procedure.
6.4 Decrease the Preamble Retransmission Counter by one.
6.5 If the Preamble Retransmission Counter > 0 then repeat from step 5.
Otherwise pass L1 status (\"No ack on AICH\") to the higher layers (MAC) and
exit the physical random access procedure.
7 If a negative acquisition indicator on AICH corresponding to the selected
signature is detected in the downlink access slot corresponding to the
selected uplink access slot.
> 7.1 If no Extended Acquisition Indicator signature set is configured in the
> cell, pass L1 status ("Nack on AICH received") to the higher layers (MAC)
> and exit the physical random access procedure.
>
> 7.2 If an Extended Acquisition Indicator signature set is configured in the
> cell, detect which one of the defined Extended Acquisition Indicator
> signatures is present.
>
> 7.2.1 If the detected Extended Acquisition Indicator signature and
> modulation symbol corresponds to 'NACK' as defined in [1], pass L1 status
> ("Nack on AICH received") to the higher layers (MAC) and exit the physical
> random access procedure.
>
> 7.2.2 If the detected Extended Acquisition Indicator signature and
> modulation symbol do not correspond to 'NACK', pass L1 status ("Ack on AICH
> received") with the corresponding E-DCH resource index as defined in [1] to
> higher layers (MAC) and skip step 8.
>
> 8 If a positive acquisition indicator on AICH corresponding to the selected
> signature is detected in the downlink access slot corresponding to the
> selected uplink access slot, pass L1 status ("Ack on AICH received") with
> the default E-DCH resource index corresponding to the selected signature as
> defined in [1] to higher layers (MAC),
9 Start transmitting DPCCH (timing as specified in [1] and synchronization
according to synchronization procedure AA). The initial transmission power of
DPCCH prior to starting the E-DCH transmission should be\ Pp-e [dB] higher
than the power of the last transmitted preamble.
10 Proceed to transmitting E-DPCCH and E-DPDCH, and transmit HS-DPCCH if so
instructed by MAC layer after the defined number of TTIs of DPCCH only
transmission has passed.
## 6.2 Void
# 6A HS-DSCH-related procedures
## 6A.1 General procedure
Scheduling and transport format selection is controlled by the MAC-hs or MAC-
ehs sublayer in the Node B [9].
The following parameters are signalled to the physical layer in the UE and the
Node B from higher layers:
1) HS-SCCH set to be monitored in the serving HS-DSCH cell
2) Repetition factors of ACK/NACK: N_acknack_transmit and
N_acknack_transmit_2. The parameter N_acknack_transmit_2 is signaled when the
UE is configured in Multiflow mode as specified in [5]
3) Channel Quality Indicator (CQI) feedback cycle _k_
4) Repetition factors of CQI: N_cqi_transmit and N_cqi_transmit_2. The
parameter N_cqi_transmit_2 is signalled when the UE is configured in Multiflow
mode as specified in [5]
5) Measurement power offset Γ and Γ~1~
6) Status of preamble/postamble transmission: HARQ_preamble_mode
7) Status of 64QAM configuration
8) Set of P-CPICH and/or S-CPICH (which shall be transmitted on the same
scrambling code) that shall be used for HS-PDSCH demodulation in case the UE
is configured in MIMO mode and in MIMO mode with four transmit antennas. Set
of D-CPICH (which shall be transmitted on the same scrambling code as that of
P-CPICH) in case the UE is configured in MIMO mode with four transmit
antennas.
9) The number _N_ of dynamic single/dual CQI reports out of a sequence of _M_
CQI reports in case the UE is configured in MIMO mode (not applicable when
single-stream restriction is configured) and in MIMO mode with four transmit
antennas: _N_ _cqi_typeA, _M_ _cqi, respectively
10) Set of transport block sizes configured for HS-SCCH-less operation
11) Set of HS-PDSCHs configured for HS-SCCH-less operation
12) Status variables HS_SCCH_LESS_STATUS and DTX_DRX_STATUS
13) Enabling_Delay
14) RRC protocol state (CELL_DCH, CELL_FACH, CELL_PCH or URA_PCH)
15) H-RNTI values (dedicated H-RNTI, common H-RNTI, BCCH specific H-RNTI) to
be monitored when the UE is configured to receive HS-DSCH in CELL_FACH or
CELL_PCH state
16) HS-DSCH paging system information, which includes the following
information when the UE is configured to receive HS-DSCH in URA_PCH state or
in CELL_PCH state:
    a.  Number of PCCH transmissions: The number of subframes used to
        transmit PAGING TYPE 1 as defined in \[5\].
    b.  HS-PDSCH Channelisation Code configured for HS-SCCH less paging
        operation
    c.  Transport Block Size: List of Transport Block Sizes
17) Status of MIMO configuration and MIMO configuration with four transmit
antennas
18) HS-SCCH set to be monitored in each secondary serving HS-DSCH cell
19) HS-SCCH set to be monitored in one non-serving cell
20) Status of 'Support for different HS-SCCHs in contiguous TTIs'
21) HS-SCCH set to be monitored in the assisting serving HS-DSCH cell
22) HS-SCCH set to be monitored in the assisting secondary serving HS-DSCH
cell
If HS_SCCH_LESS_STATUS is TRUE then HS-SCCH_less_mode=1. Otherwise HS-
SCCH_less_mode=0.
HS-SCCH-less_Active shall be set to TRUE while HS-SCCH_less_mode=1 and HS-
SCCH-less operation is activated. Otherwise HS-SCCH_less_Active shall be set
to FALSE. HS-SCCH-less operation shall be activated at the time when HS-
SCCH_less_mode is set to 1, and may be further deactivated or activated by HS-
SCCH orders as specified in [2]. This ordered deactivation or activation of
the HS-SCCH-less operation is applied by the UE 12 slots after the end of the
HS-SCCH subframe delivering the order.
If the higher layers set DTX_DRX_STATUS to TRUE (as described in [5]) then
UE_DTX_DRX_Enabled is FALSE until Enabling_Delay radio frames have passed.
After the higher layers have set DTX_DRX_STATUS to TRUE (as described in [5])
and Enabling_Delay radio frames have passed then UE_DTX_DRX_Enabled is TRUE.
Otherwise UE_DTX_DRX_Enabled is FALSE.
If the UE is not configured in Multiflow mode;
\- If the UE is configured with at least one secondary serving HS-DSCH cell,
then Secondary_Cell_Enabled is equal to the number of the configured secondary
serving HS-DSCH cells, otherwise Secondary_Cell_Enabled is 0 and
Secondary_Cell_Active is 0.
\- Configured secondary serving HS-DSCH cells shall be activated at the time
when Secondary_Cell_Enabled is changed from 0 to a value not equal to 0, or
\- The activation status for configured secondary HS-DSCH cell(s) shall be set
as specified in [5] when Secondary_Cell_Enabled is changed from a value n
(where n is greater than 0) to a value m (where m is a value greater than 0).
Configured secondary serving HS-DSCH cells may further be deactivated or
activated by HS-SCCH orders as specified in [2].
\- Secondary_Cell_Active shall be set to 1, 2, 3, 4, 5, 6, or 7 while
Secondary_Cell_Enabled is set to a value not equal to 0, and 1, 2, 3, 4, 5, 6,
or 7 secondary serving HS-DSCH cells are activated respectively; otherwise
Secondary_Cell_Active shall be set to 0.
\- If the UE receives an HS-SCCH order for activation of a secondary serving
HS-DSCH cell that is already activated as specified in [2], then the UE shall
not change the activation status of that secondary serving HS-DSCH cell, but
shall transmit the HARQ-ACK acknowledging the HS-SCCH order.
If the UE is configured in Multiflow mode and with a secondary serving cell or
an assisting secondary serving cell, all the configured cell(s) are initially
activated, and may further be deactivated or activated using HS-SCCH orders.
> \- The Secondary Serving HS-DSCH cell can be deactivated with an order
> transmitted only by the Serving or the Secondary Serving HS-DSCH cell and
> reactivated with an order transmitted only by the serving HS-DSCH cell.
>
> \- The Assisting Secondary Serving HS-DSCH cell can be deactivated with an
> order transmitted only by the Assisting Serving or Assisting Secondary
> Serving HS-DSCH cell and reactivated with an order transmitted only by the
> Assisting Serving HS-DSCH cell.
>
> \- If the UE receives an HS-SCCH order for activation of a Secondary Serving
> HS-DSCH or Assisting Secondary Serving cell that is already activated as
> specified in [2], then the UE shall not change the activation status of that
> secondary serving HS-DSCH cell, but shall transmit the HARQ-ACK
> acknowledging the HS-SCCH order.
>
> \- If the higher layers indicate a change in the HS-DSCH cells,
\- if the new configuration contains a Secondary Serving HS-DSCH cell that was
either the Secondary Serving or Assisting Secondary Serving HS-DSCH cell in
the earlier configuration and the cell was deactivated with HS-SCCH orders, it
shall remain deactivated. Otherwise after the change the Secondary Serving HS-
DSCH cell shall be active.
\- if the new configuration contains an Assisting Secondary Serving HS-DSCH
cell that was either the Secondary Serving or Assisting Secondary Serving HS-
DSCH cell in the earlier configuration and the cell was deactivated with HS-
SCCH orders, it shall remain deactivated. Otherwise after the change the
Assisting Secondary Serving HS-DSCH cell shall be active.
If the UE is not configured with multiple uplink frequencies, HS-SCCH ordered
deactivation or activation of the secondary serving HS-DSCH cell(s) or the
Assisting Secondary Serving HS-DSCH cell is applied by the UE 12 slots after
the end of the HS-SCCH subframe delivering the order, and any transient
behaviour related to this change should take place before this point in time.
If the activation statuses of all secondary serving HS-DSCH cells in a
frequency band (as defined in [7]) remain unaffected by an HS-SCCH ordered
deactivation or activation the maximum allowed interruption time for the cells
in this band is 1 slot and the interrupt shall take place during the next
downlink HS-SCCH slot after the end of the HS-DPCCH slot that contains the
HARQ-ACK information acknowledging the HS-SCCH order. The corresponding change
of the HS-DPCCH channel coding scheme as specified in [2] is applied by the UE
at the first HS-DPCCH subframe boundary after the activation or deactivation
has been applied.
If the UE is configured with multiple uplink frequencies, HS-SCCH ordered
deactivation or activation of the secondary serving HS-DSCH cell(s) or the
Assisting Secondary Serving HS-DSCH cell is applied by the UE 18 slots after
the end of the HS-SCCH subframe delivering the order, and any transient
behaviour related to this change should take place before this point in time.
If:
  * the activation statuses of all secondary serving HS-DSCH cells in a frequency band (as defined in [7]) remain unaffected by the HS-SCCH ordered deactivation or activation and the serving HS-DSCH cell is not configured in this band or,
  * the activation statuses of all secondary serving HS-DSCH cells and the secondary uplink frequency in a frequency band remain unaffected by the HS-SCCH ordered deactivation or activation and the serving HS-DSCH cell is configured in this band,
the maximum allowed interruption time for the downlink cells and uplink
frequencies configured in this frequency band is 1 slot. The interrupt shall
take place during the next downlink HS-SCCH slot after the end of the HS-DPCCH
slot that contains the HARQ-ACK information acknowledging the HS-SCCH order.
The corresponding change of the HS-DPCCH channel coding scheme as specified in
[2] is applied by the UE at the first HS-DPCCH subframe boundary after the
activation or deactivation has been applied.
### 6A.1.1 UE procedure for receiving HS-DSCH and HS-SCCH in the CELL_DCH
state
NOTE: The Node B procedure for transmitting the HS-DSCH and the HS-SCCH is
specified in subclause 6A.1.3.
In this subclause, sub-frame _n_ on the HS-SCCHs refers to the sub-frame which
is associated with sub-frame _n_ on the HS-PDSCH as defined in [1], and sub-
frame _n_ on the HS-DPCCH refers to the sub-frame which is related to sub-
frame _n_ on the HS-PDSCH as defined in [1].
If the UE did not detect consistent control information intended for this UE
on any of the HS-SCCHs in the HS-SCCH set in the immediately preceding
subframe _n_ \-- 1, the UE shall in sub-frame _n_ monitor all HS-SCCHs in the
HS-SCCH set. The maximum size of the HS-SCCH set in the serving HS-DSCH cell
is 4.
If 64QAM is not configured for the UE and 'Support for different HS-SCCHs in
contiguous TTIs' is false, then if the UE did detect consistent control
information intended for this UE in the immediately preceding subframe _n_ \--
1, it is sufficient in sub-frame _n_ to only monitor the same HS-SCCH used in
the immediately preceding subframe _n_ \-- 1. If 64QAM is configured for the
UE or 'Support for different HS-SCCHs in contiguous TTIs' is true, then if the
UE did detect consistent control information intended for this UE in the
immediately preceding subframe _n_ \-- 1, the UE shall in sub-frame _n_
monitor all HS-SCCHs in the HS-SCCH set. These rules apply regardless of the
value of HS-SCCH_less_mode.
If Secondary_Cell_Active is not 0 and the UE is not configured in Multiflow
mode,
\- The UE shall simultaneously monitor an HS-SCCH set in each of the activated
secondary serving HS-DSCH cells, and receive HS-DSCH if it is scheduled in
that cell. The maximum size of the HS-SCCH set in a secondary serving HS-DSCH
cell is 4 and the maximum number of HS-SCCHs monitored by the UE across
\- both the serving HS-DSCH cell and the secondary serving HS-DSCH cell is 6
if the UE is capable of HS-DSCH reception in a maximum of 2 cells.
\- the serving HS-DSCH cell, the 1^st^ and 2^nd^ secondary serving HS-DSCH
cells is 9 if the UE is capable of HS-DSCH reception in a maximum of 3 cells.
\- the serving HS-DSCH cell, the 1^st^ , 2^nd^ and 3^rd^ secondary serving HS-
DSCH cells is 12 if the UE is capable of HS-DSCH reception in 4 cells.
\- the serving HS-DSCH cell, the 1^st^, 2^nd^, 3^rd^ and 4^th^ secondary
serving HS-DSCH cells is 15 if the UE is capable of HS-DSCH reception in 5
cells.
\- the serving HS-DSCH cell, the 1^st^, 2^nd^, 3^rd^, 4^th^ and 5^th^
secondary serving HS-DSCH cells is 18 if the UE is capable of HS-DSCH
reception in 6 cells.
\- the serving HS-DSCH cell, the 1^st^, 2^nd^, 3^rd^, 4^th^, 5^th^ and 6^th^
secondary serving HS-DSCH cells is 21 if the UE is capable of HS-DSCH
reception in 7 cells.
\- the serving HS-DSCH cell, the 1^st^, 2^nd^, 3^rd^, 4^th^, 5^th^, 6^th^ and
7^th^ secondary serving HS-DSCH cells is 24 if the UE is capable of HS-DSCH
reception in 8 cells.
\- From the serving HS-DSCH cell, the UE shall be able to receive up to one
HS-DSCH if MIMO mode and MIMO mode with four transmit antennas is not
configured or two HS-DSCHs if MIMO mode is configured or four HS-DSCHs if MIMO
mode with four transmit antennas is configured or one HS-SCCH order.
\- In addition, from each of the activated secondary serving HS-DSCH cells,
the UE shall be able to simultaneously receive up to one HS-DSCH if MIMO mode
and MIMO mode with four transmit antennas is not configured or two HS-DSCHs if
MIMO mode is configured or four HS-DSCHs if MIMO mode with four transmit
antennas is configured or one HS-SCCH order.
\- The maximum number of HS-SCCH orders simultaneously received by the UE
across the serving HS-DSCH cell and all the activated secondary serving HS-
DSCH cells is 2.
\- HS-SCCH-less HS-DSCH transmission shall not be used in a secondary serving
HS-DSCH cell.
\- The UE behaviour is unspecified in case more than two HS-SCCH orders are
received simultaneously or contradictory HS-SCCH orders (i.e. orders for
activation and deactivation of the same functionality) are received from the
serving HS-DSCH cell and/or any of the secondary serving HS-DSCH cells during
the same subframe.
If the UE is configured in Multiflow mode
\- The UE shall simultaneously monitor an HS-SCCH set in each of the activated
serving, assisting serving, secondary serving and assisting secondary serving
HS-DSCH cells, and receive HS-DSCH if it is scheduled in that cell. The
maximum size of the HS-SCCH set in any cell is 4 and the maximum number of HS-
SCCHs monitored by the UE across
\- both the serving HS-DSCH cell and the assisting serving HS-DSCH cell is 6
if the UE is capable of HS-DSCH reception in a maximum of 2 cells in Multiflow
mode.
\- the (secondary) serving HS-DSCH cell(s) and the assisting (secondary)
serving HS-DSCH cell(s) is 9 if the UE is capable of HS-DSCH reception in a
maximum of 3 cells in Multiflow mode.
\- the (secondary) serving HS-DSCH cell(s) and the assisting (secondary)
serving HS-DSCH cell(s) is 12 if the UE is capable of HS-DSCH reception in a
maximum of 4 cells in Multiflow mode.
\- From the serving HS-DSCH cell, the UE shall be able to receive up to one
HS-DSCH if MIMO mode is not configured or two HS-DSCHs if MIMO mode is
configured or one HS-SCCH order.
\- In addition, from each of the assisting serving and the activated
(assisting) secondary serving HS-DSCH cell(s), the UE shall be able to
simultaneously receive up to one HS-DSCH if MIMO mode is not configured or two
HS-DSCHs if MIMO mode is configured or one HS-SCCH order.
\- HS-SCCH-less HS-DSCH transmission shall not be used in any cell other than
the serving HS-DSCH cell.
\- The UE behaviour is unspecified in case more than two HS-SCCH orders are
received simultaneously or contradictory HS-SCCH orders (i.e. orders for
activation and deactivation of the same functionality) are received
simultaneously.
The UE can be configured to simultaneously monitor a maximum of 1 HS-SCCH in
one non-serving cell. This HS-SCCH is only used for HS-SCCH orders that
indicate HS-DSCH serving cell change as defined in subclause 4.6C.2.2.1 in
[2]. Upon successfully receiving an HS-SCCH order that indicates HS-DSCH
serving cell change from this non-serving cell, the UE shall be able to start
listening to the full configured HS-SCCH set from this new serving cell and
from the new secondary serving HS-DSCH cells if configured by higher layers,
at the activation time configured by higher layers if the activation time is
not equal to "now", or otherwise within 40 ms from the end of the subframe in
which the HS-SCCH order is received.
When the UE monitors HS-SCCHs, the UE shall only consider the control
information to be consistent if either:
\- the decoded \'channelization-code-set information\' is lower than or equal
to \'maximum number of HS-DSCH codes received\' in its UE capability and the
decoded \'modulation scheme information\' is valid in terms of its UE
capability,
or
\- the decoded \'channelization-code-set information\' and decoded 'modulation
scheme information' correspond to an indication of an HS-SCCH order as defined
in [2] subclause 4.6C.2.
Control information for one UE shall not be transmitted from the serving cell
on more than one HS-SCCH in a single sub-frame.
If a UE detects that one of the monitored HS-SCCHs in sub-frame _n_ carries
consistent control information intended for this UE, the UE shall perform the
following:
\- If the decoded \'channelization-code-set information\' and decoded
'modulation scheme information' do not correspond to an indication of an HS-
SCCH order, start receiving the HS-PDSCHs indicated by this consistent control
information
> \- If the CRC of the HS-SCCH is OK:
  * If HS-SCCH_less_mode=1 and the TFRI value corresponds to the retransmissions of HS-SCCH-less operation, the transport block size information shall be derived from the signalled transport block size indicator as defined in [5] and [9].
  * Else if UE_DTX_DRX_Enabled is TRUE or HS-SCCH_less_mode=1 or Secondary_Cell_Enabled is not 0 or UL_CLTD_Enabled is TRUE or UE is configured in MIMO mode with four transmit antennas or UE is configured in Multiflow mode, and the 'channelization-code-set information' and 'modulation scheme information' correspond to an HS-SCCH order, the UE shall:
    * if the TFRI value corresponds to an HS-SCCH order as defined in [2] subclause 4.6C.2,
      * If the HS-SCCH order was sent by the serving HS-DSCH cell or by one of the secondary serving HS-DSCH cells, transmit ACK information in the slot allocated to the HARQ-ACK in the corresponding HS-DPCCH sub-frame as defined in [1] and [2];
      * Process the HS-SCCH orders as described in subclauses 6A.1, 6B, 6C.4, 10.6, 11.6 and 12.5.
    * else, discard the information received on this HS-SCCH.
  * Else, the transport block size information shall be derived from the signalled TFRI value as defined in [9].
    * If the \'Hybrid-ARQ process information\' is not included in the set configured by upper layers, the UE shall discard the information received on this HS-SCCH and on the HS-PDSCHs.
> \- Else, if HS-SCCH_less_Active is TRUE, the UE may start receiving the HS-
> PDSCHs configured for HS-SCCH-less operation and attempt to decode the HS-
> DSCH bits based on the set of possible HS-DSCH transport block sizes
> configured for HS-SCCH-less operation. Otherwise, the UE shall discard the
> information received on this HS-SCCH and HS-PDSCH.
Otherwise, if the UE does not detect consistent control information intended
for this UE on any of the HS-SCCHs in its HS-SCCH sets, the UE shall perform
the following:
> \- the UE shall discard the information received on this HS-SCCH.
\- if HS-SCCH_less_Active is TRUE, the UE shall start receiving the HS-PDSCHs
configured for HS-SCCH-less operation and attempt to decode the HS-DSCH bits
based on the set of possible HS-DSCH transport block sizes configured for HS-
SCCH-less operation.
> \- otherwise, the UE shall discard the information received on the HS-
> PDSCHs.
If UL_DTX_Active is TRUE (see clause 6C) and either of the following is true:
\- the UE detects consistent control information intended for this UE and the
TFRI value does not correspond to an HS-SCCH order, or
> \- the UE has successfully decoded HS-PDSCHs intended for this UE;
then, at the HS-DPCCH sub frame that contains or would contain the HARQ-ACK
corresponding to the HS-SCCH or to the HS-PDSCHs that generated the priority
change, the UE shall perform the following:
> \- set CQI_DTX_Priority to 1 and,
>
> \- reset the CQI nominal reporting timer to CQI_DTX_TIMER.
If HARQ_preamble_mode = 1 and the information received on HS-SCCH is not
discarded, the UE shall:
  * transmit a HARQ Preamble (PRE for HS-DPCCH slot format 0 or PRE/PRE for HS-DPCCH slot format 1) in the slot allocated to HARQ-ACK in HS-DPCCH sub-frame _n_ \-- 1 (if two HS-DPCCHs are active then a HARQ preamble is sent on each of HS-DPCCH and HS-DPCCH~2~), unless an ACK or NACK or any combination of ACK and NACK is to be transmitted in sub-frame _n_ \-- 1 as a result of an HS-DSCH transmission earlier than sub-frame _n_ on the HS-PDSCH, and
  * if N_acknack_transmit > 1, the UE shall transmit a HARQ Preamble in the slot allocated to HARQ‑ACK in HS-DPCCH sub-frame _n_ \-- 2 (if two HS-DPCCHs are active then a HARQ preamble is sent on each of HS-DPCCH and HS-DPCCH~2~), unless an ACK or NACK or any combination of ACK and NACK is to be transmitted in sub-frame _n_ \-- 2 as a result of an HS-DSCH transmission earlier than sub-frame _n_ on the HS-PDSCH.
  * if N_acknack_transmit _2> 1, the UE is configured in Multiflow mode and the HS-SCCH corresponds to an assisting serving or assisting secondary serving cell, then the UE shall transmit a HARQ Preamble in the slot allocated to HARQ‑ACK in HS-DPCCH sub-frame _n_ \-- 2, unless an ACK or NACK or any combination of ACK and NACK is to be transmitted in sub-frame _n_ \-- 2 as a result of an HS-DSCH transmission earlier than sub-frame _n_ on the HS-PDSCH.
> The UE shall transmit the ACK/NACK information received from MAC-hs or MAC-
> ehs in the slot allocated to the HARQ-ACK in the corresponding HS-DPCCH sub-
> frame as defined in [1] and [2].
>
> When _N_ acknack_transmit_ is greater than one, the UE shall:
>
> \- repeat the transmission of the ACK/NACK information over the next (_N_
> acknack_transmit-1_) consecutive HS-DPCCH sub-frames, in the slots allocated
> to the HARQ-ACK as defined in [1] and
>
> \- not attempt to receive any HS-SCCH in HS-SCCH subframes corresponding to
> HS-DPCCH sub-frames in which the ACK/NACK information transmission is
> repeated, nor to receive or decode transport blocks from the HS-PDSCH in HS-
> DSCH sub-frames corresponding to HS-DPCCH sub-frames in which the ACK/NACK
> information transmission is repeated.
>
> When _N_ acknack_transmit_2_ >1 and the UE is configured in Multiflow mode,
> the UE shall:
>
> \- repeat the transmission of the ACK/NACK information for the assisting
> serving cell and if configured the assisting secondary serving cell over the
> next (_N_ acknack_transmit_2-1_) consecutive HS-DPCCH sub-frames, in the
> slots allocated to the HARQ-ACK as defined in [1] and
>
> \- not attempt to receive any HS-SCCH in HS-SCCH subframes corresponding to
> HS-DPCCH sub-frames in which the ACK/NACK information transmission is
> repeated, nor to receive or decode transport blocks from the HS-PDSCH in HS-
> DSCH sub-frames corresponding to HS-DPCCH sub-frames in which the ACK/NACK
> information transmission is repeated.
>
> If ACK or NACK or any combination of ACK and NACK is transmitted in HS-DPCCH
> sub-frame _n_ , and HARQ_preamble_mode = 1 and UE InterTTI ≤
> _N_acknack_transmit_ , then the UE shall:
  * transmit a HARQ Postamble (POST for HS-DPCCH slot format 0 or POST/POST for HS-DPCCH slot format 1) in the slot allocated to HARQ-ACK in HS-DPCCH subframe _n_ \+ 2* _N_acknack_transmit_ \-- 1 (if two HS-DPCCHs are active then a HARQ preamble is sent on each of HS-DPCCH and HS-DPCCH~2~), unless ACK or NACK or PRE or PRE/PRE or any combination of ACK and NACK is to be transmitted in this subframe, and
  * if _N_acknack_transmit_ > 1, transmit a HARQ Postamble in the slot allocated to HARQ-ACK in HS-DPCCH subframe _n_ \+ 2*_N_acknack_transmit_ \-- 2 (if two HS-DPCCHs are active then a HARQ preamble is sent on each of HS-DPCCH and HS-DPCCH~2~), unless an ACK or NACK or PRE or PRE/PRE or any combination of ACK and NACK is to be transmitted in this subframe.
> If the UE is configured in Multiflow mode and ACK or NACK or any combination
> of ACK and NACK is transmitted in HS-DPCCH sub-frame _n_ corresponding to an
> assisting serving or assisting secondary serving cell, and
> HARQ_preamble_mode = 1 and UE InterTTI ≤  _N_acknack_transmit_2_ , then the
> UE shall:
  * transmit a HARQ Postamble (POST/POST for HS-DPCCH slot format 1) in the slot allocated to HARQ-ACK in HS-DPCCH subframe _n_ \+ 2* _N_acknack_transmit_2_ \-- 1, unless ACK or NACK or PRE or PRE/PRE or any combination of ACK and NACK is to be transmitted in this subframe, and
  * if _N_acknack_transmit_ _2> 1, transmit a HARQ Postamble in the slot allocated to HARQ-ACK in HS-DPCCH subframe _n_ \+ 2*_N_acknack_transmit_2_ \-- 2, unless an ACK or NACK or PRE or PRE/PRE or any combination of ACK and NACK is to be transmitted in this subframe.
For the case where Secondary_Cell_Active is less than 4 when the UE is not
configured in MIMO mode with four transmit antennas in any cell or is less
than 2 when the UE is configured in MIMO mode with four transmit antennas in
at least one cell DTX shall be used on the HS-DPCCH in the slot allocated to
HARQ-ACK in the corresponding HS-DPCCH subframe unless a HARQ-ACK message is
to be transmitted as described above.
For the case where Secondary_Cell_Active is greater than 3 when the UE is not
configured in MIMO mode with four transmit antennas in any cell or is greater
than 1 when the UE is configured in MIMO mode with four transmit antennas in
at least one cell DTX shall be used on HS-DPCCH and HS-DPCCH~2~ in the slot
allocated to HARQ-ACK in each of the corresponding HS-DPCCH subframes unless a
HARQ-ACK message is to be transmitted as described above on either of the HS-
DPCCHs. If a HARQ-ACK message is to be transmitted on only one of the active
HS-DPCCHs, the DTX codeword should be repeated in the HARQ-ACK field on the
other HS-DPCCH in the corresponding HS-DPCCH subframe.
### 6A.1.1A UE procedure for receiving HS-DSCH and HS-SCCH in CELL_FACH state
The HS-SCCH reception procedure is as defined in subclause 6A.1.1.
The UE shall perform these actions in the following order:
\- The UE shall monitor the first indexed HS-SCCH of the configured HS-SCCH
set with the BCCH specific H-RNTI.
> \- If the UE is configured with a dedicated H-RNTI, the UE shall monitor the
> HS-SCCHs of the configured HS-SCCH set with the dedicated H-RNTI. If the UE
> is not configured with a dedicated H-RNTI, the UE shall monitor the HS-SCCHs
> of the configured HS-SCCH set with the common H-RNTI as defined in [5].
If the higher layers configure NodeB triggered HS-DPCCH transmission (as
described in [5]) then NT-HS-DPCCH_Enabled is set to TRUE. Otherwise, NT-HS-
DPCCH_Enabled is set to FALSE.
If the UE detects that one HS-SCCH carries consistent control information
intended for this UE, the UE shall perform the following:
\- If the decoded \'channelization-code-set information\' and decoded
'modulation scheme information' do not correspond to an indication of an HS-
SCCH order, start receiving the HS-PDSCHs indicated by this consistent control
information.
\- If the CRC of the HS-SCCH is OK:
  * If the 'channelization-code-set information' and 'modulation scheme information' correspond to an HS-SCCH order as defined in [2] subclause 4.6C.3,
    * if the TFRI value corresponds to an HS-SCCH order, the UE shall process the HS-SCCH orders as described in subclause 6B. If NT-HS-DPCCH_Enabled is TRUE, the UE shall not transmit the associated HARQ-ACK information acknowledging the HS-SCCH order.
    * else, discard the information received on this HS-SCCH
  * Else, the transport block size information shall be derived from the signalled TFRI value as defined in [9]. If the \'Hybrid-ARQ process information\' is not included in the set configured by upper layers, the UE shall discard the information received on this HS-SCCH and on the HS-PDSCHs.
Otherwise, if the UE does not detect consistent control information intended
for this UE on any of the HS-SCCHs, the UE shall discard the information
received on this HS-SCCH and on the HS-PDSCHs.
If HS-DPCCH transmission is indicated by higher layers, the HS-DPCCH
transmission procedure as defined in subclauses 6A.1.1 and 6A.1.2 are
followed. Otherwise, the UE shall not transmit any HARQ-ACK or CQI information
and DTX shall be used on all the HS-DPCCH subframes.
### 6A.1.1B UE procedure for receiving HS-DSCH and HS-SCCH in the URA_PCH and
CELL_PCH states
The HS-SCCH reception procedure is as defined in subclause 6A.1.1.
If the UE has detected a paging indication intended for this UE, the UE shall
perform the actions below:
In CELL_PCH state, if the UE is configured with a dedicated H-RNTI, the UE
shall perform these actions in the following order:
\- The UE shall monitor the first indexed HS-SCCH of the configured HS-SCCH
set with the BCCH specific H-RNTI.
\- The UE shall monitor the HS-SCCHs of the configured HS-SCCH set with the
dedicated H-RNTI.
In CELL_PCH state, if the higher layers configure NodeB triggered HS-DPCCH
transmission (as described in [5]) then NT-HS-DPCCH_Enabled is set to TRUE.
Otherwise, NT-HS-DPCCH_Enabled is set to FALSE.
If the UE is configured with a dedicated H-RNTI, and if the UE detects that
one HS-SCCH in a set of 5 associated HS-SCCH subframes (as defined in [1])
carries consistent control information intended for this UE, the UE shall
perform the following:
\- If the decoded \'channelization-code-set information\' and decoded
'modulation scheme information' do not correspond to an indication of an HS-
SCCH order, start receiving the HS-PDSCHs indicated by this consistent control
information.
\- If the CRC of the HS-SCCH is OK,
  * If the 'channelization-code-set information' and 'modulation scheme information' correspond to an HS-SCCH order as defined in [2] subclause 4.6C.3,
    * if the TFRI value corresponds to an HS-SCCH order, the UE shall process the HS-SCCH orders as described in subclause 6B. If NT-HS-DPCCH_Enabled is TRUE, the UE shall not transmit the associated HARQ-ACK information acknowledging the HS-SCCH order.
    * else, discard the information received on this HS-SCCH
```{=html}
``` \- Else, the transport block size information shall be derived from the
signalled TFRI value as defined in [9]. If the \'Hybrid-ARQ process
information\' is not included in the set configured by upper layers, the UE
shall discard the information received on this HS-SCCH and on the HS-PDSCHs.
If the UE is configured with a dedicated H-RNTI and the UE does not detect
consistent control information intended for this UE on any of the HS-SCCHs,
the UE shall discard the information received on this HS-SCCH and on the HS-
PDSCHs.
In CELL_PCH state, when the UE is configured to receive HS-DSCH without a
dedicated H-RNTI, or in URA_PCH state, the UE shall perform the following:
\- the UE shall start receiving the HS-PDSCH configured for HS-SCCH-less
operation and attempt to decode the HS-DSCH bits of the first associated HS-
DSCH sub-frame (as defined in [1]) and the subsequent repetitions in the
(Number of PCCH transmissions-1) next contiguous HS-DSCH subframes based on
the set of possible HS-DSCH Transport Block Sizes configured by higher layers.
The UE shall not transmit any HARQ-ACK or CQI information and DTX shall be
used on all the HS-DPCCH subframes.
### 6A.1.2 UE procedure for reporting channel quality indication (CQI) and
precoding control indication (PCI)
The UE procedure for reporting PCI/CQI is given in subclause 6A.1.2.1 for the
case when the UE is not configured in MIMO mode and not configured in MIMO
mode with four transmit antennas in any cell, in subclause 6A.1.2.2 for the
case when the UE is configured in MIMO mode in all cells, and in subclause
6A.1.2.3 for the case when the UE is configured in MIMO mode with four
transmit antennas in all cells.
If the UE is configured in MIMO mode in at least one cell, but not in all
cells and is not configured in MIMO mode with four transmit antennas in any
cell, then the overall PCI/CQI reporting procedure shall be the same as if the
UE was configured in MIMO mode in all cells as specified in subclause 6A.1.2.2
except that a CQI value as defined in subclause 6A.2.1 is derived and reported
for the non-MIMO cells.
#### 6A.1.2.1 CQI reporting procedure in case the UE is not configured in MIMO
mode and not configured in MIMO mode with four transmit antennas in any cell
With the exception of the provisions of subclause 6A.3, the following shall
apply when the UE is not configured in MIMO mode and not configured in MIMO
mode with four transmit antennas in any cell:
1) The UE derives the CQI value for the serving HS-DSCH cell as defined in
subclause 6A.2.1.
> If the UE is not configured in Multiflow mode and Secondary_Cell_Active is
> not 0, the UE also derives a CQI value for the activated secondary serving
> HS-DSCH cells as defined in subclause 6A.2.1.
>
> If the UE is configured in the Multiflow mode, the UE also derives the CQI
> values for the assisting serving and any activated secondary serving and
> assisting secondary serving HS-DSCH cells as defined in subclause 6A.2.1.
>
> The CQI report(s) are constructed from the CQI value(s) as specified in [2].
2) For k = 0, the UE shall not transmit the CQI report(s).\ For k > 0 when
DTX_DRX_STATUS is not TRUE, the UE shall transmit the CQI report containing
the CQI value for the serving HS-DSCH cell in each subframe that starts _m_
×256 chips after the start of the associated uplink DPCCH frame with _m_
fulfilling:
${\left( 5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil \right)\text{mod\
{}k}^{'} = 0$ with $k^{'} = k/(2\text{ms})$,
where CFN denotes the connection frame number for the associated DPCH and the
set of five possible values of _m_ is calculated as described in subclause 7.7
in [1].
> For k > 0 when DTX_DRX_STATUS is TRUE, the UE shall transmit the CQI report
> containing the CQI value for the serving HS-DSCH cell as specified in 6C.2
> based on the CQI transmission pattern. The CQI transmission pattern is the
> set of HS-DPCCH subframes whose HS-DPCCH discontinuous transmission radio
> frame number CFN_DRX and subframe number S_DRX, both defined in 6C.3,
> verify:
((5*CFN_DRX - UE_DTX_DRX_Offset + S_DRX ) **MOD** k\') = 0, with $k^{'} =
k/(2\text{ms})$.
3) The UE shall repeat the transmission of the CQI report containing the CQI
value for the serving HS-DSCH cell derived in 1) over the next
_(N_cqi_transmit -- 1)_ consecutive HS-DPCCH sub frames in the slots
respectively allocated to the CQI as defined in [1]. UE does not support the
case of $k^{'}  4b) If Secondary_Cell_Enabled is 7 and Secondary_Cell_Active is 7 the UE
> shall for the activated cells
>
> \- Transmit the CQI report containing the CQI value of the 4^th^ secondary
> serving HS-DSCH cell simultaneously as the CQI report containing the CQI
> value of the serving HS-DSCH cell.
>
> \- Transmit the CQI report containing the CQI value of the 6^th^ secondary
> serving HS-DSCH cell simultaneously as the CQI report containing the CQI
> value of the 2^nd^ secondary serving HS-DSCH cell
>
> \- Transmit the CQI report containing the CQI value of the 5^th^ secondary
> serving HS-DSCH cell simultaneously as the CQI report containing the CQI
> value of the 1^st^ secondary serving HS-DSCH cell
>
> \- Transmit the CQI report containing the CQI value of the 7^th^ secondary
> serving HS-DSCH cell simultaneously as the CQI report containing the CQI
> value of the 3^rd^ secondary serving HS-DSCH cell
>
> The CQI report is transmitted over _(N_cqi_transmit -- 1)_ consecutive HS-
> DPCCH sub frames. The UE does not support the case of $k^{'}  N_{\text{cqi}_{\text{transmit}}}$.
4c) If Secondary_Cell_Enabled is greater than 3 and Secondary_Cell_Active is
less than 7 the UE shall
> \- For HS-DPCCH
>
> \- Transmit the CQI reports in the same slots as it would transmit the CQI
> reports if Secondary_Cell_Enabled is equal to 4 and the 1^st^, 2^nd^ and
> 3^rd^ secondary serving HS-DSCH cell were active.
>
> \- For HS-DPCCH~2~
>
> \- Transmit the CQI report of the 4^th^ secondary serving HS-DSCH cell (if
> present) so that it starts in the same slot as the transmissions of CQI
> report of the serving HS-DSCH starts.
>
> \- If at most one of the 4^th^, 5^th^, 6^th^ or 7^th^ secondary serving HS-
> DSCH cell is deactivated the transmissions of the CQI reports for the active
> secondary serving HS-DSCH cells occurs in the same slots as if
> Secondary_Cell_Active is equal to 7.
>
> \- If at most two of 4^th^, 5^th^, 6^th^ and 7^th^ secondary serving HS-DSCH
> cell are active the transmissions of the CQI reports associated with the
> active secondary serving HS-DSCH cell with lowest index as indicated by
> higher layers is transmitted in the CQI field of the subframe where the
> 4^th^ and 6^th^ secondary serving HS-DSCH cell would be transmitted if
> Secondary_Cell_Active is 7. The CQI report associated with the other
> secondary serving HS-DSCH cell (if present) is always transmitted in the
> subframe(s) immediately following the transmissions of the first CQI report.
>
> The CQI reports transmitted on HS-DPCCH~2~ are always over
> (_N_cqi_transmit-1_) consecutive HS-DPCCH sub frames.
4d) If the UE is configured in the Multiflow mode
4d.1) If the UE is configured with the Serving HS-DSCH and Assisting Serving
HS-DSCH only, and neither of the cells is in MIMO mode, the combined CQI
report is transmitted and repeated as defined in steps 2) and 3) and no other
CQI reports are sent. The CQI reports are constructed from the CQI value(s) as
specified in subclause 4.7.4.3.1, MF case 1 in table 15C.8 of [2]
4d.2) For all other non-MIMO Multiflow configurations,
> \- The UE shall transmit the CQI report(s) associated with the serving HS-
> DSCH cells as defined in step 2).
>
> \- The UE shall transmit the CQI report(s) associated with the assisting
> serving HS-DSCH cells in the next HS-DPCCH subframe immediately following
> the CQI report(s) for the serving HS-DSCH cells
>
> \- The UE shall repeat the transmission of the CQI report(s) associated with
> the serving HS-DSCH cells _(N_cqi_transmit -- 1)_ times in every other HS-
> DPCCH sub frame in the slots allocated to the CQI in accordance with the
> composite CQI report constructed in subclause 4.7.4.3 of [2].
>
> \- The UE shall repeat the transmission of the CQI report(s) associated with
> the assisting serving HS-DSCH cells _(N_cqi_transmit_2-- 1)_ times in every
> other HS-DPCCH sub frame in the slots allocated to the CQI in accordance
> with the composite CQI report constructed in subclause 4.7.4.3 of [2].
>
> \- UE does not support the case of _k'_ \ N_cqi_transmit_2)._
>
> \- The CQI reports are constructed from the CQI value(s) as specified in
> subclause 4.7.4.3, MF cases 3 to 6 and 11 to 14 in tables 15C.10, 15C.11 and
> 15C.14 of [2].
5) The UE shall not transmit CQI reports in other subframes than those
described in 2), 3) , 4a), 4b), 4c) and 4d).
#### 6A.1.2.2 Composite PCI/CQI reporting procedure in case the UE is
configured in MIMO mode
The following types of CQI reports have to be supported by the UE when the UE
is configured in MIMO mode and single-stream restriction is not configured:
A. CQI reports that indicate the supported transport format(s) for the >
number of simultaneously transmitted transport blocks that the UE > prefers
according to the current channel conditions assuming that > the preferred
primary precoding vector as indicated by the PCI > value signalled in the same
HS-DPCCH sub-frame would be applied at > the Node-B for the primary transport
block and in case two > transport blocks are preferred the precoding vector
orthogonal to > the preferred primary precoding vector would be applied for
the > secondary transport block. This type of CQI report contains >
information on either one transport format or a combination of two > transport
formats depending on what is currently the preferred > number of transport
blocks (either 1 or 2).
B. CQI reports that indicate the supported transport format for a > single
transmitted transport block according to the current > channel conditions
assuming that the preferred primary precoding > vector as indicated by the PCI
value signalled in the same > HS-DPCCH sub-frame would be applied at the
Node-B for the primary > transport block and that no secondary transport block
is > transmitted.
When UE is configured in MIMO mode and single-stream restriction is configured
only type B CQI report have to be supported by the UE.
With the exception of the provisions of subclause 6A.3, the following shall
apply when the UE is configured in MIMO mode:
1) The UE derives the PCI value for the serving HS-DSCH cell as defined in
subclause 6A.4.1 and when single-stream restriction is not configured either a
type A or a type B CQI value and when single-stream restriction is configured
type B CQI value for the serving HS-DSCH cell as defined in subclause 6A.2.2
depending on which type of CQI shall be reported as defined below.
> If UE is not configured in Multiflow mode and Secondary_Cell_Active is not
> 0, the UE also derives a PCI value for the activated secondary serving HS-
> DSCH cell(s) as defined in subclause 6A.4 and when single-stream restriction
> is not configured either a type A or a type B CQI value and when single-
> stream restriction is configured type B CQI value for the secondary serving
> HS-DSCH cell as defined in subclause 6A.2.2 depending on which type of CQI
> shall be reported as defined below.
>
> If the UE is configured in the Multiflow mode,
\- the UE also derives a PCI value for the assisting serving and any activated
secondary serving and assisting secondary serving HS-DSCH cells as defined in
subclause 6A.4 if the UE is configured in MIMO mode in that cell,
\- and when single-stream restriction is not configured, either type A or type
B CQI value, and when single-stream restriction is configured, type B CQI
value for the assisting serving and any activated secondary serving and
assisting secondary serving HS-DSCH cells as defined in subclause 6A.2.2
depending on which type of CQI shall be reported.
> The PCI/CQI report(s) in each subframe are constructed from the composite
> PCI/CQI value(s) as specified in [2].
2)
a. For k = 0, the UE shall not transmit a composite PCI/CQI value.
b. For k > 0 when DTX_DRX_STATUS is not TRUE (see subclause 6A.1), the UE
shall transmit the composite PCI/CQI value(s) for the cells in the PCI/CQI
report containing the composite PCI/CQI value for the serving HS-DSCH cell in
each subframe that starts _m_ ×256 chips after the start of the associated
uplink DPCCH frame with _m_ fulfilling
${\left( 5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil \right)\text{mod\
{}k}^{'} = 0$ with $k^{'} = k/(2\text{ms})$, (x1)
> where CFN denotes the connection frame number for the associated DPCH and
> the set of five possible values of _m_ is calculated as described in
> subclause 7.7 in [1].
>
> When single-stream restriction is not configured and the relation
$\left\lfloor \frac{5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil\ }{k^{'}}
\right\rfloor\text{mod}\ M\text{_cqi\ }\  holds, the UE shall report a type A CQI value. Otherwise the UE shall report
> a type B CQI value.
c. For k > 0 when DTX_DRX_STATUS is TRUE (see subclause 6A.1), the UE shall
transmit the CQI value for the cells in the PCI/CQI report containing the
composite PCI/CQI value for the serving HS-DSCH cell as specified in 6C.2
based on the CQI transmission pattern. The CQI transmission pattern is the set
of HS-DPCCH subframes whose HS-DPCCH discontinuous transmission radio frame
number CFN_DRX and subframe number S_DRX, both defined in 6C.3, verify:
((5*CFN_DRX - UE_DTX_DRX_Offset + S_DRX ) mod k\') = 0, with $k^{'} =
k/(2\text{ms})$.
> When single-stream restriction is not configured and the relation
>
> holds, the UE shall report a type A CQI value. Otherwise the UE shall report
> a type B CQI value.
d. For k>0, each PCI value derived in 1) shall be transmitted together with
the corresponding CQI value as a composite PCI/CQI value. It should be noted
that in case that 2560 is not an integer multiple of _M_ _cqi, the sequence of
type A and type B CQI reports might not always be periodic due to CFN roll-
over.
3) The UE shall repeat the transmission of the CQI report containing the
composite PCI/CQI value for the serving HS-DSCH cell derived above over the
next _(N_cqi_transmit -- 1)_ consecutive HS-DPCCH sub frames in the slots
respectively allocated to CQI as defined in [1]. The UE does not support the
case of $k^{'}  4b) If Secondary_Cell_Enabled is 7 and Secondary_Cell_Active is 7 the UE
> shall:
>
> \- Transmit the PCI/CQI report containing the PCI/CQI value of the 4^th^
> secondary serving HS-DSCH cell simultaneously as the PCI/CQI report
> containing the PCI/CQI value of the serving HS-DSCH cell.
>
> \- Transmit the PCI/CQI report containing the PCI/CQI value of the 6^th^
> secondary serving HS-DSCH cell simultaneously as the PCI/CQI report
> containing the PCI/CQI value of the 2^nd^ secondary serving HS-DSCH cell
>
> \- Transmit the PCI/CQI report containing the PCI/CQI value of the 5^th^
> secondary serving HS-DSCH cell simultaneously as the PCI/CQI report
> containing the PCI/CQI value of the 1^st^ secondary serving HS-DSCH cell
>
> \- Transmit the PCI/CQI report containing the PCI/CQI value of the 7^th^
> secondary serving HS-DSCH cell simultaneously as the PCI/CQI report
> containing the PCI/CQI value of the 3^rd^ secondary serving HS-DSCH cell
>
> The PCI/CQI report is transmitted over _(N_cqi_transmit -- 1)_ consecutive
> HS-DPCCH sub frames. The UE does not support the case of $k^{'}  N_{\text{cqi}_{\text{transmit}}}$.
>
> 4c) If Secondary_Cell_Enabled is greater than 3 and Secondary_Cell_Active is
> less than 7 the UE shall:
>
> \- For HS-DPCCH
>
> \- Transmit the PCQ/CQI reports in the same slots as it would transmit the
> PCI/CQI reports if Secondary_Cell_Enabled is equal to 4 and the same of the
> 1^st^, 2^nd^ and 3^rd^ secondary serving HS-DSCH cell were active.
>
> \- For HS-DPCCH~2~
>
> \- Transmit the PCI/CQI report of the 4^th^ secondary serving HS-DSCH cell
> (if present) so that it starts in the same slot as the transmissions of
> PCI/CQI report of the serving HS-DSCH cell starts.
>
> \- If at most one of the 4^th^, 5^th^, 6^th^ or 7^th^ secondary serving HS-
> DSCH cell is deactivated the transmissions of the PCI/CQI reports for the
> active secondary serving HS-DSCH cells occurs in the same slots as if
> Secondary_Cell_Active is equal to 7.
>
> \- If at most two of 4^th^, 5^th^, 6^th^ and 7^th^ secondary serving HS-DSCH
> cell are active the transmissions of the PCI/CQI reports associated with the
> active secondary serving HS-DSCH cell with lowest index as indicated by
> higher layers is transmitted in the PCI/CQI field of the subframe where the
> 4^th^ and 6^th^ secondary serving HS-DSCH cell would be transmitted if
> Secondary_Cell_Active is 7. The PCI/CQI report associated with the other
> secondary serving HS-DSCH cell (if present) is always transmitted in the
> subframe(s) immediately following the transmissions of the first PCI/CQI
> report.
>
> The PCI/CQI reports transmitted on HS-DPCCH~2~ are always over
> (_N_cqi_transmit-1_) consecutive HS-DPCCH sub frames.
4d) If the UE is configured in the Multiflow mode,
> \- The UE shall transmit the PCI/CQI report(s) associated with the serving
> HS-DSCH cells as defined in step 2).
>
> \- The UE shall transmit the PCI/CQI report(s) associated with the assisting
> serving HS-DSCH cells in the next HS-DPCCH subframe immediately following
> the PCI/CQI report(s) for the serving HS-DSCH cells
>
> \- The UE shall repeat the transmission of the PCI/CQI report(s) associated
> with the serving HS-DSCH cells _(N_cqi_transmit -- 1)_ times in every other
> HS-DPCCH sub frame in the slots allocated to the PCI/CQI in accordance with
> the composite PCI/CQI report constructed in subclause 4.7.4.3 of [2].
>
> \- The UE shall repeat the transmission of the PCI/CQI report(s) associated
> with the assisting serving HS-DSCH cells _(N_cqi_transmit_2-- 1)_ times in
> every other HS-DPCCH sub frame in the slots allocated to the PCI/CQI in
> accordance with the composite PCI/CQI report constructed in subclause
> 4.7.4.3 of [2].
>
> \- UE does not support the case of _k'_ \ N_cqi_transmit_2)._
>
> \- _The PCI/CQI reports are constructed from the PCI/CQI value(s) as
> specified in subclause 4.7.4.3,_ MF cases 2, 7...10 and 15...18 in tables
> 15C.9, 15C.12, 15C.13 and 15C.15 of [2].
5) The UE shall not transmit PCI/CQI reports in other subframes than those
described in 2), 3) , 4a), 4b), 4c) and 4d).
#### 6A.1.2.3 Composite NTBP/PCI/CQI reporting procedure in case the UE is
configured in MIMO mode with four transmit antennas
The following types of CQI reports have to be supported by the UE when the UE
is configured in MIMO mode with four transmit antennas:
Type A:
CQI reports that indicate the supported transport format(s) for the number of
simultaneously transmitted transport blocks that the UE prefers according to
the current channel conditions assuming that the preferred precoding matrix as
indicated by the PCI value signalled in the same HS-DPCCH sub-frame would be
applied at the Node-B.
Type B:
CQI reports that indicate the supported transport format for a single
transmitted transport block according to the current channel conditions
assuming that the preferred precoding vector as indicated by the PCI value
signalled in the same HS-DPCCH sub-frame would be applied at the Node-B for
the primary transport block and that no second, third, and fourth transport
blocks are transmitted.
With the exception of the provisions of subclause 6A.3, the following shall
apply when the UE is configured in MIMO mode with four transmit antennas:
1) The UE derives the NTBP, PCI value for the serving HS-DSCH cell as defined
in subclause 6A.4. 2 and either a type A or a type B CQI value for the serving
HS-DSCH cell depending on which type of CQI shall be reported as defined
below.
> If Secondary_Cell_Active is not 0, the UE also derives NTBP, PCI value for
> the activated secondary serving HS-DSCH cell(s) as defined in subclause
> 6A.4.1 and 6A.4.2 and either a type A or a type B CQI value for the
> secondary serving HS-DSCH cell depending on which type of CQI shall be
> reported as defined below.
>
> The NTBP/PCI/CQI report(s) in each subframe are constructed from the
> composite NTBP/PCI/CQI value(s) as specified in [2].
2)
a. For k = 0, the UE shall not transmit a composite NTBP/PCI/CQI value.
b. For k > 0 when DTX_DRX_STATUS is not TRUE (see subclause 6A.1), the UE
shall transmit the composite NTBP/PCI/CQI value(s) for the cells in the
NTBP/PCI/CQI report containing the composite NTBP/PCI/CQI value for the
serving HS-DSCH cell in each subframe that starts _m_ ×256 chips after the
start of the associated uplink DPCCH frame with _m_ fulfilling
${\left( 5 \times \text{CFN} + \left\lceil m \times
\text{256}\text{chip}/\text{7680}\text{chip} \right\rceil \right)\text{mod\
{}k}^{'} = 0$ with $k^{'} = k/(2\text{ms})$, (x1)
> where CFN denotes the connection frame number for the associated DPCH and
> the set of five possible values of _m_ is calculated as described in
> subclause 7.7 in [1].
c. For k > 0 when DTX_DRX_STATUS is TRUE (see subclause 6A.1), the UE shall
transmit the CQI value for the cells in the NTBP/PCI/CQI report containing the
composite NTBP/PCI/CQI value for the serving HS-DSCH cell as specified in 6C.2
based on the CQI transmission pattern. The CQI transmission pattern is the set
of HS-DPCCH subframes whose HS-DPCCH discontinuous transmission radio frame
number CFN_DRX and subframe number S_DRX, both defined in 6C.3, verify:
((5*CFN_DRX - UE_DTX_DRX_Offset + S_DRX ) mod k\') = 0, with $k^{'} =
k/(2\text{ms})$.
d. For k>0, each NTBP/PCI value derived in 1) shall be transmitted together
with the corresponding CQI value as a composite PCI/CQI value. It should be
noted that in case that 2560 is not an integer multiple of _M_ _cqi, the
sequence of type A and type B CQI reports might not always be periodic due to
CFN roll-over.
3) The UE shall repeat the transmission of the CQI report containing the
composite NTBP/PCI/CQI value for the serving HS-DSCH cell derived above over
the next _(N_cqi_transmit -- 1)_ consecutive HS-DPCCH sub frames in the slots
respectively allocated to CQI as defined in [1]. The UE does not support the
case of $k^{'}  4b) If Secondary_Cell_Enabled is 3 and Secondary_Cell_Active is 3 the UE
> shall:
>
> \- Transmit the NTBP/PCI/CQI report containing the NTBP/PCI/CQI value of the
> 2^nd^ secondary serving HS-DSCH cell simultaneously as the NTBP/PCI/CQI
> report containing the NTBP/PCI/CQI value of the serving HS-DSCH cell.
>
> \- Transmit the NTBP/PCI/CQI report containing the NTBP/PCI/CQI value of the
> 3^rd^ secondary serving HS-DSCH cell simultaneously as the NTBP/PCI/CQI
> report containing the NTBP/PCI/CQI value of the 1^st^ secondary serving HS-
> DSCH cell.
>
> The NTBP/PCI/CQI report is transmitted over _(N_cqi_transmit)_ consecutive
> HS-DPCCH sub frames. The UE does not support the case of $k^{'}  N_{\text{cqi}_{\text{transmit}}}$.
5) The UE shall not transmit NTBP/PCI/CQI reports in other subframes than
those described in 2), 3) , 4a) and 4b).
### 6A.1.3 Node B procedure for transmitting the HS-DSCH and HS-SCCH
#### 6A.1.3.1 Node B procedure for transmitting the HS-DSCH and HS-SCCH in the
CELL_DCH state
When transmitting to a UE for which the HS-SCCH_less_mode=1, the Node B shall
use the following procedures:
  * The Node B can always transmit an HS-DSCH transport block using CRC attachment method 1 and HS-SCCH type 1.
  * If HS-SCCH_less_Active is TRUE, the Node B may transmit an HS-DSCH transport block using CRC attachment method 2 and HS-SCCH type 2 according to [2] provided that the size of the transport block belongs to the set of transport block sizes configured for HS-SCCH less operation by higher layers. In this case, a maximum of two retransmissions may be used for each HS-DSCH transport block.
Otherwise,
  * The Node B should always transmit an HS-DSCH transport block using CRC attachment method 1 and
    * HS-SCCH type 1 in a cell where the UE is not configured in MIMO mode and not configured in MIMO mode with four transmit antennas, or
    * HS-SCCH type 3 in a cell where the UE is configured in MIMO mode, or
    * HS-SCCH type 4 in a cell where the UE is configured in MIMO mode with four transmit antennas.
If Node B uses CRC attachment method 1 or CRC attachment method 2 for the
first transmission of a transport block, Node B shall use CRC attachment
method 1 or CRC attachment method 2 respectively for any retransmission of the
transport block.
When transmitting/retransmitting, in a cell where the UE is not configured in
MIMO mode and not configured in MIMO mode with four transmit antennas, a
transport block using CRC attachment method 1 or retransmitting a transport
block to a UE using CRC attachment method 2, the Node B shall transmit the
corresponding control information using HS-SCCH type 1 or HS-SCCH type 2
respectively on one of the HS-SCCHs in the UE's HS-SCCH set.
When transmitting/retransmitting, in a cell where the UE is configured in MIMO
mode, a transport block the Node B shall use CRC attachment method 1 and
transmit the corresponding control information using HS-SCCH type 3 on one of
the HS-SCCHs in the UE's HS-SCCH set.
When transmitting/retransmitting, in a cell where the UE is configured in MIMO
mode with four transmit antennas, the Node B shall use CRC attachment method 1
and transmit the corresponding control information using HS-SCCH type 4 on one
of the HS-SCCHs in the UE's HS-SCCH set.
#### 6A.1.3.2 Node B procedure for transmitting the HS-DSCH and HS-SCCH in the
CELL_FACH state
When transmitting to a UE the Node B shall use the following procedures:
  * The Node B shall always transmit an HS-DSCH transport block using CRC attachment method 1 and HS-SCCH type 1.
  * When transmitting/retransmitting a transport block the Node B shall transmit the corresponding control information using HS-SCCH type 1 on one of the HS-SCCHs in the configured HS-SCCH set. When transmitting/retransmitting a transport block with the BCCH specific H-RNTI, the Node B shall use the first indexed HS-SCCH of the configured HS-SCCH set.
#### 6A.1.3.3 Node B procedure for transmitting the HS-DSCH and HS-SCCH in the
URA_PCH or CELL_PCH state
The timing relation of the PICH frame to the first associated HS-SCCH subframe
and its associated HS-DSCH subframe is described in 7.2A of [1].
In CELL_PCH state, when transmitting with a dedicated H-RNTI or BCCH specific
H-RNTI, the Node B shall use the following procedures:
  * The Node B may transmit HS-SCCH type 1 in any of the 5 HS-SCCH subframes associated with the PICH frame (as defined in [1]), and the corresponding HS-DSCH transport block using CRC attachment method 1 in the associated HS-DSCH subframe. When transmitting with the BCCH specific H-RNTI, the Node B shall use the first indexed HS-SCCH of the configured HS-SCCH set.
  * The Node B may retransmit the HS-DSCH in any of the subsequent sub-frames associated with the PICH (as defined in [1]). All retransmissions shall be sent with HS-SCCH type 1.
  * The Node B may also transmit an HS-SCCH order, as defined in [2] subclause 4.6C.3, in any of the 5 HS-SCCH subframes associated with the PICH frame (as defined in [1]).
In CELL_PCH state, when transmitting to a UE not configured with a dedicated
H-RNTI, or in URA_PCH state, the Node B shall use the following procedures:
  * The Node B shall not transmit an HS-SCCH.
  * The Node B shall transmit an HS-DSCH transport block in the HS-DSCH subframe associated with the first associated HS-SCCH subframe, with the following parameters:
    * QPSK modulation
    * HS-PDSCH channelisation code configured for HS-SCCH less paging operation by higher layers
    * CRC attachment method 1 for the HS-DSCH
    * the size of the transport block belongs to the set of transport block sizes configured for HS-SCCH less paging operation by higher layers.
  * The Node B shall retransmit the HS-DSCH transport block (Number of PCCH transmissions-1) times in the next contiguous subframes without transmitting HS-SCCH.
  * For the first, second, third, fourth and fifth transmissions, the redundancy and constellation version of the HS-DSCH transport block are 0, 2, 5, 6, and 1, respectively.
## 6A.2 Channel quality indicator (CQI) definition
Any overlap between the 3-slot reference period (as defined in either 6A.2.1
or 6A.2.2 or 6A.2.2A) and a DRX period (as defined in subclause 6C.3) shall
not prevent the UE transmitting a CQI report.
### 6A.2.1 CQI definition when the UE is not configured in MIMO mode and not
configured in MIMO mode with four transmit antennas
This definition of CQI applies only when the UE is not configured in MIMO mode
and not configured in MIMO mode with four transmit antennas.
Based on an unrestricted observation interval, the UE shall report the highest
tabulated CQI value for which a single HS-DSCH sub-frame formatted with the
transport block size, number of HS-PDSCH codes and modulation corresponding to
the reported or lower CQI value could be received with a transport block error
probability not exceeding 0.1 in a 3-slot reference period ending 1 slot
before the start of the first slot in which the reported CQI value is
transmitted. Depending on the UE category as derived by higher layers in [5],
either Table 7A, 7B, 7C, 7D, 7E, 7F or 7G should be used.
For the purpose of CQI reporting, the UE shall assume a total received HS-
PDSCH power of $P_{\text{HSPDSCH}} = P_{\text{CPICH}} + \Gamma + \Delta$ in
dB,
where the total received power is evenly distributed among the HS-PDSCH codes
of the reported CQI value, the measurement power offset is signalled by higher
layers and the reference power adjustment $\Delta$is given by Table 7A, 7B,
7C, 7D, 7E, 7F or 7G depending on the UE category.
Further, for the purpose of CQI reporting, the UE shall assume the number of
soft channel bits available in the virtual IR buffer (NIR), and redundancy and
constellation version parameter (XRV) as given by Table 7A, 7B, 7C, 7D, 7E, 7F
or 7G depending on the UE category irrespective of the actual number of HARQ
processes that are configured. The indicated HSDPA category applies
independent of whether the UE is configured in Multiflow mode or not.
If higher layer signalling informs the UE that for the relevant radio link
(i.e. the radio link from the serving HS-DSCH cell in the case of a CQI value
for the serving HS-DSCH cell, or the radio link from a secondary serving HS-
DSCH cell in the case of a CQI value for a secondary serving HS-DSCH cell) it
may use a S-CPICH as a phase reference and the P-CPICH is not a valid phase
reference, is the received power of the S-CPICH used by the UE, otherwise is
the received power of the P-CPICH. In the case of a CQI value for the serving
HS-DSCH cell, if closed loop transmit diversity is used for the radio link
from the serving HS-DSCH cell, denotes the power of the combined received
CPICH from both transmit antennas, determined as if error-free transmitter
weights had been applied to the CPICH, where those weights are determined as
described in subclause 7.2. If STTD is used, denotes the combined CPICH power
received from each transmit antenna and if no transmit diversity is used
denotes the power received from the non diversity antenna.
For the purpose of CQI reporting the UE shall assume that all HS-PDSCH
channelisation codes it may receive from the relevant radio link are under the
same scrambling code as the Common Pilot Channel used to determine .
### 6A.2.2 CQI definition when the UE is configured in MIMO mode
This definition of CQI applies only when the UE is configured in MIMO mode.
Based on an unrestricted observation interval, the UE shall report the highest
tabulated CQI value(s) for which a single HS-DSCH sub-frame formatted with the
set of transport block size(s), number of HS-PDSCH codes and set of
modulation(s) corresponding to the reported CQI value(s) could be received
with individual transport block error probabilities not exceeding 0.1 in a
3-slot reference period ending 1 slot before the start of the first slot in
which the reported CQI value(s) is/are transmitted if the preferred primary
precoding vector as indicated by the PCI value reported in the same HS-DPCCH
sub-frame would be applied at the Node B for the primary transport block and
in case two transport blocks are preferred the precoding vector orthogonal to
the preferred primary precoding vector would be applied for the secondary
transport block. When single-stream restriction is not configured and
depending on the UE category as derived by higher layers [5], either Table 7H,
7I, 7Ia or 7Ib shall be used for dual transport block type A CQI reports, and
either Table 7C, 7D, 7F or 7G shall be used for single transport block type A
or type B CQI reports.
Type A CQI reports are constructed using a CQI value that is computed
according to
$\text{CQI\ } = \left{ \begin{matrix} \text{15\ x\ CQI}_{1} + \ \text{CQI}_{2}
+ \text{31}\ \text{when\ 2\ transport\ blocks\ are\ preferred\ by\ the\ UE} \
\text{CQI}_{S}\ \text{when\ 1\ transport\ block\ is\ preferred\ by\ the\ UE} \
\end{matrix} \right.\ $,
where CQI~1~ indicates the supported transport format according to Table 7H,
7I, 7Ia or 7Ib for the transport block that could be received with the
specified block error probability if it was transmitted with the preferred
primary precoding vector and CQI~2~ indicates the supported transport format
according to Table 7H, 7I, 7Ia or 7Ib for the transport block that could be
received with the specified block error probability if it was transmitted with
the precoding vector orthogonal to the preferred primary precoding vector.
CQI~S~ indicates the supported transport format according to Table 7C, 7D, 7F
or 7G for the transport block that could be received with the specified block
error probability if it was transmitted with the preferred primary precoding
vector.
When single-stream restriction is not configured type B CQI reports are
constructed using the CQI value of the supported transport format according to
Table 7C, 7D, 7F or 7G for the transport block that could be received with the
specified block error probability if it was transmitted with the preferred
primary precoding vector.
When single-stream restriction is configured type B CQI reports are
constructed using the CQI value of the supported transport format according to
Table 7A, 7B, 7C, 7D, 7F or 7G for the transport block that could be received
with the specified block error probability if it was transmitted with the
preferred primary precoding vector.
For the purpose of CQI reporting, the UE shall assume a total transmit power
of HS-PDSCH
$P_{\text{HSPDSCH}} = P_{\text{CPICH}} + \Gamma$ in dB,
where the total transmit power is assumed to be evenly distributed among the
HS-PDSCH codes corresponding to the reported CQI value, and the measurement
power offset is signaled by higher layers. denotes the combined transmit power
of the set of CPICH(s) used for MIMO operation of HS-DSCH.
When single-stream restriction is not configured and if a CQI for a single
transport block is reported, the parameter $\Delta$ that is given by Table 7C,
7D, 7F or 7G depending on the UE category and configuration indicates a
reference power adjustment for the Node B transmit power on the indicated HS-
PDSCH(s). If a CQI for two transport blocks is reported, the parameter
$\Delta$ that is given by Table 7H, 7I, 7Ia or 7Ib depending on the UE
category and configuration indicates by how much the equivalent AWGN symbol
SINR for a specific transport block would be different from the one required
to meet the predicted BLER performance.
When single-stream restriction is configured, the parameter $\Delta$ that is
given by Table 7A, 7B, 7C, 7D, 7F or 7G depending on the UE category and
configuration indicates a reference power adjustment for the Node B transmit
power on the indicated HS-PDSCH(s).
When deriving the CQI value, the UE assumes that the Node B would be using a
uniform power allocation across the number of HS-PDSCH codes corresponding to
the CQI value to be reported. In case the UE reports a CQI for two transport
blocks, it is assumed by the UE that the Node B uses an equal power per HS-
PDSCH code for both of the two transport blocks.
When the Node B schedules the UE with two transport blocks, if the Node B does
not transmit with equal power per used HS-PDSCH code or use different power
per code than indicated by the measurement power offset , it should not assume
that the reported transport block sizes can be received with the specified
block error probabilities or that transmission of two transport blocks is
preferred by the UE.
Further, for the purpose of CQI reporting, the UE shall assume the number of
soft channel bits available in the virtual IR buffer (NIR), and redundancy and
constellation version parameter (Xrv, Xrvpb, or Xrvsb) as given by Table 7A,
7B, 7C, 7D, 7F, 7G, 7H, 7I, 7Ia or 7Ib depending on the UE category and on the
CQI report type irrespective of the actual number of HARQ processes that are
configured.
For the purpose of CQI reporting the UE shall assume that all HS-PDSCH
channelisation codes it may receive are under the same scrambling code as the
set of CPICH(s) used to determine.
### 6A.2.2A CQI definition when the UE is configured in MIMO mode with four
transmit antennas
This definition of CQI applies only when the UE is configured in MIMO mode
with four transmit antennas.
Based on an unrestricted observation interval, the UE shall report the highest
tabulated CQI value(s) for which a single HS-DSCH sub-frame formatted with the
set of transport block size(s), number of HS-PDSCH codes and set of
modulation(s) corresponding to the reported CQI value(s) could be received
with individual transport block error probabilities not exceeding 0.1 in a
3-slot reference period ending 1 slot before the start of the first slot in
which the reported CQI value(s) is/are transmitted if the preferred precoding
matrix as indicated by the PCI value reported in the same HS-DPCCH sub-frame
that would be applied at the Node B on transport blocks as indicated by the
UE. Either Table 7H, 7I, 7Ia or 7Ib shall be used for two, three or four
transport block type A CQI reports, and either Table 7C, 7D, 7F or 7G shall be
used for single transport block type A or type B CQI reports.
Type A CQI reports are constructed using a CQI value that is computed
according to
When the number of transport blocks preferred by the UE is equal to four,
CQI~1~ indicates the supported transport format according to Table 7H, 7I, 7Ia
or 7Ib for the primary and fourth transport blocks that could be received with
the specified block error probability if it was transmitted with the preferred
precoding matrix and CQI~2~ indicates the supported transport format according
to Table 7H, 7I, 7Ia or 7Ib for the second and third transport blocks that
could be received with the specified block error probability if it was
transmitted with the preferred precoding matrix.
When the number of transport blocks preferred by the UE is equal to three,
CQI~1~ indicates the supported transport format according to Table 7H, 7I, 7Ia
or 7Ib for the primary transport block that could be received with the
specified block error probability if it was transmitted with the preferred
precoding matrix and CQI~2~ indicates the supported transport format according
to Table 7H, 7I, 7Ia or 7Ib for the second and third transport blocks that
could be received with the specified block error probability if it was
transmitted with the preferred precoding matrix.
When the number of transport blocks preferred by the UE is equal to two,
CQI~1~ indicates the supported transport format according to Table 7H, 7I, 7Ia
or 7Ib for the primary transport block that could be received with the
specified block error probability if it was transmitted with the preferred
precoding matrix and CQI~2~ indicates the supported transport format according
to Table 7H, 7I, 7Ia or 7Ib for the second transport block that could be
received with the specified block error probability if it was transmitted with
the preferred precoding matrix.
When the number of transport blocks preferred by the UE is equal to one,
CQI~S~ indicates the supported transport format according to Table 7C, 7D, 7F
or 7G for the transport block that could be received with the specified block
error probability if it was transmitted with the preferred precoding vector.
Type B CQI reports are constructed using the CQI value of the supported
transport format according to Table 7C, 7D, 7F or 7G for the transport block
that could be received with the specified block error probability if it was
transmitted with the preferred precoding vector.
When D-CPICH(s) are not activated for data demodulation by Node B, for the
purpose of CQI reporting, the UE shall assume a total transmit power of HS-
PDSCH
$P_{\text{HSPDSCH}} = P_{\text{CPICH}} + \Gamma$ in dB,
where the total transmit power is assumed to be evenly distributed among the
HS-PDSCH codes corresponding to the reported CQI value, and the measurement
power offset is signaled by higher layers. denotes the combined transmit power
of the set of primary and three secondary CPICHs used for MIMO operation of
HS-DSCH.
When D-CPICH(s) are activated for data demodulation by Node B, for the purpose
of CQI reporting, the UE shall assume a total transmit power of HS-PDSCH
$P_{\text{HSPDSCH}} = P_{\text{CPICH}} + \Gamma 1$ in dB,
where the total transmit power is assumed to be evenly distributed among the
HS-PDSCH codes corresponding to the reported CQI value, and the measurement
power offset 1 are signaled by higher layers. denotes the combined transmit
power of the set of primary and three secondary CPICHs used for MIMO operation
of HS-DSCH.
If a CQI for a single transport block is reported, the parameter $\Delta$ that
is given by Table 7C, 7D, 7F or 7G depending on the UE category and
configuration indicates a reference power adjustment for the Node B transmit
power on the indicated HS-PDSCH(s). If a CQI for two or three or four
transport blocks are reported, the parameter $\Delta$ that is given by Table
7H, 7I, 7Ia or 7Ib depending on the UE category and configuration indicates by
how much the equivalent AWGN symbol SINR for a specific transport block would
be different from the one required to meet the predicted BLER performance.
When deriving the CQI value, the UE assumes that the Node B would be using a
uniform power allocation across the number of HS-PDSCH codes corresponding to
the CQI value to be reported. In case the UE reports a CQI for more than one
transport block, it is assumed by the UE that the Node B uses an equal power
per HS-PDSCH code for all the transport blocks.
When the Node B schedules the UE with more than one transport block, if the
Node B does not transmit each transport block with equal power per used HS-
PDSCH code or use different power per code than indicated by the measurement
power offset , it should not assume that the reported transport block sizes
can be received with the specified block error probabilities or that
transmission of more than one transport block is preferred by the UE.
Further, for the purpose of CQI reporting, the UE shall assume the number of
soft channel bits available in the virtual IR buffer (NIR), and redundancy and
constellation version parameter (Xrv, Xrvpb, or Xrvsb) as given by Table 7A,
7B, 7C, 7D, 7F, 7G, 7H, 7I, 7Ia or 7Ib depending on the UE category and on the
CQI report type irrespective of the actual number of HARQ processes that are
configured.
For the purpose of CQI reporting the UE shall assume that all HS-PDSCH
channelisation codes it may receive are under the same scrambling code as the
set of CPICH(s) used to determine.
### 6A.2.3 CQI tables
The CQI mapping table for each UE category and configured mode of operation is
described in Table 7a.
Table 7a: Applicability of CQI mapping tables.
+-------+-------+-------+-------+-------+-------+-------+-----+---+ | Cat | * | | | | | | | | | egory | _Used | | | | | | | | | | CQI | | | | | | | | | | ma | | | | | | | | | | pping | | | | | | | | | | ta | | | | | | | | | | ble_ _| | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | | MIMO | MIMO | * | | | | | | | | not | confi |_ MIMO | | | | | | | | confi | gured | and | | | | | | | | gured | and | sin | | | | | | | | | sin | gle-s | | | | | | | | | gle-s | tream | | | | | | | | | tream | r | | | | | | | | | r | estri | | | | | | | | | estri | ction | | | | | | | | | ction | co | | | | | | | | | not | nfigu | | | | | | | | | confi | red**| | | | | | | | | gured | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | | 64QAM | 64QAM | 64QAM | 64QAM | 64QAM | 64QAM | | | | | | | | | | | | | | | not | confi | not | confi |** not | **co | | | | | confi | gured | confi | gured | co | nfigu | | | | | gured | | gured | | nfigu | red** | | | | | | | | | red** | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | | | | In | In | In | In | | | | | | | case | case | case | case | | | | | | | of | of | of | of | | | | | | | type | dual | type | dual | | | | | | | B or | tran | B or | tran | | | | | | | s | sport | s | sport | | | | | | | ingle | block | ingle | block | | | | | | | tran | type | tran | type | | | | | | | sport | A CQI | sport | A CQI | | | | | | | block | re | block | re | | | | | | | type | ports | type | ports | | | | | | | A CQI | | A CQI | | | | | | | | re | | re | | | | | | | | ports | | ports | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 1-6 | A | N/A | A | N/A | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 7 and | B | N/A | B | N/A | | | | | | 8 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 9 | C | N/A | C | N/A | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 10 | D | N/A | D | N/A | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 11 | E | N/A | | | | | | | | and | | | | | | | | | | 12 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 13 | C | F | N/A | C | F | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 14 | D | G | N/A | D | G | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 15 | C | N/A | C | H | N/A | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 16 | D | N/A | D | I | N/A | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 17 | C | F | C | H | N/A | N/A | F | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 18 | D | G | D | I | N/A | N/A | G | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 19 | C | F | C | H | F | J | N/A | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 20 | D | G | D | I | G | K | N/A | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 21 | C | N/A | C | N/A | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 22 | D | N/A | D | N/A | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 23 | C | F | N/A | C | F | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 24 | D | G | N/A | D | G | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 25 | C | N/A | C | H | N/A | N/A | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 26 | D | N/A | D | I | N/A | N/A | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 27 | C | F | C | H | F | J | N/A | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 28 | D | G | D | I | G | K | N/A | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 29 | D | G | N/A | D | G | | | | | and | | | | | | | | | | 31 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 30 | D | G | D | I | G | K | N/A | | | and | | | | | | | | | | 32 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 33 | D | G | N/A | D | G | | | | | and | | | | | | | | | | 35 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 34 | D | G | D | I | G | K | N/A | | | and | | | | | | | | | | 36 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+ | 37 | D | G | D | I | G | K | N/A | | | and | | | | | | | | | | 38 | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-----+---+
Table 7A: CQI mapping table A.
* * *
CQI value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR Xrv HS-PDSCH
0 N/A Out of range
1 137 1 QPSK 0 9600 0
2 173 1 QPSK 0
3 233 1 QPSK 0
4 317 1 QPSK 0
5 377 1 QPSK 0
6 461 1 QPSK 0
7 650 2 QPSK 0
8 792 2 QPSK 0
9 931 2 QPSK 0
10 1262 3 QPSK 0
11 1483 3 QPSK 0
12 1742 3 QPSK 0
13 2279 4 QPSK 0
14 2583 4 QPSK 0
15 3319 5 QPSK 0
16 3565 5 16-QAM 0
17 4189 5 16-QAM 0
18 4664 5 16-QAM 0
19 5287 5 16-QAM 0
20 5887 5 16-QAM 0
21 6554 5 16-QAM 0
22 7168 5 16-QAM 0
23 7168 5 16-QAM -1
24 7168 5 16-QAM -2
25 7168 5 16-QAM -3
26 7168 5 16-QAM -4
27 7168 5 16-QAM -5
28 7168 5 16-QAM -6
29 7168 5 16-QAM -7
30 7168 5 16-QAM -8
* * *
Table 7B: CQI mapping table B.
* * *
CQI value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR Xrv HS-PDSCH
0 N/A Out of range
1 137 1 QPSK 0 19200 0
2 173 1 QPSK 0
3 233 1 QPSK 0
4 317 1 QPSK 0
5 377 1 QPSK 0
6 461 1 QPSK 0
7 650 2 QPSK 0
8 792 2 QPSK 0
9 931 2 QPSK 0
10 1262 3 QPSK 0
11 1483 3 QPSK 0
12 1742 3 QPSK 0
13 2279 4 QPSK 0
14 2583 4 QPSK 0
15 3319 5 QPSK 0
16 3565 5 16-QAM 0
17 4189 5 16-QAM 0
18 4664 5 16-QAM 0
19 5287 5 16-QAM 0
20 5887 5 16-QAM 0
21 6554 5 16-QAM 0
22 7168 5 16-QAM 0
23 9719 7 16-QAM 0
24 11418 8 16-QAM 0
25 14411 10 16-QAM 0
26 14411 10 16-QAM -1
27 14411 10 16-QAM -2
28 14411 10 16-QAM -3
29 14411 10 16-QAM -4
30 14411 10 16-QAM -5
* * *
Table 7C: CQI mapping table C.
* * *
CQI or CQI~S~ value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR Xrv or Xrvpb HS-PDSCH
0 N/A Out of range
1 137 1 QPSK 0 28800 0
2 173 1 QPSK 0
3 233 1 QPSK 0
4 317 1 QPSK 0
5 377 1 QPSK 0
6 461 1 QPSK 0
7 650 2 QPSK 0
8 792 2 QPSK 0
9 931 2 QPSK 0
10 1262 3 QPSK 0
11 1483 3 QPSK 0
12 1742 3 QPSK 0
13 2279 4 QPSK 0
14 2583 4 QPSK 0
15 3319 5 QPSK 0
16 3565 5 16-QAM 0
17 4189 5 16-QAM 0
18 4664 5 16-QAM 0
19 5287 5 16-QAM 0
20 5887 5 16-QAM 0
21 6554 5 16-QAM 0
22 7168 5 16-QAM 0
23 9719 7 16-QAM 0
24 11418 8 16-QAM 0
25 14411 10 16-QAM 0
26 17237 12 16-QAM 0
27 17237 12 16-QAM -1
28 17237 12 16-QAM -2
29 17237 12 16-QAM -3
30 17237 12 16-QAM -4
* * *
Table 7D: CQI mapping table D.
* * *
CQI or CQI~S~ value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR Xrv or Xrvpb HS-PDSCH
0 N/A Out of range
1 137 1 QPSK 0 28800 0
2 173 1 QPSK 0
3 233 1 QPSK 0
4 317 1 QPSK 0
5 377 1 QPSK 0
6 461 1 QPSK 0
7 650 2 QPSK 0
8 792 2 QPSK 0
9 931 2 QPSK 0
10 1262 3 QPSK 0
11 1483 3 QPSK 0
12 1742 3 QPSK 0
13 2279 4 QPSK 0
14 2583 4 QPSK 0
15 3319 5 QPSK 0
16 3565 5 16-QAM 0
17 4189 5 16-QAM 0
18 4664 5 16-QAM 0
19 5287 5 16-QAM 0
20 5887 5 16-QAM 0
21 6554 5 16-QAM 0
22 7168 5 16-QAM 0
23 9719 7 16-QAM 0
24 11418 8 16-QAM 0
25 14411 10 16-QAM 0
26 17237 12 16-QAM 0
27 21754 15 16-QAM 0
28 23370 15 16-QAM 0
29 24222 15 16-QAM 0
30 25558 15 16-QAM 0
* * *
Table 7E: CQI mapping table E.
* * *
CQI value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR Xrv HS-PDSCH
0 N/A Out of range
1 137 1 QPSK 0 4800 0
2 173 1 QPSK 0
3 233 1 QPSK 0
4 317 1 QPSK 0
5 377 1 QPSK 0
6 461 1 QPSK 0
7 650 2 QPSK 0
8 792 2 QPSK 0
9 931 2 QPSK 0
10 1262 3 QPSK 0
11 1483 3 QPSK 0
12 1742 3 QPSK 0
13 2279 4 QPSK 0
14 2583 4 QPSK 0
15 3319 5 QPSK 0
16 3319 5 QPSK -1
17 3319 5 QPSK -2
18 3319 5 QPSK -3
19 3319 5 QPSK -4
20 3319 5 QPSK -5
21 3319 5 QPSK -6
22 3319 5 QPSK -7
23 3319 5 QPSK -8
24 3319 5 QPSK -9
25 3319 5 QPSK -10
26 3319 5 QPSK -11
27 3319 5 QPSK -12
28 3319 5 QPSK -13
29 3319 5 QPSK -14
30 3319 5 QPSK -15
* * *
Table 7F: CQI mapping table F.
* * *
CQI value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR XRV HS-PDSCH
0 N/A Out of range
1 136 1 QPSK 0 43200 0
2 176 1 QPSK 0
3 232 1 QPSK 0
4 320 1 QPSK 0
5 376 1 QPSK 0
6 464 1 QPSK 0
7 648 2 QPSK 0
8 792 2 QPSK 0
9 928 2 QPSK 0
10 1264 3 QPSK 0
11 1488 3 QPSK 0
12 1744 3 QPSK 0
13 2288 4 QPSK 0
14 2592 4 QPSK 0
15 3328 5 QPSK 0
16 3576 5 16-QAM 0
17 4200 5 16-QAM 0
18 4672 5 16-QAM 0
19 5296 5 16-QAM 0
20 5896 5 16-QAM 0
21 _6568_ _5_ _16-QAM_ 0
22 _7184_ _5_ _16-QAM_ 0
23 _9736_ _7_ _16-QAM_ 0
24 _11432_ _8_ _16-QAM_ 0
25 _14424_ _10_ _16-QAM_ 0
26 _15776_ _10_ _64-QAM_ 0
27 _21768_ _12_ _64-QAM_ 0
28 _26504_ _13_ _64-QAM_ 0
29 _32264_ _14_ _64-QAM_ 0
30 32264 _14_ _64-QAM_ -2
* * *
Table 7G: CQI mapping table G.
* * *
CQI value Transport Block Size Number of\ Modulation Reference power
adjustment ∆ NIR XRV HS-PDSCH
0 N/A Out of range
1 136 1 QPSK 0 43200 0
2 176 1 QPSK 0
3 232 1 QPSK 0
4 320 1 QPSK 0
5 376 1 QPSK 0
6 464 1 QPSK 0
7 648 2 QPSK 0
8 792 2 QPSK 0
9 928 2 QPSK 0
10 1264 3 QPSK 0
11 1488 3 QPSK 0
12 1744 3 QPSK 0
13 2288 4 QPSK 0
14 2592 4 QPSK 0
15 3328 5 QPSK 0
16 3576 5 16-QAM 0
17 4200 5 16-QAM 0
18 4672 5 16-QAM 0
19 5296 5 16-QAM 0
20 5896 5 16-QAM 0
21 _6568_ _5_ _16-QAM_ 0
22 _7184_ _5_ _16-QAM_ 0
23 _9736_ _7_ _16-QAM_ 0
24 _11432_ _8_ _16-QAM_ 0
25 _14424_ _10_ _16-QAM_ 0
26 _15776_ _10_ _64-QAM_ 0
27 _21768_ _12_ _64-QAM_ 0
28 _26504_ _13_ _64-QAM_ 0
29 _32264_ _14_ _64-QAM_ 0
30 _38576_ _15_ _64-QAM_ 0
* * *
Table 7H: CQI mapping table H.
* * *
CQI~1~\ Transport Block Size Number of\ Modulation Equivalent AWGN SINR
difference ∆ NIR Xrvpb or Xrvsb or\ HS-PDSCH  
CQI~2~
0 4581 15 QPSK -3.00 28800 0
1 4581 15 QPSK -1.00
2 5101 15 QPSK 0
3 6673 15 QPSK 0
4 8574 15 QPSK 0
5 10255 15 QPSK 0
6 11835 15 QPSK 0
7 14936 15 16QAM 0
8 17548 15 16QAM 0
9 20617 15 16QAM 0
10 23370 15 16QAM 0
11 23370 15 16QAM 1.50
12 23370 15 16QAM 2.50
13 23370 15 16QAM 4.00
14 23370 15 16QAM 5.00
* * *
Table 7I: CQI mapping table I.
* * *
CQI~1~\ Transport Block Size Number of\ Modulation Equivalent AWGN SINR
difference ∆ NIR Xrvpb or Xrvsb or\ HS-PDSCH  
CQI~2~
0 4581 15 QPSK -3.00 28800 0
1 4581 15 QPSK -1.00
2 5101 15 QPSK 0
3 6673 15 QPSK 0
4 8574 15 QPSK 0
5 10255 15 QPSK 0
6 11835 15 QPSK 0
7 14936 15 16QAM 0
8 17548 15 16QAM 0
9 20617 15 16QAM 0
10 23370 15 16QAM 0
11 25558 15 16QAM 0
12 26969 15 16QAM 0
13 27456 15 16QAM 0
14 27952 15 16QAM 0
* * *
Table 7Ia: CQI mapping table J.
* * *
CQI~1~\ Transport Block Size Number of\ Modulation Equivalent AWGN SINR
difference ∆ NIR Xrvpb or Xrvsb or\ HS-PDSCH  
CQI~2~
0 4592 15 QPSK -3.00 43200 0
1 4592 15 QPSK -1.00
2 5296 15 QPSK 0
3 7312 15 QPSK 0
4 9392 15 QPSK 0
5 11032 15 QPSK 0
6 14952 15 16QAM 0
7 17880 15 16QAM 0
8 21384 15 16QAM 0
9 24232 15 16QAM 0
10 27960 15 64QAM 0
11 32264 15 64QAM 0
12 32264 15 64QAM 2
13 32264 15 64QAM 4
14 32264 15 64QAM 6
* * *
Table 7Ib: CQI mapping table K.
* * *
CQI~1~\ Transport Block Size Number of\ Modulation Equivalent AWGN SINR
difference ∆ NIR Xrvpb or Xrvsb or\ HS-PDSCH  
CQI~2~
0 4592 15 QPSK -3.00 43200 0
1 4592 15 QPSK -1.00
2 5296 15 QPSK 0
3 7312 15 QPSK 0
4 9392 15 QPSK 0
5 11032 15 QPSK 0
6 14952 15 16QAM 0
7 17880 15 16QAM 0
8 21384 15 16QAM 0
9 24232 15 16QAM 0
10 27960 15 64QAM 0
11 32264 15 64QAM 0
12 36568 15 64QAM 0
13 39984 15 64QAM 0
14 42192 15 64QAM 0
* * *
## 6A.3 Operation during compressed mode on the associated DPCH or F-DPCH
During compressed mode on the associated DPCH or F-DPCH, and the Secondary
Cell Active is 0, or the Secondary Cell Active is not 0 and the compressed
mode is applied to the serving HS-DSCH cell and all the secondary serving HS-
DSCH cells, the following applies for the UE for transmission of HS-DPCCH and
reception of HS-SCCH and HS-PDSCH:
  * The UE shall neglect a HS-SCCH or HS-PDSCH transmission, if a part of the HS-SCCH or a part of the corresponding HS-PDSCH overlaps with a downlink transmission gap on the associated DPCH or F-DPCH. In this case, neither ACK, nor NACK shall be transmitted by the UE to respond to the corresponding downlink transmission.
  * If a part of a HS-DPCCH slot allocated to HARQ-ACK overlaps with an uplink transmission gap on the associated DPCH, the UE shall use DTX on the HS-DPCCH in that HS-DPCCH slot.
  * If in a HS-DPCCH sub-frame a part of a slot allocated for CQI information overlaps with an uplink transmission gap on the associated DPCH, the UE shall not transmit that CQI or composite PCI/CQI information in that sub-frame (if HS-DPCCH slot format 0 is used) or in that slot (if HS-DPCCH slot format 1 is used).
  * If a CQI report or a composite PCI/CQI report is scheduled in the current CQI field according to subclause 6A.1.2.1 paragraph (2) or subclause 6A.1.2.2 paragraph (2), and the corresponding 3-slot reference period (as defined in subclause 6A.2.1 or subclause 6A.2.2) wholly or partly overlaps a downlink transmission gap, then the UE shall use DTX in the current CQI field and in the CQI fields in the next (_N_cqi_transmit_ \--1) subframes.
During compressed mode, when Secondary_Cell_Active is not 0 and the compressed
mode is not applied to all the active cells, the following applies for the UE
for transmission of HS-DPCCH and reception of HS-SCCH and HS-PDSCH on the
cell(s) in which the compressed mode is applied:
  * The UE shall neglect a HS-SCCH or HS-PDSCH transmission on a cell, if a part of the HS-SCCH or a part of the corresponding HS-PDSCH overlaps with a downlink transmission gap on that cell. In this case, neither ACK, nor NACK shall be transmitted by the UE to respond to the corresponding downlink transmission.
  * If a CQI report or a composite PCI/CQI report for a cell is scheduled in the current CQI field according to subclause 6A.1.2.1 paragraph (2) or subclause 6A.1.2.2 paragraph (2), and the corresponding 3-slot reference period (as defined in subclause 6A.2.1 or subclause 6A.2.2) wholly or partly overlaps a downlink transmission gap on that cell, then the UE shall use DTX in the current CQI field and in the CQI fields in the next (_N_cqi_transmit_ \--1) subframes if using DTX in the CQI field is possible. In the case that using DTX in the CQI field is not possible due to the need to transmit a CQI or a composite PCI/CQI report of another cell not experiencing a compressed mode gap, the UE shall transmit a CQI or a composite PCI/CQI report based on measurements prior to the start of the compressed mode gap for the cell experiencing the compressed mode gap.
During compressed mode, when the UE is configured in Multiflow mode,
  * For the assisting serving HS-DSCH cell: The UE shall follow the same compressed mode rules that are defined for the serving HS-DSCH cell.
  * For the assisting secondary serving cell, if present: The UE shall follow the same compressed mode rules that are defined for the secondary serving HS-DSCH cell.
## 6A.4 Precoding control indication (PCI) definition
### 6A.4.1 PCI definition when the UE is configured in MIMO mode
The UE uses the CPICH(s) transmitted from antenna 1 and antenna 2 to calculate
the preferred precoding vectors to be applied at Node B to maximise the
aggregate transport block size that could be supported under current channel
conditions. No matter whether one or two transport blocks are preferred, it is
sufficient to signal from the UE to the Node B only the preferred primary
precoding vector $\left( w_{1}^{\text{pref}},w_{2}^{\text{pref}} \right)$,
since the optional secondary precoding vector will be a unique function of the
primary one. When single-stream restriction is not configured the information
on whether one or two transport blocks are preferred is part of the CQI
reporting as defined in subclause 6A.2.2. Since the first precoding weight
$w_{1}^{\text{pref}}$of the preferred primary precoding vector $\left(
w_{1}^{\text{pref}},w_{2}^{\text{pref}} \right)$ is constant, it is sufficient
to determine the precoding weight for antenna 2\. In each TTI during which the
UE derives a composite PCI/CQI report, the UE shall calculate the optimum
precoding weight $w_{2}^{\text{pref}}$for antenna 2.
If the UE is not configured with precoding weight set restriction by the
higher layers, the optimum precoding weight $w_{2}^{\text{pref}}$ for antenna
2 is taken from the set:
$w_{2}^{\text{pref}} \in \begin{Bmatrix} \frac{1 + j}{2} & \frac{1 - j}{2} &
\frac{- 1 + j}{2} & \frac{- 1 - j}{2} \ \end{Bmatrix}$.
If the UE is configured with precoding weight set restriction by the higher
layers, the optimum precoding vector weight $w_{2}^{\text{pref}}$ for antenna
2 is taken from the set as defined in table 7J0.
Table 7J0 : Selection of the precoding weight set when the precoding weight
set restriction is configured by higher layers
* * *
**Number of Transport Blocks preferred in the composite PCI/CQI report**
**Precoding weight set from which the optimum precoding weight**
$w_{2}^{\text{pref}}$ **for antenna 2 is taken.** 1 (always the case when
single-stream restriction is configured to the UE)  
2
* * *
The precoding weight $w_{2}^{\text{pref}}$is mapped to PCI values as defined
in table 7J.
Table 7J : Mapping of preferred precoding weight $w_{2}^{\text{pref}}$to PCI
values.
* * *
     PCI value
     0
     1
     2
     3
* * *
### 6A.4.2 PCI definition when the UE is configured in MIMO mode with four
transmit antennas
This section applies only when the UE is configured in MIMO mode with four
transmit antennas.
The UE uses the CPICHs transmitted from antenna 1, antenna 2, antennas 3 and
antenna 4 to calculate the preferred precoding matrix to be applied at Node B
to maximise the aggregate transport block sizes that could be supported under
current channel conditions.
The preferred precoding information PCI (_pci~0~_ , _pci~1~_ , _pci~2~_ ,
_pci~3~_) is defined as the precoding weight information in subclause 4.6D.2.7
of [2] with the following PCI mapping to table 14B.7:
_pci~0~_ , _pci~1~_ , _pci~2~_ , _pci~3~ = x~pwibp,1~_ , _x~pwibp,2~_ ,
_x~pwibp,3~_ , _x~pwibp,4~_.
The number of transport blocks corresnponding corresponding to table 14B.7
used in the PCI derivation corresponds to the number of transport blocks
preferred (NTBP) reported in the composite NTBP/PCI/CQI report carrying the
corresponding NTBP.
# 6B E-DCH related procedures
The following physical layer parameters are signalled to the UE from higher
layers:
1) E-HICH set to be monitored for each uplink frequency for which E-DCH is
configured
2) E-RGCH set to be monitored for each uplink frequency for which E-DCH is
configured
If the UE is configured with multiple uplink frequencies, then the
Secondary_EDCH_Cell_Enabled is 1, otherwise Secondary_EDCH_Cell_Enabled is 0
and Secondary_EDCH_Cell_Active is 0.
The Secondary_EDCH_Cell_Active shall be set according to the following rules:
  * Secondary_EDCH_Cell_Active is set to 0 when Secondary_EDCH_Cell_Enabled is 0 or Secondary_Cell_Active is 0 (as described in subclause 6A.1).
  * Secondary_EDCH_Cell_Active shall remain set to 0, when Secondary_EDCH_Cell_Enabled is changed from 0 to 1.
  * Secondary_EDCH_Cell_Active shall be set to 0 or 1, upon the reception of HS-SCCH orders to deactivate or activate the secondary uplink carrier respectively as specified in [2] when Secondary_EDCH_Cell_Enabled is 1 and Secondary_Cell_Active is not 0 (as described in subclause 6A.1) and the 1^st^ secondary serving HS-DSCH cell is activated.
  * Secondary_EDCH_Cell_Active shall be set to 0 or 1, upon the reception of HS-SCCH orders to deactivate or activate both the secondary uplink carrier and the 1^st^ secondary serving HS-DSCH cell as specified in [2] when Secondary_EDCH_Cell_Enabled is 1 (as described in subclause 6A.1).
  * Secondary_EDCH_Cell_Active can be set to 0 by higher layers (as described in [5]).
Secondary_EDCH_Cell_Active shall be set to 1 while Secondary_EDCH_Cell_Enabled
is 1, Secondary_Cell_Active is not 0,1^st^ secondary serving HS-DSCH cell is
activated, and the secondary uplink frequency is activated, otherwise
Secondary_EDCH_Cell_Active shall be set to 0. If the
Secondary_EDCH_Cell_Active is already equal to 1 when the UE receives an HS-
SCCH order for activation of the secondary uplink frequency as specified in
[2], then the UE shall not change the status of Secondary_EDCH_Cell_Active
regarding the contents of the order, but shall transmit the HARQ-ACK
acknowledging the HS-SCCH order.
HS-SCCH ordered deactivation or activation of the secondary uplink frequency
is applied by the UE at the same point in time as in the case of HS-SCCH
ordered deactivation and activation of the secondary serving HS-DSCH cell for
a UE configured with multiple uplink frequencies (see subclause 6A.1).
If higher layers set READY_FOR_COMMON_ERGCH to TRUE (as described in [5]) then
Common_RGCH_Enabled is TRUE. Otherwise, Common_RGCH_Enabled is FALSE.
If higher layers configure concurrent deployment of 2ms and 10ms TTI in a cell
(as described in [5]) then Concurrent_TTI_Deployment_Enabled is TRUE.
Otherwise, Concurrent_TTI_Deployment_Enabled is FALSE.
If higher layers set READY_FOR_FALLBACK_R99_PRACH to TRUE (as described in
[5]) then Fallback_R99_Enabled is TRUE. Otherwise, Fallback_R99_Enabled is
FALSE.
If NT-HS-DPCCH_Enabled is TRUE, the UE shall inform higher layers about the
reception of an HS-SCCH order and the order type.
## 6B.1 ACK/NACK detection
For each activated uplink frequency, the physical layer in the UE shall detect
ACK or NACK within the E-HICH set that is monitored by the UE in the subframes
where ACK/NACK is transmitted by the UTRAN and deliver the ACK/NACK to the
higher layers as follows:
  * When a UE is not in soft handover, an ACK shall be delivered to the higher layers if a reliable ACK is detected by the physical layer in the UE, else a NACK shall be delivered to the higher layers.
  * When a UE is in soft handover, multiple ACK/NACKs may be received in an E-DCH TTI from different cells in the active set. In some cases, the UE has the knowledge that some of the transmitted ACK/NACKs are the same. This is the case when the radio links are in the same radio link set. For these cases, ACK/NACKs from the same radio link set shall be soft combined into one ACK/NACK information and delivered to higher layers. If a radio link set contains only one radio link, the detection shall be done as specified above for the case where the UE is not in soft handover. For each radio link set containing multiple radio links, an ACK shall be delivered to the higher layers if a reliable ACK is detected by the physical layer in the UE after soft combining, else a NACK shall be delivered to the higher layers.
## 6B.2 Relative grants detection
In CELL_DCH state, for each activated uplink frequency, the physical layer in
the UE shall detect relative grants within the E-RGCH set that is monitored by
the UE and deliver the relative grants to the higher layers as follows:
  * When a UE is not in soft handover, an UP shall be delivered to the higher layers if a reliable UP is detected by the physical layer in the UE, else a DOWN shall be delivered to the higher layers if a reliable DOWN is detected by the UE, else a HOLD shall be delivered to the higher layers.
  * When a UE is in soft handover, multiple relative grants may be received in an E-DCH TTI from different cells in the E-DCH active set. The UE shall handle the E-RGCH received from these cells as follows:
    * If the E-DCH serving radio link set contains only one radio link, the detection shall be done as specified above for the case where the UE is not in soft handover. If the E-DCH serving radio link set contains more than one radio link, the relative grants from the E-DCH serving radio link set are the same and shall be soft combined into one single relative grant information; an UP shall be delivered to the higher layers if a reliable UP is detected by the physical layer in the UE after soft combining, else a DOWN shall be delivered to the higher layers if a reliable DOWN is detected by the UE after soft combining, else a HOLD shall be delivered to the higher layers.
    * Furthermore, for each relative grant received from a radio link which does not belong to the E-DCH serving radio link set, a DOWN shall be delivered to the higher layers if a reliable DOWN is detected by the UE, else a HOLD shall be delivered to the higher layers. The UE shall not soft combine relative grants received from radio links which do not belong to the E-DCH serving radio link set.
In CELL_FACH state, if Common_RGCH_Enabled is TRUE, the physical layer in the
UE shall detect relative grants within the E-RGCH set that is monitored by the
UE and deliver the relative grants to the higher layers as follows:
  * Multiple relative grants may be received in an E-DCH TTI from different cells that do not belong to the E-DCH serving radio link set. For each relative grant received from a cell, a DOWN shall be delivered to the higher layers if a reliable DOWN is detected by the physical layer in the UE, else a HOLD shall be delivered to the higher layers. The UE shall not soft combine relative grants received from any of the cells.
## 6B.3 E-DCH control timing
In subclauses 6B.3.1 and 6B.3.2 the word \"first\" refers to the earliest
point in time.
### 6B.3.1 10 ms E-DCH TTI
For each cell in the E-DCH active set, the UE shall associate the control data
received in the E-HICH frame associated with SFN _i_ to the data transmitted
in the E‑DPDCH frame associated with SFN  _i-3_.
For each cell which belongs to the serving E-DCH radio link set, the UE shall
first take into account E-DCH control data received in the E-RGCH frame
associated with SFN _i_ in the higher layer procedures which correspond to
E-DCH transmission in the E-DPDCH frame associated with SFN  _i+1_.
For each cell which does not belong to the serving E-DCH radio link set the UE
shall first take into account E-DCH control data received in the E-RGCH frame
associated with SFN  _i_ in the higher layer procedures which correspond to
E-DCH transmission in the E-DPDCH frame associated with SFN _i+1+s_ where:
The UE shall first take into account E-DCH control data received in the E-AGCH
frame associated with SFN  _i_ in the higher layer procedures which correspond
to E-DCH transmission in the E-DPDCH frame associated with SFN _i+1+s_ where:
When a downlink F-DPCH is configured, $\tau_{\text{DPCH},n} = \tau_{F -
\text{DPCH},n}$.
### 6B.3.2 2 ms E-DCH TTI
For each cell in the E-DCH active set, the UE shall associate the E-DCH
control data received in sub-frame _j_ of the E-HICH frame associated with SFN
_i_ to sub-frame _t_ of the E‑DPDCH frame associated with SFN  _i-s_ where:
$s = 1 - \left\lfloor j/3 \right\rfloor$, and $t = \left( j + 2
\right)\text{mod}5$
For each cell which belongs to the serving E-DCH radio link set, the UE shall
first take into account E-DCH control data received in sub-frame _j_ of the
E-RGCH frame associated with SFN _i_ in the higher layer procedures which
correspond to E-DCH transmission in sub-frame _j_ of the E-DPDCH frame
associated with SFN  _i+1_.
For each cell which does not belong to the serving E-DCH radio link set the UE
shall first take into account E-DCH control data received in the E-RGCH frame
associated with SFN  _i_ in the higher layer procedures which correspond to
E-DCH transmission in sub-frame _t_ of the E-DPDCH frame associated with SFN
_i+1+s_ where:
$s = \left\lfloor \frac{\left\lceil \frac{\text{160} - \left(
\tau_{\text{DPCH},n}/\text{256} \right)}{\text{30}} \right\rceil}{5}
\right\rfloor$, and $t = \left\lceil \frac{\text{160} - \left(
\tau_{\text{DPCH},n}/\text{256} \right) - \text{150}s}{\text{30}}
\right\rceil$
The UE shall first take into account E-DCH control data received in sub-frame
_j_ of the E-AGCH frame associated with SFN  _i_ in the higher layer
procedures which correspond to E-DCH transmission in sub-frame _t_ of the
E-DPDCH frame associated with SFN _i+s_ where:
$s = \left\lfloor \frac{\left\lceil \frac{\text{30}j + \text{100} - \left(
\tau_{\text{DPCH},n}/\text{256} \right)}{\text{30}} \right\rceil}{5}
\right\rfloor$, and $t = \left\lceil \frac{\text{30}j + \text{100} - \left(
\tau_{\text{DPCH},n}/\text{256} \right) - \text{150}s}{\text{30}}
\right\rceil$
The same relationship applies for E-ROCH to S-E-DPDCH timing relationship as
is defined above for the E-AGCH to E-DPDCH timing relationship.
When a downlink F-DPCH is configured, $\tau_{\text{DPCH},n} = \tau_{F -
\text{DPCH},n}$.
## 6B.4 Operation during compressed mode
### 6B.4.1 Uplink compressed mode
When E‑DCH TTI length is 2 ms, the UE shall not transmit E‑DCH data in a TTI
which fully or partly overlaps with an uplink transmission gap.
Handling of uplink compressed mode when the E-DCH TTI is 10msec is described
in [2].
### 6B.4.2 Downlink compressed mode
The following applies for the UE for reception of E-HICH, E-RGCH and E-AGCH,
during compressed mode on the DPCH or F-DPCH:
> \- A UE shall decode E-HICH, E-RGCH, E-ROCH or E-AGCH transmissions to the
> UE using all the slots which do not overlap a downlink transmission gap.
>
> \- The UE may discard E-HICH, E-RGCH, E-ROCH or E-AGCH slots which overlap a
> downlink transmission gap.
# 6C Discontinuous transmission and reception procedures
Whether discontinuous uplink DPCCH transmission operation or discontinuous
downlink reception operation are applied is determined by the settings of
UL_DTX_Active and DL_DRX_Active as follows:
UL_DTX_Active shall be set to TRUE while UE_DTX_DRX_Enabled is TRUE and
discontinuous uplink DPCCH transmission is activated. Otherwise, UL_DTX_Active
shall be set to FALSE.
Discontinuous uplink DPCCH transmission shall be activated at the time when
UE_DTX_DRX_Enabled is set to TRUE, and may be further deactivated or activated
by layer 1 HS-SCCH orders (see subclause 6C.4).
DL_DRX_Active shall be set to TRUE while UE_DTX_DRX_Enabled is TRUE and
UL_DTX_Active is TRUE and discontinuous downlink reception is activated.
Otherwise, DL_DRX_Active shall be set to FALSE.
Discontinuous downlink reception shall be activated at the time when
UE_DTX_DRX_Enabled is set to TRUE, and may be further deactivated or activated
by layer 1 HS-SCCH orders (see subclause 6C.4).
The higher layers define the discontinuous transmission and reception
procedures using the following parameters:
For discontinuous UL DPCCH transmission:
**CQI_DTX_TIMER** : Specifies the number of subframes during which the CQI
reports have higher priority than the DTX pattern. This is the initial value
of CQI nominal reporting timer.
**UE_DTX_cycle_1** : Uplink DPCCH burst pattern length in subframes.
**UE_DTX_cycle_2** : Uplink DPCCH burst pattern length in subframes.
**Inactivity_Threshold_for_UE_DTX_cycle_2** : Defines a number of consecutive
E-DCH TTIs without an E-DCH transmission, after which the UE shall immediately
move from UE_DTX_cycle_1 to using UE_DTX_cycle_2.
**UE_DPCCH_burst_1** : Determines the Uplink DPCCH burst length in subframes,
when UE_DTX_cycle_1 is applied.
**UE_DPCCH_burst_2** : Determines the Uplink DPCCH burst length in subframes,
when UE_DTX_cycle_2 is applied.
**UE_DTX_long_preamble_length** : Determines in slots the length of the
preamble associated with the UE_DTX_cycle_2.
For both discontinuous UL DPCCH transmission and discontinuous downlink
reception:
**UE_DTX_DRX Offset** : Uplink DPCCH burst pattern and HS-SCCH reception
pattern offset in subframes.
**Enabling_Delay** : defined in [5], ensures that the uplink DPCCH, the
downlink F-DPCH and, if configured, the downlink F-TPICH are transmitted
continuously for Enabling_Delay radio frames after DTX_DRX_STATUS is set to
TRUE or ensures that, with DTX_DRX_STATUS set to TRUE[,]{.underline} the
uplink DPCCH on the secondary uplink frequency is transmitted continuously for
Enabling_Delay radio frames after application of secondary uplink frequency
activation.
For discontinuous downlink reception:
**UE_DRX cycle** : HS-SCCH reception pattern length in subframes.
**Inactivity_Threshold_for_UE_DRX_cycle** : Defines the number of subframes
after an HS-SCCH reception or after the first slot of an HS-PDSCH reception
(as defined in 6C.3) during which the UE is required to monitor the HS-SCCHs
in the UE's HS-SCCH set continuously with the exceptions of
N_acknack_transmit>1 or N_acknack_transmit_2 >1 when the UE is configured in
multiflow mode or InterTTI>1.
**UE_DRX_Grant_Monitoring** : A Boolean which determines whether the UE is
required to monitor the E-AGCH and E-ROCH transmissions from the serving E-DCH
cell and the E-RGCH from cells in the serving E-DCH radio link set when the
conditions in subclause 6C.3 are met.
## 6C.1 Uplink CQI transmission
When UL_DTX_Active is FALSE (see clause 6C), the UE shall always transmit the
Channel-Quality Indication (CQI) in the CQI transmission pattern defined in
6A.1.2.
When UL_DTX_Active is TRUE (see clause 6C), the UE shall perform the following
procedures:
  * The UE shall set the initial value of the variable CQI_DTX_Priority to 1.
  * Reset the \"CQI nominal reporting timer\" to CQI_DTX_TIMER **at the first HS-DPCCH subframe boundary.**
Afterwards, when UL_DTX_Active is TRUE, the UE sets the CQI_DTX_Priority based
on the status of a \"CQI nominal reporting timer\" which is counting down to
zero in HS-DPCCH subframes from the value CQI_DTX_TIMER which is configured by
higher layers.
The setting of CQI_DTX_Priority to 1 is described in subclause 6A.1.1.
Upon the expiration of the CQI nominal reporting timer, the UE shall set
CQI_DTX_Priority to 0.
CQI_DTX_Priority=0 indicates that CQI reports have lower priority than the
Uplink DPCCH burst pattern. If CQI_DTX_Priority is set to 0, the UE shall
transmit the Channel-Quality Indication (CQI), and all repeated CQI
transmissions (corresponding to the serving HS-DSCH cell and the secondary
serving HS-DSCH cell) according to the value of N_cqi_transmit, only if the
start of the CQI field corresponding to the serving HS-DSCH cell in the CQI
transmission pattern as defined in 6A.1.2 overlaps with a DPCCH transmission
burst of the Uplink DPCCH burst pattern as indicated in 6C.2.1.
CQI_DTX_Priority=1 indicates that CQI reports have higher priority than the
Uplink DPCCH burst pattern. If CQI_DTX_Priority is set to 1,
  * the UE shall always transmit the Channel-Quality Indication (CQI), in the CQI transmission pattern defined in 6A.1.2.
  * The repeated CQI transmissions according to the value of N_cqi_transmit are transmitted only if the start of the CQI field in the CQI transmission pattern, as defined in 6A.1.2, is transmitted.
## 6C.2 Discontinuous uplink DPCCH transmission operation
When UL_DTX_Active is FALSE (see clause 6C) the UE shall transmit the uplink
DPCCH in each slot except in the slots overlapping a compressed mode
transmission gap.
When UL_DTX_Active is TRUE (see clause 6C), in addition to the conditions
defined in 6C.5 the UE shall not transmit the uplink DPCCH in a slot on an
activated uplink frequency when all of the following conditions are met for
that uplink frequency:
  1. There is no HARQ-ACK transmission on HS-DPCCH as indicated in 6A.1 overlapping with the UL DPCCH slot,
  2. There is no CQI transmission on HS-DPCCH as indicated in 6C.1 overlapping with the UL DPCCH slot,
  3. There is no E-DCH transmission during the UL DPCCH slot,
  4. The slot is in a gap in the Uplink DPCCH burst pattern defined in 6C.2.1,
  5. The UL DPCCH preamble or postamble defined in 6C.2.2 is not transmitted in the slot.
  6. Either the uplink frequency is a secondary uplink frequency where at least Enabling_Delay radio frames have passed since the activation of the secondary uplink frequency was applied, or it is a primary uplink frequency.
The procedures for the F-DPCH transmission and reception in case of
discontinuous uplink DPCCH operation are defined in subclause 5.1.
The procedures for the F-TPICH transmission and reception in case of
discontinuous uplink DPCCH operation are defined in subclause 10.4.
### 6C.2.1 Uplink DPCCH burst pattern
The Uplink DPCCH burst pattern and the uplink DPCCH preamble and postamble
(6C.2.2) together define the discontinuous uplink DPCCH operation.
The Uplink DPCCH burst pattern is illustrated in Figure 2A for 2ms E-DCH TTI
and Figure 2B for 10ms E-DCH TTI. The Uplink DPCCH burst pattern defines the
minimum set of slots where the UE shall transmit the UL-DPCCH.
The Uplink DPCCH burst pattern shall be derived as follows.
If there has not been any E-DCH transmission for the last
Inactivity_Threshold_for_UE_DTX_cycle_2 E-DCH TTIs, and at least this many
TTIs have passed since the end of the Enabling_Delay, then:
  * The transmission length in the Uplink DPCCH burst pattern shall be UE_DPCCH_burst_2 subframes.
  * The gap length following the DPCCH transmission burst in the Uplink DPCCH burst pattern shall be
    * (UE_DTX_cycle_2 -- UE_DPCCH_burst_2) subframes,
  * The first subframe in each Uplink DPCCH burst pattern shall be such that
    * the CFN and DPCCH subframe number S verify\ ((5*CFN - UE_DTX_DRX_Offset + S) **MOD** UE_DTX_cycle_2) = 0
Otherwise:
  * The transmission length in the Uplink DPCCH burst pattern shall be UE_DPCCH_burst_1 subframes.
  * The gap length following the DPCCH transmission burst in the Uplink DPCCH burst pattern shall be
    * (UE_DTX_cycle_1 -- UE_DPCCH_burst_1) subframes.
  * The first subframe in each Uplink DPCCH burst pattern shall be such that
    * the CFN and DPCCH subframe number S verify\ ((5*CFN - UE_DTX_DRX_Offset + S) **MOD** UE_DTX_cycle_1) = 0
In case the DTX cycle pattern changes during a transmission of an Uplink DPCCH
burst, the following shall apply:
  * the previously derived length of the Uplink DPCCH burst which has already been started shall not be affected by the change of the DTX cycle pattern.
```{=html}
``` \- if the UL DPCCH burst, which is derived according to the new DTX cycle
pattern, overlaps with the ongoing UL DPCCH burst, the non-overlapping portion
of the burst, if any, shall be transmitted.
```{=html}
``` \- the change in the DTX cycle pattern from UE_DTX_cycle_2 to
UE_DTX_cycle_1 shall occur only at the end of an E-DCH transmission.
NOTE: The E-DCH transmission start time after data transmission inactivity may
be restricted as described in [9] to allow discontinuous reception at Node B.
Figure 2A: Example for Uplink DPCCH burst pattern for 2ms E-DCH TTI beginning
at CFN=1 (with UE_DTX_DRX_Offset = 6)
Figure 2B: Example for Uplink DPCCH burst pattern for 10ms E-DCH TTI beginning
at CFN=1 (with UE_DTX_DRX_Offset = 5)
Note: Figures 2A and 2B do not show the application of preambles and
postambles as described in subclause 6C.2.2.
### 6C.2.2 Uplink DPCCH preamble and postamble
NOTE: The "uplink DPCCH preamble" specified in this subclause is not the same
as the "uplink DPCCH power control preamble" specified in clauses 4 and 5.
#### 6C.2.2.1 Uplink DPCCH preamble and postamble for the DPCCH only
transmission
If a UE will start a transmission of DPCCH based on the Uplink DPCCH burst
pattern at the start of slot s and finish its DPCCH transmission at the end of
slot t, the UE shall start the DPCCH transmission at the start of slot s-2 and
continue the DPCCH transmission till the end of slot t+1.
#### 6C.2.2.2 Uplink DPCCH preamble and postamble for the E-DCH transmission
If a UE will start a transmission of E-DPCCH and E-DPDCH on a E-DCH TTI, the
UE shall start the DPCCH transmission 2 slots prior to the E-DCH TTI and
continue the DPCCH transmission during the E-DCH TTI and consecutive E-DCH
TTIs and 1 slot after the last consecutive E-DCH TTI.
In addition, if there has not been any E-DCH transmission for the last
Inactivity_Threshold_for_UE_DTX_cycle_2 E-DCH TTIs, and if a UE will start a
transmission of E-DPCCH and E-DPDCH on a E-DCH TTI, the UE shall start the
DPCCH transmission UE_DTX_long_preamble_length slots prior to the E-DCH TTI
and continue the DPCCH transmission during the E-DCH TTI and consecutive E-DCH
TTIs and 1 slot after the last consecutive E-DCH TTI.
#### 6C.2.2.3 Uplink DPCCH preamble and postamble for the HS-DPCCH
transmission
If a UE will start a transmission of HARQ-ACK, the UE shall start the DPCCH
transmission 2 slots prior to the DPCCH slot that coincides with or overlaps
the start of the HARQ-ACK field, unless the HARQ-ACK transmission is an HARQ
Preamble (PRE) in an HS-DPCCH sub-frame _n_ \-- 2 as defined in subclause
6A.1.1. The UE shall continue the DPCCH transmission during the HARQ-ACK field
and until the end of the first full DPCCH slot after the end of the HARQ-ACK
field.
If a UE will start a transmission of CQI, the UE shall start the DPCCH
transmission 3 slots prior to the DPCCH slot that coincides with or overlaps
the start of the CQI field, and continue the DPCCH transmission during the CQI
field and until the end of the first full DPCCH slot after the end of the CQI
field.
In addition, if there has not been any E-DCH transmission for the last
Inactivity_Threshold_for_UE_DTX_cycle_2 E-DCH TTIs, and if a UE will start a
transmission of CQI, the UE shall start the DPCCH transmission
(UE_DTX_long_preamble_length + 1) slots prior to the DPCCH slot that coincides
with or overlaps the start of the CQI field, and continue the DPCCH
transmission during the CQI field and until the end of the first full DPCCH
slot after the end of the CQI field. If the transmission of the CQI is not
known to the UE in advance due to the change of CQI_DTX_Priority from 0 to 1,
or due to the change from UE_DTX_cycle_1 to UE_DTX_cycle_2, the preamble for
the first CQI after the change may start late resulting in a shorter preamble.
## 6C.3 Discontinuous downlink reception
The HS-SCCH reception pattern is derived from a discontinuous reception
subframe numbering as follows.
The discontinuous HS-SCCH reception subframe numbering is such that:
\- A HS-SCCH discontinuous reception radio frame is 10 ms long and is indexed
using CFN_DRX.
\- The start of the HS-SCCH discontinuous reception radio frame of CFN_DRX n
is aligned with the start of the HS-SCCH subframe that starts τ~DRX~ chips
after the start of the associated downlink F-DPCH of CFN n where $-
\text{3840}\text{chips} \leq \tau_{\text{DRX}}\text{\ -}T_{0}  transmission as specified in subclause 6B.
  2. The UE shall monitor the HS-SCCH subframes in the HS-SCCH reception > pattern.
  3. The UE shall receive an HS-PDSCH subframe as specified in subclause > 6A.
  4. The UE has received an HS-SCCH or an HS-PDSCH subframe during the > last Inactivity_Threshold_for_UE_DRX_cycle subframes which > was not an HS-SCCH order.
  5. The UE shall monitor E-AGCH and E-ROCH transmission from the serving > E-DCH cell in the following cases:
     * If UE_DRX_Grant_Monitoring is TRUE and the E-AGCH/E-ROCH subframe (in case of a 2ms TTI) or E-AGCH frame (in case of a 10ms TTI) overlaps with the start of an HS-SCCH reception subframe as defined in the HS-SCCH reception pattern,
     * When conditions defined in subclause 11.8.1.8 of [9] are fulfilled.
  6. The UE shall monitor E-RGCH transmission from a cell in the serving > E-DCH radio link set in the following cases:
     * If UE_DRX_Grant_Monitoring is TRUE and the corresponding subframe (in case of a 2ms TTI) or frame (in case of a 10ms TTI) of the serving cell E-RGCH overlaps with the start of an HS-SCCH reception subframe as defined in the HS-SCCH reception pattern.
     * When conditions defined in subclause 11.8.1.8 of [9] are fulfilled.
  7. The UE shall monitor the E-RGCH(s) from all the other cells in the > E-DCH active set, except from the cells in the serving E-DCH radio > link set, in the following case:
  8. When conditions defined as determined in subclause 11.8.1.8 of [9] > are fulfilled.
The HS-SCCH reception pattern is illustrated by Figure 2C for a 2ms E-DCH TTI.
The grey subframes correspond to the HS-SCCH reception pattern UE_DRX_cycle=4.
{width="6.688888888888889in" height="3.0284722222222222in"}Figure 2C: Example
for HS-SCCH reception pattern, 2ms E-DCH TTI
The HS-SCCH reception pattern is illustrated by Figure 2D for a 10 ms TTI
E-DCH. The grey subframes correspond to the HS-SCCH reception pattern
_UE_DRX_cycle_ =5.
{width="6.686805555555556in" height="3.0506944444444444in"}Figure 2D: Example
for HS-SCCH reception pattern, 10ms E-DCH TTI
#### 6C.3.1 Discontinuous downlink reception when the UE is in Multiflow mode
When the UE is in Multiflow mode the discontinuous downlink reception for the
time reference cell operates as defined in subclause 6C.3 for the case when
the UE is not in Multiflow mode.
The discontinuous HS-SCCH reception subframe numbering in the non-time
reference cell at the UE is such that:
\- The HS-SCCH discontinuous transmission radio frame of CFN_DRX n in the non-
time reference cell is derived from the HS-SCCH discontinuous transmission
radio frame of CFN_DRX n in the time reference cell, with the related HS-PDSCH
subframes are paired subframes, i.e. the corresponding HARQ-ACK fields in the
same HS-DPCCH sub-frame.
\- The HS-DPCCH discontinuous transmission radio frame of CFN_DRX n in the
non-time reference cell is identical to the HS-DPCCH discontinuous
transmission radio frame of CFN_DRX n in the time reference cell.
The discontinuous HS-SCCH reception subframe numbering in the non-time
reference cell at the NodeB is such that:
\- A HS-SCCH discontinuous reception radio frame is 10 ms long and is indexed
using CFN_DRX.
\- The start of the HS-SCCH discontinuous reception radio frame of CFN_DRX n
is aligned with the start of the HS-SCCH subframe that starts τ~DRX~ chips
after the start of the associated downlink F-DPCH of CFN n where $-
\text{3840}\text{chips} \leq \tau_{\text{DRX}}\text{\ -}T_{0} - \text{7680}
\ast \text{DRX}_{\text{OFFSET}}  \- For the calculation of the E-DPCCH gain factors, E-DPCCH boosting is
> always applied regardless of the selected E-TFC to be transmitted,
>
> \- The S-DPCCH gain factor equals the E-DPCCH gain factor,
>
> \- The S-E-DPCCH gain factor is configured by higher layers.
UL MIMO rank-1 transmission and the setting of the channel transmit powers
function as defined for UL CLTD. The pre-coded physical channels structure for
UL MIMO rank-1 transmission is depicted in Figure 10.
Figure 9: Pre-coded physical channel structure of UL MIMO with rank-2
transmission
Figure 10: Pre-coded physical channel structure of UL MIMO with rank-1
transmission
## 11.1 General procedure
The UE transmits two orthogonal pilot signals on DPCCH and S-DPCCH. Node B
estimates the preferred rank, precoding vector and S-ETFC Offset of the two
streams from the received pilot signals. The Node B transmits the preferred
precoding vector to the UE in the form of TPI bits using the F-TPICH as in UL
CLTD. The UE applies TPI as with UL CLTD. The preferred rank and S-ETFC Offset
to be applied by the UE E-TFC selection are signalled to the UE using the
E-ROCH channel.
Rank-1 transmissions occur if the maximum rank signalled over the E-ROCH is 1,
or if the UE does not have sufficient data or power headroom to transmit at
least the _Minimum E-TFCI for Rank 2 transmission_ sized transport blocks on
both streams. _Minimum E-TFCI for Rank 2 transmission_ is configured by higher
layers.
The signal after spreading is fed to both TX antenna branches and weighted
with pre-coding weights _w~1~_ , _w~2~_ , _w~3~_ and _w~4~_. The same pre-
coding weights, _w~1~_ and _w~2~_ are always applied to DPCCH, E-DPCCH,
E-DPDCH, HS-DPCCH and S-E-DPCCH. The S-DPCCH and S-E-DPDCH are pre-coded with
pre-coding weights _w~3~_ and _w~4~_.
## 11.2 Downlink TPI transmission and control timing
When uplink MIMO is configured, downlink TPI transmission and control timing
follows that defined for UL CLTD as defined in subclause 10.2.
## 11.3 Combining TPI bits from radio links of the serving radio link set
When uplink MIMO is configured, combining TPI bits follows that defined for UL
CLTD as defined in subclause 10.3.
## 11.4 Operation during discontinuous uplink DPCCH operation
When uplink MIMO is configured, operation during discontinuous uplink DPCCH
operation follows that defined for UL CLTD as defined in subclause 10.4.
## 11.5 Operation during compressed mode
When uplink MIMO is configured, operation during compressed mode follows that
defined for UL CLTD as defined in subclause 10.5.
## 11.6 HS-SCCH orders
When uplink MIMO is configured, the HS-SCCH orders as defined for UL CLTD
operation in subclause 10.6 apply.
## 11.7 Uplink power control
When uplink MIMO is configured, the inner loop power control operates without
modifications as defined for non-MIMO operation.
# 12 MIMO operation of HS-DSCH with four transmit antennas
This section applies only when a UE is configured in MIMO mode with four
transmit antennas.
The general transmitter structure to support MIMO operation of HS-PDSCH
transmission with four transmit antennas is shown in Figure 11. For each
transport block channel coding, interleaving, spreading and scrambling are
done as in non-MIMO mode. Symbol level interleaving between symbols modulated
from the primary and the fourth transport blocks is applied. Similarly, symbol
level interleaving between symbols modulated from the second and the third
transport block. The detailed operation for symbol level interleaving is
descried in subclause 12.2. The Node B scheduler can decide to transmit one or
two or three or four transport blocks to a UE in one TTI in the serving HS-
DSCH cell. The spread complex valued signals are fed to all TX antenna
branches, and weighted with precoding weights _w~mn,\ ~_ where m = 0,1,2,3,
and n = 0 to number of transport blocks decided. The precoding weights _w~mn\
~_ is the m^th^ row and n^th^ column of the precoding matrix $W_{n}^{\left{ s
\right}}$ defined in Table 14B.7 of [2]. The Node B can dynamically schedule
the UE with one or two or three or four transport blocks.
Figure 11: The generic downlink transmitter structure to support MIMO mode
with four transmit antennas operation for HS-PDSCH transmission.
## 12.1 General procedure
The UE uses the CPICH to separately estimate the channels seen from each
antenna. One of the antennas will transmit the Antenna 1 modulation pattern of
the P-CPICH as defined in subclause 5.3.3.1 of [1]. The other antennas will
transmit the Antenna 1 modulation pattern of a S-CPICH. If D-CPICHs are
activated, the Antenna 3 and Antenna 4 will transmit the Antenna 1 modulation
pattern of a D-CPICH within TTIs in which the HS-PDSCH is scheduled for a UE
configured for MIMO mode with 4 transmit antennas. If D-CPICHs are activated,
in addition to P-CPICH and S-CPICHs, the UE uses the D-CPICHs as additional
phase references on antenna 3 and antenna 4 to estimate the channels for the
HS-PDSCH demodulation. The Pilot configuration in support of MIMO mode with
four transmit antennas operation of HS-DSCH in the cell is signalled by higher
layers.
The UE determines number of transport block preferred a preferred precoding
matrix and signals it to the Node B. The signalled information about the
number of transport block preferred (NTBP) also called rank information (RI),
preferred precoding matrix is termed precoding control indication (PCI) and is
defined in subclause 6A.4.2. The PCI is signalled to the Node B together with
channel quality indication (CQI) and number of transport block preferred
(NTBP) as a composite NTBP/ PCI/CQI report according to the procedure defined
in subclause 6A.1.2.3. The UE transmits the composite NTBP/PCI/CQI report to
the Node B using the CQI field on the HS-DPCCH as defined in [1]. Based on the
composite NTBP/PCI/CQI reports, the Node B scheduler decides whether to
schedule one, two, three or four transport blocks in a cell to a UE in one TTI
and what transport block size(s) and modulation scheme(s) to use for each of
them.
The Node B signals to the UE the transport blocks scheduled, the precoding
weights applied on the HS-PDSCH sub-frame using the precoding weight
indication bits of part 1 of the corresponding HS-SCCH sub-frame. The
precoding weight adjustment of each HS-PDSCH is done at the HS-PDSCH sub-frame
border. For an UE with dual stream capability the Node B should not schedule
more than two transport blocks.
## 12.2 Symbol level interleaving
Symbol level interleaving is applied between symbols modulated from the second
and the third transport block when the Node B schedules three transport
blocks. Symbol level interleaving is applied between symbols modulated from
the primary and the fourth transport blocks, similarly between symbols
modulated from the second and the third transport block when the Node B
schedules four transport blocks. Table 11 shows the operation of symbol level
interleaving, where x^(p)^ (i) and y^(p)^ (i), p = 0,1,2 and 3 are the symbol
interleaver input and output symbols respectivelyrepectively.
Table 11: Operation of symbol level interleaving
* * *
**Number of transport blocks** **Symbol level interleaving output** 1  
2  
3  
4
* * *
## 12.3 Retransmission Procedures
If the Node B schedules three transport blocks in any transmission, for
retransmissions the second transport block and the third transport block are
re-transmitted with the same HARQ process identifier as defined in [2]. If the
Node B schedules four transport blocks in any transmission, for
retransmissions the primary transport block and the fourth transport blocks
are re-transmitted with the same HARQ process identifier as defined in [2],
retransmissions the second transport block and the third transport block are
re-transmitted with the same HARQ process identifier as defined in [2].
  * If the Node B schedules two or three transport blocks, the transport block size information of the primary transport block is set to '111111' and if X~rvpb~ is set to 0, then the primary transport block is not transmitted.
  * If the Node B schedules two transport blocks, the transport block size information of the second transport block is set to '111111' and if X~rvsb~ is set to 0, then the second transport block is not transmitted.
  * If the Node B schedules three or four transport blocks, the transport block size information of the second and the third transport block is set to '111111' and if X~rvsb~ is set to 0, then the second and the third transport block are not transmitted.
  * If the Node B schedules four transport blocks, the transport block size information of the primary transport block and fourth transport block is set to '111111' and if X~rvpb~ is set to 0, then the primary and the fourth transport block are not transmitted.
  * When the number of transport blocks is equal to 2 or 3, X~rvpb~ = 0 and if the transport block size information of the primary transport block is equal to '111111' the UE shall discard the received data on the primary transport block, should assume that the primary transport block had been successfully decoded and generate a positive acknowledgement for the primary transport block in this HARQ process. Node B should assume positive acknowledgement has been received for this HARQ process.
  * When the number of transport blocks is equal to 2, X~rvsb~ = 0 and if the transport block size information of the second transport block is equal to '111111' the UE shall discard the received data on the second transport block, should assume that the second transport block had been successfully decoded and generate a positive acknowledgement for the second transport block in this HARQ process. Node B should assume positive acknowledgement has been received for this HARQ process.
  * When the number of transport blocks is equal to 3 or 4, X~rvsb~ = 0 and if the transport block size information of the second and the third transport block is equal to '111111' the UE shall discard the received data on the second and the third transport blocks, should assume that the second and the third transport blocks had been successfully decoded and generate a positive acknowledgement for the second and the third transport blocks in this HARQ process. Node B should assume positive acknowledgement has been received for this HARQ process.
  * When the number of transport blocks is equal to 4, X~rvpb~ = 0 and if the transport block size information of the primary and the fourth transport block is equal to '111111' the UE shall discard the received data on the primary and the fourth transport blocks, should assume that the primary and the fourth transport blocks had been successfully decoded and generate a positive acknowledgement for the primary and the fourth transport blocks in this HARQ process. Node B should assume positive acknowledgement has been received for this HARQ process.
## 12.4 Precoding weight restriction
A UE is restricted to report PCI, and NTBP within a precoder codebook subset
specified by a bitmap parameter _PrecodingWeightRestriction_ configured by
higher layer signalling. The bitmap can specify all possible precoder codebook
subsets from which the UE can assume the Node B may be using when the UE is
configured in MIMO mode with four transmit antennas. The bitmap forms the bit
sequence $a_{\text{63}},\text{.}\text{.}\text{.},a_{3},a_{2},a_{1},a_{0}$where
$a_{0}$ is the LSB and $a_{\text{63}}$is the MSB and where a bit value of zero
indicates that the precoding indices reporting is not allowed in the
NTBP/PCI/CQI report.
## 12.5 HS-SCCH Orders
The Node B may activate or deactivate D-CPICH on 3^rd^ and 4^th^ antennas
through HS-SCCH orders as described in [2]. The UE may assume that D-CPICHs
are present 12 slots after the end of the HS-SCCH subframe containing the
order for activation of D-CPICHs. The UE is not required to perform any
operations based on the D-CPICHs 12 slots after the end of the HS-SCCH
subframe containing the order for deactivation. The HS-SCCH order for
activation or deactivation of D-CPICHs is UE-specific.
The UE can assume the initial activation status of D-CPICH as set by the
network through RRC signalling.
###### ## Annex A (informative): (no title)
## A.1 Antenna verification
In closed loop mode 1, if channel estimates are taken from the Primary CPICH,
the performance will also suffer if the UE cannot detect errors since the
channel estimates will be taken for the incorrect phase settings. To mitigate
this problem, antenna verification can be done, which can make use of antenna
specific pilot patterns of the dedicated physical channel. The antenna
verification can be implemented with several different algorithms. A
straightforward algorithm can use a 4-hypothesis test per slot. Alternatively,
a simplified beam former verification (SBV) requiring only a 2-hypothesis test
per slot can be used.
Consider
$2\sum_{i = 1}^{\text{Npath}}\frac{1}{\sigma_{i}^{2}}\left{
\sqrt{2}\text{Re}(\text{γh}_{2,i}^{(d)}h_{2,i}^{{(p)}^{}}) \right} >
\text{ln}\left( \frac{\overline{p}(\varphi_{\text{Rx}} =
\pi)}{\overline{p}(\varphi_{\text{Rx}} = 0)} \right)$
Then define the variable x~0~ as 0 if the above inequality holds good and x~0~
= π otherwise.
Similarly consider
then define the variable x~1~ as -π/2 if the above inequality holds good and
x~1~ = π/2 oherwise.
Whether x~0~ or x~1~ is to be calculated for each slot is given by the
following table , where the first row contains the UL slot index of the
feedback bit to be verified.
* * *
UL 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 x~0~ x~1~ x~0~ x~1~ x~0~ x~1~ x~0~ x~1~
x~0~ x~1~ x~0~ x~1~ x~0~ x~1~ x~0~
* * *
The estimate for the transmitted phase is now obtained from
$\text{sin}(\varphi_{\text{Tx}}) + j\text{cos}(\varphi_{\text{Tx}}) =
\frac{\sum_{i = 0}^{1}{\text{sin}(x_{i})}}{\sqrt{2}} + j\frac{\sum_{i =
0}^{1}{\text{cos}(x_{i})}}{\sqrt{2}}$
where:
\- the x~i~ ­values are used corresponding to the current slot and the
previous slot taking into account the end-of-frame adjustment and the used CL
timing adjustment delay
\- $h_{2,i}^{(p)}$is the _i_ \'th estimated channel tap of antenna 2 using the
CPICH;
\- $h_{2,i}^{(d)}$is the _i_ \'th estimated channel tap of antenna 2 using the
DPCCH;
− γ _^2^_ is the DPCH Pilot SNIR/ CPICH SNIR;
\- $\sigma_{i}^{2}$is the noise plus interference power on the _i_ \'th path.
In normal operation the _a priori_ probability for selected pilot pattern is
assumed to be 96% (assuming there are 4% of errors in the feedback channel for
power control and antenna selection).
## A.2 Computation of feedback information for closed loop mode 1 transmit
diversity
In non-soft handover case, the computation of feedback information can be
accomplished by e.g. solving for weight vector, _[w,]{.underline}_ that
maximises.
_P=[w]{.underline}^H^H^H^H[w]{.underline}_ (1)
where
H=[_[h]{.underline}~1~_ _[h]{.underline}~2~_] and [w]{.underline} = [ w~1~,
w~2~ ]^T^
and where the column vectors _[h]{.underline}~1~_ and _[h]{.underline}~2~_
represent the estimated channel impulse responses for the transmission
antennas 1 and 2, of length equal to the length of the channel impulse
response. The elements of [w]{.underline} correspond to the adjustments
computed by the UE.
During soft handover, the antenna weight vector, _[w]{.underline}_ can be, for
example, determined so as to maximise the criteria function:
_P_ = [w]{.underline}^H^(H~1~^H^H~1~+ H~2~^H^H~2~+⋅⋅⋅⋅)[w]{.underline} (2)
where _H~i~_ is an estimated channel impulse response for BS#i. In regular
SHO, the set of BS#i corresponds to the active set.
If HS-PDSCH is present, the UE may emphasize the HS-PDSCH serving cell. In
this case the antenna weight vector, _[w]{.underline}_ can be, for example,
determined so as to maximise the criteria function:
_P_ = [w]{.underline}^H^(α(H~1~^H^H~1~)+
(1-α)(H~2~^H^H~2~+⋅⋅⋅⋅))[w]{.underline}
where BS#1 is the HS-PDSCH serving cell and coefficient α is less than or
equal to 1. For example α = 0.7 enhances HS-DSCH performance while ensuring
that there is only a small degradation on the DPCH.
###### ## Annex B (Informative): Power control
# B.1 Downlink power control timing
The power control timing described in this annex should be seen as an example
on how the control bits have to be placed in order to permit a short TPC
delay.
In order to maximise the cell radius distance within which one-slot control
delay is achieved, the frame timing of an uplink DPCH is delayed by 1024 chips
from that of the corresponding downlink DPCH measured at the UE antenna.
Responding to a downlink TPC command, the UE shall change its uplink DPCH
output power at the beginning of the first uplink pilot field after the TPC
command reception. Responding to an uplink TPC command, the UTRAN access point
shall change its DPCH output power at the beginning of the next downlink pilot
field after the reception of the whole TPC command. Note that in soft
handover, the TPC command is sent over one slot when DPC_MODE is 0 and over
three slots when DPC_MODE is 1. Note also that the delay from the uplink TPC
command reception to the power change timing is not specified for UTRAN. The
UE shall decide and send TPC commands on the uplink based on the downlink SIR
measurement. For the DPCH, the TPC command field on the uplink starts, when
measured at the UE antenna, 512 chips after the end of the downlink pilot
field. The UTRAN access point shall decide and send TPC commands based on the
uplink SIR measurement. However, the SIR measurement periods are not specified
either for UE nor UTRAN.
Figure B.1 illustrates an example of transmitter power control timings when a
DPCH is configured on the downlink.
Figure B.1: Transmitter power control timing for DPCH
Figure B.2 illustrates an example of transmitter power control timings when
the F-DPCH is configured on the downlink and the F-DPCH TPC offset N~OFF1~ of
all the radio links in the RLS is 0 or 2(see Table 16C of [1]). Figure B.2a
illustrates an example of transmitter power control timings for the radio link
whose F-DPCH TPC offset N~OFF1~ = 0 or 2, when the F-DPCH is configured on the
downlink, and the F-DPCH TPC offset N~OFF1~ of at least one other radio link
in the RLS is > 2\. Figure B.3 illustrates an example of transmitter power
control timings when the F-DPCH is configured on the downlink and the F-DPCH
TPC offset N~OFF1~ of the radio link is larger than 2. Figure B.4 illustrates
an example of transmitter power control timings when the F-DPCH is configured
on the downlink and the F-DPCH TPC offset N~OFF1~ of the radio link is larger
than 14 when uplink DPCCH slot format #4 is used.
Figure B.2: Transmitter power control timing for F-DPCH with TPC offsets
N~OFF1~ of 0 or 2 when F-DPCH TPC offset N~OFF1~ of all the radio links in the
RLS is 0 or 2
Figure B.2a: Transmitter power control timing for F-DPCH with TPC offsets
N~OFF1~ of 0 or 2 when the F-DPCH TPC offset N~OFF1~ of at least one other
radio link in the RLS is > 2
Figure B.3: Transmitter power control timing for F-DPCH with a TPC offset
N~OFF1~ larger than 2
Figure B.4: Transmitter power control timing for F-DPCH with a TPC offset
N~OFF1~ larger than 14 with uplink DPCCH slot format #4
# B.2 Example of implementation in the UE
The downlink inner-loop power control adjusts the network transmit power in
order to keep the received downlink SIR at a given SIR target, SIR~target~. A
higher layer outer loop adjusts SIR~target~ independently for each connection.
The UE should estimate the received downlink DPCCH/DPDCH power of the
connection to be power controlled. Simultaneously, the UE should estimate the
received interference and calculate the signal-to-interference ratio,
SIR~est~. SIR~est~ can be calculated as RSCP/ISCP, where RSCP refers to the
received signal code power on one code and ISCP refers to the non-orthogonal
interference signal code power of the received signal on one code. Note that
due to the specific SIR target offsets described in [5] that can be applied
during compressed frames, the spreading factor shall not be considered in the
calculation of SIR~est~.
The obtained SIR estimate SIR~est~ is then used by the UE to generate TPC
commands according to the following rule: if SIR~est~ > SIR~target~ then the
TPC command to transmit is \"0\", requesting a transmit power decrease, while
if SIR~est~ \< SIR~target~ then the TPC command to transmit is \"1\",
requesting a transmit power increase.
When the UE is in soft handover, the UE should estimate SIR~est~ from the
downlink signals of all cells in the active set.
# B.3 UL power control when losing UL synchronization
Each Node B operates the uplink power control independently of the other Node
Bs that may be providing RLS to the same UE. In case of multiple RLS the UE
derives the decision on power adjustment based on all the commands received
according the rules specified in subclause 5.1.2. In this scenario,
transmission of a down command by one or more of the involved Node Bs will
likely result in the UE decreasing its transmit power.
Consequently, if and when, after successful initial RL synchronization, the
Node B loses UL synchronization for a UE and if the current number of RLS
configured for that UE is greater than one and if the Node B reverts to a TPC
pattern in such situation (i.e. generates DL TPC commands independently of
actual RL measurements), the Node B should not use TPC commands "0" in the TPC
pattern.
###### ## Annex C (Informative): Cell search procedure
During the cell search, the UE searches for a cell and determines the downlink
scrambling code and frame synchronization of that cell. The cell search is
typically carried out in three steps:
##### Step 1: Slot synchronization {#step-1-slot-synchronization .H6}
During the first step of the cell search procedure the UE uses the SCH's
primary synchronization code to acquire slot synchronization to a cell. This
is typically done with a single matched filter (or any similar device) matched
to the primary synchronization code which is common to all cells. The slot
timing of the cell can be obtained by detecting peaks in the matched filter
output.
##### Step 2: Frame synchronization and code-group identification
{#step-2-frame-synchronization-and-code-group-identification .H6}
During the second step of the cell search procedure, the UE uses the SCH's
secondary synchronization code to find frame synchronization and identify the
code group of the cell found in the first step. This is done by correlating
the received signal with all possible secondary synchronization code
sequences, and identifying the maximum correlation value. Since the cyclic
shifts of the sequences are unique the code group as well as the frame
synchronization is determined.
##### Step 3: Scrambling-code identification {#step-3-scrambling-code-
identification .H6}
During the third and last step of the cell search procedure, the UE determines
the exact primary scrambling code used by the found cell. The primary
scrambling code is typically identified through symbol-by-symbol correlation
over the CPICH with all codes within the code group identified in the second
step. After the primary scrambling code has been identified, the Primary CCPCH
can be detected. And the system- and cell specific BCH information can be
read.
If the UE has received information about which scrambling codes to search for,
steps 2 and 3 above can be simplified.
###### ## Annex D (Informative): F-TPICH Transmission
The F-TPICH transmission timing described in this annex should be seen as an
example on how the TPI bits have to be placed in order to ensure a short TPI
delay.
In response to the reception of the TPI bits on the F-TPICH channel, the UE
shall apply the precoding weights indicated by the TPI bits at the first UL
DPCCH slot that is transmitted at least 512 bits after the reception of the
last of the two TPI symbols. The reliability of the received TPI bit is
determined by the UE based on the downlink SIR measurement on the F-TPICH
channel.
Figure D.1 illustrates an example of F-TPICH timing for UL CLTD operation when
the F-TPICH frame starts 512 chips after the start of the DPCH/F-DPCH frame.
Figure D.1: F-TPICH Transmission timing for UL CLTD when F-TPICH frame starts
512 chips after the start of DPCH/F-DPCH frame
#
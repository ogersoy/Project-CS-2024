# Foreword {#foreword-1}
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document studies the use cases which needs Home Network initiated
primary authentication and the associated security threats and requirements.
As part of this investigation, the study aims at identifying which network
function in the HN is better suitable to trigger the primary authentication,
corresponding procedures, the potential impacts on visited and home network,
and the potential impacts on existing procedures. Moreover, solutions for
potential normative work are also in the scope of this study.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.502: \"Procedures for the 5G System (5GS)\".
[3] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[4] 3GPP TS 29.509: \"5G System; Authentication Server Services; Stage 3\".
[5] 3GPP TS 33.535: \"Authentication and Key Management for Applications
(AKMA) based on 3GPP credentials in the 5G System (5GS)\".
[6] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Symbols
Void
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
A-KID AKMA Key IDentifier
AAnF AKMA Anchor Function
AF Application Function
AKMA Authentication and Key Management for Applications
AMF Access and Mobility Management Function
ARPF Authentication credential Repository and Processing Function
AUSF AUthentication Server Function
HN Home Network
HONTRA HOme Network TRiggered Authentication
SEAF SEcurity Anchor Function
SoR Steering of Roaming
SUPI SUbscription Permanent Identifier
UPU UE Parameter UpdateUDM Unified Data Management
# 4 Key issues
## 4.1 Key Issue #1: Ability of the home network to trigger primary
authentication
### 4.1.1 Key issue details
In the 5G System, the home network control over the security of the UE has
been strengthened compared to previous generations by many new mechanisms such
as SUPI privacy, termination of the authentication procedure in the home
network and the provisions for increased home network control and linkage to
subsequent procedures. However, when it comes to triggering the
authentication, then this is still under the control of the serving network.
The home network uses K~AUSF~ or keys derived from K~AUSF~ to provide
protection for various services, (e.g. interworking from LTE to 5G, SoR/UPU
and AKMA services) and hence the home network would benefit from having the
ability to be able to ensure a fresh K~AUSF~ is available by triggering an
authentication, in particular to prevent counter wrap in SoR/UPU or after
interworking from LTE when there might be no K~AUSF~ available.
### 4.1.2 Security threats
For the interworking case it is first time when the UE moves from EPS to 5GS
that K~AUSF~ will not be available. As soon as the UE registers to 5GS K~AUSF~
will be available and not deleted.
For SoR/UPU the service will block.
Without primary authentication, the K~AKMA~ not be refreshed.
### 4.1.3 Potential requirements
The home network may be able to trigger a primary authentication.
The messages in home network triggered primary authentication should be
confidentiality protected, integrity protected, and anti-replay protected.
NOTE: All the solutions will be evaluated specific to the use case in the
Annex A of the present document.
## 4.2 Key Issue #2: Signalling overload due to running the primary
authentication for K~AF~ refresh
### 4.2.1 Issue details
The current TS 33.501 [3] does not consider the scenario where the provisioned
key KAF expires in trusted or untrusted AF for the AKMA use case, then how to
renew the keys. i.e., via primary authentication. It a leftover issue and is
going to be addressed in [7] with following objectives. \"_It is desirable for
the HN to be able to trigger primary authentication. This study is proposed to
investigate the support of such a capability in 5GS. This study can provide
home network control and address issues but not limit to, for example, UPU/SoR
COUNT wrap around, refresh of K~AUSF~_ \".
If AF is allowed to request the 5G core to perform primary re-authentication,
then there may be multiple primary re-authentications because of multiple AFs
being involved with the UE. Multiple primary authentications may also result
in an energy drain at the UEs.
And these multiple primary authentications obviously lead to signaling
overhead and cause a refresh of the entire key hierarchy impacting both core
and access security. The situation will be bad if the AUSF and the UDM handle
the request for authentication every time, and it will be worse if more than
one request is received in a very short period.
### 4.2.2 Security Threats
If the UDM or the AUSF handles the request for primary authentication every
time without determining and if the more than one request is received in a
very short of period, the signaling overhead inside 5GC may happen.
### 4.2.3 Potential security requirements
The 5GS may reduce the impact on the signaling overhead when Home Network
triggered authentication is supported.
# 5 Potential solutions
## 5.0 Mapping of solutions to key issues
Table 5.0-1: Mapping table
+----------+----------+----------+----------+----------+----------+ | S | Related | Key | | | | | olutions | Use Case | Issue | | | | +==========+==========+==========+==========+==========+==========+ | | UC#1 | UC#2 | UC#3 | KI#1 | KI#2 | | | | | | | | | | LTE/5G | UPU/SoR | K~AKM | Ability | Si | | | inte | wrap | A~/K~AF~ | of HN | gnalling | | | rworking | around | | trigger | overload | | | | | Update | | | +----------+----------+----------+----------+----------+----------+ | S | √ | √ | | √ | | | ol#1-Pr | | | | | | | ocedure1 | | | | | | +----------+----------+----------+----------+----------+----------+ | S | | | √ | √ | √ | | ol#1-Pr | | | | | | | ocedure2 | | | | | | +----------+----------+----------+----------+----------+----------+ | Sol#2 | | | | √ | √ | +----------+----------+----------+----------+----------+----------+ | Sol#3 | √ | | | √ | | +----------+----------+----------+----------+----------+----------+ | Sol#4 | √ | √ | √ | √ | | +----------+----------+----------+----------+----------+----------+ | Sol#5 | | | √ | √ | √ | +----------+----------+----------+----------+----------+----------+ | Sol#6 | | √ | √ | √ | √ | +----------+----------+----------+----------+----------+----------+ | Sol#7 | | √ | | √ | | +----------+----------+----------+----------+----------+----------+ | Sol#8 | | √ | √ | √ | √ | +----------+----------+----------+----------+----------+----------+ | Sol#9 | | | | √ | | +----------+----------+----------+----------+----------+----------+ | Sol#10 | | | √ | √ | √ | +----------+----------+----------+----------+----------+----------+ | Sol#11 | √ | | | √ | | | | | | | | | | Pr | | | | | | | ocedure1 | | | | | | +----------+----------+----------+----------+----------+----------+ | Sol#11 | | √ | √ | √ | | | | | | | | | | Pr | | | | | | | ocedure2 | | | | | | +----------+----------+----------+----------+----------+----------+ | Sol#12 | | | | √ | √ | +----------+----------+----------+----------+----------+----------+
## 5.1 Solution #1: HN triggering primary authentication for various scenarios
### 5.1.1 Introduction
This solution provides a framework where the home network can trigger a
primary authentication due to various scenarios, i.e.
\- SOR/UPU Counter wraparound;
\- EPC to 5G interworking where KAUSF would not be available at UE and AUSF.
And due to this, a few services will not work;
\- Any other scenarios where any authorized NF can invoke the primary
reauthorization.
The solution provides an advanced detection solution where the SoR/UPU
wraparound situation is detected in advance, i.e., the AUSF detects that the
UPU/SoR counter will reach its max value in the next SoR/UPU case and takes
precautionary measures in advance.
### 5.1.2 Solution details
#### 5.1.2.1 Procedure for detection of SoR/UPU Counter wraparound in advance
and perform re-authentication
Figure 5.1.2.1-1: detection of SoR/UPU Counter wraparound in advance and
perform re-authentication
1) The UE is authenticated and registered at the 5GC.
2) The UDM decides to perform the UE parameter update procedure or SoR
procedure. Therefore, the UDM invokes the Nausf_UPUProtection or
Nausf_SoRProtection procedure. The AUSF tries to increment the
Counter~upu~/Counter~SoR~ and figures out that the Counter~upu~/Counter~SoR~
is about to wrap around or will reach the max value at the next trigger.
Therefore, AUSF shall provide an indication of \"Counter~upu~ Reaching Max
value\" or \"/Counter~SoR~ Reaching Max value\" to UDM along with the
successful result of the Nausf_UPUProtection or Nausf_SoRProtection procedure.
This alerts the UDM that the current UPU/SoR procedure is OK to continue, but
the next follow-up UPU procedure update will cause a wraparound failure. The
UDM shall store the received indication.
3) The UDM completes the UPU/SoR procedure as defined in TS 33.501 [3].
4) If \"Counter~upu~ Reaching Max value\" or \"Counter~SoR~ Reaching Max
value\" indication is received in step 2, the UDM sends a notification to the
AMF with SUPI and the \"re-authentication required\" flag set to true.
NOTE: UDM contacts AMF on Namf_communication service to trigger the re-
registration required or re-authentication required with deregistration first.
Therefore, UDM can use the same Namf_communication service for re-
authentication without performing the deregistration.
5) Based on the received indication, the AMF shall start the primary re-
authentication procedure.
6) AMF shall invoke Nausf_UEAuthetication_Authenticate Request with SUPI and
SN-Name.
7) The AUSF sends the Nudm_UEAuthentication_Get Request with SUPI and SN-Name
to the UDM.
8-10) are the same as defined in TS 33.501 [3] clause 6.1.3. After Key KAUSF
is generated, the CounterUPU and Counter~SoR~ shall be reset. Therefore, any
further UPU/SoR trigger at the UDM will be successful.
#### 5.1.2.2 Re-authentication due to EPC to 5G mobility
When UE moves from EPC to 5GC, the AMF performs Registration with UDM and
invokes Nudm_UECM_Registration API. UDM should check if there is no
authentication result stored in the UDM, then the UDM shall send a
notification to the AMF with SUPI and the \"re-authentication required\" flag
set to true as defined in clause 5.1.2.1. Step 4. It ensures K~AUSF~ is
available in AUSF and UE when a user moves from EPC to 5GC so that different
services work smoothly, i.e., SoR, UPU, and/or a user accessing the AKMA AF.
#### 5.1.2.3 Re-authentication invoked by other AAnF
If the AAnF wants to invoke the UE Re-authentication, the NF shall request the
UDM to perform re-authentication.
Whenever K~AF~ has expired at the (internal or external) AF and the AF wants
to refresh the K~AF~ via 5GC, the AF request AAnF for UE re-authentication so
that K~AF~ can be refreshed. The AAnF maintains the \"wait time before
initiating new re-authentication\". For example, suppose a configured value of
\"wait time before initiating new re-authentication\" is 30 min then AAnF
shall not invoke the UDM re-authentication service/API if primary (re)
authentication is performed less than 30 min ago and returns an error to AF.
If the interval is 30 minutes or more, then AAnF invokes the UDM service/API
to start the primary re-authentication. Alternatively, \"wait time before
initiating new re-authentication\" can be maintained at the UDM as well.
Figure 5.1.2.3-1: Re-authentication invoked by other NFs
1\. The AAnF wants to perform re-authentication. Therefore, NF shall send a
request to UDM with a new flag for Re-authentication Required.
2\. The UDM authorizes the request based on existing means (e.g. Oauth2.0).
3\. If authorization is successful, the UDM checks whether the primary
authentication for the UE to be initiated or request to be rejected, based on
the operator policy. Operator policy includes the details of the \"waiting
period before initiating new re-authentication\". If the check is passed, the
UDM shall invoke the re-authentication procedure as defined in Steps 4 to 9 of
clause 5.1.2.1.
### 5.1.3 Solution Evaluation
The solution fulfils the requirements defined in KI#1 and related 3 use-cases.
This solution also covers the requirement defined in KI#2. i.e.
+--------+-----------------------------+-----------------------------+ | **KI** | **Use case** | **Solution 1 aspects** | +========+=============================+=============================+ | 1 | Use Case #1: Security of | As defined in clause | | | Interworking | 5.1.2.2, UDM invokes | | | | re-authentication via new | | | | notification or a new error | | | | code if authentication | | | | result is not stored in the | | | | UDM, and ensures K~AUSF~ is | | | | available in the HN when | | | | user moves from EPC to 5GC | +--------+-----------------------------+-----------------------------+ | 1 | Use Case #2: SoR/UPU | As defined in clause | | | Counter Wrap around | 5.1.2.1, the solution | | | | provides an advanced | | | | detection solution where | | | | the SoR/UPU wraparound | | | | situation is detected in | | | | advance, i.e., the AUSF | | | | detects that the UPU/SoR | | | | counter will reach its max | | | | value in the next SoR/UPU | | | | case and informs UDM about | | | | \"Counter~upu/SoR~ Reaching | | | | Max value\". | | | | | | | | It will not impact the | | | | existing session/procedure | | | | at the UDM because the UDM | | | | invokes re-authentication | | | | just after completing the | | | | current procedure. | +--------+-----------------------------+-----------------------------+ | 1 | Use Case #3: KAKMA | As defined in clause | | | refresh. | 5.1.2.3, when an AF wants | | | | to refresh the K~AF~ via | | | | 5GC, the AF requests AAnF | | | | for UE re-authentication so | | | | that the K~AF~ can be | | | | refreshed. The AAnF shall | | | | invoke the UDM | | | | re-authentication | | | | service/API and UDM | | | | performs the | | | | re-authentication by | | | | invoking the AMF APIs. The | | | | AAnF or UDM maintains the | | | | \"wait time before | | | | initiating a new | | | | re-authentication\" to | | | | avoid frequent | | | | re-authentication. | +--------+-----------------------------+-----------------------------+ | 2 | NA | As defined in clause | | | | 5.1.2.3, when an AF wants | | | | to refresh the K~AF~ via | | | | 5GC, the AF requests AAnF | | | | for UE re-authentication so | | | | that the KAF can be | | | | refreshed. The AAnF shall | | | | invoke the UDM | | | | re-authentication | | | | service/API and UDM | | | | performs the | | | | re-authentication by | | | | invoking the AMF APIs. The | | | | AAnF or UDM maintains the | | | | \"wait time before | | | | initiating a new | | | | re-authentication\" to | | | | avoid frequent | | | | re-authentication. | +--------+-----------------------------+-----------------------------+
This solution brings following changes on the node/NFs:
+----------------+----------------------------------------------------+ | **Node/NF/UE** | **Impact** | +================+====================================================+ | UE | NO | +----------------+----------------------------------------------------+ | UDM | UDM provides a new service or API which can be | | | invoked for initiating re-authentication. | | | | | | UDM also receives and handles the AUSF indication | | | of the SoR/UPU wraparound advance indication | +----------------+----------------------------------------------------+ | AUSF | During the SoR/UPU procedure, the AUSF detects the | | | SoR/UPU wraparound in advance and informs the UDM | | | about the same. | +----------------+----------------------------------------------------+ | AMF | AMF receives an indication from UDM to perform | | | re-authentication and then initiates | | | re-authentication | +----------------+----------------------------------------------------+ | AF | Request AAnF to refresh the keys | +----------------+----------------------------------------------------+ | AAnF | Receives a request from AF to refresh the keys and | | | invokes the UDM API | +----------------+----------------------------------------------------+
## 5.2 Solution #2: UDM triggered primary authentication
### 5.2.1 Introduction
This solution is to address the KI#1 by providing a basic procedure on Home
network triggering authentication.
The solution introduces a new service exhibited by the AMF and to be used only
by the UDM to request primary authentication. This is because in 5GC the UDM
knows which AMF is serving the UE. Upon a request from the UDM, the AMF
triggers primary authentication using the existing services and NAS
procedures.
### 5.2.2 Solution details
#### 5.2.2.1 Procedure
{width="5.23125in" height="2.1638888888888888in"}
Figure 5.2.2.1-1: Home network trigger primary authentication procedure
1\. The UDM decides to run primary an authentication based on the request from
the UDM or AUSF or the AAnF. For example, when the UDM needs to send the UPU
data or SoR data but cannot find a valid AUSF instance which means there is no
valid K~AUSF~. Another example is when the AAnF needs to refresh K~AKMA~ based
on the cause value sent by the AF due to any reason.
The AUSF and the AAnF sends Nudm_HNAuthenticate-Request message to the AMF for
this purpose.
After receiving the request, the UDM needs to further consider the local
policy before determine to run the primary authentication, such as whether the
primary authentication has successfully run in a very short period. Then the
UDM selects the AMF that is serving the UE from the UE context. The UDM sends
Namf_HNAuthentication_Request message to the AMF the message contains the SUPI
of the UE.2. The AMF may reply the Namf_HNAuthentication_acknowledge message
to the UDM.
2\. The AMF starts the primary authentication procedure defined in TS 33.501
[3].
#### 5.2.2.2 Procedure used for each use case
Regarding interworking from LTE to 5G, if the UDM does not have a valid AUSF
ID, or the UDM initiates a SoR/UPU procedure but receives a failure from AUSF,
the UDM decides to trigger the primary authentication by sending step1 in
clause 5.2.2.1.
Regarding SoR/UPU counter wrap around, the UDM makes decision based on AUSF\'s
indication.
Regarding AKMA, the UDM makes decision based on AAnF\' s request.
#### 5.2.2.2 Service provided by AMF
##### 5.2.2.2.1 General
The AMF provides Home Network Authentication service to the requester NF, i.e.
UDM, by Namf_HN Authentication.
##### 5.2.2.2.2 Namf_HN Authentication service
###### 5.2.2.2.2.1 Namf_HNAuthentication service operation
**Service operation name:** Namf_ HNAuthentication _Request.
**Description:** Request the AMF starts the primary authentication procedure.
**Input, Required:** SUPI
**Output, Required:** None
**Output, Optional:** None
#### 5.2.2.2 Service provided by UDM
##### 5.2.2.2.1 General
The UDM provides Home Network Authentication service to the requester, i.e.
AUSF and AAnF, NF by Nudm_HN Authentication. The service consumer uses this
service to request the UDM to trigger the primary authentication for
requesting the K~AUSF~.
##### 5.2.2.2.2 Nudm_HN Authentication service
###### 5.2.2.2.2.1 Nudm_HNAuthentication service operation
**Service operation name:** Nudm_ HNAuthentication _Request.
**Description:** Request the UDM to trigger the primary authentication.
**Input, Required:** SUPI
**Output, Required:** None
**Output, Optional:** None
### 5.2.3 Evaluation
This solution addresses KI#1.
This solution can address the LTE-5G interworking case, K~AKMA~ refresh use
case, SoR/UPU counter wrap around use case, and other potential use case that
needs to refresh the K~AUSF~.
A new AMF service and a new UDM service are defined, because there is no
existing SBA message can be reused.
This solution impacts on AMF and UDM.
## 5.3 Solution #3: Home network triggered authentication solution for LTE to
5G interworking
### 5.3.1 Introduction
This solution addresses the KI #1: Ability of the home network to trigger
primary authentication. And it relates to use case #1: Security of
Interworking.
### 5.3.2 Solution details
During the mobility and handover procedures from EPS to 5GS, the UE sends
Registration Request to 5G network with registration type set to \"Mobility
Registration Update\".
In the registration procedure, after the AMF registers with the UDM using
Nudm_UECM_Registration, UDM checks if it supports home network services
requiring K~AUSF~, for example, UPU, SoR and AKMA. UDM also checks for the
corresponding AUSF instance ID. If UDM supports the home network services but
does not have AUSF instance (or does not keep track of AUSF that stores the
latest K~AUSF~ generated after successful completion of the latest primary
authentication reported to the UDM), it replies error information to AMF and
indicates AMF to initiate UE (re-)authentication before continuing the
registration procedure. For example, it responds with 403 Forbidden with the
cause \"REAUTHENTICATION_REQUIRED\". After receiving the error information
from the UDM, AMF initiates UE (re-)authentication by invoking an AUSF.
Specifically, the AMF selects an AUSF based on UE identity and requests
(re-)authentication from the AUSF, as defined in TS 33.501 [3].
NOTE 1: No AMF\'s reaction on this error code in stage 3. The reaction of AMF
to the error information from the UDM need to be clarified in TS 33.501 [3],
and align with TS 29.503 [6]. Normative work is needed for this use case to
guarantee the trigger of authentication in the AMF side.
NOTE 2: This error code is only used for interworking.
### 5.3.3 Evaluation
This solution addresses KI#1 and relates to the LTE-5G interworking case.
This solution has the following impacts.
UDM: The UDM needs to check for the corresponding AUSF instance ID, and checks
if it supports home network services requiring K~AUSF~, before reusing the
error information to indicate AMF for (re-)authentication.
AMF: The AMF needs to react to the error information send from UDM, and
initiates UE (re-)authentication.
## 5.4 Solution #4: UDM initiated primary authentication based on a NF request
### 5.4.1 Introduction
This solution addresses KI#1. The home PLMN triggers re-authentication of the
UE, based on the request from an internal NF (AUSF) which needs to refresh the
K~AUSF~ or K~AKMA~.
### 5.4.2 Solution details
A new primary authentication may require for certain events at the network,
resulting in refresh of the latest home key K~AUSF~. In such scenarios, an
internal Network Function (AUSF) requests the UDM to trigger the re-
authentication procedure.
Figure 5.4.2-1: Home PLMM initiated primary authentication
1) A UE initiates registration procedure and the primary authentication is
performed as specified in TS 33.501 [3] as a part of registration procedure.
After successful primary authentication, a K~AUSF~ is derived at the AUSF and
at the UE.
2) A NF (e.g. AUSF, AAnF) checks whether there is need to refreshing the
K~AUSF~ key (e.g. due to SoR or UPU count wrap around) for the UE.
NOTE 1: This solution does not describe Which NF and under which conditions
triggers the UDM to perform primary authentication is FFS.
3) The NF (e.g. AUSF,) requests the UDM to initiates re-authentication
procedure for the UE by sending a Nudm_re-authentication message including the
SUPI of the UE to initiate the primary authentication to refresh the home key
(e.g. K~AUSF~).
4) Upon receiving the Nudm_re-authentication message from the NF (e.g. AUSF)
for the SUPI, the UDM checks whether the primary re-authentication for the UE
to be initiated or request to be rejected, based on the operator policy.
NOTE 2: This solution does not address if a SoR or UPU transmission procedure
is ongoing then how the UDM handles the current SoR or UPU transmission is not
addressed in the present document.
5) If the operator policy allows, then the UDM sends a Nudm_UDM_message (e.g.
an existing message between UDM and AMF) containing the SUPI of the UE and an
indicator re-authentication required to the current serving the AMF to
initiate the primary authentication for the UE.
NOTE 3: This solution does not describe which service is used for the UDM
triggering the AMF to perform authentication is not addressed in the present
document.
6) Upon receiving the request from the UDM, the AMF (SEAF) initiates the
primary authentication as described in clause 6.1.2 of TS 33.501 [3]. A new
KAUSF is established after primary authentication procedure. The AMF initiates
Security Mode Command procedure after successful primary authentication
procedure to take the recently KAUSF as the current KAUSF.
### 5.4.3 Evaluation
No evaluation was proposed for this solution.
## 5.5 Solution #5: Using the UDM to start home triggered authentications
### 5.5.1 Introduction
This solution addresses KI#1 and KI#2.
### 5.5.2 Solution details
This solution uses the UDM to trigger an authentication with the possibility
of an NF requesting the UDM to trigger the authentication. Having the UDM as a
single point of control to trigger authentications allows the amount of home
triggered authentications to be controlled, e.g. the UDM can reject request
for a new authentication from the AKMA function if there has been a suitably
fresh authentication.
Figure 5.5.2-1: UDM triggered authentications
The home triggered authentication proceeds as follow:
Step 0: The UE is currently registered to either a 3GPP or non-3GPP access.
Step 1: An NF decides that a home triggered authentication is necessary and
sends a request to the UDM including either the GPSI or SUPI of the UE
(depending on what is available to the NF) to trigger an authentication for
that UE.
NOTE 1: Steps 1 and 4 are not needed in the case that the UDM unilaterally
decides that a home triggered authentication is needed and in the overall
solution if it is determined that no NF needs to be able to request a
triggering of an authentication.
NOTE 2: The AKMA function could request a trigger of authentication to refresh
the AKMA key. The AKMA function determines the need to request a trigger of
the authentication based on its local policy, e.g. the AKMA key of a
particular subscription has not been updated sufficiently recently.
NOTE 3: Whether both GPSI and SUPI are needed as options to request the UDM to
triggering an authentication will be determined based on the decision on
whether and which NFs are allowed to make that request.
Step 2: If the UDM agrees to the request from the NF or decides on its own
that a home triggered authentication is needed, the UDM selects an AMF that
the UE is registered to and sends a request to the AMF/SEAF including the SUPI
to trigger an authentication for that UE.
NOTE 4: The UDM has sufficient information to trigger a primary authentication
due to needing to refresh keys used to protect SoR/UPU traffic, mobility from
LTE in the serving network or possible wrap-around of SoR/UPU counters (as it
receives these values from AUSF). Hence these scenarios that are under
discussion can be supported by this solution with no further changes.
NOTE 5: It is left up to implementation which AMF is selected if the UE is
registered to more than one. It is also left to the UDM implementation whether
to try the second AMF if the request to the first one fails.
NOTE 6: This solution is agnostic to the specific SBI service used by the UDM
to trigger the AMF to perform an authentication, e.g. whether is it better to
add a new service or modify an existing service.
Step 3: If the AMF/SEAF agrees to run an authentication, then AMF/SEAF
acknowledges the request from the UDM.
Step 4: If the UDM triggered the authentication due to a request from an NF,
then the UDM responds to the NF with an acknowledgement.
NOTE 7: Another possibility is to delay the responses to after a successful
authentication but the UDM will get such an acknowledgement from the existing
procedures.
Step 5: The AMF/SEAF starts an authentication using existing procedures as
described in clause 6.1.2 of TS 33.501 [3].
### 5.5.3 Evaluation
Solution #5 requires two new pieces of functionality:
\- The UDM to be able to request an AMF to run a primary authentication with
the UE; and
\- An NF of a type agreed to be allowed to be able to request the UDM to
trigger a primary authentication using the above.
Running all the requests through the UDM allows one entity to control the
number of authentications runs triggered. No addition information is needed
for the UDM or AKMA function to be able decide to trigger these
authentications as described in the solution.
## 5.6 Solution #6: UDM initiated primary authentication based on AUSF request
### 5.6.1 Introduction
This solution addresses KI#1. The UDM triggers re-authentication of the UE, if
an internal NF request (AUSF) to initiate re-authentication to refresh the UE
specific home key (K~AUSF~).
### 5.6.2 Solution details
A new primary authentication may require for certain events at the network,
resulting in refresh of the latest home key K~AUSF~. In such scenarios, an
internal Network Function (AUSF) requests the UDM to trigger the re-
authentication procedure.
Figure 5.6.2-1: UDM initiated primary authentication
1\. The primary authentication is performed as specified in TS 33.501 [3].
After successful authentication, K~AUSF~ is derived at the AUSF and at the UE.
2\. AUSF determines (due to long time availability of same key, etc.) the need
of refreshing the K~AUSF~ key. Based on the operator policy, the AUSF can
determine when to refresh the K~AUSF~ for the scenarios such as SoR/UPU
Counter wraparound, due to long lived K~AUSF~ and other case where any
authorized NF (for e.g., AAnF) invokes primary authentication.
3\. If the AUSF determines that there is a need to refresh the K~AUSF~, it
decides to request UDM to initiate the primary authentication to refresh the
home key K~AUSF~. AUSF sends a re-authentication request to the UDM by
providing SUPI of the UE.
4\. Upon receiving the re-authentication request from the AUSF, UDM checks
whether the requesting AUSF is the one that holds the latest K~AUSF~ and
whether the primary re-authentication for the UE to be initiated or not, based
on the operator policy. Operator policy includes the details of the wait
period for the new request, after the last successful authentication.
5\. If the operator policy allows, then the UDM requests the AMF currently
serving the UE to initiate the primary authentication for the UE. Upon
receiving the re-authentication message from UDM, the AMF acknowledges the
request
6\. Upon receiving the request from the UDM, the AMF (SEAF) initiates the
primary authentication as described in clause 6.1.2 of TS 33.501 [3],
resulting in generation of fresh key material in the UE and in the network as
described in clause 6.2 of TS 33.501 [3], if the primary authentication is
performed successfully.
### 5.6.3 Evaluation
This solution proposes to address the following security requirement of KI#1:
\- The home network may be able to trigger a primary authentication.
AUSF determines to refresh the K~AUSF~ in various scenarios such as SoR/UPU
Counter wraparound, due to long lived K~AUSF~ and for other cases such as
AKMA, AAnF determines the need for primary authentication. This solution
proposes a mechanism for the UDM to trigger a primary authentication.
NOTE: The use case on long lived K~AUSF~ is not specified in the present
document.
## 5.7 Solution #7: UDM initiated Primary Authentication
### 5.7.1 Introduction
This solution describes how the UDM initiates a primary authentication to
refresh the long lived key K~AUSF~. The solution addresses Key Issue #1:
Ability of the home network to trigger primary authentication and relates to
use case #2: SoR/UPU Counter Wrap around and use case #3: K~AKMA~ refresh.
### 5.7.2 Solution details
{width="6.686805555555556in" height="4.0in"}
Figure 5.7.2-1
0\. Upon receiving a message that requests to initiates re-authentication
procedure, the UDM triggers a primary authentication procedure.
For example, the UDM receives the Nausf_SoRProtection_response/
Nausf_UPUProtection_response including an application error COUNTER_WRAP
indicating the CounterSoR/CounterUPU associated with the K~AUSF~ of the UE is
about to wrap around. To refresh the K~AUSF~, the UDM could initiate a new
primary authentication procedure.
Another example is that the AAnF determines to refresh K~AKMA~ to avoid
generating the same K~AF~, and sends a message that requests to initiate re-
authentication procedure. By performing the re-authentication procedure, a new
K~AKMA~ can be derived by the new generated K~AUSF~
NOTE: The determination of K~AKMA~ refresh is based on the implementation or
operator policy.
1\. The UDM sends the Re-Authentication Notification, e.g.
Nudm_UECM_ReAuthenticationNotification, (incl. SUPI, Access Type, Re-
Authentication reason) message to the AMF. Same as the
Nudm_UECM_DeregistrationNotification service, the UDM provides the reason for
sending the re-authentication notification to the consumer NF. According to
the core network status, the Re-Authentication reason can be set to SoR
counter wrap around, UPU counter wrap around, etc.
2\. If the UDM has requested an acknowledgement from the AMF, the AMF returns
the Re-Authentication Notification ACK message to the UDM.
3\. The SEAF invokes the Nausf_UEAuthentication service by sending a
Nausf_UEAuthentication_AuthenticateRequest message to the AUSF. The
Nausf_UEAuthentication_Authenticate Request message shall contain SUCI or SUPI
and the Serving network name, as defined in TS 33.501 [3].
4\. The Nudm_UEAuthentication_Get Request sent from AUSF to UDM includes SUPI
and the serving network name. Based on SUPI, the UDM/ARPF shall choose the
authentication method.
5\. Based on the decision of UDM, the UE and the network performs the EAP-
AKA\' or 5G AKA procedure.
6\. The AUSF shall store the new K~AUSF~ and inform UDM about the result and
time of the authentication procedure with the UE using a
Nudm_UEAuthentication_ResultConfirmation Request. The AUSF also resets the
CounterSoR/CounterUPU once the new K~AUSF~ is generated.
7\. The UDM shall store the authentication status of the UE (SUPI,
authentication result, timestamp, and the serving network name).
8\. The UDM shall reply to AUSF with a
Nudm_UEAuthentication_ResultConfirmation Response.
### 5.7.3 Evaluation
This solution fulfils the security requirements of Key Issue #1 and relates to
use case #2: SoR/UPU Counter Wrap around and use case #3: K~AKMA~ refresh.
The proposed solution ensures that the home network is able to trigger a
primary authentication. In addition, the HN-triggered Re-Authentication
request/response messages exchanged between the UE and 5GC is confidentiality
protected, integrity protected and anti-replay protected.
This solution has no impact on the UE.
This solution has impact on the HPLMN.
\- The UDM needs to support a new service operation to notify the AMF of the
need for Re-Authentication. If necessary, the UDM also needs to receive the
Re-Authentication ACK sent by the AMF to acknowledge the success of the
triggered Re-Authentication.
\- In this solution, no new service operation is required for AMF/SEAF. Once
receiving the notification message from UDM, the AMF/SEAF needs to send the
ACK message to UDM and trigger a primary authentication for a given UE.
## 5.8 Solution #8: Solution to enable UDM in the HN to trigger Primary
Authentication
### 5.8.1 Introduction
The Solution address key Issues #1 and #2. The solution enables the UDM in the
Home Network (HN) to trigger the primary (re-)authentication and further also
describes various security context handling (i.e., for SoR, UPU and AKMA)
associated with the K~AUSF~ resulting from a successful primary
(re-)authentication.
### 5.8.2 Solution details
The Solution discuss two main aspects as follows:
(A) HN Triggering Primary (re-)authentication (This part is applicable to use-
case such as a home network triggers a primary (re-)authentication based on
any of: operator policy, or SoR/UPU counter is about to wrap around):
The solution describes various factors that need to be considered by the AUSF
to determine if a primary (re-) authentication is required and if a primary
(re-)authentication is required, the solution further explains how a primary
(re-)authentication is triggered by the UDM (on a request from AUSF) in the
home network as shown in Figure 5.8.2-1.
{width="6.312133639545057in" height="3.525in"}
Figure 5.8.2-1: HN triggered primary authentication with AUSF
The steps shown in Figure 5.8.2-1 are described as follows:
0\. Primary authentication as in TS 33.501 [3] clause 6.1.3. The expiration
time for the primary authentication related to the SUPI can be set in the UDM
based on local policy. After a successful primary authentication, a successful
registration may occur and multiple UE Parameter Update (UPU) procedure and/or
Steering of Roaming (SoR) procedure may happen.
1\. At any point of time, the AUSF can determine to notify any of the
following factors such as:
i) if the SoR counter is about to wrap around; or
ii) if the UPU counter is about to wrap around.
2a. The AUSF sends to UDM a notification message which can include SUPI, cause
value (as suitable to the condition met such as any of: SoR Counter wrap
around indication / UPU Counter wrap around indication).
2b. The UDM on receiving any of SoR Counter wrap around indication, UPU
Counter wrap around indication, checks if valid based on local policy. If a
Counter wrap around indication is received related to SoR or UPU which is
ongoing or required to be sent, the UDM/UDR can locally store the SoR or UPU
data until a successful primary (re-authentication) is completed and
(re-)initiate SoR/UPU accordingly.
2c. The UDM can send an acknowledgement indication in the notification
response message. Further irrespective of the SoR/UPU wrap around conditions,
based on the expiration time locally stored for the primary authentication of
UE related to the SUPI, the UDM can trigger primary (re-)authentication with
steps 7-8.
3\. The UDM sends to the serving AMF/SEAF of the UE an authentication request
with SUPI.
4\. The AMF/SEAF initiates primary (re-)authentication as described in TS
33.501 [3] clause 6.1.2.
(B) AKMA Key handling without signalling overhead (This part is applicable
only for use-case related to AF key expiry and service outage issue):
Setting AKMA Key expiry: The solution describes how an AKMA Key expiration and
AF key expiration are handled in relation to the primary authentication to
enable efficient AKMA related key handling with limited signalling. Figure
5.8.2-2 shows setting of AKMA Key expiry.
Figure 5.8.2-2: Deriving K~AKMA~ and Setting expiry time after primary
authentication
The steps shown in Figure 5.8.2-2 is described below.
> 0\. Initiation of authentication and authentication method selection is
> based on TS 33.501 [3] clause 6.1.2.
1-3. Based on the selected authentication method, generate the authentication
vector (AV) as in TS 33.501 [3] clause 6.1.3. The UDM/UDR based on operator
policy set an expiry time related to the primary authentication and AUSF Key
to be used by the AUSF to set the AKMA key lifetime. The UDM sends to AUSF,
Nudm_UEAuthentication_Get Response message which can include AV, SUPI, an
expiry time (i.e., exp Time) indication, AKMA indication and Routing Indicator
(i.e., if a subscriber has an AKMA subscription UDM includes AKMA indication
and Routing Indicator according to TS 33.501 [3] clause 6.1.3). The AUSF
performs authentication method specific message exchange (i.e., one or more
message exchanges related to the authentication) with the UE as in TS 33.501
[3] clause 6.1.3. On successful primary authentication, the AUSF derives AUSF
Key (i.e., K~AUSF~) and based on home network operator policy stores the
K~AUSF~ as in TS 33.501 [3] clause 6.1.3 along with the SUPI.
4\. If the AUSF receives AKMA indication from UDM, then AUSF derives AKMA
Anchor Key (i.e., K~AKMA~) and A-KID from the AUSF Key (i.e., K~AUSF~) as in
TS 33.535 [5]. The AUSF sets the expiry time for the AKMA Key (i.e., K~AKMA~)
based on the expiry time received from the UDM.
NOTE 1: The need for AKMA Key expiry time is applicable only when this study
conclusions takes into account the \"AF key expiry\" without UE impacts as one
of the aspects to be addressed as part of KI#1 and KI#2. Setting of AKMA key
expiry based on operator policy allows, the AAnF to set AF key expiry time
same as AKMA key expiry. So, before an AF key expire, the home operator would
have performed a home triggered primary authentication based on operator
policy.
The UE can generate the AKMA Anchor Key (K~AKMA~) and the A-KID from the
K~AUSF~ before initiating communication with an AKMA Application Function as
in TS 33.535 [5].
5a. The AUSF selects the AKMA Anchor Function (AAnF) and sends the generated
A-KID, K~AKMA~ and AKMA Key expiry time to the AAnF together with the SUPI of
the UE using the Naanf_AKMA_KeyRegistration Request service operation. The
AAnF can store the latest information (such as latest A-KID, K~AKMA~ and AKMA
Key expiry time) sent by the AUSF.
NOTE 2: When re-authentication runs, the AUSF generates a new A-KID, and a new
K~AKMA~ and sets the new AKMA Key expiry time and sends the new generated
A-KID, new K~AKMA~ and new AKMA Key expiry time to the AAnF. After receiving
the new generated A-KID, K~AKMA~ and new AKMA Key expiry time, the AAnF
deletes the old A-KID, K~AKMA~, and AKMA Key expiry time and stores the new
generated A-KID, K~AKMA~ and new AKMA Key expiry time.
5b. The AAnF stores the received SUPI, A-KID, K~AKMA~ and AKMA Key expiry time
(i.e., K~AKMA~ exp time).
5c. The AAnF sends the response to the AUSF using the
Naanf_AKMA_AnchorKey_Register Response service operation as in TS 33.535 [5].
Setting AF Key expiry:
The expiry time for the AF Key is set based on the expiration time of the AKMA
Key as shown in Figure 5.8.2-3.
The steps shown in Figure 5.8.2-3 is described as follows:
Figure 5.8.2-3: AF Expiration handling and HN triggered primary authentication
1-2. The pre-requisite and steps 1-2 are same as in TS 33.535[5] clause 6.2.1.
3\. Derive AF key as in TS 33.535 [5]. Then the AAnF sets the expiration time
for the K~AF~ considering the locally stored expiration time of the AKMA Key
(Where the expiration time for the K~AF~ can be same as the expiration time of
the AKMA Key).
4-5. Steps 4-5 are same as in TS 33.535 [5] clause 6.2.1. Following a
successful AF key establishment, the UE can securely communicate with the AF
and use the application. At a later point of time, following steps may be
performed on AF key expiry.
6a-b. If the UE request the AF for access and if the K~AF~ expires or is about
to expire, then the AF request the AAnF for the AF key by sending
Naanf_AKMA_ApplicationKey_Get request, which may include indication for key
refresh.
NOTE 3: As the AF key expiration is bound to the expiration of the AKMA Key
and in turn to the expiration of the AUSF Key, by the time AF key expires, the
AUSF Key will also be expired and the AUSF would have triggered primary (re-)
authentication and the primary (re-)authentication would be running meanwhile.
6c. The AAnF checks the locally available AKMA Key expiration time for the
associated A-KID, if it is expired, then the AAnF can determine not to refresh
the AF Key and determines to waits for the new AKMA key to be provided by the
home network (i.e., AUSF);
6d. The AAnF sends to AF a Naanf_Response message, which can include a waiting
time(r) if the AAnF finds that the AKMA Key available is expired for the
A-KID. The waiting time(r) can be used by the AF to retry the key request
procedure with AAnF. During this time, the already running primary
(re-)authentication if succeed, results in a new AKMA key and new AF key
establishment.
7a-b. If the AUSF key expires, the AUSF triggers primary (re-)authentication
as described in (A) step 5-8 of this clause.
### 5.8.3 Evaluation
The solution has the following impacts as described per use case:
NOTE: The listed impacts are redundant as a use case specific evaluation was
expected to be provided for KI#1 and #2.
**Ability of HN to trigger primary authentication Use Case:**
\- UDM: Based on operator policy, locally configured with expiration time for
the primary authentication of UE related to the SUPI. The UDM can trigger
primary (re-)authentication based on local configuration by sending a request
to the serving AMF.
\- AMF: Based on request from the UDM, it need to initiate a primary
authentication.
**SoR/UPU Counter Wrap Around Use Case:**
\- AUSF: If the SoR/UPU Counter is about to wrap around, it notifies the UDM
about the wrap around condition, along with the SUPI.
\- UDM: The UDM need to initiate primary (re-)authentication for a UE by
sending a request to the serving AMF when it receives any SoR/UPU wrap around
related notification from the AUSF.
\- AMF: Based on request from the UDM, it need to initiate a primary
authentication.
**K~AKMA~ Refresh Use Case:**
\- AUSF: If an expiry time is received from the UDM, it needs to set the AKMA
key validity using the received expiry time and need to provide the AKMA key
expiry time to the AAnF along with the AKMA key in the existing procedure.
UDM: The UDM need to initiate primary (re-)authentication for a UE by sending
a request to the serving AMF when the earlier primary authentication validity
is about to expire based on local configuration. Further the UDM based on
local policy need to set an expiration time for the primary authentication
validity as well as an expiry time for the AKMA related key usage.
\- AMF: Based on request from the UDM, it need to initiate a primary
authentication.
\- AAnF: If an AKMA key expiry time is received, based on local policy, the AF
key expiry time should be set considering also the received AKMA key expiry
time.
## 5.9 Solution #9: AMF initiated primary authentication based on AUSF request
### 5.9.1 Introduction
This solution addresses KI#1. A new primary authentication may require for
certain events at the network, resulting in refresh of the latest home key
K~AUSF~. In such scenarios, an internal Network Function (AUSF) requests the
AMF to trigger the re-authentication procedure. The AMF initiates re-
authentication of the UE, if an internal NF requests (AUSF) to initiate re-
authentication to refresh the UE specific home key (K~AUSF~).
### 5.9.2 Solution details
Figure 5.9.2-1: AMF initiated primary authentication
1\. The primary authentication is performed as specified in TS 33.501 [3].
After successful authentication, K~AUSF~ is derived at the AUSF and at the UE.
> 2\. AUSF determines (for e.g., due to long time availability of same key,
> etc.) the need of refreshing the K~AUSF~ key.
>
> 3\. If the AUSF determines that there is a need to refresh the K~AUSF~, it
> decides to perform primary authentication to refresh the home key K~AUSF~.
> AUSF requests UDM to provide UE\'s current AMF by sending Nudm_UECM_Get
> request. If the request is not from the latest AUSF, the UDM rejects the
> request. Only the latest AUSF in which UE is authenticated will be provided
> with the AMF ID.
>
> 4\. Upon receiving the request for the details of the current serving AMF
> from the AUSF, UDM provides UE\'s current AMF details in Nudm_UECM_Get
> response message.
>
> 5\. The AUSF requests the AMF to initiate primary authentication for the UE
> by invoking Namf_UEAuthentication_Authenticate service operation as defined
> in clause 5.9.2.2. Upon receiving the re-authentication message from UDM,
> the AMF acknowledges the request.
>
> 6\. Upon receiving the request from the AUSF, the AMF (SEAF) initiates the
> primary authentication as described in clause 6.1.2 of TS 33.501 [3],
> resulting in generation of fresh key material in the UE and in the network
> as described in clause 6.2 of TS 33.501 [3], if the primary authentication
> is performed successfully.
#### 5.9.2.1 EPC interworking use case
The security procedure for the case when the UE was already registered to the
same PLMN via another System (E-UTRA/EPS) registers with VPLMN AMF is
described below in figure 5.9.2.1-1:
Figure 5.9.2.1-1: Procedure for re-authentication during mobility registration
update
1\. The UE initiates registration by sending a Mobility Registration Update
message to the VPLMN AMF.
2\. The VPLMN AMF executes the mobility registration update procedure as
defined in sub-clause 4.2.2.2.2 of TS 23.502 [2] and retrieves a mapped
security context as defined in TS 33.501 [3] clause 8.1.
3\. The VPLMN AMF invokes Nudm_UECM_Registrationservice operation message to
the UDM to get, amongst other information, the Access and Mobility
Subscription data for the UE (see step 14a in sub-clause 4.2.2.2.2 of TS
23.502 [2]).
NOTE: Whether the existing proposed procedure is sufficient will be discussed
in normative work.
4-5. UDM sends a notification Nudm_UECM_Registration Response to the AMF with
the \"Reauthentication Required\' indication set to true.
6\. Upon receipt of the Nudm_UECM_Registration Response notification in 5, the
AMF shall initiate a Nausf_UEAuthentication_Authenticate service operation.
#### 5.9.2.2 Namf_UEAuthentication_Authenticate
##### 5.9.3.2.1 Namf_UEAuthentication_Authenticate service operation
**Service operation name:** Namf_UEAuthentication_authenticate.
**Description:** The AUSF triggers the Re-authentication procedure.
**Input, Required:** SUPI.
**Output, Required:** Acknowledgement.
### 5.9.3 Evaluation
Based on the local operator policy and annex A.1, solution provides re-
authentication procedure for the case when the UE was already registered to
the same PLMN via another System (E-UTRA/EPS) registers with VPLMN AMF. This
solution proposes to address the following security requirement of KI#1:
\- The home network may be able to trigger a primary authentication.
AUSF determines to refresh the K~AUSF~ in various scenarios like SoR/UPU
counter wraparound, due to long lived K~AUSF~ and other case where any
authorized NF invokes primary authentication. This solution proposes a
mechanism for the AUSF to send a re-authentication request to the AMF and AMF
performs the primary authentication which results in the refresh of the latest
home key K~AUSF~. A new service operation is introduced and whether the
existing proposed procedure is sufficient will be discussed in normative work.
## 5.10 Solution #10: UDM initiated primary authentication based on AAnF
request for K~AF~ refresh scenario
### 5.10.1 Introduction
This solution addresses key issues #1 for K~AKMA~ the refresh use case and key
issues #2. To meet the requirements of both KI #1 and KI #2, the basic idea of
this solution is to make HN trigger primary authentication for K~AF~ refresh
only when necessary.
The solution determines whether to perform primary (re)-authentication
according to whether there are newly generated K~AKMA~, and corresponding
A-KID for the UE. If the HN has already performed primary (re)-authentication
for the UE just before the K~AF~ of a certain AF expired and the primary
(re)-authentication has already generated a new available K~AKMA~, then there
is no need to perform primary (re)-authentication again, thereby mitigating
multiple primary (re)-authentications; otherwise, the HN does need to trigger
primary authentication to generate new K~AKMA~ to refresh the expired K~AF~.
The solution makes the AF notify the AAnF rather than directly request UDM to
perform primary (re)-authentication. Even if more than one AF key expiry
notification is received in a very short period, the signaling overhead on UDM
will be reduced due to the mediation of the AAnF.
### 5.10.2 Solution details
Figure 5.10.2-1: UDM initiated primary authentication based on AAnF request
for K~AF~ refresh scenario
An AF detects that the K~AF~ of a UE is expiry or about to expire, and decides
to refresh the K~AF~.
NOTE 1: How AF detects the AF key expiry and when to send a notification to
the AAnF is implementation specific.
1\. The AF selects the AAnF according to TS 33.535 [5] clause 6.7 using the
A-KID associated with the expired K~AF~. Then it sends a notification to the
AAnF with the UE ID (if available), the A-KID associated with the expiry
K~AF~, the AF identity (AF_ID), and an indication of \"application key
lifetime is about to expire\".
NOTE 2: If the AF is located outside the HPLMN of the UE, it shall discover
the HPLMN of the UE based on the A-KID and sends the notification towards the
AAnF via NEF service API. The NEF selects the AAnF according to TS 33.535 [5]
clause 6.7, then forwards the notification to the AAnF.
2\. Upon receiving the application key expiry notification, the AAnF
determines whether to request UDM to trigger primary (re)-authentication
procedures or not according to the following process.
If the UE ID (e.g., SUPI/GPSI) is present in the received notification
message:
The AAnF checks if there is a newly stored A-KID for the UE which is different
from the received A-KID, if yes, the AAnF skips to step 9;
If the AAnF checks that the locally stored A-KID for the UE is the same as the
received A-KID, it shall check whether to request the HN triggered primary
authentication for the UE based on the operator policy (the operator policy
may include the details of the \"waiting period before initiating new re-
authentication\"); if the check is passed, the AAnF shall continue with step
4-10.
If the UE ID is not present in the received notification message, which
corresponds to the case that anonymous user access to the AF as specified in
TS 33.535 [5] clause 6.2.2, the AAnF retrieves in all of the stored A-KIDs to
check if the received A-KID is present in the AAnF:
> If the received A-KID is present in the AAnF, the AAnF shall check whether
> to request the HN triggered primary authentication for the UE based on the
> operator policy (the operator policy may include the details of the
> \"waiting period before initiating new re-authentication\"); if the check is
> passed, the AAnF shall recover the UE\'s SUPI according to the A-KID, then
> continue with step 4-10;
>
> If the received A-KID is not present in the AAnF, the AAnF shall skip to
> step 10 with an error response.
NOTE 3: When the UE ID is not present in the received notification message of
the AAnF, not finding the received A-KID in the AAnF implies that the A-KID
for the UE has been refreshed. However, the AAnF cannot be aware of what UE
the AF is serving since the UE is using anonymous access. Therefore, the AAnF
cannot derive the new K~AF~ for the AF because the AAnF cannot identify the
latest A-KID and K~AKMA~ for the UE just by the received A-KID.
3) The AAnF request UDM to trigger a primary (re)-authentication for that UE
with the UE\'s SUPI.
4) Editor\'s Note: whether the AAnF can directly invoke the primary
authentication service from UDM is FFS.
5) UDM checks whether the primary re-authentication for the UE to be initiated
or the request to be rejected, based on the operator policy.
6) If the UDM agrees to the request from the AAnF, the UDM selects an AMF that
the UE is registered to and notifies the AMF including the SUPI to trigger an
authentication for that UE.
7) The AMF starts the primary authentication procedure as per TS 33.501 [3]
clause 6.1.3.
8) The UE, AUSF, and AAnF derive AKMA key after primary authentication as per
TS 33.535 clause 6.1 step3\~5.
9) The AAnF derives new K~AF~ from the new K~AKMA~ as specified in TS 33.535
[5] clause A.4.
10) The AAnF sends a notification response message to the AF with the new
A-KID, the new K~AF~ and the K~AF~ expiration time, or sends an error response
to the AF if UE ID is not present in the received notification message and the
received A-KID is not found in the AAnF in step 3.
NOTE 4: If the information in step 10 indicates an error response, the AF may
choose to reject UE\'s access to the AF when the K~AF~ of a UE is expiry based
on local policy. Afterward, UE may trigger a new Application Session
Establishment request with the latest A-KID to the AKMA AF. Using this latest
A-KID, the UE and the AF can establish a new application session using
existing procedures defined in TS 33.535 [5] clause 6.2.
_NOTE 5: If_ the AF is located outside the HPLMN of the UE, the AAnF shall
send the notification response message to the AF via NEF service API.
### 5.10.3 Evaluation
This solution has no evaluation.
## 5.11 Solution #11: Home network triggered primary authentication controlled
by the UDM
### 5.11.1 Introduction
The solution proposes the UDM to be the central point of control for a
potential Home Network triggered authentication (HONTRA). This solution
describes potential directions for all the three use cases.
### 5.11.2 Solution details
#### 5.11.2.1 General
The three use cases investigated in this study (Interworking, SoR/UPU counter
wrap-around, K~AKMA~ refresh) are different with respect to whether the UE is
being registered or whether the UE has already registered to 5GC. Therefore,
there are two main architectural patterns which could be used for the
application of HONTRA or equivalent procedure to solve a potential need for
the 3 use cases. In the first pattern the UDM uses existing procedures to
trigger primary authentication under UE registration while in the second
pattern the UDM triggers a new procedure after the UE is already registered to
the 5GC.
#### 5.11.2.2 UDM triggered primary authentication during UE Registration
The procedure for UDM triggered primary authentication during UE Registration
proposed in this solution is based on existing procedures already defined in
TS 33.501 [3], TS 23.502 [2] and TS 29.503 [6].
Figure 5.11.2.2-1: UDM triggered primary authentication during UE Registration
0\. The Registration procedure as in TS 23.502 [2], clause 4.2.2.2.2, steps
1-13.
1\. During UE registration in AMF, the AMF triggers Nudm_UECM_Registration
service operation to register the UE in the UDM.
2\. The UDM checks the authentication status and decides based on a HN primary
authentication configuration to request a new primary authentication for the
UE. Refer to TS 33.501 [3] clause 6.1.4.2 for more details regarding when UDM
potentially takes this decision. The UDM marks the UE as requiring primary
authentication.
NOTE: A HN primary authentication configuration is a group of configuration
options for authentication decisions. These may be per-UE or PLMN-wide, the
design is left to implementation and could indicate for example when a UE
should be authenticated, the use case for re-authentication, etc. For this
specific case the HN authentication configuration could indicate that the UDM
should perform steps 2, 3, etc. if there is a registration request by the AMF
(step 1) and the UDM cannot find any authentication result state i.e., it
cannot find a pointer to the AUSF which holds the latest K~AUSF~.
3\. Based on the HN primary authentication configuration the UDM decides to
reject the Nudm_UECM_Registration service operation with a
REAUTHENTICATION_REQUIRED error as defined in TS 29.503 [6].
4\. The AMF then initiates the primary authentication procedure as defined in
TS 33.501 [3], clause 6.1.2. The primary authentication is executed according
to TS 33.501 [3], clauses 6.1.3 and 6.1.4. The primary authentication is
successful.
5\. Upon successful primary authentication, the UDM clears the mark that the
UE requires authentication.
6\. The AMF repeats the Nudm_UECM_Registration service operation to register
the UE in the UDM.
7\. The UDM checks the authentication status and now decides that the AMF
registration can be accepted.
8\. The UDM accepts the AMF Registration.
9\. The Registration procedure as in TS 23.502 [2], clause 4.2.2.2.2, steps
14b-25.
See clause 5.11.2.4.1 for more details on how this procedure can be applied to
cover the interworking use case.
#### 5.11.2.3 UDM triggered primary authentication after UE Registration
The procedure for UDM triggered primary authentication after UE Registration
proposed in this solution is depicted in the following figure.
Figure 5.11.2.3-1: UDM Triggered primary authentication after UE Registration
1\. The UE is registered in the 5GC via an AMF. The AMF has registered the UE
in UDM. The AMF potentially has authenticated the UE or has reused an
authentication context from another AMF (or MME). The UDM keeps a time stamp
of the latest UE authentication in 5GC (refer to TS 33.501 [3] clause 6.1.4).
2\. The UDM decides that the UE needs to be authenticated according to the HN
primary authentication configuration. It marks that the UE needs to be
authenticated and takes the action to request a new primary authentication
procedure for the UE towards the AMF. The reasons for the UDM deciding that
the UE needs to be authenticated can be different:
a. The UDM is required to initiate a SoR/UPU procedure for the UE, but it
detects that the corresponding Counters have wrapped-up or are about to wrap-
up. See clause 5.11.2.4.2 for more details on how this procedure can be
applied to cover the SoR/UPU wrap-up use case.
b. The UDM enforces a Home Network primary authentication configuration to
refresh primary authentication after a selected period of time and that time
(based on the time stamp of latest authentication kept in UDM) has expired for
the UE. See clause 5.11.2.4.3 for more details on how this procedure can be
applied to cover the K~AF~ refresh use case.
NOTE 1: For this specific case the HN authentication configuration could be
(a) a time interval every which the UE should be re-authenticated, or (b) an
option to re-authenticate the UE if SoR/UPU counters are about to wrap around,
etc. The specific details of the HN authentication configuration are left for
normative work.
3\. Unless the UE is already engaged in a primary authentication procedure
already, UDM requests the AMF to trigger a primary authentication procedure
for the UE by sending a re-authentication notification to the AMF.
If multiple AMFs are registered in UDM, the UDM selects and notifies one AMF
first and if primary authentication fails, UDM potentially also notifies the
other AMF based on local policies.
This solution proposes that the new service operation is modelled as a
notification operation within the set of services offered by UDM; i.e. a Nudm
service operation.
NOTE1a: Which is the most appropriate alternative to model the re-
authentication notification is left for the normative phase.
4\. . Before acknowledging the Re-Authentication notification, the AMF first
checks if the UE can be contacted to execute the requested primary
authentication procedure. After receiving the notification from the UDM in
Step 3 the AMF potentially marks the UE as requiring re-authentication and
decides based on its own policy and potentially the received Home Network
authentication configuration when to initiate primary authentication and when
to contact the UE or wait for the UE to contact the AMF.
NOTE 2: The AMF could page the UE right away or wait for the UE to contact the
AMF. The behaviour of the AMF is left for normative work since the behaviour
could also be dependent on the requirements of the specific use case for
example a specific use case may be tolerant to the re-authentication blocking
to wait for the UE to contact the AMF.
5\. The AMF replies to the Re-Authentication Notification either with a
successful response including the status information (if the UE is reachable
or not).
6\. If the UE is reachable, the AMF then initiates the primary authentication
procedure as defined in TS 33.501 [3], clause 6.1.2. The primary
authentication is executed according to TS 33.501 [3], clause 6.1.3 and 6.1.4.
The primary authentication is successful.
Otherwise, if the UE cannot be reached, the AMF marks the UE as requiring
authentication, stores this information in the UE security context and:
\- Upon next UE contact in the same AMF, the AMF then triggers the primary
authentication procedure after consulting the information stored in the UE
security context if the UE requires re-authentication.
\- Upon UE registration in UDM via a different AMF, if the new AMF does not
authenticate the UE prior to the AMF registration, the UDM then rejects the
AMF registration with a Re-Authentication Required error as described in
clause 5.11.2.2. If the new AMF is able to retrieve the UE security context
from the old AMF, the security context includes an indication that the UE
needs to be authenticated (this indication was based on the old AMF actions),
or a specific event information. The new AMF acts on this information and
initiates primary authentication. Otherwise, the new AMF registration to the
UDM will trigger the UDM to act and initiate authentication as described in
clause 5.11.2.2.
7\. After the primary authentication is successfully completed, the UDM clears
the mark that UE requires primary authentication in the HN primary
authentication configuration.
8\. The UDM executes other procedures (e.g. SoR/UPU) depending on the reason
that motivated the UDM triggered re-authentication procedure in step 2.
#### 5.11.2.4 Applicability of the UDM triggered primary authentication
procedures to the Use Cases.
##### 5.11.2.4.1 Interworking use case
The UDM triggered primary authentication procedure during registration as
described in clause 5.11.2.2 can be used by the Home Network to initiate
primary authentication during the interworking use case.
It can be observed that interworking mobility from EPS to 5GS could result
from a handover. However, a registration procedure is executed as the last
steps of a handover procedure so the procedure in clause 5.11.2.2 is
applicable for the handover case.
This solution makes use of existing proposed procedures in TS 33.501 [3],
clause 6.1.4.2.
NOTE: Solution #1 (clause 5.1.2.2) and Solution #3 proposes same solution for
the interworking use case as proposed here too. The guidance in TS 33.501 [3],
clause 6.1.4.2 is not normative. Since the AMF behaviour upon receiving an
error response from the UDM is not clear, it needs to be clarified that the
AMF will restart authentication and not reject the UE registration (as it
proposed in the guidance on TS 33.501 [3], clause 6.1.4.2).
##### 5.11.2.4.2 SoR/UPU wrap around use case
The UDM triggered primary authentication procedure after registration as
described in clause 5.11.2.3 can be used by the Home Network to initiate
primary authentication during the SoR/UPU wrap around use case.
The UDM can detect that the SoR/UPU Counters has wrapped-up or are about to
wrap-up during the execution of the corresponding services in AUSF. The UDM
receives the value of the Counters from AUSF so UDM can detect when the
Counter are about to wrap up. Ultimately, the AUSF provides a Counter wrap up
error to UDM when the counters wrap up. Based on the HN primary authentication
configuration, the UDM can then request the AMF to trigger a primary
authentication procedure for the UE.
After the primary authentication is successfully completed, the UDM can
trigger the SoR/UPU procedure if needed.
If the primary authentication cannot be initiated by the AMF after being
requested by the UDM (e.g. in case the UE is not reachable at that time), the
UDM is informed by the AMF in the result of the re-authentication
notification. In this case, the UDM marks the UE as requiring re-
authentication in the HN primary authentication configuration and suspends the
SoR/UPU service for the UE until the UE is authenticated again.
##### 5.11.2.4.3 Home Network triggered primary authentication for K~AF~
refresh
If there is a need to address the K~AF~ refresh use case, the UDM triggered
primary authentication procedure after registration as described in clause
5.11.2.3 can be used to ensure that there is fresh K~AUSF~/ K~AKMA~ key
available in the Home Network for the K~AF~ refresh use case. This could be
achieved in several ways for example the UDM decides based on the HN primary
authentication configuration whether to perform a primary authentication for
K~AF~ refresh or the UDM providing the HN primary authentication configuration
to the AAnF; the AAnF can then decide to set the KAF expiration time based on
the HN primary authentication configuration so that a primary authentication
happens before KAF expiration.
NOTE: The need for KAF refresh based on HONTRA is not addressed in the present
document.
### 5.11.3 Evaluation
This solution addresses the requirements of KI#1 Ability of the home network
to trigger primary authentication.
The solution addresses all the HONTRA use cases namely Interworking from EPS
to 5GS, SoR/UPU counter wrap-around and AKMA KAF refresh.
The solution addresses the interworking use case by proposing to follow the
Nudm_UECM_Registration procedure and the error code that the UDM sends to the
AMF.
The solution addresses the SoR/UPU counter wrap around case by having the UDM
initiate a HONTRA procedure when the UDM determines that the SoR/UPU counter
is about to wrap around.
The solution addresses the AKMA use case by providing the HN primary
authentication configuration to the AAnF; the AAnF can then decide to set the
KAF expiration time based on the HN primary authentication configuration so
that a primary authentication happens before KAF expiration.
The solution has impact on the UDM and AMF.
## 5.12 Solution #12: Delegated Home Network controlled primary authentication
### 5.12.1 Introduction
The solution proposes that the Home Network delegates the enforcement of its
Home Network (HN) primary authentication policy to the Serving Network (SN).
The SN initiates primary authentication upon time intervals and/or events
described in the HN primary authentication policy such as timer events or
receptions of specific messages.
A HN primary authentication policy is a group of configuration options for
authentication decisions. These may be per-UE or PLMN-wide, and could indicate
for example when a UE should be authenticated, the use case for re-
authentication, etc. The exact design of the HN primary authentication policy
is left to normative work.
There are at least two options for the HN primary authentication policy. The
policy could be static such as specific time interval values or the reception
of specific messages for example mobility registration after interworking from
EPS to 5GS. The HN primary authentication policy could also be dynamic with
dynamic time interval values provided to the VPLMN or the reception of
specific messages which could be different upon the different state of the
system.
### 5.12.2 Solution details
The basic concept of this solution is that the HN delegates the enforcement of
its HN primary authentication policy to the SN.
The SN can be made aware of the HN primary authentication policy as part of
the SLA agreements with each roaming partner. Such a sharing of HN primary
authentication policies is in the scope of GSMA. However, when HPLMN provides
the HN policy to the service network, then how the serving network will take
into account such a HN policy is within the remits of 3GPP.
The present document outlines the needed functionality on the home and serving
network to support such a delegated primary authentication.
Alternatively, this solution proposes that the HN provides the HN primary
authentication policy to the SN via an online method using SBA interactions.
Some examples of how the HN authentication policy could be then provided to
the SN include:
a) In the response to the authentication request to the AMF
(Nausf_UEAU_Authenticate Response).
b) In the response to the AMF registration in UDM (Nudm_UECM_Registration
Response).
c) As Subscription Data provided to the AMF during registration (Nudm_SDM_Get
Response).
Depending on the method used, the HN primary authentication policy potentially
applies either at HPLMN level or on a per UE basis (i.e. different UEs of the
HPLMN potentially use different HN authentication policies).
The AMF potentially takes into account the local authentication policy and the
provided HN primary authentication policy and decides when to initiate primary
authentication and when to potentially contact the UE.
### 5.12.3 Evaluation
This solution addresses the requirements of KI#1 Ability of the home network
to trigger primary authentication.
The solution addresses all the HONTRA use cases namely Interworking from EPS
to 5GS, SoR/UPU counter wrap-around and AKMA KAF refresh but details are to be
left for normative work.
The solution addresses the SoR UPU counter wrap around and the AKMA use case
but lack details for these use case cases.
The solution has impact on the UDM and AMF
# 6 Conclusions
It is recommended to specify a new Home Network Triggered Authentication
procedure for which the UDM is the central point that decides when to trigger
the procedure, and its behaviour is controlled by the Home Network. That means
that the UDM triggers interaction with the serving network to request the
execution of primary authentication.
###### ### Annex A: Use cases
# A.1 Use Case #1: Security of Interworking
As an evolution of LTE networks, the 5G system supports backward
compatibility, providing seamless voice and data services continuity.
According to TS 23.502 [2], the 5G core enables interworking between EPS and
5GS, allowing the UE to move between two systems. During interworking between
5GS and EPS, the MME and the AMF perform the handover procedure, which
provides the IP address continuity and the security context mapping on inter-
system mobility to UEs.
As per TS 33.501 [3], when the UE moves from EPS to 5GS, the handover
procedure is initiated by the source MME to provide the target AMF with the UE
identity and UE\'s EPS security context. If the source MME has the UE NR
security capabilities stored, it forwards the UE NR security capabilities as
well to the target AMF.
For the UE moving to 5GS for the first time, the AMF derives a mapped K~AMF~\'
key from the received K~ASME~, then derives the mapped 5G NAS keys (i.e.,
K~NASenc~ and K~NASint~) and K~gNB~ using the mapped K~AMF~\' key. In this
situation, the target AMF has no native 5G security context, it will use the
mapped 5G security context constructed from the EPS security context to
protect the subsequent messages, which does not include a K~AUSF~ key. As
specified in TS 33.501 [3], if the AMF has no native 5G security context
available, when the UE performs the Registration Request following the
handover procedure, the AMF via the SEAF should run a primary authentication
depending on local operator policy.
# A.2 Use Case #2: SoR/UPU Counter Wrap around
The counters for SoR and UPU procedure are maintained by the AUSF as specified
in TS 33.501 [3]. However, there is no mechanism to refresh the counters
unless by running the primary authentication. When the counters are about to
wrap around, there is currently no mechanism by which the home network can
trigger primary authentication in order to refresh the K~AUSF~ key and safely
reset the counters in time. In roaming situations, the home network has no
control on when to trigger such procedure unless by forcing a deregistration
may cause a service disruption for the user.
The maximum value of the counters is 65 536 according to TS 29.509 [4], and
the wrap around of the counter is a corner case due to the infrequent use of
the UPU and SoR procedures. The probability is low for the case of a primary
authentication not happening before 65 536 SoR/UPU messages are transmitted
from the network to the UE.
# A.3 Use Case #3: K~AKMA~ refresh
In TS 33.535 [5], the K~AF~ can only be refreshed by UA* protocol, there is no
other method to refresh it. That\'s because if the UA* protocol does not
support the K~AF~ refresh, and K~AKMA~ is unchanged, the same K~AF~ will be
generated again. If the K~AKMA~ can be refreshed, then the issue is solved.
However, the AKMA feature specified in TS 33.535 [5] does not support refresh
of the K~AKMA~ key. In fact, refresh of AKMA keys is not possible during the
lifetime of the K~AUSF~ key even when the life time of K~AF~ has expired. By
triggering the primary authentication from the home network, the AUSF will
generate a new K~AUSF~ and a new K~AKMA~.
#
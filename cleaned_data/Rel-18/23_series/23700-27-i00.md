# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The scope of this Technical Report is to study the following aspects of 5GS
with satellite backhaul:
1: Architecture enhancements for support of a backhaul with changing delay
(e.g. brought by ISL in satellite networks or changed satellite backhaul on
the UP path), and possibly limited bandwidth in case of a gNB with satellite
backhaul only (e.g. restricted by the maximum data rate of a satellite beam):
\- Policy/QoS control enhancements based on the detected packet delivery
latency and/or bandwidth of the satellite backhaul on the UP path;
\- Exposure of backhaul information to AFs.
2: Architecture enhancements for support of UPF deployed on GEO satellite with
gNB on the ground:
\- Whether and how to enable satellite edge computing services via UPF on-
board e.g. to reduce the latency for data transmission, and minimize the
backhaul resources consumption.
\- How to enhance local switch for UEs in a communication when they are served
by UPF on-board, e.g. to reduce end to end delay comparing with existing 5G
LAN local switch at PSA on the ground.
# 2 References {#references-1}
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G system, Stage 2\".
[4] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System\".
[5] 3GPP TR 23.737: \"Study on architecture aspects for using satellite access
in 5G\".
[6] 3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".
# 3 Definitions of terms, symbols and abbreviations
This clause and its three (sub) clauses are mandatory. The contents shall be
shown as \"void\" if the TS/TR does not define any terms, symbols, or
abbreviations.
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
Definition format (Normal)
**\ :** \.
**example:** text used to clarify abstract rules by applying them literally.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
Abbreviation format (EW)
\ \
# 4 Architecture Assumptions
The 5GS architecture specified in TS 23.501 [2], TS 23.502 [3] and TS 23.503
[4] is used as a baseline.
The following architectural assumptions are applied to the study:
\- At least UP backhaul connection of a gNB is over satellite link.
\- If available bandwidth information is needed in dynamic satellite backhaul
link cases, the bandwidth detection is performed by the transport network
layer.
# 5 Key Issues
## 5.1 Key Issue #1: PCC/QoS control enhancement considering dynamic satellite
backhaul
### 5.1.1 Description
Satellite based backhaul is important for remote area or mission critical
scenarios, in case it is not possible to build terrestrial backhaul
connections.
In Release 17, a satellite backhaul category indication was defined to
indicate the satellite backhaul information in. However, this indication may
not enough if the satellite backhaul involves multi-hops of ISL or backhaul
connections are over different satellites and terrestrial networks. In such
case, the capabilities provided by the satellite backhaul can be
changed/adjusted dynamically. For example, if inter-satellite links are used
on the backhaul path, the delay and bandwidth of the backhaul may be impacted
due to the traffic engineering on the links. Satellite backhaul category is
not enough to describe such a dynamic satellite backhaul characteristics.
To better serve UEs connecting to 5GC via a gNB with satellite backhaul, the
following topics are to be studied:
\- Determination of packet delivery latency or bandwidth or both of the
satellite backhaul on the UP path.
\- Policy/QoS control enhancements based on the determined packet delivery
latency or bandwidth or both of the satellite backhaul on the UP path.
\- What kind of backhaul information can be exposed to the AF, and how to
perform the exposure?
\- Whether and how to solve packet out-of-sequence problems introduced by
dynamic satellite backhaul.
## 5.2 Key Issue #2: Support of Satellite Edge Computing via UPF on board
### 5.2.1 Description
Whether and how to enable satellite edge computing services via UPF on-board
e.g. to reduce the latency for data transmission, and minimize the backhaul
resources consumption.
NOTE: Coordination with CT4 may be done on aspects related to N4 association
between the UPF on board and 5GC NFs on the ground.
## 5.3 Key Issue #3: Support of Local Data Switching via UPF on-board
### 5.3.1 Description
How to support local data switch for UEs in a communication when they are
served by UPF on-board, e.g. to reduce end to end delay comparing with
existing 5G LAN local switch at PSA on the ground?
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
              Key Issues
* * *
Solutions 1 2 3  
1 x  
2 x  
3 x  
4 x x  
5 x  
6 x x  
7 x  
8 x  
9 x  
10 x
## 6.1 Dynamic delay solution
### 6.1.1 Description
In Rel-17 reference architecture specified in TS 23.501 [2] and TS 23.502 [3],
the AMF is configured with the awareness of satellite backhaul categories as
specified in clause 5.8.2.15 of TS 23.501 [2]. The AMF informs the SMF of
satellite backhaul category that is being used when PDU session is established
and after change or handover causing different backhaul connection to be used.
In roaming case, the V-SMF relays the satellite backhaul category to H-SMF.
The PCF is informed of satellite backhaul category as the SMF includes it SM
Policy Association establishment. Based on this knowledge, the PCF can set the
QoS policies accordingly.
NOTE 1: For a gNB that only has single type of satellite backhaul, the AMF
detection of satellite backhaul is based on local configuration, e.g. based on
AMF awareness of Global RAN Node ID.
A gNB may have multiple candidate satellite backhaul on N2 and N3 interfaces,
e.g. GEO satellite backhaul, LEO satellite backhaul, LEO satellite backhaul
with ISL. The gNB uses a single satellite backhaul connection from the set of
available candidate satellite backhauls for all UEs that the gNB is serving at
any point in time. The following figure gives an example scenario:
Figure 6.1.1-1: Example scenario that gNB has multiple candidate satellite
backhauls
For such scenario, the gNB may use different CP Transport Layer Information
for different satellite backhaul on N2 interface. The AMF determines the
Satellite backhaul category (i.e. GEO, MEO, LEO or OTHERSAT) based on local
configuration gNB ID and CP Transport Layer Information used by the gNB on N2
interface.
NOTE 2: It is assumed that N2 and N3 interfaces of a gNB use the same
satellite backhaul at a certain time.
NOTE 3: For the deployment that gNB use same CP Transport Layer Information
for different satellite backhauls, it\'s assumed that the AMF will be updated
by OAM with the latest satellite backhaul type of a gNB when the gNB switches
to a different satellite backhaul.
Awareness of QoS changes is needed to adapt this Rel-17 solution to the
dynamic delay requirement in Rel-18. That awareness of variable delay can be
obtained by re-using the capability for the SMF to request QoS monitoring from
the UPF that is specified in clause 5.33.3.3 of TS 23.501 [2]. The SMF can be
configured to request QoS monitoring depending on the satellite backhaul type
category signalled from AMF e.g. for GEO but not LEO, the UE location and also
be configured to request (again) QoS monitoring based on certain triggers e.g.
time related or UE location related.
In addition to the already specified use cases where the SMF informs the PCF
of the satellite category, the SMF needs to be enhanced to measure the N3
using the echo procedure and to inform the PCF of not only satellite category
but also the observed delay.
### 6.1.2 High level architecture principles
Figure 6.1.2-1 shows the call flow that will say the following:
Figure 6.1.2-1: Dynamic delay monitoring and QoS adaptation
1\. During PDU session establishment, PDU session modification or handover
that leads to NG-RAN with different backhaul category, the AMF determines the
satellite backhaul category based on configuration.
2\. The AMF informs the SMF of satellite backhaul by including the Satellite
Backhaul Category in Nsmf_PDUSession_CreateSMContext or in
Nsmf_PDUSession_UpdateSMContext message as specified in clause 4.3.2.2 of TS
23.502 [3].
3\. SMF responds by Nsmf_PDUSession_CreateSMContext Responsed message or
Nsmf_PDUSession_UpdateSMContext Response.
4\. SMF informs PCF of the satellite backhaul by including Satellite Backhaul
Category in Npcf_SMPolicyControl_Create Request during SM Policy Association
Establishment as specified in clause 4.16.4 of TS 23.502 [3] or
Npcf_SMPolicyControl_Update Request during SM Policy Association Modification
as specified in clause 4.16.5 of TS 23.502 [3].
The PCF takes the policy decision based on the information that it has
received so far but at this point, the PCF is not yet aware of any dynamic
changes in the observed backhaul delay.
Based on the Satellite Backhaul Category, the PCF may indicate SMF to activate
QoS monitoring in the PCC rules.
5\. Since SMF knows based on indication received from the AMF in step 2 that
satellite backhaul is used, and/or based on the received PCC rules, the SMF
initiates GTP-U path monitoring as specified in clause 5.33.3.3 of TS 23.501
[2], no matter whether the GTP-U path is over a satellite backhaul with
dynamical delay.
NOTE 1: The SMF need not request echo procedure for every PDU session of every
UE that are served by the same gNB.
6\. SMF receives GTP-U path monitoring results indicating the observed delay.
7\. Upon receiving the observed delay from the UPF in step 6, the SMF
initiates SM Policy Association Modification in order to inform the PCF of the
Satellite Backhaul Category and (optionally) the observed delay. The SMF may
be configured with margins of the observed delay to determine the
actualSatellite Backhaul Category in use to report to PCF.
8\. [Conditional] The SMF may inform the CHF of the Satellite Backhaul
Category and the observed delay. This information may be used for charging,
network statistics and sorting out customer complaints. This step is
asynchronous and the SMF can initiate it at any time after having received the
delay information at step 6.
NOTE 2: Step 8 can be supported in stage 3 using Charging Data Request /
Charging Data Response message.
9\. PCF adjusts the QoS policy according to the observed N3 delay. PCF may
need to report the delay or Satellite Backhaul category or both to AF for
application specific reasons.
### 6.1.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
SMF:
\- Capability to trigger GTP-U path monitoring when satellite backhaul is
used.
\- Capability to report the observed delay resulting from GTP-U path
monitoring to CHF.
PCF:
\- If observed delay is reported from SMF, PCF needs to have the capability to
receive observed delay and to take it into account for policy control
decisions.
It is assumed that OAM can provide the AMF with the satellite backhaul type
used between a gNB and the AMF.
## 6.2 Solution for KI#1: QoS control enhancements for dynamic satellite
backhauling
### 6.2.1 Description
In Rel-17, only a single satellite backhaul category refers to the type of the
satellite (i.e. GEO, MEO, LEO or OTHERSAT) can be indicated.
In Rel-18, the multi-hops ISL or multi-types of backhaul will be considered,
for example, as shown in the Figure 6.2.1-1, a gNB may have UP connections
each of which is over different satellites. Before establishing UP connection
of the PDU session, the AMF may not know what kind of satellite backhaul is
used to serve the PDU session. In such case, only a single satellite backhaul
category is not enough to describe the dynamic satellite backhaul
characteristics.
Figure 6.2.1-1: gNB has multiple satellite backhaul UP connections
Moreover, due to dynamic satellite network topology and distinguished
transmission capabilities provided by different type of satellites, statically
configured QoS parameters for the PDU session may not always be suitable.
Therefore, the QoS control for the case of satellite backhaul needs to be
enhanced.
In addition, since the backhaul information (e.g. backhaul delay, backhaul
category) can be changed/ adjusted dynamically, the AF may request the
backhaul information for application layer optimization or adjustment.
### 6.2.2 Procedures
Figure 6.2.2-1 shows the procedure of the PDU session establishment when gNB
has multiple satellite backhaul UP connections.
Figure 6.2.2-1: PDU session establishment when gNB has multiple satellite
backhaul UP connections
1\. The UE initiates the PDU Session Establishment procedure by invoking the
PDU Session Establishment Request as specified in clause 4.3.2.2 of TS 23.502
[3].
2\. The AMF selects the SMF/I-SMF as specified in clause 6.3.2 of TS 23.501
[2] and clause 4.3.2.2.3 of TS 23.502 [3]. The AMF determines the satellite
backhaul information based on the RAN ID or the configuration.
If the AMF is aware that more than one type of the backhaul networks (e.g.
multi-types of satellites or multi-hops of ISL) can be used by the serving
gNB, or different backhaul networks can be used in the CP and the UP at the
same time or in the UP only, the AMF may invoke
Nsmf_PDUSession_CreateSMContext Request to inform the SMF of the satellite
backhaul information indicating dynamic satellite backhaul in use.
3\. SMF informs the PCF of the satellite backhaul information by including
\"dynamic satellite backhaul in use\" indication in
Npcf_SMPolicyControl_Create Request during SM Policy Association Establishment
as specified in clause 4.16.4 of TS 23.502 [3].
4\. Based on the indication, the PCF generates PCC rules suitable for
satellite backhaul, where the PCC rules indicate to activate QoS monitoring.
In addition, if downgraded QoS requirements are allowed, the PCF may also
provide Alternative QoS Profile for downgraded QoS requirements.
5\. The SMF selects the candidate UPF(s) as specified in clause 6.3.3 of TS
23.501 [2]. Based on the received PCC rules, the SMF requests to activate QoS
monitoring for the GTP-U path(s) between at least one of the candidates UPF(s)
and the (R)AN serving the UE via N4 Association Update Request.
NOTE: the SMF determine the gNB serving the UE based on the ULI.
It is assumed that the SMF is configured with GTP-U IP addresses per gNB ID.
6\. The candidate UPF(s) confirm to perform the GTP-U path monitoring.
7\. If a candidate UPF doesn\'t activate QoS monitoring for the GTP-U path
already, it sends an Echo Request message to the gNB.
8\. The gNB responds an Echo Response message.
9\. The candidate UPF(s) sends the QoS monitoring results to the SMF.
10\. Upon receiving the QoS monitoring results from the UPF(s) in step 7, the
SMF selects the suitable I-UPF and/or PSA UPF, e.g. a UPF with the minimum
backhaul latency.
Based on the received QoS monitoring results, the SMF may determine to apply
the QoS profile for downgraded QoS requirements, or initiate an SM Policy
Association Modification procedure.
The SMF may also report the QoS monitoring results to the PCF periodically or
by event triggered (e.g. the change of latency is over the threshold). In
addition, the SMF may indicate the bandwidth on the N3 interface between the
gNB and the selected UPF to the PCF, where the bandwidth is obtained from the
satellite system using implantation method, i.e. the interaction between SMF
and satellite system will not be standardized in this release.
11\. Complete the follow-up PDU session establishment process with the
existing steps as specified in clause 4.3.2.2 of TS 23.502 [3].
12\. The AF may request to obtain the satellite backhaul information for an AF
session using Nnef_AFsessionWithQoS_Create request message (satellite backhaul
information) to the NEF, e.g. when the AF would like to adjust data
transmission strategy.
13\. The NEF authorizes the AF request and interacts with the PCF to obtain
the satellite backhaul information by invoking Npcf_PolicyAuthorization_Create
Request.
If the AF is considered to be trusted by the operator, the AF uses the
Npcf_PolicyAuthorization_Create request message to interact directly with PCF
to request satellite backhaul information for an AF session.
14\. The PCF exposes the satellite backhaul information (e.g. backhaul delay
and/or bandwidth) to the NEF by reporting QoS Monitoring information.
15\. The NEF exposes the satellite backhaul information to the AF.
If the AF is considered to be trusted by the operator, the PCF sends the
Npcf_PolicyAuthorization_Create response message (satellite backhaul
information) directly to AF.
### 6.2.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
AMF:
\- Capability to determine dynamical satellite backhaul in use;
\- Capability to send the satellite backhaul indication to the SMF.
SMF:
\- Capability to trigger GTP-U path monitoring when satellite backhaul is
used.
\- Capability to report the QoS monitoring results from GTP-U path monitoring
to PCF.
\- Configured with GTP-U IP addresses per gNB ID
PCF:
\- Capability to receive satellite backhaul UP information and to take it into
account for policy control decisions.
\- Capability to expose dynamical satellite backhaul information to the NEF.
AF:
\- Capability to request dynamical satellite backhaul information
NEF:
\- Capability to expose dynamical satellite backhaul information
## 6.3 Solution for Key Issue #1: Information of satellite constellation and
change of backhaul delay exposed to PCF/AF
### 6.3.1 Description
If the satellite backhaul involves multi-hops of ISL, in some cases, the
propagation delay of backhaul paths may change dramatically with the movement
of satellite and such kind of change normally be periodic and can be well
predicated based on the operation information of satellite constellation.
If a polar-orbit satellite constellation is used and it does not support
cross-seam ISLs, the backhaul delay may change dramatically when cross-seam
transits or leave. If cross-seam ISLs are supported, there will be frequent
ISL handover with the movement of satellites on the different side of the
cross-seam, the backhaul delay may not change dramatically, but the delay
jitter will be larger due to the frequent handover of ISL.
As the cross-seam transit may last for minutes or even hours (dependent on
density of the satellites orbits in the constellation and location of gNB and
5GC), it is worthwhile to report such kind of predictable and crucial event
and its lasting time to PCF/AF, e.g. to help them understand that the dramatic
packet latency/jitter increase is inevitable over a period time, then AF may
start to perform application layer coding compensation or PCF may make a firm
decision to release the PDU session if the QoS requirement is not satisfied.
### 6.3.2 Procedures
Figure 6.3.2-1: Information of satellite constellation and change of backhaul
delay exposed to PCF/AF
1\. AMF reports the satellite constellation information to PCF/AF during the
PDU session establishment procedure. Besides the satellite backhaul category
indication, AMF also reports the satellite constellation information including
\'LEO or MEO polar-orbit satellite constellation with or without cross-seam
ISLs supported\', if multi-hops of ISLs are involved by a polar-orbit
satellite constellation. AMF determines the Satellite constellation
information based on local configuration using the same mechanism as defined
in TS 23.501 [2], i.e. based on local configuration, for example based on
Global RAN Node IDs associated with satellite backhaul.
2\. If satellite backhaul with LEO or MEO polar-orbit satellite constellation
information is received, AF/PCF requests report of backhaul delay change
information based on PCRT mechanism as described in clause 6.1.3.18 of TS
23.503 [4].
3-4. Based on satellite operation information which is a timer including the
time when cross-seam transit or leave event starts and stops, AMF determines
that backhaul delay will change and reports the delay change information (the
time of the event is expected to last) to PCF/AF based on PCRT mechanism as
described in clause 4.16.5.1 of TS 23.502 [3] AMF utilizes the
Nsmf_PDUSession_UpdateSMContext service to report the delay change information
to SMF.
NOTE: AMF can obtain the satellite operation information by local
configuration or from a satellite operation centre outside the 3GPP domain.
### 6.3.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
AMF:
\- Capability to report polar-orbit satellite constellation information.
\- Capability to determine and report of duration time of cross-seam transit
or leave event of polar-orbit satellite constellation to PCF and AF via SMF.
SMF:
\- Receive the satellite constellation information and duration time of cross-
seam transit or leave event from AMF and report it to PCF/AF.
PCF/AF:
\- Capability to ask report of backhaul delay change information if polar-
orbit satellite constellation information received.
## 6.4 Solution for Key Issue #2 and Key Issue #3: Enable Satellite Edge
Computing or local data switching via on-board UPF acting as UL CL/BP and
local PSA
### 6.4.1 Description
This solution corresponds to KI#2 and KI#3.
UE establishes a PDU Session with PSA on ground via GEO satellite backhaul.
SMF needs to:
1) determine whether to insert a UL CL/BP on the GEO UPF; and
2) obtain the target IP of traffic to be local routed to configure the traffic
steering rule to the GEO UPF (UL CL/BP/local PSA).
### 6.4.2 Procedures
Figure 6.4.2-1 shows the procedure to enable satellite edge computing or local
data switching via on-board UPF acting as UL CL/BP and local PSA.
Figure 6.4.2-1: Enabling GEO satellite edge computing via on-board UPF
0\. During PDU Session establishment procedure, the AMF determines the GEO
satellite ID serving the UE as backhaul and send the GEO satellite ID to the
SMF in Nsmf_PDUSession_CreateSMContext Request.
If multiple candidate satellite backhaul co-existed for the RAN, AMF uses
mechanisms defined in clause 6.1.1 (e.g. determining whether GEO satellite is
used based on CP Transport Layer Information or OAM configuration) to judge
whether/which GEO satellite is used.
The SMF registers the UE IP/DNN and the DNAI to the UDM when invoking
Nudm_UECM_Registration service operation.
NOTE 1: It is assumed that the AMF can determine the GEO satellite ID for the
notification to the SMF based on local configuration, e.g. based on Global RAN
Node IDs associated with satellite backhaul.
1\. SMF determines to insert GEO UPF as UL CL/BP and local PSA with the
following triggers:
1a. (For edge computing case) During the PDU Session establishment procedure,
SMF determines the UE traffic can be local routed at a DNAI assigned to the
GEO satellite based on the following information:
1) UE location;
2) GEO satellite ID;
3) the existing policy from PCF based on AF influenced information on what
DNAIs the UE can access to;
4) EAS Deployment Information.
5) Mapping relationship between DNAI and corresponding GEO satellite ID, as
configured on SMF.
SMF determines the traffic steering rules based on the IP range of the EAS
deployed on the GEO UPF.
1b. (For UE-to-UE case) AF initiates UE-to-UE communication for two UEs by
providing UE ID/IPs of both UEs to the SMF.
NOTE 2: AF might be triggered by application layer negotiation which is not in
the scope of this study.
The SMF derives the DNAI corresponding to the GEO satellite based on the SMF
configuration and the GEO satellite ID received from AMF. The SMF determines
two UEs are under the same DNAI.
If the same SMF is used for the two UEs, the SMF determines whether two UEs
are under the same DNAI based on stored correlation between the DNAI and UE
IP/DNN.
If different SMFs are used for two UEs, the SMF checks whether the two UEs are
served by the same DNAI via UDM. The SMF retrieves DNAI from UDM based on the
IP/DNN of the peer UE and checks whether the two UEs are served by the same
DNAI of the GEO UPF.
NOTE 3: New Nudm_UECM service operation is needed to get DNAI of the peer UE
using UE IP/DNN as the input.
When one UE quits the UE-to-UE communication, the SMF is notified by the AF.
The SMF initiates PDU Session Modification procedures for both of the UEs to
update the traffic steering rules or release the UL CL/BP/local PSA.
SMF determines traffic steering rules for the two UEs based on the target UE
IP.
1c. (For edge computing and UE-to-UE case) UE sends UL packet to PSA UPF on
ground. The PSA UPF on ground reports related information, e.g. FQDN in DNS
query as described in clause 6.2.3 of TS 23.548 [6] or target IP, to SMF.
For edge computing case, the SMF determines UE is accessing local services via
the DNAI based on mechanisms described in clause 6.2.3 of TS 23.548 [6].
For UE-to-UE case, the SMF determines the two UEs, i.e. the source UE and the
target UE, are under the same GEO satellite.
SMF determines traffic steering rules based on the target IP address detected
and reported by the PSA UPF.
NOTE 4: For step 1a/1b/1c, a DNAI value needs to be assigned by the operator
to each GEO satellite. After step 1a/1b/1c, DNAI value will be used instead of
GEO Satellite ID, so that existing UPF selection and other EC procedures can
be reused to support the local routing on the GEO satellite.
2\. SMF selects and inserts the GEO UPF as UL CL/BP and local PSA and sends
traffic steering rules to the GEO UPF.
For edge computing case, the traffic steering rules indicate the ULCL/BP to
perform local routing for the packets targeting the EC services via the DNAI.
For UE-to-UE case, the traffic steering rules indicate the ULCL to perform
local routing for the packets to the target UE.
If the GEO satellite does not server the UE anymore due to e.g. UE mobility,
the AMF will trigger PDU Session Modification procedure to update the SMF with
new (or none) GEO satellite ID/backhaul category. Then the SMF will
reconfigure the user plane based on the updated backhaul information as
described in step 1 and 2. This may cause ULCL/BP insertion/relocation or
removal.
### 6.4.3 Impacts on services, entities and interfaces
AF:
For UE-to-UE case:
\- Provide/Update UE ID/IP for UE-to-UE communication to the SMF.
AMF:
\- Determines GEO Satellite ID based on local configuration and RAN ID and
provides to SMF during PDU Session Establishment/Modification procedures.
SMF:
\- Receives GEO Satellite ID from AMF during PDU Session
Establishment/Modification procedures.
\- Be configured by the operator a DNAI value for each GEO satellite.
\- Derives the DNAI value based on the configuration and the GEO satellite ID
received from AMF.
For UE-to-UE case:
\- Determine whether local data switching should be performed for UEs served
by same GEO satellite based on AF request or PSA UPF reporting.
\- Interact with UDM to store DNAI and UE IP/DNN. Check whether two UEs are
served by same DNAI in case of different SMFs serving UEs in communication.
UDM:
For UE-to-UE case, when different SMFs are used:
\- Receive and store DNAI and UE IP/DNN from SMF.
\- Provide DNAI query service based on UE IP/DNN.
## 6.5 Solution for KI#2: Support of Satellite Edge Computing via UPF on board
### 6.5.1 Description
As stated in TS 23.548 [6]:
_\"The Edge Computing enables operator and 3rd party services to be hosted
close to the UE\'s access point of attachment, so as to achieve an efficient
service delivery through the reduced end-to-end latency and load on the
transport network\"._
In Rel-18, in order to enable GEO satellite edge computing, a UPF can be
deployed on the satellite. The following figure shows the high level
architecture of the Satellite Edge Computing via UPF on board.
Figure 6.5.1-1: Satellite Edge Computing via UPF on-board
Based on the existing Edge Computing(EC) specification, for providing the
application service timely, the Edge Application Servers(EAS) can be deployed
on-board and connected to the UPF on-board via a N6 interface. As specified in
clause 6.2.3 of TS 23.548 [6], in order to start the EC application service,
the UE can initiate the EAS discovery procedure which can discover the IP
address(es) of the EAS using Domain Name System (DNS). Therefore, if the EAS
can be selected by the UE, the UPF on-board can also be selected to support
the Satellite Edge Computing service.
As specified in clause 5.2.1 of TS 23.548 [6], the Edge DNS Client (EDC)
functionality in UE ensures that DNS requests from applications are sent to
the DNS Server\'s (e.g. EASDF/DNS resolver) IP address received from the SMF
and can ensure the usage of the EAS discovery procedure. If a UE without EDC
functionality, it can also use the EAS (re-)discovery functionalities provided
by EASDF but cannot be ensured. As specified in clause 5.1.1 of TS 23.548 [6],
according to the instruction from the SMF, the Edge Application Server
Discovery Function (EASDF) can forward the DNS messages to the DNS server
which can resolve the IP address(es) of the EAS. Due to the SMF and the DNS
server are all deployed on the ground, the EASDF can also be deployed on the
ground.
As specified in clause 6.2.3.2 of TS 23.548 [6], due to the IP address(es) of
the EAS needs to be resolved by the DNS server that is on the ground first, a
PDU session with the UPF on the ground needs to be established. Then, based on
the UE\'s subscription data, UE location, the information from Application
Function (AF), the EAS information reported from EASDF, the SMF may select the
target DNAI and trigger UL CL/BP and L-PSA insertion.
For the Satellite Edge Computing case, the SMF has to select a UL CL/BP and a
L-PSA on the satellite serving a gNB, e.g. taking the identity of the
satellite serving the gNB into account to select a UPF on-board.
As specified in clause 5.13 of TS 23.501 [2], the UPF can be selected by the
SMF based on the DNAI. The DNAI may correspond to multiple UPFs on-board.
However, the satellites that deploying the selected UPF may not be able to
provide the satellite backhaul service to the gNB serving the UE.
The connectable gNB IDs/IPs are proposed to be included in the UPF profile.
Based on the UPF profile and the gNB serving the UE, the SMF can select the
UPF on-board that can provide the satellite backhaul service to the gNB
serving the UE.
When a GTP-U path is activated (echo request/response) between gNB and UPF on-
board, the UPF on-board can know the gNB IP address. If UPF profile includes
gNB ID, then the UPF on-board needs to be configured with the mapping between
gNB ID and the gNB IP, so that the UPF can report gNB ID to the SMF via N4
node level procedure, e.g. N4 report procedure. The UPFs are assumed to be
configured with the possible gNB IP addresses so that UPF can initiate GTP-U
path monitoring towards this gNBs using echo request/response.
### 6.5.2 Procedures
Figure 6.5.2-1 shows the procedure of EAS(UPF on-board) discovery procedure
with EASDF.
Figure 6.5.2-1: EAS(UPF on-board) discovery procedure with EASDF
0\. During the procedure of NG setup, the gNB may inform the AMF of satellite
backhaul information and the gNB ID.
1\. The UE initiates the PDU Session Establishment procedure by invoking the
PDU Session Establishment Request as specified in clause 4.3.2.2 of TS 23.502
[3]. If the AMF is aware that the serving gNB uses satellite backhaul UP
connections, the AMF invokes Nsmf_PDUSession_CreateSMContext Request to send
satellite backhaul UP connections information and the gNB ID. The SMF
retrieves the UE subscription information from the UDM (which may optionally
include an indication on UE authorization for EAS discovery via EASDF) and
checks if the UE is authorized to discover the EAS via EASDF. If not
authorized, this procedure is terminated.
2\. Based on the UE subscription information, the SMF selects EASDF as
described in clause 6.3 of TS 23.501 [2].
3\. The SMF invokes Neasdf_DNSContext_Create/Update Request (UE IP address,
SUPI, DNN, notification endpoint, (DNS message handling rules)) to the
selected EASDF as specified in clause 6.2.3.2.2 of TS 23.548 [6].
4\. The EASDF invokes Neasdf_DNSContext_Create/Update Response (IP address of
the EASDF) to the SMF.
5\. The Application in the UE uses the EDC functionality as described in
clause 6.2.4 of TS 23.548 [6] sends the DNS Query to the EASDF.
6\. The EASDF handles the DNS Query message received from the UE as specified
in clause 6.2.3.2.2 step 12 of TS 23.548 [6].
7\. The EASDF sends the EAS IP addresses which are determined by the DNS
system to the SMF as specified in clause 6.2.3.2.2 of TS 23.548 [6].
8\. The SMF selects a UL CL/BP and Local PSA on-board.
Based on the EAS information received from the EASDF, UPF selection criteria,
and possibly Service Experience or DN performance analytics for an Edge
Application, the SMF may determine the DNAI and determine the associated N6
traffic routing information for the DNAI.
The SMF may utilize the NRF to obtain the UPF profile(s), or, the SMF may
obtain the UPF profile(s) from the UPFs associated with the DNAI via N4 node
level procedure, e.g. N4 report, where each UPF profile includes one or more
gNB IDs/IPs which is connecting with the UPF on-board. Based on the UPF
profile and the gNB ID received from the AMF, the SMF determines the UL CL/BP
and Local PSA on-board.
NOTE: The UL CL/BP and L-PSA on the satellite are combined in this release of
the specification.
9\. The SMF inserts UL CL/BP and Local PSA as described in TS 23.502 [3].
10\. The EASDF sends the DNS Response(s) to the UE if it is indicated to send
the buffered DNS response(s) to UE.
### 6.5.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
SMF:
\- Capability to determine UL CL/BP and Local PSA on-board which has
connection with the gNB serving the UE.
UPF:
\- Configure the connectable gNB ID list or gNB IP range in the UPF profile.
## 6.6 Solution for Key Issue #2 and Key Issue #3: Enable on-board EC or local
data switch based on GEO PSA UPF
### 6.6.1 Description
This solution resolves the Key Issue #3 to support local data switch for UEs
in a communication when they are served by PSA UPF on-board. This solution
also resolves the Key Issue #2 to support satellite edge computing via PSA UPF
on board.
For the case a UE communicates with another UE directly via 5GC without
preconfigured VN Group association, e.g. via point-to-point application and
protocols, the existing 5G LAN local switch cannot be reused. In this case,
especially for the scenario that UPF is deployed on GEO satellite with gNB on
the ground, on-board local data switch would be very beneficial to reduce end-
to-end latency. This solution proposes a UPF-level session based approach to
support local data switch.
In this solution, the on-board UPF is a PSA UPF and it is assumed that a
single SMF is used. UE establishes a PDU Session with the GEO UPF acting as
PSA.
UE initiates PDU Session Establishment procedure based on URSP rules and sends
DNN/S-NSSAI to AMF as described in clause 4.3.2 of TS 23.502 [3]. SMF selects
GEO UPF as the PDU Session anchor based on the DNN/S-NSSAI sent by AMF. PCF
determines the URSP rules based on GEO satellite backhaul category from AMF
and send it to the UE including DNN/S-NSSAI for services deployed in GEO
satellite or UE-to-UE services. The N4 rules of the UPF-level session applies
to the DNN/S-NSSAI.
After the PDU Session Establishment, the UE can access to the edge computing
services deployed on the satellite via normal N6 routing.
### 6.6.2 Procedures
To support UE-UE local data switch via UPF on board, the following procedure
is performed:
Figure 6.6.2-1: High-level procedure for UPF-level N4 session solution
1\. The SMF gets all on-board UPFs\' address pools information per DNN and
creates address mapping information based on these on-board UPFs\' address
pools information. The address mapping information is for traffic routing
between on-board UPFs. The address mapping information includes UE IP address
range and next UPF information corresponding to the address range.
2\. The SMF creates a UPF-level N4 session on the on-board UPFs, i.e. UPF1 and
UPF2. During the corresponding UPF-level N4 sessions establishment, the SMF
provides N4 rules, which including several PDR and FAR pairs.
One PDR and FAR pair includes:
\- a PDR detecting that the destination address is in the current UPF address
pool; and
\- a FAR instructing the UPF to forward the traffic to the UPF internal
interface.
One PDR and FAR pair per UPF (excluding current UPF) includes:
\- a PDR detecting that the destination address is in the another UPF address
pool; and
\- a FAR instructing the UPF to add an outer header (e.g. address information
of next UPF) and forward the traffic to the next UPF.
3\. The UE1, UE2 and UE3 establish PDU sessions. The UE1 and UE2 are served by
UPF1. The UE3 is served by UPF2. During corresponding N4 sessions
establishment, the SMF provides N4 rules to instruct the UPF forwarding the
user plane packet from UPF internal interface to the target UE.
During the PDU Session Establishment procedure, AMF determines the ID of GEO
Satellite serving the UE as backhaul and sends the GEO satellite ID to the SMF
in Nsmf_PDUSession_CreateSMContext Request. The SMF derives the DNAI
corresponding to the GEO satellite based on the SMF configuration and the GEO
satellite ID received from AMF. SMF selects on-board UPF corresponding to the
DNAI. This is same as solution #4.
NOTE 1: It is assumed that the AMF can determine the GEO Satellite ID for the
notification to the SMF based on Global RAN Node IDs associated with satellite
backhaul, same as Solution #4.
4\. The UE1 sends data to the UE2. Upon receipt of a user plane packet, the
UPF1 forwards the packet based the UPF1 address pool and the destination
address of the packet. The UPF1 handles the packet as follows:
\- identify the UPF-level N4 session is the first N4 session to which the
packet corresponds;
\- determines that the destination address is in the UPF1 address pool and
then forward the packet to the UPF internal interface;
\- the packet will match the N4 session corresponding to the UE2\'s PDU
session; and
\- the packet is then forwarded to the UE2.
5\. The UE1 sends data to the UE3. Upon receipt of a user plane packet, the
UPF1 forwards the packet based the UPF1 address pool and the destination
address of the packet. The packet would be handled as follows:
\- the UPF1 identifies the UPF-level N4 session is the first N4 session to
which the packet corresponds;
\- the UPF2 determines that the destination address is out of the UPF1 address
pool and then forwards the packet to UPF2 based on the address mapping
information in the corresponding FAR, in which case the destination address is
in the address range of one term of address mapping information and the
corresponding next UPF is the UPF2; and
\- the UPF2 identifies the UPF-level N4 session is the first N4 session to
which the packet corresponds;
\- the UPF2 determines that the destination address is in the UPF2 address
pool and then forward the packet to the UPF internal interface;
\- the packet will match the N4 session corresponding to the UE3\'s PDU
session; and
\- the packet is then forwarded to the UE3.
### 6.6.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
AMF:
\- Send satellite backhaul category to PCF.
\- Determine GEO Satellite ID based on local configuration and RAN ID, and
provide it to SMF during PDU Session Establishment/Modification procedures,
same as Solution #4.
PCF:
\- Determine UE policy based on satellite backhaul category.
The following impacts are for UE-to-UE local data switch only:
SMF:
\- Request UPF to establish UPF-level N4 session.
\- Provide UPF N4 rules to enable local data switch.
\- Select on-board UPF corresponding to the DNAI mapped from GEO satellite ID,
same as Solution #4.
UPF:
\- Establish a UPF-level N4 session.
\- Implement local data switch based on received N4 rules.
## 6.7 Solution for KI#3: Support of Local Data Switching via UPF on board
### 6.7.1 Description
As specified in TS 23.501 [2], for UEs belong to the same enterprise or
organization, and if they belong to the same 5G VN group, 5G LAN-type services
can be applied among them.
For UEs in a communication that are served by satellite backhaul, if local
data switching via UPF on-board can be enabled, then the communication path
between two UEs can be significantly shorten by avoiding using ISL and feeder
link on the way towards the PSA on the ground. If some UEs are served by
satellite backhaul and if they are closing to each other, local data switching
via a UPF on-board for system efficiency and QoE improvement can be achieved
as shown in the Figure 6.7.1-1. If UEs are served by different satellites, in
order to enable the local data switching between them, N19 forwarding between
UPFs on-board should be supported as shown in the Figure 6.7.1-2. The UPF on-
board can be configured to send usage report for traffic subject to local data
switching to the SMF on the ground.
NOTE: It is assumed that two UEs are served by same SMF while enabling local
data switching, and for data subject to local data switching, same QoS
treatment is applied on both UE sides.
Figure 6.7.1-1: Local Data Switching via a UPF on-board
Figure 6.7.1-2: Local Data Switching via multiple UPFs on-board
The possible interactions via the satellite backhaul between UEs are shown in
the Figure 6.7.1-3. The Local Data Switching via a UPF on-board is shown as
the blue line. The Local Data Switching via multiple UPFs on-board is shown as
the red line. The Local Data Switching via the PSA UPF is shown as the green
line.
Figure 6.7.1-3: Local Data Switching via multiple UPFs on-board
In order to reduce end to end delay comparing with existing 5G LAN local
switch at PSA on the ground, the method of how the UPF on-board can be
selected by the SMF to support the 5G LAN-type services needs to be achieved.
### 6.7.2 Procedures
Figure 6.7.2-1 shows the procedure of the PDU session establishment between
UEs served by the UPF on-board in a communication.
Figure 6.7.2-1: PDU session establishment between UEs served by the UPF on-
board.
0\. During the procedure of NG setup, the gNB may inform the AMF of satellite
backhaul information and the gNB ID.
1\. UE1 initiates the PDU Session Establishment procedure by invoking the PDU
Session Establishment Request (DNN, S-NSSAI, PDU Session Type) as specified in
clause 4.3.2.2 of TS 23.502 [3].
2\. If the DNN/S-NSSAI obtained from the AMF is associated with a 5G VN group,
a dedicated SMF is to be selected as specified in clause 5.29.3 of TS 23.501
[2]. The SMF retrieves the UE subscription information from the UDM (which may
optionally include the VN group ID).
If the AMF is aware that the serving gNB uses satellite backhaul UP
connections, the AMF may invoke Nsmf_PDUSession_CreateSMContext Request to
send satellite backhaul information and the gNB ID.
3\. Based on the DNN and backhaul information, the SMF determines whether to
insert an UL-CL/BP and an additional PSA on-board to activate local data
switching.
NOTE 1: If there are no other PDU sessions established over satellite backhaul
for this VN group, the SMF may decide to not select an UL-CL/BP and an
additional PSA on-board to enable local data switching.
4\. The SMF selects the PSA UPF on the ground and possibly a UL-CL/BP and an
additional PSA on-board.
5\. The PDU session is established for UE1.
6\. UE2 initiates the PDU Session Establishment procedure by invoking the PDU
Session Establishment Request (DNN, S-NSSAI, PDU Session Type) as specified in
clause 4.3.2.2 of TS 23.502 [3].
7\. If the DNN/S-NSSAI obtained from the AMF is associated with a 5G VN group,
a dedicated SMF is to be selected as specified in clause 5.29.3 of TS 23.501
[2]. The SMF retrieves the UE subscription information from the UDM (which may
optionally include the VN group ID).
If the AMF is aware that the serving gNB uses satellite backhaul UP
connections, the AMF may invoke Nsmf_PDUSession_CreateSMContext Request to
send satellite backhaul information and the gNB ID.
8\. Based on the DNN and backhaul information and existing PDU sessions for
the VN group, the SMF determines to insert an UL-CL/BP and an additional PSA
on-board to activate local data switching.
9\. The SMF selects the PSA UPF on the ground and an UL-CL/BP and an
additional PSA on-board.
The SMF may utilize the NRF to obtain the on-board UPF profile(s), or, the SMF
may obtain the UPF profile(s) from the UPFs associated with the DNN by via N4
Node Level Procedure, e.g. N4 report procedure, where each UPF profile
includes one or more gNB IDs/IPs that the UPF currently connects. Based on the
UPF profile and the gNB ID received from AMF, the SMF determines the UL-CL/BP
and an additional PSA on-board.
10\. The SMF confirms to initiate the N4 Session Establishment including the
PDR and FAR to the UL-CL/BP and an additional PSA on-board serving the PDU
session 2 to enable local data switching. If both of UE1 and UE2 are served by
satellite backhaul via the same GEO UPF1 on-board, the SMF will enable local
switch via UPF1 on board the GEO satellite. If the UE1 and UE2 are served by
satellite backhaul via different GEO UPFs on-board, the SMF will establish N19
tunnels between GEO UPFs on-board to enable local data switching.
The PDR and FAR in the UL-CL/BP indicates that, all UL traffic towards group
members (identified by destination IP addresses or QFI) served by UPF(s) on-
board will be forwarded to the additional PSA, and all DL traffic received
from the additional PSA will be forwarded to the gNB via N3 tunnel.
NOTE 2: The precondition of using QFI to identify the UL traffic towards group
members is that, all UL traffic in the PDU session is subject to local data
switching, the UL traffic subject to local data switching and UL traffic not
subject to local data switching in a PDU session for 5G-LAN type service are
using different QFIs.
The PDR and FAR in the additional PSA indicates that,all UL traffic towards
group members (identified by destination IP addresses) served by UPF(s) on-
board will be forwarded via the additional PSA to the gNB or other I-UPFs, and
all DL traffic towards this UE (identified by the destination IP address) will
be forwarded to the UL-CL/BP via N9 tunnel.
NOTE 3: The detailed PDR and FAR will be specified during normative phase.
For any SDF subject to local data switching, the SMF may provide particular
reporting rules to the additional PSA on-board for minimization of N4
signalling exchange.
11\. The PDU session is established for UE2.
12\. The SMF triggers to select an UL-CL/BP and an additional PSA on-board for
PDU session1 to enable local data switching between UEs served by UPF on-
board.
13\. The SMF initiates the N4 Session Modification including PDR and FAR to
the UPF on-board serving the PDU session 1 to enable local data switching.
### 6.7.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
AMF:
\- Capability to send the satellite backhaul UP connections to the SMF.
SMF:
\- Capability to determine whether to insert an UL-CL/BP and an additional PSA
on-board to activate local data switching based on DNN and backhaul
information.
\- Capability to generate specific PDR and FAR to enable local data switching
between UEs.
UPF:
\- Configure the connectable gNB ID list or gNB IP range in the UPF profile.
## 6.8 Solution for Key Issue #1: In-sequence delivery
### 6.8.1 Description
When backhaul between gNB and UPF involves satellite, the inter satellite link
may switch due to the satellite movement. This handover of transmission path
may happen without UE mobility, caused by the transport network itself and
usually is not perceived by 5GC, which will cause performance decline and user
experience degradation, especially for TCP-based applications. In such case
the traffic of the service flow of an application may need in-sequence
delivery by the network.
The following solution is proposed to solve the packet out-of-sequence issue
introduced by dynamic satellite backhaul:
For a non 5G LAN PDU session:
Figure 6.8.1-1
1\. The backhaul type is indicated to SMF by AMF. The SMF indicates backhaul
type to PCF and then to AF(maybe via NEF) if AF has requested to obtain the
satellite backhaul information for an AF session. The detailed procedures can
be captured in other solutions(e.g. #2 ).
2\. If the AF decides the network perform the in-sequence delivery for the
traffic of the service flow, e.g. based on the current hackhaul
type(LEO/MEO)for the communication path, the service QoS requirement, the
capability of the application and APP .. the AF requests the PCF(maybe via
NEF) to ensure in-sequence delivery for a flow.
3\. The PCF generates the corresponding PCC policy demanding in-sequence
delivery for a QoS flow and sends to SMF.
4\. Based on PCC policy from PCF, the SMF decides to initiate the in-order-
delivery for the QoS flow. The SMF can also decides the in-order-delivery by
local configuration if backhaul involves satellite(s).
5\. The SMF sends to CHF the indication of in-sequence delivery for the
corresponding flow.
6\. During PDU Session establishment, or during mobility/handover procedure,
the SMF indicates the UPF and gNB, which are all located on ground, to enable
Sequence number based in order delivery for the QoS flow:
For uplink traffic:
\- The gNB adds the GTP-U sequence number for the QoS flow according to the
PDCP order of the received packets for this QoS flow.
\- The UPF delivers the packets in order based on GTP-U sequence number. The
UPF monitors the sequence and initiates timer to wait out of sequence packets.
For downlink traffic:
\- The UPF adds the GTP-U sequence number for the QoS flow according to packet
order received from DN.
\- The gNB delivers the packets in order based on GTP-U sequence number. The
gNB monitors the sequence and initiates timer to wait out of sequence packets.
For a 5G LAN PDU session:
Figure 6.8.1-2
The UE1 establishes a 5G LAN PDU session which is anchored at UPF1, and uses
this PDU Session to send packets to UE2 and UE3, anchored at UPF2 and UPF3.
When the UE1 maps packets sent to UE2 and UE3 into the same QoS flow, the QoS
flow level based in order delivery mechanism described above for a non 5G LAN
PDU session will not work, since the GTP-U SN received at UPF2 and UPF3 will
not be in sequence. For example, if UE1 sends the first packet to UE2, the
second packet to UE3, the third packet to UE2 and the forth packet to UE3,
then the UPF3 may receive two packets with #N+2 and #N+4 and UPF2 may receive
two packets with #N+1 and #N+3. UPF2 cannot determine whether there is a
packet with number #N+2 sent to it but lost or still on the path. UPF3 has the
same issue.
In order to solve this issue, the GTP-U SN is removed over N19 tunnel. Since
UPFs are located on ground, the transport links between UPFs are regarded
stable. The UE1\'s gNB and UPF1 guarantees the in-sequence delivery of packets
between UE1\'s gNB and UPF1, and UE2\'s gNB and UPF2 guarantees the in-
sequence delivery of packets between UE2\'s gNB and UPF2.
The in order delivery mechanism described above for a non 5G LAN PDU is thus
enhanced:
\- The SMF indicates the UPF to remove the GTP-U SN of the packets of a 5G LAN
PDU Session, before deliver it to internal interface.
\- The SMF indicates the UPF to add GTP-U SN to packets received from N19
tunnel before sending to gNB.
In summary:
The out-of-order problem is introduced by dynamic satellite links, thus SMF
needs the satellite backhaul category information to \'active\' the sequence
number.
For 5G-LAN N19 tunnel on ground in this scenario, SMF should not \'active\'
the sequence number.
NOTE: Considering that inter-GEO satellite links are static, the out-of-order
problem on N19 over inter-GEO satellite links does not exists or is
negligible; i.e. how to solve the out-of-order problem on N19 is not in the
scope of R18.
### 6.8.2 Void
### 6.8.3 Impacts on services, entities and interfaces
gNB:
\- Support SN based in-sequence delivery.
SMF:
\- Receive the policy of in-sequence delivery.
\- Support enabling SN based in-sequence delivery. For 5G LAN, SMF indicates
UPF to remove SN when transferring packets via N19 tunnel, and add SN before
sending via N3 tunnel.
\- Send the indication of in-sequence delivery to CHF for corresponding
charging.
UPF:
\- Support SN based in-sequence delivery.
\- For 5G LAN case, remove GTP-U SN when transferring packets over N19.
PCF:
\- Send satellite backhaul type information to AF(or via NEF ).
\- Receive indication of in-sequence delivery from AF(or vi NEF) and generate
corresponding policy to SMF.
AF:
\- Decide the in-sequence delivery by network or by AF/APP when needed.
## 6.9 Solution for Key Issue #1: QoS Monitoring for dynamic satellite
backhaul delay control
### 6.9.1 Description
In Rel-17, the single satellite backhaul network is used and the AMF reports
to the SMF the satellite backhaul category and the change of satellite
backhaul category, as specified in clause 5.8.2.15 of TS 23.501 [2].
Figure 6.9.1-1: Example scenarios of satellite backhaul network with dynamic
delay
As example scenarios depicted above, the RAN may use one or more type of
backhaul networks with the 5GC, and also the RAN may use different type of
backhaul networks in CP and UP which is differed with the single satellite
backhaul network assumed in Rel-17.
In order to adapt Policy/QoS control for dynamic delay in satellite backhaul
network used in UP, the QoS monitoring over GTP-U path between RAN and UPF is
required. For efficient and precise monitoring, the PCF needs to generate the
appropriate QoS Monitoring Policy and needs to adjust the PCC rules based on
the monitoring results in time.
### 6.9.2 Procedures
Figure 6.9.2-1 below depicts the key steps of the solution, which enables the
QoS monitoring for dynamic satellite backhaul delay control.
Figure 6.9.2-1: Procedure for enabling QoS monitoring for dynamic satellite
backhaul delay control
1\. The UE initiates the PDU Session Establishment procedure as specified in
clause 4.3.2.2 of TS 23.502 [3].
2\. The AMF determines the Satellite backhaul category (as specified in clause
4.3.2.2 of TS 23.502 [3]), and the following criteria of the network:
Criteria #1: whether more than one type of backhaul networks can be used with
the NG-RAN.
Criteria #2: whether different backhaul networks can be used in the CP and the
UP at the same time
If the AMF determines that the more than one type of backhaul networks can be
used with the NG-RAN, or different backhaul networks can be used in the CP and
the UP at the same time, or both, the AMF informs to the SMF that the backhaul
network delay is dynamically change by providing \'dynamic satellite backhaul
delay control request\' in Nsmf_PDU_Session_CreateSMContext Request.
The AMF provides \'dynamic satellite backhaul delay\' even when the satellite
backhaul network is not used in the CP, if more than one type of backhaul
networks can be used or if different type of backhaul network can be used in
the UP.
The AMF determines the above criteria based on the RAN ID (e.g. Global RAN
Node ID), or its configuration.
3\. The SMF initiates SM Policy Association establishment with the PCF. The
SMF provides Satellite backhaul category, and/or dynamic satellite backhaul
delay control request to the PCF, if it received from the AMF.
4\. The PCF generates and provides to the SMF, the PCC rules with the Policy
Control Request Trigger. In the Policy Control Request Trigger, the PCF
includes \'UPF with dynamic satellite backhaul delay is selected\' which
requests to the SMF to interact again when the SMF selects an UPF for the PDU
Session by performing GTP-U path monitoring in the available UPFs.
5\. The SMF initiates GTP-U path monitoring as specified in clause 5.33.3.3 of
TS 23.501 [2] with the available UPFs. Based on the measured backhaul delay
received from the available UPFs and the PCC rules received from the PCF, the
SMF selects an UPF for the PDU Session.
6\. After UPF selection, the SMF notices the PCRT condition received in step 4
is met. The SMF sends Information on the Policy Control Request Trigger
condition that has been met and the measured backhaul delay by the selected
UPF in Npcf_SMPolicyControl_Update Request to the PCF.
7\. Based on received backhaul network delay measurement information, the PCF
evaluates the provided PCC rules and decides whether to adjust the PCC rules.
The PCF provides PCC rules (if it needs to be updated), and the Policy Control
Request Trigger of \'QoS Monitoring information for dynamic satellite backhaul
delay control\' information. This \'QoS Monitoring information for dynamic
satellite backhaul delay control\' information includes the information in
\'QoS Monitoring for URLLC\' as specified in Table 6.3.1 of TS 23.503 [4], and
may provide additionally \'Threshold Values\'.
8\. SMF performs N4 Session Establishment/Modification as specified in clause
4.3.2.2 of TS 23.502 [3].
9\. SMF provides to the RAN, the QoS Monitoring Indication, QoS Monitoring
reporting frequency, and QoS Monitoring Threshold value, which are derived
from the PCC rule information received in step 7, via AMF by invoking
Namf_Communication_N1N2Message Transfer.
10\. The AMF sends N2 PDU Session Request to the RAN as specified in clause
4.3.2.2 of TS 23.502 [3].
11\. The RAN setups AN-specific resources with the UE as specified in clause
4.3.2.2 of TS 23.502 [3].
12\. The RAN indicates its rejection to perform QoS Monitoring, e.g. due to
RAN load condition, if any. The SMF is responsible to ensure the QoS
Monitoring for satellite backhaul network delay between the RAN and the UPF.
If SMF determines that there are no other PDU Sessions that use the same
backhaul network on this RAN and UPF, then the SMF concludes that this
backhaul network cannot be monitored in the RAN side.
13\. The AMF sends Nsmf_PDUSession_UpdateSMContext Request to the SMF.
14\. The SMF initiates N4 Session Modification with the UPF and provides QoS
Monitoring Policy for dynamic satellite backhaul delay control, which are
derived from the PCC rule information received in step 7. When the SMF
receives the measured backhaul network delay from the UPF after this step and
if the measurement result exceeds the Threshold Value, the SMF reports to the
PCF the PCRT condition is met.
15\. The SMF sends Nsmf_PDUSession_UpdateSMContext Response as specified in
clause 4.3.2.2 of TS 23.502 [3].
16\. Optionally, if the SMF concluded that the backhaul network cannot be
monitored in the RAN side (as described in step 12), and it is configured that
the satellite backhaul network monitoring in both RAN and UPF side is
mandatory, then the SMF informs the AMF by invoking
Nsmf_PDUSession_SMContextStatusNotify (Release), and related steps are
performed as specified in clause 4.3.2.2 of TS 23.502 [3].
### 6.9.3 Impacts on services, entities and interfaces
AMF:
\- During the PDU Session Establishment procedure, determines whether more
than one type of backhaul networks can be used with the RAN, and whether the
different type of backhaul networks can be used in CP and UP.
\- Indicates to the SMF that the satellite backhaul network with dynamic delay
can be used with the RAN during the PDU Session Establishment procedure.
SMF:
\- Upon receiving dynamic satellite backhaul delay control request from the
AMF, forwards the request to PCF.
\- Derives the information of QoS Monitoring for dynamic satellite backhaul
delay control for RAN and UPF based on the PCC rule information provided by
the PCF.
\- Initiates the GTP-U path monitoring upon receiving dynamic satellite
backhaul delay control request from the AMF.
\- During the PDU Session Establishment procedure, selects the UPF based on
the GTP-U path minoring results received from the available UPFs.
PCF:
\- Upon receiving dynamic satellite backhaul delay control request from the
SMF, generates PCC rule information for QoS Monitoring for the satellite
backhaul with dynamic delay, and the Policy Control Request Triggers for the
SMF.
## 6.10 Solution for Key Issue #2: Enable Satellite EAS re-discovery and re-
allocation by means of local DNS on-board satellite
### 6.10.1 Description
This solution corresponds to KI#2.
UE has established a PDU Session with the local PSA (L-PSA) and with the
corresponding EAS on-board a GEO satellite. The procedure described below
covers the cases when the EAS on satellite needs to be changed to another EAS
on the same satellite or when the EAS on one satellite is substituted with
another EAS on another satellite. Such changes among EASs could be caused by
the mobility of a UE or temporary unavailability of an EAS due to e.g.
maintenance, insertion of new services or failure.
### 6.10.2 Procedures
Figure 6.10.2-1 shows the procedure to enable changes of EAS by means of local
DNS (L-DNS) located on the satellite.
Figure 6.10.2-1: Enabling EAS re-discovery or EAS re-selection by means of a
local DNS (L-DNS)
1\. A change from one EAS to another EAS can be performed by using local DNS.
The local DNS needs to be aware of various EASs located in the satellite or in
the neighbouring GEO satellites.
Information about L-DNS address is provided to UE (EDC) by the SMF located on
the ground during the PDU session establishment or modification procedure. By
storing, in L-DNS, information on other EASs (either on board currently
serving or neighbouring GEO satellites) a switch from one EAS to another can
be performed without SMF intervention and saves the backhauling resources
accordingly. After the EAS change the local DNS only reports this change to
the SMF.
### 6.10.3 Impacts on services, entities and interfaces
SMF:
\- Update the procedure such that SMF stores the information on the L-DNS
located on a GEO satellite about the EASs that provide the same application
services and can be used as alternatives for the currently used EASs.
\- L-DNS should be able to receive and store information about the EASs on
neighbouring GEO Satellites.
# 7 Overall Evaluation
## 7.1 Evaluation of solutions for Key Issue #1: PCC/QoS control enhancement
considering dynamic satellite backhaul
There are 5 candidate solutions (solutions #1, #2, #3, #8, #9) proposed to
solve this KI.
**For the determination of packet delivery latency or bandwidth or both of the
satellite backhaul on the UP path:**
There are solutions #1, #2, #9. The common part among these solutions is that
QoS monitoring mechanism is used to measure the packet delivery latency over
satellite backhaul (per GTP-U path). The main differences are:
\- Solution#1 may require the SMF to activate QoS monitoring based on the
satellite backhaul category defined in rel-17, and the measured delay is
mainly used for policy control.
\- Solution#2 introduces a new indication named \"dynamic satellite backhaul
in use\" determined by the AMF to trigger the PCF to generate QoS monitoring
rules, and the measured delay is not only used for policy control, but also
used for UPF selection. In addition, the SMF provides the bandwidth of the
GTP-U path (identified by a pair of \) to the PCF for policy
control, where the bandwidth is detected via implementation methods.
\- Solution#9 also relies on a new indicator named \"dynamic satellite
backhaul delay control request\" determined by the AMF internally to trigger
the PCF to generate QoS monitoring rules, and the QoS monitoring rules include
threshold values to avoid frequent reports by SMF to PCF due to dynamic
backhaul delay change. The measured delay can be used for policy control and
UPF selection.
All of these procedures can serve the purpose of reporting dynamic backhaul.
Indication of multiple satellite backhaul categories in Solution #1 is only an
encoding issue of including multiple instances of the already existing
satellite backhaul information. Solution #2 introduces \"dynamic satellite
backhaul in use\" indication, which can be encoded either as above in Solution
#1 or via new enumerated satellite backhaul category. Solution #9 introduces
\"dynamic satellite backhaul delay control request\" from the AMF to achieve
the same.
Frequent measurement of delay is costly, reporting time of duration of high
packet delivery delay event help PCF/AF action properly. For example, if
PCF/AF received a high delay (based on measurement) and the time of duration
representing that there would be a cross-seam transiting in a period of time,
they can be aware that the dramatically increased high delay is inevitable and
may action properly, e.g. PCF indicates SMF to change the delay measurement
interval to wait the cross-seam transiting event over, or AF may start coding
compensation (a single high delay report may not trigger the action, as it may
be temporary caused by network congestion).
**For exposure of backhaul information to the AF:**
There are solutions #1, #2, #3. The common part of these solutions is that the
satellite backhaul delay can be exposed to AF. The main differences among them
are:
\- Solution#1 allows the PCF to report the measured backhaul delay or
satellite backhaul category or both to AF for application specific reasons.
\- Solution#2 proposes to expose not only satellite backhaul delay but also
bandwidth of the GTP-U path over satellite backhaul. The satellite backhaul
delay is observed via QoS monitoring, and the bandwidth is obtained by SMF via
implementation method. In addition, the AF can request to obtain the satellite
backhaul information if it is aware of satellite backhaul is in use.
\- Solution #3 deals with dramatic change of delay/jitter caused by cross-seam
transiting event in polar orbit satellite constellation scenarios. The AMF
reports satellite constellation information to the PCF/AF. The PCF/AF requests
a backhaul delay change event report. When determining that the backhaul delay
is about to change due to cross-seam transiting event, the AMF notifies the
PCF/AF the duration time of the event. This solution enables networks and
applications to be aware of the duration time of dramatic change of backhaul
delay/jitter and perform proper actions timely in polar orbit satellite
constellation scenarios.
**For reporting of the satellite backhaul to CHF:**
Satellite backhaul category and the observed backhaul delay need to be stored
for charging and statistics reasons. Solution #1 is the only solution that
supports the reporting of the satellite backhaul category and the observed
backhaul delay to CHF.
**For packet order related topics:**
Dynamic satellite backhaul introduces one new case in addition to the existing
ones where out-of-order packets can occur e.g. due to backhaul routing
changes.
## 7.2 Evaluation of solutions for Key Issue #2 - Support of Satellite Edge
Computing via UPF on board
Solutions #4 (Edge computing part of this solution), #5, #6(Edge computing
part of this solution) and #10 describe supporting Satellite Edge Computing
via UPF on board.
**Session Breakout connectivity model (solutions #4, #5)**
In solutions #4 and #5, the on-board UPF acts as UL CL/BP and local PSA. The
Session Breakout connectivity model defined in TS 23.548 [6] is supported.
In solution#4 the on-board UPF can be inserted statically (i.e. during PDU
Session Establishment procedure) or dynamically (i.e. during the DNS Query
process), while in solution#5 the on-board UPF is inserted dynamically based
on DNS Query initiated by UE.
For GEO UPF selection, in Solution#4, SMF selects on-board UPF based on DNAI
as described in TS 23.548 [6]. The DNAI is derived by SMF based on the GEO
satellite ID provided by AMF. Solution#5 requires the UPF onboard to report
the gNB ID it connects to the SMF via N4 association, then the SMF can select
a UPF connecting with the gNB serving the UE after determining the candidate
UPFs using existing mechanism.
**Distributed Anchor Point and multiple PDU Sessions connectivity models
(solution #6)**
In solution#6, the on-board UPF acts as PSA. The Distributed Anchor Point and
multiple PDU Sessions connectivity model defined in TS 23.548 [6] are
supported.
**EAS rediscovery (solution #10)**
In solution#10, EAS rediscovery is described. SMF stores EAS located in a GEO
satellite or neighbouring GEO satellites on on-board local DNS. In case of EAS
change, the local DNS reports this change to SMF. An interface between SMF and
local DNS is needed for such reporting.
## 7.3 Evaluation of solutions for Key Issue #3: Support of Local Data
Switching via UPF on-board
There are 3 candidate solutions (solutions #4, #6, #7) proposed to solve how
to enable local data switching via UPF on-board:
\- Solution #4 requires the UPF onboard to act as a UL-CL/BP and an additional
PSA, so that UE to UE traffic can be routed to the additional PSA on the
satellite, and then forwarded to the target UE. The SMF determines whether the
two UEs which requests UE-UE communication are severed by same DNAI mapped
from the GEO satellite ID provided by AMF without creating group. If the two
UEs are severed by same DNAI, the SMF inserts the on-board UPF as UL CL/BP and
local PSA for the two UEs according to the DNAI. When different SMFs are used
for the two UEs, the UDR is involved in above procedure to judge whether two
UEs are under same DNAI.
\- Solution #6 requires the UPF onboard to act as a PSA which is pre-
configured with IP address pool per DNN, and the UPFs onboard are configured
with particular PDR and FAR pairs, so that the UE to UE traffic can be local
routed automatically without creating group. It\'s assumed that the same SMF
is used and inter-GEO UE-UE communication is supported.
\- Solution #7 also proposes the UPF onboard to act as a UL-CL/BP and an
additional PSA, but requires to support QoS flow level traffic switching at
the UL-CL/BP, and establish N19 tunnel between two additional PSAs, so that
the UE to UE traffic will be routed to target UE belonging to same 5GLAN VN
group according to the PDR and FAR. The same SMF is assumed in this solution.
# 8 Conclusions
## 8.1 Conclusions on PCC/QoS control enhancement considering dynamic
satellite backhaul
For the determination of packet delivery latency of the satellite backhaul on
the UP path, following conclusions are proposed:
\- The PCF may determine the packet delivery latency on N3 interface, if it
detects dynamic satellite backhaul is used to serve the PDU session. The PCF
can determine the N3 latency based on configuration or by using QoS monitoring
triggered by PCF or estimate the N3 latency based on the received satellite
backhaul category (LEO, GEO, etc.);
\- The SMF activates the QoS monitoring to measure the packet delivery latency
on N3 interface according to the PCC rule;
\- The measured delay can be used by PCF for policy control, and can be
considered for UPF selection (e.g. when the different types of backhaul
network can be used in CP and UP).
For exposure of backhaul information to the AF, there are solutions #1, #2,
#3, following conclusions are proposed:
\- The PCF can report packet delivery latency to the AF using existing QoS
monitoring solution;
\- The AF can request the PCF to report the packet delivery latency using
existing QoS monitoring solution.
The reporting of the satellite backhaul category and the observed backhaul
delay to CHF as proposed in Solution #1 can be supported but this is to be
determined by SA WG5.
For handling of out-of-sequence packets that can occur at N3, it is concluded
that no action needs to be taken.
## 8.2 Conclusion on solutions for Key Issue #2
On-board PSA UPF or ULCL/BP/local PSA UPF selection is performed as following:
\- The SMF determines DNAI based on local configuration and GEO satellite ID
received from AMF. SMF performs UPF selection considering the DNAI.
NOTE 1: It is assumed that a DNAI value is assigned for each GEO satellite ID
by the operator. SMF is local configured with mapping relationship between
DNAI and GEO satellite ID.
NOTE 2: The selected On-board UPF can be inserted as ULCL/BP/L-PSA reusing
existing ULCL/BP insertion procedures defined in TS 23.502 [3] or TS 23.548
[6].
For Distributed Anchor Point and multiple PDU Sessions connectivity models:
\- Based on GEO satellite backhaul category from AMF, UE PCF may determine and
update URSP rule including a appropriate DNN/S-NSSAI for services that allowed
to access the services on GEO satellite.
## 8.3 Conclusions on Support of Local Data Switching via UPF on-board
**1\. Assumption:**
\- Only a single SMF is supported for Local Data Switching and N19 via UPF on-
board, i.e. both UEs are served by the same SMF.
\- Local Data Switching via UPF on board applies on GEO satellite backhaul
only. Conclusions in this clause consider only DNNs and slices for 5G VN.
\- The UE to UE traffic may be locally routed by UPF on-board to the target UE
without traversing back to the satellite gateway on the ground;
\- N19 tunnel may be established between two UPFs on-board different
satellites to locally switch UE to UE traffic.
**2\. On-board PSA UPF or ULCL/BP/local UPF selection is performed as
following (Same mechanism can be reused to KI#2):**
\- For each GEO satellite ID, a DNAI value is assigned by the operator. SMF is
configured with DNAI corresponding to each GEO satellite ID. The SMF
determines DNAI based on the configuration and GEO satellite ID received from
AMF.
\- On-board UPF selection is done based on the DNAI as current UPF selection
defined in TS 23.501 [2] and TS 23.502 [3].
NOTE: The latency optimisation that can be gained by inter-satellite N19
between UPFs on different GEO satellites depends on the distance between the
satellites that can be substantial, depending on the number of deployed
satellites.
**3\. URSP configuration:**
For on-board UPF acting as PSA case:
\- A combination of DNN/S-NSSAI is assigned by the operator to the services
deployed on GEO satellite. Based on GEO satellite backhaul category from AMF,
PCF determines URSP rule including the DNN/S-NSSAI for such services. PCF
sends the URSP rules to UEs allowed to access the services on GEO satellite.
(Same mechanism can be reused to KI#2).
**4\. User plane configuration:**
\- For the on-board UPF acting as a PSA case, SMF creates N4 rules on the on-
board UPF to enable local data switching as following:
\- Based on pre-configuration, the SMF establishes the N19 tunnel between the
two UPFs and corresponding UPF-level N4 rules to support local data switch.
The IP address(es) in UPF address pools are utilized in the UPF-level N4
session to detect UE-to-UE communication packets which are sent to pre-
configured N19 for local data switch.
\- For on-board UPF acting as ULCL/BP/local PSA case:
\- SMF determines to activate local data switching for UEs based on:
1) AF request including IPs/DNNs of UEs which require UE-to-UE communications,
which will re-uses an existing NEF API and no impacts are foreseen; or
2) Target IP reported by on-ground PSA UPF as current reporting mechanism
defined in TS 23.501 [2].
\- SMF configures Local PSA(s) based on the IP address(es) of target UEs, then
UE-to-UE communication packets are detected and sent to the internal interface
and optional N19 for local data switch. The local data forwarding rules on
L-PSA can be configured based on 5GVN user plane handing mechanism.
\- SMF configures UL-CL/BP to route data traffic toward the L-PSA.
#
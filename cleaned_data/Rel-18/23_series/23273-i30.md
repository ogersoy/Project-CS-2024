# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the stage 2 of the service-based architecture
used for location services in the 5G system, and corresponding Network
Functions (NFs), NF services and procedures, to meet the service requirements
defined in TS 22.261 [3] and TS 22.071 [2].
Location Services specified in the present document include regulatory
location services and commercial location services. The architecture and
signalling procedures in NG-RAN are defined in TS 38.305 [9].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.071: \"Technical Specification Group Systems Aspects; Location
Services (LCS)\".
[3] 3GPP TS 22.261: \"Service requirements for the 5G system; Stage 1\".
[4] 3GPP TS 23.271: \"Functional stage 2 description of Location Services
(LCS)\".
[5] 3GPP TS 43.059: \"Functional Stage 2 description of Location Services in
GERAN\".
[6] Void.
[7] 3GPP TS 36.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in E-UTRAN\".
[8] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[9] 3GPP TS 38.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in NG-RAN\".
[10] 3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".
[11] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[12] 3GPP TS 29.572: \"5G System; Location Management Services; Stage 3\".
[13] OMA MLP TS: \"Mobile Location Protocol\",
[http://www.openmobilealliance.org].
[14] Void.
[15] 3GPP TS 38.455: \"NG-RAN; NR Positioning Protocol A (NRPPa)\".
[16] 3GPP TS 29.518: \"5G System; Access and Mobility Management Services;
Stage 3\".
[17] 3GPP TS 25.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in UTRAN\".
[18] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[19] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[20] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\".
[21] 3GPP TS 23.316: \"Wireless and wireline convergence access support for
the 5G System (5GS)\".
[22] Void.
[23] ITU-T Recommendation E.164: \"The international public telecommunication
numbering plan\".
[24] 3GPP TS 23.222: \"Common Application Programming Interface (API)
framework for 3GPP northbound APIs\".
[25] RFC 2396: \"Uniform Resource Identifiers\".
[26] RFC 3261: \"SIP: Session Initiation Protocol\".
[27] 3GPP TS 23.228: \"IP multimedia subsystem (IMS)\".
[28] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[29] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[30] 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
[31] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[32] Void.
[33] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces; Stage 3\".
[34] Void.
[35] 3GPP TS 29.122: \"T8 reference point for Northbound APIs\".
[36] 3GPP TS 24.571: \"5G System (5GS); Control plane Location Services (LCS)
procedures; Stage 3\".
[37] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services\".
[38] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[39] 3GPP TS 22.104: \"Service requirements for cyber-physical control
applications in vertical domains\".
[40] 3GPP TS 23.586: \"Architectural Enhancements to support Ranging based
services and Sidelink Positioning\".
[41] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[42] 3GPP TS 23.632: \"User data interworking, coexistence and migration;
Stage 2\".
[43] 3GPP TS 29.563: \"Home Subscriber Server (HSS) services for interworking
with Unified Data Management (UDM); Stage 3\".
# 3 Definitions and Abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**5G enhanced positioning area:** see TS 22.261 [3].
**5G positioning service area:** see TS 22.261 [3].
**LCS Client:** entity that interacts with GMLC for the purpose of obtaining
location information for one or more UEs. The LCS Client may reside in the UE.
For the purposes of the present document, the following terms and definitions
given in TS 23.271 [4] apply:
**Call Related:** see TS 23.271 [4].
**Codeword:** see TS 23.271 [4].
**Current Location:** see TS 23.271 [4].
**Deferred location request:** see TS 23.271 [4].
**DL Positioning:** positioning of a target UE in which the target UE obtains
downlink measurements for a 3GPP RAT.
**GNSS Assistance Data:** see clause 6.5.2.1 of TS 37.355 [20].
**Immediate location request:** see TS 23.271 [4].
**Last Known Location:** see TS 23.271 [4].
**LCS (LoCation Services):** see TS 23.271 [4].
**Local Co-ordinates:** see TS 23.032 [8].
**Local Location:** location determined by Local Co-ordinate(s).
**Located UE:** see TS 23.586 [40].
**Location Estimate:** see TS 23.271 [4].
**LOS/NLOS measurement indication:** LOS-NLOS-Indicator as defined in TS
37.355 [20] or LOS/NLOS information as defined in TS 38.455 [15].
**Positioning Reference Unit (PRU):** see TS 38.305 [9].
**Mobile Base Station Relay:** see TS 23.501 [18].
**PRU association:** association of a PRU with an LMF by providing PRU related
information to an LMF.
**PRU dis-association:** remove the PRU related information to dis-associate a
PRU with an LMF.
**Pseudonym:** see TS 23.271 [4].
**Pseudonym mediation device** : Functionality that verifies pseudonyms to
verinyms.
**RAT Independent Positioning:** positioning of a target UE in which the
target UE obtains measurements not related to a 3GPP RAT.
**Requestor** : see TS 23.271 [4].
**Requestor Identity** : see TS 23.271 [4].
**Response Method:** for LCS Client using the OMA MLP protocol. Detail see TS
23.271 [4].
**Scheduled Location Time:** a future global time (e.g. UTC) at which a UE is
to be located.
**Service Type:** see TS 23.271 [4].
**Sidelink Positioning:** see TS 23.586 [40]
**Target UE:** see TS 23.271 [4].
**UL Positioning:** positioning of a target UE in which NG-RAN obtains uplink
measurements of the target UE for a 3GPP RAT.
**UL+DL Positioning:** positioning of a target UE using both DL Positioning
and UL Positioning.
**Velocity:** see TS 23.271 [4].
**Verinym** : see TS 23.271 [4].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
APN Access Point Name
APN-NI APN Network Identifier
EDT Early Data Transmission
E-SMLC Evolved Serving Mobile Location Centre
GMLC Gateway Mobile Location Centre
HGMLC Home GMLC
LCS LoCation Services
LDR Location Deferred Request
LIR Location Immediate Request
LMF Location Management Function
LOS Line-Of-Sight
LPI LCS Privacy Indicator
LPHAP Low Power and High Accuracy Positioning
LRF Location Retrieval Function
MBSR Mobile Base Station Relay
MO-LR Mobile Originated Location Request
MT-LR Mobile Terminated Location Request
NLOS Non-Line-Of-Sight
NI-LR Network Induced Location Request
PMD Pseudonym mediation device functionality
POI Privacy Override Indicator
PRU Positioning Reference Unit
SDT Small Data Transmission
TNAN Trusted Non-3GPP Access Network
TNAP Trusted Non-3GPP Access Point
TWAP Trusted WLAN Access Point
VGMLC Visited GMLC
SL-MO-LR Sidelink Mobile Originating Location Request
SL-MT-LR Sidelink Mobile Terminating Location Request
# 4 Architecture Model and Concepts
## 4.1 General Concepts
A general description of location services and service requirements are given
in the specification TS 22.071 [2] and TS 22.261 [3]. Support of location
services for GERAN, UTRAN and E-UTRAN access networks is described in TS
23.271 [4], TS 43.059 [5], TS 25.305 [17] and TS 36.305 [7].
The positioning of a UE can be supported by RAT dependent position methods,
which rely on for example 3GPP RAT measurements obtained by a target UE and/or
on measurements obtained by an Access Network of 3GPP RAT signals transmitted
by a target UE. Positioning of a UE can also be supported by RAT independent
position methods which may rely on non-RAT measurements obtained by a UE
and/or on other information.
The Location Services defined in this specification are applicable to PLMN(s)
and within a SNPN as described in clause 6, except for the following features,
which are not supported in SNPNs:
\- interworking with EPC;
\- roaming; and
\- direct access to SNPN via non-3GPP access.
The Location Service in PNI-NPN with signalling optimisation is defined as
clause 5.13.
The positioning of a UE can be performed by either 3GPP access network or
non-3GPP access network. A proper access type shall be determined to assure
that the positioning result can fulfil the requested QoS and operator policy.
Location information for one or multiple target UEs may be requested by and
reported to an LCS client or an AF within or external to a PLMN or SNPN, or a
control plane NF within a PLMN or SNPN. Location information contained in the
location request and location information contained in the location response
are defined in clause 5.5.
For location request from LCS client (neither in the UE nor in the NG-RAN) or
AF external to a PLMN or SNPN, privacy verification of the target UE shall be
enabled to check whether it is allowed to acquire the UE location information
based on UE LCS privacy profile and whether the LCS client or the AF is
authorised to use the location service as defined in clause 5.4. Additionally,
UEs may optionally support privacy notification and verification on behalf of
a user. Privacy override is also supported for regulatory LCS services
according to local regulation.
The capabilities of a target UE to support LCS may be signalled by the UE to a
serving PLMN or to an SNPN at the AS, NAS and application (positioning
protocol) levels to enable use of position methods supported by the UE.
To provide Location Service in the EPC interworking scenario, an EPC and 5GC
common interface shall be used for the location request from LCS client or AF.
Ranging based services and Sidelink Positioning for a UE can be supported, and
details are described in clause 5.17.
## 4.1a Types of Location Request
### 4.1a.1 Network Induced Location Request (NI-LR)
With a Network Induced Location Request (NI-LR), a serving AMF for a UE
initiates localization of the UE for a regulatory service (e.g. an emergency
call from the UE) or for verification of a UE location (country or
international area) for NR satellite access.
### 4.1a.2 Mobile Terminated Location Request (MT-LR)
With a Mobile Terminated Location Request (MT-LR), an LCS client or AF
external to or internal to a serving PLMN sends a location request to the PLMN
(which may be the HPLMN or VPLMN) for the location of a target UE.
### 4.1a.3 Mobile Originated Location Request (MO-LR)
With a Mobile Originated Location Request (MO-LR), a UE sends a request to a
serving PLMN for location related information for the UE.
### 4.1a.4 Immediate Location Request
With an immediate location request, an LCS client or AF sends or instigates a
location request for a target UE (or group of target UEs) and expects to
receive a response containing location information for the target UE (or group
of target UEs) within a short time period which may be specified using QoS. In
regulatory cases, one or more responses of the target UE\'s location
information can be expected. An immediate location request may be used for an
NI-LR, MT-LR or MO-LR.
### 4.1a.5 Deferred Location Request
With a deferred location request, an LCS client or AF sends a location request
to a PLMN for a target UE (or group of target UEs) and expects to receive a
response containing the indication of event occurrence and location
information if requested for the target UE (or group of target UEs) at some
future time (or times), which may be associated with specific events
associated with the target UE (or group of target UEs). In this version of the
specification, only deferred location requests for an MT-LR are supported.
#### 4.1a.5.1 Types of event
The following types of event are defined for a deferred location request.
a) UE availability: Any event in which the 5GCN has established a contact with
the UE. This event is considered to be applicable when the UE is temporarily
unavailable due to inaction by the user, or for temporarily loss of radio
connectivity or IMSI detach and so on. The UE Available event only requires
one response to an LCS client/AF and after this response, the UE Available
event is concluded.
b) Area: An event where the UE enters, leaves or remains within a pre-defined
geographical area. At least one type of area event can be defined (i.e.
entering, leaving or remaining within the area). The LCS client or AF may
define the target area as a geographical area or as a geopolitical name of an
area. The PLMN may translate and define the target area as the identities of
one or more radio cells or tracking areas. The LCS client or AF may request an
additional check about whether the UE is located within the provisioned target
area. The area event may be reported one time only, or multiple times. The
area event report shall contain an indication of the event occurrence. The
location estimate may be included in the report. If an area event is detected
by the UE but an event report cannot be sent (e.g. because the UE cannot
access the network or due to a minimum reporting interval), a report shall be
sent later when possible irrespective of whether the area event still applies
for the current UE location. Area event reporting is controlled by a minimum
and a maximum reporting time. The minimum reporting time defines the minimum
allowed time between successive area events. The maximum reporting time
defines the maximum time between successive reports. When a UE sends a report
due to expiration of the maximum reporting time, the UE indicates expiration
of the maximum reporting time as the trigger event. The maximum reporting time
enables the AF, LCS client and HGMLC to remain aware of continuing support by
the UE for the area event (e.g. to detect if area event reporting may have
been aborted due to UE power off).
NOTE: To achieve more precise usage of area event in some scenario, e.g. for
small target area, it may be useful if LCS Client/AF requests UE location
estimate and compares the location estimate with the target area.
c) Periodic Location: An event where a defined periodic timer expires in the
UE and activates a location report. If a periodic event is detected by the UE
but an event report cannot be sent (e.g. because the UE cannot access the
network temporarily), a report shall be sent later when possible and the
periodic timer for the next event shall then be started. The reporting
duration for periodic location shall equal the requested number of reports
multiplied by the periodic interval even when reports are delayed.
d) Motion: An event where the UE moves by more than some predefined straight
line distance from a previous location. The motion event may be reported one
time only, or multiple times. The motion event report shall contain an
indication of the event occurrence. A location estimate may be included in the
report if requested by the LCS client or AF. For successive motion event
reports, motion is determined relative to the UE location corresponding to the
immediately preceding event report (including an event report triggered by
expiration of the maximum reporting time). If a motion event is detected by
the UE but an event report is deferred (e.g. because the UE cannot access the
network temporarily), a report shall be sent later when possible irrespective
of whether the motion event still applies to the current UE location. Motion
reporting is controlled by a minimum and a maximum reporting time. The minimum
reporting time defines the minimum allowed time between successive event
reports. The maximum reporting time defines the maximum time between
successive reports. When a UE sends a report due to expiration of the maximum
reporting time, the UE indicates expiration of the maximum reporting time as
the trigger event. The maximum reporting time enables the AF, LCS client and
HGMLC to remain aware of continuing support by the UE for the motion event
(e.g. to detect if motion event reporting may have been aborted due to UE
power off).
## 4.1b LCS Quality of Service
LCS Quality of Service is used to characterise the location request. It can
either be determined by the operator or determined based on the negotiation
with the LCS client or the AF. It is optional for LCS client or the AF to
provide the LCS Quality of Service in the location request.
LCS Quality of Service information is characterised by 3 key attributes:
\- LCS QoS Class as defined below.
\- Accuracy: i.e. Horizontal Accuracy (see clause 4.3.1 of TS 22.071 [2]) and
Vertical Accuracy (see clause 4.3.2 of TS 22.071 [2].
\- Response Time (e.g. no delay, low delay or delay tolerant as described in
clause 4.3.3 of TS 22.071 [2]).
NOTE 1: One or two QoS values for Horizontal Accuracy, Vertical Accuracy can
be provided in the location request in addition to a preferred accuracy when
LCS QoS Class is set to Multiple QoS Class.
The LCS QoS Class defines the degree of adherence by the Location Service to
another quality of service parameter (Accuracy), if requested. The 5G system
shall attempt to satisfy the other quality of service parameter regardless of
the use of QoS Class. There are 3 LCS QoS Classes:
\- Best Effort Class: This class defines the least stringent requirement on
the QoS achieved for a location request. If a location estimate obtained does
not fulfil the other QoS requirements, it should still be returned but with an
appropriate indication that the requested QoS was not met. If no location
estimate is obtained, an appropriate error cause is sent.
\- Multiple QoS Class: This class defines intermediate stringent requirements
on the QoS achieved for a location request. If the obtained location estimate
does not fulfil the most stringent (i.e. primary) other QoS requirements
affected by the degree of adherence of the QoS class, then another location
estimation may be triggered at LMF attempting less stringent other QoS
requirements. The process may be iterated until the least stringent (i.e.
minimum) other QoS requirements are attempted. If the least stringent other
QoS requirements cannot be fulfilled by a location estimate, then the location
estimate shall be discarded, and an appropriate error cause shall be sent.
NOTE 2: An AF may provide a location request with Multiple QoS Class via NEF.
For an LCS client to provide a location request with Multiple QoS Class an Le
interface implementation supporting Multiple QoS Class may be required.
NOTE 3: Multiple QoS Class can only be applied for Deferred 5GC-MT-LR
Procedure in this release of the specification.
\- Assured Class: This class defines the most stringent requirement on the
accuracy achieved for a location request. If a location estimate obtained does
not fulfil the other QoS requirements, then it shall be discarded, and an
appropriate error cause shall be sent.
NOTE 4: How the LMF decides the positioning method is an implementation aspect
not pre-determined by QoS criteria.
For LCS client, it may indicate accuracy defined in TS 29.572 [12], tables
6.1.6.3.2-1 and 6.1.6.3.5-1. For AF, it may either indicate the accuracy
defined in TS 29.572 [12], table 6.1.6.3.2-1, or indicate a particular value
e.g. PLMN ID defined in TS 29.122 [35], table 5.3.2.4.7-1.
## 4.1c Scheduled Location Time
A scheduled location time allows an external LCS Client, AF or the UE to
specify a time in the future at which a current location of the UE is to be
obtained. A scheduled location time can be used with a 5GC-MT-LR, 5GC-MO-LR or
deferred 5GC-MT-LR for periodic or triggered location events. The location
preparation phase starts when a location related request is sent by an LCS
Client, AF or UE requesting a current location of the UE. The request includes
the scheduled location time T. As part of the location preparation phase, the
5GC, and UE interact to determine suitable position methods and schedule
location measurements of the UE. The LMF coordinates the interaction and is
aware of the scheduled location time. The location preparation phase ends at
or near to the time T and is followed by a location execution phase in which
the UE location is obtained and returned to the external LCS Client, AF or the
UE.
A scheduled location time only applies when an external LCS Client, AF or the
UE is aware of a specific time in the future at which the location of the UE
is needed. A location estimate returned to an LCS Client, AF or UE for a
scheduled location time can be treated by the LCS Client, AF or UE as an
estimate of the location of the UE at the scheduled location time.
To support the Scheduled Location Time in 5GC-MO-LR, the UE defers sending the
request to AMF until the time remaining until the scheduled location time is
within some implementation dependent threshold in order to avoid failure
triggered by HTTP request timeout.
When support the Scheduled Location Time in 5GC-MT-LR (i.e. the LCS Client/AF
obtains one time UE location at Scheduled Location Time), to avoid failure
triggered by HTTP request timeout, one of the following methods is applied:
\- The LCS Client or AF defers sending the request until the time remaining
until the scheduled location time is within some implementation dependent
threshold; or
\- Re-using the deferred 5GC-MT-LR for periodic location events procedure to
realize providing one time UE location at Scheduled Location Time by, e.g. set
the value of total reporting number parameter in the location request to one.
NOTE: Which method to be used is implementation specific.
## 4.2 Architectural Reference Model
### 4.2.1 Non-roaming reference architecture
Figure 4.2.1-1 shows an architectural reference model for 5GS LCS for a non-
roaming UE and PRU in reference point representation.
Figure 4.2.1-1: Non-roaming reference architecture for Location Services in
reference point representation
NOTE 1: (R)AN represents NG-RAN, trusted non-3GPP access or untrusted non-3GPP
access.
NOTE 2: Reference point interface related to charging functionality is not
shown in this specification.
NOTE 3: PRU refers to a Positioning Reference Unit realized by a UE as defined
in clause 5.4.5 of TS 38.305 [9].
Figure 4.2.1-2 shows an architectural reference model for 5GS LCS for a non-
roaming UE and PRU in SBI representation.
Figure 4.2.1-2: Non-roaming reference architecture for Location Services in
SBI representation
### 4.2.2 Roaming reference architecture
Figure 4.2.2-1 shows an architectural reference model for 5GS LCS for a
roaming UE and PRU in reference point representation.
Figure 4.2.2-1: Roaming reference architecture for Location Services in
reference point representation
NOTE 1: (R)AN represents NG-RAN, trusted non-3GPP access or untrusted non-3GPP
access.
NOTE 2: Reference point interface related to charging functionality is not
shown in this specification.
NOTE 3: PRU refers to a Positioning Reference Unit realized by a UE as defined
in clause 5.4.5 of TS 38.305 [9].
Figure 4.2.2-2 shows an architectural reference model for 5GS LCS for a
roaming UE and PRU in SBI representation.
Figure 4.2.2-2: Roaming reference architecture for Location Services in SBI
representation
### 4.2.3 Reference architecture with sidelink positioning
Architectural reference model for 5GS LCS with sidelink positioning in
reference point representation and in SBI representation is in clause 4.2 of
TS 23.586 [40].
## 4.2a Interconnection between 5GC and EPC
### 4.2a.1 General
For MT-LR Location Request, when a LCS service request is received at 5GC
GMLC, the target UE may be served by either 5GC or EPC. An EPC/5GC common
interface is used between the LCS Client and the 5GC GMLC to enable the
location service request being handled based on whether the target UE is
served by EPC or 5GC. The AF initiates the service request to the 5GC GMLC via
NEF.
NOTE: The LCS Client doesn\'t know if UE is currently served by EPC or 5GC.
For MT-LR Location Request, the 5GC interconnection with EPC happens:
\- when an LCS service request is received by the 5GC GMLC and the target UE
is served by EPC in non-roaming case;
\- when an LCS request is received by the 5GC GMLC in the HPLMN of the target
UE and the target UE is served by EPC in the VPLMN in roaming case.
### 4.2a.2 Non-roaming architecture
Figure 4.2a.2-1 represents the non-roaming architecture of Location Services
for interconnection between 5GC and EPC.
Figure 4.2a.2-1: Non-roaming architecture of interconnection between 5GC and
EPC
NOTE 1: EPC GMLC and 5GC GMLC can be collocated in implementation, in such
case, Lr\' is not needed.
NOTE 2: For this release, Lr\' is not standardized.
NOTE 3: Interworking between 5GS and EPS is defined in clause 5.32.7 of TS
23.501 [18].
NOTE 4: The interaction between UDM and HSS, when they are deployed as
separate network functions, is defined in TS 23.632 [42] and TS 29.563 [43] or
it is implementation specific.
### 4.2a.3 Roaming architecture
Figure 4.2a.3-1 and Figure 4.2a.3-2 represent the Roaming architecture of
interconnection between 5GC and EPC.
Figure 4.2a.3-1: Roaming architecture of Location Services for interconnection
between 5GC and EPC (5GC GMLC and EPC GMLC are separately deployed in VPLMN)
Figure 4.2a.3-2: Roaming architecture of Location Services for interconnection
between 5GC and EPC (5GC GMLC and EPC GMLC are co-located in VPLMN)
## 4.2b Positioning methods
The LCS feature utilises one or more positioning methods in order to determine
the location of user equipment (UE). Determining the position of a UE involves
two main steps:
\- Radio signal measurements or non-RAT measurements; and
\- Position estimate computation based on the measurements.
The positioning methods for 3GPP access are described in clause 5.2.
The positioning methods for non-3GPP access are described in clause 5.3.1.
## 4.3 Functional description of LCS per network function
### 4.3.1 Access Network
The Access Network is involved in the handling of various positioning
procedures including positioning of a target UE, provision of location related
information not associated with a particular target UE and transfer of
positioning messages between an AMF or LMF and a target UE. The Access Network
shall support determination of location estimates in geographical and/or local
co-ordinates as defined in TS 23.032 [8].
In this version of the specification, location services are supported for NG-
RAN and non-3GPP access.
The LCS specific functionalities of the radio access network elements are
specified in TS 38.305 [9] for NG-RAN.
### 4.3.2 LCS Clients, Application Functions and Network Functions
AFs and NFs may access LCS services from a GMLC in the same trust domain (e.g.
in the same PLMN) using the Ngmlc interface or Event Exposure with location
information from an AMF in the same trust domain using the Namf interface. The
NWDAF collects UE location information by accessing GMLC directly.
LCS Clients may access LCS services from a GMLC (e.g. HGMLC) using the Le
reference point.
External AFs may access LCS services from an NEF using Nnef interface or CAPIF
API. The CAPIF and associated API provider domain functions are specified in
TS 23.222 [24].
An LCS Client or AF may access LCS services from a UE over a user plane
connection for reporting of location events by the UE for a periodic or
triggered 5GC-MT-LR when the UE is able to determine location estimates.
### 4.3.3 Gateway Mobile Location Centre, GMLC
The Gateway Mobile Location Centre (GMLC) contains functionality required to
support LCS. In one PLMN, there may be more than one GMLC.
A GMLC is the first node an external LCS client accesses in a PLMN (i.e. the
Le reference point is supported by the GMLC). AFs and NFs may access GMLC
directly or via NEF. The GMLC may request routing information and/or target UE
privacy information from the UDM via the Nudm interface. After performing
authorization of an external LCS Client or AF and verifying target UE privacy,
a GMLC forwards a location request to either a serving AMF using Namf
interface or to a GMLC in another PLMN using the Ngmlc interface in the case
of a roaming UE.
The target UE\'s privacy profile settings shall always be checked in the UE\'s
home PLMN prior to delivering a location estimate.
The \"Visited GMLC\" (VGMLC) is the GMLC, which is associated with the serving
node of the target UE.
The \"Home GMLC\" (HGMLC) is the GMLC residing in the target UE\'s home PLMN,
which is responsible for the control of privacy checking of the target UE.
Additional functions which may be performed by a GMLC to support location
services include the following:
\- At an HGMLC, determine the serving AMF for a target UE when there is more
than one serving AMF.
\- At an HGMLC, determine whether to attempt a second location request for a
target UE from a different AMF when location information returned by a first
AMF does not meet QoS requirements and there is more than one serving AMF.
\- At an HGMLC, support location requests from an external LCS client or NEF
for a 5GC-MT-LR and deferred 5GC-MT-LR for periodic, triggered and UE
available location events.
\- At an HGMLC, support additional check of whether the UE is located within
the requested target area for deferred 5GC-MT-LR for periodic, triggered and
UE available location events.
\- At an HGMLC, forward location requests for a roaming UE to a VGMLC or
serving AMF in the VPLMN based on deployment configurations.
\- At an HGMLC, receive event reports from a VGMLC or LMF for a deferred 5GC-
MT-LR for periodic or triggered location and return to an external LCS Client
or NEF.
\- At an HGMLC, support cancelation of a periodic or triggered location.
\- At an HGMLC, receive location information from an VGMLC for a 5GC-MO-LR and
forwards to an LCS Client or an AF (via NEF) if requested by the UE.
\- At a VGMLC, receive location requests from an HGMLC for a roaming UE and
forward to a serving AMF.
\- At a VGMLC, receive event reports from an LMF for a deferred 5GC-MT-LR for
periodic or triggered location for a roaming UE and forward to an HGMLC.
\- At a VGMLC, receive location information from an AMF for a 5GC-MO-LR and
forwards to an HGMLC.
\- At an HGMLC, reject the LCS request coming from a LCS client, e.g. when the
number of Target UEs in the LCS request exceeds the Maximum Target UE Number
of such client.
\- At an HGMLC, allocate the reference number for each location request from
an external LCS client for LDR.
\- At an HGMLC, assign the pseudonym if pseudonym indicator is received in the
service request and transfer it to external LCS client, e.g. when core network
provides the UE\'s location information to LCS client. Resolve the verinym
from the pseudonym, if it is received from the LCS client.
\- At an HGMLC, resolve group identifier to identifier of individual UEs and
aggregate responses to LCS Client or NEF during bulk operation procedure.
\- At an HGMLC, verify a request for user plane reporting by an LCS Client or
AF for a periodic or triggered 5GC-MT-LR and verify or assign parameters to
the request to enable the target UE to establish a secure user plane
connection to the LCS Client or AF. Subsequently, support the transfer of
cumulative event reports from the target UE via control plane back to the LCS
Client or AF.
\- During UE mobility between 5GS and EPS, the GMLC transfers the LCS request
between 5GS and EPS, may map the LCS QoS and (re-)initiate the LCS sessions
towards the 5GS to/from EPS.
\- At an HGMLC, determine a reporting indication on how a target UE sends
event reports when the UE is outside the event report allowed area based on
LCS privacy profile data, LCS Client type, the type of periodic or triggered
location reporting and associated parameters.
\- Support aggregation of a single UE\'s location estimates over a period of
time for a periodic or triggered 5GC-MT-LR event.
\- At an HGMLC or a VGMLC, for a regulatory location service, support multiple
location reports if requested by the LCS client.
### 4.3.4 Location Retrieval Function, LRF
The Location Retrieval Function (LRF) may be collocated with a GMLC or
separate and is responsible for retrieving or validating location information,
providing routing and/or correlation information for a UE which has initiated
an IMS emergency session. The information is provided by an LRF to an E-CSCF.
For more details, refer to TS 23.167 [10].
### 4.3.5 UE
A target UE may support positioning according to four different modes:
\- UE assisted mode (the UE obtains location measurements and sends the
measurements to another entity (e.g. an LMF) to compute a location);
\- UE based mode (the UE obtains location measurements and computes a location
estimate making use of assistance data provided by serving PLMN);
\- standalone mode (the UE obtains location measurements and computes a
location estimate without making use of assistance data provided by serving
PLMN);
\- network based mode (a serving PLMN obtains location measurements of signals
transmitted by a target UE and computes a location estimate).
NOTE: The transmission of UE signals for network based mode may or may not be
transparent to the UE.
Positioning procedures used by a UE for NG-RAN access are described in TS
38.305 [9].
A limited set of UE positioning capabilities and UE user plane positioning
capabilities can be transferred to the 5GCN in the 5GMM capability during
registration of the UE as described in TS 24.501 [11]. Some of these
positioning capabilities may be transferred subsequently to an LMF as
described in TS 29.572 [12]. UE positioning capabilities may also be
transferred directly to a location server (e.g. LMF).
Additional functions which may be supported by a UE to support location
services include the following.
\- Support location requests received from a network for 5GC-MT-LR, 5GC-NI-LR
or a deferred 5GC-MT-LR for periodic or triggered location.
\- Support location requests to a network for a 5GC-MO-LR.
\- Support privacy notification and verification for a 5GC-MT-LR or deferred
5GC-MT-LR for periodic or triggered location.
\- Send updated privacy requirements to a serving AMF (for transfer to a UDR
via UDM).
\- Support periodic or triggered location reporting to an LMF.
\- Support change of a serving LMF for periodic or triggered location
reporting.
\- Support cancelation of periodic or triggered location reporting.
\- Support multiple simultaneous location sessions.
\- Support the reception of unciphered and/or ciphered assistance data
broadcast by NG-RAN.
\- Support the reception of ciphering keys for the assistance data from the
AMF.
\- Support handling of 5GC-MT-LR, 5GC-NI-LR, 5GC-MO-LR and deferred 5GC-MT-LR
for periodic or triggered location over a user plane connection between UE and
LMF.
\- Support reporting of location events for a periodic or triggered 5GC-MT-LR
over a user plane connection to an LCS Client or AF with periodic cumulative
event reports being sent over control plane to the LMF, H-GMLC and LCS Client
or AF.
### 4.3.6 UDM
The UDM contains LCS subscriber LCS privacy profile and routing information.
The UDM is accessible from an AMF, GMLC or NEF via the Nudm interface.
The UDM may also contain an indication whether a UE is allowed to serve as a
PRU and indication whether PRU is stationary PRU as part of the UE
subscription data.
The UDM may also contain LMF identifier(s) and indication of user plane
positioning between UE and LMF in UE LCS subscription data.
### 4.3.7 Access and Mobility Management Function, AMF
The AMF contains functionality responsible for managing positioning for a
target UE for all types of location request. The AMF is accessible to the GMLC
and NEF via the Namf interface, to the RAN via the N2 reference point and to
the UE via the N1 reference point.
Functions which may be performed by an AMF to support location services
include the following.
\- Initiate an NI-LR location request for a UE with an IMS emergency call or
to know a UE geographical area with NR satellite access for PLMN selection
verification.
\- Receive and manage location requests from a GMLC for a 5GC-MT-LR and
deferred 5GC-MT-LR for periodic, triggered and UE available location events.
\- Receive and manage location requests from a UE for a 5GC-MO-LR.
\- Receive and manage Event Exposure request for location information from an
NEF.
\- Select an LMF.
\- Receive updated privacy requirements from a UE and transfer to a UDR via
UDM.
\- Support cancelation of periodic or triggered location reporting for a
target UE.
\- Support change of a serving LMF for periodic or triggered location
reporting for a target UE.
\- When assistance data is broadcast by 5GS in ciphered form, the AMF receives
ciphering keys from the LMF and forwards to suitably subscribed UEs using
mobility management procedures.
\- Store UE Positioning Capability received from an LMF and send the UE
Positioning Capability along with the received location request to an LMF.
\- Receive and store UE user plane positioning capability as part of the
\"5GMM capability\" from UE.
\- Receive UL NAS Transport including a PRU Association, Association Update,
or Disassociation Request (contained in an LCS supplementary service message)
from a UE.
\- AMF may verify whether a UE can serve as a PRU based on UE subscription
data after receiving the PRU Association Request, Association Update, or
Disassociation. AMF may also use local policy to determine if UEs are allowed
to serve as a PRU. AMF may verify based on subscription information or local
policy if PRU can work as stationary PRU.
\- Sends the PRU Association Request or PRU Disassociation Request to LMF and
may include a UE verification indication indicating whether this UE is
authorized to serve as a PRU.
\- Support verifying whether UE is subscribed with user plane positioning
between UE and LMF and triggering LMF to establish a User Plane Connection to
UE if UE requested that.
\- Support subscribing from LMF status of LCS user plane connection between a
UE and the LMF.
\- Store in UE context that UE has a maintained User Plane connection with
certain LMFs.
NOTE: Details of UE Positioning Capability is defined in TS 37.355 [20].
\- Support of local configuration of a mapping table of UE identifier ranges
and LMF identifier(s) or querying the UDM the LMF identifier for a UE for a
5GC-MO-LR.
\- Support the 5G to EPS Handover by providing the target MME ID to GMLC as
part of the LCS Service response.
\- Support interaction with NWDAF to obtain UE related analytics to assist
with UE location verification for NR satellite access.
### 4.3.8 Location Management Function, LMF
The LMF manages the overall co-ordination and scheduling of resources required
for the location of a UE that is registered with or accessing 5GCN. It also
calculates or verifies a final location and any velocity estimate and may
estimate the achieved accuracy. The LMF receives location requests for a
target UE from the serving AMF using the Nlmf interface. The LMF interacts
with the UE in order to exchange location information applicable to UE
assisted and UE based position methods and interacts with the NG-RAN, N3IWF or
TNAN in order to obtain location information.
The LMF shall determine the result of the positioning in geographical co-
ordinates as defined in TS 23.032 [8] and/or in local co-ordinates as defined
in TS 23.032 [8]. If requested and if available, the positioning result may
also include the velocity of the UE. The coordinate type(s) is determined by
LMF when receiving a location request, based on LCS Client type and supported
GAD shapes. If the location request indicates regulatory LCS Client type the
LMF shall determine a geographical location and optionally a location in local
coordinates. For location request indicates a value added LCS Client type, the
LMF may determine the UE location in local coordinates or geographical co-
ordinates or both. If the supported GAD shapes is not received or Local Co-
ordinates is not included in the supported GAD shapes, the LMF shall determine
a geographical location.
NOTE 1: Some RAT independent position methods (e.g. GNSS based position
methods) can only determine a UE location in geographical co-ordinates. In
such a case, the LMF may translate a UE location in geographical co-ordinates
into a location in local co-ordinates when an origin for the local co-
ordinates has known global coordinates. When an origin for the local co-
ordinates does not have known global coordinates, position methods that can
only determine a UE location in geographical co-ordinates cannot be used to
determine a UE location in local co-ordinates.
Additional functions which may be performed by an LMF to support location
services include the following.
\- Support a request for a single location received from a serving AMF for a
target UE.
\- Support a request for periodic or triggered location received from a
serving AMF for a target UE.
\- Determine type and number of position methods and procedures based on UE
and PLMN capabilities, QoS, UE connectivity state per access type, LCS Client
type, co-ordinate type and optionally service type and indication of requiring
reliable UE location information.
\- Report UE location estimates directly to a GMLC for periodic or triggered
location of a target UE.
\- Support cancelation of periodic or triggered location for a target UE.
\- Support the provision of broadcast assistance data to UEs via NG-RAN in
ciphered or unciphered form and forward any ciphering keys to subscribed UEs
via the AMF.
\- Support change of a serving LMF for periodic or triggered location
reporting for a target UE.
\- Support of receiving stored UE Positioning Capability from AMF and support
of providing updated UE Positioning Capability to AMF.
\- Map the UE location to a geographical area where the PLMN is or is not
allowed to operate based on the request from AMF.
\- Support determination of a UE location at a scheduled location time.
\- Support determination of indoor or outdoor for a location estimate.
\- Determine whether to use user plane or control plane for positioning.
\- Support handling of 5GC-MT-LR, 5GC-NI-LR, 5GC-MO-LR and deferred 5GC-MT-LR
for periodic or triggered location over a user plane connection between UE and
LMF over TLS.
Editor\'s note: LMF functionality of user plan connection handling will be
updated according to the protocol stack decision made by CT WG1.
\- Support collection of GNSS assistance data from AFs.
\- Support service level PRU Association, PRU Association update or PRU
Disassociation.
\- LMF supports verification of a PRU initiated Association or Disassociation
by checking whether there is an PRU verified indication from AMF.
\- LMF stores the received PRU information contained in service level PRU
Association message and removes the PRU information after PRU Disassociation.
\- LMF keeps PRU information for PRUs which are in OFF state.
\- LMF may indicate support of PRU function to NRF via NF profile and may
further send the PRU indication via NF profile update if PRU is stationary
PRU.
\- LMF may request a PRU to associate to a new LMF by returning a Routing ID
of the new LMF.
PRU ON/OFF states indicate temporarily availability of the PRU functionality
of a UE at the serving LMF (e.g. PRU OFF due to other high priority
tasks/energy saving at the UE, or the UE temporarily loses network coverage).
\- Support selection of a PRU based on stored PRU information if the LMF needs
to obtain the location measurements from the PRU to assist positioning of a
target UE.
\- Support to obtain PRU location measurements as described in clause 5.4.5 of
TS 38.305 [9] by triggering the procedure in clause 6.11.
\- Support to obtain PRU location measurements from other PRU serving LMF(s).
\- As a serving LMF of target UE(s), support discovery and selection of other
PRU serving LMF(s) by querying the NRF and support to request PRU location
measurements from the selected LMF(s).
\- As a serving LMF of PRU(s), support to provide PRU location measurements to
other LMF(s) after receiving a request from other LMF(s).
\- Support to determine UE location by considering obtained PRU location
measurements.
NOTE 2: Country, area within a country, or an international area can be
supported as different types of geographical area.
\- Support a request for user plane reporting from a UE to an LCS Client or AF
for a periodic or triggered 5GC-MT-LR. Subsequently, support the transfer of
cumulative event reports from the target UE via control plane back to the
H-GMLC and LCS Client or AF. Also support any request for assistance data
received in a cumulative event report.
\- Determine UE location for a UE connecting to a MBSR based on location and
velocity of the MBSR and the timing of the location estimations for the target
UE and MBSR.
\- For a regulatory location service, support reporting of multiple
INTERMEDIATE location estimates to GMLC.
### 4.3.9 Network Exposure Function, NEF
An NEF provides a means of accessing location services by an external AF or
internal AF. AFs access location services from an NEF using an API. Depending
on QoS requirements, an NEF can forward a location request to a GMLC or
request an event exposure for location information from serving AMF
(optionally via a UDM). When event exposure via AMF is used, an NEF may
request routing information and/or target UE privacy information from the UDM
via the Nudm interface.
Additional functions which may be performed by an NEF to support location
services include the following.
\- Support location requests from an AF for immediate location and for
deferred periodic and triggered location events.
\- Support location information exposure to an AF based on the location
request.
\- Support determination of GMLC or AMF based on e.g. the QoS requirements
from AF, type of the location request.
NOTE: If the GMLC or AMF are determined based on the QoS requirements and the
QoS requirements include Multiple QoS class, the determination of GMLC or AMF
is done based on the most stringent (i.e. primary) QoS requirements.
\- Select the serving AMF for a target UE when there is more than one serving
AMF.
\- Determine whether to attempt a second location request for a target UE from
a different AMF when location information returned by a first AMF does not
meet QoS requirements and there is more than one serving AMF.
\- Support UE LCS privacy profile provision from the AF.
\- Support suspending and cancellation of a periodic or triggered location
request.
\- Support authorization of LCS request from the AF.
\- Support rejecting the LCS request coming from an AF, e.g. when the number
of Target UEs in the LCS request exceeds the Maximum Target UE Number of such
client.
\- Support allocating the reference number for each location request from an
AF for LDR.
### 4.3.10 Unified Data Repository, UDR
The UDR contains privacy data information for target UEs and may be updated by
a serving AMF via UDM with new privacy information received from a UE.
### 4.3.11 Positioning Reference Unit, PRU
A UE may support the functions of a PRU. The PRU supports the following
functions including functions defined in TS 38.305 [9]:
\- Support service level association, association update and disassociation
with a serving LMF.
\- The PRU sends service level association, association update or
disassociation to LMF via LCS supplementary service message.
\- Support association with multiple LMFs. e.g. for the case a PRU is in
multiple LMF overlapped serving areas.
\- The PRU information included in a PRU association or PRU association update
contains one or more than one of the following aspects:
\- PRU Positioning Capabilities.
\- Location information if known.
\- PRU ON/OFF state.
PRU ON/OFF states indicate temporarily availability of the PRU functionality
of a UE at the serving LMF.
A UE accesses 5G network via NR satellite shall not operate as a PRU.
### 4.3.12 Network Repository Function, NRF
In addition to the functions defined in TS 23.501 [18], the NRF may perform
the following functions:
\- Support to store or update PRU existence indication in TAI level in LMF
profile based on request from PRU serving LMF.
\- Support LMF(s) with PRU function discovery by AMF.
\- LMF discovery by considering user plane Positioning Capability.
\- Support LMF(s) associated with PRUs discovery by other LMF(s), according to
target area in the discovery request and the LMF profiles with PRU existence
indication in TAI level.
## 4.4 Reference Point to Support Location Services
### 4.4.1 Le Reference Point
The Le reference point supports location requests sent by an LCS Client to a
GMLC or LRF.
The Le reference point may be supported using the Mobile Location Protocol
(MLP) defined by OMA [13].
### 4.4.2 NL3 Reference Point
The NL3 reference point supports location requests forwarded by an HGMLC to a
VGMLC.
### 4.4.3 N1 Reference Point
The N1 reference point supports transfer of supplementary services messages
between a serving AMF and target UE to support privacy notification and
verification and change of UE privacy preference. The N1 reference point also
supports transfer of positioning protocol messages and location event reports
between a target UE and an LMF via a serving AMF. The N1 reference point
supports the transfer of ciphering keys from an AMF to a suitably subscribed
UE to enable the UE to receive ciphered broadcast assistance data. All
messages sent over the N1 reference point for support of location services are
encapsulated in NAS Transport messages as defined in TS 24.501 [11].
### 4.4.4 N2 Reference Point
The N2 reference point supports transfer of positioning messages, via an AMF,
between an LMF and a RAN node, or N3IWF in the case of untrusted non-3GPP
access. The N2 reference point also supports transfer of messages, via an AMF,
from an LMF to an NG-RAN node, which carry assistance data to be broadcast by
the NG-RAN node. Positioning messages relevant to the N2 interface are defined
in TS 38.455 [15].
### 4.4.5 Void
### 4.4.6 NL5 Reference Point
The NL5 reference point supports location requests sent by an NEF or other NF
to a GMLC.
### 4.4.7 NL2 Reference Point
The NL2 reference point supports location requests sent by a GMLC to a serving
AMF for a target UE.
Messages for the NL2 reference point are defined in TS 29.518 [16].
### 4.4.8 NL6 Reference Point
The NL6 reference point supports queries from an HGMLC to a UDM for privacy
subscription information for a target UE and routing information for a target
UE.
### 4.4.9 N51 Reference Point
The N51 reference point supports queries from an NEF to a serving AMF for the
location of a target UE.
Messages for the N51 reference point are defined in TS 29.518 [16].
### 4.4.10 NL1 Reference Point
The NL1 reference point supports location requests for a target UE sent from a
serving AMF for the target UE to an LMF. Location requests are supported for
immediate location and for deferred location for periodic or triggered
location events.
The NL1 reference point also supports the transfer from an LMF to an AMF of
ciphering keys and associated data that enable deciphering by suitably
subscribed UEs of ciphered broadcast assistance data.
Messages for the NLI reference point are defined in in TS 29.518 [16] and TS
29.572 [12].
### 4.4.11 N52 Reference Point
The N52 reference point supports queries from an NEF to a UDM for privacy
subscription information for a target UE and routing information for a target
UE. The N52 interface also supports a request from an NEF to a UDM to forward
a location request from the NEF to a serving AMF for the target UE.
### 4.4.12 NL7 Reference Point
The NL7 reference point supports location context transfer between two LMFs.
### 4.4.13 NL8 Reference Point
The NL8 reference point supports LMF to receive location related analytics
from NWDAF as defined in TS 23.288 [37].
### 4.4.14 NL9 Reference Point
The NL9 reference point supports location requests sent by NWDAF to a GMLC.
### 4.4.15 NL10 Reference Point
The NL10 reference point supports LMF to send location requests to GMLC in
case of 5GC-MT-LR involving MBSR. Additionally, this reference point is used
by LMF to send location result directly to GMLC in case of Deferred Location
or 5GC-MT-LR multiple location or in case of support for PNI-NPN architecture.
## 4.5 Service Based Interfaces to Support Location Services
The 5GS LCS architecture contains the following service-based interfaces for
Location Services:
**Nlmf:** Service-based interface exhibited by LMF.
**Ngmlc:** Service-based interface exhibited by GMLC.
# 5 High Level Features
## 5.1 LMF Discovery and Selection
LMF selection functionality is supported by the AMF to determine an LMF for
location estimation of the target UE or Ranging/Sidelink Positioning between
Target UE and SL Reference UE. The LMF selection functionality is also
supported by the LMF if it determines that it is unsuitable or unable to
support location for the current UE access network or serving cell for the
deferred 5GC-MT-LR procedure for periodic, triggered location events, or
Modification of User Plane Connection. The LMF selection functionality may
also be supported by the GMLC and the GMLC provides the selected LMF ID to
AMF.
LMF reselection is a functionality supported by AMF when necessary, e.g. due
to UE mobility.
The LMF selection/reselection may be performed at the AMF or LMF or GMLC based
on the locally available information i.e. LMF profiles are configured locally
at AMF or LMF or GMLC, or by querying NRF.
The following factors may be considered during the LMF selection:
\- LCS client type.
\- Requested Quality of Service information, e.g.:
\- LCS accuracy,
\- Response time (latency),
\- Access Type (3GPP /N3GPP).
NOTE 1: Location methods may differ depending on the Access Type, e.g. in the
case of WLAN Access Location determination may just correspond to retrieval of
IP addressing information from the N3IWF/TNGF; As another example, for
Wireline access, Location determination may just correspond to retrieval of
geo coordinates corresponding to a GLI as defined in clause 4.7.8 of TS 23.316
[21] or a HFC Node ID.
\- RAT type (e.g. 5G NR, eLTE, or any of the RAT Types specified for NR
satellite access) and/or the serving AN node (i.e. gNB or NG-eNB) of the
target UE.
\- RAN configuration information.
\- LMF capabilities, including the support of Uu based positioning as defined
in clause 4.3.8 and/or Ranging/Sidelink positioning as defined in clause 4.3.8
of TS 23.586 [40].
\- LMF load.
\- LMF location.
\- Indication of either a single event report or multiple event reports.
\- Duration of event reporting.
\- Network slicing information, e.g. S-NSSAI and/or NSI ID.
\- LMF Service Area consisting of one or more TA(s).
\- Supported GAD shapes.
\- Support LCS when MBSR is involved.
\- Requested UE has maintained user plane connection with certain LMFs.
When receiving a NAS message from UE, including an LMF ID together with a LPP
message (refer to step 25 in clause 6.3.1 for event reporting for a deferred
5GC-MT-LR), AMF sends the LPP message to the LMF, as indicated by the LMF ID.
NOTE 2: Description on how UE encapsulates the LMF ID in the NAS message is
documented in TS 24.571 [36].
UDM may store the LMF ID in UE subscription data. During the location
procedure, GMLC received the LMF ID from the UDM and provides it to AMF.
GMLC may be configured with the following parameters:
\- LMF ID and/or
\- per group ID and its correlating LMF ID.
The AMF may use locally provisioned configuration to determine LMF based on UE
identify or its group information.
NOTE 3: It is AMF implementation specific for the priority of different
selection criteria from GMLC, AMF and LMF.
When the GMLC receives a MT location request from LCS client/AF, GMLC
determines the LMF ID based on the configured parameters for an LCS Client/AF.
In case a group ID is provided or derived from the location request, GMLC
determines the correlating LMF ID based on the provisioned group ID.
GMLC may have configuration with one or several dedicated LMF ID(s),
irrelevant to any LCS client/AF. When the GMLC receives a MT location request
from LCS client/AF, GMLC only determines the LMF ID within the configuration
for all LCS client/AF.
NOTE 4: When AMF can\'t access the LMF instance of the LMF ID, by default, AMF
replies to corresponding error to GMLC. GMLC could retry or fail the request
accordingly; with explicit configuration to serve as backup selection in this,
AMF can also select different configured LMF instance.
## 5.1a GMLC Discovery and Selection
More than one GMLC in the HPLMN can serve the location requests for a single
UE. GMLC discovery and selection functionality is supported by AMF, LMF, NEF,
LCS client and GMLC.
A LCS client may be configured with GMLC address(es). It may also determine
the GMLC address by performing a DNS query.
A NEF, LMF, AMF or GMLC may be configured with GMLC address(es). Those NF may
also query the NRF to get GMLC address(es).
In the following scenarios, information about the GMLC instance may be
provided by UE, in such case, this GMLC instance is used:
\- In the deferred MT-LR procedure, when UE reports the detected event to the
AMF, it may also include the (H)GMLC address.
\- In the MO-LR procedure, when UE initiates the LCS service request, it may
also include the (H)GMLC address if the location estimation is reported to the
(H)GMLC.
AMF may be configured locally a mapping table of UE identity e.g. MSISDN and
GMLC address. When receiving a MO-LR, AMF determines GMLC based on local
configuration.
## 5.2 3GPP access specific aspects
When 3GPP access type is selected, the positioning methods for 3GPP access
defined in TS 38.305 [9] apply.
Access Type Selection for LCS Service is defined in clause 5.3.2.
## 5.3 Non-3GPP Access Specific Aspects
### 5.3.1 Location Information for Non-3GPP Access
If the UE registered to non-3GPP access, following information can be regarded
as UE location information:
Table 5.3.1-1: Supported UE location information of non-3GPP access
+----------------+----------------+----------------+----------------+ | | Untrusted | Trusted | Wireline | | | non-3GPP | non-3GPP | Access | | | Access | Access | | +================+================+================+================+ | UE Side | UE local IP | UE/N5CW device | Null | | | address, | local IP | | | N5CW device | | address | | | Side for | In the case of | (NOTE 2). | | | Trusted WLAN | WLAN access, | | | | Access | BSSID of the | In the case of | | | | attached AP or | WLAN access, | | | 5G-RG side for | BSSID of | BSSID of the | | | Wireline | detected AP, | attached AP or | | | Access | | BSSID of | | | | Civic address | detected AP, | | | | and/or | | | | | geospatial | Civic address | | | | location | and/or | | | | information | geospatial | | | | (NOTE 1, | location | | | | NOTE 5, | information | | | | NOTE 6). | (NOTE 1, | | | | | NOTE 5, | | | | | NOTE 6). | | +----------------+----------------+----------------+----------------+ | N3IWF Side for | UE local IP | UE/N5CW device | HFC node ID | | Untrusted | address and | local IP | for 5G-CRG in | | non-3GPP | optionally UDP | address and | clause 10.1 of | | Access; | or TCP source | optionally UDP | TS | | | port (NOTE 2) | or TCP source | 23.316 [21]; | | TNGF Side for | | port (NOTE 2), | | | trusted | | | GLI for 5G-BRG | | non-3GPP | | TNAP/TWAP Id | in clause 10.1 | | Access; | | (NOTE 2) | of | | | | | TS | | TWIF Side for | | | 23.316 [21]. | | trusted WLAN | | | | | Access; | | | | | | | | | | W-AGF Side for | | | | | wireline | | | | | Access | | | | +----------------+----------------+----------------+----------------+ | AMF Side | UE local IP | UE/N5CW device | HFC node ID | | | address and | local IP | for 5G-CRG in | | | optionally UDP | address and | clause 10.1 of | | | or TCP source | optionally UDP | TS | | | port (NOTE 3). | or TCP source | 23.316 [21]; | | | | port (NOTE 2, | | | | Last known | NOTE 3). | GLI for 5G-BRG | | | 3GPP access | | in clause 10.1 | | | User Location | Last known | of | | | Info (NOTE 4). | 3GPP access | TS | | | | User Location | 23.316 [21] | | | | Info (NOTE 4). | | | | | | | | | | TNAP/TWAP Id | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | NOTE 1: In the | | | | | case of WLAN | | | | | access, the UE | | | | | may retrieve | | | | | its location | | | | | from a WLAN | | | | | AP, prior or | | | | | after | | | | | association | | | | | with the AP, | | | | | requesting the | | | | | Civic Location | | | | | ANQP element, | | | | | the Geospatial | | | | | Location ANQP | | | | | element or | | | | | both as | | | | | specified in | | | | | IEEE Std | | | | | 802.11-2012, | | | | | using ANQP | | | | | procedures | | | | | described in | | | | | HS2.0 Rel-12 | | | | | specification. | | | | | | | | | | NOTE 2: More | | | | | details can | | | | | refer to | | | | | clause 5.6.2 | | | | | of | | | | | TS | | | | | 23.501 [18]. | | | | | | | | | | NOTE 3: This | | | | | location | | | | | information | | | | | can be | | | | | provided by | | | | | location | | | | | change event, | | | | | more details | | | | | can refer to | | | | | cl | | | | | ause 5.2.2.3.1 | | | | | of | | | | | TS | | | | | 23.502 [19]. | | | | | | | | | | NOTE 4: This | | | | | location | | | | | information is | | | | | also named as | | | | | Last known | | | | | Cell-Id, more | | | | | details can | | | | | refer to | | | | | clause 5.6.2 | | | | | of | | | | | TS | | | | | 23.501 [18]. | | | | | | | | | | NOTE 5: | | | | | Geospatial | | | | | location | | | | | information | | | | | can be | | | | | obtained if UE | | | | | (e.g. laptop) | | | | | has installed | | | | | GNSS receiver, | | | | | i.e. GPS. | | | | | | | | | | NOTE 6: Some | | | | | Applications | | | | | (e.g. Google | | | | | Map) may map | | | | | the WiFi AP\'s | | | | | BSSID with the | | | | | geospatial | | | | | locations | | | | | obtain through | | | | | GPS when the | | | | | UE switch on | | | | | the GPS and | | | | | WiFi | | | | | s | | | | | imultaneously. | | | | | When another | | | | | UE detect the | | | | | same AP, the | | | | | Application | | | | | will send the | | | | | geospatial | | | | | locations to | | | | | the UE. Thus | | | | | the UE obtain | | | | | the geospatial | | | | | locations even | | | | | without switch | | | | | on the GPS. If | | | | | the | | | | | Application | | | | | map the | | | | | geospatial | | | | | locations to | | | | | civic address, | | | | | the UE can | | | | | also obtain | | | | | the civic | | | | | address. | | | | +----------------+----------------+----------------+----------------+
If the UE registered to 3GPP access and non-3GPP access simultaneously,
following information can be regarded as UE location information:
\- All location information when the UE only registered to non-3GPP access,
\- All location information when the UE only registered to 3GPP access, more
details can refer to TS 36.305 [7].
### 5.3.2 Access Type Selection for LCS Service
The positioning of a UE can be performed via either 3GPP access network or
non-3GPP access network.
For a MT-LR Location Service request, in order to select the positioning
access type, the GMLC uses information retrieved from the UDM and optionally
serving AMFs, e.g. access type, its serving AMF identity(ies), and UE
connectivity state of this access, if available, and locally configured
operator policy as follows:
\- If only one AMF identity is provided by the UDM, the GMLC selects this AMF
for UE positioning.
\- When the UE is concurrently served by multiple PLMNs respectively for 3GPP
access and non-3GPP access, multiple AMF identities with corresponding access
types may be provided by the UDM, and the GMLC selects one access type and its
associated AMF, which may be based on access type and its AMF, UE connectivity
state per access type information, if this is retrieved from UDM or AMFs, PLMN
identity, and/or locally configured operator policy. If the location
estimation result provided by this AMF cannot fulfil the QoS requirements, the
GMLC may reselect another access type and its associated AMF from the
candidate list provided by the UDM to perform positioning.
When AMF receives a MT-LR Location Service request, the AMF shall provide to
the LMF UE connectivity state per access type as well as the QoS requirement
that are received from the GMLC.
When AMF receives the event report from the UE for a periodic or triggered MT-
LR Location Service, the AMF may select a LMF or use the LMF indicated by the
UE as described in clause 6.4 and clause 6.3.1 and may provide the UE
connectivity state per access type to the LMF.
The LMF determines the positioning access type and positioning method based on
the QoS requirement, UE/network positioning capability, and UE connectivity
state per access type received from the AMF and the locally configured
operator policy.
## 5.4 UE LCS privacy
### 5.4.1 General
An LCS client or AF may or may not be authorised to retrieve the UE location,
e.g. for commercial use. UE LCS privacy is a feature which allows a UE and/or
AF to control which LCS clients and AFs are and are not allowed access to UE
location information. UE LCS privacy can be supported via subscription and via
UE LCS privacy profile handling.
With subscription, privacy preferences for a UE are stored in a UE LCS privacy
profile as part of UE subscription data in the UDM and queried from the UDM by
another NF such as GMLC or NEF. The UDM may also store the UE privacy profile
in the UDR. In this release of the specification, subscription of privacy
preferences is restricted to the Call/Session unrelated Class as defined in
clause 5.4.2.2.3 and the PLMN Operator Class as defined in clause 5.4.2.2.4.
With UE LCS privacy profile handling, the UE and/or AF can provide and update
part of the UE privacy profile and provide it to the network as an update to
the UDR. In this release of the specification, UE LCS privacy profile handling
is restricted to the Location Privacy Indication as defined in clause 5.4.2.3.
The UE LCS privacy profile is used to indicate whether LCS requests from LCS
clients and AFs are allowed or disallowed, together with the POI as defined in
clause 5.4.4.
NOTE: In clause 5.4, even if the UE LCS privacy detail is only described for
LCS client, the same detail is also applicable for AF, if no exception
statement.
### 5.4.2 Content of UE LCS Privacy Profile
#### 5.4.2.1 General
The UE LCS privacy profile shall include information related to classes of LCS
client, referred to as \"privacy classes\", which are permitted, or
conditionally permitted, to obtain location information for the UE. Privacy
classes are defined in clause 9.5.3 of TS 23.271 [4], but not all classes
defined in TS 23.271 [4] are supported in this specification. Privacy classes
are supported as described below. The differences between the Privacy classes
for 5GS and those for EPS are described in Annex A.
The UE LCS privacy profile also includes the Location Privacy Indication, as
defined in clause 5.4.2.3, which can be provided and updated by the UE and/or
AFs.
#### 5.4.2.2 Privacy Classes
##### 5.4.2.2.1 Universal Class
The universal class defined in clause 9.5.3.1 of TS 23.271 [4] is not
supported in this specification.
##### 5.4.2.2.2 Call/Session related Class
The call/session related class defined in clause 9.5.3.2 of TS 23.271 [4] is
not supported in this specification.
##### 5.4.2.2.3 Call/Session unrelated Class
The call/session unrelated class defined in clause 9.5.3.3 of TS 23.271 [4] is
supported for a 5GC-MT-LR. The subscription options for the Call/Session
unrelated Class may be assigned to an identified value added LCS Client, AF,
value added LCS Client group or service type as described in clause 7.1 and
comprise one of the following alternatives:
\- positioning allowed without notifying the UE user (default case);
\- positioning allowed with notification to the UE user;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user or if there is no
response to the notification;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user.
NOTE: LCS service types are defined in TS 22.071 [2] and numeric values for
LCS service types are listed in clause 17.7.8 of TS 29.002 [29].
A default subscription as described in clause 9.5.3.3 of TS 23.271 [4] is
included in the UE LCS privacy profile for any value added LCS client or AF
not otherwise identified for the Call/Session unrelated Class and defines one
of the following alternatives:
\- positioning not allowed (default case);
\- positioning allowed with notification to the UE user;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user or if there is no
response to the notification;
\- positioning requires notification and verification by the UE user;
positioning is allowed only if granted by the UE user.
The subscription options for the Call/Session unrelated Class may further
indicate additional information for each identified value added LCS client,
for each identified service type and for the unidentified value added LCS
clients as follows:
\- A valid time period for positioning;
\- A valid geographic area for positioning.
The UE LCS privacy profile may also indicate that any unidentified value added
LCS client or an LCS Client associated with an identified service type shall
provide a codeword in order to locate the UE, where the codeword is verified
by either a GMLC or the UE. When verification by a GMLC is indicated, a list
of one or more codewords is included as part of the UE LCS privacy profile.
##### 5.4.2.2.4 PLMN Operator Class
The PLMN operator class defined in clause 9.5.3.4 of TS 23.271 [4] is
supported.
NOTE: The PLMN Operator Class (except O&M LCS client in the VPLMN) can be
applied to SNPN.
Besides the types of client specified in clause 9.5.3.4 of TS 23.271 [4], the
PLMN Operator Class also supports positioning by the following types of
client:
\- NWDAF in the HPLMN (when the UE is currently being served by the HPLMN);
\- NWDAF in the VPLMN.
#### 5.4.2.3 Location Privacy Indication (LPI)
The Location Privacy Indication is not defined in TS 23.271 [4]. The Location
Privacy Indication defines whether LCS requests for UE from any LCS clients
are allowed or disallowed.
The LPI at least includes one of the following global settings (for all LCS
clients and AFs):
\- Location for UE is disallowed (location for UE not allowed to any LCS
client except where POI applies).
\- Location for UE is allowed (default setting, and LCS requests for UE from
LCS clients are authorized based on their associated privacy classes as
defined in clause 5.4.2.2).
NOTE: Additional LPI values may be supported for additional differentiation of
location request types.
The LPI also allows the following optional settings:
\- Valid time period for LPI, including start time and end time.
The LPI takes precedence on the subscribed privacy classes as defined in
clause 5.4.2.2. The LPI allows a UE to override the location preference of the
subscribed privacy classes. The usage of LPI is described in clause 6.1.2.
### 5.4.3 Provision of UE LCS privacy profile
A generation or change to the LPI in UE LCS privacy profile is determined by
the UE and provided to the network using N1 NAS message. It may be updated by
UE any time.
An authorized AF is allowed to provision the LPI in UE LCS privacy profile for
specific UE(s) via NEF.
NOTE: The AF allowed to provision the UE LCS privacy profile is different from
the AF sending location requests.
The LPI in UE LCS privacy profile may be provided or updated by the target UE
during the 5GC-MT-LR and Deferred 5GC-MT-LR Procedure for Periodic, Triggered
and UE Available Location Events. The updated profile is stored into the UDR
by the UDM after the interaction with the AMF. The LPI in UE LCS privacy
profile shall include an indication if location is allowed or disallowed and
may include a valid time period for LPI as described in clause 5.4.2.3.
In addition, a notification is sent by the UDM in order to notify the
subscribed consumer i.e. GMLC and NEF about the change of UE LCS privacy
profile:
\- Target UE identity (one or both of GPSI and SUPI);
\- Updated UE LCS privacy profile.
### 5.4.4 Privacy Override Indicator (POI)
The POI is used to determine whether the UE LCS privacy profile of the
subscriber to be positioned shall be overridden by the request for location
services. The POI is applicable only to regulatory services. The assignment of
a POI value with an \"override\" or \"not override\" value in the LCS client
profile (see clause 7.2.1) is done during the LCS client provisioning (out of
scope of this specification). The type of LCS client requesting location
information (i.e. emergency, law-enforcement etc.) shall determine the value
of the POI assigned to the LCS client profile.
### 5.4.5 LCS service authorization for an Immediate UE Location
UDM provides the UE LCS privacy profile to NEF and GMLC, if the information is
available.
For a 5GC_MT_LR request for immediate location, the GMLC in the HPLMN, or the
HGMLC when the UE is roaming, determines whether the LCS client or NF is
authorized to retrieve UE location, based on the UE privacy profile.
NOTE 1: The UE LCS privacy profiles are not sent to the VGMLC.
Authorization is determined by first verifying whether the location request is
allowed according to the Location Privacy Indication (LPI) defined in clause
5.4.2.3. If the location request is not allowed, an error response is returned
to the LCS client, AF, or NF. If the location request is allowed according to
the LPI, authorization is next verified according to the Call/Session
unrelated Class for an LCS Client or AF or according to the PLMN Operator
Class for an NF.
For the Call/Session unrelated Class client types where POI does not apply,
the HGMLC determines one of the following indications to be included in the
location request forwarded to the serving AMF, or VGMLC in the case of
roaming:
\- Location allowed without notification;
\- Location allowed with notification;
\- Location with notification and privacy verification; location allowed if no
response;
\- Location with notification and privacy verification; location restricted if
no response.
For PLMN Operator Class client types that are permitted to receive UE location
information or where POI applies, a \"location allowed without notification\"
is included.
For a Call/Session unrelated Class client type, which a geographic area
restriction was included in the UE LCS privacy profile, the (H)GMLC performs
an initial location by including a \"location allowed without notification\"
indication in the location request sent to the VGMLC or AMF. The (H)GMLC then
determines, based on the obtained location, whether location of the UE is
allowed. If location of the UE is allowed subject to notification or
verification, the (H)GMLC initiates a second location request to the VGMLC or
serving AMF for the purpose of notification and/or verification only and
includes one of the following indications in the second location request
forwarded to the serving AMF, or VGMLC in the case of roaming:
\- Notification only
\- Notification and privacy verification only
When \"Notification and privacy verification only\" is included, the serving
AMF shall report the result of privacy verification back to the (H)GMLC (i.e.
location allowed, location not allowed or timeout on a response) and the
(H)GMLC shall determine whether or not to return the location received for the
first request back to the LCS client based or AF on this result.
For a direct NEF query to a serving AMF, or for an NEF query via the UDM, if
GMLC is not involved, the NEF determines whether the AF is authorized to
retrieve UE location, based on the UE LCS privacy profile.
NOTE 2: Notification and verification are not supported for a direct NEF query
to a serving AMF, or for an NEF query via the UDM. Consequently, when
notification or verification are required, or may be required based on a
geographic area restriction, an NEF shall forward a location request to a GMLC
or return an error indication to the requesting AF.
### 5.4.6 LCS service authorization for a Deferred UE Location
Support of UE LCS privacy for a deferred UE location is the same as that
described in clause 5.4.5 for an immediate UE location with the differences
and qualifications described in this clause.
An (H)GMLC or NEF shall subscribe to notification of a change in the UE LCS
privacy profile from the UDM at the start of a deferred 5GC-MT-LR procedure
and shall verify UE privacy both at the start of the deferred 5GC-MT-LR
procedure and for each location result returned to an LCS client or AF based
on the most recent UE LCS privacy profile received from the UDM.
If the UE LCS privacy profile indicates notification or verification of a
location request is required for a particular value added LCS client, the
(H)GMLC indicates this in the initial location request sent to the serving AMF
and the serving AMF notifies the UE or verifies the location request with the
UE, as for an immediate location request, when the UE first becomes reachable.
The serving AMF also indicates the type of deferred location request in the
NAS Location Notification Invoke Request sent to the UE. However, the location
notification or verification is not repeated for each UE location in the case
of a periodic or triggered 5GC-MT-LR.
For a value added LCS client, AF, value added LCS client group or LCS service
type, for which a geographic area restriction was included, the (H)GMLC
includes any request for notification or verification of the location request
in the initial location request sent to the serving AMF. The (H)GMLC then
determines whether a location result can be returned to the LCS client or AF
based on whether the location result is or is not restricted by the geographic
area restriction. If the location result is allowed by the geographic area
restriction, the (H)GMLC does not perform a second location request to the
serving AMF for the purpose of notification and/or verification only. If the
location result is not allowed by the geographic area restriction, the (H)GMLC
discards the location result without notifying the LCS client or AF.
## 5.5 Location service exposure
Location service can be exposed to the authorized control plane NF or the LCS
client to obtain the UE location to enable their application and services
using the MT-LR procedure. For the location service exposed to the AF which is
not allowed to directly interact with the GMLC or AMF, CAPIF API may be used
between NEF and the AF as described in clause 6.2.5.1 of TS 23.501 [18].
For location service exposure, there are two types of location service
requests as defined in clause 4.1a.4 and clause 4.1a.5:
\- Location Immediate Request (LIR); and
\- Location Deferred Request (LDR).
The following attributes may be included in the location service requests:
\- Target UE identity;
\- LCS Client identity or AF ID;
\- Service identity, if needed;
\- Codeword, if needed;
\- Type of Event definition, i.e. UE available, change of area, motion or
periodic location, applicable to deferred location requests only;
\- Indication of requiring reliable UE location information;
\- Definitions for change of area type deferred location requests. Following
parameters may be defined, if needed:
a) Indication for event trigger, i.e. UE enters, leaves or is within requested
target area;
b) Indication of either a single event report or multiple event reports;
c) Minimum time interval between area event reports, if multiple event reports
are requested;
d) Indication of the requested location estimate; i.e. whether the location
estimate of the target UE should be contained in the change of area event
report;
e) Duration of event reporting;
f) Maximum time interval between reports;
g) Maximum sampling time for event detection;
h) Indication to have an additional check whether UE is located within the
requested target area, and when this additional check is requested, the
location estimate is mandatory;
\- Definitions for motion type deferred location requests. Following
parameters may be defined, if needed:
a) Linear distance threshold;
b) Indication of either a single event report or multiple event reports;
c) Minimum time interval between motion event reports, if multiple event
reports are requested;
d) Indication of the requested location estimate; i.e. whether the location
estimate of the target UE should be contained in the motion event report;
e) Duration of event reporting;
e) Maximum time interval between reports;
f) Maximum sampling time for event detection;
\- Definitions for periodic location type deferred location requests.
Following parameters may be defined, if needed:
a) Time interval between successive location reports;
b) Total number of reports;
\- Start time, stop time (i.e. specifying the validity time of LCS request),
if needed for LCS Client e.g. using the OMA MLP protocol;
\- Interval, applicable to periodical requests only;
\- Requested LCS Quality of Service information, if needed, i.e. accuracy,
response time and LCS QoS Class;
\- Requested type of location, i.e. \"current location\", \"current or last
known location\" or \"initial location\" applicable to LIR only (current
location is only available for LDR);
\- Supported GAD shapes, if needed;
\- Velocity of the UE, if needed;
\- Priority, if needed;
\- Service coverage (i.e. E.164 country codes for geographic areas, ITU-T
Recommendation E.164 [23]), if needed;
\- Requested maximum age of location, if needed;
\- Local coordinate reference system, if needed for LCS Client e.g. using the
OMA MLP protocol;
\- Target area, i.e. geographical area expressed as one of the following
format, if needed:
a) a shape defined in TS 23.032 [8];
b) local coordinate system for LCS Client e.g. using the OMA MLP protocol;
c) E.164 country code for a geographic area [23] for LCS Client e.g. using the
OMA MLP protocol;
d) PLMN identity for LCS Client e.g. using the OMA MLP protocol;
e) geopolitical name of the area (e.g. London) for LCS Client e.g. using the
OMA MLP protocol;
\- Response Method, if needed for LCS Client e.g. using the OMA MLP protocol;
\- Scheduled Location Time.
\- Definitions for periodic or triggered location reporting from a UE to an
LCS Client or AF over user plane. Following parameters may be defined, if
needed:
a) Request for user plane reporting;
b) User plane address of the LCS Client or AF;
c) Security information to enable a secure connection.
The following attributes may be included in the location service response:
\- Location indication of UE in geographical coordinates and/or local
coordinates expressed as a shape as defined in TS 23.032 [8] or for LCS Client
e.g. using the OMA MLP protocol, local coordinate reference system;
\- Velocity of the UE as defined in TS 23.032 [8], if requested and if
available;
\- The information about the positioning method used to obtain the location
estimate of the UE, if it is available at the LCS server and if needed;
\- Time stamp of location estimate;
\- Indication when UE enters, is within or leaves the Geographical area, if
needed;
\- Acknowledgement for a deferred location request, if needed.
\- Request id, if needed.
\- Indication that the requested QoS was not met, if needed, only applicable
if the request was for best effort class
\- Indication of a periodic event.
\- Indication of a motion event.
\- Indication that a deferred location request has been activated in a UE.
\- Indication of expiration of the maximum reporting interval for the area
event or motion event for LCS Client e.g. using the OMA MLP protocol.
\- Indication of a cumulative event for user plane location reporting from a
UE to an LCS Client or AF.
In addition, the information attributes of the location service request may be
used also in the location service response.
For a LCS client in the core network, the LCS service request is sent to GMLC
using Le interface.
For an AF not allowed to directly interact with the GMLC or AMF, the LCS
service request is sent to NEF using the service based interface.
For an internal control plane NF, the LCS service request is sent to AMF or
GMLC using the service based interface.
NOTE: For regulatory services, any control plane NF can be LCS client.
To support location service exposure through NEF, when NEF receives a LCS
service request, it determines based on the location accuracy of the QoS
requirement, e.g. lower or higher than cell-ID level, on whether to invoke the
GMLC service or the AMF service for the LCS service request.
## 5.6 LCS Charging
Charging Information for LCS service is collected at GMLC and AMF. For roaming
case, the Charging Information shall be collected in both home PLMN and
visited PLMN for inter-operator charging purpose.
Charging mechanism for LCS service and the Charging Information collected at
GMLC and at AMF are defined in TS 32.271 [30] and TS 32.298 [31].
## 5.7 Support of Concurrent Location Requests
### 5.7.1 General
Concurrent Location Requests occur when any entity (e.g. UE, AMF, LMF, GMLC,
NEF):
\- Case A: receives/initiates multiple LCS requests (e.g. 5GC-MT LR, 5GC-MO
LR, 5GC-NI LR) for the location estimate of the same target UE within a time
period; or
\- Case B: receives/initiates one or more new LCS request(s) (e.g. 5GC-MT LR,
5GC-MO LR, 5GC-NI LR) for the location estimate of the same target UE during
the location session to support the old LCS request(s).
In either case, if allowed by the QoS requirements and privacy settings, the
entity may combine the concurrent location requests by fully executing one of
the requests and using the ensuing location estimate result(s) to satisfy the
other request(s) without fully executing the latter. When concurrent location
requests are supported, each entity needs to ensure it correlates each
location/position response with the associated request and different
concurrent location requests shall be treated separately without any
dependency on one another by any entity.
NOTE 1: Combining of location requests is not allowed for a deferred 5GC-MT-LR
for periodic or triggered location for privacy reasons (e.g. a target UE would
not be aware that location event reports were being sent to multiple AFs
and/or external LCS clients).
NOTE 2: An entity (e.g. AMF, GMLC, NEF) may cache location information
obtained for one location request and use this information to support later
location requests for \"current or last known location\". This is not
considered to be a case of concurrent location requests.
If the entity, either itself or in association with another entity, cannot
support concurrent location requests or it can only support up to a certain
number of concurrent location requests, it can reject or defer a new
concurrent request or cancel one or more existing requests. For Case B, it can
also allow the new location request to proceed concurrently with and
separately from the previous requests.
LCS Client/AF priority and any other relevant priority information (e.g. UE
subscription preferences) should be considered when rejecting or deferring a
concurrent request or when cancelling one or more existing requests. In
particular, location requests associated with emergency services or lawful
interception clients should be given priority over other location requests.
### 5.7.2 Combining location requests by an H-GMLC or NEF
An H-GMLC or NEF may combine concurrent location requests (e.g. 5GC-MT LR,
5GC-MO LR, 5GC-NI LR) for the same target UE by executing only one request and
using the ensuing location estimate result(s) to satisfy the other request(s).
The conditions for this are as follows:
\- the H-GMLC must be able to fully resolve privacy requirements for the other
location request(s) without requiring notification or verification by the UE
(though notification only as in steps 17-23 of clause 6.1.2 could still be
used in the case of location dependent privacy); and
\- the QoS for the other request(s) should be less strict than the QoS for the
executed location request.
An H-GMLC may also combine concurrent location requests in the case of a bulk
location request for a group of UEs as described in clause 6.8. In this case,
location information for any UE in the group may be obtained from location
information obtained from another concurrent location request for the same UE.
### 5.7.3 Combining location requests by a V-GMLC
A V GMLC may combine concurrent 5GC-MT LR and 5GC-MO-LR related location
requests for the same target UE provided it is clear and unambiguous for any
5GC-MT LR that will not be fully executed (e.g. from the contents of any
location request received from the H GMLC) that no outstanding privacy related
actions are required for the UE (e.g. no privacy notification and/or privacy
verification interaction with the UE). QoS requirements must also be satisfied
for the non-executed location requests.
### 5.7.4 Combining location requests by an AMF
An AMF may combine concurrent 5GC-MT LR, 5GC-MO LR and 5GC-NI LR location
requests once any needed privacy related actions (e.g. UE notification and
verification) have been performed for each 5GC-MT LR. (i.e. AMF may decide to
not execute multiple positioning procedures for the concurrent location
requests) QoS requirements must also be satisfied for the non-executed
location requests.
### 5.7.5 Combining location requests by an LMF
An LMF may combine concurrent location requests for the same target UE
provided QoS requirements can be satisfied for the non-executed location
requests.
### 5.7.6 Combining location requests by a UE
A UE may combine concurrent location requests provided QoS requirements can be
satisfied and provided any positioning procedures with an LMF remain supported
according to the positioning protocol.
## 5.8 Interworking with the IMS
When the location service request is initiated by the LCS Client / AF for the
location estimation of a target UE in an IMS session, a SIP-URI or a TEL-URL
maybe included in the request to identify the target UE. In that case, the
H-GMLC of the UE shall be able to convert the SIP-URI/TEL-URL into SUPI of the
target UE.
NOTE 1: The H-GMLC may query IMS-HSS or UDM to retrieve the SUPI of the target
UE based on its SIP-URI/TEL-URL.
NOTE 2: If multiple SUPIs are resolved for the SIP-URI/TEL-URL, the H-GMLC
behaviour is out of scope of this specification.
## 5.9 Location Service involving Mobile Base Station Relay
### 5.9.1 General
A MBSR (i.e. mobile IAB-node) may have location service capability as
specified in TS 38.305 [9] and participate in the location service of a UE. As
the MBSR may be moving, the location service procedures need to be enhanced as
following for an accurate estimation of the UE positioning:
\- The UE reports the cell IDs of all the cells the UE performed DL
positioning measurements on.
\- The MBSR which performed the location service procedures for the UE
includes it\'s cell ID in the reported UL positioning measurement.
\- The AMF serving the UE provides the cell ID of serving cell of the UE and
indicates, if possible, that the cell-ID belongs to a MBSR to the LMF in the
location request. The AMF serving the UE also provides LMF with the additional
ULI Information received from NG-RAN, so that the LMF can initiate the
positioning procedure to obtain the location information of the MBSR.
\- Additionally, the LMF uses the reported cell IDs to derive whether the cell
ID(s) corresponds to a MBSR. There can be multiple MBSR cells in the
measurement report.
\- The LMF may also decide whether the cell ID(s) corresponds to MBSR(s) based
on information received in a TRP information exchange i.e. that the cell-ID
belongs to a MBSR and the UE-ID (GPSI) associated with MBSR.
\- To aid the LMF to improve the accuracy of the UE location estimation, the
MBSR velocity information and time of obtaining its location measurement data
should be obtained by the LMF when available. The LMF uses the received
location and velocity of the MBSR(s) when estimating the location of the
Target UE.
### 5.9.2 Obtaining location information for the MBSR
There are multiple options for an LMF to obtain the location information and
velocity of the MBSR(s):
\- The LMF can derive the location and velocity of the MBSR by triggering the
gNB serving the MBSR using NRPPa or by requesting the GMLC to derive the
location of the MBSR (UE) using the UE-ID of the MBSR. The GMLC triggers MT-LR
procedure as specified in clause 6.11.1 or 6.11.2.
\- As the timing of the location estimations for the Target UE and MBSR(s) is
important for the quality of the location estimation of the Target UE, the LMF
needs to reduce the timing offset of the positioning measurements, i.e. the
positioning of the Target UE and MBSR can be scheduled with using the same
scheduled location time and compensate for the potential time difference of
the positioning measurements, e.g. taking velocity of MBSR into account.
### 5.9.3 Privacy check for MBSR
If the positioning of the MBSR is performed for the location estimation of a
Target UE (UE different from the MBSR), the privacy check in clause 5.4 is
skipped for the MBSR. When the LMF requests the GMLC to derive the location of
the MBSR (UE), the LMF includes a MBSR indication indicating the location of
MBSR is requested to determine the location of a Target UE in the location
request. The GMLC obtains the subscription information of the MBSR (UE) from
the UDM. Based on the indication, and/or MBSR\'s subscription information, the
GMLC skips the privacy check.
If the positioning of the MBSR is performed for the location estimation of the
MBSR itself when it acts as a normal UE which is not authorized to operate as
MBSR based on the subscription information, the UE privacy check procedure in
clause 5.4 is performed.
## 5.10 Support of Positioning over user plane connection between UE and LMF
for non-regulatory service
LMF and UE may utilize a user plane connection to transfer supplementary
services messages and LPP messages.
If LMF decides to use user plane the LMF should indicate the UE to use user
plane for positioning with the information to establish a secure connection,
and via this secure connection, position messages can be transferred between
UE and the LMF. The URSP defined in TS 23.503 [41] is used by UE to determine
how to route the position messages. The operator may provide LMF(s) address
information and connection capability for LCS use in traffic descriptors and
LCS user plane positioning dedicated PDU session parameters (e.g., DNN and
S-NSSAI) in Route Selection Descriptors to the UE as part of the URSP rule.
The position messages can be routed to an established PDU Session or can
trigger the establishment of a new PDU Session. The LMF and UE may maintain
the established user plane connection and the established user plane
connection may be reused for subsequent user plane position messages
transmission trigged by UE or LMF. If the LMF detects the user plane
connection is not used for an implementation specific time, the LMF terminates
the user plane connection.
NOTE: In this Release, the user plane connection between UE and LMF can not be
used for regulatory positioning service.
## 5.11 Collection of GNSS assistance data
LMF may collect GNSS assistance data by reusing Data Collection from AF as
described in clause 5.20a of TS 23.501 [18] and Naf_EventExposure service
described in clause 5.2.19.2 of TS 23.502 [19]. The collection may be
performed on a periodic basis.
LMF generates a mapping table of GNSS assistant data and applicable area (e.g.
TA lists). LMF may generate multiple sets of GNSS assistance data for the same
location area, and each of them corresponds to a certain location accuracy.
The accuracy of GNSS assistance data may vary for different areas.
NOTE 1: The multiple accuracy level of GNSS assistance data can be the reason
the collection method, and /or calculation method.
After the collection, LMF may send the collected GNSS assistance data to UEs
via the procedures described in clause 6.14.1 (Broadcast of Assistance Data by
an LMF) or clause 6.11.1 (UE Assisted and UE Based Positioning Procedure)
during a positioning session.
In the case of using Broadcast of Assistance Data by an LMF, the LMF may
provision one or more of GNSS assistance data to RAN. LMF may also provision
one or more cyphered key(s) to UE from the AMF, and each cyphered key
corresponds to a certain GNSS assistance data.
## 5.12 UE Unaware Positioning
UE Unaware Positioning applies to the regulatory location service. When UE
Unaware Positioning is required by LCS Client/AF, if the UE is in CM_IDLE or
RRC_INACTIVE state, the UE cannot be paged during the positioning procedure.
In this case, the 5GC provides the latest stored UE location information to
the LCS Client/AF if the requested LCS QoS can be achieved. If the UE is in
CM_CONNECTED state, the LMF selects Uplink Positioning method to obtain UE
location.
## 5.13 Support of location service in PNI-NPN with signalling optimisation
Support of location service in PNI-NPN is based on the PNI-NPN description
defined in clause 5.30.3 of TS 23.501 [18]. PNI-NPN architecture described in
Annex C are supported.
Under the PNI-NPN architecture described in Annex C, the relevant Network
Functions in local network are defined as follows:
\- Local AMF, an AMF type function deployed in the local network, it supports:
\- Functionalities related to AMF service operation \"NonUeN2MessageTransfer\"
within Namf_Communication service, defined in TS 29.518 [16].
\- Handling \"UL and DL NON UE ASSOCIATED NRPPA TRANSPORT\", defined in TS
38.413 [38].
NOTE 1: Local AMF can support other functionalities defined in TS 23.501 [18].
NOTE 2: It is assumed only one local AMF is deployed in the local network.
\- LMF, deployed in the local network, it supports:
\- Pre-configured with local AMF FQDN or communication address.
\- For DL UE associated NRPPa signalling, sends the signaling message to the
serving AMF.
\- For DL NON UE associated NRPPa signalling, sends the signaling message to
the local AMF.
\- NG-RAN, deployed in the local network, it supports:
\- Pre-configured with local AMF FQDN or communication address.
\- Establishes TNL association with local AMF.
\- For UL UE associated NRPPa signalling, sends the signalling message to the
serving AMF
\- For UL NON UE associated NRPPa signalling, sends the signalling message to
the local AMF
\- GMLC, deployed in the local network.
\- UDM, deployed in public network, it supports:
\- Pre-configured with UE\'s allowed local network list.
\- Verify the GMLC request from a different network domain, by checking
whether the local network of GMLC is on the UE\'s allowed local network list.
For Nudm_SDM_Get request or Nudm_UECM_Get request from local network, sends
the UE data (i.e. privacy setting of UE, current serving AMF address, SUPI)
after verification.
When UE access the NG-RAN in the local network, during the registration
procedure or service request procedure, NG-RAN selects the serving AMF in the
public network. With appropriate configuration, local AMF cannot be selected
as the serving AMF for the UE.
During the positioning procedure, if LMF determines network assisted
positioning method, the positioning procedure defined in clause 6.11.2 is used
and the AMF is the serving AMF. If the LMF determines to obtain Non-UE
Associated Network Assistance Data, the positioning procedure defined in
clause 6.11.3 is used and the AMF is the local AMF.
For MO-LR, immediate MT-LR and deferred MT-LR, the AMF provides the GMLC
contact address and a reference number to LMF. When LMF determines UE
location, LMF provides the UE location to GMLC directly, as defined in clause
6.3.1.
NOTE 3: LMF should not determine to use E-CID positioning method for location
service in PNI-NPN.
## 5.14 Event Report Allowed Area
During the deferred 5GC-MT-LR procedure, when the UE detects the triggered or
periodic event happens, if it is inside the event report allowed area, the UE
is allowed to generate and send the event report to network to reduce UE power
consumption.
The event report allowed area is a list of cell(s) or TA(s) determined by GMLC
based on the event report expected area provided by UE which is a geographical
area and is sent to the UE during the deferred 5GC-MT-LR procedure.
The event report allowed area applies to the Area, Periodic Location and
Motion event types. When the UE decides to send an event report (i.e. the
event is detected or the maximum reporting time is expired), if the UE is
inside the event report allowed area, the UE sends the event report. If the
event report is not received from the UE for an implementation dependent time
period, the AF or LCS Client or GMLC cancels the deferred 5GC-MT-LR procedure
for periodic, or triggered location events.
NOTE: The UE can only send event report when the UE is inside of event report
allowed area.
The event report allowed area can also be used differently if an area usage
indication is provided together with the power saving area by the UE. A
reporting indication that is determined by GMLC based on the area usage
indication means when the UE detects the triggered or periodic event happens,
if it is outside the event report allowed area, the UE is allowed to generate
and send the event report to network to reduce UE power consumption.
## 5.15 Support of Low Power and High Accuracy Positioning
Service requirements for low power and high accuracy positioning (LPHAP) is
defined in TS 22.261 [3] and TS 22.104 [39]. Support of low power and high
accuracy positioning is optional in this release of specification.
Low power and high accuracy positioning is supported via subscription and in
the LCS related subscriber data in the UDM, an LPHAP indication may be
included.
During the positioning procedure, AMF provides the LPHAP indication to the
LMF. The LPHAP indication is either obtained from the GMLC, or stored in the
UE LCS context received during UE registration procedure.
If LMF receives from AMF of the LPHAP indication in the location request, LMF
determines appropriate positioning method, e.g. network-based positioning
method, or may determine to trigger the low power periodic and triggered 5GC-
MT-LR procedures in clause 6.7 by taking into account the LPHAP indication. In
addition, LMF also sends LPHAP indication to RAN in the positioning procedure,
as defined in clause 6.11.2.
## 5.16 Location services assisted by NWDAF
LMF and AMF may utilize analytics from NWDAF to assist with location services
as described in clause 6.21.
NWDAF may provide Location Accuracy analytics as specified in clause 6.17 of
TS 23.288 [37] to LMF. When LMF receives analytics for Location Accuracy from
the NWDAF, it may use the analytics to determine indoor or outdoor for a
location estimate, to select or adjust appropriate positioning methods for the
requested location accuracy.
NWDAF may provide UE related mobility analytics as specified in clause 6.7 of
TS 23.288 [37] to AMF. The UE location information received in analytics can
be used by AMF to perform the UE location verification for NR satellite
access.
## 5.16A Network data analytics assisted by LCS
NWDAF may interact with the LCS system to request location information for a
target UE or a group of UEs via Ngmlc services or NL9.
NWDAF may request an aggregated report for a single UE from GMLC to include
multiple UE location estimates for a period of time. NWDAF may also provide a
reporting time to indicate the latest time for reporting.
NOTE: The value of the reporting time is left for NWDAF implementation. The
reporting time should be earlier than the parameter \'time when analytics
information is needed\' (if applicable) defined in TS 23.288 [37].
## 5.16B LCS Continuity During UE Mobility
LCS session continuity during UE mobility applies to:
\- deferred triggered/periodic MT-LR, immediate MT-LR and MO-LR procedures.
\- uplink, downlink or uplink and downlink positioning methods.
### 5.16B.1 Mobility Between 5GS and EPS
LCS continuity of UE in RRC-CONNECTED state enables transfer of a location
session between 5GS and EPS. The LCS QoS may then be mapped from the source
RAT to the target RAT.
The Lr\' interface between the EPC-GMLC and 5GC-GMLC is implementation
specific - or the EPC-GMLC and 5GC-GMLC may be co-located.
## 5.17 Support of Ranging and Sidelink Positioning
Ranging and Sidelink Positioning as defined in TS 23.586 [40] is supported.
The following procedures have been specified to support the Network Assisted
Sidelink Positioning:
\- SL-MT-LR involving LMF as defined in clause 6.18;
\- SL-MO-LR involving LMF as defined in clause 6.19.
Editor\'s note: This clause will be updated with full list of procedures for
Ranging/SL Positioning support by stage 2 freeze deadline.
# 6 Location Service Procedures
## 6.1 5GC-MT-LR Procedure
### 6.1.1 5GC-MT-LR procedure for the regulatory location service
Figure 6.1.1-1 illustrates the general network positioning for the LCS clients
external to the PLMN for the regulatory location service for non-roaming
scenario. In this scenario, it is assumed that the target UE is identified
using an SUPI or GPSI.
This procedure is applicable to a request from an LCS client for a current
location of the target UE, and it is assumed that the LCS client is authorised
to use the location service and no privacy verification is required.
Figure 6.1.1-1: 5GC-MT-LR procedure for the regulatory location service
1\. The external location services client sends a request to the GMLC for a
location for the target UE identified by an GPSI or an SUPI. The request may
include the required QoS, UE unaware indication and Supported GAD shapes. If
location is required for more than one UE, the steps following below may be
repeated and in that case the GMLC shall verify whether the number of Target
UEs in the LCS request is equal to or less than the Maximum Target UE Number
of the LCS client. If Maximum Target UE Number is exceeded, the GMLC shall
reject the LCS request, the step 2-10 are skipped, and then GMLC respond to
the client with proper error cause in the step 11.
2\. The GMLC invokes a Nudm_UECM_Get service operation towards the home UDM of
the target UE to be located with the GPSI or SUPI of this UE.
3\. The UDM returns the network addresses of the current serving AMF.
NOTE: For backward compatibility, the GMLC can use a Nudm_SDM_Get service
operation to retrieve the SUPI of the target UE from a Rel-15 UDM as defined
in clause 5.2.3.3.2 of TS 23.502 [19].
4\. The GMLC invokes the Namf_Location_ProvidePositioningInfo service
operation towards the AMF to request the current location of the UE. The
service operation includes the SUPI, and client type and may include the
required QoS, UE unaware indication and Supported GAD shapes.
5\. If the UE is in CM IDLE state and UE unaware indication is not included,
the AMF initiates a network triggered Service Request procedure as defined in
clause 4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the
UE.
If UE unaware indication is received by AMF, and the UE is in CM_IDLE state or
in RRC_INACTIVE state (if known by AMF by requesting the NG-RAN to report RRC
state information), the steps 6 - 9 are skipped.
6\. The AMF selects an LMF based on the available information as defined in
clause 5.1 or based on AMF local configuration. The LMF selection takes the
5G-AN currently serving the UE into account. The selection may use a NRF
query.
7\. The AMF invokes the Nlmf_Location_DetermineLocation service operation
towards the LMF to request the current location of the UE. The service
operation includes a LCS Correlation identifier, the serving cell identity of
the Primary Cell in the Master RAN node and the Primary Cell in the Secondary
RAN node when available based on Dual Connectivity scenarios, and the client
type and may include an indication if UE supports LPP, the required QoS, UE
Positioning Capability if available, UE unaware indication and Supported GAD
shapes. If any of the procedures in clause 6.11.1 or clause 6.11.2 are used
the service operation includes the AMF identity.
8\. The LMF performs one or more of the positioning procedures described in
clauses 6.11.1, 6.11.2 and 6.11.3. During this step the LMF may use the
Namf_Communication_N1N2MessageTransfer service operation to request the
transfer of a Positioning related N1 message to the UE or the transfer of a
Network Positioning message to the serving NG-RAN node (gNB or NG-eNB) for the
UE. The LMF shall determine a geographical location and optionally a location
in local coordinates.
If UE unaware indication is received from AMF in step 7, the LMF selects
Uplink Positioning method to obtain UE location and performs the positioning
procedure described in clause 6.11.2.
9\. The LMF returns the Nlmf_Location_DetermineLocation Response towards the
AMF to return the current location of the UE and UE Positioning Capability if
the UE Positioning Capability is received in step 8 including an indication
that the capabilities are non-variable and not received from AMF in step 7.
The service operation includes the LCS Correlation identifier, the location
estimate, its age and accuracy and may include information about the
positioning method and the timestamp of the location estimate.
If UE unaware indication is received from AMF in step 7 and the NG-RAN rejects
the Network Positioning message as described in clause 6.11.2 with appropriate
rejection cause (e.g. UE cannot be paged) in step 8, the LMF rejects the
Nlmf_Location_DetermineLocation Request with appropriate rejection cause (e.g.
UE cannot be paged).
10\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the GMLC/LRF to return the current location of the UE. The service operation
includes the location estimate, its age and accuracy and may include
information about the positioning method and the timestamp of the location
estimate. The AMF stores the UE Positioning Capability in UE context when
received from LMF.
If the AMF decides to skip steps 5 - 9 in step 5 based on the UE unaware
indication and the UE state or the LMF rejects the
Nlmf_Location_DetermineLocation Request with appropriate rejection cause (e.g.
UE cannot be paged), the AMF may convert any last known location in the form
of a cell ID or TAI into geographical information based on TS 23.032 [8] and
as defined in clause 6.2.6.2.5 of TS 29.518 [16] and clauses 5.4.4.7, 5.4.4.8
and 5.4.4.9 of TS 29.571 [33] and answer to the GMLC with the geographical
information together with the age of this location.
11\. The GMLC sends the location service response to the external location
services client.
### 6.1.2 5GC-MT-LR Procedure for the commercial location service
Figure 6.1.2-1 illustrates the general network positioning requested by the
LCS clients, the AF or the NF (e.g. NWDAF). In this scenario, it is assumed
that the target UE may be identified using an SUPI or GPSI. This procedure is
applicable to a request from an LCS client, an NF or an AF for a current
location of the target UE, and it is assumed that
\- Privacy verification may be required for the location service request;
\- The LCS client, or the AF or NF needs to be authorised to use the location
service.
Figure 6.1.2-1: 5GC-MT-LR Procedure for the commercial location services
1\. The LCS Client, the NF or the AF (via NEF) sends a request to the (H)GMLC
for a location and optionally a velocity for the target UE which may be
identified by an GPSI or an SUPI. The request may include the required QoS,
supported GAD shapes and other attributes. (H)GMLC (for 1a, 1c) or NEF (for
1b) authorizes the LCS Client, the NF or the AF for the usage of the LCS
service. If the authorization fails, step 2-23 are skipped and (H)GMLC (for
1a, 1c) or NEF (for 1b) responds to the LCS Client, the NF or the AF the
failure of the service authorization in step 24. In some cases, the (H)GMLC
derives the GPSI or SUPI of the target UE and possibly the QoS from either
subscription data or other data supplied by the LCS Client, the NF or the AF.
The LCS request may carry also the Service Identity (see TS 22.071 [2]) and
the Codeword and the service coverage information. The (H)GMLC may verify that
the Service Identity received in the LCS request matches one of the service
identities allowed for the LCS client or AF. If the service identity does not
match one of the service identities for the LCS client or AF, the (H)GMLC
shall reject the LCS request. Otherwise, the (H)GMLC can map the received
service identity in a corresponding service type.
The LCS service request may include a scheduled location time if a current
location of the UE is required at a specific time in the future.
The LCS service request may include integrity requirements including Time-to-
Alert (TTA), Target Integrity Risk (TIR) and Alert Limit(AL). Definitions of
these parameters are specified in TS 38.305 [9].
NOTE 1: In this release of specification, integrity requirements are only for
GNSS integrity.
If the LCS service request contains the pseudonym of the target UE and the
(H)GMLC cannot resolve the PMD address from the pseudonym, the (H)GMLC itself
determines the verinym (GPSI or SUPI) of the target UE. If the (H)GMLC can
resolve the address of PMD from the pseudonym, the HGMLC requests the verinym
from its associated PMD. If (H)GMLC is not able to obtain the verinym of the
target UE, the (H)GMLC shall cancel the location request.
If a scheduled location time is not included and the requested type of
location is \"current or last known location\" and the requested maximum age
of location information is available, the (H)GMLC verifies whether it stores
the previously obtained location estimate of the target UE. If the HGMLC
stores the location estimate and timestamp of the location estimate (if
available) and the location estimate satisfies the requested accuracy and the
requested maximum age of location, the (H)GMLC checks the result of the
privacy check at step 2. If the result of the privacy check for call/session
unrelated class is \"Location allowed without notification\" then steps 3-23
may be skipped.
1b-1 AF sends the Nnef_EventExposure_Subscribe to the NEF.
1b-2 The NEF identifies based on the QoS attribute received from the location
request that higher than cell-ID level location accuracy is required and
invokes the Ngmlc_Location_ProvideLocation_Request service operation to the
(H)GMLC, which contains the attributes received from the AF request. The NEF
may also invoke the Ngmlc_Location_ProvideLocation_Request service operation
to the (H)GMLC for lower than cell-ID location accuracy as an implementation
option or if a scheduled location time is included.
1c. The NF (e.g. NWDAF) invokes the Ngmlc_Location_ProvideLocation service
operation to the (H)GMLC.
If location is required for more than one UE, the steps following below may be
repeated and in that case the NEF or HGMLC receiving location request, shall
verify whether the number of Target UEs in the Nnef_EventExposure_Subscribe,
Ngmlc_Location_ProvideLocation or LCS request is equal to or less than the
Maximum Target UE Number of the LCS client. If Maximum Target UE Number is
exceeded, the NEF or HGMLC shall reject the Nnef_EventExposure_Subscribe,
Ngmlc_Location_ProviceLocation or LCS request, the steps 2-23 are skipped, and
then GMLC respond to the client with proper error cause in the step 24.
NOTE 2: If cell-ID level or lower than cell-ID level location accuracy is
required in the location request, the NEF may invoke an
Namf_EventExposure_Subscribe service operation to subscribe location event
reporting from the AMF for the target UE as further described in clause 6.5.
2\. The (H)GMLC invokes a Nudm_SDM_Get service operation towards the UDM of
the target UE to get the privacy settings of the UE identified by its GPSI or
SUPI. The UDM returns the target UE Privacy setting of the UE. The (H)GMLC
checks the UE LCS privacy profile. If the target UE is not allowed to be
located, steps 3-23 are skipped. The UDM may also reply (H)GMLC with an LPHAP
indication, if stored in the UE LCS subscriber data.
3\. The (H)GMLC invokes a Nudm_UECM_Get service operation towards the UDM of
the target UE with GPSI or SUPI of this UE. The UDM returns the network
addresses of the current serving AMF and additionally the address of a VGMLC
(for roaming case). If the location request is an immediate location request,
the (H)GMLC checks the country codes of the serving node addresses. If the
(H)GMLC finds the current AMF is out of the service coverage of the (H)GMLC,
the (H)GMLC returns an appropriate error message to the LCS client, the NF or
the AF (via NEF).
GMLC may determine the LMF ID based on the LCS data for an LCS Client/AF. In
case a group ID is provided or derived from the location request, GMLC
determines the LMF ID based on the provisioned Group ID.
GMLC may be configured with an LMF ID, irrelevant to any LCS client/AF. When
the GMLC receives a MT location request from LCS client/AF, GMLC determines
the LMF ID for all LCS client/AF.
NOTE 3: The UDM is aware of the serving AMF address at UE registration on an
AMF as defined in clause 4.2.2.2.2 of TS 23.502 [19]. The UDM is aware of a
serving VGMLC address at UE registration on an AMF as defined in clause
4.2.2.2.2 of TS 23.502 [19].
NOTE 4: The HGMLC can also query the HSS of the target UE for a serving MME
address as described in clause 9.1.1 of TS 23.271 [4]. The EPC-MT-LR procedure
described in clause 9.1.15 of TS 23.271 [4], excluding the UE availability
event, may then be performed instead of steps 4-23, e.g. if the HSS returns an
MME address but the UDM does not return an AMF address.
4\. For a non-roaming case, this step is skipped. In the case of roaming, the
HGMLC may receive an address of a VGMLC (together with the network address of
the current serving AMF) from the UDM in step 3, otherwise, the HGMLC may use
the NRF service in the HPLMN to select an available VGMLC in the VPLMN, based
on the VPLMN identification contained in the AMF address received in step 3.
The HGMLC then sends the location request to the VGMLC by invoking the
Ngmlc_Location_ProvideLocation service operation towards the VGMLC. In the
cases when the HGMLC did not receive the address of the VGMLC, or when the
VGMLC address is the same as the HGMLC address, or when both PLMN operators
agree, the HGMLC sends the location service request message to the serving
AMF. In this case, step 4 is skipped. If the result of privacy check indicates
that the verification based on current location is needed, the HGMLC shall
send a location request to the VGMLC (in the case of roaming) or to the AMF
(in the case of non-roaming) indicating \"positioning allowed without
notification\" and VGMLC shall invoke an Namf_Location_ProvidePositioningInfo
Request service operation towards the AMF at step 5. H-GMLC also provides the
LCS client type of AF, if received in step 41bâ€‘2, or LCS client type of LCS
client and other attributes to be sent to AMF in step 5.
5\. In the case of roaming, the VGMLC first authorizes that the location
request is allowed from this HGMLC, PLMN or from this country. If not, an
error response is returned. The (H)GMLC or VGMLC invokes the
Namf_Location_ProvidePositioningInfo service operation towards the AMF to
request the current location of the UE. The service operation includes the
SUPI, the client type and may include the required LCS QoS, supported GAD
shapes, scheduled location time, service type and other attributes as received
or determined in step 1. If received in step 2, the (H)GMLC or VGMLC provides
the LPHAP indication to the AMF.
To support location service in PNI-NPN with signalling optimisation, the
H-GMLC also includes a contact address (Notification Target Address, e.g. a
URI) and a Notification Correlation ID, which is used by LMF to provide
location determination to H-GMLC directly.
NOTE 5: The location request forwarded at step 4 and step 5 may also carry the
result of the privacy check in step 2 which may include a codeword provided by
the LCS Client or AF and an indication of a privacy related action as
described in clause 5.4.
6\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
If signalling connection establishment fails, step 7-13 are skipped and the
AMF answers to the GMLC in step 14 with the last known location of the UE
(i.e. Cell ID) together with the age of this location.
7\. If the indicator of privacy check related action indicates that the UE
must either be notified or notified with privacy verification and if the UE
supports LCS notification (according to the UE capability information), a
notification invoke message is sent to the target UE, indicating the identity
of the LCS client and the , service type (if that is both supported and
available) and whether privacy verification is required.
8\. The target UE notifies the UE user of the location request and, if privacy
verification was requested, waits for the user to grant or withhold
permission. The UE then returns a notification result to the AMF indicating,
if privacy verification was requested, whether permission is granted or denied
for the current LCS request. If the UE user does not respond after a
predetermined time period, the AMF shall infer a \"no response\" condition.
The AMF shall return an error response in step 14 and if roaming VGMLC in step
15 to the HGMLC if privacy verification was requested and either the UE user
denies permission or there is no response with the indication received from
the (H)GMLC indicating barring of the location request and steps 10\~13 are
skipped.
The notification result may also indicate the Location Privacy Indication
setting for subsequent LCS requests; i.e whether subsequent LCS requests, if
generated, will be allowed or disallowed by the UE. The Location Privacy
Indication may also indicate a time for disallowing the subsequent LCS
requests.
9\. The AMF invokes the Nudm_ParameterProvision_Update (LCS privacy) service
operation to store in the UDM the Location Privacy Indication information
received from the UE. The UDM may then store the updated UE privacy setting
information into the UDR as the \"LCS privacy\" Data Subset of the
Subscription Data.
10-13. Step 10-13 are the same as steps 6-9 defined in clause 6.1.1 with the
addition that LMF can also perform 6.11.4 as positioning procedure and service
type may be indicated towards the LMF and the exception that the LMF may
determine the UE location in local coordinates or geographical co-ordinates or
both. If the supported GAD shapes is not received in step 11 or Local Co-
ordinates is not included in the supported GAD shapes, the LMF shall determine
a geographical location. If a scheduled location time is provided at step 5,
steps 11 and 12 include the following additional differences.
11\. The AMF includes the scheduled location time in the
Nlmf_Location_DetermineLocation service operation sent towards the LMF. If
received in step 5, the AMF provides the LPHAP indication to the LMF.
If H-GMLC contact address is received in step 5, AMF also includes the H-GMLC
contact address and the Notification Correlation ID in the
Nlmf_Location_DetermineLocation service operation and sends towards the LMF.
12\. If received in step 11 of the LPHAP indication, the LMF may determine an
appropriate positioning method by taking into account the LPHAP indication.
When sending a location request to the UE, the LMF may include the scheduled
location time.
NOTE 6: If integrity requirements are received in step 11, LMF may determine
to use GNSS positioning method.
NOTE 7: LMF does not deliver the scheduled location time to NG-RAN as part of
step 12.
NOTE 8: The LMF may send a location request to the UE at step 12 containing
the scheduled location time sometime before the scheduled location time to
allow the UE to enter CM Connected state shortly before the scheduled location
time.
If H-GMLC contact address and the Notification Correlation ID is received in
step 11, the LMF responds to AMF in the Nlmf_location_determineLocation
Response to indicate that the location determination will be sent directly to
GMLC. In this case, the LMF determines to use local AMF for obtaining Non-UE
Associated Network Assistance Data, as described in clause 6.11.3.
When LMF determines the UE location, it executes the step 28 as described in
clause 6.3.1.
14\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the (V)GMLC (or HGMLC for roaming when the NL3 reference point is not
supported) to return the current location of the UE. The service operation
includes the location estimate, its age and accuracy and may include
information about the positioning method and the timestamp of the location
estimate.
If indicated in step 13 that the location determination will be sent directly
to GMLC, AMF responds to GMLC with Namf_location_providePositioningInfo
Response to indicate that GMLC will receive the location from LMF directly.
15\. In the case of roaming, the VGMLC forwards the location estimation of the
target UE, its age, its accuracy and optionally the information about the
positioning method received at step 14 to the HGMLC. For non-roaming scenario,
this step is skipped.
16\. If the privacy check in step 2 indicates that further privacy checks are
needed, the (H)GMLC shall perform an additional privacy check in order to
decide whether the (H)GMLC can forward the location information to the LCS
client or AF or send a notification if the result of the privacy check
requires the notification and verification based on current location. One
example when this additional privacy check is needed is when the target UE
user has defined different privacy settings for different geographical
locations. When an additional privacy check is not needed, the (H)GMLC skips
steps 17-23.
17\. If the result of privacy checks in step 16 indicates that the
notification (and verification) based on current location is needed, and in
the case of roaming, the (H)GMLC shall send a location request to the VGMLC
with location type indicating \"notification only\".
18\. The (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo
service operation towards the AMF to request notification (and verification)
based on current location.
19\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
20\. If the indicator of privacy check related action indicates that the UE
must either be notified or notified with privacy verification and if the UE
supports LCS notification, the AMF sends a notification invoke message to the
target UE, indicating the identity of the LCS client and the service type (if
that is both supported and available) and whether privacy verification is
required.
21\. Step 21 is the same as step 8.
22\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the (V)GMLC (or HGMLC for roaming when the NL3 reference point is not
supported) with an indication of the result of notification and verification
procedure performed in steps 20-21.
23\. In the case of roaming, the VGMLC forwards an indication of the result of
notification and verification procedure to the HGMLC. For non-roaming
scenario, this step is skipped.
24\. The (H)GMLC sends the location service response to the LCS Client, the NF
or the AF (via the NEF) if the target UE is allowed to be located by the LCS
Client, the NF or the AF. Accordingly, NEF invokes Nnef_EventExposure_Notify
or sends Nnef_EventExposure_Subscribe Response to the AF. If the location
request from the LCS Client contained the pseudonym and the (H)GMLC resolved
the verinym from the pseudonym in step 1, the (H)GMLC shall use the pseudonym
of the target UE in the location response to the external LCS client. If the
external LCS client or AF requires it, the (H)GMLC may first transform the
universal location co-ordinates provided by the AMF into some local geographic
reference system. The (H)GMLC may record charging information both for the LCS
Client or AF and inter-network revenue charges from the AMF\'s network. The
location service response from the (H)GMLC to the LCS Client, the NF or the AF
may contain the information about the positioning method used and the
indication whether the obtained location estimate satisfies the requested
accuracy or not. If in step 2, step 15, step 16 or step 23 the (H)GMLC
identifies that the target UE is not allowed to be located by the LCS Client,
the NF or the AF, it rejects the LCS service request, and optionally indicate
in the response the reason of the rejection, i.e. the target UE is not allowed
to be located. If the LCS QoS Class is Assured and (H)GMLC detects that
requested accuracy is not achieved, the (H)GMLC sends error response including
failure cause.
### 6.1.3 5GC-MT-LR multiple location procedure for the regulatory location
service
Figure 6.1.3-1 illustrates an extension procedure of 5GC-MT-LR procedure for
the regulatory location service defined in clause 6.1.1.
This procedure is applicable for providing multiple location estimates of the
target UE to LCS client.
Figure 6.1.3-1: 5GC-MT-LR multiple location procedure for the regulatory
location service
1\. Steps 1-7 for 5GC-MT-LR procedure for the regulatory location service
clause 6.1.1 are performed with the following differences:
\- At step 1 in clause 6.1.1 the request from external location services
client may include acceptance of INTERMEDIATE response and maximum response
time.
\- At step 4 in clause 6.1.1 Namf_Location_ProvidePositioningInfo service
operation invoked by GMLC may include the acceptance of INTERMEDIATE response
and maximum response time, GMLC contact address and LIR reference number. The
LIR reference number is allocated by GMLC based on predefined rule.
\- At step 7 in clause 6.1.1 Nlmf_Location_DetermineLocation service operation
invoked by AMF may include additionally include acceptance of INTERMEDIATE
response and maximum response time, GMLC contact address, LIR reference number
for the INTERMEDIATE response. AMF can overwrite maximum response time to
avoid timeout.
2\. LMF performs positioning procedures and determines multiple location
estimates during the session.
2.1. This step is executed if the INTERMEDIATE result is available. The LMF
invokes an Nlmf_Location_EventNotify service operation towards GMLC and
provides the INTERMEDIATE location of the UE during the session and timestamp
of the location estimate, and LIR reference number, and INTERMEDIATE event
type.
2.2. This step is executed if step 2.1 was executed. The GMLC sends the
INTERMEDIATE location of the UE and timestamp of the location estimate to
external location services client.
3\. Based on step 9 in clause 6.1.1 the LMF returns the
Nlmf_Location_DetermineLocation Response towards the AMF to return the FINAL
location of the UE. LMF ensures that FINAL location will be transferred
towards AMF within the maximum response time.
4\. Steps 10-11 for 5GC-MT-LR procedure for the regulatory location service
clause 6.1.1 are performed with the following differences:
\- At step 11 the FINAL location is sent from GMLC to LCS client.
### 6.1.4 5GC-MT-LR procedure involving Mobile Base Station Relay
Figure 6.1.4-1 illustrates the network positioning for the LCS clients when
Mobile Base Station Relay(s) is involved.
In this scenario, it is assumed that the target UE may be identified using an
SUPI or GPSI. The procedure follows the functionality in clause 5.9 and the
5G-MT-LR procedures in clauses 6.1.1 and 6.1.2. It is further assumed that:
\- The NG-RAN in figure 6.1.4-1 is a donor-CU to the MBSR.
\- When the MBSR is integrated or fully migrated to a new gNB, the OAM
triggers the LMF to perform TRP Information Exchange procedure. The LMF learns
that a new integrated TRP at a gNB is mobile and its MBSR IAB UE ID (GPSI) via
a TRP information exchange towards the gNB with the Cell ID of the TRP. The
LMF may also performs NRPPa TRP information exchange procedure before the
positioning procedure for a target UE, e.g. to determine the position
capability of NG-RAN.
\- The LMF that performs the location estimation of the MBSR can be different
than the LMF that performs the location estimation of the target UE (not shown
in figure 6.1.4-1).
Figure 6.1.4-1: 5GC-MT-LR procedure involving Mobile Base Station Relay
1\. [Optional] The location services client sends a request to the GMLC for a
location for the target UE identified by an GPSI or an SUPI. The UE may or may
not be served by a MBSR.
2\. The GMLC invokes the Namf_Location_ProvidePositioningInfo service
operation towards the AMF serving the target UE to request the current
location of the target UE. The location procedure may be also triggered at the
AMF for a 5GC-NI-LR as at step 1 in clause 6.10.1, or an event report sent by
the UE for a deferred 5GC-MT-LR for periodic or triggered location as at step
25 in clause 6.3.1.
3\. The 5GC-MT-LR procedure as specified in clause 6.1.1 step 5-8 or clause
6.1.2 step 6-12 are performed with the difference that the LMF selection also
consider LMF capability supporting MBSR involvement. If the AMF is aware that
the target UE is served by a MBSR, it would select the LMF that can support
the MBSR handling.
NOTE 1: The step 4 to 11 may happen as part of step 3.
4\. LMF derives if any MBSR(s) is involved in the positioning of the target UE
based on the cell-ID used for positioning measurements in the step 3. The AMF
serving the target UE may indicate that the serving cell is an MBSR (if
applicable). When the MBSR was integrated as a TRP (IAB-DU) with a gNB, the
LMF may determine from in a TRP information exchange procedure that the cell-
ID belongs to the MBSR and/or the UE-ID (GPSI) associated with MBSR. The LMF,
when the OAM provides a new Cell Id to the LMF, performs a TRP information
exchange as specified in TS 38.455 [15] for the new Cell ID. When the MBSR is
integrated or fully migrated in the NG-RAN, the Cell ID(s) of the MBSR is
(are)provided to the LMF and, in the case of full migration, any stale Cell ID
of fully migrated MBSR is removed from LMF by OAM. If the LMF selects any cell
for UE positioning measurements, and the LMF determines it needs to perform a
TRP information exchange with the cell, it shall perform TRP Information
Exchange procedure as specified in TS 38.455 [15].As the MBSR can be mobile
the LMF may need to determine an updated location of the MBSR by either
performing step 5-7 (option 1) or performing step 8-10 (option 2) if option 1
is not feasible. If several MBSRs were derived, then step 5-7 or step 8-10 are
be performed for each MBSR.
NOTE 2: It is assumed that for the case of MBSR\'s inter CU mobility, the OAM
can timely update the Cell Id of the MBSR to the LMF so as to enable it to
perform a proper TRP information exchange. Until the Cell Id of the MBSR is
provided to LMF by OAM, the Cell of the MBSR is not used for location
procedures.
5\. [Conditional] The LMF initiates a NRPPa TRP Information Exchange procedure
to request the updated location information of the TRP(s) associated with
MBSR(s) by directing the TRP information exchange messages to the gNB
associated with the Cell ID(s), for example, by setting the NRPPa TRP
Information Type Item IE to \"geo-coordinates\". Donor-CU further send a F1
TRP INFORMATION REQUEST message to any MBSR IAB-DU.
6\. [Conditional] The MBSR IAB-UE initiates a 5GC-MO-LR procedure (as defined
in clause 6.2) to get its location information. The MBSR IAB-UE\'s location
info is used by the co-located MBSR IAB-DU to determine the updated location
for its TRP.
7\. [Conditional] The MBSR IAB-DU report its updated TRP location, e.g. TRP\'s
geo-coordinate, velocity and the time for obtaining them, to the Donor-CU,
which is further forwarded to LMF.
8\. [Conditional] The LMF invokes the Ngmlc_Location_ProvideLocation_Request
service operation to the GMLC by providing the identifier of MBSR IAB-UE and a
scheduled location time. The LMF determines the identifier of MBSR IAB-UE
based on the Cell ID of MBSR and the received the GPSI of the MBSR in a TRP
information exchange when the MBSR was integrated as a TRP. LMF may receive
the scheduled location time in step 3. Otherwise, LMF may generate the
scheduled location time, e.g. based on response time.
9\. [Conditional] The GMLC determines the AMF serving the MBSR and step 4-10
in clause 6.1.1 or steps 4-23 in clause 6.1.2 is performed. The privacy check
in clause 5.4 is skipped for the MBSR based on the subscription data of the
MBSR (IAB-UE). The scheduled location time received in step 8 is also provided
to the MBSR IAB-UE when sending a location request to the MBSR.
10\. [Conditional] The GMLC sends the location service response including the
MBSR IAB-UE\'s location to the LMF.
11\. [Conditional] The LMF performs one of the positioning procedures with the
target UE described in clauses 6.11.1 and 6.11.2. To reduce the timing offset
of the positioning measurements, the UE positioning may be scheduled with the
same scheduled location time as the MBSR positioning in step 9. LMF sends the
same time with the scheduled location time in step 8 to the target UE in
clause 6.11.1. If Network Assisted procedure is used, as in 6.11.2, the NG-RAN
may provide the MBSR updated location and velocity information and the time
obtained them to the LMF as part of the NRPPa procedure for the UE.
12\. The LMF uses the received location and velocity of the MBSR(s) when
estimating the location of the target UE together with the measurements
reports in step 3 or optionally the updated measurement reports in step 11.
13\. The LMF returns the Nlmf_Location_DetermineLocation Response towards the
AMF to return the current location of the target UE.
14\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the GMLC to return the current location of the target UE.
15\. The GMLC sends the location service response to the location services
client.
## 6.2 5GC-MO-LR Procedure
Figure 6.2-1 illustrates the general network positioning requested by the UE
to the serving PLMN for obtaining the location related information of itself
or just assistance data.
Figure 6.2-1: 5GC-MO-LR Procedure
1) If the UE is in CM-IDLE state, UE instigates the UE triggered Service
Request as defined in clause 4.2.3.2 of TS 23.502 [19] in order to establish a
signalling connection with the AMF.
2) The UE sends an MO-LR Request message included in a UL NAS TRANSPORT
message. The MO-LR Request may optionally include up to three LPP positioning
message(s). Different types of location services can be requested: location
estimate of the UE, location estimate of the UE to be sent to an LCS client or
AF, or location assistance data. If the UE is requesting its own location or
that its own location be sent to an LCS client or AF, this message carries LCS
requested QoS information (e.g. accuracy, response time, LCS QoS Class), the
requested maximum age of location, the requested type of location (e.g.
\"current location\", \"current or last known location\") and, optionally for
a current location, a scheduled location time. If the UE is requesting that
its location be sent to an LCS client, the message shall include the identity
of the LCS client or the AF, and may include the address of the GMLC through
which the LCS client or AF (via NEF) should be accessed. In addition, a
Service Type indicates which MO-LR service of the LCS Client is requested by
the UE may be included. The message also may include a pseudonym indicator to
indicate a pseudonym should be assigned by the network and transferred to the
LCS Client as the UE\'s identity. The message may also include integrity
requirements including Time-to-Alert (TTA), Target Integrity Risk (TIR) and
Alert Limit(AL). Definitions of these parameters are specified in TS 38.305
[9].
NOTE 1: In this release of specification, integrity requirements are only for
GNSS integrity.
If the UE is instead requesting location assistance data, the embedded LPP
message specifies the type of assistance data and the positioning method for
which the assistance data applies.
For an LCS 5GC-MO-LR requesting location transfer to an LCS Client or AF, the
AMF shall assign a GMLC address, i.e. VGMLC address, which is stored in the
AMF. If a VGMLC address is not available, the AMF may reject the location
request. The AMF verifies the subscription profile of the UE and decides if
the requested service is allowed or not by checking the Mobile Originated data
retrieved from UDM during the UE Registration Procedure, as defined in clause
4.2.2.2.2 of TS 23.502 [19].
If the requested type of location is \"current or last known location\" and
the requested maximum age of location information is available, the AMF
verifies whether it stores the previously obtained location estimate and
related timestamp (if available) of the target UE. If the AMF stores the
location estimate and the related timestamp (if available) and the location
estimate satisfies the requested accuracy and the requested maximum age of the
location, the AMF skips steps 3 - 6.
3) The AMF selects an LMF as described in clause 5.1. AMF may be configured
locally a mapping table of UE identity e.g. MSISDN and LMF address. When
receiving a MO-LR, AMF determines LMF based on local configuration or by
retrieving from UDM in the UE LCS subscriber data.
4) The AMF invokes the Nlmf_Location_DetermineLocation service operation
towards the LMF. The service operation includes an LCS Correlation identifier,
the serving cell identity, the client type, an indication whether a location
estimate, or location assistance data is requested, UE Positioning Capability
if available, a list of MO-LR subscribed assistance data and any embedded LPP
message(s) in the MO-LR Request. If the UE\'s location is requested, the
service request may include an indication if UE supports LPP, the requested
QoS, Supported GAD shapes and any scheduled location time. If location
assistance data is requested, the embedded LPP message(s) will convey the
requested types of location assistance data. If any of the procedures in
clause 6.11.1 or 6.11.2 are used the service operation includes the AMF
identity. Once an AMF has selected an LMF it must continue to use that LMF for
the duration of the session.
To support location service in PNI-NPN with signalling optimisation, the AMF
also includes a contact address (Notification Target Address, e.g. a URI) and
a Notification Correlation ID, which is used by LMF to provide location
determination to H-GMLC directly.
NOTE 2: If the UE is requesting its own location, AMF does not indicate
support of a GAD shape for local co-ordinates, see TS 23.032 [8].
5) If the UE is requesting its own location, the actions described in clause
6.11 are performed together with the actions described for step 12 in clause
6.1.2 if a scheduled location time is present. If the UE is instead requesting
location assistance data, the LMF transfers this data to the UE as described
in clause 6.11.1. The LMF determines the exact location assistance data to
transfer according to the type of data specified by the UE, the UE location
capabilities, the MO-LR subscribed assistance data and the current cell.
If H-GMLC contact address and the Notification Correlation ID is received in
step 11, and the LMF determines to use local AMF for obtaining Non-UE
Associated Network Assistance Data, as described in clause 6.11.3, the LMF
responds to AMF in the Nlmf_location_determineLocation Response to indicate
that the location determination will be sent directly to GMLC.
When LMF determines the UE location, it executes the step 28 as described in
clause 6.3.1.
NOTE 3: If integrity requirements are received in step 4, LMF may determine to
use GNSS positioning method.
6) When a location estimate best satisfying the requested QoS has been
obtained or when the requested location assistance data has been transferred
to the UE, the LMF returns the Nlmf_Location_DetermineLocation Response
towards the AMF. The service operation includes the LCS Correlation
identifier, the location estimate, if this was obtained, its age and accuracy
and may include information about the positioning method.
If a location estimate was not successfully obtained, or if the requested
location assistance data could not be transferred successfully to the UE, a
failure cause is included in the service operation.
The service operation may also include the UE Positioning Capability if the UE
Positioning Capability is received in step 5 including an indication that the
capabilities are non-variable and not received from AMF in step 4.
If the UE is requesting location assistance data, steps 7 to 12 are skipped.
7) If the location estimate was successfully obtained, the AMF invokes the
Ngmlc_Location_LocationUpdate service operation towards to the VGMLC assigned
in the step 2. The service operation carries the identity of the UE, the event
causing the location estimate (5GC-MO-LR) and the location estimate, its age,
obtained accuracy indication and the LCS QoS Class requested by the target UE.
In addition, the service operation may include the pseudonym indicator, the
identity of the LCS Client, AF ID, the GMLC address, the timestamp of the
location estimate and the Service Type specified by the UE, if available.
8) If the UE did not request transfer of its location to an LCS Client or AF
in step 2, steps 8 to 11 are skipped. If the VGMLC is same NF instance as
HGMLC this step is skipped. Otherwise VGMLC invokes the
Ngmlc_Location_LocationUpdate service operation towards to the HGMLC (the
VGMLC may query the NRF to obtain the address of the HGMLC) including the
information received from the AMF.
9a) If the pseudonym indicator is included in the MO-LR Location Information,
the HGMLC assigns a pseudonym to the UE. If the identified LCS Client is not
accessible by the HGMLC, step 9a and step 10a are skipped. Otherwise the GMLC
transfers the location information to the LCS client, carrying the identity or
the pseudonym of the UE, the event causing the location estimate (5GC-MOâ€‘LR),
the Service Identity, if available, and the location estimate, the timestamp
of the location estimate (if available) and its age, in accordance with the
LCS QoS Class requested by the target UE. If the UE requested LCS QoS class
was Assured, GMLC sends the result to the LCS client only if the result has
been indicated to fulfil the requested accuracy. If the UE requested LCS QoS
class was Best Effort, GMLC sends whatever result it received to the LCS
client with an appropriate indication if the requested accuracy was not met.
NOTE 4: The HGMLC maps any Service Type Identity received in step 8 into a
Service Identity.
9b-1) If the AF ID is included in step 1, the HGMLC assigns the NEF address
based on local configuration or via NRF and invokes
Ngmlc_Location_LocationUpdateNotify service request towards the NEF, carrying
the AF ID. The location information parameters sent within this service
operation are same as the step 9a except that no pseudonym is included.
9b-2) If the identified AF is not accessible by the NEF, step 9b-2 and step
10b-1 are skipped. Otherwise, the NEF transfer the location information to the
identified AF by invoking the Nnef_Location_LocationUpdateNotify service.
10a) If the LCS Client does not support MO-LR (for temporary or permanent
reasons) or cannot handle the location estimate of the UE, e.g. the LCS Client
does not know the Service Identity, or the UE does not register to the LCS
Client, the LCS Client has no corresponding data of the UE, the LCS Client
shall return the Location Information ack message to the HGMLC with a suitable
error cause. Otherwise, the LCS Client handles the location estimate according
to the Service Identity, sends the GMLC or the HGMLC the Location Information
ack message signalling that the location estimate of the UE has been handled
successfully.
10b-1) If the AF cannot handle the location estimate of the UE, e.g. the UE
does not register to the AF, the AF has no corresponding data of the UE, the
AF shall respond to the Nnef_Location_LocationUpdateNotify service request
with a suitable error cause. Otherwise, the AF handles the location estimate
according to the Service Identity and respond to the
Nnef_Location_LocationUpdateNotify service request indicating that the
location estimate of the UE has been handled successfully.
10b-2) The NEF sends a Ngmlc_Location_LocationUpdateNotify service response
towards the HGMLC with the outcome of the operation.
11) If the VGMLC is same NF instance as HGMLC this step is skipped. If the
identified LCS Client or AF is not accessible, the HGMLC sends a
Ngmlc_Location_LocationUpdate service response to VGMLC with an appropriate
error cause. Otherwise, the response shall include an acknowledgement. The
message shall specify whether the location estimate of the UE has been handled
successfully by the identified LCS Client or AF, and if not, the corresponding
error cause obtained in step 10. In addition, the HGMLC may record charging
information both for the UE and inter-working revenues charges.
12) If the VGMLC receives the MO-LR Location Information Acknowledgement from
the HGMLC, if the identified LCS Client or AF is not accessible, the VGMLC
sends a Ngmlc_Location_LocationUpdate service response to AMF with an
appropriate error cause. Otherwise, the response shall include an
acknowledgement. The message shall specify whether the location estimate of
the UE has been handled successfully by the identified LCS Client or AF, and
if not, the corresponding error cause obtained in step 9 or 10. In addition,
the VGMLC may record charging information both for the UE and inter-working
revenue charges.
If the VGMLC receives Ngmlc_Location_LocationUpdate Request from the AMF and
it is not required to send to any LCS Client or AF, the VGMLC may record
charging information for the UE and response the Ngmlc_Location_LocationUpdate
Request to the AMF.
13) The AMF sends an MO-LR Response message included in a DL NAS TRANSPORT
message. If the UE is requesting its own location, the response carries any
location estimate requested by the UE and the timestamp of the location
estimate (if available) including the indication received from LMF whether the
obtained location estimate satisfies the requested accuracy or not, or an
indicator whether a location estimate was successfully transferred to the
identified LCS client or AF. If the location estimate was successfully
transferred to the identified LCS Client or AF, the MO-LR Response message
shall specify whether the location estimate of the UE has been handled
successfully by the identified LCS Client or AF, and if not, the corresponding
error cause obtained in step 13. In addition, AMF may record charging
information.
## 6.3 Deferred 5GC-MT-LR Procedure for Periodic, Triggered and UE Available
Location Events
### 6.3.1 Initiation and Reporting of Location Events
Figure 6.3.1-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic, Triggered and UE Available
Location Events. The procedure supports mobility of a UE within a VPLMN 5GCN
and from a 5GCN to an EPC.
Figure 6.3.1-1: Deferred 5GC-MT-LR for periodic, triggered and UE available
location events
1\. The external location services client, the NF or the AF (via NEF) sends a
request to the (H)GMLC for location reporting for periodic, triggered or UE
available location events. The request is sent as described for step 1 in
clause 6.1.2 with the differences described here. The LCS Service Request
provides the type of periodic or triggered location reporting being requested
and associated parameters. For periodic location, the LCS Service Request
includes the time interval between successive location reports, the total
number of reports and may include location QoS. For periodic location
reporting, the LCS Service Request may include a scheduled location time for
the first periodic location report. For area event reporting, the LCS Service
Request includes details of the target geographical area, an indication to
have an additional check whether UE is located within the requested target
area, whether the event to be reported is the UE being inside, entering into
or leaving the target area, the duration of event reporting, the minimum and
maximum time intervals between successive event reports, the maximum event
sampling interval, whether location estimates shall be included in event
reports (and associated location QoS), and whether only one location report is
required or more than one. If the target area is expressed by a local
coordinate system or a geopolitical name, the (H)GMLC shall convert the target
area to a geographical area expressed by a shape as defined in TS 23.032 [8].
For motion event reporting, the LCS Service Request includes the threshold
linear distance, the duration of event reporting, the minimum and maximum time
intervals between successive event reports, the maximum event sampling
interval, whether location estimates shall be included in event reports (and
associated location QoS), and whether only one location report is required or
more than one.
1b-1 AF invokes the Nnef_EventExposure_Subscribe service operation to the NEF.
1b-2 The NEF forwards the request to the (H)GMLC. The NEF assigns a LDR
refence number locally and sends it to (H-)GMLC,
1c. The NF (e.g. NWDAF) invokes the Ngmlc_Location_ProvideLocation service
operation to the (H)GMLC.
NOTE 1: If the LCS Client/AF requests an additional check about whether the UE
is located within the provisioned target area, the LCS Client/AF shall also
request that location estimates shall be included in event reports.
2\. The (H)GMLC may verify UE privacy requirements as for step 2 in clause
6.1.2. The (H)GMLC may also subscribe to and receive notification of UE
privacy profile updates according to steps 0 and 4 of clause 6.12.1. The
(H)GMLC may also receive the event report expected area and optionally an area
usage indication from UDM. For area event reporting, if there is no overlap
between the event report expected area and the area provided by the AF or LCS
Client, the (H)GMLC rejects the location request with a failure cause.
3\. The (H)GMLC queries the UDM for the AMF address and, in the case of
roaming, a VGMLC address as for step 3 in clause 6.1.2.
GMLC may determine the LMF ID based on the LCS data for an LCS Client/AF. In
case a group ID is provided or derived from the location request, GMLC
determines the LMF ID based on the provisioned Group ID.
GMLC may be configured with an LMF ID, irrelevant to any LCS client/AF. When
the GMLC receives a MT location request from LCS client/AF, GMLC determines
the LMF ID for all LCS client/AF.
NOTE 2: The HGMLC may also query the HSS of the target UE for a serving MME
address as described in clause 9.1.1 of TS 23.271 [4]. The deferred EPC-MT-LR
procedure for Periodic and Triggered Location described in clause 9.1.19 of TS
23.271 [4] or the EPC-MT-LR procedure for the UE availability event described
in clause 9.1.15 of TS 23.271 [4] may then be performed instead of steps 4-31
- e.g. if the HSS returns an MME address but the UDM does not return an AMF
address.
4\. This step is skipped for a non-roaming UE. For a roaming UE, the HGMLC
obtains a VGMLC address if not received at step 3 and invokes the
Ngmlc_Location_Provide Location Request service operation to forward the
location request to the VGMLC as described for step 4 of in clause 6.1.2. The
(H)GMLC also includes a contact address for the (H)GMLC (Notification Target
Address, e.g. a URI) and an LDR reference number (Notification correlation ID)
to be used for event reporting at steps 20 and 29. The LDR reference number is
either allocated by (H)GMLC based on predefined rule, e.g. operator\'s policy
if the location request is received in step 1a, or allocated by NEF, if the
location request is received in step 1b. If the event report expected area is
received in step 2, the (H)GMLC is responsible to determine the event report
allowed area which includes a cell/TA list based on the event report expected
area. In the case of an area event, if there is overlap(s) between the event
report expected area and the area provided by the AF or LCS client, the
(H)GMLC will separately derive the TA/cell lists and take the overlapped
TA/cell lists as the event report allowed area. If the area usage indication
is also received in step 2, the (H)GMLC is responsible to determine the
reporting indication regarding how the UE will report when the UE is inside or
outside the event report allowed area. The (H)GMLC may include the event
report allowed area and optionally a reporting indication.
5\. The (H)GMLC or VGMLC invokes the Namf_Location_ProvidePositioningInfo
Request service operation to forward the location request to the serving AMF
as described for step 5 in clause 6.1.2 and includes the (H)GMLC contact
address and LDR reference number. The LDR reference number is either allocated
by (H-)GMLC based on predefined rule, e.g. operator\'s policy if the location
request is received in step 1a, or allocated by NEF, if the location request
is received in step 1b. For area event reporting, the target geographical area
is converted into a corresponding list of cell and/or tracking area
identities. The service operation includes the event report allowed area, the
reporting indication if they are determined by GMLC in step 4.
6-8. If the AMF supports a deferred location request, the AMF returns an
acknowledgment to the external LCS client, the NF, or the AF, via the (H)GMLC
and, in the case of roaming, the VGMLC, indicating that the request for
deferred location was accepted. The VGMLC, when used, may optionally release
resources for the deferred location request at this point.
9\. If the UE is not currently reachable (e.g. is using eDRX or PSM), the AMF
waits for the UE to become reachable.
NOTE 3: In the event of mobility of the UE to another AMF or to EPC when the
UE becomes reachable, the old AMF can return an event indication to the
(H)GMLC as at steps 19 and 20 and may include the address of the new serving
AMF or MME if known. If a new serving AMF or MME is not known, the (H)GMLC can
repeat step 3 to query the UDM and HSS for the new AMF or MME address. If a
new AMF address is received, the (H)GMLC can restart the procedure from step
4.
10\. Once the UE is reachable, if the UE is then in CM IDLE state, the AMF
initiates a network triggered Service Request procedure as defined in clause
4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.
NOTE 4: The AMF may decide to cancel the location request before the UE
becomes reachable (e.g. due to lack of resources or due to a timeout on the UE
becoming reachable) or when the UE becomes reachable (e.g. if the AMF executes
NAS level congestion control on the UE, or for other reasons). The AMF then
skips steps 10-18 and proceeds to step 19 to return an indication of location
cancelation to the VGMLC or (H)GMLC.
11-12. The AMF performs steps 7-8 in clause 6.1.2 to notify the UE of the
location request and verify privacy requirements if required by the location
request received at step 5 and supported by the UE. The AMF includes in the
notification to the UE the type of deferred location request in the case of
periodic or triggered location.
13\. The AMF selects an LMF as described for step 6 in clause 6.1.1. The
selection may take into account the type of deferred location request (e.g.
whether periodic or triggered) and any parameters for the deferred location
request (e.g. the number of event reports required and/or the duration).
14\. The AMF invokes the Nlmf_Location_DetermineLocation Request service
operation towards the LMF to initiate a request for deferred UE location. For
a request for periodic or triggered location, the service operation includes
all the information received in step 4 or step 5 including the (H)GMLC contact
address, LDR reference number, UE Positioning Capability if available and any
scheduled location time and may include a list of allowed access types for
event reporting at step 22. For a request for the UE available location event,
the (H)GMLC contact address and LDR reference number are not included, except
for the case to support location service in PNI-NPN with signalling
optimisation described in clause 5.13. In all cases, the service operation
includes an LCS Correlation identifier, the AMF identifier, the serving cell
identity, the client type and may include an indication if UE supports LPP,
the required QoS and Supported GAD shapes. The service operation includes the
event report allowed area, the reporting indication if received by AMF in step
5.
15\. The LMF performs one or more of the positioning procedures described in
clause 6.11.1, 6.11.2 and 6.11.3 and as described for step 8 in clause 6.1.1.
During this step, the LMF may request and obtain the UE positioning
capabilities (e.g. which may indicate the type(s) of periodic and triggered
location supported by the UE and the access types supported by the UE for
event reporting). The LMF may also obtain the UE location - e.g. for a request
for the UE available location event or when an initial location is requested
for periodic or triggered UE location. For a request for the UE available
location event, the LMF skips steps 16 and 17.
16\. If periodic or triggered location was requested, the LMF sends a
supplementary services LCS Periodic-Triggered Invoke Request to the UE via the
serving AMF by invoking the Namf_Communication_N1N2MessageTransfer service
operation. The LCS Periodic-Triggered Location Invoke carries the location
request information received from the AMF at step 14, including the (H)GMLC
contact address, LDR reference number and any scheduled location time. The LCS
Periodic-Triggered Location Invoke also includes a deferred routing
identifier, which can be the identification of the LMF when the LMF will act
as a serving LMF or a default LMF identification otherwise. The LCS Periodic-
Triggered Location Invoke may indicate the allowed access types for event
reporting at step 25 (e.g. one or more of NR, E-UTRA connected to 5GC,
non-3GPP access connected to 5GC, any of the RAT Types specified for NR
satellite access) and may include embedded positioning message(s) which
indicates certain allowed or required location measurements (or a location
estimate and the timestamp of the location estimate if available) at step 24
for each location event reported (e.g. based on the positioning capabilities
of the UE obtained in step 14 and the allowed access types). As part of NAS
transport of the LCS Periodic-Triggered Location Invoke from the serving AMF
to the UE, the serving AMF includes an immediate routing identifier in the NAS
transport message containing an LCS Correlation identifier - e.g. according to
clause 6.11.1. The service operation includes the event report allowed area,
the reporting indication received by LMF in step 14.
NOTE 5: The deferred routing identifier may be global (e.g. an IP address,
UUID or URI) or may be local. The deferred routing identifier is used for
routing in step 25. However, the immediate routing identifier included by the
AMF in step 15 is used for routing in step 17.
17\. If the request in step 16 can be supported, the UE returns a
supplementary services acknowledgment to the LMF, which is transferred via the
serving AMF using the immediate routing identifier and delivered to the LMF
using an Namf_Communication_N1MessageNotify service operation.
18\. The LMF invokes the Nlmf_Location_DetermineLocation Response service
operation towards the AMF to respond to the request at step 14. For a request
for the UE available location event, the response includes any UE location
obtained at step 15 and the LMF then releases all resources and if (H)GMLC
contact address and the Notification Correlation ID is received in step 14 for
PNI-NPN signalling optimization, the LMF responds to AMF to indicate that the
location determination will be sent directly to GMLC and step 19 is skipped
and similarly with step 28, the LMF sends Nlmf_Location_EventNotify to (H)GMLC
directly. For a periodic or triggered location request, the response includes
any location obtained at step 15, a confirmation of whether periodic or
triggered location was successfully activated in the UE according to steps 16
and 17 and the identification of the LMF in the case of successful activation
with a serving LMF; the LMF also retains state information and resources for
later steps if the LMF acts a serving LMF. If the multiple QoS class was used
in the location request, the LMF provides the achieved Location QoS Accuracy
in step 15. If the UE cannot support the periodic and triggered location
request, the service operation returned to the AMF shall include a suitable
error cause. The service operation also includes the UE Positioning Capability
if the UE Positioning Capability is received in step 15 including an
indication that the capabilities are non-variable and not received from AMF in
step 14.
19\. The AMF invokes the Namf_Location_EventNotify service operation towards
the VGMLC for roaming, or (H)GMLC for non-roaming, and includes any location
received at step 18 and, for periodic or triggered location, a confirmation of
whether or not periodic or triggered location was successfully activated in
the target UE. The VGMLC, if used, may be the same VGMLC used in steps 5 and 6
or may be a different VGMLC. In the case of a different VGMLC, the AMF
includes the HGMLC contact address and LDR reference number. The AMF also
includes the LMF identification and the achieved Location QoS Accuracy if
received at step 18. The AMF may then release all resources for the location
request and cease support for the procedure.
20\. This step is skipped for a non-roaming UE. For a roaming UE, The VGMLC
forwards the response received at step 19 to the HGMLC using the HGMLC contact
address received at step 19 (for a different VGMLC) or received and stored at
step 4 (for the same VGMLC) and includes the LDR reference number and any LMF
identification that was received. The VGMLC may then release all resources for
the location request and cease support for the procedure.
NOTE 6: As an optional optimization for a roaming UE, instead of performing
steps 19 and 20, the AMF may invoke the Namf_Location_EventNotify service
operation directly towards the HGMLC (e.g. if a VGMLC is not used or if the
VGMLC ceases support after step 8).
21\. The (H)GMLC forwards the response to the external LCS client, the NF or
the AF (via the NEF). If the location request at step 1 was for the UE
available location event, the procedure terminates here and further steps
22-31 are not performed.
22\. For a periodic or triggered location request where steps 16 and 17 were
successfully performed, the UE monitors for occurrence of the trigger or
periodic event requested in step 16. For the area event or motion event, the
UE monitors the requested event at intervals equal to or less than the maximum
event sampling interval. An event trigger is detected by the UE when any of
the following occur: (i) a requested area event or motion event has been
detected and the minimum reporting time interval has elapsed since the last
report (if this is not the first event report); (ii) a requested periodic
location event has occurred; or (iii) the maximum reporting time for an area
event or motion event has expired. When a trigger or periodic event is
detected and if the UE is camped on or connected to (or can otherwise access)
an access type allowed by the LMF at step 16, the UE proceeds to step 23. If
the UE cannot access an allowed access type, the UE may skip reporting the
trigger event or may report the trigger event at a later time when an allowed
access type becomes available, according to requirements received from the LMF
at step 16. When a scheduled location time is provided for periodic location
request at step 16, a UE should perform steps 23-25 some time in advance of
the scheduled location time for the first periodic event report or some time
in advance of the periodic interval expiration for each succeeding periodic
event report in order to enable location measurements at step 23 or step 27 to
occur near to each of these times, respectively.
If the event report allowed area with no reporting indication is received in
step 16, when UE detects the event happens, it further checks whether it is
inside the event report allowed area. If yes, the steps 23 to 30c are
performed. Otherwise, the steps 23 to 30c are skipped. If the event report
allowed area with a reporting indication is received in step 16, when UE
detects the event happens, it further checks whether it is outside the event
report allowed area. If yes, the steps 23 to 30c are performed. Otherwise, the
steps 23 to 30c are skipped.
23\. The UE obtains any location measurements or a location estimate that were
requested or allowed at step 16.
NOTE 7: Obtaining a location estimate when requested also applies to the
trigger event corresponding to expiration of the maximum reporting interval
for an area event or motion event.
24\. The UE performs a UE triggered service request as defined in clause
4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a
signalling connection with the AMF.
25\. The UE sends a supplementary services event report message to the LMF
which is transferred via the serving AMF (which may be different to the
original serving AMF for steps 14-16) and is delivered to the LMF using an
Namf_Communication_N1MessageNotify service operation. The event report may
indicate the type of event being reported (e.g. whether a normal event or
expiration of the maximum reporting interval) and may include embedded
positioning message(s) which includes any location measurements or location
estimate and the timestamp of the location estimate if available obtained at
step 23. The UE also includes the deferred routing identifier received in step
16 in the NAS Transport message used to transfer the event report from the UE
to the AMF. The AMF then forwards the event report to either the serving LMF
or any suitable LMF based on whether the deferred routing identifier indicates
a particular LMF or any (default) LMF. If a different LMF than the serving LMF
is used, procedure in clause 6.4 is used. The UE also includes the (H)GMLC
contact address, the LDR reference number, whether location estimates are to
be reported and if so the location QoS in the event report and any scheduled
location time indicated at step 16 for periodic reporting.
NOTE 8: When forwarding the event report message to the LMF in step 25, the
AMF includes the deferred routing identifier received in step 25 as the LCS
Correlation Identifier. The deferred routing identifier can assist a serving
LMF in identifying the periodic or triggered location session if the same
serving LMF had assigned the deferred routing identifier at step 16 or can
indicate to the LMF that it is acting as a default LMF.
NOTE 9: The scheduled location time included at step 25 equals T + (N-1)*P,
where T is the initial Scheduled Location Time, N is the Report Number (Nâ‰¥1)
and P is the time interval between successive periodic events.
26\. When the LMF receives the event report and if it can handle this event
report, the LMF updates the status of event reporting(e.g. the number of event
reports so far received from the UE and/or the duration of event reporting so
far) and returns a supplementary services acknowledgment for the event report
to the UE. The acknowledgment may optionally include a new deferred routing
identifier indicating a new serving LMF or a default (any) LMF. If the UE does
not receive any response from the LMF after a predefined time, i.e. the
current LMF does not support the deferred location request (for temporary or
permanent reasons) or due to some radio access failures, the UE may re-send
the report one or more times. If the UE sends the repeated event report more
than the predefined maximum resending time and the UE still does not receive
any response from AMF, the UE shall stop resending the report and reserve the
event report, then record a corresponding flag to indicate that a report has
been sent unsuccessfully. When the UE performs location update and detects the
PLMN is changed, if the flag has been set, the UE shall send the report to the
corresponding AMF, and the flag will be cleared upon a success of the sending.
NOTE 10: Inclusion of a new deferred routing identifier in the event report
acknowledgment at step 26 may be used to change the serving LMF (e.g. if a UE
moves into an area or to an access type that is better supported by a
different LMF or if the serving LMF is overloaded) or to enable a default LMF
to become a serving LMF.
27\. If a location estimate is needed for event reporting, the LMF may perform
one or more of the positioning procedures described in clauses 6.11.1, 6.11.2,
6.11.3 and 6.11.4 and as described for step 8 in clause 6.1.1 and step 12 in
clause 6.1.2. The LMF then determines the UE location using the location
measurements and/or location estimate(s) obtained at this step and/or received
at step 25. The LMF may also determine the timestamp of the location estimate.
NOTE 11: A precondition for the procedure in clause 6.11.1 is that an LCS
Correlation identifier assigned by the serving AMF has been previously passed
to the LMF. The LCS Correlation identifier is used in steps 1, 3, 6 and 7 in
clause 6.11.1 to ensure that during a positioning session between the LMF and
UE, positioning response messages from the UE are returned by the AMF to the
correct LMF and carrying an indication (the LCS Correlation identifier) which
can be recognized by the LMF. To retain this capability in step 27, the LMF
shall assign a Correlation identifier indicating the LMF (and optionally a
positioning session) for use at step 1 in clause 6.11.1. To enable an AMF to
distinguish a Correlation identifier assigned by an LMF (used in this
procedure) from a Correlation identifier assigned by the AMF (used otherwise
for clause 6.11.1), the two types of Correlation identifier could be selected
from different ranges, with or without a flag.
28\. In the case of roaming, the LMF selects a VGMLC (which may be different
to the VGMLC for steps 3-8 and steps 19-21), The LMF then invokes an
Nlmf_Location_EventNotify service operation towards the selected VGMLC or
(H)GMLC with an indication of the type of event being reported, the (H)GMLC
contact address and LDR reference number, the identification of the LMF if
this is a serving LMF, and any location estimate and the timestamp of the
location estimate (if available) obtained at step 27. If multiple QoS class
was used in the initial location request, the LMF provides the achieved
Location QoS Accuracy in step 27.
NOTE 12: In the case of roaming, the LMF may select the VGMLC for step 28
using the NRF service or using configuration information in the LMF or may use
the same VGMLC as for steps 3-8 (e.g. if the LMF acts as a serving LMF and
received the VGMLC address from the AMF as part of step 14).
29\. This step is skipped for a non-roaming UE. For a roaming UE, the VGMLC
invokes an Ngmlc_Location_EventNotify service operation to forward the
information received in step 28 (e.g. including the type of event being
reported, the LDR reference number and possibly the LMF identification) to the
HGMLC which identifies the periodic and triggered location request from the
LDR reference number.
NOTE 13: As an optional optimization for a roaming UE, instead of performing
steps 28 and 29, the LMF may invoke the Nlmf_Location_EventNotify service
operation directly towards the HGMLC.
NOTE 14: In the event of mobility of the UE to an access network for which
event reporting at step 22 is not allowed (e.g. an access network in EPS) or
if the UE is otherwise unable to send event reports (e.g. due to being powered
off), the (H)GMLC may not receive event reports at step 28 or step 29 at fixed
intervals for periodic location or at intervals equal to or less than the
maximum reporting interval for triggered location. In such a case, the (H)GMLC
may cancel the periodic or triggered location reporting using the procedures
defined in clause 6.3.3. The UE may also cancel the periodic or triggered
location reporting either locally or using the procedure defined in clause
6.3.2 once the UE can access an access network that is allowed for event
reporting.
30\. The (H)GMLC uses the LDR reference number received in step 28 or step 29
to identify the periodic and triggered location request received in step 1 and
then sends the type of event being reported and any location estimate and the
timestamp of the location estimate (if available) and used positioning methods
to the external LCS client, the NF or the AF (via the NEF), and sends the LDR
reference number to LCS client. The (H)GMLC may also verify UE privacy
requirements before reporting the event and any location to the external LCS
client, the NF or the AF. If multiple QoS class was used in the initial
location request, the LMF provides the achieved Location QoS Accuracy in step
27. If an indication to have an additional check is received at step 1, the
(H)GMLC will verify the UE location estimate is within the target area, and
send the event report to the LCS client, the NF or the AF.
31\. The UE continues to monitor for further periodic or trigger events as in
step 22 and instigates steps 23-30 each time a trigger event is detected.
NOTE 15: Service continuity for reporting of periodic or trigger events when a
UE moves between 5GS and EPS is not supported in this release of the
specification.
### 6.3.2 Cancellation of Reporting of Location Events by a UE
Figure 6.3.2-1 summarizes a procedure to enable a UE to cancel a deferred 5GC-
MT-LR procedure for periodic, or triggered location events (e.g. if the UE is
powered off or if the UE cancels the location request based on user\'s input).
It is assumed that a deferred 5GC-MT-LR for periodic or triggered location
events has already been initiated in the UE according to steps 1-17 for the
procedure in clause 6.3.1. If a network entity (e.g. (H)GMLC, AMF or LMF)
cancels a deferred 5GC-MT-LR procedure for periodic or triggered location
events, part of the procedure in clause 6.3.3 for cancellation by an AF, an NF
or external LCS Client would be used to cancel towards the UE and part of the
procedure in this clause would be used to cancel towards the AF, the NF or
external LCS Client.
Figure 6.3.2-1: UE Cancellation of a Deferred 5GC-MT-LR for periodic or
triggered location events
1\. The UE performs a UE triggered service request as defined in clause
4.2.3.2 of TS 23.502 [19] if in CM-IDLE state in order to establish a
signalling connection with the AMF.
2\. The UE sends a Cancel Location request message to the LMF which is
transferred via the serving AMF and is delivered to the LMF using an
Namf_Communication_N1MessageNotify service operation. The UE includes the
deferred routing identifier originally received in step 16 of the procedure in
clause 6.3.1 (or as updated by step 26 in clause 6.3.1 or by the procedure in
clause 6.4) in the NAS Transport message used to transfer the cancel location
request from the UE to the AMF. The AMF then forwards the cancel location
request to either the serving LMF or any suitable LMF based on whether the
deferred routing identifier indicates a particular LMF or any (default) LMF.
The UE also includes the (H)GMLC contact address and the LDR reference number.
3\. In the case of roaming, the LMF selects a VGMLC. The LMF then invokes an
Nlmf_Location_EventNotify service operation towards the selected VGMLC or
(H)GMLC with an indication of the cancelation of location event reporting, the
(H)GMLC contact address and LDR reference number.
NOTE 1: In the case of roaming, the LMF may select the VGMLC for step 3 using
the NRF service or using configuration information in the LMF or may use the
same VGMLC as for steps 3-8 of clause 6.3.1 (e.g. if the LMF acts as a serving
LMF and received the VGMLC address from the AMF as part of step 14 of clause
6.3.1).
4\. This step is skipped for a non-roaming UE. For a roaming UE, the VGMLC
invokes an Ngmlc_Location_EventNotify service operation to forward the cancel
location request (including the LDR reference number) to the HGMLC which
identifies the periodic and triggered location request from the LDR reference
number.
NOTE 2: As an optional optimization for a roaming UE, instead of performing
steps 3 and 4, the LMF may invoke the Nlmf_Location_EventNotify service
operation directly towards the HGMLC.
5\. The (H)GMLC uses the LDR reference number received in step 3 or step 4 to
identify the periodic and triggered location request received in step 1 of
clause 6.3.1 and then forwards the cancel location to the external LCS client,
the NF or the AF (via the NEF).
6\. The LMF returns an acknowledgment to the UE via the serving AMF.
### 6.3.3 Cancellation of Reporting of Location Events by an AF, an NF or
External LCS Client or GMLC
Figure 6.3.3-1 summarizes a procedure to enable an AF, an NF or External LCS
Client or GMLC to cancel a deferred 5GC-MT-LR procedure for periodic, or
triggered location. It is assumed that a deferred 5GC-MT-LR for periodic or
triggered location events has already been requested according to the
procedure in clause 6.3.1 up until at least step 20.
Figure 6.3.3-1: Cancellation of a Deferred 5GC-MT-LR for periodic or triggered
location events by an AF, an NF or External LCS Client
1\. The external LCS client, the NF or the AF (via an NEF) send a request to
cancel the periodic or triggered location to the (H)GMLC, the external LCS
client, the NF or the AF shall include the identity of the deferred request.
The HGMLC may itself initiate the cancellation procedure, e.g. when it is
notified that the UE LCS privacy profile stored in the UDM was changed. For
every outstanding Deferred Location Request against that UE, the HGMLC shall
perform a new privacy check based on the updated UE LCS privacy profile stored
in the UDM. If the privacy check passes, i.e. the LCS Client is still allowed
to position the target UE, the handling of the outstanding Deferred Location
Request shall be continued. Otherwise, if the privacy check does not pass,
i.e. the Location estimate of the target UE is not allowed to be provided to
the LCS Client, the HGMLC shall initiate a cancellation procedure
NOTE: GMLC may perform privacy check for more than one location request as a
bulk operation.
2\. The (H)GMLC queries the UDM to determine the serving AMF address as in
step 3 of clause 6.3.1.
3\. For a roaming UE, the HGMLC obtains a VGMLC address if not received at
step 2 and invokes an Ngmlc_Location_CancelLocation service operation to
forward the cancellation request to the VGMLC. The (H)GMLC also includes the
contact address for the (H)GMLC and the LDR reference number in the request
and the latest LMF identification received in step 20 or step 29 in clause
6.3.1 if either step has occurred and included an LMF identification.
4\. The (H)GMLC or VGMLC invokes the Namf_Location_CancelLocation service
operation to forward the cancellation request to the serving AMF and includes
the (H)GMLC contact address, LDR reference number and LMF identification if
available.
5\. If an LMF identification was included in step 4, the AMF forwards the
cancelation request to the indicated LMF by invoking an
Nlmf_Location_CancelLocation service operation and includes the (H)GMLC
contact address and LDR reference number. The LMF then releases all resources
for the location request.
6\. If the UE is not currently reachable (e.g. is using eDRX or PSM), the AMF
waits for the UE to become reachable.
7\. Once the UE is reachable, if the UE is then in CM IDLE state, the AMF
initiates a network triggered Service Request procedure as defined in clause
4.2.3.3 of TS 23.502 [19] to establish a signalling connection with the UE.
8\. The AMF sends the cancelation request to the target UE and includes the
(H)GMLC contact address and the LDR reference number. The UE then releases all
resources for the location request.
9\. The UE returns an acknowledgment to the AMF.
10\. The AMF responds to Namf_Location_CancelLocation, then V-GMLC or (H)GMLC
releases all resources for the location request. AMF releases all resources
for the location request.
11\. For a roaming UE, the VGMLC responds to Ngmlc_Location_CancelLocation,
then HGMLC releases all resources for the location request.
12\. [Conditional] If the cancellation procedure is requested by HGMLC (i.e.
the procedure is triggered in step 1c) and the cancelled location event is
reported to external client, the NF or the AF (via NEF).
## 6.4 LMF Change Procedure
The LMF Change procedure supports change of a serving LMF during a deferred
5GC-MT-LR procedure for periodic, or triggered location events as defined in
clause 6.3.1. When a serving LMF is used for the procedure in clause 6.3.1,
mobility of the target UE may lead to a change of serving AMF for which the
original serving LMF is not suitable. For example, the serving LMF may be very
remote from the new serving AMF leading to higher resource utilisation for AMF
to LMF signalling or the LMF may not be configured with information (e.g. a
cell database) for the current access network for the UE to enable location.
In such a case, the serving LMF may need to change. Figure 6.4-1 shows a
procedure to enable change of the serving LMF when a UE sends an event report
as at step 25 in clause 6.3.1.
Figure 6.4-1: Change of serving LMF for periodic and triggered UE location
events
**Precondition:** Steps 1-23 in clause 6.3.1 have already been performed and
steps 22-30 may have been performed or repeated. A serving LMF is used and the
current serving LMF is LMF1.
1\. The UE performs a service request if needed as for step 24 in clause
6.3.1.
2\. The UE sends a NAS Transport message containing a supplementary services
event report message to the serving AMF. The NAS Transport message includes a
deferred routing identifier indicating LMF1. Step 2 corresponds to part of
step 25 for clause 6.3.1.
3\. Based on operator configuration and policy, the AMF may evaluate and
determine that LMF1 is unsuitable or unable to support location for the
current UE access network or serving cell and determines LMF2 as being a more
suitable LMF. AMF may already have LMF2 information e.g. from previous NRF
discovery or locally configured, otherwise AMF queries NRF and in response may
get a set of LMF profiles. AMF selects new LMF (i.e. LMF2 in this case) for
the current UE location based on LMF service area (consisting of one or more
TA(s)) and also other information as listed in clause 5.1.
4\. The AMF invokes the Namf_Communication_N1MessageNotify service operation
towards LMF1. The service operation includes the event report received in step
2. If the AMF determined in step 3 that a new LMF2 should be used, it
indicates that to the LMF1 as well.
5\. If the AMF did not indicate a new LMF in step 4, based on the operator
configuration and policy, LMF1 may evaluate and determine that it is
unsuitable or unable to support location for the current UE access network or
serving cell and determines LMF2 as being a more suitable LMF. LMF1 may
already have LMF2 information e.g. from previous NRF discovery or locally
configured, otherwise LMF1 queries NRF and in response may get a set of LMF
profiles. LMF1 selects new LMF (i.e. LMF2 in this case) for the current UE
location based on LMF service area (consisting of one or more TA(s)) and other
information as listed in clause 5.1.
6\. LMF1 invokes an Nlmf_Location_LocationContextTransfer Request service
operation towards LMF2 to provide the current location context of the UE and
includes the event report message received in step 4. The service operation
includes the AMF identity and all the information originally received by LMF1
for the periodic or triggered location request either from the AMF according
to the procedure in clause 6.3.1 or from an earlier serving LMF according to
this procedure. The service operation may also include the current status of
event reporting (e.g. the number of event reports so far received from the UE
and/or the duration of event reporting so far) and may include location
related information for the UE such a previous location estimate and the
timestamp of the location estimate (if available) or location measurements.
7\. LMF2 informs LMF1 of the location context transfer operation results. LMF1
then releases all resources for the procedure.
8\. LMF2 invokes the Namf_Communication_N1N2MessageTransfer service operation
towards the AMF to request the transfer of a supplementary services Event
Report Acknowledgment message to the UE. The Event Report Acknowledgment
indicates a change of LMF and includes a deferred routing identifier
indicating LMF2.
9\. The AMF forwards the Event Report Acknowledgment to the UE in a NAS
Transport message. The AMF also informs the LMF2 of the result of the delivery
of the Event Report Acknowledgement.
10\. If a location estimate is needed for event reporting, LMF2 may perform
positioning of the UE and determines the UE location as at step 27 in clause
6.3.1. The rest of the procedure in clause 6.3.1 then continues from step 28
with LMF2 retaining state information to enable support of subsequent event
reports from the UE.
## 6.5 Unified Location Service Exposure Procedure
### 6.5.1 Unified Location Service Exposure Procedure without routing by a UDM
Figure 6.5.1-1 shows a unified location service exposure procedure provided by
an NEF in an HPLMN for a target UE to an NF in the HPLMN or to an external AF
outside the HPLMN. The procedure enables a request for an immediate location
or for a deferred location for a target UE.
Figure 6.5.1-1: Unified Location Service Exposure Procedure without routing by
a UDM
1a. An external AF invokes an Nnef_EventExposure_Subscribe service operation
towards an NEF in the HPLMN for a target UE and includes an identification of
the UE (e.g. SUPI or GPSI) and details of the location request such as whether
a current or last know immediate location or a deferred location is requested,
the location accuracy and response time, maximum age of location, LDR request
information and other information applicable to the type of request.
1b. As an alternative to step 1a, a consumer NF in the HPLMN for a target UE
invokes an Nnef_EventExposure_Subscribe service operation towards an NEF in
the HPLMN and includes a global identification of the UE (e.g. SUPI or GPSI)
and details of the location request as in step 1a.
2\. Based on the service requirements in step 1a or step 1b (e.g. location QoS
and whether an immediate or deferred location is requested) and on the
availability of GMLC versus AMF based location service, the NEF determines
whether the location request in step 1a or step 1b can be mapped to a GMLC
based location service or to an AMF location event exposure service. The NEF
determines to use whichever mapping is supported or, when both mappings are
supported, may employ implementation or operator dependent procedures to make
a choice. When a GMLC based location service is determined, steps 3-6 are
performed and steps 7-15 are omitted. When an AMF location event exposure
service is determined, steps 7-15 are performed and steps 3-6 are omitted. If
NEF determines the location request is handled by AMF, it allocates an LDR
reference number.
NOTE 1: The NEF may take the potential load to the system, e.g. AMF/UDM load,
or GMLC load, into consideration when deciding which location service to use,
or whether to reject the request from NF or AF. The NEF may also take into
account QoS. For example, when QoS accuracy exceeds cell ID, the GMLC location
service shall be used if available.
3\. When a GMLC based location service is determined in step 2, the NEF
invokes an Ngmlc_Location_ProvideLocation Request service operation towards an
HGMLC in the HPLMN. The service operation may include all of the information
received from the AF or NF in step 1a or 1b.
4\. For a request for an immediate location, the HGMLC performs steps 2-10 of
the 5GC-MT-LR procedure in clause 6.1.1 in the case of regulatory location or
steps 2-23 of the 5GC-MT-LR procedure in clause 6.1.2 in the case of
commercial location. For a request for deferred location, the HGMLC performs
steps 2-29 of the deferred 5GC-MT-LR procedure for periodic, triggered or UE
available location events in clause 6.3.1.
5\. The HGMLC invokes the Ngmlc_Location_ProvideLocation Response service
operation towards the NEF to confirm the request in step 3 for a request for
deferred location or to return the UE location for a request for an immediate
location.
6\. If deferred location was requested in step 1, the HGMLC invokes one or
more Ngmlc_Location_EventNotify service operations towards the NEF, to convey
a single UE location in the case of deferred location for the UE available
event or to convey an indication of location activation in the UE followed by
one or more location event reports in the case of deferred location for
periodic or triggered location events.
7\. When an AMF location event exposure service is determined in step 2, if
the NEF needs to verify the target UE privacy requirements, the NEF invokes a
Nudm_SDM_Get service operation towards the UDM of the target UE to get the
privacy settings of the UE identified by its GPSI or SUPI. The UDM returns the
target UE Privacy setting and the SUPI of the UE. The NEF checks the privacy
settings. If the target UE is not allowed to be located, steps 8-14 are
skipped.
NOTE 2: The AMF location event exposure service does not support a real time
query to the UE to verify UE privacy requirement by the user. If the NEF finds
this is needed, the NEF either selects a GMLC location service or returns an
error to the external AF or NF.
8\. The NEF invokes a Nudm_UECM_Get service operation towards the UDM of the
target UE with SUPI of this UE. The UDM returns the network addresses of the
current serving AMF. If the location request is an immediate location request,
the NEF checks the country codes of the serving node addresses. If the NEF
finds out the current AMF locates out of the service coverage, the NEF returns
an appropriate error message to the AF or NF.
When the UE is concurrently served by multiple PLMNs respectively for 3GPP
access and non-3GPP access, multiple AMF IDs with corresponding access type
are provided by the UDM, the NEF selects one access type and its associated
AMF based on principle defined in clause 5.3.2.
9\. The NEF invokes an Namf_EventExposure Subscribe service operation towards
the serving AMF for the target UE and indicates whether a one-time UE location
is requested or multiple UE locations for some triggering event, if current or
last known is requested, maximum age of location and includes information on
location accuracy (e.g. cell ID or TA granularity). If the NEF has no direct
access to AMF or is configured to use UDM for the AMF event exposure,
procedure in clause 6.5.2 is used instead.
10\. The AMF responds to the service operation in step 9.
11\. If the UE is currently reachable and in CM-IDLE state and if current
location is requested in step 9 with a cell ID accuracy and maximum age of
location cannot be fulfilled based on AMF knowledge of the current or last
known serving cell, the AMF perform a network triggered service request as
described in TS 23.502 [19] to place the UE in CM-CONNECTED state.
12\. If an immediate location is requested in step 9 which the AMF can support
based on AMF knowledge of the current or last known serving cell or serving TA
for the UE, the AMF uses this information. Otherwise, the AMF invokes the NG-
RAN location reporting procedure defined in clause 4.10 of TS 23.502 [19] to
obtain a single location or multiple UE locations according to the request in
step 9. The AMF may convert any location that was obtained in the form of a
cell ID or TAI into geographical information based on TS 23.032 [8] and as
defined in clause 6.2.6.2.5 of TS 29.518 [16] and clauses 5.4.4.7, 5.4.4.8 and
5.4.4.9 of TS 29.571 [33] before proceeding to step 13.
13\. The AMF invokes the Namf_EventExposure Notify service operation towards
the NEF to provide the current or last known UE location as obtained at step
12.
When the NEF obtains more than one serving AMF and corresponding access type
from UDM at step 8, if the location information provided by AMF can not meet
the required LCS QoS, the NEF may forward the location request to another AMF,
i.e. Steps 9-15 is performed in another PLMN served by this AMF. In this case,
if the access type associated with another AMF is non-3GPP access, procedure
defined in clause 6.9.2 applies.
14\. If the AMF invokes the NG-RAN location reporting procedure in step 12 to
obtain multiple UE locations and receives multiple location reports from NG-
RAN as part of step 12, the AMF invokes one or more additional
Namf_EventExposure Notify service operations towards the NEF to provide each
additional UE location provided by NG-RAN. The AMF may convert each additional
UE location in the form of a cell ID or TAI into geographical information as
in step 12.
NOTE 4: AMF conversion of a UE location in the form of a cell ID or TAI into
geographical information in step 12 and step 14 can be PLMN operator
dependent. However, it is expected that AMF conversion will normally be needed
for a roaming UE to avoid VPLMN cell ID and TAI configuration in the HPLMN
NEF.
15\. In the case of LDR, the NEF may itself initiate the Namf_EventExposure
Unsubscribe service operation, e.g. if when the UE\'s privacy setting stored
in the UDM was changed. For every outstanding Deferred Location Request
against that UE, the NEF shall perform a new privacy check based on the
updated privacy setting stored in the UDM. If the privacy check passes, i.e.
the LCS Client is still allowed to position the target UE, the handling of the
outstanding Deferred Location Request should be continued. Otherwise, if the
privacy check does not pass, i.e. the Location estimate of the target UE is
not allowed to be provided to the LCS Client, the NEF shall initiate a
cancellation. Then AMF then releases all resources for the LDR request, and
NEF shall send a notification of cancellation of LDR request to consumer AF or
NF in the step 17a, 17b.
16a, 16b. The NEF returns the first UE location received at step 5 or step 13
or a confirmation of a request for deferred location received at step 5 in the
case of a GMLC location service to the external AF (step 15a) or NF (step
15b).
17a, 17b. If one or more additional location reports are received at step 6 or
step 14, the NEF returns one or more additional locations to the external AF
(step 16a) or NF (step 16b). If step 15 occurs, a notification of cancellation
of LDR request shall be sent to the consumer AF (step 17a) or consumer NF
(step 17b).
NOTE 5: As part of step 16 and step 17, the NEF converts any UE location
received in the form of a cell ID or TAI into geographical information prior
to sending the location to a consumer AF or NF.
### 6.5.2 Unified Location Service Exposure Procedure with routing via a UDM
Figure 6.5.2-1 shows the procedure used by an NEF to access the serving AMF
for the UE when the NEF does not have direct access to the serving AMF or is
configured to use UDM for AMF location event exposure service. When this
procedure is used, steps 1-8 in Figure 6.5.2-1 replace steps 8-14 in Figure
6.5.1-1.
Figure 6.5.2-1: Unified Location Service Exposure Procedure with routing by a
UDM
1\. The NEF invokes an Nudm_EventExposure Subscribe service operation towards
the UDM for the target UE for location reporting and indicates whether a one-
time UE location is requested or multiple UE locations for some triggering
event and includes the UE identity (SUPI or GPSI) and information on location
accuracy (e.g. cell ID or TA granularity). A correlation ID is also included.
2\. The UDM invokes an Namf_EventExposure Subscribe service operation towards
the serving AMF for the target UE for location reporting and includes the
information received in the service operation for step 1 including the
correlation ID and a URI for the NEF.
3\. The AMF responds to the service operation in step 2.
4\. The UDM responds to acknowledges the service operation in step 1.
5\. The AMF performs a Network Triggered Service Request if needed as for step
11 of clause 6.5.1.
6\. The AMF obtains a location of the UE or invokes a location reporting
procedure with NG-RAN to obtain a UE location or multiple UE locations as for
step 12 of clause 6.5.1.
7\. The AMF invokes the Namf_EventExposure Notify service operation towards
the NEF indicated by the URI received in step 2 and includes the first UE
location obtained at step 6 and the correlation ID received at step 2.
8\. If the AMF invokes a location reporting procedure with NG-RAN to obtain
multiple UE locations at step 6, the AMF invokes one or more
Namf_EventExposure Notify service operations towards the NEF to provide each
additional UE location as in step 14 for clause 6.5.1.
## 6.6 NG-RAN Location Service Exposure Procedure
The NG-RAN Location Service Exposure procedure is not supported in this
Release of the specification.
## 6.7 Low Power Periodic and Triggered 5GC-MT-LR Procedures
The low power periodic and triggered 5GC-MT-LR procedures may be used to
support a request from an external LCS client or AF for deferred location for
periodic or triggered location events. The procedures may be used as
alternatives to the procedures in clause 6.3.1 and clause 6.4. If the
procedures are used, cancellation of the reporting of location events is still
supported using the procedures in clause 6.3.2 and clause 6.3.3.
### 6.7.1 Event Reporting with no change of LMF
Figure 6.7.1-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events using
low power event reporting. This procedure is only applicable to a UE with
E-UTRA access to 5GC.
Figure 6.7.1-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure with no
change of LMF
1\. Steps 1-23 for the deferred 5GC-MT-LR procedure for periodic or triggered
location events in clause 6.3.1 are performed with the following exceptions.
\- At step 14, the AMF includes an indication in the
Nlmf_Location_DetermineLocation Request service operation that the UE supports
and is allowed to use Control Plane CIoT 5GS Optimisation as described in
clause 5.31.4 of TS 23.501 [18].
\- At step 16, if the AMF indicates the UE supports and is allowed to use
Control Plane CIoT 5GS Optimisation at step 14 and if the LMF decides to allow
Control Plane CIoT 5GS Optimisation, the LMF includes an indication in the LCS
Periodic-Triggered Invoke Request that the UE is allowed to use Control Plane
CIoT 5GS Optimisation to send Event Reports. The LMF may also include criteria
indicating when Control Plane CIoT 5GS Optimisation may be used to send Event
Reports. The criteria may include a maximum duration for sending Event Reports
using Control Plane CIoT 5GS Optimisation, a maximum number of consecutive
Event Reports to be sent using Control Plane CIoT 5GS Optimisation or both.
NOTE 1: As part of negotiating 5G network behaviour during registration, a UE
indicates in a Registration Request whether Control Plane CIoT 5GS
Optimisation is supported for location event reporting. This indication may be
passed to the LMF by the AMF at step 14 for clause 6.3.1.
2\. The UE determines whether to report the event detected at step 22 in
clause 6.3.1 using Control Plane CIoT 5GS Optimisation or using a NAS
signalling connection. If the UE is currently in CM CONNECTED state or is not
accessing E-UTRA connected to 5GC, the UE shall use a NAS signalling
connection. Otherwise, the determination shall be based on criteria received
from the LMF at step 14 in clause 6.3.1 when criteria are received. When the
criteria include a maximum duration for sending event reports using Control
Plane CIoT 5GS Optimisation, the UE shall report the event using a NAS
signalling connection if the UE has not used a NAS signalling connection to
report events during an immediately preceding time interval equal to the
maximum duration. When the criteria include a maximum number of consecutive
Event Reports to be sent using Control Plane CIoT 5GS Optimisation, the UE
shall report the event using a NAS signalling connection if the UE has used
Control Plane CIoT 5GS Optimisation to report each of the N previous events,
where N equals the maximum number of consecutive Event Reports. In other
cases, Control Plane CIoT 5GS Optimisation may be used to report the event if
supported by the 3GPP access type. If use of a NAS signalling connection is
determined, steps 24-31 for the procedure in clause 6.3.1 are performed and
steps 3-11 below are skipped. If use of Control Plane CIoT 5GS Optimisation is
determined, steps 3-11 below are performed.
3\. If the UE and ng-eNB node both support EDT, the UE sends an
RRCEarlyDataRequest message to the ng-eNB node and includes a NAS control
plane service request.
Otherwise, the UE established an RRC connection with the ng-eNB node and sends
the NAS control plane service request. The NAS control plane service request
includes an event report message which includes the information described in
step 25 in clause 6.3.1 (e.g. the type of event being reported and any
location measurements or location estimate obtained at step 23 in clause
6.3.1). The control plane service request also includes the deferred routing
identifier received in step 16 in clause 6.3.1. The UE also includes a NAS
Release Assistance Indication (NAS RAI) in the NAS message. The NAS RAI
indicates a single response is expected.
NOTE 2: Event reporting using Control Plane CIoT 5GS Optimisation requires a
single Event report acknowledgment from the LMF.
4\. The ng-eNB node forwards the NAS message to the AMF in an N2 Initial UE
message and includes an \"EDT Session\" indication if EDT was used at step 3.
5\. The AMF checks the integrity of the NAS message and deciphers its
contents. The AMF then invokes an Namf_Communication_N1MessageNotify service
operation to forward the event report to either the serving LMF or any
suitable LMF as described for step 25 for clause 6.3.1. The AMF includes an
indication of Control Plane CIoT 5GS Optimisation in the service operation and
the serving cell ID.
6\. The AMF returns a NAS Service Accept to the ng-eNB node which is
encapsulated in an N2 Downlink NAS Transport message.
7\. If EDT was used at step 3, the ng-eNB node establishes an RRC connection
to the UE.
8\. The ng-eNB node sends an RRC DL Information Transfer message to the UE and
includes the NAS Service Accept message received in step 6.
9\. The LMF invokes an Namf_Communication_N1N2MessageTransfer operation to
return an acknowledgment for the event report as described for step 26 for
clause 6.3.1.
10\. The AMF forwards the acknowledgment to the ng-eNB node in a NAS DL NAS
Transport message which is encapsulated in an N2 Downlink NAS Transport
message. The AMF also includes an \"end indication\" in the N2 message.
NOTE 3: If the AMF determines more data or signalling may be pending for the
UE, the AMF does not include the \"end indication\" at step 10 and step 12
below is not performed.
11\. The ng-eNB node sends an RRC DL Information Transfer message to the UE
and includes the NAS message received in step 10.
12\. If the \"end indication\" was received in step 10, the ng-eNB node
releases the RRC connection.
13\. If a location estimate is needed for event reporting, the LMF determines
the UE location using the location measurements and/or location estimate
received in the event report at step 5 and/or the serving cell ID provided by
the AMF at step 5.
NOTE 4: The LMF does not attempt to obtain additional location measurements
from the UE or from the NG-RAN.
14\. Steps 28-31 for clause 6.3.1 are performed to send the event report to
the external client or AF and to continue event detection at the UE.
### 6.7.2 Event Reporting with change of LMF
Figure 6.7.2-1 shows a procedure to enable change of the serving LMF when a UE
sends an event report as at steps 3 and 4 in clause 6.7.1.
Figure 6.7.2-1: Event Reporting with change of LMF
**Precondition:** Step 1 in clause 6.7.1 has already been performed and steps
2-11 in clause 6.7.1 may have been performed or repeated. A serving LMF is
used and the current serving LMF is LMF1.
1\. Steps 2-4 for Event Reporting for no change of LMF in clause 6.7.1 are
performed with the following exceptions.
\- At step 3, the NAS control plane service request includes a deferred
routing identifier indicating LMF1.
2\. Steps 3-8 for the LMF Change procedure in clause 6.4 are performed with
the following exceptions.
\- At step 4, the Namf_Communication_N1MessageNotify service operation
includes an indication of Control Plane CIoT 5GS Optimisation.
\- At step 6, the Nlmf_Location_LocationContextTransfer Request service
operation includes an indication of Control Plane CIoT 5GS Optimisation and
the serving cell ID.
3\. Steps 7-10 for Event Reporting for no change of LMF in clause 6.7.1 are
performed with LMF2 replacing the LMF in clause 6.7.1. The rest of the
procedure in clause 6.7.1 then continues in step 11 with LMF2 retaining state
information to enable support of subsequent event reports from the UE.
### 6.7.3 Event Reporting in RRC INACTIVE state for DL Positioning, RAT
Independent Positioning or No Positioning
Figure 6.7.3-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events when
a UE is in RRC INACTIVE state and when DL positioning, RAT independent
positioning or no positioning is used for event reporting. This procedure is
only applicable to a UE with NR access to 5GC.
Figure 6.7.3-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure in RRC
INACTIVE state with DL Positioning, RAT Independent Positioning or No
Positioning
1\. Steps 1-21 for the deferred 5GC-MT-LR procedure for periodic or triggered
location events in clause 6.3.1 are performed with the following differences.
\- At step 16 in clause 6.3.1, the LMF indicates to the UE that DL
positioning, RAT Independent positioning or no positioning will be used for
subsequent location reporting events when the UE is in RRC INACTIVE state. If
DL positioning or RAT independent positioning will be used, the LMF includes
an LPP positioning message in the LCS Periodic-Triggered Invoke Request sent
to the UE at step 16, where the LPP positioning message requests DL location
measurements, RAT independent location measurements or a location estimate
based on these location measurements. If no location of the UE is needed for
event reporting or if a location based on a Cell ID will suffice for the
location QoS, the LMF does not include an LPP positioning message in the LCS
Periodic-Triggered Invoke Request sent to the UE at step 16.
NOTE 1: A deferred routing identifier indicating a default LMF cannot be
included in the LCS Periodic-Triggered Location Invoke sent at step 16 in
clause 6.3.1 because for event reporting at steps 5-11 below. the LMF needs to
know which type of positioning was indicated at step 1 in order to correctly
support these subsequent steps. However, a default LMF would not know which
type of positioning had been indicated at step 1.
2\. The UE enters RRC INACTIVE state some time before an event is detected at
step 22 or step 31 in clause 6.3.1. If the UE is not in RRC INACTIVE state
when an event is detected at step 22 or step 31 in clause 6.3.1, then the UE
follows the procedure described for steps 22-31 in clause 6.3.1 to report the
event to the LMF and to the LCS Client or AF.
NOTE 2: The LMF is not aware of whether the UE is in RRC INACTIVE state. This
allows the LMF to follow the procedure described here or the procedure
described in clause 6.3.1 for event reporting. With the procedure described
here, a UE that was initially in RRC INACTIVE state can remain in RRC INACTIVE
state after the procedure is complete. With the procedure in clause 6.3.1, a
UE that was initially in RRC INACTIVE state could be moved into RRC CONNECTED
state during the procedure in clause 6.3.1.
3\. The UE monitors for and detects a trigger event as described for step 22
in clause 6.3.1.
4\. If DL positioning or RAT independent positioning was indicated at step 1,
the UE obtains the location measurements or location estimate requested in the
LPP message received in step 1. If DL positioning or RAT independent
positioning was not indicated at step 1, this step is skipped.
5\. The UE sends an RRC Resume Request with small data transmission (SDT) to a
receiving gNB node in the NG-RAN. The RRC Resume Request includes an RRC UL
Information Transfer message containing an UL NAS TRANSPORT message that
includes a supplementary services event report message. If DL positioning or
RAT independent positioning was indicated at step 1, the UE includes an LPP
positioning message in the supplementary services event report message that
includes the location measurements or location estimate obtained at step 4. If
DL positioning or RAT independent positioning was not indicated at step 1, the
UE does not include an LPP positioning message in the supplementary services
event report message. The event report message also includes other information
described in step 25 in clause 6.3.1 (e.g. the type of event being reported).
The UL NAS TRANSPORT message also include the deferred routing identifier
received in step 16 in clause 6.3.1.
6\. The receiving gNB node forwards the UL NAS TRANSPORT message to the
serving AMF in an N2 Uplink NAS Transport message.
NOTE 3: If the receiving gNB node is not the anchor gNB node for the UE, the
UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor
gNB node.
7\. The AMF checks the integrity of the NAS message and deciphers its
contents. The AMF then invokes an Namf_Communication_N1MessageNotify service
operation to forward the event report to the serving LMF as described for step
25 in clause 6.3.1.
8\. The LMF invokes an Namf_Communication_N1N2MessageTransfer operation to
return an acknowledgment for the event report as described for step 26 in
clause 6.3.1.
NOTE 4: If there is a change of LMF according to clause 6.4, the
acknowledgment includes a deferred routing identifier for the new LMF as
described in clause 6.4.
9\. The AMF forwards the acknowledgment to the receiving gNB node in a DL NAS
TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport
message.
NOTE 5: If the receiving gNB node is not the anchor gNB node for the UE, the
DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the
anchor gNB node.
10\. The receiving gNB node sends a Subsequent DL SDT message to the UE and
includes the NAS message received in step 10.
11\. The receiving gNB node sends an RRC Release message to the UE to keep the
UE in RRC INACTIVE state.
12\. Following step 11, the UE remains in RRC INACTIVE state.
13\. If a location estimate is needed for event reporting, the LMF determines
the UE location using the location measurements or location estimate received
at step 7 or a Cell ID provided by the AMF at step 7.
NOTE 6: The LMF does not attempt to obtain additional location measurements
from the UE or from the NG-RAN.
14\. Steps 28-31 for clause 6.3.1 are performed to send the event report to
the LCS client or AF.
### 6.7.4 Event Reporting in RRC INACTIVE state for UL Positioning
Figure 6.7.4-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events when
a UE is in RRC INACTIVE state and when UL positioning is used for event
reporting. This procedure is only applicable to a UE with NR access to 5GC.
Figure 6.7.4-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure in RRC
INACTIVE state with UL Positioning
1\. Steps 1-21 for the deferred 5GC-MT-LR procedure for periodic or triggered
location events in clause 6.3.1 are performed with the following differences.
\- At step 16 in clause 6.3.1, the LMF indicates to the UE that UL positioning
may be used for subsequent location reporting events when the UE is in RRC
INACTIVE state by not including an LPP positioning message in the LCS
Periodic-Triggered Invoke Request sent to the UE at step 16.
NOTE 1: A deferred routing identifier indicating a default LMF cannot be
included in the LCS Periodic-Triggered Location Invoke sent at step 16 in
clause 6.3.1 because for event reporting at steps 4-11 below. the LMF needs to
know which type of positioning was indicated at step 1 in order to correctly
support these subsequent steps. However, a default LMF would not know which
type of positioning had been indicated at step 1.
2\. The UE enters RRC INACTIVE state some time before an event is detected at
step 22 or step 31 in clause 6.3.1. If the UE is not in RRC INACTIVE state
when an event is detected at step 22 or step 31 in clause 6.3.1, then the UE
follows the procedure described for steps 22-31 in clause 6.3.1 to report the
event to the LMF and to the LCS Client or AF.
NOTE 2: The LMF is not aware of whether the UE is in RRC INACTIVE state. This
allows the LMF to follow the procedure described here or the procedure
described in clause 6.3.1 for event reporting. With the procedure described
here, a UE that was initially in RRC INACTIVE state can remain in RRC INACTIVE
state after the procedure is complete. With the procedure in clause 6.3.1, a
UE that was initially in RRC INACTIVE state could be moved into RRC CONNECTED
state during the procedure in clause 6.3.1.
3\. The UE monitors for and detects a trigger event as described for step 22
in clause 6.3.1.
4\. The UE sends an RRC Resume Request with small data transmission (SDT) to a
receiving gNB node in the NG-RAN. The RRC Resume Request includes an RRC UL
Information Transfer message containing an UL NAS TRANSPORT message that
includes a supplementary services event report message. The UE does not
include an LPP positioning message in the supplementary services event report
message. The event report message includes other information described in step
25 in clause 6.3.1 (e.g. the type of event being reported). The UL NAS
TRANSPORT message also includes the deferred routing identifier received in
step 16 in clause 6.3.1.
5\. The receiving gNB node forwards the UL NAS TRANSPORT message to the
serving AMF in an N2 Uplink NAS Transport message.
NOTE 3: If the receiving gNB node is not the anchor gNB node for the UE, the
UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor
gNB node.
6\. The AMF checks the integrity of the NAS message and deciphers its
contents. The AMF then invokes an Namf_Communication_N1MessageNotify service
operation to forward the event report to the serving LMF as described for step
25 in clause 6.3.1.
7\. The LMF uses the Network Assisted Positioning Procedure in clause 6.11.2
to request the receiving gNB node to provide an UL configuration to the UE at
step 11. The receiving gNB node then determines an UL Configuration to be used
later at step 11 and indicates this to the LMF. The LMF also uses the Non-UE
Associated Network Assistance Data procedure in clause 6.11.3 to request UL
location measurements of the UE by NG-RAN gNB nodes.
NOTE 4: Because the UE is in RRC INACTIVE state and thus in CM CONNECTED
state, step 2 of the Network Assisted Positioning Procedure in clause 6.11.2
whereby the AMF performs a Network Triggered Service Request will not be
performed. This avoids a transition of the UE into RRC CONNECTED state.
8\. The LMF invokes an Namf_Communication_N1N2MessageTransfer operation to
return an acknowledgment for the event report as described for step 26 in
clause 6.3.1.
NOTE 5: If there is a change of LMF according to clause 6.4, the
acknowledgment includes a deferred routing identifier for the new LMF as
described in clause 6.4.
9\. The AMF forwards the acknowledgment to the receiving gNB node in a DL NAS
TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport
message.
NOTE 6: If the receiving gNB node is not the anchor gNB node for the UE, the
DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the
anchor gNB node.
10\. The receiving gNB node sends a Subsequent DL SDT message to the UE and
includes the NAS message received in step 10.
11\. The receiving gNB node sends an RRC Release message to the UE to keep the
UE in RRC INACTIVE state and includes the UL Configuration determined at step
7.
12\. The UE transmits UL positioning signals according to the UL Configuration
received at step 11. The NG-RAN gNB nodes that were requested to obtain UL
location measurements at step 7 obtain the UL location measurements of the UL
positioning signals transmitted by the UE.
13\. The NG-RAN gNB nodes transfer the UL location measurements obtained at
step 12 to the LMF according to the Non-UE Associated Network Assistance Data
Procedure in clause 6.11.3.
14\. Following step 13, the UE remains in RRC INACTIVE state.
15\. The LMF determines the UE location using the UL location measurements
received at step 13.
NOTE 7: The LMF does not attempt to obtain additional location measurements
from the UE or from the NG-RAN.
16\. Steps 28-31 in clause 6.3.1 are performed to send the event report to the
LCS client or AF.
### 6.7.5 Event Reporting in RRC INACTIVE state for UL+DL Positioning
Figure 6.7.5-1 summarizes the initiation and reporting of location events for
a deferred 5GC-MT-LR procedure for Periodic or Triggered Location Events when
a UE is in RRC INACTIVE state and when UL-DL positioning is used for event
reporting. This procedure is only applicable to a UE with NR access to 5GC.
Figure 6.7.5-1: Low Power Periodic and Triggered 5GC-MT-LR Procedure in RRC
INACTIVE state with UL+DL Positioning
1\. Steps 1-21 for the deferred 5GC-MT-LR procedure for periodic or triggered
location events in clause 6.3.1 are performed with the following differences.
\- At step 16 in clause 6.3.1, the LMF indicates to the UE that UL+DL
positioning will be used for subsequent location reporting events when the UE
is in RRC INACTIVE state by including an LPP positioning message in the LCS
Periodic-Triggered Invoke Request sent to the UE at step 16, where the LPP
positioning message identifies an UL-DL positioning method and requests DL
location measurements for this positioning method. The LMF also includes a
deferred routing identifier in the LCS Periodic-Triggered Location Invoke
which is an identification of the LMF.
NOTE 1: A deferred routing identifier indicating a default LMF cannot be
included in the LCS Periodic-Triggered Location Invoke sent at step 16 in
clause 6.3.1 because for event reporting at steps 4-20 below. the LMF needs to
know which type of positioning was indicated at step 1 in order to correctly
support these subsequent steps. However, a default LMF would not know which
type of positioning had been indicated at step 1.
2\. The UE enters RRC INACTIVE state some time before an event is detected at
step 22 or step 31 in clause 6.3.1. If the UE is not in RRC INACTIVE state
when an event is detected at step 22 or step 31 in clause 6.3.1, then the UE
follows the procedure described for steps 22-31 in clause 6.3.1 to report the
event to the LMF and to the LCS Client or AF.
NOTE 2: The LMF is not aware of whether the UE is in RRC INACTIVE state. This
allows the LMF to follow the procedure described here or the procedure
described in clause 6.3.1 for event reporting. With the procedure described
here, a UE that was initially in RRC INACTIVE state can remain in RRC INACTIVE
state after the procedure is complete. With the procedure in clause 6.3.1, a
UE that was initially in RRC INACTIVE state could be moved into RRC CONNECTED
state during the procedure in clause 6.3.1.
3\. The UE monitors for and detects a trigger event as described for step 22
in clause 6.3.1.
4\. The UE sends an RRC Resume Request with small data transmission (SDT) to a
receiving gNB node in the NG-RAN. The RRC Resume Request includes an RRC UL
Information Transfer message containing an UL NAS TRANSPORT message that
includes a supplementary services event report message. The UE includes an LPP
positioning message in the supplementary services event report message that
includes a request for an UL Configuration to support the UL+DL positioning
method indicated to the UE at step 1. The event report message also includes
other information described in step 25 in clause 6.3.1 (e.g. the type of event
being reported). The UL NAS TRANSPORT message also includes the deferred
routing identifier received in step 16 in clause 6.3.1.
5\. The receiving gNB node forwards the UL NAS TRANSPORT message to the
serving AMF in an N2 Uplink NAS Transport message.
NOTE 3: If the receiving gNB node is not the anchor gNB node for the UE, the
UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor
gNB node.
6\. The AMF checks the integrity of the NAS message and deciphers its
contents. The AMF then invokes an Namf_Communication_N1MessageNotify service
operation to forward the event report to the serving LMF as described for step
25 in clause 6.3.1.
7\. The LMF uses the Network Assisted Positioning Procedure in clause 6.11.2
to request the receiving gNB node to provide an UL configuration to the UE at
step 11. The receiving gNB node then determines an UL Configuration to be used
later at step 11 and indicates this to the LMF. The LMF also uses the Non-UE
Associated Network Assistance Data procedure in clause 6.11.3 to request UL
location measurements of the UE by NG-RAN gNB nodes.
NOTE 4: Because the UE is in RRC INACTIVE state and thus in CM CONNECTED
state, step 2 of the Network Assisted Positioning Procedure in clause 6.11.2
whereby the AMF performs a Network Triggered Service Request will not be
performed. This avoids a transition of the UE into RRC CONNECTED state.
8\. The LMF invokes an Namf_Communication_N1N2MessageTransfer operation to
return an acknowledgment for the event report as described for step 26 in
clause 6.3.1.
NOTE 5: If there is a change of LMF according to clause 6.4, the
acknowledgment includes a deferred routing identifier for the new LMF as
described in clause 6.4.
9\. The AMF forwards the acknowledgment to the receiving gNB node in a DL NAS
TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport
message.
NOTE 6: If the receiving gNB node is not the anchor gNB node for the UE, the
DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the
anchor gNB node.
10\. The receiving gNB node sends a Subsequent DL SDT message to the UE and
includes the NAS message received in step 9.
11\. The receiving gNB node sends an RRC Release message to the UE to keep the
UE in RRC INACTIVE state and includes the UL Configuration determined at step
7.
12\. The UE transmits UL positioning signals according to the UL Configuration
received at step 11. The UE also obtains DL location measurements as requested
at step 1. The NG-RAN gNB nodes that were requested to obtain UL location
measurements at step 7 obtain the UL location measurements of the UL
positioning signals transmitted by the UE.
13\. The NG-RAN gNB nodes transfer the UL location measurements obtained at
step 12 to the LMF according to the Non-UE Associated Network Assistance Data
Procedure in clause 6.11.3.
14\. The UE sends an RRC Resume Request with small data transmission to the
receiving gNB node. The RRC Resume Request includes an RRC UL Information
Transfer message containing an UL NAS TRANSPORT message that includes a
supplementary services event report message. The event report message
indicates that this is a second event report associated with the first event
report sent at step 4 and includes an LPP positioning message that includes
the DL location measurements obtained at step 12. The UL NAS TRANSPORT message
also includes the deferred routing identifier received in either step 16 in
clause 6.3.1 or step 10 in this procedure if there was a change of LMF.
NOTE 7: The LMF can be aware that UL+DL positioning is used from receipt at
step 6 of the LPP positioning message in the supplementary services event
report message that includes a request for an UL Configuration to support the
UL+DL positioning method indicated to the UE at step 1. The LMF can thus
expect to receive the second event report at step 14.
15\. The receiving gNB node forwards the UL NAS TRANSPORT message to the
serving AMF in an N2 Uplink NAS Transport message.
NOTE 8: If the receiving gNB node is not the anchor gNB node for the UE, the
UL NAS TRANSPORT message may be forwarded to the serving AMF via the anchor
gNB node.
16\. The AMF checks the integrity of the NAS message and deciphers its
contents. The AMF then invokes an Namf_Communication_N1MessageNotify service
operation to forward the event report to the serving LMF as described for step
25 in clause 6.3.1.
17\. The LMF invokes an Namf_Communication_N1N2MessageTransfer operation to
return an acknowledgment for the event report as described for step 26 in
clause 6.3.1.
18\. The AMF forwards the acknowledgment to the receiving gNB node in a DL NAS
TRANSPORT message which is encapsulated in an N2 Downlink NAS Transport
message.
NOTE 9: If the receiving gNB node is not the anchor gNB node for the UE, the
DL NAS TRANSPORT message may be forwarded to the receiving gNB node via the
anchor gNB node.
19\. The receiving gNB node sends a Subsequent DL SDT message to the UE and
includes the NAS message received in step 18.
20\. The receiving gNB node sends an RRC Release message to the UE to keep the
UE in RRC INACTIVE state.
21\. Following step 20, the UE remains in RRC INACTIVE state.
22\. The LMF determines the UE location using the UL location measurements
received at step 13 and the DL location measurements received at step 16.
NOTE 10: The LMF does not attempt to obtain additional location measurements
from the UE or from the NG-RAN.
23\. Steps 28-31 in clause 6.3.1 are performed to send the event report to the
LCS client or AF.
## 6.8 Bulk Operation of LCS Service Request Targeting to Multiple UEs
The procedure described in this clause applies to 5GC_MT_LR and Deferred 5GC-
MT-LR request targeting to a group of UE identified by an external/internal
group ID, if available.
Figure 6.8-1: Bulk operation of LCS service request targeting to multiple UEs
1\. This step is the same as step 1 of clause 6.1.2 and step 1 of clause
6.3.1, with the difference that the LCS request is targeting a group of UE
identified by a group ID. The GMLC may map the external/internal group ID to
the list of UE ID (i.e. SUPI) using Nudm_SDM_Get (Group Identifier
Translation, External Group Identifier) service operation.
NOTE: Step 1b-1 assumes the LCS QoS provided by AF indicate \"high-accuracy\",
and NEF determines the location request is handled by GMLC.
1b-2. The NEF shall send a Ngmlc_Location_ProvideLocation Request to the GMLC
with the group of UE identified by a group ID to indicate a bulk operation
procedure. If deferred location is requested the NEF shall include an Event
type to indicate that deferred location is requested and provides an LDR
reference number (Notification Correlation ID) to be used for event reporting
at steps 6b-1 and 11b-1. If immediate location is requested the NEF shall not
provide an Event type to indicate that immediate location is requested and
provides a Notification Correlation ID to be used for reporting at steps 6b-1.
1c. he NF (e.g. NWDAF) shall send a Ngmlc_Location_ProvideLocation Request to
the GMLC with the group of UE identified by a group ID to indicate a bulk
operation procedure.
2a. If deferred location is requested from the LCS Client, the GMLC responds
with an acknowledgment.
2b-1. The GMLC responds with a Ngmlc_Location_ProvideLocation Response.
GMLC may decide whether completely or partially (i.e. accept part of the UE(s)
within the group identified by the group ID in step 1) reject the location
request. If GMLC decides to partially reject the location request, GMLC will
respond to the LCS client /AF with a proper error cause.
2b-2. The NEF acknowledges the execution of the Nnef_EventExposure_Subscribe.
2c. If deferred location is requested from the NF, the GMLC responds with an
acknowledgment.
Steps 3 to 5 are carried out once per UE.
3\. The GMLC invokes a Nudm_SDM_Get (LCS privacy, SUPI) service operation
towards the UDM to get the UE LCS privacy profile of the target UE. The GMLC
checks the privacy settings. For the UE whose privacy setting does not allow
it to be located, steps 4 and 5 are skipped. The GMLC may also subscribe to
and receive notification of UE privacy profile updates according to steps 0
and 4 of clause 6.12.1.
4\. The GMLC invokes a Nudm_UECM_Get service operation towards the UDM of the
target UE with SUPI of this UE. The UDM returns the current serving AMF ID to
the GMLC.
5a. If no AMF ID is returned at step 4:
\- if it is a deferred location request and the GMLC supports the storage of
the LCS service request for a group of UE, the GMLC subscribes the UE
reachability status to the UDM using Nudm_EventExposure_Subscribe service
operation with the data key \"SUPI\";
\- otherwise, this step is skipped and the GMLC returns an appropriate error
cause to the LCS client or NEF at step 6.
5b. If the UDM returns the current serving AMF ID to the GMLC at step 4:
\- the GMLC initiates 5GC_MT_LR procedure (from step 4 onwards) as described
in clause 6.1.2, with the difference that Step 24 is skipped (as it is
replaced by step 6 below); The GMLC shall not include the Notification
Correlation ID received from NEF in step 1b-2.
\- or the GMLC initiates Deferred 5GC-MT-LR Procedure (from step 4 onwards) as
described in clause 6.3.1 with the difference that steps 8,21 and 30 are
skipped (as it is replaced by steps 2, 6 and 11 below) and that GMLC assign
LDR reference numbers (separate number for each UE) to be used for event
reporting at steps 20 and 29.
6a. The GMLC receives response messages as defined in clause 6.1.2 step 22 or
23 or GMLC receives notification messages as defined in clause 6.3.1 step 28
or 29. The GMLC sends one or more LCS Service Responses to the LCS Client to
convey UE locations or event reports.
6b-1. The GMLC receives response messages as defined in clause 6.1.2 step 22
or 23 or GMLC receives notification messages as defined in clause 6.3.1 step
28 or 29. The GMLC maps the messages to the Request received in step 1b-2 and
invokes one or more Ngmlc_Location_EventNotify service operations towards the
NEF to convey UE locations or event reports. GMLC may aggregate one or more UE
location estimates / event reports in each message sent to NEF.
6b-2. The NEF invokes one or more Nnef_EventExposure_Notify service operations
towards the AF, to convey UE locations or event reports , received from GMLC
in step 6b-1.
6c. The GMLC receives response messages as defined in clause 6.1.2 step 22 or
23 or GMLC receives notification messages as defined in clause 6.3.1 steps 28
or 29. The GMLC sends one or more Ngmlc_Location_EventNotify to the NF to
convey UE locations or event reports.
7\. For the deferred location request, if any UE in the group didn\'t get its
serving AMF ID at step 4, the GMLC may store the LCS service request locally
if the GMLC supports the storage of the LCS service request for a group of UE;
otherwise, this step is skipped.
Further steps apply to the UEs of the group who was not registered to the
network when the LCS service request is received at GMLC.
8\. UE performs the registration as described in clause 4.2.2 of TS 23.502,
during which an AMF is selected to serve the UE, and the AMF ID is stored into
UDM.
9\. UDM notifies the GMLC who had subscribed the UE registration at step 5a
using Nudm_EventExposure_Notify service operation, which includes \"SUPI\" and
UE registration status.
10\. GMLC initiates Deferred 5GC-MT-LR Procedure as described in step 5b.
11a. The GMLC receives notification messages as defined in clause 6.3.1 step
28 or 29. The GMLC sends one or more LCS Service Responses to the LCS Client
to convey UE locations or event reports.
11b-1. The GMLC receives notification messages as defined in clause 6.3.1 step
28 or 29. The GMLC maps the messages to the Request received in step 1b-2 and
invokes one or more Ngmlc_Location_EventNotify service operations towards the
NEF to convey UE locations or event reports. GMLC may aggregate one or more UE
location estimates / event reports in each message sent to NEF.
11b-2. The NEF invokes one or more Nnef_EventExposure_Notify service
operations towards the AF, to convey event reports received from GMLC in step
11b-1.
11c. The GMLC receives notification messages as defined in clause 6.3.1 steps
28 or 29. The GMLC sends one or more Ngmlc_Location_EventNotify to the NF to
convey UE locations or event reports.
## 6.9 Procedures to Support Non-3GPP Access
### 6.9.1 Common Positioning Procedures when a UE is served by only one PLMN
Figure 6.9.1-1 shows the common positioning procedures to support location
services with non-3GPP access when UE is served by only one PLMN, which
provides either non-3GPP access only or both 3GPP access and non-3GPP access.
The common positioning procedures can be triggered by:
\- 5GC-NI-LR procedure (described in clause 6.10.1), which assumes that the
serving AMF is aware of the emergency session initiation - e.g. due to
supporting an Emergency Registration procedure or assisting in establishing an
emergency PDU Session. If such emergency session procedure is initiated via
non-3GPP access, the AMF provides access type to LMF in step 2 in clause
6.10.1,the LMF shall use the access type provided by AMF in step 2 in clause
6.9.1; or
\- 5GC-MT-LR procedure (described in clause 6.1.1 and 6.1.2 and 6.10.2), which
is applicable to a request from an LCS client for a current location.
\- 5GC-MO-LR procedure (described in clause 6.2), for this case, the access
type is selected by the UE using the UE Local Configuration to initiate MO-LR
procedure which is the same as the 5GC-MO-LR Procedure in clause 6.2 with
following differences:
\- The AMF shall in step 4 of clause 6.2 include UE connectivity state per
access type.
\- In step 5 of clause 6.2 the modification in this clause shall be applied,
the LMF shall also determine positioning methods and the positioning access
type, which can be different with the access type selected by the UE.
\- Deferred 5GC-MT-LR procedure for periodic, triggered and UE available
location events (described in clause 6.3.1), which is applicable to report of
location event for a deferred 5GC-MT-LR procedure.
\- Unified Location Service Exposure Procedure (described in clause 6.5),
which allows an NEF to provide location service exposure to an NF in HPLMN or
to an external AF outside the HPLMN when requested by the NF or the AF.
Figure 6.9.1-1: Common positioning procedures when UE is served by the one
PLMN
1\. The AMF invokes the Nlmf_Location_DetermineLocation service operation
towards the LMF to request the current location of the UE, which includes the
QoS requirement and UE connectivity state per access type.
2\. The LMF determines the positioning access type and the positioning method
based on the UE/network positioning capability, the QoS requirement and UE
connectivity state per access type received from the AMF and the locally
configured operator policy. The LMF may also determine the access type for
transmission of an LPP message to the UE (e.g. in order to ensure the UE will
be in a connected state for the selected positioning access type).
When the LPP protocol in TS 37.355 [20] is determined to be used to obtain
location information from the UE and the UE has both 3GPP and non-3GPP access,
the AMF shall decide which access type should be used to transmit the location
information if the LMF did not select an access type. For example, if the UE
is in CM-IDLE state in 3GPP access and in CM-CONNECTED state in Non-3GPP
access, AMF may prefer to select the N3IWF/TNGF/W-AGF to relay positioning
signalling to UE, rather than performing paging procedures via the 3GPP
access.
When the NRPPa protocol in TS 38.455 [15] is determined to be used to obtain
location information from the NG-RAN or N3IWF/TNGF/W-AGF:
\- In the case that 3GPP Access is determined to be used to transmit the
location information, the Network Assisted Positioning procedure in step 3b
and/or the obtaining Non-UE Associated Network Assistance Data procedure in
step 3c shall be performed.
\- In the case that non-3GPP Access is determined to be used to obtain the
location information, the Network Assisted Positioning procedure in step 3e
shall be performed.
When the LPP protocol in TS 37.355 [20] is determined to be used to obtain
location information from the UE:
\- In the case that 3GPP Access is determined to be used to relay the location
information, the UE Assisted and UE Based Positioning procedure in step 3a
shall be performed.
\- In the case that non-3GPP Access is determined to be used to relay the
location information, the UE Assisted and UE Based Positioning procedure in
step 3d shall be performed.
3a. This step is same as the UE Assisted and UE Based Positioning procedure in
clause 6.11.1.
3b. This step is same as the Network Assisted Positioning procedure in clause
6.11.2 with the difference that step 1 of clause 6.11.2 includes the selected
Access Type (i.e. 3GPP access). The AMF forwards the Network Positioning
message to the NG-RAN in step 3 of clause 6.11.2 based on the received Access
Type.
3c. This step is same as the Obtaining Non-UE Associated Network Assistance
Data procedure in clause 6.11.3.
3d. This step is same as the UE Assisted and UE Based Positioning procedure in
clause 6.11.1 with the following difference:
\- The NG-RAN in clause 6.11.1 is replaced by the N3IWF/TNGF/W-AGF in Figure
6.9.1-1;
\- Steps 2 and 5 in clause 6.11.1 are omitted;
\- The location information returned by the UE can include information
specified in clause 5.3.1.
3e. This step is same as the Network Assisted Positioning procedure in clause
6.11.2 with the following difference:
\- The NG-RAN in clause 6.11.2 is replaced by the N3IWF/TNGF/W-AGF in Figure
6.9.1-1;
\- Steps 2 and 4 in clause 6.11.2 are omitted;
\- The Access Type, i.e. non-3GPP access type, which is selected to provide
the location information is included in step 1 of clause 6.11.2. The AMF
forwards the Network Positioning message to the N3IWF/TNGF/W-AGF based on the
received Access Type in step 1 of clause 6.11.2.
\- The location information returned in step 5 of clause 6.11.2 is specified
in clause 5.3.1.
The UE is replaced by 5G-RG in the case of wireline access type.
### 6.9.2 MT-LR Procedures when a UE is served by Different PLMNs for 3GPP
Access and Non-3GPP Access
Figure 6.9.2-1 and Figure 6.9.2-2 show the enhanced MT-LR positioning
procedures to support location service with non-3GPP access when the UE is
served by different PLMNs for 3GPP access and non-3GPP access. The procedures
can be triggered by the 5GC-MT-LR Procedures described in clause 6.1.1, clause
6.1.2 and clause 6.3, which are applicable to a request from an LCS client for
an immediate current location or a deferred location.
Figure 6.9.2-1: MT-LR positioning procedures when UE is served by the two
VPLMNs
1\. The step is same as step 1 in clause 6.1.1 or clause 6.3.1.
2\. The step is same as step 2 in clause 6.1.1 or clause 6.3.1.
3\. The step is same as step 3 in clause 6.1.1 or clause 6.3.1 with the
difference that when the UE is served by more than one AMF the UDM provides to
the HGMLC for each access type,
\- serving AMF identity with the corresponding PLMN Id,
\- possibly a VGMLC address.
4\. When the HGMLC identifies that the UE is served by different PLMNs
according to the returned information from the UDM in step 3 it may retrieve
the CM state(s) per Access Type from the candidate AMFs by using
Namf_EventExposure service, or from the UDM using Nudm_EventExposure service.
The HGMLC selects one access type and its associated AMF based on the UDM
returned information in step 3, QoS requirement, CM state(s) per Access type
of the UE, PLMN identity and/or the locally configured operator policy.
NOTE: The locally configured operator policy in the HGMLC can include access
type and CM state and PLMN priority for positioning. For example, the local
policy can be 3GPP access first and/or connected state first and/or V-PLMN
and/or H-PLMN first.
5\. The HGMLC forwards the location request to the VGMLC-1 and may include the
V-AMF-1 identity received in step 3 and the target UE identity (e.g. SUPI).
6\. The VGMLC-1 invokes the Namf_Location_ProvideLocation_Request service
operation to forward the location request to the V-AMF-1. Then the V-LMF-1
receives the location request from the V-AMF-1.
7\. This step is same as step 2-3 of the Common Positioning Procedures in
clause 6.9.1.
8-9. The VGMLC-1 receive the location service response from the V-LMF-1 and
for a request for an immediate location, returns positioning results to the
HGMLC. For an immediate location, the location service response contains
positioning information, the information about the positioning method used and
the indication of whether the obtained location estimate satisfies the
requested LCS QoS (e.g. accuracy) or not (described in clause 9.1.1 of TS
23.271 [4]). For a request for a deferred location, the location service
response indicates whether the location request was accepted.
10\. For a request for an immediate location, if the HGMLC identifies that the
location service response from the chosen PLMN meets required LCS QoS, it
returns the results to the LCS Client directly. Otherwise, the HGMLC may
forward the location request to another AMF (in another PLMN) so as to obtain
the positioning result which can meet required LCS QoS shown as step 11. For a
request for a deferred location, if the HGMLC identifies that location service
was accepted (by the chosen PLMN), it returns this indication to the LCS
Client directly. Otherwise, the HGMLC may forward the location request to
another AMF (in another PLMN).
11\. This step obtains the immediate positioning information or requests a
deferred location from another PLMN, the details are the same as steps 5-9.
12-13. The HGMLC returns a location service response to the LCS client. For a
request for immediate location, if the positioning result from the other PLMN
meets the QoS requirement, the HGMLC returns it to the LCS client. Otherwise,
the HGMLC returns final location service response without including any
positioning result. For a request for deferred location, if the result from
the other PLMN indicates acceptance of the location request, the HGMLC returns
this to the LCS client. Otherwise, the HGMLC returns a final location service
response indicating failure of the deferred location request.
Figure 6.9.2-2: MT-LR positioning procedures when UE is served by HPLMN and
VPLMN
Figure 6.9.2-2 shows the MT-LR positioning procedures when the UE is served by
the H-PLMN and a V-PLMN. The difference with procedures shown in Figure
6.9.2-1 is that the HGMLC interacts with AMF directly shown in step 11 of
Figure 6.9.2-2 without involving VGMLC shown in step 11 of Figure 6.9.2-1. In
scenarios where the HGMLC prioritizes location by the H-PLMN rather than
V-PLMN at step 4, steps 5-9 may be replaced by step 11 and step 11 (when step
11 occurs) is then replaced by steps 5-9.
### 6.9.3 MO-LR Procedures when UE is served by the Different PLMNs via 3GPP
Access and Non-3GPP Access
When UE is served by the different PLMNs via 3GPP access and Non-3GPP access,
UE uses the UE Local Configuration to select the access to initiate MO-LR
procedure which is the same as the 5GC-MO-LR Procedure in clause 6.2. If
Non-3GPP access is selected, the following difference exists:
\- The NG-RAN in 5GC-MO-LR Procedure in clause 6.2 is corresponding to the
N3IWF/TNGF;
\- Step 5 in 5GC-MO-LR Procedure in clause 6.2 is the same as step 3d or 3e in
Common Positioning Procedure when UE is served by the same PLMN in clause
6.9.1.
### 6.9.4 NI-LR Procedures when a UE is served by Different PLMNs for 3GPP
access and non-3GPP access
When UE is served by the different PLMNs via 3GPP access and non-3GPP access,
the UE selects one access to register to the 5GC for emergency services as
defined in TS 23.167 [10], or request the establishment of a PDU Session
related to an emergency session.
The NI-LR procedures are the same as the 5GC-NI-LR Procedure (described in
clause 6.10.1) with the difference that:
\- if the procedures are performed for non-3GPP access, NG-RAN in Figure
6.10.1 is replaced by an N3IWF/TNGF/W-AGF and the UE Positioning in step 3 in
Figure 6.10.1 is performed according to steps 3d and 3e in Figure 6.9.1-1.
\- In step 2 in 5GC-NI-LR Procedure in clause 6.10.1, AMF also provides access
type to LMF. LMF shall use the access type provided by AMF for positioning.
The UE is replaced by 5G-RG in the case of wireline access type.
## 6.10 Procedures dedicated to Support Regulatory services
### 6.10.1 5GC-NI-LR Procedure
Figure 6.10.1-1 shows a Network Induced Location Request (NI-LR) procedure for
a UE in the case where the UE initiates an emergency session or other session
using NG-RAN. The procedure assumes that the serving AMF is aware of the
regulatory service associated with the session (e.g. emergency session
initiation - e.g. due to supporting an Emergency Registration procedure or
assisting in establishing an emergency PDU Session). The procedure can also be
used to verify UE location for NR satellite access.
Figure 6.10.1-1: 5GC Network Induced Location Request (5GC-NI-LR) for a UE
1\. A trigger for AMF to initiate the 5GC-NI-LR procedure happens, e.g. the UE
registers to the 5GC for emergency services or requests the establishment of a
PDU Session related to an applicable regulatory service (e.g. emergency
session initiation) or the AMF decides to verify UE location via LCS procedure
for a UE registered for NR satellite access.
2\. For verifying UE location via LCS service for NR satellite access this
step is mandatory, for other triggers this step is optional. The AMF selects
an LMF based on NRF query or configuration in AMF and invokes the
Nlmf_Location_DetermineLocation service operation towards the LMF to request
the current location of the UE. The service operation includes a LCS
Correlation identifier, the serving cell identity of the Primary Cell in the
Master RAN node and the Primary Cell in the Secondary RAN node when available
based on Dual Connectivity scenarios, and an indication of a location request
from a regulatory services client (e.g. emergency services) and may include an
indication if UE supports LPP, the required QoS and Supported GAD shapes, the
UE Positioning Capability if available. When AMF needs to know the
geographical area of the UE to check whether the PLMN is allowed to operate in
the area, an indication of this is included. When AMF needs to verify the
location of the UE when a UE registers via NR satellite access, the AMF
includes in indication in the request to the LMF that the request is for UE
location verification. If any of the procedures in clause 6.11.1 or 6.11.2 are
used the service operation includes the AMF identity. Optionally, the AMF may
also request UE related analytics containing UE location information (e.g., UE
mobility analytics) from NWDAF to assist with UE location verification for NR
satellite access as described in clause 6.21.2.
3\. [Conditional] If step 2 occurs, the LMF performs one or more of the
positioning procedures described in clause 6.11.1, 6.11.2 and 6.11.3. If the
AMF included an indication at step 2, the LMF maps the UE location to a
geographical area where a PLMN is or is not allowed to operate.
4\. [Conditional] If step 3 occurs, the LMF returns the
Nlmf_Location_DetermineLocation Response towards the AMF to return the current
location of the UE. The service operation includes the LCS Correlation
identifier, the location estimate, its age and accuracy and may include
information about the positioning method and the timestamp of the location
estimate. The service operation also includes the UE Positioning Capability if
the UE Positioning Capability is received in step 3 including an indication
that the capabilities are non-variable and not received from AMF in step 2.
When UE geographical area determination for location verification is indicated
at step 2, the service operation also returns the geographical area where a
PLMN is or is not allowed to operate determined at step 3.
NOTE 1: Any remaining procedures for regulatory services other than emergency
services are not addressed in this flow. The remaining steps are applicable
for emergency services.
5\. [Conditional] For emergency services, the AMF selects an GMLC based on NRF
query or configuration in AMF. The information regarding the endpoint in the
GMLC to deliver the event notification, is obtained from the NRF as specified
in clause 7.1.2 of TS 23.501 [18] or from local configuration in the AMF. AMF
invokes the Namf_Location_EventNotify service operation towards the selected
GMLC to notify the GMLC of an emergency session initiation. The service
operation includes the SUPI or the PEI, and the GPSI if available, the
identity of the AMF, an indication of an emergency session and any location
obtained in step 3.
6\. [Conditional] For emergency services, the GMLC forwards the location to an
external emergency services client or may wait for a request for the location
from the external emergency services client (not shown in Figure 6.10.1-1)
before forwarding the location.
7\. [Conditional] For emergency services, the emergency services session and
emergency PDU Session are released.
8\. [Conditional] For emergency services, the AMF invokes the
Namf_Location_EventNotify service operation towards the GMLC to notify the
GMLC that the emergency session was released to enable the GMLC and LRF to
release any resources associated with the emergency session.
### 6.10.2 5GC-MT-LR Procedure without UDM Query
Figure 6.10.2-1 illustrates a location request for an emergency services
session, where an emergency services client (e.g. a Public Safety Answering
Point) identifies the target UE and the serving LRF using correlation
information that was previously provided to it by the IMS Core. The signalling
used to provide the correlation information to the PSAP is defined in TS
23.167 [10]. The correlation information may be used by the LRF to retrieve
other information previously provided to it by the IMS Core and/or AMF as
described for Figure 6.10.1-1. This allows the GMLC associated with the LRF to
request a location from the AMF without needing to query the UDM of the target
UE for the serving AMF address. This scenario therefore supports location of
emergency sessions from roamers and USIM-less and other non-registered UEs,
and requires that identifying information for the UE and AMF have been
provided to the GMLC/LRF as described in clauses 6.10.1 and 6.10.3.
Figure 6.10.2-1: 5GC-MT-LR Procedure without UDM Query
1\. The external emergency services client (e.g. a PSAP) sends a request to
the LRF for a location for the target UE and includes correlation information
identifying the target UE. The request may include the required QoS and
Supported GAD shapes. The LRF address and the correlation information would
have been previously provided to the external client when the emergency
session from the UE was established.
2\. The LRF/GMLC determines the AMF by associating the correlation information
received from the external client with other information received previously
from the AMF as described in step 5 of clause 6.10.1 and step 7 of clause
6.10.3. The GMLC invokes the Namf_Location_ProvidePositioningInfo service
operation towards the AMF to request the current location of the UE. The
service operation includes the SUPI or the PEI and an indication of a location
request from an emergency services client and may include the required QoS and
Supported GAD shapes. The AMF identifies the target UE using the SUPI or in
the case of a USIM-less emergency session, or non-registered USIM emergency
session, the PEI.
3\. The AMF selects an LMF based on NRF query or configuration in AMF and
invokes the Nlmf_Location_DetermineLocation service operation towards the LMF
to request the current location of the UE. The service operation includes a
LCS Correlation identifier, the serving cell identity and an indication of a
location request from an emergency services client and may include an
indication if UE supports LPP, the required QoS and Supported GAD shapes, UE
Positioning Capability if available. If any of the procedures in clause 6.11.1
or clause 6.11.2 are used the service operation includes the AMF identity.
4\. The LMF performs one or more of the positioning procedures described in
clauses 6.11.1, 6.11.2 and 6.11.3.
5\. The LMF returns the Nlmf_Location_DetermineLocation Response towards the
AMF to return the current location of the UE. The service operation includes
the location estimate, its age and accuracy and may include information about
the positioning method and the timestamp of the location estimate. The service
operation also includes the UE Positioning Capability if the UE Positioning
Capability is received in step 4 including an indication that the capabilities
are non-variable and not received from AMF in step 3.
6\. The AMF returns the Namf_Location_ProvidePositioningInfo Response towards
the GMLC/LRF to return the current location of the UE. The service operation
includes the LCS Correlation identifier, the location estimate, its age and
accuracy and may include information about the positioning method and the
timestamp of the location estimate.
7\. The LRF sends the location service response to the external emergency
services client.
### 6.10.3 Location continuity for Handover of an Emergency session from NG-
RAN
Figure 6.10.3-1 shows support for location continuity for handover of an
emergency session from NG-RAN on the source side to either NG-RAN or another
3GPP RAN on the target side. The procedure applies when control plane location
according to Figures 6.10.1-1 and 6.10.2-1 is used for location of the UE on
the source side. The procedure is based on the procedures for location
continuity currently defined in clause 9.4.5.4 of TS 23.271 [4].
NOTE: If User Plane (SUPL) Location Protocol [bb] is used on the source (NG-
RAN) side, then the current procedure for location continuity in TS 23.271 [4]
can be used.
Figure 6.10.3-1: Location Continuity for Handover of an Emergency session from
NG-RAN
1\. Following the request for an emergency session, the UE establishes a PDU
Session for emergency services and an IMS emergency session for NG-RAN access,
during which an LRF is assigned in the serving network IMS and a source GMLC
may be chosen. The 5GC-NI-LR procedure of Figure 6.10.1-1 is also performed
which provides the source AMF identity to the GMLC and LRF and optionally an
initial location for the UE.
2\. At some later time, the LRF may need the UE location and requests the
source GMLC to invoke the Namf_Location_ProvidePositioningInfo service
operation towards the AMF to request the current location of the UE. The
service operation includes the SUPI or the PEI, the required QoS and an
indication of a location request from an emergency services client.
3\. If step 2 occurs or if support for an NI-LR is required, the source AMF
starts a location session to obtain the location of the UE as described in
clause 6.10.2 or clause 6.10.1.
4\. The source AMF receives a request to handover the UE to a cell associated
with a different target node which may be another AMF for intra-RAN handover
or a different type of node (e.g. an MME) for inter-RAN handover (e.g. to
E-UTRAN connected to EPC).
5\. The handover procedure is executed as specified in clause 4.9.1.3 of TS
23.502 [19].
6\. Any location session started in step 3 may terminate normally before step
6. If not, the source AMF shall abort the location session once step 5 is
complete.
7a. If steps 2 and 3 has occurred, the source AMF returns the
Namf_Location_ProvidePositioningInfo Response towards the GMLC to return any
location estimate and the timestamp of the location estimate (if available)
obtained for the UE. The service operation includes the target node identity.
7b. If steps 2 and 7a do not occur, the source AMF may invoke the
Namf_Location_EventNotify service operation towards the source GMLC (i.e. the
GMLC used in step 1) to indicate the handover. The service operation includes
the SUPI or the PEI and the GPSI if available, an event type indicating
handover and the identity of the target node.
8a. For inter-RAN handover (e.g. to E-UTRAN connected to EPC) and if control
plane location will be used on the target side, the target node (e.g. MME) may
send a Subscriber Location Report to a GMLC on the target side after
completion of the handover in step 6. The Subscriber Location Report carries
the UE identity (IMSI, MSISDN and/or IMEI), an event type indicating handover
and the identity of the target node. The target node may determine the target
GMLC from configuration information.
8b. For intra-RAN handover and if control plane location will be used on the
target side, the target AMF may invoke the Namf_Location_EventNotify service
operation towards the GMLC to indicate the handover. The service operation
includes the SUPI or the PEI and the GPSI if available, an event type
indicating handover and the identity of the target node.
9\. Reconfiguration of the LRF and the source and target GMLCs may occur in a
manner outside the scope of 3GPP.
10\. If the LRF needs a location estimate for the UE after handover has
occurred and if control plane location is used on the target side, the LRF may
instigate an MT-LR request via the target Node.
### 6.10.4 5GC-MT-LR multiple location procedure without UDM Query
Figure 6.10.4-1 illustrates an extension procedure of 5GC-MT-LR procedure
without UDM Query for the regulatory location service defined in clause
6.10.2.
This procedure is applicable for providing multiple location estimates of the
target UE to emergency services client.
Figure 6.10.4-1: 5GC-MT-LR Multiple Location Procedure without UDM Query
1\. Steps 1-3 for 5GC-MT-LR procedure without UDM Query in clause 6.10.2 are
performed with the following differences:
\- At step 1 in clause 6.10.2 the request from external emergency client (e.g.
a PSAP) location services client may include the acceptance of INTERMEDIATE
response and maximum response time.
\- At step 2 in clause 6.10.2 Namf_Location_ProvidePositioningInfo service
operation invoked by GMLC may include the acceptance of INTERMEDIATE response
and maximum response time, GMLC contact address and LIR reference number. The
LIR reference number is allocated by GMLC based on predefined rule.
\- At step 3 in clause 6.10.2 Nlmf_Location_DetermineLocation service
operation invoked by AMF may include the acceptance of INTERMEDIATE response
and maximum response time, GMLC contact address, and LIR reference number. AMF
can overwrite maximum response time to avoid timeout.
2\. LMF performs positioning procedures and determines multiple location
estimates during the session.
2.1 This step is executed if INTERMEDIATE response is available. The LMF
invokes an Nlmf_Location_EventNotify service operation towards GMLC and
provides the INTERMEDIATE location of the UE and timestamp of the location
estimate, and LIR reference number, and INTERMEDIATE event type.
2.2 This step is executed if step 2.1 was executed. The GMLC sends the
INTERMEDIATE location of the UE and timestamp of the location estimate to
external location services client.
3\. Based on step 5 in clause 6.10.2 the LMF returns the
Nlmf_Location_DetermineLocation Response towards the AMF to return the FINAL
location of the UE. LMF ensures that FINAL location will be transferred
towards AMF within the maximum response time.
4\. Steps 6-7 for 5GC-MT-LR procedure without UDM Query in clause 6.10.2 are
performed with the following differences:
\- At step 7 the FINAL location is sent from GMLC to the external services
client.
## 6.11 Common Sub-Procedures
### 6.11.0 General
The procedures defined in clause 6.11 are applicable to both a UE and PRU.
Wherever, a UE is referenced in these procedures, a PRU may be used instead.
### 6.11.1 UE Assisted and UE Based Positioning Procedure
Figure 6.11.1-1 shows a positioning procedure used by an LMF to support UE
based positioning, UE assisted positioning and delivery of assistance data.
The procedure is based on use of the LPP protocol defined in TS 37.355 [20]
between the LMF and UE.
Figure 6.11.1-1: UE Assisted and UE Based Positioning Procedure
**Precondition:** A LCS Correlation identifier and the AMF identity has been
passed to the LMF by the serving AMF.
1\. The LMF invokes the Namf_Communication_N1N2MessageTransfer service
operation towards the AMF to request the transfer of a Downlink (DL)
Positioning message to the UE. The service operation includes the DL
Positioning message. The Session ID parameter of the
Namf_Communication_N1N2MessageTransfer service operation is set to the LCS
Correlation identifier. The Downlink Positioning message may request location
information from the UE, provide assistance data to the UE or query for the UE
capabilities if the UE Positioning Capability is not received from AMF.
2\. If the UE is in CM IDLE state, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19] to
establish a signalling connection with the UE.
3\. The AMF forwards the Downlink Positioning message to the UE in a DL NAS
TRANSPORT message. The AMF includes a Routing identifier, in the DL NAS
TRANSPORT message, which is set to the LCS Correlation identifier. The
Downlink Positioning message may request the UE to response to the network,
e.g. may request the UE to acknowledge the Downlink Positioning message, to
return location information or to return capabilities, as defined in TS 37.355
[20].
4\. The UE stores any assistance data provided in the Downlink Positioning
message and performs any positioning measurements and/or location computation
requested by the Downlink Positioning message.
5\. If the UE has entered CM-IDLE state during step 4 and needs to responses
to the request received in step 3, the UE instigates the UE triggered Service
Request as defined in clause 4.2.3.2 of TS 23.502 [19] in order to establish a
signalling connection with the AMF.
6\. [Conditional] The UE sends to the AMF the Uplink Positioning message
included in a NAS TRANSPORT message, e.g. to acknowledge the Downlink
Positioning message, to return any location information obtained in step 4 or
returns any capabilities, as requested in step 3. When the UE sends Uplink
Positioning message in a NAS TRANSPORT message, the UE shall also include in
the UL NAS TRANSPORT message the Routing identifier received in step 3.
7\. [Conditional] The AMF invokes the Namf_Communication_N1MessageNotify
service operation towards the LMF indicated by the routing identifier received
in step 6. The service operation includes the Uplink Positioning message
received in step 6 and the LCS Correlation identifier. Steps 6 and 7 may be
repeated if the UE needs to send multiple Uplink Positioning messages to
respond to the request received in Step 3. Steps 1 to 7 may be repeated to
send new assistance data, and to request further location information and
further UE capabilities.
### 6.11.2 Network Assisted Positioning Procedure
Figure 6.11.2-1 shows a procedure that may be used by an LMF to support
network assisted and network based positioning. The procedure may be based on
an NRPPa protocol in TS 38.455 [15] between the LMF and NG-RAN.
Figure 6.11.2-1: Network Assisted Positioning Procedure
**Precondition:** A LCS Correlation identifier and the AMF identity have been
passed to the LMF by the serving AMF. In the case of PRU, LCS Correlation
identifier is generated by LMF and provided to AMF during PRU Registration
Accept message.
1\. The LMF invokes the Namf_Communication_N1N2MessageTransfer service
operation towards the AMF to request the transfer of a Network Positioning
message to the serving NG-RAN node (gNB or ng-eNB) for the UE. The service
operation includes the Network Positioning message and may indicate if the
positioning is initiated towards a PRU and the LCS Correlation identifier. The
Network Positioning message may request location information for the UE from
the NG-RAN and may include UE unaware indication if it is received by LMF from
AMF. LMF may provide an LPHAP indication to RAN in an NRPPa message, if
received in step 11 clause 6.1.2.
2\. If the UE is in CM IDLE state and there is no UE unaware indication for
the UE in the UE\'s location context, the AMF initiates a network triggered
Service Request procedure as defined in clause 4.2.3.3 of TS 23.502 [19], to
establish a signalling connection with the UE. If positioning towards a PRU is
indicated in step 1, the AMF verifies the UE is a valid PRU before initiating
the procedure.
If the UE is in CM-IDLE state and there is UE unaware indication for the UE in
the UE\'s location context, the AMF should reject the forwarding request of
the Network Positioning message with a proper rejection cause value and steps
3-6 are skipped.
3\. The AMF forwards the Network Positioning message to the serving NG-RAN
node in an N2 Transport message. The AMF includes a Routing identifier, in the
N2 Transport message, identifying the LMF.
4\. The serving NG-RAN node obtains any location information for the UE
requested in step 3.
If UE unaware indication is received in the Network Positioning message, and
the UE is in RRC_INACTIVE state, the NG-RAN rejects the Network Positioning
message with appropriate rejection cause (e.g. UE cannot be paged).
5\. The serving NG-RAN node returns any location information obtained in step
4 to the AMF in a Network Positioning message included in an N2 Transport
message. The serving NG-RAN node shall also include the Routing identifier in
the N2 Transport message received in step 3.
6\. The AMF invokes the Namf_Communication_N2InfoNotify service towards the
LMF indicated by the routing identifier received in step 5. The service
operation includes the Network Positioning message received in step 5 and the
LCS Correlation identifier. Steps 1 to 6 may be repeated to request further
location information and further NG-RAN capabilities.
### 6.11.3 Obtaining Non-UE Associated Network Assistance Data
Figure 6.11.3-1 shows a procedure which may be used by an LMF to support
network assisted and network based positioning. This procedure is not
associated with a UE location session. It is used to obtain network assistance
data from a NG-RAN node (e.g. gNB or ng-eNB). The procedure may be based on an
NRPPa protocol in TS 38.455 [15] between the LMF and NG-RAN.
Figure 6.11.3-1: Procedure for Obtaining Non-UE Associated Network Assistance
Data
NOTE: To support location service in the PNI-NPN, local AMF is used instead of
serving AMF, as defined in clause 5.13.
1\. The LMF invokes the Namf_Communication_NonUeN2MessageTransfer service
operation towards the AMF to request the transfer of a Network Positioning
message to a NG-RAN node (gNB or ng-eNB) in the NG-RAN. The service operation
includes the Network Positioning message and the target NG-RAN node identity.
The Network Positioning message may request position related information from
the NG-RAN.
2\. The AMF forwards the Network Positioning message to the target NG-RAN node
indicated in step 1 in an N2 Transport message. The AMF includes a Routing
identifier, in the N2 Transport message, identifying the LMF.
3\. The target NG-RAN node obtains any position related information requested
in step 2.
4\. The target NG-RAN node returns any position related information obtained
in step 3 to the AMF in a Network Positioning message included in an N2
Transport message. The target NG-RAN node shall also include the Routing
identifier in the N2 Transport message received in step 2.
5\. The AMF invokes the Namf_Communication_NonUeN2InfoNotify service operation
towards the LMF indicated by the routing identifier received in step 4. The
service operation includes the Network Positioning message received in step 4.
Steps 1 to 5 may be repeated to request further position related information
from the NG-RAN.
### 6.11.4 Positioning Procedure over User Plane
The flow below shows a positioning procedure used by an LMF and/or UE over
User Plane. The procedure is based on use of the LPP protocol defined in TS
37.355 [20] between the LMF and UE. Prerequisite of this procedures is User
Plane establishment between UE and LMF described in in clause 6.18.
Figure 6.11.4-1: Positioning Procedure over User Plane
1\. [Optional] The UE or LMF use the Secure UP transfer one or multiple LPP
message(s). If LMF starts the procedure the LMF may request location
information and/or measurements from the UE, and/or provide assistance data
to/from the UE and/or query for the capabilities; if UE starts procedure, UE
may request assistance data from LMF and/or providing location data and/or
capability information to LMF.
2\. [Optional] The UE or LMF processes capabilities information, assistance
data, and/or location measurements/calculations.
3\. [Optional] The UE or LMF may send one or multiple LPP message(s) using the
Secure UP transfer.
NOTE: Step 1, step 2 and step 3 can occur in any order, sequentially or
concurrently.
Editor\'s note: This procedure will be updated according to the protocol stack
decision made by CT WG1.
## 6.12 UE Location Privacy Setting Procedure
### 6.12.1 UE Location Privacy Setting Procedure Initiated by UE
Figure 6.12.1-1: UE Location Privacy Setting procedure initiated by UE
0\. NF (e.g. GMLC, NEF) may subscribe to UDM notifications of UE LCS privacy
profile updates.
NOTE: NF can decide to subscribe to such notifications while a deferred
location request is on-going.
1\. If the UE has generated or updated the UE Location Privacy Indication, the
UE sends the Location Privacy Indication to the AMF via UE Location Privacy
Setting Request in N1 NAS message. The UE Location Privacy Indication
indicates whether allows or disallows the subsequent LCS requests for the UE,
as defined in clause 5.4. If the UE has generated or updated the event report
expected area and optionally the area usage indication, e.g. based on UE power
status, the UE Location Privacy Setting Request includes the event report
expected area and the area usage indication.
2\. The AMF invokes a Nudm_ParameterProvision_Update (LCS privacy) service
operation towards the UDM and the service operation carries the Location
Privacy Indication information and may include event report expected area and
the area usage indication. The UDM stores or updates the UE LCS privacy
profile in the UDR by invoking a Nudr_DM_Update (SUPI, Subscription Data)
service operation accordingly.
3\. The AMF responses to the UE via UE Location Privacy Setting Response in N1
NAS message.
4\. UDM notifies the subscribed Network Function (e.g. GMLC, NEF) of the
updated UE LCS privacy profile via Nudm_SDM_Notification Notify message.
5\. NF (e.g. GMLC, NEF) may unsubscribe to UDM notifications of UE LCS privacy
profile updates e.g. if a deferred location procedure is cancelled.
### 6.12.2 UE Location Privacy Setting Procedure Initiated by AF
The procedure is defined by using the procedure in clause 4.15.6.2 of TS
23.502 [19] to set the Location Privacy Indication parameters and should in
addition unsubscribe to UDM notifications of UE LCS privacy profile updates
e.g. if a deferred location procedure is cancelled.
## 6.13 Procedures with interaction between 5GC and EPC
### 6.13.1 MT-LR Procedure
Figure 6.13.1-1 illustrates network positioning requested by the LCS clients
or the AF external to the PLMN for the case where the LCS Client or AF is
associated with a GMLC in 5GC domain and the UE is served by the EPC domain.
Both non-roaming and roaming scenarios are described. For non-roaming scenario
both the case of separate EPC GMLC and 5GC GMLC connected with Lr reference
point and the case with combined 5GC GMLC and EPC GMLC are described. For
roaming scenario, the 5GC GMLC in the HPLMN uses NL3 to interconnect with the
combined 5GC+EPCGMLC in the VPLMN.
Figure 6.13.1-1: MT-LR procedure with 5GC and EPC interaction
1\. Steps 1-3 in clause 6.1.2 are performed.
2\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, steps 2a
and 2b are skipped. Otherwise the 5GC GMLC may derive an address of a EPC GMLC
or 5GC+EPC GMLC, either received together with the network address of the
current serving node) from the UDM/HSS in step 1, by internal configuration or
by query to NRF.
2a. If an address of a EPC GMLC is derived, the 5GC GMLC then sends the Lr
location request to the EPC GMLC. If the result of privacy check indicates
that the notification (and verification) based on current location is needed,
the 5GC GMLC shall send a location request to the VGMLC indicating
\"positioning allowed without notification\".
2b. If an address of an 5GC+EPC GMLC is derived, the 5GC GMLC invokes a
Ngmlc_Location_ProvideLocation service operation towards the 5GC+EPC GMLC. If
the result of privacy check indicates that the notification (and verification)
based on current location is needed, the 5GC GMLC invokes the service request
indicating \"positioning allowed without notification\"
3 Steps 2-9 or 9b in clause 9.1.15 of TS 23.271 [4] are performed.
4\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, step 4a
and 4b are skipped. Otherwise the following applies:
4a. If step 2a was performed, the EPC GMLC forwards the location estimation of
the target UE, its age, its accuracy and optionally the information about the
positioning method to the 5GC GMLC.
4b. If step 2b was performed, the 5GC+EPC GMLC forwards the location
estimation of the target UE, its age, its accuracy and optionally the
information about the positioning method to the 5GC+EPC GMLC in a
Ngmlc_Location_ProvideLocation service Response.
5\. If the privacy check in step 1 indicates that further privacy checks are
needed, the 5GC GMLC shall perform an additional privacy check in order to
decide whether the 5GC GMLC can forward the location information to the LCS
client or AF or send a notification if the result of the privacy check
requires the notification and verification based on current location. One
example when this additional privacy check is needed is when the target UE
user has defined different privacy settings for different geographical
locations. When an additional privacy check is not needed, the (H)GMLC skips
steps 6-8.
6\. For non-roaming case and if5GC GMLC and EPC GMLC are combined, step 6a and
6b are skipped. Otherwise the following applies:
6a. If step 2a was performed and if the result of privacy checks in step 5
indicates that the notification (and verification) based on current location
is needed, and in the case of roaming, the 5GC GMLC shall send a location
request to the EPC GMLC indicating \"notification only\".
6b. If step 2b was performed and if the result of privacy checks in step 5
indicates that the notification (and verification) based on current location
is needed, and in the case of roaming, the 5GC GMLC shall invokes a
Ngmlc_Location_ProvideLocation service operation to the 5GC+EPC GMLC
indicating \"notification only\".
7\. The EPC post positioning notification and verification procedure in clause
9.1.18 of TS 23.271 [4] is performed.
8\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, step 8a
and 8b are skipped. Otherwise the following applies:
8a. If step 2a was performed, the EPC GMLC forwards an indication of the
result of notification and verification procedure to the 5GC GMLC.
8b. If step 2b was performed, the 5GC+EPC GMLC forwards an indication of the
result of notification and verification procedure to the 5GC GMLC.
9\. Steps 24 in clause 6.1.2 are performed.
### 6.13.2 MO-LR Transfer to a Third Party Procedure
Figure 6.13.2-1 illustrates the UE requesting its location to be sent to a
Third Party (i.e. an external LCS Client) for the case where the LCS Client is
associated with a GMLC in 5GC domain and the UE is served by the EPC domain.
Both non-roaming and roaming scenarios are described. For non-roaming scenario
both the case of separate 5GC GMLC and EPC GMLC connected with Lr reference
point and the case with co-located 5GC GMLC and EPC GMLC are described. For
roaming scenario, when the combined 5GC GMLC and EPC GMLC are deployed in the
HPLMN, it uses NL3 to interconnect with the EPCGMLC in the VPLMN.
Figure 6.13.2-1: MO-LR procedure with 5GC and EPC interaction
1Steps 1-6 in clause 9.2.6 of TS 23.271 [4] are performed.
2\. For non-roaming case and if 5GC GMLC and EPC GMLC is combined, this step
is skipped. Otherwise the EPC GMLC sends Location Update Notification Request
towards to the 5GC GMLC including the information received in step 1.
3 Steps 9-10 in clause 6.2 are performed.
4\. For non-roaming case and if 5GC GMLC and EPC GMLC are combined, this step
is skipped. Otherwise if the identified LCS Client is not accessible, the EPC
GMLC sends a Location Update Notification response to AMF with an appropriate
error cause. Otherwise, the response shall include an acknowledgement. The
message shall specify whether the location estimate of the UE has been handled
successfully by the identified LCS Client, and if not, the corresponding error
cause obtained in step.
5 Steps 13-14 in clause 9.2.6 of TS 23.271 [4] are performed.
## 6.14 Procedures for Broadcast of Assistance Data
### 6.14.1 Broadcast of Assistance Data by an LMF
The following procedure is used by the LMF to support broadcasting of network
assistance data to target UEs. This procedure is not associated with a UE
location session. It is used in an AMF to send network assistance data to an
NG-RAN node for broadcasting by the NG-RAN node to target UEs. NG-RAN
positioning procedures related to LMF and NG-RAN node communication are
specified in TS 38.455 [15].
Figure 6.14.1-1: Broadcasting Network Assistance Data
1\. The LMF invokes the Namf_Communication_NonUeN2MessageTransfer service
operation towards the AMF to request the transfer of a Network Assistance Data
message to an NG-RAN node (gNB or ng-eNB) in the NG-RAN. The service operation
includes the Network Assistance Data message and the target NG-RAN node
identity. The Network Assistance Data message includes assistance data which
may be optionally ciphered. LMF may send one or multiple sets of GNSS
assistance data to the target NG-RAN node.
LMF receives the GNSS assistance data by means of describing in clause 6.15,
or other means not specified in the present document.
2\. The AMF forwards the Network Assistance Data message to the target NG-RAN
node indicated in step 1 in an N2 Transport message. The AMF includes a
Routing identifier, in the N2 Transport message, identifying the LMF.
3\. The NG-RAN node broadcasts the assistance data contained in the Network
Assistance Data message.
4\. The target NG-RAN node may return feedback on assistance information
broadcasting to the AMF in a Network Assistance Feedback message. The target
NG-RAN node shall also include the Routing identifier in the N2 Transport
message received in step 2.
5\. The AMF invokes the Namf_Communication_NonUeN2InfoNotify service operation
towards the LMF indicated by the routing identifier received in step 4. The
service operation includes the Network Assistance Data Feedback message
received in step 4.
### 6.14.2 Delivery of Ciphering Keys to UEs for Broadcast Assistance Data
The following procedure is used by the LMF and the AMF to distribute ciphering
keys to UEs to enable UEs to decipher broadcast assistance data that was
ciphered by the LMF. This procedure is not associated with a UE location
session. The procedure makes use of the Registration procedure defined in TS
23.502 [19].
Figure 6.14.2-1: Delivery of Ciphering Keys to UEs for Broadcast Assistance
Data
1\. The LMF invokes the Nlmf_Broadcast_CipheringKeyData Notify service
operation towards the AMF carrying one or more ciphering keys used to cipher
network assistance data that is broadcast to UEs according to the procedure in
clause 6.14.1. For each ciphering key, the LMF includes a ciphering key value,
a ciphering key identifier, a validity period, a set of applicable tracking
areas and a set of applicable types of broadcast assistance data.
NOTE 1: The LMF may send a new ciphering key to the AMF at a time T1 if this
will start to be used to cipher network assistance data at a later time T2
(e.g. will replace a previous ciphering key which expires at time T2). The
value of (T2 - T1) should exceed the longest periodic registration timer of
any UE subscribed to receive ciphering keys to ensure that periodic
registration can be used to request new ciphering keys as described in note 2.
2\. The AMF stores the ciphering keys including the validity periods,
applicable tracking areas and the types of applicable broadcast assistance
data.
3\. A UE sends a Registration Request to a RAN node. The Registration Request
may be sent as part of normal mobility management, A Registration Request may
also be sent specifically to request and obtain ciphering keys. The UE
includes in the Registration Request an indication that ciphering keys are
requested. Other details of the Registration Request are as defined in TS
23.502 [19].
NOTE 2: A UE should request new ciphering keys using a Registration Request
caused by periodic registration if the remaining validity period for one or
more ciphering keys received earlier by the UE is less than the periodic
registration timer value. This can help avoid all UEs initiating a
Registration procedure at the same time to obtain new ciphering keys when a
validity period for a ciphering key is about to expire. A UE should also
request new ciphering keys for a Registration Request caused by entering a new
tracking area if previous ciphering keys are not applicable to the new
tracking area.
4\. The RAN node selects the AMF if the UE is in CM IDLE state or determines
the AMF for CM CONNECTED state.
5\. The RAN node forwards the Registration Request to the AMF.
6\. The AMF returns a Registration Accept to the RAN node as defined in TS
23.502 [19]. If the UE is subscribed to receive ciphered broadcast data, the
AMF includes in the Registration Accept one or more ciphering keys applicable
to the current tracking area for the UE. The AMF also includes for each
ciphering key the ciphering key value, the ciphering key identifier, the
validity period, the set of applicable tracking areas and the set of
applicable types of broadcast assistance data.
NOTE 3: The AMF does not need to keep a record of ciphering keys delivered to
a UE and may instead send all ciphering keys stored at step 2 that are
applicable to the current tracking area, for which the UE has a subscription
and whose validity period has not yet expired.
7\. The RAN node forwards the Registration Accept to the UE. The UE may start
to use each ciphering key to decipher network assistance data that is
broadcast according to the procedure in clause 6.14.1 once the validity period
for the ciphering key has started and if the UE is currently in an applicable
tracking area. The UE shall cease using a ciphering key when entering a
tracking area not applicable to the ciphering key. The UE shall cease using
and shall delete a ciphering key when the validity period for the ciphering
key has expired.
NOTE 4: A UE that receives no ciphering keys in response to a request for
ciphering keys may assume that the UE does not have a subscription to receive
ciphering keys in the serving PLMN.
8\. The AMF deletes all information for a ciphering key when the validity
period has expired.
## 6.15 Procedures for GNSS assistance data Collection
### 6.15.1 GNSS assistance data collection from untrusted AF via NEF
The following procedure is used by LMF to collect GNSS assistance information
from AFs via the NEF.
Figure 6.15.1-1: GNSS assistance data collection from untrusted AF
1a-1c. Reuse the steps 1a-1c in figure 6.2.2.3-1 of TS 23.288 [37] with
following difference:
\- The AF should also provide its serving area to NEF. NEF should map the
serving area into TA(s) if it is presented as geographical location and update
the NEF profile in NRF including the serving area information.
1d-1e. Reuse the steps 1d-1e in figure 6.2.2.3-1 of TS 23.288 [37] with
following difference:
\- When LMF needs to discovery the available data from AFs and the
appropriated NEF to collect GNSS assistance data, LMF additionally provides
TAs in the Nnrf_NFDiscovery_Request_request service operation.
2-5. Reuse the steps 2-5 in figure 6.2.2.3-1 of TS 23.288 [37] with following
difference:
\- Besides available GNSS assistance data, AF also provides associated serving
area of the GNSS assistance data and optional precise global coordinates of
the source of the GNSS assistance data. NEF may map the serving area into a TA
or TA list.
6\. After LMF gets the GNSS assistance data, it can send the assistance data
to UE via the procedures described in clauses 6.14 or 6.11.1 during a
positioning session.
### 6.15.2 GNSS assistance data collection from trusted AF
For trusted AFs, LMF collects GNSS assistance data through AFs directly. LMF
discovers trusted AFs covering LMF serving area through NRF and subscribes to
GNSS assistance data exposure from discovered trusted AFs.
Figure 6.15.2-1: GNSS assistance data collection from trusted AF
1a-1c. AF invokes Nnrf_NFManagement_NFUpdate_request service operation to
register its GNSS related information including Event IDs, and associated AF
identification, Application ID(s) and its serving area (TAs). NRF stores the
received AF update information and sends Nnrf_NFManagement_NFUpdate_response
message to AF.
1d-1e. When LMF needs to discovery the available GNSS assistance data from
AFs, LMF provide TAs to NRF through Nnrf_NFDiscovery service to discover
related AFs.
2\. LMF subscribes to or cancels subscription to GNSS assistance data in AF by
invoking the Naf_EventExposure_Subscribe/Naf_EventExposure_Unsubscribe service
operation.
3\. AF notifies the LMF with the available GNSS assistance data by invoking
Naf_EventExposure_Notify service operation. AF also provides associated
serving area (TAs) of the GNSS assistance data and optional precise global
coordinates of the source of the GNSS assistance data. The AF notifies the LMF
with the data by invoking Nnef_EventExposure_Notify service operation.
4\. After LMF gets the GNSS assistance data, it can send the data to UE via
the procedures described in clauses 6.14 or 6.11.1 during a positioning
session.
## 6.16 Periodic and Triggered 5GC-MT-LR Procedure with User Plane
### 6.16.1 Reporting of Location Events to an LCS Client or AF via user plane
Figure 6.16.1-1 shows a procedure for event reporting from a UE to an LCS
Client or AF when a User Plane connection is established directly from the UE
to the LCS Client or AF. This procedure is applicable when the target UE is
able to determine its location.
Figure 6.16.3-1: Reporting of Location Events to an LCS Client or AF via user
plane
1\. Steps 1-21 in clause 6.3.1 for the deferred 5GC-MT-LR procedure for
periodic or triggered location are performed with the following differences.
\- At step 1, the LCS Client or AF includes a request for user plane reporting
in the LCS Service Request and may include a user plane address of the LCS
Client or AF and security information to enable a secure connection. The
H-GMLC verifies that both the target UE and the LCS Client or AF are
subscribed to user plane reporting. If the LCS Client or AF did not include a
user plane address or security information, the H-GMLC obtains a default user
plane address and/or default security information from subscription data for
the LCS Client or AF. The H-GMLC determines criteria for sending cumulative
events reports over control plane. The criteria can include a cumulative event
report timer and/or a maximum number of user plane event reports.
\- At steps 4, 5 and 14, the request for user plane reporting, the user plane
address, the security information and the criteria for sending cumulative
events reports over control plane are forwarded in sequence to the V-GMLC (if
used), serving AMF and LMF.
\- At step 14 or step 15, the LMF gets the UE capabilities and verifies that
the UE is able to support position methods that allow the UE to determine its
own location.
\- At step 16, the LMF includes the request for user plane reporting, the user
plane address, the security information and the criteria for sending
cumulative events reports in the supplementary services LCS Periodic-Triggered
Invoke Request sent to the target UE.
\- At step 17, the target UE indicates to the LMF whether event reporting via
user plane can be supported by the target UE. If event reporting via user
plane cannot be supported by the target UE, a failure response is returned to
the LCS Client or AF at steps 18-21.
2\. The UE establishes a secure user plane connection with TLS to the LCS
Client or AF using the user plane address and the security information
received at step 1.
Editor\'s note: Support of a secure user plane connection and suitable
security information needs to be determined by SA WG3. The type of user plane
connection (e.g. TCP/IP) needs to be determined at stage 3.
3\. The UE monitors for and detects the occurrence of a trigger or periodic
event as described for step 22 of the procedure in clause 6.3.1.
4a. The UE obtains location measurements and determines a current location.
4b. If the UE is unable to determine its location at step 4a, the UE sends an
event report to the LCS Client or AF over control plane as described for steps
24-30 in clause 6.3.1.
5\. The UE sends an Event Report to the LCS Client or AF over the secure user
plane connection established at step 2. The event report indicates the type of
event being reported and includes the location determined at step 4a.
6\. The LCS Client or AF may return an Event Report Acknowledgment to the UE
over the secure user plane with TLS connection established at step 2.
Editor\'s note: Whether the event report and event report acknowledgment reuse
existing supplementary services messages or are defined using a new protocol
needs to be determined at stage 3.
7\. The UE continues to monitor for and detect further trigger or periodic
events as at step 3 and repeats steps 4-6 for each detected trigger or
periodic event.
8\. The UE monitors the criteria received at step 1 for sending of cumulative
event reports. If a cumulative event report timer was received at step 1, the
UE starts the timer following step 1 and after each cumulative event report is
sent. If a maximum number of user plane event reports was received at step 1,
the UE maintains a count of the number of user plane event reports sent at
step 5. When the cumulative event report timer expires or when the count of
user plane events reports sent at step 5 reaches the maximum number of user
plane event reports, the UE sends a cumulative event report and restarts the
timer and the count of user plane event reports. The UE sends the cumulative
event report to the LMF, H-GMLC and LCS Client or AF over the control plane
portion of the periodic or triggered deferred 5GC-MT-LR using steps 25-30 of
the procedure in clause 6.3.1. The cumulative event report indicates to the
LMF, H-GMLC and External LCS Client or AF that the control plane portion of
the periodic or triggered deferred 5GC-MT-LR is still active, that the UE is
reporting events via user plane and may include statistics on the events
reported since the last cumulative event report was sent (e.g. the number of
event reports).
A target UE may also send a cumulative event report at step 8 to obtain
assistance data from the LMF to assist with location at step 4a. In this case,
the target UE includes a positioning LPP request for assistance data in the
cumulative event report sent to the LMF at step 25 in clause 6.3.1 and the LMF
uses step 27 in clause 6.3.1. to return the requested assistance data to the
target UE. In this case, the cumulative event report timer and the count of
user plane event reports are restarted and a cumulative event report is sent
on to the H-GMLC and LCS Client or AF by the LMF (but without the embedded
positioning LPP request for assistance data).
During step 8, the LMF change procedure in clause 6.4 may be used to forward
the cumulative event report (and any request for assistance data) to another
LMF if the current LMF can no longer support the periodic or triggered MT-LR
due to a change in target UE location (e.g. a change to the target UE TAI). In
this case, the new LMF can return any assistance data to the UE (if this was
requested) and can forward the cumulative event report to the H-GMLC and LCS
Client or AF.
NOTE: When using step 8 to request assistance data, the UE may perform step 8
well before performing step 4a for a user plane event report in order to avoid
extra delay in sending the user plane event report.
9\. After the UE has sent the final event report and received an
acknowledgment using steps 5 and 6 or step 4b, the UE shall release the user
plane connection to the LCS Client or AF if the LCS Client or AF has not yet
initiated release of the user plane connection
### 6.16.2 Cancellation of Reporting of Location Events with a User Plane
Connection
A UE may cancel a deferred 5GC-MT-LR procedure for periodic, or triggered
location events where a user plane connection is used by the following the
procedure defined in clause 6.3.2. After the UE receives the acknowledgment of
the cancellation at step 6 in clause 6.3.2, the UE shall release the user
plane connection to the LCS Client or AF if the LCS Client or AF has not yet
initiated release of the user plane connection.
An AF or External LCS Client or a GMLC may cancel a deferred 5GC-MT-LR
procedure for periodic or triggered location where a user plane connection is
used by the following the procedure defined in clause 6.3.3. After the UE has
returned the acknowledgment of the cancellation at step 9 in clause 6.3.3, the
UE shall release the user plane connection to the LCS Client or AF if the LCS
Client or AF has not yet initiated release of the user plane connection.
## 6.17 Procedures applicable to a PRU
### 6.17.1 PRU Association Procedure
Figure 6.17.1-1 shows a procedure used by a PRU to associate as a PRU with a
serving LMF. The procedure is used for initial PRU Association with the
serving LMF which may occur when the PRU first starts to access the HPLMN. The
procedure can also be used to perform a PRU Association update to inform the
serving LMF of the continued availability of the PRU or to inform the serving
LMF of some change to the PRU such as a change of location (e.g. a change of
tracking area or change of serving AMF) or a change of the PRU positioning
capabilities. The PRU shall only perform the Association procedure in the
HPLMN.
Figure 6.17.1-1: PRU Association Procedure
**Precondition:** The PRU is currently registered in the HPLMN. For initial
PRU Association, a Routing Identifier may have been configured in the PRU
indicating the serving LMF. For subsequent PRU Association, a Routing ID
indicating a serving LMF has been returned to the PRU at step 6a or 6b of a
previous PRU Association procedure.
NOTE 1: A Correlation ID and a Routing ID are different terms for the same
identifier. The term \"Correlation ID\" is used for an identifier in service
operations between an AMF and LMF while the term \"Routing ID\" is used for an
identifier in a NAS message sent over the N1 reference point between a PRU and
AMF.
1\. The PRU performs a UE Triggered Service Request if in CM IDLE state.
2\. The PRU sends a supplementary services PRU Association Request to the
serving AMF in an UL NAS TRANSPORT message and includes any preconfigured
Routing ID for an initial Association or the Routing ID if received at step 6a
or step 6b for a previous PRU Association procedure. The PRU Association
Request is included in the UL NAS TRANSPORT message at the NAS level. The PRU
Association Request includes a reason for the PRU Association (e.g. initial
PRU Association, or PRU Association update), the PRU\'s positioning
capabilities, location information (if known) or PRU ON/OFF state.
3\. The AMF verifies whether the sender of the PRU Association Request is a
PRU using subscription information from the UDM. AMF verifies based on
subscription information or local policy if PRU can work as stationary PRU.
4\. The AMF selects the serving LMF based on the criteria defined in clause
5.1 or one of the Routing ID if included in the UL NAS TRANSPORT message of
step 2. The AMF may override the Routing ID based on criteria of clause 5.1.
The AMF transfers the PRU Association Request to the serving LMF using an
Namf_Communication_N1MessageNotify service operation. The AMF includes in the
Namf_Communication_N1MessageNotify service operation an indication of whether
the request corresponds to a PRU subscription and indication if PRU is
stationary. The AMF also includes the SUPI, TAI and cell ID of the PRU.
5a. If the AMF indicates in step 4 that the request corresponds to a PRU and
if the LMF can accept the PRU Association, the serving LMF returns a PRU
Association Accept, as a supplementary services message, using
Namf_Communication_N1N2MessageTransfer service operation towards the AMF, and
a Correlation ID. The Correlation ID is assigned by the serving LMF to
identify the serving LMF and optionally the PRU. The PRU Association Accept
indicates conditions for performing PRU Association updates with the serving
LMF which may include a periodic PRU Association update timer and PRU
Association update based on a change of PRU location, change of PRU TAI,
change of serving AMF, or change of PRU ON/OFF state. For a PRU whose state is
OFF, PRU information is kept at the serving LMF.
NOTE 2: A periodic PRU Association is independent of a periodic NAS
Registration and may occur with greater, equal or lesser frequency.
6a. The serving AMF forwards the PRU Association Accept and a Routing ID equal
to the Correlation ID to the PRU in a DL NAS TRANSPORT message. The PRU stores
the Routing ID which is used for any further PRU Association update with the
serving LMF. This Routing ID overrides any Routing ID used in previous
Association updates, if any.
5b. If the AMF indicates in step 4 that the request does not correspond to a
PRU subscription or if the serving LMF cannot accept the PRU Association for
some other reason (e.g. the serving LMF is not the correct serving LMF for the
PRU), the serving LMF returns a PRU Association Reject message, using
Namf_Communication_N1N2MessageTransfer service operation towards the AMF, and
may include the Routing ID of a new serving LMF if the request at step 4
corresponds to a PRU.
6b. The serving AMF forwards the PRU Association Reject in a DL NAS TRANSPORT
message to the PRU.
7\. If PRU Association is performed successfully as in steps 5a and 6a, the
serving LMF may optionally verify any PRU location provided at step 4 or
obtain a more accurate location of the PRU using the procedures defined in
clause 6.11. The LMF also stores information received for the PRU. If PRU
Association update including only a state change is performed, the serving LMF
may consider the previously verified PRU location is valid.
8\. If PRU Association is performed successfully as in steps 5a and 6a and if
this is an initial PRU Association or if this is a PRU Association update and
information for the PRU has changed and if PRU is stationary the serving LMF
may optionally instigate an Nnrf_NFManagement_NFUpdate Request service
operation towards an NRF and includes an existence indication of a PRU
associated with a TAI.
The LMF also indicates to the NRF to remove the TAI associated existence of
PRU(s) when there are no longer any PRUs associated in the LMF for this TAI.
9\. If step 8 requested by LMF the NRF returns a confirmation response to the
serving LMF.
10\. After being rejected at step 6b, if there are new available Routing
ID(s), the PRU may perform a PRU Association procedure with the new serving
LMF.
NOTE 3: The PRU may be configured with a limit on the number and/or duration
of unsuccessful PRU Association attempts. When this limit is reached the PRU
considers itself disassociated.
### 6.17.2 LMF Initiated PRU Disassociation Procedure
Figure 6.17.2-1 shows a procedure used by a serving LMF to disassociate an
already associated PRU. The procedure may be used prior to the serving LMF
becoming unavailable (e.g. for maintenance, removal or replacement) or to
transfer the PRU to a different serving LMF for other reasons.
Figure 6.17.2-1: LMF Initiated PRU Disassociation Procedure
**Precondition:** The PRU has previously associated with the serving LMF using
the procedure in clause 6.17.1.
1\. The serving LMF sends a PRU Disassociation Request as a supplementary
services message, using the Namf_Communication_N1N2MessageTransfer service
operation, and a Correlation ID identifying the serving LMF. The PRU
Disassociation Request may include a Routing ID for a new serving LMF.
NOTE: The Correlation ID for the serving LMF is transferred to the serving AMF
to provide the Routing ID for step 3. The Routing ID for a new serving LMF, if
provided, is included inside the PRU Disassociation Request and is not visible
to the serving AMF. This Routing ID is different to the Routing ID for steps
3, 4 and 5 and enables the PRU to perform an Association with a new serving
LMF at step 8.
2\. If the PRU is in CM IDLE state, the serving AMF performs a Network
Triggered service request to place the PRU in CM CONNECTED state.
3\. The serving AMF forwards the PRU Disassociation Request and a Routing ID
equal to the Correlation ID to the PRU using DL NAS TRANSPORT message.
4\. The PRU returns a supplementary services PRU Disassociation Accept to the
serving AMF in an UL NAS TRANSPORT message and includes the Routing ID
received in step 3.
5\. The serving AMF forwards the PRU Disassociation Accept to the serving LMF
indicated by the Routing ID received at step 4 and includes a Correlation ID
equal to the Routing ID.
6\. If the serving LMF has indicated the PRU to an NRF during PRU Association
and if serving LMF does not have any PRU to the TAI, the serving LMF issues an
Nnrf_NFManagement_NFUpdate Request service operation towards the NRF and
requests an indication of PRU removal. The NRF then removes the TAI associated
PRU existence indication.
7\. The NRF returns a confirmation response to the serving LMF.
8\. If the PRU received a new Routing ID for a new serving LMF at step 3, the
PRU may perform a PRU Association with the new serving LMF as described in
clause 6.17.1.
### 6.17.3 PRU Initiated PRU Disassociation Procedure
Figure 6.17.3-1 shows a procedure used by a PRU to disassociate from a serving
LMF. The procedure may be used prior to the PRU becoming unavailable (e.g. for
a software upgrade or power down) or when the PRU will be transferred to a
different serving LMF.
Figure 6.17.3-1: PRU Initiated PRU Disassociation Procedure
**Precondition:**
The PRU has previously associated with the serving LMF using the procedure in
clause 6.17.1 and is currently registered in the HPLMN.
1\. The PRU performs a UE Triggered Service Request if in CM IDLE state.
2\. The PRU sends a supplementary services PRU Disassociation Request to the
serving AMF in an UL NAS TRANSPORT message and includes the Routing ID
received at step 6a for the procedure in clause 6.17.1 for a previous PRU
Association procedure. The PRU also indicates whether an acknowledgment is
expected. The PRU Disassociation Request is included in the UL NAS TRANSPORT
message at the NAS level.
NOTE 1: A PRU could indicate whether an acknowledgment is expected according
to whether the PRU expects to be still able to receive the acknowledgment at a
later time.
3\. The AMF verifies whether the sender of the PRU Disassociation Request is a
PRU using subscription information from the UDM.
4\. The AMF selects the serving LMF based on the Routing ID and optionally the
current TAI and transfers the PRU Disassociation Request to the serving LMF
using an Namf_Communication_N1MessageNotify service operation. The AMF
includes in the Namf_Communication_N1MessageNotify service operation an
indication of whether the sender of the PRU Disassociation Request is a PRU.
The AMF also includes the SUPI of the PRU.
5\. The serving LMF verifies that the PRU is currently associated in the
serving LMF. If the PRU is not currently associated in the serving LMF, the
serving LMF performs steps 6 and 7 but not steps 8 and 9.
NOTE 2: Inconsistency between Association in a PRU versus a serving LMF might
arise if a PRU is powered off or loses network coverage and if the serving LMF
then performs an LMF initiated PRU Disassociation.
6\. If the PRU has indicated that an acknowledgment is expected, the serving
LMF returns a PRU Disassociation Accept, as a supplementary services message,
using an Namf_Communication_N1N2MessageTransfer service operation towards the
AMF, and a Correlation ID.
7\. The serving AMF forwards the PRU Disassociation Accept and a Routing ID
equal to the Correlation ID to the PRU in a DL NAS TRANSPORT message.
8\. If the serving LMF has indicated the PRU to an NRF during a previous PRU
Association and if serving LMF does not have any PRU to the TAI, the serving
LMF invokes an Nnrf_NFManagement_NFUpdate Request service operation towards
the NRF and requests an indication of PRU removal. The NRF then removes the
TAI associated PRU existence indication.
9\. The NRF returns a confirmation response to the serving LMF.
### 6.17.4 Positioning of a target UE
Figure 6.17.4-1 shows a procedure used by a serving LMF for a target UE to
obtain a location of the target UE using location information provided by one
or more PRUs.
Figure 6.17.4-1: Location of a target UE using PRUs
1\. The serving LMF for the target UE and other PRU serving LMFs may use the
procedures defined in clause 6.11 to obtain location information from one or
more PRUs associated in the serving LMF and in the other PRU serving LMFs that
is not related to the target UE. For example, the location information may
include location information for the PRU(s) or for the NG-RAN or both.
2\. The serving LMF for the target UE receives a location request from the
serving AMF for the target UE. The location request may be included in an
Nlmf_Location_DetermineLocation Request service operation for a 5GC-MO-LR,
5GC-MT-LR or 5GC-NI-LR for the target UE. Alternatively, the location request
may be implied by receipt of an Namf_Communication_N1MessageNotify service
operation carrying a supplementary services event report from the target UE
for a periodic or triggered 5GC-MT-LR.
3\. The serving LMF uses the procedures defined in clause 6.11 to obtain
location information for the target UE from the target UE and/or from the NG-
RAN and may determine pre-calculated location of target UE. During the
procedures, the LMF decides to use PRUs to improve the positioning result.
4\. The serving LMF selects one or more PRUs associated with the serving LMF
based on the PRU ON/OFF state information to assist in locating the target UE.
The selected PRU(s) may be nearby to an initial location estimate for the
target UE obtained at step 3 or indicated by a serving cell identifier for the
target UE received at step 2.
NOTE 1: The PRU selection criteria are implementation specific and may be
based on operator policies.
5\. The serving LMF may optionally invoke an Nnrf_NFDiscovery Request service
operation to an NRF. The service operation includes a PRU indication and an
area which could be TAs decided by the serving LMF of the target UE based on
the serving cell of the target UE.
6\. If step 5 is performed, the NRF selects one or more other PRU serving LMFs
based on the PRU indication and the area received in step 5 and sends an
Nnrf_NFDiscovery Response to the serving LMF of target UE. The service
operation includes the profiles of the other PRU serving LMFs selected by the
NRF.
7\. If steps 5 and 6 are performed, the serving LMF of the target UE may send
an Nlmf_Location_MeasurementData Request service operation to one or more of
the other PRU serving LMFs indicated at step 6. The service operation for each
of the other PRU serving LMFs includes target UE cell ID or pre-calculated
location of target UE in step 3.
8\. The serving LMF uses the procedure defined in clause 6.11.1 to obtain
location information (e.g. PRU location coordinates, associated location
quality/uncertainty of the PRU together with any performed location
measurements) related to the target UE from the PRU(s) selected at step 4.
9\. If steps 5-7 are performed and if PRU information is included in the PRU
serving LMF profile sent by the NRF to the target UE serving LMF, each of the
other PRU serving LMFs for step 7 uses the procedure defined in clause 6.11.1
to obtain the location measurements and/or location requested at step 7 from
each of the PRUs identified at step 7 for this LMF.
If steps 5-7 are performed PRU serving LMFs for step 7 selects one or more
PRUs based on the locally associated PRU information and information in the
location measurements requested (the target UE cell ID, or pre-calculated
location of target UE), and uses the procedure defined in clause 6.11.1 to
obtain the location measurements requested at step 7 from each of the selected
PRUs.
NOTE 2: Steps 3, 8 and 9 can be performed in any order, including
simultaneously. A common scheduled location time may be used if the LMF
determines that simultaneous measurements for UE and PRU(s) are desirable.
10\. If step 9 is performed, each of the other PRU serving LMFs for step 9
returns the location measurements and the known PRU location obtained from
PRUs at step 9 to the serving LMF for the target UE.
11\. The serving LMF for the target UE determines the location of the target
UE based on the location information obtained at step 1 (if step 1 is
performed), step 3, step 8 and step 10.
12a. If an Nlmf_Location_DetermineLocation Request service operation for a
5GC-MO-LR, 5GC-MT-LR or 5GC-NI-LR was received at step 2, the serving LMF
returns the location estimate of the target UE to the serving AMF.
12b. If an Namf_Communication_N1MessageNotify service operation carrying a
supplementary services event report from the target UE for a periodic or
triggered 5GC-MT-LR was received at step 2, the serving LMF sends an event
report for the target UE to a GMLC with the location estimate obtained at step
11 as described in clause 6.3.1.
## 6.18 Procedures of User Plane Connection between UE and LMF
### 6.18.0 General
Clause 6.18 describes the management of the user plane connection between UE
and LMF. LMF or UE may trigger the establishment of the user plane connection.
UE and LMF may maintain the established user plane connection. LMF may modify
or terminate the established user plane connection between UE and LMF.
**Precondition:**
The LMF can send its user plane information (i.e. IP address or FQDN) to the
UE via a DL NAS TRANSPORT message of the AMF. If LMF sends its FQDN to the UE,
a DNS server/resolver is used to resolve the IP address of LMF (e.g. EASDF or
local DNS for local LMF address resolution). UE uses URSP which includes user
plane positioning related PDU session parameters (e.g. a dedicated DNN and
S-NSSAI) to establish a PDU session used for user plane positioning. SMF
should select a PSA UPF (located in central site or local site) connecting
with the LMF for this PDU session, based on S-NSSAI, DNN and UE location
information, etc.
Session break out for local LMF service for user plane positioning can be
supported by preconfiguring SMF with local LMF(s) IP address(es)/network
prefix(es) and their DNAIs for positioning dedicated PDU session in certain
service area(s) for local PSA and UL CL/BP insertion.
NOTE 1: Based on preconfigured local LMF information, SMF can subscribe to UE
location information from AMF and perform additional local PSA and UL CL/BP
insertion and corresponding forwarding rules configuration if UE moves to a
location where it can be served by local LMF(s).
NOTE 2: In this Release, to avoid LMF selection conflicts, the LMFs use their
dedicated FQDNs which are different from each other, but their FQDNs can have
common parts in support of usage as Traffic descriptor in URSP.
NOTE 3: It is up to operator to determine appropriate QoS parameters for user
plane connection between UE and LMF.
### 6.18.1 LMF initiated User Plane Connection
LMF may trigger the user plane connection establishment after receiving a
location request from AMF if target UE does not have user plane connection
with LMF. AMF also subscribes from LMF the status of LCS user plane connection
for the target UE, using a Nlmf_Location_UP Subscribe message if the UE
supports user plane positioning. Figure 6.18.1-1 shows a procedure triggered
by LMF to support positioning over the user plane connection between UE and
LMF.
Figure 6.18.1-1: Positioning via a User Plane Connection between UE and LMF
initiated by LMF
1\. Based on UE user plane positioning capability, control plane congestion
status (e.g. AMF load status) and other implementation factors, LMF decides
whether to use the positioning procedure via a user plane connection between
UE and LMF.
LMF may invoke Nnrf_NFDiscovery service operation to retrieve control plane
congestion status (e.g. AMF load information). Based on AMF load information,
LMF may determine to use user plane positioning, if there is available user
plane connection between UE and LMF.
Steps 2-7 are skipped if there is already a user plane connection context of
the target UE in LMF and LMF determines to utilize the user plane connection
for positioning.
NOTE: LMF can select user plane positioning for specific positioning methods
(e.g. motion sensor-based method) and it is based on implementation and local
configuration to determine which positioning method requires user plane
transport.
2\. [Conditional] If LMF decides to utilize user plane for positioning and
there is no established secure user plane connection between the UE and LMF,
LMF invokes Namf_communication_N1N2Transfer service operation to send the user
plane information to AMF in a NAS container to indicate UE to utilize user
plane over TLS for positioning. The user plane information includes the user
plane positioning address of the LMF, security related information.
Editor\'s note: The security mechanism and security information provided by
LMF to UE is subject to SA WG3\'s work.
3\. [Conditional] When AMF receives the user plane information from LMF in
step 2, AMF sends it to UE via a DL NAS TRANSPORT message.
4\. [Conditional] If there is no established applicable PDU session for the
user plane positioning, the UE uses the URSP as defined in TS 23.503 [41]
which includes user plane positioning related PDU session parameters, e.g. a
dedicated DNN and S-NSSAI, to establish the PDU session for user plane
positioning. UE may send an acknowledgement to LMF through AMF to indicate a
success of utilization of a user plane connection for positioning service or a
failure to utilize the user plane connection, e.g. no suitable PDU session
established.
5\. [Conditional] AMF sends the acknowledgement received in step 4 to the LMF
via Namf_N1messageNotify service.
6\. [Conditional] If LMF knows the UE IP address information, LMF may notify
UE to setup the secure user plane connection through the known UE IP address.
Editor\'s note: It is stage 3 to check and decide the protocol used by LMF to
notify UE through the known UE IP address.
7\. [Conditional] UE establishes a secured user plane connection with LMF. If
LMF send its FQDN to the UE, a DNS server/resolver is used to resolve the IP
address of LMF (e.g. EASDF or local DNS for local LMF address resolution).
Editor\'s note: IP address and/or FQDN as LMF address information needs to be
checked/verified based on CT1/CT3 feedback.
8\. [Conditional] LMF indicates AMF in the Nlmf_Location_UPNotify message that
user plane connection between the UE and LMF has been established.
9\. [Conditional] The AMF stores the LCS-UP connection context as part of UE
context.
10\. If LMF or UE determines to utilize the user plane connection for
positioning and the secure user plane connection is established, LPP messages
are transferred between UE and LMF for UE based positioning, UE assisted
positioning and delivery of assistance data. Supplementary services event
report messages from UE may also be transferred to LMF via the established
user plane connection.
### 6.18.2 UE initiated User Plane Connection
UE may trigger the user plane connection establishment if the UE does not have
user plane connection with LMF. Figure 6.18.2-1 shows a procedure triggered by
UE to support positioning over the user plane connection between UE and LMF.
Figure 6.18.2-1: Positioning via a User Plane Connection between UE and LMF,
initiated by UE
1\. UE sends a user plane establishment request to AMF via NAS Message, if UE
decides to request a user plane connection for upcoming positioning requests.
2\. [Conditional] If the UE is authorized based on UE Subscription to use the
user plane positioning, AMF selects an LMF which capable to establish a user
plane session for positioning with the UE. AMF may either query the NRF or
based on local configuration to discover and select a proper LMF.
3\. [Conditional] The AMF sends a Nlmf_Location_UPConfig Request towards LMF
to request set up of an LCS-UP connection.
4\. [Conditional] If LMF accept to utilize user plane for positioning and
there is no established secure user plane connection between the UE and LMF,
LMF sends a user plane information to AMF to indicate UE to accept and utilize
user plane for positioning. The user plane information includes the user plane
positioning address of the LMF, security related information.
5\. [Conditional] When AMF receives the user plane information from LMF in
step 4, AMF forwards it to UE via a DL NAS TRANSPORT message.
6\. [Conditional] If there is no established secure user plane connection, UE
establishes a secured user plane connection with LMF. UE uses the user plane
positioning address of the LMF, together with the information in the URSP, to
determine the PDU session parameters including DNN+S-NSSAI. UE uses the PDU
session parameter to establish PDU session. When SMF receives the request, it
selects a proper UPF based on the DNN+S-NSSAI, and establish the connection
between the UPF and LMF.
7\. [Conditional] LMF responds to AMF that user plane connection between the
UE and LMF has been established.
8\. [Conditional] The AMF stores the LCS-UP connection context as part of UE
context
9\. [Conditional] After the secure user plane connection is established, if
LMF determines to utilize the user plane connection for positioning after
receiving a positioning request from AMF, or UE determines to utilize the user
plane connection for positioning, LPP messages are transferred between UE and
LMF for UE based positioning, UE assisted positioning and delivery of
assistance data. Supplementary services event report messages from UE may also
be transferred to LMF via the established user plane connection.
### 6.18.3 Modification of User Plane Connection between UE and LMF
The figure 6.18.3-1 shows how a secure user plane connection between UE and
LMF is modified. The flow describes change of LMF but applies also when source
and target LMF is the same. The procedure can also be used to terminate the
user plane connection to Source LMF not selecting any Target LMF.
Figure 6.18.3-1: Connection modification between UE and LMFs
1a. [Conditional] The LMF discovers a need to change LMF or re-establish the
user plane connection between UE and LMF or terminate the user plane
connection. The LMF sends an Nlmf_Location_UPNotify message that includes
connection move (termination and establishment) or termination is required and
if connection move is requested then message may include target LMF
identification. The address of the AMF was provided to LMF as a \"Notification
Target Address\" in latest Nlmf_Location_UPConfig message or Nlmf_Location_UP
Subscribe message.
NOTE: The LMF change procedure is independent from the SSC mode of the PDU
Session with dedicated DNN used for positioning. For SSC mode 2/3, PSA UPF
connection with the LMF can be relocated with UE movement and LMF can discover
the need to change LMF to reduce the user plane path latency.
1b. [Conditional] AMF based on target LMF identification received from source
LMF for user plane positioning, or AMF may perform LMF reselection if UE moves
to a new location (which may be out of serving area of source LMF and in
serving area of target LMF) and select the target LMF for the current UE
location based on LMF service area, LMF user plane positioning capability
information and other information listed in clause 5.1. LMF needs to be
capable to establish a user plane session for positioning with the UE. Further
at AMF relocation the target AMF needs to inform the LMF of the AMF change.
2\. [Conditional] If AMF reallocation has occurred, this step is skipped.
Otherwise, steps 3-8 of figure 6.18.2-1 are performed between AMF, UE, and
Target LMF with addition that UE also terminate connection to Source LMF.
3\. The AMF sends an Nlmf_Location_UPConfig Request towards the source LMF.
The message may include a request for the Source LMF to terminate a specific
user plane connection to the UE and the Target LMF identification.
Alternatively, it may include information about AMF reallocation.
4-5.[Conditional] The source LMF may invoke an
Nlmf_Location_LocationContextTransfer Request service operation towards the
target LMF to provide the current location context of the UE, if there is
periodic and triggered UE location events report context. The target LMF
informs source LMF of the location context transfer operation results.
6\. [Conditional] If the user plane connection to source LMF is still active,
the source LMF terminates the connection to the UE.
7\. The LMF sends Nlmf_Location_UPConfig Response message to AMF to confirm
connection termination or acknowledge change of AMF. If this procedure is used
for termination, the AMF will release the LCS-UP context after receiving the
response message.
## 6.19 Location Service Continuity between EPS and 5GS
### 6.19.0 General
Clause 6.19.1 describes the location service continuity procedure from 5GS to
EPS for Immediate Location Request. Clause 6.19.2 describes the location
service continuity procedure from EPS to 5GS for Immediate Location Request.
Clause 6.19.3 describes the location service continuity procedure for deferred
MT-LR and also includes the 5GS to EPS case and EPS to 5GS case. GMLC in
Figure 6.19-1 and Figure 6.19-2 can be a single co-located EPC-GMLC and 5GC-
GMLC or a separate EPC-GMLC and 5GC-GMLC with the non-standardized Lr\'
interface.
### 6.19.1 Location Service Continuity for Immediate Location Request
#### 6.19.1.1 Location Service Continuity from 5GS to EPS with N26 Interface
for Immediate Location Request
Figure 6.19.1.1-1: Location Service Continuity from 5GS to EPS with N26
Interface for Immediate Location Request
1\. Target UE positioning is started in 5GS, e.g. steps 1-12 of 5GC-MT-LR
procedure in clause 6.1.2, or steps 1-5 of 5GC-MO-LR procedure in clause 6.2.
2\. LMF handles the ongoing LCS session
3\. 5GS to EPS handover happens successfully as described in figure
4.11.1.2.1-1 of TS 23.502 [19] - AMF receives the relocation complete
notification message from MME and record the target MME ID.
4\. AMF instructs the LMF to cancel the ongoing LCS session.
5\. The LCS Session on 5GS is cancelled by LMF.
6\. LMF sends the Nlmf_Location_DetermineLocation Response to AMF after the
cancellation is complete, LMF may include the current available location
result in the response even it doesn\'t meet the requested QoS.
7\. [Conditional] If the location request is received from 5GC-GMLC, AMF
responds failure to the 5GC-GMLC with Namf_Location_ProvidePositioningInfo
Response indicating failure of the LCS session with cause = HO to EPC while
also including the target MME ID for the UE. The response may contain the
location result from LMF at step 6.
NOTE: The LCS session cancellation with the UE and NG-RAN is to be completed
before the UE is handed over to LTE.
8\. [Conditional] If the step 7 is performed, the 5GC-GMLC forwards the
location request to the EPC-GMLC including all the parameters of the LCS
Request and the target MME ID. The location result from step 6 and 7 may also
be included as one of the candidates of EPC-GMLC\'s location result.
9\. The EPC-GMLC may reconstruct the request (e.g. area information in EUTRA
for area event), it forwards the LCS Request to the Target MME received at
step 8 in the case of MT-LR. The LCS session is started in EPS (e.g. steps
2-10 in Figure 9.18 of TS 23.271 [4]). In the case of MO-LR, the UE restarts
the EPC-MO-LR.
10\. [Conditional] If step 8 is performed, the UE location estimate is
returned by the EPC-GMLC to the 5GC-GMLC
11\. [Conditional] If step 10 is performed, 5GC-GMLC forwards the result from
EPC-GMLC to the AF/LCS Client. AF/LCS Client is transparent to the Handover
process.
#### 6.19.1.2 Location Service Continuity from EPS to 5GS with N26 Interface
for Immediate Location Request
Figure 6.19.2.1-1: Location Service Continuity from EPS to 5GS with N26
Interface for Immediate Location Request
1\. Target UE positioning is started in EPS, e.g. Steps 1-7 of EPC-MT-LR
procedure in Figure 9.18 or steps 1-4 of EPC-MO-LR procedure in Figure 9.8d of
TS 23.271 [4].
2\. During the EPC-MT-LR or EPC-MO-LR, EPS to 5GS handover happens
successfully, as described in steps 1-14 in figure 4.11.1.2.2.2-1 of TS 23.502
[19] - MME receives Forward Relocation Complete Notification from the AMF and
stored the AMF ID.
3\. [Conditional] If the location request is received from EPC-GMLC, MME sends
Subscriber Location Report to GMLC with Handover event type, UE identifies and
AMF ID as target node information, EPC-GMLC identifies the handover by event
type and target AMF.
4\. the LCS session is cancelled as described in clause 9.1 of TS 23.271 [4].
5\. [Conditional] If step 3 is performed, the EPC-GMLC forwards the location
request to the 5GC-GMLC including all the parameters of the LCS Request and
the target AMF ID.
6\. The 5GC-GMLC may reconstruct the request (e.g. convert the area
information for area event), it forwards the LCS Request to the Target AMF
received in the case of MT-LR. The LCS session is started in 5GS. In the case
of MO-LR, the UE restarts the 5GC-MO-LR.
7\. [Conditional] If step 5 is performed, the response is returned by the 5GC-
GMLC to the EPC-GMLC.
8\. [Conditional] If step 7 is performed, EPC-GMLC forwards the response from
5GC-GMLC to the LCS Client.
#### 6.19.1.3 Location Service Continuity from 5GS to EPS without N26
Interface for Immediate Location Request
Figure 6.19.1.3-1: Location Service Continuity from 5GS to EPS without N26
Interface for Immediate Location Request
1\. Target UE positioning is started in 5GS, e.g. Steps 1-12 of 5GC-MT-LR
procedure in clause 6.1.2, or steps 1-5 of 5GC-MO-LR procedure in clause 6.2.
2\. [Conditional] If the 5GC-GMLC sends the message in step 4 or step 5 in
Figure 6.1.2-1, 5GC-GMLC invokes the Nudm_EventExposure_Subscribe to HSS+UDM
to subscribe the CN Type change event report.
3\. LMF handles the ongoing LCS session.
4\. 5GS to EPS mobility happens successfully as described in Figure 4.11.2.2-1
of TS 23.502 [19].
5\. [Conditional] If step 2 is performed, the UDM detects that the CN Type of
UE changes, the UDM notifies the CN Type of UE to 5GC-GMLC by invoking the
Nudm_EventExposure_Notify service operation.
6a. The LMF invokes Nlmf_Location_DetermineLocation Response including
failure.
6b. The AMF invokes Namf_Location_ProvidePositioningInfo Response including
failure.
7\. The steps 8\~ 11 in the location service continuity from 5GS to EPS with
N26 interface for immediate location request in clause 6.19.1.1 are performed
in the case of MT-LR. In the case of MO-LR, the UE restarts the EPC-MO-LR
procedure.
NOTE: The 5GC-MT-LR in 5GS may be failed because of timeout of the location
request. The 5GC-GMLC can trigger the step 6 when the LIR in 5GS is failed.
8\. [Conditional] If step 2 is performed, 5GC-GMLC invokes the
Nudm_EventExposure_UnSubscribe to HSS+UDM to cancel the subscription of the CN
Type change event report.
#### 6.19.1.4 Location Service Continuity from EPS to 5GS without N26
Interface for Immediate Location Request
Figure 6.19.1.4-1: Location Service Continuity from EPS to 5GS without N26
Interface for Immediate Location Request
1\. Target UE positioning is started in EPS, e.g. Steps 1-7 of EPC-MT-LR
procedure in Figure 9.18, or steps 1-4 of EPC-MO-LR procedure in Figure 9.8d
in TS 23.271 [4].
2a-2c. [Conditional] If the EPC-GMLC initiates the location request, the EPC-
GMLC requests the 5GC-GMLC to subscribe the CN Type change event report. The
5GC-GMLC invokes the Nudm_EventExposure_Subscribe to HSS+UDM to subscribe the
CN Type change event report.
3\. E-SMLC handles the ongoing LCS session.
4\. EPS to 5GS mobility happens successfully as described in Figure 4.11.2.3-1
of TS 23.502 [19].
5\. [Conditional] If step 2 is performed, the UDM detects that the CN Type of
UE changes, the UDM notifies the CN Type of UE to 5GC-GMLC by invoking the
Nudm_EventExposure_Notify service operation. The 5GC-GMLC notifies the CN Type
of UE to EPC-GMLC.
6\. The steps 5\~ 8 in the location service continuity from EPS to 5GS with
N26 interface for immediate location request in clause 6.19.1.2 are performed
in the case of MT-LR. In the case of MO-LR, the UE restarts the EPC-MO-LR
procedure.
NOTE: The EPC-MT-LR in EPS may be failed because of timeout of the location
request. The EPC-GMLC can trigger the step 6 when the LIR in EPS is failed.
7\. [Conditional] If step 2 is performed, 5GC-GMLC invokes the
Nudm_EventExposure_UnSubscribe to HSS+UDM to cancel the subscription of the CN
Type change event report.
### 6.19.3 Location Service Continuity between EPS and 5GS (bi-direction) for
deferred MT-LR
This clause shows the procedure to support location service continuity between
EPS and 5GS (bi-direction) for deferred MT-LR. Clause 6.19.3.1 shows the
procedure for 5GS to EPS handover case and clause 6.19.3.2 shows the procedure
for the EPS to 5GS handover case.
Cancellation of the reporting of location events is still supported using the
procedures in clause 6.3.2 and clause 6.3.3 and clauses 9.1.19.2 and 9.1.19.3
of TS 23.271 [4], with the enhancement that for the UE or Client initiated
cancel procedure in EPS, after EPC-(H)GMLC receiving LCS Cancel Service
request, it also transfers the request to 5GC-(H)GMLC then 5GC-(H)GMLC
initiate the cancel procedure of clause 6.3.3; for UE or Client initiated
cancel procedure in 5GS, after 5GC-(H)GMLC receiving LCS Cancel Service
request, it also transfers the request to EPC-(H)GMLC to release context in
EPC-(H)GMLC.
#### 6.19.3.1 Location Service Continuity from 5GS to EPS
Figure 6.19.3.1-1: LCS Continuity Solution for 5GS to EPS Mobility
1\. Same as step 1 of deferred 5GC-MT-LR procedure in clause 6.3.1, with the
enhancement that 5GC-(H)GMLC obtains the LDR reference number and EPC-(H)GMLC
address from EPC-(H)GMLC for the periodic or triggered location session.
NOTE 1: Multiple QoS class is supported in 5GS but not in EPS, if the deferred
LCS service request in this step contains multiple location QoS, QoS mapping
is performed in step 3a or on UE to support service continuity in EPS.
2\. Target UE positioning starts in 5GS with steps 2\~15 of deferred 5GC-MT-LR
procedure in clause 6.3.1.
\- If handover happens before step 16 in clause 6.3.1, the UE has not received
the LCS Periodic-Triggered Invoke Request message. After handover complete,
the AMF notifies 5GC-GMLC. The 5GS to EPS handover notification also includes
the MME ID for the target UE. The 5GC-GMLC sends the location request with the
mapped location QoS to EPC-GMLC to trigger the deferred/periodic MT-LR in EPS
(i.e. steps 3-11 in clause 6.19.1.1 are performed with the enhancement in step
8 that 5GC-GMLC perform location QoS mapping, then obtain and forward the
mapped location QoS which can be applicable to EPS to EPC-GMLC, the mapping
may be performed by choosing the most stringent values from the
\"LocationQoS\" and set the \"LcsQoSClass\" in \"LocationQoS\" as the \"Best
Effort\"), and steps 3a-9 are not performed;
\- If handover or UE movement with IDLE state happens after step 16 in clause
6.3.1, the UE has received the LCS Periodic-Triggered Invoke Request message.
The UE does not release the deferred MT-LR context after handover or movement
with IDLE state. The following steps 3a-9 are performed;
3a. [Conditional] In the periodic or triggered 5GC-MT-LR case, if the LCS QoS
class in location request is \"multiple QoS class\" and the LMF determines the
access type allowed for the UE for event reporting includes \"E-UTRAN
connected to EPC\", the LMF may determine the mapped location QoS which can be
applicable to EPS based on the original multiple QoS. The mapping may be
performed by choosing the most or least stringent values from the
\"LocationQoS\" and set the \"LcsQoSClass\" in \"LocationQoS\" as the \"Best
Effort\" or \'Assured\'. The mapping strategy performed by LMF is operator
dependent.
3b\~3c. [Conditional] In the deferred periodic or triggered 5GC-MT-LR case,
LMF sends the LCS Periodical-Triggered Invoke Request to UE. If step 3a is
performed, besides the multiple location QoS, the request also includes the
mapped location QoS used for EPS. UE response to LMF with the LCS Periodical-
Triggered Invoke Return Result.
4\. [Conditional] LMF sends the Nlmf_Location_DetermineLocation Response to
AMF.
5\. [Conditional] UE may stay in 5GC over a period of time and the deferred
5GC-MT-LR procedure can continue in 5GS.
6\. [Conditional] 5GS to EPS handover happens or UE moves to EPS with IDLE
state. The LMF in 5GS does not release resource for the deferred MT-LR session
after this step.
7-8. [Conditional] For the deferred periodic or triggered MT-LR case, when the
event is detected by UE in EPS, the UE shall send an LCS MO-LR Invoke message
for event report to the MME. If the location QoS is multiple QoS in 5GS, the
UE shall include the mapped location QoS which is applicable to EPS in the LCS
MO-LR Invoke message.
9\. [Conditional] For the deferred periodic or triggered MT-LR case, the
procedure continues with step 15-23 as described in Figure 9.1.19.1-1 of TS
23.271 [4]
10-11. [Conditional] EPC-(H)GMLC sends LCS Service Response to 5GC-(H)GMLC and
5GC-(H)GMLC performs the step 30 of Figure 6.3.1-1.
NOTE 2: If UE detects handover is not complete but the event is triggered,
i.e. Step 8 happens before handover complete, the UE waits for handover
complete to send the triggered LCS MO-LR Invoke message. For area event, the
geographical area can be mapped into cell(s)/TAI(s) corresponding to 5GS and
EPS, so UE can detect area event based on received cell(s)/TAI(s) no matter it
is in 5GS or EPS.
#### 6.19.3.2 Location Service Continuity from EPS to 5GS
Figure 6.19.3.2-1: LCS Continuity Solution for EPS to 5GS Mobility
1\. Target UE positioning starts in 5GS with steps 1-3 of deferred 5GC-MT-LR
for periodic, triggered and UE available location events procedure in clause
6.3.1.
2\. The target UE is registered in EPC, 5GC-GMLC sends LCS Service Request to
EPC-GMLC. The 5GC-GMLC derives the address of EPC-GMLC by using the mechanisms
described in step 2 in clause 6.13.1.
3\. Target UE positioning starts in EPS with steps 1-16 of deferred EPC-MT-LR
procedure for Periodic and Triggered Location procedure in Figure 9.1.19.1-1
of TS 23.271 [4], with enhancement that EPC-(H)GMLC obtains LDR reference
number and 5GC-(H)GMLC address from 5GC-(H)GMLC for the periodic or triggered
location session.
\- If handover happens before step 9 in clause 9.1.19.1 of TS 23.271 [4], the
UE has not received the LCS Periodic-Triggered Event Invoke message. After
handover complete, the MME notifies EPC-GMLC. The EPS to 5GS handover
notification also includes the AMF ID for the target UE. The EPC-GMLC sends
the location request to 5GC-GMLC to trigger the deferred/periodic MT-LR in 5GS
(i.e., steps 3-8 in clause 6.19.2-1 of are performed), and steps 2-5 are not
performed;
\- If handover or UE movement with IDLE state happens after step 9 in clause
9.1.19.1, the UE has received the LCS Periodic-Triggered Event Invoke message.
The following steps 4-7 are performed.
4\. [Conditional] 5GS to EPS handover happens or UE moves to EPS with IDLE
state.
5-7. [Conditional] For the deferred periodic or triggered MT-LR case, when the
event is detected by UE in 5GS, the UE should send an Event Report message to
the LMF through AMF.
For the deferred periodic or triggered MT-LR case, the procedure continues
with steps 26-30 as described in clause 6.3.1.
NOTE: If UE detects handover is not complete but the event is triggered, i.e.
Step 5 happens before handover complete, the UE waits for handover complete to
send the event report message.
## 6.20 Ranging/Sidelink Positioning procedures
### 6.20.1 Procedures of SL-MO-LR involving LMF
Figure 6.20.1-1 illustrates a procedure to enable a UE to obtain Sidelink
positioning/ranging location results using one or more other UEs with the
assistance of an LMF in a serving PLMN for UE1.
The Ranging/SL Positioning location results may include absolute locations,
relative locations or distances and directions, depending on the service
request.
If the Target UE decides to initiate SL-MO-LR procedure, it includes one or
multiple SL reference UE(s) / Located UE (s) in the service request. See TS
23.586 [40] for more information on how this generic procedure can be used.
Figure 6.20.1-1: SL-MO-LR Procedure
**Precondition:** UE1 is in coverage and registered with a serving PLMN. UEs 2
to n may or may not be in coverage and, if in coverage, may or may not be
registered with the same serving PLMN as UE1.
1\. The procedures and signalling specified in clause 6.2 of TS 23.586 [40]
may be used to provision the Ranging/SL positioning service authorization and
policy/parameter provisioning to UEs 1 to n, when in coverage.
NOTE 1: If indication of UE-only operation is received, procedures of
Ranging/Sidelink Positioning control as defined in clause 6.8 of TS 23.586
[40] is performed.
2\. Based on a trigger of service request (e.g. received from the application
layer), which includes UE1/.../UEn, UE discovery is performed for Ranging/SL
positioning as specified in clause 6.4 of TS 23.586 [40]:
\- If UE1 is the target UE, UE1 discovers UEs 2 to n
\- If UE1 is the Located UE, the target UE (i.e. one of the UEs 2 to n)
discovers UE1 (and other Located UEs in the set of UEs 2 to n).
3\. Secure groupcast and/or unicast links are established between UEs 1 to n
as defined in clause 5.3 of TS 23.586 [40] to enable UE1 to exchange Ranging
and Sidelink Positioning Protocol (RSPP) messages over PC5-U reference point
with each of UEs 2 to n and possibly enabling UEs 2 to n to exchange RSPP over
PC5-U between each other.
Editor\'s note: Security aspects for RSPP signalling need to be defined or
agreed by SA WG3.
4\. UE1 and UEs 2 to n may communicate over PC5 for authorization of
Ranging/SL positioning and receiving QoS parameters if needed. Each of UEs
verifies that Ranging/SL positioning is permitted, including whether
Ranging/SL positioning results may be transferred to an LCS Client or AF if
this is used, according to any service authorization and policy/parameter
provisioning received at step 1. QoS requirements for the Ranging/SL
positioning may be also provided based on QoS requirements in the service
request.
5\. UE1 may obtain the Sidelink positioning capabilities of UEs 2 to n using
the groupcast and/or unicast links established in step 3.
Step 4 and 5 may be performed to transfer the information of UEs which are not
served by the LMF.
NOTE 2: UE2/.../UEn is not assumed to be served by the same LMF serving UE1.
Editor\'s note: It needs to be verified that RAN2 will provide support for
steps 4 and 5.
6\. Based on the Sidelink positioning capabilities of UE1/.../UEn, the target
UE determines SL-MO-LR is to be performed. If UE1 is the Located UE (i.e. when
the target UE is one of UE2/.../UEn and does not have NAS connection), the
target UE initiates SL-MO-LR service request to UE1.
7\. If UE1 is in CM-IDLE state, UE1 instigates a UE triggered Service Request
in order to establish a signalling connection with the serving AMF of UE1.
8\. UE1 sends a supplementary services SL-MO-LR request to the serving AMF in
an UL NAS TRANSPORT message. The SL-MO-LR request indicates the other UEs 2 to
n (using application layer ID), indicates any assistance data needed,
indicates whether location calculation assistance is needed, and indicates
whether location results should be transferred to an LCS client or AF. The
message shall include the identity of the LCS client or the AF and may include
the address of the GMLC through which the LCS client or AF (via NEF) should be
accessed. In addition, a Service Type indicates which MO-LR service of the LCS
Client is requested by the UE may be included. For location calculation
assistance from the LMF, the preferred type of Sidelink positioning/ranging
location results (e.g. absolute locations, relative locations or distances and
directions between pairs of UEs) and the required QoS are included. If UE1 is
Located UE and one of UE2/.../UEn is the target UE that does not have NAS
connection, the supplementary services SL-MO-LR request includes an indication
that one of UE2/.../UEn is the target UE instead of UE1.
Editor\'s note: It is FFS whether indication about the need of assistance data
from UE, which will be aligned with RAN WGs.
9\. The serving AMF selects an LMF serving UE1 (e.g. an LMF that supports
Sidelink positioning/ranging) and sends an Nlmf_Location_DetermineLocation
service operation towards the LMF with the information from the SL-MO-LR
Request. The service operation includes a LCS Correlation identifier.
10\. The LMF sends a request to UE1 for the capabilities of UEs 1 to n.
NOTE 3: UE2/.../UEn is not assumed to be served by the same LMF serving UE1.
Editor\'s note: It is FFS the update when the LMF also serves UE2/.../UEn with
alignment with RAN.
11\. UE 1 returns its capabilities to the LMF. UE1 may additionally return the
capabilities of the UEs obtained at step 5 if requested by the LMF at step 10.
12\. UE1 may send a request for specific assistance data to the LMF.
13\. LMF sends the requested assistance data to UE1, and UE1 forwards the
assistance data received from LMF to UE2/.../UEn. The assistance data may
assist UEs 1 to n to obtain Sidelink location measurements at step 15 and/or
may assist UE1 to calculate Sidelink positioning/ranging location results at
step 16.
NOTE 4: Steps 10 and 11 can be omitted if UE1 includes a message containing
the capabilities of UEs 1 to n in the SL-MO-LR request at step 8. Step 12 can
be omitted if UE1 includes a message containing the request for specific
assistance data in the SL-MO-LR request at step 8.
Editor\'s note: Whether step 10-11 are needed will be aligned with RAN WGs.
14\. If the SL-MO-LR request at step 8 indicated location calculation
assistance is needed and/or indicated transfer of Sidelink positioning/ranging
location results to an LCS Client or AF, the LMF sends a request for location
information to UE1 and may also send a request for location information to
UE2/.../UEn if it is served by the LMF. If LMF determines to apply UE based SL
Positioning, LMF includes in the request the indication of UE based SL
Positioning. LMF may also provide the list of candidate Located UE(s), if
absolute location is requested at step 8. If scheduled location time is
received at step 14. LMF may include a scheduled location time.
Editor\'s note: It needs to be aligned with RAN WG2 if the list of candidate
Located UE(s) is provided in step 13 or step 14.
15\. UE1 instigates a Sidelink positioning/ranging procedure among UEs 1 to n
in which UEs 1 to n obtain Sidelink location measurements and UEs 2 to n
transfer their Sidelink location measurements to UE 1 and/or to the LMF
(depending on the assistance requested). If scheduled location time is
received at step 14, Sidelink positioning/ranging is performed at the
scheduled location time.
16\. If Target UE\'s absolute location information is required at step 8 and
if absolute location of Located UE(s) is not available, the Target UE sends a
request to the Located UE(s) to trigger 5GC-MO-LR procedure to let the Located
UE(s) acquire their own absolute location. The QoS requirement received at
step 8 is included in the request, which is used to derive the QoS for Located
UE(s) positioning.
17\. If LMF determines to use UE based calculation, at least one of
UE1/.../UEn calculates Sidelink positioning/ranging location results based on
the Sidelink location measurements obtained at step 15 and possibly using
assistance data received at step 13. The Sidelink positioning/ranging location
results can include absolute locations, relative locations or ranges and
directions related to the UEs 1 to n.
18\. If UE1 received a request for location information at step 14, UE1 sends
a response to the LMF and includes the Sidelink location measurements obtained
at step 15, the Sidelink positioning/ranging location results obtained at step
17 if step 17 was performed, or Located UE\'s absolute location obtained at
step 16.
19\. If Target UE\'s absolute location information is required at step 8 and
if absolute location of Located UE(s) is not received at step 18, LMF can
either retrieved the location of the Located UE(s) locally or triggers 5GC-MT-
LR procedure to the GMLC to acquire the absolute location of the Located UE(s)
using Application Layer ID of the Located UE(s). LMF includes the QoS
requirement received at step 8 in the request, which is used to derive the QoS
for Located UE(s) positioning. If scheduled location time is used, LMF
includes the scheduled location time in the request to GMLC.
20\. The LMF calculates Sidelink positioning/ranging location results for UEs
1 to n from the Sidelink location measurements received at step 18 and
absolute location of Located UE(s) at step 19. The Sidelink
positioning/ranging location results can include absolute locations, relative
locations or ranges and directions related to the UEs 1 to n, depending on the
location request received in step 8.
21\. The LMF returns an Nlmf_Location_DetermineLocation service operation
response to the AMF and includes the Sidelink positioning/ranging location
results received at step 18 or calculated at step 20.
22\. If Sidelink positioning/ranging location results were received at step
21, the AMF performs steps 7-12 of clause 6.2 to send the Sidelink
positioning/ranging location results to the GMLC and to an AF or LCS Client if
this was requested at step 8. The Sidelink positioning/ranging location
results include the identities for the respective UEs 1 to n received at step
8.
NOTE 5: Sending location results and global identities for UEs 1 to n to an AF
or LCS Client may require privacy verification from UEs 1 to n and/or from the
HPLMNs of UEs 1 to n.
23\. The LMF returns a supplementary services SL-MO-LR response to UE1 in a DL
NAS TRANSPORT message and includes any Sidelink positioning/ranging location
results calculated at step 20 if step 20 was performed. If UE1 is Located UE,
and the target UE is one of the UEs 2 to n and does not have NAS connection,
then UE1 may transfer the Sidelink positioning/ranging location results to the
target UE.
### 6.20.2 5GC-MO-LR Procedure using SL positioning
This procedure is used to estimate the location of a UE based on the location
of one or more Located UEs and the distance and/or direction between the UE
and the Located UE(s). 5GC-MO-LR Procedure as defined in clause 6.2 applies
with the following differences:
\- Step 5 is replaced by step 10-19 of clause 6.20.1 with the following
adaptations:
\- UE1 is the target UE, and UE2/.../UEn is the Located UE.
\- Step 14: LMF determines whether to obtain location of the UE with the
assistance of one or more Located UE (s). LMF triggers the UE to perform
Ranging/Sidelink Positioning with the Located UE.
### 6.20.3 Procedures of SL-MT-LR involving LMF
The SL-MT-LR procedure is used to estimate the relative locations or distances
and/or directions between the UEs.
Figure 6.20.3-1 illustrates a procedure to enable an LCS Client or AF to
obtain Ranging/Sidelink Positioning location results for a group of n UEs
(nâ‰¥2), i.e. UE1, UE2, ..., UEn. In the procedure, the GMLC determines a UE
among the n UEs to be designated UE1 (i.e. Target UE in TS 23.586 [40]) and
one or more other UEs designated UE2, UE3, ..., UEn (nâ‰¥2) (i.e.
Reference/Located UEs in TS 23.586 [40]). The Ranging/Sidelink Positioning
location results may include absolute locations, relative locations or ranges
and directions related to the UEs, based on the service request.
Procedure for periodic and triggered SL-MT-LR is defined in clause 6.20.4.
Figure 6.20.3-1: SL-MT-LR Procedure
**Precondition:** At least one of the n UEs is in coverage and registered with
a serving PLMN.
1\. The LCS Client or the AF (via NEF) sends an LCS service request to the
(H)GMLC for Ranging/Sidelink Positioning location results for the n UEs which
may each be identified by an Application Layer ID, a GPSI or a SUPI. The
request may include the required QoS, the required location results (e.g.
absolute locations, relative locations or distances and/or directions related
to the UEs), the SL reference UE(s) in case of relative locations, distance,
or direction. The (H)GMLC or NEF authorizes the LCS Client or the AF for the
usage of the LCS service. If the authorization fails, the remaining steps are
skipped and the (H)GMLC or NEF responds to the LCS Client or the AF with the
failure of the service authorization.
In addition, an Application Layer ID shall be used for each of the n UEs to
enable discovery of the UEs at step 12. If only GPSI is provided to the
(H)GMLC, it can query the NEF for the mapping Application Layer ID as
specified in clause 4.3.9 of TS 23.586 [40].
Editor\'s note: Whether Application Layer ID will be included in LPP operation
is FFS and needs the coordination with RAN WGs.
2\. The (H)GMLC invokes a Nudm_SDM_Get service operation towards the UDM of
each of the n UEs to get the privacy settings of the UE identified by its GPSI
or SUPI. The UDM returns the UE Privacy setting of the UE. The (H)GMLC checks
the UE LCS privacy profile.
3\. The (H)GMLC invokes a Nudm_UECM_Get service operation towards the UDM of
each of the n UEs (for which GPSI or SUPI is available), one at a time, using
the GPSI or SUPI of each UE. The (H)GMLC selects the UE (e.g. which is treated
as UE1 in following steps) that initiates the Ranging/SL Positioning and
selects the corresponding serving AMF.
NOTE: The UDM is aware of the serving AMF address at UE registration on an AMF
as defined in clause 4.2.2.2.2 of TS 23.502 [19]. The UDM is aware of a
serving (V)GMLC address at UE registration on an AMF as defined in clause
4.2.2.2.2 of TS 23.502 [19].
4\. For a non-roaming case, this step is skipped. In the case of roaming, the
(H)GMLC may receive an address of a (V)GMLC (together with the network address
of the current serving AMF) from the UDM in step 3, otherwise, the (H)GMLC may
use the NRF service in the (H)PLMN to select an available (V)GMLC in the
(V)PLMN, based on the (V)PLMN identification contained in the AMF address
received in step 3. The (H)GMLC then sends the location request to the (V)GMLC
by invoking the Ngmlc_Location_ProvideLocation service operation towards the
(V)GMLC. In the cases when the (H)GMLC did not receive the address of the
(V)GMLC, or when the (V)GMLC address is the same as the (H)GMLC address, or
when both PLMN operators agree, the (H)GMLC sends the location service request
message to the serving AMF. In this case, step 4 is skipped. The (H)-GMLC also
provides the LCS client type of AF, if received in step 1, or LCS client type
of LCS client and other attributes to be sent to AMF in step 5.
5\. In the case of roaming, the (V)GMLC first authorizes that the location
request is allowed from this (H)GMLC, PLMN or from this country. If not, an
error response is returned. The (H)GMLC or (V)GMLC invokes the
Namf_Location_ProvidePositioningInfo service operation towards the AMF serving
UE1 to request Sidelink positioning/ranging location results of the n UEs. The
service operation includes the SUPI of UE1, Application layer IDs of the UEs,
the client type and may include the required LCS QoS, the required location
results (e.g. relative locations or ranges and directions related to the UEs)
and other attributes as received or determined in step 1.
6\. If UE1 is in CM-IDLE state, the AMF initiates a network triggered Service
Request procedure to establish a signalling connection with UE1.
If signalling connection establishment fails, steps 7-17 are skipped.
7-8. If the indicator of privacy check indicates an action is needed, then
same operation as that of step 7-8 of clause 6.1.2 is carried out.
9\. The serving AMF selects an LMF serving UE1 (e.g. an LMF that supports
Ranging/Sidelink Positioning) and sends an Nlmf_Location_DetermineLocation
service operation towards the LMF with the information received at step 5 e.g.
required location results (e.g. relative locations or ranges and directions
between pairs of UEs), SL reference UE(s) in case of relative locations,
Application layer IDs of the UEs if received in step 5. The service operation
includes a LCS Correlation identifier.
10\. The LMF sends an SL-MT-LR request to the serving AMF as a supplementary
services message, using the Namf_Communication_N1N2MessageTransfer service
operation, and the session ID parameter is set to the LCS Correlation
identifier.
The SL-MT-LR request may include the application layer IDs of the other UEs 2
to n, the types of required location results (e.g. relative locations or
distances and/or directions) and SL reference UE(s) in case of relative
locations.
Editor\'s note: Whether supplementary services message or lpp will be sent
from LMF to UE is FFS and needs the coordination with RAN WGs.
11\. The serving AMF forwards the SL-MT-LR request and a Routing identifier
equal to the LCS Correlation identifier to UE1 using a DL NAS TRANSPORT
message.
12\. UE1 attempts to discover the other UE 2 to n using their Application
Layer IDs if not already discovered using procedure defined in clause 6.4 of
TS 23.586 [40].
13\. UE1 obtains the sidelink positioning capabilities of the discovered UEs
via the SLPP if not already obtained.
14\. UE1 returns a supplementary services SL-MT-LR response to the serving AMF
in an UL NAS TRANSPORT message and includes the Routing identifier received in
step 11.
The SL-MT-LR response indicates which of UEs 2 to n have been discovered and
the sidelink positioning capabilities of the discovered UEs.
15\. The serving AMF forwards the SL-MT-LR response to the LMF indicated by
the Routing identifier received at step 14 and includes a LCS Correlation
identifier equal to the Routing identifier.
16\. Ranging/Sidelink Positioning of UE1 and the other discovered UEs occurs
as for an SL-MO-LR as described for steps 10-19 of Figure 6.20.1-1 with the
difference that Ranging/Sidelink Positioning location measurement data or
results are always returned to the LMF and the LMF indicates to UE1 at step 13
or step 14 of Figure 6.20.1-1 whether the Ranging/Sidelink Positioning
location results will be calculated by the LMF (at step 19) or by UE1 (at step
17). For some undiscovered UEs among the other UEs 2 to n, the LMF interacts
with GMLC to initiate the 5GC-MT-LR procedure for UE2 to n to get their
absolute locations, and calculates the relative locations or distances and/or
directions related to the UEs.
17-20. The LMF returns the Sidelink positioning/ranging location results to
the LCS Client or AF as in steps 13-15 and step 24 of clause 6.1.2. The
results also include failure information of the UE(s) that was not discovered.
### 6.20.4 Procedures of SL-MT-LR for periodic, triggered Location Events
The periodic and triggered SL-MT-LR procedure is based on SL-MT-LR procedure
in clause 6.20.3, and used to estimate the relative locations or distances
and/or directions between the UEs periodically or following certain trigger
events. LCS Client or AF to obtain Ranging/Sidelink Positioning location
results for a group of n UEs (nâ‰¥2), i.e. UE1, UE2, ..., UEn either
periodically or when certain trigger events occur.
Besides relative locations, ranges, directions as defined in clause 6.20.3,
for periodic and triggered SL-MT-LR procedure, and the Ranging/Sidelink
Positioning location results may additionally include velocities and relative
velocities related to the UEs based on the service request. Figure 6.20.4-1
illustrates the procedure.
Figure 6.20.4-1: Periodic and Triggered SL-MT-LR Procedure
The following additions apply compared to the procedure in clause 6.20.3:
1\. The LCS service request further includes periodic or trigger event
parameters. For periodic location, the LCS Service Request includes the time
interval between successive location reports and the total number of reports.
For triggered location. the LCS Service Request includes details of the
trigger event, the duration of event reporting, the minimum and maximum time
intervals between successive event reports, the maximum event sampling
interval, whether location estimates shall be included in event reports, and
whether only one location report is required or more than one. Trigger events
can be one of the following;
\- ranging event with range threshold and threshold type (a, b, c or d): a
trigger event occurs if the ranges between at least one UE of the n UEs and
each of the other UEs are such that any range for the one UE is less than the
threshold (type a), any range for the one UE exceeds the threshold (type b),
all ranges for the one UE are less than the threshold (type c), or all ranges
for the one UE exceed the threshold (type d).
4\. In the message sent by (H)GMLC, the (H)GMLC also includes a contact
address for the (H)GMLC (Notification Target Address, e.g. a URI) and an LDR
reference number (Notification correlation ID) to be used for event reporting
at steps 24-31 defined for periodic and triggered SL-MT-LR procedure only. The
LDR reference number is either allocated by (H-)GMLC based on predefined rule
or allocated by NEF, if the location request is sent by an NEF at step 1.
5\. The message Namf_Location_ProvidePositioningInfo service operation towards
the AMF is to request periodic or triggered Sidelink positioning/ranging
location results of the n UEs. The service operation further includes the
periodic or trigger event parameters and other attributes as received or
determined in steps 1 and 4.
NOTE 1: The location request is sent to one VGMLC at step 4 for roaming and to
one AMF at step 5, which is the serving AMF for UE1.
10\. The LMF sends a Periodic-Triggered SL-MT-LR request to the serving AMF.
The LCS Periodic-Triggered SL-MT-LR request further includes a deferred
routing identifier, which can be the identification of the LMF when the LMF
will act as a serving LMF or a default LMF identification otherwise. The LCS
Periodic-Triggered SL-MT-LR request may include the QoS and allowed or
required location results at step 24 for each location event reported. The LCS
Periodic-Triggered SL-MT-LR request also includes the application IDs of UEs 1
to m, the address for the (H)GMLC and LDR reference number. The LCS Periodic-
Triggered SL-MT-LR request also includes the identities of the target UEs. The
requested location results (e.g. absolute locations, relative locations,
ranges, directions, velocities and relative velocities) for the target UEs and
QoS.
11\. The SL-MT-LR request from AMF is Periodic-Triggered, and the Routing
identifier is immediate Routing identifier.
NOTE 2: The deferred routing identifier may be global (e.g. an IP address,
UUID or URI) or may be local. The deferred routing identifier is used for
routing in steps 24 and 25. The immediate routing identifier included by the
AMF in step 11 is used for routing in steps 14 and 15.
14\. The SL-MT-LR response from UE1 is Periodic-Triggered, and Routing
identifier is immediate Routing identifier. The supplementary services
Periodic-Triggered SL-MT-LR response indicates whether UE1 and other UEs 2 to
m accept the periodic or triggered location request and which of UEs 2 to m
were discovered by UE1 at step 12.
15\. The SL-MT-LR response forwarded by AMF is Periodic-Triggered, and Routing
identifier is immediate Routing identifier.
NOTE 3: Step 16 in clause 6.20.3 enables the LMF to obtain the capabilities
and initial location results for the UEs 1 to n.
17-20. The Sidelink positioning/ranging location results returned by LMF to
LCS Client is initial one.
The following additional steps are dedicated for Periodic and Triggered SL-MT-
LR Procedure:
21\. The UEs 1 to m periodically perform Sidelink positioning/ranging in order
to support steps 22 and 24.
NOTE 4: The UEs 1 to m may perform Sidelink positioning/ranging at intervals
of the maximum event sampling interval provided at step 1.
22\. UE1 monitors for occurrence of the trigger or periodic event requested in
step 11. For a trigger event, UE1 monitors the requested event at intervals
equal to or less than the maximum event sampling interval. An event trigger is
detected by UE1 when any of the following occur: (i) a requested non-periodic
trigger event has been detected and the minimum reporting time interval has
elapsed since the last report (if this is not the first event report); (ii) a
requested periodic location event has occurred; or (iii) the maximum reporting
time for a non-periodic trigger event has expired.
23\. UE1 performs a UE triggered service request as defined in clause 4.2.3.2
of TS 23.502 [19] if in CM-IDLE state in order to establish a signalling
connection with the AMF.
24\. UE1 sends a supplementary services event report message to the serving
AMF using the Namf_Communication_N1N2MessageTransfer service operation, and
includes the deferred Routing ID received in step 11. The event report
indicates the type of event being reported (e.g. whether a normal event or
expiration of the maximum reporting interval) and may include location results
obtained at step 21. UE1 also includes the (H)GMLC contact address, the LDR
reference number, whether location results are to be reported and if so the
location QoS in the event report.
25\. The AMF forwards the event report to the LMF indicated by the deferred
Routing ID received at step 24 and includes a Correlation ID equal to the
deferred Routing ID.
26\. When the LMF receives the event report and if it can handle this event
report, the LMF updates the status of event reporting (e.g. the number of
event reports so far received from UE1 and/or the duration of event reporting
so far) and returns a supplementary services acknowledgment for the event
report to the serving AMF using the Namf_Communication_N1N2MessageTransfer
service operation, and a Correlation ID identifying the LMF. The
acknowledgment may optionally include a new deferred routing identifier
indicating a new serving LMF or a default (any) LMF.
27\. The serving AMF forwards the event report Ack and an immediate Routing ID
equal to the Correlation ID to UE1 using a DL NAS TRANSPORT message. If UE1
does not receive any response from the LMF after a predefined time, i.e. the
current LMF does not support the deferred location request (for temporary or
permanent reasons) or due to some radio access failures, UE1 may re-send the
report one or more times.
NOTE 5: Inclusion of a new deferred routing identifier in the event report
acknowledgment at step 26 may be used to change the serving LMF (e.g. if a UE
moves into an area that is better supported by a different LMF or if the
serving LMF is overloaded) or to enable a default LMF to become a serving LMF.
28\. If location results are needed for event reporting and not received at
step 25, the LMF may instigate Ranging/Sidelink Positioning of UEs 1 to m as
at step 16.
29-31. The LMF returns the event report and any location results obtained at
step 25 or step 28 to the LCS Client or AF as in steps 28-30 of clause 6.3.1.
32\. UEs 1 to m continue to periodically perform Sidelink positioning/ranging
as in step 21.
33\. UE1 continues to monitor for further periodic or trigger events as in
step 22 and instigates steps 23-31 each time a periodic or trigger event is
detected.
### 6.20.5 5GC-MT-LR Procedure using SL positioning
The procedure is used to estimate the location of a UE by using the location
of one or more Located UEs and the distance and/or direction between the UE
and the Located UE(s).
Procedure of Figure 6.1.2-1 can be reused, with step 12 of Figure 6.1.2-1
replaced by the step 10-16 of Figure 6.20.3-1 with the following adaptations:
\- UE1 is the target UE, and UEs 2 to n are Located UEs.
\- In step 10, the types of required location results is absolute solution,
and the other UEs 2 to n are the candidate Located UE(s) if included. SL-MT-LR
request also includes the indication of Target UE/LMF selecting Located UE.
\- In step 14, if UE1 receives the indication of LMF selecting Located UE in
step 11, step 14 includes the obtained information of all the discovered
Located UEs. If UE1 receives the indication of Target UE selecting Located UE
in SL-MT-LR request, UE1 performs the Located UE selection, and SL-MT-LR
response includes the selected Located UEs ID.
## 6.21 Procedure for NWDAF assistance to location services
### 6.21.1 General
This clause specifies procedures for NF in the LCS system to interact with
NWDAF for data analytics. General framework for NF in the LCS system to
interact with NWDAF for data analytics refers to the clauses 6.1.1 and 6.1.2
of TS 23.288 [37].
Clause 6.21.2 describes the procedures of Location Accuracy Analytics
retrieved by LMF.
Clause 6.21.3 describes the procedures of UE Mobility Analytics retrieved by
AMF.
NOTE: In this release of specification, only AMF and LMF can be NF service
consumers to NWDAF.
The procedure in Figure 6.21-1 can be used by a 5GC NF involved in 5GC
location services to get optional assistance from NWDAF as shown below.
Figure 6.21-1: Procedure for NWDAF assistance to location services
1\. The AMF may invoke Nlmf_Location_DeterminationLocation service operation
towards the LMF to request the current location of the UE.
2\. Assistance from NWDAF for location services may be requested from the LMF
and/or AMF.
3\. The LMF may trigger UE positioning.
4\. The LMF may return the location estimate to AMF as specified in clause
8.3.2.
### 6.21.1 Location Accuracy Analytics Retrieval by LMF
LMF may request Location Accuracy Analytics from NWDAF to retrieve the
location accuracy.
The procedure to request Location accuracy analytics by LMF is referred to
clause 6.17.4 of TS 23.288 [37]. In Figure 6.17.4-1 of TS 23.288 [37] the
Analytics consumer is replaced by LMF. Pre-condition of the procedure is NWDAF
has a trained supervised ML model for deriving Location Accuracy Analytics.
NOTE: To assist the determination of the positioning methods for the requested
LCS accuracy with the LCS accuracy analytics, LMF may know the accuracy of the
positioning method(s) and NLOS/LOS measurement indication if the positioning
method is NR based.
### 6.21.2 UE Mobility Analytics Retrieval by AMF
AMF may request assistance for UE location verification for NR satellite
access as described in clause 6.10.1 by requesting or subscribing to UE
mobility analytics from NWDAF. With NWDAF-based UE location statistics and
predictions and UE location estimated by LMF, AMF can further assist UE
location verification for NR satellite access.
# 7 Information storage
## 7.1 UDM
For each UE subscriber the UDM stores LCS related data as part of the
Subscriber Data Management (SDM) service as defined in clause 5.2.3.3.1 of TS
23.502 [19].
The privacy profile data is defined in table 7.1-1 containing data for the
privacy classes for which location of the target UE is permitted. For the
meaning of each LCS privacy profile data type and included data, refer to
clause 5.4.2.
Table 7.1-1: LCS privacy profile data stored in the UDM for a UE Subscriber
+----------------------------+----------+----------------------------+ | Privacy Profile Data Type | Presence | UDM data | +============================+==========+============================+ | Location Privacy | M | Indication of one of the | | Indication | | following mutually | | | O | exclusive global settings: | | | | | | | | > \- Location is | | | | > disallowed | | | | > | | | | > \- Location is allowed | | | | > (default) | | | | | | | | Time period when the | | | | Location Privacy | | | | Indication is valid | +----------------------------+----------+----------------------------+ | Call/session Unrelated | M | For any LCS client or AF | | Class | | not in the external LCS | | | O | client list or otherwise | | | | identified for the | | | O | Call/session Unrelated | | | | Class, the following data | | | O | may be present: | | | | | | | O | > \- One of the following | | | | > mutually exclusive | | | O | > options: | | | | > | | | O | > \- Location not allowed | | | | > (default case) | | | O | > | | | | > \- Location allowed with | | | O | > notification | | | | > | | | O | > \- Location with | | | | > notification and privacy | | | O | > verification; location | | | | > allowed if no response | | | O | > | | | | > \- Location with | | | O | > notification and privacy | | | | > verification; location | | | O | > restricted if no | | | | > response | | | | > | | | | > \- Time period when | | | | > positioning is allowed | | | | > | | | | > \- Geographical area | | | | > where positioning is | | | | > allowed | | | | > | | | | > \- Indication that | | | | > codeword shall be | | | | > checked in UE or one or | | | | > more codeword values to | | | | > be checked in GMLC | | | | | | | | External LCS client list: | | | | a list of zero or more LCS | | | | clients, AFs and LCS | | | | Client groups with the | | | | following data for each | | | | entry: | | | | | | | | > \- One of the following | | | | > mutually exclusive | | | | > options: | | | | > | | | | > \- Location allowed | | | | > without notification | | | | > (default case) | | | | > | | | | > \- Location allowed with | | | | > notification | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > allowed if no response | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > restricted if no | | | | > response | | | | > | | | | > \- Time period when | | | | > positioning is allowed | | | | > | | | | > \- Geographical area | | | | > where positioning is | | | | > allowed | | | | | | | | Service types list: a list | | | | of one or more service | | | | types for which the LCS | | | | client is allowed to | | | | locate the particular UE. | | | | The possible service types | | | | are defined in | | | | TS 22.071 [2]. The | | | | following data may be | | | | present for each service | | | | type in the list: | | | | | | | | > \- One of the following | | | | > mutually exclusive | | | | > options: | | | | > | | | | > \- Location allowed | | | | > without notification | | | | > (default case) | | | | > | | | | > \- Location allowed with | | | | > notification | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > allowed if no response | | | | > | | | | > \- Location with | | | | > notification and privacy | | | | > verification; location | | | | > restricted if no | | | | > response | | | | > | | | | > \- Time period when | | | | > positioning is allowed | | | | > | | | | > \- Geographical area | | | | > where positioning is | | | | > allowed | | | | > | | | | > \- Indication that | | | | > codeword shall be | | | | > checked in UE or one or | | | | > more codeword values to | | | | > be checked in GMLC | +----------------------------+----------+----------------------------+ | PLMN Operator Class | O | LCS client list: a list of | | | | one or more generic | | | | classes of LCS client that | | | | are allowed to locate the | | | | particular UE. The | | | | following classes are | | | | distinguished: | | | | | | | | > \- LCS client | | | | > broadcasting location | | | | > related information | | | | > | | | | > \- O&M LCS client in the | | | | > HPLMN | | | | > | | | | > \- O&M LCS client in the | | | | > VPLMN | | | | > | | | | > \- LCS client recording | | | | > anonymous location | | | | > information | | | | > | | | | > \- LCS Client supporting | | | | > a bearer service, | | | | > teleservice or | | | | > supplementary service to | | | | > the target UE | | | | > | | | | > \- NWDAF in the HPLMN | | | | > (when the UE is | | | | > currently being served | | | | > by the HPLMN) | | | | > | | | | > \- NWDAF in the VPLMN | +----------------------------+----------+----------------------------+ | User Plane Connection | O | Indication of one of the | | between UE and LCS Client | | following mutually | | or AF | | exclusive global settings: | | | | | | | | > \- UE is allowed to | | | | > report periodic or | | | | > triggered location | | | | > events via user plane to | | | | > an LCS Client or AF | | | | > | | | | > \- UE is not allowed to | | | | > report periodic or | | | | > triggered location | | | | > events via user plane to | | | | > an LCS Client or AF | | | | > (default) | +----------------------------+----------+----------------------------+ | Event report expected area | O | Presents a geographical | | | | area generated by UE, | | | | which is used by GMLC to | | | | determine event report | | | | allowed area for the UE | +----------------------------+----------+----------------------------+ | Area usage indication | O | Indication of one of the | | | | following mutually | | | | exclusive global settings | | | | on using event report | | | | allowed area: | | | | | | | | > \- Inside reporting | | | | > (default) | | | | > | | | | > \- Outside reporting | +----------------------------+----------+----------------------------+ | GMLC address list | O | Addresses of GMLC located | | | | in local network(s) which | | | | are allowed to be used for | | | | the UE positioning | +----------------------------+----------+----------------------------+
The Mobile Originating data is defined in table 7.1-2 containing the LCS MO-LR
services that a UE can receive.
Table 7.1-2: LCS Mobile Originated data for a UE Subscriber
+----------------------------+----------+----------------------------+ | MO-LR Data | Presence | UDM data | +----------------------------+----------+----------------------------+ | Mobile Originated data | M | List of MO-LR services | | | | allowed for a UE | | | | subscriber: | | | | | | | | > \- Basic Self Location | | | | > (UE can receive its own | | | | > location) | | | | > | | | | > \- Autonomous Self | | | | > Location (UE can receive | | | | > location assistance | | | | > data) | | | | > | | | | > \- Transfer to Third | | | | > Party | +----------------------------+----------+----------------------------+ | List of Assistance Data | O | A list of one or more | | Types for MO-LR | | types of location | | | | assistance data that may | | | | be provided to the UE in | | | | the MO-LR procedure. | +----------------------------+----------+----------------------------+
The LCS broadcasting data is defined in table 7.1-3 containing a list of
assistance data types for which ciphering keys should be provided to the UE if
requested by the UE.
Table 7.1-3: LCS broadcasting data for a UE subscriber
* * *
Broadcasting Data Presence Description List of Assistance Data Types O A list
of one or more types of location assistance data for which ciphering keys
should be provided to the UE if requested by the UE when the assistance data
is broadcast using ciphering.
* * *
Other UE LCS subscriber data is defined in table 7.1-4 containing UE\'s
subscription data related with LCS.
Table 7.1-4: UE LCS subscriber data
* * *
UE LCS subscriber data Presence Description PRU indication O When present, it
is used to indicate that the UE is allowed to serve as a PRU. LPHAP indication
O When present, it indicates a UE requires low power and high accuracy
positioning. LMF ID O An LMF ID which presents an LMF deployed in local
network to support location service for the UE. Indication of user plane
positioning between UE and LMF O When present, it indicates that the UE is
allowed to use the user plane positioning between UE and LMF.
* * *
## 7.2 GMLC
### 7.2.1 Information for an LCS Client
The GMLC holds information for external LCS clients which are permitted to
request location information for UE subscribers. Table 7.2.1-1 shows the
information which may be stored in the GMLC for an external LCS Client.
Table 7.2.1-1: GMLC Information for an External LCS Client
+-----------------------------+--------+-----------------------------+ | LCS Client Information | Status | Description | +-----------------------------+--------+-----------------------------+ | LCS Client Type | M | Identifies the type of LCS | | | | client from among the | | | | following: | | | | | | | | - Emergency Services | | | | | | | | - Value Added Services | | | | | | | | - PLMN Operator Services | | | | | | | | - Lawful Intercept | | | | Services | +-----------------------------+--------+-----------------------------+ | External identifier | O | A list of one or more | | | | identifiers used to | | | | identify an external LCS | | | | client. The identifier may | | | | be used for a 5GC-MT-LR | | | | and/or 5GC-MO-LR. The | | | | format of the identifier is | | | | an international E.164 | | | | address, ITU-T | | | | Recommendation | | | | E.164 [23]. | +-----------------------------+--------+-----------------------------+ | Authentication data | MO | Data employed to | | | | authenticate an external | | | | LCS client if the | | | | authentication is not done | | | | by a security gateway -- | | | | details are outside the | | | | scope of the present | | | | document | +-----------------------------+--------+-----------------------------+ | Internal identifier | O | Identifies the sub-type of | | | | a PLMN operator services | | | | LCS Client from among the | | | | following: | | | | | | | | - LCS client broadcasting | | | | location related | | | | information | | | | | | | | - O&M LCS client in the | | | | HPLMN | | | | | | | | - O&M LCS client in the | | | | VPLMN | | | | | | | | - LCS client recording | | | | anonymous location | | | | information | | | | | | | | - LCS Client supporting a | | | | bearer service, teleservice | | | | or supplementary service to | | | | the target UE | +-----------------------------+--------+-----------------------------+ | Client name | O | An address string which is | | | | associated with the LCS | | | | client\'s external identity | | | | (i.e. E.164 address). | +-----------------------------+--------+-----------------------------+ | Client name type | O | Indication of the type of | | | | the LCS client name. The | | | | type of the LCS client name | | | | can be one of the | | | | following: | | | | | | | | - Logical name | | | | | | | | - MSISDN | | | | | | | | - E-mail address | | | | (RFC 2396 [25]) | | | | | | | | - URL (RFC 2396 [25]) | | | | | | | | - SIP URL | | | | (RFC 3261 [26]) | | | | | | | | - IMS public identity | | | | (1 23.228 [27]) | | | | | | | | - GPSI | +-----------------------------+--------+-----------------------------+ | Privacy Override Indication | O | Indication of whether the | | | | LCS client possesses the | | | | POI capability (only | | | | applicable to lawful | | | | intercept and emergency | | | | services clients) | +-----------------------------+--------+-----------------------------+ | Authorized UE List | O | A list of SUPIs and/or | | | | groups of SUPI for which | | | | the LCS client may issue a | | | | request for a 5GC-MT-LR for | | | | immediate or deferred | | | | location. | +-----------------------------+--------+-----------------------------+ | Priority | O | The priority of the LCS | | | | client | +-----------------------------+--------+-----------------------------+ | QoS parameters | M | The default QoS | | | | requirements for the LCS | | | | client, comprising: | | | | | | | | - Accuracy | | | | | | | | - Response time | | | | | | | | - LCS QoS Class | +-----------------------------+--------+-----------------------------+ | Service Coverage | O | A list of E.164 country | | | | codes for geographic areas, | | | | ITU-T Recommendation | | | | E.164 [23] where the LCS | | | | client is permitted to | | | | request and receive UE | | | | location information. | +-----------------------------+--------+-----------------------------+ | Allowed LCS Request Types | M | Indicates which of the | | | | following are allowed: | | | | | | | | - Request of current | | | | immediate location | | | | | | | | - Request of current or | | | | last known immediate | | | | location | | | | | | | | - Request of deferred | | | | location for the UE | | | | available event | | | | | | | | - Request of deferred | | | | location for UE periodic | | | | events | | | | | | | | - Request of deferred | | | | location for the Area Event | | | | | | | | - Request of deferred | | | | location for the Motion | | | | Event | +-----------------------------+--------+-----------------------------+ | Local Co-ordinate System | O | Definition of the | | | | co-ordinate system(s) in | | | | which a location estimate | | | | shall be provided -- | | | | details are outside the | | | | scope of the present | | | | document | +-----------------------------+--------+-----------------------------+ | Access Barring List(s) | O | List(s) of SUPIs or groups | | | | of SUPI for which a | | | | location request is barred | +-----------------------------+--------+-----------------------------+ | Service types | O | List of service type | | | | allowed for the LCS client. | +-----------------------------+--------+-----------------------------+ | Maximum Target UE Number | O | The maximum number of the | | | | Target UEs in one LCS | | | | request. For a specific LCS | | | | Client, this parameter may | | | | have different values for | | | | different service types. | +-----------------------------+--------+-----------------------------+ | User Plane location | O | Indicates whether or not | | reporting | | the LCS Client is allowed | | | | to request event reporting | | | | for a periodic or triggered | | | | MT-LR over user plane. | +-----------------------------+--------+-----------------------------+ | | O | Default user plane address | | | | for event reporting over | | | | user plane. | +-----------------------------+--------+-----------------------------+ | | O | Default security | | | | information for event | | | | reporting over user plane. | +-----------------------------+--------+-----------------------------+ | Correlated LMF ID | O | An LMF ID correlated with | | | | the LCS client, and/or | | | | | | | | An LMF ID correlated with a | | | | group ID and the LCS | | | | client. | +-----------------------------+--------+-----------------------------+
# 8 Network Function Services
## 8.1 AMF Services
AMF services related to location service are defined in clause 5.2.2 of TS
23.502 [19].
## 8.2 UDM Services
UDM services related to location service are defined in clause 5.2.3 of TS
23.502 [19].
## 8.3 LMF Services
### 8.3.1 General
The following table shows the LMF Services and LMF Service Operations.
Table 8.3.1-1: List of LMF Services
+----------------+----------------+----------------+----------------+ | Service Name | Service | Operation | Example | | | Operations | | Consumer(s) | | | | Semantics | | +================+================+================+================+ | Nlmf_Location | Det | Re | AMF | | | ermineLocation | quest/Response | | +----------------+----------------+----------------+----------------+ | | EventNotify | Notify | GMLC | +----------------+----------------+----------------+----------------+ | | CancelLocation | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | LocationC | Re | LMF | | | ontextTransfer | quest/Response | | +----------------+----------------+----------------+----------------+ | | M | Re | LMF | | | easurementData | quest/Response | | +----------------+----------------+----------------+----------------+ | | UPConfig | Re | AMF | | | | quest/Response | | +----------------+----------------+----------------+----------------+ | | UPSubcribe | Su | AMF | | | | bscribe/Notify | | +----------------+----------------+----------------+----------------+ | | UPNotify | | AMF | +----------------+----------------+----------------+----------------+ | N | Ci | Notify | AMF | | lmf_Broadcast | pheringKeyData | | | +----------------+----------------+----------------+----------------+
### 8.3.2 Nlmf_Location service
#### 8.3.2.1 General
**Service description:** This service enables an NF to request location
determination for a target UE. The following are the key functionalities of
this NF service.
\- Allow the consumer NF to request the current geodetic and optionally local
and/or civic location of a target UE.
\- Allow the consumer NF to subscribe/unsubscribe the geodetic and optionally
local and/or civic location of a target UE for some certain events.
\- Allow the consumer NF to get notified about the geodetic and optionally
local and/or civic location of a target UE when some certain events are
detected.
\- Allows the consumer NF to cancel location event reporting for a target UE.
\- Allows the consumer NF to transfer location context information for
location event reporting for a target UE.
\- Allows the consumer NF to request the PRU location measurement.
\- Allows the consumer NF to request to set up, modify or terminate a secure
LCS-UP connection for a target UE.
\- Allows the consumer NF to get notified about status or modification of a
secure LCS-UP connection for a target UE.
The events to trigger location estimation notification are defined in clause
4.1a.5.1
#### 8.3.2.2 Nlmf_Location_DetermineLocation service operation
**Service operation name:** Nlmf_Location_DetermineLocation
**Description:** Provides UE location information to the consumer NF.
NOTE: For deferred location request, this service operation is used to
implicitly subscribe to the notification of the UE location information.
**Input, Required:** Client Type, LCS Correlation Identifier.
**Input, Optional:** Serving cell identifierof the Primary Cell in the Master
RAN node and the Primary Cell in the Secondary RAN node when available based
on Dual Connectivity scenarios if the UE is using 3GPP access, required
Location QoS instance(s), Supported GAD shapes, service type, indication of
requiring reliable UE location information, AMF identity if a UE associated
Namf_Communication service is to be invoked by LMF, Type of request for a 5GC-
MO-LR, Embedded LPP message(s) for a 5GC-MO-LR (1-3 messages), subscribed
assistance data for a 5GC-MO-LR, Deferred location type, Deferred location
parameters, indication if UE supports LPP or not, UE connectivity state per
access type, Notification Target Address, Notification Correlation ID,
indication of UE geographical area determination for PLMN selection
verification, UE Positioning Capability, UE User Plane Positioning Capability,
TNAPId (see TS 29.571 [33]), TWAPId (see TS 29.571 [33]), Scheduled Location
Time, request for user plane reporting to an LCS Client or AF, user plane
address of an LCS Client or AF, user plane security information for an LCS
Client or AF, cumulative event report timer, maximum number of user plane
event reports to an LCS Client or AF, event report allowed area, reporting
indication, UE unaware indication, LPHAP indication, the serving cell identity
belongs to a MBSR indication, IAB-UE ID of the MBSR.
**Output, Required:** Success/Failure indication
**Output, Optional:** Geodetic Location, Local Location including Coordinate
ID, Civic Location, Indoor/Outdoor indication, LOS/NLOS measurement
indication, Position Methods Used (in the case of success indication
provided), Serving LMF identification, Failure Cause (in the case of failure
indication provided), achieved Location QoS Accuracy, UE geographical area
where a PLMN is or is not allowed to operate, UE Positioning Capability, the
timestamp of the Location, indication that the location determination will be
sent directly to GMLC.
See clause 6.1, clause 6.2. clause 6.3.1 and clause 6.9.1 for examples of
usage of this service operation.
#### 8.3.2.3 Nlmf_Location_EventNotify service operation
**Service operation name:** Nlmf_Location_EventNotify.
**Service operation description:** Allow the consumer NF to get notified about
the geodetic and optionally local and/or civic location of a target UE when
some certain events are detected, either the events implicitly subscribed by
the AMF using Nlmf_Location_DetermineLocation service operation or the
cancellation of reporting of periodic or triggered location events.
**Input, Required:** Notification Correlation ID, UE (SUPI and if available
GPSI).
**Input, Optional:** Geodetic Location, Local Location including Coordinate
ID, Civic Location, Indoor/Outdoor indication, LOS/NLOS measurement
indication, Position Methods Used (in the case of success indication
provided), Notification Target address, Serving LMF identification, Failure
Cause (in the case of failure indication provided), achieved Location QoS
Accuracy, the timestamp of the Location, Type of event (e.g. including a
cumulative event report for events reported via user plane), statistics on
events reported via a user plane since the last cumulative event report.
**Output, Required:** None _._
**Output, Optional:** Success/Failure indication _._
See clause 6.3.1 and clause 6.3.2 for examples of usage of this service
operation.
#### 8.3.2.4 Nlmf_Location_CancelLocation service operation
**Service operation name:** Nlmf_Location_CancelLocation
**Description:** The consumer NF cancels a deferred 5GC-MT-LR procedure for
periodic or triggered location request.
**Input, Required:** Notification Target Address, Notification Correlation ID.
**Input, Optional:** None.
**Output, Required:** Success/Failure indication
**Output, Optional:** None.
See clause 6.3.3 for an example of usage of this service operation.
#### 8.3.2.5 Nlmf_Location_LocationContextTransfer service operation
**Service operation name:** Nlmf_Location_LocationContextTransfer
**Description:** Transfers location context information for location event
reporting for a target UE from the consumer NF.
**Input, Required:** AMF identity, Location QoS, Supported GAD shapes,
Deferred location type, Deferred location parameters, Notification Target
Address, Notification Correlation ID, Embedded event report message.
**Input, Optional:** Event reporting status, UE location information, LOS/NLOS
measurement indication, Indoor/Outdoor indication, UE Positioning
Capabilities, Scheduled Location Time, the timestamp of the Location, request
for user plane reporting to an LCS Client or AF, cumulative event report
timer, maximum number of user plane event reports to an LCS Client or AF.
**Output, Required:** Success/Failure indication
**Output, Optional:** None.
See clause 6.4 for an example of usage of this service operation.
#### 8.3.2.6 Nlmf_Location_MeasurementData service operation
**Service operation name:** Nlmf_Location_MeasurementData
**Description:** Provides PRU location measurements to the consumer NF.
**Input, Required:** Target UE cell ID.
**Input, Optional:** Pre-calculated location of target UE.
**Output, Required:** PRU location measurement(s) and associated PRU known
location.
**Output, Optional:** None.
See clause 6.17 for an example of usage of this service operation.
#### 8.3.2.7 Nlmf_Location_UPConfig service operation
**Service operation name:** Nlmf_Location_UPConfig
**Description:** The consumer NF requests to set up, modify or terminate a
secure LCS-UP connection for a target UE.
**Input, Required:** Notification Target Address, UE identifier (GPSI, SUPI).
**Input, Optional:** AMF reallocation indication, LCS-UP connection
termination indication, LCS-UP connection set up request indication, Target
LMF identifier.
**Output, Required:** Success/Failure indication
**Output, Optional:** Failure Cause (in the case of failure indication
provided).
See clauses 6.18.2 and 6.18.3 for an example of usage of this service
operation.
#### 8.3.2.8 Nlmf_Location_UPSubscribe service operation
**Service operation name:** Nlmf_Location_UPSubscribe
**Description:** Allow the consumer NF to subscribe about status of a secure
LCS-UP connection for a target UE.
**Input, Required:** Notification Target Address, UE identifier (SUPI and if
available GPSI).
**Input, Optional:** None.
**Outputs, Required:** None.
**Outputs, Optional:** None.
#### 8.3.2.9 Nlmf_Location_UPNotify service operation
**Service operation name:** Nlmf_Location_UPNotify
**Description:** Allow the consumer NF get notified about status or
modification of a secure LCS-UP connection for a target UE.
**Input, Required:** Notification Correlation Information, LCS-UP connection
status (established, released or move indication).
**Input, Optional:** Target LMF identifier (only applicable in case of move of
the connection).
**Output, Required:** None.
**Output, Optional:** None.
See clauses 6.18.1 and 6.18.3 for an example of usage of this service
operation.
### 8.3.3 Nlmf_Broadcast service
#### 8.3.3.1 General
Service description: This service enables an NF to receive information related
to broadcast of location assistance by an LMF. The following are the key
functionalities of this NF service.
\- Allow the consumer NF to be notified about ciphering keys used to cipher
broadcast assistance data.
The events to trigger ciphering key notification are defined in clause 6.14.2.
#### 8.3.3.2 Nlmf_Broadcast_CipheringKeyData service operation
**Service operation name:** Nlmf_Broadcast_CipheringKeyData
**Description:** Provides ciphering key data to the consumer NF.
**Input, Required:** For each ciphering key: ciphering key value, ciphering
key identifier, validity period, set of applicable types of broadcast
assistance data.
**Input, Optional:** For each ciphering key: set of applicable tracking areas.
**Output, Required:** For each ciphering key: ciphering key identifier,
success/failure indication.
**Output, Optional:** none.
See clause 6.14.2 for an example of usage of this service operation.
## 8.4 GMLC Services
### 8.4.1 General
The following table shows the GMLC Services and GMLC Service Operations.
Table 8.4.1-1: List of GMLC Services
+-----------------+----------------------+--------------------+---------------------+ | Service Name | Service Operations | Operation | Example Consumer(s) | | | | | | | | | Semantics | | +=================+======================+====================+=====================+ | Ngmlc_Location | ProvideLocation | Request / Response | GMLC, NEF, NWDAF | +-----------------+----------------------+--------------------+---------------------+ | | LocationUpdate | Request / Response | AMF, GMLC | +-----------------+----------------------+--------------------+---------------------+ | | LocationUpdateNotify | Notify | NEF, NWDAF | +-----------------+----------------------+--------------------+---------------------+ | | CancellLocation | Request / Response | GMLC, NEF, NWDAF | +-----------------+----------------------+--------------------+---------------------+ | | EventNotify | Notify | GMLC, NEF, NWDAF | +-----------------+----------------------+--------------------+---------------------+
### 8.4.2 Ngmlc_Location service
#### 8.4.2.1 General
**Service description:** This service enables an NF to request location
determination for a target UE. The following are the key functionalities of
this NF service.
\- Allow the consumer NF to request the current geodetic and optionally local
and/or civic location of a target UE.
\- Allow the consumer NF to subscribe/unsubscribe the geodetic and optionally
local and/or civic location of a target UE for some certain events.
\- Allow the consumer NF to cancel an on-going periodic or triggered location
request of a target UE.
\- Allow the consumer NF to get notified about the geodetic and optionally
local and/or civic location of a target UE when some certain events are
detected.
#### 8.4.2.2 Ngmlc_Location_ProvideLocation service operation
**Service operation name:** Ngmlc_Location_ProvideLocation
**Description:** Provides UE location information to the consumer NF.
NOTE 1: For deferred location request, this service operation is used to
implicitly subscribe to the notification of the UE location information.
NOTE 2: For bulk LCS service request from NEF to GMLC, this service operation
is used to implicitly subscribe to the notification of UE location information
**Input, Required:** UE identifier (GPSI, SUPI, Internal Group Identifier or
External Group Identifier), Client Type.
**Input, Optional:** Required QoS instance(s), Supported GAD shapes, UE
privacy requirements, LCS Client Identification, Service type, indication of
requiring reliable UE location information, Notification Target Address,
Notification Correlation ID, Event Type (defined in clause 4.1a.5.1),
Scheduled Location Time, request for user plane reporting to an LCS Client or
AF, user plane address of an LCS Client or AF, user plane security information
for an LCS Client or AF, cumulative event report timer, maximum number of user
plane event reports to an LCS Client or AF, event report expected area,
reporting indication, LPHAP indication and:
\- For periodic event type, optional input further includes the time interval
between successive location reports, the total number of reports, location
QoS.
\- For area event type, optional input further includes target geographical
area(s) with optionally associated required QoS instance, whether the event to
be reported is the UE being inside, entering into or leaving the target area,
the duration of event reporting, the minimum and maximum time intervals
between successive event reports, the maximum event sampling interval, whether
location estimates and associated location QoS shall be included in event
reports, and whether only one location report is required or more than one.
\- For motion event type, optional input further includes the threshold linear
distance, the duration of event reporting, the minimum and maximum time
intervals between successive event reports, the maximum event sampling
interval, whether location estimates and associated location QoS shall be
included in event reports, and whether only one location report is required or
more than one.
**Output, Required:** Success/Failure indication
**Output, Optional:** Geodetic location, Local Location including Coordinate
ID, civic location, age of location, Indoor/Outdoor indication, LOS/NLOS
measurement indication, position methods used (in the case of success
indication provided), failure cause (in the case of failure indication
provided), achieved Location QoS Accuracy, the timestamp of the Location.
See clauses 6.3.1 and 6.8 for examples of usage of this service operation.
#### 8.4.2.3 Ngmlc_Location_LocationUpdate service operation
**Service operation name:** Ngmlc_Location_LocationUpdate
**Description:** Consumer NF provides UE location information to the GMLC.
**Input, Required:** UE identifier (GPSI or SUPI), event causing the location
estimate (5GC-MO-LR), location estimate, age of location estimate, accuracy
indication, LCS QoS class.
**Input, Optional:** pseudonym indicator, identity of the LCS client, identity
of the AF, GMLC address, service type specified by UE, the timestamp of the
location estimate.
**Output, Required:** Success/Failure indication
**Output, Optional:** Failure Cause (in the case of failure indication
provided).
See clause 6.2 for example of usage of this service operation.
#### 8.4.2.4 Ngmlc_Location_EventNotify service operation
**Service operation name:** Ngmlc_Location_EventNotify
**Description:** Allow the consumer NF to get notified about the geodetic and
optionally local and/or civic location of one or more target UEs when some
certain events, either the events implicitly subscribed by the AMF using
Ngmlc_Location_ProvideLocation service operation, or the cancellation of
reporting of periodic or triggered location events, are detected or at bulk
reporting of location.
**Input, Required:** Notification Correlation ID, UE (SUPI and if available
GPSI), Type of location related event (e.g. deferred location for the UE
available event, activation of location for periodic or triggered location,
mobility of a target UE to a new AMF or MME for a deferred location,
cumulative event report for events reported via user plane).
**Input, Optional:** Geodetic Location, Local Location including Coordinate
ID, Civic Location, Indoor/Outdoor indication, LOS/NLOS measurement
indication, Position Methods Used (in the case of success indication
provided), Failure Cause (in the case of failure indication provided), address
of a new AMF or MME, achieved Location QoS Accuracy, the timestamp of the
Location, statistics on events reported since the last cumulative event
report.
**Output, Required:** None _._
**Output, Optional:** None _._
See clauses 6.3 and 6.8 for examples of usage of this service operation.
#### 8.4.2.5 Ngmlc_Location_CancelLocation service operation
**Service operation name:** Ngmlc_Location_CancelLocation
**Description:** The consumer NF uses this service operation to cancel a
deferred 5GC-MT-LR procedure for periodic or triggered location.
**Input, Required:** UE Identification (SUPI), Notification Target address,
Notification Correlation ID.
**Input, Optional:** None.
**Output, Required:** None _._
**Output, Optional:** None _._
See clause 6.3.3 for example of usage of this service operation.
#### 8.4.2.6 Ngmlc_Location_LocationUpdateNotify service operation
**Service operation name:** Ngmlc_Location_LocationUpdateNotify
**Description:** Provides UE location information to the consumer NF.
**Input, Required:** UE identifier (GPSI or SUPI), identity of the AF, event
causing the location estimate (5GC-MO-LR), location estimate, age of location
estimate, accuracy indication, LCS QoS class.
**Input, Optional:** Service identity (mapped from service type by HGMLC), the
timestamp of the location estimate.
**Output, Required:** Success/Failure indication.
**Output, Optional:** Failure Cause (in the case of failure indication
provided).
See clause 6.2 for example of usage of this service operation.
## 8.5 NEF Services
For 5GC-MT-LR procedures, location reporting is one of the monitoring events,
as defined in clause 4.15.3.1 of TS 23.502 [19], supported by
Nnef_EventExposure service.
Nnef_EventExposure service operations are defined in clause 5.2.6.2 of TS
23.502 [19].
The attributes that may be included in the location service request and
response are listed in clause 5.5.
For 5GC-MO-LR procedure, if UE requests to report its location to AF, the
location reporting is supported by Nnef_Location_LocationUpdateNotify service
operation defined in clause 5.2.6.21 of TS 23.502 [19].
## 8.6 UDR Services
UDR services related to location service are defined in clause 5.2.3 of TS
23.502 [19].
###### ## Annex A (informative): Differences with TS 23.271 [4]
# A.0 General
Differences with TS 23.271 [4] are described here where these may impact
service to a target UE, LCS client, or client AF or NF. The differences are
restricted to those applicable to a UE with EPS access in the case of TS
23.271 [4] and do not include all differences applicable to GERAN or UTRAN
access.
# A.1 Differences in Parameters for a Location Request
Table A.1-1 shows a list of parameters applicable to a location request sent
by an external LCS client to a GMLC which are defined in TS 23.271 [4],
differences if any with this TS, and comments on these including any
significant consequences.
Table A.1-1: Differences in Parameters for a Location Request with TS 23.271
[4]
+----------------------+----------------------+----------------------+ | Location Request | Difference | Comments | | Parameter | | | +======================+======================+======================+ | Target UE Identity | GPSI, SUPI or | | | | pseudonym in this TS | | | | | | | | MSISDN, IMSI or | | | | pseudonym in | | | | TS 23.271 [4] | | +----------------------+----------------------+----------------------+ | LCS QoS | None | | +----------------------+----------------------+----------------------+ | Supported GAD shapes | None | | +----------------------+----------------------+----------------------+ | LCS Client type | None | | +----------------------+----------------------+----------------------+ | Called Party Number | Not supported in | If provided, this | | | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | APN NI | Not supported in | If provided, this | | | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | Service Identity | None | | +----------------------+----------------------+----------------------+ | Codeword | None | | +----------------------+----------------------+----------------------+ | Service coverage | None | | | information | | | +----------------------+----------------------+----------------------+ | Requestor Identity | Not supported in | If provided, this | | | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | Type of Requestor | Not supported in | If provided, this | | Identity | this TS | parameter should be | | | | ignored by a GMLC | +----------------------+----------------------+----------------------+ | Type of a deferred | None | | | location request | | | +----------------------+----------------------+----------------------+ | Periodic Location | None | | | parameters | | | +----------------------+----------------------+----------------------+ | Area Event | None | | | parameters | | | +----------------------+----------------------+----------------------+ | Motion Event | None | | | parameters | | | +----------------------+----------------------+----------------------+
# A.2 Differences in Information Storage in the UDR/UDM versus HSS/GMLC for
EPS
Table A.2-1 shows a list of LCS information storage items for a UE in the UDR
and UDM defined in this TS and for the HSS and/or GMLC defined in TS 23.271
[4], differences if any between this TS and TS 23.271 [4], and comments on
these including any significant consequences.
Table A.2-1: Differences in Information Storage for a UE in the UDR/UDM versus
HSS/GMLC for EPS
+----------------------+----------------------+----------------------+ | Information Storage | Difference | Comments | | Item(s) | | | +======================+======================+======================+ | UE Privacy Universal | Not supported in | This privacy class | | Class | this TS | should not be | | | | supported for 5GC | | | | capable UEs on the | | | | EPS side to avoid | | | | differences in LCS | | | | privacy support | | | | between EPS access | | | | and 5GS access for | | | | the same UE. (Note | | | | 1) | +----------------------+----------------------+----------------------+ | UE Location Privacy | Not supported in | This indication can | | Indication | TS 23.271 [4] | create differences | | | | between LCS client | | | | access to a UE which | | | | has 5GS access | | | | versus EPS access. | | | | (Note 1) | +----------------------+----------------------+----------------------+ | UE Privacy | Not supported in | This privacy class | | Call/Session related | this TS | should not be | | Class | | supported for 5GC | | | | capable UEs on the | | | | EPS side to avoid | | | | differences in LCS | | | | privacy support | | | | between EPS access | | | | and 5GS access for | | | | the same UE. (Note | | | | 1) | +----------------------+----------------------+----------------------+ | UE Privacy | Supported as defined | This privacy class | | Call/Session | in TS 23.271 [4] | can create | | unrelated Class | with the following | differences between | | | differences: | LCS client access to | | | | a UE which has 5GS | | | - Information | access versus EPS | | | related to an RGMLC | access. (Note 1) | | | is not included | | | | | | | | - An optional time | | | | period is not | | | | supported in | | | | TS 23.271 [4] | | | | | | | | - An optional | | | | geographic area is | | | | not supported in | | | | TS 23.271 [4] | | +----------------------+----------------------+----------------------+ | UE Privacy PLMN | None | | | Operator Class | | | +----------------------+----------------------+----------------------+ | UE LCS Mobile | None | | | Originating Data | | | +----------------------+----------------------+----------------------+ | NOTE 1: A PLMN | | | | operator can avoid | | | | any difference in UE | | | | privacy support for | | | | EPS access versus | | | | 5GS access by only | | | | storing information | | | | for UE privacy (in | | | | the UE LCS privacy | | | | profile) in a UDR | | | | (and UDM) and not in | | | | an HSS or GMLC. | | | +----------------------+----------------------+----------------------+
# A.3 Differences in Information Storage in the GMLC
Table A.3-1 shows a list of information storage items in the GMLC for an LCS
Client defined in this TS and in TS 23.271 [4], differences if any between
this TS and TS 23.271 [4], and comments on these including any significant
consequences.
Table A.3-1: Differences in Information Storage for an LCS Client in the GMLC
+----------------------+----------------------+----------------------+ | Information Storage | Difference | Comments | | Item(s) | | | +======================+======================+======================+ | LCS Client Type | None | | +----------------------+----------------------+----------------------+ | LCS Client Type | None | | +----------------------+----------------------+----------------------+ | External identity | None | | +----------------------+----------------------+----------------------+ | Authentication data | None | | +----------------------+----------------------+----------------------+ | Call/session related | Not supported in | This information | | identity | this TS | item can create | | | | differences between | | | | LCS client access to | | | | a UE which has 5GS | | | | access versus EPS | | | | access. (Note 1) | +----------------------+----------------------+----------------------+ | Internal identity | None | | +----------------------+----------------------+----------------------+ | Client name | None | | +----------------------+----------------------+----------------------+ | Client name type | No difference except | A GPSI can be an | | | that this TS adds a | MSISDN or External | | | Client Name type in | Identifier in the | | | the form of a GPSI. | form of | | | | \"username\@realm\" | | | | as defined in | | | | TS 23.003 [28]. | | | | | | | | TS 23.271 [4] | | | | allows an MSISDN but | | | | the External | | | | Identifier is not | | | | included. | +----------------------+----------------------+----------------------+ | Override capability | None | | +----------------------+----------------------+----------------------+ | Authorized UE List | None | | +----------------------+----------------------+----------------------+ | Priority | None | | +----------------------+----------------------+----------------------+ | QoS parameters | None | | +----------------------+----------------------+----------------------+ | Service Coverage | None | | +----------------------+----------------------+----------------------+ | Allowed LCS + | TS 23.271 [4] | This TS should take | | Request Types | includes the | precedence (Note 1) | | | following items | | | | which are not in | | | | this TS: | | | | | | | | - Non-call related | | | | CS-MT-L | | | | R/PS-MT-LR/EPC-MT-LR | | | | | | | | - Call/session | | | | related | | | | CS-MT-L | | | | R/PS-MT-LR/EPC-MT-LR | | | | | | | | - Specification or | | | | negotiation of | | | | priority | | | | | | | | - Specification or | | | | negotiation of QoS | | | | parameters | | | | | | | | - Specification or | | | | negotiation of | | | | Service Coverage | | | | parameter | | | | | | | | This TS includes the | | | | following items | | | | which are not in | | | | TS 23.271 [4]: | | | | | | | | - Request of | | | | deferred location | | | | for the UE available | | | | event | | | | | | | | - Request of | | | | deferred location | | | | for UE periodic | | | | events | | | | | | | | - Request of | | | | deferred location | | | | for the Area Event | | | | | | | | - Request of | | | | deferred location | | | | for the Motion Event | | +----------------------+----------------------+----------------------+ | Local Co-ordinate | None | | | System | | | +----------------------+----------------------+----------------------+ | Access Barring | TS 23.271 [4] | This TS can take | | List(s) | includes a list of | precedence (Note 1) | | | MSISDNs. | | | | | | | | This TS includes a | | | | list of SUPIs | | +----------------------+----------------------+----------------------+ | Service Identities | None | | +----------------------+----------------------+----------------------+ | Maximum Target UE | None | | | Number | | | +----------------------+----------------------+----------------------+ | NOTE 1: A PLMN | | | | operator can avoid | | | | any difference in | | | | LCS Client support | | | | for a target UE with | | | | EPS access versus | | | | 5GS access by only | | | | storing information | | | | for an LCS Client in | | | | a GMLC as defined in | | | | this TS. | | | +----------------------+----------------------+----------------------+
# A.4 Differences with TS 23.271 [4] on Privacy
## A.4.1 Differences in UE LCS Privacy
Table A.4.1-1 shows a list of UE LCS privacy features defined in this
specification and in TS 23.271 [4], differences if any between these, and
comments on these including any significant consequences.
Table A.4.1-1: Differences in UE LCS Privacy with TS 23.271 [4]
+----------------------+----------------------+----------------------+ | UE LCS Privacy | Difference | Comments | | Feature | | | +======================+======================+======================+ | Privacy Override | None | | | Indicator (POI) | | | +----------------------+----------------------+----------------------+ | UE Privacy Universal | Not supported in | This class allows a | | Class | this TS | UE to subscribe to | | | | location by any LCS | | | | client. For such a | | | | UE, a 5GC GMLC will | | | | not support such | | | | location. | +----------------------+----------------------+----------------------+ | Location Privacy | Not supported in | As defined in | | Indication | TS 23.271 [4] | clause 5.4.2.3. | +----------------------+----------------------+----------------------+ | UE Privacy | Not supported in | This class permits | | Call/Session related | this TS | location by LCS | | Class | | clients to which the | | | | UE has established a | | | | PS session. | | | | | | | | A 5GC GMLC will not | | | | allow such location. | | | | However, the | | | | location can be | | | | allowed as part of | | | | the Call/Session | | | | unrelated class. | +----------------------+----------------------+----------------------+ | UE Privacy | Supported as defined | The optional valid | | Call/Session | in TS 23.271 [4] | time period and | | unrelated Class | with the following | valid geographic | | | differences: | area allow more | | | | precise control of | | | An optional valid | location reporting. | | | time period is added | For example, | | | | tracking of | | | An optional valid | employees by an | | | geographic area is | employer can be | | | added | restricted to a work | | | | location and/or | | | | normal work hours. | +----------------------+----------------------+----------------------+ | UE Privacy PLMN | Supported as defined | | | Operator Class | in TS 23.271 [4] | | +----------------------+----------------------+----------------------+
###### ## Annex B (informative): LCS privacy selection rule in serving NF
# B.1 LCS privacy selection flow rule
A 5GS-MT-LR may be applied to more than one LCS privacy data in the LCS
privacy profile, e.g. one or more privacy classes as defined in clause 5.4.2.2
and LPI as defined in clause 5.4.2.3. The 5GS-MT-LR may also require POI as
defined in clause 5.4.4. The Privacy selection flow is shown in Figure B.1-1.
Figure B.1-1: Privacy selection flow diagram
###### ## Annex C (informative): PNI-NPN architecture to support location
service with signalling optimisation
Figure C-1 shows the PNI-NPN architecture to support location services with
optimisation of signalling latency and privacy, with the corresponding
functional descriptions are defined in clause 5.13.
When UE access the NG-RAN in the local network, during the registration
procedure or service request procedure, NG-RAN selects the Serving AMF in the
public network. With appropriate configuration, local AMF cannot be selected
as the serving AMF for the UE.
Assuming NG-RAN 1 is the serving RAN of UE. NG-RAN 2 and NG-RAN 3 illustrated
in the figure below is for positioning signal measurement.
Figure C-1 PNI-NPN architecture to support location service with signalling
optimisation
#
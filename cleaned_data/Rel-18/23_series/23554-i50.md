# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
# 1 Scope
The present document specifies the functional architecture, procedures,
information flows and APIs for MSGin5G Service. MSGin5G Service provides
messaging communication capability in 5GS especially for Massive Internet of
Things (MIoT).
MSGin5G Service includes the following message communication models:
\- Point-to-Point message;
\- Application-to-Point message/ Point-to-Application message;
\- Group message;
\- Broadcast message.
The corresponding service requirements are defined in 3GPP TS 22.262 [2].
MSGin5G Service provides the following capabilities to enhance the message
delivery for all message communication models:
\- MSGin5G Store and Forward;
\- Message communication based on Messaging Topic;
\- Message Aggregation;
\- Message Segmentation and Reassembly;
\- Message Gateway to interwork with non MSGin5G messaging services;
\- Usage of Network Capabilities including UE reachability status monitoring
and MSGin5G device triggering.
The present specification also defines the usage and interactions of the
MSGin5G Service with SEAL services and the utilizing of SEAL functionalities
in MSGin5G service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.262: \"Message Service within the 5G System\".
[3] GSMA PRD RCC.07: \"RCC.07 Rich Communication Suite 9.0 Advanced
Communications Services and Client Specification\".
[4] OMA OMA-ERELD-LightweightM2M-V1_1-20180612-C: \"Enabler Release Definition
for LightweightM2M\".
[5] 3GPP TS 23.434: \"Service Enabler Architecture Layer for Verticals\".
[6] 3GPP TS 23.222: \"Functional architecture and information flows to support
Common API Framework for 3GPP Northbound APIs; Stage 2\".
> [7] 3GPP TS 23.502: \"Procedures for the 5G System\".
>
> [8] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
> with packet data networks and applications\".
>
> [9] 3GPP TS 29.122: \"T8 reference point for northbound Application
> Programming Interfaces (APIs)\".
>
> [10] 3GPP TS 29.522: \"5G System; Network Exposure Function Northbound APIs;
> Stage 3\".
>
> [11] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
> Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
>
> [12] 3GPP TS 23.501: \"System Architecture for the 5G System (5GS); Stage
> 2\".
>
> [13] 3GPP TS 23.204: \"Support of Short Message Service (SMS) over generic
> 3GPP Internet Protocol (IP) access; Stage 2\".
>
> [14] 3GPP TS 23.041: \"Technical realization of Cell Broadcast Service
> (CBS)\".
>
> [15] 3GPP TS 23.040: \"Technical realization of the Short Message Service
> (SMS)\".
>
> [16] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
>
> [17] 3GPP TS 32.240: \"Charging architecture and principles\".
[18] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System
(5GS)\".
[19] 3GPP TS 23.303: \"Proximity-based services (ProSe)\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**AS-to-Point messaging:** an MSGin5G message delivery that is originated at
an Application Server in the network and terminated at a UE.
**Broadcast Area:** an area consisting of one or more cells where the
broadcast message is delivered.
**Broadcast messaging:** an MSGin5G message delivery that is delivered to UEs
in a Broadcast Area.
**Broadcast Message Gateway:** the entity in MSGin5G Service to support
delivery Broadcast messages to Legacy 3GPP UEs, Non-3GPP UEs and MSGin5G UEs.
**Constrained UE:** an MSGin5G UE which cannot connect to the 3GPP network
directly for message exchange with MSGin5G Server.
**Group messaging** : message delivery that is originated at a UE or an
Application Server and is terminated at all members of the group (a group
member can be of type UE, Legacy 3GPP UE or Non-3GPP UE).
**Legacy 3GPP Message Gateway:** the entity in MSGin5G Service to support
interworking with Legacy 3GPP UEs.
**Legacy 3GPP UE:** the UE that supports legacy 3GPP message sending and
receiving (e.g. SMS, NIDD, etc) in MSGin5G Service.
**MSGin5G Client:** the client that enables MSGin5G message sending and
receiving.
**Message Gateway:** general terminology for Legacy 3GPP Message Gateway,
Non-3GPP Message Gateway, or Broadcast Message Gateway.
**MSGin5G Gateway UE:** an MSGin5G UE that can provide access to multiple
constrained UEs to connect to the 3GPP network for MSGin5G services.
**MSGin5G Group:** the group of UEs which members may be MSGin5G UE, Legacy
3GPP UE and Non-3GPP UE.
**MSGin5G message:** the message defined in the present specification that is
exchanged between the MSGin5G Service endpoints under the MSGin5G Service.
**MSGin5G Server:** a server in MSGin5G Service that receives and delivers
MSGin5G messages among MSGin5G Service endpoints.
**MSGin5G Service:** an MNO message service using the 5G System that enables
Point- to-Point, AS-to-Point, Point-to-AS, Group and Broadcast message
delivery for thing-to-thing communication and person-to-thing communication.
**Messaging Topic:** an identifier for a topic to which a UE or an Application
Server can subscribe to in order to receive messages that are characterized by
a Message Topic.
**MSGin5G UE:** the UE that uses MSGin5G Client in MSGin5G Service.
**Non-3GPP Message Gateway:** the entity in MSGin5G Service to support
interworking with Non-3GPP UEs.
**Non-3GPP UE:** the UE that supports non-3GPP message sending and receiving
(e.g. RCS message as specified in GSMA PRD RCC.07 [3], OMA LWM2M message as
specified in OMA OMA-ERELD-LightweightM2M [4]) in MSGin5G Service.
NOTE: The MSGin5G UE utilizes MSGin5G Client in MSGin5G Service. The Legacy
3GPP UE and Non-3GPP UE does not utilize MSGin5G Client in MSGin5G Service.
**Non-MSGin5G UE:** general terminology for Legacy 3GPP UE or Non-3GPP UE.
**Point-to-AS messaging:** an MSGin5G message delivery that is originated at a
UE and terminated at an Application Server.
**Point-to-Point messaging:** an MSGin5G message delivery that originates at a
UE and terminates at a UE, where at least one of the end points is an MSGin5G
UE.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
5GS 5G System
AOMT AS-Originated Mobile-Terminated
AS Application Server
BMG Broadcast Message Gateway
CAPIF Common API Framework for northbound APIs
MOAT Mobile-Originated AS-Terminated
MOMT Mobile-Originated Mobile-Terminated
NIDD Non IP Data Delivery
SCEF Service Capability Exposure Function
SCS Service Capability Server
SEAL Service Enabler Architecture Layer for Verticals
SMSC Short Message Service Center
VAL Vertical Application Layer
# 4 Architectural requirements
## 4.1 General
### 4.1.1 Description
This subclause specifies the general architecture requirements for MSGin5G
Service.
### 4.1.2 Requirements
[AR-4.1.2-a] The MSGin5G Client shall support one or more applications which
need to use the MSGin5G message exchanging capabilities.
[AR-4.1.2-b] The MSGin5G Server shall support one or more Applications Servers
which support the MSGin5G message exchanging capabilities.
[AR-4.1.2-c] The MSGin5G messaging related capabilities (e.g. registration,
Point-to-Point messaging, Group messaging, message delivery status, etc.)
should be exposed as APIs to the Applications Server(s).
[AR-4.1.2-d] The application architecture shall enable the communication
between the UEs in different PLMNs. The UEs support MSGin5G Service.
[AR-4.1.2-e] The MSGin5G service should support different application priority
levels for the MSGin5G messages including High, Normal and Low.
## 4.2 UE types
### 4.2.1 Description
This subclause specifies the requirements for UE types supported by MSGin5G
Service.
### 4.2.2 Requirements
[AR-4.2.2-a] The application architecture shall support the message exchanging
between the following UE types:
1\. MSGin5G UE:
1) constrained devices (e.g. sensors, actuators) and
2) unconstrained devices with advanced capabilities (e.g. washing machine,
micro-ovens)
2\. Legacy 3GPP UE
3\. Non-3GPP UE
[AR-4.2.2-b] The application architecture shall enable the unconstrained
devices to act as a MSGin5G Gateway UE to constrained devices to communicate
with MSGin5G Server.
## 4.3 Communication models
### 4.3.1 Description
This subclause specifies the requirements for MSGin5G communication models.
### 4.3.2 Requirements
[AR-4.3.2-a] The application architecture shall support the following message
communication models:
1 Point-to-Point message;
2 Application-to-Point message/ Point-to-Application message;
3 Group message;
4 Broadcast message.
[AR-4.3.2-b] The application architecture shall support interconnecting
between the MSGin5G Service and other different messaging delivery mechanisms,
(e.g. SMS as specified in 3GPP TS23.040 [15], or RCS message as specified in
GSMA PRD RCC.07 [3]).
## 4.4 Charging
### 4.4.1 Introduction
This subclause specifies the charging related requirements for the MSGin5G
Service.
### 4.4.2 Requirements
[AR-4.4.2] The MSGin5G Server shall support collecting charging information
from MSGin5G message according to the operator\'s charging policy including
charge per message, charge by amount of data, and flat rate (e.g., per month
or per year).
# 5 Application layer architecture
## 5.1 General
The following aspects of MSGin5G Service are described in this clause:
\- application architecture;
\- functional entities;
\- reference points;
\- capability exposure for enabling MSGin5G Service; and
\- service-based interface representation for MSGin5G Service.
## 5.2 Application Architecture
Figure 5.2-1 shows the application architecture of the MSGin5G service. The
MSGin5G service shall fulfil the service requirements which are enumerated in
3GPP TS 22.262 [2] and the architecture requirements enumerated in clause 4.
Figure 5.2-1: Application Architecture of the MSGin5G Service
The Application Client resides on the same UE with the MSGin5G Client as shown
in MSGin5G UE-1, or resides on a different UE and interacts with the MSGin5G
Client over the MSGin5G-5 reference point as shown in UE-2.
The MSGin5G Client(s) interacts with SEAL Clients over the SEAL-C reference
point specified for each SEAL service. The MSGin5G Server(s) interacts with
SEAL Servers over the SEAL-S reference point specified for each SEAL service.
The interaction between a SEAL Client and the corresponding SEAL Server is
supported by SEAL-UU reference point specified for each SEAL service as
specified in 3GPP TS 23.434 [5].
The MSGin5G UE-1 communicates with MSGin5G Server over MSGin5G-1 reference
point.
The Legacy 3GPP Message Gateway interacts with MSGin5G Server over MSGin5G-2
reference point on behalf of Legacy 3GPP UE (e.g., SMS, NIDD).
The Non-3GPP Message Gateway interacts with MSGin5G Server over MSGin5G-4
reference point on behalf of Non-3GPP UE.
The Broadcast Message Gateway interacts with MSGin5G Server over MSGin5G-7
reference point.
NOTE 1: A SEAL Group Management Server and a SEAL Configuration Management
Server (both specified in 3GPP TS 23.434 [5]) may be collocated in the MSGin5G
Server. A SEAL Configuration Management Client specified in 3GPP TS 23.434 [5]
may be collocated in the MSGin5G Client, Legacy 3GPP Message Gateway and
Non-3GPP Message Gateway. The implementation of such deployment option is out
of scope of the present specification.
NOTE 2: Depending on the non-3GPP message service, the interaction between
Non-3GPP message client and Non-3GPP Message Gateway may involve 3GPP Core
Network.
NOTE 3: 3GPP Core Network may not be involved for the interaction between the
Non-3GPP Message Gateway and the MSGin5G Server.
NOTE 4: If the Application Client on UE-2 communicates with the MSGin5G Client
on UEâ€‘1 over the MSGin5G-5 reference point then the transport layer
communication is based on the Unicast mode 5G ProSe Direct Communication
specified in 3GPP TS 23.304 [18] or is implementation specific.
The architecture shown in Figure 5.2-2 and Figure 5.2-3 illustrate
architectural options for providing MSGin5G services for constrained devices.
In these figures, the MSGin5G UE-2 is a constrained device which does not
connect to the 3GPP network directly for message exchange with MSGin5G Server
(e.g. UE-2 is out of 3GPP RAN coverage, with or without authorization to use
UE-to-Network relay). If allowed by configuration, the MSGin5G UE-2 can use
the options listed below to communicate with the MSGin5G Server:
\- the MSGin5G UE-2 uses an UE-1 as relay;
\- the MSGin5G UE-2 interacts with an MSGin5G Gateway UE which supports
MSGin5G Gateway Client.
Figure 5.2-2 shows the application architecture of MSGin5G UE-2 using an UE-1
as a relay. The SEAL Client(s) residing on the UE-1 also acts as relay for the
SEAL Client(s) residing on the MSGin5G UE-2 as specified in 3GPP TS 23.434
[5].
NOTE 5: In this option, MSGin5G UE-2 discovers the UE-1 and then uses the UE-1
as a ProSe UE-to-Network Relay by using the procedure specified in 3GPP TS
23.304 [18].
NOTE 6: The UE-1 can be any UE supporting ProSe UE-to-Network Relay capability
and may not be an MSGin5G UE.
Figure 5.2-2: MSGin5G UE-2 using UE-1 as a relay
Figure 5.2-3 shows the application architecture of MSGin5G UE-2 with MSGin5G
Client interacts with an MSGin5G Gateway UE over the MSGin5G-6 reference
point.
NOTE 7: Both MSGin5G Client functionality and MSGin5G Gateway service
functionality are internal functionalities of MSGin5G Gateway Client. The
interaction between MSGin5G Client functionality in the MSGin5G Gateway Client
and the MSGin5G Gateway service functionality is implementation specific.
Figure 5.2-3: MSGin5G UE-2 with MSGin5G Client interacts with an MSGin5G
Gateway UE
NOTE 8: MSGin5G-6 reference point is based on the Unicast mode 5G ProSe Direct
Communication specified in 3GPP TS 23.304 [18].
Editor's note: How to handle SEAL Client functionality in a constrained
MSGin5G UE is FFS.
Figure 5.2-4 illustrates the functional model for interconnection between
MSGin5G servers.
Figure 5.2-4: Interconnection between MSGin5G Servers
To support distributed SEAL server deployment in one PLMN, and delivering
MSGin5G messages between different PLMNs, the MSGin5G Server interacts with
another MSGin5G Server over MSGin5G-8 reference point.
## 5.3 Functional entities
### 5.3.1 General
The functional entities of the application architecture for the MSGin5G
Service are described in this clause.
### 5.3.2 MSGin5G Server
#### 5.3.2.1 General functionalities
An MSGin5G Server provides server-side functionality to assist MSGin5G Clients
with the sending and receiving of messages via the MSGin5G Service to/from
Application Servers and/or other MSGin5G Service endpoints on other UEs, and
collect charging information from MSGin5G message.
Functionalities of MSGin5G Server:
\- To manage MSGin5G UEs that are home to the MSGin5G Server and provides:
\- handling the registration of these MSGin5G UEs
\- handling the message initiation by these MSGin5G UEs
\- handling the message delivery to these MSGin5G UEs
\- To deliver messages to an MSGin5G Service endpoint based on the terminating
MSGin5G Service ID. The terminating MSGin5G Service ID may be served by the
same MSGin5G Server or served by another MSGin5G Server. If the MSGin5G
Service ID is served by another MSGin5G Server, the MSGin5G Server forwards
the messages to the next MSGin5G Server until it reaches to the MSGin5G Server
that is the home of the terminating MSGin5G Service ID;
\- To resolve the MSGin5G Group Service ID to determine the members of the
Group as specified in 3GPP TS 23.434[5];
\- Interworking with non 3GPP messaging service through the Non-3GPP Message
Gateway;
\- Interworking with legacy 3GPP messaging service through the Legacy 3GPP
Message Gateway;
\- Interworking with a 3GPP broadcast service through the Broadcast Message
Gateway;
\- Exchanging MSGin5G messages with Application Servers, MSGin5G Clients,
Legacy 3GPP Message Gateway, and Non-3GPP Message Gateway;
\- Supporting MSGin5G message segmentation according to service provider\'s
policy;
\- Supporting UE configuration procedures as specified in TS 23.434 [5] or
communicating with the SEAL Configuration Management Server to provide MSGin5G
configuration data on a UE to be ready for the MSGin5G Service;
\- Managing information related to the MSGin5G Service, such as MSGin5G Client
Triggering Information, MSGin5G Client availability and MSGin5G Client
Supported Maximum MSGin5G segment size, and Broadcast Message Gateway;
\- Support store and forward of messages based on the sender request and the
availability and reachability of the service endpoints, and
\- Interactions towards the CHF, as defined in TS 32.240 [17], to collect
charging information from MSGin5G message according to the operator\'s
charging policy and report charging information to CHF.
NOTE: The details of charging function are out of scope of the present
document.
#### 5.3.2.2 Target resolution
Upon receiving the MSGin5G message request to deliver the message to the
recipient (which could be any of the MSGin5G UE, Legacy 3GPP UE, Non-3GPP UE
or Application Server), the MSGin5G Server checks the recipient\'s
registration status (created at the time of each MSGin5G UE/Application Server
registration to MSGin5G Server, or the Message Gateway performs registration
with the MSGin5G Server on behalf of the Non-MSGin5G UEs) for availability and
reachability of MSGin5G service endpoints. The MSGin5G Server will attempt for
delivery of the MSGin5G message request towards recipient based on the UE
Service ID/AS Service ID, if the recipient is available and reachable. If the
recipient is unavailable, the MSGin5G Server stores the message for deferred
delivery unless the sender or the recipient opted out of store and forward
services.
NOTE: If reachability monitoring (see clause 8.9.2) is not used or the
recipient is not an MSGin5G UE, the MSGin5G Server assumes the recipient is
reachable.
If the recipient is Non-MSGin5G UE, the Legacy 3GPP Message Gateway or the
Non-3GPP Message Gateway that the Non-MSGin5G UE is registered with, will
receive the MSGin5G message request on behalf of the Non-MSGin5G UE, and then
delivers the message to the Non-MSGin5G UE by using the Non-MSGin5G message
delivery mechanism.
If the message is a Broadcast message, the Broadcast Message Gateway will
receive the MSGin5G message request and will deliver the message to all UEs in
the Broadcast Area via the Broadcast messaging delivery mechanism, based on
the Broadcast Area ID.
### 5.3.3 MSGin5G Client
#### 5.3.3.1 General functionalities of MSGin5G Client
An MSGin5G Client provides client-side functionality for UE Application
Clients with the sending and receiving of messages via the MSGin5G Service
to/from Application Servers and/or other MSGin5G Service endpoints; i.e. UEs.
Functionalities of MSGin5G Client including:
\- may expose MSGin5G APIs to enable Application Clients to use an MSGin5G
Service;
\- supporting (de-)registration of an MSGin5G Client to an MSGin5G Server to
use MSGin5G Service;
\- supporting configuration of an MSGin5G Client required to use MSGin5G
Service;
\- construction of MSGin5G message when requested by a native application or
Application Client;
\- delivery of MSGin5G message payload to the targeted native application or
Application Client;
\- exchanging MSGin5G messages via an MSGin5G Server to/from Application
Servers and/or other MSGin5G Service endpoints; i.e. UEs;
\- support MSGin5G message segmentation and re-assembly;
\- support MSGin5G message aggregation and segregation
NOTE 1: A native application on an MSGin5G UE is the application logic built
within the MSGin5G Client.
NOTE 2: An MSGin5G Client residing in a constrained device is the same as an
MSGin5G Client residing in an unconstrained device. i.e. both of them use the
same transport/data formats and have the same capabilities.
#### 5.3.3.2 MSGin5G Gateway Client
An MSGin5G Gateway Client is an MSGin5G Client which supports MSGin5G Gateway
service functionality in addition to the MSGin5G Client functionalities
specified in clause 5.3.3.1. It enables constrained devices to obtain services
from the MSGin5G Server when communications via ProSe UE-to-Network Relay are
not or cannot be supported.
The MSGin5G Gateway service functionality in the MSGin5G Gateway Client
supports:
\- supporting the bulk configuration and bulk (de-)registration for the
MSGin5G Client residing on the Constrained UE, e.g. checking whether bulk
configuration/bulk (de-)registration can be used, holding the
(de-)registration request from MSGin5G Client residing on the constrained
device, construction of the bulk (de-)registration request and splitting of
the MSGin5G UE bulk (de-)registration response.
Editor\'s note: Whether other capabilities, e.g. detailing of the support for
(de-)registration of constrained devices, are needed to be supported by
MSGin5G Gateway service functionality is FFS
### 5.3.4 Message Gateway
#### 5.3.4.1 General Description of Message Gateway
A Message Gateway in the MSGin5G application architecture provides
functionality to deliver MSGin5G messages to Non-MSGin5G UEs.
NOTE 1: It is an implementation option to deliver broadcast messages to Legacy
3GPP UEs and MSGin5G UEs (see Figure 5.2-1).
A Message Gateway performs the role of interconnecting two different messaging
delivery mechanisms and assures the message integrity between different
message delivery mechanisms. A message delivery mechanism comprises the
specific set of protocols, procedures and rules.
Functionalities of Message Gateway:
\- Enables seamless delivery of an MSGin5G message between different message
delivery mechanisms with integrity;
\- Communicates with the MSGin5G Server using either an MSGin5G Client
functionality or similar functions to enable sending and receiving MSGin5G
messages;
\- Delivers payload of an MSGin5G message to the Non-MSGin5G UE using the
specific message delivery mechanism available to that Non-MSGin5G UE and vice
versa;
\- Performs message sender and receiver addresses conversion according to the
two connected message delivery mechanisms and maintain the mapping of the
address pair used for a response message delivery;
\- Perform registration and de-registration with the MSGin5G Server on behalf
of the Non-MSGin5G UEs;
\- Act as a service endpoint to perform message segmentation and reassembly
for the Non-MSGin5G UEs when needed;
\- Act as a service endpoint to split the aggregated MSGin5G message into
multiple individual MSGin5G message requests for the Non-MSGin5G UEs; and
\- Performs protocol conversion according to the service supported by the
target UE;
\- Supports the MSGin5G message delivery status report
1\. If application level message delivery status report is not supported by
the Non-MSGin5G message delivery mechanisms, based on the information (e.g.
response to the message delivery request, transport level information, etc)
obtained from the Non-MSGin5G message delivery mechanisms, the Message Gateway
fetches the delivery status from the above information and uses it to create
an MSGin5G message delivery status report on behalf of Non-MSGin5G UE. If the
delivery status is failure, also fetch the suitable failure reason from the
above information and use it as reason of failure in the MSGin5G message
delivery status report.
2\. If application level message delivery status report is supported by the
Non-MSGin5G message delivery mechanisms (e.g. RCS specified in GSMA PRD RCC.07
[3]), translates the application level message delivery status report in the
Non-MSGin5G message delivery mechanisms to MSGin5G message delivery status
report.
There are three types of Message Gateways used to deliver MSGin5G messages to
different UE types: the Legacy 3GPP Message Gateway, the non-3GPP Message
Gateway, and the Broadcast Message Gateway.
NOTE 2: Implementation of the Message Gateway and the MSGin5G Server together
is a deployment option that is out of scope the present specification.
#### 5.3.4.2 Legacy 3GPP Message Gateway
The Legacy 3GPP Message Gateway is used to deliver MSGin5G message to Legacy
3GPP UEs, using their 3GPP supported message delivery mechanisms.
#### 5.3.4.3 Non-3GPP Message Gateway
The Non-3GPP Message Gateway is used to deliver MSGin5G message to Non-MSGin5G
UEs, using their (non-3GPP) supported message delivery mechanisms.
#### 5.3.4.4 Broadcast Message Gateway
The Broadcast Message Gateway is used to deliver MSGin5G message to MSGin5G
UEs, Legacy 3GPP UEs or Non-MSGin5G UEs in a Broadcast Area.
### 5.3.5 Application Client
The Application Client is an entity in the application layer to implement and
perform the application service logic for its own service.
The Application Client interacts with MSGin5G Client for on the same or
different UE sending and receiving MSGin5G messages. The Application Client
provides needed information for the MSGin5G Client to perform MSGin5G Service
with other endpoints.
### 5.3.6 Application Server
The Application Server is an entity in the application layer to implement and
perform the application service logic.
The Application Server supports sending and receiving messages with MSGin5G
Service layer protocols and procedures.
### 5.3.7 Legacy 3GPP Message Client
The Legacy 3GPP Message Client provides client-side functionality for a Legacy
3GPP messaging service (e.g. SMS, NIDD).
NOTE: The details of the Legacy 3GPP Message Client are out of scope of the
present document.
### 5.3.8 Non-3GPP Message Client
The Non-3GPP Message Client provides client-side functionality for a Non-3GPP
messaging service.
NOTE: The details of the Non-3GPP message client are out of scope of the
present document.
### 5.3.9 SEAL Client
The following SEAL Clients for MSGin5G Service are supported:
\- Group management client as specified in 3GPP TS 23.434 [5];
\- Configuration management client as specified in 3GPP TS 23.434 [5].
### 5.3.10 SEAL server
The following SEAL servers for MSGin5G Service are supported:
\- Group management server as specified in 3GPP TS 23.434 [5];
\- Configuration management server as specified in 3GPP TS 23.434 [5].
Editor\'s note: Usage of other SEAL services (e.g. location) from 3GPP TS
23.434 [5] for MSGin5G Service is FFS.
## 5.4 Reference Points
### 5.4.1 General
The reference points of the service architecture for the MSGin5G Service are
described in this clause.
### 5.4.2 MSGin5G-1
The interactions related to enabling MSGin5G message exchange between an
MSGin5G Client and an MSGin5G Server are supported by the MSGin5G-1 reference
point. This reference point supports:
\- Registration of an MSGin5G Client to an MSGin5G Server when not using IMS
based solution; and
\- The exchange of MSGin5G messages.
### 5.4.3 MSGin5G-2
The interactions related to enabling MSGin5G message exchange between an
MSGin5G Server and the Legacy 3GPP Message Gateway are supported by the
MSGin5G-2 reference point. This reference point supports:
\- The exchange of MSGin5G messages between MSGin5G Server and the Legacy 3GPP
Message Gateway; and
\- Perform registration /de-registration on behalf of the Legacy 3GPP UEs that
the Message Gateway connects with the MSGin5G Server.
NOTE: Indicating the delivery mechanism on the MSGin5G-2 reference point is
out of scope of current functionality.
### 5.4.4 MSGin5G-3
The interactions related to enabling MSGin5G message exchange between an
Application Server and an MSGin5G Server are supported by the MSGin5G-3
reference point. This reference point supports:
\- Access to MSGin5G Server and APIs to enable sending and receiving of
MSGin5G messages; and
\- Adherence to CAPIF as specified in 3GPP TS 23.222 [6].
### 5.4.5 MSGin5G-4
The interactions related to enabling MSGin5G message exchange between a
Non-3GPP Message Gateway and an MSGin5G Server are supported by the MSGin5G-4
reference point. This reference point supports:
\- The exchange of MSGin5G messages between MSGin5G Server and the Non-3GPP
Message Gateway; and
\- Perform registration/de-registration on behalf of the Non-3GPP UEs that the
Message Gateway connects with the MSGin5G Server
### 5.4.6 MSGin5G-5
The interactions related to enabling MSGin5G message related information
exchange between an Application Client and an MSGin5G Client are supported by
the MSGin5G-5 reference point. The Application Client can reside on the same
UE with the MSGin5G Client or reside on a different UE. This reference point
supports:
\- Providing information from Application Clients required to enable the
MSGin5G Client to construct an MSGin5G message to be delivered to other
MSGin5G Service endpoints.
\- Configuring application clients with information required to enable the
MSGin5G Client and MSGin5G Server to exchange and route MSGin5G messages to
other MSGin5G Service endpoints.
\- Sending notifications and information in the incoming MSGin5G messages
received by the MSGin5G Client to the Application Clients from other MSGin5G
Service endpoints.
### 5.4.7 MSGin5G-6
The MSGin5G Client of MSGin5G UE-2 communicates with MSGin5G Gateway service
functionality residing on an MSGin5G Gateway UE over MSGin5G-6 reference
point. The interface is based on Unicast mode 5G ProSe Direct Communication
specified in 3GPP TS 23.304 [18].
### 5.4.8 SEAL-C
The following SEAL-C reference points for MSGin5G Service are supported:
\- GM-C reference point for group management as specified in 3GPP TS 23.434
[5];
\- CM-C reference point for configuration management as specified in 3GPP TS
23.434 [5].
### 5.4.9 SEAL-S
The following SEAL-S reference points for MSGin5G Service are supported:
\- GM-S reference point for group management as specified in 3GPP TS 23.434
[5];
\- CM-S reference point for configuration management as specified in 3GPP TS
23.434 [5].
### 5.4.10 SEAL-UU
The following SEAL-UU reference points for MSGin5G Service are supported:
\- GM-UU reference point for group management as specified in 3GPP TS 23.434
[5];
\- CM-UU reference point for configuration management as specified in 3GPP TS
23.434 [5].
5.4.11 MSGin5G-7
The MSGin5G-7 reference point is used by the MSGin5G Server to communicate
with the Broadcast Message Gateway to deliver Broadcast messages.
5.4.12 MSGin5G-8
The MSGin5G-8 reference point is used by the MSGin5G Server to communicate
with another MSGin5G Server to deliver messages to the MSGin5G Service
endpoint which is served by the other MSGin5G Server, and for message exchange
related to Messaging Topic (un)subscriptions.
## 5.5 Capability exposure for enabling MSGin5G Service
### 5.5.1 MSGin5G application enabler layer adaptation to CAPIF
The MSGin5G Server and Application Server may support CAPIF. When CAPIF is
supported:
\- The MSGin5G Server shall support the CAPIF API provider domain functions
(i.e. CAPIF-2/2e, CAPIF-3/3e, CAPIF-4/4e and CAPIF-5/5e as specified in 3GPP
TS 23.222 [6]) as shown in Figure 5.5.1-1;
\- The Application Server shall act as API invoker and support the API invoker
functions (i.e. CAPIF-1/1e and CAPIF-2/2e as specified in 3GPP TS 23.222 [6])
as shown in Figure 5.5.1-1.
Figure 5.5.1-1: MSGin5G adaptation to the CAPIF architecture
## 5.6 Service based interface representation for MSGin5G Service
### 5.6.1 General
The Service based architecture for MSGin5G Service is represented using
functional entities and reference points between the functional entities as
specified in clause 5.
### 5.6.2 Service based architecture
Figure 5.6.2-1 is the Service based Architecture for MSGin5G Service.
Figure 5.6.2-1: Service based MSGin5G Architecture
NOTE: The AS, BMG, L3G and N3G in this Service based MSGin5G Architecture are
in the same trust domain.
The M5S function is a service based function exhibited by MSGin5G Server.
The M5C function is the MSGin5G Client.
The AC is the Application Client.
The L3G function is a service based function exhibited by Legacy 3GPP Message
Gateway.
The N3G function is a service based function exhibited by Non-3GPP Message
Gateway.
The BMG function is a service based function exhibited by the Broadcast
Message Gateway.
The M5S manages the distribution of the messages it has received from MSGin5G
UE, from Application Server, or from N3G (on behalf of Non-3GPP UE) or from
L3G (on behalf of Legacy 3GPP UE).
The M5S invokes services provided by L3G/N3G/BMG to send MSGin5G messages
towards Legacy 3GPP UE, Non-3GPP UE, or the broadcast delivery mechanism.
The AS/L3G/N3G invokes services provided by M5S to send MSGin5G messages to
M5S on behalf of Legacy 3GPP UE or Non-3GPP UE.
The M5S invokes services provided by SEAL Group management function to do
MSGin5G Group management.
The M5S/L3G/N3G invokes services provided by SEAL Configuration management
function to do service configuration (including UE service ID provisioning).
### 5.6.3 Service based interfaces
Table 5.6.3-1 specifies the service based interfaces supported by MSGin5G
Service.
Table 5.6.3-1: Service based interfaces supported by MSGin5G Service
Service based interface Application function entity Mapping server entity APIs
offered
* * *
Mm5s MSGin5G Server function MSGin5G Server Specified in 9.1 Ml3g Legacy 3GPP
Message Gateway function Legacy 3GPP Message Gateway Specified in 9.2.1 Mn3g
Non-3GPP Message Gateway function Non-3GPP Message Gateway Specified in 9.2.2
Mbg Broadcast Message Gateway function Broadcast Message Gateway Specified in
9.2.3
# 6 Identities
## 6.1 Identities for MSGin5G Service endpoints
### 6.1.1 General
MSGin5G Service endpoints shall be identified by unique identifiers within the
MSGin5G Service domain. For each MSGin5G Service endpoint the identifier shall
be a unique URI that can be used to identify the MSGin5G Service endpoint\'s
home service domain.
The following clauses describe different types of MSGin5G Service endpoint
identifiers.
### 6.1.2 UE Service Identity (UE Service ID)
UE Service ID is the identifier of a UE (i.e. MSGin5G UE, Legacy 3GPP UE or
Non-3GPP UE).
For an MSGin5G UE, the assigned UE Service ID is used by the MSGin5G Client to
register with the MSGin5G Server and to send and receive MSGin5G messages. It
is used by the MSGin5G Server to authenticate and authorize the associated UE
to the MSGin5G Service at the application layer.
For a Legacy 3GPP UE or a Non-3GPP UE, the assigned UE Service ID is used by
the Message Gateway to register with the MSGin5G Server on behalf of Legacy
3GPP UE or Non-3GPP UE, to map into the Service ID in their defined message
delivery mechanisms for interworking, and to send/receive MSGin5G messages
to/from MSGin5G Server on behalf of Legacy 3GPP UE or Non-3GPP UE.
### 6.1.3 Application Server Service Identity (AS Service ID)
AS Service ID is the identifier of an Application Server. It is used to
perform mutual authentication with the MSGin5G Server for establishing a
secured service connection, and it is used to send/receive message API
request/response to/from other MSGin5G Service endpoints via MSGin5G Server.
### 6.1.4 Message Gateway Service Identity (MGW Service ID)
MGW Service ID is the identifier of Message Gateway. It is used to perform
mutual authentication with the MSGin5G Server for establishing a secured
service connection.
## 6.2 MSGin5G Group Service Identity (Group Service ID)
The Group Service ID is a unique identifier within the MSGin5G Service that
represents a pre-defined MSGin5G Group. A pre-defined MSGin5G Group is
established before the MSGin5G Group messages are sent to it, and is assigned
a unique and permanent Group Service ID when it is established. This Group
Service ID shall be communicated to all members of the group. A service
endpoint (MSGin5G UE or Application Server) shall use this Group Service ID to
send a message to all members of the group.
The Group Service ID shall be a unique URI that can be used to identify where
the group is hosted.
## 6.3 Broadcast Area Service Identity (Broadcast Area ID)
The Broadcast Area ID is the identity of the Service Area where the broadcast
message is delivered.
## 6.4 MSGin5G UE Identity (MSGin5G UE ID)
The MSGin5G UE ID is a unique identifier that represents the MSGin5G UE (i.e.
the device identifier of the MSGin5G UE). The MSGin5G UE ID may be pre-
configured to the MSGin5G UE by its vendor.
## 6.5 Non-MSGin5G UE identity (Non-MSGin5G UE ID)
The Non-MSGin5G UE ID is a unique identifier that represents the Non-MSGin5G
UE. A Non-MSGin5G UE ID is associated with a specific Non-MSGin5G UE. It is
used by the Message Gateway in the MSGin5G Service to record the Non-MSGin5G
UE. It is also used by the Message Gateway as a part of VAL UE ID when the
Message Gateway executes the Non-MSGin5G UE configuration procedure on behalf
of a Non-MSGin5G UE. The format of Non-MSGin5G UE ID may differ among
different VALs. The non-MSGin5G ID may be pre-configured to the Non-MSGin5G UE
by its vendor.
## 6.6 Application Identity (Application ID)
Application ID is an identifier that represents the application for which the
payload of message is intended. The content of Application ID is outside the
scope of this document.
## 6.7 MSGin5G Server address
MSGin5G Server address is the identifier of an MSGin5G Server within an
MSGin5G service provider\'s domain. The MSGin5G Service endpoints in this
MSGin5G service provider\'s domain can contact an MSGin5G Server by using the
MSGin5G Server address of this MSGin5G Server.
# 7 Generic description of the MSGin5G Service (informative)
## 7.1 General
Massive Internet of Things (MIoT) is one of key market segments of 5G. The
typical IoT device communication is sending and receiving small data which can
be delivered just in a message. The MSGin5G Service is designed and optimized
for massive IoT device communication including thing-to-thing communication
and person-to-thing communication.
The MSGin5G Service is a message enabler for applications. An Application
Client in a UE utilizes MSGin5G Service to send a message to another UE, to
multiple UEs or to the Application Server, or the Application Server utilizes
the MSGin5G Service to send a message to a UE or to multiple UEs. All messages
will be routed via the MSGin5G Server in the 5G system. The MSGin5G Service
flow is shown in figure 7.1-1.
If the UE supports a legacy 3GPP message service (e.g. SMS, NIDD, or CB) and
does not support the MSGin5G Service (i.e. UE has no MSGin5G Client), the
message will be translated to the appropriate message delivery mechanism by
the Legacy 3GPP Message Gateway. A UE that does not support any 3GPP message
service can connect to the MSGin5G Service via Non-3GPP Message Gateway that
facilitates the translation between the MSGin5G Service and non-3GPP message
delivery mechanism. The connection between such UE and the gateway can be via
3GPP access or non 3GPP access (e.g. WLAN) and is out of scope of the present
specification.
An Application Server resides outside the 3GPP domain and connects to the
MSGin5G Server via a CAPIF-aware reference point.
The message communication models include:
\- Point-to-Point messaging: message that is originated at a UE (UE A) and
terminated at another UE (UE B, a Legacy 3GPP UE or a Non-3GPP UE).
\- AS-to-Point messaging: message that is originated at an Application Sever
and terminated at a UE.
\- Point-to-AS messaging: message that is originated at a UE and terminated at
an Application Sever.
\- Group Messaging: message that is originated at a UE or an Application
Server and is terminated at a group of UEs (a group member can be of type UE
A, Legacy 3GPP UE or Non-3GPP UE).
\- Broadcast Messaging: message that is originated at an Application Sever or
an MSGin5G UE and broadcasted to all the UEs in a specific Broadcast Area
within coverage of a cell or of multiple cells. An existing broadcast function
(e.g. CB specified in 3GPP TS 23.041 [14]) may be reused in broadcast
messaging of MSGin5G Service.
\- Topic Messaging: message that is originated at an Application Sever or a UE
and is delivered to all UEs and Application Server(s) that have subscribed to
the topic.
Figure 7.1-1: The MSGin5G Service overview
## 7.2 Service flow
Before a UE or an Application Server can use the MSGin5G Service it needs to
register with the MSGin5G Server.
A UE registers with its identity, its security credentials, the capabilities
that it supports, and its availability. The MSGin5G Server will use the
availability registration and de-registration to determine if the UE is
available for message delivery. If a UE is unavailable for message delivery,
the MSGin5G Server will store the message and deliver it once the UE becomes
available again.
When a UE or an Application Server sends an MSGin5G message to a recipient UE
then such message will be sent to the MSGin5G Server and this server will
deliver the message to the UE based on the capabilities of the recipient UE
(MSGin5G UE, Legacy 3GPP UE or Non-3GPP UE). If the recipient UE is a Legacy
3GPP UE then the MSGin5G Server will forward the message to the Legacy 3GPP
Message Gateway and this gateway will convert the message to a message that is
supported by the recipient UE (e.g. SMS, NIDD or CB). If the recipient UE is a
Non-3GPP UE then the MSGin5G Server will forward the message to the Non-3GPP
Message Gateway and this gateway will convert the message to a message that is
supported by the recipient UE.
A Legacy 3GPP UE sends the application payload to the Legacy 3GPP Message
Gateway and this gateway will forward the application payload in an MSGin5G
message to the MSGin5G Server, which will deliver the message to the recipient
UE(s). A Non-3GPP UE sends the application payload to the Non-3GPP Message
Gateway and this gateway will forward the application payload in an MSGin5G
message to the MSGin5G Server, which will deliver the message to the recipient
UE(s).
NOTE: Conversion by a Message Gateway is out of scope of the present
specification.
If a UE or an Application Server sends an MSGin5G message to a group of UEs,
the MSGin5G Server will deliver the message to all group members taking into
account if such a UE is an MSGin5G UE, a Legacy 3GPP UE or a Non-MSGin5G UE
and if such UE is available for delivery.
If a UE or an Application Server sends an MSGin5G message containing a
Messaging Topic to the MSGin5G Server, the MSGin5G Server will distribute the
message to all UEs and Application Servers that have subscribed to that topic.
If a UE or an Application Server sends a broadcast message to a Broadcast
Area, the MSGin5G Server forwards the message to the Broadcast Message Gateway
and this gateway will forward the message to the broadcast function.
An originating UE or Application Server may request the recipient UE(s) to
acknowledge reception of the message. If such a request is made, a message
delivery status report shall be sent by the recipient MSGin5G UE or the
Message Gateway (on behalf of the Non-MSGin5G UE) as a point-to-point message
back to the originating UE or Application Server. The acknolwedgement
information is included in the payload and the format of this information is
out of scope of the present specification.
The Non-MSGin5G UE may respond to an incoming MSGin5G message; it is subject
to the Message Gateway implementation to maintain the transaction of the
incoming MSGin5G message and reply to it to the sender, with the response it
receives from the Non-MSGin5G UE.
## 7.3 Message delivery flow at MSGin5G Server
Figure 7.3-1 shows the flow for message delivery by the MSGin5G Server.
Figure 7.3-1: The message delivery flow at the MSGin5G Server
# 8 Procedures and information flows
## 8.1 Configuration
### 8.1.1 General
The configuration procedure is used to get the MSGin5G Service configuration
information (e.g. UE Service ID). The configuration procedure is used by the
MSGin5G UE or used by Message Gateway on behalf of the Non-MSGin5G UE. The
MSGin5G Service configuration information is used in the future messaging
communication.
The VAL UE configuration data specified in TS 23.434 [5] is used in this
configuration procedure. After the configuration procedure, the MSGin5G UE, or
the Message Gateway on behalf of the Non-MSGin5G UE can register to MSGin5G
Server.
NOTE 1: The configuration on the Message Gateway to support the Non-MSGin5G UE
for MSGin5G Service can also be done without using the SEAL configuration
procedures and is implementation specific.
NOTE 2: The MSGin5G Service configuration information can also be pre-
configured to the MSGin5G UE/Non-MSGin5G UE and is implementation specific.
### 8.1.2 MSGin5G UE Configuration
In the MSGin5G UE configuration procedure, the MSGin5G UE acts as
Configuration management client specified in 3GPP TS 23.434 [5].
The following steps of configuration management service apply for the MSGin5G
UE:
\- Send the Get VAL UE configuration request specified in clause 11.3.2.1 of
3GPP TS 23.434 [5];
\- Receive the related Get VAL UE configuration response specified in clause
11.3.2.2 of 3GPP TS 23.434 [5];
The usage of the above information flows is clarified as below:
\- The MSGin5G UE ID works as VAL UE ID which is mandatory in the Get VAL UE
configuration request;
\- The UE Service ID works as VAL user ID;
\- The service identifier of MSGin5G Service works as VAL service ID;
Besides the IEs specified in clause 11.3.2.1 of 3GPP TS 23.434 [5], the
information in table 8.1.2-1 is also included in the Get VAL UE configuration
request.
Table 8.1.2-1: Additional Information in the Get VAL UE configuration request
Information element Status Description
* * *
MSGin5G UE information O Other information needed by the configuration
procedure. (see NOTE) NOTE: The information can be the device type, device
vendor, etc. It is specified by application provider or MSGin5G Service
provider and is out of scope of this document. The MSGin5G Service provider
can configure the MSGin5G UE with different configuration data based on this
IE. E.g. all sensors can be configured to a same MSGin5G Server.
The information in table 8.1.2-2 is included in the Get VAL UE configuration
response as a part of VAL UE configuration data.
Table 8.1.2-2: Information in the Get VAL UE configuration response
Information element Status Description
* * *
UE Service ID M UE Service ID assigned to the requesting MSGin5G UE. MSGin5G
Server address M The MSGin5G Server which serves this MSGin5G UE. MSGin5G
Service specific information O The specific information of the MSGin5G Service
specified by the MSGin5G Service provider. (see NOTE) NOTE: E.g. the segment
size of MSGin5G message in this service provider. The detailed definition is
out of scope of this document.
Besides the functionalities of Configuration Management Server specified in
3GPP TS 23.434 [5], the MSGin5G Configuration Function should also check
whether the MSGin5G UE ID (i.e. VAL UE ID) is included in a former Get VAL UE
configuration request.
\- If so, the MSGin5G Configuration Function included the UE Service ID
assigned to the MSGin5G UE in the former configuration procedure as a part of
VAL UE configuration data,
\- Otherwise, a new UE Service ID is assigned to the MSGin5G UE and included
in the VAL UE configuration data.
Then the MSGin5G Configuration Function processes the configuration request
according to the service policy.
### 8.1.3 Message Gateway Configuration for support of Non-MSGin5G UE
The Message Gateway performs the configuration procedure on behalf of the Non-
MSGin5G UE to get the MSGin5G Service configuration information (e.g. UE
Service ID).
NOTE 1: As an alternative to the configuration procedure all the necessary
service information (including the UE Service ID) of a Non-MSGin5G UE can be
pre-configured with the Message Gateway.
If Configuration Management service in SEAL is used for the Message Gateway
configuration, the Message Gateway acts as Configuration management client
specified in 3GPP TS 23.434 [5] on behalf of each Non- MSGin5G UE.
The following steps of configuration management service may apply for the
Message Gateway:
\- Send the Get VAL UE configuration request specified in clause 11.3.2.1 of
3GPP TS 23.434 [5];
\- Receive the related Get VAL UE configuration response specified in clause
11.3.2.2 of 3GPP TS 23.434 [5];
The usage of the above information flows is clarified as below:
\- An Information Element contains both Non-MSGin5G UE ID and MGW Service ID
works as VAL UE ID which is mandatory in the Get VAL UE configuration request;
NOTE 2: The Non-MSGin5G UE ID may differ among different VALs and may not be
unique among different Gateways. It is not enough to use only Non-MSGin5G UE
ID as VAL UE ID.
\- The UE Service ID works as VAL user ID;
\- The service identifier of MSGin5G Service works as VAL service ID;
Besides the IEs specified in clause 11.3.2.1 of 3GPP TS 23.434 [5], the
information in table 8.1.3-1 is also included in the Get VAL UE configuration
request.
Table 8.1.3-1: Additional Information in the Get VAL UE configuration request
Information element Status Description
* * *
Non-MSGin5G UE information O Other information needed by the configuration
procedure. (see NOTE) NOTE: The information can be the device type, device
Vendor, etc. It is specified by application provider or MSGin5G Service
provider and is out of scope of this document. The MSGin5G Service provider
can configure the Non-MSGin5G UE with different configuration data based on
this IE. E.g. all sensors can be configured to a same MSGin5G Server.
The information in table 8.1.3-2 is included in the Get VAL UE configuration
response as a part of VAL UE configuration data. The information is used by
Message Gateway to support non-MSGin5G UEs that will be used to register with
the MSGin5G Server for MSGin5G service.
Table 8.1.3-2: Information in the Get VAL UE configuration response
Information element Status Description
* * *
UE Service ID M UE service ID assigned to the requesting Non-MSGin5G UE.
MSGin5G Server address M The MSGin5G Server which serves this MSGin5G UE.
MSGin5G Service specific information O The specific information of the MSGin5G
Service specified by the MSGin5G Service provider. (see NOTE) NOTE: The
information (except UE Service IE) used by Message Gateway to support non-
MSGin5G UEs that will be used to register with the MSGin5G Server for MSGin5G
service is included in this IE. The detailed information is specified in Table
8.2.1-1. Other service specific information can also be included in this IE,
the detailed definition of the other service specific information is out of
scope of this document.
Besides the functionalities of Configuration Management Server specified in
3GPP TS 23.434 [5], the MSGin5G Configuration Function should also check
whether the MSGin5G UE ID (i.e. VAL UE ID) is included in a former Get VAL UE
configuration request.
\- If so, the MSGin5G Configuration Function included the UE Service ID
assigned to the Non-MSGin5G UE in the former configuration procedure as a part
of VAL UE configuration data.
\- Otherwise, a new UE Service ID is assigned to the Non-MSGin5G UE and
included in the VAL UE configuration data.
Then the MSGin5G Configuration Function processes the configuration request
according to the service policy.
### 8.1.4 MSGin5G UE bulk configuration over MSGin5G-6 reference point
When more than one MSGin5G UEs, which are constrained devices, which support
an MSGin5G Client, get the MSGin5G Service configuration information via the
MSGin5G Gateway UE, the MSGin5G Gateway UE may decide to use bulk
configuration procedure specified in this clause based on service policy.
Pre-conditions:
1\. The constrained MSGin5G UE has discovered and selected an MSGin5G Gateway
UE as specified in clause 8.2.8 and connected to the serving network via the
MSGin5G Gateway UE successfully.
2\. The MSGin5G Gateway UE has been configured by using the procedure
specified in clause 8.1.2 of the present document.
The constrained MSGin5G UE sends the Get VAL UE configuration request as
specified in clause 8.1.2 of the present document to MSGin5G Gateway UE. If
the MSGin5G Gateway UE decides to use bulk configuration based on the service
policy, the MSGin5G Gateway UE sends a Get VAL UE configuration response
including the information elements as listed in table 8.1.4-1 as a part of VAL
UE configuration data to the constrained MSGin5G UEs before bulk configuration
is performed. This Get VAL UE configuration response is used to inform each
constrained MSGin5G UE that their Get VAL UE configuration requests will be
handled later.
NOTE: How to decide that bulk configuration is used is implementation specific
and out of scope.
Table 8.1.4-1: Information in the Get VAL UE configuration response to
constrained device before bulk configuration is performed
Information element Status Description
* * *
Maximum configuration time M The maximum wait time for the bulk configuration
request to be sent to the MSGin5G Server.
In the MSGin5G UE bulk configuration procedure, the MSGin5G Gateway UE acts as
Configuration management client specified in clause 8.1.2 of the present
document. In addition to the information elements listed in table 8.1.2-1 of
the present document and clause 11.3.2.1 of 3GPP TS 23.434 [5], the Get VAL UE
configuration request used for bulk configuration also includes the
information elements as listed in table 8.1.4-2.
Table 8.1.4-2: additional Information in the Get VAL UE configuration request
Information element Status Description
* * *
Bulk configuration flag M Indicates this request is an enhanced Get VAL UE
configuration request used for MSGin5G UE bulk configuration List of MSGin5G
UE IDs M List of MSGin5G UE ID of MSGin5G UEs which needed to be configured in
this bulk configuration request
In addition to the information elements listed in table 8.1.2-2 of the present
document, the Get VAL UE configuration response used for bulk configuration
also includes the information elements as listed in table 8.1.4-3 as a part of
VAL UE configuration data as specified in clause 11.3.2.2 of 3GPP TS 23.434
[5].
Table 8.1.4-3: additional Information in the Get VAL UE configuration response
Information element Status Description
* * *
List of MSGin5G UE configuration information M Each element in this list
contains information as specified in Table 8.1.2-2. The configuration
information included in this IE is used to complete the configuration of the
constrained MSGin5G UEs.
Editor\'s note: The enhancement of VAL UE configuration request and response
are needed to be captured by eSEAL2 WID and are FFS.
Upon receiving the Get VAL UE configuration response used for bulk
configuration, the MSGin5G Gateway UE includes the MSGin5G UE configuration
information in the List of MSGin5G UE configuration information into multiple
individual Get VAL UE configuration responses and sends them to the
corresponding constrained MSGin5G UEs.
## 8.2 Registration
### 8.2.1 MSGin5G UE Registration
The signalling flow for MSGin5G UE registration is illustrated in figure
8.2.1-1. The procedure assumes that the MSGin5G UE is responsible for
initiating registration to the MSGin5G Server in order to establish
association with the MSGin5G Server to receive MSGin5G Services.
Pre-conditions:
1\. The MSGin5G UE has connected to the serving network successfully.
2\. The MSGin5G UE has successfully completed the Configuration procedure;
alternatively, a UE Service ID and the MSGin5G Server address have been pre-
configured on the MSGin5G UE.
3\. Both the MSGin5G UE and MSGin5G Server have been configured with the
necessary credentials to enable authenticating one another.
Figure 8.2.1-1: MSGin5G Client registration
1\. The MSGin5G UE sends an MSGin5G UE registration request to the MSGin5G
Server. The request includes the UE Service ID and may include the MSGin5G
Client Profile and Requested expiration time as detailed in Table 8.2.1-1.
Table 8.2.1-1: MSGin5G UE registration request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | UE Service ID | M | UE service identifier | | | | assigned to the requesting | | | | MSGin5G UE. | +-----------------------------+--------+-----------------------------+ | MSGin5G Client Profile | O | Set of parameters | | | | describing the MSGin5G | | | | Client | +-----------------------------+--------+-----------------------------+ | >MSGin5G Client Triggering | O | UE Identifier (i.e., | | Information | | MSISDN, external ID), port | | | | number(s) and associated | | | | protocol (e.g., SMS, NIDD, | | | | etc.) for device | | | | triggering. See Table | | | | 8.2.1â€‘2. The MSGin5G Server | | | | uses the information in | | | | step 5 of clause 8.9.3.2. | +-----------------------------+--------+-----------------------------+ | >MSGin5G Client | O | Communication availability | | Communication Availability | | information for the MSGin5G | | | | Client to receive MSGin5G | | | | messages. This IE informs | | | | the MSGin5G Server if the | | | | client has a specific | | | | application-level | | | | schedule/periodicity to its | | | | MSGin5G communications. See | | | | Table 8.2.1-3. | +-----------------------------+--------+-----------------------------+ | > MSGin5G Client Supported | O | The Maximum MSGin5G segment | | Maximum MSGin5G segment | | size can be used by the | | size | | MSGin5G Server to deliver | | | | message to the client | | | | served by it in its MSGin5G | | | | service domain. The MSGin5G | | | | message sent to the MSGin5G | | | | Client should be segmented | | | | by the MSGin5G Server | | | | serves the receiver if the | | | | message size is bigger than | | | | the MSGin5G Client | | | | Supported Maximum MSGin5G | | | | segment size as specified | | | | in clause 8.5. | | | | | | | | The value of this IE is | | | | decided by the MSGin5G | | | | Client, and is depended on | | | | the MSGin5G Client | | | | capabilities, e.g. | | | | supported transport, | | | | computing capability or | | | | application processing time | | | | limitation. | | | | | | | | If this IE is not included, | | | | the MSGin5G Server shall | | | | use the pre-configured | | | | global value within the | | | | MSGin5G service domain. | +-----------------------------+--------+-----------------------------+ | Requested expiration time | O | Requested expiration time | | | | for the registration. | +-----------------------------+--------+-----------------------------+
Table 8.2.1-2: MSGin5G Client Triggering Information
Information element Status Description
* * *
MSGin5G UE ID M Identity of the UE hosting the MSGin5G Client (e.g., the
External Identifier defined in TS 23.682 [8], or an MSISDN) MSGin5G Client
Ports M List of port numbers that the MSGin5G Client listens on for device
triggers from the MSGin5G Server. Also included with each port number is an
associated protocol (e.g., SMS, NIDD, etc.).
Table 8.2.1-3: MSGin5G Client Communication Availability
Information element Status Description
* * *
Scheduled communication time M Time when the UE becomes available for
communication. Communication duration time M Duration time of periodic
communication. Periodic communication indicator O Identifies whether the
client communicates periodically or not, e.g., on demand. Periodic
communication interval O Interval Time of periodic communication. This IE is
mandatory if the Periodic communication indicator indicates periodic
communications. Data size indication O Indicates the expected data size to be
exchanged during the communication duration. Store and forward option O
Indicates opting out of store and forward services for incoming MSGin5G
requests. The MSGin5G Server uses the information to determine whether Store
and Forward procedure applies as specified in clause 8.3.6.
2\. Upon receiving the request, the MSGin5G Server initiates authentication
procedures with the MSGin5G Client and authorizes the MSGin5G Client. If the
registration is successful, the MSGin5G Server stores the UE Service ID and
associated MSGin5G Client Profile. The UE Service ID and associated MSGin5G
Client Profile should be maintained on the MSGin5G Server until one of the
following cases applies:
a) the MSGin5G UE de-registers from the MSGin5G Server as specified in clause
8.2.2;
b) the MSGin5G UE re-registered successfully with a different MSGin5G Client
Profile; In this case, the MSGin5G Server shall store the UE Service ID and
associated new MSGin5G Client Profile;
c) the MSGin5G UE registration is expired; or
d) the MSGin5G Server deletes the MSGin5G UE registration as required by the
service provider.
NOTE: The authentication procedures in step 2 are built on top of the
transport layer mechanism specified in Annex Y.2 of 3GPP TS 33.501 [16].
3\. The MSGin5G Server sends an MSGin5G UE registration response to the
MSGin5G UE. The response includes the information elements as detailed in
Table 8.2.1-4. The registration expiration time may be returned either as
provided by the MSGin5G client in the registration request or determined by
the MSGin5G Server based on local policy.
Table 8.2.1-4: MSGin5G UE registration response
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | UE Service ID | M | UE service identifier of | | | | the requesting MSGin5G UE. | +-----------------------------+--------+-----------------------------+ | Registration result | M | Indication if the | | | | registration is success or | | | | failure | +-----------------------------+--------+-----------------------------+ | Registration expiration | O | Indicates the expiration | | time | | time of the registration. | | | | | | (see NOTE 1) | | | +-----------------------------+--------+-----------------------------+ | Failure Cause (see NOTE 2) | O | The reason for failure | +-----------------------------+--------+-----------------------------+ | NOTE 1: This IE shall only | | | | be present when the | | | | Registration is Success. | | | | | | | | NOTE 2: This IE shall only | | | | be present when the | | | | Registration result is | | | | Failure. | | | +-----------------------------+--------+-----------------------------+
### 8.2.2 MSGin5G UE De-Registration
By de-registering, the MSGin5G UE informs the MSGin5G Server that it wishes to
terminate its association with the MSGin5G Server.
NOTE 1: De-registration implies that Client Triggering Information and the
Client Communication Availability Information are no longer valid.
The procedure assumes that the MSGin5G UE is responsible for initiating the
de-registration from the MSGin5G Server. The signalling flow for MSGin5G UE
de-registration is illustrated in figure 8.2.2-1.
Pre-condition:
> 1\. The MSGin5G UE is registered to the MSGin5G Server.
Figure 8.2.2-1: MSGin5G UE de-registration
1\. The MSGin5G UE determines to de-register from the MSGin5G Server.
2\. The MSGin5G UE sends an MSGin5G UE de-registration request to the MSGin5G
Server that includes the UE Service ID, as detailed in Table 8.2.2-1.
Table 8.2.2-1: MSGin5G UE de-registration request
Information element Status Description
* * *
UE Service ID M UE service identifier assigned to the MSGin5G UE.
3\. The MSGin5G Server may initiate authentication procedures with the MSGin5G
Client and authorizes the MSGin5G Client. If the MSGin5G Server has authorized
the MSGin5G Client successfully it deletes any UE Service ID and associated
MSGin5G Client Profile that it has stored.
NOTE 2: The authentication procedures in step 3 are built on top of the
transport layer mechanism specified in Annex Y.2 of 3GPP TS 33.501 [16].
4\. The MSGin5G Server sends an MSGin5G UE de-registration response as
detailed in Table 8.2.2-2 to the MSGin5G UE.
Table 8.2.2-2: MSGin5G UE de-registration response
Information element Status Description
* * *
UE Service ID M UE service identifier of the MSGin5G UE. De-registration
result M Indication if the de-registration is success or failure Failure Cause
O The reason for failure
### 8.2.3 Non-MSGin5G UE Registration
Non-MSGin5G UEs (i.e., Legacy 3GPP UEs or Non-3GPP UEs) are connected to the
MSGin5G Server through a Message Gateway. The Message Gateway performs
registration with the MSGin5G Server on behalf of the Non MSGin5G UEs, based
on pre-provisioned information when it receives a registration request from
the Non MSGin5G UE, or gets the knowledge that the Non-MSGin5G UE is ready for
the MSGin5G service. After the procedure is completed, the Message Gateway may
communicate the result to the Non-MSGin5G UE to enable MSGin5G Services at the
Non MSGin5G UE.
NOTE: The communication procedure between Non-MSGin5G UE and Message Gateway
is out of scope of this document.
The signalling flow is illustrated in figure 8.2.3-1.
Pre-conditions:
1\. The Message Gateway has been pre-configured with the MSGin5G Server
address.
2\. The Message Gateway has been configured with the necessary information as
specified in clause 8.1.3. If the UE Service ID and Non-MSGin5G UE credentials
have been configured and the Non-MSGin5G UE Profile is available, this pre-
condition enables authentication and Non- MSGin5G UE registration at the
Message Server.
3\. A secured connection has been established between the Message Gateway and
the MSGin5G Server.
Figure 8.2.3-1: Non-MSGin5G UE registration
1\. The Message Gateway sends the Non-MSGin5G UE registration request to the
MSGin5G Server. The request includes the information pre-configured to the
Message Gateway or provided by the Non-MSGin5G UE (e.g. in non-MSGin5G
registration or bootstrapping procedures which are out of scope of the present
specification) and detailed in Table 8.2.3-1.
Table 8.2.3-1: Non-MSGin5G UE registration request
Information element Status Description
* * *
UE Service ID M UE service identifier assigned to the requesting Non-MSGin5G
UE. MGW Service ID M The service identifier of the Message Gateway performing
registration on behalf of a Non-MSGin5G UE Non-MSGin5G UE Profile O Set of
parameters describing the Non-MSGin5G UE >Non-MSGin5G UE Communication
Availability O Communication availability information for the Non-MSGin5G UE
to receive messages. This IE informs the MSGin5G Server if the Non-MSGin5G UE
has a specific application-level schedule/periodicity to its MSGin5G
communications, which may be used to determine whether and when MSGin5G
communications are attempted. See Table 8.2.1-3.
2\. Upon receiving the request, the MSGin5G Server initiates authentication
procedures with the Message Gateway on behalf of the Non-MSGin5G Client and
authorises the Non-MSGin5G UE to receive the MSGin5G Service. If the
registration is successful, the MSGin5G Server stores the UE Service ID and
associated Non-MSGin5G UE Profile. The UE Service ID and associated Non-
MSGin5G UE Profile should be maintained on the MSGin5G Server until one of the
following cases applies:
a) the Non-MSGin5G UE de-registers from the MSGin5G Server as specified in
clause 8.2.4;
b) the Non-MSGin5G UE re-registered successfully with a different Non-MSGin5G
UE Profile; In this case, the MSGin5G Server shall store the UE Service ID and
associated new Non-MSGin5G UE Profile;
c) the Non-MSGin5G UE registration is expired; or
d) the MSGin5G Server deletes the Non-MSGin5G UE registration as required by
the service provider.
NOTE: The authentication procedures in step 2 are built on top of the
transport layer mechanism specified in Annex Y.2 of 3GPP TS 33.501 [16].
3\. The MSGin5G Server returns the result of the registration in the Non-
MSGin5G UE registration response message with the information detailed in
table 8.2.1-4, to the Message Gateway.
### 8.2.4 Non-MSGin5G UE De-registration
The Message Gateway performs de-registration with the MSGin5G Server on behalf
of the Non-MSGin5G UEs, in order to terminate services from the MSGin5G
Server.
NOTE: After the procedure is completed, the Message Gateway may communicate
the result to the requesting Non-MSGin5G UE and the procedure is out of scope
of this document.
The procedure assumes that the Message Gateway is responsible for initiating
the de-registration from the MSGin5G Server on behalf of the Non-MSGin5G UE.
The signaling flow for Non-MSGin5G UE de-registration is illustrated in figure
8.2.4-1.
Pre-condition:
1\. The Message Gateway successfully performed registration with the MSGin5G
Server on behalf of the Non-MSGin5G UE.
Figure 8.2.4-1: Non-MSGin5G UE de-registration
1\. The Message Gateway determines to de-register the Non-MSGin5G UE with the
MSGin5G Server.
2\. The Message Gateway sends a Non-MSGin5G UE de-registration request to the
MSGin5G Server that includes the UE Service ID associated with the Non-MSGin5G
UE, as shown in Table 8.2.4-1.
Table 8.2.4-1: Non-MSGin5G UE de-registration request
Information element Status Description
* * *
UE Service ID M UE service identifier assigned to the Non-MSGin5G UE.
3\. Upon receiving the request, the MSGin5G Server may initiate authentication
procedures with the Message Gateway on behalf of the Non-MSGin5G Client and
authorizes the Message Gateway. If the MSGin5G Server has authorized the
Message Gateway successfully, it deletes any UE Service ID and associated Non-
MSGin5G UE Profile that it has stored.
NOTE: The authentication procedures in step 3 are built on top of the
transport layer mechanism specified in Annex Y.2 of 3GPP TS 33.501 [16].
4\. The MSGin5G Server replies with a Non-MSGin5G UE de-registration response
as shown in table 8.2.4-2.
Table 8.2.4-2: Non-MSGin5G UE De-registration response
Information element Status Description
* * *
UE Service ID M UE service identifier of the Non-MSGin5G UE. De-registration
result M Indication if the de-registration is success or failure Failure Cause
O The reason for failure
### 8.2.5 Application Server Registration
The signalling flow for Application Server registration is illustrated in
figure 8.2.5-1. Application Server may use the procedure in this clause to do
registration.
NOTE: If the Application Server does not use the Registration procedure,
applicable Information Elements as listed in Table 9.1.2.3-1 need to be
configured on the MSGin5G Server.
Pre-conditions:
1\. The Application Server has connected to the serving network successfully.
2\. An AS Service ID has been provisioned on the Application Server.
3\. The MSGin5G Server address has been provisioned on the Application Server.
4\. Both the Application Server and MSGin5G Server have been configured with
the necessary credentials to enable authenticating one another.
Figure 8.2.5-1: Application Server registration
1\. The Application Server sends an Application Server registration request to
the MSGin5G Server. The request may include authorization information for the
Application Server to register to the MSGin5G Server. The request includes the
AS Service ID and may include Application Profile information as detailed in
Table 9.1.2.3â€‘1.
2\. Upon receiving the request, the MSGin5G Server validates the Application
Server registration request and may verify the security credentials.
NOTE: The authentication procedures in step 2 are built on top of the
transport layer mechanism specified in Annex Y.4 of 3GPP TS 33.501 [16].
3\. The MSGin5G Server sends an Application Server registration response to
the Application Server. The response includes the information elements as
specified in Table 9.1.2.4-1. If the registration is successful, the MSGin5G
Server stores the AS Profile information as detailed in Table 9.1.2.3-1.
### 8.2.6 Application Server De-registration
By de-registering, the Application Server informs the MSGin5G Server that it
wishes to terminate its association with the MSGin5G Server.
The procedure assumes that the Application Server is responsible for
triggering the de-registration from the MSGin5G Server. The signalling flow
for Application Server de-registration is illustrated in figure 8.2.6-1.
Pre-conditions:
1\. The Application Server is registered to the MSGin5G Server.
Figure 8.2.6-1: Application Server de-registration
1\. The Application Server determines to de-register from the MSGin5G Server.
2\. The Application Server sends an Application Server de-registration request
to the MSGin5G Server that includes the AS Service ID, as detailed in Table
9.1.2.5-1.
3\. The MSGin5G Server validates the Application Server de-registration
request. If the MSGin5G Server has authorized the Application Server
successfully, it deletes any AS Profile information that it has stored.
NOTE: The authentication procedures in step 3 are built on top of the
transport layer mechanism specified in Annex Y.4 of 3GPP TS 33.501 [16].
4\. The MSGin5G Server replies with an Application Server de-registration
response as detailed in Table 9.1.2.6-1.
### 8.2.7 MSGin5G UE bulk registration over MSGin5G-6 reference point
When MSGin5G UE-1 and UE-2, which support an MSGin5G Client, perform
registration via MSGin5G Gateway UE to contact the MSGin5G Server, the MSGin5G
Gateway service functionality in the MSGin5G Gateway UE may decide to use bulk
registration procedure specified in this clause based on the registration
request sent from MSGin5G Clients in MSGin5G UE-1 and MSGin5G UE-2, if allowed
by service policy. The procedure for MSGin5G UE bulk registration is
illustrated in figure 8.2.7-1.
Pre-conditions:
1\. The MSGin5G Gateway UE has registered to the MSGin5G Server successfully.
2\. MSGin5G UE-1 and MSGin5G UE-2 have discovered and selected an MSGin5G
Gateway UE as specified in clause 8.2.8 and connected to the serving network
via MSGin5G Gateway UE successfully.
3\. UE Service IDs and the MSGin5G Server addresses have been configured on
the MSGin5G Gateway UE, MSGin5G UE-1 and MSGin5G UE-2. All these MSGin5G UEs
are served by a same MSGin5G Server.
4\. Both the MSGin5G UEs and MSGin5G Server have been configured with the
necessary credentials to enable authenticating one another.
Figure 8.2.7-1: MSGin5G Client bulk registration
1\. The MSGin5G Client-1 sends an MSGin5G UE registration request to the
MSGin5G Server as specified in clause 8.2.1, In addition to the Information
Elements specified in table 8.2.1-1, the MSGin5G Client-1 may also add the
Information Elements specified in table 8.2.7-1 in the MSGin5G UE registration
request.
Table 8.2.7-1: MSGin5G UE registration request
Information element Status Description
* * *
Registration urgent degree O Indicates whether the registration request is
urgent or not. Wait time O Indicates the maximum wait time of the registration
request allowed by the MSGin5G Client which sent the registration request
before the bulk registration request is sent to the MSGin5G Server.
2\. Upon receiving the MSGin5G UE registration request, the MSGin5G Gateway
Client checks whether this request can be queued for bulk-handling based on
the service policy and the information included in the MSGin5G UE registration
request, e.g. whether the MSGin5G UE registration request is urgent.
NOTE 1: Whether bulk registration is supported can be configured in the
MSGin5G Gateway Client.
NOTE 2: The bulk registration conditions are specified by the application
provider or MSGin5G Service provider and are out of scope of this document.
3\. Based on step 2:
a) if the MSGin5G UE registration request is urgent, MSGin5G Gateway Client
may also include other registration requests; or
b) if the MSGin5G UE registration request can be bulk-handled, MSGin5G Gateway
Client sends a bulk registration notification to MSGin5G Client-1 and
caches/stores the MSGin5G UE registration request until the bulk registration
conditions can be fulfilled. The Information Elements specified in table
8.2.7-2 are included in the bulk registration notification. The steps 4 and 5
are skipped.
Table 8.2.7-2: bulk registration notification
Information element Status Description
* * *
UE Service ID M UE service identifier assigned to the requesting MSGin5G UE.
Expected registration time O The expected time when the bulk registration can
be handled and the MSGin5G UE registration Response can be received.
4\. The MSGin5G Server handles the MSGin5G UE registration request as
specified in clause 8.2.1 and sends the corresponding MSGin5G UE registration
response to MSGin5G Gateway Client.
5\. The MSGin5G Gateway Client sends the MSGin5G UE registration response to
MSGin5G Client-1. The MSGin5G Client-1 handles the MSGin5G UE registration
response as specified in clause 8.2.1 and skips all the remaining steps in the
present clause.
6\. MSGin5G Client-2 sends an MSGin5G UE registration request and the MSGin5G
UE registration request is handed as in steps 2-5.
7\. The MSGin5G Gateway Client finds that the conditions of sending a bulk
registration request can be fulfilled, e.g.
a) the registration request expiration time in the MSGin5G UE registration
request sent from MSGin5G Client-1 or MSGin5G Client-2 is reached; or
b) the periodic bulk registration interval is reached; or
c) the maximum MSGin5G UE registration request number in a MSGin5G UE bulk
registration request is reached.
NOTE 3: The maximum registration time, periodic bulk registration interval and
maximum MSGin5G UE registration request number are implementation specific and
out of the scope of the current specification.
8\. The MSGin5G Gateway Client includes all cached/stored MSGin5G UE
registration requests in an MSGin5G UE bulk registration request and sends it
to the MSGin5G Server. The Information Elements specified in table 8.2.7-3 are
included in the MSGin5G UE bulk registration request.
Table 8.2.7-3: MSGin5G UE bulk registration request
Information element Status Description
* * *
Number of individual MSGin5G UE registration requests M Indicates total number
of MSGin5G UE registration requests which are bulked in this MSGin5G UE bulk
registration request List of individual MSGin5G UE registration request M Each
element in this list contains information as specified in Table 8.2.1-1.
9\. Upon receiving the MSGin5G UE bulk registration request, the MSGin5G
Server splits the MSGin5G UE bulk registration request, executes the
authentication, authorization and registration procedures for each MSGin5G
Client individually as specified in clause 8.2.1.
Editor\'s note: Security aspects of bulk registration is the responsibility of
SA3.
10\. The MSGin5G Server includes all corresponding MSGin5G UE registration
responses in an MSGin5G UE bulk registration response and sends it to MSGin5G
Gateway Client. The Information Elements specified in table 8.2.7-4 are
included in the MSGin5G UE bulk registration response.
Table 8.2.7-4: MSGin5G UE bulk registration response
Information element Status Description
* * *
Number of individual MSGin5G UE registration responses M Indicates total
number of MSGin5G UE registration responses which are bulked in this MSGin5G
UE bulk registration response List of individual MSGin5G UE registration
response M Each element in this list contains information as specified in
Table 8.2.1-4.
11\. Upon receiving the MSGin5G UE bulk registration response, the MSGin5G
Gateway Client splits the MSGin5G UE bulk registration response into multiple
individual MSGin5G UE registration responses. Each individual MSGin5G UE
registration response contains information as specified in Table 8.2.1-4.
12\. MSGin5G Gateway Client sends the MSGin5G UE registration Response 1 to
MSGin5G Client-1.
13\. MSGin5G Gateway Client sends the MSGin5G UE registration Response 2 to
MSGin5G Client-2.
### 8.2.8 Constrained device with MSGin5G Client selecting MSGin5G Gateway UE
The signalling flow for MSGin5G Client-2 in the MSGin5G UE-2 (which is a
constrained device) to request other MSGin5G UEs supporting MSGin5G Gateway
service functionality to provide their configuration is illustrated in figure
8.2.8-1.
Pre-conditions:
1) MSGin5G UE-2 is not able to communicate with MSGin5G Server directly;
2) MSGin5G UE-2 has discovered nearby MSGin5G UEs using ProSe direct discovery
procedure as specified in 3GPP TS 23.304 [18].
3) An MSGin5G UE-3 supports MSGin5G Gateway service functionality (i.e.
MSGin5G UE-3 is an MSGin5G Gateway UE) and an MSGin5G UE-1 does not support
MSGin5G Gateway service functionality (i.e. MSGin5G UE-1 is not an MSGin5G
Gateway UE).
4) The UE service ID has been pre-configured on the MSGin5G UE-2.
Figure 8.2.8-1: Constrained UE sending message to request configuration of the
MSGin5G Gateway UE
1) The MSGin5G Client-2 in MSGin5G UE-2 (which is a constrained UE) sends
messages to all surrounding MSGin5G UEs (using ProSe Direction communication
as specified in 3GPP TS 23.304 [18]) to provide their gateway configuration if
MSGin5G Gateway service functionality is supported by the MSGin5G UE, i.e. the
MSGin5G UE is a MSGin5G Gateway UE. The request message includes information
elements as specified in Table 8.2.8-1.
Table 8.2.8-1: Information elements for Request for gateway UE configuration
Information element Status Description
* * *
Layer-2 ID M Layer-2 identity of UE-2 UE service ID M UE service identifier of
the UE-2 MSGin5G UE ID O MSGin5G device identifier of the UE-2 Required packet
size M Maximum allowed packet size of the UE-2
2) Upon receiving the request from the MSGin5G Client of MSGin5G UE-2, the
MSGin5G UE-3 supporting the MSGin5G Gateway service functionality sends the
response for the gateway configuration. The response message includes
information elements as specified in Table 8.2.8-2. The MSGin5G UE-1 does not
support the MSGin5G Gateway service functionality and ignores the request for
gateway UE configuration, i.e. should not send a corresponding response.
Table 8.2.8-2: Information elements for Response for gateway UE configuration
Information element Status Description
* * *
Layer-2 ID M Layer-2 identity of UE-1 UE service ID M UE service identifier of
the UE-1 MSGin5G UE ID O MSGin5G device identifier of the UE-1 Allowed packet
size M Maximum allowed packet size of the UE-2
3) If the MSGin5G UE-2 receives responses from multiple different MSGin5G
Gateway UEs, then the MSGin5G Client of the MSGin5G UE-2 selects an MSGin5G
Gateway UE whose value of the Allowed packet size is equal or more than the
value of the Required packet size of the MSGin5G UE-2. If the value of the
Allowed packet size is less than the value of the Required packet size for all
MSGin5G Gateway UE, then the MSGin5G Client of the MSGin5G UE-2 selects the
MSGin5G Gateway UE with the maximum value of the Allowed packet size among all
MSGin5G Gateway UEs and further sets the maximum allowed packet size of the
constrained UE to the value of the Allowed packet size of the selected MSGin5G
Gateway UE.
If the MSGin5G UE-2 receives responses from multiple MSGin5G Gateway UEs which
serve different domains, the MSGin5G UE-2 shall select the MSGin5G Gateway UE
that serves the same domain as the MSGin5G UE-2 does, based on the UE service
ID.
Once MSGin5G UE has selected the MSGin5G Gateway UE, the MSGin5G UE indicates
the selected MSGin5G Gateway UE by registering to use the gateway service. The
signalling flow for MSGin5G Client in the MSGin5G UE (which is a constrained
device) to register itself to use Gateway service of the MSGin5G Gateway UE is
illustrated in figure 8.2.8-2.
Figure 8.2.8-2: Constrained UE registering to use MSGin5G Gateway UE
1) Upon selecting the MSGin5G Gateway UE, the MSGin5G Client of the MSGin5G UE
sends a Gateway registration request to register with the selected MSGin5G
Gateway UE to request the use of gateway service. The request message includes
the UE service ID and may include the MSGin5G UE ID of the MSGin5G UE (i.e.
constrained UE) and the time till when constrained device is intended to use
the gateway service from the selected MSGin5G Gateway UE. The information
elements are specified in Table 8.2.8-3.
Table 8.2.8-3: Information elements for Gateway registration request
Information element Status Description
* * *
UE service ID M UE service identifier of the MSGin5G UE MSGin5G UE ID O Unique
identifier that represents the MSGin5G UE (i.e. the device identifier of the
MSGin5G UE) Time till O The time when constrained device is intended to use
the gateway service
2) Upon receiving the request from the MSGin5G Client of the MSGin5G UE, the
MSGin5G Gateway Client in MSGin5G Gateway UE checks whether the MSGin5G UE is
authorized to use the gateway service or not.
3) The MSGin5G Gateway Client in MSGin5G Gateway UE sends the response message
with the status of the registration. If the registration is successful, the
response message includes parameters like the Accepted time till when the
constrained device is allowed to use the gateway service from the selected
MSGin5G Gateway UE. The information elements are specified in Table 8.2.8-4.
Table 8.2.8-4: Gateway registration response
Information element Status Description
* * *
UE Service ID M UE service identifier of the requesting MSGin5G UE.
Registration result M Indication if the registration is success or failure
Accepted time till O Indicates the time when constrained device is allowed to
use the gateway service if the constrained device was authorized succesfully.
Failure Cause O The reason for failure. This IE should be included if the
Registration result is failure.
### 8.2.9 Non-MSGin5G UE bulk registration
Non-MSGin5G UEs (i.e., Legacy 3GPP UEs or Non-3GPP UEs) are connected to the
MSGin5G Server through a Message Gateway. The Message Gateway may decide to
use bulk registration procedure specified in this clause based on service
policy. The procedure for Non-MSGin5G UE bulk registration is illustrated in
figure 8.2.9-1.
Pre-conditions:
1\. The Message Gateway has been pre-configured with the MSGin5G Server
address.
2\. The Message Gateway has been configured with the necessary information as
specified in clause 8.1.3. If the UE Service ID and Non-MSGin5G UE credentials
have been configured and the Non-MSGin5G UEs\' Profile is available, this pre-
condition enables authentication and Non- MSGin5G UEs registration at the
Message Server.
3\. A secured connection has been established between the Message Gateway and
the MSGin5G Server.
Figure 8.2.9-1: Non-MSGin5G UE bulk registration
1\. The Message Gateway determines to perform Non-MSGin5G UE bulk
registration.
NOTE: The conditions of whether the Non-MSGin5G UE bulk registration is used
are implementation specific and out of the scope of the current specification.
2\. The Message Gateway sends a Non-MSGin5G UE bulk registration request to
the MSGin5G Server. The Information Elements specified in table 8.2.9-1 are
included in the Non-MSGin5G UE bulk registration request.
Table 8.2.9-1: Non-MSGin5G UE bulk registration request
Information element Status Description
* * *
Number of individual MSGin5G UE registration requests M Indicates total number
of Non-MSGin5G UE registration requests which are bulked in this Non-MSGin5G
UE bulk registration request List of individual Non-MSGin5G UE information M
Each element in this list contains information as specified in Table 8.2.3-1.
3\. Upon receiving the Non-MSGin5G UE bulk registration request, the MSGin5G
Server processes each of the UE registrations from the list individually as
specified in clause 8.2.3. For each individual Non-MSGin5G UE registration
that successful, the MSGin5G Server stores that UE Service ID and associated
Non-MSGin5G UE Profile information.
Editor\'s note: Security aspects of Non-MSGin5G UE bulk registration is the
responsibility of SA3.
4\. The MSGin5G Server includes all corresponding MSGin5G UE registration
responses in a Non-MSGin5G UE bulk registration response and sends it to the
Message Gateway. The Information Elements specified in table 8.2.9-2 are
included in the Non-MSGin5G UE bulk registration response.
Table 8.2.9-2: MSGin5G UE bulk registration response
Information element Status Description
* * *
Number of individual Non-MSGin5G UE registration responses M Indicates total
number of Non-MSGin5G UE registration responses which are bulked in this
MSGin5G UE bulk registration response List of individual Non-MSGin5G UE
registration response M Each element in this list contains information as
specified in Table 8.2.1-4.
### 8.2.10 Non-MSGin5G UE bulk de-registration
The procedure assumes that the Message Gateway is responsible for initiating
the bulk de-registration from the MSGin5G Server on behalf of the Non-MSGin5G
UEs. The signaling flow for Non-MSGin5G UE bulk de-registration is illustrated
in figure 8.2.10-1.
Pre-conditions:
1\. The Message Gateway successfully performed registration with the MSGin5G
Server on behalf of a set of Non-MSGin5G UEs.
Figure 8.2.10-1: Non-MSGin5G UE bulk de-registration
1\. The Message Gateway determines to perform Non-MSGin5G UE bulk de-
registration.
NOTE: The conditions of whether the Non-MSGin5G UEs can be bulked de-
registered are implementation specific and out of the scope of the current
specification.
2\. The Message Gateway sends a Non-MSGin5G UE bulk de-registration request to
the MSGin5G Server. The Information Elements specified in table 8.2.10-1 are
included in the Non-MSGin5G UE bulk de-registration request.
Table 8.2.10-1: Non-MSGin5G UE bulk de-registration request
Information element Status Description
* * *
Number of individual MSGin5G UE de-registration requests M Indicates total
number of Non-MSGin5G UE de-registration requests which are bulked in this
Non-MSGin5G UE bulk de-registration request List of individual UE Service ID M
Each element in this list contains a UE service identifier assigned to the
Non-MSGin5G UE.
3\. Upon receiving the request, the MSGin5G Server processes each of the UE
de-registration from the list individually as specified in clause 8.2.4. The
MSGin5G Server deletes any applicable UE Service ID in the List of individual
UE Service ID and associated MSGin5G Client Profile information that it has
stored.
Editor\'s note: Security aspects of Non-MSGin5G UE bulk de-registration is the
responsibility of SA3.
4\. The MSGin5G Server replies with a Non-MSGin5G UE bulk de-registration
response as shown in table 8.2.10â€‘2.
Table 8.2.10-2: Non-MSGin5G UE bulk de-registration response
Information element Status Description
* * *
Number of individual Non-MSGin5G UE de-registration responses M Indicates
total number of Non-MSGin5G UE de-registration responses which are bulked in
this Non-MSGin5G UE bulk de-registration response List of individual Non-
MSGin5G UE de-registration response M Each element in this list contains
information as specified in Table 8.2.4-2.
### 8.2.11 MSGin5G UE bulk de-registration over MSGin5G-6 reference point
The MSGin5G Gateway UE may decide to use bulk de-registration procedure
specified in this clause based on the de-registration request sent from
MSGin5G Clients in MSGin5G UEs or, if allowed by service policy. The procedure
for MSGin5G UE bulk de-registration is illustrated in figure 8.2.11-1.
Pre-conditions:
1\. The MSGin5G Gateway UE has registered to the MSGin5G Server successfully.
2\. MSGin5G UE-1 and MSGin5G UE-2 have registered to the MSGin5G Server via
MSGin5G Gateway UE successfully as specified in clause 8.2.8.
Figure 8.2.11-1: MSGin5G UE bulk de-registration
1\. The MSGin5G Client-1 sends an MSGin5G UE de-registration request to the
MSGin5G Server as specified in clause 8.2.2, In addition to the Information
Elements specified in table 8.2.2-1, the MSGin5G Client-1 may also add the
Information Elements specified in table 8.2.11-1 in the MSGin5G UE de-
registration request.
Table 8.2.11-1: MSGin5G UE de-registration request
Information element Status Description
* * *
De-registration urgent degree O Indicates whether the de-registration request
is urgent or not. Wait time O Indicates the maximum wait time of the de-
registration request allowed by the MSGin5G Client-2 before the bulk de-
registration request is sent to the MSGin5G Server.
2\. Upon receiving the MSGin5G UE de-registration request, the MSGin5G Gateway
Client checks whether this request can be queued for bulk-handling based on
the service policy and the information included in the MSGin5G UE registration
request, e.g. whether the MSGin5G UE de-registration request is urgent.
NOTE 1: Whether bulk de-registration is supported can be configured in the
MSGin5G Gateway Client.
NOTE 2: The bulk de-registration conditions are specified by the application
provider or MSGin5G Service provider and are out of scope of this document.
3\. Based on step 2:
a) if the MSGin5G UE de-registration request is urgent, the MSGin5G Gateway
Client may also include other registration requests; or
b) if the MSGin5G UE de-registration request can be bulked, MSGin5G Client-1
sends a bulk de-registration notification to MSGin5G Client-1 and
caches/stores the MSGin5G UE de-registration request until the bulk de-
registration conditions can be fulfilled. The Information Elements specified
in table 8.2.11-2 are included in the bulk de-registration notification. The
steps 4 and 5 are skipped.
Table 8.2.11-2: bulk de-registration notification
Information element Status Description
* * *
UE Service ID M UE service identifier assigned to the requesting MSGin5G UE.
Expected de-registration time O The expected time when the bulk de-
registration can be handled and the MSGin5G UE de-registration response can be
received.
4\. The MSGin5G Server handles the MSGin5G UE de-registration request as
specified in clause 8.2.2 and sends the corresponding MSGin5G UE de-
registration response to MSGin5G Gateway Client.
5\. The MSGin5G Gateway Client sends the MSGin5G UE de-registration response
to MSGin5G Client-1. The MSGin5G Client-1 handles the MSGin5G UE de-
registration response as specified in clause 8.2.2 and skips all the remaining
steps in the present clause.
6\. MSGin5G Client-2 sends an MSGin5G UE de-registration request and the
MSGin5G UE de-registration request is handled as in steps 2-5.
7\. The MSGin5G Gateway Client finds that the conditions of sending a bulk de-
registration request can be fulfilled, e.g.
a) the de-registration request expiration time in the MSGin5G UE de-
registration request sent from MSGin5G Client-1 or MSGin5G Client-2 is
reached; or
b) the periodic bulk de-registration interval is reached; or
c) the maximum MSGin5G UE de-registration request number in a MSGin5G UE bulk
de-registration request is reached.
NOTE 3: The maximum de-registration time, periodic bulk de-registration
interval and maximum MSGin5G UE de-registration request number are
implementation specific and out of the scope of the current specification.
8\. The MSGin5G Gateway Client includes all cached/stored MSGin5G UE de-
registration requests in an MSGin5G UE bulk de-registration request and sends
it to the MSGin5G Server. The Information Elements specified in table 8.2.11-3
are included in the MSGin5G UE bulk de-registration request.
Table 8.2.11-3: MSGin5G UE bulk de-registration request
Information element Status Description
* * *
Number of individual MSGin5G UE de-registration requests M Indicates total
number of MSGin5G UE de-registration requests which are bulked in this MSGin5G
UE bulk de-registration request List of individual MSGin5G UE de-registration
request M Each element in this list contains information as specified in Table
8.2.2-1.
9\. Upon receiving the MSGin5G UE bulk de-registration request, the MSGin5G
Server processes each of the MSGin5G UE de-registration from the list
individually as specified in clause 8.2.2.
Editor\'s note: Security aspects of MSGin5G UE bulk de-registration is the
responsibility of SA3.
10\. The MSGin5G Server includes all corresponding MSGin5G UE de-registration
responses in an MSGin5G UE bulk de-registration response and sends it to
MSGin5G Gateway Client. The Information Elements specified in table 8.2.11-4
are included in the MSGin5G UE bulk de-registration response.
Table 8.2.11-4: MSGin5G UE bulk de-registration response
Information element Status Description
* * *
Number of individual MSGin5G UE de-registration responses M Indicates total
number of MSGin5G UE de-registration responses which are bulked in this
MSGin5G UE bulk de-registration response List of individual MSGin5G UE de-
registration response M Each element in this list contains information as
specified in Table 8.2.2-2
11\. Upon receiving the MSGin5G UE bulk de-registration response, the MSGin5G
Gateway Client splits the MSGin5G UE bulk de-registration response into
multiple individual MSGin5G UE de-registration responses. Each individual
MSGin5G UE de-registration response contains information as specified in Table
8.2.2-2.
12\. MSGin5G Gateway Client sends the MSGin5G UE de-registration Response 1 to
MSGin5G Client-1.
13\. MSGin5G Gateway Client sends the MSGin5G UE de-registration Response 2 to
MSGin5G Client-2.
## 8.3 Message delivery procedures
### 8.3.1 General
All MSGin5G message traffic is routed via the MSGin5G Server. The present
clause specifies the MSGin5G message origination procedure when a MSGin5G
service endpoint (i.e. MSGin5G UE, AS or Message Gateway) sending a message to
its recipient(s) and the MSGin5G message termination procedure when a MSGin5G
Server delivers a message to the MSGin5G service endpoint.
### 8.3.2 MSGin5G messages origination procedure
Figure 8.3.2-1 shows the procedure for an MSGin5G UE that initiates an MSGin5G
message request.
Figure 8.3.2-1: New MSGin5G message request from UE
Figure 8.3.2-2 shows the procedure for an Application Server that initiates an
API request specified in clause 9.1.1.1 for sending an MSGin5G message to UE.
Figure 8.3.2-2: Application Server initiates a request for sending an MSGin5G
message
Figure 8.3.2-3 shows the procedure for a Legacy 3GPP Message Gateway or a
non-3GPP Message Gateway that sends a new MSGin5G message request to the
MSGin5G Server on behalf of a Legacy 3GPP UE or Non-3GPP UE.
Figure 8.3.2-3: New MSGin5G message request sending from Message Gateway
The following procedure applies to the above figures 8.3.2-1, 8.3.2-2 and
8.3.2-3 with the exception that step 1 only applies to figure 8.3.2-1.
1\. The Application Client in the UE sends a request to the MSGin5G Client for
invoking the MSGin5G Client to send a new MSGin5G message to a recipient or to
multiple recipients.
Editor\'s note: Whether the APIs provided by the MSGin5G Client to the
Application Client is to be specified in another clause of the TS is FFS.
2\. As shown in figure 8.3.2-1 or 8.3.2-3, the MSGin5G Client or Message
Gateway sends the MSGin5G message request to the MSGin5G Server and includes
the IEs as listed in table 8.3.2-1 in the request; or as shown in figure
8.3.2-2, the Application Server sends an API request to the MSGin5G Server for
sending an MSGin5G message, the API request includes the IEs as listed in
table 8.3.2-1.
NOTE: If the value of the Store and forward flag IE in the MSGin5G message
request indicates that store and forward services are requested by the sender,
the procedure in 8.3.6 applies instead.
Table 8.3.2-1: Request to MSGin5G Server for sending MSGin5G message
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | M | The service identity of the | | ID/AS Service ID | | sending MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | | | or the sending Application | | | | Server. | +-----------------------------+--------+-----------------------------+ | Recipient UE Service ID/AS | O | The service identity of the | | Service ID | | receiving MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | (see NOTE 1, NOTE 2) | | or the receiving | | | | Application Server. | | | | | | | | This IE is mandatory for | | | | Point-to-Point messaging, | | | | AS-to-Point messaging, AOMT | | | | messaging and MOAT | | | | messaging and is not | | | | present in other message | | | | scenarios. | +-----------------------------+--------+-----------------------------+ | Group Service ID | O | The service identifier of | | | | the target MSGin5G Group. | | (see NOTE 1) | | | | | | This IE is mandatory for a | | | | Group Message and is not | | | | present in other message | | | | scenarios. | +-----------------------------+--------+-----------------------------+ | Broadcast Area ID | O | The service identifier of | | | | the Broadcast Service Area | | (see NOTE 1) | | where the message needs to | | | | be broadcast. | | | | | | | | This IE is mandatory in the | | | | Broadcast Message and is | | | | not present in other | | | | message scenarios. | +-----------------------------+--------+-----------------------------+ | Messaging Topic (see NOTE | O | Indicates which Messaging | | 1) | | Topic this message is | | | | related to. | | | | | | | | This IE is mandatory for a | | | | message distribution based | | | | on topic and is not present | | | | in other message scenarios. | +-----------------------------+--------+-----------------------------+ | Application ID | O | Identifies the | | | | application(s) for which | | | | the payload is intended. | | | | | | | | This list of Application | | | | IDs IE is required when the | | | | message is sent to one or | | | | multiple Application | | | | Clients served by same | | | | MSGin5G Client. | | | | | | | | This list of Application | | | | IDs IE may be included when | | | | the message is sent to an | | | | Application Server or to an | | | | Application Client. | | | | | | | | MSGin5G Server is unaware | | | | of the content. | +-----------------------------+--------+-----------------------------+ | Message ID | M | Unique identifier of this | | | | message. | +-----------------------------+--------+-----------------------------+ | Delivery status required | O | Indicates if delivery | | | | acknowledgement from the | | | | recipient is requested. | +-----------------------------+--------+-----------------------------+ | Payload | O | Payload of the message. | | | | | | | | MSGin5G Server/Client is | | | | unaware of the content. | | | | | | | | If the request is sent from | | | | MSGin5G Client or Message | | | | Gateway to the MSGin5G | | | | Server, the maximum size of | | | | this IE is a configurable | | | | value that shall not exceed | | | | 2048 octets. | +-----------------------------+--------+-----------------------------+ | Priority type (see NOTE 3) | O | Application priority level | | | | requested for this message. | | | | The application priority | | | | levels include High, Normal | | | | and Low. The default | | | | Priority type of an MSGin5G | | | | message is Normal. | +-----------------------------+--------+-----------------------------+ | Message is segmented | O | Indicates this message is | | | | part of a segmented | | | | message. | +-----------------------------+--------+-----------------------------+ | Segmentation set identifier | O | All segmented messages | | | | associated within the same | | | | set of segmented messages | | | | (i.e. associated with the | | | | same MSGin5G message) are | | | | assigned the same unique | | | | identifier. | | | | | | | | Mandatory IE to be present | | | | in every segmented message. | +-----------------------------+--------+-----------------------------+ | Total number of message | O | Indicates the total number | | segments | | of segments for the | | | | message. | | | | | | | | The Total Segments needs to | | | | be included only in the | | | | first segment of the | | | | message. | +-----------------------------+--------+-----------------------------+ | Message segment number | O | An incrementing message | | | | segment number that | | | | indicates segmented message | | | | number of each segmented | | | | message within a set of | | | | segmented messages | +-----------------------------+--------+-----------------------------+ | Last segment flag | O | An indicator of whether | | | | this segmented message is | | | | the last segment in the set | | | | of segmented messages or | | | | not. | | | | | | | | The Last Segment Flag needs | | | | to be included only in the | | | | last segment of the | | | | message. Message segment | | | | number of the segment with | | | | \"Last Segment Flag\" set | | | | can be considered as total | | | | segments. | +-----------------------------+--------+-----------------------------+ | Store and forward flag | M | An indicator of whether | | | | store and forward services | | | | are requested for this | | | | message. If the value | | | | indicates that store and | | | | forward services are | | | | requested by the sender, | | | | the store and forward | | | | procedure in clause 8.3.6 | | | | applies. | +-----------------------------+--------+-----------------------------+ | Store and forward | O | Parameters used by MSGin5G | | parameters | | Server for providing store | | | | and forward services, as | | | | detailed in table 8.3.2-2. | | | | This IE shall be included | | | | only if the value of the | | | | Store and forward flag IE | | | | indicates that store and | | | | forward services are | | | | requested. The MSGin5G | | | | store and forward procedure | | | | is detailed in clause | | | | 8.3.6. | +-----------------------------+--------+-----------------------------+ | NOTE 1: Only one of these | | | | IEs shall be included to | | | | represent the type of | | | | message request. The | | | | MSGin5G Client may | | | | construct the related IEs | | | | based on the information | | | | received from Application | | | | Client, e.g. adds the | | | | MSGin5G service domain. | | | | | | | | NOTE 2: When the originator | | | | is an Application Server, | | | | (i.e. Originating AS | | | | Service ID is present), | | | | this IE shall be a UE | | | | Service ID. | | | | | | | | NOTE 3: The MSGin5G message | | | | with high priority should | | | | not be aggregated. The | | | | other usages of the | | | | priority level of the | | | | message is implementation | | | | specific and is out of | | | | scope of this document. | | | +-----------------------------+--------+-----------------------------+
Table 8.3.2-2: Store and forward parameters
**Value** **Status** **Description**
* * *
Message expiration time O Indicates message expiration time used for providing
store and forward services if the destination is not available for
communications, The MSGin5GServer attempts delivery at or before the message
expiration time, or when the recipient becomes available. Application specific
store and forward information O Application specific information about store
and forward handling, e.g. a delivery time/date.
3\. The MSGin5G Server verifies that the sender is authorized to send the
message and checks the integrity of the message.
If the received MSGin5G message request is for a Group Message, the MSGin5G
Server shall generate an individual message to all group members (excluding
the message originator) with additional Recipient UE Service ID to each
individual message as shown in table 8.3.3-1.
If the received MSGin5G message is a Message Topic message, the MSGin5G Server
shall generate an individual message to all subscribers subscribing this
message topic (excluding the message originator) with additional Recipient UE
Service ID to each individual message as shown in table 8.3.3-1.
4\. The MSGin5G Server may send a Message response to the originating entity
if the message is rejected or stored and includes the IEs as listed in table
8.3.2-3 in the response.
Table 8.3.2-3: Message Response
Information element Status Description
* * *
Originating UE Service ID/AS Service ID M The identity of the MSGin5G Client,
Legacy 3GPP UE, Non-3GPP UE or the identity of the Application Server that
initiated the previous Request. Message ID M Identifier of the initiating
Request. Delivery Status O Indicates if delivery is a failure, or if the
message is stored for deferred delivery. Failure Cause O The reason for
failure
### 8.3.3 MSGin5G messages termination procedure
Figure 8.3.3-1 shows the procedure for the MSGin5G Server that delivers an
MSGin5G message.
Figure 8.3.3-1: MSGin5G message towards UE
Figure 8.3.3-2 shows the same procedure (step 1 only), however for the MSGin5G
Server that delivers the message to an Application Server by application
request.
Figure 8.3.3-2: Message towards an Application Server
Figure 8.3.3-3 shows the procedure for the MSGin5G Server that delivers an
MSGin5G message to a Legacy 3GPP Message Gateway, a Non-3GPP Message Gateway,
or a Broadcast Message Gateway.
Figure 8.3.3-3: MSGin5G message towards a Message Gateway
The following procedure applies to the above figures 8.3.3-1, 8.3.3-2 and
8.3.3-3 with the exception that step 2 only applies to figure 8.3.3-1.
1\. The MSGin5G Server delivers the received MSGin5G message as listed in
table 8.3.3-1.
Table 8.3.3-1: MSGin5G message request from MSGin5G Server
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | M | The service identity of the | | ID/AS Service ID | | originating MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | | | or the originating | | | | Application Server. | +-----------------------------+--------+-----------------------------+ | Recipient UE Service ID/AS | O | The service identity of the | | Service ID | | receiving entity. | | | | | | | | For Group messaging, this | | | | IE can be a Recipient UE | | | | Service ID only. This IE is | | | | fetched from the | | | | participant information of | | | | the recipient in the group | | | | profile. | | | | | | | | For message delivery based | | | | on Messaging Topic | | | | subscription, this IE is | | | | the UE Service ID/AS | | | | Service ID of the Messaging | | | | Topic subscriber. | +-----------------------------+--------+-----------------------------+ | Broadcast Area ID | O | The identifier of the | | | | Service Area where the | | | | message needs to be | | | | broadcast. | +-----------------------------+--------+-----------------------------+ | Application ID | O | Identifies the application | | | | for which the payload is | | | | intended. | +-----------------------------+--------+-----------------------------+ | Message ID | M | Unique identifier of this | | | | message. | +-----------------------------+--------+-----------------------------+ | Delivery status required | O | Indicates if delivery | | | | acknowledgement from the | | | | recipient is requested. | +-----------------------------+--------+-----------------------------+ | Payload | O | Payload of the message. | +-----------------------------+--------+-----------------------------+ | Message is segmented | O | Indicates this message is | | | | part of a segmented | | | | message. | +-----------------------------+--------+-----------------------------+ | Group Service ID | O | The service identifier of a | | | | Group. | +-----------------------------+--------+-----------------------------+ | Messaging Topic | O | Indicates which Messaging | | | | Topic this message is | | | | related to. | +-----------------------------+--------+-----------------------------+ | Segmentation Set Identifier | O | All segmented messages | | | | associated within the same | | | | set of segmented messages | | | | (i.e. associated with the | | | | same MSGin5G message) are | | | | assigned the same unique | | | | identifier. | +-----------------------------+--------+-----------------------------+ | Total number of message | O | Indicates the total number | | segments | | of segments for the | | | | message. | | | | | | | | The Total Segments needs to | | | | be included only in the | | | | first segment of the | | | | message. | +-----------------------------+--------+-----------------------------+ | Message segment number | O | An incrementing message | | | | segment number that | | | | indicates segmented message | | | | number of each segmented | | | | message within a set of | | | | segmented messages. | +-----------------------------+--------+-----------------------------+ | Last Segment Flag | O | An indicator of whether | | | | this segmented message is | | | | the last segment in the set | | | | of segmented messages or | | | | not. | | | | | | | | The Last Segment Flag needs | | | | to be included only in the | | | | last segment of the | | | | message. Message segment | | | | number of the segment with | | | | \"Last Segment Flag\" set | | | | can be considered as total | | | | segments. | +-----------------------------+--------+-----------------------------+ | Priority type | O | Application priority level | | | | requested by the message | | | | originator for this | | | | message. | +-----------------------------+--------+-----------------------------+
### 8.3.4 MSGin5G message delivery status report into the MSGin5G Server
Figure 8.3.4-1 shows the procedure for an MSGin5G UE that initiates an MSGin5G
message delivery status report.
Figure 8.3.4-1: Message delivery status report from MSGin5G UE
Figure 8.3.4-2 shows the procedure for an Application Server that initiates an
API request for MSGin5G message delivery status report specified in clause
9.1.1.4 to UE.
Figure 8.3.4-2: Message delivery status report from Application Server
Figure 8.3.2-3 shows the procedure for a Legacy 3GPP Message Gateway or a
Non-3GPP Message Gateway that sends an MSGin5G message delivery status report
to the MSGin5G Server on behalf of a Legacy 3GPP UE or Non-3GPP UE.
Figure 8.3.4-3: Message delivery status report from Message Gateway (on behalf
of Non-MSGin5G UE)
Pre-conditions:
1\. The sender of an MSGin5G message has asked for a message delivery status
report.
Procedures:
The following procedure applies to the above figures 8.3.4-1, 8.3.4-2 and
8.3.4-3 with the exception that step 1 only applies to figure 8.3.4-1.
1\. The Application Client in the MSGin5G UE sends a request to the MSGin5G
Client for invoking the MSGin5G Client to send an MSGin5G message delivery
status report to a recipient.
Editor\'s note: Whether the APIs provided by the MSGin5G Client to the
Application Client is to be specified in another clause of the TS is FFS.
2\. As shown in figure 8.3.4-1 or 8.3.4-3, the MSGin5G Client or Message
Gateway sends the MSGin5G message delivery status report to the MSGin5G Server
and includes the IEs as listed in table 8.3.4-1, or as shown in figure
8.3.4-2, the Application Server sends an API request to the MSGin5G Server for
sending an MSGin5G message, the API request includes the IEs as listed in
table 8.3.4-1.
Table 8.3.4-1: Message delivery status report to MSGin5G Server
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | M | The service identity of the | | ID/AS Service ID | | sending MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | | | or the sending Application | | | | Server. | +-----------------------------+--------+-----------------------------+ | Recipient UE Service ID/AS | M | The service identity of the | | Service ID (NOTE) | | receiving MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | | | or the receiving | | | | Application Server. | | | | | | | | This is the sender of the | | | | message that this message | | | | delivery status report is | | | | for. | +-----------------------------+--------+-----------------------------+ | Message ID | M | Unique identifier of | | | | message delivery status | | | | report. | | | | | | | | The message ID of the | | | | MSGin5G message that is | | | | being acknowledged is | | | | included in this IE. | +-----------------------------+--------+-----------------------------+ | Failure Cause | O | The Failure Cause indicates | | | | the failure reason, if | | | | applicable. | +-----------------------------+--------+-----------------------------+ | Delivery Status | M | The delivery status | | | | description, including | | | | success or failure in | | | | delivery | +-----------------------------+--------+-----------------------------+ | NOTE: When the originator | | | | is an Application Server, | | | | (i.e. Originating AS | | | | Service ID is present), | | | | this IE shall be a UE | | | | Service ID. | | | +-----------------------------+--------+-----------------------------+
3\. The MSGin5G Server verifies that the sender is authorized to send the
message delivery status report.
4\. The MSGin5G Server may send a response to the originating entity if the
message delivery status report is rejected and includes the IEs as listed in
table 8.3.2-3 in the response.
### 8.3.5 MSGin5G message delivery status report from the MSGin5G Server
Figure 8.3.5-1 shows the procedure for the MSGin5G Server that forwards an
MSGin5G message delivery status report to an MSGin5G UE.
Figure 8.3.5-1: Message delivery status report towards an MSGin5G UE
Figure 8.3.5-2 shows the procedure for the MSGin5G Server that forwards an
MSGin5G message delivery status report to an Application Server.
Figure 8.3.5-2: Message delivery status report towards an Application Server
Figure 8.3.5-3 shows the procedure for the MSGin5G Server that forwards an
MSGin5G message delivery status report to a Legacy 3GPP Message Gateway or a
Non-3GPP Message Gateway.
Figure 8.3.5-3: Message delivery status report towards a Message Gateway
The following procedure applies to the above figures 8.3.5-1, 8.3.5-2 and
8.3.5-3 with the exception that step 2 only applies to figure 8.3.5-1.
1\. the MSGin5G Server sends the MSGin5G message delivery status report to the
MSGin5G UE or Message Gateway and includes the IEs as listed in table 8.3.5-1,
or as shown in figure 8.3.5-2 and figure 8.3.5-3, the MSGin5G Server sends an
API request to the Application Server for sending an MSGin5G message, the API
request includes the IEs as listed in table 8.3.5-1.
Table 8.3.5-1: Message delivery status report to MSGin5G Server
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | M | The service identity of the | | ID/AS Service ID | | sending MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | | | or the sending Application | | | | Server. | +-----------------------------+--------+-----------------------------+ | Recipient UE Service ID/AS | M | The service identity of the | | Service ID (see NOTE) | | receiving MSGin5G Client, | | | | Legacy 3GPP UE, Non-3GPP UE | | | | or the receiving | | | | Application Server. | | | | | | | | This is the sender of the | | | | message that this message | | | | delivery status report is | | | | for. | +-----------------------------+--------+-----------------------------+ | Message ID | M | Unique identifier of | | | | message delivery status | | | | report. | | | | | | | | The message ID of the | | | | MSGin5G message that is | | | | being acknowledged is | | | | included in this IE. | +-----------------------------+--------+-----------------------------+ | Failure Cause | O | The Failure Cause indicates | | | | the failure reason, if | | | | applicable. | +-----------------------------+--------+-----------------------------+ | Delivery Status | M | The delivery status | | | | description, including | | | | success or failure in | | | | delivery. | +-----------------------------+--------+-----------------------------+ | NOTE: When the originator | | | | is an Application Server, | | | | (i.e. Originating AS | | | | Service ID is present), | | | | this IE shall be a UE | | | | Service ID. | | | +-----------------------------+--------+-----------------------------+
2\. The MSGin5G Client sends the MSGin5G message delivery status report to
Application Client.
### 8.3.6 MSGin5G Store and Forward
Figure 8.3.6-1 shows the procedure for providing store and forward services
for MSGin5G message requests.
This procedure applies when an MSGin5G message is received at the MSGin5G
Server for delivery and the message cannot be delivered to the recipient UE;
otherwise, the procedure detailed in clause 8.3.2 applies.
Pre-conditions:
1\. The MSGin5G Client or Application Server has registered to the MSGin5G
Server.
2\. The MSGin5G Server has determined that the recipient UE is not available.
NOTE: In addition to UE registration status, the MSGin5G Server can use e.g,
UE reachability status monitoring specified in clause 8.9.2 or the
recipient\'s Communication Availability information specified in clause 8.2 to
determine whether the recipient is available and reachable for message
delivery.
Figure 8.3.6-1: Store and forward procedure
1\. MSGin5G message origination handling, see steps 1-3 in clause 8.3.2. The
value of the Store and forward flag IE (see **Table 8.3.2-1)** in the MSGin5G
message indicates that store and forward services are requested by the sender.
2\. The MSGin5G Server checks the registration information of the recipient
UE. If the Store and forward option IE (see **Table 8.2.1-3)** indicates that
the recipient UE opts out of store and forward services, the message is
discarded and the procedure proceeds with step 4 and ends with step 4. If the
Store and forward flag IE (see Table 8.3.2-1) in the received message
indicates that store and forward services are not requested by the sender, the
message is discarded and the procedure proceeds with step 4 and ends with step
4.
> If store and forward processing is required, the MSGin5G Server uses the
> Application specific store and forward information IE (see Table 8.3.2-2) to
> determine storage and forwarding.
>
> 3\. Before the Message expiration time is expired, the MSGin5G Server may
> trigger the Recipient UE based on the MSGin5G device triggering procedure in
> clause 8.9.3.
4\. The MSGin5G Server may send a message response as defined in table 8.3.2-3
which includes store and forward status information in the Delivery Status IE,
e.g., that the delivery had been deferred, or has been discarded.
5\. The recipient UE becomes available.
6\. When the recipient UE becomes available, the MSGin5G Server attempts
delivery of the request using the procedure specified in clause 8.3.3.
If the UE does not become available prior to the expiration time, the MSGin5G
Server attempts delivery of the request at the message expiration time and the
stored message is discarded or apply local implementation afterwards.
7\. The MSGin5G Server may send a message response as defined in table 8.3.2-3
which includes store and forward status information in the Delivery Status IE,
e.g., that the message was discarded.
## 8.4 Message Aggregation
### 8.4.1 General
Based on maximum segment size allowed to transmit over available transport,
the MSGin5G Service can optimize communications by aggregating one or more
messages towards the same target. The target may be an UE, an Application
Server, a Broadcast Area, an MSGin5G Group or a Messaging Topic.
The following pre-conditions apply for message aggregation:
1\. The recipient UE(s) support an MSGin5G Client or the (Legacy-3GPP and
non-3GPP) Message Gateway supports the MSGin5G Client capability.
2\. The MSGin5G Client 1 and MSGin5G Client 2 are registered with the MSGin5G
Server, or an Application Server has established a secured communication with
the MSGin5G Server.
### 8.4.2 Message Aggregation at MSGin5G Client
Figure 8.4.2-1 shows the procedure for an MSGin5G Client aggregating a set of
Point-to-Point messages each carrying small amounts of data. All of the Point-
to-Point messages to be aggregated are targeted to the same UE.
NOTE 1: Aggregation of multiple messages can also be done with the Application
Client; in this case it is implementation specific and out of the scope of the
current specification.
Figure 8.4.2-1: MSGin5G UE aggregates messages towards target MSGin5G UE
Figure 8.4.2-2 shows the procedure for an MSGin5G Client aggregating a set of
Point-to-AS messages each carrying small amounts of data. All of the Point-to-
AS messages to be aggregated are sent to same Application Server.
Figure 8.4.2-2: MSGin5G UE aggregates messages towards target Application
Server
Figure 8.4.2-3 shows the procedure for an MSGin5G Client aggregating a set of
Point-to-Point messages each carrying small amounts of data. All of the Point-
to-Point messages to be aggregated are sent to same recipient Non-MSGin5G UE.
Figure 8.4.2-3: MSGin5G UE aggregates messages towards target Non-MSGin5G UE
Figure 8.4.2-4 shows the procedure for an MSGin5G Client sends aggregated
message to a MSGin5G group. All of the messages to be aggregated are sent to
same MSGin5G Group.
Figure 8.4.2-4: MSGin5G UE sends aggregated messages towards target MSGin5G
Group
Figure 8.4.2-5 shows the procedure for an MSGin5G Client sends aggregated
message based on Messaging Topic. All the messages to be aggregated have the
same Messaging Topic.
Figure 8.4.2-5: MSGin5G UE sends aggregated messages towards target MSGin5G
Group
Figure 8.4.2-6 shows the procedure for an MSGin5G Client aggregating a set of
Broadcast messages each carrying small amounts of data. All of the Broadcast
messages to be aggregated are sent to same Broadcast Area.
Figure 8.4.2-6: MSGin5G UE aggregates messages towards target Broadcast Area
The following procedure applies to the above figures 8.4.2-1 to 8.4.2-6 with
the exception that:
a) step 4a only applies to figure 8.4.2-4
b) step 7a only applies to figure 8.4.2-1 and figure 8.4.2-4;
c) step 7b only applies to figure 8.4.2-3. and figure 8.4.2-4; and
d) step 7c only applies to figure 8.4.2-6.
1\. Application Client(s) initiates a request to the MSGin5G Client 1 to send
a message to another target. The target may be an MSGin5G UE, a Non-MSGin5G
UE, an Application Server, a MSGin5G group, or a broadcast area. the
Application Client(s) may also initiate a request to the MSGin5G Client 1 to
send a message which is to be delivered based on Messaging Topic.
2\. The MSGin5G Client 1 checks if aggregation is allowed for this message as
per the service configuration. The MSGin5G Client 1 also checks the message
data size and the priority level to determine if the received message can be
aggregated. For example, MSGin5G Client 1 finds that the message has a small
payload size when compared to the maximum segment size that can be transmitted
over available transport and is not high priority message (i.e. the value of
Priority type included in the message is not \"High\"), the MSGin5G Client 1
may aggregate this message. The MSGin5G Client 1 may continue aggregating
messages until an optimal segment size is reached before sending the
aggregated message. When the aggregation is finished, e.g. the optimal segment
size is reached or other conditions such as waiting time configured by service
provider is fulfilled, the MSGin5G Client sends the aggregated message as per
scheduling policy towards a selected target.
NOTE 2: The condition(s) when the aggregation is needed to be finished is
implementation specific.
NOTE 3: The configuration of whether aggregation is allowed for MSGin5G
messages and how the MSGin5G Client 1 uses information such as individual
message priority, maximum time to wait, etc for aggregating and sending is out
of scope of the present document.
NOTE 4: The maximum segment size that can be transmitted over available
transport is configured to the MSGin5G Client 1 in the MSGin5G Service
specific information IE as specified in Table 8.1.2-2.
3\. The MSGin5G Client 1 aggregates multiple MSGin5G message requests intended
for a selected target and sends the Aggregated message request containing the
information elements specified in Table 8.4.2-1 and Table 8.4.2-2 according to
scheduling policy towards the MSGin5G Server.
Table 8.4.2-1: Aggregated message request (MSGin5G Client to MSGin5G Server)
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originator UE Service ID | M | The service identity of the | | | | sending MSGin5G Client. | +-----------------------------+--------+-----------------------------+ | Recipient UE Service ID/AS | O | The service identity of the | | Service ID (see NOTE) | | receiving MSGin5G Client or | | | | the receiving Application | | | | Server. | +-----------------------------+--------+-----------------------------+ | Group Service ID | O | The service identifier of | | | | the target MSGin5G Group. | | (see NOTE) | | | +-----------------------------+--------+-----------------------------+ | Messaging Topic (see NOTE) | O | Indicates which Messaging | | | | Topic this message is | | | | related to. | +-----------------------------+--------+-----------------------------+ | Broadcast Area ID (see | O | The service identifier of | | NOTE) | | the Broadcast Area where | | | | the message needs to be | | | | broadcast. | +-----------------------------+--------+-----------------------------+ | Message ID | M | Unique identifier of this | | | | aggregated message | +-----------------------------+--------+-----------------------------+ | Number of individual | M | Indicates total number of | | messages | | messages which are | | | | aggregated into this | | | | message | +-----------------------------+--------+-----------------------------+ | List of individual messages | M | Each element in this list | | | | contains information | | | | elements as specified in | | | | Table 8.4.2-2. | +-----------------------------+--------+-----------------------------+ | Store and forward flag | O | An indicator of whether | | | | store and forward services | | | | are requested for this | | | | aggregated message. The | | | | store and forward services | | | | can be applied to the | | | | aggregated message only if | | | | all messages in this | | | | aggregated message can be | | | | store and forwarded. | +-----------------------------+--------+-----------------------------+ | Store and forward | O | Parameters used by MSGin5G | | parameters | | Server for providing store | | | | and forward services, as | | | | detailed in table 8.3.2-2. | | | | This IE shall be included | | | | only if the value of the | | | | Store and forward flag IE | | | | indicates that store and | | | | forward services are | | | | requested. | +-----------------------------+--------+-----------------------------+ | NOTE Only one of these IEs | | | | shall be included to | | | | represent the type of | | | | message request. | | | +-----------------------------+--------+-----------------------------+
Table 8.4.2-2: Individual message data
Information element Status Description
* * *
Individual Message ID M Unique identifier of this individual message.
Application ID O Identifies the application for which the payload is intended.
Delivery status required O Indicates if delivery acknowledgement from the
recipient is requested. Payload M Payload of the message Priority type O
Application priority level requested for this message as specified in Table
8.3.2-1 except that the value of this IE should not be High.
NOTE 5: Total size of Aggregated message request is less than or equal to
maximum segment size allowed to be transmitted over available transport.
4\. MSGin5G Server checks whether the MSGin5G Client 1 is authorized to send
the Aggregated message request.
4a The MSGin5G Server performs the necessary message exchanging procedure with
the Application Server as per clause 8.7.4.2.
5\. The MSGin5G Server sends the Aggregated message response to the MSGin5G
Client 1 in the cases listed below. The information elements defined in Table
8.4.2-3 shall be included in the response.:
a) MSGin5G Client 1 is not authorized to send Aggregated message request; or
b) the Aggregated message request is not valid; or
c) if MSGin5G Client 1 is authorized but the message is stored for deferred
delivery.
Table 8.4.2-3: Aggregated message response (MSGin5G Server to MSGin5G Client)
Information element Status Description
* * *
Original MSGin5G Client ID M The identity of the MSGin5G Client sending the
original message. Message ID M Unique identifier of the original aggregated
message Delivery Status O Indicates if delivery is a failure, or if the
message is stored for deferred delivery. Failure Cause O This IE contains the
failure reason, e.g. the originator is not authorized to send a message
request or one of the multiple messages aggregated has an issue, may be
included in this IE.
6\. If MSGin5G Client 1 is authorized to send an Aggregated message request,
the MSGin5G Server sends the Aggregated message request towards the selected
target as specified in clause 8.3.3. If the aggregated message is sent to a
recipient whose supported message segment size is smaller than the aggregated
message, the MSGin5G Server should remove the last individual message in the
List of individual messages element from the aggregated message until the
aggregated message is smaller than the maximum segment size that can be
transmitted over available transport. The MSGin5G messages removed from the
aggregated message may be sent individually or aggregated again by the MSGin5G
Server according to service configuration.
7a. If the recipient of the aggregated message is MSGin5G UE 2, the MSGin5G
Client 2 in the MSGin5G UE 2 splits the received Aggregated message request
into multiple individual MSGin5G message requests. The content of each MSGin5G
message is delivered to the recipient Application Client(s).
NOTE 6: The delivery between MSGin5G Client and Application Client is out of
scope of the present document.
7b. If the recipient of the aggregated message is a Message Gateway on behalf
of Non-MSGin5G UE, the Message Gateway splits the received Aggregated message
request into multiple individual MSGin5G message requests. The content of each
MSGin5G message is delivered to the Non-MSGin5G UE via Non-MSGin5G message
delivery.
NOTE 7: The Non-MSGin5G message delivery is out of scope of this document.
7c. If the aggregated message needs to be delivered in the Broadcast Area, the
Broadcast Message Gateway splits the received Aggregated message request into
multiple individual MSGin5G message requests. The Broadcast Message Gateway
broadcasts each individual MSGin5G message request to the MSGin5G UEs in the
Broadcast Area, or broadcasts the content of each individual MSGin5G message
request to the non-MSGin5G UEs in the Broadcast Area via CBCF. The procedures
on CBCF are specified in 3GPP TS 23.041 [14].
8\. The recipient MSGin5G Client/ Application Server/ Message Gateway may
initiate sending a message delivery status report, if requested in the
original message that is received as in Step 7a (for MSGin5G UE), step 7b (for
Non-MSGin5G UE) or Step 6 (for Application Server). MSGin5G Client 2/
Application Server/ Message Gateway sends the message delivery status report
towards the MSGin5G Client on MSGin5G UE 1 via MSGin5G Server.
NOTE 8: The message delivery status reports can also be aggregated into a
single message.
### 8.4.3 Message aggregation at MSGin5G Server
Figure 8.4.3-1 shows the procedure for the MSGin5G Server aggregating a set of
Application-to-Point messages targeted to the same recipient UE, set of group
messages for the same MSGin5G group, or a set of messages delivered based on
Messaging Topic for the same Messaging Topic, or a set of messages broadcasted
to the same Service Area, each carrying a small amount data targeted towards
the same target MSGin5G UE(s).
NOTE 1: Aggregation of multiple messages can also be done at the Application
Server; in this case it is implementation specific and out of the scope of the
current specification.
Figure 8.4.3-1: MSGin5G Server aggregates messages towards target MSGin5G UE
Figure 8.4.3-2 shows the procedure for MSGin5G Server aggregating a set of
Application-to-Point messages targeted to the same recipient UE, or a set of
group messages for the same MSGin5G group, or a set of messages delivered
based on Messaging Topic for the same Messaging Topic, or a set of messages
broadcasted to the same Service Area, each carrying a small amount data
targeted towards the same target Non-MSGin5G UE(s).
Figure 8.4.3-2: MSGin5G Server aggregates messages towards target Non-MSGin5G
UE
Figure 8.4.3-3 shows the procedure for MSGin5G Server aggregating Broadcast
messages, each carrying a small amount data targeted towards the target
Broadcast Area.
Figure 8.4.3-3: MSGin5G Server delivers aggregated message towards Non-MSGin5G
UEs in the Broadcast Area
The following procedure applies to the above figures 8.4.3-1, 8.4.3-2 and
8.4.3-3 with the exception that step 4a only applies to figure 8.4.3-1, step
4b only applies to figure 8.4.3-2 and step 4c only applies to figure 8.4.3-3.
1\. The Application Server initiates to send a set of Application-to-Point
messages targeted to the same recipient UE, or a set of group messages for the
same MSGin5G group, or a set of messages delivered based on Messaging Topic
for the same Messaging Topic, or a set of messages broadcasted to the same
Service Area, and sends the request to MSGin5G Server. The MSGin5G Server
executes the MSGin5G messages origination procedure for each message as
specified in clause 8.3.2.
2\. The MSGin5G Server checks the message data size and the priority level of
each message to determine if these messages, targeted to the same service end-
point and of the same message type (i.e., either a set of Application-to-Point
messages targeted to the same recipient UE, a set of group messages for the
same MSGin5G group, a set of messages delivered based on Messaging Topic for
the same Messaging Topic or a set of messages broadcasted to the same Service
Area,), can be aggregated. For example, the MSGin5G Server finds that the
messages have small payload size when compared to the maximum segment size
that can be transmitted over available transport and are not high priority
messages (i.e. the value of Priority type included in the message is not
\"High\"), which could be sent as per scheduling policy towards a selected
target.
NOTE 2: MSGin5G Server decides to continue aggregating messages until optimal
use of segment size before sending message towards MSGin5G Client 1.
3\. The MSGin5G Server aggregates multiple MSGin5G message requests intended
for the target UE. The Aggregated message request contain the information
elements as defined in Table 8.4.3-1 and Table 8.4.2â€‘2. The MSGin5G Server
delivers the Aggregated message request by using the MSGin5G messages
termination procedure specified in clause 8.3.3.
Table 8.4.3-1: Aggregated message request (MSGin5G Server to MSGin5G Client)
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating AS Service ID | M | The service identity of the | | | | sending Application Server. | +-----------------------------+--------+-----------------------------+ | Recipient UE Service ID | O | The service identity of the | | | | receiving MSGin5G Client. | | | | | | | | This IE in Mandatory for | | | | all type of message request | | | | except the broadcast | | | | message. | +-----------------------------+--------+-----------------------------+ | Group Service ID (see NOTE) | O | The service identifier of | | | | the target MSGin5G Group. | | | | | | | | This IE should be present | | | | if the aggregated message | | | | is a set of group messages | | | | for the same MSGin5G group. | +-----------------------------+--------+-----------------------------+ | Messaging Topic (see NOTE) | O | Indicates which Messaging | | | | Topic this message is | | | | related to. | | | | | | | | This IE should be present | | | | if the aggregated message | | | | is a set of message | | | | delivered based on | | | | Messaging Topic for the | | | | same Messaging Topic | +-----------------------------+--------+-----------------------------+ | Broadcast Area ID | O | The identifier of the | | (see NOTE) | | Service Area where the | | | | message needs to be | | | | broadcast. | +-----------------------------+--------+-----------------------------+ | Message ID | M | Unique identifier of this | | | | message | +-----------------------------+--------+-----------------------------+ | Number of individual | M | Indicates total number of | | messages | | messages which are | | | | aggregated into single | | | | message | +-----------------------------+--------+-----------------------------+ | List of Individual messages | M | Each element in this list | | | | contains information as | | | | specified in Table 8.3.3-1 | +-----------------------------+--------+-----------------------------+ | NOTE: Only one of these IEs | | | | shall be included to | | | | represent the type of | | | | message request. | | | +-----------------------------+--------+-----------------------------+
NOTE 3: Total size of Aggregated message request is less than or equal to
maximum segment size allowed to transmit over available transport.
4a. If the recipient of the aggregated message is MSGin5G UE, the MSGin5G
Client 1 residing on the MSGin5G UE splits the received Aggregated message
request into multiple individual MSGin5G message requests. The content of each
MSGin5G message is delivered to the recipient Application Client(s).
NOTE 4: The delivery between MSGin5G Client and Application Client is out of
scope of the present document.
4b. If the recipient of the aggregated message is the Message Gateway on
behalf of Non-MSGin5G UE, the Message Gateway splits the received Aggregated
message request into multiple individual MSGin5G message requests. The content
of each MSGin5G message is delivered to the Non-MSGin5G UE via Non-MSGin5G
message delivery.
NOTE 5: The Non-MSGin5Gmessage delivery is out of scope of this document.
NOTE 6: The MSGin5G Server may aggregate messages towards the target UE if it
receives messages from multiple MSGin5G UEs (instead of Application Server).
4c. If the recipient of the aggregated message is a Broadcast Area, the
Broadcast Message Gateway split the received aggregated message request into
multiple individual MSGin5G message requests. The Broadcast Message Gateway
may either broadcast each individual MSGin5G message request to the MSGin5G
UEs in the Broadcast Area, or broadcast the content of each individual MSGin5G
message request to the non-MSGin5G UEs in the Broadcast Area, via CBCF. The
procedures on CBCF are specified in 3GPP TS 23.041 [14].
## 8.5 MSGin5G Message Segmentation and Reassembly
### 8.5.1 General
This clause introduces MSGin5G message segmentation and reassembly
functionality to the MSGin5G Service.
Segmentation and reassembly operations are performed by the MSGin5G Server, or
by the MSGin5G Client, or by the Message Gateway, depending on the
communication models. For Application-to-Point use case, the MSGin5G Server
performs MSGin5G message segmentation while the MSGin5G Client performs
MSGin5G message reassembly. For Point-to-Application use case, the MSGin5G
Client performs MSGin5G message segmentation while the MSGin5G Server performs
MSGin5G message reassembly. For the Point-to-Point use case the MSGin5G Client
performs both the segmentation and the reassembly.
The Message Gateway performs segmentation and reassembly if the sender or the
recipient is a non-MSGin5G UE.
The Aggregated message request should not be segmented. If aggregated message
is sent to a recipient whose supported message segment size is smaller than
the aggregated message, the MSGin5G Server should handle the Aggregated
message as specified in clause 8.4.2.
The maximum segmentation size of MSGin5G message is 2048 bytes and can be
configurable. The supported maximum segment size for an MSGin5G UE may be
provided in the MSGin5G UE registration request.
### 8.5.2 Application-to-Point Segmentation and Reassembly
Figure 8.5.2-1 shows the MSGin5G message segmentation and reassembly procedure
for Application-to-Point MSGin5G message use cases (e.g. AOMT).
NOTE 1: Segmentation can also be done by the Application Server, in this case
the Application Server will create a segmented message and send it as a
regular MSGin5G message. In this case it is implementation specific and out of
the scope of the current specification.
Pre-conditions:
1\. A UE hosts an MSGin5G Client and an Application Client.
2\. The MSGin5G Client has registered with the MSGin5G Server.
3\. An Application Server needs to deliver application data to the Application
Client on the UE and the size of the application data exceeds the maximum
allowed packet size (e.g. due to limitation by the UE\'s access network
transport).
4\. Both the Application Server and the MSGin5G UE are hosted by the same
MSGin5G Server.
Figure 8.5.2-1: Application-to-Point MSGin5G Message Segmentation and
Reassembly
1\. An Application Server sends a message to an MSGin5G Server that targets an
Application Client on a UE.
2\. The MSGin5G Server compares the size of the received message to the
maximum allowed packet size that is supported for message delivery to the
targeted UE and detects that the size exceeds the limit. As a result, the
MSGin5G Sever segments the received message into a set of segmented messages.
Within each segmented message, the information elements defined in Table
8.3.3-1 are included to enable the MSGin5G Client on the targeted UE to
reassemble the segmented messages, with following clarifications.
a) The MSGin5G message request includes following information elements from
Table 8.3.3-1:
i) Originating AS Service ID, Recipient UE Service ID, Message ID,
Segmentation Set Identifier and Message segment number in each segmented
message
ii) Delivery status required and Total number of message segments, only if it
is the first segment of the message
iii) Last Segment Flag, only if it is the last segment of the message.
3\. The MSGin5G Server sends each segmented message to the targeted UE. If any
segment is not received within the expected time (based on configuration) then
proceed to step 4.
4\. If MSGin5G Client has received all segments (determined based on First
segment and Last Segment), the MSGin5G Client reassembles all the segmented
messages into a single MSGin5G message based on the information elements
mentioned in step 2. If not all segments are received within expected time,
then the MSGin5G Client recovers the segments as described in clause 8.5.6
MSGin5G message segment recovery procedure, before continuing with rest of the
steps.
NOTE 2: When no further segments are received within expected time and if both
first segment and last segment are missing, recovery can be initiated as
described in clause 8.5.6 MSGin5G message segment recovery procedure for
recovering the first segment and then for remaining segments.
5\. The MSGin5G Client sends Message received confirmation request to the
MSGin5G Server. The information elements defined in Table 8.5.2-2 are included
in the request. The result information element will contain \"success\" if the
reassembly of the segments is success. Otherwise, the result information
element will contain \"failure\".
Table 8.5.2-2: Message Received Confirmation Request Information Elements
**Information element** **Status** **Description**
* * *
Segmentation Set Identifier M The Segmentation Set Identifier as received in
segments. Result M Indicates the \"success\" or \"failure\"
6\. If reassembly of segments is successful, the MSGin5G Client delivers the
contents of the MSGin5G message to the targeted Application Client. If MSGin5G
Client has not received all messages (even after recovery procedure) or
reassembly of segments failed for any reason (e.g. corrupt data) then the
MSGin5G Client will notify receiving of a failed message to the Application
Client.
### 8.5.3 Point-to-Application Message Segmentation and Reassembly
Figure 8.5.3-1 shows the MSGin5G message segmentation and reassembly procedure
for Point-to-Application MSGin5G message use cases (e.g. MOAT).
Pre-conditions:
1\. A UE hosts an MSGin5G Client and an Application Client.
2\. The MSGin5G Client registered with the MSGin5G Server.
3\. An Application Client on the UE needs to deliver application data to an
Application Server and the size of the application data exceeds the maximum
allowed packet size (e.g. due to limitation by the UE\'s access network
transport).
4\. Both the Application Server and the MSGin5G UE are hosted by the same
MSGin5G Server.
Figure 8.5.3-1: Point-to-Application MSGin5G Message Segmentation and
Reassembly
1\. An Application Client on a UE sends a message to an MSGin5G Client that
targets an Application Server and that has a size that exceeds the maximum
allowed packet size.
2\. The MSGin5G Client compares the size of the received message to the
maximum allowed packet size that is supported for message delivery to the
MSGin5G Server and detects that the size exceeds the limit. As a result, the
MSGin5G Client segments the received message into a set of segmented messages
such that each segmented message can fit within the maximum allowed packet
size. Within each segmented message, the information elements defined in Table
8.3.2-1 are included to enable the MSGin5G Server to reassemble the segmented
messages, with following clarifications.
a) The MSGin5G message request includes following information elements from
Table 8.3.2-1:
i) Originating UE Service ID, Recipient AS Service ID, Message ID,
Segmentation set identifier and Message segment number in each segmented
message
ii) Delivery status required and Total number of message segments, only if it
is the first segment of the message
iii) Last segment flag, only if it is the last segment of the message.
3\. The MSGin5G Client sends each segmented message to the MSGin5G Server. If
any segment is not received within the expected time (based on configuration)
then proceed to step 4.
4\. If MSGin5G Server has received all segments (determined based on first
segment and last Segment), the MSGin5G Server reassembles all the segmented
messages into a single MSGin5G message based on the information elements
mentioned in step 2. If not all segments are received within expected time,
then the MSGin5G Server recovers the segments as described in clause 8.5.6
MSGin5G message segment recovery procedure, before continuing with rest of the
steps.
NOTE 1: When no further segments are received within expected time and if both
first segment and last segment are missing, recovery can be initiated as
described in clause 8.5.6 MSGin5G message segment recovery procedure for
recovering the first segment and then for remaining segments.
5\. The MSGin5G Server sends a Message received confirmation to the MSGin5G
Client. The information elements defined in Table 8.5.2-2 are included in the
request. The result information element will contain \"success\" if the
reassembly of the segments is success. Otherwise, the result information
element will contain \"failure\".
6\. If reassembly of segments is successful, the MSGin5G Server delivers the
contents of the MSGin5G message to the targeted Application Server. If MSGin5G
Server has not received all messages (even after recovery procedure) or
reassembly of segments failed for any reason (e.g. corrupt data) then the
MSGin5G Server will notify receiving of a failed message to the Application
Server.
### 8.5.4 Point-to-Point Message Segmentation and Reassembly
Figure 8.5.4-1 shows the MSGin5G message segmentation and reassembly procedure
for Point-to-Point MSGin5G message use cases (e.g. MOMT).
If the recipient UE is a non-MSGin5G UE, the reassembly is performed by the
Message Gateway.
This procedure assumes that a UE is only aware of the maximum payload size of
the delivery mechanism it is currently using, and it is not aware of the
maximum payload size of the recipient UE.
Pre-conditions:
1\. Both UEs host an MSGin5G Client and an Application Client.
2\. The MSGin5G Clients registered with the MSGin5G Server.
3\. An Application Client on the UE needs to deliver application data to an
Application Client on another UE and the size of the application data exceeds
the allowed maximum packet size (e.g. due to limitation by the UE\'s access
network transport).
4\. Both the sending and the receiving MSGin5G UE are hosted by the same
MSGin5G Server.
Figure 8.5.4-1: Point-to-Point MSGin5G Message Segmentation and Reassembly
1\. An Application Client on UE 1 sends a message to MSGin5G Client 1 that
targets Application Client on UE 2.
2\. The MSGin5G Client 1 compares the size of the received message to the
maximum allowed packet size that is supported for message delivery to the
MSGin5G Server and detects that the size exceeds the limit of the originating
UE. As a result, the MSGin5G Client segments the received message into a set
of segmented messages such that each segmented message can fit within the
maximum allowed packet size. Within each segmented message, the information
elements defined in Table 8.51.2-1 are included to enable reassembly of the
segmented messages, with following clarifications.
a) The MSGin5G message request includes following information elements from
Table 8.3.2-1:
i) Originating UE Service ID, Recipient UE Service ID, Message ID,
Segmentation set identifier and Message segment number in each segmented
message
ii) Delivery status required and Total number of message segments, only if it
is the first segment of the message
iii) Last segment flag, only if it is the last segment of the message.
3\. The MSGin5G Client 1 sends each segmented message to the MSGin5G Server.
If any segment is not received within the expected time (based on
configuration) then proceed to step 4.
4\. The MSGin5G Server checks if each segment does not exceed the configured
maximum packet size of the targeted UE. If the maximum packet size is not
exceeded, then the MSGin5G Server proceeds with step 6.
> If the maximum packet size is exceeded, the MSGin5G Server performs the
> following operations:
a) If all segments are received within expected time, then the MSGin5G Server
reassembles subsequent segmented messages into a single MSGin5G message until
the Last segment flag indication is received. The re-assembled message is then
segmented such that each segment is smaller than the maximum allowed packet
size of the targeted UE. Within each segmented message, the information
elements as mentioned in step 2 are included to enable reassembly at the
target, then proceed with step 6.
b) If not all segments are received within expected time, then the MSGin5G
Server acts as Message Receiver to recover the segments as described in clause
8.5.6 MSGin5G message segment recovery procedure, before continuing with rest
of the steps. If all segments are received after recovery procedure, then the
MSGin5G Server skips to step 4-a, otherwise proceed to step 5.
5\. The MSGin5G Server sends Message received confirmation to the MSGin5G
Client 1. The information elements defined in Table 8.5.2-2 are included in
the request, the Result information element is \"failure\", and further steps
are not executed.
6\. The MSGin5G Server sends each segmented message to the MSGin5G Client 2.
If any segment as a separate message is not received within the expected time
(based on configuration) then proceed to step 8.
7\. The MSGin5G Client 2 reassembles all the segmented messages into a single
MSGin5G message based on the information elements defined mentioned in step 2.
If not all segments are received within expected time, then the MSGin5G Client
2 acts as Message receiver to recover the segments as described in clause
8.5.6 MSGin5G message segment recovery procedure, before continuing with rest
of the steps.
NOTE 1: Steps 7, 8 and 9 can also be performed by the MSGin5G Client
functionality in the Message Gateway in case the recipient UE is a non-MSGin5G
UE.
8\. The MSGin5G Client 2 sends Message received confirmation to the MSGin5G
Client. The information elements defined in Table 8.5.2-2 are included in the
request. The Result information element will contain \"success\" if the
reassembly of the segments is successful. Otherwise, the Result information
element will contain \"failure\".
9\. The MSGin5G Client 2 delivers the contents of the MSGin5G message to the
targeted Application Client. If MSGin5G Client has not received all messages
(even after recovery procedure) or reassembly of segments failed for any
reason (e.g. corrupt data) then the MSGin5G Client will notify receiving of
failed message to Application Client.
### 8.5.5 Group Message Segmentation and Reassembly
A Group Message is sent from the MSGin5G Server to a group of recipient UEs.
The MSGin5G Server sends the message to each individual recipient taking into
account the maximum packet size that is supported by the recipient and
segments the message as described in clause 8.5.4.
### 8.5.6 MSGin5G Message Segment Recovery
Figure 8.5.6-1 illustrates an MSGin5G message segmentation recovery procedure.
The procedure is applicable to Application-to-Point messages, Point-to-
Application messages, Point-to-Point message and Group messages.
Pre-conditions:
1\. The Message sender has delivered segmented messages to Message receiver.
Figure 8.5.6-1: MSGin5G Message Segmentation and Reassembly
1\. The Message Receiver detects that few segments are missing to reassemble
complete message.
2\. The Message receiver sends Segment recovery request to Message sender. The
information elements defined in Table 8.5.6-1 are included in the request
message.
Table 8.5.6-1: Segment Recovery Request Information Elements
Information element Status Description
* * *
Segmentation Set Identifier M The Segmentation Set Identifier as received in
segments. List of Segment range M List of Segment range which the client wants
to recover, each segment range consist of start and end sequence number of
missing segments e.g. (5-7, 10-10, 15-19)
3\. The Message sender sends Segment recovery acknowledgement to the MSGin5G
Receiver.
4\. The Message sender sends each segmented message to the Message receiver
within an individual access network transport packet. If any segment is not
received within the expected time (based on configuration) then the Message
receiver may consider as recovery failed or may initiate the procedure again
with updated list of segment range.
NOTE: The MSGin5G message segment recovery procedure may repeat based on the
configuration.
5\. If Message receiver has received all segments (determined based on First
segment and Last Segment), the Message receiver reassembles all the segmented
messages into a single MSGin5G message.
## 8.6 MSGin5G messaging procedure on Message Gateway
### 8.6.1 General MSGin5G messaging procedure on Message Gateway
Figure 8.6.1-1 shows the MSGin5G message delivery procedure on Message Gateway
for Non-MSGin5G UEs.
Figure 8.6.1-1: MSGin5G messaging procedure on Message Gateway.
1\. The MSGin5G Server forwards the MSGin5G message request to recipient Non-
MSGin5G UE based on the UE Service ID or to the Broadcast Message Gateway
based on the Broadcast Area ID as specified in clause 8.3.3. A Delivery status
required IE may be included in the MSGin5G message request.
2\. The Message Gateway records if a message delivery status report is
requested in the message. Then it translates the MSGin5G message to a Non-
MSGin5G message (e.g. SMS, RCS message as specified in GSMA PRD RCC.07 [3])
with message delivery status report requested and finishes the information
exchange procedure with Non-MSGin5G UE (e.g. sends the non-MSGin5G message to
the Non-MSGin5G UE and receives the needed response).
NOTE 1: The information exchange procedure between Message Gateway and Non-
MSGin5G UE is out of scope of this specification.
3\. The Message Gateway checks if application level message delivery status
report is supported by the Non-MSGin5G message delivery mechanism. If not
supported, step 4a will be used and steps 4b and 5b will be skipped; otherwise
step 4b-5b will be used and step 4a will be skipped.
4a. Based on the information (e.g. response to the non-MSGin5G message
delivery request, transport level information) obtained from the non-MSGin5G
message delivery mechanism, the Message Gateway fetches the delivery status
from the above information and uses it to create an MSGin5G message delivery
status report. If the delivery status is a failure, the Message Gateway also
fetches the suitable failure reason from the above information and uses it as
reason of failure in the MSGin5G message delivery status report. The
Information Elements listed in table 8.3.4-1 are included in the MSGin5G
message delivery status report.
4b. A non-MSGin5G application level message delivery status report is received
by the Message Gateway.
NOTE 2: The procedure of non-MSGin5G application level message delivery status
report is out of scope of this specification.
5b. The Message Gateway translates the non-MSGin5G application level message
delivery status report to MSGin5G message delivery status report as specified
in clause 8.3.4. The Information Elements listed in table 8.3.4-1 are also
included in this MSGin5G message delivery status report, but the Delivery
Status and Failure Cause IEs are fetched from the non-MSGin5G application
level message delivery status report.
6\. The Message Gateway sends the MSGin5G message delivery status report to
the MSGin5G Server on behalf of the Non-MSGin5G UE or based on the delivery
result of the broadcast delivery mechanism, as specified in clause 8.3.4.
NOTE: The Broadcast Message Gateway could provide the delivery status report.
If the recipient UE supports an MSGin5G Client, the MSGin5G UE can (also) send
a delivery status report.
### 8.6.2 Non-MSGin5G UE receives message from group
#### 8.6.2.1 Legacy 3GPP UE receives message from group
Figure 8.6.2.1-1 shows the procedure for Legacy 3GPP UE to receive message
from group.
Pre-conditions:
1\. The MSGin5G Server has received the Group message to be sent to a target
Legacy 3GPP UE.
Figure 8.6.2.1-1: Legacy 3GPP UE receives a message from a group
1\. The MSGin5G Server sends the MSGin5G message request to the recipient
based on the UE Service ID. The Legacy 3GPP Message Gateway receives the
MSGin5G message request on behalf of the Legacy 3GPP UE as defined in clause
8.3.3 with following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
Group Service ID, Recipient UE Service ID, Message ID, Payload information
elements from Table 8.3.3-1. The MSGin5G message request may include Delivery
status required, Application ID and Priority type information elements from
Table 8.3.3-1.
2\. The Legacy 3GPP Message Gateway translates the MSGin5G message request to
Legacy 3GPP message (e.g. SMS).
3\. The Legacy 3GPP message gateway sends the Legacy 3GPP message (e.g. SMS)
to Legacy 3GPP UE.
4\. The Legacy 3GPP UE delivers the payload of the legacy 3GPP message (e.g.
SMS) to the targeted Application Client on the Legacy 3GPP UE.
#### 8.6.2.2 Non-3GPP message client receives message from group
Figure 8.6.2.2-1 shows the procedure for Non-3GPP message client to receive
message from group.
Pre-conditions:
1\. The MSGin5G Server has received the Group message to be sent to target
Non-3GPP UE.
Figure 8.6.2.2-1: Non-3GPP message client receives a message from a group
1\. The MSGin5G Server sends the MSGin5G message request to the recipient
based on the UE Service ID. The MSGin5G Gateway receives the MSGin5G message
request on behalf of the Non-3GPP UE as defined in clause 8.3.3 with following
clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
Group Service ID, Recipient UE Service ID, Message ID, Payload information
elements from Table 8.3.3-1. The MSGin5G message request may include Delivery
status required, Application ID and Priority type information elements from
Table 8.3.3-1.
2\. The Non-3GPP Message Gateway translates the MSGin5G message to Non-3GPP
message.
3\. The Non-3GPP Message Gateway sends message to Non-3GPP Message Client.
4) The Non-3GPP UE delivers the payload of the non-3GPP message (e.g. RCS) to
the targeted Application Client on the Non-3GPP UE.
NOTE: The procedure to translate an MSGin5G message to a Non-3GPP message and
to send a Non-3GPP message from the Non-3GPP Message Gateway to the Non-3GPP
Message Client are out of scope of 3GPP.
## 8.7 E2E Message delivery procedures
Editor\'s note: It is also FFS how endpoints are provided with the Service IDs
of the counterparts with which the E2E message delivery procedures are used.
Editor\'s note: Generalizing MSISDN to Legacy 3GPP identifier in pre-
conditions is FFS.
### 8.7.1 Point-to-Point Message delivery procedures
#### 8.7.1.1 From MSGin5G UE to MSGin5G UE
Figure 8.7.1.1-1 shows the message delivery procedure from MSGin5G UE 1 to
MSGin5G UE 2.
Pre-condition:
1\. Both MSGin5G Client 1 in MSGin5G UE 1 and MSGin5G Client 2 in MSGin5G UE 2
have registered with the MSGin5G Server.
Figure 8.7.1.1-1 Message delivery between MSGin5G UEs
1\. The MSGin5G Client 1 sends an MSGin5G message request to MSGin5G Server as
specified in clause 8.3.2 with following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
UE Service ID and Message ID information elements in Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
b) Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the MSGin5G Client 1 is authorized to send a message to MSGin5G Client 2.
2\. The MSGin5G Server forwards the MSGin5G message request to MSGin5G Client
2 as specified in clause 8.3.3.
3\. If Delivery status required is included in the MSGin5G message request,
MSGin5G Client 2 sends MSGin5G message delivery status report to the MSGin5G
Server as specified in clause 8.3.4 and then the MSGin5G Server sends MSGin5G
message delivery status report to MSGin5G Client 1 as specified in clause
8.3.5.
#### 8.7.1.2 From MSGin5G UE to Legacy 3GPP UE
Figure 8.7.1.2-1 shows the message delivery procedure from MSGin5G UE to
Legacy 3GPP UE.
Pre-conditions:
1\. MSGin5G Client in MSGin5G UE has registered with the MSGin5G Server and
the Message Gateway has registered with the MSGin5G Server on behalf of the
Legacy 3GPP UE.
2\. Legacy 3GPP Message Gateway is aware of the UE Service ID of Legacy 3GPP
UE and maintains the mapping to IDs used in the legacy network.
Figure 8.7.1.2-1: Message delivery from MSGin5G UE to Legacy 3GPP UE
1\. The MSGin5G Client sends an MSGin5G message request to the MSGin5G Server
as specified in clause 8.3.2 with following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
UE Service ID and Message ID information elements in Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
2\. Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the MSGin5G Client is authorized to send a message to the recipient UE.
3\. The MSGin5G Server forwards the MSGin5G message request to the recipient
based on the UE Service ID. The Legacy 3GPP Gateway receives the MSGin5G
message request on behalf of the Legacy 3GPP UE as specified in 8.3.3.
4\. The Legacy 3GPP Message Gateway determines which legacy 3GPP message
delivery mechanism (e.g. SMS, NIDD, Device triggering) will be used based on
Legacy 3GPP UE capability, the UE communication status, and the MSGin5G
Service configuration. When selected, the Legacy 3GPP Message Gateway maps the
UE Service ID to the corresponding identifier. For example (not an exhaustive
list):
a) if the Legacy 3GPP Message Gateway selected the device triggering delivery
mechanism, it maps the UE Service ID to MSISDN and Application port ID
b) if the Legacy 3GPP Message Gateway selected the NIDD delivery mechanism, it
maps the UE Service ID to External Identifier or MSISDN.
c) if the Legacy 3GPP Message Gateway selected the SMS delivery mechanism, it
maps the UE Service ID to MSISDN.
5-7. The Legacy 3GPP Message Gateway sends the payload of the MSGin5G message
to the terminating Legacy 3GPP UE using the determined delivery mechanism. For
example:
a) For Device triggering delivery mechanism, the Legacy 3GPP Message Gateway
interacts with the MTC-IWF/SCEF/NEF and maps the payload of the MSGin5G
message to one or more Device Triggering requests. The MTC-IWF/SCEF/NEF
interacts with SMS-SC for delivery to the UE and to receive the message
delivery status report (see TS 23.682 [8] clause 5.2, TS 29.122 [9] clause
4.4.6 and TS 29.522 [10] clause 4.4.3)
b) For NIDD delivery mechanism, the Legacy 3GPP Message Gateway may interact
with the SCEF/NEF and maps the payload of the MSGin5G message to one or more
NIDD submit request messages. The Reliable Data Service Configuration, Maximum
Latency, Priority, PDN Connection Establishment Option settings are based on
pre-configurations (see TS 23.682 [8] clause 5.13, TS 29.122 [9] clause
4.4.5.3 and TS 29.522 [10] clause 4.4.12.3). Alternatively, if tunnel
parameters are provisioned in the Legacy 3GPP Message Gateway and UPF/P-GW the
payload could be tunnelled via the UPF/P-GW (see TS 23.401 [11] (clause
4.3.17.8.3.3), TS 23.501[12] clause 5.6.10.3, TS 23.502 [7] clause 4.24);
c) For SMS delivery mechanism, the Legacy 3GPP Message Gateway sends SMS to
the Legacy 3GPP UE through the SMSC according to the procedure in TS 23.204
[13] or the procedure in clause 4.13.3 of TS 23.502 [7].
8\. If Delivery status required is included in the MSGin5G message request,
the Legacy 3GPP Message Gateway sends the MSGin5G message delivery status
report to the MSGin5G Server as specified in clause 8.3.4 and then the MSGin5G
Server sends the message delivery status report to the MSGin5G Client as
specified in clause 8.3.5.
#### 8.7.1.3 From MSGin5G UE to Non-3GPP UE
Figure 8.7.1.3-1 shows the message delivery procedure from MSGin5G UE to
Non-3GPP UE.
Pre-conditions:
1\. MSGin5G Client in MSGin5G UE has registered with the MSGin5G Server and
the Non-3GPP Message Gateway has registered with the MSGin5G Server on behalf
of the Non-3GPP UE.
2\. Non-3GPP Message Gateway is aware of the non-3GPP message client in
Non-3GPP UE and provides the mapping to UE Service ID.
Figure 8.7.1.3-1 Message Delivery from MSGin5G UE to Non-3GPP UE
1\. The Application Client in the MSGin5G UE triggers the MSGin5G Client to
send an MSGin5G message request to the MSGin5G Server as specified in 8.3.2
with following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
UE Service ID and Message ID information elements in Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
2\. The MSGin5G Server determines if the MSGin5G Client is authorized to send
a message to the recipient UE.
3\. The MSGin5G Server forwards the MSGin5G message request to the recipient
based on the UE Service ID. The Non-3GPP Message Gateway receives the MSGin5G
message request on behalf of the Non-3GPP UE as specified in clause 8.6.1.
4\. The Non-3GPP Message Gateway translates the MSGin5G message to the
Non-3GPP message with message delivery status report, if appropriate,
requested and sends it to the Non-3GPP Message Client. This step is outside
the scope of the present specification.
5\. If message delivery status report is requested, the Non-3GPP Message
Gateway sends the MSGin5G message delivery status report to the MSGin5G Server
as specified in clause 8.3.4, the MSGin5G Server forwards the MSGin5G message
delivery status report to the MSGin5G Client as specified in clause 8.3.5.
#### 8.7.1.4 From Legacy 3GPP UE to MSGin5G UE
This procedure is used for message reply from Legacy 3GPP UE (e.g. SMS UE) to
MSGin5G UE.
Figure 8.7.1.4-1 shows the response message delivery procedure from Legacy
3GPP UE (e.g. SMS UE) to MSGin5G UE.
Pre-conditions:
1\. MSGin5G Client in MSGin5G UE has registered with the MSGin5G Server and
the Legacy 3GPP Message Gateway has registered with the MSGin5G Server on
behalf of the Legacy 3GPP UE.
2\. The Legacy 3GPP UE received a message from the MSGin5G UE.
3\. The Legacy 3GPP Message Gateway is aware of the Legacy 3GPP UE and
provides the mapping to UE Service ID.
4\. The Legacy 3GPP UE replies to the MSGin5G UE upon receiving the message
from the MSGin5G UE.
5\. The Legacy 3GPP Message Gateway implementation supports storing a
messaging transaction, i.e. mapping the message originating MSGin5G Service ID
and the message delivered to the Legacy 3GPP UE, for an operator configured
time period to allow if the Legacy 3GPP UE will send a response to the
incoming message.
Figure 8.7.1.4-1: Legacy 3GPPs UE replies to MSGin5G UE
1\. The Legacy 3GPP UE sends a Legacy 3GPP message request to the Legacy 3GPP
Message Gateway (e.g. through SMSC if SMS is used according the procedure in
3GPP TS 23.204 [13] or the procedure in clause 4.13.3 of TS 23.502 [7]).
2\. The Legacy 3GPP Message Gateway translates the SMS message into MSGin5G
message and sends an MSGin5G message request to the MSGin5G Server as
specified in clause 8.3.2 with the following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
UE Service ID, and Message ID information elements in Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
b) Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the Legacy 3GPP UE with its UE Service ID is allowed to send a message to
the MSGin5G UE.
3\. The MSGin5G Server forwards the MSGin5G message request to the target
MSGin5G Client as specified in clause 8.3.3.
4-6. If the message delivery status report is requested, the MSGin5G Client in
MSGin5G UE sends an MSGin5G message delivery status report to the MSGin5G
Server as specified in clause 8.3.4, the MSGin5G Server sends the MSGin5G
message delivery status report to the Legacy 3GPP Message Gateway specified in
clause 8.3.5, the Legacy 3GPP Message Gateway translates the MSGin5G message
delivery status report to a Legacy 3GPP message delivery status report and
sends it to the Legacy 3GPP UE.
#### 8.7.1.5 From Non-3GPP UE to MSGin5G UE
This procedure is used for message reply from Non-3GPP UE to MSGin5G UE.
Figure 8.7.1.5-1 shows the message delivery procedure from Non-3GPP UE to
MSGin5G UE.
Pre-conditions:
1\. MSGin5G Client in MSGin5G UE has registered with the MSGin5G Server and
the Non-3GPP Message Gateway has registered with the MSGin5G Server on behalf
of the Non-3GPP UE.
2\. The Non-3GPP UE received a message from the MSGin5G UE.
3\. The Non-3GPP Message Gateway is aware of the Non-3GPP message client on
the Non-3GPP UE and provides the mapping to UE Service ID.
4\. The Non-3GPP UE replies to the MSGin5G UE upon receiving the message from
the MSGin5G UE.
5\. The Non-3GPP Message Gateway implementation supports storing a messaging
transaction, i.e. mapping the message originating MSGin5G Service ID and the
message delivered to the Non-3GPP UE, for an operator configured time period
to allow if the Non-3GPP UE will send a response to the incoming message.
Figure 8.7.1.5-1: Non-3GPP UE replies to MSGin5G UE
1\. The Non-3GPP UE sends a Non-3GPP message request to the Non-3GPP Message
Gateway.
2\. The Non-3GPP Message Gateway translates the Non-3GPP message to MSGin5G
message with message delivery status report requested and sends an MSGin5G
message request to the MSGin5G Server as specified in clause 8.3.2 with the
following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
UE Service ID and Message ID information elements in Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
b) Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the Non-3GPP UE with its UE Service ID is allowed to send a message to the
MSGin5G UE.
3\. The MSGin5G Server forwards the MSGin5G message request to the target
MSGin5G Client as specified in clause 8.3.3.
4\. If the message delivery status report is requested by the Non-3GPP UE, the
MSGin5G Client in MSGin5G UE sends an MSGin5G message delivery status report
to the MSGin5G Server specified in clause 8.3.4, the MSGin5G Server sends the
MSGin5G message delivery status report to the Non-3GPP Message Gateway
specified in clause 8.3.5, the Non-3GPP Message Gateway translates the MSGin5G
message delivery status report to a Non-3GPP message delivery status report
and sends it to the Non-3GPP UE.
### 8.7.2 Application-to-Point Message delivery procedures
#### 8.7.2.1 From Application Server to MSGin5G UE
Editor\'s note: It is FFS whether and how NIDD can be chosen as alternative
delivery mechanism in application -to-Point message delivery to MSGin5G UEs.
Figure 8.7.2.1-1 shows the message delivery procedure from Application Server
to MSGin5G UE.
Pre-conditions:
1\. The MSGin5G Client is registered with the MSGin5G Server.
2\. The Application Server has established secured communication with the
MSGin5G Server.
Figure 8.7.2.1-1: Message delivery from Application Server to MSGin5G UE
1\. The Application Server sends an API Request to MSGin5G Server for sending
MSGin5G message as specified in clause 8.3.2 with the following
clarifications:
a) The API request includes Originating AS Service ID, Recipient UE Service
ID, and Message ID information elements from Table 8.3.2-1, and may include
Delivery status required, Application ID, Payload, Priority type information
elements from Table 8.3.2-1.
b) Upon receiving the API Request for MSGin5G message delivery, the MSGin5G
Server determines if the Application Server is allowed to send a message to
the MSGin5G UE.
2\. The MSGin5G Server sends the MSGin5G message request to MSGin5G Client as
specified in clause 8.3.3.
3\. If Delivery status required is included in the MSGin5G message request,
MSGin5G Client 2 sends the message delivery status report to the MSGin5G
Server specified in clause 8.3.4.
4\. The MSGin5G Server sends the message delivery status report to the
Application Server as specified in clause 8.3.5
#### 8.7.2.2 From Application Server to Legacy 3GPP UE
Figure 8.7.2.2-1 shows the message delivery procedure from Application Server
to Legacy 3GPP UE.
Pre-conditions:
1\. The Application Server has established secured communication with the
MSGin5G Server.
2\. The Legacy 3GPP Message Gateway has registered with the MSGin5G Server on
behalf of the client in the Legacy 3GPP UE.
3\. Legacy 3GPP Message Gateway is aware of the legacy 3GPP message client
(i.e. SMS client) in Legacy 3GPP UE and provides the mapping to UE Service ID.
Figure 8.7.2.2-1: Application Server to Legacy 3GPP UE messaging
1\. The Application Server sends an API Request to the MSGin5G Server for
sending an MSGin5G message as specified in clause 8.3.2 with the following
clarifications:
a) The API Request includes Originating AS Service ID, Recipient UE Service
ID, and Message ID information elements from Table 8.3.2-1, and may include
Delivery status required, Application ID, Payload, Priority type information
elements from Table 8.3.2-1.
2\. Upon receiving the API Request for MSGin5G message delivery, the MSGin5G
Server determines if the Application Server is allowed to send a message to
the recipient UE.
3\. The MSGin5G Server sends the MSGin5G message request to the recipient
based on the UE Service ID. The Legacy 3GPP Gateway receives the MSGin5G
message request on behalf of the Legacy 3GPP UE as specified in clause 8.3.3.
4-7. Same with step 4-7 in clause 8.7.1.2.
8\. The Legacy 3GPP Message Gateway sends the MSGin5G message delivery status
report to the MSGin5G Server as specified in clause 8.3.4.
#### 8.7.2.3 From Application Server to Non-3GPP UE
Figure 8.7.2.3-1 shows the message delivery procedure from Application Server
to Non-3GPP UE.
Pre-conditions:
1\. The Application Server has established a secured communication with the
MSGin5G Server.
2\. The Non-3GPP Message Gateway has registered with the MSGin5G Server on
behalf of the message client in the Non-3GPP UE.
3\. Non-3GPP Message Gateway is aware of the non-3GPP message client in
Non-3GPP UE and provides the mapping to UE Service ID.
Figure 8.7.2.3-1 Application Server to Non-3GPP UE messaging
1\. The Application Server sends an API Request to the MSGin5G Server for
sending an MSGin5G message as specified in 8.3.2 with the following
clarifications:
a) The API Request includes Originating AS Service ID, Recipient UE Service
ID, and Message ID information elements from Table 8.3.2-1, and may include
Delivery status required, Application ID, Payload, Priority type information
elements from Table 8.3.2-1.
2\. Upon receiving the API Request for MSGin5G message delivery, the MSGin5G
Server determines if the Application Server is allowed to send a message to
the Non-3GPP UE.
3\. The MSGin5G Server sends the MSGin5G message request to the recipient
based on the UE Service ID. The Non-3GPP Message Gateway receives the MSGin5G
message request on behalf of the Non-3GPP UE as specified in clause 8.3.3.
4\. The Non-3GPP Message Gateway translates the MSGin5G message to the
Non-3GPP message and sends it to the Non-3GPP UE. This step is outside the
scope of the present specification.
5-6. If message delivery status report is required, the Non-3GPP Message
Gateway sends the MSGin5G message delivery status report to the MSGin5G Server
as specified in clause 8.3.4, the MSGin5G Server sends the message delivery
status report to the Application Server as specified in clause 8.3.5.
### 8.7.3 Point-to-Application Message delivery procedures
#### 8.7.3.1 From MSGin5G UE to Application Server
Figure 8.7.3.1-1 shows the message delivery procedure from MSGin5G UE to
Application Server.
Pre-conditions:
1\. The Application Server and MSGin5G Client in MSGin5G UE have registered
with the MSGin5G Server.
Figure 8.7.3.1-1: Message delivery from MSGin5G UE to Application Server
1\. The MSGin5G Client sends an MSGin5G message request to the MSGin5G Server
as specified in clause 8.3.2 with the following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
AS Service ID, and Message ID information elements from Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
b) Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the MSGin5G Client is allowed to send message to Application Server.
2\. The MSGin5G Server forwards the MSGin5G message request to the Application
Server as specified in clause 8.3.3.
3-4. If Delivery status required is included in the MSGin5G message request,
the Application Server sends the message delivery status report to the MSGin5G
Server as specified in clause 8.3.4, the MSGin5G Server sends the delivery
status to MSGin5G Client as specified in clause 8.3.5.
#### 8.7.3.2 From Legacy 3GPP UE to Application Server
This procedure is used for message reply from Non-3GPP UE to Application
Server.
Figure 8.7.3.2-1 shows the message delivery procedure from Legacy 3GPP UE to
Application Server.
Pre-conditions:
1\. The Application Server has established secured communication with the
MSGin5G Server.
2\. The Legacy 3GPP Message Gateway has registered with the MSGin5G Server on
behalf of the message client in the Legacy 3GPP UE.
3 The Legacy 3GPP UE received a message from the Application Server.
4\. The Legacy 3GPP Message Gateway is aware of the Legacy 3GPP Message client
on the Legacy 3GPP UE and provides the mapping between its identifiers and UE
Service ID.
5\. The Legacy 3GPP Message Gateway implementation supports storing a
messaging transaction, i.e. mapping the message originating MSGin5G Service ID
and the message delivered to the Legacy 3GPP UE, for an operator configured
time period to allow if the Legacy 3GPP UE will send a response to the
incoming message.
Figure 8.7.3.2-1: Legacy 3GPP UE replies to Application Server
1\. The Legacy 3GPP UE sends a Legacy 3GPP message request to the Legacy 3GPP
Message Gateway (e.g. through SMSC if SMS is used according the procedure in
3GPP TS 23.204 [13] or the procedure in clause 4.13.3 of TS 23.502 [7]).
2\. The Legacy 3GPP Message Gateway translates the Legacy 3GPP message into an
MSGin5G message and may include message delivery status report requested in
the MSGin5G message. The Legacy 3GPP Message Gateway sends the MSGin5G message
request to the MSGin5G Server as specified in clause 8.3.2 with the following
clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
AS Service ID and Message ID information elements from Table 8.3.2-1, and may
include Delivery status required, and may include Application ID, Payload and
Priority type information elements from Table 8.3.2-1.
b) Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the Legacy 3GPP UE with its UE Service ID is allowed to send a message to
the Application Server.
3\. The MSGin5G Server forwards the MSGin5G message in API request to the
Application Server as specified in clause 8.3.3.
4-6. If message delivery status report is requested, the Application Server
sends the message delivery status report by API request to the MSGin5G Server
as specified in clause 8.3.4, the MSGin5G Server forwards the message delivery
status report to the Legacy 3GPP Message Gateway as specified in clause 8.3.5,
the Legacy 3GPP Message Gateway translates the MSGin5G message delivery status
report into a Legacy 3GPP message delivery status report and sends it to the
Legacy 3GPP UE.
#### 8.7.3.3 From Non-3GPP UE to Application Server
This procedure is used for message reply from Legacy 3GPP UE to Application
Server.
Figure 8.7.3.3-1 shows the message delivery procedure from Non-3GPP UE to
Application Server.
Pre-conditions:
1\. The Application Server has established secured communication with the
MSGin5G Server.
2\. The Non-3GPP Message Client in Non-3GPP UE has registered with the MSGin5G
Server via the Non-3GPP Message Gateway.
3\. The Non-3GPP UE received a message from the Application Server.
4\. The Non-3GPP Message Gateway is aware of the Non-3GPP message client on
the Non-3GPP UE and provides the mapping between its identifiers and UE
Service ID.
5\. The Non-3GPP Message Gateway implementation supports storing a messaging
transaction, i.e. mapping the message originating MSGin5G Service ID and the
message delivered to the Non-3GPP UE, for an operator configured time period
to allow if the Non-3GPP UE will send a response to the incoming message.
Figure 8.7.3.3-1: Non-3GPP UE replies to Application Server
1\. The Non-3GPP UE sends a Non-3GPP message request to the Non-3GPP Message
Gateway.
2\. The Non-3GPP Message Gateway translates the Non-3GPP Message into an
MSGin5G message and may include MSGin5G message delivery status report
requested in the MSGin5G message. The Non-3GPP Message Gateway sends an
MSGin5G message request to the MSGin5G Server as specified in clause 8.3.2
with the following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
AS Service ID, and Message ID information elements in Table 8.3.2-1, and may
include Delivery status required, Application ID, Payload, Priority type
information elements from Table 8.3.2-1.
b) Upon receiving the MSGin5G message request, the MSGin5G Server determines
if the Non-3GPP UE with its UE Service ID is allowed to send a message to the
Application Server.
3\. The MSGin5G Server forwards the MSGin5G message in an API request to the
Application Server as specified in clause 8.3.3.
4-6. If the delivery status is required, the Application Server sends a
message delivery status report by API request to the MSGin5G Server as
specified in clause 8.3.4, the MSGin5G Server sends the message delivery
status report to the Non-3GPP Message Gateway as specified in clause 8.3.5,
the Non-3GPP Message Gateway translates the MSGin5G message delivery status
report into a Non-3GPP message delivery status report and sends it to the
Non-3GPP UE.
### 8.7.4 MSGin5G Group messaging
#### 8.7.4.1 General
This clause introduces a group messaging procedure for MSGin5G Client and
MSGin5G Server to send and receive Group messages after a group is created. In
this procedure, the group creation and membership management are handled by
group management function specified in 3GPP TS 23.434 [5].
#### 8.7.4.2 Message delivery from UE to group
Figure 8.7.4.2-1 shows the MSGin5G Group messaging procedure in which MSGin5G
Client (both IMS and non-IMS UE) sends a message to a group.
Editor\'s note: Solution for the group hosted on the legacy side where MSGin5G
Client is one of the group members is FFS.
Pre-conditions:
1\. An MSGin5G Group is created by following group management SEAL service
procedures as specified in 3GPP TS 23.434 [5].
2\. All participants in the MSGin5G Group may get the Group information i.e.
the Group Service ID.
3\. The MSGin5G Server has a copy of the group profile with all the group
members by using Group information query specified in 3GPP TS 23.434 [5].
Figure 8.7.4.2-1: Group messaging in MSGin5G Service
1\. The MSGin5G Client 1 sends a message to a group as specified in clause
8.3.2 with following clarifications:
a) The MSGin5G message request includes Originating UE Service ID, Recipient
Group Service ID and Message ID information elements from Table 8.3.2-1. The
MSGin5G message request may include Delivery status required, Application ID,
Payload and Priority type information elements from Table 8.3.2-1.
2\. Upon receiving the MSGin5G message request to send the group message, the
MSGin5G Server may send the message to the Application Server based on service
ID present in the received MSGin5G message request (e.g. to log application
specific message or for analytics). Otherwise go to step 4.
a) Upon receiving the MSGin5G message request, the Application Server
validates the message and if the message is not valid, the Application Server
sends MSGin5G message response with delivery status set as Reject to the
MSGin5G Server. Otherwise, go to step 3.
b) The MSGin5G Server sends the MSGin5G message response with delivery status
set as reject to the MSGin5G Client 1. The information elements defined in
Table 8.3.2-3 are included in the response. Following procedures will be
skipped.
3\. The Application Server initiates to send message to all group members and
sends the MSGin5G message request to the MSGin5G Server.
Editor\'s note: Whether to keep or correct step 2 or 3 is FFS.
4 Upon receiving the MSGin5G message request, if the MSGin5G Server determines
the MSGin5G Client-1 is authorized to send the group message, the MSGin5G
Server resolves the group ID to determine the members of that group, based on
the information from the group management server as specified in 3GPP TS
23.434 [5].
NOTE: If the originating UE is member of the group, the originating UE is not
included as recipient of the group message.
5\. The MSGin5G Server sends the message to all participants of the group by
their UE Service ID. The MSGin5G message request includes Originating UE
Service ID, Recipient Group ID, Recipient UE Service ID, Message ID, Payload
information elements from Table 8.3.3-1. The MSGin5G message request may
include Delivery status required, Application ID and Priority type information
elements from Table 8.3.3-1. The MSGin5G Server routes, using the procedures
in clause 8.3.3, the message to:
a) a MSGin5G UE,
b) a Legacy 3GPP UE,
c) a Non-3GPP UE.
NOTE: Steps 5 a), 5 b) and 5 c) can happen in parallel and in any order.
5\. Upon receiving the group message, if message delivery status report is
requested and if supported by target message client, the MSGin5G Client or
Legacy 3GPP UE or Non-3GPP message client sends the message delivery status
report to originator MSGin5G Client 1 as specified in clause 8.2.4 and 8.3.5.
#### 8.7.4.3 Message delivery procedure from Application Server to group
Figure 8.6.4.3-1 shows the MSGin5G Group messaging procedure in which the
Application Server sends a message to a group.
Pre-conditions:
1\. An MSGin5G Group is created by following group management SEAL service
procedures as specified in 3GPP TS 23.434 [5].
Figure 8.7.4.3-1: Group messaging in MSGin5G Service
1\. The Application Server sends a message to a group as specified in clause
8.3.2.
2 Upon receiving the MSGin5G message request, if the AS is authorized to send
the group message, the MSGin5G Server resolves the group ID to determine the
members of that group, based on the information from the group management
server specified in 3GPP TS 23.434 [5].
3\. The MSGin5G Server sends the message to all participants of the group
based on UE Service ID. The MSGin5G message Request includes Originating AS
Service ID, Recipient Group ID, Recipient UE Service ID, Message ID, Payload
information elements from Table 8.3.3-1. The MSGin5G message Request may
include Delivery Status Required, Application ID and Priority Type information
elements from Table 8.3.3-1. The MSGin5G Server routes, using the procedures
in clause 8.7.2, the message to:
a) a MSGin5G UE,
b) a Legacy 3GPP UE,
c) a Non-3GPP UE.
NOTE: Steps 3 a), 3 b) and 3 c) can happen in parallel and in any order.
4\. Upon receiving the group message, if message delivery status report is
requested and if supported by the target message client, the MSGin5G Client or
Legacy 3GPP UE or Non-3GPP message client sends the message delivery status
report to originator Application Server as specified in clause 8.3.4 and
8.3.5.
### 8.7.5 Message delivery between different PLMNs
#### 8.7.5.1 General
MSGin5G messages may be delivered between different PLMNs.
The procedure specified in clause 8.7.5.2 applies to Point-to-Point message,
Group message, and may also apply to AS-to-Point message and Point-to-AS
message delivery if agreed by the business agreement between the PLMN
operators. The procedure specified in clause 8.7.5.3 applies to Message
delivery based on Messaging Topic.
#### 8.7.5.2 Inter-PLMN message exchange procedure
Pre-condition:
1\. The Message Sender (e.g. MSGin5G Client 1 in MSGin5G UE 1) is registered
to the MSGin5G Server 1 in one PLMN.
2\. The Message Receiver (e.g. MSGin5G Client 2 in MSGin5G UE 2) is registered
to the MSGin5G Server 2 in another PLMN.
3\. MSGin5G Server 1 and MSGin5G Server 2 have established a secured
connection.
Editor\'s Note: TS 33.501 does not specify how the connection is secured.
Figure 8.7.5.2-1 shows message delivery between MSGin5G endpoints in different
PLMNs, where the Message Sender is registered in MSGin5G Server 1 and the
Message Receiver is registered in MSGin5G Server 2.
Figure 8.7.5.2-1: Message delivery between MSGin5G UEs in different PLMNs
1\. The Message Sender sends an MSGin5G message request to MSGin5G Server 1 in
PLMN 1 as specified in clause 8.3.2.
2\. The MSGin5G Server 1 analyses the target UE Service ID and determines that
the message is targeted to the Message Receiver in PLMN 2, authenticates that
the Message Sender is allowed to send a message to the Message Receiver, and
then the MSGin5G Server 1 forwards the MSGin5G message request to MSGin5G
Server 2 in PLMN 2. The MSGin5G message request contains the Information
Elements as specified in table 8.3.3-1.
3\. MSGin5G Server 2 forwards the MSGin5G message request to the Message
Receiver as specified in clause 8.3.3.
4-6. If the message delivery status report is requested, the Message Receiver
sends a message delivery status report to Message Sender as per procedure
specified in clause 8.3.4 and 8.3.5.
#### 8.7.5.3 Inter-PLMN message exchange procedure based on Messaging Topic
Figure 8.7.5.3-1 shows the inter-PLMN Message delivery based on Messaging
Topic when MSGin5G Server 2 forwards the Messaging Topic subscription request
from the MSGin5G UE/Application Server served by it to MSGin5G Server 1 as
specified in clause 8.8.4.
Editor\'s note: If clause 8.7.5.3 needs alignment with clause 8.8.4 is FFS.
Pre-condition:
1\. The Message Sender (e.g. an MSGin5G UE, a Message Gateway on behalf of a
Non-MSGin5G UE or an Application Server) is registered to the MSGin5G Server 1
in PLMN 1.
2\. The Message Receiver (e.g. an MSGin5G UE, a Message Gateway on behalf of a
Non-MSGin5G UE or an Application Server) is registered to the MSGin5G Server 2
in PLMN 2.
3\. MSGin5G Server 1 and MSGin5G Server 2 have established a secured
connection.
4\. MSGin5G Client or Application Server served by MSGin5G Server 2 has
subscribed to a Messaging Topic with the MSGin5G Server 1 as specified in
clause 8.8.4 via MSGin5G Server 2.
Figure 8.7.5.3-1: Message delivery between MSGin5G UEs in different PLMNs
1\. The Message Sender sends an MSGin5G message request (if the sender is an
MSGin5G UE) or API request (if the sender is an Application Server or a
Message Gateway on behalf of a Non-MSGin5G UE) to MSGin5G Server 1 in PLMN 1
as specified in clause 8.3.2. A Messaging Topic is included in this request.
2\. The MSGin5G Server 1 checks the subscriptions of the Messaging Topic
included in the request and obtains the UE Service ID/AS Service ID of the
Message Receivers. The MSGin5G Server 1 determines that the message with this
Messaging Topic is needed to be delivered to an MSGin5G UE/Application Server
served by Message Server 2 in PLMN 2 based on the UE Service ID/AS Service ID
of the Message Receiver. The MSGin5G Server 1 then sends the MSGin5G message
to MSGin5G Server 2. The MSGin5G message request contains the Information
Elements as specified in table 8.3.3-1.
3 The MSGin5G Server 2 delivers the MSGin5G message request to Messager
Receiver based on the UE Service ID/AS Service ID in the message as specified
in clause 8.3.3.
4-6. If the message delivery status report is requested, the Message Receiver
sends message delivery status report to Message Sender as per procedure
specified in clause 8.3.4 and 8.3.5.
Figure 8.7.5.3-2 shows the inter-PLMN Message delivery to subscribing service
endpoints based on Messaging Topic when MSGin5G Server 2 subscribes the
Messaging Topic on behalf of all MSGin5G UEs/Application Servers served by it
as specified in clause 8.8.4.
Pre-condition:
1\. The Message Sender (e.g. an MSGin5G UE, a Message Gateway on behalf of a
Non-MSGin5G UE or an Application Server) is registered to the MSGin5G Server 1
in PLMN 1.
2\. The Message Receiver (e.g. an MSGin5G UE, a Message Gateway on behalf of a
Non-MSGin5G UE or an Application Server) is registered to the MSGin5G Server 2
in PLMN 2.
3\. MSGin5G Server 1 and MSGin5G Server 2 have established a secured
connection.
4\. MSGin5G Server 2 subscribed to a Messaging Topic with the MSGin5G Server 1
as specified in clause 8.8.4. A Messaging Topic with the MSGin5G Server 2
address of the subscriber has been created on MSGin5G Server 1.
5\. The MSGin5G Client or Application Server served by MSGin5G Server 2
subscribed to the Messaging Topic with the MSGin5G Server 2. A Messaging Topic
with the UE Service ID/AS Service ID of the subscriber has been created on
MSGin5G Server 2.
Figure 8.7.5.3-2: Message delivery between MSGin5G UEs in different PLMNs
1\. The Message Sender sends an MSGin5G message request (if the sender is an
MSGin5G UE) or API request (if the sender is an Application Server or a
Message Gateway) to MSGin5G Server 1 in PLMN 1 as specified in clause 8.3.2. A
Messaging Topic is included in this request.
2\. The MSGin5G Server 1 checks the subscription of the Messaging Topic
included in the request. The MSGin5G Server 1 determines that the message with
this Messaging Topic is needed to be delivered to the Message Server 2 in PLMN
2 and sends the MSGin5G message to MSGin5G Server 2. The MSGin5G message
request contains the Information Elements as specified in table 8.3.2-1.
3a The MSGin5G Server 2 checks the subscription of the Messaging Topic
included in the inbound request. The MSGin5G Server 2 delivers the MSGin5G
message request to Messager Receiver 1 based on its UE Service ID/AS Service
ID as specified in clause 8.8.2.
3b The MSGin5G Server 2 also delivers the MSGin5G message request to Messager
Receiver 2 which subscribed to this Messaging Topic as specified in clause
8.8.2.
4a-6a. If the message delivery status report is requested, the Message
Receiver 1 sends message delivery status report to Message Sender as per
procedure specified in clause 8.3.4 and 8.3.5.
4b-6b. If the message delivery status report is requested, the Message
Receiver 2 sends message delivery status report to Message Sender as per
procedure specified in clause 8.3.4 and 8.3.5.
### 8.7.6 Broadcast message delivery
#### 8.7.6.1 General
This clause introduces a Broadcast message procedure for an Application Server
and an MSGin5G UE to send a Broadcast message. In this procedure, an MSGin5G
message is delivered via broadcast to MSGin5G UEs or non-MSGin5G UEs in a
Broadcast Area.
#### 8.7.6.2 Broadcast message delivery procedure
Figure 8.7.6.2-1 shows the Broadcast message delivery procedure from
Application Server or MSGin5G UE to the UEs in Broadcast Area.
Pre-condition:
1\. Application Server or MSGin5G Client in MSGin5G UE has registered with the
MSGin5G Server.
Figure 8.7.6.2-1: Message Delivery in Broadcast Area
1\. An MSGin5G message request is sent by an Application Server or an MSGin5G
UE to the MSGin5G Server as specified in clause 8.3.2 with following
clarifications:
a) The MSGin5G message includes Originating UE Service ID/AS service ID,
Broadcast Area ID and Message ID information elements in Table 8.3.2-1, and
may include Delivery status required, Application ID, Payload information
elements from Table 8.3.2-1.
2\. The MSGin5G Server determines if the Application Server or MSGin5G Client
is authorized to send a Broadcast message.
3\. The MSGin5G Server forwards the Broadcast message request to the CBCF (as
specified in 3GPP TS 23.041 [14]) via the Broadcast Message Gateway based on
the Broadcast Area ID as specified in 8.3.3.
4\. The Broadcast Message Gateway delivers the message to the CBCF which
broadcasts the message to the MSGin5G UEs in the Broadcast Area or to the non-
MSGin5G UEs in the Broadcast Area. This step is out of scope of the present
specification.
If the Delivery status requested information element is included in the
MSGin5G Broadcast message, a recipient MSGin5G UE sends the delivery report as
specified in clause 8.3.4.
## 8.8 Other MSGin5G messaging related procedures
### 8.8.1 Messaging Topic Subscription
An MSGin5G Client or an Application Server can subscribe one or more Messaging
Topic(s) on the MSGin5G Server. The Messaging Topic IE will be populated by
the Application Client or the Application Server and the content of this IE is
out of scope.
When an MSGin5G Client or an Application Server is subscribed to a Messaging
Topic, then the MSGin5G Server will deliver messages that contain the same
Messaging Topic to the subscribers.
Figure 8.8.1-1 shows the MSGin5G Client/Application Server subscribing to
Messaging Topic(s) on the MSGin5G Server.
Pre-conditions:
1\. The MSGin5G Client or Application Server has registered to the MSGin5G
Server.
Figure 8.8.1-1: MSGin5G Service endpoint subscribes to Messaging topic(s)
1\. The MSGin5G Client or Application Server sends a Messaging Topic
subscription request to the MSGin5G Server. The request includes the
information elements listed in Table 8.8.1-1.
Table 8.8.1-1: Messaging Topic subscription request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | M | The service identity of the | | ID/AS Service ID | | sending MSGin5G Client or | | | | the sending Application | | | | Server. | +-----------------------------+--------+-----------------------------+ | Messaging Topic | M | A list of Messaging | | | | Topic(s) that is to be | | | | subscribed. The number of | | | | Messaging Topic(s) included | | | | in this IE can be one or | | | | more. | +-----------------------------+--------+-----------------------------+ | Expiration | O | The date and time when the | | | | subscription expires. | | | | | | | | This date and time apply to | | | | all Messaging Topic(s) | | | | subscribed in this request. | | | | | | | | If this IE is included, the | | | | value of it should be | | | | larger than 0. | | | | | | | | If this IE is not included, | | | | the expiration time is | | | | subject to operator policy. | +-----------------------------+--------+-----------------------------+ | NOTE: The content of the | | | | Messaging Topic is out of | | | | scope of the present | | | | document. | | | +-----------------------------+--------+-----------------------------+
2\. The MSGin5G Server validates the Messaging Topic subscription request and
checks the locally stored Messaging Topic(s).
a) If the subscribed Messaging Topic has already been created, the MSGin5G
Server checks whether the UE Service ID/AS Service ID of the subscriber is
already included in the subscribers list of this Messaging Topic.
1\. If not, the MSGin5G Server adds the UE Service ID/AS Service ID of the
subscriber to the subscribers list of this Messaging Topic. The MSGin5G Server
sets the validity time of this subscription to the value of the Expire IE or
to a default value according to the service policy.
2\. Else, the MSGin5G Server updates the validity time of this subscription.
b) If the subscribed Messaging Topic has not been already created, the MSGin5G
Server creates this Messaging Topic, and adds the UE Service ID/AS Service ID
of the subscriber to the subscribers list of this Messaging Topic. The MSGin5G
Server sets the validity time of this subscription to the value of the Expire
IE or to a default value according to the service policy.
3\. The MSGin5G Server sends a Messaging Topic Subscription response to the
originator of the request. The response includes the information listed in
Table 8.8.1-2.
Table 8.8.1-2: Messaging Topic Subscription response
Information element Status Description
* * *
Subscription status M Indicates whether the subscription was successfully
added or deleted on the MSGin5G Server. Expiration O The validity date and
time of this subscription set by the MSGin5G Server.
8.8.2 Message delivery based on Messaging Topic
If an MSGin5G Client or an Application Server is in the subscribers list of a
Messaging Topic, the MSGin5G Server delivers messages that contain this
Messaging Topic to it.
Figure 8.8.2-1 shows the Message delivery to a subscribing service endpoint
based on Messaging Topic.
Pre-conditions:
> 1\. The MSGin5G Client or Application Server subscribed to a Messaging Topic
> with the MSGin5G Server. A Messaging Topic with the UE Service ID/AS Service
> ID of the subscriber has been created.
Figure 8.8.2-1: Message delivery to subscribing service endpoint based on
Messaging Topic
1\. The MSGin5G Server receives an MSGin5G message request or an API message
request corresponding to step 2 in figures 8.3.2-1 or 8.3.2-2 which includes
the IEs as listed in table 8.3.2-1. The MSGin5G message request or API message
request contains a Messaging Topic IE corresponding to the Messaging Topic for
which subscription(s) exist.
2\. The MSGin5G Server uses the procedure described in clause 8.3.3 to deliver
the message to all subscriber(s) of this Messaging Topic. In each message, the
UE Service ID/AS Service ID of subscriber should be added as the Recipient UE
Service ID/AS Service ID IE specified in table 8.3.3-1.
### 8.8.3 Messaging Topic Unsubscription
Corresponding to message topic subscription, an MSGin5G Client or an
Application Server can unsubscribe from one or more Messaging Topic(s) on the
MSGin5G Server.
Figure 8.8.3-1 shows the MSGin5G Client/Application Server unsubscribing to
Messaging Topic(s) on the MSGin5G Server.
Pre-condition
1\. The MSGin5G Client or Application Server has subscribed one or more
message topic(s) on the MSGin5G Server.
Figure 8.8.3-1: MSGin5G Service endpoint unsubscribes to Messaging topic(s)
1\. The MSGin5G Client or Application Server sends a Messaging Topic
unsubscription request to the MSGin5G Server. The request includes the
information listed in Table 8.8.3-1.
Table 8.8.3-1: Messaging Topic unsubscription request
Information element Status Description
* * *
Originating UE Service ID/AS Service ID M The service identity of the sending
MSGin5G Client or the sending Application Server. Messaging Topic(s) M A list
of Messaging Topic(s) that is to be unsubscribed. The number of Messaging
Topic(s) included in this IE can be one or more.
2\. The MSGin5G Server validates the Messaging Topic unsubscription request
and checks the locally stored Messaging Topic(s). If the UE Service ID/AS
Service ID is included in the subscribers list of this Messaging Topic, the
MSGin5G Server removes the UE Service ID/AS Service ID from the subscribers
list of this Messaging Topic.
3\. The MSGin5G Server sends a Messaging Topic Unsubscription response to the
originator of the request. The response includes the information listed in
Table 8.8.3-2.
Table 8.8.3-2: Messaging Topic Unsubscription response
Information element Status Description
* * *
subscription status M Indicates whether the subscription was successfully
deleted on the MSGin5G Server
### 8.8.4 Messaging Topic handling between different MSGin5G Servers
#### 8.8.4.1 General
When a Messaging Topic(s) is handled between different MSGin5G Servers, the
MSGin5G Server 1 may work in the following models, when the subscription for
the Messaging Topic exists on Server 2:
a. Mod.A: the MSGin5G UE/Application Server served by MSGin5G Server 1
subscribes to Messaging Topic(s) and the MSGin5G Server 1 forwards Messaging
Topic subscription request from the MSGin5G UE/Application Server to MSGin5G
Server 2 or
b. Mod.B: the MSGin5G UE/Application Server served by MSGin5G Server 1
subscribes to Messaging Topic(s) and the MSGin5G Server 1 subscribes to the
Messaging Topic(s) on Server 2 on behalf of all MSGin5G UE/Application Server
served by it.
If the subscription for the Messaging Topic already exists on Server 1, or if
the subscription does not exist either on Server 1 or on Server 2, the
procedure in clause 8.8.1 applies.
The MSGin5G Server may work in one model based on the service policy. The
MSGin5G Server 1 and MSGin5G Server 2 can be located in the same PLMN or
different PLMNs.
To enable the message delivery based on Messaging Topic between different
MSGin5G Servers, an MSGin5G Server shall subscribe the Messaging Topic list
from other MSGin5G Servers as specified in clause 8.8.4.2. If the Messaging
Topic is created or deleted on an MSGin5G Server, and if there are Messaging
Topic list subscriptions from other MSGin5G Server(s), the MSGin5G Server
shall send a Messaging Topic list notification to the corresponding MSGin5G
Server(s) as specified in clause 8.8.4.2. When an MSGin5G Server receives a
Messaging Topic subscription or unsubscription from an MSGin5G Client, it
shall handle the Messaging Topic subscription or unsubscription request as
specified in clause 8.8.4.3 or clause 8.8.4.4.
Editor\'s note: If a Messaging Topic creation procedure, where Messaging Topic
subscription management is controlled by the MSGin5G Server, is required is
FFS.
#### 8.8.4.2 Messaging Topic list subscription
Before the subscribing of Messaging Topic(s), the MSGin5G Server 1 should
obtain the available Messaging Topic list on the MSGin5G Server 2 to determine
whether to forward the Messaging Topic subscription request to MSGin5G Server
2, to subscribe to the Messaging Topic on behalf of all MSGin5G UE/Application
Server served by it on MSGin5G Server 2, or to create the subscription on
Server 1 as specified in clause 8.8.1 if the subscription does not exist on
Server 2.
Figure 8.8.4.2-1 shows the MSGin5G Server 1 subscribing to Messaging Topic
list on the MSGin5G Server 2.
NOTE 1: If the MSGin5G Server 1 and MSGin5G Server 2 are located in the same
PLMN, the synchronization of Messaging Topic list between MSGin5G Servers may
also be implementation specific.
Pre-conditions:
1\. MSGin5G Server 1 and MSGin5G Server 2 have established a secured
connection.
Editor\'s Note: How a secure connection between two MSGin5G Servers is to be
established is FFS.
Figure 8.8.4.2-1: MSGin5G Server 1 subscribes to Messaging Topic list on the
MSGin5G Server 2
1\. The MSGin5G Server 1 sends a Messaging Topic list subscription request to
the MSGin5G Server 2. The request includes the information elements listed in
Table 8.8.4.2-1.
Table 8.8.4.2-1: Messaging Topic list subscription request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating MSGin5G Server | M | The MSGin5G Server which | | ID | | requests the Messaging | | | | Topic list. | +-----------------------------+--------+-----------------------------+ | Recipient MSGin5G Server ID | M | The MSGin5G Server which | | | | holds the Messaging Topic | | | | list. | +-----------------------------+--------+-----------------------------+ | Security credentials | O | Security information | | | | required by the MSGin5G | | | | Server 2 and is left for | | | | implementation. | +-----------------------------+--------+-----------------------------+ | Expiration | O | The date and time when the | | | | subscription expires. | | | | | | | | If this IE is included, the | | | | value of it should be | | | | larger than 0. | | | | | | | | If this IE is not included, | | | | the expiration time is | | | | subject to operator policy. | +-----------------------------+--------+-----------------------------+
Editor\'s Note: Each request should have an originating address and a
recipient address. This should be made consistent across the entire TS.
2\. Upon receiving the Messaging Topic list subscription request, the MSGin5G
Server 2 validates this request and may verify the security credentials.
3\. The MSGin5G Server 2 checks the locally stored Messaging Topic list
subscription(s).
a) If the MSGin5G Server 1\'s subscription has already been created, the
MSGin5G Server 2 updates the validity time of this subscription.
b) If the MSGin5G Server 1\'s subscription has not been created, the MSGin5G
Server 2 creates the subscription.
4\. The MSGin5G Server 2 sends a Messaging Topic list Subscription response to
MSGin5G Server 1. The response includes the information listed in Table
8.8.4.2-2.
Table 8.8.4.2-2: Messaging Topic list Subscription response
Information element Status Description
* * *
Subscription status M Indicates whether the subscription was successfully
added or deleted on the MSGin5G Server 2. Expiration O The validity date and
time of this Messaging Topic list subscription set by the MSGin5G Server 2.
5\. The MSGin5G Server 2 checks whether Messaging Topic list notification is
needed, e.g. whether the MSGin5G Server 1 subscribes the Messaging Topic list
on MSGin5G Server 2 for the first time, or the local Messaging Topic(s) on the
MSGin5G Server 2 are updated, e.g. new Messaging Topic(s) has been created or
existing Messaging Topic(s) has been deleted.
NOTE 2: If the MSGin5G Server 1 has previously unsubscribed the Messaging
Topic list on MSGin5G Server 2, the MSGin5G Server 2 should consider that the
MSGin5G Server 1 subscribes the Messaging Topic list on MSGin5G Server 2 for
the first time when the MSGin5G Server 1 subscribes the Messaging Topic list
again.
6\. If Messaging Topic list notification is needed, the MSGin5G Server 2 sends
a Messaging Topic list notification to MSGin5G Server 1. The notification
includes the information listed in Table 8.8.4.2-3.
Table 8.8.4.2-3: Messaging Topic list notification
+------------------------+--------+-----------------------------+ | Information element | Status | Description | +========================+========+=============================+ | Expiration | O | The new validity date and | | | | time of this subscription | | | | set by the MSGin5G Server | | | | 2. | +------------------------+--------+-----------------------------+ | >Messaging Topic list | M | A list of Messaging | | | | Topic(s) that exists on the | | | | MSGin5G Server 2. | | | | | | | | If the MSGin5G Server 1 | | | | subscribes the Messaging | | | | Topic list on MSGin5G | | | | Server 2 for the first | | | | time, the MSGin5G Server 2 | | | | should include all | | | | Messaging Topic(s) that | | | | exist on the MSGin5G Server | | | | 2 in this Messaging Topic | | | | list, else the MSGin5G | | | | Server 2 includes the | | | | deviation of Messaging | | | | Topic(s) since the last | | | | notification, | | | | | | | | Each element in this list | | | | contains information as | | | | specified in | | | | Table 8.8.4.2-4. | | | | | | | | Based on service policy, | | | | the MSGin5G Server 2 may | | | | only include a part of | | | | Messaging Topic(s) in the | | | | notification which are | | | | allowed to be subscribed by | | | | MSGin5G Server 1. | +------------------------+--------+-----------------------------+
Table 8.8.4.2-4: Individual Messaging Topic
Information element Status Description
* * *
Messaging Topic M Unique identifier of this Messaging Topic. Update status M
Identifies the Messaging Topic is newly created on the MSGin5G Server 2, or
newly deleted on the MSGin5G Server 2
7\. Upon receiving the Messaging Topic list notification, the MSGin5G Server 1
updates the locally stored Messaging Topic list:
a) if the Update status of a Messaging Topic is Created, the MSGin5G Server 1
adds the Messaging Topic to the locally stored Messaging Topic list; and
b) if the Update status of a Messaging Topic is Deleted,
i) if the Messaging Topic exists on MSGin5G Server 1, the MSGin5G Server 1
removes the Messaging Topic from the locally stored Messaging Topic list; and
ii) if the Messaging Topic does not exist on MSGin5G Server 1, the MSGin5G
Server 1 ignores this Messaging Topic update.
NOTE 3: The MSGin5G Server should not send Messaging Topic list notification
to other MSGin5G Servers if its locally stored Messaging Topic list is updated
by receiving a Messaging Topic list notification.
#### 8.8.4.3 Messaging Topic Subscription between different MSGin5G Servers
If the MSGin5G Server 1 works in Mod.A (see clause 8.8.4.1), upon receiving a
Messaging Topic subscription request from MSGin5G Client or Application
Server, if the Messaging Topic is included in the Messaging Topic list of
MSGin5G Server 2, the MSGin5G Server 1 forwards the Messaging Topic
subscription request to MSGin5G Server 2. Otherwise, the MSGin5G Server 1
handles the Messaging Topic subscription request as specified in clause 8.8.3.
If the MSGin5G Server 1 works in Mod.B (see clause 8.8.4.1), upon receiving a
Messaging Topic subscription request from MSGin5G Client or Application
Server, if the Messaging Topic is not included in the Messaging Topic list of
MSGin5G Server 2, the MSGin5G Server 1 handles the Messaging Topic
subscription request as specified in clause 8.8.1. Otherwise, it may subscribe
one or more Messaging Topic(s) from the Messaging Topic list by using the
procedure specified in clause 8.8.1 with the clarification listed below.
The procedure for the Messaging Topic subscription for both Mod. A and Mod. B.
between MSGin5G Servers is as follows:
1\. The MSGin5G Server 1 includes the information elements listed in Table
8.8.4.3-1 instead of the information elements listed in Table 8.8.1-1.
Table 8.8.4.3-1: Messaging Topic subscription request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | O | The service identity of the | | ID/AS Service ID (see NOTE | | sending MSGin5G Client or | | 1) | | the sending Application | | | | Server. | | | | | | | | This IE shall be included | | | | if MSGin5G Server 1 | | | | forwards Messaging Topic | | | | subscription request from | | | | the MSGin5G UE/Application | | | | Server served by it to | | | | MSGin5G Server 2. | +-----------------------------+--------+-----------------------------+ | MSGin5G Server address | O | The MSGin5G Server which | | (see NOTE 1) | | subscribes the Messaging | | | | Topic(s). | | | | | | | | This IE shall be included | | | | if MSGin5G Server 1 | | | | subscribe the Messaging | | | | Topic on behalf of all | | | | MSGin5G UE/Application | | | | Server served by it. | +-----------------------------+--------+-----------------------------+ | Security credentials | O | Security information | | | | required by the MSGin5G | | | | Server 2 and is left for | | | | implementation. | +-----------------------------+--------+-----------------------------+ | Messaging Topic (see NOTE | M | A list of Messaging | | 2) | | Topic(s) that is to be | | | | subscribed. The number of | | | | Messaging Topic(s) included | | | | in this IE can be one or | | | | more. | +-----------------------------+--------+-----------------------------+ | Expiration | O | The date and time when the | | | | subscription expires. | | | | | | | | This date and time apply to | | | | all Messaging Topic(s) | | | | subscribed in this request. | | | | | | | | If this IE is included, the | | | | value of it should be | | | | larger than 0. | | | | | | | | If this IE is not included, | | | | the expiration time is | | | | subject to operator policy. | +-----------------------------+--------+-----------------------------+ | NOTE 1: Only one of these | | | | IEs shall be included. | | | | | | | | NOTE 2: The content of the | | | | Messaging Topic is out of | | | | scope of 3GPP | | | | specifications. | | | +-----------------------------+--------+-----------------------------+
2\. Upon receiving the Messaging Topic subscription request, the MSGin5G
Server 2 validates this request and may verify the security credentials.
3\. The MSGin5G Server 2 handles the Originating UE Service ID/AS Service ID
or MSGin5G Server address included in the Messaging Topic subscription request
as the UE Service ID/AS Service ID included in Table 8.8.1-1.
#### 8.8.4.4 Messaging Topic Unsubscription between different MSGin5G Servers
If the MSGin5G Server 1 works in Mod.A (see clause 8.8.4.1), and upon
receiving a Messaging Topic unsubscription request from MSGin5G Client or
Application Server, and if the Messaging Topic is included in the Messaging
Topic list of MSGin5G Server 2, the MSGin5G Server 1 forwards the Messaging
Topic unsubscription request to MSGin5G Server 2. Otherwise, the MSGin5G
Server 1 handles the Messaging Topic unsubscription request as specified in
clause 8.8.1.
If the MSGin5G Server 1 works in Mod.B (see clause 8.8.4.1), it may also
unsubscribe one or more Messaging Topic(s) from the Messaging Topic list held
on MSGin5G Server 2 by using the procedure specified in clause 8.8.3 with the
clarification listed below.
The procedure for the Messaging Topic unsubscription for both Mod. A and Mod.
B. between MSGin5G Servers is as follows:
1\. The MSGin5G Server 1 includes the information elements listed in Table
8.8.4.4-1 instead of the information elements listed in Table 8.8.3-1.
Table 8.8.4.4-1: Messaging Topic unsubscription request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Originating UE Service | O | The service identity of the | | ID/AS Service ID (see NOTE | | sending MSGin5G Client or | | 1) | | the sending Application | | | | Server. | | | | | | | | This IE shall be included | | | | if MSGin5G Server 1 | | | | forwards Messaging Topic | | | | unsubscription request from | | | | the MSGin5G UE/Application | | | | Server served by it to | | | | MSGin5G Server 2. | +-----------------------------+--------+-----------------------------+ | MSGin5G Server address (see | O | The MSGin5G Server which | | NOTE 1) | | unsubscribes the Messaging | | | | Topic(s). | | | | | | | | This IE shall be included | | | | if MSGin5G Server 1 | | | | subscribe the Messaging | | | | Topic on behalf of all | | | | MSGin5G UE/Application | | | | Server served by it. | +-----------------------------+--------+-----------------------------+ | Security credentials | O | Security information | | | | required by the MSGin5G | | | | Server 2 and is left for | | | | implementation. | +-----------------------------+--------+-----------------------------+ | Messaging Topic | M | A list of Messaging | | | | Topic(s) that is to be | | | | unsubscribed. The number of | | | | Messaging Topic(s) included | | | | in this IE can be one or | | | | more. | +-----------------------------+--------+-----------------------------+ | NOTE 1: Only one of these | | | | IEs shall be included. | | | +-----------------------------+--------+-----------------------------+
2\. Upon receiving the Messaging Topic unsubscription request, the MSGin5G
Server 2 validates this request and may validate the security credentials.
3\. The MSGin5G Server 2 handles the Originating UE Service ID/AS Service ID
or MSGin5G Server address included in the Messaging Topic unsubscription
request as the UE Service ID/AS Service ID included in Table 8.8.3-1.
8.9 Usage of Network Capabilities
### 8.9.1 General
The present clause specifies the functionality leveraged by the MSGin5G
Service via Core Network exposure.
### 8.9.2 UE reachability status monitoring
#### 8.9.2.1 General
UE reachability status leverages the 3GPP network monitoring functionality
exposed via T8/N33 reference point detailed in 3GPP TS 23.502 [7] and TS
29.522[10]. How the MSGin5G Server determines whether and how (e.g., via
request/response or subscription) to monitor the UE reachability using the
3GPP Network capabilities is implementation dependent.
NOTE 1: Use of the UE reachability status monitoring procedure in the
application layer has no impact to how the Core Network delivers the message
to the UE.
NOTE 2: MSGin5G Service provider policies may indicate whether the UE
reachability status monitoring feature is enabled or not.
#### 8.9.2.2 Procedures
##### 8.9.2.2.1 Request-response
Figure 8.9.2.2.1-1 shows the procedure which may be used by the MSGin5G Server
to make a request for UE reachability status information.
Pre-conditions:
1\. A UE hosts an MSGin5G Client.
2\. The MSGin5G Client has registered with the MSGin5G Server and has shared
UE contact information.
3\. The MSGin5G Server has determined to subscribe for monitoring of UE
reachability events in the Core Network, e.g., that the UE is a sleepy node.
NOTE: How the MSGin5G Server determines to subscribe for monitoring of UE
reachability events in the Core Network is implementation dependent.
Figure 8.9.2.2.1-1: MSGin5G reachability status request-response.
1\. The MSGin5G Server sends a one-time Monitoring Request to the 3GPP Network
using SCEF/NEF capabilities.
The one-time Monitoring Request includes monitoring type set to
UE_REACHABILITY, Maximum Number of Reports of 1 and does not include the
Monitoring Duration IE.
2\. The 3GPP network processes the monitoring request and determines the
reachability status of the UE(s), as described in 3GPP TS 29.122 [9].
3\. If the Monitoring Request is successfully processed, a monitoring response
providing the UE(s) reachability status is sent to the MSGin5G Server. The
response may include idle mode information e.g., active time granted to the
UE, eDRX cycle length, periodic RAU/TAU timer., depending on the parameters
indicated in the request.
##### 8.9.2.2.2 Subscribe
Figure 8.9.2.2.2-1 shows the procedure which may be used by the MSGin5G Server
to subscribe for monitoring of UE reachability.
Pre-conditions:
1\. A UE hosts an MSGin5G Client.
2\. The MSGin5G Client has registered with the MSGin5G Server and has shared
UE contact information.
3\. The MSGin5G Server has determined to subscribe for monitoring of UE
reachability events in the Core Network, e.g., that the UE is a sleepy node.
NOTE: How the MSGin5G Server determines to subscribe for monitoring of UE
reachability events in the Core Network is implementation dependent.
Figure 8.9.2.2.2-1: MSGin5G reachability status subscribe.
1\. The MSGin5G Server sends a Monitoring Event Subscribe request to the 3GPP
Network using existing SCEF/NEF capabilities.
The Monitoring Event Subscribe is a Monitoring Request with monitoring type
set to UE_REACHABILITY, and either the Maximum Number of Reports greater than
1 or the Monitoring Duration IE are included.
3\. The 3GPP network processes the Monitoring Event Subscribe request as
described in 3GPP TS 29.122 [9].
4\. If the Monitoring Event Subscribe Request is successfully processed, a
response indicating the request was accepted is sent to the MSGin5G Server.
##### 8.9.2.2.3 Notify
Figure 8.9.2.2.3-1 shows the procedure which may be for updating MSGin5G
reachability status.
Pre-conditions:
1\. The MSGin5G Server has subscribed for reachability status monitoring for a
UE or group of UEs.
2\. The monitored UE(s) has transitioned to Connected Mode, Idle Mode or eDRX
paging occasion and the 3GPP Network Entities has detected the change in UE
reachability status.
Figure 8.9.2.2.3-1: MSGin5G reachability status notify.
1\. Based on the reachability status change of a monitored UE(s), the 3GPP
Network sends a Monitoring Notification message for UE reachability to the
MSGin5G Server as specified in 3GPP TS 29.122 [9].
The notification may include idle mode information e.g., active time granted
to the UE, eDRX cycle length, periodic RAU/TAU timer, depending on the
subscription.
2\. After receiving a UE Reachability monitoring notification, the MSGin5G
Server responds with an acknowledgement of the notification via SCEF/NEF.
3\. The MSGin5G Server uses the information provided in the UE reachability
monitoring event report to update its information on the UE\'s availability,
e.g., MSGin5G Client Availability information. The MSGin5G Server may provide
additional services based on reachability information, e.g., forward a stored
message.
##### 8.9.2.2.4 Unsubscribe
Figure 8.9.2.2.4-1 shows the procedure which may be used by the MSGin5G Server
to unsubscribe from monitoring of UE reachability.
Pre-conditions:
1\. The MSGin5G Server has subscribed for reachability status monitoring for a
UE or group of UEs.
2\. Later, the MSGin5G Server has determined to unsubscribe for monitoring of
UE reachability events in the Core Network,
NOTE 1: How the MSGin5G Server determines to subscribe or unsubscribe for
monitoring of UE reachability events in the Core Network is implementation
dependent.
NOTE 2: If the initial MSGin5G Server subscription for reachability status
monitoring reaches the Maximum Number of Reports or Monitoring Duration
indicated in the request, the 3GPP Network automatically deletes the
subscription and an explicit MSGin5G reachability status unsubscribe is not
necessary.
Figure 8.9.2.2.4-1: MSGin5G reachability status unsubscribe.
1\. The MSGin5G Server sends a Monitoring event unsubscribe request to the
3GPP Network using existing SCEF/NEF capabilities.
2\. The 3GPP network processes the Monitoring event unsubscribe request and
deletes the subscription, as described in 3GPP TS 29.122 [9].
3\. If the Monitoring event unsubscribe request is successfully processed, a
response indicating the subscription was deleted is sent to the MSGin5G Server
via SCEF/NEF.
#### 8.9.2.3 Flows
The following information flows are specified for UE reachability status
monitoring:
\- UE Reachability monitoring request and response;
\- UE Reachability monitoring subscribe and unsubscribe
\- UE Reachability monitoring notify
All UE reachability monitoring interactions from MSGin5G Server (acting as
SCS/AS) to SCEF/NEF occur over T8/N33 reference points capabilities detailed
in 3GPP TS 23.502 [7] and TS 29.522[10]. As specified in TS 29.522[10] clause
4.4.2, all UE Reachability monitoring procedures use APIs specified in TS
23.682 [8] clause 5.6.1.4 and 3GPP TS 29.122 [9] clause 4.4.2.2.
### 8.9.3 MSGin5G device triggering
#### 8.9.3.1 General
MSGin5G device triggering is the means by which an MSGin5G Server leverages
the 3GPP network device triggering capabilities, exposed via T8 /N33 reference
point, while attempting to deliver an MSGin5G message. For example, when an
Application Server initiates an MSGin5G message request, but the target
MSGin5G UE is not reachable, the MSGin5G Server may use the 3GPP network
device triggering mechanism to wake up the device and then deliver the payload
to the destination.
#### 8.9.3.2 Procedure
Figure 8.9.3.2-1 shows the MSGin5G device triggering procedure.
Pre-conditions:
1\. The target UE is an MSGin5G UE.
2\. The target MSGin5G Client is registered with the MSGin5G Server.
3\. At a later time, after the registration is completed, the MSGin5G UE has
become unreachable by the MSGin5G Server.
Figure 8.9.3.2-1: MSGin5G Triggering Procedure
1\. The MSGin5G Server receives a request for sending an MSGin5G message, the
request includes the IEs as detailed in clause 9.1.2.1.
2\. If the MSGin5G Server determines that the recipient MSGin5G Client is not
reachable, it initiates a device trigger request via the SCEF/NEF.
> To determine the reachability of the target MSGin5G UE, the MSGin5G Server
> may use the UE reachability status monitoring procedure in clause 8.9.2. The
> MSGin5G Server may also use availability information provided by the MSGin5G
> Client at registration in the MSGin5G Client Communication Availability IE,
> as detailed in Table 8.2.1-1.
NOTE 1: How the MSGin5G Server uses the MSGin5G Client Communication
Availability IE, the UE reachability status monitoring procedure, or a
combination thereof to make this determination is implementation specific.
NOTE 2: If the recipient MSGin5G Client is reachable then the trigger request
is not required, the MSGin5G Server sends the MSGin5G message as detailed in
clause 8.3.3 and the rest of the steps in this procedure are skipped.
> 3\. The MSGin5G Server sends a request for Device Triggering via SCEF/NEF
> and determines the flow as detailed in clause 8.9.3.2. The Device Triggering
> request uses the UE Identifier, port number(s) and associated protocol
> information provided by the MSGin5G Client at registration in the MSGin5G
> Client Triggering Information IE.
The MSGin5G Server may use MSGin5G Client Communication Availability and/or
pre-configured information to determine the timing of the Device Triggering
request, e.g. the trigger may be sent to ensure that the target UE is
reachable prior to resuming MSGin5G communications.
4\. The MSGin5G Server receives a response from SCEF/NEF indicating the
success or failure status of the request, as detailed in clause 8.9.3.3.
5\. The device trigger is delivered to the target via SCEF/NEF and the Core
Network. The targeted MSGin5G Client or Application Client receives the device
trigger request. The targeted MSGin5G Client or Application Client parses the
payload of the trigger request and determines the device trigger purpose. The
target UE becomes reachable, and the MSGin5G Client or Application Client
becomes available for further MSGin5G communications.
6\. The MSGin5G Server receives a Device Triggering delivery status report
from SCEF/NEF indicating the success of the delivery, as detailed in clause
8.9.3.3.
7\. The MSGin5G Server send a Device Triggering delivery status report
response to SCEF/NEF to acknowledge the delivery status report, as detailed in
clause 8.9.3.3.
Based on the trigger purpose derived from the payload, the targeted MSGin5G
Client performs the corresponding actions (e.g. establish access network
connectivity, contact the Application Server).
#### 8.9.3.3 Flows
The following information flows are specified for MSGin5G triggering:
1\. request for device triggering;
2\. response to device triggering;
3\. device triggering delivery report; and
4\. device triggering delivery report response.
All device triggering interactions from MSGin5G Server (acting as SCS/AS) to
SCEF/NEF occur over T8/N33 reference points, using capabilities detailed in
3GPP TS 23.502 [7] and TS 29.522[10]. As specified in TS 29.522[10] clause
4.4.3, all device triggering flows use APIs specified in TS 23.682 [8] clause
5.17.1 and 3GPP TS 29.122 [9] clause 4.4.6.
8.10 Usage of SEAL
### 8.10.1 General
The MSGin5G Service functional entities MSGin5G Client and MSGin5G Server
utilize the SEAL services. All SEAL services specified in 3GPP TS 23.434 [5]
are available to MSGin5G Service. In this clause, only the details of the
information flows, procedures and APIs whose utilization by MSGin5G Service
are well-known are described.
### 8.10.2 Configuration management service
#### 8.10.2.1 General
The MSGin5G Service functional entities MSGin5G Client and MSGin5G Server
utilize configuration management service procedures of SEAL to support MSGin5G
Service.
#### 8.10.2.2 Information flows
The following information flows of Configuration Management service are
applicable for the MSGin5G Service:
\- Get VAL UE configuration request specified in subclause 11.3.2.1 of 3GPP TS
23.434 [5];
\- Besides the IEs specified in subclause 11.3.2.1 of 3GPP TS 23.434 [5], the
information in table 8.10.2.2-1 is also included in the Get VAL UE
configuration request.
Table 8.10.2.2-1: Additional information in the Get VAL UE configuration
request
Information element Status Description
* * *
MSGin5G UE information O Other information needed by the configuration
procedure. (NOTE) NOTE: The information can be the device type, device Vendor,
etc. It is specified by application provider or MSGin5G Service provider and
is out of scope of this document. The MSGin5G Service provider can configure
the MSGin5G UE with different configuration data based on this IE. E.g. all
sensors can be configured to a same MSGin5G Server.
\- Get VAL UE configuration response specified in subclause 11.3.2.2 of 3GPP
TS 23.434 [5];
\- Besides the IEs specified in subclause 11.3.2.2 of 3GPP TS 23.434 [5], the
information in table 8.10.2.2-2 is also included in the Get VAL UE
configuration response.
Table 8.10.2.2-2: Additional information in the Get VAL UE configuration
response
Information element Status Description
* * *
UE service ID M MSGin5G Service ID assigned to the requesting MSGin5G UE.
MSGin5G Server address M The MSGin5G Server which serves this MSGin5G UE.
MSGin5G Service specified information O The specific information of the
MSGin5G Service specified by the MSGin5G Service provider. (NOTE) NOTE: E.g.
the segment size of MSGin5G message in this service provider, the detailed
definition is out of scope of this document.
The usage of the above information flows is clarified as below:
\- The VAL UE ID is the MSGin5G UE ID;
\- VAL service ID is the service identifier of the MSGin5G Service; and
\- VAL UE configuration data is the MSGin5G UE configuration data.
#### 8.10.2.3 Procedures
The following procedures of configuration management service are applicable
for the MSGin5G Service:
\- VAL UE configuration data specified in subclause 11.3.3 of 3GPP TS 23.434
[5].
### 8.10.3 Group management service
#### 8.10.3.1 General
The MSGin5G Service functional entities MSGin5G Client and MSGin5G Server
utilize SEAL Client and SEAL Server for the group management service (e.g.
creation, join, leave) on the group configuration information (e.g. group join
policy, group leader) provided by the MSGin5G Server. The decisions and
corresponding triggers (e.g. group creation, join, leave and deletion) for
group management are responsibility of the application leveraging MSGin5G
Service. The group management service of SEAL provides support for creating
group for MSGin5G Service for applications leveraging MSGin5G Service.
#### 8.10.3.2 Information flows
The information flows of group management procedures are specified in 3GPP TS
23.434 [5].
#### 8.10.3.3 Procedures
The following procedures of group management service of SEAL as specified in
3GPP TS 23.434 [5] are applicable for the MSGin5G Service:
\- Group creation specified in clause 10.3.3;
\-- Subsequent to Step 3, when the identity list with the list of VAL user IDs
or VAL UE IDs that are part of the created group contain the list of VAL user
IDs or VAL UE IDs which does not have group management client (e.g. Legacy
3GPP UEs, Non-3GPP UEs or Application Server), it is responsibility of the VAL
server (MSGin5G Server) to initiate the group creation notification towards
those UEs.
\- Group membership update specified in clause 10.3.5.2;.
\- Group configuration management specified in clause 10.3.6;
\- Location-based group creation specified in clause 10.3.7;
\- Group announcement and join specified in clause 10.3.8;
\- Group member leave specified in clause 10.3.9;
\- Temporary groups specified in clause 10.3.10;
\- Group deletion specified in clause 10.3.13.
NOTE: If the UE that is involved the Group management procedures does not have
group management client (e.g. Legacy 3GPP UEs, Non-3GPP UEs or Application
Server), it is responsibility of the VAL server (MSGin5G Server) to initiate
the necessary group management request/response towards SEAL Group Management
server on behalf of those UE. And if applicable, send and receive the
necessary group management request/response to/from those UEs.
#### 8.10.3.4 APIs
The following APIs of group management service of SEAL as specified in 3GPP TS
23.434 [5] are applicable for the MSGin5G Service:
\- SS_GroupManagement API specified in clause 10.4.2;
\- SS_Group_Management_Event API specified in clause 10.4.5.
## 8.11 Application Client resides different UE in MSGin5G Service
### 8.11.1 General
This clause specifies the procedures for an Application Client residing on a
different UE-2 than the UE with the MSGin5G Client (resides on MSGin5G UE-1)
to perform Application Client registration, to send messages and receive
messages using MSGin5G Client. The communication between Application Client
and MSGin5G Client is over MSGin5G-5 reference point.
NOTE: The procedure in this clause is also applicable to UE-2 that is out of
network coverage.
Editor\'s note: The API definition for the procedures defined in this clause
is FFS.
Editor\'s note: Whether the procedures in this clause are applicable to
Application Client within MSGin5G UE-1 is FFS.
### 8.11.2 Application Client registration using MSGin5G Client
The signalling flow for registration of Application Client on the UE-2 with
MSGin5G Client on MSGin5G UE-1 to use MSGin5G service is illustrated in figure
8.11.2-1.
Pre-conditions:
1\. The MSGin5G UE-1 is configured with information to recognize and authorize
UE-2.
2\. The Application Client on UE-2 has discovered or is configured that the
MSGin5G Client resides on MSGin5G UE-1 and can provide the MSGin5G service
capability to it.
3\. The UE-2 is using NR-PC5 to communicate with MSGin5G UE-1.
Figure 8.11.2-1: Registration of Application Client on UE-2 with MSGin5G
Client on MSGin5G UE-1
1) An Application Client on the UE-2 registers with MSGin5G Client-1 in
MSGin5G UE-1 to use MSGin5G service. The request message includes information
elements as specified in Table 8.11.2-1.
Table 8.11.2-1: Information elements for Registration to gateway UE request
Information element Status Description
* * *
Layer-2 ID M Layer-2 identity of UE-2 Application ID M Application ID of the
application client on UE-2 Credential information M UE-2 credential
information
Editor\'s note 1: The security parameters to include in the message between
UE-2 and MSGin5G UE-1 are FFS.
Editor\'s note 2: The alignment between the request/response name in clause
8.11.2/8.11.3 and the updated architecture is FFS.
2) Upon receiving the request from the Application Client, the MSGin5G Client
authorizes the Application Client on UE-2 to it for MSGin5G service. The
MSGin5G Client assigns a Registration ID and stores the mapping of the
Registration ID, Application ID and Layer-2 ID of the UE-2.
NOTE 1: The MSGin5G Client may reject the request for registration to use it
for MSGin5G service based on local condition (like available power or
connectivity to access network or any other reason outside the scope of 3GPP).
3) The MSGin5G Client sends a response to the Application Client. The response
message includes information elements as specified in Table 8.11.2-2.
Table 8.11.2-2: Information elements for Registration to gateway UE response
Information element Status Description
* * *
Result M Indicates success or failure of the request Registration ID O
Identifies registration. This IE is included only if Result IE is set to
success. Failure reason O Indicates failure reason. This IE is included only
if Result IE is set to failure.
NOTE 2: If the MSGin5G Client decided to reject the request for registration
or if authorization fails in step 2, the MSGin5G Client sends a failure
response to the Application Client. Otherwise, the MSGin5G Client sends a
success response to the Application Client.
NOTE 3: The MSGin5G Client may provide MSGin5G service capabilities for
multiple Application Clients, at the same time.
### 8.11.3 Application Client de-registration using MSGin5G Client
The signalling flow for deregistration of Application Client on the UE-2 with
MSGin5G Client-1 on MSGin5G UE-1 is illustrated in figure 8.11.3-1.
Pre-conditions:
1\. The Application Client on UE-2 is successfully registered with MSGin5G
Client on MSGin5G UE-1.
Figure 8.11.3-1: Deregistration of Application Client on UE-2 with MSGin5G
Client on MSGin5G UE-1
1) An Application Client on the UE-2 deregisters with MSGin5G Client in
MSGin5G UE-1 to discontinue usage of the MSGin5G Service. The request message
includes information elements as specified in Table 8.11.3-1.
Table 8.11.3-1: Information elements for Deregistration to gateway UE request
Information element Status Description
* * *
Registration ID M Identifies the registration Credential information M UE-2
credential information
2) Upon receiving the request from the Application Client, the MSGin5G Client
removes the mapping of Registration ID, Application ID and Layer-2 ID of the
UE-2. The MSGin5G Client sends a response to the Application Client on UE-2.
The response message includes the information elements as specified in Table
8.11.3-2.
Table 8.11.3-2: Information elements for Deregistration to gateway UE response
Information element Status Description
* * *
Result M Indicates success or failure of the request Failure reason O
Indicates failure reason. This IE is included only if the Result IE is set to
failure.
### 8.11.4 Application Client sending a message using MSGin5G Client on
another UE
The signalling flow for the Application Client on the UE-2 to send a message
using the MSGin5G Client on MSGin5G UE-1 is illustrated in figure 8.11.4-1.
Pre-conditions:
1\. The MSGin5G UE-1 is connected to an access network that provides
connectivity to the MSGin5G Server.
2\. The Application Client on UE-2 is successfully registered with MSGin5G
UE-1 to use MSGin5G service.
Figure 8.11.4-1: Application Client on UE-2 sends message using MSGin5G Client
on MSGin5G UE-1
1) An Application Client on the UE-2 sends a request to send MSGin5G message
to the MSGin5G Client. The information elements defined in Table 8.11.4-1 are
included in the message.
Table 8.11.4-1: Information elements for Request to send MSGin5G message
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Recipient UE Service ID or | O | The service identity of the | | AS Service ID (see NOTE) | | recipient. This IE is | | | | mandatory to initiate | | | | Point-to-Point messaging | | | | and Point-to-AS messaging. | +-----------------------------+--------+-----------------------------+ | Group Service ID (see NOTE) | O | The service identifier of | | | | the target MSGin5G Group. | | | | | | | | This IE is mandatory to | | | | initiate Group messaging. | +-----------------------------+--------+-----------------------------+ | Broadcast Area ID | O | The service identifier of | | | | the Broadcast Service Area | | (see NOTE) | | where the message needs to | | | | be broadcast. | | | | | | | | This IE is mandatory in the | | | | Broadcast Message. | +-----------------------------+--------+-----------------------------+ | Messaging Topic | O | Indicates which Messaging | | | | Topic this message is | | (see NOTE) | | related to. | | | | | | | | This IE is mandatory for a | | | | message distribution based | | | | on topic. | +-----------------------------+--------+-----------------------------+ | Application ID | O | Identifies the | | | | application(s) for which | | | | the payload is intended. | +-----------------------------+--------+-----------------------------+ | Payload | M | Payload of the message. | | | | | | | | MSGin5G Server/Client is | | | | unaware of the content. | +-----------------------------+--------+-----------------------------+ | Delivery status required | O | Indicates whether delivery | | | | status is required or not. | +-----------------------------+--------+-----------------------------+ | Priority type | O | Application priority level | | | | requested for this message | | | | as specified in Table | | | | 8.3.2-1. | +-----------------------------+--------+-----------------------------+ | NOTE: Only one occurrence | | | | shall be present of any of | | | | these IEs. | | | +-----------------------------+--------+-----------------------------+
Editor\'s note: If table 8.11.4-1 should be moved to separate clause to be
applicable for communication between any Application Client and any MSGin5G
Client is FFS.
2) Upon receiving the request from the Application Client in UE-2, the MSGin5G
Client constructs an MSGin5G message with the related IEs specified in table
8.3.2-1 and sends the MSGin5G message.
a) if the size of the received message exceeds the maximum allowed packet
size, the MSGin5G Client sends the message as specified in clause 8.5; or
b) If the size of the received message does not exceed the maximum allowed
packet size, the MSGin5G Client sends the message as specified in clause 8.7.;
or
c) If the size of the received message does not exceed the maximum allowed
packet size, the MSGin5G Client may apply message aggregation as specified in
clause 8.4 before sending the message as specified in clause 8.7.
NOTE 1: The MSGin5G Client may also reject the request to send the MSGin5G
message based on local condition (like available power or connectivity to
access network or any other reason outside the scope of 3GPP).
3) The MSGin5G Client sends a response to Application Client on UE-2. The
response message includes the information elements as specified in Table
8.11.4-2.
Table 8.11.4-2: Information elements for Response to send MSGin5G message
Information element Status Description
* * *
UE Service ID or AS Service ID or Group Service ID or Broadcast Area ID or
Message Topic M The service identifier that the message is sent Result M
Indicates success or failure of the request Failure reason O Indicates failure
reason. This IE is included only if Result IE is set to failure.
NOTE 2: If the MSGin5G Client has decided to reject the request to send the
message or the MSGin5G Client received a reject response from the MSGin5G
Server in step 2, the MSGin5G Client sends a failure response to the
Application Client and stops performing further steps.
4) If delivery status is requested in the message in step 1, the MSGin5G
Client may receive MSGin5G message delivery status report from the MSGin5G
Server.
5) Upon receiving the MSGin5G message delivery status report, the MSGin5G
Client sends the message delivery status report to the Application Client on
UE-2. The message delivery status report includes information elements as
specified in Table 8.11.4-3.
Table 8.11.4-3: Information elements for MSGin5G message delivery status
Information element Status Description
* * *
UE Service ID or AS Service ID M The service identifier that sends the message
delivery status Delivery status M Indicates delivery status
### 8.11.5 Application Client receiving message via MSGin5G Client on another
UE
The signalling flow for an Application Client on the UE-2 to receive a message
using the MSGin5G Client on MSGin5G UE-1 is illustrated in figure 8.11.5-1.
Pre-conditions:
1\. The MSGin5G UE-1 is connected to an access network that provides
connectivity to the MSGin5G Server.
2\. The Application Client on UE-2 is successfully registered with MSGin5G
UE-1 to use MSGin5G service.
Figure 8.11.5-1: Application Client on UE-2 receives message using MSGin5G
Client on MSGin5G UEâ€‘1
1) The MSGin5G Client receives an MSGin5G message as specified in clause 8.3.3
for the Application Client on UE-2. The MSGin5G Client performs reassembly if
the received message is part of a segmented message and waits till the whole
message is received. The MSGin5G Client may also perform the segment recovery
procedure as specified in clause 8.5.4 to recover missing segments.
2) Upon successfully receiving a message for the Application Client on UE-2,
the MSGin5G Client sends a message received request to the Application Client
based on the Application ID in the received message. The message includes
information elements as specified in Table 8.11.5-1.
Table 8.11.5-1: Information elements for Message received request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | Recipient UE Service ID/AS | O | The service identifier of | | Service ID (see NOTE) | | the originator. This IE is | | | | mandatory for | | | | Point-to-Point messaging | | | | and AS-to-Point messaging. | +-----------------------------+--------+-----------------------------+ | Group Service ID (see NOTE) | O | The service identifier of | | | | the MSGin5G Group | | | | | | | | This IE is mandatory for | | | | Group Message. | +-----------------------------+--------+-----------------------------+ | Messaging Topic | O | Indicates the Topic for | | | | which the message is | | (see NOTE) | | received. This IE is | | | | mandatory for a Topic | | | | Message. | +-----------------------------+--------+-----------------------------+ | Payload | M | Payload of the message. | | | | | | | | MSGin5G Server/Client is | | | | unaware of the content. | +-----------------------------+--------+-----------------------------+ | Delivery status required | O | Indicates whether delivery | | | | status is required or not | +-----------------------------+--------+-----------------------------+ | Priority type | O | Application priority level | | | | requested for this message | | | | as specified in Table | | | | 8.3.2-1. | +-----------------------------+--------+-----------------------------+ | NOTE: Only one occurrence | | | | shall be present of any of | | | | these IEs. | | | +-----------------------------+--------+-----------------------------+
3) Upon successfully receiving the message, the Application Client on UE-2
sends the message received response to the MSGin5G Client.
4) If delivery status is requested in the received message, the Application
Client on UE-2 sends the message delivery status to the MSGin5G Client.
5) Upon receiving the delivery status, the MSGin5G Client constructs the
MSGin5G message delivery status report as specified in table 8.3.4-1 and sends
it to the MSGin5G Server.
# 9 APIs and related information flows
## 9.1 APIs provided by MSGin5G Server
### 9.1.1 Mm5s APIs
#### 9.1.1.1 M5S_AS_Originating_Message_Delivery API
##### 9.1.1.1.1 General
**API description:** This API enables the Application Server to send MSGin5G
message to the MSGin5G Server.
##### 9.1.1.1.2 Send_MSGin5G_Message operation
**API operation name:** Send_MSGin5G_Message
**Description:** Send an MSGin5G message to MSGin5G Server.
**Known Consumers:** Application Server
**Inputs:** Refer subclause 9.1.2.1
**Outputs:** Refer subclause 8.3.2
See subclause 8.3.2 for the details of usage of this API operation.
#### 9.1.1.2 M5S_UE_Originating_Message_Delivery API
##### 9.1.1.2.1 General
**API description:** This API enables the Message Gateway or other 5GS
Function to deliver MSGin5G message to the MSGin5G Server.
##### 9.1.1.2.2 Send_ MSGin5G_Message operation
**API operation name:** Send_MSGin5G_Message
**Description:** Send an MSGin5G message to MSGin5G Server.
**Known Consumers:** L3G, N3G.
**Inputs:** Refer subclause 8.3.2
**Outputs:** Refer subclause 8.3.2
See subclause 8.3.2 for the details of usage of this API operation.
#### 9.1.1.3 M5S_AS_Originating_Delivery_Status_Report API
##### 9.1.1.3.1 General
**API description:** This API enables the Application Server to delivery
MSGin5G message delivery status report to the MSGin5G Server.
##### 9.1.1.3.2 Report_Message_Delivery_Status operation
**API operation name:** Report_Message_Delivery_Status
**Description:** Send an MSGin5G message delivery status report to MSGin5G
Server.
**Known Consumers:** Application Server
**Inputs:** Refer subclause 9.1.2.2
**Outputs:** Refer subclause 8.3.4
See subclause 8.3.4 for the details of usage of this API operation.
#### 9.1.1.4 M5S_Delivery_Status_Report API
##### 9.1.1.4.1 General
**API description:** This API enables the Message Gateway to deliver MSGin5G
message delivery status reports to the MSGin5G Server.
##### 9.1.1.4.2 Report_Message_Delivery_Status operation
**API operation name:** Report_Message_Delivery_Status
**Description:** Send an MSGin5G message delivery status report to MSGin5G
Server.
**Known Consumers:** L3G, N3G, BMG.
**Inputs:** Refer subclause 8.3.4
**Outputs:** Refer subclause 8.3.4
See subclause 8.3.4 for the details of usage of this API operation.
#### 9.1.1.5 M5S_AS_Registration API
##### 9.1.1.5.1 General
**API description:** This API enables the Application Server to register to
MSGin5G Server.
##### 9.1.1.5.2 Registration operation
**API operation name:** Registration
**Description:** Do registration or update registration to an MSGin5G Server,
by using this API, the Application Server provides/updates its information,
including the URL used for the message delivery from MSGin5G Server to
Application Server.
**Known Consumers:** Application Server
**Inputs:** Refer subclause 9.1.2.3
**Outputs:** Refer subclause 9.1.2.4
##### 9.1.1.5.3 Deregistration operation
**API operation name:** Send_MSGin5G_Message
**Description:** Do deregistration with an MSGin5G Server.
**Known Consumers:** Application Server
**Inputs:** Refer subclause 9.1.2.5
**Outputs:** Refer subclause 9.1.2.6
#### 9.1.1.6 M5S_Topiclist_Event API
##### 9.1.1.6.1 General
**API description:** This API enables another MSGin5G Server to communicate
with the MSGin5G Server to subscribe and receive subsequent notification
events of the Messaging Topic list and information of specific message topics
on the MSGin5G Server.
##### 9.1.1.6.2 Subscribe Messaging Topiclist operation
**API operation name:** Subscribe_Messaging_Topiclist
**Description:** Subscribing to changes to Messaging Topic list on the MSGin5G
Server.
**Known Consumers:** MSGin5G Server
**Inputs:** Refer subclause 8.8.4.2
**Outputs:** Refer subclause 8.8.4.2
See subclause 8.8.4.2 for the details of usage of this API operation
##### 9.1.1.6.3 Notify Messaging Topiclist operation
**API operation name:** Notify_Messaging_Topiclist
**Description:** Notification for changes to Messaging Topic list on the
MSGin5G Server.
**Known Consumers:** MSGin5G Server
**Inputs:** Refer subclause 8.8.4.2
**Outputs:** Refer subclause 8.8.4.2
See subclause 8.8.4.2 for the details of usage of this API operation
##### 9.1.1.6.4 Subscribe Messaging Topic operation
**API operation name:** Subscribe_Messaging_Topic
**Description:** Subscribing to changes to one or more specific Messaging
Topic(s) on the MSGin5G Server.
**Known Consumers:** MSGin5G Server
**Inputs:** Refer subclause 8.8.4.3
**Outputs:** Refer subclause 8.8.4.3
See subclause 8.8.4.3 for the details of usage of this API operation
##### 9.1.1.6.5 Notify Messaging Topic operation
**API operation name:** Notify_Messaging_Topic
**Description:** Notification for changes to one or more specific Messaging
Topic(s) on the MSGin5G Server.
**Known Consumers:** MSGin5G Server
**Inputs:** Refer subclause 8.8.4.3
**Outputs:** Refer subclause 8.8.4.3
See subclause 8.8.4.3 for the details of usage of this API operation
### 9.1.2 Mm5s Information flows
#### 9.1.2.1 M5S Application Server originating message send request
The information flows from the Application Server to the MSGin5G Server for
message delivery includes the IEs in table 8.3.2-1. Additionally, the
following information in table 9.1.2.1-2 elements needs to be included:
Table 9.1.2.1-2: M5S Northbound Message Delivery Send request
Information element Status Description
* * *
Latency O The latency requirement for the message. Authorization Information O
The authorization information used to determine whether the Application Server
is allowed to send the message
#### 9.1.2.2 M5S Application Server originating message delivery status report
request
The information flows from the Application Server to the MSGin5G Server for
message delivery status report includes the IE in table 8.3.4-1, and the
following information in table 9.1.2.2-1 elements needs to be included:
Table 9.1.2.2-1: M5S Northbound Message Delivery Send request
Information element Status Description
* * *
Authorization Information O The authorization information used to determine
whether the Application Server is allowed to send the message
#### 9.1.2.3 M5S Application Server registration request
The information flows from the Application Server to the MSGin5G Server for
registration request includes the information elements in Table 9.1.2.3-1.
Table 9.1.2.3-1: Application Server Registration request
+-----------------------------+--------+-----------------------------+ | Information element | Status | Description | +=============================+========+=============================+ | AS service ID | M | The MSGin5G identifier of | | | | the Application Server. | | | | | | | | This ID is configured | | | | before registration. | +-----------------------------+--------+-----------------------------+ | Application ID | O | The identifier of the | | | | application specified by | | | | the application provider. | +-----------------------------+--------+-----------------------------+ | Authorization Information | O | The authorization | | | | information used to | | | | determine whether the | | | | Application Server is | | | | allowed to send the message | +-----------------------------+--------+-----------------------------+ | Notification target URI | O | The URL for receiving | | | | message, message delivery | | | | status report. The MSGin5G | | | | Server uses this URL to | | | | interact to Application | | | | Server. | +-----------------------------+--------+-----------------------------+ | Application Profile (NOTE) | O | The elements in Application | | | | Profile include the | | | | information of the | | | | Application Server, e.g. | | | | application name, | | | | application provider, | | | | application scenario | | | | description, application | | | | category. | | | | | | | | This IE is used by MSGin5G | | | | Server to compare with | | | | application client | | | | information. | +-----------------------------+--------+-----------------------------+ | NOTE: The detailed | | | | definition of Application | | | | Profile is out of scope of | | | | this document. | | | +-----------------------------+--------+-----------------------------+
#### 9.1.2.4 M5S Application Server registration response
The information flows from the MSGin5G Server to the Application Server for
registration response includes the information elements in Table 9.1.2.4-1.
Table 9.1.2.4-1: Application Server registration response
Information element Status Description
* * *
AS service ID M The MSGin5G identifier of the Application Server. Registration
result M Indication if the registration is success or failure
Editor\'s note: Whether other information may be included in the Application
Server registration response is FFS.
#### 9.1.2.5 M5S Application Server de-registration request
The information flows from the Application Server to the MSGin5G Server for
de-registration request includes the information elements in Table 9.1.2.5-1.
Table 9.1.2.5-1: Application Server de-registration request
Information element Status Description
* * *
AS service ID M The MSGin5G identifier of the Application Server.
#### 9.1.2.6 M5S Application Server de-registration response
The information flows from the MSGin5G Server to the Application Server for
de-registration response includes the information elements in Table 9.1.2.6-1.
Table 9.1.2.6-1: Application Server de-registration response
Information element Status Description
* * *
AS service ID M The MSGin5G identifier of the Application Server. De-
registration result M Indication if the de-registration is success or failure
## 9.2 APIs provided by Message Gateway
### 9.2.1 Ml3g APIs
#### 9.2.1.1 L3G_Message_Delivery API
##### 9.2.1.1.1 General
**API description:** This API enables the MSGin5G Server to deliver MSGin5G
message to the Legacy 3GPP Message Gateway.
##### 9.2.1.1.2 Send_Message operation
**API operation name:** Send_MSGin5G_Message
**Description:** Send an MSGin5G message to Legacy 3GPP Message Gateway.
**Known Consumers:** M5S.
**Inputs:** Refer subclause 8.3.3
**Outputs:** Refer subclause 8.3.3
See subclause 8.3.3 for the details of usage of this API operation.
#### 9.2.1.2 L3G_Delivery_Status_Report API
##### 9.2.1.2.1 General
**API description:** This API enables the MSGin5G Server to deliver a Delivery
Status Report to the Legacy 3GPP Message Gateway.
##### 9.2.1.2.2 Report_Message_Delivery_Status operation
**API operation name:** Report_Message_Delivery_Status
**Description:** Send an MSGin5G message delivery status report to Legacy 3GPP
Message Gateway.
**Known Consumers:** M5S.
**Inputs:** Refer subclause 8.3.5
**Outputs:** Refer subclause 8.3.5
See subclause 8.3.5 for the details of usage of this API operation.
### 9.2.2 Mn3g APIs
#### 9.2.2.1 N3G_Message_Delivery API
##### 9.2.2.1.1 General
**API description:** This API enables the MSGin5G Server to deliver MSGin5G
message to the Non-3GPP Message Gateway.
##### 9.2.2.1.2 Send_Message operation
**API operation name:** Create_MSGin5G_Message
**Description:** Send an MSGin5G message to Non-3GPP Message Gateway.
**Known Consumers:** M5S.
**Inputs:** Refer subclause 8.3.3
**Outputs:** Refer subclause 8.3.3
See subclause 8.3.3 for the details of usage of this API operation.
#### 9.2.2.2 N3G_Delivery_Status_Report API
##### 9.2.2.2.1 General
**API description:** This API enables the MSGin5G Server to deliver a Delivery
Status Report to the Non-3GPP Message Gateway.
##### 9.2.2.2.2 Report_Message_Delivery_Status operation
**API operation name:** Report_Message_Delivery_Status
**Description:** Send an MSGin5G message delivery status report to Non-3GPP
Message Gateway.
**Known Consumers:** M5S.
**Inputs:** Refer subclause 8.3.5
**Outputs:** Refer subclause 8.3.5
See subclause 8.3.5 for the details of usage of this API operation.
### 9.2.3 Mbg APIs
#### 9.2.3.1 Nbg_Message_Delivery API
##### 9.2.3.1.1 General
**API description:** This API enables the MSGin5G Server to deliver MSGin5G
messages to the Broadcast Message Gateway.
##### 9.2.3.1.2 Send_Message operation
**API operation name:** Create_MSGin5G_Message
**Description:** Send an MSGin5G message to Broadcast Message Gateway.
**Known Consumers:** M5S.
**Inputs:** Refer subclause 8.3.3
**Outputs:** Refer subclause 8.3.3
See subclause 8.3.3 for the details of usage of this API operation.
# 10 Information Elements
## 10.1 Payload
The _Payload_ Information Element carries the application payload that is
transferred by the MSGin5G Service, of which the content is transparent to the
MSGin5G Service.
If the message originates from an MSGin5G UE, the _Payload_ IE is a string of
maximum length that can be transported without segmentation but not more than
2048 octets.
## 10.2 Application ID
The _Application ID_ Information Element identifies the Application Client on
the UE or in the Application Server.
The _Application ID_ is a string, which shall allow identifying 65535
different Application Clients. The _Application ID_ is configured or
provisioned in the Application Client or the Application Server.
## 10.3 Messaging Topic
The _Messaging Topic_ Information Element indicates the topic of the message,
which an interested UE or Application Server can subscribe to.
The _Messaging Topic_ IE is a string, which shall allow identiying 65535
different Messaging Topics. Allocating and populating the _Messaging Topic_ IE
is done by the Application Client or the Application Server.
## 10.4 Broadcast Area ID
The _Broadcast Area ID_ Information Element identifies the service area where
the Broadcast Message will be delivered.
The _Broadcast Area ID_ IE is a string, which shall allow identiying 65535
different Broadcast Areas. The _Broadcast Area ID_ is provisioned on the
Application Client or the Application Server and is mapped by the Broadcast
Message Gateway onto the Broadcast Area as used by the broadcast service in
the 5GC.
## 10.5 Message ID
The _Message ID_ Information Element uniquely identifies a specific MSGin5G
message in the MSGin5G Service. If message delivery status report is requested
by an MSGin5G message, the Message ID IE in this MSGin5G message is used by
the sender of the MSGin5G message to match the message delivery status report
with the original MSGin5G message. It is also used by the MSGin5G Server in
aggregating the message delivery status report message delivery status
reports.
The _Message ID_ shall be unique within the MSGin5G Service and shall be
generated by the sender of a new message.
## 10.6 Failure Cause
The Failure Cause Information Element indicates the the failure reason of an
MSGin5G message, if this MSGin5G message can not be delivered successfully.
The Failure Cause IE is a string, which shall allow identiying 65535 different
failure reasons.
# 11 Deployment models
## 11.1 General
This clause describes deployments of the functional model specified in clause
5.
## 11.2 Deployment of MSGin5G server(s)
The MSGin5G server(s) should be deployed in the PLMN operator domain. The VAL
service using MSGin5G service for the message delivery acts as Application
Server and interacts with MSGin5G Server via MSGin5G-3 reference point. The
MSGin5G server(s) connects with the 3GPP network system in one or more PLMN
operator domain. The MSGin5G server(s) may be supporting multiple Application
Servers.
Figure 11.2-1 illustrates the deployment of multiple MSGin5G Servers in a
single PLMN operator domain. Each MSGin5G Server serves a part of MSGin5G
service subscribers (including the subscriber using the MSGin5G UE or Non-
MSGin5G UE) in this PLMN operator domain. In this deployment, the MSGin5G
Servers shall be connected with each other to provide the MSGin5G service to
all MSGin5G service subscribers in the PLMN operator domain. The MSGin5G
Servers provide MSGin5G service to the Application Server(s) deployed in the
VAL service provider domain. The Application Server may be connected and
registered to one MSGin5G Server.
Figure 11.2-1: MSGin5G Server(s) deployed in a single PLMN operator domain
with interconnection between MSGin5G Server(s)
Figure 11.2-2 illustrates the deployment of MSGin5G Servers in multiple PLMN
operator domains. Each MSGin5G Server serves the MSGin5G service subscribers
in this PLMN operator domain. In this deployment, the MSGin5G Servers deployed
in PLMN operator domain 1 may be connected with the MSGin5G deployed in PLMN
operator domain 2 to provide the MSGin5G service interconnection based on the
business agreement between PLMN operator 1 and PLMN operator 2.
Figure 11.2-2: MSGin5G Server(s) deployed in multiple PLMN operator domain
with interconnection between MSGin5G Server(s)
Editor\'s note: Whether MSGin5G Server can be deployed in EDN to fulfill the
delay requirement specified in [R-5.1.2-001] of 3GPP TS 22.262 [2] is FFS.
## 11.3 Deployment of Message Gateway(s)
Figure 11.3-1 illustrates the deployment of Message Gateway in a single PLMN
operator domain. If only one Message Gateway, i.e. Message Gateway 1 in Figure
11.3-1, is deployed, all MSGin5G Servers in this PLMN domain may connected to
a single Message Gateway to provide the MSGin5G service for the Non-MSGin5G
UEs. Multiple Message Gateways may also be deployed in a single PLMN operator
domain. In this deployment, i.e. Message Gateway 1 and Message Gateway 2 in
Figure 11.3-1 are deployed, each Message Gateway is used to provide MSGin5G
service for a part of MSGin5G service subscribers in this PLMN operator
domain.
NOTE: The relationship between MSGin5G service subscribers served by the
MSGin5G Server and Message Gateway, e.g. whether all MSGin5G service
subscribers served by MSGin5G Server 1 use Message Gateway 1 or some of them
use Message Gateway 1 and some of them use Message Gateway 2, is
implementation specific.
Figure 11.3-1: deployment of Message Gateway in a single PLMN operator domain
Figure 11.3-2 illustrates the deployment of Message Gateway in multipl PLMN
operator domains. The MSGin5G Server(s) in one PLMN domain are only connected
the Message Gateway(s) in the same PLMN operator domain to provide the MSGin5G
service for the Non-MSGin5G UEs served by this PLMN operator.
Figure 11.3-2: deployment of Message Gateway in multipl PLMN operator domains
## 11.4 Deployment of MSGin5G Server(s) and SEAL server(s)
If an MSGin5G Server interacts with SEAL Servers over the SEAL-S reference
point specified for each SEAL service, i.e. the SEAL Server are not collocated
in the MSGin5G Server, the application of functional model to deployments of
SEAL servers specified in 3GPP TS 23.434 [5] applied. In the deployment,
MSGin5G acts as the VAL servers specified in 3GPP TS 23.434 [5], but may be
deployed in the PLMN operator domain.
#
# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, certain modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
NOTE 1: The constructions \"shall\" and \"shall not\" are confined to the
context of normative provisions, and do not appear in Technical Reports.
NOTE 2: The constructions \"must\" and \"must not\" are not used as
substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as
possible, and they are not used in a normative context except in a direct
citation from an external, referenced, non-3GPP document, or so as to maintain
continuity of style when extending or modifying the provisions of such a
referenced document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
NOTE 3: The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
NOTE 4: The constructions \"can\" and \"cannot\" shall not to be used as
substitutes for \"may\" and \"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
NOTE 5: The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The Technical Report studies and performs evaluations of potential
architecture enhancements to enhance the support of Wireline-Wireless
convergence in the 5G Core network (5GC). Specifically, two objectives are
included:
\- **Work task #2:** Whether and how to improve the support of devices
connecting behind 5G-RG including:
Providing differentiated service (e.g. QoS and charging) for UE and Non-3GPP
devices connected behind a 5G RG. This may imply s studying ways for 5GC to
identify Non-3GPP devices connected behind a 5G RG and/or their traffic.
Conclusions may differ for UE and for Non-3GPP devices.
\- **Work task #3:** Trusted/untrusted Non-3GPP access network: How to select
a TNGF/N3IWF that supports the S-NSSAI(s) needed by the UE.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G system, Stage 2\".
[4] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System\".
[5] 3GPP TS 23.316: \"Wireless and wireline convergence access support for the
5G System (5GS)\".
[6] WiFi Alliance Technical Committee, Hotspot 2.0 Technical Task Group:
\"Hotspot 2.0 (Release 2) Technical Specification\".
[7] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[8] 3GPP TS 24.502: \"Access to the 3GPP 5G Core Network (5GCN) via non-3GPP
access networks\".
[9] 3GPP TS 33.501: \"Security architecture and procedures for 5G System\".
[10] 3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS): Stage
3\".
[11] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[12] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[13] 3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\".
[14] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1], in
TS 23.501 [2] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1] or in TS 23.501 [2].
**Authenticable Non-3GPP (AUN3) devices:** A Non-3GPP device that the 5GC can
authenticate.
**Non Authenticable Non-3GPP (NAUN3) devices:** A Non-3GPP device that the 5GC
cannot authenticate.
**Non-3GPP devices:** A device that use Non-3GPP access technology to connect
to the RG and does not support NAS over non 3GPP access.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], in TS 23.501 [2] and the following apply. An abbreviation defined in the
present document takes precedence over the definition of the same
abbreviation, if any, in TR 21.905 [1] or in TS 23.501 [2].
# 4 Architectural Assumptions and Principles
For all objectives, the architectural assumptions and principles include:
1\. The architecture of 5WWC (for Wireline, Trusted and Untrusted access to
5GC) as defined in TS 23.501 [2] and TS 23.316 [5] shall be used as a
baseline,
2\. The support of S-NSSAIs as defined in TEI17_N3SLICE shall be taken as
baseline,
3\. Before a solution that impacts the 5G RG or the wireline access network is
selected, this solution shall be evaluated by BBF and/or CableLabs.
# 5 Key Issues
## 5.1 Key Issue #1: Providing differentiated service for UE and Non-3GPP
devices connected behind a 5G RG
### 5.1.1 Description
This key issue will study:
\- How to support differentiated services (e.g. QoS and charging) for the same
and different Non-3GPP devices, and UEs connected behind a 5G-RG.
NOTE 1: A device capable of access to a N3IWF or to a TNGF is a UE; Non-3GPP
devices can correspond to either AUN3 devices or NAUN3 devices defined in
clause 3.1.
NOTE 2: The definitions in the clause 3.1 are considered as indication of
kinds of Non-3GPP devices to be considered, but each solution may propose
alternative kinds of devices with relative definition, if needed.
This may imply studying ways for 5GC to identify Non-3GPP devices connected
behind a 5G RG and/or their traffic.
Conclusions to this key issue may differ for UE and for Non-3GPP devices.
Different solutions may address different kinds of Non-3GPP devices, but as
conclusion of this KI the kinds of Non-3GPP devices with related definitions
considered applicable for the normative work will be selected.
This Key Issue will focus on 5G-RG as a first priority; No solution specific
only to FN RG can be proposed, but common solutions for 5G RG and FN RG can be
proposed.
## 5.2 Key Issue #2: How to select a TNGF/N3IWF that supports the S-NSSAI(s)
needed by the UE
### 5.2.1 Description
As part of TEI17_N3SLICE it has not been possible to work on How to select a
TNGF/N3IWF that supports the S-NSSAI(s) requested by the UE during
registration via non-3GPP access network because TEI17_N3SLICE had the
constraint not to impact the UE.
The key issue will study solutions allowing to select a TNGF/N3IWF that
supports the S-NSSAI(s) needed by the UE.
Work on this KI may address roaming; Network (e.g. PLMN) selection shall not
be impacted by solutions to this KI.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
Solutions KI1 KI2
* * *
Solution 1: N3GPP device behind 5G-RG X  
Solution 2: UE behind 5G-RG and FN-RG X  
Solution 3: Differentiated QoS for N5CW devices behind 5G-RG X  
Solution 4: Solution of providing differentiated service for Non-3GPP devices
connected behind a 5G-RG X  
Solution 5: 5GC-capable UE behind 5G-RG using trusted Non-3GPP access X  
Solution 6: New method for non-3GPP device connected behind a 5G-RG X  
Solution 7: Differentiated QoS for non-3GPP devices behind 5G-RG X  
Solution 8 - Support of \"combo Ethernet + IP\" service X  
Solution 9: 5GC-capable UE behind 5G-RG using untrusted Non-3GPP access X  
Solution 10: Registration via Trusted Non-3GPP Access with TNGF Relocation X
Solution 11: Registration via Untrusted Non-3GPP Access with N3IWF Relocation
X Solution 12: slice related TNGF selection for WLAN access X Solution 13 : UE
getting the slices supported by N3IWF (s) X Solution 14: use of AN NRF X
Solution 15: Selecting N3IWF supporting the S-NSSAI needed by UE X Solution
16: N3IWF selection taking supported slices into account X Solution 17:
Untrusted Non-3GPP Access with N3IWF/TNGF Relocation due to network slicing X
Solution 18: ANDSP based solution for slice related TNGF selection X Solution
19: Selecting TNGF supporting the S-NSSAI needed by UE X Solution 20:
providing differentiated service for UE and non-3GPP devices connected behind
a 5G-RG X  
Solution 21: Non-3GPP device behind 5G-RG based on 5GS exposure X  
Solution 22: Support differentiated QoS for AUN3 devices X  
Solution 23: Delay budget for non-3GPP devices behind 5G-RG X  
Solution 24: Differentiated QoS for Non-Authenticable non-3GPP devices behind
RG X  
Solution 25: Differentiated QoS for Authenticable non-3GPP devices behind RG.
X
## 6.1 Solution 1: N3GPP device behind 5G-RG
### 6.1.1 Description
#### 6.1.1.1 Overall architecture
This solution addresses KI#1 and describes a solution for how to provide
differentiated service (e.g. QoS and charging) for Non-3GPP devices connected
behind a 5G RG.
The N3GPP devices are locally authenticated by the 5G-RG using such as pre-
shared secret etc. As such, it is invisible to the 5G network though 5G-RG is
subscribed to the 5G-Core. Differentiated QoS can still be provided by using
local configuration in the 5G-RG and based on DNN / S-NSSAI for the 5G RG\'s
PDU Sessions.
This solution allows for traffic segregation on both PDU session / S-NSSAI and
per QoS flow basis. We assume that, when it is per PDU session basis, the
default QoS associated with the PDU session can be different based on the DNN
and S-NSSAI. 5G-RG can set up distinct PDU Session for each N3GPP device or a
group of N3GPP devices based on local configuration in the 5G-RG. For e.g.
consider admin settings on the 5G-RG where the admin can group N3GPP devices
based on mac addresses and set different QoS levels/priority levels for a
group of N3GPP devices. Based on these local configurations the 5G-RG can
provide distinct PDU session for each N3GPP device. When these devices have
common QoS sessions and DNN / S-NSSAI to be served then, these devices are
classified into \"connectivity groups\" where each group connects to the 5G-RG
using a separate physical or virtual port. These ports could for e.g. refer to
a separate physical Ethernet ports and/or a separate WLAN SSIDs and the groups
may also be separated on the LAN behind the RG using VLANs.
Each physical/virtual port (connectivity group) is then mapped to a separate
PDU Session that is established by the 5G-RG based on existing procedures
defined in TS 23.316 [5]. The overall architecture is illustrated in Figure
6.1.1-1. Only the case where 5G-RG connects via wireline access is shown in
the Figure. The 5G-RG may also connect via 3GPP access (not shown).
Figure 6.1.1-1: Example scenario for Non-3GPP devices behind 5G-RG based on
connectivity groups
The 5G-RG is configured with the (virtual) port information (e.g. VLANs and
SSIDs) based on TR-69, TR-360 and TR-181. URSP rules can be provided to the RG
to indicate what PDU Sessions to establish (DNN, S-NSSAI etc). Alternatively,
the 5GRG can be manually configured by the admin to form the connectivity
groups.
The cross-connect between virtual ports and DNN/S-NSSAI can be configured
using URSP and TR-69/TR-181. In case of URSP, VLAN IDs and Connection
Capabilities can be used as Traffic Descriptors, assuming that the 5G-RG has a
corresponding configuration of virtual ports with the same VLAN IDs or
Connection Capabilities. It is also possible for operators to define its own
set of Connection Capabilities applicable to 5WWC scenarios using the operator
specific value range defined by CT WG1.
In addition, it is assumed that the cross-connect between a \"virtual port\"
and DNN/S-NSSAI can be configured via TR-69/TR-181 (to be verified with BBF).
It is assumed that the non-3GPP devices are manually configured to use a
specific SSID or connect to a certain Ethernet port on the 5G-RG. No new 5GS
mechanism is added to enforce or authorize a specific non-3GPP device to
access a certain SSID or port on the RG. It is assumed that the end-users of
the local network provisions only authorized devices with the required Wi-Fi
credentials and ensures that only authorized devices connect to physical
ports. MAC address filters may be installed on the 5G-RG for each logical port
to ensure that only devices with certain MAC addresses can connect to each
logical port on the 5G-RG.
#### 6.1.1.2 Support for differentiation of e.g. charging and QoS
The connectivity groups are fully separated from each other and
differentiation of charging and QoS is provided via existing mechanisms. The
solution also allows isolation of the connectivity groups into separate
network slices, i.e. with separate N-SSAIs for each PDU Session.
Differentiated charging for sectors/departments can be enabled by assigning
separate DNNs/N-SSAIs to them.
### 6.1.2 Procedures
The procedures for 5G-RG connecting via W-5GAN and/or NG-RAN are captured in
TS 23.316 [5].
### 6.1.3 Impacts on Existing Nodes and Functionality
No impacts to 3GPP entities or protocols compared to 3GPP Rel-16. The overall
solution may however be documented in TS 23.316 [5].
5G-RG:
\- Be able to establish one PDU Session per connectivity group, or per
non-3GPP device.
\- Be able to map one or multiple non-3GPP devices to a PDU Session of the
5G-RG. This could e.g. be done based on SSID or Ethernet port used by the
non-3GPP device
NOTE: Impacts to W-5GAN related entities and functionality are to be verified
with BBF and/or Cablelabs.
## 6.2 Solution 2: UE behind 5G-RG and FN-RG
### 6.2.1 Description
#### 6.2.1.1 Overall architecture
This solution addresses KI#1 and describes how a UE behind a 5G-RG/FN-RG can
connect to 5GC. The solution is based on existing solutions described in TS
23.316 [5] clause 4.10 (UE connecting to TNGF via RG) and TS 23.316 [5]
informative Annex A (UE connecting to N3IWG via RG). The solution assumes that
the UE is capable of handling the 5G NAS protocol over WLAN.
An RG connecting via W-5GAN or NG-RAN access towards 5GC can provide
connectivity for a UE behind the RG to access an N3IWF or TNGF. It is assumed
that the UE is 5GC capable, i.e. supports untrusted non-3GPP access and/or
trusted non-3GPP access. This allows the RG, W-5GAN and the RG\'s connectivity
via 5GC to together act as untrusted/trusted N3GPP access to support UEs
behind the RG.
When FN-RG/5G-RG is serving a UE, the control and user plane packets of the UE
is transported using a FN-RG/5G-RG IP PDU session and then from PSA UPF of
that PDU session to an IWF. A single FN-RG/5G-RG IP PDU session can be used to
serve multiple UEs.
Figure 6.2.1-1 shows the non-roaming architecture for a UE, behind a 5G-RG,
accessing the 5GC via N3IWF where the combination of 5G-RG, W-5GAN and UPF
serving the 5G-RG/FN-RG is acting as an untrusted Non-3GPP access network.
Figure 6.2.1-2 shows the non-roaming architecture for a UE, behind a 5G-RG,
accessing the 5GC via TNGF where the combination of 5G-RG, W-5GAN and UPF
serving the 5G-RG is acting as a trusted Non-3GPP access network.
NOTE 1: FN-RG and W-5GAN acting as trusted Non-3GPP access is not considered
since it is assumed that FN-RG does not support EAP-based access control (e.g.
802.1X).
Figure 6.2.1-1: Architecture for UE behind 5G-RG using untrusted N3GPP access
The 5G-RG can be connected to 5GC via W-5GAN, NG-RAN or via both accesses. The
UE can be connected to 5GC via untrusted non-3GPP access (via 5G-RG), NG-RAN
or via both accesses.
Figure 6.2.1-2: Non-roaming architecture for UE behind 5G-RG using trusted
N3GPP access
The TNGF and Ta reference point are defined in TS 23.501 [2].
NOTE 2: The reference architecture in figure 6.2.1-1 and 6.2.1-2 only shows
the architecture and the network functions directly connected to W-5GAN or
TNGF/N3IWF, and other parts of the architecture are the same as defined in
clause 4.2 of TS 23.501 [2].
The salient features of this solutions are the following:
\- For untrusted non-3GPP access:
\- UE connects to the overlay 5G network using the untrusted non-3GPP access
approach as illustrated in Annex A of TS 23.316 [5].
\- For trusted non-3GPP access:
\- UE connects to the overlay 5G network using the trusted non-3GPP access
approach as illustrated in clause 4.10 of TS 23.316 [5].
\- In addition to being connected to the underlay 5G network, the 5G-RG also
acts as TNAP with respect to the TNGF in the overlay network i.e. it has an
established Ta reference point with the TNGF.
\- For NWu scenario, the overlay and the underlay network as described in
clause D.7 of TS 23.501 [2] may be administrated by different operator\'s
domain, hence an SLA can be used (as defined clause D.7 of TS 23.501 [2]). If
the same operator deploys both overlay and the underlay network, e.g. as in
the case for trusted non-3GPP access (NWt), there is no need for SLA but that
operator\'s network configuration determines how to handle the DSCP markings
in the underlay network.
\- The N3IWF/TNGF in the overlay network translates the QoS request received
over N2 into DSCP marking that is applied to the outer header of the IPsec
tunnel encapsulation.
\- The N3IWF/TNGF may inform the UE about the DSCP marking to apply in the
uplink as defined in clauses 4.12 and 4.12a of TS 23.502 [3].
#### 6.2.1.2 Support for differentiated charging and QoS
Support for QoS differentiation can be achieved in a similar way as it is
handled when a UE connects to a PLMN via SNPN (clause 5.30.2.7 and clause D.7
of TS 23.501 [2],). Also differentiated charging, both in the RG\'s PLMN and
in the UE\'s PLMN, can be achieved based on existing mechanisms. This is
further described below.
The solution allows a differentiation based on whether the UEs PDU Session is
established via an RG or not via an RG of a certain PLMN. In addition, in case
of trusted non-3GPP access solution is used, the solution supports a
differentiation based on individual RG subscriptions, e.g. differentiation
between whether a UE connects via one specific RG or another specific RG of
the same PLMN. This can be used to determine e.g. whether a UE is considered
as host or guest of the local network of 5G-RG. This is supported by using
location-based policies where PCF takes the User Location Information into
account in the policy decisions. This is further described in the procedure in
clause 6.2.2.
QoS differentiation in the RG\'s PDU Session can be provided on per-IPsec
Child Security Association basis. The UE\'s N3IWF/TNGF determines the IPsec
child SAs as defined in clauses 4.12 and 4.12a of TS 23.502 [3]. The
N3IWF/TNGF is preconfigured by the UE\'s PLMN to allocate different IPsec
child SAs for QoS Flows with different QoS profiles.
To support QoS differentiation in the W-5GAN, the mapping rules between the
RG\'s 5GC and the UE\'s 5GC (where N3IWF is located) are assumed to be
governed by an SLA (or network configuration in case of single operator)
including:
1) mapping between the DSCP markings for the IPsec child SAs on NWu and the
corresponding QoS, and
2) N3IWF/TNGF IP address(es) in the UE\'s 5GC.
NOTE 3: If UEs behind RG belong to different PLMNs that may negotiate to RG\'s
PLMN with several SLAs, the QoS differentiation can be still supported by
applying the mapping rules.
The mapping rules may be provisioned to RG by RG\'s PLMN during PDU session
establishment and network initiated PDU Session Modification based on the
RG\'s subscription. The RG\'s PCF/SMF may e.g. provide QoS rules for the
available mappings as determined by the SLA. In case of the mapping rules of
N3IWF/TNGF IP address is not configured at the RG when receiving packets with
the N3IWF/TNGF IP address, the RG may buffer the received packets and send the
target N3IWF/TNGF IP address and indication of requesting mapping rules to
SMF/PCF. The RG can be provisioned with the mapping rules by SMF/PCF.
When RG receives packets from the UE, the mapping of DSCP markings and the
corresponding QoS may be determined based on the N3IWF/TNGF IP address(es)
carried in the packets. The RG may translate the DSCP marking in the outer
header of IPsec tunnel encapsulation into QoS parameters based on the mapping
of DSCP markings and the corresponding QoS.
The non-alteration of the DSCP field on NWu is also assumed to be governed by
an SLA and by transport-level arrangements that are outside of 3GPP scope. The
packet detection filters in the RG\'s UPF can be based on the N3IWF IP address
and the DSCP markings on NWu.
It is assumed that the same set of DSCP values and corresponding QoS are
applicable independent of whether UE-requested or network-initiated QoS is
used.
To enable differentiated charging similar mechanisms are applied. It is
assumed that the awareness of N3IWG/TNGF IP addresses as well as RG PDU
Session IP addresses are governed by SLA between UE\'s 5GC and RG\'s 5GC (or
network configuration in case of single operator).
In the RG\'s PLMN, the IP addresses belonging to N3IWF/TNGF in UE\'s PLMN can
be provided in packet filters to the RG\'s UPF together with a separate Rating
Group. In addition, to enable service-based differentiation, packet detection
filters in the RG\'s UPF can also include the DSCP markings on NWu. This is
similar to how QoS differentiation is done and would enable differentiated
charging in the RG\'s PDU Session on a per-IPSec Child Security Association
basis.
In the UE\'s PLMN, the N6 IP addresses available on the DNN to which the RG
establishes its PDU Session are assumed to be known based on SLA (or network
configuration in case of single operator). When the UE connects to N3IWF/TNGF,
one of these IP addresses will be used as the UE\'s local IP address (i.e. N6
address of the RG\'s PDU Session). This local UE IP address will be known to
the UE\'s SMF since it is part of the ULI provided from N3IWF/TNGF to AMF and
forwarded to SMF. The ULI is also provided to the UE\'s PCF. It is thus
possible for SMF/PCF to apply differentiated charging (e.g. different Rating
Groups) when the UE is accessing N3IWF/TNGF via W-5GAN.
QoS differentiation in the underlying 5G-RG\'s PDU Session can be provided on
per-IPsec Child Security Association basis by using the network requested PDU
Session Modification procedure described in clause 4.3.3.2 of TS 23.502 [3].
To support QoS differentiation in the underlying 5G-RG\'s PDU Session, the PCF
can generate separate PCC rules based on the DSCP values and the corresponding
QoS. Based on this, the SMF initiates PDU Session modification procedure for
an IPSec SA based on mapping between the DSCP markings for the IPsec child SAs
and the corresponding QoS in the PLMN. The packet detection filters in the
underlying 5G-RG\'s PDU Session can be based on the N3IWF/TNGF IP address and
the DSCP markings.
If there is no mapping rules involving the DSCP markings for the IPsec child
SAs when 5G-RG receives the packets from the UE, the 5G-RG may initiate PDU
Session modification procedure. The DSCP values and the target IP address on
the IP header of the IPsec child SAs may be included in the PDU Session
Modification Request. The SMF may establish corresponding QoS flow based on
the mapping rules between the RG\'s 5GC and the UE\'s 5GC. The SMF may also
update the provisioned mapping rules in 5G-RG so as to include the DSCP
markings together with the N3IWF/TNGF IP address.
### 6.2.2 Procedures
#### 6.2.2.1 General
The procedures for 5G-RG connecting via W-5GAN and/or NG_RAN are captured in
TS 23.316 [5].
The procedures for FN-RG connecting via W-5GAN are captured in TS 23.316 [5].
The procedures for a UE connecting via N3IWG and TNGF are captured in TS
23.502 [3].
#### 6.2.2.2 QoS and charging differentiation based on user location
information
In order to provide differentiation based on what specific 5G-RG the UE
connects via, the procedures below can be used.
Figure 6.2.2.2-1: PDU Session Establishment
1\. UE sends a PDU Session Establishment Request.
2\. TNGF forwards the NAS message to the UE\'s AMF in a N2 message. TNGF
includes the ULI (UE local IP address, TNAP ID) in the N2 message.
3\. AMF sends a Nsmf_PDUSession_CreateSMContext to AMF, including the SM NAS
container and ULI.
4\. SMF sends a Npcf_SMPolicyControl_Create Request to PCF, including the ULI.
5\. The PCF makes a policy decision, taking ULI into account. The policy
decision may e.g. be based on the following considerations:
\- If the UE\'s policy subscription data contains the TNAP ID, the PCF
considers the UE to be a \"home\" user of that RG.
\- If the UE local IP address is in the range of RG PDU Session IP addresses
as governed by SLA, and the UE\'s policy subscription data does not contain
the TNAP ID, the PCF considers the UE to be a \"guest\" user of that RG.
PCF may e.g. select different QoS and charging parameters for \"home\" users
and \"guest\" users.
The above considerations for policy decisions are only examples and the actual
policy decisions are based on operator configuration.
#### 6.2.2.3 AF influence on differentiation for UEs behind RG
The AF may provide information via NEF Service Specific parameter provisioning
to influence the policy decisions taken by PCF. The procedure re-uses the
Service Specific parameter provisioning as defined in clause 4.15.6.7 of TS
23.502 [3], but extends to support new service parameters (TNAP ID, GPSI).
Figure 6.2.2.3-1: AF influence on differentiation for UEs behind RG
0\. This step is the same as step 0 in clause 4.15.6.7 of TS 23.502 [3].
1\. The AF provides information related to the RG location information (TNAP
ID) for specific UE IDs (GPSIs). The AF may have received this information
from the owner of the RG subscription via a web portal. How this is done is
out of 3GPP scope.
2\. The NEF translates GPSI to SUPI and stores the information in UDR.
3\. The UDR notifies the PCF about changes in the stored data.
4\. The PCF may take the information into account for UE\'s PDU Sessions, as
described in clause 6.2.2.2.
### 6.2.3 Impacts on Existing Nodes and Functionality
No impacts compared to 3GPP Rel-17 to support differentiation based on whether
the UEs PDU Session is established via an RG or not via an RG of a certain
PLMN. It is assumed that an SLA exist between the RG\'s PLMN and the UE\'s
PLMN (or appropriate network configuration, in case of same operator).
In case of trusted non-3GPP access, since the Ta interface is not specified,
it is assumed that the 5G-RG and TNGF are administered by the same operator or
by different operators that have a joint operator specific implementation of
the Ta interface. Irrespective of the Ta interface, since TNAP just relays the
packet from UE to TNGF, the overlay and underlay network can have different or
same operators.
It is assumed that the SMF initiates PDU Session modification procedure for
each IPSec SA based on PCC rules with the DSCP values and the corresponding
QoS in the PLMN (supported by existing standards).
To support differentiation between whether a UEs PDU Session is established
via one specific RG or another specific RG of the same PLMN, the following
impacts applies:
PCF:
\- Support of UE location-based policies based on ULI for trusted non-3GPP
access (no standards impacts).
\- Retrieval application data from UDR containing TNAP ID and SUPI.
UDR:
\- Storage of new service parameter data.
NEF:
\- Policy control subscription data includes the TNAP ID.
\- New service data for Service Specific parameter provisioning API.
## 6.3 Solution 3: Differentiated QoS for N5CW devices behind 5G-RG
### 6.3.1 Description
The solution describes how differentiated QoS can be provided to the following
type of devices residing behind a 5G-RG:
\- Non-5G Capable WLAN (N5CW) device, which is not capable of handling the 5G
NAS protocol over WLAN, but is equipped with a USIM.
The architecture for providing differentiated services to a N5CW device behind
5G-RG is illustrated in Figure 6.3.1-1.
Figure 6.3.1-1: **N5CW device behind 5G-RG using trusted WLAN access for N5CW
device**
The salient features of this solutions are the following:
\- N5CW device connects to the overlay 5G network using the trusted WLAN
access for N5CW device approach.
\- In addition to being connected to the underlay 5G network, the 5G-RG also
acts as TWAP with respect to the TWIF in the overlay network i.e. it has an
established Yw reference point.
\- The traffic between TWAP and TWIF is carried in IPsec tunnels, each IPsec
tunnel corresponding to a pre-defined QoS level. Each IPsec tunnel can carry
traffic from more than one N5CW device. Each N5GW device is associated with
only one QoS level.
\- Provided Yw has such a signalling capability, each IPsec tunnel
establishment can be initiated by the TWIF on the fly when the QoS associated
with a N5CW device does not correspond to the QoS of any of the established
IPsec tunnels. Otherwise, all the IPsec tunnels corresponding to all supported
QoS levels need to be pre-established ahead of time (i.e. before any N5CW
device associates with the 5G-RG).
\- The TWIF in the overlay network translates the QoS request received over N2
into DSCP marking that is applied to the outer header of the IPsec tunnel
encapsulation. The IPsec tunnel is selected based on the QoS level only (i.e.
the IPsec tunnels are not specific to a N5CW device).
\- The TWAP extracts the inner IP packet and forwards the decapsulated IP
packet to the N5CW device using the DSCP marking in the outer IPsec header for
local QoS handling on the Yt\' interface. The TWAP also keeps track of the QoS
associated with this N5CW device and applies the same QoS in the uplink i.e.
the TWAP receives the uplink packets from specific N5CW device over Yt\' and
forwards them via the IPsec tunnel associated with the same QoS level.
\- There is an SLA between the overlay and the underlay network as described
in clause D.7 of TS 23.501 [2] defining how the DSCP marking in the outer IP
header of the IPsec Child SA (of the IPsec tunnel(s) established between TWAP
and TWIF) is to be handled by the underlay network for differentiated QoS.
### 6.3.2 Procedures
1) The SLA between the overlay and the underlay network as described in clause
D.7 of TS 23.501 [2] defining how the DSCP marking in the outer IP header of
the IPsec Child SA (of the IPsec tunnel(s) established between TWAP and TWIF)
is to be handled by the underlay network for differentiated QoS.
2) In addition to point1, TWAP will establish pre-defined secure multiple QoS
flows between TWAP and TWIF, and tunnel all the UE to/from traffic through one
of the pre-defined QoS flows.
5G-RG will discover a TWIF based on a pre-configured list of TWF or based on a
name server for TWIF.
TWAP based on the configuration will setup a session with the overlay network
(TNGF) through N6 interface. Once the session is established, TNAP will setup
a secure tunnel with the TNGF (Yw). To support QoS differentiation in the
underlying 5G-RG\'s secure PDU Session, when IPsec is used between the TWAP
and TNGF, the TNGF should ensure that different SA are used to carry flows of
different QoS, and any upstream data from the N5CW or downstream data to the
N5CW are sent in one of the QoS flow based on the DSCP markings. The packet
detection filters in the underlying PDU session used to carry Ta user plane
between TWAP (in the 5G RG) and TNGF can be based on the TNGF IP address and
the DSCP markings.
### 6.3.3 Impacts on Existing Nodes and Functionality
Specify (if needed) Yw as a standard inter operator interface (in R17 The Yw
reference points is outside the scope of the 3GPP specifications) and define
ways how the 5G RG can discover a TWIF in another network.
The solution largely re-uses existing functionality.
Impact to 5G-RG (in the role of TWAP):
\- Ability to pre-establish QoS-specific IPsec tunnels with the TWIF.
Optionally use Yw signalling to establish IPsec tunnels with the TWIF on the
fly.
\- Ability to keep track of QoS level associated with a N5CW device based on
DSCP marking in downlink packets and apply the same QoS to uplink packets by
forwarding them to the corresponding IPsec tunnel.
Impact to TWIF:
\- Optionally use Yw signalling to establish IPsec tunnels with the TWAP on
the fly.
## 6.4 Solution 4: Solution of providing differentiated service for Non-3GPP
devices connected behind a 5G-RG
### 6.4.1 Description
This solution provides differentiated service for non-3GPP devices connected
behind a 5G-RG. In this solution, the 5G-RG receives QoS rules for the
non-3GPP devices behind the 5G-RG. Then the 5G-RG uses the corresponding data
transfer tunnel to transfer the packets of the non-3GPP devices according to
the QoS rules.
This solution is used for Non-Authenticable Non-3GPP (NAUN3) devices.
The 5G-RG is pre-configured or receives session policy for non-3GPP devices
from the network during its PDU Session Establishment procedure. The session
policy for non-3GPP devices describes the following information:
a) to establish a QoS flow for one category of non-3GPP devices;
b) the DNN / S-NSSAI corresponding to the PDU session of the QoS flow for
non-3GPP devices;
c) the non-3GPP device category identifier. The non-3GPP device category
identifier is used to identify one or a group of non-3GPP devices. The
non-3GPP device category identifier is a standardized value, e.g. 5QI.
d) mapping relationship between non-3GPP device category identifier and the
corresponding port number range used for the packets of the non-3GPP device
category when transferred in the 5GS.
When the 5G-RG detects the connection of a non-3GPP device, the 5G-RG requests
to establish a QoS flow for the non-3GPP device according to the session
policy. If there is already a corresponding PDU Session (i.e. a PDU sessions
with the same DNN/S-NSSAI), the 5G-RG performs PDU Session Modification
procedure. If there is no corresponding PDU Sessions (i.e. no PDU sessions
with the same DNN/S-NSSAI), the 5G-RG performs PDU Session Establishment
procedure.
### 6.4.2 Procedures
#### 6.4.2.1 5G-RG initiates PDU Session Modification or Establishment for One
Non-3GPP Device Category
Figure 6.4.2.1-1 5G-RG establishes a QoS flow for one category of non-3GPP
devices
1\. non-3GPP device connects to 5G-RG with non-3GPP access network (e.g.
establishes WiFi association).
During this procedure, 5G-RG obtains non-3GPP device category identifier. The
5G-RG may need to map the WLAN SSID or physical Ethernet port identifier used
by the non-3GPP device to non-3GPP device category identifier. The 5G-RG
performs such mapping based on local configuration.
The 5G-RG is configured (e.g. by the device vendor) with the mapping
relationship between WLAN SSID or physical Ethernet port identifier used by
the non-3GPP device to non-3GPP device category identifier.
When 5G-RG receives UL packets of a non-3GPP device in this category, it
modifies the source port number of the packet to one of the port numbers in
the port number range. When 5G-RG receives DL packets of a non-3GPP device in
this category, it modifies the destination port number of the packet to the
original source port number of the UL packet.
The 5G-RG may configure IP address (i.e. using IPv6 prefix delegation or local
IPv4 address allocation mechanism) to the non-3GPP device.
2\. 5G-RG sends NAS message to the AMF. The NAS message includes a PDU Session
Modification Request, including PDU Session ID, 5G-RG ID and non-3GPP device
category identifier. Optionally, non-3GPP indication is also included.
The 5G-RG determines to request to establish a QoS flow for the category of
non-3GPP devices according to the session policy for non-3GPP devices.
NOTE: It is assumed that the 5G-RG already establishes a PDU session.
3\. The AMF sends N11 message to the SMF and forwards the PDU Session
Modification Request.
4\. The SMF reports non-3GPP device category identifier to the PCF by
initiating the SM Association Modification procedure.
The PCF provides QoS rules for the category of non-3GPP devices to the SMF.
5\. For Ethernet PDU Session type, the SMF updates the UPF with N4 Rules by
indicating that this PDU session is also used to transfer the traffic related
to the non-3GPP device\'s MAC address.
6\. The SMF generates PDU Session Modification message including the QoS rules
for the non-3GPP device.
The SMF sends N11 message to the AMF, including the PDU Session Modification
message, 5G-RG ID and non-3GPP device category identifier.
7\. The AMF sends NAS message to the 5G-RG, forwarding the PDU Session
Modification message to the 5G-RG.
The 5G-RG maps the traffic of the non-3GPP device to the QoS flow of this PDU
session according to the received QoS rule.
When the 5G-RG detects disconnection of the non-3GPP device, if there is no
traffic of other non-3GPP devices maps to the QoS flow, the 5G-RG initiates
PDU Session Modification procedure to release such QoS flow.
Figure 6.4.2.1-2 5G-RG establishes a PDU session for one category of non-3GPP
devices
If the 5G-RG determines to establish a PDU session for the non-3GPP device
according to the session policy for non-3GPP devices, the 5G-RG performs PDU
session establishment procedure according to clause 4.3.2.1 of TS 23.502 [3]
with the following differences:
In step 1, 5G-RG includes 5G-RG ID and non-3GPP device category identifier in
PDU Session Establishment Request.
During SM Policy Association Establishment procedure, in step 3, the SMF
reports non-3GPP device category identifier to the PCF, and in step 4, the PCF
sends PCC policy corresponding to the non-3GPP device category identifier.
In step 5a. the SMF sends the corresponding port number range used for the
packets of the non-3GPP device category when transferred in the 5GS to the
UPF. Then the UPF can monitor the packets transferred in this PDU session.
In steps 6 and 7, the SMF includes the non-3GPP device category identifier and
QoS rule of the non-3GPP device in PDU Session Establishment Response.
The 5G-RG maps the traffic of the non-3GPP device to this PDU session
according to the received QoS rule.
Figure 6.4.2.1-3 5G-RG receives session policy for non-3GPP devices in PDU
session establishment procedure
The 5G-RG receives the session policy for non-3GPP devices during its own PDU
Session establishment procedure. The 5G-RG performs PDU session establishment
procedure according to clause 4.3.2.1 of TS 23.502 [3] with the following
differences:
\- In step 1, 5G-RG includes non-3GPP access indication in PDU Session
Establishment Request to requests the session policy for non-3GPP devices
behind it.
\- During SM Policy Association Establishment procedure, in step 3, the SMF
reports non-3GPP access indication to the PCF and in step 4, the PCF sends
session policy for non-3GPP devices to the SMF.
\- In step 5a. the SMF sends the corresponding port number range used for the
packets of the non-3GPP device category which are transferred in this PDU
session to the UPF. Then the UPF can monitor the packets transferred in this
PDU session, e.g. drop the packet which is transferred via this PDU session
but does not belong to the non-3GPP device category.
\- In steps 6 and 7, the SMF sends the session policy for non-3GPP devices to
the UE in PDU Session Establishment Response.
The mapping relationship between non-3GPP device category identifier and the
corresponding port number range used for the packets of the non-3GPP device
category when transferred in the 5GS is transferred to the 5G-RG during PDU
Session Establishment procedure. Other parameters in session policy can be
transferred via URSP.
a) to establish a QoS flow for one category of non-3GPP devices;
b) the DNN / S-NSSAI corresponding to the PDU session of the QoS flow for
non-3GPP devices;
c) the non-3GPP device category identifier.
#### 6.4.2.2 SMF initiates PDU Session Modification or Establishment for One
Non-3GPP Device Category
Figure 6.4.2.2-1 SMF initiated PDU Session Modification for a non-3GPP device
category
0\. The 5G-RG establishes a PDU session and receives the session policy for
non-3GPP devices during its own PDU Session establishment procedure. The 5G-RG
performs PDU session establishment procedure according to clause 4.3.2.1 of TS
23.502 [3] with the following differences:
\- In step 1, 5G-RG includes non-3GPP access indication in PDU Session
Establishment Request to requests the session policy for non-3GPP devices
behind it.
\- During SM Policy Association Establishment procedure, in step 3, the SMF
reports non-3GPP access indication to the PCF and in step 4, the PCF sends
session policy for non-3GPP devices to the SMF.
\- In step 5a. the SMF sends the corresponding port number range used for the
packets of the non-3GPP device category which are transferred in this PDU
session to the UPF and requests the UPF to detect the packets of the non-3GPP
device category using URR.
\- In steps 6 and 7, the SMF sends the session policy for non-3GPP devices to
the UE in PDU Session Establishment Response.
1\. Non-3GPP device connects to 5G-RG with non-3GPP access network (e.g.
establishes WiFi association).
During this procedure, 5G-RG obtains non-3GPP device category identifier. The
5G-RG may need to map the WLAN SSID or physical Ethernet port identifier used
by the non-3GPP device to non-3GPP device category identifier.
The 5G-RG is configured (e.g. by the device vendor) with the mapping
relationship between WLAN SSID or physical Ethernet port identifier used by
the non-3GPP device to non-3GPP device category identifier.
2\. When 5G-RG receives UL packets of a non-3GPP device in this category, it
modifies the source port number of the packet to one of the port numbers in
the port number range. When 5G-RG receives DL packets of a non-3GPP device in
this category, it modifies the destination port number of the packet to the
original source port number of the UL packet.
3\. When UPF detects the packets of the non-3GPP device category, it reports
to the SMF using Usage Report.
4\. The SMF initiates PDU Session Modification procedure to establish a QoS
flow for the non-3GPP device category.
Editor\'s note: The RG impacts in this solution needs to be checked by BBF.
### 6.4.3 Impacts on Existing Nodes and Functionality
5G-RG:
\- 5G-RG requests for QoS rule for the non-3GPP device behind it, by sending
PDU session modification message to the network and receives the requested
information from the network.
\- 5G-RG receives session policy for non-3GPP devices from the network and
requests to establish PDU Session or QoS flow based on the session policy for
non-3GPP devices.
\- 5G-RG includes non-3GPP access indication in PDU Session Establishment
Request to requests the session policy for non-3GPP devices behind it.
\- 5G-RG maps the MAC address, WLAN SSID or physical Ethernet port identifier
used by the non-3GPP device to non-3GPP device category identifier based on
local configuration.
\- 5G-RG is configured with mapping relationship between non-3GPP device
category identifier and the corresponding port number range used for the
packets of the non-3GPP device category when transferred in the 5GS, and
modify the packets of non-3GPP device category correspondingly.
SMF:
\- The SMF requests QoS rule for non-3GPP device from the PCF.
\- The SMF sends the non-3GPP access indication to the PCF and receives
session policy for non-3GPP devices.
\- The SMF sends the session policy for non-3GPP devices to the UE in PDU
Session Establishment Response.
\- The SMF sends the corresponding port number range used for the packets of
the non-3GPP device category when transferred in the 5GS to the UPF. Upon
receiving report of detection of packets of the non-3GPP device category,
initiates PDU Session Modification to establish a QoS flow for this non-3GPP
device category.
PCF:
\- The PCF provides QoS rules for non-3GPP devices.
\- The PCF provides session policy for non-3GPP devices to the SMF.
## 6.5 Solution 5: 5GC-capable UE behind 5G-RG using trusted Non-3GPP access
### 6.5.1 General
This solution is applicable when 802.1x (EAP over LAN) and 3GPP credentials
are used to associate with the WLAN. In this option, the solution for trusted
N3GPP is used as baseline but with the additional property that the service is
offered via a wireline access and a 5G-RG. This solution can distinguish the
5GC-capable UE role and apply the different QoS and charging policy for the
different categories of devices, for example for 5GC capable UE considered as
host or guest of the local network of 5G-RG/HA 5G-RG. The member of the family
decides on which 5GC capable UE considered as host (i.e. subscriber of the
5G-RG) and reports these 5GC capable UE IDs (e.g. MSISDN) to the operator via
online or offline service. This is out of the scope of 3GPP. After that, the
operator may configure the role in the UDM or the application function AF
managing the service can send the subscription information to the UDM via NEF.
it is the 5GC\'s responsibility to maintain such information and decides the
5GC capable UE role based on it.
The solution is based on the following architecture as defined in clause 4.10
of TS 23.316 [5]. The Ta interface is a non-roaming interface, which means the
5G-RG and TNGF belongs to the same PLMN. Then the UE and the 5G-RG belong to
the same PLMN too.
NOTE: For the UE accessing 5GC, the 5G-RG is treated as WLAN AP connecting to
TNGF, so the same slice is supported by the 5G-RG and the TNGF.
Figure 6.5.1-1: Non-roaming architecture for UE behind 5G-RG using trusted
N3GPP access
### 6.5.2 Registration procedure
In this solution, the 5G-RG acts as TNAP and is behaved as authenticator, the
interface between the 5G-RG and W-5GAN is assumed an AAA interface.
Figure 6.5.2-1: Registration procedure
0\. 5G-RG has successfully registered to the AMF1. 5G-RG obtained the 5G-RG
GUTI from 5GC.
A layer-2 connection is established between the UE and the 5G-RG. In case of
IEEE 802.11 this step corresponds to an 802.11 Association. Optionally, the
5G-RG may send 5G-RG 5G-GUTI to the UE via ANQP message.
Editor\'s note: Security aspects of sending 5G-RG 5G-GUTI in ANQP should be
verified by SA WG3.
1a-1c. An EAP authentication procedure is initiated. EAP messages are
encapsulated into layer-2 packets, i.e. into Ethernet-over-LAN packets. The UE
provides a NAI in the EAP-Res/Identity message. This EAP-Res/Identity is
encapsulated in the AAA message as defined in clause 4.12a.2.2, step 3 of TS
23.502 [3] by 5G-RG. If the 5G-RG does not transport the 5G-GUTI via ANQP
message, the 5G-RG also includes 5G-RG 5G-GUTI in this AAA message. The AAA
message is encapsulated over IP layer, the source IP address is the 5G-RG\'s
IP address allocated by the 5GC in the PDU session established procedure via
wireline or wireless access, the destination IP address is the TNGF IP address
configured on the 5G-RG side or queried through the DNS procedure.
1d. An EAP-5G procedure is executed as specified in TS 23.502 [3] and TS
33.501 [9]. The W-5GAN sends the EAP-5G start message including the 5G-RG GUTI
to the UE.
1e. The UE sends the AN parameters (e.g. UE SUCI or the 5G-GUTI, Requested
NSSAI, etc.) and NAS Registration request message (e.g. Registration type, UE
SUCI or 5G-GUTI, Security parameters, Requested NSSAI, etc.) in the EAP-5G. In
addition, in the NAS Registration request message, the UE includes the 5G-RG
5G-GUTI received from the EAP-5G start message. The 5G-RG 5G-GUTI is used by
AMF to find the 5G-RG context and obtain 5G-RG SUPI.
2\. W-5GAN selects the AMF2 for UE as specified in clause 4.2.2.2.2 of TS
23.501 [2] with the UE 5G-GUTI or Requested NSSAI. This AMF2 may be the same
or different from the AMF1.
3-4. The AMF2 received the Registration request message and the UE
authentication procedure is performed based on the UE 3GPP credential as
defined in TS 23.502 [3] and TS 33.501 [9].
5-6. With the existing of 5G-RG GUTI, the AMF2 knows that the UE is accessing
5GC via 5G-RG. In order to obtain the 5G-RG SUPI, the AMF2 finds the 5G-RG
context based on the 5G-RG 5G-GUTI. If there is no 5G-RG context in the AMF2,
AMF2 requests the 5G-RG SUPI from AMF1. To be more specific, the AMF2 selects
the AMF1 based on the 5G-RG 5G-GUTI and sends the request message to the AMF1
including the 5G-RG 5G-GUTI and SUPI requested indication. AMF1 finds the
5G-RG context based on the 5G-RG 5G-GUTI and replies the 5G-RG SUPI to the
AMF2.
7-8. The AMF2 selects the UDM based on 5G-RG SUPI, and requests 5G-RG\'s
subscribed UE ID list from the UDM. The 5G-RG\'s subscribed UE ID list
includes the UE IDs, e.g. UE SUPI or UE MSISDN. If the UE ID sent by AMF2 to
UDM belongs to the subscribed UE ID list, the UE is treated as the subscriber
of the 5G-RG. If the UE ID does not belong to the subscribed UE ID list and
the 5G-RG only allows the subscribed UE, the UDM shall reject the UE. The UDM
stores the serving AMF identity and will notify the AMF when the 5G-RG\'s
subscribed UE ID list is updated.
9\. The UDM sends the subscribed UE ID list to the AMF2. AMF2 stored the
subscribed UE ID list and decides if the UE is the subscribed UE of the 5G-RG.
If the UE is not the subscriber of 5G-RG and the 5G-RG only allows the
subscribed UE, the AMF shall reject the UE.
10-11. The AMF2 requests the policy from PCF.
12-16. The same steps as defined in clause 4.12a.2, steps 10a to 15b of TS
23.502 [3].
During the PDU session establishment procedure triggered by the remote UE, the
procedure defined in clause 4.12a.5 of TS 23.502 [3] is applied, with the
following difference:
Step 2a: If the AMF2 identifies the UE as the subscribed UE of the 5G-RG, it
sends the subscribed UE indication to the SMF2. The SMF2 forwards this
information to the PCF, the PCF may create the different QoS or/and charging
rules based on the UE role, i.e. subscribed UE or unsubscribed UE. For
example, the PCF will apply the higher priority 5QI value for the subscribed
UE traffic than the unsubscribed UE. The SMF2 creates the DSCP value based on
5QI and the UE role.
Step 2b: The SMF2 sends N2 SM information to the TNGF, including the mapping
between the QFI and the DSCP value. The TNGF can provide DSCP value to UE for
the User Plane IPsec Child SA at PDU Session Establishment as defined in
clause 4.12.5, step 4a and 4c.
In the UE\'s PLMN, for the downlink data, the TNGF marks the DSCP in the outer
IP header based on the mapping between the QFI and DSCP received from SMF2.
For the uplink, the UE marks the DSCP using the DSCP value associated with the
Child SA.
In the 5G-RG\'s PLMN, the QoS is controlled per description for the PCF, SMF
and UPF in the clause D.7 of TS 23.501 [2].
### 6.5.3 Provisioning of subscription information in UDM
This optional procedure to provision the UDM with the UE role when connected
to the 5G-RG.
{width="6.34375in" height="3.4270833333333335in"}
Figure 6.5.2-2: Provisioning of UE rule
1) The 5G-RG or the user via application out of scope of 3GPP interacts with
AF via UP for configuration of Home Local network device information.
2) The AF provides via NEF the Role information for the UE id when connected
to the 5G-RG id to UDM and optionally the corresponding QoS profile(s) to be
applied when connected. The UE id may be the MSISDN of the UE.
3) The UDM acknowledge the request.
### 6.5.4 Impacts on existing Functions
UDM:
\- The 5G-RG subscription data is extended to include the subscribed UE list.
\- Optionally the UDM may be provided via NEF by AF the role of UE device
behind the 5G-RG.
AMF:
\- Obtain the 5G-RG GUTI from NAS message, and then request the 5G-RG SUPI
from the 5G-RG\'s serving AMF.
\- Request the 5G-RG\'s subscribed UE list from UDM based on the 5G-RG SUPI.
PCF:
\- Decide the 5QI based on the UE role, i.e. the subscribed UE or unsubscribed
UE indicated by the SMF.
SMF:
\- Transfer to the PCF the UE role, i.e. the subscribed UE or unsubscribed UE
received from the AMF.
NEF:
\- New service for configuration of UE role for device behind the 5G-RG.
5G-RG:
\- Send the 5G-RG GUTI to the UE. There are two options, the impacts on each
one is as follows:
Option 1: The 5G-RG sends the 5G-RG GUTI to TNGF via the Ta interface. As the
5G-RG and TNGF are defined by 3GPP, the Ta interface can also be defined by
3GPP.
Option 2: The 5G-RG sends the 5G-RG GUTI to the UE via ANQP message.
UE:
\- Send the 5G-RG GUTI to the AMF via the NAS message.
## 6.6 Solution 6: New method for non-3GPP device connected behind a 5G-RG
### 6.6.1 Description
This solution addresses Key Issue #1\"Providing differentiated service for UE
and Non-3GPP devices connected behind a 5G RG\".
Figure 6.6.1-1 depicts the architecture for devices connected behind a 5G-RG.
In this solution, the AF, which supports the functionality of assigning
virtual identifier (e.g. virtual SUCI) can preconfigure a list of the virtual
identifier to the UDR through NEF. After the 5G-RG registers to the 5GC, a
virtual identifier would be assigned to it as the identifier of the device
which has been connected to 5G-RG. Then the 5G-RG could use the virtual
identifier to initial registration procedure and PDU session establishment
procedure via W-AGF on behalf of the device. In this solution, the 5G-RG
receives QoS rules, which is associated with the virtual identifier (e.g.
virtual SUCI), for the non-3GPP devices and different QoS profiles may be
applied per device behind the 5G-RG by 5GC.
NOTE 1: AF in figure 6.6.1-1 is managed by operator.
NOTE 2: The interaction between the AF and 5G-RG may be out of 3GPP scope.
NOTE 3: The virtual identifier corresponds to 5G-RG\'s subscription
information in UDM.
NOTE 4: For the differentiated QoS aspect, this solution can be applied to
both static and randomized MAC address cases. But for the charge aspect, this
solution can only be applied to static MAC address case.
Figure 6.6.1-1: architecture for non-3GPP devices connected behind a 5G-RG
### 6.6.2 Procedures
Figure 6.6.2-1: Procedure for 5G RG and Device Registration
0\. The AF preconfigures the list of virtual information (e.g. virtual SUPI,
the corresponding credential) to UDR through the NEF, so that the virtual
identifier can be a legal identifier of the non-3GPP device behind the 5G-RG
for which the 5G-RG is doing the authentication procedure on behalf.
NOTE 1: Each device behind RG has a unique subscription information in UDR
which is separate from that of the RG.
NOTE 2: The virtual SUCI/SUPI can be understood as that a set of real
SUCI/SUPI are dedicated to be allocated to those devices that don\'t has SIMs,
i.e the format of virtual SUCI/SUPI is the same with the real SUCI/SUPI.
1\. The 5G-RG registration procedure, as described in clause 7.2.1.1 of TS
23.316 [5].
2\. The UDR informs the AF that the 5G-RG has been successfully registered
with 5GC by the notification on the information of UE registration state
change or the registration state changes may be monitored via
Namf_EventExposure service, as defined in clause 5.2.2.3 of TS 23.502 [3]. AF
should save the registration state of specific 5G-RG.
3\. The device connects to the 5G-RG via a layer-2 (L2) connection.
4\. The 5G-RG applies to the AF for a virtual identifier by carrying the SUCI
of the 5G RG and the MAC address of the device.
5\. The AF checks if the 5G-RG is in the list of registered 5G-RGs. If it has
registered successfully, the AF will store the non-3GPP device information in
UDR as Application Data, as currently defined for Nnef_ServiceParameter
service in clause 4.15.6.7 of TS 23.502 [3]. The information of the non-3GPP
device includes the mapping information between the virtual identifier (e.g.
the virtual SUCI) and the MAC address of the non-3GPP device, the identifier
of 5G-RG, QoS reference information, etc.
6\. The AF responds to the 5G-RG by assigning a virtual identifier (e.g. the
virtual SUCI) to the device. The AF saves the timestamp and the mapping
information between the virtual identifier (e.g. the virtual SUCI) and the MAC
address of the device.
NOTE 3: In steps 4 and 6, the AF and 5G-RG communicate directly without going
through the 5GC. Step 4 and 6 may be out of the 3GPP scope.
7\. The 5G-RG uses the virtual identifier to initial registration procedure on
behalf of the device. Registration procedure specified in clause 7.2.1.1 of TS
23.316 [5] apply with the following differences:
The 5G-RG initial registration procedure by the transmission of a NAS message
containing a registration request. The registration request contains e.g. the
virtual identifier (e.g. virtual SUCI). Because the NAS tunnel has already
been established in step 1, the 5G-RG can send a NAS message to AMF directly.
Over N2 there is a separate NGAP connection per non-3gpp device served by the
W-AGF.
The virtual information (e.g. virtual SUCI, the corresponding credential) in
5G-RG is used in the authentication procedure to authenticate the device
behind the 5G-RG.
8\. When 5G-RG establish a PDU Session on behalf of the device, the PCF may
contact the UDR to subscribe to the notification on the update of Application
Data, as per existing procedure for Service specific parameter provisioning in
clause 4.15.6.7 of TS 23.502 [3]. The PCF thus receives the non-3GPP device
information from UDR and can take the information into account for its policy
decision. After successful registration, PDU Session establishment procedure
specified in clause 4.3.2.2.1 of TS 23.502 [3] apply with the difference as
below.
The PCF provides QoS rules for the non-3GPP device to the SMF. The 5G-RG
receives QoS rules for the non-3GPP devices and the 5G-RG maps the traffic of
the non-3GPP device to the QoS flow of this PDU session according to the
received QoS rule.
NOTE 4: A distinct PDU Session and QoS flows may be established for each
device behind the RG.
### 6.6.3 Impacts on Existing Nodes and Functionality
UDR:
\- Store the mapping between the virtual identifier and the MAC Address of the
non-3GPP device.
5G-RG:
\- Apply to the AF for a virtual identifier.
\- Store the mapping information between the virtual identifier and the MAC
address of the non-3GPP device.
\- Support performing registration and PDU Session related procedure on behalf
of non-3GPP device behind.
\- Send a NAS Registration Request message virtual identifier to the AMF on
behalf of non-3gpp device.
NEF:
\- Allow an AF to provision non-3GPP device information.
PCF:
\- Retrieve the non-3GPP device information from UDR and take the information
into account for policy decision.
## 6.7 Solution 7: Differentiated QoS for non-3GPP devices behind 5G-RG
### 6.7.1 Description
#### 6.7.1.1 Introduction
QoS experienced by non-3GPP devices connected behind a 5G-RG depends on the
end-to-end path between a non-3GPP device and the application server, i.e.
depends on the QoS differentiation in both the 3GPP network and the non-3GPP
network attached to the 5G-RG.
For example, a certain Packet Error Ratio (PER) can only be successfully
ensured if it is enforced in both the 3GPP network and the non-3GPP network
attached to the 5G-RG.
To address this shortcoming, this solution proposes to indicate Non-3GPP QoS
assistance information to the 5G-RG to enable the 5G-RG to perform QoS
differentiation for the non-3GPP devices in the non-3GPP network behind the
5G-RG.
NOTE: This is conceptually similar as providing Additional QoS Information to
a UE for trusted/untrusted access to 5GC as defined in TS 23.502 [3], which
enables the UE to reserve resources in the non-3GPP network. The difference is
that the Non-3GPP QoS assistance information is used to reserve resource in
the non-3GPP network attached to the 5G-RG. In line with the definition of
Additional QoS information, the details of how to enforce QoS in the non-3GPP
network based on the Non-3GPP QoS assistance information are beyond the scope
of 3GPP.
The solution applies to 5G-RG connected via W-5GAN or connected via FWA as
defined in TS 23.316 [5].
#### 6.7.1.2 Solution principles
The solution is based on the following principles:
\- During PDU session establishment and PDU session modification, if the SMF
provides the 5G-RG with QoS flow descriptions, the SMF may, based on
subscription, additionally signal non-3GPP QoS assistance information for each
QoS flow to the 5G-RG. The non-3GPP QoS assistance information consists of the
following QoS information (if available at the SMF): QoS characteristics,
GFBR/MFBR (if applicable), ARP, Periodicity.
Editor\'s note: Details of which non-3GPP QoS assistance information to
provide, e.g. whether Periodicity needs to be part of the non-3GPP QoS
assistance information for the non-3GPP devices behind 5G-RG scenario, are
FFS.
\- Based on the non-3GPP QoS assistance information together with QoS rule
information, the 5G-RG may reserve resources in the non-3GPP network.
NOTE: The details of how to enforce QoS based on the Non-3GPP QoS assistance
information in the non-3GPP network are not subject of this solution and are
considered to be beyond the scope of 3GPP.
### 6.7.2 Procedures
Figure 1: Providing Non-3GPP QoS assistance information to the 5G-RG to enable
the 5G-RG to ensure QoS in the non-3GPP network attached to the 5G-RG
1\. PDU Session is established
2\. Application layer signalling is exchanged between an application on a
non-3GPP device connected to the 5G-RG and an application function (AF)
3\. Based on the application layer signalling, the AF requests QoS for
application flows.
NOTE 1: If the AF is not considered trusted, then the AF interacts with the
NEF instead. If the AF provides explicit QoS parameters, then AF (or NEF in
case the AF is not trusted) interacts with PCF as defined in clause 4.15.6.6
of TS 23.502 [3].
4\. PCF sends PCC rules to the SMF.
NOTE 2: Steps 1-4 are following existing Rel-17 specifications.
5\. SMF performs PDU Session modification as defined in clause 4.3.2 of TS
23.502 [3] and may include, based on subscription, in the N1 SM container per
QoS-flow Non-3GPP QoS assistance information. The Non-3GPP QoS assistance
information contains (if available at the SMF): QoS characteristics, GFBR/MFBR
(if applicable), ARP, Periodicity.
Editor\'s note: Details of which non-3GPP QoS assistance information to
provide are FFS.
6\. Based on the non-3GPP QoS assistance information and QoS rule information,
the 5G-RG may reserve resources in the non-3GPP network.
### 6.7.3 Impacts on Existing Nodes and Functionality
\- SMF:
\- to provide per-QoS flow Non-3GPP QoS assistance information
\- 5G-RG:
\- to receive additional Non-3GPP QoS assistance information in NAS-
Optionally enforce QoS in the non-3GPP network. The details of how to enforce
QoS in the non-3GPP network are not subject of this solution and are
considered to be beyond the scope of 3GPP.
Editor\'s note: Whether further considerations on 5G-RG would be brought to
BBF and/or CableLabs attention is FFS.
## 6.8 Solution 8 - Support of \"combo Ethernet + IP\" service
### 6.8.1 Overview
This solution addresses KI # 1; it relates to How to improve the support of L2
Bridge 5G-RG scenario for providing differentiated connectivity to devices
behind the RG based on BBF requirements as expressed in their LS
BBF-291/S2-1903875.
This solution is meant to apply to both 5G-RG (connected over FWA and/or via a
Wireline access) and FN-RG. The same solution applies to both 5G RG and FN RG.
This solution aims at serving RG working in Bridged and Bridged/Routed mode
(at least for some services), where the 5GC may need to:
\- provide an IP service to the Customer premises devices e.g. allocate
IPv4/v6 address / Prefix to devices behind the RG.
\- identify each device / terminal behind the RG via its MAC address: for this
purpose, Ethernet frames are exchanged between the RG and the 5GC so that the
network (UPF) is capable to identify traffic from different individual devices
in the Customer Premises. In this solution, a device / terminal behind the RG
may be a UE or a non 3GPP device.
NOTE 1: This is e.g. to apply specific policies related with the terminal
(e.g. parental control or Enhanced home office service where a work laptop
gets bandwidth and prioritization).
This solution is only meant to be used in deployments with RG working in
Bridged and Bridged/Routed mode.
The Ethernet PDU Session Type does not support an IP service over N6. For
example, TS 23.501 [2] states that \"Neither a MAC nor an IP address is
allocated by the 5GC to the UE for a PDU Session\". Furthermore, with the
Ethernet PDU Session the Layer 2 header received from the access side is
copied on the N6 side of the PSA while it is not meant to be copied over N6 in
the case of an IP service provided to RG working in Bridged and Bridged/Routed
mode. In case of Ethernet PDU Session Type DL forwarding is basically done
based on the Destination MAC address of the UE while here DL forwarding is to
be made based on the IP address of the target device ; in case an IP PDU
Session type would be used to support an RG working in Routed mode with no
NAT, as many PDU Sessions as there are devices in the Customer Premises
requiring an IP address would be required.
A dedicated PDU Session Type called \"Combo Ethernet + IP\" is used for that
purpose. It basically supports an access **Router** in the PSA while an
Ethernet PDU Session supports a **bridge** in the PSA;
In case of \"combo Ethernet + IP\" PDU Session Type:
1\. Ethernet frames are exchanged between the RG and the UPF acting as PSA
(PDU Session Anchor).
2\. Ethernet frames exchanged between the RG and the UPF acting as PSA carry
IP traffic (and IP auxiliary protocols: ARP, ND).
3\. An IP service is delivered at N6 where for example IP addresses are
allocated to individual devices (devices in the Customer Premises) behind the
RG. Any IP address delivery mechanism may be used to deliver an IP address to
the devices behind the RG i.e. SLACC, DHCPV4 or DHCPV6. The SMF related
subscription data associated with the RG apply to a whole PDU Session
regardless of whether multiple IP addresses are allocated on this PDU Session.
NOTE 2: IP address(es) allocated to devices can correspond to public or to
private addresses.
4\. In the UL direction the UPF acting as PSA receives (as a payload of the
GTP-u tunnel coming from the AGF) IP traffic within a Layer 2 framing; This
layer 2 framing below IP is called \"access side layer 2 header\" below. The
PSA maps between the IPv4/v6 address / Prefix of a device behind the RG and
the \" access side layer 2 header\" as follows:
\- in UL the \"access side layer 2 header\" framing coming from a device in
the Customer Premises is removed by the PSA. The UPF keeps track of the
association between the IP address of the device and the corresponding
\"access side layer 2 header\".
\- in DL the \" access side layer 2 header\" is added by the UPF before
sending the traffic towards a device in the Customer Premises. Necessary MAC
address swapping (source/destination) is enforced by the PSA on the \"access
side layer 2 header\" stored from UL traffic.
The \"access side layer 2 header\" handled by the PSA contains the IEEE 802.3
MAC header possibly augmented by IEEE 802.1q header or by a IEEE 802.1ad
header (also known as Â« QinQ Â»).
NOTE 3: It is up to BBF access to determine whether this \"access side layer 2
header\" includes any VLAN tagging (possibly multiple levels of VLAN tagging)
e.g. VLAN tagging added by the BBF access on top of the UL Ethernet frames
received from the RG. The PSA performs the mapping above regardless of whether
the \" access side layer 2 header\" contains 0, 1 or 2 level of VLAN tagging.
Potential VLAN tagging addition by 5G RG is defined by existing BBF
specifications.
For a Combo Ethernet and IP PDU session type the RG exchanges with the 5GC IP
packets each carried within an Ethernet frame. The 5GC delivers an IP service
to the RG and to devices locally connected to the RG while it is able to
identify traffic of these devices by the MAC address they are using.
NOTE 4: No new traffic filters (for N4 PDR or PCC rule or N1 SM QoS related
signalling) need to be defined.
Figure 6.8.1-1: Protocol stack for the combo PDU Session Type
For UL traffic, the Ethernet layer 2 framing depicted in Figure 6.8.1-1 above
is subject of following processing:
\- The RG may add a VLAN header (*) to the traffic received from the devices
in the customer premises.
\- The BBF access may add a VLAN header (**) (e.g. S-tag) to the traffic
received from the RG.
For DL traffic, the Ethernet layer 2 framing depicted in Figure 6.8.1-1 above
is subject of following processing:
\- The BBF access may strip off a VLAN header (**) (e.g. S-tag) to the traffic
received from the network.
\- The RG may strip off a VLAN header (*) to the traffic received from the
network.
In this release of the specification, SSC mode 3, UL CL and IPV6 multihoming
do not apply to a PDU Session of the Combo type.
In this release of the specification, the Combo PDU Session type applies only
to the Wireline access.
A RG may use simultaneously a PDU Session with the \"combo Ethernet + IP\" PDU
Session type and PDU Session(s) with another PDU Session type.
A 5G-RG configured to work in Bridged and Bridged/Routed mode requests PDU
Sessions with the PDU Session Type \"combo IP + Ethernet\" or may be
associated in its subscription with this default PDU Session Type.
NOTE 5: This PDU Session Type has many similarities with the Ethernet PDU
Session Type but services described in bullets 3 and 4 above are not supported
by the Ethernet PDU Session Type.
The support of \"combo IP + Ethernet\" PDU Session type assume that multiple
devices served by the PDU Session may request an IP address at any time during
the lifetime of the PDU Session. The release of an IP address to such device
(e.g. when the DHCP lease has expired) does not release the PDU Session. The
SMF may allocate multiple IPv4 addresses in one PDU session of \"combo IP +
Ethernet\" PDU Session type (when each device has its own IP address). IP
address allocation takes place as in R17, i.e. options for SMF and UPF to
allocate IP address, SMF handling the DHCP signalling, SLAAC etc are supported
There is an unique UDM subscription for the RG regardless of the number of
devices in the customer premises that are subject of a specific handling.
When some devices are subject of a specific service, the identity of these
devices (MAC address) and the parameters of their specific service (e.g.
Access restriction for parental control, dedicated QoS) are configured in the
policy (PCF) data related with the subscription (UDR). Other devices benefit
of a baseline service and do not require to be individually identified in the
policy data related with the subscription (UDR).
### 6.8.2 Description of the solution
The \"Combo Ethernet + IP\" PDU Session Type supports following features:
\- An IP service is delivered at N6 where for example IP addresses are
allocated to individual devices behind the RG. The same IP address allocation
mechanisms (including deferred IPv4 and DHCPV6 IP address allocation) are
supported than in case of RG supported by the IP PDU Session Type.
\- The SMF indicates to the PSA that a PDU Session is of \"Combo Ethernet +
IP\" type at the N4 Session Establishment. Based on this the PSA (UPF) acts as
the first hop router of the devices in the customer premises with regard to
the handling of the layers below IP. The SMF remains responsible of the
RA/RS/ND handling. Especially it supports the behaviour described in bullet 4
of clause 6.8.1 related with \" access side layer 2 header\".
Editor\'s note: It is FFS whether signaling a new \" \'combo Ethernet + IP\'
service\" PDU Session type can be avoided to be signalled by/to the 5G-RG
(i.e. Ethernet PDU Session type can still be signaled by/to 5G-RG).
\- N4 FAR and PDR are those used for an IP PDU Session Type.
\- based on the PDU Session type, the UPF handles the Ethernet layer towards
the UE on its own without instructions from SMF
\- The QER is updated for the SMF to be able to control the Priority Code
Point of the VLAN Headers within the \"access side layer 2 header\".
\- When an IP address/prefix has been allocated to the PDU Session the SMF
reports it together with the corresponding MAC address (of the RG or of a
device behind the RG) to the PCF and the PCF may use this MAC address to
derive policies dedicated to a given device (PCF policy subscription data
stored in UDR for the 5G RG subscription may contain a device category that is
to be handled in a similar way as Subscriber category already defined in
23.503 [4]). For a \"Combo Ethernet + IP\" PCC rules (sent to the SMF) need
only to refer to the IP header. No PCF policy differentiation is defined that
would use the VLAN header received by the UPF over a PDU Session.
\- PCF binding using BSF is based on the IP address of the devices. Service
differentiation upon application (AF) request is also possible using the same
mechanisms (e.g. Npcf_authorization service) as in the case of an IP PDU
Session type: the AF provides requests identifying the IP flow of a terminal
it wants to act upon, session binding with the IP address of the terminal
applies as described in clause 6.1.1.2 of TS 23.503 [4] and the PCF provides
corresponding updated PCC rule. The BSF need not to be aware of \"access side
layer 2 header\".
\- There is no authentication of the devices behind the RG that are identified
by their MAC address.
The following figure shows the message flow for a PDU Session establishment
(copied from Figure 4.3.2.2.1-1 of TS 23.502 [3]). The changes to existing
procedure introduced for the support of the solution are described in the text
below the figure while otherwise the PDU Session Establishment proceeds as
described in existing specifications.
Figure 6.8.2-1: impacts of Combo IP + Ethernet PDU Session Type to 23.502 [3]
Figure 4.3.2.2.1-1: UE-requested PDU Session Establishment for non-roaming and
roaming with local breakout
Step 1: The 5G RG or in case of FN RG the AGF may be configured (e.g. URSP) to
request a PDU Session of the Combo IP + Ethernet PDU Session Type. Other
parameters of the PDU Session may be the same than in IP PDU Session Type
(E.g. the PDU Session establishment request may contain PCO asking for a
P-CSCF address, ACS address, etc.).
Step 4: The subscription data retrieved from the UDM may contain Combo IP +
Ethernet PDU Session Type as allowed PDU Session Type for a subscription.
Step 6 is optional (as in Rel-17 TS 23.502 [3]).
Step 7. The SMF may indicate to the PCF that the PDU Session is of Combo IP +
Ethernet PDU Session Type.
Per PDU Session policies sent by the PCF may contain a control on the Maximum
Number of IP address to allocate as part of the PDU Session to devices in the
customer premises (MNIP).
Step 10a. The N4 session between the SMF and an UPF acting as PSA for the PDU
Session may be associated by the SMF with a Combo IP + Ethernet PDU Session
Type; the SMF controls the UPF to report MAC addresses detected in UL traffic
of the PDU Session.\ If the SMF requests the UPF to forward DHCP/RS (Router
Solicitation) traffic from devices using the PDU Session, the SMF may request
the UPF to report the \"access side layer 2 header\" on which the DHCP/RS has
been received.
Access to ACS (Autoconfiguration server used in BBF TR 069 procedures) is
supported as for IP or Ethernet PDU Session types (e.g. as described in TS
23.316 [5]).
Figure 6.8.2-2: Allocation of an IP address to a device behind the RG
For Combo PDU Session Type, the SMF requests the UPF to forward DHCP / RS
signalling over N4; the reporting from UPF shall contain the MAC address of
the device.
When during the life time of a PDU Session, an IP address is allocated to a
device supported by a PDU Session established with the Combo IP + Ethernet PDU
Session Type, the following applies:
1) In band IP address allocation procedure (RS/RA, DHCPv4, DHCPv6). The SMF /
UPF uses policies received in step 7 of Figure 6.8.2-1 (IP index, max number
of IP addresses for the PDU Session) to determine whether to grant an IP
address to the device and if yes to determine the IP pool / allocation method
to use.
NOTE: The usage of DHCPV4 signalling to allocate IP address to devices behind
the RG does not require sending dedicated NAS signalling with a request of
deferred IP address allocation. ; it is possible that the IP address allocated
to the RG itself is provided via NAS to the RG while in band IP address
allocation applies for the devices behind the RG.
2) If this corresponds to a PCRT (Policy Control Request Trigger) received
previously from the PCF, the SMF initiates the SM Policy Association
Modification procedure described in clause 4.16.5.1 of TS 23.502 [3].
The reception of new policies from the PCF in step 2 may trigger the network
initiated PDU Session modification procedure in clause 4.3.3 of TS 23.502 [3]
which may include a corresponding N4 session modification procedure to create
or update the corresponding PDR/FAR/QER/URR on the UPF and SMF sending updates
of QOS rules to the 5G-RG to apply new QoS flows.
### 6.8.3 Impacts on existing functions
The impact on existing network function is the following:
\- SMF / UPF(N4), UDM and PCF (Npcf) need to support a new PDU Session type.
\- Support of Multiple IP address for a PDU session. The SMF may allocate
multiple IPv4 addresses in one PDU session of \"combo IP + Ethernet\" PDU
Session type.
\- When the N4 session is associated by the SMF with a Combo IP + Ethernet PDU
Session Type, the UPF enforces the behaviour in bullet 4 of clause 6.8.1.
\- Npcf Policy Request Control Trigger mechanism is upgraded for the SMF to be
able to report the allocation of an IP address to a device behind the RG
together with the MAC address of that device.
\- the PCF may apply policies (possibly related with IP level traffic) related
with the MAC address of a device (as reported by the SMF via a Policy Request
Control Trigger). PCF policy subscription data stored in UDR for the 5G RG
subscription may contain a device category that is to be handled in a similar
way as Subscriber category already defined in TS 23.503 [4].
\- The CHF and LI may receive an indication of a new IP address having been
allocated to a PDU Session together with the indication of the corresponding
MAC Address.
\- 5G-RG: Support the new \"combo IP + Ethernet\" PDU Session type value in
NAS signalling
## 6.9 Solution 9: 5GC-capable UE behind 5G-RG using untrusted Non-3GPP access
### 6.9.1 General
The solution is based on the UE behind RG using untrusted Non-3GPP access
architecture as defined in Annex A of TS 23.316 [5]. The 5G-RG and 5GC-capable
UE may belong to the same PLMN or the different PLMN.
Figure 6.9.1: Non-roaming architecture for UE behind 5G-RG using untrusted
N3GPP access
### 6.9.2 Registration procedure
The UE register to the 5GC based on the procedure as defined in clause 4.12.2
of TS 23.502 [3] with the following difference.
\- Before the step 1a, the UE obtains the 5G-RG GUTI from ANQP message, as
defined in clause 6.5.2, step 0.
\- Step 5: the UE sends the Registration Request message to the UE\'s AMF, in
which the 5G-RG GUTI is included in this message as defined in clause 6.5.2
step 1e.
\- After the step 9d, the UE\'s AMF identify the UE role by using the same
solution as defined in clause 6.5.2, from step 5 to step 9.
During the PDU session establishment procedure of the UE, the same procedure
defined in clause 6.5.2 is applied.
### 6.9.3 Impacts on existing Functions
UDM, AMF, PCF, SMF, UE:
\- Same as described in the clause 6.5.3.
5G-RG:
\- The 5G-RG sends the 5G-RG GUTI to the UE via ANQP message.
## 6.10 Solution 10: Registration via Trusted Non-3GPP Access with TNGF
Relocation
### 6.10.1 Description
The solution in this clause defines extensions to the \"5GC registration via
trusted non-3GPP access\" procedure, which enable the AMF to select a
different TNGF to serve the UE, when the originally selected TNGF cannot
support the slices needed by the UE.
The solution follows the principles agreed for TEI17_N3SLICE, i.e. that each
TNGF may be locally configured with one TAI value and a corresponding set of
S-NSSAIs.
The key steps of the solution are summarized as follows:
a) The UE selects a PLMN and a trusted non-3GPP access that supports 5G
connectivity with this PLMN, as specified in clause 6.3.12 of TS 23.501 [2].
b) An EAP procedure is initiated between the UE and the selected trusted
non-3GPP access. The realm provided by the UE in NAI
(\"\\@nai.5gc.mnc\.mcc\.3gppnetwork.org\") is used to
select a TNGF that supports 5G connectivity with the selected PLMN. This TNGF
is selected without considering any slice information.
c) The UE sends a Registration Request message via the selected TNGF, as
specified in clause 4.12a.2.2 of TS 23.502 [3]. The selected TNGF selects an
AMF and forwards to this AMF the Registration Request message. If the
Requested NSSAI is received by the selected TNGF (according to the conditions
defined in clause 5.15.9 of TS 23.501 [2]), then the TNGF selects an AMF by
considering also the Requested NSSAI (as defined in clause 6.3.5 of TS 23.501
[2]).
d) The AMF (either the one selected by TNGF, or the one selected after AMF re-
allocation, as defined in clause 5.15.5.2.3 of TS 23.501 [2]) identifies
whether the selected TNGF can or cannot support the slices requested by the
UE. The AMF knows the slices supported by each TNGF connected with the AMF
because (as defined in TS 38.413 [7]), the N2 Setup Request message sent from
TNGF to AMF includes the supported TAI and the supported S-NSSAIs for this
TAI.
If the selected TNGF cannot support the slices requested by the UE, and if
there is another TNGF that can serve this UE and can support the slices
requested by the UE, then the AMF triggers TNGF relocation, i.e. requests to
substitute the selected TNGF with a new TNGF. This TNGF relocation does not
interrupt the ongoing registration procedure. The registration procedure
continues but the UE is instructed to establish a NWt connection with the new
TNGF.
The AMF can decide to trigger TNGF relocation based on its own criteria.
Typically, the AMF considers the Requested NSSAI provided by the UE, the
Subscribed NSSAI and the S-NSSAIs supported by all TNGFs that can serve the
UE.
Editor\'s note: Many TNGFs can be connected to the AMF. How the AMF can
determine which of these TNGFs can serve the UE is FFS.
Editor\'s note: When the NSSF is used for selecting the serving AMF, it is FFS
whether and how the NSSF has knowledge of the TAI supported by TNGF.
e) As a result, the 5G registration procedure is completed and a new TNGF is
selected by AMF, which can support all (or the most) S-NSSAIs requested by the
UE.
More details can be found in the next clause. No changes are made to the slice
selection procedure and to the AMF selection for serving AMF.
### 6.10.2 Procedures
#### 6.10.2.1 Registration via trusted non-3GPP access with TNGF relocation
The procedure specified in this clause extends the registration procedure for
trusted non-3GPP access specified in clause 4.12a.2.2 of TS 23.502 [3], in
order to support TNGF relocation. During the registration via trusted non-3GPP
access, the AMF may trigger TNGF relocation as defined in the previous clause.
Figure 6.10.2.1-1: Registration via trusted non-3GPP access with TNGF
relocation
The steps in Figure 6.10.2.1-1 are the same steps as in Figure 4.12a.2.2-1 of
TS 23.502 [3] (registration via trusted non-3GPP access) with the following
additions and clarifications:
3\. The TNAP selects a TNGF, referred to as TNGF-1. The TNGF-1 is selected by
using the NAI provided by the UE and, optionally, the non-3GPP access network
identity (e.g. SSID) requested by the UE.
6b. If the AMF determines that the Registration Request should be served by
another AMF (e.g. as defined in clause 5.15.5.2 of TS 23.501 [2]), the AMF
initiates AMF re-allocation and forwards the Registration Request to another
AMF (see clause 5.15.5.2.3 of TS 23.501 [2]).
10a. The AMF decides to trigger TNGF relocation and use TNGF-2 instead of
TNGF-1. For taking this decision, the AMF may consider the Requested NSSAI
provided by the UE, the Subscribed NSSAI for this UE, the S-NSSAIs supported
by other TNGFs connected to AMFs, and other information. The AMF knows the
slices supported by each TNGF connected with the AMF because (as defined in TS
38.413 [7]), the N2 Setup Request message sent from TNGF to AMF includes the
supported TAI and the supported S-NSSAIs for this TAI.
If the AMF decides to trigger TNGF relocation, then the AMF shall include in
the N2 Initial Ctx Setup Request the TNGF-2 IP address, indicating that the
AMF wants to relocate the UE to TNGF-2. When TNGF-1 receives message 10a, it
recognizes that the TNGF Address contains an IP address of another TNGF,
hence, it recognizes that the AMF requests TNGF relocation.
Editor\'s note: It is FFS whether N2 Initial Ctx Setup Request or a N2
handover related message is used for this purpose.
Editor\'s note: Instead of sending an N2 Initial Ctx Setup Request in step
10a, the AMF could send a new N2 message used for TNGF relocation, e.g. a TNGF
Relocation Command. In this case, the TNGF-1 would respond with a TNGF
Relocation Response in step A1. It is FFS whether such a new N2 message is
preferable.
10b. The TNGF Address sent to UE is the TNGF-2 IP address provided by AMF.
After receiving this message, the UE does not switch to a different SSID, if
the non-3GPP access network supports SSIDs (such as WLAN access networks). It
is assumed that the same SSID can support multiple S-NSSAIs.
Editor\'s note: Whether there is need for the UE to switch to a different SSID
after receiving step 10b is FFS.
A1. After receiving an EAP-Response/5G-Notification packet from the UE in step
10c, the TNGF-1 shall send message 10d containing the EAP-Success packet. In
addition, TNGF-1 shall respond to AMF with an N2 Initial Context Setup Failure
message (see TS 38.413 [7]) with a Cause value indicating that the failure is
because of the requested TNGF relocation. If needed, this message may also
contain some information that shall be transparently forwarded to TNGF-2 (via
the AMF).
A2. The N2 Initial Context Setup Failure message triggers the AMF to send an
N2 Initial Context Setup Request to TNGF-2 including the TNGF key, the UE
identity and, if received in step A1, the information that shall be
transparently forwarded to TNGF-2.
13\. The UE sets up a secure NWt connection using the TNGF address received in
step 10b, i.e. with TNGF-2. All further communication between the UE and the
AMF takes place via TNGF-2.
NOTE: In the above registration procedure, the EAP-5G protocol runs between
the UE and TNGF-1, while the NWt connection is established between the UE and
TNGF-2.
### 6.10.3 Impacts on Existing Nodes and Functionality
UE:
\- No impact.
TNGF-1 (used for EAP-5G):
\- Shall be able to recognize when the AMF requests relocation (by inspecting
the TNGF Address in step 10a) and shall respond to AMF with N2 Initial Context
Setup Failure after receiving an EAP-Response/5G-Notification packet from the
UE (which indicates that the UE has received the IP address of TNGF-2).
TNGF-2 (used for NWt connection establishment):
\- Shall be able to receive N2 Initial Context Setup Request from an AMF
without having an EAP-5G session with a UE and shall be able to establish an
NWt connection with the UE by using the UE identity and the TNGF key included
in the N2 Initial Context Setup Request.
AMF:
\- Shall be able to trigger TNGF relocation, e.g. based on the Requested NSSAI
provided by the UE, the Subscribed NSSAI for this UE, the S-NSSAIs supported
by all TNGFs that can serve the UE, and other information. The AMF shall
include in the N2 Initial Ctx Setup Request (step 10a) the IP address of the
new TNGF.
\- The AMF triggers the establishment of an N2 association for the UE via N2
Initial Context Setup Request. After receiving the N2 Initial Context Setup
Failure from TNGF-1 with a cause value indicating TNGF relocation, the AMF
shall send and N2 Initial Context Setup Request to TNGF-2 including the TNGF
key and the UE identity. This N2 Initial Context Setup Request establishes the
N2 association for the UE.
## 6.11 Solution 11: Registration via Untrusted Non-3GPP Access with N3IWF
Relocation
### 6.11.1 Description
The solution in this clause defines extensions to the \"5GC registration via
untrusted non-3GPP access\" procedure, which enable the AMF to select a
different N3IWF to serve the UE, when the originally selected N3IWF cannot
support the slices needed by the UE.
The solution follows the principles agreed for TEI17_N3SLICE, i.e. that each
N3IWF may be locally configured with one TAI value and a corresponding set of
S-NSSAIs.
The key steps of the solution are summarized as follows:
a) The UE selects a PLMN and an N3IWF in this PLMN as specified in clause
6.3.6.2 of TS 23.501 [2], \"Stand-alone N3IWF selection\". This N3IWF is
selected without considering any slice information.
b) The UE initiates an IKE_AUTH exchange with the selected N3IWF and sends a
Registration Request message via this N3IWF, as specified in clause 4.12.2.2
of TS 23.502 [3]. The selected N3IWF selects an AMF by using information
provided by the UE, including the Requested NSSAI, and forwards to this AMF
the Registration Request message.
c) The AMF (either the one selected by N3IWF, or the one selected after AMF
re-allocation, as defined in clause 5.15.5.2.3 of TS 23.501 [2]) identifies
whether the selected N3IWF can or cannot support the slices requested by the
UE. The AMF knows the slices supported by each N3IWF connected with the AMF
because (as defined in TS 38.413 [7]) the N2 Setup Request message sent from
N3IWF to AMF includes the supported TAI and the supported S-NSSAIs for this
TAI.
If the selected N3IWF cannot support the slices requested by the UE, and if
there is another N3IWF that can serve this UE and can support the slices
requested by the UE, then the AMF triggers N3IWF relocation, i.e. requests to
substitute the selected N3IWF with a new N3IWF. This N3IWF relocation does not
interrupt the ongoing registration procedure. The registration procedure
continues but the UE is instructed to establish a NWu connection with the new
N3IWF.
The AMF can decide to trigger N3IWF relocation based on its own criteria.
Typically, the AMF considers the Requested NSSAI provided by the UE, the
Subscribed NSSAI and the S-NSSAIs supported by all N3IWFs connected to this
AMF.
Editor\'s note: When the NSSF is used for selecting the serving AMF, it is FFS
whether and how the NSSF has knowledge of the TAI supported by N3IWF.
d) As a result, the 5G registration procedure is completed and a new N3IWF is
selected by AMF, which can support all (or the most) S-NSSAIs requested by the
UE.
More details can be found in the next clause. No changes are made to the slice
selection procedure and to the AMF selection for serving AMF.
### 6.11.2 Procedures
#### 6.11.2.1 Registration via untrusted non-3GPP access with N3IWF relocation
The procedure specified in this clause extends the registration procedure for
untrusted non-3GPP access specified in clause 4.12.2.2 of TS 23.502 [3], in
order to support N3IWF relocation. During the registration via untrusted
non-3GPP access, the AMF may trigger N3IWF relocation as defined in the
previous clause.
Figure 6.11.2.1-1: Registration via untrusted non-3GPP access with N3IWF
relocation
1-7. Same as figure 4.12.2.2-1, steps 1-8 of TS 23.502 [3], with the following
clarification:
\- If the AMF determines that the Registration Request received in step 6b
should be served by another AMF (e.g. as defined in clause 5.15.5.2 of TS
23.501 [2]), the AMF initiates AMF re-allocation and forwards the Registration
Request to another AMF (see clause 5.15.5.2.3 of TS 23.501 [2]).
9a. The AMF decides to trigger N3IWF relocation and use N3IWF-2 instead of
N3IWF-1. For taking this decision, the AMF may consider the Requested NSSAI
provided by the UE, the Subscribed NSSAI for this UE, the S-NSSAIs supported
by all N3IWFs connected to AMF, and other information. The AMF knows the
slices supported by each N3IWF connected with AMF because (as defined in TS
38.413 [7]) the N2 Setup Request message sent from N3IWF to AMF includes the
supported TAI and the supported S-NSSAIs for this TAI.
The AMF sends a N3IWF Relocation Command to N3IWF-1 that contains a Security
Mode Control (SMC) Request message, in order to establish a NAS security
context for this UE and protect further NAS messages. In this message, the AMF
also includes the address of N3IWF-2 and an AMF identity, e.g. a Globally
Unique AMF Identifier (GUAMI) or an IP address of AMF. The N3IWF-1 forwards to
UE the received SMC Request message, the N3IWF-2 address and the AMF identity,
inside an EAP 5G-NAS packet.
Editor\'s note: It is FFS whether the AMF sends a N3IWF Relocation Command or
an existing NGAP handover related message is used for this purpose.
10\. Since the UE receives an N3IWF address in step 9b, the UE determines that
it should select another N3IWF. Therefore, the UE sends an EAP 5G-Stop packet,
which (as specified in TS 24.502 [8]) triggers the N3IWF-1 to terminate the
ongoing IKE procedure by sending an IKE_INFORMATIONAL request message
containing an EAP-Failure and an appropriated error cause.
After this step, the N3IWF-1 could release the N2 connection with the AMF.
However, since the release of the N2 connection may affect the ongoing 5G
registration procedure, the N3IWF-1 may delay the release of the N2 connection
with the AMF and wait for AMF to release the N2 connection.
11-12. The UE starts the establishment of a new NWu connection with the N3IWF
address received in step 9b (i.e. N3IWF-2).
13\. The UE sends an IKE_AUTH request to N3IWF-2, which includes an EAP-
Response/5G-NAS packet that contains the AN-Params and a SMC Complete message,
which is a response to the SMC Request message received in step 9b. The AN-
Params contains a UE identity (e.g. SUCI or 5G-GUTI), an Establishment cause,
(optionally) a Requested NSSAI, and the AMF identity received in step 9b. The
presence of the AMF identity in this message indicates to N3IWF-2 that this
message is sent due to N3IWF relocation. Alternatively, the Establishment
cause may contain a value that indicates to N3IWF-2 that this message is sent
due to N3IWF relocation.
NOTE: Although the UE reconnected to a new N3IWF, the NAS registration
procedure between the UE and the AMF is _resumed_ via the new N3IWF. The
registration procedure is not interrupted due to the N3IWF relocation.
14\. The N3IWF-2 selects the same AMF based on the received AMF identity and
forwards the SMC Complete message to the AMF inside a N3IWF Relocation Notify.
This message also contains the UE identity so that the AMF can associate the
received SMC Complete message with the appropriate UE context and resume the
ongoing registration procedure for this UE. The N3IWF Relocation Notify
message creates a new N2 connection associated with the UE. Note that the
N3IWF-2 decides to send a N3IWF Relocation Notify message to AMF (and not an
Initial UE Message) because it determines that the message in step 13 is sent
to due to N3IWF relocation.
After the AMF receives the N3IWF Relocation Notify from N3IWF-2, the AMF may
have two different N2 connections associated with the same UE: one with
N3IWF-1 setup in step 6b and another with N3IWF-2 setup in step 14b.
Therefore, the AMF is expected to release the N2 connection with N3IWF-1,
which is not required anymore. The messages exchanged for releasing this N2
connection are not shown in the above figure.
Editor\'s note: Whether the UE Id is needed in message 14b is FFS. It should
be studied whether the SMC Complete message is enough for AMF to associate
message 14b with an existing UE context.
15-21. Same as figure 4.12.2.2-1, steps 10-13 of TS 23.502 [3].
After the above signalling flow the UE registration to 5GC is completed and
the initially selected N3IWF-1 is relocated to N3IWF-2, which supports the
S-NSSAI allowed for the UE.
### 6.11.3 Impacts on Existing Nodes and Functionality
Editor\'s note: The impacts on existing nodes will be provided in a future
update of this solution.
## 6.12 Solution 12: slice related TNGF selection for WLAN access
### 6.12.1 Description
The solution addresses slice related TNGF selection for WLAN access. Other
types of non-3GPP access are not covered by this solution.
Current (Rel-17) clause 6.3.12 of TS 23.501 [2] specifies that a non-3GPP
access network may advertise \"3GPP Cellular Network\" information, by using
the ANQP protocol, defined in the HS2.0 specification [6]. A non-3GPP access
network (WLAN) may via ANQP \"3GPP Cellular Network\" information advertise
(per Current (Rel-17) clause 6.3.12 of TS 23.501 [2]):
\- A PLMN List-3, which includes PLMNs with which \"5G connectivity\" is
supported. A non-3GPP access network supports \"5G connectivity\" with a PLMN
when it deploys a TNGF function that can connect with an AMF function and an
UPF function in this PLMN via N2 and N3 interfaces, respectively.
The solution proposes to extend this capability in order for the UE to be able
to select a SSID mapping at best capable to support the NSSAI the UE wishes to
register to over trusted non-3GPP access. The solution assumes that all TNGFs
reachable via the same SSID support the same set of S-NSSAI(s). Hence
selecting on a TNAP a SSID that supports the slices targeted by the UE allows.
\- To implicitly select a TNGF that supports the slices targeted by the UE.
\- To possibly benefit from slice related policies configured on the TNAP for
this SSID.
The ANQP \"3GPP Cellular Network\" information when indicating \"5G
connectivity\" may also advertise:
a) a list of S-NSSAI(s) that the TNGF(s) reachable by the corresponding SSID
support; or
b) a list of Network Slice Non-3GPP Access Groups (NSNAGs that the TNGF(s)
reachable by the corresponding SSID support. Each NSNAG is associated with one
or more S-NSSAIs. A NSNAG is the equivalent of a NSAG (as defined in clause
9.11.3.87 of TS 24.501 [14] but with an empty TA list) defined for Trusted
Non-3GPP access selection.
Editor\'s note: Whether the ANQP \"3GPP Cellular Network\" information
contains a list of S-NSSAIs or a list of NSNAGs will be decided at the TR
conclusion phase.
The NSNAG Information, that applies for the UE to access via TNGF to the 5GC
of a PLMN is provided to the UE by an AMF of that PLMN in NAS registration
signalling. Different information may be provided for NG RAN (NSAG) and for
TNGF access (NSNAG). The AMF may provide the UE with NSNAG information for
TNGF access even though the UE is registering over 3GPP access. NSNAG
information for TNGF access is not associated with a TA and is valid to select
a TNGF all over a PLMN. The UE stores NSNAG Information after deregistration.
NOTE 1: The NSAG configuration for NG-RAN may not fit for TNGF selection.
NOTE 2: The advantage of containing NSNAGs in the \"3GPP Cellular Network\"
information, instead of S-NSSAIs, is to avoid disclosing the network slices
supported by each PLMN, which can be sensitive information. Note that the
\"3GPP Cellular Network\" information is provided to the UE prior to WLAN
association and, therefore, is provided without confidentiality protection.
NOTE 3: The actual format of NSNAG is up to CT WG1.
### 6.12.2 Procedures
The UE runs the trusted WLAN selection process described in clause 6.3.12.2 of
TS 23.501 [2] up to step 3.
In step 3, it is assumed that the UE selects \"5G connectivity\" for
connecting to the selected PLMN (i.e. the PLMN selected in step 2).
Step 4 of clause 6.3.12.2 of TS 23.501 [2] is modified as follows to take into
account the NSSAI the UE wishes to register to over trusted WLAN access, as
well as the ANQP \"3GPP Cellular Network\" information advertisement of the
list of S-NSSAI(s) or the list of Network Slice Non-3GPP Access Groups
(NSNAGs) that the TNGF(s) reachable by the corresponding SSID may support.
NOTE: The list of S-NSSAI(s) that the TNAP advertises over ANQP for a SSID is
a subset of the list of S-NSSAI(s) associated with the TAI that the TNGF has
provided to the AMF in the N2 Setup Request message (TS 38.413 [7]).
Step 4: The UE selects a non-3GPP access network to connect to, as follows
(only step a is modified):
a. The UE puts the available non-3GPP access networks in priority order. For
WLAN access, the UE constructs a prioritized list of WLAN access networks by
using the WLANSP rules (if provided) and the procedure specified in clause
6.6.1.3 of TS 23.503 [4], as well as by using the Requested NSSAI of the UE
and the slicing information advertised within the ANQP \"3GPP Cellular
Network\" information. If the UE is not provided with WLANSP rules, the UE
constructs the prioritized list of WLAN access networks by using an
implementation specific procedure. For other types of non-3GPP access, the UE
may use access specific information to construct this prioritized list
User Preferences On Non-3GPP Access Selection take precedence over the WLANSP
rules and selection based on the target Requested NSSAI; the steps A1. to A3.
below apply if such user preferences are non- existent or cannot be fulfilled.
A1 The UE first tries to find a WLAN access where there is a match between the
target Requested NSSAI of the UE and the slicing information advertised over
ANQP \"3GPP Cellular Network\" information, using the descending priority of
otherwise valid WLAN SP rules as defined in TS 23.503 [4] clause 6.6.1.3.: the
algorithm defined in TS 23.503 [4] clause 6.6.1.3 applies, removing the WLAN
access(es) where there is no match between the target Requested NSSAI of the
UE and the slicing information advertised over ANQP \"3GPP Cellular Network\"
information.
A2 If step A1 failed i.e. UE cannot register over a WLAN access where there is
a full match between the target Requested NSSAI of the UE and the slicing
information advertised over ANQP \"3GPP Cellular Network\" information: if the
UE can determine a set of lower priority slices in the target Requested NSSAI
of the UE, the UE removes these lower priority slices from the target
Requested NSSAI and retries the step A1 above.
A3 Otherwise (if steps A1 and A2 failed) the UE applies the procedure of TS
23.503 [4] clause 6.6.1.3 without taking into account the target Requested
NSSAI of the UE.
b.
d. Over the selected non-3GPP access network, the UE starts the 5GC
registration procedure specified in clause 4.12a.2.2 of TS 23.502 [3].
The UE may then register to the 5GC using the selected TNAP and SSID (thus
using a TNGF that supports its slicing requirements)
If the UE registers with a requested NSSAI equal to the Default Configured
NSSAI (first registration in the serving PLMN), it may happen that the UE
receives a Configured-NSSAI for the serving PLMN and an allowed NSSAI that
contains more S-NSSAI(s) where there are more S-NSSAI(s) in the Configured-
NSSAI for the serving PLMN than in the Allowed NSSAI. In that case the UE can
retry trusted WLAN selection in that PLMN using the Configured NSSAI for the
Serving PLMN as Requested NSSAI.
AMF rejection in case of usage of a wrong TNGF.
The AMF may determine that the TNGF used by the UE is not appropriate but that
the UE should use another TNGF and thus another SSID. The TNGF/SSID used by
the UE may not be appropriate because e.g.:
\- the TNGF used by the UE does not support the slices requested by the UE and
allowed by subscription; or
\- there is another TNGF that would better serve the UE.
In this case, the AMF rejects the registration of the UE. The Registration
Reject conveys a dedicated cause like \"the selected TNGF/ SSID is not
suitable due to slicing\". Additionally, the AMF may provide information on
another suitable alternative SSID that provides access to a TNGF that
satisfies the slices requested by the UE and allowed by subscription.
The UE then may use the new/alternate SSID received from the AMF.
### 6.12.3 Impacts on Existing Nodes and Functionality
\- No impact on TNGF.
\- TNAP is to advertise per SSID information on the slices that the TNGF(s)
reachable by the corresponding SSID support. This advertisement is done via
ANQP \"3GPP Cellular Network\" information that is also indicating \"5G
connectivity\":
\- Whether the slicing information advertised by ANQP corresponds to a list of
S-NSSAI(s) or to a list of Network Slice Non-3GPP Access Groups (NSAGs) will
be decided at the TR conclusion phase.
\- UE is to leverage this information to determine the priority order of
available non-3GPP access networks per a modified clause 6.3.12 of TS 23.501
[2] process.
\- The AMF:
\- may reject the registration of the UE with a dedicated cause like \"the
selected SSID is not suitable due to slicing\". Additionally, the AMF may
provide information on another suitable alternative SSID that could satisfy
the UE\'s NSSAI needs;
\- is configured with SSID to use to reach a (set of) slices (e.g. a NSNAG).
NOTE 1: This requires extra configuration than AMF just knowing the S-NSSAI(s)
supported by the TNGF. But it allows the UE to get to a SSID that actually
meets its slicing requirement (whereas redirecting the UE to another TNGF,
would have implied reusing the same SSID, which would have meant still using a
SSID that does not meet the slice requirements of the UE).
NOTE 2: This solution does not modify the state machines of the TNGF and does
not modify the state machine of the registration procedure while allowing the
AMF to indicate to UE(s) with specific subscriptions (e.g. public Safety
related subscription) to use SSID(s) otherwise hidden from regular UE(s).
## 6.13 Solution 13: UE getting the slices supported by N3IWF (s)
### 6.13.1 Description
The solution assumes that the UE(s) can themselves select the N3IWF that
supports the set of slices they wish to use. As part of the N3IWF selection
procedure defined in clause 6.3.6 of TS 23.501 [2], when a UE has selected a
PLMN and has a set of candidate N3IWF(s), the UE may issue a Slice Support Get
request to each of these N3IWF. Upon receiving a Slice Support Get request, a
N3IWF answers with the list of slices this N3IWF supports. Then, the UE takes
into account the set of slices it wishes to use and the slices supported by
the candidate N3IWF as indicated in Slice Support Get responses to select a
N3IWF that best supports the slices the UE wishes to use.
\- The set of slices the UE wishes to use maps to Requested NSSAI if the N3IWF
selection is part of a UE registration request over N3IWF, and maps to Allowed
NSSAI if the N3IWF selection is part of a UE service request over N3IWF.
In the case that the UE selects a N3IWF that does not align with its slicing
requirement, the UE\'s request may be rejected with appropriate cause and UE
may repeat its registration.
### 6.13.2 Procedures
#### 6.13.2.1 Baseline N3IWF discovery using slice support get
Figure 6.13.2.1-1:Baseline N3IWF discovery using slice support get
1\. UE discovery of candidate N3IWF according to Rel-17 clause 6.3.6 of TS
23.501 [2] (Rel-17), including PLMN selection (possibly taking into account
the need to select a N3IWF in the local country) and including choice between
N3IWF and EPDG and up to the point where the UE has received from DNS the IP
addresses of candidate N3IWF; Using S-NAPTR DNS procedure the UE may discover
which N3IWF supports the Slice Support Get request procedure, based on a
dedicated S-NAPTR \"Service Parameter\" (equivalent to \"x-3gpp-sgw:x-s5-gtp\"
defined in TS 29.303 [13]).
2 and 4. The UE sends a Slice Support Get request to each N3IWF.
A Slice Support Get request may optionally contain the set of slices (S-NSSAI)
the UE wishes to use (indicating to N3IWF that there is no need to answer with
slices outside this set).
3 and 5. The N3IWF sends a Slice Support Get response that contains the set of
slices (S-NSSAI) the N3IWF supports. This set of slices (S-NSSAI) is
restricted to contain only a subset of the set of slices (S-NSSAI) the UE has
indicated in the Slice Support Get request. It may also contain a caching
information telling the UE how long the UE should consider this information
(received in a Slice Support Get response) valid for.
It is up to UE\'s policy to determine how many N3IWFs the UE may need to query
(sending a sends a Slice Support Get) as part of this procedure. The UE may
stop sending a sends a Slice Support Get once it has got a N3IWF that supports
the slices it wishes to use.
The UE does not need to perform the discovery each time it needs to connect to
an N3IWF as it may cache the information received in a Slice Support Get
response. The caching timer sent by a N3IWF ensures that the UE does not use
stale information. Even if the UE would use stale information the procedure in
clause 6.13.2.2 can tell the UE that it used a wrong N3IWF.
This procedure is stateless: the N3IWF does not need to store any information
related with a Slice Support Get request. The Slice Support Get service is not
meant to change the state of the N3IWF (as the UE just gets information).
The Slice Support Get service may be designed as a new (HTTPs) API exposed by
the N3IWF to the UE and defined by 3GPP.
TLS connections may be used between the UE and the N3IWF from steps 2 to 5\.
The N3IWF is assumed to provide a server certificate as it does over IKE
within R17 specifications.
Security aspects for this new HTTP API are to be specified by SA WG3.
6\. Based on the information received from N3IWF in Slice Support Get
response, the UE selects the N3IWF it will contact to access to the 5GC.
7\. The UE connects to 5GC over the selected N3IWF, here N3IWF1, per R17
specifications.
NOTE 1: The procedure requires to run, as per R17 specifications, only once
the IKE_SA_Init procedure which requires heavy computation
NOTE 2: Selection of a N3IWF also based on tracking area is possible as the UE
contacts N3IWF based on currently configured information.
If within the set of candidate N3IWF(s) there are N3IWF(s) that support the
Slice Support Get procedure and others that don\'t, the UE selects the N3IWF
to use in the following descending order of priority:
1\. N3IWF(s) that support the Slice Support Get procedure and that have
indicated they support the set of slices (S-NSSAI) the UE wishes to use.
2\. N3IWF(s) that don\'t support the Slice Support Get procedure.
3\. N3IWF(s) that support the Slice Support Get procedure and that have
indicated they don\'t support some set of slices (S-NSSAI) the UE wishes to
use.
It is left implementation specific how UE considers N3IWF(s) that support the
Slice Support Get procedure and that have indicated they support only a subset
of the slices (S-NSSAI) the UE wishes to use.
#### 6.13.2.2 AMF rejection in case of usage of a wrong N3IWF
Figure 6.13.2.2-1: UE Rejection by AMF for Invalid N3IWF Selection
Steps 1-6: Same as steps 1-6 defined in 6.13.2.1
Step 7: The UE connects to 5GC over the selected N3IWF, here N3IWF1, as per
Rel-17 steps 2-7 in clause 4.12.2.2 of TS 23.502 [3].
Step 8: The AMF may have the UE authenticated by the AUSF. The AMF gets
slicing subscription information from the UDM and the allowed/rejected NSSAI
from the NSSF.
Step 9: This clause assumes that the AMF determines that the N3IWF used by the
UE is not appropriate but that the UE should use another N3IWF. The N3IWF used
by the UE may not be appropriate because e.g.:
\- the N3IWF used by the UE does not support the slices requested by the UE
and allowed by subscription; or
\- there is another N3IWF that would better serve the UE.
The AMF rejects the registration of the UE. The Registration Reject conveys a
dedicated cause like \"the N3IWF selected is not suitable due to slicing\".
Additionally, the AMF may provide information on another suitable alternative
N3IWF (FQDN or IP address(es)) that could satisfy the slices requested by the
UE and allowed by subscription.
Step 10: The UE then may use the new/alternate N3IWF received from the AMF.
#### 6.13.2.3 Rejection by N3IWF with cause
Figure 6.13.2.3-1: UE rejected by N3IWF with cause
Steps 1: Same as steps 1 defined in clause 6.13.2.1
Steps 2 and 4: The UE sends a Slice Support Get request to N3IWF.
A Slice Support Get request may contain the set of slices (S-NSSAI) the UE
wishes to use (indicating to N3IWF that there is no need to answer with slices
outside this set).
Step 3: The N3IWF1 determines that it does not support UE\'s slicing
requirements. Therefore, N3IWF1 rejects UEs request with cause \"Slice not
supported\".
Step 5: The N3IWF2 determines that it supports UE\'s slicing requirements.
Therefore, N3IWF2 responds UEs request with the list of slices it supports.
Steps 6.and 7: Same as steps 6-7 defined in clause 6.13.2.1.
### 6.13.3 Impacts on Existing Nodes and Functionality
This new solution impacts:
\- the UE:
\- discover which N3IWF supports the Slice Support Get request procedure;
\- support new Slice Support Get procedure;
\- N3IFW selection based on additional information received from N3IWF;
\- support the new NAS rejection (see AMF impacts).
\- the N3IWF:
\- support new Slice Support Get procedure).
\- The AMF:
\- may reject the registration of the UE with a dedicated cause like \"the
N3IWF selected is not suitable due to slicing\". Additionally, the AMF may
provide information on another suitable alternative N3IWF (FQDN or IP
address(es)) that could satisfy the UE\'s NSSAI needs.
NOTE: This solution does not modify the state machines of the N3IWF and does
not modify the state machine of the registration procedure while allowing the
AMF to indicate to UE(s) with specific subscriptions (e.g. public Safety
related subscription) to use N3IWF(s) whose FQDN is otherwise hidden from
regular UE(s).
## 6.14 Solution 14: use of AN NRF
### 6.14.1 Description
The UE performs a N3IWF discovery procedure to a new \"AN NRF\" (similar to
5GC NRF defined in TS 23.501 [2]), to which N3IWFs register the set of Slices
(S-NSSAI(s)) they support (reusing Nnrf_NFManagement_NFRegister service
operation as defined in TS 23.502 [3] or a new similar service operation
supported by a new NF).
The AN NRF is for security reason assumed to be a different NF hosted by a
different platform than the 5GC NRF.
UE(s) only needs to perform ONE \"AN NRF\" query (reusing
Nnrf_NFDiscovery_NFDiscover service operation as defined in TS 23.502 [3]),
not as many queries as there are N3IWFs.
UEs discover the \"AN NRF\" node via a DNS query as the AN NRF has a well
known FQDN (to be defined in TS 23.003 [12]).
NOTE: As an example, the well-known FQDN pattern could be something like:
\"an-nrf.5gc.mnc\.mcc\.pub.3gppnetwork.org\" where the \ and
\ identify the PLMN where the N3IWF is to be located.
### 6.14.2 Procedures
The procedure of Figure 6.14.2-1 and/or Figure 6.14.2-2 are run independently
of any UE attempt to get N3IWF access. The N3IWF information newly configured
on the AN NRF may contain one or multiple S-NSSAI(s) (with possible
wildcarding) and one or multiple N3IWF public IP addresses for use by UEs
issuing connecting to the N3IWF (Nwu N3IWF IP address).
Figure 6.14.2-1: N3IWF registering onto AN NRF
Figure 6.14.2-2: N3IWF updating an existing registration onto AN NRF
Figure 6.14.2-4: UE discovering suitable N3IWF using AN NRF
The AN NRF may take into account both the list of target S-NSSAI requested by
the UE and the UE IP address (source address of the AN NRF request) to
determine a best matching N3IWF that serves the list of target S-NSSAI
requested by the UE and whose Nwu N3IWF IP address is IP close to the UE IP
address. The AN NRF may also take into account 3GPP TA information provided by
the UE.
The Discovery of the AN NRF is not meant to change the state of the AN NRF (as
the UE just gets information). The AN NRF is assumed to provide a server
certificate.
Security aspects for usage of AN NRF are to be specified by SA WG3.
### 6.14.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
\- Addition of a new AN NRF.
\- N3IWF register onto the AN NRF.
\- UE issue a discovery request to AN NRF.
## 6.15 Solution #15: Selecting N3IWF supporting the S-NSSAI needed by UE
### 6.15.1 Description
This solution aims at addressing Key Issue #2 about how to select a TNGF/N3IWF
that supports the S-NSSAI(s) needed by the UE. In particular, this solution
mainly focuses on how to select a N3IWF that supports the S-NSSAI(s) needed by
the UE.
The solution provides two methods to select a N3IWF that supports the
S-NSSAI(s) needed by the UE:
\- UE configuration: Key idea is to enhance the N3IWF identifier configuration
and to amend the non-3GPP access node selection information with information
about supported S-NSSAI(s) per N3IWF. Access Network Discovery & Selection
policy (ANDSP) was designed to be provided to UE by the network for selection
of N3IWF. Adding the supported S-NSSAI(s) in ANDSP allows UE to determine an
appropriate N3IWF that supports the S-NSSAI(s) needed by the UE during N3IWF
selection procedure.
\- NAS-based redirection: When UE connects with a N3IWF that does not support
the S-NSSAI(s) needed by the UE, AMF can determine the target N3IWF which
supports the S-NSSAI(s) needed by the UE and provides the target N3IWF
information to UE via Registration Reject message so that UE can use the
target N3IWF information to connect with the target N3IWF in order to meet the
requirement of the UE. Redirection can be applied by the AMF based on the
slices supported by the N3IWFs in the network .
### 6.15.2 N3IWF selection solution
#### 6.15.2.1 UE configuration
The H-PCF may provide the UE with the following information for the HPLMN
(which the UE stores and applies as described further below):
\- Extended Home N3IWF identifier configuration (one or multiple entries)
\- FQDN or IP address of the N3IWF in the HPLMN and the S-NSSAIs supported by
this N3IWF
\- Slice-specific N3IWF prefix information for the HPLMN (one or multiple
entries)
\- List of supported S-NSSAIs
\- Prefix to be added to the existing Tracking Area (TA) or Operator
Identifier (OI) FQDNs
The V-PCF may provide the UE with the following information for that VPLMN
(which the UE stores and applies as described further below):
\- Slice-specific N3IWF prefix information for that VPLMN (one or multiple
entries)
\- List of supported S-NSSAIs
\- Prefix to be added to the existing TA or OI FQDNs
NOTE 1: It is assumed that the UE will indicate its supports of extended N3IWF
configuration to the PCF. The details of the indication can be specified by
CT1.
To enable the V-PCF to provide the UE with slice specific N3IWF configuration
information, the AMF provides the V-PCF with the Configured NSSAI for the
serving PLMN during UE Policy Association Establishment/Modification. The PCF
(V-PCF in the roaming case) is assumed to be locally configured with
information about the slices supported by the different N3IWFs in the serving
PLMN.
NOTE 2: The PCF already receives the subscribed NSSAI from the UDR, therefore
there is no need for the AMF to provide the Configured NSSAI to the PCF in the
non-roaming case.
#### 6.15.2.2 N3IWF selection
This clause describes N3IWF selection based on the additional information
listed in the previous clause as delta on top of the existing N3IWF selection.
Since the full details of N3IWF selection are only covered by Stage 3 specs,
the delta is described on top of TS 24.502 [8]:
\- UE is located in its home country:
\- The procedures described in Rel-17 clauses 7.2.4.3 and 7.2.4.4 of TS 24.502
[8] are applied with the following changes:
\- If the UE is configured with Extended Home N3IWF identifier configuration,
then the UE uses the Extended Home N3IWF identifier configuration:
\- UE uses the FQDN or IP address from the Extended Home N3IWF identifier
configuration that matches all (or most, in case there is no full match) of
the S-NSSAIs that the UE is going to request in the subsequent Registration.
\- If the UE is not configured with Extended Home N3IWF identifier
configuration and not configured with Rel-17 Home N3IWF identifier
configuration but configured with slice-specific N3IWF prefix information for
the HPLMN:
\- Whenever the UE constructs an N3IWF FQDN according to clauses 7.2.4.3 and
7.2.4.4 of TS 24.502 [8], the UE first selects the Slice-specific N3IWF prefix
information for the HPLMN that matches the S-NSSAIs the UE is going to request
in the subsequent Registration procedure and adds the prefix to the Rel-17 TA
or OI format FQDNs as follows:
\- \.tac-lb\.tac-hb\.tac.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org.
\- \.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org.
NOTE 1: Which FQDN format (TA or OI) to construct follows the existing
description in clauses 7.2.4.3 and 7.2.4.4 of TS 24.502 [8].
\- If the UE has constructed an N3IWF FQDN including a prefix but the DNS does
not return an IP address, then the UE attempts the same FQDN without the
prefix.
\- If the UE is not configured with Extended Home N3IWF identifier
configuration and not configured with Slice-specific N3IWF prefix information,
then the existing procedures in Rel-17 clauses 7.2.4.3 and 7.2.4.4 of TS
24.502 [8] apply.
\- UE is not located in its home country:
\- The procedures described in Rel-17 clauses 7.2.4.3 and 7.2.4.4 of TS 24.502
[8] are applied with the following changes:
\- If the UE is configured with slice-specific N3IWF prefix information for
the selected VPLMN:
\- Whenever the UE constructs an N3IWF FQDN according to clauses 7.2.4.3 and
7.2.4.4 of TS 24.502 [8], the UE first selects the slice-specific N3IWF prefix
information for the VPLMN that matches the S-NSSAIs the UE is going to request
in the subsequent Registration procedure and adds the prefix to the Rel-17 TA
or OI format FQDNs as follows:
\- \.tac-lb\.tac-hb\.tac.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org
\- \.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org
NOTE 2: Which FQDN format (TA or OI) to construct follows the existing
description in clauses 7.2.4.3 and 7.2.4.4 of TS 24.502 [8].
\- For selecting the slice-specific N3IWF prefix information for the VPLMN,
the UE applies the S-NSSAIs valid in the VPLMN.
\- If the UE has constructed an N3IWF FQDN including a prefix but the DNS does
not return an IP address, then the UE attempts the same FQDN without the
prefix.
\- If the UE determines that the visited country does not mandate the
selection of N3IWF or ePDG in the visited country and if the N3AN node
configuration information is not provisioned or the N3AN node configuration
information is provisioned and the N3AN node selection information of the N3AN
node configuration information excluding any PLMN in the list of \"forbidden
PLMNs for non-3GPP access to 5GCN\" contains no PLMN in the visited country
and the UE is configured with Extended Home N3IWF identifier configuration,
then the UE uses the IP address or FQDN from the Extended Home N3IWF
identifier configuration that matches the S-NSSAIs the UE is going to request
in the subsequent Registration.
### 6.15.3 Procedures
Figure 6.15.3-1 specifies how N3IWF is selected to support the NSSAI needed by
the UE,
Figure 6.15.3-1: Registration via untrusted non-3GPP access
1\. The UE connects to an untrusted non-3GPP Access Network with any
appropriate authentication procedure and it is assigned an IP address. For
example, a non-3GPP authentication method can be used, e.g. no authentication
(in the case of a free WLAN), EAP with pre-shared key, username/password, etc.
When the UE decides to attach to 5GC network, the UE selects an N3IWF in a 5G
PLMN as described in clause 6.15.2.2.
Steps 2 to 7 do not require specification changes with regard to 3GPP Rel-17.
2\. The UE proceeds with the establishment of an IPsec Security Association
(SA) with the selected N3IWF by initiating an IKE initial exchange according
to RFC 7296 [3]. After step 2, all subsequent IKE messages are encrypted and
integrity protected by using the IKE SA established in this step.
3\. The UE shall initiate an IKE_AUTH exchange by sending an IKE_AUTH request
message. The AUTH payload is not included in the IKE_AUTH request message,
which indicates that the IKE_AUTH exchange shall use EAP signalling (in this
case EAP-5G signalling). If the UE supports MOBIKE, it shall include a Notify
payload in the IKE_AUTH request, as specified in RFC 4555 [40], indicating
that MOBIKE is supported. In addition, as specified in TS 33.501 [9], if the
UE is provisioned with the N3IWF root certificate, it shall include the
CERTREQ payload within the IKE_AUTH request message to request the N3IWF\'s
certificate.
4\. The N3IWF responds with an IKE_AUTH response message, which includes an
EAP-Request/5G-Start packet. The EAP-Request/5G-Start packet informs the UE to
initiate an EAP-5G session, i.e. to start sending NAS messages encapsulated
within EAP-5G packets. If the N3IWF has received a CERTREQ payload from the
UE, the N3IWF shall include the CERT payload in the IKE_AUTH response message
containing the N3IWF\'s certificate. How the UE uses the N3IWF\'s certificate
is specified in TS 33.501 [9].
5\. The UE shall send an IKE_AUTH request, which includes an EAP-
Response/5G-NAS packet that contains the Access Network parameters (AN
parameters) and a Registration Request message. The AN parameters contain
information that is used by the N3IWF for selecting an AMF in the 5G core
network. This information includes e.g. the GUAMI, the Selected PLMN ID (or
PLMN ID and NID, see clause 5.30 of TS 23.501 [2]), the Requested NSSAI and
the Establishment cause. The Establishment cause provides the reason for
requesting a signalling connection with 5GC. Whether and how the UE includes
the Requested NSSAI as part of the AN parameters is dependent on the value of
the Access Stratum Connection Establishment NSSAI Inclusion Mode parameter, as
specified in clause 5.15.9 of TS 23.501 [2].
NOTE 1: The N3IWF does not send an EAP-Identity request because the UE
includes its identity in the first IKE_AUTH. This is in line with clause 3.16
of RFC 7296 [3].
6\. The N3IWF shall select an AMF based on the received AN parameters and
local policy, as specified in clause 6.3.5 of TS 23.501 [2]. The N3IWF shall
then forward the Registration Request received from the UE to the selected AMF
within an N2 message. This message contains N2 parameters that include the
Selected PLMN ID and the Establishment cause.
7\. AMF initiates authentication and security procedure as defined in clause
4.12.2.2 of TS 23.502 [3]
8\. The selected AMF determines whether the N3IWF connected with UE currently
(named S-N3IWF) should be the serving N3WIF or a different target N3IWF
(T-N3IWF) needs to be used. The AMF makes the determination considering the
Requested S-NNSAI, the determined Allowed S-NSSAI, local configuration, etc.
Case a): S-N3IWF is not appropriate:
9\. If the AMF has determined in step 8 that the selected N3IWF is not
appropriate, the AMF may initiate the UE Policy Association Establishment
procedure, trigger the PCF to provide the UE with updated N3IWF selection
policies (described in clause 6.15.2.1) and request the PCF to notify the AMF
when the UE has been updated with such policies. The AMF may set a timer
(related with the maximum time the UE can wait for a registration
accept/reject) at the expiry of which it will send a registration reject to
the UE regardless of the policy update status.
When the UE has been updated with N3IWF selection policies, the PCF notifies
the AMF, and the AMF sends a Registration Reject message to the UE.
If the PCF indicates a failure to update the UE or if the PCF does not notify
the AMF when the UE has been updated with such policies, the AMF sends a
Registration Reject message to the UE providing target N3IWF information (e.g.
FQDN and/or IP address). so that UE can use the target N3IWF information to
select the target N3IWF to register to 5GC.
10a. AMF sends a Registration Reject message to the UE. Optionally, if the AMF
has determined in step 8 that the selected N3IWF is not appropriate, the AMF
may provide target N3IWF information (e.g. FQDN and/or IP address) to UE
within Registration Reject message.
Case b): S-N3IWF is appropriate:
10.b If the AMF has determined in step 8 that the selected N3IWF is
appropriate, AMF continues the registration procedure as defined in clause
4.12.2.2 and sends a Registration Accept to the UE. AMF only includes S-NSSAIs
supported by the selected N3IWF in the Accepted NSSAI for the UE. (id the
S-N3IWF is appropriate)The N3IWF forwards the NAS Registration Accept message
to UE via the established signalling IPsec SA. If the NAS Registration Accept
message is received by the N3IWF before the IPsec SA is established, the N3IWF
shall store it and forward it to the UE only after the establishment of the
signalling IPsec SA.
11\. If UE is rejected, UE connects to T-N3IWF if the UE has been provided
with T-N3IWF information in the previous Registration Reject, otherwise the UE
performs N3IWF selection again using the updated N3IWF selection information.
### 6.15.4 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
UE impacts:
\- Select the N3IWF based on Extended Home N3IWF identifier configuration or
based on Slice-specific N3IWF prefix information.
\- Re-select N3IWF based on the N3IWF information provided by the AMF via NAS
Registration Reject message.
AMF impacts:
\- Ability to determine target N3IWF information based on the list of
supported TAs and the corresponding list of supported slices for each TA
obtained in RAN Configuration Update procedure.
\- Provide UE with the N3IWF information via NAS Registration Reject message.
\- Provide PCF with Configured NSSAI during UE Policy Association
Establishment/Modification in the roaming case.
PCF impacts
\- Configuration about the slices supported by the N3IWF(s) of the network
\- Provide the UE with extended ANDSP based on configuration about the slices
supported by the N3IWF(s) of the network: Extended Home N3IWF identifier
configuration or Slice-specific N3IWF prefix information.
\- Receive Configured NSSAI from AMF during UE Policy Association
Establishment/Modification in the roaming case.
DNS configuration:
\- No functional impact, the following FQDNs need to be configured in the DNS
using existing A/AAAA DNS record types:
\- \.tac-lb\.tac-hb\.tac.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org
## 6.16 Solution #16: N3IWF selection taking supported slices into account
### 6.16.1 Description
#### 6.16.1.1 Introduction
Key idea of this solution is to provide additional information to a UE to
enable the UE to select an N3IWF that supports the network slices (identified
by S-NSSAIs) that the UE is intending to register for, i.e. to select an N3IWF
that supports the S-NSSAIs that the UE wants to include in the Requested NSSAI
during the subsequent Registration procedure.
This solution has been merged into Solution 15 and will therefore not be
progressed further.
#### 6.16.1.2 Solution principles
##### 6.16.1.2.1 General
\- PLMN selection prior to N3IWF selection is performed as defined in TS
23.501 [2]
##### 6.16.1.2.2 N3IWF selection when the UE is located in the home country
and when the UE is not located in the home country
\- UE configuration
\- AMF may provide the UE with the following information for the current PLMN
(which the UE stores and applies as described further below) as part of the
Registration or the UE Configuration Update procedure:
\- Slice-specific N3IWF prefix information: one or multiple entries, each
consisting of:
\- List of supported S-NSSAIs.
\- FQDN format: Tracking Area (TA) FDQN format or Operator Identifier (OI)
FQDN format.
\- Prefix.
Editor\'s note: It is FFS how this information fits with N3AN node selection
information and Home N3IWF identifier configuration defined in TS 24.526 [10].
\- N3IWF selection by the UE
\- If the UE has Slice-specific N3IWF prefix information for the PLMN that the
UE wants to register with:
\- The UE selects a Slice-specific N3IWF prefix information entry that
supports all (or most, in case there is no full match) of the S-NSSAIs that
the UE intends to request in the Requested NSSAI, and creates an FQDN using
the prefix from the selected prefix information as follows:
\- \.tac-lb\.tac-hb\.tac.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org (if the FQDN
format indicates TA FQDN format).
\- \.n3iwf.5gc.mnc\.mcc\.pub.3gppnetwork.org (if the FQDN
format indicates OI FQDN format).
\- If the UE has not received Slice-specific N3IWF prefix information from the
AMF, then the UE selects an N3IWF using Rel-17 N3IWF selection procedures.
\- If the DNS returns an IP address for the FQDN and the UE has established
the connection to the N3IWF but the AMF detects that the selected N3IWF does
not support the S-NSSAIs requested by the UE in the Requested NSSAI, then the
AMF may indicate updated Slice-specific N3IWF prefix information to the UE and
may reject the UE\'s registration request. Based on this, the UE performs
N3IWF selection again.
NOTE: Alternatively, the AMF can, after updating the UE with new Slice-
specific N3IWF prefix information, redirect the UE to a different N3IWF as
proposed by solution 11.
### 6.16.2 Procedures
Existing procedures are reused.
### 6.16.3 Impacts on Existing Nodes and Functionality
\- UE:
\- Support N3IWF selection based on Slice-specific N3IWF prefix information
from AMF
\- AMF:
\- Indicate Slice-specific N3IWF prefix information to the UE
### 6.16.3 Impacts on Existing Nodes and Functionality
\- UE:
\- Support N3IWF selection based on Slice-specific N3IWF prefix information
from AMF
\- AMF:
\- Indicate Slice-specific N3IWF prefix information to the UE
## 6.17 Solution 17: Untrusted Non-3GPP Access with N3IWF/TNGF Relocation due
to network slicing
### 6.17.1 Description
The solution addresses KI#2 and enables the AMF to select a different N3IWF to
serve the UE, when the originally selected N3IWF cannot support the slices
needed by the UE.
Each N3IWF/TNGF may be locally configured with one TAI value and a
corresponding set of S-NSSAIs (based on rel-17 enhancements done as part of
TEI17_N3SLICE).
The key steps of the solution are summarized as follows:
1\. UE Registers with initial N3IWF/TNGF (i.e. full initial registration
procedure).
2\. AMF informs the UE about target N3IWF/TNGF and releases the N2 UE
connection
3\. UE preforms Service Request via target N3IWF/TNGF.
### 6.17.2 Procedures
Figure 6.17.1-1 Registration and N3IWF/TNGF relocation to enable UE to be
served by N3IWF/TNGF supporting the requested S-NSSAIs
1\. The UE selects a PLMN and an N3IWF in this PLMN. This N3IWF is selected as
currently specified in TS 23.501 [2], i.e. without considering any slice
information.
The UE initiates the initial Registration procedure which takes place as
described in TS 23.502 [3] clause 4.12.2.2, steps 1-11 for untrusted non-3GPP
access and clause 4.12a.2.2, steps 1-14 for trusted non-3GPP access, with the
differences and clarifications described below.
The AMF (either the one selected by N3IWF, or the one selected after AMF re-
allocation, as defined in clause 5.15.5.2.3 of TS 23.501 [2]) identifies
whether the selected N3IWF can or cannot support the slices requested by the
UE. The AMF knows the slices supported by each N3IWF connected with the AMF
because (as defined in TS 38.413 [7]) the N2 Setup Request message sent from
N3IWF to AMF includes the supported TAI and the supported S-NSSAIs for this
TAI.
2\. The AMF sends Registration Accept to the UE and includes information about
target N3IWF(s). The N3IWF information may contain information about N3IWFs
and what S-NSSAIs each N3IWF supports.
Editor\'s note: It is FFS whether the AMF may provide information about target
TNGF(s). How the AMF is configured with TNGF(s) available via the SSID+BSSID
that the UE is using is also FFS.
Editor\'s note: The details on what N3IWF/TNGF information is provided to the
UE is FFS. It is e.g. FFS whether the 5GC selects a N3IWF/TNGF on behalf of
the UE, or provides information about multiple N3IWFs/TNGFs and allow the UE
to select N3IWF/TNGF. It is also FFS for how long the information is intended
to be valid in the UE.
Editor\'s note: It is FFS whether and how the AMF can accept the Registration
with the initial N3IWF/TNGF if that N3IWF/TNGF does not support the set of
slices requested by the UE.
Editor\'s note: In the case 5GC or provides information about multiple
N3IWFs/TNGFs and allowing the UE to select N3IWF/TNGF, how to enable N3IWF
selection taking also the current tracking area of the UE in 3GPP access into
account (i.e. how to support N3IWF selection based on the TA FQDN) is FFS.
3\. The AMF triggers N2 connection release, as described in clause 4.12.4.2 of
TS 23.502 [3] (for untrusted non-3GPP access) or clause 4.12a.4.2 (for trusted
non-3GPP access). As part of this procedure, the N3IWF performs the release of
the IPsec tunnel. The AMF includes information about target N3IWF in step 3a.
The N3IWF provides this information to the UE in step 3b.
Editor\'s note: It is FFS whether target N3IWF/TNGF information should be
provided in NAS Registration Accept (step 2) or via AS parameters (steps
3a-3b). Both options are described in this solution, but only one is to be
selected.
4\. The UE selects a N3IWF/TNGF from the information provided in step 2 (for
NAS) or step 3 (for AS) and triggers Service Request procedure as described in
clause 4.12.4.1 of TS 23.502 [3] (for untrusted non-3GPP access) or clause
4.12a.4.1 (for trusted non-3GPP access).
Editor\'s note: It is FFS how a UE can select a TNGF (the TNGF is selected by
the WLAN AN).
### 6.17.3 Impacts on Existing Nodes and Functionality
UE:
\- Able to receive a new N3IWF/TNGF information via NAS (NAS option) or IKE
(AS option)
N3IWF-1/TNGF-1:
\- AS option: Able to receive new N3IWF/TNGF information from the AMF and
provide this to the UE
N3IWF-2/TNGF-2:
\- No impact.
AMF:
\- Able to trigger N3IWF/TNGF relocation, e.g. based on the Requested NSSAI
provided by the UE, the Subscribed NSSAI for this UE, the S-NSSAIs supported
by all TNGFs that can serve the UE, and other information.
Editor\'s note: It is FFS whether the AMF may provide information about target
TNGF(s). How the AMF is configured with TNGF(s) available via the SSID+BSSID
that the UE is using is also FFS.
\- The AMF includes new N3IWF/TNGF information in NAS Registration Accept (NAS
option) or N2 UE Context Release Command (AS option).
## 6.18 Solution 18: ANDSP based solution for slice related TNGF selection
### 6.18.1 Description
This solution addresses the Key Issue 2 on How to select a TNGF that supports
the S-NSSAI(s) needed by the UE.
ANDSP (Access Network Discovery & Selection policy) was designed to be
provided to UE by the network for selection of TNGF/N3IWF. This solution
proposes to add the supported S-NSSAI(s) for the TNGF in ANDSP to aid the UE
in the selection of the TNGF that supports the S-NSSAI(s) needed by the UE.
### 6.18.2 Procedures
Editor\'s note: This clause describes services and related procedures for the
solution.
#### 6.18.2.1 Procedures for TNGF selection
When the UE initiates trusted non-3GPP access to 5GC, it can selects a WLAN
access network based on WLANSP rules, as described in current (Rel-17) clause
6.6.1.3 of TS 23.503 [4]. The UE can be provided by the HPLMN and by the VPLMN
with WLANSP rules to assist UE the selection of WLAN in home network or in
visited network. WLANSP rule can include PreferredSSIDList which is
prioritized list of SSIDs preferred for selection, as described in TS 23.402
[11]. PreferredSSIDList can be used as a selection criteria for the UE to
constructs a prioritized list of the available WLANs by discovering the
available WLANs and comparing their SSIDs against the PreferredSSIDList. From
the prioritized list of the available WLANs, the UE selects the highest
priority WLAN network and starts the 5GC registration procedure. Above
current(Rel-17) procedures does not consider the needed S-NSSAI(s).
To aid the UE in the selection of the WLANs that supports the S-NSSAI(s)
needed by the UE, it is proposed to configure the supported S-NSSAI(s) for the
SSID in the PreferredSSIDList. Here the supported S-NSSAI(s) information is
not used as selection criteria which the UE compares the
attributes/capabilities of the available WLANs against. It is designed for the
UE to select the WLAN supporting the needed S-NSSAI(s) from prioritized list
of WLANs. After the UE constructs a prioritized list of the WLANs following
the existing procedures of WLAN access selection based on WLANSP rules, the UE
can know the supported S-NSSAI(s) for the SSID/WLAN in the list, if these SSID
match the PreferredSSIDList and the matched SSID is configured with supported
S-NSSAI(s). When the UE desides to select a WLAN supporting S-NSSAI(s) needed
by the UE for registration, the UE select the SSID/WLAN from the prioritized
list of the WLANs.
The HPLMN or VPLMN can provide a UE with PreferredSSIDList in WLANSP rules so
that the list of SSIDs in PreferredSSIDList cover all the UE\'s subscribed
S-NSSAI(s).
After the UE selects the WLAN/TNAP, the UE follows the existing registration
procedure specified in clause 4.12a.2.2 of TS 23.502 [3] and connects to the
TNGF supporting the needed S-NSSAI(s). It is assumed the TNAP selects a TNGF
based on the realm provided by the UE and based on the SSID selected by the UE
and the TNGF supports all the S-NSSAIs for this SSID.
NOTE: The solution configures the UE with the supported S-NSSAI(s) on a per
SSID basis so assumes that the a SSID gives access to TNGF(s) that support the
same set of slices all over the country.
### 6.18.3 Impacts on services, entities and interfaces
Editor\'s note: This clause captures impacts on existing services, entities
and interfaces.
The following impacts are foreseen by this solution:
UE:
\- select the SSID/WLAN which supports the needed S-NSSAI(s) from the
prioritized list of the WLANs.
PCF in HPLMN:
\- provide the supported S-NSSAI(s) for the SSID in the PreferredSSIDList in
WLANAP
PCF in VPLMN:
\- provide the supported S-NSSAI(s) for the SSID in the PreferredSSIDList
which is in VPLMN.
## 6.19 Solution #19: Selecting TNGF supporting the S-NSSAI needed by UE
### 6.19.1 Description
This solution aims at addressing Key Issue #2 about how to select a TNGF/N3IWF
that supports the S-NSSAI(s) needed by the UE. In particular, this solution
mainly focuses on how to select a TNGF that supports the S-NSSAI(s) needed by
the UE.
The solution follows the principles of solution #15.
The mechanism of the first option (UE configuration) can also be applicable to
trusted non-3GPP access. The extended WLANSP may contain the SSID and TNGF ID
associated with NSSAI. UE can select an appropriate SSID associated with the
Requested NSSAI and build the realm of NAI with the appropriated TNGF ID so
that the TNAP can select the target TNGF based on the SSID selected by the UE
and the realm part of NAI provided by the UE.
### 6.19.2 Procedures
Figure 6.19.2-2: Registration via trusted non-3GPP access
1\. Step 1 to step 6 are performed as specified in clause 4.12a.2.2 with
follow addition:
\- the UE selects the SSID which is associated to the set of slices that it
requests to access to based on the information from WLANSP (e.g. the extended
WLANSP).
\- the UE sends a NAI with the realm including the TNGF ID associated to the
slices received in the WLANSP (e.g. the extended WLANSP).
\- The Registration Request message may optionally contain an indication
indicating that the UE supports TNGF selection based on slicing.
2\. The selected AMF determines whether the TNGF connected with UE currently
(named S-TNGF) supports the request NSSAI needed by UE if the indication is
included in the Registration Request. If the selected TNGF supports the
Requested NSSAI, steps from 4 to 6 will be performed and the Registration will
be accepted if the UE has been successfully authenticated. If the TNGF does
not support the Requested NSSAI, the AMF may determine target SSIDs and a
target TNGF that supports the requested NSSAI based on the list of supported
TAs and the corresponding list of supported slices for each TA obtained in RAN
Configuration Update procedure as specified in TS 38.413 [7].
3\. If the AMF has determined in step 2 that the selected TNGF is not the
appropriated one, the AMF may provide the target TNGF information (e.g. TNAN
information such as SSID and TNGF ID) to UE within Registration Reject message
so that UE can use the target TNGF information to select the target TNAN (e.g.
based on the received SSID) and to build the realm of NAI with the TNGF ID to
register to 5GC.
4\. If the S-N3IWF has been determined to be the suitable one or if the UE
does not provide the indication, the AMF may continue the registration
procedure as defined in clause 4.12a.2.2 in TS 23.502 [3].
5\. The AMF sends the NAS Registration Accept message to the TNGF. The N2
Message includes the Allowed NSSAI for the access type for the UE.
6\. The TNGF forwards the NAS Registration Accept message to UE via the
established signalling IPsec SA.
7\. If UE is rejected in step 3, UE uses the target TNGF information to select
target TNAN (i.e. using received SSID to select TNAP) and build the realm of
NAI with the TNGF ID to registers to 5GC via T- TNGF.
### 6.19.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
UE impacts:
\- Re-select TNGF based on the TNGF information provided by the AMF via NAS
Registration Accept or Registration Reject message.
\- Ability to select the SSID associated with the Requested NSSAI and build
the realm of NAI with the TNGF ID based on the received extended WLANSP.
AMF impacts:
\- Ability to determine target TNGF information based on the list of supported
TAs and the corresponding list of supported slices for each TA obtained in RAN
Configuration Update procedure.
\- Provide UE with the TNGF information via Registration Reject message.
WLANSP impacts:
\- Extension of WLANSP with the association of SSID, TNGF identifiers and
slice.
## 6.20 Solution 20: providing differentiated service for UE and non-3GPP
devices connected behind a 5G-RG
### 6.20.1 Description
Editor\'s note: This clause will describe the solution principles and
architecture assumptions for corresponding key issue(s). (Sub) clause(s) may
be added to capture details.
In Rel-18 FS_5WWC_Ph2, the KI#1 aims to provide differentiated service (e.g.
QoS and charging) for UE and Non-3GPP devices connected behind a 5G RG. Guided
by the existing knowledge in 3GPP (e.g. ProSe), the study for L-3 UE-to-
Network Relay without N3IWF in 5G can also be applied to UE connects to the
5G-RG for UE approach.
In this solution, 5G-RG obtains User ID and UE info of devices connected
behind a 5G-RG. And 5G-RG sends these information to the SMF, in turn
delivered to the PCF. Then the PCF or SMF can make corresponding policy
decisions related to e.g. QoS control or charging.
### 6.20.2 Procedures
#### 6.20.2.1 providing differentiated service for non-3GPP devices connected
behind a 5G-RG
Editor\'s note: This clause describes high-level procedures and information
flows for the solution.
Figure 6.20.2.1-1
1\. Non-3GPP device connects to 5G-RG with non-3GPP access network (e.g.
establishes WiFi association).
During this procedure, 5G-RG obtains non-3GPP device\'s User ID and Non-3GPP
device info. The User ID is an identity of the non-3GPP device (e.g. MAC
address, or SUCI which could be acquired by Authentication procedure for NSWOF
in TS 33.501 [9] v17.5.0 Annex S, or SUPI). To acquire SUCI/SUPI of non-3GPP
device, it is assumed that non-3GPP device and 5G-RG support 5G NSWO where
5G-RG takes the role of \"WLAN AN\". In the case of acquiring SUPI of the
non-3GPP device, during the authentication procedure for NSWOF in TS 33.501
[9] the 5G-RG can add an indication in SWa protocol message to NSWOF and an
indication in Nausf_UEAuthentication_Authenticate Request to AUSF for
acquiring the SUPI. Then the AUSF can send SUPI as a new parameter in
Nausf_UEAuthentication_Authenticate Response to NSWOFand deliver SUPI as a new
parameter in SWa protocol message to the 5G-RG. The non-3GPP device info is
used to assist identifying the non-3GPP device in the 5GC. For IP PDU Session
Type, the non-3GPP device info is non-3GPP device IP info, e.g. TCP/UDP port
ranges assigned to non-3GPP device by 5G-RG as NAT in case of IPV4. For
Ethernet PDU Session Type, the non-3GPP device info is non-3GPP device
Ethernet address.
2\. 5G-RG sends Remote UE Report message to the SMF through the AMF. The
Remote UE Report message includes Non-3GPP device\'s User ID and Non-3GPP
device info.
NOTE: It is assumed that the 5G-RG already establishes a PDU session to
simplify the procedures.
3\. The SMF sends non-3GPP device\'s User ID and Non-3GPP device info to the
PCF by initiating the SM Association Modification procedure. The SMF may store
the Non-3GPP device\'s User ID and Non-3GPP device info. Then SMF may get
subscription data for Non-3GPP device from UDM using Nudm_SDM_Get service.
4\. The PCF stores the Non-3GPP device\'s User ID and Non-3GPP device info.
The PCF can get policy information for Non-3GPP device from local
configuration (e.g. common policy for Non-3GPP device) or from UDR using
Nudr_DM_Query service.
5\. The PCF shall authorize policy for the non-3GPP device based on policy
information at step 4.
6\. The PCF generates and sends the PCC rules related to e.g. QoS or charging
for non-3GPP devices connected behind a 5G-RG.
7\. The SMF performs charging and QoS provision for the data traffic of the
Non-3GPP device via existing mechanisms. And the SMF provides the charging
information with corresponding User ID to the CHF. Same CHF session is
proposed to be used to deal with the 5G RG traffic and with the traffic of
different devices behind the 5G RG e.g. distinguish different traffic by
corresponding User ID. The details of processing will be determined by SA WG5.
#### 6.20.2.2 differentiated QoS for 5GC-capable UE connected behind a 5G-RG
Figure 6.20.2.2-1
The solution is based on the architecture as defined in clause 4.10 of TS
23.316 [5] which UE connects to the overlay 5G network using the trusted N3GPP
for UE approach.
In step 1, UE completes authentication and receives IP configuration during
Registration procedure for trusted non-3GPP access in clause 4.12a of TS
23.502 [3]. The 5G-RG obtains UE info which is used to assist identifying the
UE in the 5GC. For IPv4, 5G-RG as a NAT shall assign TCP/UDP port ranges to
individual UE(s) as UE info.
In step 2 and 3, the 5G-RG (acts as a TNAP) performs step 2 and 3 as in clause
6.20.2.1 with the modification where the UE takes the role of \"non-3GPP
devices\", to report User ID (e.g. MAC address, or SUCI of the UE) and UE info
to 5GC.
In step 4, PCF shall authorize QoS to UE, e.g. with the configured default QoS
for the UE as described from step 4 to 7 in clause 6.20.2.1. (by
configuration) If needed, the 5GC at 5G-RG side can perform differentiated
charging for the data flow of this UE following the procedures in 6.20.2.1,
although the 5GC at the UE side will perform charging for the UE. This
approach can handle the issue of repeat billing at 5G-RG, by excluding the
amount of data generated by 5GC-capable UEs behind the 5G-RG.
In step 5 and 6, once the TNGF acquires the UE\'s QoS information e.g. UE-AMBR
or session-AMBR from 5GC when UE setup PDU session, it sends the corresponding
QoS information to 5G-RG through the Ta interface. Then 5G-RG stores the QoS
information for the UE and performs PDU session modification procedure to
request the QoS for the UE\'s data flow identified by UE info. For example,
the 5G-RG can request MBR for the data flow of this UE in the PDU session of
5G-RG. The SMF and PCF perform subsequent procedures for PDU Session
Modification to authorize and enforce the QoS for the UE\'s data flow in the
PDU session.
In addition, when the TNGF acquires the UE\'s QoS flow level QoS parameters
e.g. 5QI, GFBR, MFBR from 5GC, to assist the RG to differentiate QoS flows
within UE, TNGF can allocate a DSCP value for the QoS flow associated with the
corresponding IPsec Child SA which is over the outer IP address of TNGF and
RG. TNGF then sends the UE\'s QoS flow level QoS parameters, DSCP value and
address e.g. TNGF IP address to 5G-RG through the Ta interface. Then 5G-RG can
generate the RG\'s QoS flow information which can be mapped to the UE\'s QoS
flow e.g. 5QI and packet filter for QoS flow (DSCP value, TNGF IP address,
RG\'s address if necessary), and perform PDU session modification procedure to
request the QoS flow corresponding to the UE\'s QoS flow.
### 6.20.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
5G-RG:
\- 5G-RG sends User ID and UE info to the SMF through the AMF, e.g. by Remote
UE Report message
\- 5G-RG receives Qos information of the UE from TGNF and performs PDU session
modification procedure to request the QoS for data flow of the UE.
SMF:
\- The SMF sends User ID and UE info to the PCF by initiating the SM
Association Modification procedure.
\- The SMF provides the charging information with User ID to the CHF.
\- The SMF may store the User ID and UE info of devices connected behind a
5G-RG.
PCF:
\- The PCF can get policy related to e.g. QoS control, or charging of Non-3GPP
device.
\- The PCF stores the User ID and UE info of devices connected behind a 5G-RG.
\- PCF authorizes policy for non-3GPP devices or UE behind the 5G-RG.
TNGF:
\- The TNGF sends the corresponding QoS information of the UE to 5G-RG through
the Ta interface.
## 6.21 Solution 21: Non-3GPP device behind 5G-RG based on 5GS exposure
### 6.21.1 Description
#### 6.21.1.1 Introduction
This solution addresses KI#1 for providing differentiated services (e.g. QoS
and charging) for Non-3GPP devices behind a 5G-RG.
The solution consists of three parts that are used to provide a working e2e
solution:
1\. Example for how non-3GPP device information can be created in an AF.
2\. Enhancements to the NEF exposure services to provide the non-3GPP device
information to 5GC.
3\. Description for how the traffic from non-3GPP devices can be identified in
the 5GC to provide differentiated charging and QoS.
#### 6.21.1.2 Overall Architecture
The overall architecture is shown in Figure 6.21.1-1. Only NFs relevant for
the solution are shown.
Figure 6.21.1-1: Overall architecture
#### 6.21.1.3 Functional Description
**Providing non-3GPP device information to AF**
In this solution, the AF is assumed to have access to information about the
non-3GPP devices that are or have been connected behind the RG. An example for
how this can be done is described here. The details are however out of 3GPP
scope
Based on existing BBF specifications TR-69/369 and TR-181, the Auto-
Configuration Server (ACS) can retrieve information about the non-3GPP devices
from the 5G-RG. This information can e.g. contain the host table from the DHCP
server in the RG, or device list gathered by other means, and typically
includes for each device: a host name, the MAC address of the device and the
IP address allocated to the device. An example of such a table for IPv6 is
shown in Figure 6.21.1-2.
Figure 6.21.1-2: Example of IPv6 host table from an RG
In the case of IPv4 traffic, the routed RG typically has NAT functionality.
The IPv4 addresses in the list of non-3GPP devices received from the RG would
thus correspond to the private IPv4 addresses. These private addresses are not
useful for traffic detection in the 5GC. In this case the solution assumes
that the NAT in the 5G-RG assigns a port range for each device and can provide
the external IP address and port range associated with each device to the ACS.
The non-3GPP device information is then provided from the ACS to the AF. How
this is done is out of scope of 3GPP. For reference, the BBF has specified
requirements for such an interface in TR-131 ACS Northbound Interface
Requirements -- Amendment 1, 2015. The BBF has also done work on a RESTful API
in a TR-369 controller
(https://github.com/BroadbandForum/usp/tree/master/api).
It is further assumed that the operator may integrate a web portal with the
AF. The end-user (e.g. the person that owns the subscription for the RG) can
login to this web portal and manage the list of devices. The end-user could
e.g. select a device profile for each device from a drop-down menu. The device
profile may e.g. indicate what type of non-3GPP device it is (set top box,
printer, tablet, PC etc), or be a reference to a QoS category. How this Device
profile ID is to be interpreted is up to operator configuration.
In summary:
1) It is assumed that the AF has a table containing a complete list of
non-3GPP devices in the home. The table includes a host name (which may be
informative but is not guaranteed to be unique), MAC address, assigned IPv4
address (local to the home LAN) and IPv6 address. The combination of host name
and MAC address is considered to be a unique and persistent identification of
a specific device connected to the home LAN.
2) It is assumed that the AF may be directed by an authorized subscriber by
means out of scope of 3GPP to request differentiated service for specific
devices in the AF\'s list of non-3GPP devices.
It should be noted that similar systems and procedures are employed in
wireline networks today, but these would benefit from the enhanced
differentiation capabilities of the 5GS.
**Provisioning of non-3GPP device information to 5GC**
The existing NEF Service Parameter service is enhanced with a new Service
Description to allow an AF to provide the non-3GPP device information to 5GC.
This information will be used by 5GC to detect the traffic to/from a non-3GPP
device and also to provide differentiated QoS and/or charging.
The information provided by the AF via the Nef_ServiceParameter service
contains:
\- GPSI of the RG.
\- List of non-3GPP devices, containing for each device:
\- IPv6 address or IPv4 and the port number of the device.
\- Device profile ID.
The NEF maps the RG\'s GPSI to the RG\'s SUPI and stores the non-3GPP device
information in UDR as Application Data, as currently defined for
Nnef_ServiceParameter service in clause 4.15.6.7 of TS 23.502 [3].
**Differentiated services per non-3GPP device**
When a PDU Session for an RG is established, the PCF contacts the UDR to
subscribe to Application Data that may be available, as per existing procedure
for Service specific parameter provisioning in clause 4.15.6.7 of TS 23.502
[3]. The PCF thus receives the non-3GPP device information from UDR
corresponding to the RG\'s SUPI.
The PCF takes the service parameters as well as other information (e.g. RG\'s
subscribed QoS and RG\'s policy subscription data in UDR) into account for
policy decisions, e.g. to determine QoS and charging parameters for the
non-3GPP device\'s traffic. The PCF may provide PCC rules to SMF that are
specific for individual non-3GPP devices, containing SDF filter with the IPv6
address or IPv4 and the port number of the device, and corresponding QoS and
charging related parameters. The PCF may provide different PCC rules for
different services, as per existing standards.
### 6.21.2 Procedures
The procedures below are based on the existing Service specific parameter
provisioning procedure in clause 4.15.6.7 of TS 23.502 [3], but adapted to fit
the use case.
The procedure for the provisioning of non-3GPP device information is shown
below:
Figure 6.21.2-1: Provisioning of non-3GPP device information
1-5. The end-user logs in to customer portal and manages the list of non-3GPP
devices associated with the RG.
6\. The AF invokes Nnef_ServiceParameter service to provide the non-3GPP
device information for the RG\'s GPSI to the NEF.
7\. The NEF maps the RG\'s GPSI to a SUPI and stores the information in UDR.
8\. The NEF sends a Nnef_ServiceParameter Response to the AF.
The procedure for providing differentiated services for the traffic of a
non-3GPP device is shown below.
Figure 6.21.2-2: Provisioning of providing differentiated services to non-3GPP
devices
1\. The 5G-RG establishes a PDU Session.
2\. The PCF subscribes to non-3GPP device information from the UDR. PCF may
e.g. use the DNN to determine whether to request such data from UDR.
3\. In case the non-3GPP device information is updated during the lifetime of
the 5G-RG\'s PDU Session, the UDR notifies the PCF about the updated
information.
4\. The PCF takes the non-3GPP device information into account for its policy
decision. The non-3GPP Device profile ID may map to a set of QoS parameters or
charging related parameters.
5\. The PCF provides updated policy rules to the SMF.
6\. The SMF initiates corresponding updates of the N4 rules.
### 6.21.3 Impacts on Existing Nodes and Functionality
NEF: Extensions to the NEF Service Parameter Service to allow an AF to
provision non-3GPP device information.
UDR: Extensions to the Application Data in UDR to store non-3GPP device
information.
PCF: Ability to retrieve non-3GPP device information from UDR and take it into
account for policy decisions.
There are no impacts to SMF and UPF since existing capabilities are re-used.
It is assumed that the 5G-RG can provide a list of non-3GPP devices to the
ACS, with host name, MAC address and IP address for each device. For IPv4 with
a NAT in the 5G-RG, it is assumed that the 5G-RG provides the external IP
address and the associated port range for each device to the ACS.
Impacts to and assumptions on the 5G-RG and ACS are out of 3GPP scope and are
to be verified by BBF/Cablelabs.
## 6.22 Solution 22: Support differentiated QoS for AUN3 devices
### 6.22.1 Description
This clause specifies a solution for KI#1. It specifies how to support traffic
identification and differentiated QoS for Authenticable Non-3GPP (AUN3)
devices connected behind a 5G-RG. As defined in clause 3.1, an AUN3 device is
a Non-3GPP device which does not support NAS over non-3GPP access but it can
be authenticated by 5GC (so, it possesses 5G credentials).
In short, the solution supports the following capabilities:
a) It enables an AUN3 device to connect to a 5G-RG after being authenticated
and authorized by the HPLMN of this device. The authentication procedure does
not require 5GS registration because it is based on the NSWO authentication
procedure specified in Annex S of TS 33.501 [9].
b) It enables the AUN3 device to exchange data packets via the PDU Session of
5G-RG, each one marked with a unique Traffic Identifier (thus, it enables per-
device traffic identification and charging); and
c) It enables the AUN3 device to exchange data packets via the PDU Session of
5G-RG, all of them using a specific QoS flow (thus, it enables per-device QoS
handling).
### 6.22.2 Procedures
The main steps of the solution are illustrated in the following figure and are
described below. It is assumed that the SMF supports an SWa interface and can
interact with a Non-Seamless WLAN Offload Function (NSWOF) defined in TS
23.501 [2].
Figure 6.22.2-1
0\. The 5G-RG registers with a 5G core network (PLMN (5G-RG)) using its own 5G
credentials and establishes a PDU Session, which can be used by devices
operating \"behind\" the 5G-RG, such as, the AUN3 device. This PDU Session
typically supports one or more QoS flows, each one providing different QoS
handling.
The PDU Session of the 5G-RG must be controlled by an SMF that supports the
SWa interface and, therefore, it can communicate with one or more NSWOFs. If
not all SMFs in the PLMN (5G-RG) support this capability, then, during this
PDU Session establishment, the AMF must select an SMF that supports this
capability (i.e. the SWa interface). The AMF may decide to select an SMF that
supports the SWa interface, either because:
a) It receives a new indication from the 5G-RG, e.g. a new indication in the
NAS message sent from the 5G-RG to AMF; or
b) It receives a new indication in the subscription information of 5G-RG
(retrieved from UDM), which indicates that all PDU Sessions of this 5G-RG must
use an SMF that support the SWa interface.
The alternative a) is preferable because it allows the 5G-RG to send the new
indication to AMF only for the PDU Sessions which can be shared by devices
\"behind\" the 5G-RG.
1\. The AUN3 device requests to connect to 5G-RG, e.g. it performs a WLAN
association with the 5G-RG. This triggers the 5G-RG to initiate an EAP-based
authentication procedure, hence, it sends an EAP-Request/Identity to AUN3,
which responds with an EAP-Response/Identity containing its Subscriber
Concealed Identity (SUCI) in a form of a Network Access Identifier (NAI). The
realm part of NAI contains the MCC/MNC of the HPLMN of the AUN3 device.
2\. The 5G-RG requests from SMF to authenticate the AUN3 device and to
determine whether the AUN3 device is authorized to connect to the 5G-RG and
share its PDU Session. For this purpose, the 5G-RG sends a new 5GSM message to
SMF, called PDU Session Third-Party Authentication Request message. The
\"Third-Party\" signifies that the authentication request is not for the 5G-RG
but for another device operating behind the 5G-RG. The PDU Session Third-Party
Authentication Request message includes the EAP-Response/Identity received by
the AUN3 device.
Editor\'s note: The solution assumes that the SMF supports an SWa interface
and interacts with NSWOF. However, it is possible that the SWa interface is
supported by the 5G-RG and the 5G-RG interacts directly with NSWOF. In this
case, the SMF is not involved in the authentication procedure of AUN3 device
and the new 5GSM messages are not needed. The details of this case are FFS.
3-6. A NSWO mutual authentication procedure takes places between the AUN3
device and AUSF, using EAP-AKA\' authentication. These steps are the same as
those specified in, Annex S of TS 33.501 [9], with the following differences:
a) In step 4a, the UDM provides not only the Subscriber Permanent Identity
(SUPI) of the AUN3 device, but also \"QoS Info\" for the data traffic of the
AUN3 device. This \"QoS Info\" is part of the subscription data of the AUN3
device and identifies the QoS that should be applied to handle the data
traffic of the AUN3 device when carried over the PDU Session of the 5G-RG. All
traffic associated with the same AUN3 device has the same QoS treatment.
For example, the \"QoS Info\" may contain QoS parameters such as a 5QI value
and/or a packet delay budget and/or a packet error rate. The \"QoS Info\" is
later used by SMF to determine the QoS flow on which the data traffic of AUN3
device should be sent over the PDU Session of the 5G-RG.
The UDM decides to provide the QoS Info based on the information received in
step 3c, for example, based on the value of the Access Network Identity, or
another parameter. For example, if the Access Network Identity is different
from \"5G:NSWO\" (which is specified in Annex S of TS 33.501 [9], for NSWO),
then the UDM may decide to provide the QoS Info.
Editor\'s note: Instead of sending the QoS Info in step 4a, the SMF (after
step 6b) may request from UDM subscription data for the AUN3, including the
QoS Info. Whether this alternative is better is FFS.
b) In step 6a, if the authentication procedure is successful, the AUSF
provides the QoS Info received from UDM and also the SUPI of the AUN3 device.
c) In step 6b, the SUPI and the QoS Info are forwarded to SMF. This way the
SMF receives both the permanent subscriber identity of the AUN3, which can be
used for charging, and information indicating the QoS that should be used to
handle the data traffic of the AUN3 device.
d) In step 6c, the SMF responds to 5G-RG with a PDU Session Third-Party
Authentication Result message. If the authentication procedure is successful,
this message contains, not only the EAP-Success packet and the Master Session
Key (MSK), but also the following parameters:
\- A Traffic Identifier, which will be carried in all GTP-U or GRE datagrams
exchanged between the 5G-RG and UPF that encapsulate data packets to/from the
AUN3 device. Via this identifier, the UPF can identify the traffic of each
AUN3 devices behind the 5G-RG.
Editor\'s note: The 5G-RG encapsulates all traffic of the AUN3 device into
either GTP-U or GRE packets, which carry the Traffic Identifier in their
headers. It is FFS whether GTP-U or GRE is used. It is also FFS whether the
Traffic Identifier needs to be sent over the user plane.
\- The QoS flow on which the data traffic of AUN3 device should be sent when
carried over the PDU Session of the 5G-RG.
8\. After the EAP-Success message is sent, the AUN3 device and the 5G-RG
establish a security context to secure the air-interface traffic. In case of
WLAN access, this is typically accomplished by applying the 4-way handshake
procedure specified in IEEE 802.11. In addition, the AUN3 device obtains IP
configuration data, including an IPv4/IPv6 address/prefix.
9\. The SMF sends to UPF the SUPI of the AUN3 device and the associated
Traffic Identifier, so that the UPF can identify and, possibly, charge the
data traffic of the AUN3 device.
Editor\'s note: The details of how and if the Traffic Identifier can be used
for charging the data traffic of the AUN3 device are FFS.
10\. If the QoS flow provided by SMF in step 6c does not exist in the PDU
Session of the 5G-RG, the 5G-RG initiates a PDU Session Modification procedure
to establish a new QoS flow.
12\. The 5G-RG sends the data traffic received from the AUN3 device to the QoS
flow corresponding to this AUN3 device. Similarly, the UPF sends the data
traffic received from the data network and is destined to the AUN3 device to
the QoS flow corresponding to this AUN3 device. Between the 5G-RG and the UPF,
the data traffic of the AUN3 device is encapsulated within GTP-U or GRE
datagrams, each one containing the Traffic Identifier that corresponds to this
AUN3 device (the one provided by SMF in step 6c).
### 6.22.3 Impacts on Existing Nodes and Functionality
HPLMN (AUN3 device):
Shall be able to support NSWO authentication (as defined in Annex S of TS
33.501 [9]) and shall be able to provide QoS Info for the AUN3 device. The QoS
Info could be part of the subscription data of the AUN3 device.
AMF:
Shall be able to select an SMF that supports the SWa interface.
Editor\'s note: It is FFS how determines to select an SMF that supports the
SWa interface.
NRF:
Manage a new SMF registration and discovery capability related with SWa
support.
SMF:
Shall be able to support the SWa interface and to initiate an NSWO
authentication procedure with the HPLMN of the AUN3 device. It shall also be
able to create a Traffic Identifier for the AUN3 device and to determine the
QoS flow that should be used for the AUN3 device. In addition, it shall
support the new 5GSM messages \"PDU Session Third-Party Authentication
Request/Response\".
5G-RG:
Shall encapsulate the data traffic of the AUN3 device within GTP-U or GRE
datagrams, each one containing the Traffic Identifier that corresponds to this
AUN3 device. In addition, it shall support the new 5GSM messages \"PDU Session
Third-Party Authentication Request/Response\".
UPF:
Shall encapsulate the data traffic of the AUN3 device within GTP-U or GRE
datagrams, each one containing the Traffic Identifier that corresponds to this
AUN3 device.
Editor\'s note: It is FFS whether the Traffic Identifier needs to be sent over
the user plane.
NAS protocol:
New 5GSM messages are introduced: \"PDU Session Third-Party Authentication
Request/Response\".
UDM:
If the UDM provides the QoS Info in step 4a (see relevant Editor\'s note in
clause 6.22.2), the UDM shall provide the QoS Info when specific information
is received from AUSF, e.g. based on the value of the received Access Network
Identity.
PCF:
Editor\'s note: The impact on PCF is FFS.
## 6.23 Solution 23: Delay budget for non-3GPP devices behind 5G-RG
### 6.23.1 Description
QoS experienced by non-3GPP devices behind a 5G-RG depends on the end-to-end
path between a non-3GPP device and the application server, i.e. depends on the
QoS differentiation in both the 3GPP network and the non-3GPP network attached
to the 5G-RG.
The packet delay budget (PDB) currently only considers the delay between the
UPF and the 5G-RG; the additional delay between the 5G-RG and the non-3GPP
devices is not accounted for.
To address this shortcoming, this solution proposes to make 5GS aware of the
additional delay that can occur in the non-3GPP network attached to the 5G-RG
and to compensate for this delay in 5GS. The compensation is achieved by
reducing the PDB for the 3GPP network by the delay that can occur in the
non-3GPP network attached to the 5G-RG (referred to as non-3GPP delay
hereafter).
This solution proposes two enhancements to make 5GS aware of the non-3GPP
delay:
\- A Default non-3GPP network delay budget is configured in the UDR as part of
the PDU Session policy control subscription information. The PCF applies the
Default non-3GPP delay budget when taking policy decisions, i.e. the PCF
reduces the PDB for a given flow by the Default non-3GPP delay budget.
\- If supported by the 5G-RG and if the 5G-RG wants to change the default
non-3GPP delay budget for a specific flow, the 5G-RG may use the UE requested
PDU Session Modification procedure to request a non-3GPP delay budget for a
set of packet filters. The SMF provides the Requested non-3GPP delay budget
received from the 5G-RG to the PCF, which takes it into account for the
subsequent policy decision.
The solution applies to 5G-RG connected via FWA as defined in TS 23.316 [5].
The solution addresses Non authenticable non-3GPP devices and Authenticable
non-3GPP devices.
### 6.23.2 Procedures
Figure 6.23.2-1: Taking delays in the non-3GPP network attached to the 5G-RG
into account in 5GS
1\. PDU Session is established
2\. Application layer signalling is exchanged between an application on a
non-3GPP device connected to the 5G-RG and an application function (AF)
3\. Based on the application layer signalling, the AF requests QoS for
application flows.
NOTE 1: If the AF is not considered trusted, then the AF interacts with the
NEF instead. If the AF provides explicit QoS parameters, then AF (or NEF in
case the AF is not trusted) interacts with PCF as defined in clause 4.15.6.6
of TS 23.502 [3].
NOTE 2: Steps 1-3 are following existing Rel-17 specifications.
4\. PCF creates/updates PCC rules based on the AF request. If the PDU Session
policy control subscription information in the UDR contains a Default non-3GPP
delay budget, then the PCF takes it into account by reducing the PDB for the
application flows by the Default non-3GPP delay budget.
5\. PCF sends the PCC rules to the SMF and also includes the Non-3GPP delay
budget.
6\. SMF completes the PDU Session modification based on the PCC rules received
from the PCF and includes in the N1 SM container the Non-3GPP delay budget
provided by the PCF. A Pre-Rel-18 5G-RG or a Rel-18 5G-RG that does not
support the Non-3GPP delay budget information, will ignore the Non-3GPP delay
budget included in the N1-SM container.
7\. Application traffic is exchanged between the application on a non-3GPP
device connected to the 5G-RG and an application function (AF).
8\. If the 5G-RG supports signalling of Non-3GPP delay budget information and
determines the need to request a different Non-3GPP delay budget for a
specific flow of a non-3GPP device, then the 5G-RG initiates the UE requested
PDU Session Modification procedure and includes the Requested Non-3GPP delay
budget. The packets filters that the 5G-RG includes in the UE requested PDU
Session Modification Request include at least the non-3GPP devices\' IP
address and optionally port numbers. In case 5G-RG has assigned a private IP
address to the non-3GPP device, then the 5G-RG includes its own IP address and
the port numbers used for the non-3GPP device.
NOTE 3: How the 5G-RG determines the need to request a different Non-3GPP
delay budget for a specific flow (e.g. by monitoring the delays in the
non-3GPP network) is up to 5G-RG implementation.
9\. The SMF provides the Requested Non-3GPP delay budget to the PCF.
10\. PCF creates/updates PCC rules based on the Requested Non-3GPP delay
budget received from the SMF by reducing the PDB for the application flows by
the Requested Non-3GPP delay budget received from the SMF. The PCF may also
alternatively apply a different Non-3GPP delay budget, based on operator
policy. PCF uses the packet filters as signalled by the 5G-RG for the PCC
rules as per existing procedures.
11\. PCF sends updated PCC rules to the SMF and also includes the Non-3GPP
network budget.
12\. SMF completes the PDU Session modification based on the PCC rules
received from the PCF and includes in the N1 SM container the Non-3GPP delay
budget provided by the PCF.
### 6.23.3 Impacts on Existing Nodes and Functionality
\- SMF:
\- Support signalling of non-3GPP delay budget between UE and PCF.
\- PCF:
\- Receive Default non-3GPP delay budget from UDR.
\- Take Default non-3GPP delay budget from UDR into account for policy
decisions (specifically for calculating PDB).
\- Provide Non-3GPP delay budget to SMF.
\- Optionally, support receiving Requested non-3GPP delay budget from SMF.
\- Optionally, take Requested non-3GPP delay budget from SMF into account for
policy decisions (specifically for calculating PDB).
\- UDR:
\- Support Default non-3GPP delay budget as part of the PDU Session policy
control subscription information.
\- 5G-RG:
\- Optionally, support receiving Non-3GPP delay budget from SMF.
\- Optionally, support signalling Requested Non-3GPP delay budget to SMF.
## 6.24 Solution 24: Differentiated QoS for Non-Authenticable non-3GPP devices
behind RG
### 6.24.1 Description
The solution addresses KI#1 and describes how differentiated QoS can be
provided to non-authenticable non-3GPP devices (NAUN3) connected behind the RG
(5G-RG and FN-RG). A NAUN3 device is a non-3GPP device that the 5GC can not
authenticate.
The NAUN3 device is locally authenticated by the 5G-RG using such as pre-
shared secret etc and is invisible to the 5G network. Differentiated QoS can
still be provided by using 5G-RG\'s local configuration (based on DNN /
S-NSSAI for the 5G RG\'s PDU Sessions).
Using local-configuration, the 5G-RG can perform Traffic separation to isolate
traffic from the NAUN3 devices and map them to appropriate PDU Session/QoS
flows. The overall architecture is illustrated in Figure 6.24.1-1.
Figure 6.24.1-1: Architecture for NAUN3 devices behind 5G-RG
### 6.24.2 Procedures
1\. The 5G-RG registers to 5GC as specified in clause 7.2.1.1 of TS 23.316
[5].
2\. The 5G-RG PDU session establishment is done as specified in clause 7.3.1.1
of TS 23.316 [5].
3\. Using local-configuration, the 5G-RG can perform Traffic separation to
isolate traffic from the NAUN3 devices and map them to appropriate PDU
Session/QoS flows.
### 6.24.3 Impacts on Existing Nodes and Functionality
The solution largely re-uses existing functionality.
5G-RG:
\- Be able to map the traffic from NAUN3 devices to a PDU session/QoS Flow of
the 5G-RG.
\- Further considerations on 5G-RG would be brought to BBF and/or CableLabs
attention is FFS.
## 6.25 Solution 25: Differentiated QoS for Authenticable non-3GPP devices
behind RG.
### 6.25.1 Description
The solution addresses KI#1 and describes how differentiated QoS can be
provided to authenticable non-3GPP devices (AUN3) connected behind the RG
(5G-RG and FN-RG). An AUN3 device can be authenticated by the 5GC based on a
permanent identifier (e.g. NAI, physical Mac address).
NOTE: A N3GPP device using a randomized MAC address can still be identified
based on EAP Identity (NAI) if configured on the device. If a N3GPP device
uses a randomized MAC address for authentication, it will be treated as NAUN3
device. It is up to SA3 to study how to identify and authenticate a device
using randomized MAC address. In principle, the registration procedure of N5GC
devices connecting via W-5GAN described in clause 4.10a of Rel-16 TS 23.316
[5] can be followed by AUN3 devices. The authentication procedure of N5GC
device as described in Rel-16 TS 33.501 [9] can be used to authenticate AUN3
devices.
The architecture for providing differentiated services to an AUN3 device
behind 5G-RG is illustrated in Figure 6.25.1-1.
Figure 6.25.1-1: AUN3 device behind 5G-RG
The salient features of this solution are the following:
\- The AUN3 device is authenticated by the 5GC.
\- 5GC can setup a distinct PDU session for each AUN3 device.
\- 5GC can setup distinct QoS Flows for each AUN3 device.
NOTE: FWA deployment is NOT applicable to AUN3 devices.
### 6.25.2 Procedures
The high-level procedure for this solution is described in Figure 6.25.2-1.
NOTE 1: Each AUN3 device is registered to 5GC and has a unique subscription
record in UDM/UDR that is separate from that of the RG.
Figure 6.25.2-1. 5GC registration of AUN3 device
1\. The 5G-RG registers to 5GC as specified in clause 7.2.1.1 of TS 23.316
[5].
2a. The AUN3 device connects to the 5G-RG with non-3GPP access network (e.g.
to establish WiFi connection).
2b. An authentication procedure is triggered (e.g. local authentication or
802.1x authentication). This can be done either by AUN3 device sending a
EAPOL-start frame to 5G-RG or 5G-RG receives a frame from an unknown MAC
address. 5G-RG receives a permanent identifier from the AUN3 device (e.g. an
NAI in form of username\@realm or a physical MAC address).
NOTE 2: How the 5G-RG is triggered to apply procedures for AUN3 devices is
defined by BBF and/or CableLabs. Authentication procedures for AUN3 devices is
to be defined by SA3.
NOTE 3: For FN-RG scenario, step 2b involving the FN-RG and W-AGF is to be
defined by BBF and/or CableLabs.
3\. The 5G-RG, on behalf of the AUN3 devices, sends NAS Registration Request
message to the AMF, including SUCI (or GUTI) of the AUN3 device and a device
capability indicator that the device is AUN3. 5G-RG selects the serving AMF
for the AUN3 device based on the received AN parameters and local policy as
described in TS 23.316 [5].
NOTE 4: Each AUN3 device has its UDM/UDR subscription. AUN3 PDU Session
parameters are checked wrt AUN3 subscription.
4\. AMF selects a suitable AUSF as specified in clause 6.3.4 of TS 23.501 [2].
5\. EAP based authentication defined in TS 33.501 [9] is performed between the
AUSF and the AUN3 device.
NOTE 5: Each AUN3 device is registered to 5GC with its own unique SUPI.
6\. The AMF performs other registration procedures as required (clause
4.2.2.2.2 of TS 23.502 [3]).
7\. The AMF sends the Registration Accept message to the 5G-RG.
8\. The 5G-RG sends the Registration Complete message back to the AMF, when
the procedure is completed. The 5G-RG shall store the 5G-GUTI of AUN3 device
to be able to use it potential later NAS procedures. The 5G-RG shall maintain
a separate N2 connection for the 5G-RG and AUN3 device. Each AUN3 device has
its own NAS connection (own NAS security context in the AMF and with the
5G-RG) and its own NGAP connection separate from that of the 5G-RG.
NOTE 6: Mobility restrictions as defined in clause 4.3.3 of TS 23.316 [5] are
applicable to 5G-RG shall be applicable to the AUN3 device also.
9\. The AMF performs steps 23-24 in clause 4.2.2.2.2 of TS 23.501 [2].
10\. The 5G-RG continues by requesting the establishment of PDU Session(s) on
behalf of the AUN3 device. A distinct PDU session and QoS flows maybe
established for each AUN3 device based on the subscription of the AUN3 device
in the UDM/UDR. The PDU Session establishment/modification/release procedure
is specified in clauses 7.3.1, 7.3.2 and 7.3.3 of TS 23.316 [5].
Distinct RG Level Wireline Access Characteristics (RG-LWAC), which provide
appropriate mapping of QoS characteristics of the 5G QoS flows to the wireline
technology specific QOS parameters to both the W-AGF and 5G-RG are configured
for the 5G-RG and the AUN3 device and specified in clause 4.5.1.2 of TS 23.316
[5].
In the case of FN-RG, Authentication, Registration and PDU session handling is
performed by the W-AGF instead of the 5G-RG as specified in clauses 7.3.4,
7.3.6 and 7.3.7 of TS 23.316 [5].
### 6.25.3 Impacts on Existing Nodes and Functionality
The solution largely re-uses existing functionality.
5G-RG:
\- The 5G-RG is configured to perform registration and PDU Session related
procedures on behalf of the AUN3 device.
\- Further considerations on 5G-RG would be brought to BBF and/or CableLabs
attention is FFS.
W-AGF:
\- In the case of FN-RG, W-AGF is configured to perform registration and PDU
session related procedures on behalf of the AUN3 device.
\- The W-AGF supports multiple PDU sessions, at least one PDU session for each
AUN3 device behind the FN-RG.
Editor\'s note: Further considerations on W-AGF would be brought to BBF and/or
CableLabs attention is FFS.
# 7 Overall Evaluation
Void.
# 8 Conclusions
## 8.1 Key Issue #1: Providing differentiated service for UE and Non-3GPP
devices connected behind a 5G RG
### 8.1.1 General
As the technical issue are generally different for NAUN3 devices, AUN3 devices
and UE(s), the conclusions are split up into 3 parts:
\- support of NAUN3 devices,
\- support of AUN3 devices,
\- support of UE(s).
This sub-clause addresses only common aspects:
The solution that is selected for the normative phase will not violate the
following principles:
\- Principle 1: Each PDU session is associated with only one SUPI /
independent subscription.
\- Principle 2: Only devices/users with independent subscriptions may have
their own Registration and PDU session / Devices with no \"independent\"
subscription/SUPI need to be piggybacked on the RG\'s Registration and PDU
Session.
\- Principle 3: A device can use a RG to access to 5GC only if this RG is
itself duly registered.
Here independent means that the subscription is independent from the 5G-RG\'s
subscription.
Solution 7 is endorsed for normative work (providing non-3gpp QoS assistance
information for a QoS flow to the 5G RG) and applies for any kind of device
with following clarifications including the NOTE(s) below:
\- this applies for 5G RG only;
\- this may apply for both wireline and FWA access;
\- non-3gpp QoS assistance information for a QoS flow may correspond to the
same information that is contained in the Additional QoS Information (as
specified in clause 4.12a.5 of TS 23.502 [3] and in Table 9.3.1.1-2 of TS
24.502 [8]) by the SMF to the 5G-RG in NAS PDU session establishment and PDU
session modification signalling; furthermore non-3gpp QoS assistance
information for a QoS flow may also include ARP and Periodicity information.
NOTE 1: How 5G-RG uses the non-3gpp QoS assistance information to enforce QoS
in non-3gpp networks is outside the scope of 3GPP.
NOTE 2: Transferring information like Periodicity to the 5G RG is not meant to
support TSC/TSN like flows but to support consumer real time applications like
XR (extended Reality, etc.).
\- SMF may additionally include a DSCP value in the non-3GPP QoS assistance
information. The DSCP value may be used by the 5G-RG to derive e.g. IEEE
802.11 user-priority (UP) information in case the non-3GPP access is based on
IEEE 802.11. The details of deriving information from DSCP are beyond the
scope of 3GPP.
### 8.1.2 Conclusion for NAUN3 devices
Normative work will proceed according to following principles:
\- FN RG are not considered.
\- Principles of solution 1 are endorsed as follows:
\- The RG is configured with the mapping between SSID, RG physical ports, etc.
and Connection Capabilities whose values are defined by the operator.
\- Policies configured by the PCF for the RG are used to map from Connection
Capabilities to parameters of the PDU session to use for the traffic of NAUN3
devices (DNN, S-NSSAI, PDU Session Type, SSC mode) associated with a given
Connection Capability.
### 8.1.3 Conclusion for AUN3 devices
Only 5G RG are considered.
\- following principles related with Solution#25 are endorsed where:
\- each AUN3 device has its own UDM/UDR subscription data and policy control
subscription data including its own SUPI, security credential;
\- the 5G RG may issue a NAS register on behalf of an AUN3 device that it is
willing to serve and relay EAP between the AUN3 device and the 5GC;
\- the AMF and the 5G RG maintain a NAS connection per AUN3 device. This
includes maintaining a GUTI and NAS security context per AUN3 device;
\- A 5G RG shall be registered to serve an AUN3 device. This does not mean a
specific registration for 5G RG but means that the 5G RG shall not issue a NAS
register on behalf of an AUN3 device if it is itself not registered;
\- there is a N2 connection per AUN3 device ; the 5G-RG act as multiple UEs so
that it is transparent to the W-AGF;
\- The solution is only applicable if the 5G-RG connects via wireline access /
W-AGF;
\- The solution assumes that the AUN3 devices and the 5G-RG belong to the same
PLMN;
\- once an AUN3 device has been registered, the 5G RG may request to establish
one single PDU session to the 5GC for this AUN3 device;
\- QoS differentiation on this PDU session is supported per existing
specifications;
\- The network (e.g. PCF or OAM) is able to control the aggregate traffic of
all the PDU Sessions (of a 5G RG and of the AUN3 devices using the 5G RG)
using a wireline access, ensuring that the sum of the MBR limits of these PDU
Sessions remains below a subscribed maximum value. The mechanism is to be
determined in normative phase but is not on a per packet basis for the
aggregate;
\- if a RG supports both the existing N5GC procedure and the procedure per
solution 25, it may use the SSID or Ethernet ports used by the device to
determine whether to use AUN3 or N5GC related mechanism.
### 8.1.4 Conclusions for UE(s)
\- in order to support NSWO (as defined in clause 5.42 of TS 23.501 [2]) for
3GPP UE, 5G-RG shall support the SWa\' interface to NSWOF but this aspect is
in the scope of BBF and/or Cable Labs specifications. There are no impacts to
3GPP specifications.
\- For both untrusted and trusted non-3gpp access, QoS differentiation for 5G
UE behind an RG will be supported per the principles described in Solution 2
that are endorsed except following aspect:
\- the RG may buffer the received packets and send the target N3IWF/TNGF IP
address and indication of requesting mapping rules to SMF/PCF.
NOTE 1: The RG can with current specifications request PDU Session
modification when it detects IP flows for which it has no explicit QoS rules
but no specification work will be done in R18 for that feature.
This assumes that 3GPP normative work will be based on:
\- BBF and/or Cable Labs specifications support of 5G RG acting as a TNAP (the
TNAP In the figure below is supported by a 5G RG).
NOTE 2: This is in the scope of BBF and/or Cable Labs specifications.
\- The RG\'s PCF is preconfigured with IP address ranges corresponding to
TNGF/N3IWF(s) and with DSCP used over NWu and NWt, (this corresponds to the
DSCP values used below the IPsec tunnel between the UE and the TNGF/N3IWF).
\- The UE\'s PCF is preconfigured with IP address ranges corresponding to
UE(s) served by wireline access (5G RG) that are to be associated with QoS
policies for wireline access.
\- (for Trusted access) To determine whether an UE is to be considered as a
guest on a wireline access:
\- The TNAP Id of the 5G RG is provided by the 5G RG to the TNGF over Ta and
then by the TNGF to the PCF of the UE as ULI carried via AMF and SMF; this is
working as currently defined in TS 23.501 [2] / TS 23.502 [3].
\- Policy subscription control data in UDR (as defined in TS 23.503 [4], Table
6.2-2: PDU Session policy control subscription information) may contain the
TNAP Id(s) that is/are associated with a UE\'s subscription.
\- An AF may provide TNAP ID for a subscriber (GPSI) which is stored as
Application data in UDR.
\- The PCF may use the TNAP Id of the 5G RG received over ULI and Policy
subscription control data and Application data in UDR (as defined above).
NOTE 3: FN-RG is only supported for untrusted access and with no Rel-18
normative work (e.g. clause 6.2.2 of the present document does not apply to FN
RG).
The following Figure from TS 23.501 [2] is provided for reference for the text
above.
Figure 8.3.2-1: User Plane via TNGF
Solution#9 and Solution#20.2 have been ruled out by CableLabs and BBF.
## 8.2 Key Issue #2: How to select a TNGF/N3IWF that supports the S-NSSAI(s)
needed by the UE
### 8.2.1 How to select an N3IWF that supports the S-NSSAI(s) needed by the UE
Selection of N3IWF that supports the S-NSSAIs needed by the UE is enabled
based on extended ANDSP configuration and NAS-based redirection (using
Registration Reject) as defined by Solution 15 (as updated by S2-2205515).
### 8.2.2 How to select a TNGF that supports the S-NSSAI(s) needed by the UE
Selection of a TNGF that supports the S-NSSAIs needed by the UE is enabled
based on:
\- UE based solutions where UE(s) may use WLAN SP policy to select a SSID
allowing to access to a TNGF that supports the slices the UE are willing to
use and then leverage this information to try registering onto 5GC via TNGF.
\- The WLAN SP policy is extended with the indication of the set of slices
associated to a SSID.
\- The AMF may determine the UE used a wrong SSID based on information
received over N2 from the TNGF.
\- The AMF may trigger the UE Policy Association Establishment procedure to
provide the UE with updated WLANSP if the selected SSID (TNGF) does not
support the slices requested by UE. The AMF requests the PCF to receive a
notification when the PCF has completed the WLANSP update; once the AMF has
received this notification from the PCF, the AMF can issue a registration
reject.
\- AMF may provide the target TNAN information (e.g. such as SSID) associated
with the Requested NSSAI to UE within Registration Reject message.
Editor\'s note: It is FFS whether TNGF ID is provided as part of TNAN
information and the UE needs to use it to build the target NAI.
\- The UE selects an appropriate SSID associated with the Requested NSSAI and
build the realm of NAI.
No solution using the AMF redirection of the UE with a registration accept
will be pursued in normative specifications.
#
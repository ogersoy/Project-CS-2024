# Foreword {#foreword-1}
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The objective of this Technical Report is to study and perform an evaluation
of potential architecture enhancements for supporting 5G Timing Resiliency and
TSC & URLLC enhancements for 5G System (5GS). The following aspects are
covered:
\- Study how to report 5GS network timing synchronization status (such as
divergence from UTC and 5GS network timing source degradation) to UEs and 3rd
party applications (AFs):
\- Study how RAN and 5GC learn about network 5GS network timing
synchronization status to be able to inform UEs and AFs.
\- Study if additional information needs to be provided to UEs and AFs to
inform about 5GS network timing synchronization status.
\- Study how to enable AFs to request time synchronization service in a
specific coverage area and how to enforce the coverage area.
\- Study how to control 5G time synchronization service based on subscription
(i.e. introducing subscription parameter for time synchronization and
enforcing it).
\- Study how to enable an AF to explicitly provide PER to NEF/PCF.
\- Study mechanisms for interworking with TSN transport networks. Study
interworking mechanisms with TSN networks deployed in the transport network in
order to support of E2E determinism and low latency communication and
efficient N3 transmission.
\- Study if there is a need for applications to adapt downstream scheduling in
order for 5GS to meet really low latency (e.g. 2 msecs) requirement and if
there is a need to have feedback from RAN (e.g. for application to consider DL
packet transmission time slots to avoid buffering in the RAN) for this
purpose.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System (5GS); Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[5] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\".
[6] IEEE 802.1Qcc: \"IEEE Standard for Local and Metropolitan Area Networks--
Bridges and Bridged Networks -- Amendment 31: Stream Reservation Protocol
(SRP) Enhancements and Performance Improvements\".
[7] IEEE Std 802.1AS: \"IEEE Standard for Local and Metropolitan Area
Networks-Timing and Synchronization for Time-Sensitive Applications\".
[8] IEEE Std 1588: \"Standard for a Precision Clock Synchronization Protocol
for Networked Measurement and Control Systems\".
[9] 3GPP TR 22.878: \"Feasibility Study on 5G Timing Resiliency System\".
[10] IEEE P802.1Qdj d0.2: \"Configuration Enhancements for Time-Sensitive
Networking\".
[11] 3GPP TS 38.321: \"Medium Access Control (MAC) protocol specification\".
[12] 3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".
[13] 3GPP TS 38.300: \"NR and NG-RAN Overall Description; Stage 2\".
[14] IEEE Std 802.1AB-2016: \"IEEE Standard for Local and metropolitan area
networks - Station and Media Access Control Connectivity Discovery\".
[15] ITU-T Recommendation G.8271.1: \"Network limits for time synchronization
in packet networks with full timing support from the network\".
[16] 3GPP TS 23.273: \"5G System (5GS) Location Services (LCS); Stage 2\".
[17] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Architectural Assumptions and Requirements
## 4.1 Architectural Assumptions
The following architectural assumptions apply:
\- The architecture defined in clause 4.4.8 of TS 23.501 [2] is as a baseline
for the study.
\- The TSN network deployed in the transport network supports the fully
centralised model defined in IEEE 802.1Qcc [6].
NOTE: The transport network and 5GS may belong to the same operator or
different operator.
\- Configuration and operation of the external synchronization network (i.e.
timing synchronization provided by network external to 5GS network) and
mitigation actions when time source fails or degrades are assumed to be
outside the scope of 3GPP.
\- This study is assumed to inherit the time synchronization architecture,
methods, and exposure framework as defined in Rel-17 for 5G System in TS
23.501 [2]. This includes the support for time synchronization service based
on 5G Access Stratum timing distribution, (g)PTP time sync based on IEEE Std
802.1AS [7] with 5GS acting as Grand-master or PTP time sync with 5GS acting
as grand-master based on IEEE Std 1588 [8], along with support for DS-TT, NW-
TT and TSCTSF in the time synchronization architecture.
\- How the 5GS network is time synchronized is assumed to be deployment
specific thus outside the scope of this study (e.g. 5GS may use local GNSS
server, may be time synchronized with an external clock using transport
network synchronization protocols, etc.).
\- The study assumes that sync network design complies with applicable
performance requirements also during network rearrangements (for example, in
the case of ITU-T Recommendation G.8271.1 [15], where budget is allocated to
Sync network rearrangements).
## 4.2 Architectural Requirements
The following architectural requirements apply:
\- Solutions for timing resilience and time synchronization shall support the
already defined time synchronization distribution methods as defined in clause
4.1.
Editor\'s note: In the case of PTP-based time sync, for which IEEE Std 1588
[8] profile(s) to support timing resilience is FFS.
\- Solutions for main 5G time resiliency use cases shall at least support that
the UEs are static to address financial and power grid scenarios, see TR
22.878 [9]), but may also support the scenarios where the UEs may not be
static.
# 5 Key Issues
## 5.1 Key Issue #1: 5GS network timing synchronization status and reporting
### 5.1.1 Description
The objective of this Key Issue is to study the monitoring and reporting for
timing synchronization status in 5GS.
For this Key Issue the following areas should be studied:
\- Study how RAN and 5GC learn about 5GS network timing synchronization status
to be able to inform UEs (e.g. application running in the UE), devices
attached to the UE (i.e. that receive time information from 5GS) and AFs.
\- Study how to report 5GS network timing synchronization status (such as
divergence from UTC and 5GS network timing source degradation) to UEs (e.g.
application running in the UE), devices attached to the UE (i.e. that receive
time information from 5GS) and 3rd party applications (AFs).
\- Study if additional information needs to be provided to UEs and AFs to
inform about 5GS network timing synchronization status.
## 5.2 Key Issue #2: Time synchronization service enhancements
### 5.2.1 Description
The objective of this Key Issue is to study enhancements for 5GS time
synchronization considering the coverage area where the service is configured.
For this Key Issue the following areas should be studied:
\- How to enable AFs to request time synchronization service in a specific
coverage area and whether and how to enforce the coverage area.
## 5.3 Key Issue #3: Support for controlling 5G time synchronization service
based on subscription
### 5.3.1 Description
Control of time synchronization service based on UE subscription is important
for the operator in managing time critical services such as smart grid or
financial services.
This key issue aims at studying how to control 5G time synchronization service
based on subscription (i.e. introducing subscription parameter for time
synchronization and enforcing it).
The following technical issues will be studied:
\- How to authorize time synchronization service based on UE subscription.
\- How to enforce time synchronization service on a per UE basis based on
subscription.
\- What parts of time synchronization service require a separate UE
subscription (and authorization), if any.
## 5.4 Key Issue #4: How to enable an AF to explicitly provide PER to NEF/PCF
### 5.4.1 Description
For this Key Issue the following areas should be studied:
1\. Enable an AF to explicitly provide the required PER to the NEF/PCF for QoS
and Alt-QoS.
## 5.5 Key Issue #5: Interworking with TSN network deployed in the transport
network
### 5.5.1 Description
The objective of this Key Issue is to study interworking mechanisms with TSN
networks deployed in the transport network in order to support of E2E
determinism and low latency communication and efficient N3 transmission.
This Key Issues applies only to 3GPP layer traffic flows that fall in the
category of \"periodic deterministic communication\" as defined in clause
5.27.1a of TS 23.501 [2], i.e. for 3GPP layer traffic flows that can be
associated with the TSCAI parameters - namely, burst arrival time, periodicity
and flow direction.
For this Key Issue the following areas should be studied:
a) The architecture enhancement to support the interworking between 5GS and
TSN networks deployed in the transport network.
b) What information are needed and how to collect these information from 5GS
(e.g. NG-RAN, 5GC NF), so that the 5GS can interact with TSN network. Also,
determine which 5GS entity is responsible to provide it to the TSN network
deployed in the transport network.
NOTE: In the context of interworking with a TSN-based transport network, 5GS
is assumed to take the role of the CUC towards the CNC of the TSN transport
network. It is assumed to rely on on-going work in IEEE for the interaction
between CUC and CNC (P802.1Qdj), i.e. no new interface to the CNC will be
specified as part of this work.
## 5.6 Key Issue #6: Adapting downstream scheduling based on RAN feedback for
low latency communication
### 5.6.1 Description
This key issue is targeting how for applications to adapt downstream
scheduling in order for 5GS to meet really low latency (e.g. 2ms) requirement.
For this key issue, the following areas should be studied:
\- Need for application transmission schedule adaptation and the ability to
meet extremely low PDB for a QoS Flow from the 5GS perspective for periodic
traffic streams (based on feedback from RAN WGs).
\- How to enable the RAN to provide feedback to application for low latency
communication (e.g. for application to consider DL packet transmission time
slots to avoid buffering in the RAN) for this purpose.
NOTE 1: The key issue needs to consider also the downlink scheduling in N3
transport network as studied under the Key Issue #x: Interworking with TSN
network deployed in the transport network.
NOTE 2: Although the focus is on downstream scheduling, any optimization on
upstream scheduling should not be precluded if similar enhancement as for
downstream scheduling applies.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
              Key Issue \#1   Key Issue \#2   Key Issue \#3   Key Issue \#4   Key Issue \#5   Key Issue \#6
* * *
Solutions  
#1 X  
#2 X #3 X  
#4 X  
#5 X  
#6 X  
#7 X  
#8 X  
#9 X  
#10 X  
#11 X  
#12 X #13 X #14 X  
#15 X #16 X #17 X  
#18 X  
#19 X  
#20 X  
#21 X #22 X
## 6.1 Solution #1: Inform UE and AF about network timing synchronization
status
### 6.1.1 Introduction
This solution enables UE and AF to learn about network timing synchronization
status, addressing KI #1.
This solution makes the following assumptions:
\- NG-RAN is time synchronized with an external clock using transport network
synchronization protocols or using a local GNSS receiver.
\- NG-RAN can detect network timing synchronization degradation/improvement or
timing synchronization failures locally, e.g. based on information provided by
the transport network time synchronization protocols or based on information
provided by the local GNSS receiver. The details of how NG-RAN detects timing
synchronization degradation/improvement or timing synchronization failures are
beyond the scope of 3GPP.
\- If UPF/NW-TT is involved in providing timing information to UEs, UPF/NW-TT
is time synchronized e.g. using transport network-based time synchronization
protocols.
\- UPF can detect network timing synchronization degradation/improvement or
timing synchronization failures locally, e.g. based on information provided by
the transport network time synchronization protocols. The details of how the
UPF detects timing synchronization degradation/improvement or timing
synchronization failures are beyond the scope of 3GPP.
This solution addresses the following scenarios for 5G internal timing
distribution:
\- 5GS distributes timing information to UEs using access stratum signalling.
\- 5GS is acting as GM and distributes timing information to UEs using PTP or
gPTP.
### 6.1.2 Functional Description
The solution is based on the following principles:
\- Informing 5GC and AFs about network timing synchronization status:
\- Informing 5GC about RAN and UPF time synchronization status:
\- TSCTSF subscribes for receiving RAN time synchronization status on a per
RAN node level from NWDAF:
\- NWDAF subscribes for RAN time synchronization status information from OAM.
RAN time synchronization internal status information includes e.g.
synchronization state, primary source information (e.g. type, quality, lock
state), relevant PTP dataset members such as clock class (if PTP applies), the
more general UTC traceability information, stability and clock accuracy.
\- As an alternative option, TSCTSF subscribes for RAN time synchronization
status information from OAM. RAN time synchronization status information
includes e.g. synchronization state, primary source information (e.g. type,
quality, lock state), relevant PTP dataset members such clock class (if PTP
applies), the more general UTC traceability, stability and clock accuracy
information.
\- If UPF/NW-TT is involved in providing time information to DS-TT, TSCTSF
subscribes for receiving time synchronization status from UPF (i.e. the status
of the synchronization of the UPF with the transport network timing):
\- Based on this, UPF reports transport network time synch status (e.g.
relevant PTP dataset members such as clock class (if PTP applies), UTC
traceability information and clock accuracy and stability) to TSCTSF.
NOTE 1: UPF time synchronization status is only needed for the option when
UPF/NW-TT is generating and timestamping messages for the DS-TT, which are
forwarded from DS-TT adding residence time.
\- Determining UEs impacted by RAN time synchronization status degradation or
improvement:
\- TSCTSF subscribes to receive location information (RAN node granularity)
from AMF for UEs that AF requested time synchronization for.
\- TSCTSF requests UEs for which an AF requested time synchronization to
perform a Registration Update if the UE is in CM-IDLE and detects a change in
the RAN time synchronization status information (see below) for the current
cell or when re-selecting to a different cell. This ensures that the CN is
made aware of the location of a UE if the RAN time synchronization status
changes while a UE that has been configured to receive time information is in
CM-IDLE.
\- Determining UEs impacted by UPF time synchronization status degradation or
improvement (only for the case when UPF/NW-TT is involved in providing time
information to DS-TT):
\- If TSCTSF receives time synchronization status information for NG-RAN nodes
from NWDAF (or from OAM directly) indicating time synchronization status
degradation or improvement, then TSCTSF determines the UEs served by those NG-
RAN nodes based on location information received from AMF.
\- If TSCTSF receives time synchronization status information from UPF
indicating time synchronization status degradation or improvement, then the
TSCTSF determines the UEs for which the UPF/NW-TT or the DS-TT co-located with
those UEs is configured to send (g)PTP messages.
\- Inform AFs about network timing synchronization status degradation or
improvement:
\- If TSCTSF has determined UEs impacted by RAN or UPF time synchronization
status degradation or improvement then TSCTSF informs the AF about the network
timing synchronization status for those UEs as follows:
\- For UEs impacted by RAN time synchronization status degradation or
improvement for which the AF has requested 5G access stratum time
distribution, TSCTSF determines if the Time synchronization error budget
provided by the AF can be met given the change of clock accuracy for the RAN
node serving the UE:
\- If the sum of the clock accuracy of the RAN node serving a UE and the Uu
time synchronization error budget previously calculated for the UE (see clause
5.27.1.9 of TS 23.501 [2]) exceeds the Time synchronization error budget
provided by the AF, then the TSCTSF informs the AF that the time
synchronization request cannot be fulfilled for the impacted UE.
\- Otherwise, the TSCTSF informs the AF that the time synchronization request
can be fulfilled again for the impacted UE.
\- For UEs for which the AF has requested (g)PTP based time distribution and
which are impacted by RAN and/or UPF time synchronization status degradation
or improvement, TSCTSF determines if the Time synchronization error budget
provided by the AF can be met given the change of clock accuracy for the RAN
node serving the UE and/or the change of clock accuracy reported by the UPF:
\- If the sum of:
\- the clock accuracy of the RAN node serving a UE;
the Uu time synchronization error budget previously calculated for the UE (see
clause 5.27.1.9 of TS 23.501 [2]); and
\- (if NW-TT is configured to act as Grandmaster on behalf of the UE/DS-TT)
the clock accuracy reported by the UPF;
\- exceeds the Time synchronization error budget provided by the AF, the
TSCTSF informs the AF that the time synchronization request cannot be
fulfilled for the impacted UE by indicating the PTP port state as Inactive for
the related DS-TT PTP port.
\- Otherwise, the TSCTSF informs the AF that the time synchronization request
can be fulfilled again for the impacted UE by indicating the PTP port state as
Active for the related DS-TT PTP port.
Editor\'s note: Whether and how to provide network timing synchronization
status for the case that an AF requested time synchronization service in a
specific coverage area depends on the progress of the related key issue.
\- Informing UEs and devices attached to UE/DS-TT about network timing
synchronization status:
\- NG-RAN detects network timing synchronization degradation or failure based
on implementation-specific means.
\- NG-RAN informs UEs that receive 5G access stratum time about the time
synchronization status by providing additional time synchronization status
information (e.g. synchronization state, primary source description (e.g.
type, quality, lock state), clock class and information about traceability to
UTC, clock accuracy and stability) to UEs in SIB or using dedicated RRC.
\- Reflecting RAN and UPF time synchronization status degradation and
improvement in Announce messages sent by DS-TT and NW-TT:
\- If TSCTSF has determined that UEs that are part of a PTP instance are
impacted by RAN or UPF time synchronization status degradation or improvement
for which the Time synchronization error budget provided by the AF can still
be met (see above), then TSCTSF may update the clockQuality information sent
in Announce messages (see IEEE 1588 [8] clause 7.6.2) for the PTP instance.
For example, TSCTSF may change the clockQuality information to reflect that
the clock has entered holdover state or to reflect a change in clock accuracy.
\- If a DS-TT is configured to send Announce messages for the related PTP
port, then TSCTSF changes the clockQuality information for the related PTP
port using PMIC.
\- If NW-TT is configured to send Announce messages on behalf of the DS-TT,
then TSCTSF changes the clockQuality information for the related PTP port
using UMIC.
\- The handling of Announce messages follow existing procedures as described
in TS 23.501 [2].
NOTE 2: ClockQuality information included in Announce message needs to be the
same for all PTP ports of the same PTP instance. Therefore TSCTSF needs to
configure the same clockQuality information for all UEs that are part of the
same instance PTP instance even if only some UEs are impacted. For example, if
one UE that is part of a PTP instance is served by a RAN node that lost
synchronization to a primary reference time source (e.g. GNSS) and enters
holdover mode, then the clockClass attribute needs to be changed for all UEs
that are part of that PTP instance. Alternatively, disabling the impacted UE
PTP port would preserve the other UEs\' status.
NOTE 3: Time synchronization status information provided to the UE using RRC
is assumed to be used by the UE, e.g. for applications running on the UE or to
provide time information to devices attached to the UE using implementation
specific means. Time synchronization status information provided to UE/DS-TT
by 5GC in (g)PTP (e.g. clock class, clock accuracy) is assumed to be consumed
by devices attached to the UE to which UE/DS-TT forwards the (g)PTP
frames/packets.
\- Deactivation and re-activation of (g)PTP based time synchronization due to
RAN or UPF time synchronization status degradation and improvement:
\- If TSCTSF has determined UEs impacted by RAN or UPF time synchronization
status degradation (see above) for which the AF has requested (g)PTP based
time distribution and for which the Time synchronization error budget provided
by the AF cannot be met (see above) then TSCTSF temporarily removes the UE/DS-
TT from the PTP instance:
\- If the DS-TT is configured to send Sync, Follow_Up and Announce messages
for the related PTP instance, then TSCTSF deactivates the Grandmaster
functionality in the DS-TT using PMIC (see also clause K.2.2.4 of TS 23.501
[2]) and removes the DS-TT from the PTP instance (see also clause K.2.2.1 of
TS 23.501 [2]).
\- If NW-TT is configured to send Sync, Follow_Up and Announce messages on
behalf of the DS-TT, then TSCTSF deactivates the Grandmaster functionality on
behalf of the DS-TT in NW-TT using UMIC (see also clause K.2.2.4 of TS 23.501
[2]) and removes the DS-TT from the PTP instance (see also clause K.2.2.1 of
TS 23.501 [2]).
\- If TSCTSF has determined UEs impacted by RAN or UPF time synchronization
status improvement for which the AF has requested (g)PTP based time
distribution and for which the Time synchronization error budget provided by
the AF can be met again (see above) then TSCTSF adds the DS-TT PTP port to the
PTP instance again and also re-activates the Grandmaster functionality.
### 6.1.3 Procedures
### 6.1.4 Impacts on services, entities and interfaces
NG-RAN:
\- Indicate RAN network timing synchronization status to UEs in RRC signalling
or SIB9.
UE:
\- Support receiving RAN network timing synchronization status information.
\- Support performing a Registration request when RAN network timing
synchronization status information changes while the UE is in CM-IDLE, if
requested by TSCTSF.
NWDAF:
\- Support subscribing for RAN time synchronization status information from
OAM and providing RAN time synchronization status information to TSCTSF.
TSCTSF:
\- Receive time synchronization status information from NWDAF (or OAM) and
UPF.
\- Subscribe for receiving location information from AMF.
\- Support for requesting UEs to perform a Registration request if the UE
detects a change in RAN network timing synchronization status information and
the UE is in CM-IDLE.
\- Inform AFs about time synchronization status (i.e. for which UEs time
synchronization can be provided or not due to 5GS time synchronization
status).
\- Discover serving AMF for a UE.
UPF:
\- Report transport network time synch status (e.g. primary source information
and status, clock class UTC traceability and clock accuracy and stability) to
TSCTSF if NW-TT is configured to generate (g)PTP messages (see case (a) in
clause 5.27.1.7 of TS 23.501 [2].
## 6.2 Solution #2: Burst arrival time adaptation
### 6.2.1 Introduction
This solution enables the network to adjust the burst arrival time by
signalling positive or negative offset values (e.g. +3 ms) to the AF so that
the AF can adjust the burst sending time accordingly.
Providing a burst arrival time offset value to an AF does not require 5GS and
AF to be time synchronized.
The solution builds on top of the QoS notification control mechanism (clause
5.7.2.4.1a (without Alternative QoS Profiles) or clause 5.7.2.4.1b (with
Alternative QoS Profiles) of TS 23.501 [2]). In line with the assumptions for
the existing QoS notification control mechanism, also this solution applies
only if the application traffic is able to adapt to the change in QoS, i.e. if
an application can tolerate that the PDB target is temporarily not met.
### 6.2.2 Functional Description
This solution is based on the following principles:
\- When requesting QoS for a flow as defined in clause 6.1.3.22 of TS 23.503
[4], AF may also indicate support of Burst arrival time adaptation to5GS. AF
also subscribes to receive notifications for successful resource allocation
and when the QoS targets can no longer (or can again) be fulfilled as
described in clause 6.1.3.18 of TS 23.503 [4].
\- PCF forwards the support of Burst arrival time adaptation indication to SMF
together with a PCC rule and other parameters (burst size, flow direction,
burst periodicity), BAT (optional)), if provided by the AF. PCF enables QoS
Notification Control in the PCC rule.
NOTE 1: If AF and 5GS are time synchronized, then the AF may additionally
include BAT.
\- SMF creates TSCAI based on the received periodicity , flow direction and
BAT (if provided by PCF). If PCF indicated support of Burst arrival
adaptation, SMF includes support of Burst arrival time adaptation indication
in TSCAI and signals TSCAI to NG-RAN as described in clause 4.3.3.2 of TS
23.501 [2]. As part of this, SMF also activates QoS notification control.
\- At any time after the flow has started, if NG-RAN has received the
indication of support of Burst arrival time adaptation in TSCAI for the given
QoS Flow and NG-RAN determines that the PDB of the QoS profile cannot be
fulfilled in DL direction, then NG-RAN sends a notification to SMF as defined
in clause 5.7.2.4.1a of TS 23.501 [2] (if no Alternative QoS parameters have
been provided) or as defined in clause 5.7.2.4.1b of TS 23.501 [2] (if
Alternative QoS parameters have been provided). As part of the notification to
SMF, NG-RAN may include a burst arrival time offset value. The burst arrival
offset can take positive or negative values.
NOTE 2: NG-RAN determines a relative burst arrival time offset value in
reference to the current Burst Arrival Time experienced by RAN (i.e. in
reference to when RAN currently receives bursts). Since it is a relative
offset it can also be applied by the AF for adapting when it sends bursts,
i.e. for the AF to adapt the burst sending time (see further below).
NOTE 3: Since NG-RAN is aware of the radio resource situation NG-RAN can
determine whether it would be possible to support the PDB of the QoS profile
again if the burst was shifted in the time domain and calculate the required
offset value.
NOTE 4: The QoS notification procedure, which is reused by this solution
already avoids too frequent signalling to the SMF (see NOTE 2 in clause
5.7.2.4.1b of TS 23.501 [2]).
\- The burst arrival time offset value is signalled from SMF to AF via
PCF/TSCTSF/NEF using existing Notification control signalling.
\- For downlink flows AF adapts the burst sending time based on the received
offset.
### 6.2.3 Procedures
Existing procedures are reused (PDU session modification to signal support of
Burst arrival time adaptation indication in TSCAI to NG-RAN; Notification
control as defined in clause 5.7.2.4.1a or clause 5.7.2.4.1b of TS 23.501 [2].
to signal burst arrival time offset value to PCF/TSCTSF/NEF/AF).
### 6.2.4 Impacts on services, entities and interfaces
AF:
\- Support of sending burst arrival time adaptation indication and receiving
burst arrival time offset.
NEF, PCF, TSCTSF, SMF:
\- Support of signalling burst arrival time adaptation indication and burst
arrival time offset.
NG-RAN:
\- Support of receiving burst time arrival adaptation indication, determining
and signalling burst arrival time offset.
## 6.3 Solution #3: Timing synchronization resiliency and status reporting
### 6.3.1 Introduction
This solution aims to address Key issue #1: 5GS network timing synchronization
status and reporting. When 5GS provides timing resiliency service e.g. in the
smart grid or financial sector, the timing synchronization status (such as
divergence from UTC, timing source degradation) needs to be able to inform UEs
(e.g. application running in the UE), devices attached to the UE (i.e. that
receive time information from 5GS) and AFs. The AF can configure 5GS with the
requirements about the timing resiliency service to meet when timing
synchronization event happens.
This solution makes the following assumptions:
\- UEs are consuming (g)PTP timing synchronization service from UPF/NW-TT that
acts as Grand-master based on IEEE Std 802.1AS [7] or IEEE Std 1588 [8];
\- 5G GM may have different sources of time/frequency like GNSS signal,
Synchronous Ethernet (SyncE), PTP transport network, PPS input, etc. It is
assumed that UPF is synchronized with 5G GM by PTP compatible transport, etc.
\- When UPF detects 5GS networking timing synchronization status for original
5G GM timing source, it sends the reporting to 5GC. Additionally, the UPF
activates the timing synchronization configuration for PTP GM functionality as
configured by TSCTSF in the case of degradation for original 5G GM timing
source, so as to provide seamless time synchronization service for the UEs; or
the UPF de-activates the timing synchronization configuration for PTP GM
functionality as configured by TSCTSF in the case of recovery for original 5G
GM timing source.
NOTE: This solution assumes the time synchronization service is offered by
(g)PTP based timing distribution, and can be used in combination with other
solutions (e.g. sol#4 in clause 6.4) to address the case where the time
synchronization service is offered based on 5G Access Stratum timing
distribution.
### 6.3.2 Functional Description
This solution uses the following principles:
\- TSCTSF collects timing synchronization capability of UPF. The TSCTSF
retrieves the timing synchronization capability via PMIC or UMIC, and then
TSCTSF sends the collected information to AF if it subscribes:
\- The timing synchronization capability can indicate holdover time or
traceability capability information. For example, clock class, synchronization
accuracy, holdover time parameters for the smart grid scenario, or UTC
divergence scale and synchronization accuracy parameters for financial
scenario.
\- TSCTSF creates timing synchronization configuration on the UPF upon
reception of AF request:
\- TSCTSF receives timing synchronization requirement from AFs. The timing
synchronization requirement consists of the time synchronization error budget.
AF may also request to subscribe network timing synchronization status from
TSCTSF (if it is a trusted AF, or via NEF).
\- TSCTSF confirms that the 5GS can meet the requirement based on UPF reported
timing synchronization capability.
\- TSCTSF creates a timing synchronization configuration on UPF.
\- With the timing synchronization configuration, the UPF detects and reports
the networking timing synchronization status, and (de)activates the timing
synchronization configuration for PTP GM functionality accordingly.
\- UEs are consuming (g)PTP timing synchronization service from UPF/NW-TT that
acts as grand-master based on IEEE Std 802.1AS [7] or IEEE Std 1588 [8].
\- When UPF detects networking timing synchronization status for original 5G
GM timing source, it sends the status reporting to TSCTSF, and the TSCTSF
forwards the reporting to AFs:
\- When UPF detects recovery for original 5G GM timing source, the UPF
activates the timing synchronization configuration for PTP GM functionality as
configured by TSCTSF, and the status reporting contains: 5GS timing
synchronization enabled status, the timing source clock class, time validity.
\- When UPF detects degradation or unavailable for original 5G GM timing
source, the UPF de-activates the timing synchronization configuration for PTP
GM functionality, and status reporting contains: 5GS timing synchronization
disabled status, the timing source clock class, time validity.
\- Inform the status to UE:
\- When UPF detects networking timing synchronization status for original 5G
GM timing source, the UPF/NW-TT may update (g)PTP attributes as configured by
the TSCTSF via UMIC and sends the updated (g)PTP messages to the UE(s).
### 6.3.3 Procedures
Existing PDU Session establishment procedures are reused in timing
synchronization capability configuration. Enhanced the procedure for exposure
of capability of time sync service defined in clause 4.15.9.2 of TS 23.502 [3]
to support exposure of timing synchronization capability. Existing timing
distribution procedures are reused for UEs using (g)PTP messages.
Figure 6.3.3-1: Timing synchronization resiliency and status reporting
0\. PDU session establishment procedure with UPF timing resiliency capability,
UPF exchanges timing resiliency capability to TSCTSF via UMIC/PMIC.
1\. AF requests for time synchronization service status, with time
synchronization error budget for specific UE(s).
2\. TSCTSF confirms that the 5GS can meet the requirement based on UPF
reported timing synchronization capability, and determinates UPF to provide
time sync service.
3\. TSCTSF creates a timing synchronization configuration on UPF via
PMIC/UMIC.
Editor\'s note: It is FFS the information in timing synchronization
configuration.
4\. The UPF detects and reports the networking timing synchronization status
degradation or recovery, and (de)activates the timing synchronization
configuration for PTP GM functionality accordingly.
5\. When UPF detects degradation or recovery for original 5G GM timing source,
the UPF sends the status reporting contains 5GS timing synchronization enabled
or disable status, the timing source clock class, time validity to AF, via
TSCTSF.
6\. The TSCTSF may reconfigure (g)PTP operation at the UPF/NW-TT via
PMIC/UMIC.
7\. UEs are consuming (g)PTP timing synchronization service from UPF or RAN
that acts as grand-master based on IEEE Std 802.1AS [7] or IEEE Std 1588 [8].
UPF/NW-TT sends updated PTP messages to the UE(s).
### 6.3.4 Impacts on services, entities and interfaces
UPF:
\- Support of signalling the timing synchronization capability to TSCTSF and
AF.
\- Support of reporting time synchronization status (e.g. holdover time or UTC
divergence status) to TSCTSF.
TSCTSF:
\- Support of receiving timing synchronization requirement from AFs.
\- Support of timing synchronization with timing resiliency capability
configuration.
\- Support of timing synchronization status report to AFs.
AF:
\- Support of providing timing synchronization requirement (time
synchronization error budget) to TSCTSF, and receiving status reporting from
TSCTSF.
\- Support of subscribing timing synchronization capability.
## 6.4 Solution #4: 5GC learning and reporting network timing synchronization
status
### 6.4.1 Introduction
This solution is proposed to solve Key Issue #1: 5GS network timing
synchronization status and reporting.
In this key issue, the 5GS has a synchronization plane that synchronizes the
5G network functions (e.g. UPFs and RAN nodes) to a common time reference. The
synchronization plane may have different sources of time/frequency like GNSS
signal, Synchronous Ethernet (SyncE), PTP transport network, PPS input, etc.
Thus, the following assumptions are considered for the synchronization plane:
\- NG-RAN is time synchronized with an external clock using transport network
synchronization protocols or using a local GNSS receiver.
\- NG-RAN is frequency synchronized (i.e. synchronization) with an external
clock using transport network syntonization methods or using a local GNSS
receiver.
NOTE 1: The syntonization aspect is included in the assumptions because it may
have an important role when the primary time reference source is lost but
still the base station has a frequency reference (e.g. SyncE), then the
holdover period can be longer. This is taking for example the long
interruption failure scenarios considered in ITU-T Recommendation G.8271.1
[15], Appendix V.
\- NG-RAN can detect network timing synchronization degradation/improvement or
timing synchronization failures locally, e.g. based on information provided by
the transport network time or frequency synchronization methods or based on
information provided by the local GNSS receiver. The details of how NG-RAN
detects timing synchronization degradation/improvement or timing
synchronization failures are beyond the scope of 3GPP.
\- UPF/NW-TT is time synchronized with an external clock using transport
network-based time synchronization protocols if UPF/NW-TT is involved in
providing time information to UEs/DS-TTs.
\- UPF can detect network timing synchronization degradation/improvement or
timing synchronization failures locally, e.g. based on information provided by
the transport network time synchronization protocols. The details of how the
UPF detects timing synchronization degradation/improvement or timing
synchronization failures are beyond the scope of 3GPP.
This solution addresses the following scenarios:
\- 5GS distributes time information to UEs using access stratum signalling.
\- 5GS distributes time information to UEs using PTP or gPTP messages and the
5GS (i.e. UPF/NW-TT) is acting as the grand-master.
NOTE 2: How the performance of the 5G clock distribution across the 5GS impact
the external (g)PTP clock scenario is out of scope.
From UE/DS-TT perspective, the 5GS time information received can be the
primary time source the UE/DS-TT is consuming or can be a back-up time source
alternative to a time source already present at the UE/DS-TT side. For both
cases, this solution proposes enablers to allow the 5GC to retrieve 5GS
network timing synchronization status from NG-RAN nodes and UPF/NW-TT (if
needed) and report this information to subscribed UEs and AFs.
### 6.4.2 Functional Description
#### 6.4.2.1 Functional Description for 5GC learning network timing
synchronization status
The following principles are proposed to enable the 5GC to learn the network
timing synchronization status at the NG-RAN and UPF/NW-TT:
\- The TSCTSF can retrieve and store timing synchronization status from NG-RAN
and UPF/NW-TT.
\- The NG-RAN timing synchronization status and the UPF/NW-TT timing
synchronization status provide information for different time synchronization
processes the UE/DS-TT(s) may have configured. The TSCTSF checks the time
synchronization distribution method the target UE(s) have configured and
determines the network functions to subscribe:
\- The NG-RAN timing synchronization status informs the synchronization
performance of the time distribution process the gNB and UE execute at Uu
interface using access stratum signalling.
\- On top of the access stratum time distribution method, if the UE/DS-TT
receives 5G clock via (g)PTP with the UPF/NW-TT acting as a PTP grandmaster,
the (g)PTP Announce messages already include GM quality attributes to
determine UPF/NW-TT timing synchronization status at the UE/DS-TT.
NOTE 3: If the UE/DS-TT is acting as a PTP grandmaster, it might not be
required for the UE to receive gPTP or PTP messages over user plane (i.e. the
UE and DS-TT use the 5G timing information and generate the necessary gPTP or
PTP message for the end station as described in clause 5.27.1.1 of TS 23.501
[2]). In this case, there is no need for the UPF reporting time synch status
to TSCTSF.
\- For TSCTSF subscription to NG-RAN timing synchronization status, three
reporting alternatives via AMF are possible as follows:
\- Alternative 1 for NG-RAN Time Sync Status reporting: The TSCTSF is
responsible for determining the impacted UE(s) based on their location and the
NG-RAN timing synchronization status reports received from AMF.
\- Alternative 2 for NG-RAN Time Sync Status reporting: The AMF is responsible
for determining the impacted UE(s) based on their location and the NG-RAN
timing synchronization status reports received. Per impacted UE, the AMF
forwards the notification to the TSCTSF subscribed to it.
\- Alternative 3 for NG-RAN Time Sync Status reporting: The NG-RAN is
responsible for determining the impacted UE(s) and sending the NG-RAN timing
synchronization status reports to the AMF. Per impacted UE, the AMF forwards
the notification to the TSCTSF subscribed to it.
\- For TSCTSF subscription to UPF/NW-TT timing synchronization status, three
reporting alternatives are possible as follows:
\- Alternative 1 for UPF/NW-TT Time Sync Status reporting: Using UPF event
exposure service operation. The TSCTSF can be a new consumer of the service
and node level signalling is used between UPF and TSCTSF.
\- Alternative 2 for UPF/NW-TT Time Sync Status reporting: Using N4 Node Level
procedures between the UPF and the SMF to report the update from the UPF. The
TSCTSF subscribes to this information at the SMF on a per UE level or node
level (between UPF and SMF or between SMF and TSCTSF). If UE level signalling
is preferred, the SMF is responsible for determining the impacted UE(s) and
notify the TSCTSF per UE level basis using PDU Session information available.
\- Alternative 3 for UPF/NW-TT Time Sync Status reporting: Using UMIC to
forward the status update from the UPF to the TSCTSF. Node level signalling is
used between UPF and TSCTSF.
\- The TSCTSF can determine time source degradation/failure/recovery events
using the event flags and/or comparing numeric attributes included within the
network timing synchronization status update received from NG-RAN and UPF/NW-
TT.
\- The TSCTSF can use the primary source quality attributes included within
the NG-RAN and UPF/NW-TT timing synchronization status update to recalculate
Uu time synchronization error budget for the time synchronization service
offered to UE(s) to assist time synchronization enforcement (i.e. to notify
the AF if the time synchronization error budget provided cannot be fulfilled,
or to provide an updated Uu time synchronization error budget to the serving
NG-RAN node).
#### 6.4.2.2 Functional Description for network timing synchronization status
information
Editor\'s note: What type of information is needed and how it is used is FFS.
#### 6.4.2.3 Functional Description for AF requested network timing
synchronization status
The following capabilities are proposed for AF requesting network timing
synchronization status:
\- The AF requests network timing synchronization status monitoring from the
NEF or TSCTSF (if it is a trusted AF). Existing Time synchronization APIs
(i.e. Ntsctsf_TimeSynchronization_Config and Ntsctsf_ASTI) are extended with
Subscribe/Unsubscribe/Notify operations to enable the AF to perform this
request for monitoring. The request may contain:
\- Targets of the monitoring and filtering information (e.g. UE IDs, spatial
validity, DNN/S-NSSAI, or time synchronization service identifier (i.e. PTP
instance reference for the (g)PTP service scenario or time synchronization
configuration ID for the ASTI service scenario)).
\- The subscription events or information elements it wants to be notified.
\- Request for UE side reporting (i.e. the UE(s) that are targets of the
monitoring receive also the network timing synchronization status report) and
reporting criterion (e.g. as soon as new information is available, when the UE
is reachable).
\- AF Identification.
\- To determine the targets of the monitoring, AF request for network timing
synchronization status provides the filter information. Four criteria to
determine the targets of the network timing synchronization status exposure
framework can be considered as summarized in Table 6.4.2.3 based on UE
identities, known location, or connectivity.
Table 6.4.2.3: Criteria alternatives for network timing synchronization status
exposure
+-------------+-------------+-------------+-------------+-------------+ | Criteria | Spatial | All UEs | All UEs | A UE or | | | validity | within the | connected | group of | | | | spatial | to the | UEs | | | | validity | DNN/S-NSSAI | | +=============+=============+=============+=============+=============+ | Target of | an optional | any UE | any UE | one or more | | Monitoring | SUPI or any | | | SUPI(s) or | | Reporting | UE | | | Internal | | | | | | Group | | | | | | Id | | | | | | entifier(s) | +-------------+-------------+-------------+-------------+-------------+ | Monitoring | spatial | Spatial | DNN; | | | Filter | validity; | validity | | | | information | | | S-NSSAI; | | +-------------+-------------+-------------+-------------+-------------+
\- If AF\'s request includes geographical area filter(s), the AF can provide
them in spatial validity format (e.g. a civic address or shapes), or area(s)
of interest. If the AF provides spatial validity, the NEF maps the spatial
validity to validity area(s) (based on pre-configuration). Later, the TSCTSF
or PCF determines the area(s) of interest based on validity area(s). The
TSCTSF or AMF subscriptions use area of interest that may be the same as
spatial validity condition or may be a subset of the spatial validity
condition (e.g. a list of TAs or list of Cells) based on the latest known UE
location.
\- AMF or TSCTSF uses Location reports or UE presence in Area of Interest
services at the AMF to identify the UE(s) to which the AF request with
geographical area filter(s) applies, following the description of clause
6.4.2.1.
\- If AF\'s request includes DNN/S-NSSAI filters, service events related to
PDU Sessions (e.g. establishment or release) can be used at the SMF or TSCTSF
to identify the UE(s) to which the request applies.
\- Based on the network timing synchronization status reports the TSCTSF
receives from NG-RAN and UPF/NW-TT (if applicable) nodes, the TSCTSF re-
evaluates if the time synchronization service configured for the UE(s)
impacted for which the AF has requested time synchronization service can be
fulfilled:
\- If TSCTSF determines that the service requirements (time synchronization
error budget) cannot be met:
\- For ASTI based time synchronization service, the TSCTSF updates access
stratum time distribution indication to \"disable\" and forwards the attribute
to the serving NG-RAN nodes for the impacted UEs via AMF (following Release-17
operation as described in clause 4.15.9.4 of TS 23.502 [3]).
\- For (g)PTP based time synchronization service, the TSCTSF temporarily
removes the UE/DS-TT from the PTP instance and reconfigures the UPF/NW-TT
accordingly (following Release-17 operation described in clause K.2.2 of TS
23.501 [2]). The TSCTSF may update the clockQuality information (via PMIC if
DS-TT or via UMIC if NW-TT is configured to send Announce messages) for the
PTP instance (see IEEE 1588 [8] clause 7.6.2).
NOTE 4: ClockQuality information included in Announce message needs to be the
same for all PTP ports of the same PTP instance. Therefore, TSCTSF needs to
configure the same clockQuality information for all UEs that are part of the
same instance PTP instance even if only some UEs are impacted. For example, if
one UE that is part of a PTP instance is served by a RAN node that lost
synchronization to a primary reference time source (e.g. GNSS) and enters
holdover mode, then the clockClass attribute needs to be changed for all UEs
that are part of that PTP instance. Instead of changing the clockClass of all
related UEs, an alternative way is to mark the impacted UE PTP port disabled
and other UEs of the PTP instance unchanged. This is up to implementation.
NOTE 5: When DS-TT is configured to generate Announce messages for one or more
PTP ports, the TSN AF or TSCTSF shall use the elements in defaultDS in PMIC
for the respective DS-TT(s) and in UMIC for NW-TT to ensure that all PTP ports
in the DS-TT(s) and NW-TT in particular PTP instance are distributing the same
values of grandmasterPriority1, grandmasterClockQuality, grandmasterPriority2,
grandmasterIdentity, and timeSource message fields in Announce messages as
described in clause K.2.2.4 of TS 23.501 [2]).
\- If TSCTSF determines that the service requirements can be met:
\- For ASTI based time synchronization service, the TSCTSF updates access
stratum time distribution indication to \"enable\" and forwards the attribute
to the serving NG-RAN nodes for the impacted UEs via AMF (following Release-17
operation as described in clause 4.15.9.4 of TS 23.502 [3]).
\- For (g)PTP based time synchronization service, the TSCTSF adds the UE/DS-TT
to the PTP instance again (or changes the status of the impacted UE PTP port)
and reconfigures the UPF/NW-TT accordingly (following Release-17 operation
described in clause K.2.2 of TS 23.501 [2]).
#### 6.4.2.4 Functional Description for network timing synchronization status
reporting to UE(s)
The following capabilities are proposed for UE(s) receiving network timing
synchronization status:
\- Based on TSCTSF policies or the received AF\'s network timing
synchronization status request as described in clause 6.4.2.3 and the time
synchronization service the UE has configured, the TSCTSF is responsible for
subscribing to network timing synchronization status as described in clause
6.4.2.1 (i.e. to the serving NG-RAN via AMF and if needed to the UPF/NW-TT via
SMF or UPF directly).
\- The trigger conditions of UE side reporting include,
\- AF\'s request for UE side reporting
Editor\'s note: Need for UE side reporting depends e.g. on how timing status
information is reported to the UE and is FFS.
\- TSCTSF policies (e.g. whether there exists AF\'s request or not, TSCTSF
reports status to UEs who have network timing synchronization services)
\- UE\'s authorization (e.g. newly defining UE\'s subscription data stored in
the UDM, which indicates whether the UE is authorized to receive the network
timing synchronization status reports)
NOTE: Whether and how to define UE\'s subscription data for the case that an
UE authorize the network timing synchronization status reporting depends on
the progress of the related key issue (i.e. KI#3).
\- When access stratum time distribution method is configured for the UE, the
TSCTSF could configure the NG-RAN node (via AMF) to generate and send the NG-
RAN timing synchronization status report to the UE(s) via SIB9/RRC signalling.
The report shall be made available to DS-TT by the UE.
\- When (g)PTP time distribution method is configured for the UE/DS-TT, the
PTP attributes received via PTP announce messages are enough to describe the
status of the UPF/NW-TT timing synchronization status.
\- If the DS-TT is the last recipient of the network timing synchronization
status reports (if only access stratum time distribution method is
configured), it is up to the DS-TT implementation the determination of how the
time source status update impacts the total degradation of the timing service
the DS-TT is running.
### 6.4.3 Procedures
#### 6.4.3.1 Procedure for AF requested network timing synchronization status
An overall procedure for AF requested network timing synchronization status is
illustrated in Figure 6.4.3.1-1. Note this procedure is focusing on NG-RAN
network timing synchronization status reporting and uses ASTI based time
synchronization service as an example how the report can be exposed to the AF.
For (g)PTP based time synchronization service, the exposure API should be
Nxxx_TimeSynchronization_ConfigSubscribe/Notify in steps 1, 2, 9, 10, 16, and
17.
Figure 6.4.3.1-1: Procedure for AF requested network timing synchronization
status
1-2. The AF sends network timing synchronization status request to the NEF or
TSCTSF. The request may include targets of the monitoring and filtering
information (as described in Table 6.4.2.3), the subscription events or
information elements it wants to be notified, request for UE side reporting
and reporting criterion, AF Identification.
If the request is received at the NEF, it checks whether the AF is authorized
to send the request and forwards the request to the TSCTSF.
If spatial validity is included in AF\'s request, NEF maps the spatial
validity to list of TA(s) or Cell(s).
3\. Based on the filters the request contains, the TSCTSF determines the
target(s) UE(s) for the request.
4\. The TSCTSF determines the AMF(s) and the UPF/NW-TT nodes (if applicable)
that needs to initiate network timing synchronization status subscription
considering the time synchronization service the target UE(s) have configured
in the 5GS.
To determine the serving AMF(s), the TSCTSF can use different methods such as:
\- Method 1: NRF services (Nnrf_NFDiscovery, illustrated in Figure 6.4.3.1-1)
or UDM UE Context Management services (Nudm_UECM_Get) to discover the AMF of
the target TAI(s) or UE(s). This method enables the TSCTSF to directly
interact with the AMF to retrieve NG-RAN Time Sync Status reports at UE or NG-
RAN node level.
\- Method 2: AM policy procedures via PCF. The TSCTSF can discover the PCF for
the UE using the BSF and interact with the AMF via PCF AM Policy services.
This method only enables the TSCTSF to retrieve NG-RAN Time Sync Status
reports at UE level.
To determine the serving UPF/NW-TT(s) the TSCTSF can use the PTP instance
information already configured for the (g)PTP service provided to the UE(s).
That is, the TSCTSF can reuse the time synchronization capability exchange via
UMIC with the UPF/NW-TT (e.g. attribute List of UEs associated with the User-
Plane Node ID in Table 5.2.6.25.8-1 of TS 23.502 [3]).
5-7. The TSCTSF request NG-RAN timing synchronization status (TSS)
subscription to the AMF. First the TSCTSF may send the configuration of the
TSS reporting to the NG_RAN via AMF using Namf_NonUeN2MsgTransfer. The AMF
interacts with the NG-RAN to configure the reporting. Finally, the TSCTSF
initiates the subscription to TSS reporting at the AMF. Three alternatives are
possible (as described in clause 6.4.2.1):
\- Alternative 1 for NG-RAN Time Sync Status reporting (option illustrated in
Figure 6.4.3.1-1): TSCTSF subscribes for receiving NG-RAN timing
synchronization status at the AMF on a per RAN node level. The AMF forwards
the received status report from the NG-RAN node to the TSCTSF. The TSCTSF is
responsible for determining the impacted UE(s) based on their location.
\- Alternative 2 for NG-RAN Time Sync Status reporting: TSCTSF subscribes for
receiving NG-RAN timing synchronization status at the AMF on a per UE level.
The AMF is responsible for determining the impacted UE(s) based on the NG-RAN
node level report received and UE(s) location. Per impacted UE, the AMF
forwards the NG-RAN time synchronization status report to the TSCTSF
subscribed to it.
\- Alternative 3 for NG-RAN Time Sync Status reporting: TSCTSF subscribes for
receiving NG-RAN timing synchronization status at the AMF on a per UE level.
The NG-RAN is responsible for determining the impacted UE(s) and sending the
NG-RAN timing synchronization status reports to the AMF. Per impacted UE, the
AMF forwards the notification to the TSCTSF subscribed to it.
If (g)PTP time distribution is configured for a UE, the TSCTSF request UPF/NW-
TT timing synchronization status subscription to the SMF (at UE level or node
level) or directly at the UPF/NW-TT (node level), as described in clause
6.4.2.1.
8\. If AF\'s request contains a spatial validity filter and the TSCTSF
subscribes to node level information at the AMF in step 4, the TSCTSF is
responsible for determining if a serving NG-RAN timing synchronization status
update received at node level signalling impacts the UE(s) matching AF\'s
request condition. To support this, the TSCTSF subscribes to location services
at the AMF (e.g. Namf_EventExposure service for events like Location Report
(TAI, Cell ID) or UE moving in or out of a subscribed \"Area Of Interest\").
If AF\'s request contains a spatial validity filter and (g)PTP time
distribution is configured for a UE, the TSCTSF is responsible of determining
the UE(s) matching AF\'s request condition based in their location and the
serving UPF/NW-TT for the PTP instance.
9-10. The TSCTSF responds the AF.
11\. The AMF subscribes to UE(s) location services reporting from NG-RAN node
using Location reporting Request procedure.
12\. The NG-RAN node detects a primary source event (e.g. degradation,
failure, recovery).
13\. The NG-RAN node notifies the AMF providing a NG-RAN timing
synchronization status report. The report message may include, for example,
the gNB node information, time status information, relevant UE information.
The gNB node information indicates which 5G access stratum time distribution
is impacted. The time status information might include the clock status in gNB
node, and it can refer to the time service indication (disabled, enabled and
holdover status). The relevant UE info represents those UE using the involved
gNB access stratum time.
Editor\'s note: The actual details of the parameters to be provided by NG-RAN
and to AF are FFS.
14\. The AMF forwards the NG-RAN timing synchronization status report to the
TSCTSF. If TSCTSF subscription is at NG-RAN node level (alternative 1 for NG-
RAN Time Sync Status reporting, illustrated in Figure 6.4.3.1-1), the AMF can
directly forward the report received from NG-RAN node. If TSCTSF subscription
is at UE level (alternative 2 and 3 for NG-RAN Time Sync Status reporting),
the AMF or RAN determines the UE(s) impacted by the status update received
from NG-RAN before notifying the TSCTSF (e.g. based on UE locations or UE
identities).
15\. The TSCTSF revaluates if the time synchronization service configured for
the UE(s) impacted can still be fulfilled ( time synchronization error budget
provided by AF). If the service requirements cannot be met, then the TSCTSF
may temporarily deactivate time synchronization service for the impacted
UE(s).
For ASTI based time synchronization service, this implies the TSCTSF updates
access stratum time distribution indication to \"disable\" and forwards the
attribute to the serving NG-RAN nodes for the impacted UEs via AMF (following
Release-17 operation as described in clause 4.15.9.4 of TS 23.502 [3]).
For (g)PTP based time synchronization service (not illustrated in Figure
6.4.3.1-1), this implies the TSCTSF temporarily removes the UE/DS-TT from the
PTP instance or marks the impacted DS-TT ports disabled and reconfigures the
UPF/NW-TT accordingly (following Release-17 operation described in clause
K.2.2 of TS 23.501 [2]).
16-17. The TSCTSF stores the network timing synchronization status update
received and notifies the subscribed AF via exposure framework. If the
notification from gNB provides the time status information (e.g. disabled,
enabled and holdover status, actual status information values is FFS), TSCTSF
stores the time status information locally. If the notification from the gNB
has triggered the (de)activation of time synchronization service for the
impacted UE(s), the TSCTSF notifies the AF.
Figure 6.4.3.1-1 illustrates the NG-RAN timing synchronization status
subscription example, if the TSCTSF requires UPF/NW-TT timing synchronization
status (determined in step 3), a similar signalling exchange between UPF/NW-
TT, SMF, and TSCTSF is required to subscribe to UPF/NW-TT updates (directly or
via the SMF), as described in clause 6.4.2.1.
#### 6.4.3.2 Procedure for UE provisioning network timing synchronization
status
An overall procedure for UE provisioned network timing synchronization status
is illustrated in Figure 6.4.3.2-1.
Figure 6.4.3.2-1: Procedure for UE provisioning network timing synchronization
status
1\. The AF sends network timing synchronization status request to the NEF or
TSCTSF. The subscription configuration of NG-RAN nodes and UPF/NW-TT (if
applicable) is performed as described in clause 6.4.3.1.
2\. The NG-RAN node detects a primary source event (e.g. degradation, failure,
recovery).
3\. The NG-RAN node notifies the AMF providing a NG-RAN timing synchronization
status report. The TSCTSF may have already configured the NG-RAN node to
provide updates to the UE directly via SIB9/RRC signalling, in that case,
steps 5 7 can be skipped.
4\. The AMF forwards the NG-RAN timing synchronization status report to the
TSCTSF. If TSCTSF subscription is at NG-RAN node level (alternative 1 for NG-
RAN Time Sync Status reporting, illustrated in Figure 6.4.3.2-1), the AMF can
directly forward the report received from NG-RAN node. If TSCTSF subscription
is at UE level (alternative 2 and 3 for NG-RAN Time Sync Status reporting),
the AMF or RAN determines the UE(s) impacted by the status update received
from NG-RAN before notifying the TSCTSF (e.g. based on UE locations or UE
identities).
5\. The TSCTSF determines the UE(s) to notify and the method to use to forward
the network timing synchronization status notification.
Similar to step 15 in clause 6.4.3.1, when the TSCTSF receives a status
notification revaluates if the time synchronization service configured for the
UE(s) impacted can still be fulfilled (time synchronization error budget). If
the service requirements cannot be met, then the TSCTSF may temporarily
deactivate time synchronization service for the impacted UE(s) following
Release-17 operation.
6\. The TSCTSF can initiate a network triggered procedure to forward the
notification to the UE via AMF. When the AMF receives the notification, it
will forward it to the NG-RAN node. Two alternatives are possible: send the
report to the UE using RRC signalling or NAS signalling.
7a. If RRC signalling is preferred, the AMF sends a N2 message to forward the
UE\'s report from AMF to the NG-RAN node. The serving NG-RAN node forwards the
network timing synchronization status to the UE using RRC signalling.
7b. If NAS signalling is preferred, the AMF initiates DL NAS Transport
procedure to forward the UE\'s report transparently via the NG-RAN node to the
UE using NAS signalling.
### 6.4.4 Impacts on services, entities and interfaces
UE:
\- Support receiving RAN timing synchronization status information.
\- Support performing a registration request when RAN network timing
synchronization status information changes while the UE is in CM-IDLE, if
requested by TSCTSF or AMF.
DS-TT:
\- Support receiving network timing synchronization status information.
NG-RAN:
\- Indicate NG-RAN network timing synchronization status to UEs via SIB9 or
RRC signalling.
\- Report NG-RAN network timing synchronization status to AMF.
AMF:
\- Subscribe for network timing synchronization status reports from NG-RAN
nodes.
\- Report NG-RAN timing synchronization status to the TSCTSF (at UE level or
NG-RAN node level).
SMF:
\- If SMF is involved in UPF/NW-TT timing sync status reporting, subscribe for
network timing synchronization status reports from UPF/NW-TT nodes.
\- Report UPF/NW-TT timing synchronization status to the TSCTSF (at UE level
or UPF node level).
TSCTSF:
\- Receive network timing synchronization status information from NG-RAN (via
AMF) and UPF/NW-TT (via SMF or directly).
\- Discover serving AMF for a UE.
\- Subscribe for receiving UE\'s location, UE\'s presence in Area of Interest,
and reachability information from AMF.
\- Subscribe for receiving UE\'s PDU Session events from SMF.
\- Support for requesting UEs to perform a Registration request if the UE
detects a change in RAN network timing synchronization status information and
the UE is in CM-IDLE.
\- Inform AFs about network timing synchronization status and time
synchronization service status for the impacted UE(s).
\- Initiate network-triggered procedures to reach the UE if is in CM-IDLE.
\- Inform UE about RAN timing synchronization status using NAS signalling, or
configuration of NG-RAN node to notify the UE via RRC/SIB.
UPF:
\- Report transport network timing synchronization status to TSCTSF (directly
or via SMF).
AF:
\- Request for network timing synchronization status.
\- Support receiving network timing synchronization status information.
## 6.5 Solution #5: Inform UE and AF about 5GS network timing synchronization
status for PTP
### 6.5.1 Introduction
The solution is proposed to solve Key Issue #1: 5GS network timing
synchronization status and reporting.
This solution addresses the following scenarios:
\- 5GS is acting as Bridge to distribute time information to UEs using PTP or
gPTP, as defined in clause 5.27.1.7 of TS 23.501 [2].
This solution makes the following assumptions:
\- The UE/DS-TT, NG-RAN, UPF/NW-TT are synchronized with the 5G GM (i.e. the
5G internal system clock) as specified in TS 23.501 [2] and TS 38.331 [5].
\- The UE/DS-TT and UPF/NW-TT handle the (g)PTP message as TS 23.501 [2].
### 6.5.2 Functional Description
This solution only get time synchronization status from UPF/NW-TT. To enable
NG-RAN time synchronization status case, this solution can be used in
combination with other KI#1 solutions (like solution #1 or solution #4).
The solution is based on the following principles:
\- The AF/NEF subscribes the time synchronization status with TSCTSF.
\- TSCTSF subscribes for receiving time synchronization status from UPF/NW-TT
via PMIC/UMIC (i.e. the status of the synchronization of the UPF/NW-TT with
the 5G GM and PTP GM):
\- According to the status subscription, the UPF/NW-TT reports 5G GM and PTP
GM (e.g. clock class and traceability) to TSCTSF/TSN AF via PMIC/UMIC.
\- When TSCTSF receives the time synchronization status, it determines the
impacted PTP ports and related UE (i.e. AF sessions):
\- The TSCTSF notifies the AF with the time synchronization status.
### 6.5.3 Procedures
The exchange of PMIC/UMIC between TSCTSF and UE/DS-TT and between TSCTSF and
UPF/NW-TT is specified in clause 5.28.3 of TS 23.501 [2].
### 6.5.4 Impacts on services, entities and interfaces
TSCTSF:
\- Receive time synchronization status from UPF/NW-TT.
\- Inform AFs about time synchronization status.
UPF/NW-TT:
\- Report 5G GM or PTP GM time sync status (e.g. clock class and UTC
traceability) to TSCTSF via PMIC/UMIC.
## 6.6 Solution #6: **Support for 5G Timing Exposure Enhancement.**
### 6.6.1 Introduction
The solution enables AF to request time synchronization service in a specific
coverage area. 5GS enforces the time synchronization service according to the
requested coverage area.
### 6.6.2 General description
\- The AF requested time synchronization service is for one UE or a group of
UE.
\- UEs get time synchronization service by receiving 5GS access stratum time
or time-synchronized UPF/NW-TT.
The general idea of the solution is structured as follows:
\- AF requests time synchronization service for targeted UE(s), and the
coverage area info is included in the request.
\- NEF authorizes the AF request and sends it to TSCSTF.
\- TSCTSF determines the time source for the requested AF.
\- AMF reports UE location information to PCF when the PCF initiates the AM
policy association modification.
\- If UE moves out of the coverage area, the requirements of time
synchronization service in the AF request will not be met any more. When
TSCTSF receives the notification from AMF about UE leave, TSCTSF will
deactivate the time synchronization service and the RAN node will stop to
provide 5G access stratum information to the UE.
\- The coverage area information in the AF request can be per cell, per RAN
nodes or a geographical area. If the requested coverage area information is
presented in per cell or per RAN nodes, TSCTSF will update the access stratum
time indication combined with coverage area information. If the requested area
is a geographical area, it is assumed that the requested information can be
interpreted by NEF to a 3GPP defined location information. It may be a pre-
configured area mapping or depending on specific implement.
### 6.6.3 Procedures
Flow chart for the AF requested time synchronization service in a specific
area is illustrated as following.
Figure 6.6.3-1: AF requesting time synchronization service in a specific area
1\. AM policy association establishment is finalized during UE registration
procedure.
2\. The procedure is triggered by the AF request to influence the 5G time
distribution. The coverage area information is added in step 2 when the AF
requests the service in a specific area.
3\. The NEF authorizes the request and invokes the operation with the
corresponding TSCTSF. TSCTSF calculates the Uu time synchronization error
budget if the AF provides the error budget requirements. The coverage area
information is considered together with the 5G access stratum time
distribution indication by the TSCSTF. If 5G access stratum time distribution
is enabled in the coverage area, it can meet the request. If another gNB not
in the coverage area or time-synchronized UPF/NW-TT can meet the request
requirements, it provides reference time to the targeted UE in the area to
enforce AF request if possible.
4\. If the 5G access stratum time distribution parameters in UDR are
associated with a DNN/S-NSSAI for the PCF for the UE may discover the PCF for
the PDU Session using SUPI and (DNN, S-NSSAI) as parameters.
5\. TSCTSF selects for the PCF that handles the AM Policy Association of the
targeted UE with SUPI (step 4) as an input parameter and informs the PCF to
consider UE location information when determining AM policy.
6\. If the TSCTSF sends multiple time synchronization error budgets for a
given UE, the PCF would pick the most stringent budget. The PCF takes a policy
decision and then it may initiate an AM Policy Association Modification
procedure. In the step, the AMF is responsible for reporting UE location
information to PCF. When PCF receives UE location information, it determines
to provide which 5GS access stratum time information to UE based on time
synchronization date sent by TSCTSF. As part of this, the 5G access stratum
time distribution indication and the Uu time synchronization error budget are
provided to NG-RAN. Based on this, NG-RAN provides the 5GS access stratum time
to the UE according to the Uu time synchronization error budget as provided by
the TSCTSF (if supported by UE and NG-RAN).
7\. The PCF of the UE replies to the TSCTSF with the result of
Npcf_AMPolicyAuthenorization operation.
8\. The TSCTSF responds to the NEF request in step 3.
9\. The NEF informs the AF about the result of the operation in step 2.
### 6.6.4 Impacts on services, entities and interfaces
AF:
\- Support to include the coverage area information in the time
synchronization service request.
TSCTSF:
\- Support to include the coverage area information in the time
synchronization service request.
\- Update the 5G access stratum time distribution indication based on coverage
area information.
\- Inform the PCF to consider UE location information.
PCF:
\- Combine UE location information when AM policy decision.
## 6.7 Solution #7: RequestedCoverage area filters for time synchronization
service
### 6.7.1 Introduction
This solution is proposed to solve Key Issue #2: Time synchronization service
enhancements. In this Key Issue, the coverage area is taken into account for
the configuration of the time synchronization service. Therefore, this
solution addresses the time synchronization service scenarios already
supported in 5G Release-17 based on access stratum or (g)PTP time distribution
methods.
This solution proposes to use a list of Tracking Areas (TAs) identified by
Tracking Area Identities (TAI) or a list of Cells to describe a specific
geographical area (a so-called Requested Coverage Area) where an AF requests
to enable a time synchronization (TS) service. Furthermore, in order to
enforce that the requested TS service is enabled for UEs (a specific UE or a
group of UEs) only in that Requested Coverage Area, the proposed solution
exploits the 5GS functionality (provided by the AMF) of tracking and reporting
\"UE mobility on Area of Interest\" events (clause 5.3.4.4 of TS 23.501 [2]).
An Area of Interest (AoI) for each AMF is represented by a list of TA(s) or by
a list of Cells, wherein the Area of Interest is identical to the Requested
Coverage Area or the Area of Interest is a TA or cell subset of the Requested
Coverage Area.
### 6.7.2 Functional Description
The existing time synchronization exposure procedures (clause 4.15.9 of TS
23.502 [3]) are enhanced.
The following principles are proposed to enable the use of coverage area for
time synchronization service operation:
\- An AF may optionally include a Requested Coverage Area within the timing
synchronization service request using a spatial validity condition.
\- As a spatial validity condition, the AF may use a geographical area (e.g. a
civic address or shapes) or a TA/Cell list (if it is an AF within the
operator\'s domain, it will have TA(s) or Cell(s) configured):
\- If the AF uses a geographical area as a spatial validity condition, the NEF
transforms this information into 3GPP identifiers (e.g. TAI(s) or Cell(s))
based on pre-configuration. Later, the TSCTSF discovers the AMF(s) serving the
TAs/Cells comprising Area(s) of Interest. The TSCTSF or AMF subscriptions use
Area of Interest that may be the same as the Requested Coverage Area or may be
a subset of TAs/Cells from the list of TAs/Cells describing the Requested
Coverage Area.
\- If the AF is within the operator\'s domain, it uses a list of TAs or a list
of Cells directly (based on pre-configuration) to formulate the spatial
validity condition for the Requested Coverage Area.
\- TSCTSF uses Location or UE presence in Area of Interest services at the AMF
Event Exposure service (Namf_EventExposure operations) to identify the UE(s)
to which the AF request with a Requested Coverage Area applies. The TSCTSF
subscribes to this information at the AMF(s), stores it, and determines the
UE(s) presence in the Requested Coverage Area using the notification(s) from
one or multiple AMFs.
\- Requested Coverage Area will be used at the TSCTSF for triggering time
synchronization service activation/modification/deactivation with the
following differences:
1) the TSCTSF discovers the AMF(s) serving in the Tracking Areas (TAs)
comprising the Requested Coverage Area;
2) the TSCTSF subscribes (using the Namf_EventExposure_Subscribe service
operation specified in clause 5.2.2.3.2 of TS 23.502 [3]) to the UE mobility
on Area of Interest event notification service from the AMF(s) to be notified
the UE(s) presence in an Area of Interest for each AMF (e.g. UE location is IN
or OUT an Area of Interest);
3) the TSCTSF determines (based on the notification from the AMF(s)) whether
or not the targeted UE(s) are inside the Requested Coverage Area; and
4) the TSCTSF proceeds with the time synchronization service
activation/deactivation only after the TSCTSF has determined which of the
targeted UE(s) are in or out of the Requested Coverage Area. The subscription
to reports of UE presence in the Area of Interest procedure is described in
clause 5.3.4.4 of TS 23.501 [2].
\- For access stratum distribution activation/deactivation, the TSCTSF will
enable/disable ReferenceTimeInformation delivery to the UE at the serving NG-
RAN node reusing the procedure in clause 4.15.9.4 of TS 23.502 [3]. For (g)PTP
distribution activation/deactivation, the TSCTSF will modify the PTP instance
configuration by means of sending a PMIC to the impacted UE/DS-TT and UMIC to
the UPF/NW-TT, as described in clause K.2.2 of TS 23.501 [2].
\- Alternatively, the TSCTSF can trigger a deferred 5GC-MT-LR procedure to
GMLC with the type of event assigned to Area, where the area information is
set to the Requested Coverage Area for time synchronization services provided
by TSN AF. GLMC receives the deferred 5GC-MT-LR procedure and responds with
location event notification indicating the UE entering or moving out of the
coverage area.
### 6.7.3 Procedures
#### 6.7.3.1 Procedure for AF requested (g)PTP timing synchronization with
Requested Coverage Area
An overall procedure for AF providing coverage area for (g)PTP based time
synchronization service is illustrated in Figure 6.7.3.1-1.
Figure 6.7.3.1-1: (g)PTP time distribution configuration with Requested
Coverage Area
1\. The AF creates a time synchronization service configuration for a PTP
instance by invoking Nnef_TimeSynchronization_ConfigCreate service operation.
The request includes the parameters as described in table 4.15.9.3.1 in TS
23.502 [3] and optionally a spatial validity condition (i.e. Requested
Coverage Area) in the format of a geographical area (e.g. a civic address or
shapes) a list of TA(s), or a list of Cells.
2\. The NEF authorizes the request. If the AF uses a geographical area as a
spatial validity condition, the NEF transforms this information into a list of
TA(s) or a list of Cells based on pre-configuration. The list of TA(s) or the
list of Cells describes the Requested Coverage Area.
The AF within the operator\'s domain shall use a list of TA(s) or a list of
Cells directly to formulate a spatial validity condition describing the
Requested Coverage Area.
3\. After successful authorization, the NEF invokes the
Ntsctsf_TimeSynchronization_ConfigCreate service operation with the
corresponding TSCTSF, with the parameters as received from the AF.
The AF that is part of operator\'s trust domain may invoke the services
directly with TSCTSF.
4\. TSCTSF determines whether the TSCTSF has subscribed for the UE presence
for an area that is indicated in the TAs or Cell IDs in the spatial validity
condition. If not, the TSCTSF discovers the AMF(s), serving in the TAs or
serving the Cells that either comprise the spatial validity condition, using
the NRF discovery service (Nnrf_NFDiscovery_Request) with the list of TAs or
the list of Cells, respectively.
5\. The spatial validity condition for the UE(s) is resolved at the TSCTSF. In
order to do that, the TSCTSF subscribes to the AMF(s) to receive notifications
about the UE presence in an area of interest (or UE location) using
Namf_EventExposure operation. The subscribed area of interest may be the same
as the Requested Coverage Area specified by the spatial validity condition or
may be a subset of the Requested Coverage Area (e.g. a list of TAs, or cell
list) based on the latest known UE location.
6-7. The AMF(s) track the UE\'s location to determine the UE\'s presence in an
Area of Interest as described in clause 4.15.4.2 of TS 23.502 [3]. Further,
the AMF(s) notify the TSCTSF about the UE(s) presence (IN, OUT, or UNKNOWN) in
the Area of Interest(s).
8\. The AMF(s) accept TSCTSF\'s subscription and provide the first
corresponding event report (if available).
9\. According to the UE location of each UE that is targeted by the request
and spatial validity condition in step 1, the TSCTSF determines whether to
active time synchronization service for this UE:
\- If the UE location is in an Area of Interest (and thus in the Requested
Coverage Area), the TSCTSF determines to active time synchronization service
and creates a PTP port in a DS-TT and assigns it into the PTP instance.
\- If the UE location is out of Requested Coverage Area, the TSCTSF creates a
PTP port in a DS-TT and assigns it into the PTP instance but temporarily
removes the UE/DS-TT from the PTP instance and indicates the PTP port state as
Inactive for the related DS-TT PTP port.
10\. The TSCTSF responds with the Ntsctsf_TimeSynchronization_ConfigCreate
response.
11\. The NEF responds with the Nnef_TimeSynchronization_ConfigCreate response.
12\. The TSCTSF uses the procedures described in clause K.2.2 of TS 23.501 [2]
to configure and initialize the PTP instance in the DS-TT(s) and NW-TT.
13\. The TSCTSF uses the procedure in clause 4.15.9.4 of TS 23.502 [3] to
manage the 5G access stratum time distribution for the UEs that are part of
the impacted PTP instance.
14\. UE moves in/out of the determined area of interest (i.e. Requested
Coverage Area).
15\. NG-RAN determines the UE presence in the area of interest has changed and
notifies the AMF.
16\. The AMF detects the subscription change related event occurs and it sends
the event report by means of Namf_EventExposure_Notify message to the TSCTSF.
17\. If the TSCTSF receives the UE location change notification for AoI. The
TSCTSF may update to activate or deactivate the time synchronization service
for the given UE.
\- If the UE moves out of the Requested Coverage Area, the TSCTSF temporarily
removes the UE/DS-TT from the PTP instance and indicates the PTP port state as
Inactive for the related DS-TT PTP port.
\- If the UE moves into an Area of Interest, and according to Temporal
Validity Condition (if this parameter is available, and current time is within
validity time period), the TSCTSF determines to activate time synchronization
service; the TSCTSF adds the DS-TT PTP port to the PTP instance again and
indicates the PTP port state as Active for the related DS-TT PTP port.
\- The TSCTSF keeps the requested TS service unchanged (i.e. active/inactive)
when the UE presence in the Requested Coverage Area becomes UNKNOWN until the
TSCSTF determines that the UE is inside/outside the Requested Coverage Area.
18\. The TSCTSF updates the state of the time synchronization configuration
and may notify the NEF (or AF) with the
Ntsctsf_TimeSynchronization_ConfigUpdateNotify service operation. The
notification indicates the identities of the UEs currently within the area of
spatial validity.
19\. The NEF notifies the AF with the
Nnef_TimeSynchronization_ConfigUpdateNotify service operation.
#### 6.7.3.1a Procedure for AF requested (g)PTP timing synchronization with
Requested Coverage Area where UE\'s presence is obtained via TSCTSF triggered
deferred 5GC-MT-LR
An overall procedure for AF providing coverage area for (g)PTP based time
synchronization service is illustrated in Figure 6.7.3.1a-1.
Figure 6.7.3.1a-1: (g)PTP time distribution configuration with Requested
Coverage Area where UE\'s presence is obtained via TSCTSF triggered deferred
5GC-MT-LR
1\. The AF creates a time synchronization service configuration for a PTP
instance by invoking Nnef_TimeSynchronization_ConfigCreate service operation.
The request includes the parameters as described in table 4.15.9.3.1 in TS
23.502 [3] and optionally a spatial validity condition (i.e. Requested
Coverage Area) in the format of a geographical area (e.g. a civic address or
shapes) a list of TA(s), or a list of Cells.
2\. The NEF authorizes the request. If the AF uses a geographical area as a
spatial validity condition.
3\. After successful authorization, the NEF invokes the
Ntsctsf_TimeSynchronization_ConfigCreate service operation with the
corresponding TSCTSF, with the parameters as received from the AF.
The AF that is part of operator\'s trust domain may invoke the services
directly with TSCTSF.
4\. TSCTSF triggers a deferred 5GC-MT-LR procedure to GMLC with the type of
event assigned to Area, where the area information is set to the Requested
Coverage Area for time synchronization services provided by TSN AF.
5\. GLMC performs deferred 5GC-MT-LR procedure as defined from step 2 to 20 in
Figure 6.7.3.1-1 of TS 23.273 [16] v17.5.0 with the type of event assigned to
Area.
6\. The GLMC notifies the TSCTSF about the UE(s) presence (IN, OUT, or
UNKNOWN) in the Area of Interest(s).
7\. TSCTSF determines whether to activate time synchronization service.
According to the UE location of each UE that is targeted by the request and
spatial validity condition in step 1, the TSCTSF determines whether to active
time synchronization service for this UE:
\- If the UE location is in an Area of Interest (and thus in the Requested
Coverage Area), the TSCTSF determines to active time synchronization service
and creates a PTP port in a DS-TT and assigns it into the PTP instance.
\- If the UE location is out of Requested Coverage Area, the TSCTSF creates a
PTP port in a DS-TT and assigns it into the PTP instance but temporarily
removes the UE/DS-TT from the PTP instance and indicates the PTP port state as
Inactive for the related DS-TT PTP port.
8 The following procedure is described from step 10 to 19 in Figure 6.7.3.1-1.
#### 6.7.3.2 Procedure for AF requested 5G access stratum timing
synchronization with **Requested Coverage Area**
An overall procedure for AF requesting a specific coverage area for 5G access
stratum based time synchronization service (see TS 23.502 [3]) is illustrated
in Figure 6.7.3.2-1.
**Figure 6.7.3.2-1: 5G access stratum time distribution configuration with
Requested Coverage Area**
1\. The AF request to influence the 5G access stratum time distribution
providing access stratum time distribution parameters to the NEF (together
with the AF identifier and potentially further inputs as specified in table
4.15.9.4-1 of TS 23.502 [3]) and optionally a spatial validity condition (i.e.
Requested Coverage Area) in the format of a geographical area (e.g. a civic
address or shapes), a list of TA(s), or a list of Cells.
2\. The NEF authorizes the request. If the AF uses a geographical area as a
spatial validity condition, the NEF transforms this information into a list of
TA(s) or a list of Cells based on pre-configuration. The list of TA(s) or the
list of Cells describes the Requested Coverage Area.
The AF within the operator\'s domain shall use a list of TA(s) or a list of
Cells directly to formulate a spatial validity condition describing the
Requested Coverage Area.
3\. After successful authorization, the NEF invokes the Ntsctsf_ASTI_Create
service operation with the corresponding TSCTSF.
4\. TSCTSF determines whether the TSCTSF has subscribed for the UE presence
for an area that is indicated in the TAs or Cell IDs in the spatial validity
condition. If not, the TSCTSF discovers the AMF(s), serving in the TAs or
serving the Cell(s) that either comprise the spatial validity condition, using
the NRF discovery service (Nnrf_NFDiscovery_Request) with the list of TAs or
the list of Cells, respectively.
5\. The spatial validity condition is resolved at the TSCTSF. In order to do
that, the TSCTSF subscribes to the AMF to receive notifications about change
of UE location in an area of interest using Namf_EventExposure operation. The
subscribed area of interest may be the same as the Requested Coverage Area
specified by the spatial validity condition or may be a subset of the
Requested Coverage Area (e.g. a list of TAs, a list of Cells) based on the
latest known UE location.
6-7. The AMF(s) track the UE\'s location to determine the UE\'s presence in an
Area of Interest as described in clause 4.15.4.2 of TS 23.502 [3]. Further,
the AMF(s) notify the TSCTSF about the UE(s) presence (IN, OUT, or UNKNOWN) in
the Area of Interest(s).
8\. The AMF(s) accept TSCTSF\'s subscription and provide the first
corresponding event report (if available).9. According to the UE location and
spatial validity condition, the TSCTSF determines whether to activate time
synchronization service:
\- If the UE location is in an Area of Interest (and thus in the Requested
Coverage Area), the TSCTSF determines to activate time synchronization
service.
\- If the UE location is out of Requested Coverage Area, the TSCTSF stores the
UE identity and determines not to activate ASTI time synchronization service
for the UE.
10\. The TSCTSF responds the AF with the Ntsctsf_ASTI_Create service operation
response.
11\. The NEF informs the AF about the result of the Nnef_ASTI_Create service
operation performed in step 1.
12\. The TSCTSF uses the procedures described in clause 4.15.9.4 of TS 23.502
[3] to configure ReferenceTimeInformation delivery to the UE(s) at the serving
NG-RAN nodes.
13\. UE moves in/out of the configured Area(s) of Interest.
14\. NG-RAN determines the change of the UE presence in the area of interest
has changed and notifies the AMF.
15\. The AMF detects the subscription change related event occurs and it sends
the event report by means of Namf_EventExposure_Notify message to the TSCTSF.
16\. If the TSCTSF receives the UE location change notification for AoI. The
TSCTSF may update to activate or deactivate the time synchronization service.
\- If the UE moves out of the Requested Coverage Area, the TSCTSF determines
to temporarily deactivate ASTI time synchronization service as described in
clause 4.15.9.4 of TS 23.502 [3].
\- If the UE moves into an Area of Interest, and according to Temporal
Validity Condition (if this parameter is available, and current time is within
validity time period), the TSCTSF determines to activate ASTI time
synchronization service as described in clause 4.15.9.4 of TS 23.502 [3].
\- The TSCTSF keeps the requested TS service unchanged (i.e. active/inactive)
when the UE presence in the Requested Coverage Area becomes UNKNOWN until the
TSCSTF determines that the UE is inside/outside the Requested Coverage Area.
17\. The TSCTSF updates the state of the time synchronization configuration
and may notify the NEF (or AF) with the Ntsctsf_ASTI_UpdateNotify service
operation for the UE identities that are inside or outside of the area in the
spatial validity condition.
18\. The NEF notifies the AF with the Nnef_ASTI_UpdateNotify service
operation.
#### 6.7.3.2a Procedure for AF requested 5G access stratum timing
synchronization with **Requested Coverage Area where UE\'s presence is
obtained via TSCTSF triggered** deferred 5GC-MT-LR
An overall procedure for AF requesting a specific coverage area for 5G access
stratum based time synchronization service (see TS 23.502 [3]) is illustrated
in Figure 6.7.3.2-1.
**Figure 6.7.3.2a-1: 5G access stratum time distribution configuration with
Requested Coverage Area where UE\'s presence is obtained via TSCTSF
triggered** deferred 5GC-MT-LR
1\. The AF request to influence the 5G access stratum time distribution
providing access stratum time distribution parameters to the NEF (together
with the AF identifier and potentially further inputs as specified in table
4.15.9.4-1 in TS 23.502 [3]) and optionally a spatial validity condition (i.e.
Requested Coverage Area) in the format of a geographical area (e.g. a civic
address or shapes), a list of TA(s), or a list of Cells.
2\. The NEF authorizes the request. If the AF uses a geographical area as a
spatial validity condition.
3\. After successful authorization, the NEF invokes the
Ntsctsf_TimeSynchronization_ConfigCreate service operation with the
corresponding TSCTSF, with the parameters as received from the AF.
The AF that is part of operator\'s trust domain may invoke the services
directly with TSCTSF.
4\. TSCTSF triggers a deferred 5GC-MT-LR procedure to GMLC with the type of
event assigned to Area, where the area information is set to the Requested
Coverage Area for time synchronization services provided by TSN AF.
5\. GLMC performs deferred 5GC-MT-LR procedure as defined from step 2 to 20 in
Figure 6.7.3.1-1 of TS 23.273 [16] v17.5.0 with the type of event assigned to
Area.
6\. The GLMC notifies the TSCTSF about the UE(s) presence (IN, OUT, or
UNKNOWN) in the Area of Interest(s).
7\. TSCTSF determines whether to activate time synchronization service.
According to the UE location of each UE that is targeted by the request and
spatial validity condition in step 1, the TSCTSF determines whether to active
time synchronization service for this UE:
\- If the UE location is in an Area of Interest (and thus in the Requested
Coverage Area), the TSCTSF determines to active time synchronization service
and creates a PTP port in a DS-TT and assigns it into the PTP instance.
\- If the UE location is out of Requested Coverage Area, the TSCTSF creates a
PTP port in a DS-TT and assigns it into the PTP instance but temporarily
removes the UE/DS-TT from the PTP instance and indicates the PTP port state as
Inactive for the related DS-TT PTP port.
8 The following procedure is described from step 10 to 18 in Figure 6.7.3.2-1.
### 6.7.4 Impacts on services, entities and interfaces
TSCTSF:
\- Subscribe for receiving UE\'s presence in Area of Interest from AMF or from
GLMC as a deferred 5GC-MT-LR with the type of event assigned to Area.
\- Determination of area of interest based on list of TAs or Cells.
\- Support for time synchronization service configuration conditioned to the
AF-Requested Coverage Area using a spatial validity condition.
\- Discovers the related AMF(s) using the NRF\'s service operation
Nnrf_NFDiscovery_Request.
\- Notifies the AF/NEF via a new Ntsctsf_ASTI_UpdateNotify service operation
for the UE identities that are inside or outside of the area in the spatial
validity condition.
AMF:
\- Tracks a UE\'s location to determine the UE\'s presence in an Area of
Interest using the existing event reporting type, i.e. UE mobility on Area of
Interest.
\- Notifies the subscribed TSCTSF about the change of UE\'s status (IN, OUT,
or UNKNOWN) in the Area of Interest using the (existing)
Namf_EventExposure_Notify service operation.
AF:
\- Includes the Spatial Validity Condition in AF request for time
synchronization service configuration.
## 6.8 Solution #8: AF Request of PER for QoS and Alt-QoS
### 6.8.1 Introduction
This solution is proposed to solve Key Issue #4: Enable an AF to explicitly
provide the required PER to the NEF/PCF for QoS and Alt-QoS.
In Release 17, the \"Setting up an AF session with required QoS\" procedure
(clause 4.15.6.6 of TS 23.502 [3]) and the \"AF Session with required QoS
update\" procedure (clause 4.15.6.6a of TS 23.502 [3]) were revised so the AF
can provide individual parameters for QoS and Alt-QoS. Inclusion of PER as an
individual parameter requested by the AF was postponed to Release18. PER is a
QoS Characteristic as defined in clause 5.7.3.1 of TS 23.501 [2], similar to
PDB which was included as an individual parameter. PER is also currently part
of the Alternative QoS Profile, along with PDB and GFBR. PDB and GFBR as
individual parameters for Alt-QoS were addressed in Release 17.
This solution adds Requested PER to the AF request for QoS and Alternative
QoS.
### 6.8.2 Functional Description
When there is a single PDU session anchor for the UE, an AF request for QoS
specifying a Requested PER value can sent to the PCF where it is mapped to a
PCC rule with a 5QI that reflects the Requested PER. Similarly, a Requested
PER value can be added to each Alternative-QoS Related parameter set
(currently comprising Requested Delay and Requested GBR) in the Alternative
QoS Requirements. Requested PER in the Alternative QoS requirements is mapped
to the corresponding parameters in the Alternative QoS Profile (as defined in
clause 5.7.1.2a of TS 23.501 [2]), in the same manner as was done for PDB and
GFBR in Release 17. PCF selects the appropriate 5QI considering the requested
PER and Requested 5GS Delay as in TS 23.503 [4].
### 6.8.3 Procedures
Following are the steps needed for the AF requested PER to be considered
either using single or redundant user plane paths:
1\. The AF provides Requested PER for QoS and Alternative QoS. If it is a
trusted AF, it may provide it directly to the TSCTSF. If not, it provides it
via the NEF which eventually forwards it to the TSCTSF.
2\. The TSCTSF forwards the parameters to the PCF.
3\. The PCF selects the appropriate 5QI considering the requested PER and the
individual QoS Parameters as specified in clause 6.1.3.22 of TS 23.503 [4].
4\. The PCF determines a PCC rule using the Requested PERs received from the
AF/NEF.
5\. The response to the AF (Nnef_AFsessionWithQoS_Create/Update response)
indicates whether the PER request was achieved.
### 6.8.4 Impacts on services, entities and interfaces
SMF:
\- Map Requested PER to QoS Profile for QoS and Alternative QoS.
PCF:
\- Map Requested PER to PCC Rule for QoS and Alternative QoS.
TSCTSF:
\- Support receiving Requested PER from NEF and sending to PCF.
NEF:
\- Include Requested PER in Nnef_AFSessionWithQoS service and send Requested
PER to TSCTSF.
AF:
\- Request PER for QoS and Alternative QoS.
## 6.9 Solution #9: Interworking with TSN network deployed in the transport
network
### 6.9.1 Introduction
This solution enables enhancement to support TSN transport network (TN) for N3
tunnels.
NOTE: The same solution can be used also for N9 tunnels, if necessary.
This solution addresses the following areas:
a) The architecture enhancement to support the interworking between 5GS and
TSN networks deployed in the transport network.
b) The information from 5GS to interact with TSN network.
This solution makes the following assumptions:
\- The underlay transport network for N3 tunnels support TSN features and
deploys a CNC.
\- 5GC implements the UNI as defined in IEEE P802.1Qdj [10] towards the CNC in
Transport Network. The related parameters are defined in IEEE Std 802.1Qcc
[6].
\- The solution can be used with both Ethernet and IP type PDU Sessions.
\- The solution can be used when 5GS is integrated with external IEEE TSN
networks as specified in TS 23.501 [2]. In this case the CNC in external TSN
network controls the 5GS as an IEEE 802.1Q bridge via TSN AF.
\- The solution can be used when integration with external IEEE TSN networks
does not apply as specified in TS 23.501 [2]. In this case the AF uses the
3GPP QoS-service to indicate the QoS requirements and traffic characteristics
to the TSCTSF.
\- A dynamic value for the CN PDB of a Delay-critical GBR 5QI is determined by
the SMF as described in clause 5.3.7.4 of TS 23.501 [2].
\- NG-RAN may include AN-TL function and UPF may include CN-TL function, to
support acting as a TSN Talker/Listener. SMF/CUC communicates with the AN-TL
via Transparent Container that conveys the IEEE Std 802.1Qcc [6] data sets in
N2 interface. SMF/CUC communicates with the CN-TL via Transparent Container
that conveys the IEEE Std 802.1Qcc [6] data sets in N4 interface.
\- AN-TL and CN-TL enable the following functions:
a) hold and buffer functionality in a case when the TSCAI contains a BAT in UL
and/or DL direction. In this case the TimeAwareOffset is sent to the AN-TL
and/or CN-TL in a Transparent Container, and the Talker in RAN/UPF must buffer
the data burst until the time indicated in the TimeAwareOffset is reached.
b) for support of stream transformation, in this case the
InterfaceConfiguration is sent in a Transparent Container to AN-TL and/or CN-
TL, and the Talker in RAN/UPF must use the indicated MAC address, VLAN ID or
IP-tuples for the data stream.
c) for SMF/CUC to retrieve the InterfaceCapabilities and/or
EndStationInterfaces from the AN-TL or CN-TL via Transparent Container.
Otherwise, this information must be preconfigured or determined by SMF/CUC.
\- It is assumed that RAN, 5GC and Transport Network are time synchronized
with each other in 5G internal system clock in this case.
### 6.9.2 Functional Description
5GC will act as CUC to interact with the TN CNC. RAN and UPF may act as Talker
or Listener by implementing Access Network TSN Talker/Listener (AN-TL) and
Core Network N3 interface TSN Talker/Listener (CN-TL) as network termination
point for the N3 interface. AN-TL and CN-TL support the functionality of
Talker and Listener (End Station).
The architecture is as Figure 6.9.2-1:
Figure 6.9.2-1: Architecture on interworking with TSN transport network
NOTE 1: The TN CNC in transport network (TN) is independent from the CNC in
the DN.
NOTE 2: DS-TT and NW-TT are required when 5GS is integrated with external IEEE
TSN networks.
It is proposed the SMF will act as the CUC or the CUC functionality is
collocated with SMF. SMF/CUC provides merged stream requirements on QoS Flow
basis (i.e. translated Talker group and Listener group information) as
specified in clause 45.1.7 of IEEE P802.1Qdj [10] via the User/Network-
Interface (UNI) to the TN CNC. TN CNC uses the merged stream requirements as
input to select respective path(s) and calculate schedules in TN. Based on the
results, the TN CNC provides merged end station communication-configuration
back to the SMF/CUC. The SMF may further adjust the transmit time of the
stream in UPF and RAN by including TimeAwareOffset in a Transparent Container
in a QoS Flow modification request.
When the SMF setups a new QoS Flow, the SMF signals the dynamic value for the
CN PDB and TSCAI for the QoS Flow to NG-RAN on QoS Flow basis. Upon receiving
the TSCAI for a QoS Flow from the SMF, if the TSCAI includes a BAT in UL
direction, the RAN may determine a dynamic value of 5G-AN PDB in UL direction
that is determined on QoS Flow basis. The NG-RAN provides the dynamic value of
5G-AN PDB to the SMF in a response to the QoS Flow request.
The details of providing End Station related information to generate the
merged stream requirements for the QoS Flow by the SMF/CUC are as follows:
For the Talker group:
‐ Stream ID and Stream Rank can be generated by the SMF/CUC based on pre-
configuration.
‐ EndStationInterfaces and Interface Capabilities (optional) are either pre-
configured in the SMF/CUC or the SMF/CUC can collect them during PDU Session
Establishment from AN-TL and CN-TL. The pre-configured information at the
SMF/CUC leaves the InterfaceCapabilities empty.
\- DataFrameSpecification (optional) is present if stream transformation is
not performed in AN-TL and CN-TL.
or if AN-TL and CN-TL functions are not supported. In this case, the TN CNC
configures the edge bridge to perform the stream transformation based on the
provided the DataFrameSpecification. The SMF/CUC populates the attribute with
the N3 tunnel end point addresses/ports during the QoS Flow setup.
If the TL-functions are not supported, two options can be considered for
identifying the traffic on QoS Flow basis in the TN:
a) The SMF can instruct the UPF and NG-RAN to assign a separate CN tunnel end
point address for each QFI of the N4 Session. This ensures the TN can
distinguish the QoS Flows based on the N3 tunnel destination IP addresses. For
example IPv6 can be used in the N3 tunnel end point addresses to provide
sufficient address space.
b) The interface between the SMF/CUC and TN CNC allows the SMF /CUC to
indicate the TEID and QFI of the given QoS Flow to the TN CNC. For example,
the SMF/CUC indicates a Stream Filter including the source/destination IP
addresses/ports and QFI and/or TEID, and merged stream requirements that are
associated with this Stream Filter. TN can distinguish the QoS Flows based on
the TEID and QFI as carried in the GTP-U. This option impacts the IEEE
P802.1Qdj [10].
NOTE 3: Option b) will be abandoned if it is not supported by IEEE P802.1Qdj
[10].
‐ In TrafficSpecification elements, there are several parameters related to
the TSC traffic within 5GS:
‐ MaxFrameSize, SMF/CUC could generate it from the Burst Size of the TSC
traffic. PCF needs to transfer the Burst Size to the SMF. SMF also needs to
consider the framing bits which is not used for transferring in 5GS, (e.g.
CRC), the GTP-U tunnel overhead.
‐ MaxFramesPerInterval, SMF could set it as 1.
‐ Interval, SMF could generate it from the Periodicity of the traffic as
indicated in the TSCAI.
‐ TSpecTimeAware group (optional, present only if the traffic is time-
synchronized):
‐ EarliestTransmitOffset, the earliest offset within the Interval.
\- For uplink, EarliestTransmitOffset should be set based on the BAT in UL in
TSCAI, 5G-AN PDB, and Interval using the following formula:
The sum of (UL BAT + 5G-AN PDB) (presented in TAI time and corrected for clock
drifting as specified in TS 23.501 [2]) - M x Interval, where M is the largest
integer for which the relation:
UL BAT + 5G-AN PDB > M x Interval duration.
would be true.
\- For downlink, EarliestTransmitOffset should be set based on the BAT in DL
in TSCAC, and UPF Residence Time and Interval using the following formula:
The sum of (DL BAT + UPF Residence Time) (presented in TAI time and corrected
for clock drifting as specified in TS 23.501 [2]) - CN PDB - M x Interval,
where M is the largest integer for which the relation:
DL BAT + UPF Residence Time > M x Interval duration.
would be true.
‐ LatestTransmitOffset, the last chance within an interval should leave enough
time to transfer a packet with MaxFrameSize. Thus, the SMF could generate it
from the EarliestTransmitOffset plus the interval subtracting subtracting the
sum of jitter and the time to transfer a packet with MaxFrameSize.
‐ Jitter, SMF could generate it based on local configuration.
‐ UserToNetworkRequirements.MaxLatency:
‐ NumSeamlessTrees, SMF/CUC could set it as 0 if no redundancy is needed,
otherwise it could use other values.
‐ MaxLatency, SMF/CUC could generate it based on CN PDB and UPF Residence
Time, i.e. it should be CN PDB minus UPF Residence Time.
The Listener group contains Stream ID, EndStationInterfaces,
UserToNetworkRequirements, and Interface Capabilities. The SMF could generate
the corresponding information in the same way as defined for the Talker group.
NOTE 4: It is assumed that the merged stream requirements will contain at
least the same information as defined for the User/network configuration
information (i.e. Talker group and Listener group).
The merged end station communication-configuration provided by TN CNC to the
SMF/CUC includes:
‐ Stream ID.
‐ StatusInfo.
‐ AccumulatedLatency.
‐ InterfaceConfiguration (optional):
‐ MAC Address (optional, present only if stream transformation is performed).
‐ VLAN Tag (optional, present only if stream transformation is performed).
‐ IPv4/IPv6 Tuples (optional, present only if stream transformation is
performed).
‐ TimeAwareOffset (optional, present only if the traffic is time-
synchronized).
‐ FailedInterfaces.
The details of the above information are described in IEEE Std 802.1Qcc [6].
When the SMF/CUC receives the merged end station communication-configuration
from TN CNC, the configuration may include InterfaceConfiguration, optionally
with TimeAwareOffset element.
If the InterfaceConfiguration is included from TN CNC to SMF/CUC, and if the
NG-RAN and UPF include the AN-TL/CN-TL and support the Stream Transformation
as described in IEEE 8021.Qdj [10], SMF can instruct the UPF and NG-RAN to
assign for each TSC stream an individual TSN Transport address by providing
the InterfaceConfiguration to the AN-TL/CN-TL. The Talker in AN-TL/CN-TL shall
use the indicated InterfaceConfiguration, e.g. Multicast destination MAC
address as assigned by the TN CNC. In this case the TN can identify the
streams based on the Stream Transformation that is applied in the Talker in
the AN-TL/CN-TL. This allows to use a single GTP-U tunnel as defined for non
TSN Transport networks. The TSN transport address used for identification in
TN can be a Destination MAC address, a Source MAC address and a VLAN ID
(optional).
If the TimeAwareOffset is included from TN CNC to SMF/CUC, the SMF/CUC should
configure the AN-TL and CN-TL based on the TimeAwareOffset. The SMF/CUC
adjusts the TimeAwareOffset to be relative from the start of the BAT before
sending it to the AN-TL or CN-TL. The AN-TL and CN-TL should set the sending
time of the traffic (e.g. AdminBaseTime and OperBaseTime in 802.1Qbv data
sets) in the transport layer accordingly.
NOTE 5: It is assumed that the merged end station communication-configuration
will contain at least the same information as defined for the status.
### 6.9.3 Procedures
Figure 6.9.3-1 shows the procedure for this solution:
Figure 6.9.3-1: Procedure for interworking with TSN transport network
1\. UE triggers the PDU Session Establishment procedure as described in clause
4.3.2 of TS 23.502 [3]. If the RAN/UPF support the TL-function, the RAN and
UPF report InterfaceCapabilities to the SMF/CUC via a Transparent Container.
2\. During QoS Flow setup, the SMF received PCC rules with TSC Assistance
Container from the PCF. The PCF needs to send Burst Size of the TSC traffic as
described in clause 6.9.2.
2a. SMF setups the QoS Flow with UPF and NG-RAN.
3\. The SMF/CUC generates merged stream requirements as described in clause
6.9.2.
4\. The SMF/CUC sends the merged stream requirements to the TN CNC.
5\. The TN CNC returns the merged end station communication-configuration to
the SMF/CUC.
6\. The SMF/CUC configures the Talker and Listener based on the merged end
station communication-configuration returned by the TN CNC. The SMF/CUC could
send the TimeAwareOffset to theCN-TL and AN-TL in a Transparent Container. The
CN-TL and AN-TL should adjust the sending time of the traffic (e.g.
AdminBaseTime and OperBaseTime) accordingly.
### 6.9.4 Impacts on services, entities and interfaces
SMF:
\- Support the collocation with CUC, i.e.:
\- Provide input related to the Talker/Listener Group based on the above
description. Passes the merged stream requirements to the TN CNC. Receives the
merged end station communication-configuration from the TN CNC.
\- Optionally transfer received merged end station communication-configuration
from the TN CNC to the Talker/Listener accordingly.
PCF:
\- sends the TSCAC including Burst Size of the TSC traffic to the SMF.
RAN:
\- optionally support the functionality of Listener/Talker as described above.
UPF:
\- optionally support the functionality of Talker/Listener as described above.
## 6.10 Solution #10: 5GC acting as a CUC for CNC in TN
### 6.10.1 Introduction
This solution is merged into Solution #9.
This solution enables the 5GC to act as a TSN CUC (Centralized User
Configuration).
This solution makes the following assumptions:
\- The underlay transport network for N3 and N9 tunnels support TSN features
and deploys a CNC.
\- 5GC implements the UNI as defined in IEEE P802.1Qdj [10] towards the CNC in
Transport Network.
\- The solution can be used with both Ethernet and IP type PDU Sessions.
\- The solution can be used when 5GS is integrated with external IEEE TSN
networks as specified in TS 23.501 [2]. In this case the CNC in external TSN
network controls the 5GS as an IEEE 802.1Q bridge via TSN AF.
\- The solution can be used when integration with external IEEE TSN networks
does not apply as specified in TS 23.501 [2]. In this case the AF uses the
3GPP QoS-service to indicate the QoS requirements and traffic characteristics
to the TSCTSF.
\- A dynamic value for the CN PDB of a Delay-critical GBR 5QI is determined by
the SMF as described in clause 5.3.7.4 of TS 23.501 [2].
### 6.10.2 Functional Description
The solution is based on the architecture in Figure 6.10.2-1:
Figure 6.10.2-1: Architecture to support the control of TSN features in TN
\- The solution supports deployments with and without external TSN network:
a) When integration with IEEE TSN applies: CNC in external TSN network
provides bridge configuration to the TSN AF. TSN AF uses the PSFP (IEEE
802.1Qci) information as provided by the CNC to derive the TSC Assistance
Container (TSCAC). TSCAC is provided to the SMF (via PCF), and SMF determines
the TSC Assistance Information (TSCAI) as specified in TS 23.501 [2].
b) When integration with IEEE TSN does not apply: The AF provides a
Ntsctsf_QoSandTSCAssistance service request to the TSCTSF (directly or via
NEF). The request contains the flow description and may contain one or more of
the Requested 5GS delay, Burst Size, Burst Arrival Time, Periodicity, and Time
Domain as specified in clause 4.15.6.6 of TS 23.502 [3]. TSCTSF determines the
TSCAC and provides it to the SMF (via PCF), and SMF determines the TSCAI. DS-
TT and NW-TT are optional as in Release 17.
\- TSN Transport Network (TN) deploys a CNC that communicates with a CUC
residing in the 5GC. The SMF is collocated with the CUC and information is
exchanged between SMF and CUC by implementation specific means (out of scope
of 3GPP). Once the SMF has established a QoS Flow between UPF and NG-RAN, the
SMF/CUC determines the merged stream requirements for the QoS Flow in the
transport network and communicates them to the CNC in TN.
\- The CUC implements the UNI as defined in IEEE P802.1Qdj [10] towards the
CNC in Transport Network.
\- CNC in TN configures the TN according to the merged stream requirements
reflecting the required traffic characteristics of the QoS Flow.
Editor\'s note: Stream Aggregation is FFS.
### 6.10.3 Procedures
Figure 6.10.3-1 describes the overall procedure how QoS Flows are established
with the solution.
Figure 6.10.3-1: Overview of the QoS Flow establishment
1\. PCF receives the Policy Authorization service request from the
AF/NEF/TSCTSF. The PCF composes the PCC Rules as specified in Release 17\. PCF
includes the TSCAC in the request when it invokes the SMF.
2\. SMF receives the PCC Rules from the PCF. The SMF binds the PCC rule to a
QoS Flow.
3\. SMF indicates N4 rules for a QoS Flow to the UPF. The UPF assigns the CN
tunnel endpoint address. The SMF determines a dynamic value for the CN PDB,
based on the UPF and NG-RAN of the PDU Session.
4\. The SMF provides the QoS profile for the QoS Flow to the NG-RAN. The SMF
signals the dynamic value for the CN PDB for the QoS Flow to NG-RAN. NG-RAN
assigns the AN tunnel endpoint address.
SMF provides the TSCAI to the NG-RAN on QoS Flow basis. The TSCAI may contain
Burst Arrival Time (BAT) at the UE egress for UL traffic, and BAT at the gNB
ingress for DL traffic, as specified in Release 17.
Upon receiving the TSCAI for a QoS Flow from the SMF, if the TSCAI includes a
BAT in UL direction, the RAN determines the corresponding BAT offset in UL
direction at the gNB egress. The NG-RAN provides the value to the SMF in a
response.
BAT offset is relative to the BAT value in UL direction NG-RAN has received
from the SMF in TSCAI. BAT offset can take positive or negative values. The
NG-RAN estimates the value of BAT offset at the time of QoS Flow establishment
or modification. If necessary, the NG-RAN can update the BAT offset to the SMF
e.g. if certain threshold is exceeded.
If (g)PTP time synchronization is used and the TSCAC contains the Burst
Arrival Time expressed in external GM time, the SMF adjusts the TSCAI to be
expressed in 5GS time based on the clock drifting reports from the UPF as in
Release 17. In this case the SMF may update the TSCAI of the QoS Flow to the
NG-RAN.
5\. After the SMF has setup a QoS Flow between UPF and NG-RAN, the SMF deducts
the received BAT offset from the current BAT in UL direction in the TSCAI for
the given QoS Flow.
The SMF provides the corresponding flow identification (AN tunnel end point
address/port and CN tunnel endpoint address/port) along with the traffic
requirements and characteristic for the QoS Flow (BAT at RAN egress in UL
direction, BAT at UPF egress in DL direction, Periodicity, maximum latency,
maximum jitter, max number of frames per interval, maximum frame size, etc.).
While the collocated CUC translates this information to merged stream
requirements. The CUC communicates the merged stream requirements to the CNC
in the TN. The SMF sets the maximum latency to the value of the CN PDB.
Editor\'s note: It is FFS if also the UPF residence time needs to be
considered when calculating the maximum latency that is indicated in the
stream requirements.
The CUC and CNC in TN may use the data frame specification for IP to identify
at UNI the TN stream on QoS Flow basis, in order to treat the data flow
according to the traffic requirements assigned for the QoS Flow. The CNC in TN
can then use the provided merged stream requirements to ensure that sufficient
resources are reserved in the TN for the TN stream e.g. to select the path(s)
and calculate schedules for the traffic that can guarantee the required
maximum latency.
NG-RAN and UPF may support the Stream Transformation as described in IEEE
P802.1.Qdj [10], e.g. Talker uses the Multicast MAC address as assigned by the
TN-CNC and indicated to the NG-RAN and UPF from the SMF/CUC. Alternatively, if
the NG-RAN and UPF do not support Stream Transformation, two options can be
considered for identifying the traffic on QoS Flow basis in the TN:
a) The SMF can instruct the UPF and NG-RAN to assign a separate CN tunnel end
point address for each QFI of the N4 Session. This ensures the TN can
distinguish the QoS Flows based on the AN and CN tunnel destination IP
addresses. It is assumed that IPv6 is used in the CN tunnel addresses to
provide sufficient number of addresses.
b) The interface between the CUC and CNC in the TN allows the SMF and CUC to
indicate the TEID and QFI of the given QoS Flow to the CNC in the TN. For
example, the CUC indicates a Stream Filter including the source/destination IP
addresses/ports and QFI and/or TEID, and merged stream requirements that are
associated with this Stream Filter. TN can distinguish the QoS Flows based on
the TEID and QFI as carried in the GTP-U. This option impacts the IEEE
P802.1Qdj [10].
### 6.10.4 Impacts on services, entities and interfaces
SMF:
\- Allows information access with the collocated CUC to support UNI as
described in IEEE P802.1Qdj [10].
\- Determines the traffic requirements for a QoS Flow and initiates that CUC
translates them to merged stream requirements which are then passed to the CNC
in Transport Network.
NG-RAN:
\- Determines a BAT offset in UL direction at the gNB egress, based on the BAT
in UL direction the NG-RAN receives from the SMF in TSCAI. The NG-RAN provides
the BAT offset value to the SMF in a response to the QoS Flow establishment or
modification request. If Option a) is used to identify the flows in TN,
assigns a separate AN tunnel end point address for each QFI of the PDU
Session.
UPF:
\- If Option a) is used to identify the flows in TN, assigns a separate CN
tunnel end point address for each QFI of the N4 Session.
## 6.11 Solution #11: Interworking with TSN enabled N3 transport network for
deterministic traffic delivery
### 6.11.1 Introduction
The solution is proposed to solve Key Issue #5: Interworking with TSN network
deployed in the transport network. In the 3GPP Rel-16 and Rel-17, the 5GS has
supported \"periodic deterministic communication\", so called TSC
communication.
The E2E delay for the service flow in the 5GS (called as PDB) includes AN-PDB
between UE and NG-RAN, and CN-PDB between NG-RAN and UPF. The CN-PDB is
guaranteed by N3 transport network.
If the TSN is deployed in the N3 transport network, the 5GS can utilize the
TSN capability in the N3 to provide the deterministic CN-PDB.
### 6.11.2 Functional Description
In the figure 6.11.2-1, it proposes an enhanced 5GS architecture to utilize
the TSN capability in the N3 transport network.
Figure 6.11.2-1: The enhanced 5GS interworking with CNC in transport network
The solution is based on the following principles:
\- It is assumed that RAN, 5GC and Transport Network are time synchronized
with each other in 5G internal system clock in this case.
\- There may be a logical functionality, NG-TT (NG-RAN TSN translator) in the
NG-RAN, which act as the TSN end station in the N3 transport network.
\- it may support LLDP to provide topology information to the TSN Transport
Network.
\- As TSN end station, it acts as Talker when it sends UL packets, and as
Listener when it receives DL packets.
\- it may support PMIC and UMIC to communicate with TSNCF.
\- There may be a logical functionality, TNW-TT (Transport NW-TT) in the UPF,
which acts as TSN end station in the N3 transport network.
\- it may support LLDP to provide topology information to CNC the TSN
Transport Network.
\- As TSN end station, it acts as Talker when it sends to DL packets, and as
Listener when it receives UL packets.
\- it may support PMIC and UMIC to communicate with TSNCF.
\- When LLDP is supported, the u-plane is performing the LLDP functionality
without the need for c-plane interaction with CNC of the transport network for
the purpose of LLDP. This can be achieved with following measures:
\- The TSN End Station (UPF, NG-RAN, or respective End Station TSN Translator)
implements the Transmit Only operation mode as defined in clause 9.1 of IEEE
Std 802.1AB-2016 [14].
\- The TSN End Station is pre-configured with parameter set for Transmit Only
operating mode as defined in clause 9.2 of IEEE Std 802.1AB-2016 [14].
\- The System Capabilities TLV may also be set to Station Only as defined in
clause 8.5.8 of IEEE Std 802.1AB-2016 [14].
NOTE 1: It may reuse the PMIC/UMIC for the NW-TT.
\- There is TSN CUC Function (TSNCF) in the 5GC. It act as the CUC to
communicate with CNC in the N3 transport network.
\- The TSNCF may be in the TSN AF, or TSCTSF.
\- During TSC communication establishment, it collect the Talker/Listener
stream requirement as specified in IEEE Std 802.1Qcc [6] from NG-TT and TNW-
TT.
\- The TSNCF provides the Talker/Listener status to CNC and receives the
status of stream configuration from CNC.
\- The TSNCF provides the Talker/Listener configuration status to NG-TT and
TNW-TT via PMIC/UMIC.
\- The Talker/Listener stream requirement and Talker/Listener configuration
status as specified in IEEE Std 802.1Qcc [6] are encoded as container in the
PMIC which is transferred between TSNCF and UPF/TNW-TT.
\- The Talker/Listener stream requirement and Talker/Listener configuration
status as specified in IEEE Std 802.1Qcc [6] are encoded as container in N2
container which is transferred between TSNCF and NG-RAN.
\- The NG-TT/TNW-TT provides the CN PDB to TSN CUC Function (TSNCF) in the
5GC.
\- The NG-TT/TNW-TT provides the following Talker status to TSN CUC Function
(TSNCF) in the 5GC.
\- EndStationInterfaces.
\- DataFrameSpecification. DataFrameSpecification is present if stream
transformation IEEE Std 802.1Qcc [6] clause 46.1.4 is not performed in the End
Station. This solution proposes the Talker (NG-TT/TNW-TT) always send this IE.
There are two methods in DataFrameSpecification, which can be used by TSN to
identify the TSN stream.
Option A): For each Qos flow for the TSN, there is a distinct GTP tunnel, i.e.
source IP address + source UDP port + destination IP address shall be unique.
(Destination UDP port is well known, i.e. 2152).
Option B): There is no impact to the usage of existing GTP-U. For each Qos
flow for the TSN, it used the source MAC address + destination MAC address +
VLAN ID identify the stream. Because the VLAN tag value is less than 4096, so
the NG-TT/TNW-TT need to maintain a MAC address pool for each interface.
\- TrafficSpecification.
\- InterfaceCapabilities.
\- The NG-TT/TNW-TT provides the following Listener status to TSN CUC Function
(TSNCF) in the 5GC.
\- EndStationInterfaces.
\- InterfaceCapabilities.
\- The TSN CUC Function (TSNCF) in the 5GC create the following IE for the
talker and Listener.
\- StreamID.
\- StreamRank.
\- UserToNetworkRequirements.
NOTE 2: The value of Listener and Talker status refer to solution 9 except the
DataFrameSpecification.
### 6.11.3 Procedures
The procedure in Figure 6.11.3-1 shows a signalling flow in which the 5GS
reserve the resource in the TSN enabled N3 transport network.
Figure 6.11.3-1: Procedure for reserve the resource in TSN transport network
The signalling procedure is similar with the network requested PDU Session
Modification specified in clause 4.3.3.2 of TS 23.502 [3]. The enhancement
are:
8\. The NG-RAN send the PMIC/UMIC in the N2 request, which carry the stream
information needed for CUC. For the UL traffic, the stream information is for
the Talker, and for the DL traffic, the stream information is for the
Listener. The stream information detail see clauses 46.2.3 and 46.2.4 of IEEE
Std 802.1Qcc [6].
9\. The PMIC/UMIC from NG-TT is sent to SMF.
10\. The UPF/TNW-TT send the PMIC/UMIC in the N4 response, which carry the
stream information needed for CUC. For the DL traffic, the stream information
is for the Talker, and for the UL traffic, the stream information is for the
Listener. The stream information detail see clauses 46.2.3 and 46.2.4 of IEEE
Std 802.1Qcc [6].
11, 12. The PMIC/UMIC from NG-TT and TNW-TT is sent to TSNCF via PCF.
13\. The TSNCF send the Talker/Listener status to CNC. The CNC response with
stream configuration.
14-18. The TSNCF send the stream configuration to NG-TT and TNW-TT in the
PMIC/UMIC.
### 6.11.4 Impacts on services, entities and interfaces
\- NG-RAN/NG-TT: it may support LLDP to report the topology to CNC. As the TSN
end station, it is Talker when it send to UL packet, and is Listener when it
receives the DL packet. It support container to communicate with TSNCF.
\- UPF/TNW-TT: it may support LLDP to report the topology to CNC. As the TSN
end station, it is Talker when it send to DL packet, and is Listener when it
receives the UL packet. It support PMIC and UMIC to communicate with TSNCF.
\- TSNCF: It collect the Talker/Listener stream requirement as specified in
IEEE Std 802.1Qcc [6] from NG-TT and TNW-TT via PMIC/UMIC. It provides the
Talker/Listener status to CNC and receives the status of stream configuration
from CNC. It provides the Talker/Listener configuration status to NG-TT and
TNW-TT via PMIC/UMIC.
Editor\'s note: Additional impact is FFS.
## 6.12 Solution #12: Cross layer scheduling optimization based on RAN
feedback
### 6.12.1 Introduction
This solution enables the RAN to provide time offset feedback to AF for low
latency communication, and the solution addresses the following scenarios:
\- adapting application transmission schedule in DL based on RAN feedback for
low latency.
\- The same solution can be used also in UL direction, if necessary
\- The solution can be used together with the Solution 9 to configure the
underlay network in the TN for the required traffic characteristics of the QoS
Flow.
### 6.12.2 Functional Description
In the current specification, the AF/NEF provides the traffic characteristics
information to the TSCTSF using the Ntsctsf_QoSandTSCAssistance service. The
TSCTSF constructs a TSC Assistance Container (including flow direction,
periodicity and Burst Arrival Time) for an application and provides it to the
SMF via PCF. In this solution, instead of the BAT, the AF provides BAT window
(as indicated by BAT-early and BAT-late) showing the acceptable earliest and
latest arrival time of the traffic (as experienced by the 5GS). The TSCTSF
provides the BAT windows in the TSC Assistance Container to the SMF via PCF if
included in the Ntsctsf_QoSandTSCAssistance.
NOTE 1: This solution assumes that 5GS and AF are time synchronized.
The SMF determines the TSCAI for the QoS Flow based on the TSC Assistance
Container of the PCC rule bound to the QoS Flow as described in clause
5.27.2.4 of TS 23.501 [2], i.e. the BAT-early and BAT-late in the TSCAI
represent a range for the latest possible time when the first packet of the
data burst arrives at the AN.
When NG-RAN receives the TSCAI, NG-RAN determines a Semi-Persistent Scheduling
scheme according to the TSCAI and the PDB. To maximize the time for
transmission/re-transmission over the air interface and to minimize the
scheduling time (within the PDB available for the QoS Flow), the NG-RAN may
calculate the offset time between the earliest arrival time of the Burst
Arrival Time and the determined scheduling time.
NOTE 2: The timing of the arrival of the DL traffic can be made more accurate
for the NG-RAN by using Solution 9 to configure the underlay network.
For example, the adjusted packet for DL traffic based on the offset should
arrive at a time slot before and closest to the determined scheduling time
slot so that it could be transferred immediately. The NG-RAN may select the
BAT offset that is relative to the BAT-early, and is less or equal to the
subtract of the BAT-late and BAT-early.
NG-RAN forwards the BAT offset in DL direction to the SMF. SMF will send it
back to the AF via PCF/TSCTSF/NEF.
AF receives the BAT offset and notifies the application to adapt the DL
transmission schedule to it.
In similar manner, NG-RAN may determine scheduling for configured grants in UL
direction, and provide a BAT offset in UL direction to the SMF. The SMF sends
it back to the AF via PCF/TSCTSF/NEF.
If the AF wishes to change the accepted BAT offset, the AF can update the
TSCTSF with the new BAT window by initiating a new QoS update procedure. The
TSCTSF updates the TSCAC based on the AF update.
NOTE 3: This solution could also be used for UL as BAT offset could be
indicated separately for UL and DL directions.
The SMF configures the UPF for clock drifting reports as specified in TS
23.502 [3]. In a case the SMF receives a clock drifting report from UPF, the
SMF adjusts the BAT offset based on the existing procedures in TS 23.502 [3]
and provides the updated BAT offset to the AF via PCF/TSCTSF/NEF.
### 6.12.3 Procedures
Figure 6.12.3-1 describe the procedure for this solution:
Figure 6.12.3-1: Procedure for Cross layer scheduling optimization based on
RAN feedback
1\. AF/TSCTSF provides TSCAC to the SMF as described in clause 5.27.2 of TS
23.501 [2]. Optionally, the TSCTSF provides a BAT window (BAT-early and BAT-
late) in UL and/or DL direction in the TSC Assistance Container to the SMF via
PCF based on the AF request.
2\. The SMF determines the TSCAI for the QoS Flow based on the TSC Assistance
Container of the PCC rule (including BAT windows) bound to the QoS Flow as
described in clause 5.27.2.4 of TS 23.501 [2].
3\. The SMF transfer the TSCAI generated in step 2 to the RAN.
4\. NG-RAN determines the BAT offset(s) as described in clause 6.12.2.
5\. NG-RAN provides the BAT offset(s) to SMF.
6\. [OPTIONAL] If Solution 9 is used to interwork with TSN in the transport
network, the SMF adds the received BAT offset in UL or DL direction to the
BAT-early in UL or DL direction, respectively. The SMF uses the resulted new
BAT value(s) as an input to the formula as described in Solution 9, when the
SMF calculates the EarliestTransmitOffset(s) to the CNC in Transport Network.
7\. SMF provides the BAT offset(s) to the TSCTSF/AF.
8\. The AF receives the offset time or expected BAT and notifies the
application to adapt the DL transmission schedule to it.
If the AF wishes to change the accepted BAT offset, the AF can update the
TSCTSF with the new BAT window by initiating a new QoS update procedure as in
step 1. The TSCTSF updates the TSCAC based on the AF update.
### 6.12.4 Impacts on services, entities and interfaces
NG-RAN:
\- Supports of BAT offset calculating and reporting.
AF:
\- Receiving BAT offset.
\- Providing a BAT window.
\- Notifying the applications to adapt the DL transmission schedule to it.
SMF:
\- Mapping the BAT offset between external clock and the 5G clock.
\- Support of signalling the BAT offset and BAT window.
PCF/TSCTSF/NEF
\- Support of signalling the BAT offset BAT window.
## 6.13 Solution #13: Pro-active RAN burst timing preference provision
### 6.13.1 Introduction
This solution enables AF to configure burst transmission scheduling
(transmission time and/or periodicity) optimally considering the radio
configuration. This is achieved by signalling RAN burst timing preferences
pro-actively to AF at the time of QoS configuration phase.
### 6.13.2 Functional Description
This solution is based on the following principles:
\- The AF indicates its burst timing adaptation capabilities in QoS request
together with the TSC stream characteristics to TSCTSF. The TSCTSF sends burst
timing adaption capabilities in TSCAC to the PCF:
\- The application may be capable of adapting burst sending time and/or burst
periodicity proactively based on the feedback.
\- The SMF receives the TSCAC including burst timing adaptation capability
from the PCF and sends it to the RAN in TSCAI.
\- For a given UE, the RAN node derives the preferred time window for burst
arrival taking at least radio configuration and radio resource status into
account and communicates the derived burst timing preferences to 5GC. RAN
burst timing preferences includes both the burst arrival window (BAW) in
absolute time and burst periodicit(ies) separately for UL and DL in order to
align periodic burst optimally to the radio configuration at the radio
interface. Burst arrival window (BAW) refers to the time period that is
provided by RAN, including the earliest possible absolute time and the latest
possible absolute time (taking radio configuration and radio resources status
into account).
\- RAN can provide one/multiple of periodicities as part of feedback to AF
based on the periodicity values of the TDD cycle specified in TS 38.331 [5].
NOTE 1: If the application is unable to adapt the traffic according to burst
timing preferences provided by the AF, there could be misalignment between
incoming traffic and transmission opportunity in the RAN.
\- The SMF translates the (absolute time) burst arrival window from 5G clock
to external clock (depending on AF time domain) and from RAN reference point
to 5G ingress reference point considering the clock drift between the 5G clock
and external clock, UE/DS-TT residence time and CN PDB. The SMF forwards the
preferred 5G Ingress BAW and preferred periodicity for UL and DL along with
UE/DS-TT residence time to the PCF.
\- The TSCTSF receives burst timing preferences (BAW and periodicity) from the
PCF. The TSCTSF may derive exact 5G ingress burst arrival times from the burst
arrival window from the RAN node.
\- The TSCTSF forwards burst timing preferences to the AF.
NOTE 2: Achieving determinism for the transport network (i.e. to avoid
inaccuracies with CN PDB) is out of scope for this solution.
### 6.13.3 Procedures
As shown in figure below, the solution utilizes existing procedures. Mainly
following enhancements are proposed:
1\. The AF session with requested QoS procedure (clause 4.15.6.6 of TS 23.502
[3]) is used for burst timing adaptation capability signalling from AF to PCF.
\- The TSCTSF includes the burst timing adaptation capabilities in TSCAC.
2\. The burst timing adaptation capability is forwarded to RAN by reusing PDU
session modification procedure. The PDU session modification procedure is also
used for RAN timing preference signalling to the PCF.
\- The SMF derives the TSCAI and includes the burst timing adaptation
capabilities in TSCAI.
\- The RAN derives RAN burst timing preferences (preferred RAN BAW and
periodicity) based on the radio configuration and radio resource status, and
performs admission control. RAN communicates the derived timing preferences to
SMF (through AMF).
\- The SMF translates RAN BAW to 5GS ingress BAW and signals RAN preferences
to PCF.
3\. The notification procedures are utilized for burst timing preference
signalling from PCF to TSCTSF and from TSCTSF to AF.
\- The TSCTSF derives exact BAT from the BAW and includes BAT to the NEF.
\- The TSCTSF provides the updated BAT value as part of TSC Assistance
container which is eventually forwarded to the SMF and provided as updated
TSCAI to the RAN.
Figure 6.13.3.1-1: Procedure for AF requested QoS with burst timing adaptation
### 6.13.4 Impacts on existing services and interfaces
AF:
\- Indication of burst timing adaptation capabilities.
\- Burst sending schedule adaptation according to the received timing
preferences.
TSCTSF:
\- Reception and forwarding of burst timing adaptation capabilities.
\- Receptions of RAN timing preferences from the PCF.
\- Derivation of the exact BAT from the wider BAW from the RAN and timing
coordination between burst of different TSC streams and providing the BAT
value as part of updated TSCAI to the RAN.
RAN:
\- Reception of Adjustment Capability flag that triggers derivation of RAN
Burst arrival window and periodicity.
\- Derivation of RAN burst timing preferences based on the radio
configurations and radio resource status.
SMF:
\- Translation of RAN burst arrival window to 5GS ingress burst arrival
window.
NEF, PCF:
\- Support of signalling burst timing adaptation capabilities and RAN timing
preferences.
## 6.14 Solution #14: Assisted and Complement Timing Support
### 6.14.1 General
Editor\'s note: Whether this solution is in scope of the key issue is FFS.
This solution is addressing the requirement for timing resiliency towards a
client network (external network that requires a resilient timing service by
the 5GS), as backup when the local primary time source fails, or as a
complement to calibrate an inaccurate local primary timing source in the
client network.
In these cases, delivering a stable and accurate phase or frequency is
sufficient (no need to deliver time information over the 5G network).
This solution proposes to support Assisted Timing to provide backup timing
service which if applied to 5GS implies a low impact since the only timing
information to be provided is a stable phase or frequency only. As an
alternative, the stable phase synchronization could be offered in order to
complement (by calibrating) the external inaccurate primary local source, i.e.
Complement Timing. In the case of Complement Timing where timing information
is provided in terms of phase synchronization, NG-RAN is required to deliver
phase synchronization (frequency synchronization is not sufficient).
If the client network supports receiving some form of assisted/complement
timing and requires Timing Resiliency from 5GS via the already supported Time
Synchronization service activation, the 5GS will be able to provide
assisted/complement timing, where the timing information may be phase or
frequency. The AF request therefore may indicate during the Time
Synchronization service activation, that Timing Resiliency is required,
whether assisted or complement timing is required, the type to timing
information (phase or frequency). Additional parameters need to be provided
such as service availability (including holdover time), and frequency/phase
accuracy compared to UTC frequency/phase, respectively. Like with per-Uu
interface time error budget, the frequency/phase accuracy has to be calculated
per UE (per Uu interface) by TSCTSF and provided to NG-RAN. The timing service
can be provided over different types of external interfaces, e.g. (g)PTP as
defined in TS 23.501 [2] or by an implementation specific interface.
If Timing Resiliency is required, the client network should receive feedback
(status report) whenever the service requirements (e.g. time error budget, UTC
traceability, frequency/phase accuracy, etc.) are out of the agreed range.
Moreover, status reports content just indicate that requirements were not
achieved, instead of including the actual values of the parameters. How to
provide the status report is out of the scope in this solution.
### 6.14.2 Functional Description
This solution is based on the following principles:
\- AF may include in its request for time synchronization service the
following:
\- Timing Resiliency requirement, including the following parameters:
\- Assisted or complement timing requirement;
\- Type of timing information required (phase or frequency);
\- Frequency/phase accuracy requirement compared to UTC frequency/phase,
respectively.
Editor\'s note: It is FFS whether to include this list of specific parameters
as part of the subscription data related to KI #3.
NOTE: Other parameters such as service availability (including holdover time)
and stability level of the timing information (time, phase or frequency) are
relevant and can apply to this solution.
\- Status report is sent to UE application and to AF when one or more agreed
requirements are out of range, indicating that service requirements are not
achieved.
### 6.14.3 Procedures
Existing time synchronization activation procedures (see clause 4.15.9 of TS
23.502 [3]) are reused, where the AF request content is modified to include
Timing Resiliency requirement, whether assisted/complement timing is required,
the type of timing information (phase or frequency), frequency/phase accuracy.
Extract of clauses from TS 23.502 [3] (using approved S2-2203232 from SA WG2
meeting #150E for clause 4.15.9.4) are presented showing the changes proposed
to support this solution.
NOTE: Except for clause 4.15.9.3.1, where time synchronization parameters are
added, procedures in clause 4.15.9.3 remain unchanged.
Clause 4.15.9.4 of TS 23.502 [3] is also modified to add parameters to the
time synchronization table, to state that TSCTSF calculates the Uu
frequency/phase accuracy, and to transfer time resiliency parameters
(including assisted or complement timing requirement, timing information type,
frequency/phase accuracy), likewise Uu time synchronization error budget, to
NG-RAN.
#### 6.14.3.1 Procedures for (g)PTP time distribution
To procedures are presented as changes (underlined text) to clause 4.15.9.3.1
of TS 23.502 [3], as follows:
This procedure can be used by the AF to activate, modify or deactivate the
(g)PTP instances in 5GS.
The AF may activate the time synchronization service using the
Nnef_TimeSynchronization_ConfigCreate service operation. The service operation
creates a time synchronization configuration based on the service parameters
as indicated in the create request. The AF may update the time synchronization
configuration using the Nnef_TimeSynchronization_ConfigUpdate service
operation. The AF may deactivate the time synchronization service using the
Nnef_TimeSynchronization_ConfigDelete service operation, which deletes the
corresponding time synchronization service configuration.
The Nnef_TimeSynchronization_ConfigCreate and
Nnef_TimeSynchronization_ConfigUpdate request may contain the parameters as
described in Table 6.14.3.1-1.
Table 6.14.3.1-1: Description of Time Synchronization service parameters
+----------------------------------+----------------------------------+ | Time Synchronization Parameter | Description | +==================================+==================================+ | PTP instance type | Identifies the requested PTP | | | instance type as described in | | | clause 5.27.1.4 of | | | TS 23.501 [2]. | +----------------------------------+----------------------------------+ | Transport protocol | Identifies the requested | | | transport protocol for PTP | | | instance as described in | | | clause 5.27.1.4 of | | | TS 23.501 [2]. This is | | | applicable for | | | IEEE Std 1588 [8] Boundary | | | Clock and Transparent Clock | | | operation. | +----------------------------------+----------------------------------+ | PTP Profile | Identifies the PTP profile for | | | the PTP instance as requested by | | | AF. | +----------------------------------+----------------------------------+ | Grandmaster enabled | Indicates whether the AF | | | requests the PTP instance in 5GS | | | to be able to act as a | | | grandmaster for PTP or gPTP | | | (depending on the requested PTP | | | instance type). | | | | | | This is applicable for | | | IEEE Std 1588 [8] Boundary | | | Clock or IEEE Std 802.1AS [7] | | | operation. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Grandmaster priority | Indicates a priority used as | | | defaultDS.priority1 when | | | generating Announce message when | | | 5GS acts as (g)PTP GM. | | | Applicable only if the | | | Grandmaster enabled = TRUE. If | | | omitted, the default value as | | | described in the PTP Profile is | | | used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Time Domain | (g)PTP domain of the PTP | | | instance as defined in | | | IEEE Std 1588 [8]. | +----------------------------------+----------------------------------+ | Temporal Validity Condition | Indicates start-time and | | | stop-time attributes that | | | describe the time period when | | | the time synchronization service | | | for a PTP instance is active. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Time synchronization error | Indicates the time | | budget | synchronization budget for the | | | time synchronization service (as | | | described in clause 5.27.1.9 of | | | TS 23.501 [2]). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Timing resiliency | Indicates whether the | | | synchronization service will be | | | used to provide timing | | | resiliency. | +----------------------------------+----------------------------------+ | >Assisted/Complement timing | Indicates whether Assisted | | method | timing or Complement timing is | | | used. | +----------------------------------+----------------------------------+ | >Type of timing information | Indicates which type of timing | | | information will be provided | | | (time, frequency, phase). | +----------------------------------+----------------------------------+ | >Required timing information | It provides the required phase | | accuracy | or frequency (according to type | | | of timing information specified) | | | accuracy compared to the UTC | | | phase or frequency (according to | | | type of timing information | | | specified). | +----------------------------------+----------------------------------+ | **For each PTP port in the PTP | | | instance** | | +----------------------------------+----------------------------------+ | Either UE identity (for a DS-TT | Identifies the UE/DS-TT which | | port), or \"N6 interface\" | the parameters below apply. \"N6 | | indication | interface\" indicates that the | | | parameters below apply to the N6 | | | interface. | | | | | | If the \"PTP port\" needs to be | | | identified, this field refers to | | | the UE identity (GPSI or SUPI). | | | | | | If the N6 termination needs to | | | be identified, then this field | | | indicates \"N6 interface\" flag, | | | instead of SUPI or GPSI. | +----------------------------------+----------------------------------+ | PTP enabled | TRUE/FALSE. This is used to set | | | the portDS.portEnable. If | | | omitted, the default value as | | | described in the PTP Profile is | | | used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Log Sync Interval | Specifies the mean time interval | | | between successive Sync | | | messages. This is applicable for | | | IEEE Std 1588 [8] Boundary | | | Clock or IEEE Std 802.1AS [7] | | | operation. If omitted, the | | | default value as described in | | | the PTP Profile is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Use management settable Log Sync | TRUE/FALSE. This is applicable | | Interval | if the PTP Profile is I | | | IEEE Std 802.1AS [7]. | | | | | | When set to FALSE, the Log Sync | | | Interval is used to set the | | | initialLogSyncInterval as | | | described in | | | IEEE Std 802.1AS [7]. When set | | | to TRUE, the Log Sync Interval | | | is used to set the | | | mgtSettableLogSyncInterval as | | | described in | | | IEEE Std 802.1AS [7]. | | | | | | If omitted, the default value as | | | described in the | | | IEEE Std 802.1AS [7] is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Log Announce Interval | Specifies the mean time interval | | | between successive Announce | | | messages. This is applicable for | | | IEEE Std 1588 [8] Boundary | | | Clock or IEEE Std 802.1AS [7] | | | operation. If omitted, the | | | default value as described in | | | the PTP Profile is used. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Use management settable Log | TRUE/FALSE. This is applicable | | Announce Interval | if the PTP Profile is | | | IEEE Std 802.1AS [7]. | | | | | | When set to FALSE, the Log | | | Announce Interval is used to set | | | the initialLogAnnounceInterval | | | as described in IEEE 802.1AS. | | | When set to TRUE, the Log | | | Announce Interval is used to set | | | the | | | mgtSettableLogAnnounceInterval | | | as described in | | | IEEE Std 802.1AS [7]. | | | | | | If omitted, the default value as | | | described in the | | | IEEE Std 802.1AS [7] is used. | | | | | | [optional] | +----------------------------------+----------------------------------+
Editor\'s note: The purpose of the timing resiliency parameters for (g)PTP-
based time synchronization is FFS.
The AF may use Nnef_TimeSynchronization_CapsSubscribe service operation as
described in clause 4.15.9.2 of TS 23.502 [3] to learn the UE capabilities for
time synchronization service. The Nnef_TimeSynchronization_CapsNotify service
operation indicates the list of UE identities, User-plane Node ID, and the
Subscription Correlation ID. The AF can use the Subscription Correlation ID
and the user-plane node ID received in the Nnef_TimeSynchronization_CapsNotify
service operation as a target of the Nnef_TimeSynchronization_ConfigCreate
request. The NEF uses the Subscription Correlation ID and user-plane node ID
to determine the list of UEs and list of AF-sessions to which the
Nnef_TimeSynchronization_ConfigCreate service operation is targeted to.
#### 6.14.3.2 Procedures for 5G access stratum time distribution
To procedures are presented as changes (underlined text) to clause 4.15.9.4 of
TS 23.502 [3], (taken from approved S2‑2203232) as follows:
\- The AF can use the procedure to activate, update or delete the 5G access
stratum time distribution for one UE or a group of UEs.
\- The AF may query the status of the 5G access stratum time distribution
using Nnef_ASTIGet service operation. The Nnef_ASTICreate and Nnef_ASTIUpdate
request may contain the parameters as described in Table 6.14.3.2-1.
Table 6.14.3.2-1: Description of 5G access stratum time distribution
parameters
+----------------------------------+----------------------------------+ | Parameter | Description | +==================================+==================================+ | 5G access stratum time | Indicates that the access | | distribution indication (enable, | stratum time distribution via Uu | | disable) | reference point should be | | | activated or deactivated for the | | | associated UE identities. | +----------------------------------+----------------------------------+ | Time synchronization error | Indicates the time | | budget | synchronization error budget for | | | the time synchronization service | | | (as described in clause 5.27.1.9 | | | of TS 23.501 [2]). | | | | | | [optional] | +----------------------------------+----------------------------------+ | Temporal Validity Condition | Indicates start-time and | | | stop-time attributes that | | | describe the time period when | | | the time synchronization service | | | is active. | | | | | | [optional] | +----------------------------------+----------------------------------+ | Timing resiliency | Indicates whether the | | | synchronization service will be | | | used to provide timing | | | resiliency. | +----------------------------------+----------------------------------+ | >Assisted/Complement timing | Indicates whether Assisted | | method | timing or Complement timing is | | | used. | +----------------------------------+----------------------------------+ | >Type of timing information | Indicates which type of timing | | | information will be provided | | | (frequency, phase). | +----------------------------------+----------------------------------+ | >Required timing information | It provides the required phase | | accuracy | or frequency accuracy (according | | | to type of timing information | | | specified) compared to the UTC | | | phase or frequency (according to | | | type of timing information | | | specified). | +----------------------------------+----------------------------------+
Figure 6.14.3.2-1: Management of 5G access stratum time information
1\. AM Policy Association establishment as described in clause 4.16.1 in TS
23.502 [3].
2\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
\- To create a new request, the AF provides access stratum time distribution
parameters to the NEF using the Nnef_ASTI_Create service operation (together
with the AF identifier and potentially further inputs as specified in table
6.14.3.2-1), including a target (one UE identified by SUPI or GPSI, a group of
UEs identified by an External Group Identifier. The NEF maps the External
Group Identifier to an Internal Group Identifier and any GPSI to a SUPI.
\- To update or remove an existing request, the AF invokes an Nnef_ASTI_Update
or Nnef_ASTI_Delete service operation providing the corresponding time
synchronization configuration id.
\- To query the status of the access stratum time distribution, the AF invokes
Nnef_ASTI_Get service operation providing the target (List of UE identities
(SUPI or GPSI)).
The AF that is part of operator\'s trust domain may invoke the services
directly with the TSCTSF.
NOTE 1: Steps 1 and 2 can occur in any order.
3\. (When the procedure is triggered by the AF request to influence the 5G
access stratum time distribution):
\- The NEF authorizes the request. After successful authorization, the NEF
invokes the Ntsctsf_ASTI_Create/Update/Delete/Get service operation with the
TSCTSF discovered and selected as described in clause 6.3.24 of TS 23.501 [2].
\- The TSCTSF determines whether the targeted UE is part of a PTP instance in
5GS, if so the TSCTSF rejects the request (steps 4-10 are skipped).
(When the procedure is triggered by PTP instance activation, modification, or
deactivation in the TSCTSF):
\- If time synchronization error budget is provided by the AF, the TSCTSF may
use the PTP port state of each DS-TT to determine an Uu time synchronization
error budget for corresponding SUPIs that are part of the PTP instance.
\- If time synchronization error budget is provided by the AF, the TSCTSF
calculates the Uu time synchronization error budget as described in clause
5.27.1.9 of TS 23.501 [2].
\- If frequency or phase accuracy compared to UTC phase or frequency
respectively, has been provided, the TSCTSF calculates the Uu accuracy value.
4\. If the AF request targets a group of UEs, the TSCTSF uses the Nudm_SDM_Get
request to retrieve the subscription information (SUPI list) from the UDM
using the Internal Group ID.
5\. The UDM provides the Nudm_SDM_Get response containing a SUPI list that
identifies UEs that belong to that group of UEs.
6\. The TSCTSF searches the PCF for the UE using Nbsf_Management_Subscribe
with a SUPI as an input parameter, indicating that it is searching for the PCF
that handles the AM Policy Association of the UE.
7\. The BSF provides to the TSCTSF the identity of the PCF for the UE for the
requested SUPI via an Nbsf_Management_Notify operation. If matching entries
already existed in the BSF when step 6 is performed, this shall be immediately
reported to the TSCTSF.
8\. The TSCTSF sends to the PCF for the UE its request for the AM policy of
the UE (identified by SUPI) using Npcf_AMPolicyAuthorization request,
containing the 5G access stratum time distribution indication (enable,
disable) and optionally the calculated Uu time synchronization error budget,
and the timing resiliency parameters (if provided), including the Uu frequency
or phase accuracy.
9\. If the PCF receives multiple time synchronization error budgets or
frequency/phase accuracy for a given UE, then the PCF picks the most stringent
budget or frequency/phase accuracy. The PCF takes a policy decision and then
the PCF may initiate an AM Policy Association Modification procedure for the
UE as described in clause 4.16.2.2 of TS 23.502 [3] to provide AMF the 5G
access stratum time distribution parameters. As part of this, the AMF shall,
if supported, send the 5G access stratum time distribution indication (enable,
disable) and the Uu time synchronization error budget and timing resiliency
parameters, when they are available, to an NG-RAN node using NGAP procedures
(e.g. UE Context Setup/Modification) specified of TS 38.413 [12]. The NG-RAN
node shall, if supported, store the information in the UE Context. Based on
this information, the NG-RAN node provides the 5GS access stratum timing to
the UE according to the Uu time synchronization error budget and timing
resiliency parameters as provided by the TSCTSF (if supported by UE and NG-
RAN).
NOTE 2: This release of the specification assumes that deployments ensure that
the targeted UEs and the NG-RAN nodes serving those UEs support Rel-17
propagation delay compensation as defined in TS 38.300 [13].
10\. The PCF of the UE replies to the TSCTSF with the result of
Npcf_AMPolicyAuthorization operation.
11\. The TSCTSF responds the AF with the Ntsctsf_ASTI_Create/Update/Delete/Get
service operation response.
12\. The NEF informs the AF about the result of the
Nnef_ASTI_Create/Update/Delete/Get service operation performed in step 2.
### 6.14.4 Impacts on services, entities and interfaces
AF:
\- Formulation of the AF request that may include parameters indicating
requirements for Timing Resiliency, assisted timing/complement timing and type
of timing information. These parameters are delivered to RAN.
NOTE: There can be implications regarding the provided frequency/phase
accuracy influencing the operation of (g)PTP (including correcting the content
of (g)PTP messages) and certain parameters (such as clockClass) in the
IEEE1588 data sets to be delivered to PMIC/BMIC. (g)PTP messages may not be
used (e.g. in the case of a frequency synchronization service, or because they
may not be needed when the level of accuracy is out of range), however (g)PTP
messages may be received and there might be the need to process them at the
DS-TT/NW-TT and update certain fields in the Announce messages.
Editor\'s note: The reasons to update Announce messages at DS-TT/NW-TT and how
to trigger this behaviour is FFS.
NG-RAN:
\- Supporting delivery of frequency and phase synchronization. There is no
expected impact to generate the frequency or phase synchronization, since
these are subsets of the time synchronization, e.g. no SIB need to be sent.
The phase/frequency can be extracted by client network (as defined in clause
6.14.1) using the SFNs of the regular radio signal, as long as this signal has
guaranteed performance and UTC traceability. gNB may receive requirement
parameters such as Timing Resiliency requirement, assisted/complement timing,
the timing information type to be delivered, and frequency/phase accuracy
compared to UTC frequency/phase respectively. This information enables NG-RAN
to determine if and how to provide 5G reference timing information to the UE
efficiently (i.e. RRC/SIB). How NG-RAN is using this information is up to RAN
implementation.
Editor\'s note: Details of RAN behaviour for phase/frequency sync, and related
to that the need for additional information to be sent to RAN to trigger such
behaviour is FFS.
TSCTSF:
\- Calculates the frequency/phase accuracy for the UE (Uu interface) and
transfers to NG-RAN via PCF, AMF.
## 6.15 Solution #15: Burst arrival time adaptation
### 6.15.1 Introduction
This solution enables the network to adjust the burst arrival time by
signalling positive or negative offset values (e.g. +3 ms) for UL scheduling
and DL scheduling to the AF so that the AF can adjust the burst sending time
accordingly.
### 6.15.2 Functional Description
This solution is based on the following principles:
\- For DL scheduling: refer to solution #2.
\- For UL scheduling: Upon reception of UL packets at UE from the application
on the UE or from the device connected to the UE, UE determines a relative
burst arrival time offset value in reference to the current Burst Arrival Time
experienced by UE (i.e. in reference to when UE currently receives bursts) and
the scheduling UL time slot at UE (e.g. in Configured Grants, as defined in TS
38.321 [11]). UE sends the time offset to RAN via RRC message when the time
offset value reaches the configured threshold, and NG-RAN sends the burst
arrival time offset value to SMF in the same way as for DL scheduling.
Alternatively, UE may send the preferred burst arrival time offset to SMF
using NAS SM signalling (providing the preferred time offset from UE AS layer
to NAS layer is UE implementation specific).
\- For downlink or uplink flows AF adapts the burst sending time based on the
received offset. When receiving the burst arrival time offset for uplink
flows, the AF determines the burst sending time by sending the offset to the
application on the UE or the devices connected to the UE for adaption via
application signalling.
### 6.15.3 Procedures
In addition to clause 6.2.3 in solution #2, RRC message or NAS SM message to
signal support of burst arrival time offset value from UE to RAN and/or UE to
SMF respectively.
### 6.15.4 Impacts on services, entities and interfaces
Besides the impacts documented in clause 6.2.4 of solution #2:
\- UE: Support of determining and signalling burst arrival time offset to RAN
via RRC message.
## 6.16 Solution #16: BAT adjustment during a QoS Flow setup or modification
This solution is merged into Solution 12.
### 6.16.1 Introduction
This solution enables the 5GC to adapt applications to the downstream
scheduling, and to upstream scheduling if necessary, in Uu reference point to
meet really low latency (e.g. 2 ms) requirement.
This solution makes the following assumptions:
\- NG-RAN can indicate an adjustment to the Burst Arrival Time (BAT offset) in
a response to QoS Flow establishment or modification request.
\- The solution builds upon Solution 10: 5GC acting as a CUC for CNC in TN;
Solution 10 is used to configure the underlay network in the TN for the
required traffic characteristics of the QoS Flow. This ensures that jitter in
the transport network in DL direction can be reduced and thus the accuracy of
the Burst Arrival Time for DL packets at the ingress of NG-RAN is improved.
\- The same assumptions as in Solution 10 apply.
### 6.16.2 Functional Description
The solution is based on the architecture in Figure 6.16.2-1:
Figure 6.16.2-1: Architecture to support adaptation to the upstream /
downstream scheduling
\- The solution supports deployments with and without external TSN network:
a) When integration with IEEE TSN applies: In addition what is described in
Solution 10, this solution provides Burst Arrival Time (BAT) offset for DL
direction from NG-RAN via SMF and PCF to the TSN AF. TSN AF can act as a CUC
towards the CUC in external TSN network and provide the BAT offset as feedback
to the external TSN network. The CUC then controls the CNC in external TSN
network and adjusts the TSN streams accordingly.
b) When integration with IEEE TSN does not apply: In addition to what is
described in Solution 10, this solution provides Burst Arrival Time (BAT)
offset for DL direction from NG-RAN via SMF and PCF to the AF. The AF can then
adjust the data streams accordingly by means that are out of scope of 3GPP.
\- As described in Solution 10, Transport Network deploys a CNC that can be
controlled by a CUC residing in the 5GC via the procedures specified in IEEE
P802.1Qdj [10]. In addition what is described in Solution 10, this solution
can provide an adjusted BAT for both UL and DL directions to the Transport
Network, based on the feedback received from the NG-RAN.
### 6.16.3 Procedures
The figure 6.16.3-1 describes the overall procedure how QoS Flows are
established with the solution.
Figure 6.16.3-1: Overview of the QoS Flow establishment
1\. [No changes to Solution 10]: PCF receives the Policy Authorization service
request from the AF/NEF/TSCTSF. The PCF composes the PCC Rules as specified in
Release 17. PCF includes the TSCAC in the request when it invokes the SMF.
2\. [No changes to Solution 10]: SMF receives the PCC Rules from the PCF. The
SMF binds the PCC rule to a QoS Flow.
3\. [No changes to Solution 10]: SMF indicates N4 rules for a QoS Flow to the
UPF. The UPF assigns the CN tunnel endpoint address. The SMF determines a
dynamic value for the CN PDB, based on the UPF and NG-RAN of the PDU Session.
4\. As described in Solution 10, the SMF provides the QoS profile for the QoS
Flow to the NG-RAN. The SMF signals the dynamic value for the CN PDB for the
QoS Flow to NG-RAN. NG-RAN assigns the AN tunnel endpoint address.
As described in Solution 10, upon receiving the TSCAI for a QoS Flow from the
SMF, if the TSCAI includes a BAT in UL direction, the RAN determines the
corresponding BAT offset in UL direction at the gNB egress. The NG-RAN
provides the value to the SMF in a response. As an enhancement to Solution 10,
when the NG-RAN provides the offset value to SMF, the NG-RAN may adjust the
offset value based on the upstream scheduling in Uu reference point.
As an enhancement to Solution 10, if the NG-RAN determines a need to adjust
the Burst Arrival Time for DL direction to adapt the applications to the
downstream scheduling in Uu reference point, NG-RAN includes a BAT offset for
DL direction in the response to the SMF.
BAT offset is relative to the BAT value in corresponding direction NG-RAN has
received from the SMF in TSCAI. BAT offset can take positive or negative
values.
5\. After the SMF has setup a QoS Flow between UPF and NG-RAN, if the NG-RAN
indicated a BAT offset for UL or DL direction to the SMF, the SMF deducts the
received BAT offset from the BAT in UL or DL direction, respectively, that the
SMF has received in the TSCAI for the given QoS Flow, and indicates the
resulted new BAT value(s) to the Transport Network using the procedure as
described in Solution 10.
The SMF provides the BAT offset values in UL and DL direction (if available)
to NEF/AF or TSN AF via PCF. When integration with IEEE TSN applies, TSN AF
can act as a CUC towards the CUC in external TSN network and provide the BAT
offset as feedback to the external TSN network. The CUC then controls the CNC
in external TSN network and adjusts the TSN streams accordingly.
Editor\'s note: Typically for TSN flows there would be already an external
CUC. Whether CNC can handle two CUCs for the same flows is FFS. Whether CNC
can replan TSN flows after they have started is FFS.
When integration with IEEE TSN does not apply, the BAT offset values are
provided to the AF, and the AF can then adjust the data streams accordingly by
means that are out of scope of 3GPP.
### 6.16.4 Impacts on services, entities and interfaces
The same impacts as in Solution 10: 5GC acting as a CUC for CNC in TN. In
addition, the following impacts are caused by this solution:
SMF:
\- If the NG-RAN indicates a BAT offset for UL or DL direction to the SMF in a
response to the QoS Flow establishment or modification request, the SMF
deducts the received BAT offset from the current BAT in UL or DL direction,
respectively, in the TSCAI for the given QoS Flow, and indicates the resulted
new BAT value(s) to the Transport Network using the procedure as described in
Solution 10.
NG-RAN:
\- Determines a BAT offset in UL direction, based on the BAT in UL direction
the NG-RAN receives from the SMF in TSCAI and the upstream scheduling in Uu
reference point.
\- Determines a BAT offset in DL direction, based on the BAT in DL direction
the NG-RAN receives from the SMF in TSCAI and the downstream scheduling in Uu
reference point.
\- Provides the BAT offset values to the SMF in a response to the QoS Flow
establishment or modification request.
## 6.17 Solution #17: DS-TT and NW-TT assisted 5GS synchronization error
detection
### 6.17.1 Introduction
The solution is proposed to solve Key Issue #1 for the object: \"Study how RAN
and 5GC learn about 5GS network timing synchronization status\" and can be
used by the other solutions.
This solution addresses the following scenarios:
\- 5GS is acting as Bridge to distribute time information to UEs using PTP or
gPTP, as defined in clause 5.27.1.7 of TS 23.501 [2].
\- The NG-RAN node is not able to detect the 5GS timing synchronization error
due to implementation limits.
Editor\'s note: It is FFS whether scenarios exist where the NG-RAN node cannot
detect the 5GS timing synchronization error by itself.
This solution has the following assumptions:
\- The UE/DS-TT, NG-RAN, UPF/NW-TT are synchronized with the 5G GM (i.e. the
5G internal system clock) as specified in TS 23.501 [2] and TS 38.331 [5].
\- The UE/DS-TT and UPF/NW-TT handle the (g)PTP messages by making
timestamping according to 5G GM as specified in clause 5.27.1.2.2 of TS 23.501
[2].
\- The DS-TT and NW-TT can detect (g)PTP timing synchronization error by
comparing the (g)PTP clock and 5G GM clock.
\- If 5G GM degradation occurs, there is timing error when calculating the
residence time in 5GS according to 5G GM timestamping. Then DS-TT or NW-TT can
detect the (g)PTP time sync error.
Editor\'s note: How DS-TT or NW-TT can detect time synch error is FFS.
### 6.17.2 Functional Description
The solution is based on the following principles:
\- The AF/NEF subscribes the time synchronization status notification from
TSCTSF.
\- TSCTSF subscribes for time synchronization status information report from
NW-TT and DS-TT via PMIC/UMIC (i.e. the status of the synchronization of the
PTP GM in NW-TT and DS-TT):
\- When receiving the (g)PTP time synchronization signals, the DS-TT/NW-TT can
detect the (g)PTP time synchronization offset between the (g)PTP local clock
(i.e. the clock maintained by the device locally) and the (g)PTP clock
calculated according to the time synchronization signal. If the (g)PTP time
synchronization offset exceeds the configured threshold and the jitter of the
time synchronization offset between the (g)PTP local clock and 5GS internal
local clock does not exceed jitter threshold, DS-TT/NW-TT can decide that
there is a timing synchronization error (i.e. Timing Sync Signal is not
correct). If the time synchronization offset and the jitter both exceed their
thresholds, DS-TT/NW-TT can decide that the (g)PTP local clock should be
adjusted according to the time synchronization signal as in this case it can
be assumed there is an error in the (g)PTP local clock.
Editor\'s note: How DS-TT and NW-TT can decide that there is a timing
synchronization error only based on observing an offset between their local
clock and the time reported in (g)PTP is FFS.
\- If TSCTSF has subscribed the status report, the NW-TT and DS-TT reports
(g)PTP timing synchronization status information to TSCTSF via PMIC/UMIC.
\- When TSCTSF receives the (g)PTP time synchronization status information, it
determines whether the (g)PTP synchronization error occurs in the ingress port
of the (g)PTP domain or 5G GM synchronization error occurs in the serving RAN:
\- The TSCTSF can determine the affected UE according to the time domain (for
(g)PTP synchronization error) or the UE\'s RAN information (for 5G GM
synchronization error).
### 6.17.3 Procedures
The exchange of PMIC/UMIC between TSCTSF and DS-TT/NW-TT is specified in
clause 5.28.3 of TS 23.501 [2]. The enhancement is that DS-TT and NW-TT should
report the (g)PTP timing synchronization status to TSCTSF via PMIC/UMIC.
TSCTSF can determine the time synchronization error according to the (g)PTP
timing synchronization status information as following:
\- Case A: Both DS-TT (maybe multiple DS-TTs belonging to the same time
domain) and NW-TT report the (g)PTP timing synchronization error. TSCTSF can
determine that the (g)PTP synchronization error occurs in the ingress port of
the (g)PTP domain.
\- Case B: Only DS-TT(s) or NW-TT reports the (g)PTP timing synchronization
error (normally the egress port reports the timing synchronization error,
while the ingress port does not). TSCTSF can determine that the (g)PTP timing
synchronization error is caused by 5G GM synchronization error in the RAN
serving the DS-TT related UE.
TSCTSF may subscribe to the AMF to get the serving RAN of the UE(s) to
determine the affected UE(s).
### 6.17.4 Impacts on services, entities and interfaces
DS-TT:
\- Support reporting the (g)PTP timing synchronization status information to
TSCTSF via PMIC
TSCTSF:
\- Receive (g)PTP time synchronization status information report from DS-TT
and NW-TT and decide time synchronization error as above.
NW-TT:
\- Report (g)PTP GM timing synchronization status information to TSCTSF via
PMIC/UMIC.
## 6.18 Solution #18: Subscription based control of time synchronization
service
### 6.18.1 Introduction
This solution is proposed to solve Key Issue #3: Support for controlling 5G
time synchronization service based on subscription. In this Key Issue, the
time synchronization service scenarios already supported in 5G Release-17 and
Release-16 based on access stratum or (g)PTP time distribution methods are
addressed.
### 6.18.2 Functional Description
The solution is based on the following principles:
\- UE subscription data types stored in the UDM are extended to include two
new data structures related to time synchronization service:
\- The \"Access and Mobility Subscription data\" is extended with the
following field:
\- Access Stratum Time Synchronization Service Authorization:
\- Indication whether the UE is authorized to receive RTI reception via RRC
dedicated signalling Note this field applies to the gNB using dedicated RRC
signalling to disseminate access stratum time information to the UE.
\- (Optionally) Uu time synchronization error budget
\- (Optionally) Start and stop time defining active times of Access Stratum
Time Synchronization Service for the UE. Start and stop times do not include
the date information
\- (Optionally) Coverage Area: defining a list of TAs where the ASTI-based
time synchronization is available for the UE.
\- The AMF retrieves \"Access Stratum Time Synchronization Service
Authorization\" in the UDM when the UE registers with the 5GS. If \"Access
Stratum Time Synchronization Service Authorization\" is available, the AMF
configures the access stratum time distribution information at the NG-RAN
accordingly using Rel-17 NGAP signalling.
\- The TSCTSF may retrieve \"Access Stratum Time Synchronization Service
Authorization\" in the UDM for getting the UE\'s subscribed Uu time
synchronization error budget. The TSCTSF should not configure the Uu time
synchronization error budget to the NG-RAN exceeding the value in the UDM.
\- A new subscription data \"Time Synchronization Subscription data\" with the
following fields:
1) AF request Authorization:
\- Indicates whether the UE is authorized for an AF-requested time
synchronization services (either (g)PTP based or ASTI based).
2) The \"Time Synchronization Service Authorization\":
\- One or more Subscribed time synchronization service ID(s): Provides
reference to a PTP configuration pre-configured at the TSCTSF (i.e.
DNN/S-NSSAI, PTP instance configuration within the 5GS, including e.g. PTP
profile, PTP domain, etc.).
3) (Optionally) Start and stop times defining active times of Time
Synchronization Service for the UE. Start and stop time do not include the
date information.
4) (Optionally) Coverage Area: defining a list of TAs where the (g)PTP-based
time synchronization is available for the UEs in the PTP instance.
5) Access Stratum Time Synchronization Service Authorization:
\- Indication whether the UE is authorized to receive RTI reception via RRC
dedicated signalling
NOTE: This field applies to the gNB using dedicated RRC signalling to
disseminate access stratum time information to the UE.
\- (Optionally) Uu time synchronization error budget
\- For (g)PTP time distribution method, the TSCTSF accesses Time
Synchronization Subscription data in the UDM and based on the subscription
data, the TSCTSF may enable/disable time synchronization configuration for the
UE with or without an AF request for the service. The trigger for the TSCTSF
to retrieve this subscription data from the UDM is the notification from the
PCF that a UE has established a PDU Session for a specific DNN/S-NSSAI (based
on the PCF using Npcf_PolicyAuthorization_Notify service operation).
\- For access stratum time distribution method with AF request, the TSCTSF
retrieves Time Synchronization Subscription data available at the UDM and
checks if the AF is allowed to request access stratum time synchronization as
a service or not.
\- The configuration of access stratum time distribution for a UE via Access
Stratum Time Synchronization Service Authorization in the Access and Mobility
Subscription data or AF request is assumed to mutually exclusive meaning that
the AF is not allowed to modify the 5GS access stratum time distribution
parameters if the UE is authorized to receive RTI according to the \"Access
and Mobility Subscription data\". This is enforced by the AMF.
\- The configuration of access stratum time distribution for a UE via Access
Stratum Time Synchronization Service Authorization in the Time Synchronization
Subscription data and Access and Mobility Subscription data simultaneously is
considered as a configuration error.
\- Access Stratum Time Synchronization Service Authorization and Time
Synchronization Subscription Data is stored at the UDR. The UDM retrieves this
subscription data from the UDR for other NFs to access it.
\- For (g)PTP time distribution method, the TSCTSF may modify the PTP instance
configuration by means of sending a PMIC to the impacted UE/DS-TT and UMIC to
the UPF/NW-TT, as described in clause K.2.2 of TS 23.501 [2].
\- For access stratum time distribution method, if AMF receives Access Stratum
Time Synchronization Service Authorization from UDM, then AMF provides 5G
access stratum time distribution indication and Uu time synchronization error
budget (if part of the Access Stratum Time Synchronization Service
Authorization received from the UDM) to NG-RAN.
### 6.18.3 Procedures
#### 6.18.3.1 Procedure for subscription based control of access stratum time
synchronization service without AF request
An overall procedure for subscription based control of access stratum time
synchronization service without AF request for time synchronization is
illustrated in Figure 6.18.3.1-1.
Figure 6.18.3.1-1: Subscription based control of access stratum time
synchronization service
1\. The UE performs the registration procedure with the 5GS.
2\. While the registration procedure is configured, the AMF retrieves the UE
subscription data stored at the UDM as described in step 14b in clause
4.2.2.2. in TS 23.502 [3].
3\. If Access Stratum Time Synchronization Service Authorization is available
at the UDM, the UDM provides it to the AMF. Optionally, if a valid start and
stop time for time synchronization are included in the UE subscription data,
the AMF should enable the ASTI time synchronization service only during this
time period.
4\. If the AMF receives Access Stratum Time Synchronization Service
Authorization from the UDM in step 3, the AMF may subscribe to notifications
for updates at the UDM. Optionally, if a valid geographical area for time
synchronization is included in the UE subscription data, the AMF tracks the
UE\'s location to determine the UE\'s presence (i.e. in or out of the
subscribed \" valid geographic area\"). If the UE location is out of the \"
valid geographic area\", the AMF determines not to activate ASTI time
synchronization service for the UE.
If the Access Stratum Time Synchronization Service Authorization contains a
Coverage Area, the AMF subscribes for the UE mobility events locally.
5\. When the AMF is setting up or modifying the UE Context in the NG-RAN and
AMF has received Access Stratum Time Synchronization Service Authorization
from the UDM, then AMF provides access stratum attributes to NG-RAN via N2
message (5G access stratum time distribution indication and Uu time
synchronization error budget). If Uu time synchronization error budget is not
part of the Access Stratum Time Synchronization Service Authorization received
from the UDM then AMF may send to NG-RAN a Uu time synchronization error
budget based on a default pre-configured default value.
The registration procedure continues as described in TS 23.502 [3].
If the Access Stratum Time Synchronization Service Authorization contains
Start and stop times, the AMF enables and disables the 5G access stratum time
distribution indication to the NG-RAN according to the expiry of start and
stop times.
If the Access Stratum Time Synchronization Service Authorization contains
Coverage Area, the AMF enables and disables the 5G access stratum time
distribution indication to the NG-RAN when the UE moves inside or outside of
the Coverage Area, respectively.
#### 6.18.3.2 Procedure for subscription based control of access stratum time
synchronization service with AF request
An overall procedure for subscription based control of access stratum time
synchronization service with asynchronous reception of an AF request for ASTI
service is illustrated in Figure 6.18.3.2-1.
Figure 6.18.3.2-1: Subscription based control of access stratum time
synchronization service with AF request
1\. The AF request to influence the 5G access stratum time distribution.
2\. The TSCSTF retrieves Time Synchronization Subscription Data available at
the UDM:
3\. The TSCTSF determines if the AF is allowed to request ASTI service. If
authorized, the TSCTSF proceeds with ASTI service configuration. Otherwise, if
the AF is not authorized, steps 4-7 are skipped.
4\. The TSCTSF sends to the PCF for the UE its request to update the AM policy
of the UE (identified by SUPI) containing the 5G access stratum time
distribution indication (enable, disable) and optionally the calculated Uu
time synchronization error budget (if available).
5\. The PCF takes a policy decision and then the PCF may initiate an AM Policy
Association Modification procedure for the UE as described in clause 4.16.2.2
of TS 23.502 [3] to provide AMF the 5G access stratum time distribution
parameters. The PCF includes a Policy Control Request Trigger for the 5G
access stratum time distribution into the request.
6\. The AMF sends the 5G access stratum time distribution indication (enable,
disable) and the Uu time synchronization error budget (if available) to the
NG-RAN via N2 signalling.
If the AMF has received Access Stratum Time Synchronization Service
Authorization from the UDM as described in clause 6.18.3.1, the AMF ignores
the 5G access stratum time distribution parameters received from the PCF. If
the PCF included a Policy Control Request Trigger for the 5G access stratum
time distribution into the request in step 5, the AMF initiates AM Policy
Association Modification procedure for the UE as described in TS 23.502 [3]
clause 4.16.2.1, indicating the 5G access stratum time distribution parameters
as stored in the Access Stratum Time Synchronization Service Authorization.
7\. The PCF of the UE replies to the TSCTSF with the result of
Npcf_AMPolicyAuthorization operation.
8\. The TSCTSF responds the AF with the Ntsctsf_ASTI_Create service operation
response.
#### 6.18.3.3 Procedure for subscription based control of (g)PTP time
synchronization service without AF request
An overall procedure for subscription based control of (g)PTP time
synchronization service without AF request is illustrated in Figure
6.18.3.3-1.
Figure 6.18.3.3-1: Subscription based control of (g)PTP time synchronization
service without AF request
1\. The UE performs the UE-requested PDU Session Establishment for data
establishing connectivity.
2\. The PCF determines if the PDU Session is potentially impacted by time
synchronization service and invokes Npcf_PolicyAuthorization_Notify service
operation to the TSCTSF discovered and selected for time synchronization to
indicate there is a UE connected to a specific DNN/S-NSSAI configured for
(g)PTP services.
3\. The TSCSTF uses the SUPI to retrieve the Time Synchronization Subscription
Data available at the UDM.
4\. If the Time Synchronization Subscription Data contains:
a) one or more Subscribed Time Synchronization Service ID(s) that can be
mapped to PTP instance configuration(s), the TSCTSF determines if one or more
of the PTP instance configurations match with the DNN/S-NSSAI of the given PDU
Session. The TSCTSF assumes that the time-synchronization service cannot be
controlled by an AF for the given SUPI.
b) An indication that an AF-requested (g)PTP time synchronization service is
allowed for the given UE and DNN/S-NSSAI, the TSCTSF adds the given SUPI to
the list of SUPIs for which the time-synchronization service can be controlled
by an AF.
c) If TSCTSF receives neither a) nor b), the TSCTSF assumes that the time-
synchronization service cannot be controlled by an AF for the given SUPI. The
TSCTSF releases the AF-session with the PCF.
5\. For each matching PTP instance configuration determined in step 4, if no
PTP instance exists for the given PTP instance configuration, the TSCTSF
initializes the PTP instance in 5GS as described in clause K.2.2 of TS 23.501
[2]. The TSCTSF configures a PTP port in DS-TT and adds it to the
corresponding PTP instance in NW-TT as described in clause K.2.2 of TS 23.501
[2].
If the Time Synchronization Subscription data for the UE in UDR contains start
and stop times, the TSCTSF sets a timer for the expiration of start and stop
time. Upon expiry of start time, the TSCTSF adds the PTP port in DS-TT to the
corresponding PTP instance. Upon expiry of stop time, the TSCTSF temporarily
removes the PTP port in DS-TT from the corresponding PTP instance.
If the Time Synchronization Subscription data for the UE in UDR contains
Coverage Area, the TSCTSF subscribes to UE\'s presence in Area of Interest at
the discovered AMF(s) in similar manner as concluded for KI#2. When the TSCTSF
determines that the UE has moved inside or outside of the Coverage Area, the
TSCTSF adds or temporarily removes the PTP port in DS-TT from the
corresponding PTP instance, in similar manner as concluded for KI#2.
#### 6.18.3.4 Procedure for (g)PTP time synchronization service with AF
request
An overall procedure for (g)PTP time synchronization service with AF request.
Steps 1 to 4 below are illustrated in figure 6.18.3.3-1.
1\. The UE performs the UE-requested PDU Session Establishment for data
establishing connectivity.
2\. Upon PDU Session establishment, the PCF determines if the PDU Session is
potentially impacted by time synchronization service and invokes
Npcf_PolicyAuthorization_Notify with the TSCTSF as configured in the PCF. The
TSCTSF setups an AF-session with the PCF as described in clause 4.15.9.2 of TS
23.502 [3].
3\. The TSCSTF uses the SUPI to retrieve the Time Synchronization Subscription
Data available at the UDM.
4\. If the Time Synchronization Subscription Data contains:
a) one or more Subscribed Time Synchronization Service ID(s) that can be
mapped to PTP instance configuration(s), the TSCTSF determines if one or more
of the PTP instance configurations match with the DNN/S-NSSAI of the given PDU
Session. In this case, for each such PTP instance configuration, if no PTP
instance exists for the given PTP instance configuration, the TSCTSF
initializes the PTP instance in 5GS as described in clause K.2.2 of TS 23.501
[2]. The TSCTSF configures a PTP port in DS-TT and adds it to the
corresponding PTP instance in NW-TT as described in clause K.2.2 of TS 23.501
[2]. The TSCTSF assumes that the time-synchronization service cannot be
controlled by an AF for the given SUPI.
b) An indication that an AF-requested (g)PTP time synchronization service is
allowed for the given UE and DNN/S-NSSAI, the TSCTSF adds the given SUPI to
the list of SUPIs for which the time-synchronization service can be controlled
by an AF.
c) If TSCTSF receives neither a) nor b), the TSCTSF assumes that the time-
synchronization service cannot be controlled by an AF for the given SUPI. The
TSCTSF releases the AF-session with the PCF.
5\. Based on received subscription data in step 4, the TSCTSF determines that
the UE is authorized for the service, and the TSCTSF proceeds with rest of the
procedure as described in clause 4.15.9.2 of TS 23.502 [3].
When the TSCTSF receives Ntsctsf_TimeSynchronization_CapsSubscribe service
operation from the AF, the TSCTSF determines the matching AF-session(s) as
described in clause 4.15.9.2 of TS 23.502 [3]. If the UE is not authorized for
the service for the given DNN/S-NSSAI in the UDM, the TSCTSF does not consider
the AF-session as matching. This implies that the time synchronization
capability event notification does not list any of the SUPIs that cannot be
controlled by an AF.
### 6.18.4 Impacts on services, entities and interfaces
UDR:
\- Storage and retrieval of Time Synchronization Subscription Data by the UDM.
UDM:
\- Time Synchronization Subscription Data and Access Stratum Time
Synchronization Service Authorization fields management.
AMF:
\- Receive Access Stratum Time Synchronization Service Authorization from UDM.
\- Provide access stratum time distribution indication and Uu time
synchronization error budget to RAN based on Access Stratum Time
Synchronization Service Authorization received from UDM.
\- Manage timers for start and stop times as indicated by the start and stop
times in the Access Stratum Time Synchronization Service Authorization.
\- Enables and disables the 5G access stratum time distribution for the UE
based on the UE location and Coverage Area in the Access Stratum Time
Synchronization Service Authorization.
TSCTSF:
\- Time synchronization service configuration (i.e. ASTI and/or (g)PTP time
distribution) based on UE\'s Time Synchronization Subscription Data.
\- Manages the Coverage Area in the Time Synchronization Subscription Data in
the same way as if it was received from the AF as concluded in KI#2.
\- Subscription to Time Synchronization Subscription Data at the UDM.
## 6.19 Solution 19: Support for controlling 5G time synchronization service
based on subscription
### 6.19.1 Introduction
The solution enables the operator to control time synchronization service
based on UE subscription for time critical services management.
### 6.19.2 General description
The following assumptions are made:
\- For specific UEs which the holdover capability is not supported or
supported badly, the operator should provide them reference time information
continuously.
\- UE subscription should be taken into account when TSCTSF chooses a time
information provider in 5GS. The subscription data may include time
synchronization enable parameters or timing resiliency services parameters.
According to the subscription data, TSCTSF can determinate whether and which
timing source to provide timing synchronization service.
\- UEs get time synchronization service by receiving 5GS access stratum time
or time-synchronized UPF/NW-TT. 5G GM may have different sources of
time/frequency like GNSS signal, Synchronous Ethernet (Sync E), PTP transport
network, PPS input, etc. Besides, 5G GM may collocate with UPF or RAN, not
limited with the deployment.
Following are the principles for the solution:
\- In order to provide continuous time synchronization service for targeted
UEs, 5GC should be informed if the time synchronization status of those UEs
change. The time status changes can be resulted from some unexpected cases,
e.g. time sources failure or UE mobility.
\- The AF could send a request to TSCTSF (directly or via NEF) to control the
(g)PTP time synchronization service and may target to a set of AF-sessions
with a UE or multiple UE(s). In addition, the AF may request time
synchronization distribution method, such as a Boundary Clock, peer-to-peer
Transparent Clock, or end-to-end Transparent Clock or as s PTP relay instance.
For all the AF-request, TSCTSF should check targeted UE(s) subscription data
from the UDM first before it invokes time synchronization service. If
necessary, the SMF would check the per UE subscription data again when PDU
session establishment.
\- The AF may request to use the 5G access stratum timing information for
UE(s) or the attached DS-TT(s). When TSCTSF receives the request, it should
get the targeted UE subscription data from the UDM to authorize the request.
If needed, the AMF is responsible to check the per UE subscription data when
it controls 5G-AN to provide 5G access stratum timing information.
\- A trusted AF can request a stringent/resilient time synchronization service
for targeted UEs or DS-TTs if the UEs subscription supports.
\- Time service parameters can be included in the UE subscription data:
a) Authorized time synchronization method: access stratum, gPTP, or both;
b) One or multiple authorized Uu error budget: e.g. 1us, 250ns, or other
values. Multiple authorized Uu error budgets allows 5G network to select a
certain Uu error budget, based on AF request. The enforced Uu error budget
should not exceed the most stringent value.
### 6.19.3 Procedures
Below is the flow chart for AF requesting time synchronization service for
targeted UE.
#### 6.19.3.1 AF requesting time synchronization service for targeted UE
Procedures of AF requesting time synchronization service for targeted UE are
shown:
Figure 6.19.3-1: AF requesting time synchronization service based on
subscription
0\. UDM subscription data may include a new subscription type for time
synchronization service or timing resiliency service. The subscription data
indicates whether or not the UE support time synchronization service or timing
resiliency services. The subscription data may also include 5GS clock
properties, e.g. clock class, accuracy, etc. to reflect the possible selection
of clock source e.g. during GNSS unavailability.
1\. AF request for time synchronization service for the UE.
2\. When receiving the time synchronization request for the UE, the TSCTSF
will check with UDM, whether and what information the UE has the subscription
for time synchronization service. The time service parameter of UE
subscription data refers to the above description.
3\. TSCTSF determinates a suitable time source to provide time synchronization
service for the UE if the subscription data is satisfied.
4\. TSCTSF may sends the determinate information (with 5GS clock properties
including e.g. clock class, accuracy information) to UPF for time
synchronization service, UPF initiates PTP or gPTP based distribution to the
UE to provide timing synchronization. Or TSCTSF may send the determinate
information to RAN for time synchronization service, RAN initiates access
stratum distribution to the UE to provide timing synchronization.
### 6.19.4 Impacts on services, entities and interfaces
TSCTSF:
\- Update the 5G time distribution indication based on UE subscription.
\- Authorize time synchronization service request based on UE subscription.
\- Providing time synchronization service based on UE subscription.
\- Determining a suitable 5G timing source to provide time synchronization
service for the UE.
AMF:
\- Support to forward UE time synchronization service to targeted TSCTSF.
UDM:
\- Support to perform the storage of UE Subscription data including time
synchronization parameters or timing resiliency parameters.
## 6.20 Solution #20: NG-RAN acting as CUC towards CNC of the N3 transport
network
### 6.20.1 Introduction
Key idea of this solution is that NG-RAN acts as CUC towards the CNC of the N3
transport network.
### 6.20.2 Functional Description
The solution is based on the architecture in Figure 6.20.2-1:
Figure 6.20.2-1: NG-RAN acting as CUC towards CNC of the N3 transport network
Editor\'s note: The consequence of collocating CUC with a single gNB is FFS.
The solution is based on the following principles:
\- If NG-RAN receives a QoS Flow description from the SMF, which includes a
TSCAI:
NG-RAN derives a stream identification description based on the NG-RAN and UPF
tunnel end point addresses and ports and traffic requirements/characteristics
based on the QoS profile, TSCAI information and the CN PDB.
\- RAN (acting as a CUC), provides the stream identification/requirements to
the transport network CNC.
\- If the QoS flow description with TSCAI is removed by the SMF or if the UE
context is removed in the RAN (e.g. when the UE enters Idle or when the UE
relocates to a different RAN node), then RAN (acting as CUC) removes the
previously provided stream identification/requirements from the transport
network\'s CNC.
NOTE 1: To enable the transport network to distinguish QoS flows, this
solution assumes that separate tunnel end-point addresses are used for the N3
tunnels for QoS flows, which include a TSCAI (SMF can instruct RAN and UPF to
do so). Use of IPv6 addresses can ensure that sufficient addresses are
available.
NOTE 2: This solution does not assume support of talker/listener functionality
to be supported by RAN and UPF.
NOTE 3: Whether the above needs to be standardized or can be left as an option
for RAN implementation can be determined in coordination with RAN WG3.
### 6.20.3 Procedures
Existing procedures are reused.
### 6.20.4 Impacts on services, entities and interfaces
NG-RAN:
\- For QoS flows for which SMF provides TSCAI, derive a stream identification
based on NG-RAN/UPF tunnel end point addresses and ports and traffic
requirements/characteristics based on the QoS profile, TSCAI information and
the CN PDB.
\- Provide stream requirements to transport network CNC.
\- Allocate separate tunnel end-point destination addresses per QoS Flow (for
QoS flows with TSCAI) used for the N3 tunnels (existing functionality).
UPF:
\- Allocate separate tunnel end-point destination addresses per QoS Flow (for
QoS flows with TSCAI) used for the N3 tunnels (existing functionality).
SMF:
\- Instruct the NG-RAN and UPF to allocate separate tunnel end-point
destination addresses per QoS Flow (for QoS flows with TSCAI) used for the N3
tunnels using existing NGAP and existing N4 signalling.
## 6.21 Solution #21: BAT adjustment by TSNCF to TSN in the transport network
### 6.21.1 Introduction
This solution enables the 5GS to adapt downstream scheduling in order for 5GS
to meet really low latency (e.g. 2ms) requirement. This solution also can be
used for the UL stream scheduling.
This solution makes the following assumptions:
\- There is TSN deployed in the transport network.
\- This solution builds on the top of solution 11.
### 6.21.2 Functional Description
The solution is based on the architecture in Figure 6.11.2-1 of solution 11.
The solution is based on the following principles:
\- When the NG-RAN receives the TSCAI during Qos flow
establishment/modification, it detects there is a need for adjustment to the
Burst Arrival Time (i.e. offset to the BAT).
\- The NG-RAN indicate the BAT offset to TSNCF/CUC in the response.
\- The TSNCF calculate the Talker/Listener status according to the BAT offset
and stream information. The TSNCF uses the procedures described in Solution 11
to communicate with the NG-TT, TNW-TT and CNC.
NOTE: Whether TSNCF can enforce a negative BAT offset depends on whether the
TSN in the transport network can achieve the delay, i.e. CN-PDB -- BAT offset
\- After the TSNCF/CUC receives the configuration from CNC, the TSNCF update
the TSCAC and send it to SMF.
\- The SMF update the TSCAI and send to NG-RAN/UPF.
### 6.21.3 Procedures
The procedure in Figure 6.11.3-1 is re-used with following enhancement:
Figure 6.21.3-1: (Figure 6.11.3-1)
8\. NG-RAN detect the offset to the BAT is needed. The NG-RAN send the offset
and stream information to AMF.
9-12. The BAT offset is sent to TSNCF.
13\. The TSNCF calculate the Talker/Listener status according to the BAT
offset and stream information.
14-15. TSNCF/CUC receives the configuration from CNC, the TSNCF sends the
stream configuration to NG-TT and TNW-TT in the PMIC/UMIC as described in
Solution 11 and updates the TSCAC and sends it to SMF with the configuration.
NOTE: Update the TSCAC is to make TSCAI is align with the stream configuration
from TSN CNC in the NG-RAN.
Editor\'s note: It is FFS whether updating the TSCAC is necessary because the
stream configuration that is sent to NG-TT via PMIC contains the same timing
information.
17-18. The SMF updates the TSCAI. And send the TSCAI and configuration to the
NG-RAN.
### 6.21.4 Impacts on services, entities and interfaces
In addition to the impacts in sol#11, the following impacts are caused by this
solution:
NG-RAN:
\- Determines a BAT offset for UL/DL traffic according to TSCAI.
\- Provides the BAT offset values to the TSNCF in a response to the QoS Flow
establishment or modification request.
TSNCF:
\- The TSNCF calculate the Talker/Listener status according to the BAT offset
and stream information.
\- After the TSNCF/CUC receives the configuration from CNC, the TSNCF update
the TSCAC and send it to SMF.
## 6.22 Solution #22: Transmission opportunities exposure
### 6.22.1 Introduction
This solution enables the RAN to provide to an AF some details on DL
transmission opportunities, so that the AF can adapt its transmissions times
to minimise end-to end delays.
The solution addresses the following scenario: Adapting downstream scheduling
based on RAN feedback for low latency communication.
The solution addresses also the enhancement of transmissions delays in the
uplink.
In TDD transmissions, the frame structure has an impact on transmission
delays. Indeed, a DL packet has to wait for a DL part of the frame before
being actually transmitted, and similarly an UL packet will have to wait for
an UL part in the frame.
In NR, the TDD frame structure is very flexible, and can be composed of
several UL and DL chunks. We call \"transmission opportunity\" one of this DL
or UL chunk.
The principle of this solution is to provide to an application function
information about the transmission opportunities. It is then up to the
application to adapt its sending times accordingly to minimise transmission
delays. In the case of 5GS integration in a TSN network, this information can
be used to minimise the independent delays provided to the CNC.
### 6.22.2 Functional Description
The application function is assumed to be able to adapt its sending times. In
the case of UL streams, the application client is assumed to be able to adapt
its transmission times. This is typically the case when the 5G system is
acting as a TSN bridge in a TSN.
The solution is based on the following principle:
The AF indicates to the PCF that it is interested in getting transmission
opportunities information, directly in the case of a TSN-AF or through
NEF/TSCTSF otherwise.
The transmission opportunities information request is forwarded to RAN by
reusing PDU session modification procedure.
The RAN builds the transmission opportunities information. This information
may be composed of:
\- A start of frame reference time.
\- A list of offsets for DL opportunities.
\- A list of offsets for UL opportunities.
\- A periodicity.
An example of the mapping between a RAN frame structure and the transmission
opportunities information is provided in Figure 6.22.2-1.
Figure 6.22.2-1: Example of transmission opportunities information
The RAN forwards the transmission opportunities information to the SMF.
The SMF translates the reference time from 5G clock to external clock, taking
into account CN delay and clock drift.
SMF sends the translated transmission opportunities information back to the AF
via PCF/TSCTSF/NEF or directly via the PCF in the case of TSN-AF.
Editor\'s note: Clock time difference management has to be clarified.
### 6.22.3 Procedures
Figure 6.22.3-1 describe the procedure for this solution.
Figure 6.22.3-1: Procedure for transmission opportunities exposure
1\. AF indicates to the PCF a request for getting transmission opportunities
information. Signalling AF session with requested QoS procedure (clause
4.15.6.6 in TS 23.502 [3]) is used.
2\. The transmission opportunities information is forwarded to RAN by reusing
PDU session modification procedure:
\- RAN gets frame format it uses for that PDU session and derives the
transmission opportunities parameters.
\- SMF translates the start of frame indication from 5G internal clock
reference to external clock reference.
3\. PCF provides the transmission opportunities information to the AF using
the notification procedures.
In the case of TSN-AF, the transmission opportunities information can be
useful for computing the delays to be advertised to the CNC, i.e. the TSN-AF
shall have the option of getting the transmission opportunity information
before requesting any data flow. In this case, the TSN-AF triggers the
transmission opportunities information request in
Npcf_PolicyAuthorization_Update without including a stream request.
Editor\'s note: To be checked whether the QoS request procedure is the right
procedure to use if the AF does not include a stream request.
After having received the transmission opportunities information, the AF may
trigger another AF session with requested QoS procedure including flow BAT and
periodicity that take into account transmission opportunities information.
### 6.22.4 Impacts on services, entities and interfaces
AF:
\- Transmission opportunities information request.
\- Computing the delays to be advertised to the CNC taking into account
transmission opportunities information (TSN-AF).
\- Burst sending schedule adaptation according to the received transmission
opportunities information.
SMF:
\- Support of signalling transmission opportunities request / transmission
opportunities information.
\- Translates the start of frame indication from 5G clock to external clock.
NG-RAN:
\- Reception of transmission opportunities information request.
\- Provides transmission opportunities information.
PCF/TSCTSF/NEF:
\- Support of signalling transmission opportunities request / transmission
opportunities information.
# 7 Evaluation
## 7.1 Key Issue #3: Support for controlling 5G time synchronization service
based on subscription
There are 2 solutions (Sol#18, Sol#19) for KI#3. The following technical
issues are studied:
1\. How to authorize time synchronization service based on UE subscription:
\- TSCTSF performs time synchronization service configuration (i.e. ASTI
and/or (g)PTP time distribution) based on UE\'s Time Synchronization
Subscription Data. (Sol#18, Sol#19).
\- AMF performs time synchronization service configuration for ASTI if the
Access Stratum Time Synchronization Service Authorization is available at the
UDM and the UE is authorized. (Sol#18).
\- Applicability of time sync subscription for time sync service activation
with or without AF request. (Sol#18).
\- TSCTSF authorizes time synchronization service request based on UE
subscription. (Sol#19).
2\. How to enforce time synchronization service on a per UE basis based on
subscription:
\- TSCTSF performs time synchronization service configuration (i.e. ASTI
and/or (g)PTP time distribution) based on UE\'s Time Synchronization
Subscription Data with or without AF request. (Sol#18).
\- AMF performs time synchronization service configuration for ASTI if the
Access Stratum Time Synchronization Service Authorization is available at the
UDM and the UE is authorized. (Sol#18).
\- TSCTSF updates the 5G time distribution indication based on UE
subscription. (Sol#19).
\- TSCTSF subscribes to Time Synchronization Subscription Data at the UDM.
(Sol#18, Sol#19).
\- TSCTSF determines a suitable 5G timing source to provide time
synchronization service for the UE. (Sol#19).
3\. What parts of time synchronization service require a separate UE
subscription (and authorization), if any:
\- UDM stores Time Synchronization Subscription Data and Access Stratum Time
Synchronization Service Authorization fields management with or without AF
request. (Sol#18).
\- UDM stores Subscription data including time synchronization parameters or
timing resiliency parameters. (Sol#19).
## 7.2 Key Issue #5: Interworking with TSN network deployed in the transport
network
There are 4 solutions (Sol#9, Sol#10, Sol#11, Sol#20) for KI#5. The solution
#10 has been merged into Solution #9, therefore it is not considered here. The
following technical issues are studied:
a) The architecture enhancement to support the interworking between 5GS and
TSN networks deployed in the transport network.
\- NG-RAN/NG-TT and UPF/TNW-TT support LLDP to report the topology to CNC in
TSN Transport Network. It supports the container to communicate with TSNCF.
TSNCF collects the Talker/Listener stream requirement as specified in IEEE Std
802.1Qcc [6] from NG-TT and TNW-TT via PMIC/UMIC. It provides the
Talker/Listener status to CNC and receives the status of stream configuration
from CNC. It provides the Talker/Listener configuration status to NG-TT and
TNW-TT via PMIC/UMIC. (Sol#11).
\- SMF allows information access with the collocated TN CUC to support UNI as
described in IEEE P802.1Qdj [10]. SMF determines the traffic requirements for
a QoS Flow and initiates that CUC translates them to merged stream
requirements which are then passed to the CNC in TSN Transport Network.
(Sol#9).
\- TSNCF (co-located with TSCCF/TSN AF) act as 5G CUC to support UNI as
described in IEEE P802.1Qdj [10]. TSNCF determines the traffic requirements
and translates them to merged stream requirements which are then passed to the
CNC in TSN Transport Network. (Sol#11).
\- NG-RAN and UPF may support Listener/Talker and Stream Transformation as
described in IEEE P802.1Qdj [10]. (sol#9 and sol#11) If the Stream
Transformation in NG-RAN and UPF is not supported, two options for identifying
the traffic on QoS Flow basis in the TN: 1) SMF instructs UPF and RAN to
assign a separate CN tunnel end point address for each QFI or 2) the interface
between the CUC and CNC in the TN allows the SMF and CUC to indicate the TEID
and QFI of the given QoS Flow to the CNC in the TN (Sol#9).
\- SMF may transfer received merged end station communication-configuration
from the TN CNC to the Talker/Listener accordingly. (Sol#9).
\- TSNCF (co-located with TSCCF/TSN AF) may transfer received merged end
station communication-configuration from the TN CNC to the Talker/Listener
accordingly. (Sol#11).
\- NG-RAN and UPF may support the functionality of Listener/Talker as
described above. (Sol#9, sol#11).
\- NG-RAN provides stream requirements to transport network CNC, and allocates
separate tunnel end-point destination addresses per QoS Flow (for QoS flows
with TSCAI) used for the N3 tunnels (existing functionality). (Sol#20).
\- SMF instructs the NG-RAN and UPF to allocate separate tunnel end-point
destination addresses per QoS Flow (for QoS flows with TSCAI) used for the N3
tunnels using existing NGAP and existing N4 signalling. (Sol#20).
\- NG-RAN provides stream identification to transport network CNC. (Sol#20).
b) What information are needed and how to collect the information from 5GS
(e.g. NG-RAN, 5GC NF), so that the 5GS can interact with TSN network. Also,
determine which 5GS entity is responsible to provide it to the TSN network
deployed in the transport network.
\- TSNCF collects the Talker/Listener stream requirement as specified in IEEE
Std 802.1Qcc [6] from NG-TT and TNW-TT via PMIC/UMIC. It provides the
Talker/Listener status to CNC and receives the status of stream configuration
from CNC. It provides the Talker/Listener configuration status to NG-TT and
TNW-TT via PMIC/UMIC. (Sol#11).
\- SMF allows information access with the collocated CUC to support UNI as
described in IEEE P802.1Qdj [10]. SMF determines the traffic requirements for
a QoS Flow and initiates that CUC translates them to merged stream
requirements which are then passed to the CNC in Transport Network. (Sol#9).
\- NG-RAN provides stream requirements to transport network CNC, and allocates
separate tunnel end-point destination addresses per QoS Flow (for QoS flows
with TSCAI) used for the N3 tunnels (existing functionality). (Sol#20).
\- NG-RAN may determine a dynamic value of 5G-AN PDB in UL direction at the
gNB egress. The NG-RAN provides the dynamic value of 5G-AN PDB value to the
SMF in a response to the QoS Flow establishment or modification request. This
is used as more accurate value for AN-PDB when the SMF determines the traffic
requirements for a QoS Flow towards the TN CNC (Sol#9).
## 7.3 Evaluation for KI #6: Adapting downstream scheduling based on RAN
feedback for low latency communication
There are currently 7 solutions in the TR for Key Issue#6: Solution#2,
Solution#12, Solution#13, Solution#15, Solution#16, Solution#21 and
Solution#22. Solution#16 has been merged with Solution#12, so it is not
considered further. Rest of the solutions are summarized below.
The solutions can be divided into two categories:
1) NG-RAN determines the timing feedback based on the reception time of the
packets in user plane (**Solutions 2 and 15**).
The 5GS notifies the AF for the Burst Arrival Time offset; that is expressed
in reference to the actual reception timing of the packets as experienced by
the NG-RAN in User Plane; Burst Arrival Time offset can take positive or
negative values. The solution#2 is applicable only for traffic in DL
direction. Solution #15 is an enhancement of Solution#2 to make it applicable
also for traffic in UL direction, but this impacts to the UE. The solutions do
not require that the application is time-synchronized with the 5GS, i.e. BAT
in TSCAI is optional.
The solution can only adjust the sending time after the traffic has started.
In practice it requires several packets until the application receives the
feedback and required latency can be met.
2) 5GS and AF negotiate the Burst Arrival Time in control plane (**Solutions
12, 13, 21, 22**).
These solutions require that the application is time-synchronized with the
5GS, i.e. BAT in TSCAI is mandatory.
In Solution#12 the AF provides a \"BAT window\" to 5GC and to NG-RAN; it
consists of earliest and latest arrival time of the traffic. The NG-RAN
responds with a \"BAT offset\" that is relative to the earliest arrival time
in the BAT window and is less or equal to the subtract of the latest and
earliest arrival times of the BAT window. The BAT offset can be provided
separately for UL and DL directions.
In Solution#21 the feedback from the NG-RAN is only used to indicate the
timing of the burst to the Transport Network (via TN CNC), thus the solution
requires that integration with TSN in the Transport Network is supported as
described in Solution#11 for KI#5. In addition, since the feedback is not sent
to the AF, the application cannot adjust the timing based on the feedback,
thus the bridges in the Transport Network will buffer the bursts.
In Solution#13 the NG-RAN provides a Burst Arrival Window (BAW) in absolute
time and burst periodicity preference to 5GC (separately for UL and DL). The
BAW and periodicity preference are then to be provided to the AF; the AF
provides a BAT to the NG-RAN that is within the Burst Arrival Window.
Solution#22 is similar to Solution#13, but instead of providing Burst Arrival
Window and periodicity preference, the NG-RAN provides \"transmission
opportunities\" to the AF, that consists of start of frame reference time, a
list of offsets for DL opportunities, a list of offsets for UL opportunities,
and periodicity. The AF is then supposed to update the QoS-request
accordingly. The solution also contains a procedure for the AF to query the
\"transmission opportunities\" from the NG-RAN, before the AF has invoked the
actual QoS-request for a stream.
# 8 Conclusions
## 8.1 Conclusion for KI #4: AF Request of PER for QoS and Alt-QoS
It is agreed to adopt Solution #8: \"AF Request of PER for QoS and Alt-QoS\"
for normative work.
## 8.2 Key Issue #2: Time synchronization service enhancements
The following bullet points summarize the principles for the way forward:
\- To request a Requested Coverage Area for time synchronization services, AFs
within the operator\'s domain formulates a spatial validity condition using a
list of Tracking Area identities, but AFs outside the operator\'s domain use a
geographical area (e.g. a civic address or shapes) instead, while NEF
transforms this information into a list of Tracking Area identities.
\- The AF provides the Requested Coverage Area for time synchronization
services, UE list and time synchronization services (ASTI or (g)PTP based) to
TSCTSF, optional via NEF.
NOTE: The Requested Coverage Area is restricted to TA level granularity.
\- In order to track the UE moving in and out of Time Synchronization coverage
area at a TA granularity, the Registration Area (RA) shall only include TAs
either inside or outside of the Requested Coverage Area the AF requested for
Time Synchronization. This ensures the UE performs Registration update with
the network when the UE moves in and out of Requested Coverage Area.
\- The TSCTSF need to query with UDM to check whether ASTI or (g)PTP based
time synchronization is allowed to be requested by AF for the UE.
\- The TSCTSF is responsible of activate/deactivate time synchronization
services (ASTI or (g)PTP based) considering the spatial validity condition
provided by the AF.
\- The TSCTSF discovers the AMF(s) serving the list of TA(s) that comprise the
spatial validity condition using the NRF.
\- The TSCTSF subscribes to UE\'s location or UE\'s presence in Area of
Interest at the discovered AMF(s).
\- The TSCTSF may optionally provide the Location Reporting Type indication to
the AMF when the TSCTSF subscribes to UE\'s location or presence in AoI.
Otherwise, the AMF determines the Location Reporting Type indication.
\- The determination of the Location Reporting Type indication and Location
Report Level can be based on AoI requested, other location reporting processes
the UE may have active with the AMF, and the UE\'s current RRC state (if
known). Alternatively, the UE\'s presence in the AoI event type may be used
unless specified otherwise.
\- The Location Report Level shall be set in accordance with the Requested
Coverage Area.
\- The TSCTSF determines (based on notifications from the discovered AMF(s))
whether the targeted UE(s) are inside or outside the AF Requested Coverage
Area.
\- The TSCTSF activates time synchronization services for UE(s) that are
inside the Requested Coverage Area. If the AF has requested (g)PTP based time
distribution, then TSCTSF creates the PTP port in DS-TT and adds it to the PTP
instance as described in clause 4.15.9.3.2 in TS 23.502 [3].
\- TSCTSF notifies the AF with the indication of 5G access stratum time
distribution (enabled, disabled) for the targeted UE(s) for which the AF has
requested ASTI-based time distribution that are inside or move inside or
outside of the Requested Coverage Area.
\- If the TSCTSF has determined (e.g. notified) that the UE has moved outside
the AF Requested Coverage Area for which the AF has requested (g)PTP based
time distribution, then TSCTSF temporarily removes the UE/DS-TT from the PTP
instance:
\- If the DS-TT is configured to send Sync, Follow_Up and Announce messages
for the related PTP instance, then TSCTSF deactivates the Grandmaster
functionality in the DS-TT using PMIC (see also clause K.2.2.4 of TS 23.501
[2]) and removes the DS-TT from the PTP instance (see also clause K.2.2.1 of
TS 23.501 [2]).
\- If NW-TT is configured to send Sync, Follow_Up and Announce messages on
behalf of the DS-TT, then TSCTSF deactivates the Grandmaster functionality on
behalf of the DS-TT in NW-TT using UMIC (see also clause K.2.2.4 of TS 23.501
[2]) and removes the DS-TT from the PTP instance (see also clause K.2.2.1 of
TS 23.501 [2]).
\- The TSCTSF informs the AF for the impacted UE by indicating the PTP port
state as Inactive for the related DS-TT PTP port.
\- If TSCTSF has determined (e.g. notified) that the UE has moved inside the
AF Requested Coverage Area for which the AF has requested (g)PTP based time
distribution, then TSCTSF adds the DS-TT PTP port to the PTP instance and also
(re-)activates the Grandmaster functionality. The TSCTSF informs the AF for
the impacted UE by indicating the PTP port state as Active for the related DS-
TT PTP port.
\- If the TSCTSF has determined (e.g. notified) that the UE has moved outside
the AF Requested Coverage Area for which the AF has requested ASTI based time
distribution, then TSCTSF temporarily deactivate ASTI time synchronization
service by disabling the indication of 5G access stratum time distribution for
the targeted UE(s).
\- If TSCTSF has determined (e.g. notified) that the UE has moved inside the
AF Requested Coverage Area for which the AF has requested ASTI based time
distribution, then TSCTSF enables the indication of 5G access stratum time
distribution for the targeted UE(s) based on the AF-requested requirement of
time synchronization service.
## 8.3 Conclusion for KI #5: Interworking with TSN network deployed in the
transport network
The following bullet is the interim conclusion for KI#5:
\- There is 5G CUC to interact with TN CNC on exchanging Talker/Listener or
Status Groups information. The 5G CUC is collocated with the SMF(s).
\- The 5G CUC will map the QoS Flow related parameters into Talker/Listener
Group in IEEE 802.1Qcc [6]. The detailed handling of the parameters in
Talker/Listener or Status Groups information is described in clause 6.9.2.
\- The RAN and UPF may support the functionality of Listener/Talker for the
following:
\- hold and buffer functionality in a case when the TSCAI contains a BAT in UL
and/or DL direction. In this case the TimeAwareOffset is sent to the Talker in
RAN/UPF in a Transparent Container, and the Talker in RAN/UPF must buffer the
data burst until the time indicated in the TimeAwareOffset is reached.
\- for support of stream transformation, the Talker/Listener does not provide
the DataFrameSpecification. In this case the 5G CUC transfers the
InterfaceConfiguration received from the TN CNC to Talker in a Transparent
Container, and the Talker in RAN/UPF must use the indicated MAC address, VLAN
ID or IP-tuples for the data stream.
\- for 5G CUC to retrieve the InterfaceCapabilities and/or
EndStationInterfaces from the Talker/Listener via Transparent Container.
Otherwise, this information must be preconfigured or determined by 5G CUC.
\- NG-RAN and UPF may support u-plane LLDP functionality. When LLDP is
supported, the u-plane is performing the LLDP functionality without the need
for c-plane interaction with CNC of the transport network for the purpose of
LLDP as specified in clause 6.11.2.
\- It is assumed that RAN, 5GC and Transport Network are time synchronized
with each other in 5G internal system clock.
## 8.4 Key issue #6: Adapting downstream scheduling based on RAN feedback for
low latency communication
The following bullet points summarize the principles for the way forward:
\- Proactive feedback requires that 5GS and the AF receive time information
from the same master clock. Since this assumption cannot hold in all
deployments, both pro-active and reactive feedback mode shall be supported.
The feedback is in order to align the burst arrive time and the next
transmission opportunity on the respective direction (i.e. both UL and DL) of
the traffic to reduce the potential buffering delay.
\- When the AF gets the feedback for BAT (in both modes), the AF adjusts the
burst sending time accordingly.
\- When the AF gets the periodicity feedback (in proactive mode), the AF
adjusts the periodicity accordingly.
NOTE 1: For both UL and DL direction, the AF adjusts the burst sending time
and periodicity by using application layer mechanism, e.g. to notify the
application in device side.
\- The AF provides adaptation capability information of the application to 5GS
as described below.
Principles for Proactive feedback for BAT:
\- The AF may indicate its capability for BAT window along with the BAT as
specified in Rel-17. If the PCF receives a policy authorization request from
the AF/NEF/TSCTSF that indicates that capability or a BAT window:
\- the PCF sets a trigger to be notified for the \"BAT offset\" event for the
corresponding PCC Rule via the SM policy control service to the SMF.
\- If the SMF receives an indication for a BAT adaptation capability or a BAT
window, in a TSCAC, the SMF includes that indication or a BAT window into
TSCAI along with the QoS Flow establishment request. This indicates to the NG-
RAN that the NG-RAN may provide a BAT offset in an N2 SM information as a
response to the SMF.
\- As a response to the QoS Flow establishment request, the NG-RAN may provide
a \"BAT offset\" that is within the BAT window, if available, value. The BAT
offset is provided from NG-RAN to SMF, eventually forwarded via PCF/TSCTSF/NEF
to AF.
\- If the AF does not receive the BAT offset (e.g. NG-RAN did not provide it),
the AF assumes that the 5GS does not support BAT adaptation and the initial
BAT value is used as a Burst Arrival Time in 5GS.
\- The SMF configures the UPF for clock drifting reports as specified in TS
23.502 [3]. In a case the SMF receives a clock drifting report from UPF, if
the SMF has received a BAT offset from the RAN, the SMF adjusts the BAT offset
based on the existing procedures in TS 23.502 [3] and provides the updated BAT
offset to the AF via PCF/TSCTSF/NEF.
Principles for Proactive feedback for Periodicity:
\- The AF may also indicate its capability for Periodicity Range in the AF
Request along with the Periodicity as specified in Rel-17, together with the
parameter for BAT adaptation mentioned above:
\- The RAN may provide a periodicity feedback together with a BAT offset
mentioned above. The periodicity feedback shall be within the Periodicity
Range (if available).
\- If the RAN provides feedback with proposed periodicity value and a BAT
offset, the BAT offset is accepted based on the proposed periodicity.
\- If the RAN provides BAT offset and no proposed periodicity, the Periodicity
as specified in Rel-17 is accepted and the BAT offset is processed as
described for the proactive feedback for BAT.
\- The AF may attempt to update the Periodicity and/or BAT using the same
procedure as described for initial proactive feedback.
\- If the interworking with TSN network deployed in the transport network is
supported, the SMF/CUC uses the accepted periodicity and BAT offset to derive
the Talker/Listener Group in IEEE 802.1Qcc [6] as described in clause 8.3.
Principles for Reactive feedback:
\- The AF may request the 5GS to report the BAT offset; that is a time offset
to the observed timing of the packet reception in the user plane in the NG-
RAN. In this case the AF subscribes for the QoS notifications as described in
the QoS notification control procedure in TS 23.501 [2] and includes an
indication of \"burst arrival time adaptation\" in the QoS-request to the 5GC.
\- If the PCF receives indication for \" burst arrival time adaptation\" along
a subscription for QoS notifications in policy authorization request from
AF/NEF/TSCTSF, the PCF sets the QoS notification control parameter as
described in TS 23.501 [2] and in addition sets a trigger to be notified for
the \"BAT offset\" event for the corresponding PCC Rule via the SM policy
control service to the SMF. The SMF provides the notification control
parameter to the NG-RAN as described in TS 23.501, and in addition includes
the indication of \" burst arrival time adaptation\" to the QoS profile.
\- If the Notification control is enabled and indication of \" burst arrival
time adaptation\" is set in the TSCAI, and the NG-RAN determines that the PDB
can no longer be guaranteed for a QoS Flow, the NG-RAN notifies the SMF as
described in TS 23.501 [2] and in addition may include a BAT offset to the N2
SM information that is sent to SMF, eventually forwarded via PCF/TSCTSF/NEF to
AF.
\- If the NG-RAN receives the indication for \"burst arrival time
adaptation\", the NG-RAN indicates the parameter to the UE via RRC signalling.
The NG-RAN indicates a threshold for the BAT offset reports to the UE.
\- If the UE receives the indication for \"burst arrival time adaptation\"
from NG-RAN, the UE determines a relative BAT offset value in reference to the
current Burst Arrival Time experienced by UE (i.e. in reference to when UE
currently receives bursts) and the scheduling UL time slot at UE (e.g. in
Configured Grants, as defined in TS 38.321 [11]). The UE sends the BAT offset
to RAN when the time offset value reaches the configured threshold, and NG-RAN
sends the BAT offset value to SMF.
NOTE 2: Whether the UE provides the BAT offset to the RAN or RAN can determine
the BAT offset based on other information provided by the UE will be
determined by RAN WG2. Need for \"burst arrival time adaptation\" indication
to the UE depends on the RAN WG2 conclusion.
## 8.5 Conclusion for KI #1: 5GS network timing synchronization status and
reporting
The following bullet points summarize the principles for the way forward:
\- Detecting and reporting RAN and UPF timing synchronization status to
TSCTSF.
\- NG-RAN and UPF/NW-TT can detect timing synchronization
degradation/failure/improvement locally.
NOTE 1: The detection is performed based on information provided by time
synchronization protocols used in the transport network for both RAN and UPF,
or, in the case of NG-RAN, using information provided by a local GNSS
receiver. However, in any case, the details on how exactly NG-RAN/UPF detects
timing synchronization degradation/failure/improvement locally are beyond the
scope of 3GPP.
Two options are defined for the TSCTSF to detect the timing synchronization
status information of RAN and UPF/NW-TT:
1) TSCTSF may receive network timing synchronization status information of RAN
and UPF/NW-TT directly from OAM.
2) Alternatively, TSCTSF may receive network timing synchronization status
information of RAN and UPF/NW-TT using control plane signalling at node level:
\- For UPF/NW-TT case the TSCTSF may use UMIC.
\- For NG-RAN case the TSCTSF may obtain NG-RAN network timing synchronization
status information via the AMF (i.e. AMF uses NGAP signalling to configure the
NG-RAN reporting).
The network timing synchronization status information from RAN or UPF/NW-TT
can contain the following parameters: node\'s synchronization state, node\'s
synchronization performance, primary source description, and primary source
event.
\- UE determining that the RAN clock quality information changed using:
\- SIB broadcast information to enable UEs in RRC_IDLE and RRC_INACTIVE and in
the case of RRC_CONNECTED UEs, dedicated RRC signalling, to enable UEs to
determine that:
\- the timing synchronization status of the cell that the UE is camping on has
changed;
\- the timing synchronization status of the new cell the UE is camping on
after cell reselection is different compared to the timing synchronization
status of the cell that the UE was previously camping on.
\- If the UE has determined that the RAN clock quality information has changed
and the UE has been requested by the TSCTSF to connect to the network in the
case that the RAN clock quality information changes, the UE performs a
registration (if the UE is in RRC_IDLE) or the UE Triggered Connection Resume
in RRC Inactive procedure (if the UE is in RRC_INACTIVE).
\- Informing UEs in RRC_Inactive/Idle state about a change of the RAN clock
quality information:
\- The gNB includes in SIB9 a reference report ID as a notification for the
UEs reading the SIB9 that there is new clock quality information available.
The UE compares the reference report ID with locally stored reference report
ID to determine if it had retrieved the last available clock quality
information already.
\- The reference report ID consists of the scope of the report ID and an Event
ID (an integer). Scope may either identify a group of cells within a single
gNB or a group of cells across gNBs. The latter would reduce the amount of
signalling even further since then UEs that move to another gNB would not need
to retrieve the clock quality details.
NOTE 2: RAN WGs are expected to decide whether to support both scopes (group
of cells per gNB or across gNBs).
NOTE 3: It is not required that the UE always transitions to RRC_CONNECTED
immediately to retrieve the latest available clock quality information. In
order to reduce RACH access from many UE(s) (to move back to RRC_CONNECTED
state) at the same time, the following option has been considered pending RAN
WG2 feedback:
\- The RAN may require that the UE(s) randomize re-connecting back to the
network, i.e. to spread the UEs\' connection attempts in the time domain, e.g.
over the course of one minute. It is up to RAN WG2 to determine how this is
achieved.
\- Providing RAN\'s latest clock quality information to the UE in
RRC_Connected state:
\- If a UE is subscribed for Access Stratum Time Synchronization (ASTI) in the
UDM (see clause 8.6), then the \"Access and Mobility Subscription data\" may
additionally contain the following clock quality reporting control
information:
\- Clock quality detail level: indicates whether and which clock quality
information to provide to the UE and can take one of the following values:
clock quality metrics or acceptable/not acceptable indication;
\- Clock quality acceptance criteria for the UE (if the clock quality level
equals \"acceptable/not acceptable indication\": the clock quality acceptance
criteria for the UE. Acceptance criteria can be defined based on the following
attributes: time source, traceability to UTC or GNSS, synchronization state,
clock accuracy, PTP clockClass, frequency stability. (e.g. acceptable clock
accuracy, acceptable frequency stability, etc.).
NOTE 4: Attributes that can be used for clock quality acceptance criteria
depends on RAN capabilities to provide them and pending RAN WGs feedback.
Whether PTP clockClass can be used will be determined during the normative
phase.
NOTE 5: Whether and which clock quality information to provide to the UE
depends on the needs of the time service consumer (referred to as client
network operator hereafter). Therefore, the clock quality detail level and
clock quality acceptance criteria are based on the parameters and their values
specified in the agreement between the 5G network operator and the client
network operator. The clock quality acceptance criteria refer to the quality
with which 5G access stratum time needs to be delivered to and received by the
UE (i.e. also considering propagation delays). Additional inaccuracies in the
UE, e.g. if the 5G access stratum time is delivered to devices attached to the
UE, are not included in the clock quality acceptance criteria because they are
assumed to be budgeted by the client network operator when agreeing the
required clock accuracy with the 5G network operator.
\- If an AF requests Access Stratum Time Synchronization (ASTI) for a UE, then
the AF may provide clock quality reporting control information and service
acceptance criteria (defined based on the following attributes: time source,
traceability to UTC or GNSS, synchronization state, clock accuracy,
clockClass, frequency stability, see NOTE 4) to TSCTSF. TSCTSF provides the
clock quality reporting control information to AMF.
\- When AMF provides the 5G access stratum time distribution indication and
the Uu time synchronization error budget to NG-RAN, AMF also includes the
clock quality reporting control information.
\- Based on the clock quality reporting control information received from AMF,
RAN reports its timing synchronization status to the UE using unicast RRC:
\- If clock quality detail level is set to \"clock quality metrics\", then the
RAN provides clock quality metrics to the UE that reflect its current timing
synchronization status. Clock quality metrics refers to the following
information: clock accuracy, PTP clockClass, traceability to UTC, frequency
stability, time source, synchronization state.
\- If clock quality detail level is set to \"acceptable/not acceptable
indication\", then the RAN provides an acceptable indication to the UE if the
RAN\'s timing synchronization status matches the acceptance criteria received
from AMF; otherwise RAN indicates \"not acceptable\" to the UE.
\- When determining the clock quality metrics for a UE and when determining
whether clock quality is acceptable or not acceptable for a UE, RAN considers
whether propagation delay compensation is performed.
NOTE 6: Clock quality metrics and the acceptable/not acceptable indication
refer to the quality with which 5G access stratum time is delivered to and
received by the UE (i.e. also considering propagation delays). In addition,
the UE can, for example, update clock quality metrics to reflect internal
inaccuracies in the UE before providing the clock quality metrics to devices
connected to the UE.
\- Determining UEs impacted by RAN timing synchronization status
degradation/improvement:
\- TSCTSF subscribes to receive notifications for UE presence in Area of
Interest information (Area of Interest is set to a list of RAN node IDs that
have the same RAN timing synchronization status) from AMF for UEs that AF
requested time synchronization for or which are configured for (g)PTP-based or
ASTI-based time synchronization based on subscription.
\- When activating time synchronization for a UE, TSCTSF requests the UE to
connect to the network via AMF (i.e. to perform a registration if the UE is in
RRC_IDLE or the UE Triggered Connection Resume in RRC Inactive (if the UE is
in RRC_INACTIVE) in the case when the UE later detects that the RAN timing
synchronization status has changed while the UE is in RRC_IDLE or
RRC_INACTIVE.
\- TSCTSF correlates information about impacted RAN nodes and the UE location
information received from AMF to determine the UEs impacted by RAN timing
status degradation/failure/improvement.
NOTE 7: How to determine the impacted UE will continue to be discussed during
the normative phase.
\- Determining UEs impacted by UPF timing synchronization status degradation
or improvement (only for the case when UPF/NW-TT is involved in providing time
information to DS-TT):
\- TSCTSF determines the UEs for which an impacted UPF/NW-TT is configured to
send (g)PTP messages.
\- Informing AFs about network timing synchronization status degradation or
improvement:
\- If TSCTSF has determined UEs impacted by RAN or UPF timing synchronization
status degradation or improvement or failure then TSCTSF informs the AF about
the timing synchronization status for those UEs if the AF was the requester of
the time synchronization service.
\- The AF may subscribe to time synchronization service status for a UE (or
group of UEs) for which the AF requests or has requested time synchronization
service (for ASTI or (g)PTP services).
\- For the subscribed AFs the TSCTSF provides time synchronization service
status.
\- The TSCTSF may perform the following:
\- For AFs that requested ASTI service, the TSCTSF may indicate whether it can
support the ASTI service or not as per the requested criteria.
\- For AFs that requested PTP service, the TSCTSF may indicate whether it can
support the PTP service or not as per the requested criteria.
\- For AFs that subscribe for ASTI/PTP service status update (i.e. change in
support status), the TSCTSF may provide notification towards the AF when there
is a change in support status.
\- Deactivating/reactivating/updating time synchronization services based on
RAN/UPF timing synchronization status changes:
\- PTP case: For UEs that are part of a PTP instance and which are impacted by
RAN or UPF time synchronization status degradation or improvement:
\- If TSCTSF determines that the Time synchronization error budget provided by
AF can still be met, then TSCTSF may update the clockQuality information sent
in Announce messages (see clause 7.6.2 of IEEE 1588 [8]) for the PTP instance
using existing procedures and existing PMIC/UMIC information. The handling of
Announce messages follows existing procedures as described in TS 23.501 [2].
\- If TSCTSF determines that the Time synchronization error budget provided by
AF cannot be met (see above) then TSCTSF informs the AF about the intention to
temporarily remove the UE/DS-TT from the PTP instance and performs the action
using existing procedures in clause K.2.2.1 and clause K.2.2.4 of TS 23.501
[2]) after receiving the confirmation. If the AF declines the intention, the
TSCTSF keeps the service active.
\- If TSCTSF determines that the Time synchronization error budget provided by
AF can be met again then TSCTSF adds the DS-TT PTP port to the PTP instance
again and also re-activates the Grandmaster functionality.
\- ASTI case: the TSCTSF determines if the acceptance criteria can be met or
not and notifies the result to the AF. Based on the notification, the AF
decides to modify the ASTI service if preferred (e.g. disable the service upon
degradation or enable it again upon recovery).
## 8.6 Conclusion for KI#3: Support for controlling 5G time synchronization
service based on subscription
The following principles summarize the solution baseline:
\- UE subscription data types stored in the UDM are extended to include two
new data structures related to time synchronization service:
1) The \"Access and Mobility Subscription data\" is extended with the
following fields:
\- \"Access Stratum Time Synchronization Service Authorization\" which
indicate whether the UE is provisioned to receive RTI reception.
\- (Optionally) the Uu time synchronization error budget.
\- (Optionally) One or more periods of Start and stop times defining active
times of Access Stratum Time Synchronization Service for the UE.
\- (Optionally) Coverage Area: defining a list of TAs where the ASTI-based
time synchronization is available for the UE. .
2) A new subscription data \"Time Synchronization Subscription data\":
\- the \"AF request Authorization\", indicating whether the UE is authorized
for an AF-requested time synchronization services:
\- \"allowed\" or \"not allowed\" for (g)PTP based time synchronization
service (per DNN/S-NSSAÍ and UE identity),
\- \"allowed\" or \"not allowed\" for ASTI based time synchronization services
(per UE identity).
\- optionally Coverage Area defining a list of TA(s) which restricts the area
in which an AF may request time synchronization services (for ASTI or PTP
services).
\- one or more \"Subscribed time synchronization service ID(s)\", each
containing the DNN/S-NSSAI and a reference to a PTP instance configuration
pre-configured at the TSCTSF (e.g. PTP profile, PTP domain, etc.).
\- (Optionally) For each PTP instance configuration, one or more periods of
Start and stop times defining active times of Time Synchronization Service for
the PTP instance.
\- (Optionally) For each PTP instance configuration, Coverage Area defining a
list of TAs where the (g)PTP-based time synchronization is available for the
UEs in the PTP instance.
\- (Optionally) Uu time synchronization error budget.
\- The AMF uses the \"Access and Mobility Subscription data\" in the following
way:
\- The AMF retrieves the \"Access and Mobility Subscription data\" stored at
the UDM during the registration procedure.
\- If the AMF receives Access Stratum Time Synchronization Service
Authorization from UDM, it provides 5G access stratum time distribution
indication and Uu time synchronization error budget (if part of the Access
Stratum Time Synchronization Service Authorization received from the UDM) to
NG-RAN.
\- The AF is not allowed to modify the 5GS access stratum time distribution
parameters if \"Access Stratum Time Synchronization Service Authorization\"
indicates that the UE is provisioned to receive RTI reception. This may be
enforced by the AMF.
NOTE: If there is \"Access Stratum Time Synchronization Service
Authorization\" in the \"Access and Mobility Subscription data\", the \"AF
request Authorization\" for ASTI based in the \"Time Synchronization
Subscription data\" should be set to \"not allowed\".
\- If the Access Stratum Time Synchronization Service Authorization contains
Start and stop times, the AMF enables and disables the 5G access stratum time
distribution indication to the NG-RAN according to the expiry of start and
stop times if the UE is in CM_Connected. If the UE is in CM_Idle when a Start
time condition is met, AMF pages the UE and provides the 5G access stratum
time distribution indication to NG-RAN as part of the subsequent service
request procedure initiated by the UE in response to the paging.
\- If the Access Stratum Time Synchronization Service Authorization contains
Coverage Area, the AMF enables and disables the 5G access stratum time
distribution indication to the NG-RAN when the UE moves inside or outside of
the Coverage Area, respectively.
\- The TSCTSF uses the Time Synchronization Subscription data in the following
way:
\- The TSCTSF retrieves the Time Synchronization Subscription data from the
UDM when the TSCTSF receives an AF request for the time synchronization
service (either ASTI or (g)PTP). According to the \"AF request Authorization\"
in the Subscription data, the TSCTSF determines whether the UE is authorized
for an AF-requested time synchronization service. If the UE is authorized, the
TSCTSF proceeds as specified in TS 23.502 [3].
\- The TSCTSF retrieves the Time Synchronization Subscription data from the
UDM when the TSCTSF receives notification from the PCF that a UE has
established a PDU Session that is potentially impacted by (g)PTP-based time
synchronization service. The TSCTSF retrieves the PTP instance configurations
referenced from the Subscribed time synchronization service ID(s). The PTP
instance configurations are stored locally in the TSCTSF.
\- The TSCTSF determines if one or more of the PTP instance configurations
match with the DNN/S-NSSAI of the given PDU Session. If no PTP instance exists
for the given PTP instance configuration, the TSCTSF initializes the PTP
instance in 5GS as described in clause K.2.2 of TS 23.501 [2]. The TSCTSF
configures a PTP port in DS-TT and adds it to the corresponding PTP instance
in NW-TT as described in clause K.2.2 of TS 23.501 [2].
\- If the PTP instance configuration referenced by the Time Synchronization
Subscription data for the UE contains start and stop times, the TSCTSF, upon
expiry of start time, creates the PTP instance and adds the PTP port in DS-TT
to the PTP instance. Upon expiry of stop time, if this is the last period of
start and stop times in the PTP instance configuration, the TSCTSF deletes the
PTP instance, otherwise the TSCTSF temporarily disables the PTP instance.
\- If the PTP instance configuration referenced by the Time Synchronization
Subscription data for the UE contains Coverage Area, the TSCTSF subscribes to
UE\'s presence in Area of Interest at the discovered AMF(s) in similar manner
as concluded for KI#2. When the TSCTSF determines that the UE has moved inside
or outside of the Coverage Area, the TSCTSF adds or temporarily removes the
PTP port in DS-TT from the corresponding PTP instance, in similar manner as
concluded for KI#2.
###### ### Annex A: KI#1 related additional analysis
# A.1 Methods to notify RAN Time Synchronization Status towards the UE
## A.1.1 Alternative 1: gNB provides a reference report ID within SIB
In this alternative when there is a new RAN timing synchronization status
report available at the gNB, the gNB includes in the SIB a status report ID as
a notification for the UEs reading the SIB. The report ID can be an optional
integer information element. This report ID enables the UE to know there is
new information available at the NG-RAN that is not available locally at the
UE. There are two options for the UE to determine RAN timing synchronization
status information with the report ID:
a) The UE can actively retrieve the RAN timing synchronization status
information from the network by entering RRC_Connected. In order to determine
if a report ID is associated to a new report, the UE uses status report ID and
the SIB information to identify the serving gNB in the cell. For report ID
composition, the report ID is constructed from a pre-agreed (known values at
the UE and network side) set of values. The report ID is constructed from a
cell group ID and event ID elements:
\- Cell group ID is an integer allocated by the gNB that identifies a group of
cells controlled by the same gNB.
\- Event ID is an integer value.
b) Report ID is an index that maps to a pre-defined and/or standardized time
synchronization characteristics thus the UE can automatically determine this
without having to move to RRC_CONNECTED state. The report ID is composed by
one integer which values are standardized or operator defined that are known
at the UE and the NG-RAN node.
To limit the possible permutations of report IDs, in addition to the report ID
mapping to time synchronization characteristics, the UEs or AFs may receive
additional time synchronization characteristics via SLA or dedicated
signalling. The decision depends on the time synchronization characteristics
that should be considered. For example, the following parameters can be
considered: Lock state, Parent Time Source, Clock class, Clock stability,
Clock identifier, Physical layer frequency availability, Holdover
specification
An overall procedure for SIB including a reference report ID is illustrated in
Figure A.1.1-1.
Figure A.1.1-1: Procedure for gNB provisioning status report ID in SIB
1\. The UE has received reference time information using unicast RRC or via
SIB9. The RAN releases the UE to RRC Inactive or RRC Idle state.
2\. The NG-RAN node detects a primary source event (e.g. degradation, failure,
recovery).
3\. The NG-RAN generates a RAN timing synchronization status report and an
associated status report ID.
4-5. The NG-RAN node broadcasts a status report ID in the cell using SIB to
notify the primary source event to the UEs camping in the cell.
6\. The UE reads SIB and the status report ID and:
\- Alternative a), if the UE does not have stored locally the RAN timing
synchronization status report corresponding to the status report ID, the UE
retrieves a new RAN timing synchronization status report corresponding to the
status report ID the NG-RAN Otherwise, the UE uses the locally stored RAN
timing synchronization status report and steps 7-9 are skipped; or
\- Alternative b), the UE uses the status report ID as an index to map to the
pre-defined and/or standardized characteristics. Steps 7-9 are skipped.
7\. In the case of alternative a), the UE enters RRC_CONNECTED.
8\. In the case of alternative a) after UE moves to RRC_CONNECTED mode, the
NG-RAN determines the UE is subscribed to RAN timing synchronization status
(e.g. based on configuration provided by the TSCTSF via AMF).
9\. In the case of alternative a) the NG-RAN node sends the last available RAN
timing synchronization status report with its associated status report ID to
the UE via dedicated RRC signalling. The UE may store the RAN timing
synchronization status report with the corresponding status report ID locally
for a configured time or until deregistration, and thus avoid the need to
reconnect with the network.
10\. In the case of alternative b) the UE uses the report ID as an index to
map to the pre-defined and/or standardized characteristics that describe the
RAN timing synchronization status.
## A.1.2 Alternative 2:
This alternative covers a case when a time synchronization status needs to be
reported to UEs in RRC_IDLE and RRC_Inactive states where applications need
such information. For this purpose, it is proposed to use a SIB9 message to
transmit a flag and a timestamp so that UEs in RRC_IDLE and RRC_Inactive state
get information/trigger about a new time synchronization status report
available. Then, UEs, providing a specific time synchronization service, need
now to move to RRC_CONNECTED state so that the report could be delivered to
them via dedicated RRC signalling. An overall procedure shall include at least
the following steps:
0\. The UE has a time synchronization service configured. During the ongoing
service, the UE moves to RRC_IDLE or RRC_Inactive state (which could happen
due to different reasons). While the UEs in RRC_IDLE or and RRC_Inactive
state, the NG-RAN detects an event related to a primary time source (e.g.
degradation, improvement, failure, etc.). This event triggers a time
synchronization status report, and now this report needs to be sent from the
NG-RAN node to the UE.
1\. A new field, acting as a flag, is included in SIB9 to indicate to UEs in
RRC_IDLE state that a time synchronization status report is available.
Consequently, the UEs need to move to RRC_CONNECTED state to receive the
report, if it has an ongoing time synchronization service.
In addition to a flag, another field (e.g. flagSetTimeUTC) is included in SIB9
to reflect a time (actual timeInfoUTC value) when the flag was set/changed,
which is required so that UEs are aware which report the flag is referring to
since every report can be linked to unique time.
NOTE: UEs supporting the feature and when the time sync service is active
(e.g. configured by upper layers) in the UE, such UE will be mandated to
ensure that they always have a valid version of SIB9 stored, which is required
for this reporting procedure to work. Otherwise, UEs are not mandated to re-
acquire a SIB9 message unless a SI update notification is received, i.e. no
new requirements on UEs with respect to SIB acquisition are pursued.
The flag and flagSetTimeUTC fields (this two information may be reflected by
one field) shall be updated by the NG-RAN node only when there is a change in
a time synchronization status.
2\. If there is a new report, NG-RAN updates SIB9. The UEs re-acquires SIB9
and reads the flag and flagSetTimeUTC fields in the received SIB9 message.
Based on the information in these fields, the UE determines whether there is a
new time synchronization report available at the NG-RAN.
3\. If the UE determines there is a new time synchronization status report
available, the UE initiates the relevant legacy procedure to enter the
RRC_CONNECTED state. The procedure of RRC state transition is not affected.
4\. After completing the transition to RRC_CONNECTED state, the NG-RAN
determines (based on the information provided by the AMF via the TSCTSF)) that
the latest time synchronization status report needs to be sent to this UE.
Steps at RRC_CONNECTED state is common to all variants.
5\. The NG-RAN sends the latest time synchronization status report to the UE
via dedicated RRC signalling. If a time synchronization status changes and a
new report is available after the UE has gone to RRC_IDLE or RRC_Inactive
state again, then the process with an update of the flag and the
flagSetTimeUTC fields repeats.
## A.1.3 Alternative 3: Broadcast the time change status in SIB
This alternative is related to the conclusion for KI#1 on:
\- the NG-RAN informs UEs that receive 5G access stratum time about the time
synchronization status by providing additional time synchronization status
information (e.g. synchronization state, primary source description (e.g.
type, quality, lock state), clock class and information about traceability to
UTC, clock accuracy and stability) to UEs
The idea of this alternative is to provide RAN Time Synchronization Status in
SIB. According to the status information, the UE know the time status has be
changed. In this alternative, there is no inter-RAN node cooperation.
The ReferenceTimeinfo (RTI) is extended with:
\- Time quality (e.g. quality, clock class)
\- Latest time status change time
\- Time source
NOTE: The detail of time quality will depend on the ITU-T feedback.
### A.1.3.1 Procedures
#### A.1.3.1.1 Broadcast the time change status
Figure A.1.3.1.1-1: Broadcasting RAN Time Synchronization Status
1\. The AF has requested 5G access stratum time distribution for the UE and
NG-RAN know it need to notify the time status to UE if there is primary time
source event (e.g. changed, degradation, etc.).
NOTE 1: This step can be optional or depend on the existing solution in this
TR.
2\. The NG-RAN provides the referencetimeinfo to UE via SIB9 or dedicated RRC:
3\. There is a primary time source event that occurs (e.g. degradation,
switch, failure, recovery).
4\. The NG-RAN provides the enhanced referencetimeinfo to UE via SIB9 or
dedicated RRC. According to the Latest time status change time in the RTI, the
UE know whether this is primary time source event occurs.
NOTE 2: The UE may store the RAN id and Latest time status change time to make
the comparison. This is up to UE implementation.
## A.1.4 Alternative 4: Ciphered RAN Time Synchronization Status in SIB
Key idea of this alternative is to provide RAN Time Synchronization Status in
SIB. RAN Time Synchronization Status may optionally be ciphered. Ciphering
keys are only provided to UEs, which are subscribed for time synchronization
or for which an AF has successfully requested time synchronization.
Ciphering RAN Time Synchronization Status in SIB ensures that RAN Time
Synchronization Status can only be read by UEs that are privy to this
information.
To enable ciphering of the Ciphering RAN Time Synchronization Status, TSCTSF
obtains the RAN Time Synchronization Status from NG-RAN nodes and provides the
ciphered RAN Time Synchronization Status to NG-RAN nodes via AMF (see clause
A.1.4.1 for details).
NOTE: Details of how to obtain RAN Time Synchronization Status are discussed
in the solutions documented in clause 6 of this TR.
This means that the same ciphered RAN Time Synchronization Status information
is provided to all UEs that have received the ciphering keys.
This alternative is based on the existing solution for Broadcast of Assistance
Data for location services (see clause 6.14 of TS 23.273 [16] and clause 7 of
TS 37.355 [17]for details on Broadcast of Assistance Data).
Editor\'s note: Feasibility of this solution depends on feedback from RAN
WG2/WG3 and SA WG3.
### A.1.4.1 Procedures
#### A.1.4.1.1 Broadcast of RAN Time Synchronization Status
Figure A.1.4.1.1-1: Broadcasting RAN Time Synchronization Status
1\. TSCTSF obtains RAN Time Synchronization Status.
NOTE 1: Details of how to obtain RAN Time Synchronization Status are discussed
in the solutions documented in clause 6 of this TR.
2\. TSCTSF may optionally cipher RAN Time Synchronization Status using a
common key for all RAN nodes across one or multiple tracking areas.
3\. TSCTSF invokes the Namf_Communication_NonUeN2MessageTransfer service
operation towards the AMF to request the transfer of RAN Time Synchronization
Status to an NG-RAN node. TSCTSF includes the Network RAN Time Synchronization
Status and the target NG-RAN node identity.
4\. AMF provides RAN Time Synchronization Status to the NG-RAN node indicated
by TSCTSF.
5\. RAN broadcasts the RAN Time Synchronization Status.
6.- UEs receive the RAN Time Synchronization Status provided in SIB. If the
reference time quality information is ciphered and the UE has been provided
with the ciphering key (see clause A.1.4.1.2), the UE deciphers the reference
time quality information.
NOTE 2 Similar as for the existing broadcast of assistance data for location
services, it is assumed that UEs, which support receiving RAN Time
Synchronization Status will be mandated, e.g. configured by upper layers, to
ensure having a valid version of the SIB that will contain RAN Time
Synchronization Status in RRC_IDLE and RRC_INACTIVE. (See also clause 5.2.2.1
of TS 38.331 [5] for further details on SIB handling by the UE for broadcast
of assistance data for location services).
#### A.1.4.1.2 Delivery of ciphering keys to UEs for broadcast of RAN Time
Synchronization Status
This procedure is used by the TSCTSF and the AMF to distribute ciphering keys
to UEs to enable UEs to decipher RAN Time Synchronization Status ciphered by
TSCTSF.
Figure A.1.4.1.2-1: Delivery of Ciphering Keys to UEs for broadcast of RAN
Time Synchronization Status
1\. TSCTSF provides AMF with one or more ciphering keys used to cipher RAN
Time Synchronization Status information according to the procedure in clause
A.1.4.1.1.1. For each ciphering key, TSCTSF includes a ciphering key value, a
ciphering key identifier, a validity period, and a set of applicable tracking
areas.
2\. The AMF stores the ciphering keys including the validity periods and
applicable tracking areas.
3\. A UE sends a Registration Request. The Registration Request may be sent as
part of normal mobility management, a Registration Request may also be sent
specifically to request and obtain ciphering keys. The UE includes in the
Registration Request an indication that ciphering keys are requested.
4\. The AMF returns a Registration Accept to the UE as defined in TS 23.502
[3]. If the Registration Request includes the indication that ciphering keys
are requested and the UE is subscribed for time synchronization services or
AMF has received a request from TSCTSF to activate access stratum time
synchronization for the UE, then AMF includes in the Registration Accept one
or more ciphering keys applicable to the UE\'s current tracking area. AMF also
includes for each ciphering key the ciphering key value, the ciphering key
identifier, the validity period and the set of applicable tracking areas.
#
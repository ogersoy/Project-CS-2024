# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The scope of this Technical Report is to study the enhancement of 5G System to
support Personal IoT Network (PIN). The study addresses the service
requirements documented in TS 22.261 [5] for the Personal IoT Networks. The
following aspects needs to be studied:
\- Architecture enhancement:
\- To study the potential architectural enhancements for supporting management
of PIN, access of PIN via PIN Element with Gateway Capability (PEGC), and
communication of PIN (e.g. PIN Element communicates with other PIN Elements
directly or via PEGC or via PEGC and 5GS).
\- To study the potential architecture enhancements for supporting identifying
PIN and the PIN Elements.
\- Security related:
NOTE: The study may need cooperation with SA3. If solutions are related to
security impact, they will be studied in SA WG3.
\- To study how to identify PIN and the PIN Elements in the PIN at 5GC level
to serve for authentication/authorization.
\- Management as well as policy and routing control enforcement:
\- To study the management of a PIN.
\- To study the procedures for PIN discovery, PIN Element discovery.
# 2 References {#references-1}
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G system, Stage 2\".
[4] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System\".
[5] 3GPP TS 22.261: \"Service requirements for the 5G system; Stage 1\".
[6] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System
(5GS)\".
[7] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[8] 3GPP TS 23.316: \"Wireless and wireline convergence access support for the
5G System (5GS)\".
[9] 3GPP TS 24.502: \" Access to the 3GPP 5G Core Network (5GCN) via Non-3GPP
Access Networks (N3AN); Stage 3\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1], in
TS 23.501 [2] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1] or in TS 23.501 [2].
**Personal IoT Network:** A configured and managed group of PIN Element that
are able to communicate each other directly or via PIN Elements with Gateway
Capability (PEGC), communicate with 5G network via at least one PEGC, and
managed by at least one PIN Element with Management Capability (PEMC).
**PIN Element:** A UE or non-3GPP device that can communicate within a PIN
(via PIN direct connection, via PEGC, or via PEGC and 5GC), or outside the PIN
via a PEGC and 5GC.
**PIN Element with Gateway Capability:** A PIN Element with the ability to
provide connectivity to and from the 5G network for other PIN Elements, or to
provide relay for the communication between PIN Elements.
**PIN Element with Management Capability:** A PIN Element with capability to
manage the PIN.
NOTE: A PIN Element can have both PIN Management Capability and Gateway
Capability.
**PINE-to-PINE communication:** communication between two PINEs which may use
PINE-to-PINE direct communication or PINE-to-PINE indirect connection.
**PINE-to-PINE direct connection:** the connection between two PIN Elements
without PEGC, any 3GPP RAN or core network entity in the middle.
**PINE-to-PINE indirect connection:** the connection between two PIN Elements
via PEGC or via UPF.
**PINE-to-PINE routing:** the traffic is routed by a PEGC between two PINEs,
the two PINEs direct connect with the PEGC via non-3GPP access.
**PINE-to-Network routing:** the traffic is routed by a PEGC between PINE and
5GS, the PINE direct connects with the PEGC via non-3GPP access separately.
**Network local switch for PIN:** the traffic is routed by UPF(s) between two
PINEs, the two PINEs direct connect with two PEGCs via non-3GPP access
separately.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1], in TS 23.501 [2] and the following apply. An abbreviation defined in the
present document takes precedence over the definition of the same
abbreviation, if any, in TR 21.905 [1] or in TS 23.501 [2].
PIN Personal IoT Networks
PINE PIN Element
PEGC PIN Elements with Gateway Capability
PEMC PIN Elements with Management Capability
P2P PINE-to-PINE
P2N PINE-to-Network
NLSP Network local switch for PIN
# 4 Architectural requirements and assumptions
## 4.1 Architectural Requirements
This study has following architectural requirements:
\- If sidelink is used for the direct communication between PEMC and PEGC,
reuse procedures defined for 5G ProSe Direct Communication without introducing
new features to sidelink.
\- There shall be no change to underlying non-3GPP access (e.g. WIFI,
Bluetooth) standards.
## 4.2 Architectural Assumptions
This study has following architectural assumptions:
\- Only a 3GPP UE can act as PEGC and/or PEMC.
\- There are one or more PEGCs in a PIN.
\- There are one or more PEMCs in a PIN, at any point of time one of which is
able to control the PIN.
\- The PIN Elements assumes to use non-3GPP access (e.g. WIFI, Bluetooth) for
direct communication, the PEMC can use 5G ProSe Direct Communication for
direct communication with PEGC.
\- In this release, the PEGC and PEMC belongs to same PLMN or (S)NPN.
\- The scenario when a PEGC or PEMC or both are in roaming is out of the scope
of this release.
\- A single PEGC may support more than one PIN at a time.
\- Multi-hop P2P (i.e. communication between a chain of PINEs) and P2N relay
(i.e. communication from a PINE to another PINE or to the network via an
intermediate PINE) are not studied in this release.
Editor\'s note: Whether PINE can connect to multiple PEGCs is FFS.
NOTE: In this Release the 5G-RG is considered outside the scope of the study
and consequently not part of PIN.
Editor\'s note: It is FFS whether data traffic of PINE over control plane is
in scope of this study.
Editor\'s note: Whether PINE UE is restricted to be in the same PLMN/(S)NPN as
PEGC/PEMC or not is FFS.
# 5 Key issues
## 5.1 Key Issue #1: 5GC architecture enhancements to support PIN
### 5.1.1 Description
It is required that at least one PEGC is in a PIN. A PINE may be a non-3GPP
device, or can be a UE. There are one or more PEMCs for a PIN, at any point of
time one of which is able to control the PIN, e.g. create/delete a PIN,
add/remove a PINE for the PIN, etc.
The following aspects will be studied:
\- Whether additional 5GC function(s) and/or interface(s) are needed for
supporting identification of PIN and PIN Elements, management of PIN, access
of PIN via PEGC and communication of PIN.
\- Define the architecture of the PIN.
NOTE: If new function(s) or new interface(s) are introduced in solution
proposals addressed to other key issues, the architecture proposal needs to be
addressed in this key issue, and those solutions needs to indicate the
architecture proposal addressed to this key issue.
## 5.2 Key Issue #2: PIN and PIN Element discovery and selection
### 5.2.1 Description
The PIN discovery is used for a UE or non-3GPP device to discover a PIN. PINE
discovery is used for a UE or non-3GPP device to discover the PIN Elements
(i.e. PINE, PEGC, and PEMC).
Following issues need to be addressed in this key issue:
\- How to discover and select a PIN.
\- How to discover and select PEGC and PEMC.
\- How to discover PINEs in a PIN based on criteria, for example, the
capability, availability, reachability and services (e.g. printer).
\- How to enable and manage the discovery for all possible case, for example,
whether a PINE is discoverable by UEs or non-3GPP devices that have not joined
the PIN yet or by other PINEs of the same PIN.
## 5.3 Key Issue #3: Management of PIN and PIN Elements
### 5.3.1 Description
This key issue intends to support the management of the PIN, including the
management of different types of PINEs and the configuration of the PIN. Both
the network operator and authorized 3rd party, i.e. PEMC could create and
configure the PIN and its elements.
After a PIN has been created, PEMC can add a PEGC into the PIN, or remove a
PEGC from the PIN, as well as add a PINE into the PIN and associate it to some
PEGCs that have already been added into the PIN, or remove a PINE from the
PIN.
The Key Issue is to study the following aspects in the 5GS:
\- How to support mechanisms for network operator or authorized 3rd party
(e.g. a PEMC) for PIN management, e.g.
create/modify/delete/activate/deactivate a PIN, etc.
\- How to support for the management of PINEs, including to add/remove the
PINEs, as well as the association between PEGC and other PINEs.
\- How to support establishing and enforcing the validity duration and the
time validity of a PIN (e.g. the PIN is valid for 30 minutes, the PIN is valid
from 15:00 UTC to 23:00 UTC) and of the PINEs in a PIN (e.g. the PINE will be
member of PIN for 1 hour, the PINE will be member of PIN from 16:00 UTC to
17:00 UTC).
## 5.4 Key Issue #4: Communication of PIN
### 5.4.1 Description
The PIN connectivity supports communications between PINEs directly,
communications between PINEs via PEGC, communications between PINEs via PEGC
and 5GS, and communications between PINE and services outside of the PIN via
PEGC and 5GS.
The PINE behind the PEGC may run an application with different QoS
requirement, which may need the PEGC to have a corresponding QoS flow for
relaying the traffic.
Following issues need to be addressed in this key issue:
\- How to support communications between PINEs within a PIN.
\- How to enable a PINE to use a PEGC to communicate via 5GS.
\- Whether and how 5GS supports relay path management for a PINE when a PEGC
is used for the relay, e.g. including setup and release.
\- How to select communication path for communication between PINEs, e.g.
direct communication, via PEGC, via 5GS.
\- Whether and how 5GS supports the policy and QoS differentiation for the
traffic relayed between a PINE and 5GS when a PEGC is used for the relay.
## 5.5 Key Issue #5: Authorization for PIN
### 5.5.1 Description
The owner of a PIN may configure authorization information for the PIN, e.g.
whether a PINE can communicate with other PINEs or with a specific data
network, whether a UE is allowed to act as a PEMC and/or a PEGC, etc.
The following aspects will be studied:
\- How to support authorization in a PIN, including following aspects:
\- How to authorize/deauthorize a PINE to access 5GS service.
\- How to authorize/de-authorize PEMC to manage the PIN.
\- How to authorize/de-authorize PEGC to provide connectivity to and from the
5G network for other PINEs that is not capable to access the 5G network,
considering the case when there are multiple PEGC capable UEs present in a
specific PIN.
\- How to enforce the authorization result for a PIN.
## 5.6 Key Issue #6: Policy and parameters provisioning for PIN
### 5.6.1 Description
In order to support the necessary procedures regarding to PIN, e.g.
communication between PINEs, PINE/PEGC/PEMC discovery, authorization for
PINE/PEGC/PEMC, necessary policy/parameters configuration are needed.
The following aspects will be studied:
\- Whether and how the PIN related policy and parameter(s) identified in the
other KIs for PIN discovery, PINE discovery, authentication/authorization for
PINE and PIN communication are configured to the PEMC, PEGC and PINE.
\- Whether and how 5GC supports provisioning of configuration information to
PEGC for access control.
## 5.7 Key Issue #7: Identification of PIN and PIN Elements
### 5.7.1 Description
The key issue focuses on potential enhancements needed to support
identification of PIN and PINEs. The following aspects will be studied as part
of the key issue:
\- How to identify a PIN and who manages the PIN identity. Whether and what
characteristics of a PIN shall be known to the 3GPP network (e.g. type of PIN
(wearable, home automation, factory etc.), max of PIN elements in the PIN,
etc.).
\- How to support identifying PINE, PEGC and PEMC, and whether and how the 5GS
manages the identifier.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
+-------+-------+-------+-------+-------+-------+-------+-------+ | | Key | | | | | | | | | I | | | | | | | | | ssues | | | | | | | +=======+=======+=======+=======+=======+=======+=======+=======+ | Solu | 1 | 2 | 3 | 4 | 5 | 6 | 7 | | tions | | | | | | | | | | 5GC | PIN | Manag | Com | Aut | P | Iden | | | ar | and | ement | munic | horiz | olicy | tific | | | chite | PIN | of | ation | ation | and | ation | | | cture | El | PIN | of | for | param | of | | | en | ement | and | PIN | PIN | eters | PIN | | | hance | disc | PIN | | | pr | and | | | ments | overy | Ele | | | ovisi | PIN | | | to | and | ments | | | oning | Ele | | | su | sele | | | | for | ments | | | pport | ction | | | | PIN | | | | PIN | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0A | X | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0B | X | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0C | X | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0D | X | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 0E | X | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 1 | | X | X | | X | | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 2 | | X | X | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 3 | | X | | | | | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 4A | | X | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 4B | | X | | | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | | | X | X | X | X | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 6 | | | X | | X | | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 7 | | | X | X | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | | | X | | X | X | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 9 | | X | X | | X | X | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 10 | | | X | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 11 | | | | X | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 12 | | | | X | | X | X | +-------+-------+-------+-------+-------+-------+-------+-------+ | 13 | | | | X | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 14 | | X | | | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 15 | | X | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 16 | | | | X | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 17 | | | | X | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 18 | | | | X | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 19 | | | | X | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 20 | | | X | X | | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 21 | | | | | X | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 22 | | | | | X | | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 23 | | | | | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 24 | | | | | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 25 | | | | | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 26 | | | | | | X | | +-------+-------+-------+-------+-------+-------+-------+-------+ | 27 | | | X | | | | X | +-------+-------+-------+-------+-------+-------+-------+-------+
## 6.0A Solution #0A: 5GC architecture enhancements to support PIN
### 6.0A.1 Description
The solution describes the following 5G Core architecture enhancements to
support PIN:
1\. Additional 5GC functions and interface needed for supporting
identification of PIN and PIN Elements, management of PIN and PIN access via
PEGC.
2\. Architecture of the Personal IoT Network.
More than 500 billion IoT devices are expected to be on the internet by 2030,
to organize and manage these Personal IoT Network (PIN) from the 5G core, this
solution proposes to add a new network function, which can push the operator
and 3rd party policies such as add/remove PIN, add/delete PIN element from the
PIN etc. For the network to control the PIN and the PIN elements, PEMC of the
PIN should register itself to the 5GC and indicate that it is capable of
organizing PIN networks. Based on the policies the new Network function
(PINCTRL) on the 5GC will acknowledge the PEMC duly. PINE can access the 5G
network through PEGC, which is registered as PIN capable with the 5G network.
This solution proposes an architecture and protocol enhancement so that the
operator and 3rd party can fine grain control the PINE and PIN management
features. This solution also proposes a way to address PIN elements of PIN
from 5GC.
### 6.0A.2 Procedures
#### 6.0A.2.1 5GC architecture enhancements to support PIN
This solution addresses KI#1 and describes the 5GC architecture enhancements
to support PIN.
This solution proposes to add PINCTRL (PIN Ctrl Function) - a new Network
Function- and new interfaces P1 and N~PINCTF~ to manage and organize PIN
network as shown in Figure 6.0A.1.2-1. PEMC/PEGC communicates with the PINCTRL
of 5GCore network using P1 reference points for Authorization, 3rd
party/Operator policies etc. This solution proposes PINCTRL to be part of SBI
bus of the 5G core architecture and communicates with the other NF(s) using
N~PINCTRL~ interface. PEMC forms the PIN Network and PEMC/PEGC communicates to
the 5Gcore on behalf of PIN elements.
Figure 6.0A.2.1-1: 5GC architecture enhancements to support PIN
#### 6.0A.2.2 Additional Reference points
This solution proposes to add the following new reference points to the 5G
Architecture:
**P1:** Reference point between PEMC/PEGC to PIN CTRL Func.
**N~PINCTF~:** Reference point between PIN CTRL Func and SBA bus.
#### 6.0A.2.3 Additional Network Functions and Entities
This solution proposes to add the following new Network Functions and Entities
to the 5G System:
PINCTRL: PIN Control Function, a Network Function that is dedicated for
following PIN functions:
1) Authorizes PEMC/PEGC to form the PIN.
2) Maintains and Updates PIN Information and List of PIN elements with PIN
Capabilities such as Name, Address, assigned PEGC, 5G system accessible, Type
of PINE such as printer, headset, Thermostat, etc.
3) Acknowledges PIN_List from/to PEMC.
4) Accepts Operator or 3rd party PIN Rules.
5) Pushes Operator\'s policy to the PIN network.
PINE (Personal IoT Network Element): A PIN Element that can communicate within
the PIN network or to the 5G network via PEGC.
PEGC (PIN Element with Gateway Capability): A PIN Element with the ability to
provide connectivity to and from the 5G network for the other PIN Elements or
provide relay for the communication between PIN Elements.
PEMC (PIN Element with Management Capability): A PIN Element with capability
to manage the PIN.
#### 6.0A.2.4 Personal IoT Network Architecture
Figure 6.0A.2.4-1: SBA Architecture for Personal IoT Network
This solution proposes Service Based Architecture (SBA) for PIN discovery,
selection and communication in the Personal IoT Network. In this SBA, this
solution uses consumer, producer and broker model for the PINE to register and
provide its services to other PINE and discover services of other PINE in the
PIN as shown in Figure 6.0A.1.5-1. The PINE in the PIN, communicates among
each other using Request-Response and subscribe-notify mechanism.
This solution assumes that the PIN Elements in a PIN network are reachable via
a wireless link such as Wi-Fi, Bluetooth, WiGi etc. and the procedure to form
a reachable PIN network at wireless link is out of scope of this document.
PEMC acts as a broker in the service and producer model with PINE/PEGC service
repository function. Higher layer protocol such as http is used for internal
PIN communication and 5G NAS signalling is used to communicate with 5G systems
such as PIN registration. A device will discover a PEMC using Request-Response
broadcast message and register its services with the PEMC of the appropriate
PIN network. PINE with PEGC capability will register itself with the DNN and
then discover PEMC to register its gateway and other services.
Security and authentication of the PINE with the PEMC is described in the
solution for KI#5. PEMC will maintain a repository of the PIN elements
services and its FQDN or IP address. A PINE in the PIN will discovery other
PINE services and reachability from the PEMC for e.g. A PINE such as printer
or a UE with gateway functionality will register its FQDN and its services
with the PEMC. The PINE would query the PEMC for the printer or gateway
functionality and based on the management policies the appropriate FQDN and
its services of the printer and gateway is sent to the PINE. Management and
configuring policies are described in the solution for KI#3 and KI#6.
### 6.0A.3 Impacts on services, entities and interfaces
The solution largely re-uses existing functionality.
The solution has the following impacts:
Impact to the 5GCore:
\- Add New Network Function, PIN control function (PINCTRL), to the 5GCore.
\- Add New Interfaces P1 and NPINCTRL to the 5G system.
Impact to the UE (PEMC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to maintain a list of all the PINE and its supported services.
\- Ability to respond to PINE and its service discovery queries from the PINE.
Impact to the PINE:
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to request QoS using http request to the PEGC.
Impact to the UE (PEGC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to register its gateway functionality to PEMC.
\- Ability to accept http QoS request from the PINE and setup multiple PDU
session with the 5G System.
\- Ability to map PDU session ID to the IP address of the PINE and forward
packets to/from the corresponding PDU session.
## 6.0B Solution #0B: Architecture alternative B
### 6.0B.1 Description
This solution addresses Key Issue #1 \"5GC architecture enhancements to
support PIN\".
### 6.0B.2 Procedures
Figure 6.0B.2-1 depicts the reference architecture for the solution. The PIN
functions are defined in architecture assumption clause 4.
Figure 6.0B.2-1: Solution reference architecture
The solution defines the following PIN functionalities:
\- **PIN Element Function (PEF)** which represents the functionalities
providing the communication within the PIN (via PIN direct connection or via
PEGC), or outside the PIN via a PEGC. The PEF is able also to communicate with
the PEMC for been configured, for discovery and for authentication and
authorisation.
\- **PIN Element Gateway Capability Function (PEGCF)** which represents the
functionality providing the connectivity to and from the 5G network for other
PIN Elements, or provide relay for the communication between PIN Elements.
**\- PIN Element Management Capability Function (PEMCF)** which represents the
functionality providing the capability to manage the PIN.
\- **PIN Network Function(P-NF)** is a 5GC NF and represents the functionality
providing the capability to manage the PIN in 5GC, e.g. processing the request
of creating PIN, choosing a UE to be a PEMC and distribute a PIN ID to
identify a PIN, etc.
Editor\'s note: Security and privacy aspects of PIN identifier is FFS and is
left to SA WG3.
The following definitions also apply:
\- The PINE is a device supporting the PEF.
\- The PEGC is an UE supporting the PEGCF
\- The PEMC is an UE supporting the PEMCF
A UE can support both PEGCF and PEMCF, furthermore a UE can support the PEF
function in order to exchange data information and/or provide PIN services to
other PINE in the PIN.
The PINE per assumption can use the non-3GPP access (e.g. WIFI, Bluetooth) for
direct communication to other PINE, PEGC and PEMC so the following type of
device that contain the PEF are considered:
1) A Non-3GPP device, i.e. a device that does not support 3GPP Access or N3GPP
Access to 5GC, but supports PEF. e.g. a device that uses Bluetooth or Wi-Fi
communication.
2) A UE that supports N3GPP Access to 5GC (i.e. N3IWF). The UE is restricted
to only use the N3GPP interface for PIN direct communication.
Editor\'s note: Whether the device not supporting PIN Element Function (PEF)
can participate to PIN network, e.g. as today when the UE share the 5G
connection via WiFi, is FFS.
The following reference points are defined:
\- P1 reference point between the PINE device(s).
\- P2 reference point between the PEGC and PEMC device(s).
The P1 and P2 reference points are supported over Peer-to-Peer (P2P)
transports, e.g. Bluetooth, Wi-Fi, The P2 reference point also supports 5G
Prose Direct Communication (i.e. UE-to-UE communication).
The following Service-based interfaces are defined:
**Npinf:** Service-based provided by the P-NF.
**Npaf:** Service-based provided by AF dedicated to PIN network.
Figure 6.0B.2-2 shows the typical implementation layers involved in a PIN
network, the P2P transport and physical layer (e.g. Bluetooth, wifi, 54G
ProSe..) the PIN layer which includes the PIN functionalities (i.e. the PEF,
PEGC, PMEC) and the application layer which is out side the scope of 3GPP.
The device capable of participating in the PIN the PEF, PECGF, PEMCF and the
Peer-to-peer transport layer.
The figure 6.0B.2-3 shows the user plane protocol stack for PINE for the
scenario of transport of user application data to DNN via PEGC, e.g. web
browsing to the internet DNN, for the user application can be also the PIN
application which communicates transparently via user plane with the PIN AF.
The figure 6.0B.2-4 shows the control plane communication between the PINEs
and between the PINE and the PEGC. Figure 6.0B.2-5 and Figure 6.0B.2-6 show
the user plane and control plane between PEMC and PEGC respectively.
Editor\'s note: The definition of the PIN layer protocol is left to stage 3.
Figure 6.0B.2-2: Solution 6 Functional layer
Figure 6.0B.2-3: PINE user plane protocol stacks for communication towards PIN
AF in DNN via PEGC via 5GC user plane
Figure 6.0B.2-4: PINE control plane protocol stacks
Figure 6.0B.2-5: PEGC and PEMC user plane protocol stacks
Figure 6.0B.2-6: PEGC and PEMC control plane protocol stacks
### 6.0B.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
## 6.0C Solution #0C: Architecture alternative C
### 6.0C.1 Description
This solution addresses Key Issue #1 \"5GC architecture enhancements to
support PIN\".
### 6.0C.2 Procedures
#### 6.0C.2.1 Overview of architecture
##### 6.0C.2.1.1 General
The following figure 6.0C.2.1.1-1 depicts the overview of architecture for
PIN.
NOTE 1: The PEMC can be a PINE when relayed by PEGC for visiting 5GS.
NOTE 2: The PEMC can also be a PEGC.
NOTE 3: The Pin1 interface can over direct connection, via PEGC, or via PEGC
and 5GC. The Pin2 interface is over direct connection. The Pin5 interface can
over direct connection, or via 5GC.
Figure 6.0C.2.1.1-1: Overview of architecture
##### 6.0C.2.1.2 Signalling and traffic path of PIN
The figure 6.0C.2.1.2-1 depicts the signalling path of different interfaces of
PIN, the figure 6.0C.2.1.2-2 depicts the traffic path within PIN or between
PIN and outside services.
Figure 6.0C.2.1.2-1: Signalling path of PIN
Figure 6.0C.2.1.2-2: Traffic path of PIN
From above figure, **the 5G-LAN for PIN is needed only when traffic within PIN
is required**.
#### 6.0C.2.2 Deployment and use case example
The following figure 6.0C.2.2-1 depicts an example of current smart home
environment.
Figure 6.0C.2.2-1: Example of current smart home environment
The IoT device1 is initially discovered by a Smartphone using the 3rd party
APP1 installed in the Smartphone, and then the Smartphone is able to connect
with the IoT device1 assisted by the 3rd party APP1. The 3rd party APP1 is
developed by the vendor of the IoT device1. The IoT device1 is able to visit
the 3rd party Server1 over internet via the Smart Gateway, and the 3rd party
APP1 also can visit the 3rd party Server1 over internet, so that the
Smartphone is able to control the IoT device1 via internet assisted by the 3rd
party Server1. The IoT device2 is manufactured by a different vendor from that
of the IoT device1, and is not able to be controlled by a Smartphone via
internet.
The following figure 6.0C.2.2-2 depicts a deployment example of the PIN that
the PINMF can be a NF, trust AF, or 3rd party AF.
NOTE 1: The PEMC Function instance can be a function in a 3rd party APP, a
standalone APP, or middleware, the interface of the PEMC Function exposed to
other APPs is determined by CT WG1.
Figure 6.0C.2.2-2: Deployment example of PIN Functions
For the case of NF/trust AF, one operator only has one PINMF, the PEMC can use
pre-configured information for PIN service operations, e.g. FQDN of the
operator\'s PINMF. For the case of 3rd party AF, **there may be multiple
PINMFs** , which one is used determines by the user, and the serving PINMF
should register itself for the user to handle the PIN service operations. If
both PINMF as NF/trust AF and PINMF as 3rd party AF are deployed, which one is
used is determined by PEMC implementation.
In the deployment example, **the 3rd party APP and 3rd party Function can
assist the initial discovery and initial direct connection setup between
PINE/PEGC and PEMC without user input information**.
An example of the use case with the deployment example is as following:
1) The PINE/PEGC establishes direct connection with the PEMC assisted by the
3rd party APP1/APP2 and 3rd party Function1/Function2, which is the same as
currently widely used, or by user input.
NOTE: The interface exposed by PEMC Function to 3rd party APPs needs
coordination with CT WG1.
2) If the PEMC Function instance obtains the device metadata via the direct
connection, e.g. MAC address, vendor name, PINE Function Address, etc. from
PINE Function (Pin1) over direct connection, or device metadata, e.g. MAC
address, GPSI, vendor name, PEGC Function Address, etc. from PEGC Function
(Pin5) over direct connection. The PEMC Function instance registers the device
metadata to the PINMF (Pin3). The \ helps the PEMC to run the APP
developed by the vendor to control the PINE, e.g. turn on/off a light, tune
the temperature of an air conditioner, etc. The PINE/PEGC Function Address
makes it possible for any PEMC Function instance (e.g. when user changes cell
phone) to interact with the PINE/PEGC Function over direct connection
(Pin1/Pin5), via PEGC (Pin1), via 5GS (Pin5), or via PEGC and 5GS (Pin1).
3) Any PEMC Function instance requests the PINMF to create a PIN and obtains
device information, which includes the address of PINE/PEGC Function, from
PINMF (Pin3), the device may already be added into another PIN. The PEMC
Function instance requests the PINMF to add any device into the PIN (Pin3).
4) When adding a UE into the PIN to act as PEGC, if the UE identified by the
GPSI is pre-configured in the subscription data to be a PEGC, the PINMF
configuring \/\ to the PEGC (N1) for the PIN, if
not, the PINMF returns \ to the PEMC Function instance
(Pin3), and the PEMC Function instance sends the URI to the PEGC Function
(Pin5), the PEGC Function sends registration request to the PINMF (Pin4) to
request the PINMF configuring \/\ to the PEGC (N1)
for the PIN;
5) The PEMC Function instance obtains the SSID/BT ID and password of PEGCs
from PINMF for the PIN (Pin3) and sends them to the PINE (Pin1) for
configuring the PINE for discovery (PINE is listener), or obtains the SSID/BT
ID and password of PINEs from PINEs (Pin1) and sends them to the PINMF (Pin3)
to request the PINMF configuring the PEGC (N1) for discovery (PINE is
announcer);
6) After a PINE has been configured by the PEMC Function instance (Pin1) to
associated with PEGCs, the PINE connects to a PEGC to activate association
with the PEGC in the PIN. If the PINE has active association in another PIN,
the PINE will be automatically removed from that PIN.
7) When the 3rd party APP on PEMC needs to communicate with PINEs, the PEMC
Function sends the packet filters and necessary information to the PINMF
(Pin3), the PINMF determines that the PINE has connected to a PEGC and
instructs the 5GS to configure the PEGC for the relay, as well as instructs
5GS to establish a 5G-LAN that includes the PEMC and the PEGC, or add the PEMC
and PEGC into the existed 5G-LAN, so that the communication does not need any
Application Server for routing, which resolves the user concern related to
privacy issues.
8) When the PINE needs to communicates with other PINEs, the PINE Function
sends the packet filters and necessary information to the PEMC Function
instance (Pin1), if the PEMC Function instance allows the communication, it
requests the PINMF (Pin3) to configure PEGC(s) for the relay, and if multiple
PEGCs involved, the PINMF instructs 5GS to establish a 5G-LAN that includes
the PEGCs, or add the PEGCs into the existed 5G-LAN, so that the communication
does not need any AS for routing, which resolves the user concern related to
privacy issues.
#### 6.0C.2.3 Implementation examples without impact on PEMC
##### 6.0C.2.3.1 Example without PEGC OS impact
The following figure 6.0C.2.3.1-1 depicts an implementation example of the
PEMC, PEGC, and PINE, where the PEGC Function is above OS layer.
NOTE: Interface Pin2 is not shown.
Figure 6.0C.2.3.1-1: Implementation example - PEGC Function above OS layer
In this implementation example, the PEGC Function (1) above OS layer is like a
system APP in the UE, the UE does not need to customize OS to support PEGC,
but the PEGC Function (1) above OS layer is not able to interact with the PEGC
Function (2) in the Communication module when OS is not customized.
##### 6.0C.2.3.2 Example with PEGC OS impact
The following figure 6.0C.2.3.2-1 depicts another implementation example of
the PEMC, PEGC, and PINE, where the PEGC Function is in OS layer.
NOTE: Interface Pin2 is not shown.
Figure 6.0C.2.3.2-1: Implementation example - PEGC Function in OS layer
In this implementation example, the UE needs to customize OS to support PEGC,
which may not be proper for wearable scenarios, where smartphone that uses
common OS core acts as a PEGC, but this implementation example enables the
PEGC Function (1) in OS layer to interact with the PEGC Function (2) in
Communication module.
#### 6.0C.2.4 Control plane of PIN
##### 6.0C.2.4.1 PINE - PEMC (Pin1)
The following figure 6.0C.2.4.1-1 depicts the control plane between PINE and
PEMC over direct connection.
Figure 6.0C.2.4.1-1: Control plane of PINE - PEMC (over direct connection)
The following figure 6.0C.2.4.1-2 depicts the control plane between PINE and
PEMC, wherein PINMF is involved in the path of the control plane.
Figure 6.0C.2.4.1-2: Control plane of PINE - PEMC (with PINMF)
The following figure 6.0C.2.4.1-3 depicts the control plane between PINE and
PEMC, wherein PINE and PEMC is in a LAN.
Figure 6.0C.2.4.1-3: Control plane of PINE - PEMC (within LAN option)
##### 6.0C.2.4.2 PINE - PEGC (Pin2)
The following figure 6.0C.2.4.2-1 depicts the control plane between PINE and
PEGC, which is over direct connection.
Figure 6.0C.2.4.2-1: Control plane of PINE - PEGC
##### 6.0C.2.4.3 PEMC - PINMF (Pin3)
The following figure 6.0C.2.4.3-1 depicts the control plane between PEMC and
PINMF without PEGC involved.
Figure 6.0C.2.4.3-1: Control plane of PEMC - PINMF (without PEGC)
The following figure 6.0C.2.4.3-2 depicts the control plane between PEMC and
PINMF with PEGC involved.
Figure 6.0C.2.4.3-2: Control plane of PEMC - PINMF (with PEGC)
##### 6.0C.2.4.4 PEGC - PINMF (Pin4)
The following figure 6.0C.2.4.4-1 depicts the control plane between PEGC and
PINMF.
Figure 6.0C.2.4.4-1: Control plane of PEGC - PINMF
##### 6.0C.2.4.5 PEMC - PEGC (Pin5)
The following figure 6.0C.2.4.5-1 depicts the control plane between PEGC and
PEMC, wherein the PEMC and PEGC is connected over direct connection (non-3GPP
access or PC5) or via 5GC.
Figure 6.0C.2.4.5-1: Control plane of PEMC - PEGC (with LAN option and no
additional PEGC)
The following figure 6.0C.2.4.5-2 depicts the control plane between PEGC and
PEMC, wherein the PEMC and PEGC is connected via another PEGC and 5GC.
Figure 6.0C.2.4.5-2: Control plane of PEMC - PEGC (with LAN option and
additional PEGC)
The following figure 6.0C.2.4.5-3 depicts the control plane between PEMC and
PEGC, wherein PINMF is involved in the path of the control plane.
Figure 6.0C.2.4.5-3: Control plane of PEGC - PEMC (with PINMF)
#### 6.0C.2.5 User plane of PIN
##### 6.0C.2.5.1 PINE - PINE
The following figure 6.0C.2.5.1-1 depicts the user plane between PINEs.
NOTE: The PEGC may perform address transfer for source address of received PDU
over non-3GPP access before forwarding it over 3GPP access, and/or for
destination address of received PDU over 3GPP access before forwarding it over
non-3GPP access.
Figure 6.0C.2.5.1-1: User plane between PINEs
##### 6.0C.2.5.2 PINE - PEMC
The following figure 6.0C.2.5.2-1 depicts the user plane between PINE and
PEMC.
NOTE: The PEGC may perform address transfer for source address of received PDU
over non-3GPP access before forwarding it over 3GPP access, and/or for
destination address of received PDU over 3GPP access before forwarding it over
non-3GPP access.
Figure 6.0C.2.5.2-1: User plane of PINE - PEMC
##### 6.0C.2.5.3 PINE - external DN
The following figure 6.0C.2.5.3-1 depicts the user plane between PINE and
external DN.
NOTE: The PEGC may perform address transfer for source address of received PDU
over non-3GPP access before forwarding it over 3GPP access, and/or for
destination address of received PDU over 3GPP access before forwarding it over
non-3GPP access.
Figure 6.0C.2.5.3-1: User plane of PINE - external DN
#### 6.0C.2.6 Architecture reference model
The following figure 6.0C.2.6-1 depicts the reference architecture for PIN.
NOTE 1: The PINMF can be a NF or trust AF, or 3rd party AF, and can be
determined during conclusion phase.
Figure 6.0C.2.6-1: Reference architecture
#### 6.0C.2.7 Reference points
The PIN System Architecture contains the following reference points on
application level:
**Pin1:** Reference point between the PEMC and the PINE.
**Pin2:** Reference point between the PINE and the PEGC.
**Pin3:** Reference point between the PEMC and the PINMF, which is over user
plane of 5GS.
**Pin4:** Reference point between the PEGC and the PINMF, which is over user
plane of 5GS.
**Pin5:** Reference point between the PEMC and the PEGC, which is over
non-3GPP access or PC5.
#### 6.0C.2.8 Network Functions and entities
The PINMF (PIN Management Function) is a 3rd party/trusted AF or optionally an
NF that includes AF functionality.
The PINMF supports the following functionalities:
\- Assignment of IDs, including PEMC ID, PEGC ID, PINE ID, and PIN ID.
\- Registration of PINE, PEGC, PEMC.
\- Authorization of PEMC and PEGC.
\- Management of PIN for communication and topology.
\- Interworking with 5G NFs (e.g. PCF, UDM) for parameters provisioning to
PEGC for discovery and communication.
\- Storage of PINE, PEGC, and PEMC information and PINE-PEGC association
information.
\- Configuration to PINE and PEMC for discovery.
\- QoS control for PEGC and specific PINE traffic flow.
The PEMC supports the following functionalities:
\- Creation/modification of PIN.
\- Communication configuration for PIN.
\- Triggering PEGC to register to PINMF.
\- Handling PINE relay request.
The PEGC supports the following functionalities:
\- Relaying traffic for PINE according to parameters provisioned by 5GS.
\- Discovery PINE.
\- Access control and traffic enforcement for PINEs according to parameters
provisioned by 5GS.
The PINE supports the following functionalities:
\- Discovery and communication with PEGC.
\- Discovery and communication with other PINEs via PIN direct connection or
via PEGC relay path or outside the PIN via a PEGC relay path.
\- Interaction with PEMC for configuration and relay handling.
### 6.0C.3 Impacts on Existing Nodes and Functionality
The impacts are described in solutions addresses to KIs other than KI#1, e.g.
solution 8 and solution 12.
## 6.0D Solution #0D: Personal IoT Networks Architecture in 5GS
### 6.0D.1 Description
This solution addresses Key Issue #1 \"5GC architecture enhancements to
support PIN\".
### 6.0D.2 Procedures
#### 6.0D.2.1 Architecture of Personal IoT Networks in 5GS
Figure 6.0D.2.1-1 depicts the reference architecture of Personal IoT Networks
in 5GS.
Figure 6.0D.2.1-1: Personal IoT Networks Architecture in 5GS
#### 6.0D.2.2 Reference points
**P1:** Reference point between the PINE and the PEGC. This reference point is
based on non-3GPP access (e.g. WIFI, Bluetooth).
**P2:** Reference point between the PEMC and the PEGC. This reference point is
based on non-3GPP access (e.g. WIFI, Bluetooth) or 5G ProSe Direct
Communication.
**P3:** Reference point between the PEMC and the PIN Application Server. This
reference point can be based on the direct user plane path to 5GS, relay path
via the PEGC, or other communication path via Internet.
**P4:** Reference point between the PEGC and the PIN Application Server. This
reference point is based on the user plane path between PEGC and 5GS.
#### 6.0D.2.3 Network Functions and entities
The PIN Application Server (PIN AS) is an optional NF and includes AF
functionality can be deployed by mobile operator or an authorized third party.
When the PIN AS is deployed by third party, the interworking with 5GS need to
be transferred via NEF. PIN AS may support the following functionalities:
\- Registration management of PINE, PEGC, PEMC.
\- PIN management and PIN status management.
\- Storage of profile and context data of PIN.
\- Storage of profile and context data of PINE, PEGC, PEMC.
\- Configuration and parameters provisioning to PEGC, PEMC, PINE.
\- Supporting discovery of PIN, PINE and PEGC.
\- AF requested QoS control for PEGC and specific PINE traffic flow.
\- Interworking with 5G NFs (e.g. NEF, PCF, UDM, UDR) for provisioning of PIN
Service Parameters and requesting policy control.
The PEMC supports the following functionalities:
\- PIN management (create/modify/delete/activate/deactivate a PIN).
\- Supporting add/remove of PINE and PEGC.
\- Time validity management of PIN and PINE.
The PEGC supports the following functionalities:
\- Supporting the relay path between PINE and 5GS.
\- Supporting the traffic relay between PINEs.
\- Supporting the PINE discovery and status report.
\- Access control and traffic enforcement for PINEs.
\- Trigger the activation of communication path with the PINE for DL traffic.
\- Traffic routing for non-PIN capable devices.
The PINE supports the following functionalities:
\- Discovery and communication with PEGC.
\- Discovery and communication with other PINEs via PIN direct connection or
via PEGC relay path or outside the PIN via a PEGC relay path.
\- Device capability and status report.
\- Policy and parameters retrieval and local configuration.
### 6.0D.3 Impacts on Existing Nodes and Functionality
**PCF:** In addition to the functions defined in TS 23.501 [2], the PCF
includes the function to provision the SMF with PCC rules for PIN
communication.
**NEF:** For PIN Application Functions to provide service specific information
to the 3GPP network, the NEF supports additional PIN service parameters.
**UDR:** The UDR stores PIN Service Parameters provisioned by PIN AS, and
supports the exposure of PIN Service Parameters to the PCF.
## 6.0E Solution#0E: PIN architecture
### 6.0E.1 Description
This solution addresses Key Issue #1 \"5GC architecture enhancements to
support PIN\".
### 6.0E.2 Procedures
#### 6.0E.2.1 Architecture of Personal IoT Networks in 5GS
Figure 6.0E.2.1-1 depicts the reference PIN architecture without AF/AS
involved.
NOTE: PIN architecture without AF involved means that AF is not responsible
for PIN management. But PINE can access to the application server and also the
AF can influence the traffic as existing mechanism.
Figure 6.0E.2.1-1: PIN Architecture without AF involved
#### 6.0E.2.2 Reference points
**P1:** Reference point between the PINE and the PEMC. This reference point is
based on non-3GPP access (e.g. WIFI, Bluetooth).
**P2:** Reference point between the PINE and the PEGC. This reference point
can be based on the direct user plane path to 5GS, relay path via the PEGC, or
other communication path via Internet.
**P3:** Reference point between the PEMC and the PEGC. This reference point is
based on non-3GPP access (e.g. WIFI, Bluetooth) or 5G ProSe Direct
Communication.
#### 6.0E.2.3 Network Functions and entities
The main functions in PIN architecture above are following:
PEMC:
\- PIN management (e.g. create/modify/delete a PIN).
\- PINE management (e.g. add/remove PINE/PEGC).
\- Allocate PINE identifier for the PINE.
\- Storage of PIN profile data (e.g. PIN ID, PIN name, valid time, etc.).
\- Storage of PINE profile data (e.g. PINE ID, PINE type, PINE capability,
valid time, etc.).
\- Supporting the PINE/PIN discovery.
PEGC:
\- Supporting the relay traffic between PINE and 5GC.
\- Supporting the traffic relaying between PINEs.
\- Supporting the PIN discovery.
\- Access control and traffic enforcement for PINEs.
PINE:
\- Discovery and communication with PEGC.
\- Communication with other PINE directly, or via 5GC, or via PEGC.
UDM:
\- Allocate PIN ID associating with PEMC ID.
### 6.0E.3 Impacts on Existing Nodes and Functionality
The impacts are described in solutions addresses to KIs other than KI#1, e.g.
solution 9.
## 6.1 Solution #1: PIN and PIN element discovery and selection
### 6.1.1 Description
This solution mainly addresses the Key Issue#2 \"PIN and PIN element discovery
and selection\". This solution also addresses the Key Issue #7
\"Identification of PIN and PIN Elements\" that PEMC assigns PINE ID to a
PINE. This solution addresses part of Key Issue #3 \"Management of PIN and PIN
Elements\" that PEGC informs 5GC for being a member of a PIN.
The solution proposes method for PIN element discovery and PIN selection, PEGC
discovery in a PIN, discoverability of PIN elements in a PIN.
The following are the key aspects of the solution:
\- PIN elements discover a Personal IoT Network either by listening to
announcements from a PEMC or by querying for a PIN by its services.
\- A PIN could be configured to support either an open or a restricted
discovery.
\- A PIN element could set its discoverability level within a PIN.
\- A PEGC assignment is performed by PEMC.
### 6.1.2 Procedures
#### 6.1.2.1 PIN discovery and selection
##### 6.1.2.1.1 PIN setup with PIN elements
A PIN element offers one or more of PIN Services (these are corresponding to
the functionality offered by the PIN element, some examples are audio output
device, printer device, display device etc). A PIN might be configured to
support only specific services.
There are two methods by which PIN elements discover and join a PIN.
Both methods are running on top of Non-3GPP (Bluetooth or WiFi) connections or
on top of NR PC5 Direct Communication.
NOTE: NR PC5 applies only for PIN elements with Gateway Capability and PIN
elements with Management Capability.
Figure 6.1.2.1.1â€‘1: PIN Element function
The first step is to discover PIN element functions on devices that are
connected using any of these methods. The following call flow explains the two
methods of PIN element (PIN E) discovery.
Figure 6.1.2.1.1â€‘2: PIN discovery
**Method 1:**
In this method, PEMC periodically sends PIN related information and waits for
a response within a time window. The announced information includes PIN
identifier, PIN services offered (including services over 5GS), PIN Class
(open to all or restricted), time window within which PEMC expects join
requests from PIN elements.
A PIN is created by PEMC. PEMC periodically announces PIN parameters. This
could be transmissions on multiple connections (Bluetooth links) or broadcast
(WiFi, PC5)
PIN elements receive the announcement from PEMC and depending on their local
configurations decide whether to join the PIN or wait for another PEMC
broadcast. For joining the PIN, a PIN element sends PIN Join Request. This
contains the services the PIN element offers in the PIN and also whether PIN
element can be discovered by other PIN elements within the PIN or externally.
The PIN Join request can also carry security credentials which enables PEMC to
successfully validate a PIN element and adds it to the PIN.
A PIN Join Accept is sent by the PEMC through which the PIN element is
informed of its PIN Element Identifier. The PIN Join Accept also include PIN
Element Identifier for PEGC applicable for this PIN element.
**Method 2:**
In the second method, a PEMC, after it has been authorized by 5GC for PIN
operation, begins to monitor incoming queries for PIN services. Depending on a
local configuration or an announcement of PEMC information, e.g. PEMC or PEGC
ID, a PIN element sends out a query to the PEMC and waits for response. PEMC
announces PIN related information. This includes PIN identity, PIN services,
PIN Class (open to all or restricted), time window within which PEMC expects
\"PIN Join\" requests from PIN elements. PIN element then sends a PIN Join
request as described for Method 1.
Editor\'s note: Whether the protocol of the PIN layer is defined by 3GPP or it
uses IETF protocols or part of Prose signalling is FFS.
##### 6.1.2.1.2 Open and restricted PIN discovery
There are three broad classes of PIN:
1\. Private PIN (e.g. home network).
2\. Public PIN (e.g. shopping mall).
3\. Personal Body area PIN (e.g. smart watch, smart glasses).
PIN supports two types of discovery - open and restricted discovery. In an
open discovery any PIN element can attempt to join the PIN. The restricted
discovery allows only PIN elements which have been configured with the PIN
information to join. This configuration could be based on user input or local
configuration in devices.
#### 6.1.2.2 Discoverability by other PIN elements
A PEMC offers a lookup service, where in a PIN element (either a member of the
PIN or one that has not yet joined the PIN) is able to query for a PIN element
identifier corresponding to a service.
A PIN element can set its visibility when joining a PIN. PIN elements can also
indicate whether they want to share their information to other elements by
PEMC. PIN element visibility can be set to {Private = PIN element cannot be
looked up by other PIN elements}, {Restricted = PIN element can be discovered
by other members of the PIN}, {Public= PIN element can be discovered by anyone
querying for it, irrespective of whether they are a member of the PIN or not}.
Figure 6.1.2.2â€‘1: PIN element discovery
#### 6.1.2.3 Discovery and selection of PEGC
A UE capable of PEGC functionality is authorized for PIN operation by the 5GC.
A PEGC joins a PIN as a PIN element using either of the above methods. Along
with the services, it also indicates in the PIN Join request that it is
capable of functioning as a PIN Gateway.
Figure 6.1.2.3â€‘1: PEGC selection
A PEMC selects a PEGC depending on whether it is trusted by PEMC. This could
be from pre-configurations. A PEMC can be pre-configured with certain UE
identifiers for potentially suitable PEGC (3GPP identifiers e.g. SUCI or GPSI
are used to identify trusted PEGCs). A PEMC can also query within a PIN to
find any pre-configured UE that can function as PEGC in the PIN.
PEMC assigns the role of PEGC by sending PEGC Assign Request to a PIN element
capable of Gateway function. Once the PIN element accepts the PEGC assignment,
it responds with PEGC Assign Accept. PEGC informs the membership of a PIN to
the 5GC in PDU Session Establishment/Modification by including the PIN
identifier for which it is acting as a PIN Gateway.
A PEGC can also indicate to the PEMC that it wants to stop functioning as a
Gateway. This could be due to power consumption limitations or moving out of
coverage of cellular network. In this case, PEGC sends a PEGC Release Request
to PEMC. The PEMC will run the PEGC selection procedure again and confirms the
role change to the former PEGC with PEGC Release Confirm.
### 6.1.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
UE: implements the PIN Element Function protocol.
## 6.2 Solution #2: PIN and PINE discovery and selection
### 6.2.1 Description
#### 6.2.1.1 General
This solution is based on the architecture alternative A describe in clause
6.0A.
#### 6.2.1.2 Functional description
This solution mainly addresses KI#2 and describes the PINE services discovery
and selecting PEMC, PEGC and PINE functionality in the PIN network. This
solution also addresses part of KI#3 for management of the association between
PINE and PEGC.
Figure 6.2.1.2-1: PIN and PIN element discovery and selection
This solution assumes that the PIN elements are connected to a wireless LAN/
PAN network and each element are reachable via the wireless link. The
procedure to connect to the wireless network and assign IP address is out of
the scope of this document.
**[PEMC Identification:]{.underline}** A NAS capable UE will register with the
5GS with \"PIN capable\" in the initial registration message to be authorized
to form the PIN. 5GC architecture enhancements to support PIN are described in
the solution for KI#1. Based on the \"PIN control function\" policies, the 5G
core will authorize/deny the PIN formation. PIN element is identified as PEMC
either by the 5GC policies or by 3^rd^ party configuration. A PIN element with
management capability (PEMC) can form a PIN and it can name the PIN based on
the configuration. PEMC of the PIN will act as a broker in the proposed SBA
architecture and respond to the PIN discovery query by the PINE or PEGC as
shown in Figure 6.2.1.2-1 (a). PEMC will be NAS capable, and the policies and
its capabilities are configured by the 5G core network. Policy and
Provisioning for PIN are described in solution for KI#5.
**[PEMC Discovery:]{.underline}** This solution assumes that the PIN Elements
in a PIN network are reachable via a wireless link such as WiFi, Bluetooth,
WiGi etc. A device intending to join a PIN network will broadcast an http
message for PIN discovery, and PEMC, when active, will respond to the query
with PIN name and its capabilities as shown in Figure 6.2.1.2-1 (b). Once a
device discovers the PIN networks and decides to join the PIN network based on
the PINE local configuration. The device will authorize and register its
services with the PEMC as described in solutions to KI#5.
**[PEMC discovery Broadcast message:]{.underline}** This solution uses IP
broadcast message to discover PEMC. Unlike conventional http over TCP, this
solution proposes to send an Http discovery message over UDP + IP broadcast
address, so that all the devices connected wirelessly get the http-based
broadcast message. PIN elements can discover PEMC by broadcasting this http
discovery broadcast message and the appropriate all PEMC of different PIN will
respond to the queries. Similarly, PEMC will periodically and upon successful
PIN registration will send http-based discovery message to all the wirelessly
connected devices.
**[PIN Elements Discovery:]{.underline}** The registered PINE can discover
other PINE using the PINE discovery query to the PEMC (broker) as shown in
Figure 6.2.1.2-1 (b). The PEMC will respond to the query with the list of all
the devices, services and its FQDN or IP address. PIN elements can subscribe-
notify for an event with the PEMC for example if a PINE wants to be notified
when a PEGC or PINE with certain capabilities such as printer, scanner etc.
joins the PIN.
**[PEGC Selection and Discovery:]{.underline}** UE capable of NAS will
register itself with the 5GC using registration procedure given in TS 23.501
[2]. The UE will then discover the PIN using the PIN discovery query, will
authenticate and register its gateway services with the PEMC. The PEMC will
notify the subscribed PIN elements and it will include PEGC producer in the
all the future PINE discovery queries. PEMC will assign PEGC to appropriate
PINE based on the policies and notify both PINE and PEGC about their
association.
Editor\'s note: The scenario of PEGC and PEMC not in same location is FFS
### 6.2.2 Procedures
Editor\'s note: Detailed procedure is FFS.
### 6.2.3 Impacts on services, entities and interfaces
The solution largely re-uses existing functionality
The solution has the following impacts:
Impact to the UE (PEMC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features
\- Ability to maintain a list of all the PINE and its supported services
Impact to the UE (PINE/PEGC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features
Impact to the 5G System:
\- Add new Network Function (PINCTL) to the NAS in 5GS
\- Add new fields to the Registration request such as \"PIN capable\"
\- Add new fields to the Registration Accept message such as \"PIN
allowable\", \"PIN Name\"
## 6.3 Solution #3: Solution for PIN and PIN Elements discovery and selection
### 6.3.1 Description
This solution addresses Key Issue #2 \"PIN and PIN Element discovery and
selection\".
This solution assumes the PINE is configured with basic information to select
the PEMC as part of KI#6. Thus, PINE is able to select the PEMC and send the
PIN_join request to join the PIN.
The PIN_join message contains the PIN Information as described in the clause
6.3.3.
Based on the PIN information and available subscription information with PEMC,
the PEMC decides whether to add the PINE into the PIN, in response PEMC may
provide PEGC_name to the PIN in PIN_join_response command, if PINE has to be
added to the PIN.
Whether the PINE is authorised to join the PIN is decided by a solution to
KI#5, and how the PINE is joined into the PIN is described using the solution
to KI#3.
### 6.3.2 Procedures
Figure 6.3.2-1: PIN and PIN Elements discovery and selection
0) The PINE is configured with PIN information (see below) either by 5GC (as
part of KI#6), or by the authorised user. The PINE is configured with
PEMC_name (e.g. FQDN or address, in general the identifier of the PEMC) either
by the 5GC or the authorised user.
1) PINE sends PIN_join message to the PEMC including the PIN information (see
below) to the PEMC.
1a) if the required PIN information for e.g. the requested service in the PIN
information is not offered by any of the PINs then PEMC may choose to perform
announce procedure as described in solution 1 additionally PEMC will
broadcasted the required PIN information for e.g. the requested service, based
on if any PINE which offers the PIN information for e.g. requested service
joins the PIN the step 2a or step 2b are executed.
2a) PEMC based on the PIN information decides whether to add the PINE in the
respective PIN. If authorization of the PINE is successful following the
solution selected as part of the KI#5, the PINE is added to the PIN by the
PEMC, in this case PEMC may provide PEGC_name to the PINE as part of the
PIN_join_accept message. The solution selected as part of the KI#3 will
describe how to add the PINE by the PEMC to the PIN.
If PINE is added to the PIN then PEMC stores the PIN information e.g.
Supported service/device type part of the PIN information to identify that PIN
supports particular service for e.g. Printer. The discoverability criteria
based on which this PINE is discoverable to other PINE in the PIN.
2b) Based on PIN information if the PEMC is not able to select the PIN for
example the respective service is not supported by any of the PINs or the PIN
for respective group ID is not yet active then PIN_join_reject message is sent
to the PINE. The PINE should not request for same PIN information for
implementation dependent time.
The PIN information is at least one of the following:
a) Supported Service/device type (e.g. IOT, printer): Indicate particular
service supported by the PINE.
b) Requested Service/device type (e.g. IOT, Printer): Indicate the requested
service which the PIN should support in which this PINE has to be added.
c) Group ID (also called as PIN ID): The group ID configured by the authorised
user or the 5GC, indicates the request to join the PIN which supports a
particular group.
d) User defined name: This is a plain string configured by authorized user or
the 5GC in the PINE. Based on this plain string PEMC identifies which PIN the
PINE should be added. This plain string can be any configurable text for
example it can be an ID or PIN_NAME or PIN_DISCOVERY name etc.
e) Discoverability criteria:
The PINE is allowed to be discovered if requested for:
1) a specific service.
2) a specific group ID.
3) a specific user defined name.
4) a specific time for e.g. time slot.
### 6.3.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
## 6.4A Solution #4A: PIN and PIN Element discovery by A PINE
### 6.4A.1 Description
This solution resolves aspects of Key Issue #2 \"PIN and PIN Element discovery
and selection\" that relate to how to discover PIN Elements in a PIN.
In this solution, connections between PINEs depends on lower layer (e.g. WIFI,
Bluetooth), which is out of 3GPP scope. The PINEs (including PEMC and PEGC)
communicate with each other for PIN discovery via established connections.
### 6.4A.2 Procedures
Figure 6.4A.2-1: PIN and PIN Element discovery
0\. Connections have been established between PEMC and other PINEs (including
PEGC). How to establish connection depends on the lower layer (e.g. WiFi,
Bluetooth), which is out of 3GPP scope.
1\. PEMC provides PIN discovery policy configuration to PINEs via the
established connections from step 0. The PIN discovery policy includes
enable/disable discovery, PIN ID used for PIN discovery, PIN information (PIN
Elements list, capability, availability, reachability and services).
2\. PINEs (including PEGC) broadcast PIN announcements based on received PIN
discovery policy. The PIN announcement includes PIN ID.
NOTE: How to broadcast the PIN announcement depends on the lower layer, for
example, a PIN ID may be broadcasted as SSID in WiFi access.
3\. A PINE receives a PIN announcement from a PINE (including PEMC or PEGC).
The PINE selects the PIN based on the received PIN ID in the PIN announcement
and establishes a connection with the PINE. How to establish connection
depends on the lower layer (e.g. WiFi, Bluetooth), which is out of 3GPP scope.
4\. The PINE sends a PIN Solicitation Request, which indicates selected PIN ID
and PIN information to be requested, e.g. PINEs in the PIN and corresponding
capability, availability, reachability and services.
5\. The PINE, which received the PIN Solicitation Request, sends PIN
Solicitation response to the PINE, which includes the PIN information
requested by the PIN element.
### 6.4A.3 Impacts on Existing Nodes and Functionality
UE:
\- PEMC provides PIN discovery policy configuration information to PINEs and
PEGCs.
\- PINEs (Including PEMC/PEGC) broadcast and receive PIN announcements as per
the received PIN discovery policy.
\- PINEs (Including PEMC/PEGC) send and respond to PIN solicitation request
with PIN solicitation response.
## 6.4B Solution #4B: PIN Elements with Gateway Capabilities (PEGC) discovery
and selection by PEMC
### 6.4B.1 Description
#### 6.4B.1.1 Introduction
The aspect of the key issue #2 that is addressed by this solution is how to
discover and select PIN Elements with Gateway Capability (PEGC). This solution
also partly addresses Key Issue #6 for PEGC selection parameters provisioning
to PEMC via 5GC.
A typical PIN would consist of different PINEs (sensors, AR/VR, smart TV etc.)
and these PINEs have different requirements and as such it could be possible
that they require access to different 5G core networks services. This may mean
that they need to use different PEGC\'s to communicate with the different core
networks to access required services.
A PEMC which does the management of the PINEs, would take into consideration
PIN element types, connectivity & QoS requirements and accordingly, select a
PEGC to ensure PINEs are connected to their respective core networks and meet
required QoS requirements.
The solution addresses the above aspect and explains how a PEMC (PIN element
with management capability) could be configured with the policy parameters and
other information for PEGC selection.
In this solution, connections between PINEs depends on the lower layer (e.g.
WIFI, Bluetooth), which is out of 3GPP scope. The PINEs (including PEMC and
PEGC) communicate with each other for PIN discovery via established
connections.
#### 6.4B.1.2 Functional Description
A PIN may have several PINEs with different characteristics such as wearable
devices, home automation devices, in the office or smart industrial automation
devices, having different requirements and roles in terms of size, weight,
power consumption, mission critical, high bandwidth and so forth. Users may
create a network of all or subset of these devices (PIN) and for each PIN
there can be one or more PEGCs available.
To make selection of most appropriate PEGC, the PEMC can consider PINEs
characteristics (PIN Types supported, CN Connectivity, Power source, QoS
support, network slice) or PIN type (Sensor Type, AR/VR, smart light, plug,
UE, etc.). The PEMC could be configured with the identities, capabilities, and
prioritization information for PEGCs as follows.
1\. The PEMC device could be configured by the application layer/user
interface with required information for PEGC selection. This could be
something as \"user defined prioritized list of PEGCs\" along with the PEGC
capabilities i.e. PEGC ID, PIN Type supported, QoS Support, 5G CN Identifier,
Network slice, etc.
2\. The PEGC selection parameters could be received by the PEMC during the
registration procedure with the 5G core network, based on the provided PEMC
capabilities in the registration request procedure. PEMC could request or
receive data from active PINEs to learn PINEs characteristics before
requesting 5G core network for parameters for PEGC selection.
### 6.4B.2 Procedures
In this option PEMC could request the 5G core network for PEGC selection
information.
Figure 6.4B.2-1: PEGC selection information during initial registration
procedure
1\. PEMC has successfully established connection with the PINEs via lower
layers (i.e. WiFi, Bluetooth), which is out of 3GPP scope, determines the PIN
type and PIN characteristics (PIN Type, size, QoS requirements etc.) and will
accordingly request PEGC selection information from the 5G core network.
2\. The UE sends registration request messages and indicates its support as
PEMC in the 5GMM Capability information element and provides PEMC capabilities
(PIN Type, size, QoS requirements etc.).
3\. The AMF sends a registration accept message including \"network provided
prioritized list of PEGCs\" list along with the PEGC capabilities i.e. PEGC
IDs, PIN Type supported, CN Connectivity parameters, QoS Support, 5G CN
Identifier, Network slice etc.
### 6.4B.3 Impacts on Existing Nodes and Functionality
UE (PEMC):
\- Determines PIN characteristics based on the request from the PINEs to form
the PIN.
\- Indicates support for PEMC Capability in the UE 5GMM Capability information
element of the Registration Request message.
\- Receives PEGC selection information as part of the registration accept
message.
AMF:
\- Receives the indication of support for PEMC Capability in the UE 5GMM
Capability information element of the Registration Request message.
\- Determines PEGC selection information based on request from the PEMC (UE).
\- Provides PEGC selection information as part of the registration accept
message.
## 6.5 Solution #5: Solution for authorization and management of PIN and PIN
Elements
### 6.5.1 Description
#### 6.5.1.0 General
This solution mainly addresses Key Issue #3 \"Management of PIN and PIN
Elements\", also partly addresses Key Issue #4 \"Communication of PIN\" for
PINE visiting 5GC via PEGC.
#### 6.5.1.1 Registration management of PEMC, PEGC and PINE
The registration management is used to register or deregister a PEMC/PEGC/PINE
with the PIN Application Server, and maintain the user context in the network.
The Initial Registration procedure involves execution of PEMC/PEGC/PINE
authentication and access authorization based on the configuration of the
owner of the device.
Once registered and if applicable the PEMC/PEGC/PINE updates its registration
with the PIN Application Server:
\- periodically, in order to remain reachable; or
\- to update its status, or
\- to update its communication path; or
\- to update its capabilities or parameters,
The profile of PINE/PEGC/PEMC is stored or updated in PIN AS after successful
registration. The device profile may include following information:
\- Device ID,
\- Device name,
\- MAC address or Bluetooth ID,
\- GPSI of UE,
\- Security related information,
\- Device type e.g. PINE, PEMC, PEGC,
\- Device communication capabilities,
\- Device services capabilities.
A set of device context data of PINE or PEGC in a PIN may include following
information:
\- Associated PIN ID,
\- Associated PEGC,
\- Device state,
\- Allocated IP addresses/IPv6 prefix,
\- Authorized communication paths.
#### 6.5.1.2 Management of PIN and PINE Elements
The PEMC is registered into PIN AS and authorized to manage a PIN. The user of
the PEMC can initiate the request to create a PIN via P4 reference point with
PIN AS.
The PIN ID is allocated by PIN AS and an optional PIN Name can be allocated by
the PEMC user. The profile and context data of the PIN is stored in PIN AS and
synchronized with PEMC.
Following context data may be stored in the PIN profile:
\- PIN state (active or inactive),
\- List of serving PEMCs, include:
\- PEMC ID,
\- PEMC state,
\- GPSI and PLMN ID.
\- List of serving PEGCs, include:
\- PEGC ID,
\- PEGC state,
\- GPSI and PLMN ID.
\- List of PINEs
\- PINE ID,
\- PINE state,
\- MAC address, BT ID, or GPSI and PLMN ID,
\- The association with PEGC and other PINEs.
\- The validity duration and the time validity of a PIN and PINE
The PEMC may invite/expel a PEGC or PINE in a PIN, and a PINE/PEGC may request
to join/leave a PIN. All the request is routed to PIN AS for authorization.
After successful authorization, PIN AS updated the PIN profile and modify the
context data of the involved PEGC/PINE. The policy and parameters are
provisioned to the PEGC via P3 reference point and to PINEs via P1 reference
point to enforce the behaviour of the PINE and PEGC.
According to the policy of mobile operator, PIN AS may provision the PIN
related information to the NEF, PCF, UDR or UDM for policy control or
subscription management.
### 6.5.2 Procedures
#### 6.5.2.1 PIN Elements registration and PIN management
Figure 6.5.2.1-1 depicts a high-level procedure of PIN Elements registration,
PIN management and invitation of PIN Elements to the PIN.
Figure 6.5.2.1-1: PIN Elements registration and PIN management
1-3. Registration of the PIN Elements (e.g. PINE, PEGC, PEMC) to the PIN,
includes authentication and authorization of PIN Element, reporting of PIN
Element ID and PIN Element profile to the PIN AS. It is assumed that the PIN
Elements can communicate with PIN AS via Internet.
4\. After successful registration, the PEMC sends a request to the PIN AS to
create a PIN. The PIN ID is assigned by the PIN AS to the PEMC.
5\. The PEMC requests the PIN AS to add the PEGC into the PIN. If the
invitation is accepted by the PEGC, the PIN AS updates the PIN profile and
context data. The PIN AS sends configuration and parameters to the PEGC for
PIN communication.
6 The PIN AS provisions PIN Service Specific Parameters to the UDR (via NEF)
for policy control of the PEGC, include e.g. the PIN ID, default QoS
requirement and valid time for PIN communication.
7\. The PEMC requests the PIN AS to add the PINE into the PIN, includes the
communication requirement of the PINE, e.g. associated PEGC, whether the PINE
is authorised to access 5GS via PEGC, and the QoS requirement. If the
invitation is accepted by the PINE, the PIN AS updates the PIN profile and
context data. The PIN AS sends configuration and parameters to the PINE and
PEGC for PIN communication.
8\. The PIN AS provisions PIN Service specific Parameters to the UDR (via NEF)
for the association of the PINE with the PEGC, include e.g. PINE ID, default
QoS requirement and valid time for the PINE communication with 5GS.
#### 6.5.2.2 PINE visiting to 5GC via PEGC
Figure 6.5.2.2-1: PINE visiting to 5GS via PEGC
1\. PDU Session of PEGC is established.
2\. Application layer signalling is exchanged between the PEGC and the PIN AS.
A list of PINEs authorized to access the PEGC are provisioned to the PEGC.
3\. A PINE requests to access the PEGC for traffic relay to 5GS.
NOTE: The signalling exchange between PINE and PEGC is based on non-3GPP
access (e.g. WIFI, Bluetooth) and application layer deployment.
4\. The PEGC authenticate and authorizes the access of the PINE, and allocates
IP address for the PINE.
5\. The PEGC initiates PDU Session modification as defined in clause 4.3.3.2
of TS 23.502 [3].
The PEGC sends the PINE information to the SMF via NAS signalling, include the
PINE ID, IP address of the PINE, IP address and allocated port number in case
of NAT applied.
6\. The SMF updates the PCF with the PINE information in SM Policy Association
Modification.
7\. The PCF queries the UDR for PIN Specific Service Parameters with the PINE
ID, and receives the QoS requirement of the PINE communication.
The PCF derives the PCC rules for the PINE according to the QoS requirement
received from the UDR and IP address/port number of the PINE from the SMF.
8\. The PDU Session Modification procedures as specified in clause 4.3.3.2 of
TS 23.502 [3] continues from step 2. The QoS flow for the PINE communication
with 5GS is established.
9\. The PEGC sends a response to the PINE.
10\. The application traffic of the PINE is relayed to the 5GS via the PEGC.
### 6.5.3 Impacts on Existing Nodes and Functionality
PIN AS: The PIN AS provisions PIN service specific parameters to the UDR (via
NEF) for policy control of the PEGC.
UDR: In addition to the functions defined in TS 23.501 [2], the UDR performs
the storage of PIN Service Parameters.
NEF: For PIN Application Functions to provide service specific parameters to
the 3GPP network, the NEF supports additional PIN service parameters.
PCF: The PCF queries the UDR for PIN Service Parameters of a PINE and derives
the PCC rules for the PINE communication with 5GS.
SMF: The SMF receives the PINE information via NAS message, and forwards it to
PCF in SM Policy Association Modification request.
## 6.6 Solution #6: Management of PIN and PIN Elements
### 6.6.1 Description
This solution is based on architecture alternative B described in clause 6.0B.
This solution mainly addresses to Key Issue #3 \"Management of PIN and PIN
Elements\". This solution also partly addresses Key Issue #5 \"Authorization
for PIN\" and Key Issue #7 \"Identification of PIN and PIN Elements\".
This solution intends to enable the management of the PIN, such as
creating/modifying a PIN and adding/removing the PIN Elements.
In this solution:
a) 5GC is responsible for management PIN and PIN Elements. In particular, P-NF
is new 5GC network function dedicated to PIN, such as for management of PIN
and of PIN Elements. The request to create a PIN is sent to the P-NF, and the
P-NF can process the request and determine whether UE can act as a PEMC based
on the information provided in the request.
b) P-NF is responsible for the identification of PIN and PIN Elements and for
assigning the PIN identity. P-NF allocates a globally unique PIN identifier in
order to identify the uniquely the PIN. For PIN Elements, it is allowed that a
PINE can be added in more than one PIN. Thus, it is recommended to combine a
PIN ID and the PINE ID to identify a PIN Elements. The format of PIN
Identifier and the generation of PIN Identifier is determined by P-NF.
c) An authorized AF or UE can request to create a PIN. The request from AF
contains the chosen PEMC information.
d) PEMC selects and determines a PEGC via PC5-based mechanism, e.g. ProSe
discovery, or via means like Bluetooth. After PEMC selects a PEGC, they
establish a PC5 connection or connection via transport layer.
e) Both PEMC and PEGC are authenticated by 5GC as UE using the 5G registration
procedure.
f) Introduction of a new PIN functions in 5GC managing the PIN.
g) Definition of PIN layer which decouples the Transport part and the PIN
functionalities from the functionalities of the UE or N3GPP devices is in the
scope of the PIN SID.
h) The PINE can only communicate to the PIN AF in DNN via user plane of the
PEGC.
i) Only the PEMC and PEGC can communicate with the P-NF via the 5G NAS.
j) The PEMC and PEGC can directly communicate with the PIN AF via user plane
PDU session.
k) The protocol between PINE, PEMC and PEGC over the user plane, i.e. via PDU
session, is outside the scope of 3GPP.
l) The PEMC and PEGC belongs to the same PLMN. The roaming scenario is not
supported
m) The solution assumes that the PEMC and the PEGC are located in the same PIN
and they can communicate directly
n) The PEMC manages the PIN network so it has visibility of all PINE currently
members of the PIN, and their identity.
o) If the PEMC cannot communicate with PEGC directly, e.g. the PEGC is in the
home and PEMC is located in office, the can communication via application
layer or user plane PDU session.
This solution addresses the following scenarios:
\- How to create and identify a PIN in 5GC.
\- How to choose UE(s) to be PEMC and/or PEGC.
\- For PINE(s), how to join a PIN.
### 6.6.2 Procedures
Two flow charts about PIN creation and PINE authentication and registration
are proposed in the following.
In PIN creation, the AF initiates a request to create a PIN, and the request
contains the chosen PEMC information. After the PIN creation successful and
the PEMC allocated, the PEGC needs to be assigned. A potential discovery
method of PEGC is shown below. More details can be seen in clause 6.6.2.1.
#### 6.6.2.1 PIN creation
The PIN creation procedure is described in this clause.
Figure 6.6.2-1: Procedure for PIN Creation and Management
0a-0b. The UE supporting the PEMCF and PEGCF registered to 5GC before PIN
creation. The PEMCF may interact with the PIN AF over the user plane based PIN
specific application mechanism and procedure which are transparent to 3GPP and
out of the scope, for example the PIN AF may get a message informing that
PEMCF is connected and available.
1a-1b: AF can send a PIN setup request to P-NF via NEF to create the PIN
network within the 5GC, and the request contains the chosen PEMCF information.
2\. When P-NF receives the request, it needs to send a request to get the
chosen PEMC data in order to check whether the UE supporting PEMCF. As defined
before, the PEMCF supported UE is allowed to be PEMC.
3a-3c: After that P-NF receives the confirm from the UDM, it creates a PIN
network and generates the PIN ID if the PIN ID is not requested from the AF.
The response is sent to the requestor accordingly.
4a-4b: The P-NF sends the indication of creation of PIN network to the PEMC
with the PIN ID.
5: The PEMCF can discover the presence of the PEGCF via Prose Discovery
mechanism and they establish a Prose Direct communication as transport layer.
In case of connection between the PEGCF and PEMCF is via WLAN or BT and how
the discovery and the transport layer set up is out of the 3GPP scope. After
the establishment of transport layer the PEGCF send the PIN Join request
message to the PEMCF with the PIN ID and PEGC ID.
6a-6b: The PEMCF sends a requests to authentication and authorisation for
enabling the PEGCF for the PIN via NAS to the P-NF indicating the identity of
the PEGC, the PIN ID, and the PEGC ID.
NOTE: The PEMCF can send a request to create PEGCF before connection setup
between PEMCF and PEGCF. PEMCF may require an authentication of PEGC with the
request.
7: The P-NF needs to send a request to get the UE data in order to check
whether the UE supporting PEGCF.
8: After the P-NF receives the confirm from UDM, the P-NF update the PIN
context adding the PEGC ID to the PIN network.
9a-9b: The P-NF may notify to the PIN AF the addition of PEGC ID to the PIN ID
if the PIN AF has been requested to be notified of PIN status changes in step
1a.
10a-10b: The P-NF responds to the PMEC about the step 6a result.
11a-11b: The P-NF informs the chosen PEGC that it is authorized to be the
gateway of the PIN network which PIN ID and of the PEMC ID. Also, the PEMC can
send the join request result to PEGC like step 11b.
#### 6.6.2.2 PINE authentication and registration
PINE authentication and registration procedure has the scope to perform the
authentication and authorisation of PINE to be added to the PIN.
Figure 6.6.2.2-1 Procedure for PIN Element authentication
0\. The PINE performs the PIN network discovery procedure.
NOTE: The PIN Network discovery procedure can reuse some of solution already
defined in this TR.
1\. The PINE may send a PIN Join request to the PEGCF of the selected PIN
providing its own Identity and the Requested PIN ID. If in step 0 the PINE is
not able to identify the requested PIN ID, the device may send the join
message to the available identified PEGCF.
2\. When the PEGCF receives the PIN Join request from the PINE or when it
performs the association for establishing the P2P transport layer can send the
PIN Join request to the PEMCF without waiting the reception of the PIN Join
message from PINE. This step may be specific for the P2P transport layer. The
PINE ID may be derived from the previous association. e.g. from BT
association, or the MAC address of the PINE.
Editor\'s note: The definition of PINE identity is FFS.
3a-3b: The PEMCF send a PIN identity request in order to trigger the PINE
authentication & authorisation providing to the PINE the PIN ID and the PEMCF
ID.
4a-4b: The PINE responds with its PINE ID and the information toward the
PEMCF.
5: The PIN authentication is performed.
Editor\'s note: The detailed description of PIN authentication procedure is in
SA WG3 scope.
6a. When successfully authenticated the PEMC send a PIN update message toward
the P-NF. The message is encapsulated in the PIN Container and transported
over NAS.
6b. The AMF forwards the PIN message to P-NF in Npnf_Notify.
7\. The PEMCF send PIN successful authentication to PINE. The PEMC verifies
that the PINE ID and whether is authorised to be added to the PIN network.
8\. The P-NF updates the PIN context adding the PINE ID to the PIN network
identified by PIN ID.
9a-9b. The P-NF may notify to the PIN AF the addition of the PINE ID to the
PIN ID if the PIN AF has been requested to be notified of PIN status changes.
Editor\'s note: The generation of PIN security key will be revised based on SA
WG3 study.
### 6.6.3 Impacts on services, entities, and interfaces
**AMF:**
\- Support P-NF container messages.
**P-NF:**
\- Support the management of PIN, e.g. assign an authorised UE to be
PEMC/PEGC, distribute a PIN ID to identify a PIN.
\- Support the storage of PIN service information.
**NEF:**
\- Interact with P-NF for exposure of PIN information toward AF.
**UDM:**
Support to store UE subscription data of PIN capability.
## 6.7 Solution #7: PIN Management and Communication
### 6.7.1 Description
This solution mainly addresses Key Issue #3 \"Management of PIN and PIN
Elements\" and Key Issue #4 \"Communication of PIN\".
### 6.7.2 Procedures
#### 6.7.2.1 Procedures for PEGC UE registration
Figure 6.7.2.1-1: PEGC UE Registration with 5GS
The PEGC UE registers with the 5GS, with the following changes to the
Registration procedure defined in clause 4.2.2.2.2 of TS 23.502 [3]:
\- In the Registration message the PEGC indicates PIN Gateway capability.
\- AMF gets the PEGC UE\'s subscription data from the UDM which may contain
information about the maximum number of PINE/ PIN allowed, PIN duration,
allowed services, etc.
\- If the subscription does not allow the UE to act as a PEGC the AMF may
reject the registration with a new cause code.
After the expiry of the PIN duration indicated to the PEGC by the AMF during
the registration, AMF may initiate Network triggered de-registration procedure
towards PEGC, as defined in clause 4.2.2.3.3 of TS 23.502 [3].
NOTE 1: PINE management within PIN is managed by the PEMC without involvement
of 5GS.
NOTE 2: The validity duration for individual PINE is handled at the
application level by the PEMC or the PIN Application Server.
#### 6.7.2.2 PIN communication via PEGC and 5GS
##### 6.7.2.2.1 Description
The solution is based on the following assumptions:
\- The IP address allocation for the PINE connected to a PEGC is performed by
the PEGC.
\- Only IPv6 addressing is used within a PIN for networking. IPv4 addressing
is not used.
\- A PIN may have more than one PEGC UEs acting as gateway at the same time.
\- A PEGC UE may use multiple PDU sessions to support the communication
requirements from various PINE that are connected to the PEGC.
\- An AF configures the PIN specific information required at 5GC level into
the UDM/UDR. The information may be provided by the AF to the 5GC for routing
policy management in the PEGC and/or for managing the QoS requirements for PIN
communication. The information may include:
\- PIN Identifier.
\- List of authorized PINE connected to the PIN, along with IPv6 address
assigned to the PINE.
\- List of PEGCs in the PIN along with their IPv6 address.
\- URSP guidance information for determining the URSP rules for PEGC.
\- QoS information with various PIN traffic flow descriptions.
##### 6.7.2.2.2 IPv6 Prefix allocation by PEGC using IPv6 prefix delegation
via DHCPv6
PEGC uses the IPv6 Prefix Delegation via DHCPv6 as explained in clause 4.6.2.3
of TS 23.316 [8] for acquiring a network prefix shorter than the default /64
prefix for a PDU Session. If IPv6 stateless autoconfiguration is used, the /64
default prefix used for IPv6 stateless autoconfiguration may be allocated from
this network prefix; the remaining address space from the network prefix can
be delegated to the PDU session using prefix delegation after the PDU Session
establishment and IPv6 prefix allocation via IPv6 stateless address
autoconfiguration as defined in clause 5.8.2.2.3 of TS 23.501 [2].
The PEGC maintains the address space provided by the SMF as an IPv6 address
space pool available to the PDU Session for DHCPv6 IPv6 prefix requests from
PINE. The total IPv6 address space available for the PDU Session may be
aggregated into one IPv6 prefix that will represent all IPv6 addresses that
the PEGC may use.
After a PINE has established connection with the PEGC, it uses Dynamic Host
Control Protocol version 6 (DHCPv6) mechanism to acquire an IPv6 address from
the PEGC. PEGC assigns an IPv6 address from the address pool available in the
PEGC through the IPv6 Prefix Delegation process.
NOTE: The feature for IPv6 Prefix Delegation via DHCPv6 as explained in clause
4.6.2.3 of TS 23.316 [8] is currently only supported by 5G-RG. The same
features will have to be extended to UEs acting as PEGC.
Figure 6.7.2.2.2-1: IPv6 address allocation to PINE by PEGC using IPv6 Prefix
Delegation via DHCPv6
Figure 6.7.2.2.2-1 above shows the procedure for IPv6 address allocation to a
PINE by PEGC. When a single PEGC supports multiple PIN, at least 1 PDU session
is established by the PEGC for each individual PIN. Within a single PIN the
PEGC may use different PDU session for different set of PINE(s). The process
of IPv6 prefix delegation via DHCPv6 is performed for each PDU session that is
used for supporting PINE communication.
1a. When a PINE establishes a connection with the PEGC and requests relay, the
PEGC UE establishes a PDU session based on the URSP rules provided by the
network. The PEGC UE may also decide to re-use an existing PDU session based
on the URSP rules evaluation. The SMF may allocate an IPv6 prefix to the PDU
session during PDU Session establishment.
1b. Optionally a single network prefix shorter than the default /64 prefix may
be assigned to a PDU Session. The PEGC acts as a \"Requesting Router\" as
described in IETF RFC 3633 [17] and inserts one or more IA_PD option(s) into a
DHCPv6 Solicit message sent to the SMF via the user plane. The SMF acts as the
DHCP server and fulfils the role of a \"Delegating Router\" according to IETF
RFC 3633 [17]. The PEGC UE may optionally include the RAPID_COMMIT option in
the DHCPv6 Solicit message to trigger two-message DHCPv6 procedure instead of
the four-message DHCPv6 procedure. The SMF sends a DHCPv6 Reply message with
one or more IA_PD prefix(es) for every IA_PD option that was received in the
DHCPv6 Solicit message.
If IPv6 stateless autoconfiguration is used, the /64 default prefix used for
IPv6 stateless autoconfiguration may be allocated from this network prefix;
the remaining address space from the network prefix may be delegated to the
PDU session. The address space is maintained by the PEGC UE as an IPv6 address
space pool available to the PDU Session for DHCPv6 IPv6 prefix requests from
PINE.
PEGC UE needs to be configured such that it acts as the \"Requesting Router\"
and request IPv6 prefix delegation. Subscription of the PEGC shall allow it to
request IPv6 prefix delegation.
1c. PEGC UE allocates IPv6 Prefixes to the PINEs. How the PEGC UE assigns IPv6
Prefixes to the PINE(s) is out-side the scope of 3GPP e.g. the PEGC may act as
a DHCPv6 server or PEGC/PINE may use StateLess Address AutoConfiguration
(SLAAC) for IPv6 prefix assignment to the PINE.
1d. After the IPv6 address prefix allocated to a PINE, the PEGC UE updates the
PIN Application server (or the PEMC) about the allocated IP address. This
communication happens at the application layer over the user plane and outside
the scope of 3GPP specification. The AF (or the PEMC acting as AF) may then
use this information to provide QoS requirement for the PINE communication to
the 5GC. The AF (or the PEMC acting as AF) may use the \"Setting up an AF
session with required QoS procedure\" as defined in clause 4.15.6.6 of TS
23.502 [3] and \"AF session with required QoS update procedure\" as defined in
clause 4.15.6.6a of TS 23.502 [3] to provide/update the requested QoS
requirement to the 5GC.
2a-2d The PEGC may repeat the steps 1a through 1d for each PDU session
established for PIN communication. The PEGC UE may decide to use an existing
PDU session or establish a new PDU session for a PINE communication request
based on the evaluation of the URSP rules provided to the PEGC UE by the
network. When the PEGC UE decides to re-use an existing PDU session for a PINE
communication request, the PEGC UE skips steps 2a, 2b and may peform only step
2c, 2d. An AF (or the PEMC acting as AF) may provide guidance for URSP
generation following the procedure for \"Application guidance for URSP
determination\" as defined in clause 4.15.6.10 of TS 23.502 [3].
##### 6.7.2.2.3 Communication between PINEs via 5GS
Figure 6.7.2.2.3-1: PINE communication via 5GS
Figure 6.7.2.3-1 depicts a typical PIN communication scenario.
When a PINE establishes a connection with the PEGC and requests relay, the
PEGC assigns IPv6 Prefix to the PINE as described in clause 6.7.2.2. The PEGC
UE may re-use an existing PDU session for the PINE communication or may
establish a new PDU session. The PEGC UE may establish a PDU Session with type
as IPv6 or IPv4/v6. When PDU session type IPv4/v6 is used, the PEGC may
provide interworking between the PIN running on IPv6 and network running on
IPv4.
PINE discovers other PINE and PEGC in the PIN as per solutions agreed for
KI#2, PIN and PIN Element discovery and selection. Since the Ipv6 Prefix is
assigned to the PINE(s) based on IPv6 Prefix Delegation via DHCPv6, the
traffic can be routed as shown in Figure 6.7.2.3-1 e.g.:
PINE1**â€‘ > **PEGC1**â€‘ > **SMF1**â€‘ > **DN**â€‘ > **SMF2**â€‘ > **PEGC2**â€‘ >
**PINE13.
The 5GS provides QoS support for flow within a PDU session of a PEGC UE. To
ensure end to end QoS handling for communication between PINE(s) from PEGC1
and PINE(s) from PEGC2 it is assumed that a single AF is responsible for
providing QoS requirement to the 5GS and the AF provides QoS requirements for
individual service data flow for each PEGC UE. If there are 2 different AF
managing PEGC1 and PEGC2, it is assumed that there exists some communication
between the two AFs (outside the scope of 3GPP) so that QoS is ensured end to
end.
##### 6.7.2.2.4 PIN specific URSP guidance by AF
A new Traffic Descriptor component (Source descriptors) is added into the
URSP. This TD component is used by the PEGC UE to match the PINE that is
generating the traffic or the PIN from which the traffic is generated, so that
the PEGC UE may route traffic generated from different PINE or PIN using
different PDU sessions.
Table 6.7.2.2.4-1: New TD component in URSP
+--------------------+------------------------------------------------+ | Traffic descriptor | This part defines the Traffic descriptor | | | components for the URSP rule | +====================+================================================+ | Source descriptors | This part defines the source application that | | | is requesting the traffic. The source | | | descriptor could include one or more of the | | | below information: | | | | | | - Identity of the PINE (e.g. MAC address, | | | source IP address/port number, Bluetooth ID or | | | any other unique identifier given to the PINE | | | within the PIN). | | | | | | - Identity of the PIN (e.g. an SSID of the | | | access point supported by the UE acting as GW, | | | or any other unique identifier assigned to the | | | PIN). | +--------------------+------------------------------------------------+
The \"Source descriptors\" TD may contain one or more of the below
information:
\- a unique identity of the device that is using the UE as GW e.g. MAC
address, source IP address/port, Bluetooth ID or any unique identifier given
to the PINE within a PIN.
\- Identity of the PIN (e.g. an SSID of the access point supported by the UE
that is acting as a GW, or any other unique identifier used to identify the
PIN).
\- Any other information that uniquely identify a PIN or a PINE or a device
that is using the UE as a GW or an application running on a PINE or a device
behind the UE.
It is assumed that the H-PCF has the necessary information available to
include the \"Source descriptors\" information in the traffic descriptor of
the URSP rules for a PEGC UE. The information can be made available to the
H-PCF via:
\- Provisioning in the UDR as part of UE policy; or
\- An AF providing \"Application guidance for URSP determination\" to the PCF.
UE that supports the new \"Source descriptors\" TD component shall indicate
the same (e.g. in 5GMM capability indication) to the AMF during registration.
The PCF may include \"Source descriptors\" in TD of the URSP rule based on the
UE\'s policy subscription data, AF guidance for URSP determination and only
when the UE supports the new capability.
### 6.7.3 Impacts on services, entities and interfaces
The solution has the following impacts:
**UE:**
\- UE shall indicate the list of other PINE that are served by the UE (acting
as PEGC) within PIN to the 5GS.
\- UE supports the new \"source descriptor\" TD component for URSP.
**UDM:**
\- UDM supports PEGC subscription.
**AMF:**
\- AMF supports new failure cause code to indicate to the UE over NAS based on
different failure conditions.
**PCF:**
\- PCF supports the new \"source descriptor\" TD component for URSP
generation.
## 6.8 Solution #8: Management of PIN and PIN Elements
### 6.8.1 Description
#### 6.8.1.1 General
This solution is based on architecture alternative C described in clause 6.0C.
This solution mainly addresses KI#3 \"Management of PIN and PIN Elements\" and
KI#5 \"Authorization for PIN\", i.e. authorization of PEMC management PIN and
PEGC providing connectivity to and from 5G network. This solution also
addresses part of KI#6 \"Policy and parameters provisioning for PIN\", i.e.
the Connection parameters, RAT parameters, Discovery parameters, and
Association parameters provisioning, part of KI#2 \"PIN and PIN Element
discovery and selection\", i.e. PINE/PEGC broadcast information and PEMC
discovers them before PINE/PEGC add into a PIN, and part of KI#7
\"Identification of PIN and PIN Elements\", i.e. PINMF assigns the PIN ID,
PEMC ID, PEGC ID, and PINE ID.
#### 6.8.1.2 Concept
The figure 6.8.1.2-1 depicts the concept of this solution.
Figure 6.8.1.2-1: Concept of the solution
All PINEs, PEGCs, and PEMCs shall be registered first before adding them into
any PIN.
The Trust Members in the figure facilitate user to share PIN management among
multiple PEMCs. The example of the Trust Members is multiple phones of the
user for wearable cases, family members for smart home cases, partner members
for smart office cases. The user can assign additional PEMCs from the Trust
Members to a PIN. With multiple PEMCs option, the user can pick up any smart
phone to manage the PIN that only includes wearable devices, or any family
member of the user can buy a new device and update the PIN, which only
includes devices in living room, to add the new device in the PIN without
waiting the user back home, etc.
The Trust Members is a PIN related subscription of user, which includes PEMCs
and/or PEGCs. If a PEGC is included in the Trust Members, e.g. the user also
subscribes the smart home gateway as a trust member, the authorization of the
PEGC is based on the subscription, otherwise the authorization of the PEGC is
based on the request from the PEGC. The 5GC uses External Group ID and
Internal Group ID to identify the Trust Member Group.
The figure 6.8.1.2-2 also shows an example of three PIN instances. The PIN1
incudes PEMC-A and PEMC-B, which means they both are able to update and delete
PIN1. The PEMC-C and PEMC-D are included in Trust Members but are not the PEMC
of PIN1, so they both only are able to view information of PIN1, e.g. for
smart home cases, PEMC-A and PEMC-B belong to parents, while PEMC-C and PEMC-D
belong to son and daughter. The PEGC-I included in both PIN1 and PIN2 is in
Trust Members, hence it may be pre-configured into PIN1/PIN2 or dynamically
added into PIN1/PIN2, and serves both PIN1 and PIN2. The PEGC-II included in
PIN3 is not in Trust Members, hence it is dynamically added into the PIN3. The
PEGC-III and PINE10 have been registered but not been added into any PIN
instance yet.
#### 6.8.1.3 Overall procedure for PIN management
The figure 6.8.1.3-1 depicts the overall procedure for PIN management.
Figure 6.8.1.3-1: Overall procedure for PIN management
1\. The PEMCs register themselves into PINMF first.
2\. A PEMC obtains device information of the PINE or PEGC via direct
connection, and the PEMC registers the information of PINE or PEGC into PINMF.
Using PEMC to register PINE and PEGC into PINMF is for associating the PINE
and PEGC with the PEMC or the Trust Member Group of the PEMC.
3\. [Optional] In case a PEGC is registered but there\'s no PIN subscription
for the PEGC, e.g. the PEGC is not included in the Trust Members as a PEGC, in
order to make sure that the UE is not registered as PEGC unexpected, the PINMF
redirects the PEGC via the PEMC to directly register itself into the PINMF.
4\. In case a PEGC is registered, the PINMF requests the 5GC to provision
parameters to the PEGC for PIN UP configuration, including PINE Address
Allocation Rule and PDU Session Selection Rule.
5\. Any PEMC that is included in the Trust Members can query the registered
device information and PIN configurations from the PINMF for sync-up.
6\. Any PEMC can create a PIN with one or multiple PEMCs that are included in
Trust Members, e.g. all family members are able to update a PIN that includes
devices in living room to add a new device for the PIN.
7\. Any PEMC that is able to manage a PIN can request the PINMF to update the
PIN with PEGC and/or PINE addition or removal. In case a PEGC is added into
the PIN, the PINMF requests the 5GC to provision parameters that received from
the PEMC to the PEGC for PIN connection, including SSID/BT ID, password, etc.
8\. Any PEMC that is able to manage a PIN can request the PINMF to update the
PIN with PEGC and PINE associations, which can be used for PIN access control.
The PINMF requests the 5GC to provision parameters to the PEGC and sends
parameters to the PINE via PEMC or a PEGC, the parameters are deduced from the
received information from the PEMC.
9\. When a PINE connects to a PEGC and the connection is accepted by the PEGC,
the PEGC indicates the active association information to the PINMF.
### 6.8.2 Procedures
#### 6.8.2.1 Management of PIN without PINE/PEGC addition/removal
##### 6.8.2.1.1 Registration of PEMC and registration of PINMF
The procedure describes how PEMC registers itself into the PINMF and PINMF
registers itself into UDR, which considers that a PEMC may subscribe Trust
Member Group.
Figure 6.8.2.1.1-1: Registration of PEMC and registration of PINMF
**Precondition:**
**The user of the PEMC has subscribed PIN service.**
1\. The PEMC sends Registration Request (GPSI) to the PINMF-A, which may be
according to the pre-configured information. If the PEMC is behind a PEGC, the
PEMC sends Message Transfer Request (Registration Request) to the PEGC, and
PEGC sends Transfer Message Request (PEMC Transport Address, Registration
Request) to the PINMF.
2\. The PINMF-A interacts with the UDR via UDM or NEF to check whether the UE
identified by the GPSI has subscribed to be a PEMC. The UDR returns the
subscribed PIN related information, which includes the indicator of whether
the UE is a PEMC and the Trust Member Group ID if exists, as well as returns
the registered PINMF Info related to the GPSI if exists.
3\. [Optional] If the PINMF Info is not received in step 2, the PINMF-A sends
PINMF Registration Request (GPSI/Trust Member Group ID, PINMF Info) to the
UDM/NEF. The registration of PINMF is for the purpose that when user changes
cell phone for the PEMC or uses other PEMC in Trust Members, the management
operation can still be done.
4\. [Optional] The UDM/NEF queries PINMF Info from the UDR according to the
GPSI or Trust Member Group ID. The UDR returns the PINMF Info related to the
GPSI or the Trust Member Group ID.
5\. [Optional] If the UDR does not return the PINMF Info, the UDM/NEF
registers the PINMF-A into UDR related to the GPSI or the Trust Member Group
ID.
NOTE: The UDM/NEF does not handle the successive PINMF Registration Request
related to the GPSI or Trust Member Group ID until steps 4 and 5 are finished.
6\. [Optional] The UDM/NEF responds to the PINMF-A, which includes the
registered PINMF Info.
7\. If the returned PINMF Info in step 2 or step 6 indicates the PINMF-A, the
PINMF-A responds to the PEMC with allocated PEMC ID. If the returned PINMF
Info in step 6 does not indicate the PINMF-A, the PINMF-A instructs the PEMC
to redirect the registration with the PINMF-B that indicated by the received
PINMF Info. If the PEMC is behind a PEGC, the PINMF sends Transfer Message
Request (PEMC Transport Address, Registration Response) to the PEGC, and the
PEGC sends Message Transfer Request (Registration Response (PEMC ID)) to the
PEMC.
8\. [Optional] If the PEMC is instructed to redirect the registration, steps
1-7a are performed again with the PINMF-B.
##### 6.8.2.1.2 Create a PIN
The procedure describes how a PEMC dynamically creates a PIN without adding or
removing PINE/PEGC.
Figure 6.8.2.1-1: Create a PIN
**Precondition:**
**The user may subscribe Trust Members that can act as PEMC or PEGC.**
1\. The PEMC sends Create PIN Request (PEMC ID, PIN name, PIN description,
[Duration], [additional PEMC GPSIs]) to the PIN Management Function (PINMF)
over application layer. The Duration indicates the lifetime of the PIN, the
additional PEMC GPSIs indicates additional PEMCs that are allowed to manage
the PIN. If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and
PIN4 interfaces as described in step 1 of clause 6.8.2.1.1. The PEMC may also
send the PLMN ID to PINMF.
2\. [Optional] If additional PEMC GPSIs are received, the PINMF checks with
the UDR whether the additional PEMCs identified by the additional PEMC GPSIs
are included in the Trust Members of the PEMC identified by the PEMC ID. The
interaction between PINMF and UDR is via UDM or NEF. The NEF shall verify
whether the PINMF is the one that registered with the Trust Member Group.
Although there maybe more than one PEMCs included in a PIN, the PINMF only
allows one PEMC to control the PIN at any point of time.
3\. The PINMF responds to the PEMC with the allocated PIN ID for the PIN. If
the UE identified by the additional PEMC GPSI is not authorized to be a PEMC,
the response includes the corresponding error information. If the PEMC is
behind a PEGC, the message is encapsulated in PIN2 and PIN4 interfaces as
described in step 7 of clause 6.8.2.1.1.
##### 6.8.2.1.3 Update a PIN
The procedure describes how a PEMC updates a PIN without adding or removing
PINE/PEGC.
Figure 6.8.2.1.3-1: Update a PIN
**Precondition:**
**The user may subscribe Trust Members as describe in clause 6.8.2.1.2.**
1\. [Optional] The PEMC may perform PIN List Information Query procedure as
described in clause 6.8.2.1.5 and/or PIN Information Query procedure as
described in clause 6.8.2.1.6. An example usage of this step is that when the
user changes cell phone for acting PEMC.
2\. The PEMC sends Update PIN Request (PEMC ID, PIN ID, [PIN name], [PIN
description], [Duration], [additional PEMC GPSIs]) to the PINMF. If the PEMC
is behind a PEGC, the message is encapsulated in PIN2 and PIN4 interfaces as
described in step 1 of clause 6.8.2.1.1.
3\. [Optional] The PINMF determines whether the PEMC is allowed to manage the
PIN. If yes, when additional PEMC GPSIs are received, the PINMF determines
whether there\'re newly added PEMCs, if so, the PINMF checks with UDR whether
the newly added PEMCs are included in Trust Members of the PEMC identified by
the PEMC ID, the PINMF removes the PEMCs of the PIN that not identified by the
additional PEMC GPSIs. The interaction between PINMF and UDR is via UDM or
NEF. The NEF shall verify whether the PINMF is the one that registered with
the Trust Member Group.
4\. The PINMF responds to the PEMC. If the PEMC is behind a PEGC, the message
is encapsulated in PIN2 and PIN4 interfaces as described in step 7 of clause
6.8.2.1.1.
##### 6.8.2.1.4 Delete a PIN
The procedure describes how a PEMC deletes a dynamically created PIN that does
not include any PINE/PEGC.
Figure 6.8.2.1.4-1: Delete a PIN
1\. The PEMC sends Delete PIN Request (PEMC ID, PIN ID) to the PINMF. If the
PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4 interfaces
as described in step 1 of clause 6.8.2.1.1.
2\. The PINMF determines whether the PEMC is allowed to manage the PIN. If
yes, the PINMF removes the storage information related to the PIN. The PINMF
responds to the PEMC. If the PEMC is behind a PEGC, the message is
encapsulated in PIN2 and PIN4 interfaces as described in step 7 of clause
6.8.2.1.1.
##### 6.8.2.1.5 Query PIN list information
The procedure describes how a PEMC queries the PINMF to obtain the information
of PINs that pre-configured or dynamically created by the PEMC or other PEMCs
that are trust members of the PEMC. An example usage of this procedure is that
when the user changes cell phone for acting PEMC.
Figure 6.8.2.1.5-1: Query PIN list information
**Precondition:**
**The user may subscribe Trust Members as describe in clause 6.8.2.1.2.**
1\. The PEMC sends PIN List Information Query (PEMC ID) to the PINMF. If the
PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4 interfaces
as described in step 1 of clause 6.8.2.1.1.
2\. [Optional] The PINMF may interact with the UDR to query the trust members
of the UE. The PINMF finds out the PINs that managed by the PEMC and its trust
members. The interaction between PINMF and UDR is via UDM or NEF. The NEF
shall verify whether the PINMF is the one that registered with the Trust
Member Group.
3\. The PINMF responds to the PEMC with the list of PIN information, which
includes PIN ID, PIN name, PIN description, and optionally contains Duration.
If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 7 of clause 6.8.2.1.1.
##### 6.8.2.1.6 Query PIN information
The procedure describes how a PEMC queries the PINMF to obtain the information
of a PIN that pre-configured or dynamically created by the PEMC or other PEMCs
that are trust members of the PEMC. An example usage of this procedure is that
when the user changes cell phone for acting PEMC. If the PEMC is not a manager
of the PIN, it is not able to modify or delete the PIN.
Figure 6.8.2.1.6-1: Query PIN information
**Precondition:**
**The user may subscribe Trust Members as describe in clause 6.8.2.1.2.**
1\. The PEMC sends PIN Information Query (PEMC ID, PIN ID) to the PINMF. If
the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 1 of clause 6.8.2.1.1.
2\. [Optional] The PINMF determines whether the PEMC is one of the managers of
the PIN, or one of the trust members of the PIN manager. The interaction
between PINMF and UDR is via UDM or NEF. The NEF shall verify whether the
PINMF is the one that registered with the Trust Member Group.
3\. The PINMF responds to the PEMC with the PIN information, which includes
PIN name, PIN description, List of Device Info, Association Info, and
optionally includes PEMC GPSIs and Duration. The Device Info is described in
clause 6.8.2.2.3, the Association Info is described in clause 6.8.2.3.1. If
the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 7 of clause 6.8.2.1.1.
Editor\'s note: For the case that PINMF is 3rd party AF, how the PEMC verifies
that the information stored in and returned from the PINMF, which is received
from a PEMC by the PINMF, is not tempered needs coordination of SA WG3.
#### 6.8.2.2 Management of PEGC and PINE
##### 6.8.2.2.1 Registration of PINE
The procedure describes how a PEMC registers the PINE into PINMF. An example
usage of this procedure is that when initial discovery and initial direct
connection establishment between the PEMC and the PINE have been done.
Figure 6.8.2.2.1-1: Registration of PINE
1\. The PEMC sends Registration Required Request () to the PINE via direct
connection. If the PINE has not been registered into PINMF (i.e. no PINE ID is
provisioned), the PINE responds OK, otherwise the PINE responds failure.
2\. The PINE sends Registration Request (Device Metadata) to the PEMC. The
Device Metadata includes MAC address, vendor name, device description, PINE
Function Address. If the PINE is able to be an announcer, the Device Metadata
includes Connection Info, which contains, e.g. SSID/BT ID, password. The
Device Metadata may include Service Characters Info, which can be, e.g.
Recommend QoS Info. The Service Characters Info is used by PINMF to determine,
based on the agreement between the PINMF and the operator, the DNN/S-NSSAI
related information for the relay path established by PEGC.
Editor\'s note: For the case that PINMF is 3rd party AF, exposing password
WiFi/BT to the PINMF has privacy concern, and if user want to hide SSID,
exposing SSID to the PINMF also has privacy concern, how to secure protect the
password from the PINMF needs coordination of SA3.
3\. The PEMC sends Registration Request (PEMC ID, Device Metadata) to the
PINMF. If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and
PIN4 interfaces as described in step 1 of clause 6.8.2.1.1.
4\. The PINMF determines the registered device is PINE (GPSI is not included
in the Device Metadata), it responds to the PEMC with the allocated PINE ID.
If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 7 of clause 6.8.2.1.1.
5\. The PEMC sends Registration Response (PINE ID) to the PINE.
##### 6.8.2.2.2 Registration of PEGC
The procedure describes how a PEMC registers the PEGC into PINMF. An example
usage of this procedure is that when initial discovery and initial direct
connection establishment between the PEMC and the PEGC have been done.
Figure 6.8.2.2.2-1: Registration of PEGC
1\. The PEMC sends Registration Required Request () to the PEGC via direct
connection. If the PEGC has not been registered into PINMF (i.e. no PEGC ID is
provisioned), the PEGC responds OK, otherwise the PEGC responds failure.
2\. The PEGC sends Registration Request (Device Metadata) to the PEMC. The
Device Metadata is described in clause 6.8.2.2.1 with following exceptions:
\- The PINE is replaced with PEGC, the PINE Function Address is replaced with
PEGC Function Address.
\- GPSI of the PEGC is included.
\- Service Characters Info is not included.
\- PLMN ID may be included.
3\. The PEMC sends Registration Request (PEMC ID, Device Metadata) to the
PINMF. If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and
PIN4 interfaces as described in step 1 of clause 6.8.2.1.1.
Editor\'s note: For the case that PINMF is 3rd party AF, exposing password of
WiFi/BT to the PINMF has privacy concern, and if user want to hide SSID,
exposing SSID to the PINMF also has privacy concern, how to secure protect the
password from the PINMF needs coordination of SA WG3.
4\. The PINMF determines the registered device is PEGC (GPSI is included in
the Device Metadata), the PINMF interacts with the UDR to query the Trust
Members of the PEMC. The interaction between PINMF and UDR is via UDM or NEF.
The NEF shall verify whether the PINMF is the one that registered with the
Trust Member Group.
Following steps 5-9 and 11 are for the case when the PEGC is not included in
the Trust Members.
5\. [Optional] If the UE identified by the GPSI is not a PEMC\'s trust member
that acts as a PEGC, the PINMF should determine whether the PEGC is in the
same PLMN as the PEMC, if they are not, the authorization is failed and the
PINMF shall reject the Registration request and inform the PEMC to disconnect
with the PEGC, otherwise the PINMF responds to the PEMC with Registration URI.
If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 7 of clause 6.8.2.1.1.
6\. [Optional] The PEMC responds to the PEGC with the Registration URI.
7\. [Optional] The PEGC may close direct connection with PEMC, or the PEMC
close the direct connection based on the rejection from PINMF.
8\. [Optional] The PEGC connects to 5GS if in CM-IDLE state.
9\. [Optional] The PEGC sends Registration Request (GPSI) to the PINMF over a
PDU Session according to the Registration URI. The PINMF verifies the
registration.
10\. No matter whether steps 5-9 are performed or not, the PINMF sends UP
Configuration Request (PEMC GPSI/Trust Member Group ID, PEGC GPSI, List of
Service Mapping Rule, [Address Allocation Rule]) to the PCF (optionally via
NEF).
The Service Mapping Rule includes \. The association information may be source IP Ranges, SSIDs, BT
IDs, Packet filters, or combination of them. If Default is used, only one
Service Mapping Rule is sent.
The Address Allocation Rule includes IP Ranges or DHCP Server Address, the IP
Ranges are used by the PEGC to assign IP addresses for PINEs, the DHCP Server
Address is used by the PEGC to relay the DHCP messages between PINEs and the
DHCP Server. With IP Ranges option, the PINEs behind different PEGCs are able
to be within different IP domains.
The NEF shall verify whether the PINMF is the one that registered with the
PEMC GPSI/Trust Member Group.
11\. The PCF queries UDR to obtain the subscribed service types of the PEMC or
the Trust Member Group. The PCF generates List of PDU Session Selection Rule
according to the List of Service Mapping Rule and the subscribed services. The
PDU Session Selection Rule includes \.
With DHCP Server Address option for Address Allocation Rule and association
information for the PDU Session Selection Rule including source IP Ranges, the
PINMF is able to act as a DHCP Server and allocate IP address for the PINE
according to the PINE\'s Device Metadata (e.g. Recommend QoS Info, pre-
configured DN information, device service type, etc.), then the PEGC can map
the traffic of the PINE with the corresponding PDU Session according to the
PDU Session Selection Rules.
12\. The PCF invokes Namf_Communication_N1N2MessageTransfer (SUPI of PEGC,
List of PDU Session Selection Rule, [Address Allocation Rule]) to the AMF.
13\. The AMF sends the parameters via N1 message to the PEGC.
14\. If the UE supports PEGC, the UE sends result to the AMF.
15\. If the result from the UE is received, or timed out for receiving the
result from UE (i.e. the UE does not support PEGC), the AMF invokes
Namf_Communication_N1MessageNotify to the PCF.
16\. The PCF responds to the PINMF, which indicates whether the UE supports
PEGC.
17\. [Optional] If steps 5-9 are performed and PINMF is informed that the UE
supports PEGC during step 16, the PINMF responds to the PEGC over 5GS with
allocated PEGC ID, and the PINMF sends PEMC Event Notification (PEGC ID) to
the PEMC. If the PEMC is behind a PEGC, the PINMF sends PEGC Event
Notification (PEMC Event Notification) to the PEGC, and the PEGC sends PEMC
Event Notification to the PEMC.
18\. If steps 5-9 are not performed and PINMF is informed that the UE supports
PEGC during step 16, the PINMF responds to the PEMC with allocated PEGC ID,
the PEMC responds to the PEGC with the PEGC ID. If the PEMC is behind a PEGC,
the message is encapsulated in PIN2 and PIN4 interfaces as described in step 7
of clause 6.8.2.1.1.
##### 6.8.2.2.3 Query device list information
The procedure describes how a PEMC queries the PINMF to obtain the information
of PINEs/PEGCs that has been registered into the PINMF by the PEMC or other
PEMCs that are trust members of the PEMC. An example usage of this procedure
is that when the user change cell phone for acting PEMC.
Figure 6.8.2.2.3-1: Query device list information
**Precondition:**
**The user may subscribe Trust Members as describe in clause 6.8.2.1.2.**
1\. The PEMC sends Device List Information Query Request (PEMC ID) to the
PINMF. If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and
PIN4 interfaces as described in step 1 of clause 6.8.2.1.1.
2\. [Optional] The PINMF queries the UDR to obtain trust members of the PEMC.
The PINMF finds out the devices that has been registered into the PINMF by the
trust members. The interaction between PINMF and UDR is via UDM or NEF. The
NEF shall verify whether the PINMF is the one that registered with the Trust
Member Group.
3\. The PINMF responds to the PEMC with the List of Device Info, which
includes PINE ID/PEGC ID, MAC address, type (PEGC of PINE), vendor name,
device description, PINE/PEGC Function Address. If the PINE/PEGC is able to be
an announcer, the Device Info includes Connection Info, which contains, e.g.
SSID/BT ID, password. If the PINE has active association in a PIN, the Device
Info includes IP address(es) and association information (e.g. direct, PEGC
routable, 5GC routable, etc.). If the type is PEGC, the Device Info includes
IP address(es) and association information (e.g. direct, inner, 5GC routable,
etc.). If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and
PIN4 interfaces as described in step 7 of clause 6.8.2.1.1.
Editor\'s note: For the case that PINMF is 3rd party AF, how the PEMC verifies
that the Device Information stored in and returned from the PINMF, which is
received from a PEMC by the PINMF, is not tempered needs coordination of SA
WG3.
##### 6.8.2.2.4 Add/Update/Remove PINEs for a PIN
The procedure describes how a PEMC adds/updates/removes PINEs for a PIN.
Figure 6.8.2.2.4-1: Add/Update/Remove PINEs for a PIN
1\. [Optional] The PEMC performs PINE Registration procedure as described in
clause 6.8.2.2.1, or Device List Information Query procedure as described in
clause 6.8.2.2.3, or PIN List Information Query procedure as described in
clause 6.8.2.1.5, or PIN Information Query procedure as described in clause
6.8.2.1.6.
For adding/updating PINE, if the PEMC is able to interact with the PINE (i.e.
the PEMC is able to setup direct connection with the PINE, or the Device Info
of the PINE includes IP address), the following steps are performed, otherwise
stops. For removing PINEs, the following steps are performed.
2\. For adding PINEs, the PEMC sends Create PIN Request (PEMC ID, PIN name,
PINE ID, device name, [Connection Info], [RAT Info], [Discovery Info]) or
Update PIN Request (PEMC ID, PIN ID, PINE ID, device name, [Connection Info],
[RAT Info], [Discovery Info]) to the PINMF. For updating PINEs, the PEMC sends
Update PIN Request (PEMC ID, PIN ID, PINE ID, device name, [Connection Info],
[RAT Info], [Discovery Info]) to the PINMF. For removing PINEs, the PEMC sends
Update PIN Request (PEMC ID, PIN ID, PINE ID) or Delete PIN Request (PEMC ID,
PIN ID) to the PINMF. If the PINE is able to be an announcer, the Connection
Info may be included to replace the one that already registered in PINMF. The
RAT Info and Discovery Info may be included, which are described in clause
6.8.2.2.5 step 9. If the PEMC is behind a PEGC, the message is encapsulated in
PIN2 and PIN4 interfaces as described in step 1 of clause 6.8.2.1.1.
Editor\'s note: For the case that PINMF is 3rd party AF, exposing password of
WiFi/BT to the PINMF has privacy concern, and if user want to hide SSID,
exposing SSID to the PINMF also has privacy concern, how to secure protect the
password from the PINMF needs coordination of SA WG3.
3\. The PINMF responds to the PEMC. For create/update PIN, the response
includes PIN ID. For adding PINEs, the response includes Device Info as
described in clause 6.8.2.2.3 with exception that the Connection Info is
related to the PIN. For adding PINEs, if the PINE is not reachable according
to the IP address(es) in the Device Info, and the PEMC has no direct
connection with the PINE, the PEMC performs Remove PINEs procedure and stops.
If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 7 of clause 6.8.2.1.1.
4\. For adding PINEs, the PEMC sends Create PIN Information Request (PIN ID,
PINE ID, [Connection Info], [RAT Info], [Discovery Info]) to the PINE over
direct connection, or sends PINE Notification (PEGC ID, PINE ID, Create PIN
Information Request) to the PINMF then PINMF sends PEGC Event Notification
(PINE ID, Create PIN Information Request) to the PEGC according to the PEGC
ID, and the PEGC sends Message Transfer Request (Create PIN Information
Request) to the PINE according to the PINE ID. For updating PINEs, the PEMC
sends Update PIN Information Request (PIN ID, PINE ID, [Connection Info], [RAT
Info], [Discovery Info]) to the PINE or requests PINMF to route the messages
as described above. If the PINE is able to be an announcer and the PEMC
determines to make the PINE announcer, the Connection Info is included. The
RAT Info and Discovery Info may be included. For removing PINEs, the PEMC
sends Delete PIN Information Request (PIN ID) to the PINE or requests PINMF to
route the message as described above. If the PEMC is behind a PEGC, the
message sent to the PINMF is encapsulated in PIN2 and PIN4 interfaces as
described in step 1 of clause 6.8.2.1.1.
5\. The PINE responds to the PEMC, or sends Message Transfer Request (PEMC ID,
Create/Update/Delete PIN Information Response) to the PEGC, and PEGC sends
PEMC Notification (PEMC ID, Create/Update/Delete PIN Information Response) to
the PINMF, then PINMF sends Event Notification (Create/Update/Delete PIN
Information Response) to the PEMC.
##### 6.8.2.2.5 Add/Update/Remove PEGCs for a PIN
The procedure describes how a PEMC adds/removes a PEGC for a PIN.
Figure 6.8.2.2.5-1: Add/Update/Remove PEGCs for a PIN
**Precondition:**
**The user may subscribe Trust Members as describe in clause 6.8.2.1.2.**
**The user may change a PEGC with a new one without updating the associated
PINE before the replacement, and request the network to reuse the PIN
parameters of the old PEGC for the new one.**
1\. [Optional] The PEMC performs PEGC Registration procedure as described in
clause 6.8.2.2.2, or Device List Information Query procedure as described in
clause 6.8.2.2.3, or PIN List Information Query procedure as described in
clause 6.8.2.1.5, or PIN Information Query procedure as described in clause
6.8.2.1.6.
2\. For adding PEGCs, the PEMC sends Create PIN Request (PEMC ID, PIN name,
PEGC ID, device name, [Connection Info], [RAT Info], [Discovery Info]) or
Update PIN Request (PEMC ID, PIN ID, PEGC ID, device name, [old PEGC ID],
[Connection Info], [RAT Info], [Discovery Info]) to the PINMF. If the PEGC is
able to be an announcer, the Connection Info may be included to replace the
one that already registered in PINMF. The RAT Info and Discovery Info may be
included, which are described in step 9. If the old PEGC ID is provided, the
Connection Info, RAT Info, and Discovery Info are not needed, the PINMF uses
the corresponding parameters of the old PEGC for the PEGC.
For removing PEGCs, the PEMC sends Update PIN Request (PEMC ID, PIN ID, PEGC
ID) or Delete PIN Request (PEMC ID, PIN ID) to the PINMF.
If the PEMC is behind a PEGC, the message is encapsulated in PIN2 and PIN4
interfaces as described in step 1 of clause 6.8.2.1.1.
Editor\'s note: For the case that PINMF is 3rd party AF, exposing password of
WiFi/BT to the PINMF has privacy concern, and if user want to hide SSID,
exposing SSID to the PINMF also has privacy concern, how to secure protect the
password from the PINMF needs coordination of SA WG3.
Following steps 3-8 are for PIN Access Policy Provisioning.
3\. The PINMF sends Create/Update/Delete PIN Request (PIN ID, SUPI/GPSI of
PEGC, [Connection Info], [RAT Info], [Discovery Info]) to the PCF. The RAT
Info includes RAT configuration information, e.g. whether the SSID is hidden
or not when device is announcer, activated RAT types (e.g. WiFi, BT), etc. The
Discovery Info includes discovery configuration, e.g. open/restrict when
device is announcer (e.g. WiFi for open - accept connection for PIN1 and/or
PIN2 interaction even when the connection is requested from one that is not in
block and allowed MAC list, BT for restrict - accept connection only when the
connection is requested from one that is in allowed MAC list), etc. The
interaction between PINMF and PCF may be via NEF. The PCF may store the
parameters into UDR.
4\. The PCF invokes Namf_Communication_N1N2MessageTransfer (SUPI of PEGC, PIN
ID, [Connection Info], [RAT Info], [Discovery Info]) to the AMF.
5\. The AMF sends the PIN ID, Connection Info, RAT Info, and Discovery Info to
the PEGC.
Editor\'s note: For the case that PINMF is 3rd party AF, how the PEGC
authorize that the Connection Info, RAT Info, and Discovery Info are
configured by a PEMC needs coordination of SA WG3.
6\. If the UE supports PEGC, the UE sends result to the AMF.
7\. If the result from the UE is received, or timed out for receiving the
result from UE (i.e. the UE does not support PEGC), the AMF invokes
Namf_Communication_N1MessageNotify to the PCF.
8\. The PCF responds to the PINMF, which indicates whether the UE supports
PEGC.
9\. [Optional] For creating/updating PIN, the PINMF responds to the PEMC with
PIN ID and Device Info of the PEGC. For deleting PIN, the PINMF responds to
the PEMC with PIN ID. The information in the Device Info is related to the
PIN. If some configuration is not accepted by the PEGC during steps 3-8, the
Device Info is included to reflect the update. If the UE does not support
PEGC, the Device Info is not included. If the PEMC is behind a PEGC, the
message is encapsulated in PIN2 and PIN4 interfaces as described in step 7 of
clause 6.8.2.1.1.
#### 6.8.2.3 Management of association between PEGC and PINE
##### 6.8.2.3.1 Create/Remove association between PEGC and PINE
The procedure describes how an association between PEGC and PINE is created or
removed. One PINE can associate with multiple PEGCs, which means, without
block indication, the PINE can setup direct connection with any of those PEGCs
when they are close each other.
Figure 6.8.2.3.1-1: Create/Remove association between PEGC and PINE
**Precondition:**
**The PEGC and PINE have been added into the PIN.**
For creating association with block indication and in case the PINE is
announcer, or for creating association without block indication, if the PEMC
is able to interact with the PINE (i.e. the PEMC is able to setup direct
connection with the PINE, or the Device Info of the PINE includes IP address),
the following steps are performed.
1\. The PEMC sends Create/Remove Association Request (PEMC ID, PIN ID,
Association Info, [Lifetime]) to the PINMF. The Association Info includes List
of \, and for association creation, the
Association Info may include block indication to indicate the direct
connection is not allowed to be setup. The Lifetime indicates the duration of
the association. If the PEMC is behind a PEGC, the message is encapsulated in
PIN2 and PIN4 interfaces as described in step 1 of clause 6.8.2.1.1.
Editor\'s note: For the case that PINMF is 3rd party AF, exposure of the
Association Info to the PINMF has privacy concern, how to secure protect the
Association Info from the PINMF needs coordination of SA WG3.
Following steps 2-7 are for PIN Association Policy Provisioning.
2-7. These steps are for PIN Association Policy Provisioning, which is similar
as described in steps 3-8 of clause 6.8.2.2.5 with following exception:
\- The Association Policy is sent from PINMF to PEGC. The Association Policy
includes \ and/or \ if the PEGC is
announcer, and/or \ and/or \, the Link
Info includes SSID/BT ID and password of PINEs, if the PEGC is listener, and
may include Lifetime.
Editor\'s note: For the case that PINMF is 3rd party AF, how the PEGC
authorize that the Association Policy is configured by a PEMC needs
coordination of SA WG3.
8\. The PINMF responds to the PEMC with Device Info of PEGC and PINE with the
exception that the Connection Info is related to the PIN. If the PEMC is
behind a PEGC, the message is encapsulated in PIN2 and PIN4 interfaces as
described in step 7 of clause 6.8.2.1.1.
The following steps are for creating association with block indication and in
case the PINE is announcer, or for creating association without block
indication.
9\. [Optional] The PEMC may setup direct connection with the PINE.
10\. [Optional] For creating association without block indication, the PEMC
sends Association Create Request (PIN ID, List of \) to the PINE.
When the PINE is announcer, the Connection Info is included, which is included
in the received Device Info of PINE, and MAC addresses of PEGCs may be
included to indicate the PINE only accept the direct connection with the PEGCs
corresponding to the MAC addresses.
For creating association with block indication and in case the PINE is
announcer, the PEMC sends Association Create Request (PIN ID, MAC addresses,
block indication) to the PINE, the PINE will not accept the direct connection
from the devices corresponding to the MAC addresses.
For removing association, the PEMC sends Association Remove Request (PIN ID,
[PEGC IDs], [MAC Addresses]) to the PINE, the PINE will remove the MAC
addresses from the allowed list or block list, and remove PEGC Function
Address, Connection Info, and MAC address corresponding to the PEGC IDs.
The PINE response to the PEMC.
NOTE: The Association Remove Request can be performed by the PEMC to install
block list of devices other than PEGC into PINEs.
11\. The PINE may perform Activate association procedure as described in
clause 6.8.2.3.2.
##### 6.8.2.3.2 Activate association
The procedure describes how an association between PEGC and PINE is
established after creation. When the PINE is close to a PEGC that direct
connection is allowed to be setup, the procedure is performed.
Figure 6.8.2.3.2-1: Activate association
1\. [Optional] The PINE and PEGC setup direct connection.
2\. [Optional] If the PINE is a guest (has not registered into PINMF or has
not been added into the PIN), the PINE sends Association Activate Request (PIN
ID, [PINE ID], [Device Metadata]) to the PEGC. When the PINE has registered
into PINMF, the PINE ID is included, otherwise Device Metadata is included.
3\. When the PEGC receives Association Activate Request from PINE, or the PEGC
establishes direct connection with a PINE, the PEGC sends the Association
Activate Request to the PEMC directly, or sends PEMC Notification (PEGC ID,
Association Activate Request) to PINMF and PINMF sends PEMC Event Notification
(PEGC, Association Activate Request) to the PEMC.
If PINE ID is not registered by the PEMC and not registered by the trust
member of the PEMC (Device List Information Query procedure as described in
clause 6.8.2.2.3 may be performed after step 3 for this purpose), the
procedure stops.
4\. [Optional] If Device Metadata is received and the PEMC allows the PINE
joins into the PIN, the PEMC performs steps 2-4 of PINE Registration procedure
as described in clause 6.8.2.2.2.
5\. [Optional] If the PINE is a guest, the steps 1-8 of Create Association
procedure as described in clause 6.8.2.3.1 are performed.
6\. The PEMC responds to the PEGC, which includes the PIN ID, PINE ID. The
PEMC sends the response directly or sends PEGC Notification (PEMC ID, PEGC ID,
Association Activate Response) to PINMF and PINMF sends PEGC Event
Notification (PEMC ID, Association Activate Response) to the PEGC.
7\. The PEMC sends Event Notification (PEMC ID, Association Info, Active
indication) to PINMF. The Association Info does not include block indication,
the Active indication indicates the related association is active.
8\. The PEGC sends Association Activate Response to the PINE.
##### 6.8.2.3.3 Deactivate association
The procedure describes how an active association between PEGC and PINE is
deactivated.
Figure 6.8.2.3.3-1: Deactivate association
1\. If the PEGC detects the direct connection between PINE and the PEGC is
lost (e.g. lost heartbeat between PEGC Function and PINE Function over direct
connection), the PEGC sends the Association Deactivate Request to the PEMC
directly, or sends PEMC Notification (PEGC ID, Association Activate Request)
to PINMF and PINMF sends PEMC Event Notification (PEGC ID, Association
Activate Request) to the PEMC.
Device List Information Query procedure as described in clause 6.8.2.2.3 may
be performed after step 1, e.g. the PEMC Function is recovered from dump.
2\. The PEMC responds to the PEGC, which includes the PIN ID, PINE ID, and
PEGC ID. The PEMC sends the response directly or sends PEGC Notification (PEMC
ID, PEGC ID, Association Deactivate Response) to PINMF and PINMF sends PEGC
Event Notification (PEMC ID, Association Deactivate Response) to the PEGC.
3\. The PEMC sends Event Notification (PEMC ID, Association Info, Deactive
indication) to PINMF. The Association Info does not include block indication,
the Deactive indication indicates the related association is deactive.
#### 6.8.2.4 Activate/Deactivate a PIN
The procedure describes how to activate or deactivate a PIN.
Figure 6.8.2.4-1: Activate/Deactivate a PIN
1\. The PEMC sends PIN Activate/Deactivate Request (PEMC ID, PIN ID) to the
PINMF.
2\. The PINMF authorize whether the PEMC is able to manage the PIN, if
authorization succeeds, the PINMF sends PIN Activate/Deactivate Request (PIN
ID) to the PINEs via PEGCs. The PINEs stop traffic handling and respond to the
PINMF via PEGC.
3\. The PINMF sends PIN Activate/Deactivate Request (SUPI/GPSI, PIN ID) to the
PCF per the PEGC in the PIN. The interaction between PINMF and PCF may be via
NEF.
4\. The PCF performs steps as described in steps 3-8 of clause 6.8.2.2.5 with
indicator that instructs the PEGC to activate/deactivate D2D Routing Rule and
D2N Routing Rule that described in solution #12, as well as open/close
non-3GPP access radio if the PEGC is listener.
5\. The PCF responds to the PINMF. The interaction between PINMF and PCF may
be via NEF.
6\. The PINMF responds to the PEMC.
### 6.8.3 Impacts on Existing Nodes and Functionality
**PINMF:**
\- Support PIN ID assignment.
\- Support PEMC and PEGC authorization operation.
\- Support PIN management operations.
\- Support the ability of authorizing PEGC by PLMN.
**UDM:**
\- Support PEMC authorization.
\- Support trust members query.
**UDR:**
\- Support PIN related information storage.
**NEF:**
\- Support exposure of PIN operations.
\- Support interaction with UDR or PCF for PIN operations.
**PCF:**
\- Support PIN Parameters creation/update/removal.
**UE (support PEGC):**
\- Support PIN Parameters provisioning over NAS.
## 6.9 Solution #9: PIN management and PINE management
### 6.9.1 Description
This solution is to address the KI#3 \"Management of PIN and PIN Elements\",
how an authorized UE to create a PIN. And how to add a device (PINE) into a
PIN, when a PIN is created and PEMC is available. In this solution, it assumed
that UDM is used to create/update/remove PIN profile that includes PIN
information and PINEs information, and allocate/manage the PIN ID. And may
allocate/manage PINE ID for the PIN. This solution also partly addresses the
KI#2 \"PIN and PIN Element discovery and selection\", KI#5 \"Authorization for
PIN\", KI#6 \"Policy and parameters provisioning for PIN\", and KI#7
\"Identification of PIN and PIN Elements\".
In this solution both PINE Info and PIN Info are defined as following:
**PINE Info:**
\- **PINE ID** , unique ID within a PIN that could be allocated by PEMC/PEGC
locally, or network.
\- **PINE type** , indicating whether it is PEMC, or PEGC, normal PINE.
\- **PINE name** , human readable information, e.g. printer in bedroom, or
lamp in living room.
\- **Service** , what the PINE can provide, e.g. printer, or lamp, or camera,
etc.
\- **PINE** **Valid time** , how long for the PINE to be as member in the PIN.
\- **Capability** , indicating the communication capability, e.g. WiFi, BT,
etc.
**PIN Info:**
\- **PIN ID** , unique ID within a PLMN and allocated by network.
\- **PIN name** , is readable information for user.
\- **PIN Services** , the list of the services that the PINE(s) can provide,
e.g. printer, lamp, camera, etc.
\- **PIN valid time** , to define how long the PIN can work, e.g. 30 minutes.
\- **List of PINE Info** , including all the information of PINEs in this PIN.
Editor\'s note: It is FFS how to authorize the UE to create PIN.
### 6.9.2 Procedures
#### 6.9.2.1 PIN management
##### 6.9.2.1.1 An authorized UE (PEMC) to create a PIN
Figure 6.9.2.1.1-1: Authorized UE creates a PIN
Here the authorized UE is allowed by the PIN owner to initiate to create a
PIN. When an authorized UE triggers a request to network for creating a PIN,
it may bring the candidates **PIN Info, e.g. the PIN name, etc.** optionally
candidates **PINE Info** , which some of the **PIN/PINE Info** may be designed
by user before creating the PIN, e.g. PINE name, capability, etc.
1\. UE sends the request to AMF via gNB for creating a PIN, which including
candidate PIN name, candidate PIN Service(s), candidate PIN valid time,
optional if available, a list of candidates PINE information containing
(candidates PINE ID, candidate PINE name, candidate PINE type, candidate PINE
service, candidate PINE capability, candidate PINE valid time).
When PINE ID is allocated by network, the candidates PINE ID is not included.
NOTE: Create PIN request message can be carried by Registration Request.
Editor\'s note: Whether Service Request or others possible is FFS.
2\. AMF requests to UDM for creating the PIN, with information carried in step
1. AMF may check with UDM whether the UE is authorized to create PIN. If no,
the AMF rejects the UE with proper cause.
3\. AMF sends the Create PIN response to UE/PEMC if the request is rejected by
AMF.
4\. UDM allocates the PIN ID based on UE request, and may allocates PINE ID
for each candidate PINE if PINE info included in the request, and create PIN
profile in the UE\'s subscription data, including e.g.
**PIN Info:**
\- PIN ID.
\- PIN name, e.g. Jian\'s smart home.
\- PIN Services, e.g. printer service, lamp service, camera service.
\- PIN valid time, e.g. 1 year.
\- List of PINE Info, including all the information of PINEs in this PIN.
**PINE1 Info:**
\- PINE ID, e.g. J001.
\- PINE type, e.g. PINE.
\- PINE name, e.g. printer in bedroom.
\- Service, e.g. printer service.
\- Valid time, e.g. 10:00-18:00 each day.
\- Capability, e.g. WiFi, BT.
**PINE 2 Info ......**
**PINE 3 Info ......**
5\. UDM response to AMF with result of creating PIN, including the results,
full PIN Info {PIN ID, PIN name, PIN Service, PIN valid time, optional list of
PINE Info}.
6\. AMF sends the service accept to UE via gNB, including results, and full
PIN Info.
##### 6.9.2.1.2 PIN creation from 3rd party
Figure 6.9.2.1.2-1: PIN creation from 3rd party
Procedure:
1\. AF requests to create a new PIN network to UDM via NEF, including: PIN
Info and PINE Info as defined in clause 6.9.1:
**PIN info:** PIN ID, PIN name, PIN Service(s), PIN valid time, list of PINE
info.
**PINE info:** PINE ID, PINE name, PINE type, capability, Service(s) and valid
time.
**At least includes one PEMC, and may include multiple PINEs information.**
2\. UDM creates PIN network based on the request from AF, by establishing PIN
profile to the UE\'s subscription data to include PIN info received from AF,
as well as the new PIN parameters generated by UDM, including PIN ID.
3\. When PIN is successfully established, UDM sends the PIN create response to
AF via NEF, including result (accepted, or rejected), may include PIN info,
e.g. PIN ID, other PIN parameters generated by UDM.
The result can be delivered to the 3rd party after step 9.
4\. UDM determines to trigger UPU procedure to provision the PIN info to the
PEMC.
5-6. UDM sends the PIN info to the PEMC via AMF and gNB.
7\. PEMC updates the PIN info locally based on the parameters received from
UDM.
##### 6.9.2.1.3 PIN deleting triggered by UDM
Figure 6.9.2.1.3-1: PIN deleting triggered by UDM
0\. UDM determines to delete the PIN, due to e.g. PIN valid time expired.
1\. UDM sends the PIN delete notification to AMF(s), including PIN ID, PEMC
ID(s).
2\. AMF sends the PIN delete notification to PEMC(s) via gNB, including PIN
ID, PEMC ID(s).
3\. PEMC(s) sends the PIN delete notification to all the PINE(s) in this PIN.
4\. PINE(s) may send the PIN delete ACK to PEMC.
5\. PEMC(s) deletes all the PIN information. This step can be performed after
step 2.
6\. Optional PEMC(s) sends the PIN delete ACK to UDM via gNB and AMF.
#### 6.9.2.2 PINE management
##### 6.9.2.2.1 A device joins a PIN
Figure 6.9.2.2.1-1: A device to join a PIN
In this solution, it assumed that PEMC broadcasts PIN network information,
e.g. PIN ID, PIN name, etc. so that the device discovers and selects the
target PEMC, and connection between device and PEMC is established via
non-3GPP RATs, e.g. WiFi, BT, etc.
1\. A device sends the Join PIN Request to PEMC via the established connection
between the device and PEMC, including PIN ID, Device ID, PINE type
(optional), capability, Service, name, etc. If PINE type is PEGC, the Join PIN
Request should also contain PEGC\'s PLMN ID.
2\. PEMC determines to accept the request. How to determine to accept the
request is up to implementation. PEMC allocates the PINE ID for the device.
And PEMC determines the PINE type, e.g. act as PEMC, or PEGC, or PINE. If the
PINE type is PEGC, the PEMC shall determine whether to accept the request
based on the PLMN ID of both PEGC and PEMC. If the PLMN ID of PEGC is the same
as the one of PEMC, the request is accepted. Otherwise, the request should be
denied.
3\. PEMC sends the Join PIN response to the device, including result (accept,
or reject), PIN Info and PINE Info as defined in clause 6.9.1.
**PIN info:** PIN ID, PIN name, PIN Service(s), PIN valid time, list of PINE
info;
**PINE info:** PINE ID, PINE name, PINE type, capability, Service(s) and valid
time.
4\. PEMC sends the PIN update request to AMF via gNB, including UE ID, PIN
Info container [PIN ID, new PINE info {PINE ID, PINE type, PINE name,
capability, service, valid time}].
NOTE 1: The PIN update request can be carried by Registration Request.
Editor\'s note: Whether Service Request or others possible is FFS.
5\. AMF sends the Nudm_UECM_Registration Request to UDM for updating the UE\'s
PIN Info, including message received in step 4.
Before updating the PIN Info, UDM may determine whether to accept the
updating, e.g. accept new PINE.
6\. UDM updates the received PIN info to the UE\'s subscription data.
When a PIN is created, the PIN related information is established as well in
the requested UE\'s subscription data.
7\. UDM sends the response to AMF, including the results, and updated PIN
Info.
8\. AMF sends the PIN update response to PEMC with result (accept, or reject),
and updated PIN Info.
9\. For another option instead of step 3, PEMC sends the join PIN Response to
device with result, and PIN/PINE info same as in step 3 after PEMC updating
the PIN info to UDM.
NOTE 2: In steps 1, 3 and 9, both application layer and new adapted layer are
possible options for delivering the messages.
##### 6.9.2.2.2 UE joins a PIN via 5GC
Figure 6.9.2.2.2-1 UE joins a PIN via 5GC
1\. UE sends the PINE join request to AMF via gNB, including PIN ID, PINE ID,
PINE type, valid time, capability, etc.
2\. AMF sends the PINE join request to UDM, including PIN ID, PINE ID, PINE
type, valid time, capability. AMF checks whether this UE is authorized to use
PIN service. if no, the request is rejected.
3\. UDM triggers the PIN authenticate/authorization towards to the PEMC.
4\. After successfully PIN authentication/authorization, UDM updates the PIN
profile with the new PINE information (PINE ID, PINE type, valid time, final
valid time, or optional allocate PINE ID for the UE if it is not included in
the request). UDM may determine the final valid time for the requested PINE
5\. UDM sends the PINE join response to AMF, including PINE ID, final valid
time, PIN info [PIN ID, PIN service, valid time, etc.
6\. AMF sends the PINE Join response to the UE (PINE) via gNB, including the
PIN related information in step 5.
### 6.9.3 Impacts on Existing Nodes and Functionality
Network impacts:
\- UDM allocates PIN ID for each create PIN request.
\- UDM may allocate PINE ID for each requested PINE.
\- UDM may manage the PIN info and PINE Info.
\- AMF requests management of PIN/PINE to UDM based on the PIN related
request.
\- UE (PEMC) determines whether PEGC can join PIN based on PLMN ID.
## 6.10 Solution #10: Management of PIN and PIN Elements
### 6.10.1 Description
#### 6.10.1.1 General
This solution is based on the architecture alternative A describe in clause
6.0A.
#### 6.10.1.2 Functional description
This solution addresses KI#3 \"Management of PIN and PIN Elements\".
Figure 6.10.1.2-1: PIN Architecture and gateway to 5G System
**Background on PIN Communication:** Higher layer protocol such as http is
used for internal PIN communication and 5G NAS signalling is used to
communicate with 5G systems such as PIN registration as described in solution
to KI#4. This solution uses IP broadcast message to discover PEMC. Unlike
conventional http over TCP, this solution proposes to send an Http discovery
message over UDP + IP broadcast address, so that all the devices connected
wirelessly get the http-based broadcast message. PIN elements can discover
PEMC by broadcasting this http discovery broadcast message and the appropriate
PEMC of different PIN(s) will respond to the queries. Similarly, PEMC will
periodically and upon successful PIN registration will send http-based
discovery message to all the wirelessly connected devices. Once PINE discovers
PEMC and gets the registered services and IP address or FQDN, it can
communicate with any PINE using http query-response messages as described in
solution for KI#4.
**Operator Policies or 3rd party policies:** The operator policies are pushed
to PIN from \"PIN Control Function\" (PINCTL) via N~PINCTL~ of the 5GC to the
PEMC of the PIN as described in solution for KI#1. PEMC will be NAS capable
and register to the 5GC or it can register through PEGC. Upon registration and
authentication with the 5G network, the PINCTL will communicate the policies
to the PEMC. Similarly, the 3^rd^ party configurations should be pushed to the
PEMC to enforce them on the PIN network.
**PIN Management:** The operator or 3^rd^ party policies will be pushed to the
PEMC of the appropriate PIN and the PEMC will update the repositories and
notify PIN elements appropriately. The following use cases will further
elaborate on management of PIN.
**Case \"Create PIN\":** PEMC will broadcast the new PIN announcement using
the PIN discovery response message to the connected devices on the wireless
network. The devices on the wireless network will intercept and based on its
configuration and policies the devices will decide to join the PIN.
**Case \"Modify PIN\":** PEMC will update its repository with the updated PIN
modification and notify the PIN elements appropriately.
**Case \"Delete PIN\":** PEMC will delete its PIN related repository and
notify all the PINE about the deletion of the PIN. Once the PIN is deleted,
any query-response and subscribe-notify from the PINE will not be honoured.
**Case \"Activate PIN\":** PEMC will broadcast the activation of PIN so that
the devices in the local wireless network can decide to join the PIN by
authenticating and registering with the PEMC.
**Case \"Deactivate PIN\":** PEMC will delete all its PIN related repository
and it will broadcast about the de-activation of the PIN to the PIN elements.
Once the PIN is de-activated, any query-response in the PIN will not be
honoured.
**PIN Element Management:** The management of the PINE will be pushed to the
PEMC either from the network operator or by the 3rd party.
**Case \"Add or delete PINE\":** PEMC will add or delete a PINE\'s FQDN or IP
address and its services to the PEMC repository and notify all the registered
PINE about the PINE addition or deletion. Once the PINE is deleted, any
request and subscribe from the PINE will not be responded or registered
respectively.
**Case \"PEGC and PINE association\":** Any changes to the PEGC and PINE
association will be updated in the PEMC repository and the appropriate PEGC
and PINE will be notified about the changes. For eg. Suppose PINE1 was
associated with PEGC1 and PEMC is the broker of a PIN network, and if there is
policy from the 5GC or 3^rd^ party to change the association of PEGC1 with
PINE1 then PEMC will update the old PEMC repository of the association of
PEGC1 with PINE1 to PEGC2 with PINE2 and will notify all PEGC1, PEGC2 and
PINE1 about the new policy association. After the policy update, PEGC1 will
terminate any ongoing association and will not honour any new association
request from the PINE1 and PEGC2 will honour and accept all the association
from PINE2.
**PIN Duration Validity:** PEMC of the PIN network can set a duration of the
PIN network by starting a timer based on the allowed duration of the PIN,
which will be a policy from the operator or 3^rd^ party policies. At the end
of the PIN allowable time, the PEMC will deactivate the PIN as described in
case \"Deactivate PIN\". Once the PIN is deactivated, the PEMC will update the
PINCTL of the 5G-Core about the PIN deactivation. Optionally, PINCTL can also
start a timer to make sure that the PIN is disabled as per the allowable
duration.
### 6.10.2 Procedures
#### 6.10.2.1 PEMC Triggered Service Request to Update PIN_List Procedure
Figure 6.10.2.1-1: PEMC Triggered Service Request to update PIN_List
1\. When a new PINE joins the PIN, the PEMC will send a new Service Request
with updated PIN_List to the RAN. A typical Service Request with PIN_List will
include \"PINE list\", which contains an updated list of PINE elements and its
associated policies and parameters. For example, a typical \"PINE list\" will
be as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
2\. RAN forwards the N2 message (Service Request with the updated PIN_List) to
the AMF.
3\. Conventional Authentication Security is performed according to clause
4.2.3 of TS 23.502 [3].
4\. AMF will send the Update PIN_List message to the PCF.
5\. PCF will send the Update PIN_List to PINCTRL for its approval.
6\. PINCTRL will decide based on the subscription and 3rd party/operators
policy and send the Acknowledged update PIN_List to the PCF. A typical update
PIN_List is as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=FASLE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
7\. PCF will send the Acknowledged update PIN_List to AMF.
8\. AMF will send N2 Request with Acknowledged PIN_List to RAN.
9\. RAN will send the Update PIN_List response and the acknowledged PIN_List
to the PEMC.
#### 6.10.2.2 Network Triggered Service Request to Update PIN Policies
Procedure
Figure 6.10.2.2-1: Network Triggered Service Request to update PIN/PINE
Policies
0\. PINCTRL decides to update the PEMC PIN policies either due to operator or
3rd party policy update.
1\. PINCTRL invokes Namf_communication_N1N2MessageTransfer service operation
provided by the AMF. The message includes SUPI of PEMC, PEMC PIN Policy
container.
2\. If the PEMC is registered and reachable by AMF in either 3GPP access or
non-3GPP access, AMF shall transfers transparently the PEMC PIN Policy
container to the PEMC via the registered and reachable access.
If the PEMC is not reachable by AMF over both 3GPP and non-3GPP access, the
AMF reports to the PCF that the PEMC PIN Policy container could not be
delivered to the PEMC using Namf_communication_N1N2MessageTransfer as
mentioned in clause 4.2.3.3 of TS 23.502 [3].
3\. If the PEMC is in CM-CONNECTED over 3GPP access or non-3GPP access, the
AMF transfers transparently the PEMC PIN Policy container (PIN related policy
information) received from the PINCTRL to the PEMC. The PEMC policy container
includes the list of PIN policy as described in clause 6.10.2.1 and 6.10.2.2.
4\. The PEMC updates the PIN Policy provided by the PINCTRL and sends the
result to the AMF
5\. If the AMF received the PEMC PIN Policy container and the PINCTRL
subscribed to be notified of the reception of the PEMC PIN policy container
then the AMF forwards the response of the PEMC to the PINCTRL using
Namf_communication_N1N2MessageNotify. The PINTCTRL will further handle
successful and failure Notification accordingly.
### 6.10.3 Impacts on services, entities and interfaces
The solution largely re-uses existing functionality
The solution has the following impacts:
Impact to the UE (PEMC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to maintain a list of all the PINE and its supported services.
Impact to the UE (PINE/PEGC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
Impact to the 5G System:
\- Add new Network Function (PINCTL) to the NAS.
\- Add new fields to the Registration request such as \"PIN capable\".
\- Add new fields to the Registration Accept message such as \"PIN
allowable\", \"PIN Name\".
\- Add the following fields or parameters to the AMF paging:
\- Updated \"PINE list\", which contains a list of PINE elements and its
associated policies and parameters. For e.g. A typical \"PINE list\" will be
as follows:
\- PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED
\- PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE, DURATION
= UNLIMITED
## 6.11 Solution #11: Differentiated QoS between a PINE and 5GS when a PEGC is
used for the relay
### 6.11.1 Description
#### 6.11.1.1 Introduction
This solution mainly addresses Key Issue #4 \"Communication of PIN\".
QoS experienced by PINEs connected behind a PEGC depends on the end-to-end
path between a PINE and the application server, i.e. depends on the QoS
differentiation in both the 3GPP network and the non-3GPP network attached to
the PEGC.
For example, a certain Packet Error Ratio (PER) can only be successfully
ensured if it is enforced in both the 3GPP network and the non-3GPP network
attached to the PEGC.
To address this shortcoming, this solution proposes to indicate Non-3GPP QoS
assistance information to the PEGC to enable the PEGC to perform QoS
differentiation for the PINEs in the non-3GPP network behind the PEGC.
Note that this is conceptually similar as providing Additional QoS Information
to a UE for trusted/untrusted access to 5GC as defined in TS 23.502 [3], which
enables the UE to reserve resources in the non-3GPP network. The difference is
that the Non-3GPP QoS assistance information is used to reserve resource in
the non-3GPP network attached to the PEGC. In line with the definition of
Additional QoS information, the details of how to enforce QoS in the non-3GPP
network based on the Non-3GPP QoS assistance information are beyond the scope
of 3GPP.
#### 6.11.1.2 Solution principles
The solution is based on the following principles:
\- This solution focuses on the AF requested QoS control of PINE communication
to 5GS via PEGC, which has no dependence on the PIN management capability.
\- During PDU session establishment and PDU session modification, if the SMF
provides the PEGC with QoS flow descriptions, the SMF may, based on
subscription, additionally signal non-3GPP QoS assistance information for each
QoS flow to the PEGC. The non-3GPP QoS assistance information consists of the
following QoS information (if available at the SMF): QoS characteristics,
GFBR/MFBR (if applicable), ARP, Periodicity.
\- Based on the non-3GPP QoS assistance information together with QoS rule
information, the PEGC may reserve resources in the non-3GPP network.
NOTE: The details of how to enforce QoS based on the Non-3GPP QoS assistance
information in the non-3GPP network are not subject of this solution and are
considered to be beyond the scope of 3GPP.
### 6.11.2 Procedures
Figure 6.11.2-1: Providing Non-3GPP QoS assistance information to the PEGC to
enable the PEGC to ensure QoS in the non-3GPP network attached to the PEGC
1\. PDU Session is established
2\. Application layer signalling is exchanged between an application on a PINE
connected to the PEGC and an application function (AF)
3\. Based on the application layer signalling, the AF requests QoS for
application flows.
NOTE 1: If the AF is not considered trusted, then the AF interacts with the
NEF instead. If the AF provides explicit QoS parameters, then AF (or NEF in
case the AF is not trusted) interacts with PCF as defined in clause 4.15.6.6
of TS 23.502 [3].
4\. PCF sends PCC rules to the SMF.
NOTE 2: Steps 1-4 are following existing Rel-17 specifications.
5\. SMF performs PDU Session modification as defined in clause 4.3.2 of TS
23.502 [3] and may include, based on subscription data of the PEGC and network
operator\'s policy, in the N1 SM container per QoS-flow Non-3GPP QoS
assistance information. The Non-3GPP QoS assistance information contains (if
available at the SMF): QoS characteristics, GFBR/MFBR (if applicable), ARP,
Periodicity.
6\. Based on the non-3GPP QoS assistance information and QoS rule information,
the PEGC may reserve resources in the non-3GPP network.
### 6.11.3 Impacts on Existing Nodes and Functionality
**SMF:**
\- To provide per-QoS flow Non-3GPP QoS assistance information.
**PEGC:**
\- To receive additional Non-3GPP QoS assistance information in NAS-
Optionally enforce QoS in the non-3GPP network. The details of how to enforce
QoS in the non-3GPP network are not subject of this solution and are
considered to be beyond the scope of 3GPP.
## 6.12 Solution #12: Communication of PIN
### 6.12.1 Description
#### 6.12.1.1 General
This solution mainly addresses KI#4 \"Communication of PIN\". This solution
also addresses some part of the KI#6 \"Policy and parameters provisioning for
PIN\", i.e. UE to UE relay parameter provisioning and QoS parameter
provisioning, as well as part of the KI#7 \"Identification of PIN and PIN
Elements\", i.e. SMF assigns PINE ID and PINE IP and sends them to PEGC.
The steps in the following call flows depicted as grey line in the figures are
out of SA WG2 scope.
This solution is related to the solution 8 \"management of PIN and PIN
Elements\" addresses to KI#3, and the solution is based on architecture
alternative C described in clause 6.0C.
#### 6.12.1.2 Overall procedure for PIN communication
The figure 6.12.1.2-1 depicts the overall procedure for PIN communication.
Figure 6.12.1.2-1: Overall procedure for PIN communication
1\. [Optional] The PINE may send traffic for communicating with another PINE,
or with PEMC, or outside the PIN. The PEGC does not have the routing rule for
the traffic, then requests the PEMC to allow the routing.
2\. [Optional] If step 1 is performed and the PEGC has not established the PDU
Session associated with PIN, the PEGC initiates PDU Session Establishment
procedure. The PEMC may send traffic for communicating with a PINE, if the
PEMC has not established PDU Session associated with PIN, the PEMC initiates
PDU Session Establishment procedure. The PEGC and PEMC may establish the PDU
Session associated with PIN anyway, i.e. no matter whether the relay is needed
or not, the PEGCs and PEMCs setup the 5G-LAN as described in clause 5.29 of TS
23.501 [2] and clause 4.13.8 of TS 23.502 [3].
3\. The PEMC requests communication with a PINE, or the PEMC requests
communication for the PINE no matter whether step 1 is performed or not.
4\. [Optional] If the PEGC or the PEMC have established PDU Session associated
with PIN, the PINMF requests the 5GC to setup or update the 5G-LAN, the 5G-LAN
is not for only a specific PIN, but for all the PINs that the PEMC or Trust
Members of the PEMC has created.
5\. The PINMF requests 5GC to initiate PDU Session Modification. During the
PDU Session Modification procedure, the policy and parameters for PIN QoS and
routing is provisioned to SMF, UPF, NG-RAN, and PEGC.
The SMF may trigger the authentication and authorization procedure between a
PINE and UDM/AAA via a PEGC so that any other malicious PINE is not able to
forge the PINE to use its policy for communication.
### 6.12.2 Procedures
#### 6.12.2.1 Management of relay path
The procedure describes how a virtual LAN is built and the routing rule for
traffic is enforced.
Figure 6.12.2.1-1: Management of relay path
1\. [Optional] The PINE establishes direct connection with PEGC.
2\. [Optional] The PINE may send traffic for communicating within PIN or
outside PIN.
3\. [Optional] If step 2 is performed and the PEGC does not have routing rule
for the traffic, the PEGC sends the PIN Relay Request (PIN ID, PINE ID,
Traffic description, [DN-specific ID]) to the PEMC directly, or sends PEMC
Notification (PEGC ID, PIN Relay Request) to PINMF and PINMF sends PEMC Event
Notification (PEGC ID, PIN Relay Request) to the PEMC. The Traffic description
describes the 5-tuple of the traffic. If the request is related to internet
services, the DN-specific ID may be included.
4\. The PEMC sends Relay Activate/Deactivate Request (PIN ID, PEMC ID, PEGC
ID, PINE ID, Packet filters) to the PINMF. If step 3 is performed, Relay
Activate Request is used.
The PINMF authorizes the request whether the PEMC ID is able to manage the
PIN, if succeeds, then the following steps are performed, otherwise stop.
5\. [Optional] If the PEGC, or PEGC and PEMC, need to be included in the
5G-LAN for all the PINs that created by the PEMC or the trust members of the
PEMC, the PINMF sends UP Change Request ([SUPI/GPSI], UE address,
[DNN/S-NSSAI], DNAI) to the PCF via N5 interface or NEF for the PEGC or PEGC
and PEMC separately, which is described in clause 4.3.6.2, 4.3.6.3, and
4.3.6.4 of TS 23.502 [3] and clause 5.6.7 of TS 23,501 [2].
6\. [Optional] The procedure described in clause 4.3.5 of TS 23.502 [3] may be
performed to change the serving SMF that supports PIN according to the DNAI.
The AMF selects new SMF according to the combination of DNN and S-NSSAI, or
combination of DNN, S-NSSAI, and DNAI. In order to anchor all the PDU Sessions
of members in a PIN Trust Members Group at same SMF, the NRF is configured
with one SMF associated with the combination of DNN and S-NSSAI, or the
combination of DNN, S-NSSAI, and DNAI.
7\. [Optional] The SMF notifies the UP path management events with the
indication whether the IP address of the PEGC/PEMC is changed to the PINMF
(optionally via NEF) similar as described in steps 4a, 4b, and 4c of clause
4.3.6.3 in TS 23.502 [3].
NOTE: For 5G VN feature, in order to anchor all the PDU Sessions of a 5G VN
group members at same SMF, the UDM is configured to map a combination of DNN,
S-NSSAI to a 5G VN group, and NRF is configured to map the combination of DNN,
S-NSSAI to one SMF. PIN can reuse the mechanism, but this requires different
Trust Members Group is associated with different combination of DNN, S-NSSAI.
8\. [Optional] If the IP address of the PEMC is changed, the PEMC sends Event
Notification (PEMC ID, old IP address, new IP address) to the PINMF.
9\. [Optional] If the IP address of the PEGC is changed, the PEGC sends Event
Notification (PEGC ID, old IP address, new IP address) to the PINMF.
10\. The PINMF sends Relay Activate/Deactivate Request ([SUPI/GPSI], UE
address, [DNN/S-NSSAI], PIN ID, PINE ID, [P2P Routing Rule], [P2N Routing
Rule, [NLSP Routing Rule], [DL Packet filters], [UL Packet filters], [Framed
Route Info], [Authentication Assistance Info], QoS reference) to the PCF via
N5 interface or NEF. The P2P Routing Rule is used by PEGC that includes the
information whether some PINEs are allowed/disallowed to communicate with
other PINEs via the PEGC. The P2N Routing Rule includes packet filters that
the PEGC is able to relay and may include service requirements for the PINE
associated with the packet filters. The NLSP Routing Rule is used by UPF that
includes the information whether some PINEs are allowed/disallowed to access
other PINEs, or the PEMCs. The UL/DL Packet filters includes the information
whether some PINEs are allowed/disallowed to access internet, or a specific
internet service. The Authentication Assistance Info may be included, which
contains MAC Address that preconfigured in the PINMF for non-3GPP device case,
or UE ID for PEMC case.
If it is the first time for activate the relay for the PEGC, the Framed Route
Info may be included and used by the SMF to configure framed routing as
described in clause 5.6.14 of TS 23.501 [2] for the PDU Session of the PEGC.
The PCF uses the policy of the PEGC to authorize the QoS requirements for the
PINE.
In case of Framed Route is used, the IPv6 delegation or SMF assigned IP (step
9) for PINEs behind the PEGC may be used.
The SMF uses the Framed Route Info to configure framed routing as described in
clause 5.6.14 of TS 23.501 [2] with the UPF for the PDU Session of the PEGC.
11\. The PCF sends Relay Activate/Deactivate Request (SUPI, PDU Session ID,
PIN ID, [P2P Routing Rule], [P2N Routing Rule], [NLSP Routing Rule], [DL
Packet filters], [UL Packet filters], [Framed Route Info], [Authentication
Assistance Info], QoS profile) to the SMF.
12\. The SMF may trigger authentication and authorization procedure between
PINE and UDM, or between PINE and external DN-AAA, via the PEGC, i.e. the SMF
sends EAP Identity Request to the PINE. EAP framework is used for the
authentication and authorization. When the authentication succeeds, the AAA
sends the MAC Address to the SMF, the UDM sends UE ID to the SMF. The SMF
verifies the MAC Address/UE ID based on the Authentication Assistance Info.
Editor\'s note: The authentication and authorization procedure as well as the
content of the Authentication Assistance Info need coordination with SA WG3.
13\. The SMF interacts with UPF(s) serving the PDU Session of the PEGC, or
PEGC and PEMC to establish/update the 5G VN based on the DNAI, and install,
update, remove a corresponding FWA according to the NLS Routing Rule and DL
Packet filters.
14\. The SMF performs PDU Session Modification with the PEGC, may add, update,
or remove QoS flows serve the PINE, and delivers the PIN ID, P2P Routing Rule,
and P2N Routing Rule to the PEGC via N1 message during the PDU Session
Modification.
The QoS rules provided to the PEGC includes packet filters corresponds to
PINEs, e.g. IP range, or port range, or both, the PEGC performs P2N relay and
maps traffic with the QoS flow based on the QoS rules. The PCF may consider
the type of direct connection (e.g. WiFi, BT, PC5) to deduce the QoS rules,
e.g. uses a fixed value for the delay of direct connection.
During the PDU Session Modification procedure, the SMF may allocate IP address
for the PINE and sends the IP address and PINE ID to the PEGC via N1 message.
The PEGC associates the PINE ID and IP address with the PINE, the PEGC
transfers the inner address of the PINE to the IP address received. The PEGC
responds to the SMF. If IPv6 delegation is used, the PEGC also sends the IP
address of the PINE to the SMF. The PEGC may reports the Port Range that
allocated for the PINE to the SMF. The SMF can identify the PINE via the PINE
ID and the UPF can identify the PINE via the IP address.
Editor\'s note: For the case that PINMF is 3rd party AF, how the PEGC
authorize that the P2P Routing Rule or P2N Routing Rule are configured by a
PEMC needs coordination of SA WG3.
15-16. The SMF responds to the PCF. The PCF responds to the PINMF. If the
Authentication Assistance Info is received, the SMF indicates whether the
verification succeeds or not. The SMF may indicate Relay Assistance Info,
which contains PINE related information, e.g. transferred IPv6 address of
PINE, transferred IPv4 address and IP port range of PINE, etc. The interaction
between PINMF and PCF may be via NEF.
17\. The PINMF responds to the PEMC with Device Info of the PINE.
18\. [Optional] The PEMC responds to the PINE via PEGC.
#### 6.12.2.2 Mobile termination procedure for PINE
The procedure describes how traffic is sent to a PINE when direct connection
of the PINE is lost.
Figure 6.12.2.2-1: Mobile termination procedure for PINE
1\. The PEGC established a PDU Session with SMF supporting PIN.
2\. The PINMF sends Relay Activate Request ([SUPI/GPSI], UE address,
[DNN/S-NSSAI], PIN ID, PINE ID, Status Info) to the PCF via N5 interface or
NEF. The Status Info includes the type of the PINE, which indicates whether
the PINE is notifiable, e.g. when the PINE is a listener and PEGC is announcer
over the, e.g. WiFi, BT, etc, or when the PINE is an announcer and the PEGC is
listener, e.g. the PINE is a hot spot of Wi-Fi.
3\. The PCF sends Relay Activate Request (SUPI, PDU Session ID, PIN ID, PINE
ID, Status Info) to the SMF.
4-5. The SMF responds to the PCF. The PCF responds to the PINMF (optionally
via NEF).
6\. The PEGC may detect that the communication with the PINE is not available,
e.g. user closes the WiFi or BT on PINE or PEGC, or the PEGC closes the WiFi
when in CM-IDLE. The PEGC sends Event Notification (PEGC ID, PINE ID, lost) to
PINMF. The PINMF authorizes the request and sends Relay Activate Request
([SUPI/GPSI], UE address, [DNN/S-NSSAI], PIN ID, PINE ID, Status Info) to the
PCF via N5 interface or NEF if authorization succeeds. The Status Info
includes the information of the PINEs that are unreachable and notifiable. The
PCF sends Relay Activate Request (SUPI, PDU Session ID, PIN ID, PINE ID,
Status Info) to the SMF. The SMF responds to the PCF. The PCF responds to the
PINMF (optionally via NEF).
The PEGC may detect that the direct connection with the PINE is lost, the PEGC
initiates PDU Session Modification indicating the PINE is unreachable.
The PEGC may transit into CM-IDLE state or the PDU Session for relay may be
inactive, the PEGC initiates PDU Session Modification.
7\. According to the information received in step 6 and the Status Info of the
PINE, the SMF interacts with the UPF serving the PDU Session of the PEGC for
instructing that DL data notification for the PINE is needed.
8\. When DL data to the PINE is arrived and DL data notification is
instructed, the UPF sends DL data notification related to the PINE to the SMF.
9\. The SMF sends N1 message to the PEGC via the AMF to indicate the PEGC to
open WiFi or BT in order to establish direct connection with the PINE.
10\. The PINE and the PEGC establish the direct connection according to the
instruction.
#### 6.12.2.3 Support credential provisioning for PINE
The procedure describes how to support the credential provisioning for PINEs.
Figure 6.12.2.3-1: Credential provisioning for PINE
1\. [Optional] The PINE establishes direct connection with PEGC.
2\. [Optional] The PINE sends Credential Provisioning Request (PIN ID, PINE
ID, Duration) to the PEGC. The Duration indicates the lifetime of the path for
the remote provisioning.
3\. [Optional] The PEGC sends the Credential Provisioning Request to the PEMC
directly, or sends PEMC Notification (PEGC ID, Credential Provisioning
Request) to PINMF and PINMF sends PEMC Event Notification (PEGC ID, Credential
Provisioning Request) to the PEMC.
4\. The PEMC sends Credential Provisioning Request (PIN ID, PEMC ID, PEGC ID,
PINE ID, Duration) to the PINMF. The PEMC may change the Duration received
from step 3.
The PINMF authorizes the request whether the PEMC ID is able to manage the
PIN, if succeeds, then the following steps are performed, otherwise stop.
5\. The PINMF sends Credential Provisioning Request ([SUPI/GPSI], UE address,
[DNN/S-NSSAI], PIN ID, PINE ID, D2N Routing Rule, UL Packet filters, DL Packet
filters, Duration) to the PCF via N5 interface or NEF. The PINMF may
determines the Duration based on local policy. The D2N Routing Rule and DL
Packet filters is generated based on the vendor name of the PINE.
6\. The PCF sends Credential Provisioning Request (SUPI, PDU Session ID, PIN
ID, D2N Routing Rule, DL Packet filters, Duration) to the SMF.
7\. The SMF interacts with UPF serving the PDU Session of the PEGC to install
a corresponding forwarding rule according to the DL Packet filters.
8\. The SMF performs PDU Session Modification with the PEGC and delivers the
PIN ID, PINE ID, D2N Routing Rule, and Duration to the PEGC via N1 message.
9\. The SMF responds to the PCF.
10\. The PCF responds to the PINMF (optionally via NEF).
11\. The PINMF responds to the PEMC.
12\. The PEMC responds to the PINE via PEGC, or sends Credential Provisioning
Notification to the PINE.
From now on, the PINE is able to interact with provision server, which may be
a 3rd party or operator managed.
13\. When timeout, the SMF interacts with UPF serving the PDU Session of the
PEGC to remove the corresponding forwarding rule according to the DL Packet
filters. When timeout, the PEGC removes the D2N Routing Rule.
NOTE: The operator network can disallow the traffic to any known provision
server until the credential provisioning request is authorized.
Editor\'s note: The support of credential provisioning needs coordination with
SA WG3.
### 6.12.3 Impacts on Existing Nodes and Functionality
**PINMF:**
\- Support PIN ID assignment.
\- Support PIN parameters provisioning to PCF directly or via NEF.
**SMF:**
\- Support PIN Relay operations with PCF.
\- Support instructing UPF for rules related to PIN Elements.
\- Support provisioning relay information to PEGC over NAS.
\- Support receiving and delivering N1 message related to DL data notification
of a PINE.
\- Support triggering authentication and authorization procedure between PINE
and UDM/external DN-AAA.
\- Support PINE ID and IP address provisioning for PINE to PEGC over NAS.
**PCF:**
\- Support authorizing the QoS requirements for PINE associated with the PEGC.
\- Support PIN Association operations with PINMF and SMF.
**UE (support PEGC):**
\- Support relay information provisioning for PIN over NAS.
\- Support proxy authentication and authorization procedure between PINE and
UDM/external DN-AAA.
\- Support PINE ID and IP address provisioning for PINE over NAS, and perform
NAT for the PINE with the IP address.
## 6.13 Solution #13: Communication of PIN
### 6.13.1 Description
The solution describes the following PIN communication aspects:
1) Communication between PIN Elements within a PIN via PEGC, via 5GS and
direct.
2) PIN Element relay path setup with 5GS via PEGC
3) 5GS QoS differentiation for PINE via PEGC
#### 6.13.1.1 Communication between PINE and 5GS via PEGC
The architecture for providing relay path between PINE and 5GS via PEGC
Figure 6.13.1.1-1: Relay Path Architecture between PINE and 5GS via PEGC
**Assumption** : The PIN elements are connected to a wireless LAN/ PAN network
and each element are reachable via the wireless link. The procedure to connect
to the wireless network and assign IP address is out of the scope of this
document.
The salient feature of this solution is as follows:
**\- Setup.** PINE in the PIN will request PEGC for 5G session establishment
using request-response queries. The PEGC will establish a PDU session with the
5G network based on the existing procedure defined in clause 4.3.2.2 of TS
23.502 [3].
\- PINE will configure PEGC as its default gateway, so that all the traffic is
sent to the 5G network via PEGC relay.
\- PEGC acts as a Network Address Translator (NAT) between 5G network and the
PIN by representing a unique IP address to all the PINE and PEMC in the PIN
network.
\- PEGC establishes a unique PDU session with 5G network for every PINE
requesting for 5GS relay access through PEGC.
\- PEGC maps local FQDN or IP address of the PINE to the PDU session ID and
uses this mapping to forward the data from/to PINE and 5G PDU unique session.
**\- QoS differentiation.** This solution proposes following two ways to
achieve differentiated services
\- PINE requesting for a desired QoS will request the PEGC to setup a PDU
session using control signals (Http messages) with the intended QoS, and PEGC
will setup appropriate PDU session. All the traffic from the PIN will be
forwarded to the PDU session with the desired QoS.
\- PINE will use DSCP markings on the IP packet in the PIN to indicate the
desired QoS and PEGC will setup an appropriate 5QI PDU session with the DNN,
and further PEGC will reset the QoS marking on the IP packet and forward it to
the established PDU session.
\- PEGC will also provide the necessary QoS as indicated by the PINE on the IP
packets in the PIN network.
**\- Release.** PINE in the PIN will request PEGC for 5G session release using
request-response quires. The PEGC will release the respective PDU associated
with the PINE - PEGC uses PDU ID and PINE FQDN or IP address of the PINE in
the local PIN.
#### 6.13.1.2 Communication between PIN elements within PIN
The architecture for providing communications between PINE in the PIN.
Figure 6.13.1.2-1: Relay Path Architecture between PINE and 5GS via PEGC
**Assumption** : The PIN elements are connected to a wireless LAN/ PAN network
and each element are reachable via the wireless link. The procedure to connect
to the wireless network and assign IP address is out of the scope of this
document.
The salient feature of this solution is as follows:
**\- Direct Communication.** PINE, PEGC and PEMC will use Request-response and
Subscribe-Notify methods to communicate with each other. Since PINE are
reachable via direct or in LAN connection, PINE will communicate with each
other directly using intended PINE\'s FQDN or IP address.
**\- Via PEGC.** PINE should set PEGC as its default gateway so that all the
communication is via PEGC. Packets from PINE intended to other PIN elements in
the PIN related to local services or local communication are routed by the
PEGC locally, since PEGC has PINE repositories which includes FQDN or IP
address of the PINE in the PIN.
\- **Via 5GS.** All the packets, from PINE, including local PIN destination
are routed to the PEGC gateway. In case of local destination address, PEGC
will map it to its NAT address and then forward it to the 5GC, which will in
turn forward it back to the PEGC. Once PEGC receives such a packet, it will
translate the NAT address to local PIN address and forward it to the
appropriate PINE.
### 6.13.2 Procedures
Figure 6.13.2-1: Communication of PIN
1\. PINE (PINE1) in the PIN will send HTTP request to PEGC for PDU session
establishment with the required QoS.
2\. PEGC will Acknowledge PINE (PINE1) with a HTTP OK response.
3\. PEGC will Establish PDU session with the requested QoS on behalf of
PINE(PINE1) as described in clause 4.3.2.2 of TS 23.502 [3]. PEGC identifies
this session as PDU1 mapped to the requested PINE(PINE1). (PINE1 can request
for different QoS using the step 1 and PEGC will setup different sessions with
the requested QoS and assigns a unique local destination port as shown in
figure-6.13.1.1.
4\. Once PDU session is established, PEGC will notify the PINE (PINE1) about
successful PDU establishment with the intended QoS.
5\. PINE (PINE1) will forward all the traffic intended with QoS1 to the
assigned PEGC port. PEGC will act as router + NAT to forward the packet to the
PDU1 session.
6\. Another PINE (PINE2) in the PIN can also send HTTP request to PEGC to
establish PDU session with required QoS.
7\. PEGC will Acknowledge PINE (PINE2) with a HTTP OK response.
8\. PEGC will Establish PDU session with the requested QoS on behalf of
PINE(PINE2) as described in clause 4.3.2.2 of TS 23.502 [3]. PEGC identifies
this session as PDU2 mapped to the requested PINE(PINE2). (PINE2 can request
for different QoS using the step 6 and PEGC will setup different sessions with
the requested QoS and assigns a unique local destination port as shown in
figure-6.13.1.1.
9\. Once PDU session is established, PEGC will notify the PINE (PINE2) about
successful PDU establishment with the intended QoS.
10\. PINE (PINE2) will forward all the traffic intended with QoS2 to the
assigned PEGC port. PEGC will act as router + NAT to forward the packet to the
PDU2 session.
### 6.13.3 Impacts on services, entities and interfaces
The solution largely re-uses existing functionality
The solution has the following impacts:
Impact to the UE (PEMC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to maintain a list of all the PINE and its supported services.
\- Ability to respond to PINE and its service discovery queries from the PINE.
Impact to the PINE:
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to request QoS using http request to the PEGC.
Impact to the UE (PEGC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to register its gateway functionality to PEMC.
\- Ability to accept http QoS request from the PINE and setup multiple PDU
session with the 5G System.
\- Ability to map PDU session ID to the IP address of the PINE and forward
packets to/from the corresponding PDU session.
## 6.14 Solution #14: Discover PIN and PIN element via direct discovery
### 6.14.1 Description
The solution applies to Key Issue #2 \"PIN and PIN Element discovery and
selection\" and Key Issue #6 \"Policy and parameters provisioning for PIN\".
The PIN architecture is depicted as in Figure 6.14.1-1. The PEMC and PEGC have
Uu capability and can access 5GC using the procedures as defined in TS 23.502
[3]. The PINE may have limited communication capability and can only support
some forms of direct non-3GPP access, e.g. Wi-Fi or BT.
Figure 6.14.1-1: Reference architecture for PIN
The PEMC is responsible for managing the PIN, including creating a PIN,
adding/removing a PINE from the PIN, etc. The PEMC may be preconfigured with
PIN information that it can support, or the PIN information can be provisioned
by PCF to the PEMC.
The PEGC provides connectivity services for PINE to access the network. The
PEGC may be preconfigured with connectivity service information that it can
support, or the connectivity service information can be provisioned by PCF to
the PEGC.
The PINE can communicate with PEMC, PEGC and other PINEs via direct non-3GPP
access (e.g. Wi-Fi and BT). The PINE discovers the PEMC by using direct
discovery, and the PINE is authorized by the PEMC to join the PIN. The PINE
discovers the PEGC also by using direct discovery if it needs to communicate
with the network.
### 6.14.2 Procedures
#### 6.14.2.1 Procedures for policy and parameters provisioning for PIN
The policy and parameters for PIN and PIN element discovery may be provisioned
by PCF.
The \"PCF based Service Authorization and Provisioning to UE\" procedure as
defined in clause 6.2.2 of TS 23.304 [6] is reused with the following
differences:
\- If the UE indicates PEMC/PEGC Capability in the Registration Request
message and if the UE is authorized to act as PEMC/PEGC based on subscription
data, the AMF selects the PCF which supports PIN policy/parameter provisioning
and establishes a UE policy association with the PCF for PIN policy/parameter
delivery.
\- If the UE supports PEMC/PEGC and it does not have valid PIN
policy/parameters, the UE includes the UE Policy Container with indicating the
PIN Policy Provisioning Request during registration procedure. The UE may also
include PEMC/PEGC capabilities in the PIN Policy Provisioning Request and PCF
may determine the PIN policy/parameters for the UE based on received UE
capabilities.
\- If the UE indicates the PIN Policy Provisioning Request in the UE Policy
Container, the PCF determines whether to provision PIN policy/parameters to
the UE, and the PCF provides the PIN policy/parameters to the UE by using the
procedure as defined in clause 4.2.4.3 of TS 23.502 [3].
The \"AF-based service parameter provisioning for ProSe over control plane\"
procedure as defined in clause 6.2.5 of TS 23.304 [6] is reused for PIN AS to
provide PIN Service Parameters to the PCF.
Editor\'s note: How to support trusted PIN AS to provision PIN
policy/parameter is FFS.
#### 6.14.2.2 Procedures for PIN and PIN Element discovery
Depicted in figure 6.14.2.2-1 is the procedure for PIN and PIN Element
discovery.
Figure 6.14.2.2-1: PIN and PIN Element discovery
1\. PEMC/PEGC is preconfigured or provisioned with PIN information as
described in clause 6.14.2.1. The PIN information may include PIN identity,
PIN type, etc. and the details are addressed by solutions for KI#7.
2\. The PEGC discovers PEMC via direct discovery over non-3GPP access (e.g.
Wi-Fi and BT) after the Wi-Fi or BT connection is established. The application
layer signalling is used for direct discovery, and the PIN information is used
as criteria for PEGC to discover the appropriate PEMC. The PEGC is added to
the PIN if authorized by the PEMC.
3\. The PINE discovers PEMC via direct discovery over non-3GPP access (e.g.
Wi-Fi and BT) after the Wi-Fi or BT connection is established. The application
layer signalling is used for direct discovery, and the PIN information is used
as criteria for PINE to discover the appropriate PEMC. The PEGC info may also
be provided to the PINE in order for PINE to discover a PEGC.
4\. The PINE discovers PEGC via direct discovery over non-3GPP access (e.g.
Wi-Fi and BT) after the Wi-Fi or BT connection is established. The application
layer signalling is used for direct discovery, and the PEGC information and
connectivity service information are used for PINE to discover an appropriate
PEGC.
### 6.14.3 Impacts on services, entities and interfaces
UE:
\- Request and Receive PIN policy/parameters from PCF.
\- Support PIN and PIN Element discovery via direct discovery.
PCF:
\- Provision PIN policy/parameters to UE.
UDR:
\- Store PIN policy/parameters provided by PIN App Server.
## 6.15 Solution #15: Discovery of PIN/PINE Services via 5GC
### 6.15.1 Description
This solution proposes to address the KI#2 \"PIN and PIN Element discovery and
selection\" on how to discover the PIN/PINE Service.
In this solution, it is assumed that PINE is configured or aware of the PIN
ID, and no target PINEs information was configured in the PINE.
In the case no PEMC is available, if the PINE (i.e. UE) has the capability to
connect to 5G, it can request AMF to query the PIN profile stored in UDM in
order to discover the PIN/PINE Service. Otherwise, the PINE (i.e. non-3GPP
device) accesses the 5G network via PEGC for the PIN/PINE Service discovery.
In the case either PEMC or PEGC is available, the PINE can request the target
PINE/PIN Service from PEMC directly or via PEGC.
### 6.15.2 Procedures
#### 6.15.2.1 PINE discovery via 5GC
As in Figure 1, PINE-1 is assumed as one UE that can connect to 5G network.
And PINE-1 is configured with PIN ID, no target PINE-2 information. PINE-2 can
be reachable via PEGC.
PINE-1 wants to find what the PINE service can be provided by the PIN, and
selects the specific PINE Service based on the requirement.
Figure 6.15.2-1: PINE Service discovery via 5GC
1\. PINE-1 sends the PIN Services Info Query request to AMF via gNB, including
the PIN ID, and optional PINE-1 information (may be used for further
authorization with PEMC). If PINE-1 is a non-3GPP device, the PIN Services
Info Query request should be sent to PEGC-1 that has been associated with
PINE-1, and then be forwarded to 5GC by PEGC-1.
2\. AMF checks whether the PINE-1 is authorized to use PIN Service.
3\. Additional authorization may be needed from PEMC.
Editor\'s note: It is FFS for how to perform the authorization from PEMC.
4\. AMF sends the PIN Service Query request to UDM, with PIN ID.
5\. UDM feedbacks the PIN Services information to AMF, including the all the
PINEs information, e.g. PINE ID, PINE name, PINE capability, PINE valid time,
PINE type, List of PEGCs associated with PINE, etc.
6\. AMF sends the PIN Service Info Query response to PINE-1, including PIN
Service Information as specified in step 5. If PINE-1 is a non-3GPP device,
the PIN Services Info Query response should be sent to PINE-1 via PEGC-1.
7\. Upon receiving the information feedback from step 6, PINE-1 selects PINE-2
as the target PINE. According to the PINE information received at step 6,
PINE-1 can determine if any PEGC has been associated with PINE-2. If so,
PINE-1 triggers the PIN communication with PINE-2 via 5GC by using the
information feedback from step 6, and step 8-11 can be skipped. Otherwise,
PINE-1 sends the PIN Service Configuration request to PEMC, including PINE-2
ID.
8\. Upon receiving the PIN Service Configuration request with PINE-2 ID, PEMC
may associate PINE-2 with a PEGC (e.g. PEGC-2), and then PINE-2 is able to
connect to 5GC via PEGC. If PEGC-2 is chosen as the associated PEGC of PINE-2,
PEMC sends the Connection Setup request including PEGC-2 ID to PINE-2.
9\. Non-3GPP connection is established between PEGC-2 and PINE-2.
10\. PINE-2 responds to the PEMC to acknowledge that the Non-3GPP connection
has been established.
11\. PEMC responds to the PINE-1 with the PIN Service Configuration
information, e.g. PEGC-2 ID, etc.
#### 6.15.2.2 Local PINE discovery
Figure 6.15.2.2-1: Local PINE discovery
Assuming that there is already connection between PINE and PEGC, or PINE and
PEMC:
1\. PINE sends PINE service Query request to PEMC directly, or via PEGC.
2\. PEMC sends the PINE Service Query response to PINE directly or via PEGC,
including PINE list information, after successful authentication performed by
PEMC.
3\. PINE selects the target PINE2, and initiates the PIN communication between
PINE and PINE2 directly, or via PEGC, or via 5GC.
#### 6.15.2.3 PIN discovery
Figure 6.15.2.3-1: PIN discovery
0\. PEGC and PEMC are pre-configured with PIN Discovery information.
1\. PEGC and/or PEMC broadcast the PIN Discovery information, includes PIN ID,
PIN name.
2\. PINE sends the Join PIN request directly to PEMC or via PEGC, including
device ID, capability, valid time, etc.
3a. PEMC triggers to update the PIN Profile in 5GC, e.g. UDM.
3b. PEMC updates the PIN profile in PEMC, and sends Join PIN response to PINE
directly, or via PEGC.
### 6.15.3 Impacts on Existing Nodes and Functionality
Network impacts:
\- UDM maintains the PIN profile.
\- UDM supports query and feedback the PIN service information based on the
request from AMF.
\- AMF supports PIN Service Info Query request/response.
## 6.16 Solution #16: Policy and QoS differentiation for PINE traffic relayed
by PEGC and 5GS
### 6.16.1 Description
This solution addresses KI#4 for the policy and QoS differentiation for PINE
traffic relayed by PEGC.
Differentiated QoS can be provided for different PINEs by using configuration
in the PEGC. This solution allows for traffic differentiation per PDU session
/ S-NSSAI and per QoS flow basis.
It is assumed that, when it is per PDU session basis differentiation, the
default QoS associated with the PDU session can be different based on the DNN
and S-NSSAI. PEGC can set up distinct PDU Session based on provided PINE
information (e.g. the supported service type of the PINE). PEGC is configured
(e.g. either pre-configured or delivered to PEGC by AF managing PIN via UP)
with mapping information (e.g. between service types of PINE and DNN/S-NSSAI
and QoS flow).
When PEGC considers some PINE service types are similar and can be served with
a common PDU session and DNN/S-NSSAI, then the PINEs that support these
service types can be considered to share the same PDU session. If further
differentiation among the PINEs using the same PDU session is needed, the PEGC
can apply differentiation of PINEs based on QoS flow. The PEGC can identify
the communication from PINEs based on, e.g. MAC address/Bluetooth ID or IP
addresses/ports in case of NAT is applied.
Figure 6.16.1-1: Example for different PINE group behind PEGC using different
PDU sessions based on service type supported by PINE
Figure 6.16.1-2: Example for different PINEs behind PEGC using same PDU
session but different QoS flow based on service type
### 6.16.2 Procedures
The procedures for PDU Session Establishment and PDU Session Modification are
captured in clauses 4.3.2 and 4.3.3 of TS 23.502 [3].
If there is PIN related dynamic QoS requirement from AF via 5GC, the procedure
in clause 4.15.6.6 of TS 23.502 [3] is applied.
### 6.16.3 Impacts on services, entities and interfaces
No impacts to 3GPP entities compared to 3GPP Rel-17.
PEGC:
\- Be able to establish one PDU Session per PINE service type.
\- Be able to map one or multiple service type or sub-service type to one QoS
flow of the PDU session.
## 6.17 Solution #17: PIN Communication by local routing in 5GC
### 6.17.1 Description
#### 6.17.1.1 General
This solution addresses the Key Issue #4, specifically the question \"How to
select communication path for communication between PIN Elements, e.g. direct
communication, via PEGC, via 5GS\".
The following are the key aspects of this solution:
1\. In a Personal IoT Network with more than one PEGC, PIN elements connected
to different PEGCs are able to communicate with each other through a
communication locally routed in 5GC.
2\. The solution proposes the use of routing framework similar to the 5G VN
group communication to enable the local routing communication path for PIN.
3\. The PIN AF provisions the required group and group member configurations
for creating the N4 rules for local routing.
This solution is built on top of the NEF-SMF association framework created for
a PIN as defined in Solution #12.
#### 6.17.1.2 Local Routing for communication between PINEs
When a PIN is setup within a 5G network, the 5GS provides methods for routing
PIN communication within the secure domain of 5GS without having to route
communication via the external Data Network.
A communication path within a PIN via 5GS is realized using procedures for
local switching within UPF or using N19 interface between the PDU Sessions of
the PEGCs that are members of the PIN.
This method applies for a PIN that has more than one PEGC authorized for
communication to 5GC. A PIN can be authorized only for local routing if all
PEGCs are connected to the same UPF or using N19 interface between any UPFs
within the SMF service area.
PIN can also be configured for local routing only withing specific
geographical areas. For example, only when the PEGCs are connecting to the 5GC
from specific NG-RANs. The configuration can also be restricted for specific
time periods when it is more critical for PIN to have secure intra-5GC
routing.
A granular identification of PDUs for local routing is performed by
configuring packet filter sets (e.g. identified by IP 5-tuples) such that only
certain PIN elements may have the privilege for local routing services.
AF uses external parameter provisioning interface to provide local switching
or 5GS routing configurations for the PIN traffic. A PIN AF configures the
following parameters to the 5GC:
\- DNN/S-NSSAI.
\- PDU Session Type.
\- PIN Identifier.
\- PIN Element identifiers (IP Addresses, GPSIs) that require local routing
support.
This can also include list of IP addresses assigned to PINEs behind a PEGC UE
using Framed Routing in a PDU Session. If a PEGC applies NAT-ing for PIN
elements, the AF only configures IP Address of the PEGC.
PIN AF can also authorize a subset of PEGCs within a PIN for local routing.
\- Location restrictions for local routing.
\- Whether N19 based routing is allowed.
\- AF can provide geographic locations where PEGCs may opt for local routing.
\- Time restrictions for local routing.
\- Traffic characteristics for local routing.
\- Packet Filter Set (e.g. IP 5tuples) to identify more granular routing
requirements.
The following figure illustrates the overall architecture view when local
routing is enforced. The figure shows an example when a PIN with the two PEGCs
(a \"smart home hub\" based PIN Gateway and a smartphone based PIN Gateway)
have established PIN PDU Sessions with two UPFs. The PIN specific tunnel is
set up over the N19 interface between the UPFs. The architecture is applicable
for any number of PEGCs in a PIN.
Figure 6.17.1.1â€‘1: Architecture for local routing in 5GS
Based on parameters from the AF request, SMF identifies the affected PDU
Sessions to be configured to support local routing. When all PEGCs have PDU
Sessions in the same UPF, then local switching within the UPF is used. A
group-level N4 session is created in all UPFs serving the PEGCs of the PIN
when PIN Gateways are connected to different UPFs. In the group-level N4
rules, the PIN Identifier is used as Network Instance. The local routing is
supported only when all the UPFs are in the same SMF service area.
When a PDU session is established /modified for UE as a PEGC for a PIN
configured for local routing, SMF evaluates whether the conditions for
installing UPF rules for local routing are satisfied. If the conditions are
met, SMF configures the UPF with the routing rules as described in the
procedure description.
### 6.17.2 Procedures
Figure 6.17.2â€‘1: Local routing for PIN communication
Step 0. The PIN is created. PIN is provisioned with one or more PEGCs. This
example shows a PIN with 2 PEGCs, the same procedure is applicable for more
than two PEGCs.
Step 1a, 1b. PEGCs establish/modify PDU Sessions for the PIN.
Step 2. PEMC informs the PIN AF with the IP addresses of the PEGCs over
application layer. In case Framed routing is used, the PINE identifiers that
require local routing is also informed to the PIN AF. A PIN AF within the
trusted domain of 5GC may also be referred as PIN Management Function or PIN
MF.
Step 3a, 3b. The PIN AF configures NEF whether PIN requires local routing as
described in clause 6.12.2.2. The PIN AF also provisions other PIN routing
information for as described in clause 6.12.2.2.
Additionally, it includes the parameters identified above.
If PEGCs use NAT functionality, individual PINE IP Addresses are not included
in the list of IP Addresses, only PEGC IP addresses are included.
Step 4. NEF-SMF association is created for PIN management as described in
clause 6.12.2.1. NEF provides to the SMF, the configurations for creating N4
rules for local routing.
Step 5. SMF evaluates the location and time restrictions if applicable for
local routing.
Step 6. SMF creates the N4 rules as described in clause 5.8.2.13 of TS 23.501
[2] with the following differences.
\- The following rules are configured for processing packets arriving from
this PEGC:
\- in order to detect the traffic, a PDR containing Source Interface set to
\"access side\", and CN Tunnel Information set to PDU Session tunnel header
(i.e. N3 or N9 GTP-U F-TEID); and
\- in order to forward the traffic, a FAR containing Destination Interface set
to \"5G PIN internal\"+PIN Identifier.
\- The following rules are configured for processing packets towards this
PEGC:
\- in order to detect the traffic, a PDR containing Source Interface set to
\"5G PIN internal\" + PIN identifier, and Destination Address set to the IP
address (es) of this PEGC/ the PIN elements (IP addresses configured for
framed routing if that is used); and
\- in order to forward the traffic, a FAR containing Outer Header Creation
indicating the N3/N9 tunnel information, and Destination Interface set
\"access side\".
If N19 based forwarding is to be used, SMF configures the group level N4
session for each N19 tunnel as follows:
\- for processing packets received from a N19 tunnel with the following N4
rules are created:
\- in order to detect the traffic, a PDR containing Source Interface set to
\"core side\", and CN Tunnel Information set to N19 tunnel header (i.e. N19
GTP-U F-TEID); and
\- in order to forward the traffic, a FAR containing Destination Interface set
to \"5G PIN internal\" + PIN identifier.
\- for processing packets towards 5G PIN Gateway/Elements anchored at other
UPFs with the following N4 rules:
\- in order to detect the traffic, a PDR containing Source Interface set to
\"5G PIN internal\"+PIN Identifier, and Destination Address set to the IP
address (es) of PEGCs/PIN Elements anchored at the peer UPF of this N19
tunnel; and
\- in order to forward the traffic to a 5G PIN Gateway/Element anchored at
another UPF via the N19 tunnel, a FAR containing Outer Header Creation
indicating the N19 tunnel information, Destination Interface set to \"core
side\".
The SMF may also configure the following N4 rules for the group-level N4
Session to process packets with an unknown destination address:
\- in order to detect the traffic, a PDR containing Source Interface set to
\"5G PIN internal\" + PIN identifier, a match-all Packet Filter, and a
Precedence set to the lowest precedence value; and
\- in order to process the traffic, a FAR containing Destination Interface set
to \"core side\" to route the traffic via N6 by default, or in the case of
local SMF configuration that N6-based forwarding is not applied a FAR
instructing the UPF to drop the traffic.
### 6.17.3 Impacts on Existing Nodes and Functionality
**PIN AF (PIN MF):**
\- Support PIN Association operations to provision PIN Routing information for
local routing.
**NEF:**
\- Provides the necessary configurations for creating N4 rules.
**SMF:**
\- Support local routing operations for PIN by provisioning N4 rules.
Editor\'s note: Additional impacts are FFS.
## 6.18 Solution #18: Delay budget between PINE and PEGC
### 6.18.1 Description
QoS experienced by PINE behind a PEGC depends on the end-to-end path between a
PINE and the application server, i.e. depends on the QoS differentiation in
both the 3GPP network and the non-3GPP network attached to the PEGC.
The packet delay budget (PDB) currently only considers the delay between the
UPF and the UE (i.e. PEGC); the additional delay between the PEGC and the PINE
is not accounted for.
To address this shortcoming, this solution proposes to make 5GS aware of the
additional delay that can occur in the non-3GPP network attached to the PEGC
and to compensate for this delay in 5GS. The compensation is achieved by
reducing the PDB for the 3GPP network by the delay that can occur in the
non-3GPP network attached to the PEGC (referred to as non-3GPP delay
hereafter).
This solution proposes two enhancements to make 5GS aware of the non-3GPP
delay:
\- A Default non-3GPP network delay budget is configured in the UDR as part of
the PDU Session policy control subscription information. The PCF applies the
Default non-3GPP delay budget when taking policy decisions, i.e. the PCF
reduces the PDB for a given flow by the Default non-3GPP delay budget.
\- If supported by the PEGC and if the PEGC wants to change the default
non-3GPP delay budget for a specific flow, the PEGC may use the UE requested
PDU Session Modification procedure to request a non-3GPP delay budget for a
set of packet filters. The SMF provides the Requested non-3GPP delay budget
received from the PEGC to the PCF, which takes it into account for the
subsequent policy decision.
This solution focuses on the delay budget of non-3GPP access and PDB
adjustment for 5G QoS flow, which has no dependence on the PIN management
capability.
### 6.18.2 Procedures
Figure 6.18.2-1: Taking delays in the non-3GPP network attached to the PEGC
into account in 5GS
1\. PDU Session is established.
2\. Application layer signalling is exchanged between an application on a PINE
connected to the PEGC and an application function (AF).
3\. Based on the application layer signalling, the AF requests QoS for
application flows.
NOTE 1: If the AF is not considered trusted, then the AF interacts with the
NEF instead. If the AF provides explicit QoS parameters, then AF (or NEF in
case the AF is not trusted) interacts with PCF as defined in clause 4.15.6.6
of TS 23.502 [3].
NOTE 2: Steps 1-3 are following existing Rel-17 specifications.
4\. PCF creates/updates PCC rules based on the AF request. If the PDU Session
policy control subscription information in the UDR contains a Default non-3GPP
delay budget, then the PCF takes it into account by reducing the PDB for the
application flows by the Default non-3GPP delay budget.
5\. PCF sends the PCC rules to the SMF and also includes the non-3GPP delay
budget.
6\. SMF completes the PDU Session modification based on the PCC rules received
from the PCF and includes in the N1 SM container the non-3GPP delay budget
provided by the PCF. A PEGC that does not support the non-3GPP delay budget
information, will ignore the non-3GPP delay budget included in the N1-SM
container.
7\. Application traffic is exchanged between the application on a PINE
connected to the PEGC and an application function (AF).
8\. If the PEGC supports signalling of non-3GPP delay budget information and
determines the need to request a different non-3GPP delay budget for a
specific flow of a PINE, then the PEGC initiates the UE requested PDU Session
Modification procedure and includes the Requested non-3GPP delay budget. The
packets filters that the PEGC includes in the UE requested PDU Session
Modification Request include at least the PINE\' IP address and optionally
port numbers. In case PEGC has assigned a private IP address to the PINE, then
the PEGC includes its own IP address and the port numbers used for the PINE.
NOTE 3: How the PEGC determines the need to request a different non-3GPP delay
budget for a specific flow (e.g. by monitoring the delays in the non-3GPP
network) is up to PEGC implementation.
9\. The SMF provides the Requested Non-3GPP delay budget to the PCF.
10\. PCF creates/updates PCC rules based on the Requested non-3GPP delay
budget received from the SMF by reducing the PDB for the application flows by
the Requested non-3GPP delay budget received from the SMF. The PCF may also
alternatively apply a different non-3GPP delay budget, based on operator
policy. PCF uses the packet filters as signalled by the PEGC for the PCC rules
as per existing procedures.
11\. PCF sends updated PCC rules to the SMF and also includes the non-3GPP
network budget.
12\. SMF completes the PDU Session modification based on the PCC rules
received from the PCF and includes in the N1 SM container the non-3GPP delay
budget provided by the PCF.
### 6.18.3 Impacts on Existing Nodes and Functionality
**SMF:**
\- Support signalling of non-3GPP delay budget between UE and PCF.
**PCF:**
\- Receive Default non-3GPP delay budget from UDR.
\- Take Default non-3GPP delay budget from UDR into account for policy
decisions (specifically for calculating PDB).
\- Provide non-3GPP delay budget to SMF.
\- Optionally, support receiving Requested non-3GPP delay budget from SMF.
\- Optionally, take Requested non-3GPP delay budget from SMF into account for
policy decisions (specifically for calculating PDB).
**UDR:**
\- Support Default non-3GPP delay budget as part of the PDU Session policy
control subscription information.
**PEGC:**
\- Optionally, support receiving non-3GPP delay budget from SMF.
\- Optionally, support signalling Requested non-3GPP delay budget to SMF.
## 6.19 Solution #19: QoS handling for PINE communication with 5GC via PEGC
### 6.19.1 Description
The solution applies to Key Issue #4 \"Communication of PIN\" and Key Issue #6
\"Policy and parameters provisioning for PIN\".
The PIN architecture is depicted as in Figure 6.19.1-1. The PEMC and PEGC have
Uu capability and can access 5GC using the procedures as defined in TS 23.502
[3]. The PINE may have limited communication capability and can only support
some forms of direct non-3GPP access, e.g. Wi-Fi or BT.
Figure 6.19.1-1: Reference architecture for PIN
The PEMC is responsible for managing the PIN, including creating a PIN,
adding/removing a PINE from the PIN, etc. The PEMC may be preconfigured with
PIN information that it can support, or the PIN information can be provisioned
by PCF to the PEMC.
The PEGC provides connectivity services for PINE to access the network. The
PINE can communicate with PEMC, PEGC and other PINEs via direct non-3GPP
access (e.g. Wi-Fi and BT). The PINE can also communicate with 5GC via the
PEGC, and the PEGC acts as an IP router to relay traffic between PINE and 5GC.
For a PINE accessing network via PEGC, the QoS requirement of the relayed
traffic can be satisfied by the corresponding QoS control for the direct
non-3GPP access (out of 3GPP scope) and the QoS control for the QoS flow. The
end-to-end QoS can be met when the QoS requirements are properly translated
and satisfied over the two legs respectively.
### 6.19.2 Procedures
#### 6.19.2.1 Procedures for policy and parameters provisioning for PEGC
The policy and parameters for PIN and PIN element discovery may be provisioned
by PCF.
The \"PCF based Service Authorization and Provisioning to UE\" procedure as
defined in clause 6.2.2 of TS 23.304 [6] is reused for PCF to provision PIN
policy and parameters to PEGC.
The \"AF-based service parameter provisioning for ProSe over control plane\"
procedure as defined in clause 6.2.5 of TS 23.304 [6] is reused for PIN AS to
provide PIN Service Parameters to the PCF.
The PIN policy and parameters include:
\- a mapping between a Uu QoS parameters (including 5QI, GFBR/MFBR, ARP) value
and QoS information of direct non-3GPP access (including QoS characteristics,
GFBR/MFBR, ARP, Periodicity).
#### 6.19.2.2 Procedures for QoS handling of PINE communication with 5GC via
PEGC
Depicted in figure 6.19.2.2-1 is the procedure for Network initiated QoS flow
establishment for PINE.
Figure 6.19.2.2-1: Network initiated QoS flow establishment for PINE
1\. The PEGC registers to network and establishes PDU session for relaying
PINE traffic.
2\. PINE discovers PEGC using solutions for KI#2 and establishes connection
with PEGC over direct non-3GPP access (e.g. Wi-Fi and BT).
The application layer signalling interacts between PINE and PIN AS.
3\. The PIN AS may trigger a new QoS flow establishment and that triggers PCF-
initiated QoS flow establishment procedure as defined in clause 4.3.3 of TS
23.502 [3].
4\. The PEGC receives 5QI for the new established QoS flow from SMF, and the
PEGC determines the direct non-3GPP access QoS info based on the PCF
provisioned mapping as described in clause 6.19.2.1.
5\. The PEGC applies direct non-3GPP QoS information to reserve resources over
direct non-3GPP access, which is out of 3GPP scope.
The traffic from/to the PINE is relayed by the PEGC.
Depicted in figure 6.19.2.2-2 is the procedure for PINE initiated QoS flow
establishment.
Figure 6.19.2.2-2: PINE initiated QoS flow establishment
1\. The PEGC registers to network, and establishes PDU session for relaying
PINE traffic.
2\. PINE discovers PEGC using solutions for KI#2 and establishes connection
with PEGC over direct non-3GPP access (e.g. Wi-Fi and BT).
3\. The PINE establishes Wi-Fi/BT connection with PEGC and provides direct
non-3GPP access QoS info to the PEGC (out of 3GPP scope).
Editor\'s note: It is assumed PINE can provide QoS info to PEGC using existing
Wi-Fi/BT mechanism, and reference to Wi-Fi/BT spec can be added later.
4\. The PEGC determines the 5QI and other QoS parameters based on the PCF
provisioned mapping as described in clause 6.19.2.1.
5\. The PEGC initiates PDU session modification procedure to establish new QoS
flow.
The traffic from/to the PINE is relayed by the PEGC.
### 6.19.3 Impacts on services, entities and interfaces
**PEGC:**
\- Request and Receive PIN policy/parameters from PCF.
**PCF:**
\- Provision PIN policy/parameters to PEGC.
## 6.20 Solution #20: PIN communication using multiple PEGCs
### 6.20.1 Description
This solution focuses on the scenario when a PIN has multiple PEGCs. A valid
use case could be a PIN has more and more PINE join, so that a single PEGC may
not be able to serve all the PINE, in terms of the capacity and bandwidth. If
more than one PEGC is introduced for a PIN, it is necessary to consider the
issues, such as dynamic association between the PINE(s) and PEGC, user plane
configuration for PEGC\'s PDU session, taking into account the load balance
issues for a single PEGC, etc.
This solution addresses the following scenarios in the assumption of multiple
PEGCs:
\- How to manage the association between PEGC and PINE.
\- How to enable a PIN Element to use a PEGC to communicate with a 5GS.
\- How to support a relay path management for a PINE.
Following are the principles for this solution:
a) This solution is based on solution #6.
b) PEMCF is responsible for managing the association between PEGC and PIN
Elements (PINE). A PEGC can be used as a relay for one or more PIN Element
c) When PEMCF has configured the association between PEGC and PIN Elements, it
will report the association to P-NF. P-NF is responsible for managing and
storing the association. PEMC will also notify the association to the relevant
PEGC and PIN Elements.
d) When a PINE needs path relay, it will send a request to its targeted PEGC
via PIN layer. The PEGC will determine whether to request the session
management for SMF. If it does, the PEGC will send a request to the PIN PDU
session establishment. When SMF receives the PIN PDU session request, SMF will
send a request to P-NF to get the association between the targeted PINE and
the configured PEGC. If there is only one PEGC in the PIN, framed routing is
reused as described in TS 23.501 [2] clause 5.6.14.
e) After getting the mapping from P-NF, SMF will set the corresponding PDR and
FAR and sends the rules to UPF.
f) When UPF receives the downlink data to a PINE, it will transfer the data to
the corresponding PEGC via the PDU session for PIN service based on the
according FAR and PDR. The FAR indicates targeted PDU session of the PEGC, and
PEGC will transfer the downlink data to the relevant PINE. It is assumed that
the SMF can control the PEGC only has one session for PIN service and the PEGC
provides a list of IP address of the PINE behind it by using framed routing.
g) After determining the association between PEGC and PINE, PEMC can modify
the configured association. For instance, if there is an overload situation in
the PEGC and it cannot meet the relay QoS requirement for other PINE(s), the
PEGC will send a notification to the PEMC. This is done via the interaction
between PEGC and PEMC. PEGC notifies the PEMC of the load status. The PEMC can
assign another PEGC for the PINE. The PEMC sends the updated association to
P-NF. Then P-NF notifies SMF to update the routing rules.
Figure 6.20.1-1 depicts the reference architecture for the solution.
Figure 6.20.1-1: The selection of a PEGC for traffic relay
### 6.20.2 Procedures
A procedures for PIN communication using multiple PEGCs is shown in Figure
6.20.2-1.
Figure 6.20.2-1: PIN communication using multiple PEGCs
0\. Step 0 is the process of PIN creation, which is described in clause 6.6.2
of solution #6.
1\. PEMC configures the association between PEGC and PIN Elements (PINE) and
notifies the association to the relevant PEGC and PIN Elements. PEGC will
allocate the IP address to its associated PINE, and PEGC notifies the
association to PEMC.
2\. PEMC reports the association to P-NF. P-NF stores the association.
3\. A PINE needs path relay and sends a request to its targeted PEGC via PIN
layer. The PEGC will determine whether to request the session management for
SMF. If the PINE has the association with the PEGC, the PEGC will send a
request to the PIN PDU session establishment.
4\. The SMF verifies that the PEGC has only one session for the PIN service
and that the PEGC has provided either the framed routing information as
specified in clause 5.6.14 of TS 23.501 [2] or the IP address that it has
allocated to the PINE in accordance to the PEGC subscription data. SMF
receives the PIN PDU session request, and sends a request to P-NF to get the
association between the targeted PINE and the configured PEGC. P-NF responds
to the request with the mapping.
5\. Depending on what the PEGC provides in step 4, the SMF will provide the
UPF with either the framed routing information or the IP address that the PEGC
has allocated to the PINE. When the PEGC sends the IP address associated to
the PINE ID, it is possible for the network to have better visibility of the
PIN context. The SMF sets the PDR and FAR and sends the rules to the UPF.
NOTE: If the AF communicates with the PEGC via the application layer, the
Frame route information may also be sent by the PIN AF via the NEF.
6\. SMF responds to PEGC request. When UPF receives the downlink data to a
PINE, it will transfer the data to the corresponding PEGC via the PDU session
for PIN service based on the according FAR and PDR. When PEGC receives the
downlink data, it will transfer the data to the targeted PINE.
### 6.20.3 Impacts on services, entities, and interfaces
**PEMC:**
\- Determine the association between PEGC and PINE.
\- Send the association to P-NF, and if the association changes, send the
notification to update the association in P-NF.
**P-NF:**
\- Record traffic data route rules, including the association between PEGC and
PINE.
\- Notify SMF the updated association.
**PEGC:**
\- Support to send a request for a PIN PDU session establishment.
**SMF:**
\- Support to get the association from P-NF, and set the according PDR and FAR
based on the association.
## 6.21 Solution #21: Authorization of a PINE for PIN Access
### 6.21.1 Description
This solution addresses Key Issue #5: Authorization for PIN.
The principle of this solution is that, in order to join a PIN, a PINE must
first discover a PEMC and send a join request to the PEMC. The PEMC will then
authorize the PINE for connectivity to the PIN and may authorize the PINE to
access 5GS services via a PEGC.
The procedure assumes that a 3GPP defined PIN Protocol will be used to
communicate between PINEs (e.g. between the PINE and PEMC).
### 6.21.2 Procedures
A procedure for authorizing a PINE for access to a PIN is shown in Figure
6.21.2-1. As a precondition, the PINE is configured with Bootstrap
Information. Bootstrap Information includes:
\- Information that is used to discover a PIN.
\- An Initial PINE ID (e.g. a unique PINE ID or a mapped PINE ID).
\- Information that can be used in an Authorization procedure.
If the PINE is a UE, the Bootstrap Information may have been received in a UE
Configuration Update message. The Bootstrap Information may also be
provisioned out of band, e.g. manually entered, pre-configured in the ME
during manufacturing.
Also, as a precondition, the PINE discovers a PEMC (e.g. using key issue #2
solutions). And PEMC is able to communicate with the PEGC either via PC5 or
via the 5GC.
Figure 6.21.2-1: PINE Authorization
1\. In step 1, the PINE sends a PIN Protocol Join Request to the PEMC. The
request includes at least the Initial PINE ID from the Bootstrap information.
2\. In step 2, if the PEMC already has the necessary information to perform an
authorization procedure with the PINE, then the procedure skips to step 6.
Otherwise, the PEMC sends a request NAS PINE AUTHORIZATION (Initial PINE ID)
Request to the AMF to obtain the necessary information to authorize the PINE.
3\. In step 3, the AMF uses the Initial PINE ID to determine what NF (e.g. a
UDM/UDR or a P-NF (e.g. Solution #6)) to contact to obtain the information
that is necessary to authorize the PINE.
NOTE 1: This step is only necessary if the PINE ID is associated with a PLMN
that is different than that of the AMF.
4\. In step 4, the AMF executes a procedure with the NF to obtain necessary
information to authorize the PINE. The information from the NF also indicates
if the PIN is permitted to access the 5GS services via a PEGC.
5\. In step 5, the AMF responds to the PEMC with the necessary information to
authorize the PINE in a NAS PINE AUTHORIZATION RESPONSE. The information from
the AMF also indicates if the PIN is permitted to access the 5GS services via
a PEGC.
6\. In step 6, if the PINE is not authorized to access services of the 5GS via
a PEGC, the flow skips to step 8. Otherwise, the PEMC sends a PIN Protocol
PEGC Configuration Command to provide a PEGC with the identity of the PINE so
that the PEGC knows that the PINE is permitted to access the services of the
5GS via the PEGC.
NOTE 2: The solution assumes as per the architectural assumption that the PEMC
can communicate with the PEGC.
7\. In step 7, the PEGC sends a PIN Protocol PEGC Configuration Response to
acknowledge the command of step 6.
8\. In step 8, the PEMC sends a PIN Protocol Join Response to the PINE and
indicates if the PINE is authorized to join the PIN. If the PINE is permitted
to join the PIN and access services of the 5GS, then the PIN Protocol Join
Response also provides the PINE with a PEGC ID.
NOTE 3: The PEMC should authenticate the PINE before authorizing it to connect
to the PIN. How this is done is left for SA WG3.
### 6.21.3 Impacts on Existing Nodes and Functionality
**PINE:**
\- Uses a PIN Protocol to send a PIN Protocol Join Request and receive a PIN
Protocol Join Response.
**PEMC:**
\- Uses a PIN Protocol to receive a PIN Protocol Join Request and send a PIN
Protocol Join Response.
\- Sends a NAS PINE AUTHORIZATION request and receives a NAS PINE
AUTHORIZATION Response.
\- Uses a PIN Protocol to send a PIN Protocol PEGC Configuration Command and
receive a PIN Protocol PEGC Configuration Response.
**PEGC:**
\- Uses a PIN Protocol to receive a PIN Protocol PEGC Configuration Command
and send a PIN Protocol PEGC Configuration Response.
**AMF:**
\- Resolves a PINE ID to determine what NF to contact to authorize the PINE.
\- Sends a request to an NF to authorize the PINE and receives a response.
\- Receives a NAS PINE AUTHORIZATION request and sends a NAS PINE
AUTHORIZATION Response.
## 6.22 Solution #22: PIN Authorization
### 6.22.1 Description
The solution is based on architecture alternative 0A described in clause 6.0A,
and describes the following Authentication process:
\- PINE and its authorization to access 5GS, PEGC and other PINE.
\- Authorization/De-Authorization of the PEMC.
The architecture for Authorizing PIN Elements to access other PINE, PEGC and
PEMC in the PIN.
Figure 6.22.1-1: Token based Authorization Architecture
**Assumption:** That the PIN elements are connected to a wireless LAN/ PAN
network and each element are reachable via the wireless link. The procedure to
connect to the wireless network and assign IP address is out of the scope of
this document.
The salient feature of this solution is as follows:
**\- PEMC Initialization.** PEMC will communicate with the PINCTRL -as
described in solution for KI#1- of the 5GC to download authorization policies.
PEMC will use these downloaded policies to enforce authorization policies on
PINE, PEGC and PEMC.
**\- PINE Authorization.** Suppose PINE1 of the PIN, intending to communicate
with the other PINE for eg. PINE2, will send \"Authenticate and Request Access
Token\" Request query to the PEMC, which will respond with the access Token to
the requesting PINE (PINE1) based on the authorization policies. This access
Token will also be sent to PINE2 so that it is aware that PINE1 is authorized
to access PINE2. PEMC will also update its central repository with the Access
Token and its associated PINE(s).
**\- PINE De-Authorization:** Suppose PINE1 of the PIN, which has the access
Token to access PINE2 of a PIN must be de-authorized due to operator or 3^rd^
party policies. Then the PEMC will delete the Access Token and its associated
PINE(s) from the central repository and communicate PINE De-Authorization
message to the appropriate PINE(s).
**\- PINE to PINE Communication with Access Token.** Suppose PINE1 and PINE2
are authorized by the PEMC to communicate on the PIN. PINE1 will send an
\"Service Request with Access Token\" to the PINE2 and it will authorize based
on the access Token received from the PEMC and provide its services
accordingly.
**\- PINE to 5GS access Authorization.** Suppose PINE1 of the PIN, intending
to communicate with 5GS via PEGC will send \"Authenticate and Request Access
Token\" Request query to the PEMC, which will respond with the access Token to
the requesting PINE (PINE1) based on the authorization policies. This access
Token will also be sent to PEGC so that it is aware that PINE1 is authorized
to access 5GS. The PEMC will also update its central repository with the
Access Token and its associated PINE and 5GS services via PEGC.
**\- PINE to 5GS Communication with Access Token.** Suppose PINE1 and PEGC are
authorized by the PEMC for PINE1 to access 5GS. Then PINE1 will send a
\"Service Request with Access Token\" to the PEGC and it will authorize based
on the access Token received from the PEMC and provide 5GS accordingly.
**\- PINE to 5GS Communication De-Authorization:** Suppose PINE1 of the PIN,
which has the access Token to access 5GS via PEGC of a PIN must be de-
authorized due to operator or 3^rd^ party policies. Then the PEMC will delete
the Access Token and its associated PINE(s) from the central repository and
communicate PINE De-Authorization message to the appropriate the PEGC and
PINE. PINE1 Access Token to 5GS is no more valid.
**\- PEMC Authorization:** A NAS capable UE will register with the 5GS with
\"PIN capable\" in the initial registration message to be authorized to form
the PIN. 5GC architecture enhancements to support PIN are described in the
solution for KI#1 and KI#6. Based on the \"PIN control function\" policies,
the 5G core will authorize/deny the PIN formation. Once authorized by the 5G
Core, the PIN element is identified as PEMC.
**\- PEMC De-Authorization:** 5GS will send a PEMC de-authorization message to
the PEMC and it will send an PIN deactivation message as described in solution
KI#3. Then will PEMC will de-authorization Acknowledge message to the 5G core.
This solution assumes that authorisation procedure is based on https protocol
Editor\'s note: The definition of access Token is FFS and under SA3
responsibility
Editor\'s note: The authentication procedure and security aspects are under
SA3 responsibility, so considerations and evaluation on feasibility of
authorisation mechanism based on token is outside SA2 scope.
### 6.22.2 Procedures
#### 6.22.2.1 Authorisation for PINE to PINE Communication authorisation
Procedure
Figure 6.22.2.1-1: PINE1 authorisation
1\. PINE1 intending to communicate with PINE2 (e.g. Printer) will send PINE2
access Token query to PEMC.
2\. PEMC will request PINE1 for \"Identity request\" before granting PINE2
Token.
3\. PINE1 sends its registered Identity to PEMC.
4\. PEMC will decide to grant PINE1 access to PINE2 based on the policies from
PINCTRL.
5\. PEMC will also send PINE1/PINE2 access Token to PINE2.
6\. PINE2 will send acknowledgment for PINE1/PINE2 Token.
7\. PEMC sends PINE2 access Token to PINE1.
8\. PINE1 will send access request + PINE1/PINE2 Token to PINE2.
9\. PINE2 will acknowledge with OK + access grant.
10\. Communication between PINE1 and PINE2 begins.
#### 6.22.2.2 Authorisation for PINE accessing 5G communication via PEGC
Figure 6.22.2.2-1: Authorisation for PINE communication to 5GS
1\. PINE1 intending to access 5G system via PEGC will send PEGC access Token
query to PEMC.
2\. PEMC will request PINE1 for \"Identity request\" before granting PEGC
Token.
3\. PINE1 sends its registered Identity to PEMC.
4\. PEMC will decide to grant PEGC access to PINE1 based on the policies from
PINCTRL.
5\. PEMC will also send PINE1/PEGC access Token to PEGC
6\. PEGC will send acknowledgment for PINE1/PEGC Token.
7\. PEMC sends PEGC access Token to PINE1.
8\. PINE1 will send access request + PINE1/PEGC Token to PEGC.
9\. PEGC will acknowledge with OK + access grant
10\. Communication between PINE1 and 5G system via PEGC begins.
### 6.22.3 Impacts on services, entities and interfaces
The solution has the following impacts:
Impact to the UE (PEMC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to maintain a list of all the PINE and its supported services.
Impact to the UE (PINE/PEGC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
Impact to the 5G System:
\- Add new Network Function (PINCTRL) to the NAS in 5GS.
\- Add new fields to the Registration request such as \"PIN capable\".
\- Add new fields to the Registration Accept message such as \"PIN
allowable\", \"PIN Name\".
## 6.23 Solution #23: Policy provisioning framework for PIN
### 6.23.1 Description
This solution addresses the key issue \"Policy and parameters provisioning for
PIN\". The solution presents a framework for policy and parameter provisioning
for Personal IoT Networks.
The policy and parameters for certain types of Personal IoT Networks (e.g. a
smart home network) are heavily influenced by the Application Function (AF).
It is foreseen that different AFs have varying requirements on how PIN
policies are to be provisioned in the 5G network. Some types of PINs will work
with pre-configured/pre-provisioned policy parameters. The traffic routing
rules or other management parameters will not have any dynamic aspects. Any
PIN created by authorized PEMCs will have the same characteristics. This is a
static pre-provisioning of PIN policy parameters.
In certain other types of PIN networks, there may be some static components of
PIN policies. There will also be a set of dynamic parameters which AF will
configure after a PIN is established.
A third type of PIN networks will have all dynamic PIN policies. The PEMC may
only have a minimum configuration to initiate establishment of a PIN. Further
on, the policy and parameters for the PIN operation will be provisioned
dynamically by the AF.
This solution provides the framework for Policy provisioning in all three
cases for PINs that rely on PIN AF or PIN MF.
### 6.23.2 Procedures
A PEMC initiates PIN establishment only if it is authorized to act as a PEMC.
The authorization for PEMC is provided based on UE subscription information
during registration procedure.
#### 6.23.2.1 PIN Establishment with pre-provisioned PIN Policies
Figure 6.23.2.1â€‘1: PIN pre-provisioned policies
1\. An AF uses parameter provisioning services to provide PIN policies. PIN
policies could include PIN identifier policies, privacy policies and traffic
routing policies.
2\. A UE capable of PEMC operation registers in the 5G network. AMF includes
PEMC authorization as part of registration procedure.
3\. UE request PIN Policy provisioning to PCF. A UE may optionally include PIN
AF identifiers to fetch the appropriate policies.
4\. PCF fetches PIN policies according to the UE\'s subscription. PIN policies
can include PIN identifier or policies for self-assigning PIN identifier,
privacy policies, traffic routing policies. PIN policies could also include
indication to inform 5GC about PIN creation. PCF delivers UE policies using
the UE Configuration Update procedure defined in clause 4.2.4 of TS 23.502
[3].
5\. PIN elements are added to PIN network.
6\. UE informs PIN establishment to AMF. AMF may provide further time and
geographic restriction policies at this stage.
NOTE: The exact PIN policies provisioned by the AF may also be defined by
other solutions to this Key Issue.
#### 6.23.2.2 PIN establishment with dynamic Policy updates
Figure 6.23.2.2-1: PIN dynamic policy updates
1\. PEMC UE indicates PEMC capability to the AMF. The AMF provides PEMC
authorization. AMF also indicates that PEMC UE is allowed for dynamic PIN
creation.
2\. PIN is established
3\. The PIN related information is exchanged over application layer to PIN AF
4\. PEMC UE informs AMF of PIN establishment. PIN identifiers and UE
identifiers for PEGC are informed to the AMF. AMF provisions basic PIN policy,
including geographic area or time restrictions for operation.
5\. PIN AF derives the PIN policies specific to the MNO and updates it to PCF
directly or through NEF.
6\. PCF updates the policies (including privacy policies for PIN and PINE
discovery) that have to be provisioned to the PEMC UE based on UE subscription
data.
7\. PCF triggers policy update to the PEMC UE. PCF delivers UE policies using
the UE Configuration Update procedure defined in clause 4.2.4 of TS 23.502
[3]. Traffic routing policies for PIN are delivered as URSP rules.
NOTE: The exact PIN policies provisioned/updated by the AF may also be defined
by other solutions to this Key Issue.
#### 6.23.2.3 PEMC initiated dynamic Policy retrieval
Figure 6.23.2.3-1: PIN initiated policy retrieval
1\. PEMC UE registers with 5GC. The AMF provides PEMC authorization. AMF also
indicates that PEMC UE is allowed for dynamic PIN creation.
2\. PIN is established.
3\. PEMC UE informs AMF of PIN establishment. PIN identifiers and UE
identifiers for PEGC are informed to the AMF. AMF provisions basic PIN policy,
including geographic area or time restrictions for operation.
4\. AMF also generates event to notify PIN AF about PIN Creation.
5\. PIN AF derives the PIN policies specific to this PIN instance and updates
it to PCF directly or through NEF.
6\. PCF updates the policies (including, privacy policies for PIN and PINE
discovery) that have to be provisioned to the PEMC UE based on UE subscription
data. PCF delivers UE policies using the UE Configuration Update procedure
defined in clause 4.2.4 of TS 23.502 [3]. Traffic routing policies for PIN are
delivered as URSP rules.
NOTE: The exact PIN policies provisioned/updated by the AF may also be defined
by other solutions to this Key Issue.
### 6.23.3 Impacts on Existing Nodes and Functionality
**AMF:**
\- Handling of PEMC, PEGC authorization during registration. Handling of PIN
establishment information, generating PIN establishment events towards AF.
**PCF:**
\- Handling PIN policy parameters from AF. Provisioning PIN policy parameters
towards PEMC/PEGC UE.
## 6.24 Solution #24: PIN Policy and Parameters Provisioning using the UE
Configuration Update Procedure
### 6.24.1 Description
This solution addresses Key Issue #6: Policy and parameters provisioning for
PIN.
The principle of this solution is that a UE that can act as a PINE, PEGC, or
PEMC indicates its PINE, PEGC, and/or PEMC capability to the AMF during
registration. This indication is provided by the AMF to the PCF. The PCF may
then use the \"UE Configuration Update procedure for transparent UE Policy
Delivery\" procedures to deliver PIN related parameters and policies to the
UE.
### 6.24.2 Procedures
#### 6.24.2.1 General
The Registration procedures as defined in clause 4.2.2.2 of TS 23.502 [3], UE
Policy Association Establishment procedure as defined in clause 4.16.11 of TS
23.502 [3], UE Policy Association Modification procedure as defined in clause
4.16.12 of TS 23.502 [3], and UE Configuration Update procedure for
transparent UE Policy Delivery procedure as defined in clause 4.2.4.3 of TS
23.502 [3] apply with the following additions:
\- the UE indicates its PINE, PEGC, and/or PEMC capability(ies) in the 5GMM
Capability IE of the Registration Request message.
\- the AMF provides the capability indication(s) to the PCF in the UE Policy
Association Establishment and UE Policy Association Modification procedures.
\- the PCF provides PIN policies and parameters to the UE by using the UE
Configuration Update procedure for transparent UE Policy delivery procedure.
#### 6.24.2.2 Policy and parameters for PIN
The PIN parameters and policies may include polices that relate to one or more
PIN(s). For each PIN, the following set of information may be included in the
PIN policies and parameters. Some of the information below may be part of the
UE Subscription profile:
\- PIN ID.
\- PIN type (e.g. Sensor Type, AR/VR, smart light, plug, UE, etc.).
\- Whether the UE is permitted to act as a PINE, PEGC, and/or PEMC.
\- Permitted Discovery Types (e.g. open or restricted).
\- Security policies and parameters for communication within the PIN.
NOTE: What and whether security policies and parameters for communication
within the PIN are sent to the UE will be determined by SA WG3 (e.g. policies
and parameters that relate to authenticating and authorizing other PINEs).
\- Policies and Parameters that are sent if the UE is permitted to act as a
PEMC:
\- The DNN that should be used when sending PIN related traffic to the 5GC
(e.g. communication with a PIN AS).
\- Identities of UEs that can act as a PEGC in the PIN.
\- Whether traffic from the PIN may be forwarded via the 5GC (i.e. via a
PGEC).
\- Identities of PINEs that can join the PIN.
\- Identities that the PEMC may assign to PINEs that join the PIN.
\- A validity duration and/or time validity for the PIN.
\- PIN Start time, i.e. the time when the PEMC may begin creating the PIN.
\- PIN size, i.e. maximum number of allowed PINEs.
\- Policies and Parameters that are sent if the UE is permitted to act as a
PEGC:
\- Whether traffic from the PIN may be forwarded via the 5GC (i.e. via a
PEGC).
\- If traffic may be forwarded via the 5GC, then the DNN that should be used
when sending PIN related traffic via the 5GC.
\- Traffic routing rule (e.g. URSP rule) to enable the PEGC UE to identify
application traffic generated from a PIN or by a PINE within a PIN and
determine how to route the requested application traffic.
\- Identities of UEs that can act as a PEMC in the PIN.
\- Policies and Parameters that are sent if the UE is permitted to act as a
PINE:
\- Whether traffic from the PIN may be forwarded via the 5GC (i.e. via a
PEGC).
\- Identities of UEs that can act as a PEMC in the PIN.
\- Identities of UEs that can act as a PEGC in the PIN.
### 6.24.3 Impacts on Existing Nodes and Functionality
**UE:**
\- UE indicates its PINE, PEGC, and/or PEMC capability(ies) in the 5GMM
Capability IE of the Registration Request message.
\- Receives PIN policies and parameters in the UE Configuration Update
procedure for transparent UE Policy delivery procedure.
**AMF:**
\- Provides the UE\'s PINE, PEGC, and/or PEMC capability(ies) to the PCF in
the UE Policy Association Establishment and UE Policy Association Modification
procedures.
**PCF:**
\- Receives the UE\'s PINE, PEGC, and/or PEMC capability(ies) from the PCF in
the UE Policy Association Establishment and UE Policy Association Modification
procedures.
\- Sends PIN policies and parameters to the UE in the UE Configuration Update
procedure for transparent UE Policy delivery procedure.
## 6.25 Solution #25: Policy and Parameter provisioning for PIN
### 6.25.1 Description
The solution is based on architecture alternative 0A described in clause 6.0A,
and describes the procedures to provision policy and parameter for the PIN
such as how policies and parameters are sent communicated to the PIN and vice
versa.
This solution addresses KI#6 and describes the procedure to provision policy
and parameters to the PIN.
More than 500 billion IoT devices are expected to be IoT devices by 2030, and
to manage these PIN network and PIN elements by 5GC, this solution proposes to
add PIN control function- a new network function to 5GC. This NF will be able
to accept operator\'s policies statically or dynamically and be able to push
them to the PIN and PIN elements. PEMC will register as PIN capable to the 5GC
with a list of PIN elements and its capabilities to the new network function -
PIN control function. Based on the operator or 3rd party policies such as
add/delete PIN, add/remove a PINE for the PIN etc. the \"PIN ctrl function\"
will acknowledge the PEMC accordingly. To push and query these policies, this
solution proposes to add NPINCF Interface between PEMC of PIN to PINCF (Pin
Control Function) as shown in Figure 6.0A.2.1-1.
To summarize, this solution proposes to add the following to provision policy
and parameters for the PIN:
1) Add PIN Control Function to the 5GC (PIN Ctrl Func) that can push operators
or 3rd party policies to the PIN. The policies will include create/delete a
PIN, add/remove a PINE for the PIN etc.
2) Add Interface NPINCF between PINCTRL and other NF communication via SBI.
3) Add Reference point P1 between PEMC/PEGC and PINCTRL communication.
4) This solution proposes to add the following fields to the initial UE
registration request message as defined in clause 5.5.1 of TS 24.501 [7]:
a. \"PIN Capable\", which can be true or false.
b. \"PINE list\", which is a list of all the PIN elements with reachable
address such as PINE1\@SUCI_PIN, PINE2\@SUCI_PIN etc.
c. Each PINE in the PINE list will contain the intended features:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED (True/False values indicate that the functionality is
allowed/not-allowed for e.g. PEMC = False indicates that the UE is not allowed
to function as PEMC.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED
5) This solution proposes to add the following fields to the initial UE
registration accept message as defined in clause 5.5.1 of TS 24.501 [7]:
a. \"PIN allowable\", which can be true or false.
b. \"PINE list\", which contains a list of PINE elements and its associated
policies and parameters. For e.g. A typical \"PINE list\" will be as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
6) This solution proposes to use UE Triggered Service Request as described in
clause 4.2.3.2 of TS 23.502 [3] to push after registration policy and
parameters to the PIN. This solution proposes to add the following fields or
parameters to the Service Request:
a. Updated \"PINE list\", which contains a list of PINE elements and its
associated policies and parameters. For e.g. A typical \"PINE list\" will be
as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
### 6.25.2 Procedures
#### 6.25.2.1 Registration with PIN_Capability and PIN_List Procedure
Figure 6.25.2.1-1: PEMC Registration with PIN_Capability and PIN_List
0\. PEMC will add PIN_Capability and PIN_List along with the conventional
registration AN message which includes (AN parameters, Registration Request
(Registration type, SUCI, Security params, PIN_Capability, PIN_List, etc.) as
mentioned in clause 4.2.2 of TS 23.502 [3].
1\. PEMC will send the new Registration message with PIN_capable and PIN_List
to the SMF via RAN. The following are the new PIN related fields:
a. \"PIN Capable\", which can be true or false.
b. \"PINE list\", which is a list of all the PIN elements with reachable
address such as PINE1\@SUCI_PIN, PINE2\@SUCI_PIN etc.
c. Each PINE in the PINE list will contain the intended features:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
2\. AMF will perform its conventional Identity request, Auth/Security, UDM
selection, PCF selection etc. as mentioned in clause 4.2.2 of TS 23.502 [3].
3\. PCF selection procedure is performed according to clause 4.2.2 of TS
23.502 [3].
4\. AMF performs its Conventional Policy association Establishment/Mod and
adds PIN_Capable, PIN_List to the PCF message as mentioned in clause 4.2.2 of
TS 23.502 [3].
5\. PCF will send the PIN_Capable, PIN_List allowed/disallowed message to
PINCTRL.
6\. PINCTRL will query the UDM for the subscription to send the decide and
communicate the following message back to PCF:
a. \"PIN allowable\", which can be true or false.
b. \"PINE list\", which contains a list of PINE elements and its associated
policies and parameters. For e.g. A typical \"PINE list\" will be as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
7\. Conventional PDU session_updateSMContext, UE context modification Req/Res
is performed according to clause 4.2.2 of TS 23.502 [3] is performed.
8\. Registration Accept, along with PIN_Capability, PIN_List Response message
from PCF is sent as a Response to the PEMC.
#### 6.25.2.2 PEMC Triggered Service Request to Update PIN_List Procedure
Figure 6.25.2.2-1: PEMC Triggered Service Request to update PIN_List
1\. When a new PINE joins the PIN, the PEMC will send a new Service Request
with updated PIN_List to the RAN. A typical Service Request with PIN_List will
include the following:
a. \"PINE list\", which contains an updated list of PINE elements and its
associated policies and parameters. For e.g. A typical \"PINE list\" will be
as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
2\. RAN forwards the N2 message (Service Request with the updated PIN_List) to
the AMF.
3\. Conventional Authentication Security is performed according to clause
4.2.3 of TS 23.502 [3].
4\. AMF will send the Update PIN_List message to the PCF.
5\. PCF will send the Update PIN_List to PINCTRL for its approval.
6\. PINCTRL will decide based on the subscription and 3rd party/operators
policy and send the Acknowledged update PIN_List to the PCF. A typical update
PIN_List is as follows:
i. PINE1, PEMC = FALSE, PEGC=FALSE, 5G_Aceess=TRUE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
ii. PINE2, PEMC = TRUE, PEGC=FALSE, 5G_Aceess=FASLE, PINE_TO_PINE=TRUE,
DURATION = UNLIMITED.
7\. PCF will send the Acknowledged update PIN_List to AMF.
8\. AMF will send N2 Request with Acknowledged PIN_List to RAN.
9\. RAN will send the Update PIN_List response and the acknowledged PIN_List
to the PEMC.
#### 6.25.2.3 Network Triggered Service Request to Update PIN Policies
Procedure
Figure 6.25.2.3-1: Network Triggered Service Request to update PIN/PINE
Policies
1\. PINCTRL decides to update the PEMC PIN policies either due to operator or
3rd party policy update.
2\. PINCTRL invokes Namf_communication_N1N2MessageTransfer service operation
provided by the AMF. The message includes SUPI of PEMC, PEMC PIN Policy
container.
3\. If the PEMC is registered and reachable by AMF in either 3GPP access or
non-3GPP access, AMF shall transfers transparently the PEMC PIN Policy
container to the PEMC via the registered and reachable access.
If the PEMC is not reachable by AMF over both 3GPP and non-3GPP access, the
AMF reports to the PCF that the PEMC PIN Policy container could not be
delivered to the PEMC using Namf_communication_N1N2MessageTransfer as
mentioned in clause 4.2.3.3 of TS 23.502 [3].
4\. If the PEMC is in CM-CONNECTED over 3GPP access or non-3GPP access, the
AMF transfers transparently the PEMC PIN Policy container (PIN related policy
information) received from the PINCTRL to the PEMC. The PEMC policy container
includes the list of PIN policy as described in clauses 6.25.2.1 and 6.25.2.2.
5\. The PEMC updates the PIN Policy provided by the PINCTRL and sends the
result to the AMF
6\. If the AMF received the PEMC PIN Policy container and the PINCTRL
subscribed to be notified of the reception of the PEMC PIN policy container
then the AMF forwards the response of the PEMC to the PINCTRL using
Namf_communication_N1N2MessageNotify. The PINTCTRL will further handle
successful and failure Notification accordingly.
### 6.25.3 Impacts on services, entities and interfaces
The solution largely re-uses existing functionality
The solution has the following impacts:
Impact to the 5GCore:
\- Add New Network Function - PIN control function (PINCTRL)- to the 5GCore.
\- Add New Interfaces P1 and NPINCTRL to the 5G system.
\- Add New PIN Policy container, which will contain PIN Policy related fields.
\- Add PIN_Capable fields to the Registration message.
\- Add PIN_List field to the Registration message.
\- Add PIN_List update to the Service request message.
\- Add Namf_communication_N1N2MessageNotify message with PEMC PIN Policy
container.
\- Add PIN_Capable and PIN_List fields to registration accept message.
\- Add Delivery of PIN Policies message and results of Delivery of PIN
Policies.
Impact to the UE (PEMC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to maintain a list of all the PINE and its supported services.
\- Ability to respond to PINE and its service discovery queries from the PINE.
Impact to the PINE:
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to request QoS using http request to the PEGC.
Impact to the UE (PEGC):
\- Ability to support http broadcast messages, http request-response and http
based subscribe-notify features.
\- Ability to register its gateway functionality to PEMC.
\- Ability to accept http QoS request from the PINE and setup multiple PDU
session with the 5G System.
\- Ability to map PDU session ID to the IP address of the PINE and forward
packets to/from the corresponding PDU session.
## 6.26 Solution #26: Solution for parameter provisioning of PIN subscription
data
### 6.26.1 Description
This solution describes how the PIN subscription data is configured in the
PEGC/PEMC as required as part of the KI#6.
The solution describes UDM provides the subscription data to the PEGC/PEMC but
the same information can be considered as policy and provided by the PCF to
the PEGC/PEMC.
PEGC PIN subscription data and PEMC PIN subscription data described can also
be configured by the authorised user in the PEGC and/or PEMC.
### 6.26.2 Procedures
Figure 6.26.2-1: Provisioning PIN subscription data
1) The PEGC/PEMC initiates registration procedure. As part of registration
procedure PEGC/PEMC include the PIN input information. The PIN input
information consists of one of below based on request is from PEGC or PEMC:
For PEGC:
a) The UE wants to be(or anchor) as PEGC; and/or
b) The PIN ID (identity) for which it wants to be(or anchor) as PEGC .
For PEMC:
a) The UE wants to be(or anchor) as PEMC; and/or
b) The PIN ID (identity) for which it wants to be(or anchor) as PEMC.
2) AMF sends the PIN input information to the UDM.
3) UDM based on subscription or PIN input information includes the PIN
subscription data as described below.
4) If UDM includes the PIN subscription data the AMF indicates to the UE in
registration accept message that UE is allowed to act as PEGC/PEMC and provide
respective PIN subscription data in registration accept message.
PEGC PIN subscription data:
a) One or more PIN-IDs: Kind of group ID. The PEGC is allowed to join the PIN.
b) Max number threshold: Threshold of maximum number of PINEs allowed for the
PEGC. PEGC enforce max number threshold of PINEs.
c) Per PINE Max duration: After a PINE has joined a PIN, how long it is
allowed to be retained in the PIN. PEGC removes the PINE from the PIN when
PINE max duration is reached.
d) Applicable time slot for PEGC: For all the PIN-IDs. i.e. the PEGC will stop
functioning if it is not in the allowable time slot. If PEMC attempts to add
PEGC in the PIN during non allowed time slot an appropriate reject cause is
provided to the PEMC so that PEMC can select some other PEGC for the PIN-ID.
e) Max duration for PEGC- After UE starts behaving as a PEGC the maximum
duration it should act as a PEGC after which it should cease to act as PEGC
release all the PIN-E, indicate the same to PEMC.
f) Per PIN-ID:
i) Maximum duration: The time till UE should act as PEGC; once this time is
expired the PEGC will stop acting as PEGC for the respective PIN-ID; or
ii) Time slot (start time-end time) for which a PIN-ID is valid for this PEGC.
PEGC will stop or cease to act as PEGC for that PIN-ID if it is not in the
allowed time slot;
iii) Maximum threshold: Threshold of maximum number of PINEs allowed per PIN-
ID for the PEGC.
PEMC PIN subscription data:
a) One or more PIN-IDs: Kind of group ID. The PEMC is allowed to join/create
the PIN.
b) Max number threshold: Threshold of maximum number of PINEs/PEGCs allowed
for the PEMC across all the PIN-IDs. PEMC enforce max number threshold of
PINEs/PEGCs.
c) Per PINE Max duration: After a PINE has joined a PIN, how long it is
allowed to be retained in the PIN. PEMC removes the PINE from the PIN when
PINE max duration is reached.
d) Applicable time slot for PEMC: For all the PIN-IDs. i.e. the PEMC will stop
functioning if it is not in the allowable time slot. If PINE requests to join
the PIN during non allowed time slot an appropriate reject cause is provided
by the PEMC.
e) Max duration for PEMC: After UE starts behaving as a PEMC i.e. after
creating a PIN or receiving an indication from 5GC NF that it should act as
PEMC the maximum duration it should act as a PEMC after which it should cease
to act as PEMC and release all the PINs.
f) Per PIN-ID:
i) Maximum duration: It is the time when PEMC is setup for a given PIN-ID i.e.
the start time to the \"maximum duration\" in subscription; once this time is
expired the PEMC will cease to act as PEMC for the respective PIN-ID; or
ii) Time slot (start time-end time) for which a PIN-ID is valid for this PEMC.
PEMC will stop or cease to act as PEMC for that PIN-ID if it is not in the
allowed time slot;
iii) Maximum threshold: Threshold of maximum number of PINEs allowed per PIN-
ID for the PEMC.
g) Per PEGC:
i) Maximum duration: It is the time when PEGC is setup by PEMC. the start time
to the \"maximum duration\" in subscription; once this time is expired the
PEGC is removed from the PIN by PEMC;
ii) Time slot (start time-end time) for which a PEGC is valid. PEMC will
remove PEGC from the PIN if it is not in the allowed time slot;
iii) Maximum threshold: Threshold of maximum number of PINEs allowed per PEGC
for the PEMC.
h) Priorities among PEGCs.
PEGCs can be assigned priority, which will be used when threshold is reached.
Assignment or re-assignment of the PEGC based on the priorities. If a higher
priority PEGC joins a PIN and max number threshold is reached for PIN, the
PEGC removes a lower priority PEGC to allow higher priority PEGC.
PEGC PIN subscription data and PEMC PIN subscription data described can also
be configured by the authorised user in the PEGC and/or PEMC.
The solution above describes UDM provides the subscription data to the
PEGC/PEMC but the same information can be considered as policy and provided by
the PCF to the PEGC/PEMC after the UE has completed the registration
procedure.
### 6.26.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
**UE:**
\- UE acting as PEGC/PEMC includes the PIN information IE in registration
request message.
\- UE receives the indication in registration accept message if it can act as
PEGC/PEMC or both along with respective PIN subscription data.
**AMF:**
\- As part of registration request message PIN information IE is received. AMF
sends the PIN information to the UDM as part of Nudm_SDM_Get, in response the
received PIN subscription data is sent to the UE in registration accept
message.
**UDM:**
\- UDM provides respective PIN subscription data if allowed as per the
subscription of the UE.
## 6.27 Solution #27: Management for identification for PIN and PINE
### 6.27.1 Description
This solution is to address how to define the identification of PIN and PINE
for Key Issue#7, and also address how to allocate the identification for PINE
and PIN for Key Issue #3.
An appropriate format of PINE identifier is needed so that one PINE can
communicate with another PINE via PEGC, or via PEGC via 5GC within a PIN.
In this solution, it proposes that one PINE identifier is consisting of:
\- PIN ID.
\- PEGC ID, or PEMC ID.
\- Element ID.
PIN ID is used to identify a PIN network which the PINE is belonging to. PEGC
ID is used to identify a PEGC which serving the PINE to access to 5GC. Element
ID is used to uniquely identify the PINE within same PEGC. When the PINE is
PEGC or PEMC, no Element ID is needed. So one PINE can precisely find the PEGC
that serving the target PINE by using the PIN ID +PEGC ID, and identifying
target PINE with further Element ID.
PINE identifier can be allocated for the device by PEGC when first joining the
PIN. When there are multiple PEGCs in a PIN, the PINE (e.g. PIN ID + PEGC-1
ID+ EID) moves from one PEGC-1 to PEGC-2, new PINE identifier is needed and
allocated by PEGC-2. So that the PINE ID is identifiable with serving PEGC.
PEGC and PEMC allocates the ID for itself, no Element ID is needed, e.g. PEGC
ID =PIN ID + PEGC ID; PEMC ID = PIN ID + PEMC ID.
One PINE can have multiple PINEs allocated by multiple PEGCs. The PINE
identifier allocated by one PEGC can be only used in this PEGC. When the PEGC
leaves the PIN, all the PINE identifier(s) allocated by this PEGC are removed
accordingly.
### 6.27.2 Procedures
#### 6.27.2.1 Allocation for PINE identifier
##### 6.27.2.1.1 New PINE identifier allocation when joining the PIN
Editor\'s note: The figure of the call flow needs to be provided.
1\. Device (PINE) requests to PEGC for joining the PIN, with device
information, e.g. device ID, or mac address, capability, service, valid time.
2\. PEGC sends the request with device information to PEMC for approval with
the necessary device information in step1, and PINE ID allocated by PEGC,
which contains PIN ID, PEGC ID, and an Element ID.
3\. When the device is accepted as PINE by PEMC, PEMC sends the new PINE
information (e.g. PINE identifier, PINE Service, PINE capability, valid time,
etc.) to UDM to update the PIN profile.
4\. PEMC sends the result to the Device (PINE) with PIN info, PINE info via
PEGC.
5\. The device receives the PIN/PINE information, becomes as a PINE.
##### 6.27.2.1.2 New PINE identifier allocation when moving to new PEGC within
same PIN
Editor\'s note: The figure of the call flow needs to be provided.
1\. When one PINE moves to a new PEGC, and expects to access to 5GC via this
PEGC, then the PEGC allocates a new PINE identifier for this PINE.
2\. PEGC notifies the PEMC to update the PIN profile in UDM with the new PINE
information.
#### 6.27.2.2 Allocation for PIN identifier
Editor\'s note: It is FFS for allocation for PIN identifier
### 6.27.3 Impacts on Existing Nodes and Functionality
**UE/PEGC:**
\- Allocate the PINE ID.
# 7 Evaluation
Editor\'s note: This clause will provide evaluation of different solutions.
Further evaluation for solutions is needed until the solutions are stable.
## 7.1 Evaluation on Key Issue #1
There are 4 solutions for key issue #1 that introduce new function(s) in 5GC
for managing the PIN and 1 solution that instead proposes to only enhance the
existing functions for managing the PIN.
Solution #0A introduces a new Network Function, (PINCTRL) and proposes that
the interaction between PEMC/PEGC and the PINCTRL is over NAS. Considering NAS
protocol is not more flexible than other protocols, e.g. HTTP(S), the PINCTRL
is designed to only support limited function set.
Solution #0B introduces a new Network Functions (P-NF) and a 3rd party AF,
(P-AF) and proposes that the interaction between PEMC/PEGC and the P-NF is
over NAS. Considering NAS protocol is not more flexible than other protocols,
e.g. HTTP(S), the P-NF is designed to only support limited function set.
Solution #0C introduces a new function (PINMF) that can act as NF or as AF,
and proposes that the interaction between PEMC/PEGC and the PINMF is over 5GS
user plane, so there will be no NAS impact for PIN management and
communication. The impact on NAS is limited to provisioning of policy and
parameters where needed. NAS protocol is not more flexible than other
protocols, e.g. HTTP(S). If the PINMF is a NF, this solution is similar to
solution #0A and solution #0B, and the PINMF can only support a limited
function set. If the PINMF is an AF, there is no need to use NAS protocol. The
interaction between PINMF and PEGC/PEMC can be achieved via application over
user plane, which adds flexibility and causes less impact on 5GC.
Solution #0D introduces a new Application Function (PIN Application Server).
There will be no NAS impact for PIN management and communication for this
solution, and the impact on NAS is only for policy and parameters provisioning
when needed.
Solution #0E proposes to support PIN by enhancing existing function (e.g. UDM,
UDR). PEMC is responsible for PIN and PINE management which is carried over
application layer, 5GC only involves minimized PIN management (e.g. allocate
PIN ID). In this architecture, PEMC can communicate/manage the
PINEs/PEGCs/PEMCs directly (e.g. via WiFi, BT, PC5) or via 5GC without
specific PIN AF involving the PIN/PINE management. Considering PEMC is defined
as purely management role, there is no need another duplicated management role
(i.e. PIN AF) involved which may introduce additional complexity and cost for
user. Also considering PEMC/PEGC/PINE are configured/provisioned with the
identifiers of other PINEs, so the PIN communication and PIN/PINE management
are becoming simply \"UE to UE\" without AF involved.
In summary, the interaction among PINE, PEGC and PEMC can be achieved via
application layer. The AF can reuse existing mechanism of QoS parameters
provisioning to facilitate PIN communication, producing minimum impacts on
5GS.
## 7.2 Evaluation on Key Issue #2
### 7.2.1 General
Solution #1, Solution #2, Solution #3, Solution #4a, Solution #4b, Solution
#9, Solution #14, and Solution #15 are for Key Issue #2.
This Key Issue has two aspects, one is discovery, which is for the criterial
to determine whether to establish a wireless connection with another entity,
the other is selection, which is for the criterial to access services provided
by another entity over the established wireless connections.
The following mechanisms for discovery have been indicated:
a) Discovery based on information, which is locally configured, over a
dedicated PIN protocol layer (solution #1).
b) Discovery based on HTTP/UDP broadcast over wireless connections among
PINEs/PEGCs/PEMCs (solution #2).
c) Discovery based on information of the wireless access, e.g. SSID for WiFi,
device name for BT, PC5 discovery information, etc. which is locally
configured or provisioned by 5GC (solution #4a, #8).
d) Discovery based on input from authorized user via UI or authorized APP on
the PEMC (solution #3).
e) Discovery based on input from authorized user via UI or authorized APP on
the PEMC or based on parameter that are received from the 5GC during
registration (solution #3).
f) Discovery based on information which is configured or provisioned by 5GC
(solution #4a, #8, #15).
g) In case Discovery via 5GC, the Discovery information (e.g. PIN ID, and/or
PIN name) is configured or input from authorized user for the PINE
(solution#9, #15).
Following mechanisms for selection have been indicated:
a) Selection based on information over a dedicated PIN protocol layer among
PINEs/PEGCs/PEMCs (solution #1, #3, #4a).
b) Selection based on HTTP/UDP broadcast over wireless connections among
PINEs/PEGCs/PEMCs (solution #2).
c) Selection based on application layer interaction among PINEs/PEGCs/PEMCs
(solution #4b, #8, #14).
d) Selection based on application layer interaction between PINEs/PEGCs/PEMCs
and an PIN AF or a PIN NF (solution #8).
e) Selection based on selection parameters received from the 5GC (solution
#4b, #14, #15).
NOTE: Some combination of the above principles is not possible or not able to
be alternative.
### 7.2.2 Evaluation on solution #1
Solution #1 defines a dedicated PIN protocol layer over non-3GPP access or
PC5.
The PEMC is discovered by a new device based on the information in the PIN
Announce message that PEMC broadcasts over the PIN protocol layer. For joining
into a PIN to become a PINE, the device can send PIN Join Request to the PEMC
directly (alternative 1), or, the PEMC monitors the PIN Query Request
broadcasted from a device over the PIN protocol layer and responds the
information to the device directly (alternative 2).
The PEMC is the repository that manages the information of services that
provided by PINEs/PEGCs in a PIN. When the PIN Join Request is accepted, the
PINE is assigned the role of PEGC by the PEMC based on the capability
information indicated in the PIN protocol layer by the PINE. The PEMC could
query within the PIN to find any pre-configured UE that can function as PEGC
in the PIN. The PEGC can release the role of PEGC for a PIN by sending PIN
Release Request to the PEMC, which means the PEGC should be close to the PEMC
for releasing the role.
The solution introduces a PIN element function layer over non-3GPP access or
PC5.
### 7.2.3 Evaluation on solution #2
After the PEMC, PINE, and PEGC have established wireless connection with each
other, the PINE is able to select services based on HTTP/UDP broadcast over
wireless connections. The PEMC is the repository that manages the information
of services that provided by PINEs/PEGCs in a PIN, as well as the broker that
manages the token for service requirement between PINEs and between PEGC and
PINEs. The PEMC will assign a PEGC to an appropriate PINE based on the
policies and notify both PINE and PEGC about their association.
The solution requires the ability to support http broadcast messages, http
request-response and http based subscribe-notify features, and that the PEMC
acts as a repository for all the PINE and its supported services.
The solution also introduces a new network function to the 5GC (i.e. PINCTL).
The solution adds an information element (i.e. \"PIN Capable\") to the
registration message and information elements such as \"PIN allowable\" and
\"PIN Name\" to the registration accept message.
### 7.2.4 Evaluation on solution #3
The device discovers a PEMC based on information, e.g. PEMC name, PEMC ID,
FQDN, address, etc. that inputs from authorized user via UI. If the device is
a UE, it also can be provisioned by 5GC the information for discovering a
PEMC.
For joining into a PIN, the device sends PIN_join message to the PEMC with PIN
information related to the device, which is useful for PINE/service selection
by other PINEs and be configured by authorized user or by 5GC. The PEMC uses
the PIN Information to decide whether to add the PINE to the PIN (e.g. checks
if the requested service is supported by the PIN). The PEMC authorizes the
PIN_join message, and may respond with PEGC information to the device if the
device is authorized to be a PINE. After joining into a PIN as a PINE, the
PINE discovers the PEGC with the information received from the PEMC.
The PEMC stores the PIN information (Supported/requested services, group ID,
discoverability criteria etc.) for the PINEs.
When the information for discovering a PEMC is provisioned by 5GC and is
therefore semi-static, the flexibility in the discovery process is much
reduced. Provisioning PIN discovery information by 5GC may not be feasible and
flexible.
### 7.2.5 Evaluation on solution #4A
The device discovers a PIN based on PIN ID broadcasted by all
PINEs/PEGCs/PEMCs, the PIN ID can map to wireless access information, e.g.
SSID for WiFi. The PINE/PEGC that has joined into a PIN is configured with PIN
ID, PIN information (PIN Elements list, capability, availability,
reachability, and services) and PIN discovery policy by PEMC, and the devices
can establish connection with any joined PINE for joining into a PIN and
obtaining PIN information.
The solution proposes that the PEMC provide PIN discovery policy configuration
information to PINEs and PEGCs, broadcast and receive PIN announcements as per
the received PIN discovery policy and send and respond to PIN solicitation
request with PIN solicitation response.
The solution proposes a scenario that the PINE can join a PIN via another PINE
which may not be PEMC/PEGC. This is not in the SID scope which is specific
about the PINE joining a PIN only via PEGC/PEMC.
### 7.2.6 Evaluation on solution #4B
The PEMC is configured with PEGC selection information (prioritized list of
PEGCs along with PEGCs capabilities i.e. PEGC IDs, PIN Type supported, CN
Connectivity parameters, QoS Support, 5G CN Identifier, Network slice, QoS
Requirements, etc) by application layer, user interface, or 5GC, which
includes QoS consideration, slice, PIN type supported. The PEMC can consider
PINEs characteristics (PIN Types supported, CN Connectivity, Power source, QoS
support, network slice) or PIN type (Sensor Type, AR/VR, smart light, plug,
UE, etc.) to request 5G core network for PEGC selection information.
The solution proposes that the PEMC determine PIN characteristics based on
active PINEs, information from PINE requests, and PEGC selection information
that is received from the 5GC.
For PEGC selection information provided by 5GC, it implies that the PEMC and
PEGC are binding, which is not flexible for the scenario that the PIN may be
applied to, e.g. a UE may join a PIN based on demand.
### 7.2.7 Evaluation on solution #8
The PINE/PEGC is initially configured with information for wireless broadcast,
e.g. SSID for WiFi, and PEMC discovers PINE/PEGC by APP on the PEMC. After
establishing wireless connection with PEMC, the PINE/PEGC is provisioned with
PIN configuration information over application layer, which can include the
discovery information over wireless access for a PIN, e.g. SSID of other
PINEs/PEGCs for WiFi, or include broadcast information over wireless access
for a PIN that other PINE/PEGC can discover, e.g. SSID of the PINE/PEGC.
After establishing wireless connection with PEMC, the PINE/PEGC can obtain
PEGC/PINE selection information from PEMC over application layer.
Obtaining PIN discovery related information via application layer enable the
dynamic and flexible PIN discovery configuration.
### 7.2.8 Evaluation on solution #9
The PEMC/PEGC broadcasts PIN ID or PIN name, and the PINE discovers PEMC based
on the broadcasted PIN ID or PIN name. In case of PIN discovery via 5GC, the
Discovery information (e.g. PIN ID, PIN name, etc.) are configured or input
from user via UI.
The solution proposed that the UDM stores PIN profile which is somehow static,
making the PIN as a static or fixed group. With this solution the requirement
of being able to discover and join a PIN group dynamically on demand cannot be
met.
### 7.2.9 Evaluation on solution #14
The PIN elements (PINEs) can communicate with the PEMC/PEGC and other PINEs
via direct non-3gpp access (e.g. Wi-Fi and BT). The discovery of PIN elements
(PEGC/PEMC for PINE, PEMC for PEGC etc.) occurs via direct discovery over
non-3GPP access (e.g. Wi-Fi and BT) after the Wi-Fi or BT connection is
established using application layer signalling and using PIN information as
the criteria (e.g. PIN identity, PIN type etc.). PIN information including PIN
identity, PIN type, etc. is either preconfigured or provisioned by PCF, and
can be used for PINE/PEGC to select an appropriate PEGC/PEMC. The method of
PIN information provisioned by PCF relies on that the subscription of
PEGC/PEMC shall contain the necessary information, which implies that the PEGC
and PEMC are binding, which is not flexible and may not allow a PEGC to join
another PIN group which is managed by another PEMC.
### 7.2.10 Evaluation on solution #15
The solution focuses on the PIN/PINE service discovery in the case a PEMC/PEGC
is not available, and the PINE is a UE. For the case a new PINE performing PIN
Discovery via a PEMC/PEGC, the PEMC/PEGC broadcasts the Discovery information
(e.g. PIN ID or/and PIN name). For the case where one PINE discovers another
PINE, the Discovery information is pre-configured in the PINE.
The PINE, which can access the 5G network, sends a PIN service info query to
the network requesting PIN service Information. The UDM sends the PIN service
information (PINE ID, PINE name, PINE capability, PINE valid time, PINE type,
etc.) via the AMF to the requesting PINE. The PINE triggers the communication
with the desired PINE using the acquired PIN service information. The AMF
authorizes PINE to uses PIN service. The PIN Service information includes all
the PINEs information, e.g. PINE ID, PINE name, PINE capability, PINE valid
time, PINE type, etc. By using such PIN Services information, PINE selects the
target PINE that can provide the specific PINE Service.
The solution relies on the UDM maintaining the PIN profile, which implies that
the PEGC and PEMC are binding. This is not flexible and may not allow a PEGC
to join other PIN groups which is managed by another PEMC.
## 7.3 Evaluation on Key Issue #3
### 7.3.1 General
Editor\'s note: This clause will provide high level principles indicated by
solutions, which helps the conclusion stage. Further update is needed.
This Key Issue has two aspects, one is PIN management by PEMC, the other is
PIN management by network.
The following mechanisms for PIN management by PEMC have been indicated:
a) PIN management over application layer between PINE/PEGC and PEMC (solution
#2, #8).
b) PIN management over a dedicated PIN protocol layer between PINE/PEGC and
PEMC (solution #1, #6, #9).
c) PEGC informs association information to PEMC directly (solution #2, #6).
d) A PIN AF or a PIN NF informs association information to PEMC over
application layer (solution #8).
The following mechanisms for PIN management by network have been indicated:
a) PIN management over application layer with a PIN AF (solution #5).
b) PIN management over application layer with a PIN NF (solution #6, #7, #9,
#10).
c) PIN management over application layer with a PIN AF, and the PIN AF
interacts with a PIN NF via NEF, e.g. UDR, P-NF (solution #5, #6).
d) PIN management over NAS between PEMC and 5GC (e.g. via PDU Session
Modification procedure) and a PIN NF (e.g. P-NF) or multiple PIN NFs (e.g. UDM
and AMF) manages the PIN (solution #1, #6, #7, #9).
NOTE: Some combination of the above principles is not possible or not able to
be alternative.
There are 8 solutions (sol#1, sol#2&10, sol#5, sol#6, sol#7, sol#8, sol#9,
sol#20) covering this KI. The main aspects include the management of different
types of PINEs and the configuration of the PIN.
The evaluation of KI#3 is broken down into six objectives that the solutions
address. For each objective we present the functionality that is intended to
be used, the impacts on the system and which solution proposes the approach.
Table 7.3.1-1: Evaluation of KI#3 related alternatives
Objectives Alternatives Impacts Solutions
* * *
                                                                                                                                                                  \#1         \#2   \#5   \#6   \#7   \#8   \#9   \#20
PIN creation request The network operator can create a PIN PEMC/PEGC: support
to request a PIN creation X X X X X  
Both the network operator and authorized 3rd party, i.e. PEMC can create a PIN
AF/PEMC: support to request a PIN creation X X  
PEMC/PEGC authorization The authorized 3rd party is responsible for
authorizing PEMC/PEGC. AF: support PEMC/PEGC authorization X X  
The 5GC is responsible for PEMC/PEGC authorization 5GC: support to authorize a
PEMC/PEGC X X X X X X  
PIN parameters provision The authorized 3rd party provisions PIN parameters.
AF: support PIN parameters provision X X X  
The 5GC is responsible for PIN parameters provision. 5GC: support to provision
PIN parameters. X X X X  
Adding/ removing a PINE The authorized 3rd party is responsible for PINE
join/deletion. AF: support PINE join/deletion X X  
The PEMC determines to add/remove a PINE. PEMC: support to add/remove a PINE X
X X X X  
The PEGC/AMF adds/removes a PINE. PEGC/AMF: support to add/remove a PINE X  
PIN information storage The authorized 3rd party is responsible for storing
PIN information. AF: support to store PIN information X X X  
The 5GC is responsible for PIN information storage. 5GC: support to keep PIN
information X X X X X  
The PEMC/PEGC keeps PIN information. PEMC/PEGC: support to PIN information
storage X X  
Signalling between PEGC/PEMC The signalling over CP X X X X  
and PIN function in 5GC side The signalling over UP X X X X X
### 7.3.2 Evaluation on solution #1
The PEMC manages the PINE and PEGC for a PIN via a dedicated PIN protocol
layer.
After a device is assigned to be a PEGC of a PIN by the PEMC, the PEGC
indicates PIN ID and PEGC info to 5GC via PDU Session Modification procedure
for adding the PEGC into the PIN in 5GC.
### 7.3.3 Evaluation on solution #2
The PEMC manages the PINE and PEGC based on HTTP/UDP protocol, and is able to
assign the association between the PINE and PEGC. After the association is
assigned, the PEMC notifies the association to the PINE and the PEGC.
### 7.3.4 Evaluation on solution #5
The PIN AS is the function that manages PIN at network side over application
layer. The PIN AS stores/updates the PIN information in UDR via NEF.
### 7.3.5 Evaluation on solution #6
A network function P-NF is introduced to manage PIN in 5GC and provides
service operators for PIN management. A PIN AF is the function that manages
PIN on network side over application layer, which interacts with P-NF via NEF
to request PIN management in 5GC.
After receiving the PIN creation/deletion request from PIN AF, the P-NF
interacts with AMF, who sends NAS message to the PEMC, for PIN
creation/deletion. After a PIN has been has been created, when the PEMC is
informed that the PIN is updated, e.g. a PINE joins to a PIN via a PEGC and
the PEGC informs the PEMC, the PEMC sends NAS message to the AMF for the PIN
update, and the AMF interacts with the P-NF.
### 7.3.6 Evaluation on solution #7
The UDM is the network function that stores PIN information, and the AMF is
the network function to manage PIN.
The PEGC registers to 5GS with PINE info managing the association information
for a PIN, and the AMF queries the PIN information from the UDM for authorize
the association.
The AMF de-registers the PEGC when PIN duration expired, which implies the
PEGC shall register to 5GS again in order to obtain 5G service for itself.
### 7.3.7 Evaluation on solution #8
The PEMC manages a PIN for adding/removing a PINE or PEGC over application
layer on top of the direct wireless connection between the PEMC and the
PINE/PEGC.
The PINMF in 5GC is the function that manages PIN at network side. The PEMC
interacts with the PINMF over application layer for managing a PIN, including
PIN creation/deletion, updating PINE/PEGC information for a PIN, and authorize
PINE/PEGC association management.
### 7.3.8 Evaluation on solution #9
The UDM is the NF that manages PIN. The PEMC interacts with AMF over NAS for
PIN creation/deletion that optionally with information of PINEs, the PEMC also
interacts with AMF over NAS with information of PIN and information of PINEs
for PIN update, e.g. PINE adding/removing. The AMF interacts with the UDM for
corresponding PIN management operations.
The PEMC manages PINEs/PEGCs for a PIN via the dedicated PIN protocol between
the PINEs and the PEMC directly.
### 7.3.9 Evaluation on solution #10
The PINCTL in 5GC is the function that manages PIN. The PINCTL communicates
the policies to the PEMC for PIN management.
The PEMC manages PINEs/PEGCs for a PIN via HTTP/UDP protocol over direct
wireless connection.
### 7.3.10 Evaluation on solution #20
Editor\'s note: Further evaluation is needed.
## 7.4 Evaluation on Key Issue #4
### 7.4.1 General
Following mechanisms for device to network relay path management have been
indicated:
a) One PDU Session of the PEGC serves multiple PINEs (solution #5, #11, #12).
The PDU Session may be dedicated to relay traffic of PINE in the PIN(s) (as in
Annex X.3). Alternatively, other applications in the UE hosting PEGC may share
the PDU Session to relay traffic for the PIN (Annex X.2).
b) One PDU Session of the PEGC serves one PINE (solution #13).
In the case of one PDU Session serves multiple PINEs, following mechanisms for
SMF selection that serving the PDU Session of a PEGC for relay have been
indicated:
a) During the PDU Session Establishment procedure, an enhanced SMF supporting
PIN is selected (solution #5 implies).
b) When initial device to network relay is required from a PEGC, a PIN AF or
PIN NF sends DNAI to the PCF to trigger the SMF selection for a PDU Session of
the PEGC (solution #12).
In the case of one PDU Session serves multiple PINEs, following mechanisms for
QoS and policy differentiation have been indicated:
a) During UE (PEGC) initiated PDU Session Modification procedure with PINE
information, which is triggered by PINE, the PCF queries information for the
PINE from the UDR and devices policy for the PINE. The QoS and policy
information of the PINE is provided to the PEGC (solution #5).
b) During network initiated PDU Session Modification procedure for a PEGC,
which is triggered by a PIN AF or PIN NF, the QoS and policy information
related to PINEs associated with the PEGC is provided to the PEGC. The PCF is
able to provide QoS and policy information related to the PINEs (solution #11,
#12).
c) The PCF obtains the QoS and policy requirements for a PINE from UDR
(solution #5).
d) The PCF obtains the QoS and policy requirements from a PIN AF or PIN NF,
which may be via the SMF serving the PDU Session of the PEGC (solution #11,
#12).
In the case of one PDU Session serves one PINE, following mechanisms for QoS
and policy differentiation have been indicated:
a) The PEGC maps between DSCP over direct wireless connection and 5QI over 5GS
access (solution #13).
The following mechanisms for install routing information related to
communication for device to device via 5GC and PIN status information for DL
data notification for a PINE have been indicated:
a) Routing information and PIN status information is provided by SMF to UPF
for routing traffic of PINEs between PDU Sessions of PEGCs for a PIN (solution
#12).
NOTE: Some combination of the above principles is not possible or not able to
be alternative.
There are 9 solutions (sol#5, sol#11, sol#12, sol#13, sol#16, sol#17, sol#18,
sol#19, and sol #20) addressing this KI. The mains aspects include the
communications between PINE and services outside of the PIN via PEGC and 5GS.
The evaluation of KI#4 is based on the following classification of solution\'s
characteristics:
a) So1#13 and sol#16 define QoS differentiation for PINE traffic relayed by
PEGC and 5GS.
b) Sol#17 and sol#20 define PIN routing in presence of multiple PEGCs.
c) Sol#5&11&18, and sol#19 define QoS information for non-3GPP access.
d) Sol#12 proposes a solution for communication of PIN.
### 7.4.2 Evaluation on solution #5
The PINE requests PEGC over application layer, PEGC initiates PDU Session
Modification with PINE information. During the PDU Session Modification
procedure, the PCF queries the UDR according to the PINE information and
derives policy for the PINE, which is used as part of policy for reserving the
resources of the PDU Session of the PEGC.
The PEGC is provisioned with authorization information for device to network
relay over application layer by the PIN AS, and based on the authorization
information to allow or disallow the PINE to visit network.
### 7.4.3 Evaluation on solution #11
The PIN AF provides QoS requirement for a PINE to PCF, the PCF derives policy
rules for the PINE and notifies the SMF of the policy change, then the SMF
initiates PDU Session Modification procedure with the PEGC associated with the
PINE. Non-3GPP QoS assistance information is generated by SMF and sent for
each QoS flow to PEGC based on PEGC subscription data and operators policy.
The PEGC receives the non-3GPP QoS association information and reserves the
resources in the non-3GPP network according to the non-3GPP QoS association
information. The non-3GPP QoS assistance information includes QoS
characteristics, GFBR/MFBR (if applicable), ARP, Periodicity.
### 7.4.4 Evaluation on solution #12
The PEMC sends relay request over application layer to the PINMF, and the
PINMF sends service requirements for the PINE to PCF. Then the SMF performs
PDU Session Modification with the PEGC by interacting with PCF. The routing
information also can be stored in UDM, and the procedures are in control
plane.
When initial device to network relay is required from a PEGC over application
layer, the PINMF provides a DNAI to the PCF, which triggers the SMF
reselection procedure for the PDU Session of the PEGC. According to the DNAI,
the enhanced SMF supporting PIN can be selected by the AMF.
When PINE service is requested from the PEGC over application layer, the PINMF
interacts with the SMF for providing QoS and policy requirement of the PINE,
the SMF interacts with PCF serving the PDU Session of the PEGC to derive QoS
and policy information for the PINE, and triggers network initiated PDU
Session Modification procedure for reserving the resources of the PDU Session
of the PEGC and sending the mapping information to the PEGC for the PEGC
mapping the traffic of the PINE into corresponding QoS flows.
The PINMF provides the routing information to the SMF via NEF, and the SMF
sends the routing information to UPF to allow or disallow the relay between
PINEs via the 5GC. The PINMF also provides PIN status information to the SMF
via NEF, and the SMF sends the information to the UPF for DL data notification
for a specific PINE. The UPF notifies SMF for downlink data of a PINE
according to the PIN status information, and SMF notifies PINMF to trigger
PINE/PEGC opening non-3GPP access for direct connection setup.
### 7.4.5 Evaluation on solution #13
The PINE in the PIN requests PEGC for 5G session establishment and PEGC
establishes PDU Session per PINE that associated with the PEGC when the PINE
requests the PEGC to perform device to network traffic relay, i.e. the PINE
requests the PEGC for relay with QoS information, the PEGC establishes
appropriate PDU Session for the relay and maps DSCP field of the traffic over
the direct wireless connection with 5QI.
In order to forward the data, PEGC maps local FQDN or IP address of the PINE
to the PDU session ID. About QoS differentiation, PINE can request PEGC for a
desired QoS or PINE can use DSCP marking on the IP packet to indicate the
desired QoS.
### 7.4.6 Evaluation on solution #16
Differentiated QoS can be provided for different PINEs per PDU session /
S-NSSAI and per QoS flow basis, default QoS associated with the PDU session
can be different based on the DNN and S-NSSAI. PEGC is configured (e.g. either
pre-configured or delivered to PEGC by AF managing PIN via UP) with mapping
information (e.g. between service types of PINE and DNN/S-NSSAI and QoS flow).
The PEGC can identify the communication from PINEs based on, e.g. MAC
address/Bluetooth ID or IP addresses/ports in case of NAT is applied.
The difference from sol #13 is that if some PINE service types are similar and
can be served with a common PDU session and DNN/S-NSSAI, these PINEs can be
can be considered to share the same PDU session.
### 7.4.7 Evaluation on solution #17
The SMF configures group-level N4 session for all UPFs serve the PDU Sessions
of PEGCs in a PIN to enable local routing via 5GC. The framework is similar to
5G VN group communication to enable the local routing communication path for
PIN. The PIN AF provisions the required group and group member configurations
for creating the N4 rules for local routing.
### 7.4.8 Evaluation on solution #18
UDR contains Default non-3GPP delay budget for a PEGC, according to the AF
request, the PCF indicates the non-3GPP delay budget to the PEGC and the
adjusted PDB to NG-RAN via PDU Session Modification procedure. The PEGC takes
the non-3GPP delay budget into account for the direct connection with a PINE.
A default non-3GPP network delay budget is configured in the UDR or PEGC
requests to change the default non-3GPP delay budget for a specific flow with
the PDU Session Modification procedure.
### 7.4.9 Evaluation on solution #19
This solution provisions a mapping between a Uu QoS parameters and QoS
information of direct non-3GPP access. The PEGC determines the direct non-3GPP
access QoS info based on the PCF provisioned mapping or the PINE establishes
Wi-Fi/BT connection with PEGC and provides direct non-3GPP access QoS info to
the PEGC.
### 7.4.10 Evaluation on solution #20
This solution deals with PIN communication using multiple PEGCs. The
association between PEGC and PIN Elements is stored in specific network
function, the P-NF. The PINE requests PEGC for traffic relay, PEGC sends PDU
Session request to SMF, and SMF will send a request to P-NF to get the
association between the targeted PINE and the configured PEGC when SMF
receives the PIN PDU session request from PEGC. After getting the mapping from
P-NF, SMF will set the corresponding PDR and FAR and sends the rules to UPF.
## 7.5 Evaluation on Key Issue #5
### 7.5.1 General
Solution #1, solution #5, solution #6, solution #8, solution #9, solution #21,
and solution #22 are for Key Issue #5.
The key issue emphasizes on the aspects to authorize/de-authorize a PINE, PEMC
and PEGC for PIN services.
The following mechanisms for PEMC authorization have been indicated:
a) PEMC is authorized without 5GC involvement (solution #5).
b) PEMC is authorized based on subscription of PIN feature or subscription of
a PIN (solution #6, #8, #9).
c) PEMC is authorized with 5GC involvement (solution #22).
The following mechanisms for PEGC authorization have been indicated:
a) PEGC is authorized without 5GC involvement (solution #5).
b) PEGC is authorized when it is a UE (solution #8).
c) PEGC is authorized based on subscription (solution #6) by the 5GC (solution
#1).
The following mechanisms for PINE authorization have been indicated:
a) PINE is authorized without 5GC involvement (solution #5).
b) PINE is authorized with 5GC involvement (solution #21, #22).
The following mechanisms for authorizing a PEGC to provide connectivity to and
from the 5G network for other PINEs have been indicated:
a) The 5GC authorizes the PINE to connect to the 5G network via the PEGC
(solution #21, #22).
NOTE: Some combination of the above principles is not possible or not able to
be alternative.
### 7.5.2 Evaluation on solution #1
In the second method, a PEMC, after it has been authorized by 5GC for PIN
operation, begins to monitor incoming queries for PIN services.
A UE capable of PEGC functionality is authorized for PIN operation by the 5GC.
The solution relies on that the 5GC needs to store the PIN information in
order to authorize the PEMC, which implies that an UE can only be authorized
to be a PEMC based on subscription which is not flexible.
### 7.5.3 Evaluation on solution #5
The PIN AS, who manages PIN at network side, authorizes whether a PEMC is
allowed to manage a PIN, where the user of the PEMC can initiate the request
to create a PIN via P4 reference point with PIN AS. The PIN AS also authorizes
whether a PINE/PEGC is allowed to join into a PIN. The PEMC may invite/expel a
PEGC or PINE in a PIN, and a PINE/PEGC may request to join/leave a PIN. All
the requests are routed to the PIN AS for authorization.
The solution #5 allows PINE(s) to join/leave a PIN without 5GC involvement,
which is a simple and flexible solution.
### 7.5.4 Evaluation on solution #6
The P-NF queries the UDM to learn about UE subscription and based on the
information received from the UDM the P-NF for authorizes the PEMC and the
PEGC to manage the PIN by PEMC and to establish PIN connectivity with the 5GC
respectively.
The PEGC interacts with PEMC directly for authorizing the PINE to join via a
PEGC.
The solution requires that the 5GC shall store the PIN information e.g. a UE
can be a PEGC/PEMC.
### 7.5.5 Evaluation on solution #8
The PINMF interacts with UDM for PEMC authorization, i.e. to determine whether
the PEMC has subscribed PIN service as a manager or not. The PINMF also
determines whether the additional PEMCs/PEGCs are trusted members of the PIN.
PINMF authorize PEGC only if PEMC added the PEGC into a PIN over application
layer and the PEGC registered into PINMF over application layer. There may be
more than one PEMCs included in a PIN, the PINMF only allows one PEMC to
control the additional PEMCs in the PIN.
PINMF verifies the PEGC is a UE based on whether the parameters provisioned to
PEGC over 5GC success or not.
The solution requires the UDM to store the PIN information e.g. whether
PEMC/PEGC are trusted members of the PIN. This implies that the PEGC and PEMC
are binding, which make the PIN creation is not flexible, e.g. an UE join a
PIN dynamically.
### 7.5.6 Evaluation on solution #9
The AMF interacts with UDM for PEMC authorization based on the request from
the UE with PEMC capability, i.e. for creating a PIN. The AMF sends a request
the UDM for creating the PIN and includes the information as received from the
initiating UE. AMF may also check with UDM whether the UE is authorized to
create the PIN.
The solution requires the UDM to store the PIN information e.g. whether an UE
can be a PEMC/PEGC. The subscription shall include the PIN related capability,
which is not flexible for usage of PIN services.
### 7.5.7 Evaluation on solution #21
In Solution #21, a PINE must first discover a PEMC and send a join request to
the PEMC. The PEMC will then authorize the PINE for connectivity to the PIN by
obtaining authorization information from UDM/UDR/P-NF via the AMF. The PEMC
may authorize the PINE to access 5GS services via a PEGC.
The solution #21 assumes that a 3GPP defined PIN Protocol will be used for the
direct communication between PINEs (e.g. between the PINE and PEMC or PEGC).
The solution requires the UDM to store the PIN information e.g. whether an UE
can be a PEMC/PEGC. The subscription shall include the PIN related capability,
which is not flexible for usage of PIN services.
### 7.5.8 Evaluation on solution #22
In Solution #22, a PINE authorization to access the 5GS, PEGC and other PINEs
is performed by Token based authorization. A PINE sends \"Authenticate and
Request Access Token\" Request query to the PEMC, which will respond with the
access Token to the requesting PINE based on the authorization policies
already stored in PEMC, provided by 5GC.
Authorization/De-Authorization of the PEMC is performed with involvement by
5GC, which allows operators to control the devices to join/leave PIN.
The solution is beyond SA2 scope, which includes specific authentication and
authorization method, which shall be discussed and evaluated by SA3.
## 7.6 Evaluation on Key Issue #6
### 7.6.1 General
Solution #4B, solution #5, solution #7, solution #8, solution #9, solution
#12, solution #14, solution #19, solution #23, solution #24, solution #25, and
solution #26 are for Key Issue #6.
The following mechanisms for provisioning of PIN related policy and parameters
related to discovery and selection have been indicated:
a) Discovery and selection information is provided over application layer to
the PEGC and PINE (solution #5, #8).
b) Discovery and selection information is provided over application layer to
the PEMC (solution #5, #8, and #9).
c) Routing information is provided over application layer to PEGC (solution
#4b, #5).
The following mechanisms for provisioning of PIN related policy and parameters
routing information related to device to network relay and device to device
relay via 5GC/NAS signalling have been indicated:
a) Discovery and selection information is provided over NAS to PEGC or PEMC
through AMF (solution #4b, #7, #8, #9, #12, #14, #19, #23, #24, #25, #26).
b) Routing information is provided over NAS to PEGC, including PDU session
related, i.e. provisioned through SMF, and non-PDU session related, i.e.
provisioned through AMF (solution #8, #12).
NOTE: Some combination of the above principles is not possible or not able to
be alternative.
The following mechanisms for provisioning of PIN related policy and parameters
via 5GC/PCF/UDM (with more transparent NAS delivery) have been indicated:
a) PIN related policy and parameters are delivered to PEGC/PEMC via PCF using
delivery mechanism similar to URSP/ProSe policy (solution #14, #23, #24, #25).
b) PIN related policy and parameters are delivered to PEGC/PEMC via UDM using
delivery mechanism similar to UPU (solution #8, #12).
c) PIN related QoS control and differentiation via 5GC can also be enforced in
5GC via PCF using existing procedure (solution#19, #12) with the request from
AF/PINMF.
### 7.6.2 Evaluation on solution #4B
During registration procedure, the PEMC registers to 5GC with PEMC capability
information, which includes PIN type, size, QoS requirements, and the AMF
responds with a NAS accept message including PEGC selection information, which
includes QoS consideration, slice, PIN type supported. The PEGC selection
information is used by the PEMC to select PEGCs for itself and other PINEs.
The PEMC sends the discovery and selection parameters to PEGC(s)/PINE(s).
### 7.6.3 Evaluation on solution #5
The PIN AS, who manages PIN at network side, provisions parameters to PINE,
PEGC, and PEMC over application layer. The PIN related parameters are related
to PIN management, PIN discovery and selection, communication path. All the
requests are routed to the PIN AS for authorization.
### 7.6.4 Evaluation on solution #7
During the PEGC registration procedure, the UDM provides subscription
information that includes PIN info to the AMF, and the AMF sends it to PEGC
via a NAS accept message.
The solution assumes that all PINEs are linked to each other already before
the PEGC register to the 5GS.
### 7.6.5 Evaluation on solution #8
The PINMF provisions discovery and selection parameters to PEMC and PINE over
application layer.
When discovery and selection parameters related to a PEGC is provisioned to
the UDR by the PINMF via NEF, the UE configuration update procedure is
triggered to send the parameters to the PEGC.
The solution indicates that a new NF PINMF can provide PIN related info to
PINE/PEMC/PEGC via application layer/user plane and/or NAS/control plane.
### 7.6.6 Evaluation on solution #9
After receiving a request for PIN creation over NAS from a PEMC, the AMF
requests that the UDM create PIN context/profile and provide PIN related
information including discovery and selection parameters for the PIN, and then
forwards the parameters with the PIN creation response to the PEMC over NAS.
The solution also proposes that, when a PINE joins the PIN, the PEMC may
request a PIN related information update by sending a request for PIN update
over NAS. The AMF updates the PEMC subscription data in UDM with joined PINE
information.
The solution further proposes the UDM can receive a PIN creation request from
the AF via the NEF. The UDM may update the PEMC with PIN related information
using NAS UE configuration update procedure.
### 7.6.7 Evaluation on solution #12
During the PDU Session Modification procedure, the SMF sends the routing
information to the PEGC (or UPF in case 5GC is involved in the communication)
according to the requirements from the PINMF via PCF. The routing information
to PEGC allows or disallows the relay between PINEs via the PEGC for device to
device relay, and allows or disallows a PINE visit 5GS via a PEGC for device
to network relay.
The solution proposes that the PIN related information update is sent from the
PINMF to PEGC via UDM/AMF.
The solution introduces a new NF PINMF that can communicate with the PEGC/PEMC
via application layer.
### 7.6.8 Evaluation on solution #14
The PEGC / PEMC may be preconfigured with connectivity service information
that it can support, or the connectivity service information can be
provisioned by PCF to the PEGC / PEMC similar to ProSe policy delivery to UE.
The PCF receives PIN related information from AF via the NEF.
The UE indicates PEMC/PEGC Capability in the Registration Request message, and
the AMF selects the PCF supports PIN if the UE is authorized to act as
PEMC/PEGC based on subscription data. The UE may include the UE Policy
Container with indicating the PIN Policy Provisioning Request during
registration procedure. The UE may also include PEMC/PEGC capabilities in the
PIN Policy Provisioning Request.
### 7.6.9 Evaluation on solution #19
The \"PCF based Service Authorization and Provisioning to UE\" procedure as
defined in clause 6.2.2 of TS 23.304 [6] is reused by the PCF to provision PIN
policy and parameters to PEGC similar to ProSe policy delivery to UE. The PCF
receives PIN related information from AF via the NEF. The PIN policy and
parameters include a mapping between a Uu QoS parameters (including 5QI,
GFBR/MFBR, ARP) values and QoS information of direct non-3GPP access
(including QoS characteristics, GFBR/MFBR, ARP, Periodicity). In case of PIN
communication via 5GC, PCF provides PCC rules to SMF/UPF based on existing PDU
session modification procedure.
### 7.6.10 Evaluation on solution #23
PIN policies are provisioned to the PEGC / PEMC from the PCF. The PCF receives
PIN related information from AF via NEF.
The PCF provides PIN related information to PEMC via AMF when PEMC registers
in the 5GS if PIN related information is already available in PCF. It is also
possible that PIN related information may be delivered by AF to PCF after PEMC
registration in 5GS. The solution includes also PEMC triggered PIN related
information retrieval.
### 7.6.11 Evaluation on solution #24
UE indicates capability to AMF during registration procedure, then AMF
indicates UE capability to PCF during the UE Policy Association Establishment
and UE Policy Association Modification procedures.
The PCF provides PIN policies and parameters to the PEGC / PEMC by using the
UE Configuration Update procedure for transparent UE Policy delivery
procedure.
### 7.6.12 Evaluation on solution #25
A PINCTRL network function provides PIN policies and parameters to the PEGC /
PEMC via NAS signalling.
The PCF receives PIN related information from new NF PINCTRL. The PCF provides
PIN related information to PEMC via AMF with NAS message with explicit PIN
related information.
The solution proposes also PEMC/network triggered PIN related information
update. For PEMC triggered information update, it involves AMF/PCF/PINCTRL
using NAS with mixture of existing and new NAS messages. For Network triggered
information update, PINCTRL uses N1N2message delivery service in AMF directly
without PCF involvement.
### 7.6.13 Evaluation on solution #26
The solution proposes the PIN related information is part of the subscription
data for PEGC/PEMC. The UDM/UDR provides PIN policies, and they are sent to
the PEGC / PEMC in the Registration Response (e.g. PIN information specific
NAS parameters in Registration Accept message).
## 7.7 Evaluation on Key Issue #7
### 7.7.1 General
The following mechanisms for PIN ID management have been indicated:
a) UDM allocates the PIN ID (solution #9).
b) A new NF for PIN management allocates the PIN ID (solution #6).
c) An AF for PIN management allocates the PIN ID (solution #8).
The following mechanisms for PINE ID and PINE IP management have been
indicated:
a) PEMC allocates the PINE ID (solution #1).
b) UDM allocates the PINE ID (solution #9).
c) SMF allocates the PINE ID and PINE IP (solution #12).
d) PEGC allocates the PINE ID for the PINE connecting to this PEGC (solution
#27).
NOTE: Some combination of the above principles is not possible or not able to
be alternative.
### 7.7.2 Evaluation on solution #1
The PEMC assigns the PINE ID to a PINE during the PINE interacting with the
PEMC to join into a PIN. 5GC is not involved in PIN ID/PINE ID allocation.
### 7.7.3 Evaluation on solution #3
Group ID (also called as PIN ID): The group ID configured by the authorized
user or the 5GC.
### 7.7.4 Evaluation on solution #5
After successful registration, the PEMC sends a request to the PIN AS to
create a PIN. The PIN ID is assigned by the PIN AS to the PEMC.
The PIN AS provisions PIN Service Specific Parameters to the UDR (via NEF) for
policy control of the PEGC, include e.g. the PIN ID, default QoS requirement
and valid time for PIN communication. The PINE ID may be used in 5GC for
policy and QoS control in 5GC for PIN traffic via 5GC.
### 7.7.5 Evaluation on solution #6
When requested by a PIN AF via NEF for creating a PIN, the new PIN Network
Function P-NF assigns the PIN ID and send it to the PEMC via AMF over NAS as
well as send it to the PIN AF via NEF.
For PIN Elements, it is allowed that a PINE can be added in more than one PIN.
Thus, it is recommended to combine PIN ID and PINE ID to identify PIN Elements
The P-NF is a 5GC NF and represents the functionality providing the capability
to manage the PIN in 5GC, e.g. processing the request of creating PIN,
choosing a UE to be a PEMC and distribute a PIN ID to identify a PIN, etc.
### 7.7.6 Evaluation on solution #8
When requested by a PEMC over application layer for creating a PIN, the PINMF
assigns the PIN ID. The PIN ID is provided to PEGC/PEMC/PINE via application
layer or NAS message.
### 7.7.7 Evaluation on solution #9
In this solution, it assumed that UDM is used to create/update/remove PIN
profile that includes PIN information and optional PINEs information with PIN
ID/PINE ID, based on input PIN information from PEMC when request the creation
of the PIN via NAS. The UDM allocates/manages the PIN ID. The UDM may
allocate/manage PINE ID for the PIN.
PINE ID, unique ID within a PIN that could be allocated by PEMC locally, or
network.
PIN ID, unique ID within a PLMN and allocated by network.
When a PEMC requested over NAS to create a PIN, the AMF interacts with the UDM
for creating the PIN. The UDM allocates PIN ID and optional PINE ID(s) for the
PIN and the PINEs included in the PIN.
### 7.7.8 Evaluation on solution #12
When device to network relay is requested from a PEGC over application layer,
the PINMF indicates the information related to the relay to the SMF serving
the PDU Session of the PEGC for the relay. The SMF allocates PINE ID and PINE
IP and sends them to the PEGC via network initiated PDU Session Modification
procedure.
### 7.7.9 Evaluation on solution #27
The solution proposes that PINE ID is formulated based on PIN ID + PEGC/PEMC
ID + (optional) Element ID, PEMC/PEGC ID is consisting of PIN ID and PEMC
ID/PEGC ID, unique within a PIN. The Element ID is unique within a PIN. The
PINE ID is allocated by PEGC and uploaded to PEMC/UDM (i.e. new PEGC means new
PINE ID).
PEGC is responsible for allocating the PINE ID for the PINE after
authentication by PEMC at the same time the association between PEGC and the
PINE(s) is established.
One PINE may have multiple PINE IDs if it is connected to multiple PEGCs.
# 8 Conclusions
## 8.1 Conclusion on Key Issue #1
The following interim conclusions are agreed for principles of Personal IoT
Networks Key Issue #1 \"5GC architecture enhancements to support PIN\":
1) The functionality of PINE is not defined by 3GPP and therefore are not
specified by SA WG2.
2) Application Functions may be used to control PIN network via user plane of
5G network and this interaction is implementation specific.
3) The reference point among PINE, PEGC, and PEMC, no matter whether non-3GPP
access or sidelink or via 5GC is used, is transparent to the 5GS and not
specified by SA WG2.
4) Legacy UE acting as PEMC needs to be considered.
5) Multi-hop P2P (i.e. communication between a chain of PINEs) and P2N relay
(i.e. communication from a PINE to another PINE or to the network via an
intermediate PINE) are not studied in this release.
6) In this Release, data traffic of PINE over control plane is not studied.
## 8.2 Conclusion on Key Issue #2
The following conclusions are agreed, which does not have normative work:
1) The interfaces for PIN discovery between PINE and PEGC, PINE and PEMC, PEGC
and PEMC are divided into two layers: transport layer and application layer.
a) The transport layer is based on non-3GPP communication or 3GPP PC5 between
PEGC and PEMC (which includes direct communication and direct discovery).
Transport layer functionality based on non-3GPP communication specification is
outside the 3GPP scope. When transport layer is based on 3GPP PC5, the
existing procedures defined for 5G ProSe Direct Communication are re-used.
b) The application layer for PIN and PIN Element discovery and selection is
not specified by SA WG2. No normative work is required for this aspect.
2) The mechanism for discovering of PIN, and PIN elements is based on non-3GPP
access discovery method and is not specified by 3GPP.
3) The procedure of selection of PEMC and PEGC by PINE is implementation
specific and therefore it is not specified by 3GPP.
## 8.3 Conclusion on Key Issue #3
The following interim principles are agreed for Key Issue #3 \"Management of
PIN and PIN Elements\":
1) PEMC is responsible for PIN Element management (e.g. add/remove the
PINE/PEGCs, etc.), which is out of SA2 scope.
2) NEF/UDM supports AF provisioning parameters for managing PIN policy and 5GC
resources activation/deactivation of a PIN with parameter of PIN ID.
3) AF may access the PIN Profile invoking a NEF API.
4) In case of multiple PEMCs in a PIN, how to assure that only one PEMC is
controlling the PIN at any point of time is implementation specific (e.g. via
Application specific mechanism carried by application layer) and therefore it
is not specified.
5) The 5GC is not responsible for managing the PIN validity duration.
## 8.4 Conclusion on Key Issue #4
The normative work is based on the following principles
1) When the communication between a PEMC and a PINE behind a PEGC takes place
via 5GC, or when the communication between PINEs requires multiple PEGCs and
5GC, the existing traffic forwarding functionalities in 5GS via UPF(s) or N6
can be applied if available.
2) Non-3GPP QoS assistance information (including QoS characteristics,
GFBR/MFBR UL/DL, MPLR UL/DL) that contains the same parameters as the
Additional QoS Information specified in table 9.3.1.1-2 of TS 24.502 [9] may
be sent to PEGC from SMF to assist the deriving of N3GPP QoS parameters for
PIN.
a) Whether and how PEGC performs the deriving of QoS parameters and mapping
procedure to be applied between the PINE and the PEGC is implementation
specific and therefore it is not specified by 3GPP.
3) Differentiated traffic routing and QoS control may be required by a PEGC.
4) If AF for PIN is used, the AF can request the 5GC to exposes capabilities
in order for the AF to provision parameters for resources
configuration/deconfiguration for a PIN, QoS authorization for a PIN, QoS
control for the PIN traffic, and routing control for the PIN traffic. The
mechanism and criteria used by the AF to determine the need for a QoS
modification for the PIN traffic are out of 3GPP scope.
5) PDU session management functionality can be used by the PEGC.
a) When the PEGC detects new packets (PIN signalling or PIN traffic or
creation of PIN) from a device in the PIN, it may map the PIN or PIN packets
to an existing PDU session or establish a new PDU session. The criteria for
taking the decision can be based on existing mechanism or implementation.
NOTE 1: The procedure is the same used when application generating the traffic
resides directly on the UE.
b) The PEGC initiates PDU Session Establishment/Modification Request with
necessary information:
i) To enable 5GC to manage system resources related to a PIN, which includes
one or more PEGCs.
ii) To differentiate QoS control on PIN traffic.
NOTE 2: The AF relies on PIN signalling between the PINE/PEGC/PEMC and the PIN
AF, which is transferred via UP transparently to the 5G system, to determine
the need for a QoS modification.
6) The procedure for supporting one PINE connected to multiple PEGCs in the
same PIN and PINE to move between PEGCs is outside the 3GPP scope.
7) PIN direct communication is not specified since it is implementation
specific.
8) PIN indirect communication via PEGC is managed within the PIN, which may be
supported by 5GS.
9) A PEGC may establish a single or multiple PDU Sessions used for PIN
communication. One PEGC may serve more than one PINs. One PIN may be served by
one or more PDU sessions. PIN may be served by more than one PDU sessions in
the PEGC. (See PIN Session models as described in Annex A).
10) IPv6 Prefix Delegation as described in clause 4.6.2.3 of TS 23.316 [5], or
DHCP proxy by PEGC, or Framed Routing as described in clause 5.6.14 of TS
23.501 [2] are applied for IP address allocation of PINEs connected to PEGC.
NOTE 3: Framed Route support will be further considered during normative work.
11) If AF for PIN is used, the AF may provide necessary parameters to 5GC
which may be considered by PCF to generate the PIN Route Selection Policy for
PDU Session selection by PEGC(s) and to generate the URSP accordingly for
PEMC(s).
12) Routing of traffic from/to PDU session and the PIN elements is left to
implementation
13) PIN is a service that needs user subscribing from operator, the user\'s
PIN service subscription is used by operator for policy configuration to
PEGCs.
14) UDR is enhanced to support the storage and retrieval of PIN related policy
and QoS parameters.
15) The N3GPP network delay between PINE and PEGC may be signalled from PEGC
to PCF, and be taken into account when PCF derives the PDB value of QoS flow
for PEGC.
16) The 5G system support for anchoring PDU Sessions of PEGCs and PEMCs at
same SMF based on a combination of DNN, S-NSSAI.
NOTE 4: Other possibility without anchoring at same SMF may be determined in
normative phase.
17) If AF for PIN is used, the 5GC authorizes the number of PIN that the AF
requests to create, which results in the number of PDU Sessions per PEGC/PEMC
for PIN, according to user\'s PIN service subscription, which reflect the
agreement between user and operator for using PIN service.
## 8.5 Conclusion on Key Issue #5
The following conclusions are agreed for Authorization for PIN:
1) PIN application-level Authentication and Authorization of PIN and PIN
Elements are not specified by SA WG2.
2) PEGC is authorized by 5GC to provide PIN service via subscription in the
UDM.
3) PEGC is subject to operator policies for any PIN services that operate over
5GC.
4) A PINE is authorized by PEMC to join a PIN.
5) A PINE is allowed or disallowed to connect to a PEGC by the PEGC based on
the provisioned information.
## 8.6 Conclusion on Key Issue #6
The following principles are concluded for Key Issue #6 \"Policy and
parameters provisioning for PIN\":
1) The PIN policy and parameter(s) are configured in the PEGC via application
layer and it is implementation specific, therefore it is not specified by
3GPP.
2) The policy and parameters provisioned to PEGC by 5GC, with the support of
AF, for PIN communication include the following information:
a) The QoS flow mapping for PINE\'s traffic relay is received via PDU Session
Modification procedure from PCF.
b) Non-3GPP QoS assistance information.
NOTE: Existing procedures are used to deliver the parameters to PEGC.
3) The existing procedure used by the SMF to provide the UPF with, PDR, FAR,
etc are applicable without modification.
## 8.7 Conclusion on Key Issue #7
The following principles are concluded for Key Issue #7 \"Identification of
PIN and PIN Elements\":
1) NEF/UDM supports storing PIN ID in UDR, which may be received from AF.
NOTE 1: Whether external and internal PIN ID are needed, and who allocates the
PIN ID, are determined in normative phase.
2) PIN ID is uniquely identifiable within the 5G network,
NOTE 2: It will be determined during the normative phase whether the PIN ID is
defined as an external PIN identifier in similar way of the External Group
Identifier and GPSI, and an 5G internal PIN identifier similar as Internal
Group Identifier.
3) PINE ID awareness in 5GC is not needed.
###### ## Annex A (informative): PIN Session Models
# A.1 General
In this Annex, we describe the PIN Session models with the assumption that one
PDU Session serves one PIN.
**5GC can enforce PIN level QoS by applying the QoS for the PDU Session since
the PIN and the PDU Session has one-to-one relationship. For example, if the
operator applies the PIN level AMBR, it can enforce PIN-AMBR by enforcing PDU
Session AMBR through the existing policy framework.**
# A.2 Shared PIN Session Model
With this model, the applications of the PEGC also can use the same PDU
Session that is used for relaying the PIN traffic as depicted in the Figure
A.2-1.
Figure A.2-1: Shared PIN Session Model
**With this model, a PDU Session can serve one PIN of PEGC.**
**Activation or deactivation of the PIN of PEGC does not require the PDU
Session Establishment procedures. The QoS control on PIN may be limited
without the PEGC engagement.**
# A.3 Dedicated PIN Session Model
**With this model, the applications of the UE do not share the same PDU
Session** that is used for relaying the PIN traffic **as depicted in the
Figure A.3-1.**
Figure A.3-1: Dedicated PIN Session Model
**With this model, one PDU Session is mapped to one PIN network and other
applications of the UE do not share the same PDU Session.**
**Activation or deactivation of the PIN of PEGC can involve the PDU Session
Establishment/Modification/Release procedure.**
#
# Foreword {#foreword-1}
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The Technical Report studies key issues, solutions and conclusions on the
support of advanced media services, e.g. High Data Rate Low Latency (HDRLL)
services, AR/VR/XR services, and tactile/multi-modality communication
services. The objectives include:
Enhancements for supporting multi-modality service:
\- Study whether and how to enable delivery of related tactile and multi-modal
data (e.g. audio, video and haptic data related to a specific time) with an
application to the user at a similar time, focusing on the need for policy
control enhancements (e.g. QoS policy coordination).
Enhancements of network exposure to support interaction between 5GS and
application:
\- Study whether and how interaction between AF and 5GS is needed for
application synchronization and QoS policy coordination among multiple UEs or
between multiple QoS flows per UE.
\- Study exposure of 5GS QoS information (e.g. QoS capabilities) and network
conditions to the Application to enable quick codec/rate adaptation help to
provide desired QoE (e.g. such as assist in alleviating 5GS congestion).
Study whether and how the following QoS and policy enhancements for XR service
and media service transmission are performed:
\- Study the traffic characteristics of media service enabling improved
network resources usage and QoE.
\- Enhance QoS framework to support PDU Set granularity (e.g. video/audio
frame/tile, Application Data Unit, control information), where a PDU Set
consists of PDUs that have the same QoS requirements.
\- Support differentiated QoS handling considering different importance of PDU
Sets. e.g. eligible drop packets belong to a less important PDU Set to reduce
the resource wasting.
\- Whether and how to support uplink-downlink transmission coordination to
meet RTT (Round-Trip Time) latency requirements between UE and N6 termination
point at the UPF.
\- Potential policy enhancements to minimize the jitter, focusing on i.e.
requirement provisioning from AF, extension of PCC rule.
Study potential enhancements of power management considering traffic pattern
of media services:
\- Power saving enhancement e.g. support trade-off of
throughput/latency/reliability considering device battery life, whether and
how to enhance CDRX, considering XR/media traffic pattern.
NOTE: Whether to define a network slice type supporting media services can be
determined during normative phase.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System (5GS); Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[5] 3GPP TS 22.261: \"Service requirements for the 5G system; Stage 1\".
[6] 3GPP TR 22.847: \"Study on supporting tactile and multi-modality
communication services; Stage 1\".
[7] IEEE SA P1918.1: \"Tactile Internet: Application Scenarios, Definitions
and Terminology, Architecture, Functions, and Technical Assumptions\",
[https://standards.ieee.org/project/1918_1.html]{.underline}.
[8] 3GPP TS 38.300: \"NR and NG-RAN Overall Description; Stage 2\".
[9] IETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\",
STD 64, July 2003.
[10] IETF RFC 3711: \"The Secure Real-time Transport Protocol (SRTP)\", March
2004.
[11] draft-ietf-avtext-framemarking: \"IETF experimental draft-ietf-avtext-
framemarking-13 - Frame Marking RTP Header Extension\".
[12] IETF RFC 6184: \"RTP Payload Format for H.264 Video\", May 2011.
[13] IETF RFC 6190: \"RTP Payload Format for Scalable Video Coding\", May
2011.
[14] IETF RFC 6437: \"IPv6 Flow Label Specification\", November 2011.
[15] IETF RFC 8285: A General Mechanism for RTP Header Extensions.
[16] 3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol
User Plane (GTPv1-U)\".
[17] 3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol
specification\".
[18] 3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP)
specification\".
[19] ITU-T Recommendation H.264: \"Advanced video coding for generic
audiovisual services\".
[20] IETF RFC 3551: \"RTP Profile for Audio and Video Conferences with Minimal
Control\", July 2003.
[21] IETF RFC 7798: \"RTP Payload Format for High Efficiency Video Coding
(HEVC)\", March 2016.
[22] ISO/IEC 14496-12 \| 15444-12: \"Information technology - Coding of audio-
visual objects - Part 12: ISO base media file format\".
[23] 3GPP TS 26.244: \"Transparent end-to-end packet switched streaming
service (PSS); 3GPP file format (3GP)\".
[24] 3GPP TS 38.415: \"NG-RAN; PDU Session User Plane Protocol\".
[25] IETF RFC 1889: \"RTP: A Transport Protocol for Real-Time Applications\",
January 1996.
[26] 3GPP TS 29.998: \"Open Services Architecture (OSA) Application
Programming Interface (API) part 2\".
[27] 3GPP TR 26.926: \"Traffic Models and Quality Evaluation Methods for Media
and XR Services in 5G Systems\".
[28] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia telephony;
Media handling and interaction\".
[29] IETF RFC 4566 (2006): \"SDP: Session Description Protocol\", M. Handley,
V. Jacobson and C. Perkins.
[30] IETF RFC 5888 (2010): \"The Session Description Protocol (SDP) Grouping
Framework\", G. Camarillo, H. Schulzrinne.
[31] IETF RFC 3261 (2002): \"SIP: Session Initiation Protocol\", J. Rosenberg
et al.
[32] 3GPP TS 29.513: \"5G System; Policy and Charging Control signalling flows
and QoS parameter mapping; Stage 3\".
[33] IETF RFC 3665: \"Session Initiation Protocol (SIP) Basic Call Flow
Examples\", A. Johnston et al.
[34] WebRTC TR: [https://www.w3.org/TR/webrtc/]{.underline}.
[35] IETF RFC 7272: \"Inter-Destination Media Synchronization (IDMS) Using the
RTP Control Protocol (RTCP)\".
[36] IETF RFC 8311: Relaxing Restrictions on Explicit Congestion Notification
(ECN) Experimentation.
[37] IETF Internet-draft - L4S: \"Low Latency, Low Loss, Scalable Throughput
(L4S) Internet Service: Architecture\", Briscoe et al, Nov 2020,
[https://datatracker.ietf.org/doc/draft-ietf-tsvwg-l4s-arch/]{.underline}.
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[38] IETF Internet draft: \"Explicit Congestion Notification (ECN) Protocol
for Ultra-Low Queuing Delay (L4S)\", Briscoe et. al, Internet draft, IETF, Mar
2021, [https://tools.ietf.org/wg/tsvwg/draft-ietf-tsvwg-
ecn-l4s-id/]{.underline}.
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[39] EU project RITE: \"Data Center to the Home\",
[https://riteproject.eu/dctth/]{.underline}.
[40] L4S: \"Linux Kernel tree containing patches for TCP Prague and the
dualpi2 qdisc\", [https://github.com/L4STeam/linux/]{.underline}.
[41] IETF RFC 2616: \"Hypertext Transfer Protocol -- HTTP/1.1\", June 1999.
[42] IETF RFC 7540: \"Hypertext Transfer Protocol Version 2 (HTTP/2)\", May
2015.
[43] IETF draft-ietf-quic-http-34: \"Hypertext Transfer Protocol Version 3
(HTTP/3)\", February 2021.
[44] IETF RFC 6994: \"Shared Use of Experimental TCP Options\", August 2013.
[45] IETF draft-ietf-tsvwg-udp-options-18: \"Transport Options for UDP\",
March 2022.
[46] ITU-T Recommendation H.265: \"High efficiency video coding\".
[47] ITU-T Recommendation H.266: \"Versatile video coding.
[48] draft-ietf-avtcore-rtp-vvc-14: \"RTP Payload Format for Versatile Video
Coding (VVC)\".
[49] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
Nodes; Stage 3\".
[50] IETF RFC 9000: \"QUIC: A UDP-Based Multiplexed and Secure Transport\".
[51] IETF RFC 9001: \"Using TLS to Secure QUIC\".
[52] IETF RFC 9002: \"QUIC Loss Detection and Congestion Control\".
[53] IETF RFC 9221: \"An Unreliable Datagram Extension to QUIC\".
[54] draft-ietf-masque-connect-udp: \"UDP Proxying Support for HTTP\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[55] draft-ietf-quic-http: \"Hypertext Transfer Protocol Version 3 (HTTP/3)\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[56] draft-ietf-masque-h3-datagram: \"Using Datagrams with HTTP\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[57] draft-ietf-httpbis-h3-websockets: \"Bootstrapping WebSockets with
HTTP/3\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[58] 3GPP TR 38.838: \"Study on XR (Extended Reality) evaluations for NR\".
[59] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services\".
[60] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\".
[61] 3GPP TS 23.548: \"5G System Enhancements for Edge Computing; Stage 2\".
[62] IETF Internet-draft-L4S: \"Explicit Congestion Notification (ECN)
Protocol for Very Low Queuing Delay (L4S)\" Briscoe et al, July 2022,
https://datatracker.ietf.org/doc/draft-ietf-tsvwg-ecn-l4s-id/.
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[63] IETF draft-gruessing-moq-requirements-02: \"Media over QUIC -- Use Cases
and Requirements for Media Transport Protocol Design\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[64] IETF draft-lcurley-warp-01: \"Warp -- Segmented Live Media Transport\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[65] draft-schinazi-masque-connect-udp-ecn-02: \"An ECN Extension to CONNECT-
UDP\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[66] 3GPP TS 29.514: \"5G System; Policy Authorization Service; Stage 3\".
[67] 3GPP TS 29.522: \"5G System; Network Exposure Function Northbound APIs;
Stage 3\".
[68] AOM: RTP Payload Format for AV1 (v1.0)
[https://aomediacodec.github.io/av1-spec/av1-spec.pdf]{.underline}.
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**PDU Set** : A PDU Set is composed of one or more PDUs carrying the payload
of one unit of information generated at the application level (e.g. a frame or
video slice for XRM Services, as used in TR 26.926 [27]). In some
implementations all PDUs in a PDU Set are needed by the application layer to
use the corresponding unit of information. In other implementations, the
application layer can still recover parts all or of the information unit, when
some PDUs are missing.
**Multi-modal Data** : Multi-modal Data is defined to describe the input data
from different kinds of devices/sensors or the output data to different kinds
of destinations (e.g. one or more UEs) required for the same task or
application. Multi-modal Data consists of more than one Single-modal Data, and
there is strong dependency among each Single-modal Data. Single-modal Data can
be seen as one type of data.
NOTE 1: This definition was taken from TR 22.847 [6].
**Tactile Internet:** A network (or network of networks) for remotely
accessing, perceiving, manipulating, or controlling real or virtual objects or
processes in perceived real time by humans or machines.
NOTE 2: This definition is based on IEEE SA P1918.1 [7].
**Data Burst:** A set of multiple PDUs generated and sent by the application
in a short period of time.
NOTE 3: A Data Burst can be composed by one or multiple PDU Sets.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
PSDB PDU-Set Delay Budget
PSER PDU-Set Error Rate
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
\ \
# 4 Architectural Assumptions and Requirements
## 4.1 Architectural Assumptions
\- The architecture, framework and the QoS model as specified in TS 23.501
[2], TS 23.502 [3], and TS 23.503 [4] are regarded as the baseline for this
study.
NOTE 1: The study focuses on using NR as access technology. Specific
enhancements to other access types are not required to be studied in this TR
(although not prohibited).
\- The functional split in 5GS between UE, RAN and CN remains unchanged, i.e.
packet classification of DL packets is performed in CN, and the packet
classification of UL packets is performed in UE.
\- XRM services are assumed to use the IP PDU session types (however other PDU
types are not excluded).
\- This study assumes that the UE may be able to use different PDU Sessions
for different XRM services. This study also assumes that the UE uses a single
PDU Session for a single XRM service i.e. all data traffic for this XRM
service is only carried over this PDU Session.
NOTE 2: The above assumption imposes no restriction on deployments.
\- XRM services shall be able to coexist within a PLMN or SNPN with existing
services simultaneously
\- XRM services can be between client-server (i.e. UE - application server)
and/or peer-to-peer (i.e. between two UEs routed via the 5G CN).
\- Architecture enhancements should support XRM applications and its traffic
characteristics. However, specific media codec mechanisms are not in the scope
of this study. Interested readers may check TR 26.926 [27] for related
mechanisms.
\- The traffic characteristics can vary for different media applications, and
application is aware of this.
\- XR and media application data may be encrypted by the client and/or server
in some cases and unencrypted in other cases.
NOTE 3: It is assumed that the some header information necessary for the
identification of PDUs is not encrypted.
\- For downlink traffic the 5GS may be able to determine whether 5GS may
discard or should not discard the remaining PDUs that follow a lost PDU of
that same PDU Set.
NOTE 4: How 5GS obtains the information needed to determine whether it can
discard or not the remaining PDUs that follow a lost PDU of that same PDU Set
is solution specific.
## 4.2 Architectural Requirements
The following architectural requirements are applicable to this study:
\- Solutions shall build on the 5G System architectural principles as in TS
23.501 [2], including:
\- flexibility and modularity for newly introduced functionalities.
\- existing methods for communicating the QoS profile (i.e. Standardized 5QI,
Operator Pre-configured 5QI, Dynamically Signalled QoS Profile).
\- Any enhancements for this study shall not impact Emergency Services and
other Priority Services (MPS, Mission Critical, etc) capabilities.
\- The existing specific 5GS services using existing QoS functions shall not
require enhancement to co-exist with any QoS enhancement being specified for
XRM services.
# 5 Key Issues
## 5.1 Key Issue #1: Policy control enhancements to support multi-modality
flows coordinated transmission for single UE
### 5.1.1 Description
This key issue studies how to support coordinated transmission for multi-
modality flows with a single UE (identified by SA WG1 TACMM in clauses 6.43
and 7.10 of TS 22.261 [5]). Some advanced XR or media services may include
multiple types of flows, e.g. video/audio stream, and haptic or sensor data
for more immersive experience (defined in clause 6.43.1 of TS 22.261 [5]).
The application client(s) of the different types of data of one application
may be located at one UE. In another case, there are multiple types of
devices, e.g. VR glasses, gloves and other devices that support haptic and/or
kinaesthetic modalities, and these devices connect through wireline to a
single UE that can access the 5GS.
The objective of this Key Issue is to study how to enhance 5GS to better
support the coordinated delivery of application traffic streams that are
related to each other and belong to a single UE. In particular, this key issue
will study:
\- Whether and how to enable, for a single UE, policy enhancements for
delivering related tactile and multi-modal data (e.g. audio, video and haptic
data related to a specific time) for an application to the user at a similar
time (e.g. QoS policy coordination).
\- Potential enhancements to policy control to support coordination handling
at the application.
\- Whether and how interaction between AF and 5GS is performed for application
synchronization and QoS policy coordination between multiple QoS flows of a
single UE.
## 5.2 Key Issue #2: Support the Application Synchronization and QoS Policy
Coordination for Multi-modal Traffic among Multiple UEs
### 5.2.1 Description
One of the requirements documented in TS 22.261 [5] about tactile and multi-
modal communication service, is the following:
The 5G system shall support the means to apply 3rd party provided policy(ies)
for flows associated with an application. The policy may contain e.g. the set
of UEs and data flows, the expected QoS handling and associated triggering
events, other coordination information. The policy can be used by a 3rd party
application for coordination of the transmission of multiple UEs\' flows (e.g.
haptic, audio and video) of a multi-modal communication session.
This key issue will study how to enable application synchronization and QoS
policy coordination for Multi-modal Data flows among multiple UEs.
In particular, this KI will study:
\- Whether and how to enable for multiple UEs the delivering related tactile
and multi-modal data (e.g. audio, video and haptic data related to a specific
time) with an application to the user at a similar time, focusing on the need
for policy control enhancements (e.g. QoS policy coordination).
\- Potential enhancements to policy control to support coordination handling
at the application.
\- Whether and how interaction between an AF and the 5GS is needed for QoS
policy coordination among multiple UEs.
## 5.3 Key Issue #3: 5GS information exposure for XR/media Enhancements
### 5.3.1 Description
The interaction between application and 5GS is needed to reduce latency,
reduce congestion and ensure desired experience for users.
The XR application server could adjust media codec/traffic rate to adapt to
network conditions and ensure desired experience for the user.
The QoS flow for XR/media services could be \'GBR\' and/or \'Non-GBR\'.
This Key Issue will study mechanisms that enable codec/rate adaptation to meet
requirements for services.
\- Study the use cases and whether enhancements to the exposure framework are
needed for such use cases;
\- What 5GS information needs to be exposed to enable application codec/rate
adaptation;
\- How to expose 5GS information for application codec/rate adaptation.
NOTE 1: Parameters for exposure may be coordinated with RAN and SA WG4.
NOTE 2: Potential overlap with enhancements done in FS_EDGE_Ph2/FS_UPEAS
should be considered.
## 5.4 Key Issue #4: PDU Set integrated packet handling
### 5.4.1 Description
In current 5GS, the QoS Flow is the finest granularity of QoS differentiation
in the PDU Session. The 5G QoS characteristics is determined by the 5QI. This
implies that each packet in a QoS flow is treated according to the same QoS
requirements.
For XR/media services, a group of packets are used to carry payloads of a PDU
Set (e.g. a frame, video slice/tile).
In media layer, packets in such a PDU Set are decoded/handled as a whole. For
example, the frame/video slice may only be decoded in case all or certain
amount of the packets carrying the frame/video slice are successfully
delivered. For example, a frame within a GOP (Group of Pictures) can only be
decoded by the client in case all frames on which that frame depends are
successfully received. Hence the groups of packets within the PDU Set have
inherent dependency on each other in media layer. Without considering such
dependencies between the packets within the PDU set, 5GS may perform a
scheduling with low efficiency. For example, the 5GS may randomly drop packet
(s) but try to deliver other packets of the same PDU set which are useless to
the client and thus waste radio resources.
Also audio samples, haptics applications or remote control operations may
benefit if the 5GS considers the PDU Set characteristics.
If such dependency between packets of a PDU Set (e.g. a frame/video slice) can
be considered, it\'s possible to enhance the efficiency and promote user
experience.
This key issue proposes to study PDU Set integrated packet handling in 5G
network, in which the group of packets belongs to a same PDU Set will be
handled in an integrated manner. The key issue includes the following aspects:
\- Which types of PDU Set (e.g. frame/video slice) shall be supported for PDU
Set integrated packet handling by 5G network.
NOTE 1: Coordination with SA WG4 is possibly needed.
\- What information should be provided to the 5GS regarding PDU Set for
integrated packet handling, and how such information should be provided.
\- How the 5GS identifies that a PDU belongs to a specific PDU Set.
NOTE 2: It is assumed that some header information necessary for the
identification of PDUs and it is assumed that the corresponding information is
not encrypted.
\- Whether and how to enhance the QoS model and policy control for PDU Set
integrated packet handling.
\- Whether and how to perform the PDU Set integrated packet handling in the
UE, RAN and/or UPF.
\- What information needs to be provided to the RAN and/or UPF to support PDU
Set integrated packet handling in both the downlink and uplink direction.
\- Whether and how to provide information to the UE for PDU Set integrated
packet handling.
NOTE 3: Coordination with RAN WGs may be needed.
## 5.5 Key Issue #5: Differentiated PDU Set Handling
### 5.5.1 Description
XR/media services are characterized by high data rate and low latency. In this
release, it is anticipated that the 5GS QoS framework will be enhanced to
support different QoS handling for PDU Set. PDU Sets can carry different
content, e.g. I/B/P frames, slices/tiles within an I/B/P frame, etc.
This key issue proposes to support differentiated QoS handling considering
different importance of PDU Sets e.g. by treating packets (i.e. PDUs)
belonging to less important PDU Set(s) differently to reduce the resource
wasting. The key issue includes the following aspects:
\- How does the 5GS identify the PDUs of one PDU Set.
\- How does the 5GS determine the importance information for a given PDU Set
and/or dependency information between different PDU Sets.
\- Which network entity needs the importance/dependency information associated
with the PDU Set and how it receives it.
\- Whether and how to enhance the QoS model and policy control for the
importance/dependency information associated with a given PDU Set.
\- Definition of the importance/dependency information enabling differentiated
PDU Set handling.
NOTE 1: RAN related aspects will be coordinated with RAN WGs.
NOTE 2: Aspects related to how PDU Sets may depend on each other will be
coordinated with SA WG4.
## 5.6 Key Issue #6: Uplink-downlink transmission coordination to meet Round-
Trip latency requirements
### 5.6.1 Description
In order to provide immersive experience for users, the XR/media services with
real-time interaction typically require very low Round-Trip latency.
Typically, during the Round-Trip transmission for XR/media traffic, the uplink
latency requirement and downlink latency requirement is unbalanced and
variable. Currently the 5GS can configure the separate PDBs for separate QoS
flows which can be used for uplink and downlink transmission respectively
based on the latency requirement for corresponding UL/DL traffic from AF as
specified in TS 23.503 [4]. But the challenge is how to meet the very low
Round-Trip latency requirement with the variable and unbalanced
uplink/downlink latency overhead. Since the AF lacks dynamic information of
the current UL/DL situation, it is difficult for AF to split the RTT
requirement into UL and DL delay requirements in an optimized way.
This key issue aims at addressing the following points for XRM:
\- Whether and how to support uplink-downlink transmission coordination to
meet Round-Trip latency requirements between UE and N6 termination point at
the UPF, including the following aspects:
\- Potential interaction between AF and 5GS for uplink-downlink transmission
coordination, e.g. RTT latency requirement;
\- Potential QoS enhancements for uplink-downlink transmission coordination,
with regard to the RTT latency requirement.
## 5.7 Key Issue #7: Policy enhancements for jitter minimization
### 5.7.1 Description
This key issue intends to study policy enhancements to minimize jitter for QoS
flows supporting XR and media services. XR and media services are mainly
targeting scenarios such as cloud gaming, cloud AR/VR applications. For XR and
media services, it is necessary to minimize jitter as jitter is one of the
factors that influence the user experience of XR/media services.
The following aspects need to be studied:
\- Potential policy enhancements to minimize the jitter, focusing on i.e.
requirement provisioning from AF, extension of PCC rule.
NOTE: Coordination with SA WG4 might be needed.
## 5.8 Key Issue #8: Enhancements to power savings for XR services
### 5.8.1 Description
The objective of this Key Issue is to study whether and how to improve power
management schemes like CDRX to achieve the best trade-off among key
performance indicators like latency and device battery lifetime.
Solutions for this Key Issue rely on the enhancements to power saving schemes
to support XR services studied during RAN1 SI on XR evaluation in Release 17
and under investigation in Release 18 and builds on top of those features.
For this Key Issue the following areas should be studied:
\- Which information (e.g. XR/media traffic characteristics, traffic pattern
and statistics), if any, is needed by the RAN from the CN and/or the UE to
enhance power management (i.e. CDRX). If needed, how such information is
collected.
NOTE: This Key issue requires collaboration with RAN WGs.
## 5.9 Key Issue #9: Trade-off of QoE and Power Saving Requirements
### 5.9.1 Description
The more efficient codec requires more power consumption and higher
reliability. Also, the higher throughput and lower latency budget also
requires more power consumption and more network resource. Hence, trade-off of
QoE and device power consumption needs to be considered.
This key issue aims at addressing the following points for XRM:
\- How to support trade-off of throughput/latency/reliability and power
consumption (e.g. device battery life).
NOTE: Coordination with RAN WGs may be needed for the above bullet.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
Solutions Key Issues
* * *
                                                                                                                  1   2            3   4   5   6   7   8   9
**#1:Tactile and multi-modality traffic flows coordination transmission for
one UE** X  
**#2: Group policy for Multi-modal Traffic among Multiple UEs** X  
**#3: Same PCF selection for Multiple UEs with XRM services** X  
**#4：QoS policy coordination for multiple UEs\' QoS flows** X  
**#5: Exposure of the UE data rate, normal data transmission interruption
event and congestion information** X  
**#6: Mean bit rate change report** X  
**#7: Identification and importance of packets in PDU set** X X  
**#8: Introduction of PDU Set information in RTP extension header and related
QoS parameters** X  
**#9: GTP extension header for PDU Set Sequence Number, and, Number of PDUs in
the PDU Set** X X  
**#10: different bearers for PDUs with different importance levels** X X  
**#11: Handling PDU Set within QoS flow** X X  
**#12: PDU Set integrated QoS handling** X  
**#13: DL data handling** X  
**#14: PDU Set integrated packet handling** X  
**#15: Leverage RTP layer info for PDU Set handling** X X  
**#16: RTP/SRTP based PDU Set identification** X X  
**#17: Sub QoS Flow based QoS and PCC Architecture** X X  
**#18: PDU Set Identification and Marking** X X  
**#19: Application-aware QoS** X X  
**#20: UPF based PDU Set identification** X  
**#21: PDU Set ID in the GTP-U header** X  
**#22: N6 tunnelling and GTP-U header extension for conveyance of PDU Set-
related information** X X  
**#23: PDU set related packet handling enhancements** X X  
**#24: Support differentiated QoS Handling for different PDU Sets** X  
**#25: PDU Set QoS Profile, QoS Flow parameters and QoS Characteristics** X X  
**#26: Provisioning XR traffic configuration to 5GS** X X  
**#27: RT latency split for two QoS flows used for UL and DL respectively** X  
**#28: RAN split RT latency for single QoS flow** X  
**#29: Two Way Delay Budget** X  
**#30: Policy enhancements to minimize jitter** X  
**#31: 5GS Policy enhancements to minimize the jitter** X  
**#32: Periodicity Jitter Control for XRM Service** X  
**#33: Support of CDRX enhancement for power saving handling** X  
**#34:5GC and UE Assistance to RAN for CDRX Optimization** X X **#35:
Provision of conditional QoS profile(s)** X **#36:Handling multiple QoS flows
of one UE together** X  
**#37: Policy coordination for multiple UEs in multiple PCFs** X  
**#38: Flow Association Using a Coordination Identifier** X X  
**#39: URSP enhancement for same PDU session selection of XRM service** X  
**#40: Application layer-based media synchronization** X X  
**#41: Use of ECN bits for L4S to enable codec/rate adaptation to meet
requirements for services** X  
**#42: Exposure of round-trip delay to support XR/media enhancements** X  
**#43: Information Exposure to AF for XR/media Enhancements** X  
**#44: XRM AF driven Quick QoS Notification Control** X  
**#45: Information Exposure to AF for XR/media Enhancements** X  
**#46: Use of ECN marking for L4S for scalable congestion control and meet
requirements for services** X  
**#47: Delay Difference and Delay Notifications and Reports** X  
**#48: Enhanced Notification of Rata Adaptation Request** X  
**#49: PDU set integrated handling for UPF/UE** X  
**#50: Relative QoS within a PDU Set** X X  
**#51: Handling of the PDU Set** X  
**#52: Consolidated Solution for PDU Set based QoS framework** X X  
**#53: PDU Set transmission coordination between RAN and UPF** X  
**#54: Identification and processing of PDU set by interworking between
Application and 5GS** X X  
**#55: PDU Set based services using MASQUE** X X  
**#56: PDU Set integrated packet handling with QoS differentiation** X X  
**#57: Negotiation of details of marking mechanisms for AS to UPF
communication** X X  
**#58: Support for application packet information for CDRX enhancements** X  
**#59: Assistance information needed for power savings in NG-RAN** X  
**#60: End of Burst Indication** X  
**#61: Policy Determination Considering UE Battery Level** X **#62: Policy
control and exposure for multi-modality services** X X  
**#63: Group QoS coordination and network interaction enhancement** X X  
**#64: NEF based coordination across multiple PCFs for multi-modal flow groups
with multiple UEs** X  
**#65: QoS enhancement to support the synchronized delivery of multiple QoS
flows** X X  
**#66: Multi-modality support** X X  
**#67: Supporting ECN mark for L4S in 5GS for XR/media Enhancements** X  
**#68: PDU set handling enhancements for different kinds of packets** X  
**#69: PDU set handling capability of RAN node** X X  
**#70: PDU Set with FEC Data** X X  
**#71: RT latency fulfilment based on UL/DL AQP Adaptation** X  
**#72: Improvements to jitter range assistance information to RAN for
configuring CDRX** X  
**#73: Notification to XR AF of CDRX parameters reflecting UE\'s CDRX
preference** X  
**#74: power mode based QoS adjustment** X **#75: QoS Enhancement to Support
Trade-off of QoE and Power Consumption** X
## 6.1 Solution #1: Tactile and multi-modality traffic flows coordination
transmission for one UE
### 6.1.1 Key Issue mapping
This solution is for Key Issue #1, which addresses following aspects:
\- Whether and how to enable, for a single UE, policy enhancements for
delivering related tactile and multi-modal data (e.g. audio, video and haptic
data related to a specific time) for an application to the user at a similar
time (e.g. QoS policy coordination).
\- Potential enhancements to policy control to support coordination handling
at the application.
\- Whether and how interaction between AF and 5GS is performed for application
synchronization and QoS policy coordination between multiple QoS flows of a
single UE.
The application servers for tactile and multi-modal data should be deployed in
one DNN, and these services should belong to one S-NSSAI. So in general, the
UE may establish one PDU session to transmit these tactile and multi-modal
flows.
This solution assumes that the application server in N6 side can send out the
multi-modality user plane traffic at the same time, so if we can keep the
delay difference value lower, the user can get the user plane traffic at the
same time.
### 6.1.2 Description
This solution proposes that AF can provide QoS and coordination transmission
requirement for tactile and multi-modal services to 5GS and PCF generates
related policies and SMF/UPF/RAN/UE implement such coordination policy.
Based on clauses 6.43 and 7.11 of TS 22.261 [5], there are two kinds of
coordination transmission requirement:
1) The delay difference between two flows should be less than some values e.g.
for immersive multi-modality VR applications, the synchronization threshold
for visual-tactile is less than 15ms (if the visual data is delayed compared
to the tactile) or less than 50ms (if the tactile is delayed compared to the
visual).
2) The typical delay requirement for specific flow, e.g. for immersive multi-
modal VR UL, the max allowed end-to-end latency for haptic data is 5ms.
The AF can provide individual Requested 5GS Delay for each Flow Description,
as well as the Requested 5GS Delay Difference for a couple of flows to the
NEF/PCF, by using the AF session with required QoS procedure as described in
clause 4.15.6.6, TS 23.502 [3]. The couple of flows which requiring delay
difference threshold should be indicated by AF.
During this AF provision, the AF should provide the coordinated service
requirement to the 5GS for the tactile and multi-modal flows. And the AF may
also provide Alternative QoS Parameter sets to PCF to help generate the
Alternative QoS rules when the flows are GBR.
NOTE: Coordinated service requirement can help PCF generate the coordinated
policy e.g. QoS parameters or QoS characteristics for the tactile and multi-
modal flows, and how the AF generates the coordinated service requirement for
different flows is depending on AF.
When the PCF authorizes the service information from the AF, it derives the
QoS parameters of the PCC rule based on the service information and the
individual QoS information received from the AF, which can be considered as
the coordinated policy rules. The Requested 5G Delay Difference can be added
in policy rule.
In order to guarantee the delay difference no larger than the delay difference
threshold, the PCF may trigger the QoS monitoring for the specific couple of
flows, in order to get the real-time end-to-end delays, and calculate the
delay difference. If the PCF finds the delay difference is larger than the AF
required delay difference threshold, the PCF may notify such information to AF
as well as the real-time delay values for the couple of flows.
If the AF requires that the 5GS should keep the delay difference less than the
threshold, the PCF may adjust the PCC rules for one or each of the couple of
flows e.g. using alternative QoS profile, or adjust QoS parameters e.g. using
a standardized 5QI with minimize the delay difference value,. For example:
\- For the flow with a larger delay, the PCF may use alternative QoS profile
with a lower E2E PDB or High Priority Level.
\- For the flow with a small delay, the PCF may use alternative QoS profile
with a larger E2E PDB or Low Priority Level.
### 6.1.3 Procedures
Figure 6.1.3-1: AF request to generate coordination policy for multiple flows
for one UE
1\. AF requests to generate the coordinate policy rules for the tactile and
multi-modal flows with providing coordinate service requirement. The procedure
in TS 23.502 4.15.6.6 can be reused to show the interaction between AF and
NEF/PCF. An additional parameter i.e. delays difference for specific couple of
flows are introduced as a QoS parameter.
2\. When AF knows the couple of flows related with the delay difference, are
transmitted in the 5GS, AF may trigger the PCF to implement the QoS monitoring
for each flow and PCF can get the real delay, and then calculate the delay
difference.
3\. [Optional] PCF sends the QoS monitoring result and delay difference to AF
4\. PCF decides to trigger the PCC rule adjustment for the couple of flows, by
using a standardized 5QI with minimize the delay difference value or by using
the alternative QoS profile.
5\. [Optional] when the delay difference is less than the AF required delay
difference threshold, PCF sends the QoS monitoring result and delay difference
to AF.
### 6.1.4 Impacts on services, entities and interfaces
PCF:
\- A new QoS parameter for Delay difference between couple of flows.
\- Capability enhancement to adjust the related QoS policies to minimize the
Delay difference.
## 6\. 2 Solution #2:Group policy for Multi-modal Traffic among Multiple UEs
### 6.2.1 Key Issue mapping
This solution addresses KI#2: Support the Application Synchronization and QoS
Policy Coordination for Multi-modal Traffic among Multiple UEs.
### 6.2.2 Description
This solution assumes the following:
It is assumed that the policy of each AF session is coordinated at 3GPP level.
It is assumed that the group policy is already available to the related PCFs,
e.g. based on mechanism described in clause 6.3.7.2 of TS 23.501 [2],with
providing policy requirements that apply to multiple UE and hence to multiple
PCF. When the AF session for a UE decides to update its policy, it provides
the new policy requirement to the PCF serving the UE AF session, and the PCF
may determine a new policy for the UE based on the updated policy requirement.
It is assumed that the PCF may receive a new policy requirement for another UE
in the group from another PCF. If there is related group policy available, the
PCF determines a policy for the UE based on the received policy requirement of
another UE.
The proposed solution highlights when PCF receives policy requirements of
multiple UEs from multiple sources, e.g. AF and other PCFs, at the same time
or within a short time period, the PCF determines a group policy fulfilling
all the requirements. If no group policy fulfilling all the policy
requirements exists, the PCF determines a policy matching the requirements as
much as possible or based on the priority of each UE or priority of the group
policy.
Editor\'s note: The details if multiple PCF instance selected from one PCF set
for the PDU session related to XRM services of the group UEs is FFS.
A group policy is predefined at application level for the group of UEs. Each
Policy is associated with a priority. This policy is then provided to one or
multiple PCF(s) in the 3GPP network.
When a PCF receives multiple service requests including information related to
a policy request, e.g. QoS request, from the AF and PCF(s), it generates the
policy for the UE, based on the following principles:
\- Group Policy is determined if all the policy requests are fulfilled.
\- If none of the group policy can fulfil all the policy requests, the group
policy with highest priority among those group policies that can be determined
by one or multiple policy requests is determined; and the group policy matched
to the policy request targeting to the UE with highest priority is determined.
### 6.2.3 Procedures
The following figure represents a high-level procedure of the solution.
Figure 6.2.3-1: A high-level procedure of the solution
Group policy is provisioned to the PCFs serving the group of UE(s) of XRM
service. The PCFs serving the group of UE(s) of XRM service subscribed to be
notified that QoS policy requirements of XRM service is received.
Editor\'s note: The detailed mechanisms of Group policy determination and
provision are FFS.
1-3. Step 1-3 according to step 1-3 of clause 4.15.6.6 of TS 23.502 [3].
PCF1 determines the QoS policy for UE1 based on the service request and the
group policy received at step 0.
PCF2 determines the QoS policy for UE2 based on the service request and the
group policy received at step 0.
If step 4b happens after step 5a or step 4a happens after step 5b, the PCF has
to consider the input from another PCF for the policy determination. The
following applies:
\- Group Policy is determined if all the policy requests are fulfilled.
\- If none of the group policy can fulfil all the policy requests, the group
policy with highest priority among those group policies that can be determined
by one or multiple policy requests is determined; and the group policy matched
to the policy request targeting to the UE with highest priority is determined.
PCF1 invokes Npcf_PolocyAuthorization_Notify service operation to PCF2 to
provide:
\- QoS policy request of UE1 received at step 3; or
\- QoS policy request of UE2 generated at step 4.
PCF2 invokes Npcf_PolocyAuthorization_Notifyservice operation to PCF1 to
provide:
\- QoS policy request of UE2 received at step 3; or
\- QoS policy request of UE1 generated at step 4.
This step is skipped if the same PCF selected for the group of UEs.
PCF responds Npcf_PolocyAuthorization_Notify.
[Conditional]PCF determines the QoS policy for the serving UE based on the
policy information received at step 5. This step is skipped, if step 4b
happens after step 5a or step 4a happens after step 5b.
PCF initiates the policy association modification procedure.
9-12. Step 9-12 follow steps 4-8 in clause 4.15.6.6 of TS 23.502 [3].
### 6.2.4 Impacts on services, entities and interfaces
UDR/UDM:
\- Distributing/providing the predefined group policy at application level for
the group of UEs.
PCF:
Apply/enforce the XRM services and multimodal Data related group policy on the
group of UEs.
## 6.3 Solution #3: Same PCF selection for Multiple UEs with XRM services
### 6.3.1 Key Issue mapping
This solution addresses KI#2: Support the Application Synchronization and QoS
Policy Coordination for Multi-modal Traffic among Multiple UEs.
### 6.3.2 Description
This solution assumes the following:
It is assumed that the policy of each AF session is coordinated at 3GPP level.
It is assumed that a group of UEs collaborate to the policy related to XRM
services and multimodal Data. The policy authorized to the AF session of each
UE in the group may be adjusted due to the policy change of another UE in the
same group.
A UE group is identified by Internal Group Identifier, which is stored in the
UDM as the UE subscription data, as described in TS 23.501 [2], TS 23.502 [3]
and TS 23.503 [4].
The proposed solution highlights the same PCF is selected for the PDU session
related to XRM services of the group UEs. To enable same PCF selected for the
group of UEs for policy coordination for a specific service application,
Internal Group Id is considered in addition to other factors in the PCF
selection mechanism.
Editor\'s note: Whether it is feasible that the same PCF selected for the PDU
session related to XRM services of the group UEs.
The group of UEs subscribed to a service requiring group policy coordination,
which is indicated in the UDR as the policy data, including Internal Group ID
and Priority Level:
\- Internal Group ID, Indicates the internal group ID of the UE.
\- Priority Level, Indicates the priority level of the UE in the group.
Indication on when there are conflicts among the policy requirements received
for different UEs in the group.
### 6.3.3 Procedures
The following figure represents a high-level procedure of the solution that
same PCF selected for XRM service during SM Policy Association Establishment.
Figure 6.3.3-1: SM Policy Association Establishment from TS 23.502 [3] with
same PCF selected for XRM service
In step 1: The SMF requests to establish an SM Policy Association with the
same PCF selected for the PDU session related to XRM services of the group
UEs, with considering the Internal Group Id in addition to other factors in
the PCF selection mechanism, if already existing PCF serving the XRM service
of the group UEs.
In step 2: If the PCF sends a request to the UDR for the information related
to the PDU Session, the Internal Group ID and Priority Level as the policy
data of XRM service may be provided by UDR, which can be used for the group
policy coordination.
In step 4: The PCF makes the authorization and the policy decision with
considering the policy data of XRM service.
Editor\'s note: How to realize the coordination policy when the same PCF
selected is FFS.
The PCF may invoke Nbsf_Management_Register service operation to create the
binding information in BSF. If the PCF has received one or a list of group
policy for the UE group, or the PCF retrieves from the UDR that some service
requiring group policy coordination is subscribed (e.g. XRM service or multi-
modal Data service), the PCF checks whether the BSF has already existing PCF
serving the combination of SUPI, S-NSSAI, DNN and Internal Group ID or not.
The following applies:
\- If no such PCF is found, the PCF shall register itself to the BSF and
provides Internal Group ID in addition to other binding information (i.e.
SUPI, S-NSSAI, DNN and PCF ID) to indicate that the same PCF has to be
selected for the same group of UE for the [S-NSSAI, DNN].
\- If existing PCF is found for the above combination:
\- When the existing PCF is the same as the selected PCF, the PCF shall
register itself to the BSF and provides Internal Group ID in addition to other
binding information (i.e. SUPI, S-NSSAI, DNN and PCF ID) to indicate that the
same PCF has to be selected for the same group of UE for the [S-NSSAI, DNN].
\- Otherwise, the PCF shall return to the SMF the available information about
the existing PCF with a redirection indication.
If a redirection indication and the PCF ID received, the SMF reselect the PCF
based on the PCF ID received from the BSF.
In step 5: The PCF answers with a Npcf_SMPolicyControl_Create response; in its
response the PCF provide policy information considering the QoS coordination
of XRM serviced. The SMF enforces the decision. The SMF implicitly subscribes
to changes in the policy decisions.
### 6.3.4 Impacts on services, entities and interfaces
UDR/UDM:
\- Storing the predefined group policy (e.g. policy data including Internal
Group ID and Priority Level) as the UE subscription data.
BSF:
\- The BSF has the Internal Group ID characteristics. When the PCF register
itself to the BSF and provides Internal Group ID in addition to other binding
information (i.e. SUPI, S-NSSAI, DNN and PCF ID) to indicate that the same PCF
has to be selected for the same group of UE for the [S-NSSAI, DNN].
PCF:
\- Apply/enforce the XRM services and multimodal Data related group policy on
the group of UEs.
## 6.4 Solution #4: QoS policy coordination for multiple UEs\' QoS flows
### 6.4.1 Key Issue mapping
This solution solves the Key Issues 2 of QoS policy coordination for multiple
UEs\' QoS flows.
### 6.4.2 Description
Figure 6.4.1-1: Definition of multi-modal session/traffic/flow and Multi-modal
data flow group
In the scenarios of multi-modal communication service to multiple UEs,
different UEs are served by the different PCFs individually. Each PCFs
generate the QoS policy to each multi-modal data flow for different UEs. How
to guarantee each of the multi-modal data flow has the same QoS policy is FFS.
This solution addresses scenarios that how multiple PCF support to coordinate
the QoS policy of multiple UEs\' flows (e.g. haptic, audio and video) of a
multi-modal communication session. And this solution focuses on the situation
of AF and PCF uses the same BSF for multi-modal QoS flow.
The following definition will be used in the procedures:
\- Multi-modal data flows group: it contains the multi-modal data flows of an
application targeting to different UEs.
The solution is based on the existing AFsessionWithQoS with the following
enhancement:
\- The AF provides the QoS establishment request of multi-modal data flow
towards multiple UEs in one AF request.
\- The PCF updates the multi-modal data flow information to BSF.
\- The BSF stores and updates the information of multi-modal data flows group,
including corresponding PCF IP address, UE IP address, etc.
\- The PCF discovers the other PCFs in BSF that responsible for generation the
QoS policy for multi-modal data flow which belongs to the same multi-modal
data flows group.
\- Different PCFs which responsible for generation the QoS policy for multi-
modal data flow in the same group subscribes the QoS policy each other, to
coordinate the QoS policy.
### 6.4.3 Procedures
#### 6.4.3.1 Procedures of AF session With QoS establishment for multi-modal
QoS flow
Detail procedures are provided in the below Figure 6.4.3.1-1.
Figure 6.4.3.1-1: Procedures of Policy Coordination between different PCFs
1\. AF decides to establish multi-modal data traffic to different UEs.
2\. AF sends a Nnef_AFsessionWithQoS_Create/Update request message to NEF for
establishing or update the reserved resources, to provide a specific QoS for
the multi-modal data flow.
AF provides a group of QoS reference or flow descriptions of each multi-modal
data flows to different UEs, which of these multi-modal data flows belongs to
the same group.
AF provides the following information below:
\- a group of (Flow description(s), QoS reference, UE address).
\- Multi-modal service provider ID: The identifier of the multi-modal service
Provider.
\- Multi-modal data flows group ID: it contains the multi-modal data flows of
an application to targeting to different UEs.
3\. The NEF authorizes the AF request, if the authorization is not granted,
all steps (except step 10) are skipped and the NEF replies to the AF with a
Result value indicating that the authorization failed.
4\. According to the multiple UEs IP address are contained in AF request for
multi-modal data flow, the NEF triggers the Nbsf_Management discovery
procedure towards BSF, to discovers the PCF and PCF set selected for the UE.
The step 4 and step 5 can be triggered for multiple times according to the
number of UE IP address in AF request in step 2.
NOTE 1: The NEF triggers the BSF discovery twice with the UE 1 IP address and
UE 2 IP address respectively. Based on the NRF response in which contains the
available lists of BSFs, the NEF decides the available BSF that can serve both
of the UE 1 and UE 2. After that, the NEF can provide the BSF IP address
towards the PCF 1 and PCF 2 in step 6 or step 8, that help the both PCFs to
determine to use the same BSF as AF.
5\. The BSF provide the PCF address(es), PCF instance ID which related to each
UE respectively to NEF. For the multi-modal scenarios to multiple UEs, the
discovered PCF IP address or instance ID for each UEs may not be the same.
6\. According to the PCF IP address and instance ID received from BSF of each
UEs, the NEF triggers Npcf_PolicyAuthorization_Create to PCF authorize the AF
request and to create QoS policy as requested by the authorized AF.
According to the different UEs to be established for the multi-modal data
flows in the same group, the NEF triggers multiple policy authorization
towards different PCFs for multiple times of the same AF request.
7\. The PCF responses with Success or Failure of the authorization.
8\. The same as step 6, while the NEF triggers the Policy Authorization
procedure to a different PCF compared to step 6 for another UEs in AF request.
9\. The same as step 7.
10\. The NEF sends a Nnef_AFsessionWithQoS_Create response message
(Transaction Reference ID, Result) to the AF. Result indicates whether the
request is granted or not.
11\. The PCFs which is responsible for generation QoS policy for different UEs
individually generate the QoS policy to each multi-modal data flows. But for
now, these PCFs don\'t get each IP address, and the PCC rules are not
coordinated with each other.
12\. The PCF 1 triggers a Nbsf_Management_Update request to BSF to update the
multi-modal information. In the Nbsf_Management_Update request, the PCF 1
updates the multi-modal information that the PCF 1 responsible for, including:
\- Multi-modal data flows group ID: which identifies the unique multi-modal
data flows group.
\- Multiple modal service provider: The identifier of the multi-modal service
Provider.
NOTE 2: Before PCF performs step 12, the PCF can receive the BSF IP address
from NEF. The PCF still performs the BSF discovery from NRF, and receives the
list of potential BSFs. If the BSF indicated by NEF exists in the list of
potential BSFs received from NRF, the PCF selects this BSF.
13\. The BSF sends response to PCF 1 to successfully receive the multi-modal
information.
14\. The same as step 12, but for another PCF 2. And the PCF 2 is responsible
for the different multi-modal data flow, but this flow also belongs to the
same multi-modal data flows group.
15\. The same as step 13.
16\. According the uploaded information from different PCF (PCF 1 or PCF 2) of
the multi-modal information, the BSF can establish a multi-modal profile for
each multi-modal data flows group. In the multi-modal profile, all of the
multi-modal data flows which belongs to the same multi-modal data flows group
related information can be discovered.
Table 6.4.3-1: Multi-modal profile of a multi-modal data flows group
+---------------------------------------+---------------------------+ | Multiple modal profile | | +=======================================+===========================+ | Multi-modal data flows group ID = XXX | | | | | | Multi-modal service provider ID = ABC | | +---------------------------------------+---------------------------+ | UE 1 related: | UE 2 related: | | | | | - PCF IP address; PCF ID | - PCF IP address; PCF ID | | | | | - UE IP address; UE ID | - UE IP address; UE ID | +---------------------------------------+---------------------------+
17\. The PCF 1 can discover other related PCF 2 which belongs to the same
multi-modal data flows group in BSF, according to the multi-modal profile of a
multi-modal data flows group. Both PCF1 and PCF2 are is responsible for the
QoS policy generation of multi-modal data flow.
The PCF 1 triggers Nbsf_Management_Discovery request (Multi-modal data flows
group ID and Multi-modal service provider) towards BSF to discover the PCF 2.
18\. In the Nbsf_Management_Discovery response, the BSF provides the other
related multi-modal information to PCF 1, including PCF 2 IP address, PCF 2
instance ID, UE 2 IP address and UE ID. The PCF 2 IP address provided in
response, is related to the other multi-modal data flows in the same multi-
modal data flows group.
The PCF 2 can also triggers the step 17 to step 18.
19\. The PCF 1 has already discovered the other PCFs (e.g.: PCF 2) that
responsible for the QoS generation of multi-modal data flows which belongs to
the same group.
In this step, the PCF 1 subscribe to other PCFs by
Npcf_PolicyAuthorization_Subscribe(QoS policy for multi-modal data flow, UE IP
2 address, Multi-modal data flows group ID and Multi-modal service provider)
to explicitly subscribe the notification of events (QoS policy for multi-modal
data flow), to coordinate the PCC rules for the same multi-modal business.
The PCF 2 can also triggers the step 19 towards PCF 1.
20\. The PCF 2 replies the authorization response. When the subscription is
accepted: Subscription Correlation ID.
21\. The PCF 2 notifies PCF 1 of the subscribed QoS policy for multi-modal
data flow in the same group. PCF 2 sends
Npcf_PolicyAuthorization_Notify(updated QoS policy for multi-modal data flow
in the same group) to PCF 1.
NOTE 1: The existing defined QoS policy for data flow in 3GPP can be reused.
22\. According to the subscription between PCFs, the QoS policy of each multi-
modal data flows can be coordinated. The PCF 1 and PCF 2 can both adjust the
QoS policy for each UEs and each multi-modal data flows which belongs to the
same multi-modal business group.
NOTE 2: The coordinated QoS policy parameters can be referred to clause 6.3.1
of TS 23.503 [4]. The PCF can also indicate the details of QoS policy
parameters, for example, the MDBV or MBR to other PCF for coordination.
23\. The PCF 1 subscribes the multi-modal profiles stored in BSF by
Nbsf_Management_Subscribe (Multi-modal data flows group ID and Multi-modal
service provider).
For the situation that when UE 2 move out of the area and doesn\'t continue
the multi-modal data flow any more, the BSF should update the multi-modal
profiles and remove the UE 2 related information. The PCF 1 can subscribe the
status of multi-modal profile in BSF.
24\. The BSF sends Nbsf_Management_Subscribe response to PCF 1. When the
subscription is accepted: Subscription Correlation ID.
25\. When the multi-modal profile of a multi-modal data flow group is
modified/updated, the BSF sends the Nbsf_Management_Notify (new UE IP address,
new UE ID, new PCF address(es), new PCF instance ID, Multi-modal data flows
group ID and Multi-modal service provider) to PCF 1.
\- When the related UE 2 in multi-modal data flow group move out of the
location and doesn\'t continue the multi-modal data flow any more, the BSF
should remove the UE 2 related information in multi-modal profile.
\- When another related UE 3 join in the multi-modal data flow group to
establish multi-modal data flow, the BSF should add the related information in
multi-modal profile, such as new UE IP address, new UE ID, new PCF
address(es), new PCF instance ID.
26\. The same procedure of step 4 to step 5 as defined in Figure 4.16.5.2-1 of
TS 23.502 [3] or step 5 as defined in Figure 4.16.5.1-1 of TS 23.502 [3]. The
PCF 1 initiates the SM Policy Association Modification or Establishment.
27\. The same procedure of step 4 to step 5 as defined in Figure 4.16.5.2-1 of
TS 23.502 [3] or step 5 as defined in Figure 4.16.5.1-1 of TS 23.502 [3]. The
PCF 2 initiates the SM Policy Association Modification or Establishment.
#### 6.4.3.2 Procedures of AF session With QoS revoke for multi-modal QoS flow
Figure 6.4.3.2-1: Procedures of AF session With QoS establishment for multi-
modal QoS flow
1\. AF decides to stop the multi-modal data traffic to a UE. In this solution,
use UE 1 as example. The AF decides the UE 1 doesn\'t belong to the Multi-
modal data flows group ID any more.
2\. AF sends a Nnef_AFsessionWithQoS_Revoke request message to NEF for remove
the reserved resources, to provide a specific QoS for the multi-modal data
flow.
3\. The NEF authorizes the AF request, if the authorization is not granted,
all steps are skipped and the NEF replies to the AF with a Result value
indicating that the authorization failed. Due to the related PCF has already
been discovered in the establishment step, so the AF triggers the PCF
discovery.
4\. The NEF triggers the Npcf_PolicyAuthorization_Delete to PCF 1 to delete
the QoS policy for the multi-modal business.
5\. The PCF 1 responses with Success or Failure of the delete request.
6\. The NEF sends a Nnef_AFsessionWithQoS_Delete response message (Transaction
Reference ID, Result) to the AF. Result indicates whether the delete request
is granted or not.
7\. The PCF 1 removes the PCC rules related to this UE 1 and multi-modal
business according to UE 1 IP address, Multi-modal service provider ID and
Multi-modal data flows group ID.
8\. The PCF 1 requests the BSF to remove the binding information for a PDU
Session or for a UE, if all the related AF sessions of the Multi-modal service
released. Also, the multi-modal information in BSF should be removed.
9\. The BSF responses to PCF 1 with the result indication.
10\. According to the PCF 1\'s request, the BSF can remove the multi-modal
profile for the UE 1\'s in multi-modal data flows group. After the information
removing, the other multi-modal data flows which belongs to the UE 2 doesn\'t
be impacted.
Table 6.4.3.2-1: Multi-modal profile of a multi-modal data flows group after
removing
+---------------------------------------+---------------------------+ | Multiple modal profile | | +=======================================+===========================+ | Multi-modal data flows group ID = XXX | | | | | | Multi-modal service provider ID = ABC | | +---------------------------------------+---------------------------+ | | UE 2 related: | | | | | | - PCF IP address; PCF ID | | | | | | - UE IP address; UE ID | +---------------------------------------+---------------------------+
11\. The PCF 1 unsubscribes to other PCFs by
Npcf_PolicyAuthorization_Unsubscribe to stop the PCC rules coordination for
the same Multi-modal service, if no any UEs of the Multi-modal service have
multi-modal data flows coordinated by PCF1.
12\. The PCF 2 response with the PCF 1 for the unsubscribe request.
### 6.4.4 Impacts on services, entities and interfaces
BSF:
\- Acquire the multi-modal information from each PCF, and generation a multi-
modal profile for each multi-modal data flows group.
\- Maintenance the multi-modal profile and notify the changes of profile to
PCF.
PCF:
\- Update the multi-modal information to BSF.
\- Subscribes the status of QoS policy in other PCFs for the same multi-modal
service.
\- Subscribes the status of multi-modal profile in BSF, and receive other PCF
IP address or UE IP address which other multi-modal data flows related to.
\- Determine the BSF according to the discovery from NRF and indicated by NEF.
AF:
\- Request for two or more AF sessions towards two or more UEs in one AF
request.
NEF:
\- Determine to use the same BSF according to the potential BSF IP address
response by NRF. And provide the BSF IP address to PCFs that serve the UEs for
multi-modal QoS flow.
## 6.5 Solution #5: Exposure of the UE data rate, normal data transmission
interruption event and congestion information
### 6.5.1 Key Issue mapping
The solution applies to Key Issue #3 5GS information exposure for XR/media
Enhancements.
### 6.5.2 Description
The useful information to enable application codec/rate adaptation
\
In general, the data throughput will impact server transmission data rate, and
additionally may impact the coding efficiency. The more efficient decoding
means the less data throughput but the more power consumption. Hence, the data
transmission rate can help the server to do the decision more efficient. The
server has supported monitoring the E2E service data rate, but it is still
beneficial to report the UE data rate in 5GS link, since it can help the
server to judge the bottle neck is in 5GS or the other transport network
between the server and the client.
\
Additionally, due to UE mobility, the UE handover/redirection may cause the
data transmission interrupt for a while, i.e. the data rate=0 event. After the
handover/redirection finished, the data rate will be resumed. For this event,
it is not necessary for the server to decrease its service data throughput or
increase the decoding efficiency. Otherwise, as the log figure shown, T1 is
the start time of UE handover/redirection, T2 is the end time of
handover/redirection, during the period between T2 and T3, there is no data
transmission. The reason is Application server stop the service data
transmission when it monitors the link data rate decreases to 0. Actually, the
server doesn\'t need to stop the data transmission, since it is the normal
data transmission interruption and will recover soon.
Figure 6.5.2-1: Log for UE redirection procedure
\
The congestion information could reflect the degree of RAN congestion and
performance of the NG-RAN for the service. This information could be obtained
by the NG-RAN. It could help the application server to take certain actions,
e.g. adjust the codec method, timely to better fit the network conditions.
NOTE: The definition of congestion needs coordination with RAN WGs.
Hence, exposure of the UE data rate for the XRM and the normal data
transmission interruption event, and the congestion information is beneficial
for the server to adjust its codec and data throughput.
At release#17, the UPF has already supported to exposure the UE data rate for
a QoS flow granularity but the procedure is not defined. The solution proposes
to allocate QoS monitoring rule for the UPF to measure and report the data
rate for a QoS flow.
The normal data transmission interruption is due to UE handover, redirection.
In general, during UE handover/redirection procedure, the data transmission is
interrupted. But when UE and RAN support DAPS handover as defined in TS 38.300
[8], the data transmission is not interrupted. Furthermore, intra RAN
handover/redirection is transparent to the CN. Hence, only the NG RAN can
suitable detect the normal data transmission interruption event.
The solution is based on the existing Network Exposure functionality with the
following enhancement:
\- The AF subscribes the data rate for the service flow, the normal data
transmission interruption event of the UE, and the congestion information.
\- The PCF generates the QoS monitoring policies for the data rate
measurement, the normal data transmission interruption event measurement, the
congestion information measurement.
\- The SMF generates the QoS Monitoring configuration for UPF: data rate
measurement indication, data rate measure frequency, date rate report
threshold.
\- The SMF generates the QoS Monitoring configuration for RAN: normal data
transmission interruption event measurement indication, congestion information
measurement indication.
\- The UPF enables the data rate measurement and report the measured data
rate. The UPF also detects and reports the normal data transmission
interruption and the congestion information.
\- The RAN reports the congestion information and the normal data transmission
interruption event ( i.e. the data transmission interruption due to handover
or redirection) to the UPF.
### 6.5.3 Procedures
#### 6.5.3.1 Procedure for subscribing information
Figure 6.5.3.1-1: Subscribing Normal Data Transmission Interruption event and
Date Rate
1\. The AF subscribes the data rate for the service flow, the normal data
transmission interruption event of the UE, the congestion information by
sending Nnef_EventExposure_Subscribe request (UE address, flow description(s),
event ID(s)).
2\. The NEF authorizes the AF request.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Subscribe request to subscribe the data rate for the
service flow, the normal data transmission interruption event of the UE and
the congestion information.
4\. Upon reception of the subscribe request of the data rate for the service
flow, the PCF generates a QoS monitoring policy for the data rate measurement.
Upon reception of the subscribe request of the normal data transmission
interruption event of the UE, the PCF generates a QoS monitoring policy for
the normal data transmission interruption event measurement.
Upon reception of the subscribe request of the congestion information, the PCF
generates a QoS monitoring policy for the congestion information measurement.
The QoS monitoring policy for data rate measurement includes data rate
measurement indication, data rate measure frequency, date rate report
threshold. The date rate report threshold may include: data rate =0, data rate
reaches a data rate scope, e.g. [X, Y].
The QoS monitoring policies for the normal data transmission interruption
event and the congestion information measurement includes normal data
transmission interruption event measurement indication,
5\. The PCF responds to the NEF a Npcf_Policy Authorization_Create response.
6\. The NEF sends a Nnef_AFsessionWithQoS_Create response message to the AF.
7\. The PCF initiates SM Policy Association Modification Request (PCC rule
(QoS monitoring policy)) to the SMF.
Based on the QoS monitoring policy for data rate measurement from the PCF, the
SMF generates the QoS Monitoring configuration for UPF: data rate measurement
indication, data rate measure frequency, date rate report threshold.
Based on the QoS monitoring policy for normal data transmission interruption
event measurement from the PCF, the SMF generates the QoS Monitoring
configuration for RAN: normal data transmission interruption event measurement
indication, congestion information measurement indication.
8\. The SMF replies SM Policy Association Modification Response to the PCF.
9\. The SMF initiates N4 Session Modification Request (QoS Monitoring
configuration) to the UPF.
NOTE: This allows the UL packets with the QFI of a new or modified QoS Flow to
be transferred.
Upon reception of QoS Monitoring configuration, the UPF enables the data rate
measurement and report.
10\. The UPF(s) respond to the SMF.
11\. For SMF requested modification, the SMF invokes
Namf_Communication_N1N2MessageTransfer ([N2 SM information] (PDU Session ID,
QFI(s), QoS Profile(s), QoS Monitoring configuration), N1 SM container)).
12\. The AMF may send N2 ([N2 SM information received from SMF], NAS message
(PDU Session ID, N1 SM container (PDU Session Modification Command))) Message
to the (R)AN.
Upon reception of QoS Monitoring configuration, the RAN enables the normal
data transmission interruption event measurement, congestion information
measurement and report. When UE handover or redirection happens and causes
data transmission interruption, the NG RAN reports the normal data
transmission interruption event.
14\. The (R)AN may acknowledge N2 PDU Session Request by sending a N2 PDU
Session Ack Message to the AMF.
15-16. The AMF forwards the N2 SM information and the User location
Information received from the AN to the SMF via
Nsmf_PDUSession_UpdateSMContext service operation. The SMF replies with a
Nsmf_PDUSession_UpdateSMContext Response.
17-18. The SMF may update N4 session of the UPF(s) that are involved by the
PDU Session Modification by sending N4 Session Modification Request message to
the UPF.
#### 6.5.3.2 Procedure for notify of information via user plane
Figure 6.5.3.2-1: Normal Data Transmission Interruption event, congestion
information and measured Date Rate
1a&2\. When the Normal Data Transmission Interruption event or congestion
situation happens, the NG RAN indicates the event or congestion information in
the header of the UL data. If there is not UL data, RAN creates some UL dummy
packets for reporting, as the existing QoS monitoring mechanism in TS 23.501
[2]. Upon detection of the Normal Data Transmission Interruption event from
the UL data, the UPF triggers the Nupf_EventExposure_Notify message to report
the event.
1b. When the data rate reaches the data rate report threshold, the UPF
triggers the Nupf_EventExposure_Notify message to report the measured data
rate.
3a. The UPF sends a Nupf_EventExposure_Notify message (measured data rate,
Normal Data Transmission Interruption event, congestion information) to the
NEF.
3b. The UPF sends a Nupf_EventExposure_Notify message (measured data rate,
Normal Data Transmission Interruption event, congestion information) to the AF
when the AF is trusted.
4\. The NEF sends a Nnef_Nnef_EventExposure_Notify (measured data rate, Normal
Data Transmission Interruption event, congestion information) message to the
AF.
#### 6.5.3.3 Procedure for notify of information via control plane
Figure 6.5.3.3-1: Normal Data Transmission Interruption event , congestion
information and/or measured Date Rate
1a. When the Normal Data Transmission Interruption event or congestion
situation happens, the NG RAN indicates the event or congestion information to
the AMF via notification control in the NG message. The AMF forwards the event
or congestion information to the SMF via the Nsmf_PDUSession_UpdateSMContext.
1b. When the data rate reaches the data rate report threshold, the UPF
triggers the N4 Session Update message to report the measured data rate.
3\. The SMF sends a Npcf_SMPolicyControl_Update message (measured data rate,
Normal Data Transmission Interruption event, congestion information) to the
PCF.
4\. The PCF sends a Npcf_Policy Authorization_Notify (measured data rate,
Normal Data Transmission Interruption event, congestion information) message
to the AF.
5\. The NEF sends a Nnef_AFsessionWithQoS_Notify (measured data rate, Normal
Data Transmission Interruption event, congestion information) message to the
AF.
### 6.5.4 Impacts on services, entities and interfaces
AF:
\- Subscribe the data rate for the service flow, the normal data transmission
interruption event of the UE and the congestion information from 5GC.
PCF:
\- Generate the QoS monitoring policies for the data rate measurement, the
normal data transmission interruption event measurement, and the congestion
information measurement.
\- CP based reporting: report the detected information and event to NEF/AF.
SMF:
\- Generate the QoS Monitoring configurations for the data rate measurement,
the normal data transmission interruption event measurement, and the
congestion information measurement.
\- CP based reporting: report the detected information and event to SMF.
RAN:
\- Detect the congestion information and normal data transmission interruption
event to UPF.
\- UP based reporting: report the detected information and event to UPF via
the uplink data\'s header.
\- CP based reporting: report the detected information and event to AMF via CP
signalling.
UPF:
\- Enable the data rate measurement and report the measured data rate.
\- UP based reporting: detect information and event from uplink data\'s header
and report the detected information and event to NEF/AF.
\- CP based reporting: report the detected information and event to SMF via CP
signalling.
## 6.6 Solution #6:Mean bit rate change report
### 6.6.1 Key Issue mapping
This solution is for KI #3 5GS information exposure for XR/media Enhancements.
### 6.6.2 Description
In the Pre-Rel-18, the QoS Notification Control (QNC) with and without
alternative QoS profile are defined in clause 5.7.2.4 of TS 23.501 [2].
Since there is no explicit bitrate defined for the non-GBR Flow, but all the
non-GBR Flows share the APN-AMBR and UE-AMBR, i.e. in fact, there is the
available mean bit rate for the non-GBR flow. The available mean bit rate is
the bitrate with a time windows, e.g. averaging windows, i.e. the (default)
averaging windows (e.g. 2000ms in the Table 5.7.4-1 of TS 23.501 [2]) is also
applicable to the Non-GBR 5QI. The available mean bitrate is the bitrate that
can be provided by the non-GBR QoS Flow based on the available scheduling
radio resource to the non-GBR QoS Flow, The available mean bitrate can be
treated as the near-future bitrate and is not the measured value of the
current bitrate in the radio interface for the non-GBR QoS Flow. Since the
APN-AMBR are shared by the non-GBR QoS Flows, the available mean bitrate for a
non-GBR QoS Flow can be (near) to the APN-AMBR. If the change of the available
mean bitrate is over a threshold based on the available scheduling radio
resources for the non-GBR QoS Flow, the RAN will provide a non-GBR QoS
Notification Control Report message that \"The available mean bitrate has
changed to x kbps\" to the SMF, PCF and AF (via NEF), the AF can change the
codec based on the report available x kbps bitrates.
To control the reporting rates, there are two possible way. First one is that
the SMF can provide different bitrate span to the RAN, e.g. the three level
bitrate span are 0\~500kbps, 500\~2500kbps, above 2500kpb \~ Ͼ. Only after the
available mean bitrate is changed from one bitrate level to another bitrate
level, the RAN can generate the non-GBR QoS Notification Control Report
Message. The second on is that the SMF can provide different bitrate changes
percentage to RAN, only after the available mean bitrate is changed UP/Down
above the change percentage, the RAN will generate the non-GBR QoS
Notification Control Report message. One example of 3 level bitrate change
percentage can be 50%, 100%, 200%.
Like the alternative QoS, AF can additionally provide Requested Alternative
QoS Parameter Sets (including the desired mean bitrate value, PDB/RTT, PER,
Priority Level and Averaging Window) to the PCF, and PCF generates an 5QI, ARP
with additional desired Alternative QoS Parameters Set(s) to the SMF, then the
SMF provides the QoS profile to the RAN with an 5QI, ARP with additional
Alternative QoS Profile (including the different desired mean bitrates, PDB,
PER, Priority Level and Average Window. When the available mean bitrate is
changed to desired mean bitrate, the RAN generates the non-GBR QoS
Notification Control as described above.
NOTE: The Alternative QoS Parameter Sets requested by AF could be applied for
the GBR flows and non-GBR flows.
### 6.6.3 Procedures
#### 6.6.3.1 Non-GBR QoS Notification Control Report
Figure 6.6.3.1-1: Non-GBR QoS Notification Control Report
0\. The PDU Session for the XRM service is established, and a non-GBR QoS Flow
is established for the XRM service stream.
1\. The RAN detects the available mean bitrate of the non-GBR QoS Flow to be
changed to another level and sends a N2 QoS Notification Message \"the
available mean bitrate of the Non-GBR QoS Flow changes to x kbps\" or \"the
available mean bitrate of the non-GBR QoS Flow increases or decreases x%\" to
the AMF. The multiple levels of mean bitrate can be provisioned to the RAN by
the SMF during the Non-GBR QoS Flow Establishment procedure or during the Non-
GBR QoS Flow Modification procedure. The multiple levels of mean bitrate can
be bitrate value in kbps or can be bitrate change percentage.
2\. The AMF sends Nsmf_PDUSession_UpdateSM Context request (\"the available
mean bitrate of the Non-GBR QoS Flow changes to x kbps\" or \"the available
mean bitrate of the non-GBR QoS Flow increases or decreases x%\") to the SMF.
3\. The SMF sends Npcf_SMPolicyControl_Update request (\"the available mean
bitrate of the SDF changes to x kbps\" or \"the mean bitrate of the SDF
increases or decreases x %\") to the PCF.
4\. If NEF is used, the PCF sends the Npcf_PolicyAuthorization_Notify (\"the
available mean bitrate of the SDF changes to x kbps\" or \"the available mean
bitrate of the SDF increases or decreases x %\") to the NEF.
If the AF locates the trusted domain and the NEF is not used, the PCF sends
the Npcf_PolicyAuthorization_Notify (\"the available mean bitrate of the SDF
changes to x kbps\" or \"the available mean bitrate of the SDF increases or
decreases x %\") to the AF.
5\. After receiving the Npcf_PolicyAuthorization_Notify from the PCF, the NEF
sends the Nnef_EventExposure (\"the available mean bitrate of the stream
changes to x kbps\" or \"the available mean bitrate of the stream increases or
decreases x %\") to the AF.
6\. After receiving the information from PCF/NEF, the AF can determine to
change the codec with indicated bitrate.
#### 6.6.3.2 Non-GBR QoS Notification Control
Figure 6.6.3.2-1: Non-GBR QoS Notification Control
0\. The PDU Session for the XRM service is established.
1\. If the XRM AF does not locate at trusted domain, the AF sends the
Nnef_AFsessionwithQoS_Create Request (XRM stream information and request QoS
and additional Requested Alternative QoS Parameter Set (s)) to the NEF. The
request QoS and additional Requested Alternative QoS Parameter set(s) share
the same 5QI, ARP and each additional Requested Alternative QoS Parameter Set
includes a mean bitrate indicate the different possibilities for the codec and
a PER, PDB, Priority Level and Averaging Window for the 5QI).
2\. If the XRM AF locates at trusted domain, the AF sends the
Npcf_PolicyAuthorization_Create Request (XRM stream information and request
QoS and additional Requested Alternative QoS Parameter Set (s)) to the PCF.
3\. If the NEF is used, the NEF sends The AMF sends ends the
Npcf_PolicyAuthorization_Create Request (XRM stream information and request
QoS and additional Requested Alternative QoS Parameter Set (s)) to the PCF as
described in step 1b.
4\. The PCF sends Npcf_SMPolicyControl_UpdateNotify request (SDF PCC rule) to
the SMF. The SDF PCC rule also includes the additional desired Alternative QoS
Parameter Set(s) (e.g.multiple mean bitrate(s), PER(s), PDB(s), Priority
Level(s) and Averaging Window(s) for the associated 5QI).
5\. The SMF creates a new non-GBR QoS Flow based on received PCC rule and
sends the Namf_Communication_N1N2MessageTransfer request (N1 Message, N2
Message (QFI, non-GBR QoS profile with the 5QI , ARP , additional desired
Alternative QoS Profiles (e.g. mean bitrate(s) , PER(s), PDB(s), Priority
Level(s) and Averaging Window(s) for the associated 5QI))).
6\. AMF sends the N2 Message (QFI, non-GBR QoS profiles with the same 5QI,
ARP, and additional desired Alternative QoS Profile (s)) to the RAN to create
a non-GBR QoS Flow. After the Non-GBR QoS Flow is established, the RAN will
generate the current available mean bitrate and report the desired mean
bitrate that is closest to it to the AMF as described in clause 6.6.3.1 and
the AF may change its codec based on the desired mean bitrate reported from
the 5GS.
When the available mean bitrate changes in such a way that a different desired
mean bitrate is closest to it, the RAN generates the non-GBR QoS Flow
Notification message with the new desired mean bitrate as described in clause
6.6.3.1 and the AF can change its codec based on the desired mean bitrate
reported from the 5GS.
### 6.6.4 Impacts on services, entities and interfaces
AF:
\- Provides the stream QoS requirements which include additional Requested
Alterative QoS Set(s) (e.g. mean bitrate(s), PER(s), PDB(s)/RTT(s), Priority
Level(s), Averaging Window(s)).
\- Change its codec based on the available mean bitrate or the desired mean
bitrate reported from 5G network.
PCF:
\- The PCC rules for the non-GBR 5QI include additional desired Alternative
QoS Parameter Set(s) (e.g.mean bitrate(s), PER(s), PDB(s), Priority Level(s),
Averaging Window(s)).
\- Forwards the current available mean bitrate or the desired mean bitrate
from the SMF to the AF (via NEF).
SMF:
\- Creates a non-GBR QoS Flow with additional desired Alternative QoS
Parameter Set (s) based on the PCC rules from PCF.
\- Forwards the current available mean bitrate or the desired mean bitrate
from the RAN to the PCF.
RAN:
\- Creates a non-GBR QoS Flow with additional desired Alternative QoS
profile(s) in the QoS profile.
\- Measures the current available mean bitrate and reports the current
available mean bitrate or the desired mean bitrate to the SMF.
## 6.7 Solution #7: Identification and importance of packets in PDU set
### 6.7.1 Key Issue mapping
This solution addresses aspects of:
\- Key Issue#4 (PDU Set Integrated Packet Handling), and Key Issue#5
(Differentiated PDU Set Handling).
### 6.7.2 Description
This solution is based on the usage of the RFC 3550 [9] RTP and HTTP [41] [42]
[43] protocol to exchange data with the Application Server.
Network/user plane resources for media applications tend to be overprovisioned
to guarantee a near real-time experience due to the rate variability inherent
in these flows. However, the network can utilize scarce network resources
better and defer packet forwarding or handle congestion better if it is aware
of the importance of the coded media information and mark the packets of a PDU
set accordingly. QoS handling also benefits from distinguishing a PDU set from
adjacent ones.
XR media consists of audio, video, haptic and other data that has significant
rate variability. It is conveyed between media application end points over a
5G core and radio network that experiences congestion, delay, and jitter.
Media applications partition data into coding layers (e.g. video coding layer
- VCL) that efficiently code the data into base layers and enhanced temporal,
spatial and quality layers. The layered media data is mapped to network
adaptation layers (NAL) that are suitable to be packetized and transported
across the network. Each NAL unit transported in a data packet carries an
indication of the priority and dependencies to other coding layers/NAL units.
The media payload with the NAL header is transported by RFC 3550 [9] RTP or
RFC 3711 [10] SRTP. The RTP header contains sequence number, timestamp and M
bit that are used to identify packets that belong to a PDU set. Payload
information in NAL unit (NRI and Type) or experimental RTP extended header,
draft-ietf-avtext-framemarking [11] provides information on the type of
payload data and is used to determine the importance of the packet. For RTP
transport with unencrypted header and payload, the payload header/NAL unit
information can be used. SRTP transport where the payload is encrypted must
rely on the extended header RFC 3550 [9] if available or on the application
using different IP header fields (IPv6 flow labels, DSCPs, sending ports) that
correspond to the level of importance of the encoded media.
Media payload for web based media applications is transported over
HTTP/1.1[41], HTTP/2[42] or HTTP/3[43]. HTTP/1.1 may be inspected and packets
may be identified as belonging to a PDU set. Payload information conveys the
type of media encoded and can be used to classify its importance. However,
HTTP/1.1 is inefficient (needs multiple TCP connections), insecure and has
poor latency.
HTTP/2 on the other hand is relatively well suited for XR applications due to
supports for dynamically multiplexed and prioritized streams (e.g. 6DoF media
streams) in a single TCP connection. HTTP/2 also has and lower latency since
there is no HTTP head of line blocking. However, the HTTP/2 connection payload
carries dynamically multiplexed streams and may be encrypted, thus it is not
practical to inspect at line-speed. The proposal here is to carry new meta-
data in a new TCP option [44] in the packet along with the HTTP/2 media
payload. The meta-data carried characterizes the HTTP/2 media payload in the
packet.
HTTP/2 relies on TCP transport and its congestion control mechanisms result in
variable delays. Meanwhile, HTTP/3 uses a QUIC/UDP transport layer which is
not in kernel and can have more flexibility with congestion control, but is
otherwise like HTTP/2 for the purposes of this discussion. Since the QUIC
transport is UDP based, this solution proposes to carry the new meta-data on
the media payload in a new UDP option [45]. Another option is to use meta-data
extension headers in QUIC to carry media packet information that can be used
for packet QoS classification (based on IETF Media over QUIC (MOQ) [63]).
NOTE 1: The definition of new TCP or UDP options should be coordinated with
the IETF.
NOTE 21: Definition or extension of meta-data in QUIC headers should be
coordinated with the IETF.
This solution assumes the following:
\- QoS handlers are presented with the same set of importance information and
PDU set boundaries regardless of the format of the media transport or media
codecs used.
\- Shallow packet inspection /meta-information from headers is preferable to
minimize classification time.
\- Information in RTP headers, payload headers (NAL), extended RTP header and
IP headers are sufficient to characterize importance and PDU set boundaries.
\- This solution does not depend on SDP, HTTP or other session signalling as
they do not provide per packet information.
\- TCP or UDP options are sent between the transport endpoints (server and
UE). The UPF only inspects the meta-data in TCP/UDP option.
A high level sequence and related clauses with procedure extensions:
1) AF -> 5GC procedures to provision application preferences for filtering,
PDU classification (clause 6.7.3.2.2)
2) SMF provisions PFDs for media handling in UPF (clauses 4.18, 4.4.3.5 of TS
23.502 [3])
3) During session establishment SMF provisions PDR in UPF (clause 4.2.3 of TS
23.502 [3])
4) UPF classifies importance, packets of PDU set using rules provisioned
(clauses 6.7.3.1, 6.7.3.2)
5) UPF encodes importance, packets of PDU sequence mark in GTP-U extension
header (clause 6.7.3.3).
QoS handlers can use network resources more efficiently and deliver better e2e
media transport.
The procedures in clause 6.7.3.1 describe how to identify media packets of a
PDU set and differentiate packets of one PDU set from another. Clause 6.7.3.2
describes how to classify media packets of a PDU set by the level of
importance and the information configured between the application (AF) and 5GC
to support a customized importance by application (e.g. some applications may
prioritize motion over quality). Clause 6.7.3.3 describes how to transport the
QoS meta-information (importance, PDU sequence mark) across network entities
in 5GS.
### 6.7.3 Procedures
#### 6.7.3.1 Identifying Packets of a PDU Set
##### 6.7.3.1.1 RTP
Packets belonging to a PDU set can be identified by inspecting a combination
of fields in the RTP header (sequence number, timestamp, M bit) and RTP header
extensions (e.g. IETF Frame Marking RTP Extension header, draft-ietf-avtext-
framemarking [11]) and the media payload header (e.g. RTP payload NAL Unit
Type field).
Figure 6.7.3.1.1-1: Identifying start and end of a PDU set
The first packet of a PDU set has an RTP header with new timestamp, a new Type
field in NAL unit header and follows the sequence number of the packet with
the RTP header M-bit set to 1 (i.e. sequence number is 1 greater than the
packet with M-bit set to 1). Detection of the first packet may need a
combination of fields since timestamp may not be incremented for enhanced
layers (PDU set). If an RTP experimental extension header is present, the
S-bit is set to 1. These fields can identify the start of a PDU set.
The last packet of a PDU set has the RTP header M-bit set to 1, or precedes
packet /sequence number with new timestamp. If an RTP experimental extension
header is present, the E-bit is set to 1.
##### 6.7.3.1.2 HTTP
HTTP/1.1 packets belonging to a PDU set can be identified by inspecting the
HTTP payload to determine start, the packets in between and the end. HTTP
payload with the same timestamp and content type belong to a PDU set. Enhanced
layers can be detected by the change in content type (while the timestamp may
not be incremented). Out-of-order packet arrivals can be managed by tracking
the TCP sequence number along with the content type of the packet.
HTTP/2 and HTTP/3 packets carry multiple streams that are dynamically ordered
(i.e. their ordering is based on application priorities, network delays,
etc.). The combination of dynamically ordered streams or possible encryption
make it processing intensive to identify and characterize PDU sets at line-
rate without additional meta-data.
Methods for HTTP/2 and HTTP/3:
1\. Combination of IP header fields and stream fingerprint
UPF uses IP header fields (flow label, DSCP) to differentiate streams since a
flow (single transport connection) has multiple dynamically ordered streams.
Within an identified HTTP/2 stream, stream fingerprints (including packet
size, burst, inter arrival time) is used to identify PDU set boundaries.
Stream fingerprints are configured as described in clause 6.7.3.2.3.
2\. New TCP / UDP option with media meta-data
Media aware application server on N6 adds new TCP option [44] for HTTP/2 or
UDP option [45] for HTTP/3 to carry meta-data on the codec (audio, video,
haptics), media encoding in the packet (base layer, enhanced layers),
timestamp and PDU set information (start/end of frame). For HTTP/3 QUIC/UDP
meta-data to prioritize media with priority/importance [64] and extensions to
support other PDU set characteristics may be an option to be considered in
coordination with the IETF.
Since the meta-data is in a TCP/UDP option of the packet, no new
routing/destination information is needed (unlike using a tunnel in N6).
##### 6.7.3.1.3 PDU Sequence mark
A PDU Set is identified by a sequence number \"PDU sequence mark\" that is
appended to all the packets of a PDU set (start to end packet). More than one
bit may be used for the PDU sequence mark field if e.g. out-of-order packets
span multiple PDU sets. For example, a 2-bit counter would cycle incrementally
through 4 distinct PDU sequence marks using modulo arithmetic (i.e. mod-4 in
this case) for each subsequent PDU set. This allows the QoS handler to make
decisions based on the PDU set as a whole and differentiate from previous or
subsequent PDU sets. The PDU sequence mark (PSM) is carried in GTP extension
and further described in clause 6.7.3.3.
Since packets may arrive out-of-order, a packet with out-of-order sequence
number may be part of a new PDU set. If the packet has a new timestamp and new
media header fields, the packet belongs to a new PDU set and a higher PDU
sequence mark (i.e. (current PSM +1) mod-n) is used to indicate that it
belongs to a different PDU set.
#### 6.7.3.2 Classifying Importance of Packets in PDU Set
This clause describes how packets of a PDU set are classified based on the
importance of the media payload it carries. Media payload header NAL (e.g. RFC
3711 [10], Frame Marking RTP Header Extension, draft-ietf-avtext-framemarking
[11]) or RFC 3550 [9] RTP extended headers contain information on media
priority and dependence and is further defined in clause 6.7.3.2.1 Media
classification with HTTP payload is covered in 6.7.3.2.2.
Some PDU sets have a well understood importance (e.g. an independent frame has
high importance, or a discardable frame has low importance) but in other cases
applications may indicate a preference (e.g. an application that contains high
speed motion may give higher importance to temporal enhancement PDU sets over
spatial or quality data). PDU sets of enhancement layers (e.g. spatial,
temporal) have a dependence on base layer PDU sets and are relatively less
important than the base layer PDU sets that carry essential data. Applications
can configure these preferences as defined in clause 6.7.3.2.2.
QoS handlers are provided with a PDU Priority Mark (PPM) that represents
importance and dependence of PDU Set in terms of a linear priority value (e.g.
high/medium/low, 0-7) PPM is related to PDU set delay budget, error rate and
other parameters associated to each priority value. A QoS handler may use PPM
along with PDU set boundaries to handle packets of PDU set in a flow without
the need to understand the specifics of various coded media. The PPM can thus
be extensible for new types of media.
The QoS model in clause 5.7 of TS 23.501 [2], is extended for media PDU
handling as shown in Figure 6.7.3.2-1.
Figure 6.7.3.2-1: QoS Model with extension for Media PDU Classification
Protocol data units that arrive at a UPF with media classification
functionality are filtered and classified based on origin (3-tuple) or 5-tuple
flow information as defined in clause 5.6.7 of TS 23.501 [2]. Media PDU
filtering information is provisioned in 5GC by the application (AF) and
further details are in clause 6.7.3.2.2. If it is not a media PDU, the PDU
bypasses the media filter and flow based QoS is handled as defined in clause
5.7 of TS 23.501 [2]. Media PDUs (that are filtered) are classified using RTP
header/payload header information that identifies the importance of the packet
payload and details are in clause 6.7.3.2.1. The importance information in PPM
and sequence of PDU sets is carried in GTP extension header as outlined in
clause 6.7.3.3.
The mapping from meta-information available in media transport is presented to
the QoS handler as a scale of increasing/decreasing priorities in PPM (e.g.
high/medium/low, scale 0-7). The PPM is only applicable for selective handling
(e.g. deferring, dropping) of packets of PDU set within a flow. The actions
that the QoS handler takes based on PPM is based on network conditions or
other factors and implementation of the QoS handler and are not further
defined here.
A UPF with media classification functionality follows the extended QoS
handling below:
1\. PDU Set Marking:
If an incoming packet matches media filter criteria and is not classified
(i.e. does not have PPM), the media packet classifier uses rules configured in
clause 6.7.3.2.2 to select PPM value by matching on RTP/payload header fields
of incoming packet.
If there is no match, packet is marked with PPM of lowest priority.
2\. Flow based QoS in clause 5.7 of TS 23.501 [2] is applied.
The flow is processed using QoS defined in 23.501, 5.7. The PDB, PER, GBR, MBR
remain the same and the rules are based on existing PDR for the PDU session.
3\. Extended QoS Handling for Media packets:
Within the QoS rules for a flow, if PPM is available the QoS handler may use
it to optimize handling of the packet (e.g. deferring, or selectively dropping
when congestion exceeds threshold level). PDU set delay budget, error rate and
other parameters associated to each priority value in PPM is used.
For classification of upstream packets, the UE is provisioned with PPM during
PDU session establishment/modification based on S-NSSAI/DNN for the PDU
session. The PPM rules are sent from 5GC to the UE in N1 SM Container defined
in session management procedure in clause 4.3 of TS 23.502 [3]. PPM is used in
the UE for mapping to the appropriate MAC transmission buffers. The handling
of UL PDU sets in the UE is implementation specific.
##### 6.7.3.2.1 Mapping RTP/payload header values to PPM
Packets of a PDU set have a set of headers in IP, RTP transport and payload
headers that can be used to assign an importance and dependence to other PDU
sets. After the start of a new PDU set is detected, various header information
can be used in each of the following cases:
1\. RTP (unencrypted header and payload).
The RTP payload / NAL unit header with information on media coding priority,
dependence (e.g. H.264 [19], SVC, draft-ietf-avtext-framemarking [11]) are
used to map to per packet QoS priority values in PPM. Independent frames/PDU
sets with no dependence are marked with the highest priority while PDU sets
that carry temporal, spatial or quality enhancements are configured on a per
application basis on the level of importance. This is further defined in
clause 6.7.3.2.3.
2\. SRTP (unencrypted extended experimental header, encrypted payload).
The experimental IETF draft with extended header (Frame Marking RTP Header
Extension, draft-ietf-avtext-framemarking [11]) contains coded media
information that can be used to map to a PPM value. For example, an \"I\"
(independent/IDR frame with temporal independence) may be marked important,
while selected LID/TID values (spatial/quality/temporal frames with dependence
indicated by the value) may be of medium PPM priority and the others marked
low.
3\. SRTP (unencrypted header, encrypted payload).
The RTP unencrypted header does not provide meta-information to determine the
coded media that is carried in the packet and the NAL unit header is part of
the encrypted payload. Since the unencrypted headers don\'t convey enough
information on the media carried, the application supplements by conveying
different desired QoS handling priority by using different IPv6 flow labels,
DSCP, sender ports. The values are configurable per application and is
specified further in clause 6.7.3.2.3.
##### 6.7.3.2.2 Mapping HTTP transport payload to PPM
The methods described in 6.7.3.1.2 include both identification of PDU sets and
classification of packets with HTTP media transport.
1\. HTTP/1.1 (unencrypted header and payload)
Content type, base and enhanced layers are detected by inspection of the media
payload and mapped to per packet QoS priority values in PPM. Independent
frames/PDU sets with no dependence are marked with the highest priority while
PDU sets that carry temporal, spatial or quality enhancements are configured
on a per application basis on the level of importance. This is further defined
in 6.7.3.2.3
2\. HTTP/2 and HTTP/3 (dynamically ordered streams and possible encryption)
The HTTP/2 or HTTP/3 headers do not provide meta-information to determine the
coded media.
IP header fields (flow label, DSCP) are used to differentiate streams since a
flow (single transport connection) has multiple dynamically ordered streams.
If meta-data on the codec (audio, video, haptics), media encoding in the
packet (base layer, enhanced layers), timestamp and PDU set information
(start/end of frame)is available in TCP option [44] for HTTP/2 or UDP option
[45] for HTTP/3, this information is used to classify and map to per packet
QoS priority values. For HTTP/3, an option may be to use QUIC/UDP meta-data to
prioritize media with priority/importance [64] and extend in coordination with
IETF to support other PDU set characteristics.
##### 6.7.3.2.3 Provisioning Application Information
This clause describes the provisioning necessary to filter the media PDUs and
apply the QoS classification based on the importance that applications need
for different media encoding. For example, a video stream that encodes
significant motion may wish to prioritize PDU that have enhancement layers
with temporal information over PDUs that carry quality.
**Media Packet Filtering:**
Application function (AF) signals the 5GC and provides details on the criteria
by which to filter traffic carrying media traffic and then to the criteria by
which to determine importance of a packet/PDU. Media traffic is identified
using 3-tuple (server address/end user address, port protocol) or 5-tuple flow
as described in clause 5.6.7 of TS 23.501 [2] (Application Function Influence
on Traffic Routing).
**Media Packet Classification:**
The media traffic is then classified using the rules configured based the
application priorities for the corresponding fields in RTP/SRTP transport or
payload header. Some PDU sets have a well understood importance (e.g. an
independent frame has high importance, or a discardable frame has low
importance) but in other cases applications may indicate a preference (e.g. an
application that contains high speed motion may give higher importance to
temporal enhancement PDU sets over spatial or quality data).
The AF sends information to 5GC to configure default and application specific
information:\|
1\. Classification for RTP (unencrypted header and payload).
The parameters configured include the following:
\- if NAL I flag set to 1, then PPM = high importance.
\- NAL priority field values set for enhanced layers are mapped to PPM based
on application preference for motion or quality.
\- if no configuration applies, default is PPM = low importance.
2\. Classification for SRTP (unencrypted extended experimental header,
encrypted payload).
The parameters configured are based on RFC 3550 [9] RTP extension header:
\- if I flag is set to 1, PPM = high importance.
\- if D flag is set to 1, PPM = low importance.
\- TID/LID/TL0PICIDX values mapped to PPM based on application preference for
motion or quality.
\- if no configuration applies, default is PPM = low importance.
3\. Classification for SRTP (unencrypted header, encrypted payload).
The parameters configured include (one or more of) the following:
\- IPv6 flow label [12] values corresponding to application preference for
importance of the PDU.
\- DSCP corresponding to application preference for importance of the PDU:
(e.g. if DSCP = d1, PPM = high importance).
\- sending IP port and corresponding importance in PPM:
(e.g. if sending port = p1, PPM = medium importance).
\- if no configuration applies, default is PPM = low importance.
4\. Classification for HTTP
The parameters configured include the following:
\- parameters that fingerprint a stream including packet size, burst rate,
inter arrival time.
\- IPv6 flow label [12] values corresponding to application preference for
importance of the PDU.
\- DSCP corresponding to application preference for importance of the PDU:
(e.g. if DSCP = d1, PPM = high importance.
\- if no configuration applies, default is PPM = low importance.
These parameters are configured using PFD (Packet Flow Description) procedures
in clause 4.18 of TS 23.502 [3] and clause 4.2.4 of TS 23.503 [4] as basis (AF
-> NEF (PFDF) -> UDR). The SMF subscribes to PFDManagement services from NEF
to retrieve the configuration as specified in clause 5.2.6 of TS 23.502 [3]
(NEF Services). The SMF uses N4 PFD management procedure in clause 4.4.3.5 of
TS 23.502 [3] to provision these PFDs in the UPF.
#### 6.7.3.3 Protocol Extensions
The classification of media PDU with PPM described in clause 6.7.3.2 and
sequence of PDU sets described in clause 6.7.3.1 is carried to QoS handlers in
RAN /other UPFs using GTP-U extension headers (clause 8.3.1 of TS 23.501 [2],
TS 29.281 [16]). New GTP extension header fields are required for PPM
/importance information and for boundaries/sequence of PDU sets.
An example of GTP-U encapsulation carrying the QoS media classification result
is shown in Figure 6.7.3.3-1.
Figure 6.7.3.3-1: Example of QoS media classification in GTP-U extension
Figure 6.7.3.3-1 shows a sequence of PDU sets (I-frame followed by B-frames
and P-frame). There are two sets of classification results that are carried in
the GTP-U extension. The field with importance of each PDU defined as PPM
contains the level of importance of each PDU set as described in clause
6.7.3.2. In the example here, 3 levels of importance are conveyed for a QoS
handler to act on.
PDU set boundaries are identified as described in clause 6.7.3.1 and each of
the PDU sets are marked with a sequence number i.e. PDU sequence mark (PSM)
here shown as a single alternating bit in the figure. (A larger PSM may be
used).
### 6.7.4 Impacts on services, entities and interfaces
AF: Procedures to provision application preferences for filtering, PDU
classification (clause 6.7.3.2.3).
UPF: Classification of importance, packets of PDU set using rules provisioned
(clauses 6.7.3.1, 6.7.3.2). Encoding of importance, packets of PDU sequence
mark in GTP-U extension header (clause 6.7.3.3).
RAN: Ability to use the classification and importance information.
UE: If a UE does not support TCP/UDP option, it will be ignored (i.e. no
impact to UE).
## 6.8 Solution #8: Introduction of PDU Set information in RTP extension
header and related QoS parameters
### 6.8.1 Key Issue mapping
This solution addresses KI#4.
### 6.8.2 Description
In this solution the application layer has the capabilities to provide new
information describing characteristics of a \'PDU-Set\'. The characteristics
are encoded in a generic, media-type-agnostic manner. This to relieve the 5GS
from the burden of having media knowledge of applications that are not under
3GPP control.
#### 6.8.2.1 Solution to identify a PDU-Set on N6/in UPF
To make use of the PDU-Set concept in 5GS, it is needed to provide means for
the 5GS to identify the packets constituting a PDU-Set at N6 interface/UPF.
Given that the number of PDUs constituting a PDU Set changes dynamically, this
solution uses an in-band signalling for that purpose. In this solution a 3GPP
specified content of an extension header to carry PDU Set specific information
is introduced. This extension header is separated from privacy protected
payloads.
The solution is outlined below:
It is a design principle that the application layer provides the relevant
information about the Information Unit to the lower layers that will enable
lower layers to insert information aiding at identification of the PDU-Set at
N6.
To ensure that UPF only attempts to detect PDU-Sets in packet flows where such
are known to be present, the \'PDU-Set\' presence indication can be provided
to UPF from the SMF. The SMF receives it as new information in the PCC rule.
PCF can receive it, if available, from AF using existing procedures enhanced
with that new information.
Two implementation variants are proposed in this solution:
**A) Solution based on RTP extension header.**
Based on the understanding that segmentation into PDU-Set is applicable for
real-time media, it is assumed that RTP is used. Consequently, in this
solution RTP extension header (see clause 3.5.1 of RFC 3550 [9] and RFC 8285
[15]) is used to convey PDU-Set specific information to 5GS. This RTP
extension header is not encrypted.
UPF is enabled to inspect the RTP extension header. To reduce the UPF from
packet inspection complexity, it is required to standardize an RTP
configuration that enables a fixed starting position of the PDU-Set RTP
extension header. RTP header extension inspection is a step following the PDR
matching process and therefore does not impact the PDR matching process.
NOTE: The content of the RTP extension header will be defined by SA2 in
collaboration with SA4. Formally the definition of the RTP extension header
does not require any action in the IETF, but for broader adoption of the
header in RTP implementations, SA2 and SA4 may consider coordinating the
definition with the IETF.
**B) Variant based on MASQUE tunnel metadata:**
This variant is based on establishing a MASQUE tunnel between the UPF and the
Application Server, based on draft-ietf-masque-connect-udp [54].
At reception of the first UL packet, the UPF sends an HTTP/3 request to a
MASQUE proxy co-located in the Application Server, to create a MASQUE tunnel
in the N6 interface. The tunnel can then be secured using QUIC.
The first and subsequent packets are sent within the MASQUE tunnel as HTTP
Datagrams using the capsule protocol and are decapsulated by the co-located
proxy and forwarded to the Application.
Packets sent from the application to the UE go through the co-located MASQUE
proxy, which encapsulates them as HTTP datagrams using the capsule protocol
and sends them to the UPF through the MASQUE tunnel. The MASQUE client at the
UPF then decapsulates the HTTP Datagrams before further processing.
The AS can send PDU Set information as metadata to the UPF, which has the
following advantages:
\- It does not require CP involvement for tunnel management.
\- It works regardless of the protocol used for real-time media and the level
of encryption.
\- It provides integrity protection and encryption of both the payload and the
metadata.
\- It provides the means to insert metadata once per PDU Set, by means of
registering the metadata for a MASQUE context corresponding to that PDU Set
and referencing the context for subsequent PDUs in the set, therefore
optimizing signalling.
\- It also provides the possibility of sending per PDU extension headers, by
defining the header structure for the MASQUE context.
The parameters to be included in the metadata for PDU Set identification are
specified in clause 6.8.2.2.
Establishing of the MASQUE tunnel to the AS is a step following the PDR
matching process in the UL direction, only when PDU set handling indication is
set for the matched application ID.
Editor\'s note: A new PDU Set extension to CONNECT-UDP and CONNECT-IP needs to
be standardized, similar to draft-schinazi-masque-connect-udp-ecn-02 [65].
#### 6.8.2.2 New information associated with PDU-Set
The concept of a PDU-Set enables enhancements to efficient resource management
in 5GS, e.g. in NG-RAN.
One such example enables cell capacity increase. In this example NG-RAN may
take a decision to not deliver any PDU of a given PDU-Set when NG-RAN can
assess that not all PDUs constituting that PDU set are feasible to be
delivered within a required time while it is known that only if PDUs are
delivered the PDU-Set is used by the receiving application layer entity. To
enable such enhancement following PDU-Set associated information is provided:
**(a) in the RTP or MASQUE extension header:**
1\. PDU-Set Sequence number
Rationale: enables NG-RAN to identify PDU(s) that belong to a
new/different/particular PDU Set and to evaluate the associated information.
2\. Size of the PDU-Set (number of bytes) enabling NG-RAN to assess whether
delivery of the PDU-Set is feasible. If re-ordering of PDUs prior to N6 is
assumed as possible, the \'size of the PDU-Set information\' needs to be
included in the RTP extension header of each packet. Each RTP packet carries
the PDU Set size of the entire PDU Set.
3\. PDU-Set inter-dependencies, e.g. Late PDU-Set delivery indication.
Rationale : Dependent on the type of content carried by a PDU-Set within a QoS
Flow, a late PDU-Set delivery, i.e. delivery non-compliant with the required
latency may be still beneficial from the application perspective. Hence it
enables NG-RAN to improve the resource usage while considering benefits for
the QoE.
4\. Burst size (number of bytes), i.e. size of the \'data burst\' that a PDU
Set a part of.
Rationale: It is generally beneficial for NG-RAN to be aware of the amount of
data that needs to be transferred up-front as it aids the RRM and can be used
to improve the capacity.
**(b) in the CP (AF- >PCF-SMF-NG-RAN):**
5\. Indication whether a PDU-Set is only used by receiving application layer
entity if all PDUs constituting that PDU-Set are successfully received within
the PDU-Set Delay Budget (\'All PDUs in PDU Set Required indication\') (for
definition of PDU-Set Delay Budget please see clause 6.7.2.3).
Rationale for (2) & (5): NG-RAN may take a decision to not deliver any PDU of
a given PDU-Set when NG-RAN can assess that not all PDUs constituting that PDU
set are feasible to be delivered within a required time while it is known that
only if PDUs are delivered the PDU-Set is used by the receiving application
layer entity.
Given that the new PDU-Set associated information described in bullets 1.4
above is PDU-Set specific and can dynamically change between consecutive PDU-
Sets, it is not feasible to provide it as a (semi-)static information type in
NGAP, e.g. in a QoS profile of the QoS Flow on which the packet flows
consisting of PDU-Sets is mapped on. Hence in this solution this new PDU-Set
associated information is provided to NG-RAN in-band, i.e. encoded in the
GTP-U extension header by the UPF. On the other hand, the new PDU-Set
information in bullet 5 is assumed to be static on a per AF-session/QoS Flow
basis and therefore provided to 5GS in CP and from SMF to NG-RAN in NGAP.
#### 6.8.2.3 New QoS parameters associated with PDU-Set
An application layer instance can produce _units of information_ that can be
used by another application layer instance, e.g. to construct a usable
information and one example of such _information unit_ can be a video frame.
Dependent on its size and the MTU of the transport network, that _information
unit_ may need to be segmented and transferred in multiple transport units,
e.g. multiple IP packets. When all segments are received, the receiving
application layer instance uses the _information unit_. Hence the QoE is
dependent on the reception of the _information unit_ rather than individual
segments constituting it. Therefore, the forwarding treatment described by the
QoS parameters needs to be associated with the _information unit_.
Following the discussion above, SA2#149E agreed (subject to confirmation by SA
WG4) a concept corresponding to _information unit_ :
**PDU Set** : A PDU Set is composed of one or more PDUs carrying the payload
of one unit of information generated at the application level (e.g. a frame or
video slice for XRM Services), which are of same importance at application
layer. All PDUs in a PDU Set are needed by the application layer to use the
corresponding unit of information. In some cases, the application layer can
still recover parts of the information unit, when some PDUs are missing.
Based on the discussion above, we first introduce new \'PDU-Set\' level QoS
parameters (edited in text below in bold format).
**PDU-Set Delay Budget (PSDB)**
The **PDU-Set Delay Budget (PSDB)** defines an upper bound for the time that a
**PDU-Set** may be delayed between the UE and the N6 termination point at the
UPF. **PSDB** applies to the DL **PDU-Set** received by the UPF over the N6
interface, and to the UL **PDU-Set** sent by the UE. For a certain 5QI the
value of the **PSDB** is the same in UL and DL. In the case of 3GPP access,
the **PSDB** is used to support the configuration of scheduling and link layer
functions (e.g. the setting of scheduling priority weights and HARQ target
operating points). For GBR QoS Flows using the Delay-critical resource type, a
**PDU-Set** delayed more than PSDB is counted as lost if the QoS Flow is not
exceeding the GFBR. For GBR QoS Flows with GBR resource type not exceeding
GFBR, of the PDU-Sets shall commonly not experience a delay exceeding the
5QI\'s **PSDB** to a very high percentage.
The **5G Access Network** **PDU-Set Delay Budget (5G-AN PSDB)** is determined
by subtracting a static value for the **Core Network PDU-Set Delay Budget**
(**CN PSDB**), which represents the delay between any N6 termination point at
the UPF (for any UPF that may possibly be selected for the PDU Session) and
the 5G-AN from a given PSDB.
NOTE 1: For a standardized 5QI, a static value for the **CN PSDB** can be
specified.
NOTE 2: For a non-standardized 5QI, the static value for the **CN PSDB** is
homogeneously configured in the network.
For GBR QoS Flows using the Delay-critical resource type, in order to obtain a
more accurate delay budget PSDB available for the NG-RAN, a dynamic value for
the **CN PSDB** , which represents the delay between the UPF terminating N6
for the QoS Flow and the 5G-AN, can be used. If used for a QoS Flow, the NG-
RAN shall apply the dynamic value for the **CN PSDB** instead of the static
value for the **CN PSDB** (which is only related to the 5QI). Different
dynamic value for **CN PSDB** may be configured per uplink and downlink
direction.
NOTE 3: The configuration of transport network on CN tunnel can be different
per UL and DL, which can be different value for **CN PSDB** per UL and DL.
NOTE 4: It is expected that the UPF deployment ensures that the dynamic value
for the CN PSDB is not larger than the static value for the **CN PSDB**. This
avoids that the functionality that is based on the 5G-AN PSDB (e.g. NG-RAN
scheduler) has to handle an unexpected value.
The dynamic value for the **CN PSD** B of a Delay-critical GBR 5QI may be
configured in the network in two ways:
\- Configured in each NG-RAN node, based on a variety of inputs such as
different IP address(es) or TEID range of UPF terminating the N3 tunnel and
based on different combinations of PSA UPF to NG-RAN under consideration of
any potential I-UPF, etc.;
\- Configured in the SMF, based on different combinations of PSA UPF to NG-RAN
under consideration of any potential I-UPF. The dynamic value for the **CN
PSDB** for a particular QoS Flow shall be signalled to NG-RAN (during PDU
Session Establishment, PDU Session Modification, Xn/N2 handover and the
Service Request procedures) when the QoS Flow is established or the dynamic
value for the **CN PSDB** of a QoS Flow changes, e.g. when an I-UPF is
inserted by the SMF.
If the NG-RAN node is configured locally with a dynamic value for the **CN
PSD** B for a Delay-critical GBR 5QI, and receives a different value via N2
signalling for a QoS Flow with the same 5QI, local configuration in RAN node
determines which value takes precedence.
Services using a GBR QoS Flow and sending at a rate smaller than or equal to
the GFBR can in general assume that congestion related packet drops will not
occur.
NOTE 5: Exceptions (e.g. transient link outages) can always occur in a radio
access system which may then lead to congestion related packet drops. Packets
surviving congestion related packet dropping may still be subject to non-
congestion related packet losses (see **PSER** below).
Services using Non-GBR QoS Flows should be prepared to experience congestion-
related PDU-Set drops and delays. In uncongested scenarios, PDU-Sets should
not experience a delay exceeding the 5QI\'s **PSDB** to a very high
percentage.
The **PSDB** for Non-GBR and GBR resource types denotes a \"soft upper bound\"
in the sense that an \"expired\" PDU-Set that has exceeded the PSDB, does not
need to be discarded and is not added to the **PSER**. However, for a Delay-
critical GBR resource type, PDU-Set delayed more than the **PSDB** are added
to the **PSER** and can be discarded or delivered depending on local decision.
**PDU-Set Error Rate (PSER)**
The **PDU-Set Error Rate (PSER)** defines an upper bound for the rate of PDU-
Sets (e.g. set of IP packets constituting a PDU-Set) that have been processed
by the sender of a link layer protocol (e.g. RLC in RAN of a 3GPP access) but
where all of the PDUs in the PDU-Set are not successfully delivered by the
corresponding receiver to the upper layer (e.g. PDCP in RAN of a 3GPP access).
Thus, the **PSER** defines an upper bound for a rate of non-congestion related
packet losses. The purpose of the **PSER** is to allow for appropriate link
layer protocol configurations (e.g. RLC and HARQ in RAN of a 3GPP access). For
every 5QI the value of the **PSER** is the same in UL and DL. For GBR QoS
Flows with Delay-critical GBR resource type, a **PDU-Set** which is delayed
more than **PSDB** is counted as lost, and included in the PSER unless the QoS
Flow is exceeding the GFBR. Congestion related packet drops should be avoided
by means of an application layer rate adaptation scheme.
The QoS parameters **PSDB** and **PSER** are provided to NG-RAN as part of the
QoS profile.
### 6.8.3 Procedures
#### 6.8.3.1 Initial CP based configuration of 5GS
The **PDU Set presence indication,** **All PDUs Required indication** and the
new QoS parameters **PSDB, PSER** are added to the information provided by AF
according to the procedures in clauses 4.15.6.6 and 4.15.6.6a of TS 23.502
[3]. Alternatively, instead of the explicit values for **PSDB** and **PSER** ,
the AF provides a QoS reference that the PCF can map to **PSDB** and **PSER**
along with the **PDU Set presence indication** **and the All PDUs in PDU Set
Required indication**.
This new information is provided by PCF in PCC rule to the SMF using the PCF
initiated SM Policy Association Modification procedure in clause 4.16.5.2 of
TS 23.502 [3].
The SMF then performs network requested PDU Session Modification procedure as
specified in clause 4.3.3 of TS 23.502 [3].
As part of this procedure, SMF provides **All PDUs in PDU Set Required
indication** and formulates a QoS profile including the new QoS parameters
**PSDB** and **PSER** on N2 interface.
SMF configures the UPF with filtering information and provides the **PDU Set
presence indication**.
In the MASQUE variant, the AF provides its MASQUE destination address, to be
used for this AF session.
PCF and SMF forward this address as part of the PCC Rule and the SMF forwards
it to the UPF as N4 data.
SMF adds an indication to create the MASQUE tunnel in the FAR connected to the
UL PDR.
#### 6.8.3.2 In-band signalling of PDU Set information
For flows for which the PDU Set presence has been indicated by the SMF, the
UPF parses the RTP or MASQUE extension header.
Following PDU Set information is provided by means of in-band signalling:
**PDU Set size, PDU Set sequence number, Late PDU Set delivery indication,
Burst size.**
The extracted PDU-Set information is added to the GTP-U extension header
carrying the inspected IP packet.
In the MASQUE variant:
At reception of initial UL connection for flows for which the MASQUE tunnel
creation indication has been set by the SMF, the UPF establishes a MASQUE
tunnel with the Application Server.
For that purpose, the UPF sends an HTTP request to a MASQUE proxy co-located
in the Application Server, where the address of the MASQUE proxy has been
provided by the SMF as specified in clause 6.8.3.1.
The Application Server sends to the UPF the PDU Set information, either as
MASQUE extension headers or just once before each PDU set, by registering
these values for a context corresponding to the PDU set and then sending the
same context ID for all the PDUs in the PDU set.
### 6.8.4 Impacts on services, entities and interfaces
NOTE: This solution depends on the Application Server.
A) RTP based solution:
\- Use of RTP extension header with a 3GPP specified content carrying PDU-Set
information.
\- Inclusion of PDU-Set associated PDU Set information in the RTP extension
header: **PDU Set size, PDU Set sequence number, Late PDU Set delivery
indication**.
B) MASQUE variant:
\- Accept establishment of a MASQUE tunnel from the UPF.
\- Encapsulate PDUs in the MASQUE tunnel and add the mentioned PDU Set
information as metadata.
AF:
\- Provision of new **PDU Set presence indication** and **All PDUs in PDU Set
required indication** associated with a specific AF session to 5GS.
\- Provision of new PDU Set specific service requirements or QoS parameters:
**PSDB** and **PSER** to 5GS.
\- Provision of new MASQUE address of the Application Server, in case MASQUE
variant is used.
PCF:
\- Receives **PDU Set presence indication** , **All PDUs in PDU Set required
indication,PSDB** and **PSER** , alternatively, maps QoS reference to **PSDB**
and **PSER**.
\- Formulates PCC rules including **PSDB** and **PSER**.
\- Inclusion of the **PDU Set presence indication** and **All PDUs in PDU Set
required indication** in the PCC rule.
\- Inclusion of the MASQUE address of the Application Server, in case MASQUE
variant is used.
SMF:
\- Provides the **PDU Set presence indication** to the UPF on N4.
\- Includes on N2 **All PDUs in PDU Set required indication** and in QoS
profie **PSDB** and **PSER**.
\- For the MASQUE variant:
\- Inclusion of an indication to create the MASQUE tunnel in the FAR connected
to the UL PDR.
\- Inclusion on N4 of the MASQUE address of the Application Server.
UPF:
A) RTP based solution
\- Reception of the **PDU Set presence indication** from the SMF.
\- Detection of RTP extension header with PDU Set specific information when
such **PDU Set presence indication** has been provided for the flow.
\- Adding of the PDU Set specific information extracted from the RTP extension
header into the GTP-U extension header.
B) MASQUE variant
\- Reception through N4 of the UL indication to create a MASQUE tunnel,
together with the corresponding address of the Application Server.
\- For the first UL packet matching an N4 rule with create MASQUE tunnel
indication, establish a MASQUE tunnel with the Application Server.
\- Receive encapsulated DL PDUs with metadata and forward the associated PDU
Set parameters to the RAN in the GTP-U extension header.
NG-RAN:
\- Reception of new QoS parameters: **PSDB** and **PSER**
\- Reception of new PDU Set associated information:
\- In GTP-U extension header:
**PDU Set size, PDU Set sequence number, Late PDU Set delivery indication,
Burst size.**
\- In NGAP:
**All PDUs in PDU Set required indication.**
## 6.9 Solution #9: GTP extension header for PDU Set Sequence Number, and,
Number of PDUs in the PDU Set
### 6.9.1 Key Issue mapping
This solution addresses:
a) Key Issue #4: PDU Set integrated packet handling.
b) Key Issue #7: Policy enhancements for jitter minimization.
### 6.9.2 Description
a) The XR server is tightly coupled with a UPF, e.g. by locating the XR server
in an edge computing location.
Each PDU has a new GTP-U extension header carrying the Sequence Number
allocated to the PDU Set, and the number of PDUs in the PDU Set.
The GTP-U extension header goes from the XR Server/UPF through any (and all)
intermediate UPFs to the gNB and enables the gNB to operate the radio
resources more efficiently, e.g. by discarding PDUs of a PDU Set that the gNB
knows cannot be delivered in time.
b) In a real system, it can be expected that the delay budget relates to the
transmission of the entire PDU Set and not to each individual IP packet (PDU).
By using the concept of \"PDU Set Delay Budget\" and providing the PDU\'s PDU
Set sequence number to the gNB, the gNB can reduce the jitter in the delay
with which the complete PDU Set is delivered to the recipient\'s application
compared to the existing behaviour where each PDU is treated with the same
Packet Delay Budget.
### 6.9.3 Procedures
a) A PDN connection is established with a UPF that is suitable for the XR
service.
b) The XR server is tightly coupled or integrated with that UPF, e.g. by
locating the XR server in an edge computing location.
c) Each PDU Set is allocated a Sequence Number. New GTP-U extension header(s)
carry the PDU Set Sequence Number, and the \"Number of PDUs in the PDU Set\"
from the XR Server/UPF through any (and all) intermediate UPFs to the gNB.
d) Part of the GTP-U extension header can be used to inform the RAN whether it
is essential for all PDUs of the PDU Set to be received by the UE in order for
any of the information of that PDU Set to be of use to the UE.
This enables the gNB to know whether it can locally discard PDUs of a PDU Set
if it knows that it will fail to properly deliver the complete PDU Set.
e) The GTP-U extension header type can be encoded so that intermediate
UPFs/GTP-U entities pass the header on to the final GTP-U endpoint even if the
intermediate GTP-U entities do not understand that GTP-U extension header).
To enable smooth operation with legacy RAN nodes, it is anticipated that the
GTP-U extension header would be encoded as \'comprehension not required\'.
The relevant extract from the GTP-U specification, clause 5.2.1 of TS 29.281
[16] is copied below:
Bits 7 and 8 of the Next Extension Header Type have the following meaning:
Table 6.9.3-1
+------+--------------------------------------------------------------+ | Bits | Meaning | | | | | 8 7 | | +======+==============================================================+ | 0 0 | Comprehension of this extension header is not required. An | | | Intermediate Node shall forward it to any Receiver Endpoint | +------+--------------------------------------------------------------+ | 0 1 | Comprehension of this extension header is not required. An | | | Intermediate Node shall discard the Extension Header Content | | | and not forward it to any Receiver Endpoint. Other extension | | | headers shall be treated independently of this extension | | | header. | +------+--------------------------------------------------------------+ | 1 0 | Comprehension of this extension header is required by the | | | Endpoint Receiver but not by an Intermediate Node. An | | | Intermediate Node shall forward the whole field to the | | | Endpoint Receiver. | +------+--------------------------------------------------------------+ | 1 1 | Comprehension of this header type is required by recipient | | | (either Endpoint Receiver or Intermediate Node) | +------+--------------------------------------------------------------+
Figure 5.2.1-2: Definition of bits 7 and 8 of the Extension Header Type
f) In a real system, it can be expected that the delay budget relates to the
transmission of the entire PDU Set and not to each individual IP packet. In
such a situation, the PDU Set Sequence Number enables the gNB to estimate the
amount of time that it has for the delivery of each PDU from the time that the
first PDU of that PDU Set arrives at the gNB.
This enables the jitter in the delay with which the complete PDU Set is
delivered to the recipient\'s application to be reduced. It does however imply
a slight redefinition of the current Packet Delay Budget attribute, or, the
introduction of a new QoS attribute.
Note that even in an otherwise unloaded system, the backhaul to the gNB can
insert a non-negligible delay for typical XR PDU Sets, e.g. a PDU set of 50
kbytes occupies at least 0.4 ms on a 1 Gbit/s link. When the system is
moderately loaded, queuing delays can occur even in wider bandwidth backhaul
links.
### 6.9.4 Impacts on services, entities and interfaces
The entities impacted by this solution are the UPF at the XR Server and any
gNB that supports this functionality.
If a new QoS attribute is added for the PDU Set delay budget (instead of
changing the definition of the existing PDB), then there would be some impacts
on the PCF and SMF.
The AMF and any UPFs in between the gNB and the UPF at the XR Server are not
impacted.
## 6.10 Solution #10: Different bearers for PDUs with different importance
levels
### 6.10.1 Key Issue mapping
The solution applies to Key Issue #4 PDU Set integrated packet handling &#5
Differentiated PDU Set Handling.
### 6.10.2 Description
The XRM service PDUs have dependency with each other. The PDUs (e.g. I frame),
on which are dependent by the other PDUs (e.g. P frame, B frame), are expected
to be more important and should be transmitted firstly. However, in some XRM
service, P frame and B frame are also important as I frame to construct the
fluent video, dropping of those P frame and B frame causes jitter to the QoE
which is not better than giving up the whole service. In some other XRM
service, P frame and B frame are used to enhance the high definition, e.g.
from 720p to 1080p. dropping of those P frame and B frame makes sense to keep
the service when the network resource cannot transmit all of the service data.
Hence, the importance level for different data shall be authorized by the
application server, i.e. from the AF.
As defined in existing TS 38.321 [17], it has supported to prioritize transmit
the data from a logical channel with high priority and as defined in TS 38.323
[18], the data in the PDCP buffer is dropped when the discard timer is
expired.
\- When the UE has available UL data, the UE MAC layer generates the BSR for
LCG (logical channels group). The NG RAN allocates the time-frequency resource
for the group of logical channels. Based on the allocated time-frequency
resource, the UE prioritize to transmit the data from the logical channel with
high priority. the data in the PDCP buffer is dropped when the discard timer
is expired.
\- When there are available DL data for the UE, the RAN scheduling time-
frequency resource by its implementation. In general, the implementation
support to schedule data from logical channels in priority.
Hence, when the XRM data flows (e.g. I frame, P frame, B frame) with
difference importance levels use different standalone DRBs to transmit
respectively, the existing RAN scheduling mechanism can be reused to realize
the prioritized the transmission of the XRM data with high importance.
The solution is based on the existing QoS framework with the following
enhancement:
\- The AF provides importance level of XRM data flow and dependency among
flows.
\- The PCF generates different standalone PCC rules for flow with different
importance respectively. The importance of the flow is used to mapped the 5QI
of the PCC rule. For each PCC rule, a Standalone Indication is provided.
\- The SMF generate different QoS profile for the PCC rule with the Standalone
Indication.
\- Based on the received QoS profile of the QoS flow with Standalone
Indication, the NG RAN generate a standalone DRB for the QoS flow.
### 6.10.3 Procedures
Figure 6.10.3-1: Setting up an AF session with required QoS procedure
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, Flow
description(s), QoS reference, Importance Level) to the NEF.
If flow2 relies on flow1, the flow1\'s flow descriptions should include the
flow2\'s description.
2\. The NEF authorizes the AF request.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request and provides UE address, AF
Identifier, Flow description(s), the QoS reference, Importance Level).
4\. If the Importance Level is provided together with flow(s), the PCF uses
the Importance Level to map 5QI and generates different standalone PCC rules
respectively for the flows with different Importance Level. For each PCC rule,
a Standalone Indication is provided.
NOTE 1: The PCF also generates the PDU Set related information (e.g. QoS,
detection rule etc.) for the provided flow in this step, but this is not the
key point of the solution, so the detail of PDU Set is not repeated here.
If the flow in PCC rule2 relies on flow in PCC rule1, PCC rule1 should include
the identifier of PCC rule2.
5\. The PCF responds to the NEF a Npcf_Policy Authorization_Create response.
6\. The NEF sends a Nnef_AFsessionWithQoS_Create response message to the AF.
7\. The PCF sends a Npcf_SMPolicyControl_UpdateNotify request (PCC rules
(Standalone Indication)) the SMF.
If the Standalone Indication is provided together with PCC rule, the SMF
generates standalone QoS flow for each received PCC rule with Standalone
Indication and the QoS flow\'s QoS profile includes the Standalone Indication.
Based on that, the QoS flow is used to transmit the data of the PDU Sets with
the same importance level.
If QoS flow2 relies on QoS flow1, the QoS flow1\'s QoS profile should include
the identifier of QoS flow2.
The steps 8-10 are the same as the existing NW triggered PDU Session
Modification procedure, as described in clause 4.3.3.2 of TS 23.502 [3].
11\. The SMF sends a Namf_Communication_N1N2MessageTransfer (QoS profile
(Standalone Indication)) to the AMF.
12\. The AMF sends a N2 message (QoS profile (Standalone Indication)) to the
RAN.
Based on the received QoS profile of the QoS flow with Standalone Indication,
the NG RAN generate a standalone DRB for each received QoS flow.
In the case that QoS flow2 relies on QoS flow1 if the NG RAN fails to setup
QoS flow1, the RAN reject to setup QoS flow2 as well.
As the defined in existing TS 38.321 [17] and in existing TS 38.323 [18], when
the UE has available UL data, the UE MAC layer generates the BSR for LCG
(logical channels group). The NG RAN allocates the time-frequency resource for
the group of logical channels. Based on the allocated time-frequency resource,
the UE prioritize to transmit the data from the logical channel with high
priority. the data in the PDCP buffer is dropped when the discard timer is
expired. When there are available DL data for the UE, the RAN scheduling time-
frequency resource by its implementation. In general, the implementation
support to schedule data from logical channels in priority.
The steps 13-18 are the same as the existing NW triggered PDU Session
Modification procedure, as described in clause 4.3.3.2 of TS 23.502 [3].
### 6.10.4 Impacts on services, entities and interfaces
AF
\- Provide importance level of XRM data flow and dependency among flows (e.g.
I frame, P frame, B frame).
PCF
\- Generate different standalone PCC rules for flow with different importance
respectively.
SMF
\- Generate a standalone QoS flow for each received PCC rule with the
Standalone Indication.
RAN
\- Generate a standalone DRB for each received QoS flow with the Standalone
Indication.
## 6.11 Solution #11: Handling PDU Set within QoS flow
### 6.11.1 Key Issue mapping
The solution applies to Key Issue #4 PDU Set integrated packet handling &#5
Differentiated PDU Set Handling.
### 6.11.2 Description
The XRM service PDUs have dependency with each other. The PDUs (e.g. I frame),
on which are dependent by the other PDUs (e.g. P frame, B frame), are expected
to be more important and should be transmitted firstly. However, in some XRM
service, P frame and B frame are also important as I frame to construct the
fluent video, dropping of those P frame and B frame causes jitter to the QoE
which is not better than giving up the whole service. In some other XRM
service, P frame and B frame are used to enhance the high definition, e.g.
from 720p to 1080p. dropping of those P frame and B frame makes sense to keep
the service when the network resource cannot transmit all of the service data.
Hence, the importance level for different data shall be authorized by the
application server, i.e. from the AF.
The consecutive PDUs with the same importance level can be treated as a PDU
Set, e.g. a frame. An XRM service data can be categorized into a list of
consecutive PDU Sets. Except for importance level, the QoS requirement for the
XRM service flows are consistent. Hence, an XRM service flows can be mapped
into a QoS flow. And the QoS flow should include a list of PDU Set with
different importance level. A PDU Set includes a list of PDUs. Each PDU Set
should have the following factors:
\- The sequence number of the PDU Set
\- The Importance Level of the PDU Set.
\- The boundary information of the PDU Set, e.g.
0\. the Start Mark of PDU Set, which is only valid for the first PDU of the
PDU Set.
As shown in the example figure, unless the next PDU is 1st PDU of another PDU,
the network cannot know whether the current PDU is the last PDU of the current
PDU Set. In order to avoid always waiting for the next PDU to estimate whether
the current received PDU is the last PDU of the PDU Set, it is proposed not to
mark the last PDU of the PDU Set, but instead mark the first PDU of the PDU
Set.
1\. the sequence number of the PDU within the PDU Set.
In order to avoid the PDU disorder during the transmission, the sequence
number of the PDU within the PDU Set is proposed.
\- Dependent PDU Set\'s sequence number
0\. If the current PDU Set 2 is dependent on PDU Set 1, the PDU Set 2 should
carry the PDU Set 1\'s sequence number.
Figure 6.11.2-1: An example of PDU Set
The solution is based on the existing QoS framework with the following
enhancement:
\- The AF provides importance level of XRM data flow and dependency among
flows.
\- The PCF generates the QoS rules for flow including a list of PDU Sets.
\- The SMF maps the QoS flow for the QoS rule. The QoS flow\'s QoS profile
include a list of PDU Sets.
\- Based on the received QoS rule, the UPF maps the DL data with the
information of PDU Set.
\- Based on the received QoS rule, the UE maps the UL data with the
information of PDU Set.
\- The RAN handles the DL data of a PDU Set.
\- The UE handles the DL data of a PDU Set.
### 6.11.3 Procedures
Figure 6.11.3-1: Setting up an AF session with required QoS procedure
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, Flow
description(s), QoS reference, Importance level, Dependent Flow
description(s)) to the NEF.
1st importance level Flow description (e.g. I frame)
* * *
2nd importance level Flow description (e.g. P frame) Dependent Flow
description (e.g. I frame) 3rd importance level Flow description (e.g. B
frame) Dependent Flow description (e.g. I frame, P frame)
2\. The NEF authorizes the AF request.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request and provides UE address, AF
Identifier, Flow description(s), the QoS reference, Importance level,
Dependent Flow description(s)).
4\. If the Importance level is provided together with flow(s), the PCF
generates QoS rule for the flow(s), the QoS rule include a list of PDU Set.
The PCF uses the importance level of the flow to map the importance level of
the PDU Set and uses the flow to map the data description of the PDU Set.
PDU Set Importance level
* * *
            Data description (e.g. P frame)
            Dependent data description (e.g. I frame)
5\. The PCF responds to the NEF a Npcf_Policy Authorization_Create response.
6\. The NEF sends a Nnef_AFsessionWithQoS_Create response message to the AF.
7\. The PCF sends a Npcf_SMPolicyControl_UpdateNotify request (QoS rule (a
list of PDU Sets)) the SMF.
The SMF maps QoS flow for the QoS rule, if the QoS rule includes a list of PDU
Sets. The mapped QoS flow\'s QoS profile include the corresponding PDU Sets.
8\. The SMF replies SM Policy Association Modification Response to the PCF.
9\. The SMF initiates N4 Session Modification Request (QoS rule (a list of PDU
Sets)) to the UPF.
The UPF filters the DL based on the received PDU Set in the QoS rule and add
the header for PDU Set to the DL PDU, including the following factors:
PDU Set header Importance level
* * *
                   Sequence number of the PDU Set
                   Sequence number of the PDU within the PDU Set
                   Start Mark of the PDU Set, only valid for the 1st PDU of the PDU Set
                   Dependent PDU Set\'s sequence number
11\. The SMF sends a Namf_Communication_N1N2MessageTransfer (QoS rule (a list
of PDU Sets), QoS profile (a list of PDU Sets)) to the AMF.
12\. The AMF sends a N2 message (QoS profile (a list of PDU Sets), NAS PDU) to
the RAN.
Based on the received QoS profile with a list of PDU Set, after detecting PDU
Set header of the DL PDUs, if RAN cannot transmit some PDU, the NG RAN gives
up the transmission of the other PDUs which rely on this PDU. If the NG RAN
cannot transmit some PDU Set, the NG RAN reject to transmit the other PDU
Sets\' PDUs which rely on this PDU Set.
13\. Upon reception of the QoS rule with a list of PDU Set, the UE adds the
header for PDU Set to the UL PDU, including the following factors. If some PDU
fails to be transmitted, the UE gives up the transmission of the other PDUs
which rely on this PDU.
PDU Set header Importance level
* * *
                   Sequence number of the PDU Set
                   Sequence number of the PDU within the PDU Set
                   Start Mark of the PDU Set, only valid for the 1st PDU of the PDU Set
                   Dependent PDU Set\'s sequence number
The steps 14-18 are the same as the existing NW triggered PDU Session
Modification procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
### 6.11.4 Impacts on services, entities and interfaces
## 6.12 Solution #12: PDU Set integrated QoS handling
### 6.12.1 Key Issue mapping
This solution aims to the resolve the Key Issue #4, \"PDU Set integrated
packet handling\".
### 6.12.2 Description
For interactive media services, e.g. Cloud XR, cloud gaming, real-time video
based remote control, each frame/video slice is delivered via multiple PDUs in
the 5GS. For example, an I-Frame of 4K video can be more than 1MB which means
around 1000 IP packets are needed to deliver it. Considering the frame/video
slice can only be decoded in case all packets (or most of the packets, if FEC
is used during encoding) are successfully received. 5G system should be aware
of the PDU set and handle packets of one PDU Set in an integrated manner. When
one or some PDUs fail to be transmitted, the whole PDU Set can be dropped.
In this solution, the following aspects are included:
1\. Optionally, AF provides PCF with the PDU Set level QoS requirements and
the Flow description for the target media service data flow.
2\. PCF may generate the PCC rule with PDU Set level QoS parameters and also
the detection rules for the PDU Set.
3\. PCF sends the PCC rule to SMF. The SMF distributes these QoS
parameters/policy to RAN/UPF and instructs the UPF to detect PDU Set during
the PDU Session Establishment/Modification procedures.
4\. Once the application service started, the UPF identify the PDUs of each
PDU Set and marks PDU Set info in the GTU-U header of DL packets to RAN. The
details of how to identify the PDUs within a PDU Set is in clause 6.12.3.2.
5\. RAN identifies the PDUs of a PDU Set based on the PDU Set info in the
GTP-U headers. RAN performs the PDU Set integrated packet processing to
deliver the PDU Set to UE.
### 6.12.3 Procedures
#### 6.12.3.1 PDU Set integrated packet handling
High level procedure of PDU Set integrated packet handling can be shown as
following.
Figure 6.12.3.1-1: High-level Procedure of PDU Set integrated packet handling
As shown in Figure 6.12.3.1-1, a schematic diagram of the modification process
of the PDU session for the XR service is given. The process includes the
following steps:
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [3]. A network slice type for XR service can be used for such a PDU
Session.
1\. Optionally, as defined in clause 4.15.6.6 of TS 23.502 [3], the AF may
invoke the Nnef_AFsessionWithQoS_Create request to set up an AF session with
required QoS. In the step 1, the AF may send the following information to PCF:
Flow description of the target media service data flows for PDU Set handling.
Burst periodicity.
The PDU Set level packet handling/treatment requirements. The PDU Set level
packet handling/treatment requirements are optional and may include e.g. PDU
Set Error Rate, PDU Set Delay Budget, Maximum PDU Set Loss Rate/Number, Media
protocol info (e.g. which RFC is used in user data) etc.
2\. PCF may initiate the PDU Session modification procedure as defined in
clause 4.3.3.2 of TS 23.502 [3]. The PCF generates appropriate PCC rules based
on the information from AF as mentioned in step 1, e.g. 5QI, PER and PDB. The
PDU Set level packet handling/treatment requirements may be considered during
the PCC rule generation. The PCC rules may also include the detection rules of
service data flow, PDU Set level packet handling/treatment policy, PDU Set
identification rules. The PDU Set identification rules may contain RTP header
identification method as shown in clause 6.12.3.2.1, and/or RTP payload
identification method as shown in clause 6.12.3.2.2 (H.264), clause 6.12.3.2.4
(H.265) and clause 6.12.3.2.5 (H.266). The PCF sends the PCC rules to SMF.
3\. SMF generates the QoS profiles and N4 rules based on the PCC rules from
PCF, which may include the packet handling/treatment policy. SMF sends the N4
rules to UPF via the N4 rule, which may include the identification and marking
rule for PDU Set. Besides, SMF also sends the QoS profiles to the RAN node via
AMF, and instructs RAN to perform PDU Set integrated QoS handling.
NOTE 1: Based on Media protocol info included in the PDU Set level packet
handling/treatment requirements or based on pre-configuration, SMF generates
N4 rules accordingly to instruct UPF to identify the PDU Sets of corresponding
protocols as shown in clause 6.12.3.2.
4\. Based on received N4 rules or locally configuration on the UPF, the UPF
identifies the PDU Set and marks PDU Set info in the GTP-U layer in the DL
packets, including start/end indication of the PDU Set and the PDU Set ID.
Details of how to identify the PDU Set are in clause 6.12.3.2.
5\. The RAN identifies the PDU Set based on the PDU Set info in GTP-U header
and transmits PDUs within the PDU Set in an integrated manner, e.g. The RAN
may drop the PDU Set as a whole in case of poor network condition, and execute
packet handling/treatment policy.
NOTE 2: The details of RAN behaviour is up to RAN WGs.
#### 6.12.3.2 PDU Set identification and marking on UPF
UPF can identify the PDUs of one PDU Set via different ways, e.g. the RTP
headers/payloads in case RTP is used, the traffic periodicity. The UPF then
add marks in the GTP-U headers of DL packets to assist RAN for the PDU Set
identification, e.g. the start/end indication of the PDU Set and PDU Set ID.
The identification of PDU Set depends on what the PDU Set represents, e.g. a
video frame or a video slice.
##### 6.12.3.2.1 Identification of PDU Set as a video frame
If the PDU Set represents a video frame, the identification of the video frame
can be realized via following options
Option#1 Identification based on RTP header
The format of RTP header is defined in RFC 3550 [9] as shown below:
0 1 2 3
* * *
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 V=2 P X CC M
PT sequence number  
timestamp  
synchronization source (SSRC) identifier  
contributing source (CSRC) identifier  
....
Figure 6.12.3.2-1: RTP header format defined in RFC 3550 [9]
In RTP headers, _Marker_ (M) bit is set for the very last packet of the frame
indicated by the RTP timestamp. Therefore, _UPF can be based on the M bit to
identify the start and end of a PDU Set/frame_.
Option#2 Identification based on the RTP header extension
Based on the draft-ietf-avtext-framemarking [11], the extended RTP header
format is shown as below. The \"S\" bit and \"E\" bit in the Frame Marking RTP
header extension respectively represent the start and the end of a video
frame. UPF can identify the start and end of a PDU Set/frame according to the
\"S\" and \"E\" bits.
0 1 2 3
* * *
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 V=2 P X CC M
PT sequence number  
timestamp  
synchronization source (SSRC) identifier  
contributing source (CSRC) identifier  
....  
defined by profile length of header extension  
ID L S E I D 0 0 0 0
Figure 6.12.3.2-2: RTP header extension format
NOTE 1: The identification of a video frame based on the \"S\" and \"E\" bits
in the RTP header extension also applies for scalable video streams.
Option#3 Identification based on the periodicity via UPF.
Alternatively, the UPF can also use the periodicity information as frame
traffic pattern to identify the PDU Set/frame. The traffic pattern may also be
detected by UPF. For example, the DL media traffic may be 60 PDU Sets per
second, i.e. 60 FPS. Then the UPF can determine that it receives a PDU Set
every 16.67 ms.
NOTE 2: This assumes the service data flow only contains the video stream, or
if both video and audio streams are included in the same service data flow,
the UPF can use other ways to separate the video stream, e.g. PT field in the
RTP header.
##### 6.12.3.2.2 Identification of PDU Set as a H.264 video slice
If the PDU Set represents a video slice, the identification of PDU Set can be
realized by following approach.
According to RFC 6184 [12], within the RTP packet, the payload starts from a
one-byte header structured for a Network Abstraction Layer (NAL) Unit
encapsulating the slice output of encoded stream and the following is the
encoded video content for one, part of or multiple video slices.
Figure 6.12.3.2-3: NAL unit header format for H.264
The 5-bit NAL unit type in the NAL unit header can indicate the content of NAL
unit, e.g. coded slice of an I frame, coded slice of a P frame. Besides, it
can also indicate the possible structures of the RTP payload, e.g. single NAL
unit packet, aggregation packet and fragmentation unit (FU). The NAL unit type
for different RTP packet structure is shown below.
Figure 6.12.3.2-4: H.264 NAL unit types and corresponding packet types
For single NAL unit packet, that means one RTP packet can carry one NAL unit.
For aggregation packet, it means one RTP packets can carry multiple NAL unit,
especially when the sizes of NAL units are quite small.
For fragmentation unit, that means multiple RTP packets are used to carry one
NAL unit.
For single NAL unit packet and aggregation packet, it can be easily detected
that each RTP packet carries one NAL unit when the NAL unit type is less than
28.
When NAL unit type is 28 or 29, one NAL unit is carried over multiple RTP
packets. In this case, the first byte of RTP payload is also named the
fragmented unit (FU) indicator and the following byte is the FU header as
shown in Figure 6.12.3.2-3. In the FU header, the \"S\" bit and \"E\" bit
separately represents the start and end of the NAL unit. Therefore, based on
the NAL unit type (also known as FU indicator for fragmented unit) and the FU
header, the start/end of the same NAL unit can be identified.
Therefore, with the RTP payload (i.e. NAL unit header and optionally FU
header), the UPF can identify the PDU Set for one video slice.
NOTE 1: The mechanism described in this clause does not work with SRTP-based
payload encryption.
NOTE 2: Option 1 and 2 in clause 6.12.3.2.1 and methods in clause 6.12.3.2.2
rely on the usage of corresponding RTP protocols.
##### 6.12.3.2.3 PDU Set marking in GTP-U header
When UPF receives a media packet, UPF firstly finds a PDR based on IP
5-tuple.Then a PSDR (PDU Set Packet Detection Rule) can be used to identify
the RTP payload using any option described in clauses 6.12.3.2.1 and
6.12.3.2.2, the UPF FAR adds PDU Set info into the GTP-U headers of DL packets
in order to assist RAN for PDU Set integrated QoS handling. The PDU Set info
may include the start/end indication of the PDU Set, the PDU Set ID, etc. A
new FAR rule with enhanced Outer header creation is defined to add PDU Set
info in the GTP-U header.
NOTE: The details of GTP-U header extension for carrying PDU Set info is up to
stage 3.
##### 6.12.3.2.4 Identification of PDU Set as a H.265 video slice
If the PDU Set represents a H.265 video slice, the identification of PDU Set
can be realized by following approach.
According to RFC 7798 [21], within the RTP packet, the payload starts from 2
byte header structured for a NAL Unit encapsulating the slice output of
encoded stream and the following is the encoded video content for one, part of
or multiple video slices.
Figure 6.12.3.2.4-1: NAL unit header format for H.265
The 6-bit Type in the NAL unit header can indicate the content of NAL unit.
Besides, it can also indicate the possible structures of the RTP payload, e.g.
single NAL unit packet, aggregation packet (APs), fragmentation unit (FUs) and
Payload Content Information (PACI) carrying RTP packet. The NAL unit type for
different RTP packet structure is shown below.
Table 6.12.3.2-1: H.265 NAL unit types and corresponding packet types [46]
NAL unit type Packet Type Name
* * *
0-40 Single NAL unit packet 41-47 Reserved 48 Aggregation Packets 49
Fragmentation Units 50 PACI packet 51-63 Unspecified
\- For single NAL unit packet, that means one RTP packet can carry one NAL
unit.
\- For aggregation packet, it means one RTP packets can carry multiple NAL
unit, especially when the sizes of NAL units are quite small.
\- For fragmentation unit, that means multiple RTP packets are used to carry
one NAL unit.
\- For PACI packet, that contains a payload header (that differs from other
payload headers for efficiency), a Payload Header Extension Structure (PHES),
and a PACI payload.
For single NAL unit packet and aggregation packet, it can be easily detected
that each RTP packet carries one NAL unit when the NAL unit type is less than
49.
When NAL unit type is 49, one NAL unit is carried over multiple RTP packets.
In this case, the first two-byte of RTP payload is also named the payload
header (denoted as NAL U header) and the following byte is the FU header as
shown in Figure 6.12.3.2.4-1. In the FU header, the \"S\" bit and \"E\" bit
separately represents the start and end of the NAL unit. Therefore, based on
the NAL unit type (also known as FU indicator for fragmented unit) and the FU
header, the start/end of the same NAL unit can be identified.
When NAL unit type is 50, this is a PACI packet which may carry a single NAL
unit packet or FU. In this case, the first two-byte of RTP payload is also
named as the PACI header (denoted as NAL U header). During the following two
bytes, the \"A\" bit is the copy of \"F\" bit and cType field is the copy of
Type field in the PACI payload NAL unit. Then the following is the PHES field,
whose length is determined by the PHSize. Finally, the following is the PACI
payload NAL unit, during which the first byte is FU header when cType is 49.
Therefore, based on the PACI header and PACI payload NAL unit, the start/end
of the same NAL unit can be identified.
NOTE 1: The mechanism described in this clause does not work with SRTP-based
payload encryption.
NOTE 2: Option 1 and 2 in clause 6.12.3.2.1 and methods in clause 6.12.3.2.4
rely on the usage of corresponding RTP protocols.
##### 6.12.3.2.5 Identification of PDU Set as a H.266 video slice
If the PDU Set represents a H.266 video slice, the identification of PDU Set
can be realized by following approach.
According to draft-ietf-avtcore-rtp-vvc-14 [48], within the RTP packet, the
payload starts from 2 byte header structured for a NAL Unit encapsulating the
slice output of encoded stream and the following is the encoded video content
for one, part of or multiple video slices.
Figure 6.12.3.2.5-1: NAL unit header format for H.266
The 5-bit NAL unit type in the NAL unit header can indicate the content of NAL
unit. Besides, it can also indicate the possible structures of the RTP
payload, e.g. single NAL unit packet, aggregation packet (APs) and
fragmentation unit (FUs). The NAL unit type for different RTP packet structure
is shown below.
Table 6.12.3.2.5-1: H.266 NAL unit types and corresponding packet types [47]
NAL unit type Packet Type Name
* * *
0-25 Single NAL unit packet 26-27 Reserved 28 Aggregation Packets 29
Fragmentation Units 30-31 Unspecified
\- For single NAL unit packet, that means one RTP packet can carry one NAL
unit.
\- For aggregation packet, it means one RTP packets can carry multiple NAL
unit, especially when the sizes of NAL units are quite small.
\- For fragmentation unit, that means multiple RTP packets are used to carry
one NAL unit.
For single NAL unit packet and aggregation packet, it can be easily detected
that each RTP packet carries one NAL unit when the NAL unit type is less than
29.
When NAL unit type is 29, one NAL unit is carried over multiple RTP packets.
In this case, the first two-byte of RTP payload is also named the payload
header (denoted as NAL U header) and the following byte is the FU header as
shown in Figure 6.12.3.2.5-1 In the FU header, the \"S\" bit and \"E\" bit
separately represents the start and end of the NAL unit. Therefore, based on
the NAL unit type (also known as FU indicator for fragmented unit) and the FU
header, the start/end of the same NAL unit can be identified.
NOTE 1: The mechanism described in this clause does not work with SRTP-based
payload encryption.
NOTE 2: Option 1 and 2 in clause 6.12.3.2.1 and methods in clause 6.12.3.2.5
rely on the usage of corresponding RTP protocols.
#### 6.12.3.3 PDU Set integrated packet processing
Based on the PDU Set info carried in the GTP-U header, RAN can identify the
PDUs belongs to one PDU Set. RAN shall process the PDU Set together
accordingly. With the optional PDU Set level packet handling/treatment policy,
RAN performs corresponding QoS handlings with the granularity of PDU Set as
well.
NOTE: Details of performing PDU Set processing and QoS handling in RAN node is
up to studies in RAN WGs.
### 6.12.4 Impacts on services, entities and interfaces
AF:
\- Optionally, send the Flow description, Burst periodicity, and PDU Set level
packet handling/treatment requirements to 5GS.
PCF:
\- Optionally, receive the Flow description and PDU Set level packet
handling/treatment requirements from AF.
\- Generate the PDU Set level handling policy.
SMF:
\- Generate and distribute the PDU Set identification and marking rules.
\- Distribute the PDU Set level QoS parameters.
UPF:
\- Perform PSDR in order to identify the PDU Set and perform FAR for PDU set
marking as instructed by SMF.
RAN:
\- Identify the PDU Set and transmit packets of a PDU Set in an integrated
manner.
\- Optionally receive and execute PDU Set level packet handling/treatment
policy parameters.
NOTE: The details of RAN behaviour is up to RAN WGs.
## 6.13 Solution #13: DL data handling
### 6.13.1 Key Issue mapping
The solution applies to Key Issue #5 Differentiated PDU Set Handling.
### 6.13.2 Description
When the RAN congestion happens, in order to prioritize the transmission of
the more important data (e.g. I frame), the RAN can drop the less important DL
data (e.g. B frame) to the UE. During the congestion period, the continuous
less importance data from the UPF to the RAN may cause the RAN more congested
and waste the transport layer resource between the RAN and the UPF. The UPF
can also drop some less important data to the RAN when RAN is congested.
Besides, the existing FAR has supported to block or buffer chose data at the
UPF.
Hence, the solution proposes to make UPF not to transmit the less important DL
data to the RAN when the RAN congestion happens.
Besides, in some XRM service, P frame and B frame are also important as I
frame to construct the fluent video, dropping of those P frame and B frame
causes jitter to the QoE which is not better than giving up the whole service.
In some other XRM service, P frame and B frame are used to enhance the high
definition, e.g. from 720p to 1080p. dropping of those P frame and B frame
makes sense to keep the service when the network resource cannot transmit all
of the service data.
Hence, the data allowed to be intended dropped shall be authorized by the
application server, i.e. from the AF.
The solution is based on the existing QoS policy control and FAR with the
following enhancement:
\- The AF provides description of data allowed to be dropped and description
of data requiring prioritized transmission. The description of data allowed to
be dropped is used to identify the data allowed to be dropped and it should be
valid under some conditions, e.g. when the network cannot transmit all of the
data of service flow.
1st dropping data priority description of the data allowed to be dropped (e.g.
B frame)
* * *
2nd dropping data priority description of the data allowed to be dropped (e.g.
B frame, P frame)
\- The PCF issues the Network Load Monitoring policy: measured network load
type (e.g. RAN load, UPF load, transport layer load), measure frequency,
report event.
\- The PCF also issues multiple network load level associated QoS policies.
+-----------------------+---------------------------------------------+ | Network load level_1 | 1st QoS Policy | | | | | | description of the data/PDU set to be | | | dropped (e.g. B frame). | +=======================+=============================================+ | Network load level_2 | 2nd QoS Policy | | | | | | description of the data/PDU set to be | | | dropped (e.g. B frame, P frame) | +-----------------------+---------------------------------------------+
\- The SMF generates the Network Load Monitoring configuration for RAN: RAN
load measurement indication, measure frequency, report event.
\- The SMF generates the Network Load Monitoring for UPF: measured network
load type (e.g. RAN load, UPF load, transport layer load), measure frequency,
report event.
\- The SMF based on the multiple network load level associated QoS policies
from PCF, generates multiple network load level associated FARs, e.g.:
+-----------------------+---------------------------------------------+ | Network load level_1 | 1st FAR | | | | | | description of the data/PDU set to be | | | dropped (e.g. B frame) | +=======================+=============================================+ | Network load level_2 | 2nd FAR | | | | | | description of the data/PDU set to be | | | dropped (e.g. B frame, P frame) | +-----------------------+---------------------------------------------+
\- The UPF:
\- Upon reception of Network Load Monitoring configuration, the UPF enables
the network load (e.g. UPF, transport layer) measurement and report.
\- Upon reception of network load level associated, the UPF detects the RAN
load report from the UL data and executes the network load level corresponding
FAR.
\- The RAN:
\- Upon reception of Network Load Monitoring configuration, the RAN enables
the RAN load measurement and report.
### 6.13.3 Procedures
#### 6.13.3.1 Procedure for policy allocation
Figure 6.13.3.1-1: Setting up an AF session with required QoS procedure
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, Flow
description(s), QoS reference, dropping data authorization, valid condition of
dropping data authorization, description of data requiring prioritized
transmission) to the NEF.
The dropping data authorization is the dropping data list in prioritized
order. The valid condition of dropping data authorization can be the 5GS
cannot delivery all of the service flow data. The dropping data order list
includes the dropping data priority and its corresponding description of data
allowed to be dropped:
1st dropping data priority description of the data allowed to be dropped (e.g.
B frame)
* * *
2nd dropping data priority description of the data allowed to be dropped (e.g.
B frame, P frame)
The valid condition of dropping data authorization e.g. when the network
cannot transmit all of the data of service flow.
2\. The NEF authorizes the AF request.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request and provides UE address, AF
Identifier, Flow description(s), the QoS reference, dropping data
authorization, valid condition of dropping data authorization, description of
data requiring prioritized transmission).
4\. If the dropping data authorization and description of data requiring
prioritized transmission are provided, the PCF generates the network load
monitoring policy. The valid period (e.g. the peak time of a day) for the load
monitoring policy may also be provided.
The Network Load Monitoring policy includes measured network load type (e.g.
RAN load, UPF load, transport layer load), measure frequency, report event.
The report event may include: the report threshold of network load level,
congestion happens.
The PCF may also generate the network load level associated QoS policy to
block or buffer the chose DL data at the UPF. The chose DL data belongs to
data allowed to be dropped and not belong to data requiring prioritized
transmission. The following table is an example of the network load level
associated QoS policy:
+---------------------------------------------+-----------------------+ | 1st QoS Policy | Network load level_1 | | | | | description of the data/PDU set to be | | | dropped (e.g. B frame) | | +=============================================+=======================+ | 2nd QoS Policy | Network load level_2 | | | | | description of the data/PDU Set to be | | | dropped (e.g. B frame, P frame) | | +---------------------------------------------+-----------------------+
The PCF include the policy into the PCC rule and sends it to the SMF in step7.
5\. The PCF responds to the NEF a Npcf_Policy Authorization_Create response.
6\. The NEF sends a Nnef_AFsessionWithQoS_Create response message to the AF.
7\. The PCF initiates SM Policy Association Modification Request (PCC rule
(Network Load Monitoring policy, network load level associated QoS policy)) to
the SMF.
The SMF generates the Network Load Monitoring configuration for RAN: RAN load
measurement indication, measure frequency, report event.
The SMF generates Load Monitoring configuration for UPF: measured network load
type (e.g. RAN load, UPF load, transport layer load), measure frequency,
report event.
The SMF based on the multiple network load level associated QoS policies from
PCF, generates multiple network load level associated FARs, e.g.:
+-----------------------+---------------------------------------------+ | Network load level_1 | 1st FAR | | | | | | description of the data/PDU Set to be | | | dropped (e.g. B frame) | +=======================+=============================================+ | Network load level_2 | 2nd FAR | | | | | | description of the data/PDU Set to be | | | dropped (e.g. B frame, P frame) | +-----------------------+---------------------------------------------+
8\. The SMF replies SM Policy Association Modification Response to the PCF.
9\. The SMF initiates N4 Session Modification Request (Network Load Monitoring
configuration, network load level associated FAR) to the UPF.
Upon reception of Network Load Monitoring configuration, the UPF enables the
network load (e.g. UPF, transport layer) measurement and report.
Upon reception of network load level associated, the UPF detects the RAN load
report from the UL data and executes the network load level corresponding FAR.
10\. The UPF(s) respond to the SMF.
11\. For SMF requested modification, the SMF invokes
Namf_Communication_N1N2MessageTransfer ([N2 SM information] (PDU Session ID,
QFI(s), QoS Profile(s), Network Load Monitoring configuration), N1 SM
container)).
12\. The AMF may send N2 ([N2 SM information received from SMF], NAS message
(PDU Session ID, N1 SM container (PDU Session Modification Command))) Message
to the (R)AN.
Upon reception of Network Load Monitoring configuration, the RAN enables the
RAN load measurement and report.
The steps 13-18 are the same as the existing NW triggered PDU Session
Modification procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
#### 6.13.3.2 Procedure for RAN load report via user plane
Figure 6.13.3.2-1: RAN load report via user plane
When the RAN load reaches the report threshold or the report event happens
(e.g. congestion starts), the RAN report the RAN load level to the UPF via UL
data header.
The UPF block or buffer data based on the network load associated FAR.
When the RAN load becomes lower or the report event happens (e.g. congestion
ends), the RAN report the RAN load to the UPF via UL data header.
The UPF resumes the data transmission to the RAN.
### 6.13.4 Impacts on services, entities and interfaces
AF
\- Provide description of data allowed to be dropped and description of data
requiring prioritized transmission.
PCF
\- Issue the Network Load Monitoring policy and QoS policies associated with
network load levels.
SMF
\- Generate the Network Load Monitoring configuration for RAN and FARs
associated with network load levels.
UPF
\- Enable the network load measurement and report.
\- Detect the RAN load report from the UL data and execute the network load
level corresponding FAR.
RAN
\- Enable the RAN load measurement and report.
## 6.14 Solution #14: PDU Set integrated packet handling
### 6.14.1 Introduction
To support PDU Set integrated packet handling, this solution proposes the
decomposition and mapping of functionality show in Figure 6.14.1-1. As
specified in clause 4.2, the solution builds on the Release 17 5G System
architecture, including existing signalling for PCC Rules, QoS Profile, and
QoS Flow Level QoS parameters (see clause 6.2.5.1.1.4 of TS 23.501 [2]).
This solution assumes the following definition:
\- Media Unit Identification. Media Unit Identification detectsmedia specific
properties of packets according to the PDU Familiesto which it belongs. Media
Unit Identification may utilize techniques such as DPI, and examination of RTP
headers to determine the media units associated with a packet. Media Unit
Identification may be performed at the UE (for uplink) or the UPF (for
downlink). Media Unit identification may be implemented differently in the UE
and UPF. At the UE it may be integrated with functionality described by SA4 in
TR 29.998 [26] (e.g. for 5G STAR UE or EDGAR UE). Information needed to detect
the Media Units is configured on the SMF/UPF, or in the case of RTP headers,
the AF may provide information regarding the RTP header to be detected. When
RTP is not used, media unit detection may not be possible for encrypted
traffic.
\- Packet Classification. Packet Classification uses Media Unit identification
information to associate packets with a PDU Set in one or more PDU Families.
Classification captures media layer attributes that can impact QoS treatment.
This may include dependence of packet treatment on the successful handling
other packets (e.g. treatment of a packet carrying a P-Frame fragment is
dependent on the successful handling of packets carrying I-Frame fragments) or
treatment of a packet carrying an enhancement layer is dependent on the
successful handling of packets carrying a base layer. Classification is
conveyed from the UPF to the NG-RAN via markings added to a GTP-U header
extension, and hence 3GPP standardization of classification is required.
In addition, optionally, assistance information describing media and traffic
characteristics not required per-packet such as RTP header type (for media
where an RTP header is used), number of temporal and spatial media layers,
Group of Pictures (GOP) structure, temporal and spatiallayer periodicities and
inter-dependencies, etc. may be provided by an AF or configured in the 5GS.
\- Enhanced QoS Policy - In the 5GS, how packets are treated is based on QoS
policy determined at the PCF. While packet classification markings indicate
PDU Set associations and media unit properties (for example, indicating that
the packet carries a fragment of an I-Frame from a spatial enhancement layer
that is dependent on a base layer for an H.26x video stream) they do not
specify how the packet is treated in the 5GS. To align with the current 5GS
QoS framework, QoS policy is enhanced to provide PDU Set granularity QoS
information indicating how packets should be treated. The enhanced policy
information is sent to the SMF in a PCC rule and sent to the NG-RAN and, UE
using existing mechanisms as shown in figure 6.14.1-1.
Enhanced policy sent from the SMF to the NG-RAN (via the QoS Profile) and/or
UE may comprise of the following:
1 Changes to the QoS Flow Priority Level according to the classification of a
PDU as belonging to a PDU Set in one or more PDU Families (see example in
Table 2 of clause 6.14.2.2)
2 Changes to QoS Flow PER according to the classification of a PDU as
belonging to a PDU Set in one or more PDU Families
3 Changes to QoS Flow PDB according to the classification of a PDU as
belonging to a PDU Set in one or more PDU Families
4 PDU Set Validity Time, which indicates for each PDU set type, the maximum
delay for a given PDU Set instance to be delivered to the recipient. Beyond
the validity time, the PDU Set instance is not considered valid, and thus all
packets of the PDU Set that were not transmitted can be discarded at the RAN.
The PDU Set Validity Time defines an upper bound time limit that the combined
set of packets in a PDU Set instance may be delayed between the UE and the N6
termination point at the UPF.
Note for example that for an I-Frame PDU set, the Validity Time may take into
account the usefulness of I-Frames for subsequent P-Frame decoding, which may
occur at a later time than is required to render the I-Frame. Similar
scenarios apply for PDU Sets in the Temporal and Spatial Layer PDU Families
where an Enhancement Layer PDU Set may be dependent on a Base Layer PDU Set.
When there is one packet in the PDU Set, the Validity Time may be greater than
the PDB to reflect the usefulness of the PDU Set for this purpose.
NOTE: Neither the RAN nor UE are aware of media layer details. RAN behaviour
to enforce policy is up to RAN WGs. The details of UE behaviour is up to UE
implementation.
\- Policy Enforcement PDU Set level packet treatment in the NG-RAN and UE is
achieved by matching all PDU Set packet classification markings with the
enhanced QoS policy information provided in the QoS Profile and PDU SetLevel
QoS parameters.
Figure 6.14.1-1: 5GS Support for PDU Family integrated packet handling
### 6.14.2 Functional Description
#### 6.14.2.1 PDU Families and Packet Classification
As described in the KI, a \"group of packets (that) belongs to a same PDU
Setwill be handled in an integrated manner\". In media streams, groups of
packets handled in an integrated manner occur at different levels. These
levels include:
\- Level 1 PDU Family- Media Frame or Media Frame Slice: Packets that comprise
fragments of a media frame (e.g. an I-Frame/Slice or a P-Frame/Slice where a
Slice is an independently encoded region of a Frame and is also the minimum
media unit of transmission over the network) may be handled in an integrated
manner since, for example only by sending all packets of a frame or a frame
slice can the frame/slice be successfully decoded. Hence the set of PDUs that
comprise a specific Media Frame or Media Frame Slice should be considered a
PDU Set in the Media Frame or Media Frame Slice PDU Family. Differentiated QoS
handling may be provided for PDUs that are members of different PDU Sets in
this Families (e.g. a packet that is a member of I-Frame PDU Set is given
priorityover a packet that is a member of a P-Frame PDU Set).
\- Level 2 to Level N PDU Family - Additional Media Frame Sets: Groups of
packets can comprise higher level Media Units that are processed in an
integrated manner (as a PDU Set), particularly for scalable / layered media.
For example, packets that comprise a temporal base layer may be processed in
an integrated manner and hence be members of a Temporal Base Layer PDU Set in
the Temporal Layer Family while different packets that comprise a temporal
enhancement layer-1 may be considered as members of a Temporal Enhancement
Layer-1 PDU Set in the same PDU Family. Similarly packets that comprise a
spatial base layer may be processed in an integrated manner and hence be
members of a Spatial Base Layer PDU Set in the Spatial Layer Family while
different packets that comprise a spatial enhancement layer-1 may be
considered as members of a Spatial Enhancement Layer-1 PDU Set in that same
PDU Family .In addition to having different layers, a video frame may further
be divided into tiles that represent different regions of the overall wide
(e.g. full 360 degree) view, where tiles belonging to or close to the current
user viewport may be sent with a different quality than the other tiles.
Additional PDU Families may be considered for this type of media.
**\- Level N+1 PDU Family- Application Type** / Media Stream / Sub-Flow **-**
5GS QoS Flows can carry multiple application flow instances of the same type
(e.g. two H.26x video streams) as well as application flow instances of
different types (e.g. H.26x video and AAC Audio). To distinguish between these
application flows within a QoS Flow, packets associated with an application
instance may comprise a PDU Set in the Application Type / Media Stream /Sub-
Flow PDU Family.Differentiated QoS handling may be provided to PDUs according
to the Application Type / Media Stream / Sub-Flow PDU Set to which they belong
(e.g. audio has higher priority than video). Alternatively application flow
instances may be mapped to separate QoS Flows, in which case Application Type
QoS differentiation can be provided by existing QoS.
A PDU may be classified as belonging to a PDU Set in just one PDU Family (e.g.
an I-Frame PDU Set in a Media Frame/Slice Family), or as belonging to a PDU
Set in each of several PDU Families (particularly for scalable/layered media).
A GTP-U extension header field is defined for each PDU Family. Note that since
an individual PDU may be a member of multiple PDU Families, a field for each
may be included in the extension header. Proposed PDU Families are:
1\. Frame /Slice
2\. Temporal Layer
3\. Spatial Layer
4\. Application / Media Stream / Sub-Flow
For each PDU Family / GTP-U field, sub-fields contain the following
information:
\- The PDU Set Type
\- A rolling counter to sequentially number each PDU Set instance within a PDU
Family (one counter for all PDU Sets within the PDU Family)
\- Dependency, which is the rolling-counter value previously assigned to the
PDU Set instance on which the PDU Set is dependent.
In addition a sub-field with a PDU Set Start / End Indicator is provided for
the Frame / Slice PDU family so the RAN can take advantage of time between
frames for power saving.
The rolling counter distinguishes between PDUs belonging to two instances of
the same PDU Set Type (e.g. two sequential P-Frames) and is used to indicate
dependency of a PDU Set instance on another PDU Set Instance (e.g. a
P-Frame\'s dependency on a specific I-Frame instance, or an enhancement
Layer\'s dependency on a specific base layer instance).
For example, for Packets classified in PDU Family #1 (Media Frame/Slice), all
packets carrying fragments of a particular I-Frame instance may be assigned a
rolling counter value=3. Packets carrying P-Frames that are dependent on that
I-Frame instance would have \"3\" indicated in their \"Dependency\" field. In
another example, for packets classified in PDU Family #2 (Temporal Layer), all
packets carrying fragments of a particular Temporal Base Layer instance may be
assigned a rolling counter value=7. Packets carrying Temporal Enhancement
Layers that are dependent on that base layer instance would have \"7\"
indicated in their \"Dependency\" field.
Packets can belong to a PDU Set in one or more of the PDU Families as
described above. The PDU Set Typesrepresented at each level are defined via
configuration. For example, for H.26x video one may have levels PDU Families
and PDU Set Types defined as:
Level 1: PDU Family #1 = Media Frame/Slice, with Media Types.
\- Not Assigned
\- Independent or Random-access Frame or Slice (\"I-Frame\")
\- Referenced Frame or Slice (\"P-Frame\" with forward references)
\- Non-referenced Frame or Slice (\"P-Frame\" with no forward references)
Level 2: PDU Family #2 = Temporal Media Layers, with PDU Set Types
\- Not Assigned
\- Base Layer
\- Enhancement Layer 1
\- Enhancement Layer 2
....
Level 3: PDU Family #4 = Spatial Media Layers, with PDU Set Types
\- Not Assigned
\- Base Layer
\- Enhancement Layer 1
\- Enhancement Layer 2
....
Level 4: PDU Family #4 = Application/ Media Stream / Sub-Flow, with PDU Set
Types
Not Assigned
H.26x video
AAC Audio
......
Values for the \"PDU Set Type\" portion of the GTP-U extension header for each
PDU Family fields and an example packet marking is shown in Table 6.14.2.1-1.
packet from an H.264 video flow identified as carrying an I-Frame fragment in
Temporal Enhancement Layer 2 and a Spatial Base layer would be marked in the
\"PDU Set Type\" GTP-U sub-header fields defined for the levels as shown in
the 4th column of the table 1:
Table 6.14.2.1-1: Example PDU Set Type GTP-U Extension Header with PDU Family
Classification Marking for a Packet
+-------------+-------------+-------------+-------------+-------------+ | PDU Set | Field Name | PDU | Example | Int | | Type | | SetTypes\ | Packet | erpretation | | | | (values and | Marking\ | of Example | | | | definition) | (PDU Set | PDU Set | | | | | Type) | Type | +=============+=============+=============+=============+=============+ | 1 | **PDU | 0 = Not | 1 | Ra | | | Family | Assigned | | ndom-access | | | #1** | | | (I) Frame | | | | 1 = | | | | | | Ra | | | | | | ndom-access | | | | | | (I) frame | | | | | | | | | | | | 2 = | | | | | | Referenced | | | | | | (P) frame | | | | | | | | | | | | 3 = | | | | | | Non | | | | | | -referenced | | | | | | (P) frame | | | +-------------+-------------+-------------+-------------+-------------+ | 2 | **PDU |** Temporal | 3 | Temporal | | | Family | Layers:**| | Enhancement | | | #2** | | | Layer #2 | | | | 0 = Not | | | | | | Assigned | | | | | | | | | | | | 1 = Base | | | | | | Layer | | | | | | | | | | | | 2 = | | | | | | Enhancement | | | | | | Layer 1 | | | | | | | | | | | | 3 = | | | | | | Enhancement | | | | | | Layer 2 | | | +-------------+-------------+-------------+-------------+-------------+ | 3 | **PDU |** Spatial | 1 | Spatial | | | Family | Layers:**| | Base Layer | | | #3** | | | | | | | 0 = Not | | | | | | Assigned | | | | | | | | | | | | 1- Base | | | | | | Layer | | | | | | | | | | | | 2 | | | | | | - | | | | | | Enhancement | | | | | | Layer 1 | | | | | | | | | | | | 3 - | | | | | | Enhancement | | | | | | Layer 2 | | | +-------------+-------------+-------------+-------------+-------------+ | 4 | **PDU |** A | 1 | H.264 Video | | | Family | pplication/ | | | | | #4**| Media | | | | | | Stream / | | | | | | Sub-Flow:** | | | | | | | | | | | | 0 = Not | | | | | | Assigned | | | | | | | | | | | | 1= H.264 | | | | | | video | | | | | | | | | | | | 2= AAC | | | | | | Audio | | | +-------------+-------------+-------------+-------------+-------------+
This structure provides flexibility for cases where Media Unit Identification
is available for only a sub-set of PDU Families. For example, if Media
Detection can only distinguish packets associated an I-Frame and a P-Frame, or
alternatively as associated with a base layer and an enhancement layer, the
UPF may classify and mark those Packets accordingly and leave the other fields
\"not assigned\". Policy that differentiates packet handling , for example of
packets associated with a \"base layer\" vs \"enhancement layer\" may then be
applied even if for example the frame-type / slice remains unidentified.
The resultant, complete classification header markings for each packet would
be as shown in figure 6.14.2.1-2.
Figure 6.14.2.1-2: GTP-U Packet Header
Example entries are shown in parentheses in each sub-field in the figure. The
markings are for a PDU carrying an I-Frame for Temporal Enhancement Layer #1
and Spatial Enhancement Layer #1 of an H.264 video stream. Here both
enhancement layers are dependent on base layer instances as indicated by the
Level 2 and Level 3 dependency fields.
#### 6.14.2.2 Policy for PDU Families
Packets are classified according to the PDU Sets in PDU Families to which they
belong so differentiated QoS that considers PDU Family and PDU Set
classification can be applied according to policy provisioned on the SMF or
conveyed from the PCF. As per clause 5.7.3 of TS 23.501 [2], currently
Priority Level indicates a priority in scheduling resources among QoS Flows.
PER and PDB are also assigned per QoS Flow. In this solution it is assumed
that each QoS Flow is still assigned a pre-configured or standardized Priority
Level, PER and PDB as in standardized 5QI characteristics table (see clause
5.7.4 of TS 23.501 [2]), or a priority level, PER or PDB for the QoS Flow is
signalled over NGAP. This is the Reference Priority level, PER and PDB for all
the packets within the QoS Flow.
To vary Priority Level, PER and PDB according to how a packet is classified, a
per-packet adjustment to the Reference Priority Level can be determined
according to new **Parameteradjustment information** provided in QoS
information that is pre-configured, associated with a standardized 5QI or sent
from the PCF to the NG-RAN, and/or UE. The Parameteradjustment information
contains per PDU Family /PDU Set Type adjustments to the Reference
ParameterLevels. For each PDU Family and PDU Set type to which a packet
belongs, the ParameterAdjustment information provides a value that is added to
the Reference Parameter. The resultant sum for all adjustments to the
Reference Priority determines the priority of the packet.
To illustrate using the Priority Level QoS parameter, as per Table 5.7.4-1 of
TS 23.501 [2], a standardized 5QI=89 (Visual content for cloud/edge/split
rendering) with a default (Reference) Priority=25 could be selected to
transport H.26x video. The priority level adjustment information provided to
the NG-RAN corresponding to the packet classification illustrated in Table
6.14.2.1-1 could be as shown in Table 6.14.2-2 (note a reduced priority level
means higher priority).
Packets received at the NG-RAN with GTP-U markings as described above in
clause 6.14.2.1 would have their reference parametersadjusted according to the
PDU Family and PDU Set Type to which they are associated. For instance, if the
reference Priority Level is 25, packets classified as belonging to PDU Set
Type #1 (I-Frame) in PDU Family #1 (Media Frame / Slice) would have their
priority level decreased by \"2\"
Table 6.14.2-2: Priority Level Adjustment for H.26x Video for PDU Sets shown
in Table 6.14.2.1-1
+-------------+-------------+-------------+-------------+-------------+ | | PDU Family | PDU Family | PDU Family | PDU Family | | | #1 | #2 | #3 | #4 | | | | | | ( | | | (Frame | (Media | (Media | Application | | | Type) | Layer 1) | Layer 2) | Type) | +=============+=============+=============+=============+=============+ | PDU Set | 0 | 0 | 0 | 0 | | Type #0 | | | | | | (not | | | | | | assigned) | | | | | +-------------+-------------+-------------+-------------+-------------+ | PDU Set | -2 | -2 | -1 | +1 | | Type #1 | | | | | +-------------+-------------+-------------+-------------+-------------+ | PDU Set | +2 | 0 | +1 | -1 | | Type #2 | | | | | +-------------+-------------+-------------+-------------+-------------+ | PDU Set | | +1 | +2 | | | Type #3 | | | | | +-------------+-------------+-------------+-------------+-------------+ | PDU Set | | | | | | Type #4 | | | | | +-------------+-------------+-------------+-------------+-------------+
To further illustrate, the QoS Flow Reference Priority Level=25 would be
decreased by 2 if the packet carries an I-Frame (PDU Family #1, Media Type
#1), increased by 1 if the packet carries a Temporal Enhancement Layer 2 (PDU
Family #2, Type #3), decreased by 1 if it is in the base Spatial Layer (PDU
Family #4, Type #1), and increased by 1 because it is an H.264 video
application (PDU Family #5, Type #1) so the resultant priority for the example
packet is 24.
Similar tables may provide adjustments to the reference level for PER and PDB.
These tables would be provided to the, NG-RAN, and/or UE, for example to the
NG-RAN in an expanded QoS Profile so the, RAN, and/or UE can treat packets
with corresponding classification markings with the appropriate priority.
In addition, for each PDU Set Type in each PDU Family, a PDU Set Validity Time
as described in clause 6.14.1 may be provided. The PDU Set Validity Time may
be used by the NG-RAN to decide whether to transmit or drop the PDUs of a PDU
Set instance.
Additional QoS differentiation may be provided with additional policy
information similar to Table 2 for other QoS Parameters. For example, ARP may
be varied depending on whether a packet belongs to a base vs an enhancement
layer.
### 6.14.3 Procedures
#### 6.14.3.1 PDU Set integrated packet handling
A high level procedure of PDU Set integrated packet handling is shown in
Figure 6.14.3.1-1.
Figure 6.14.3.1-1: High-level Procedure of PDU Set integrated packet handling
As shown in Figure 6.14.3.1-1, a schematic diagram of the modification process
of the PDU session for the XR service is given. The process includes the
following steps:
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [3] for a given DNN/S-NSSAI.
1\. Optionally, as defined in clause 4.15.6.6 of TS 23.502, the AF may invoke
the Nnef_AFsessionWithQoS_Create request to set up an AF session with required
QoS. In the step 1, the AF may send the following information to PCF:
a) Flow description of the target media service data flows for PDU Set
handling.
b) Assistance information describing media and media characteristics such as
Burst periodicity, number of temporal and spatial media layers and their
periodicities and dependencies, and Media Detection Rules that specify the RTP
header type (for media where RTP header is used).
c) The PDU Set level packet handling/treatment requirements. The PDU Set level
packet handling/treatment requirements are optional and may include e.g. PDU
Set Level Priority, PDB and PER.
2\. PCF may initiate the PDU Session modification procedure as defined in
clause 4.3.3.2 of TS 23.502 [3]. The PCF generates appropriate PCC rules based
on configuration and the information from AF if supplied in step 1,. The PDU
Set/PDU Family level packet handling/treatment requirements may be considered
during the PCC rule generation. The PCC rules may also include the detection
rules of service data flow, PDU Set level packet handling/treatment policy and
PDU Set Media Detection and Classification rules. The PCF sends the PCC rules
to SMF.
3\. SMF generates the QoS profiles and N4 rules based on the PCC rules from
PCF, which may include the packet handling/treatment policy. SMF sends the N4
rules to UPF, which may include the Media Detection and Classification rules
for PDU Set(s) in one or more PDU Families. The SMF also sends the QoS
profiles to the RAN node via AMF, instructing the RAN to perform PDU Set
integrated QoS handling and Media Detection and Classification rules and PDU
Set level parameters to the UE
4\. Based on received N4 rules or local configuration on the UPF, the UPF
identifies media units associated with a downlink PDU, classifies the PDU
according to the QoS Flows and PDU Set(s) to which it belongs and marks PDU
Set info in the GTP-U layer header in the DL packets, including for each PDU
Family, the QoS Flow ID, PDU Set ID (e.g. P-Frame), the instance of the PDU
Set (e.g. frame instance number), and optionally a PDU Start/End flag and the
instance number of a PDU Set on which this PDU Set instance depends (e.g.
I-Frame instance number).
5\. For downlink PDUs, the RAN identifies the PDU Set(s) to which a PDU
belongs based on the PDU Set info in the GTP-U header and transmits the PDUs
in an integrated manner according to per-PDU Set parameters provided in the
QoS Profile (Priority Level, PER and PDB adjustment and PDU Set Validity Time
as described in clause 6.14.2.2) and the PDU\'s membership in the PDU sets.
The RAN may drop all PDUs in a PDU Set in case of poor network conditions,
when the Validity Time for the PDU Set has expired or when a PDU Set on which
a PDU depends is not successfully sent.
6\. Based on Media Detection and Classification rules received from the SMF or
local configuration, the UE identifies the media units associated with an
uplink PDU and classifies the PDU according to the PDU Set(s) to which it
belongs. The UE transmits the PDUs in an integrated manner according to per-
PDU Set level parameters provided by the SMF (e.g. Priority Level adjustment
and PDU Set Validity Time, and the PDU\'s membership in the PDU sets.
NOTE: The details of RAN behaviour to enforce policy is up to RAN WGs.
### 6.14.4 Impacts on services, entities and interfaces
PCF:
\- Support per-PDU Family policy.
UPF:
\- Support Media Unit Identification and Classification.
UE:
\- Support Media Unit Identification, Classification, Per-PDU Family Policy
and Prioritization of Packets within a QoS Flow (for uplink PDU Set integrated
packet handling).
SMF:
\- Configure per-PDU Family policy (via QoS Profile and QoS Parameters).
NG-RAN:
\- Support Per-PDU Family Policy and Prioritization of Packets within a QoS
Flow.
## 6.15 Solution #15: Leverage RTP layer info for PDU Set handling
### 6.15.1 Key Issue mapping
This solution applies to Key Issue #4 \"PDU Set integrated packet handling\"
and Key Issue #5 \"Differentiated PDU Set Handling\".
### 6.15.2 Description
RTP (A Transport Protocol for Real-Time Applications) as specified in RFC 3550
[9] is widely used for transmitting real-time data, such as interactive audio
and video. An RTP packet has fixed RTP header format, and the RTP payload
could be different media data e.g. H.264 encoded video. A particular kind of
payload data has its RTP Payload Format, e.g. for H.264, the RTP payload
header format is specified in RFC 6184 [12]. The info carried in RTP header
e.g. Marker bit (M), Timestamp, and the info carried in RTP payload header
e.g. NRI, S bit, E bit, NAL unit payload type could be used by 5GS to identify
the PDUs of one PDU Set, or to differentiate the importance of PDU Sets. For
example, as described in RFC 3550 [9], the Marker bit (M) is intended to allow
significant events such as frame boundaries to be marked in the packet stream.
And for H.264 encoded video, as described in RFC 6184 [12], NRI with the value
of [0,3] indicates the relative transport priority of the RTP packet, 0
indicates the NAL unit can be discarded without risking the integrity of the
reference pictures, while the RTP packets of an I frame should have the NRI
value of 3. S bit and E bit indicate the start and end of a NAL unit which is
fragmented into several RTP packets. The RTP header also contains sequence
number which indicates the packet sequence at RTP layer. With the RTP layer
sequence number, 5GS can identify the sequence of PDU Set and the packet
sequence within a PDU Set, thus can allocate \"PDU Set Sequence number (SN)\"
and \"PDU SN within a PDU Set\".
\- PDU Set SN: All PDUs corresponding to the same PDU Set have the same PDU
Set SN. PDU Set SN is increased monotonously for each PDU Set.
\- PDU SN within a PDU Set: indicates the sequence number of the PDU within a
PDU Set.
For DL packets, this solution proposes to extend UPF capability to read the
RTP layer info i.e. info carried in RTP header and RTP payload header for the
XR traffic. With the RTP layer info, UPF can identify the PDUs of one PDU Set,
PDU Set sequence, packet sequence within a PDU Set, and to differentiate the
importance of PDU Sets. UPF then marks the start packet and end packet of the
PDU set, \"PDU Set Sequence number (SN)\", \"PDU SN within a PDU Set\", and
marks the importance info to the N3 encapsulation header. When gNB receives DL
packets from UPF, with the DL data header marked by UPF, gNB can identify the
PDUs of one PDU Set, PDU Set sequence, packet sequence within a PDU Set, and
get the importance info of each PDU Set.
For UL packets, UE\'s AS layer can get the PDU Set related info from its upper
layer, and requests the radio resource of each PDU Set from gNB by AS layer
interaction, thus is not in scope of this solution.
### 6.15.3 Procedures
The control plane procedure for PDU Set handling is described in the Figure
6.15.3-1.
Figure 6.15.3-1: Control plane procedure for PDU Set handling
1\. AF provides service information to the PCF by invoking
Npcf_PolicyAuthorization_Create Request or Npcf_PolicyAuthorization_Update
Request service operation as described in step 1a in clause 4.16.5.2 of TS
23.502 [3]. In this step AF requests for PDU set level handling of the SDF(s)
by a PDU set handling indication. For the untrusted AF, NEF can be involved
between the AF and PCF.
2\. PCF generates the authorized PCC rule(s) based on the AF request, and
performs PCF initiated SM Policy Association Modification procedure as defined
in clause 4.16.5.2 to provide the PCC rule(s) to SMF. The PCC rule(s) also
include PDU set handling indication to indicate the SDF(s) should be handled
at PDU set level.
3\. SMF performs QoS flow binding with taking consideration of the PDU set
handling indication, and initiates PDU Session Modification procedure as
described in clause 4.3.3.2 of TS 23.502 [3]. During this procedure, UE
receives QoS rule(s) with the PDU set handling indication, RAN receives QoS
Flow level QoS profile(s) with the PDU set handling indication, UPF receives
N4 rule(s) with the PDU set handling indication.
After the control plane signalling interaction, for DL traffic, UPF performs
traffic filtering with the received N4 rule(s), for the packets which match a
N4 rule with the PDU set handling indication, UPF reads the RTP header and RTP
payload header. With the RTP layer info, UPF decides the PDUs belong to one
PDU Set, PDU Set sequence, packet sequence within a PDU Set, and decides the
importance of PDU Sets. UPF then marks the start packet and end packet of the
PDU set, \"PDU Set Sequence number (SN)\", \"PDU SN within a PDU Set\", and
marks the importance info to the N3 encapsulation header. When gNB receives DL
packets from UPF, for the traffic belong to a QoS Flow with the PDU set
handling indication, gNB identifies the PDUs of one PDU Set, PDU Set sequence,
packet sequence within a PDU Set, and get the importance info of each PDU Set
by the N3 encapsulation header marked by UPF, then gNB is able to perform PDU
Set level scheduling. For UL traffic, if the packets match a QoS rule with the
PDU set handling indication, the UE indicates to its AS layer for PDU Set
level handling and provides the PDU set related info to its AS layer, which
are UE implementation dependent.
### 6.15.4 Impacts on services, entities and interfaces
PCF:
\- Receives PDU set handling indication from AF.
\- Generates PCC rule with PDU set handling indication.
SMF:
\- Performs QoS Flow binding with the consideration of PDU set handling
indication.
\- Providing PDU set handling indication to UE/RAN/UPF.
UPF:
\- For DL traffic, reads the RTP header and RTP payload header, and decides
the PDUs belong to one PDU Set, PDU Set sequence, packet sequence within a PDU
Set ,decides the importance of PDU Sets.
\- For DL traffic, marks the start packet and end packet of the PDU set, \"PDU
Set Sequence number (SN)\", \"PDU SN within a PDU Set\", marks the importance
info to the N3 encapsulation header.
RAN:
\- For DL traffic, identifies the PDUs of one PDU Set, PDU Set sequence,
packet sequence within a PDU Set, and get the importance info of each PDU Set
by the N3 encapsulation header marked by UPF.
\- PDU Set level scheduling.
UE:
\- Receives QoS rule(s) with PDU set handling indication.
\- Handling UL traffic with PDU Set info consideration, which are UE
implementation dependent.
## 6.16 Solution#16 : RTP/SRTP based PDU Set identification
### 6.16.1 Key Issue mapping
This solution addresses the following questions from Key Issue #4 and Key
Issue #5
Key Issue#4:
\- What information should be provided to the 5GS regarding PDU Set for
integrated packet handling, and how such information should be provided.
\- How the 5GS identifies that a PDU belongs to a specific PDU Set.
Key Issue#5:
\- How does the 5GS identify the PDUs of one PDU Set.
### 6.16.1 Description
5GS needs to provide enhanced QoS treatment for PDU Sets corresponding to the
XR and Media traffic. The application traffic for these services can
correspond to diverse transport protocols. Typical streaming media
applications tend to use RTP or SRTP as transport protocols. Additional
information about the SDF is required to detect and identify PDU Sets from
this traffic at the end points of 5GS. This information can be provided by the
Application Function which has more detailed information about the traffic.
5GS already provides interfaces through which AF can provide traffic influence
parameters for specific Service Data Flow. This solution describes the
additional information required for handling XR and media traffic using RTP
and SRTP flows.
### 6.16.1 Procedures
#### 6.16.1.1 Enhancements to IP Packet Filter Set
Currently 5GS uses the IP Packet Filter Set to derive the QoS rule and Packet
Detection Rule to identify and classify one or more IP Packets. The following
components or combination of these are used for IP Packet Filter Sets as
defined in clause 5.7.6 of TS 23.501 [2].
\- Source/destination IP address or IPv6 prefix.
\- Source / destination port number.
\- Protocol ID of the protocol above IP/Next header type.
\- Type of Service (TOS) (IPv4) / Traffic class (IPv6) and Mask.
\- Flow Label (IPv6).
\- Security parameter index.
\- Packet Filter direction.
To identify and map IP packets to one or more PDU Sets, the following
components or combinations of them could additionally be used in creating IP
packet filter sets.
RTP header based condition.
RTP pay-load based condition.
RTCP header based condition.
SRTP header based condition.
SRTP pay-load based condition.
SRTCP header based condition.
The AF can provide the additional conditions for an SDF through packet
filtering information in NEF service, Nnef_TrafficInfluence.
Figure 6.**16**.1.1-**1:** AF provisioned guidance for PDU Set identification
#### 6.16.1.2 Conditions for IP packets based on RTP
The conditions based on RTP header could be defined based on either one or a
combination of the following fields.
Use of **RTP Header extension information** : RTP Header extensions can carry
additional information on PDU Set type, codec type: RFC 3550 [9], RFC 3551
[20].
Use of **marker bit in RTP header** : the marker bit can identify the PDU Set
boundaries. This information could be used along with a condition to map
timestamp/payload type to identify IP packets belonging to a PDU Set. RFC 3550
[9].
Use of **RTP header from hint track:** ISO/IEC 14496-12 [22], TS 26.244 [23].
The conditions based on RTP payload: RFC 6184 [12], RFC 7798 [21].
Additional information derived from parsing of RTP payload header can
**identify PDU Set boundaries.**
Determination of **PDU Set start and end based on RTP Payload format RFCs.**
Processing of an IP packet with a configured IP filter set may also depend on
the status/result of processing of previous IP packets. The UPF processing
enhanced packet filter sets may maintain state information of previous IP
packets it has processed/sorted into PDU Sets, potentially till the PDB window
for each PDU Set.
PCC Rules are able to specify rules for mapping RTCP packets per Application
ID with existing architecture. In scenarios where AF does not want to use
Application ID linked packet filters to identify RTCP flows, there needs to be
a support for additional fields in the IP packet filter set to handle RTCP
traffic. AF could also specify an RTCP header parsing information to map RTCP
packets to a different QoS Flow.
#### 6.16.1.3 Condition for IP Packets based on SRTP
SRTP encrypts RTP payload only. Hence packet filter conditions can be
specified using parsing of header information for SRTP streams.
The conditions based on SRTP header RFC 3711 [10] could be defined based on
either one or a combination of the following fields.
Use of SRTP Header extension information - RTP Header extensions can carry
additional information on PDU Set type, codec type
Use of marker bit in SRTP header -- the marker bit can identify the PDU Set
boundaries. This information could be used along with a condition to map
timestamp/payload type to identify IP packets belonging to a PDU Set.
### 6.16.3 Impacts to existing nodes
NEF:
\- Enhancement to the TrafficInfluence Service to enable AF to specify
additional packet filtering information.
SMF:
\- Configuring PDRs and QoS Rules based on packet filter sets with additional
information.
PCF:
\- Use of additional information to derive packets filter set for PCC rules.
UPF:
\- Use of PDR with enhanced packet filter Sets to map downlink IP packets to
PDU Sets.
\- Mapping to PDU Sets from IP filter sets may require UPF to have knowledge
of previously processed packets.
UE:
\- Use of QoS Rules with enhanced packet filter Sets to map uplink packets to
QoS Flows.
## 6.17 Solution #17: Sub QoS Flow based QoS and PCC Architecture
### 6.17.1 Key Issue mapping
This solution is for KI #4/5 PDU Set integrated packet handling and
Differentiated PDU Set Handling.
### 6.17.2 Description
#### 6.17.2.1 Sub QoS Flow based QoS Architecture
##### 6.17.2.1.1 Sub QoS Flow based QoS Architecture
Since the pre-Rel-18 QoS Flow is not suitable for the same XRM service stream
(e.g. video stream) with different type of PDU Sets with different importance
and QoS requirements. We propose to extend the QoS Flow based QoS framework
that the QoS Flow is still the finest QoS control in the 5GS, but a QoS Flow
will compose multiple sub QoS Flows. The different Type of PDU Sets of a QoS
Flow are mapped to different sub QoS Flows of the associated QoS Flow. The QoS
flow still has a QoS profile, it is named as main QoS profile. Each sub QoS
Flows of a QoS Flow have its own QoS Profile, it is called the sub QoS Flow
profile. All the sub QoS profiles and associated main QoS profile have the
same 5QI but have different QoS characterise.
Figure 6.17.2.1-1: The principle for classification and User Plane marking for
QoS Flow and its Sub QoS Flow and mapping to AN Resources
#### 6.17.2.2 The differences between the Sub QoS Flow based QoS Architecture
and pre-Rel-18 QoS Architecture
The sub QoS Flow based QoS architecture is proposed and the main difference
with the pre-Rel-18 QoS architecture is listed as below (not exhausted):
1) The user plane traffic (e.g. a XRM video service stream) is composed of
different type of PDU Sets.
2) All the PDU Sets of a XRM user plane traffic is mapped to the same QoS
Flow.
3) The QoS Flow is composed with multiple sub QoS Flows, i.e. the different
PDU Set can be mapped to different sub QoS Flow of the QoS Flow.
4) Each Sub QoS Flow is identified with a XQFI which is composed with the QoS
Flow ID (QFI) and a sub QoS Flow ID (SQFI), the XQFI (= QFI + SQFI) is unique
per UE and the SQFI is unique per QoS Flow.
5) The XQFI is used in the GTP-U header in the N3/N9 GTP-U traffic for the XRM
PDU Sets.
6) The XRM QoS Flow is associated with a main QoS profile and multiple sub-QoS
profiles, each sub QoS Flow is associated with a sub QoS profile. The main QoS
profile is used as the QoS profile defined by the pre-Rel-18 and is used by
the QoS Flow without any sub QoS Flow.
NOTE: There are multiple QoS Flows in a PDU Session, some QoS Flows can be the
pre-Rel-18 QoS Flow without any sub QoS Flow, and some QoS Flows can have its
sub QoS Flows.
7) All the sub QoS profiles and associated main QoS profile have the same 5QI
but have different QoS characterise. i.e. each sub QoS flow can has its own
priority Level, maximum Data Burst Volume, Averaging Windows for the same 5QI.
8) No bitrate is defined for any sub QoS Flow, i.e. there is no GBR, MBR and
AMBR for any sub QoS Flow.
9) All the Sub QoS Flow share the bit rates (GBR and/or MBR) of the associated
main QoS Flow.
10) The same sub QoS Flow profile shall not be used for the different sub QoS
Flows of the same QoS Flow, i.e. different sub QoS Flows of the same QoS Flow
shall not use the same QoS profile. If two different PDU sets of a QoS Flow
need the same QoS profile, the two different PDU sets shall be mapped into the
same sub QoS Flow.
11) The XRM QoS rules provided by the PCF to the SMF includes the main QoS
rules and sub QoS rules based on the XRM stream information provided by the
XRM AF and based on its local configuration.
12) The SMF provides the XQFI (QFI and SQFI), PDR for XQFI and QER for XQFI in
the N4 rules to the UPF based on the received XRM QoS rules from PCF.
13) The SQFI value can be used as the priority/importance information.
14) The UPF identifies the PDU Sets based on PDRs rules from the SMF and
enforces the QER for the identified PDU Sets.
15) The UPF maps the DL PDU Sets to a QoS Flow and a Sub QoS Flow of the QoS
Flow and includes the XQFI in the encapsulation GTP-U header.
16) UPF performs transport level packet marking in DL on per sub QoS Flow
basis. The UPF uses the transport level packet marking value provided by the
SMF.
17) The SMF provides the XQFI and XQFI QoS profile in the QoS profile of the
QoS Flow for the XRM to the RAN.
18) The RAN maps PDUs from sub QoS Flows to access-specific resources based on
the XQFI and the associated 5G QoS profile, also taking into account the N3
tunnel associated with the DL packet.
19) The RAN can drop the all the packets of the PDU Set with the least
importance if the RAN in congestion state.
20) The SMF provides the main NAS QoS rules and XQFI NAS QoS rules for the XRM
to the UE.
21) The UE performs the classification and marking of UL User plane traffic,
i.e. the association of XRM UL traffic to a QoS Flow and sub QoS Flows, based
on QoS rules.
22) The RAN schedules and receives the UL Sub QoS Flow based on XQFI and
associated Sub QoS Flow QoS Profile.
23) The RAN marks the received Sub QoS Flow with XQFI in the GTP-U header and
marks the DSCP/ToS in the transport layer header and forwards the sub QoS Flow
to the UPF via the N3 interface.
24) If the reflective QoS is activated for a QoS Flow, the reflective QoS is
automatically activated for all sub QoS Flows associated with this QoS Flow,
and there is no special reflective QoS for a sub QoS Flow.
#### 6.17.2.3 Sub QoS Rules based PCC Architecture
##### 6.17.2.3.1 RTP/SRTP based XRM Traffic stream information and PCC rules
If the XRM traffic is carried in RTP/SRTP payload, and XRM AF provides the XRM
stream information to the PCF as below:
\- IP Packet Filters as defined in clause 5.7.6.2 of TS 23.501 [2] (including
the UDP ports for the RTP/SRTP).
\- GBR and or MBR.
\- RTP Payload type for media type (e.g. H.264/H.265/H.266/VP9/AV1) and clock
frequency to measure the timestamp in the RTP header.
\- SSID : synchronization Source Identifier.
\- Possible special Label Information as defined in related RFC (e.g. RFC 6184
for H.264, RFC 7798 for H.265), including:
\- Layer ID (mandatory for H.265/H.266).
\- Temporal ID (mandatory for H.265/H.266).
\- NRI (mandatory for H.264).
\- NAL Type (optional for H.264/5/6).
\- Other ID and Flags, e.g. DID, QID and Discardable Flag.
The PCF will generates the PCC rules to the PCF to SMF, the PCC Rules include
the main PCC rule for the XRM streams identified by the SDF detection (e.g.
the IP packet filter set and Precedence) and also include additional sub PCC
Rules associated with the main PCC rule for the SDF detection with additional
different ID (e.g. the different combination of LID, TID and NAL Type, if
available).
The main PCC rule and associated additional sub PCC rules have the same 5QI
but with different 5QI QoS characteristics, and additional PCC rule also
include new QoS Control parameters e.g. discardable flag, important/Priority
Index.
The main difference between the proposed PCC rules and the pre-Rel-18 QoS
rules is listed as below (not exhausted):
\- The XRM SDF is composed of different SDF templates for different PDU Sets.
\- All the SDF templates of a XRM SDF is associated with the same PCC rule.
\- The PCC rule is composed with a main PCC rule and multiple sub PCC rules,
i.e. the different SDF template is associated with a different sub PCC rule.
\- All the sub QoS profiles in the sub PCC rules and associated main QoS
profile in the main PCC rule have the same 5QI but have different QoS
characterise. i.e. each sub QoS profile can has its own priority Level,
maximum Data Burst Volume, Averaging Windows for the same 5QI.
\- No bitrate is defined for any sub QoS profile, i.e. there is no GBR, MBR
and AMBR for any sub QoS profile.
\- All the Sub QoS profile share the bit rates (GBR and/or MBR) of the
associated main QoS profile.
\- The XRM QoS rules provided by the PCF to the SMF includes the main PCC rule
and sub PCC rules.
\- The SMF performs the binding between the main PCC rules with a QoS Flow and
also performs the binding between the sub PCC rules with a sub QoS Flow with
the associated bounded QoS Flow.
\- The SMF provides the XQFI (QFI and SQFI), PDR for XQFI and QER for XQFI in
the N4 rules to the UPF to ask the UPF to enforce the QER for the QoS and sub
QoS flows based on PDR.
\- The SMF provides the XQFI and XQFI QoS profile in the QoS profile of the
QoS Flow for the XRM to the RAN.
##### 6.17.2.3.2 PCC rules if XRM stream information is not available
In some cases, the XRM AF cannot or does not provide the XRM service stream
information to the PCF. In such case, the PCF may activate the Configured QoS
rules in the SMF, and the SMF can provide some general PDR to the UPF to
intelligently detect the XRM traffic and performance the mark. E.g. based on
the time between the two successive PDU burst to determine the FPS (Frame per
Second) of the XRM media, and start/end of the PDU set (and the PDUs between
the start and end of the PDU set) if there is only one PDU set in the PDU
burst. If there are multiple PDU Sets within a PDU burst, the UPF can
intelligently get FPS, the number of the PDU set, start/end of a PDU set (and
all the PDUs of this PDU set) based on packet size of the last PDU of the PDU
set, since normally the size of the last PDU is less than the MTU while all
other PDUs of the PDU set are in the full size of MTU.
Also, the normally the UPF can intelligently detect the I-type frame (in H.264
there is only one type frame for I frame, but there are 6 type frames for I
frame in H.265 and there are 4 type frames for I frame in H.266) since
normally the I frame is the largest frame in the XRM stream and about 5 times
bigger than the P type frame and about 20 times bigger than the B type frame.
And normally the more important frame within the B/P frames are the frame in
the first received frames after the I frame.
Based on the information provided by the SMF, the UPF can intelligently
identify the most important I frame, and second important (P) frame just
following the I frame and other less important (B) frame in the XRM stream.
However such important information maybe is not reliable in some cases. But
the detected FPR, the start/end PDU (and the all the PDUs) of a PDU Set are
very reliable in practice and works well even when the traffic is encrypted.
Based on the detected information, the UPF can mark the QoS Flow and Sub QoS
Flows in the GTP-U header as described in clause 2.
And the SMF generates and provides the main QoS profile and the sub QoS
profiles to the RAN based on the activated configured QoS rule from the PCF.
The SMF generates and provides the main NAS QoS rule and the NAS sub QoS Rules
to the UE.
### 6.17.3 Procedures
Figure 6.17.3-1
0\. The PDU Session for the XRM service is established, the user initiated the
XRM service.
1\. The XRM AF/NEF sends Npcf_PolicyAuthorization_Create/Update request (UE
address, AF Identifier, Flow description, QoS requirements) request to the
PCF. The Flow description can include the information described in clause
6.17.2.2.1.
2\. The PCF sends the Npcf_SMPolicyControl_Update Notify (PCC rules) to the
SMF. The PCC rules include the sub QoS Rules as described in clause
6.17.2.2.1.
3\. The steps 3 to 12 are the same with the step in clause 4.3.3.2 of TS
23.502, with the NAS QoS rules include the Sub QoS Rules (XQFI, packet
filters, 5QI, 5QI characteristics, DSCP/ToS). The N2 QoS Profiles include the
sub QoS profiles (XQFI, 5QI, 5QI characteristics, DSCP/ToS for UL transport
layer marking). The N4 rules include the sub N4 rules (XQFI, packet filters,
5QI, 5QI characteristics, DSCP/ToS for DL transport layer marking).
After step 8, the UPF begins to use the PDR to identify the PDU sets and add
the XQFI for the matched PDU set in the GTP-U header, and marks the DSCP/ToS
(based on the PFR provided by the SMF) to the transport IP header and forward
the DL PDU Set to the RAN via the N3/N9 interface.
After the RAN receives the PDU Set with the extension XQFI in the GTP-U
header, the RAN uses the XQFI to match the Sub QoS Flow QoS Profile, and uses
the QoS parameters and 5QI characteristics in the matched Sub QoS Flow QoS
Profile to scheduling the DL PDU Set to the UE.
The UE performs the classification and marking of UL User plane traffic, i.e.
the association of XRM UL traffic to a QoS Flow and sub QoS Flows, based on
QoS rules.
The RAN schedules and receives the UL Sub QoS Flow based on XQFI and
associated Sub QoS Flow QoS Profile.
The RAN marks the received Sub QoS Flow with XQFI in the GTP-U header and
marks the DSCP/ToS in the transport layer header and forwards the sub QoS Flow
to the UPF via the N3 interface.
13\. The SMF responses to the PCF.
14\. The SMF responses to the AF/NEF.
### 6.17.4 Impacts on services, entities and interfaces
AF/NEF:
\- Provides new/updated XRM stream information including the media important
information and possible NAL type information.
PCF:
\- Provides the new PCC rules including the Sub QoS PCC rules to the SMF.
SMF:
\- Includes the Sub QoS Flow packet filter , XQFI, and DSCP/ToS marking for
the Sub QoS Flow in N4 session rule.
\- Includes Sub QoS Flow QoS profile and XQFI to the RAN.
\- Includes the Sub QoS Flow Packet Filter and XQFI in the NAS QoS rules to
the UE.
UPF:
\- Identify the DL PDU Set with XQFI and forwards the XQFI to the RAN.
\- Performs the QoS control for the Sub QoS Flow (i.e. PDU Set).
RAN:
\- Scheduling and admission control for the Sub QoS Flow based on the QoS
Profiles of the Sub QoS Flow QoS Flow and associated QoS Flow.
UE:
\- Identify the UL PDU Set with XQFI and forwards the XQFI to the RAN.
## 6.18 Solution #18: PDU Set Identification and Marking
### 6.18.1 Key Issue mapping
This solution is for KI #4/5 PDU Set integrated packet handling and
Differentiated PDU Set Handling.
### 6.18.2 Description
For the DL XRM service stream, the UPF needs to identify the PDU Sets in the
QoS Flow and also needs to marks the identified PDU Sets in the N3/N9
interface to the RAN.
The DL XRM service stream can be carried on RTP/SRTP or not in STP/SRTP from
N6 interface, two ways to identify the PDU Sets in RTP/SRTP or not. The UPF
also needs to identify the different PDU Sets in a PDU burst, the start/end of
each PDU Set, the importance/dependency of each PDU set.
The UPF then needs to mark the identified PDU Sets in the GTP-U header
(extended GTP-U header) of N3/N9 interface. The UPF need to mark the different
PDU Sets, the star/end of each PDU set, the important/dependency of each PDU
Set in the GTP-U extension header.
Finally, the UPF also needs to perform the transport level marking, i.e. the
DSCP/TOS for the identified PDU Sets.
For the UL XRM service stream, the UE performs the similar PDU Set
identification procedure as the UPF. How the UE performs the marking for the
identified PDU Set is defined in the RAN.
#### 6.18.2.1 How the UE/UPF detects the PDU Sets
##### 6.18.2.1.1 What information are provided to the 5GS to identify the PDU
Sets?
If the XRM service stream is carried over RTP/SRTP, the RFC 6184 [12] / RFC
6190 [13] has defined the encapsulation format for the H.264/AVC stream, the
RFC 7798 [21] has defined the encapsulation format for the H.265/HEVC stream.
The IETF WG draft is in process to define the encapsulation for the H.266/VVC
stream.
If the XRM service stream is carried over RTP/SRTP, it is assumed that the XRM
AF can provide the XRM service stream information to the PCF (via the NEF),
then these stream information are further provided to the UPF by the SMF in
the PDR to detect and to the UE by the NAS QoS rules, the UPF and UE use these
information to identify the PDU Sets.
Normally the XRM service stream information provided by the XRM AF can be in
SDP or MDP format, and XRM AF can change the format to provide the stream
information to the PCF via the service based interface.
The XRM service stream information can include the following information (not
exhausted):
\- IP Packet Filters as defined in clause 5.7.6.2 of TS 23.501 [2] (including
the UDP ports for the RTP/SRTP).
\- GBR and or MBR.
\- RTP Payload type for media type (e.g. H.264/H.265/H.266/VP9/AV1) and clock
frequency to measure the timestamp in the RTP header.
\- SSID : synchronization Source Identifier.
\- Special Label Information as defined in related RFCs (e.g. RFC 6184
[12]/RFC 6190 [13] for H.264, RFC 7798 [21] for H.265), including:
\- Layer ID.
\- Temporal ID.
\- NRI.
\- NAL Type.
\- Other ID and Flags, e.g. DID, QID and Discardable Flag.
The figure 6.18.2.1.1-1 provides the detailed information to identify the
first packet of a PDU Set.
Figure 6.18.2.1.1-1: The First Packet of a PDU Set.
##### 6.18.2.1.2 How the UE/UPF detects the start/end and importance of a PDU
Set over RTP/SRTP
If the XRM service stream is carried over RTP/SRTP, the UE/UPF can:
1\. Use the IP packet filter in the PDR (for UPF) or in the NAS QoS rules to
match the XRM service stream.
2\. Use the RTP payload type to identify the media type (e.g. H.264/H.265).
the RTP payload type can be provided in the PDR by the SMF.
3\. Use the RTP/SRTP header to identify the PDU Set type (i.e. the NAL type).
NOTE: For the Aggregated SRTP packet, the PDU Set type cannot be identified.
In such case, the predefined default PDU Set type can be used.
4\. Use the RTP/SRTP header information to identify the PDU importance, e.g.:
a) using the Layer ID + Temporal ID + PDU Set type for the H.265.
First, using the Layer ID + Temporal ID to compare the importance for the two
PDU Sets. Smaller value of the Layer ID, more importance of the PDU Set. If
the two PDU Sets have the same Layer ID, smaller value of Temporal ID, more
importance of the PDU Set. If the two PDU Sets have the same Layer ID and
Temporal ID, using the NAL type of the PDU Set to compare. E.g. IRAP type PDU
Set is more important than the TRAIL type PDU Set.
b) using the NRI and PDU Set type for the basic H.264.
First, using the NRI to compare the importance for the two PDU Sets. Smaller
value of the NRI, more importance of the PDU Set. If the two PDU Sets have the
same NRI, using the NAL type of the PDU Set to compare. E.g. I type PDU Set is
more important than P, and P is more important than B type PDU Set.
If multilayer H.264 is used, RFC 6190 will be used by the UPF, and similar
mechanism as defined for H.265 is used. Only the Layer ID and Temporal ID are
placed by other ID, e.g. the QID, TID, DID as defined in RFC 6190 [13].
5\. Use the \"Marker\" Flag in the RTP/SRTP header, \"Start\" and \"End\" Flag
in the payload header to identity the start and end of a PDU Set. The detailed
description can reference to the RFC 6184 [12] / RFC 6190 [13] /RFC 7798 [21].
##### 6.18.2.1.3 How the UE/UPF detect the start/end and importance of a PDU
Set without using RTP/SRTP
If the XRM stream is not carried in RTP/SRTP, it is assumed that XRM AF can
only provide the IP packet filters to identify the XRM service stream. In such
case, it is still possible for the UPF to identify the different PDU Sets. The
UE/UPF can:
\- Use DSCP/TOS to identify the different PDU Sets if the DSCP/TOS has been
marked in the XRM service stream by the XRM AF to identify the different NAL
type.
\- Use the time span between two successive PDU burst to determine the FPS
(Frame per Second) of the XRM media.
\- Use the size information of the PDU with the full MTU size and PDU with
less the MTU Size to determine the PDU Sets in a PDU burst and start and end
of all the PDU Sets in the PDU burst.
One example is showed in Figure 6.18.2.3-1, the H.265/HEVC stream has 3 slices
and the stream is delivered in the raw IP packet without using the RTP/SRTP
encapsulation. Using the number of the packets with size smaller than 1500
(MTU) in a PDU Burst, the slices number is 3. (Since there are some non-VCL
data in the video stream, like the SPS,PPS, the smaller packets of the packet
burst may be bigger than 3. Since some slice packets are small, packets from 1
or 2 slice are aggregated into one packet, so some packet bursts have 1 or 2
smaller packets. If the resolution of the video is increased, almost most of
the PDU bursts have 3 smaller packets).
\- Detect the I/P/B type frame for the H.264 service stream.
But it is some difficult for the UE/UPF to detect the frame type for the H.265
and H.266 stream (in H.264 there is only one type I frame, but there are 6
types of I frame in H.265 and there are 4 types of I frame in H.266). Since
normally in H.264, the I frame is the largest frame in the XRM stream and
about 5 times bigger than the P type frame and about 20 times bigger than the
B type frame. And normally the more important frame within the B/P frames are
the frame in the first received frames after the I frame.
\- Detect the important PDU Sets in a PDU burst. Normally the first arrived
PDU Set is decoded first and the decoded picture will be used by the following
pictures, so the more first arrived PDU Set, the more important.
Figure 6.18.2.1.3-1: Number of Packets with Size \< MTU (1500) in a H.265/HEVC
XRM stream
All in all, if the XRM service stream is totally encrypted or not pre-
configured information or no SLA information available, in some cases, the UPF
can still intelligently and correctly detect the different PDU Sets and the
start and end of a PDU Set and importance of the PDU Set. But in some cases,
the UE/UPF can only provide the start and end of the PDU Sets in a PDU burst,
but cannot provide the correct importance information for the PDU Set,
especially the importance information of the PDU Sets from the different PDU
bursts.
#### 6.18.2.2 How the UPF marks the PDU Sets in N3/N9 interface?
##### 6.18.2.2.1 PDU Set and XQFI marking
After the UPF has identified the PDU Sets, the UPF needs to mark the different
PDU Sets in the N3/N9 interface to the RAN in order to provide additional
information to help the RAN to different the radio resource admission control
and scheduling.
UPF marks PDU Sets with the proposed XQFI, the main functions are listed as
below. The QFI and XQFI list are provided by the SMF during the QoS Flow
establishment or during the QoS Flow modification procedure.
1) All the PDU Sets of a XRM user plane traffic is mapped to the same QoS
Flow.
2) The QoS Flow is composed with multiple sub QoS Flows, i.e. the different
PDU Set can be mapped to different sub QoS Flow of the QoS Flow.
3) Each Sub QoS Flow is identified with a XQFI which is composed with the QoS
Flow ID (QFI) and a sub QoS Flow ID (SQFI), the XQFI (= QFI + SQFI) is unique
per UE and the SQFI is unique per QoS Flow.
4) The XQFI is used in the GTP-U header in the N3/N9 GTP-U traffic for the XRM
PDU Sets.
5) The UPF maps the DL PDU Sets to a QoS Flow and a Sub QoS Flow of the QoS
Flow and includes the XQFI in the encapsulation GTP-U header.
6) UPF performs transport level packet marking in DL on per sub QoS Flow
basis. The UPF uses the transport level packet marking value provided by the
SMF.
##### 6.18.2.2.2 Start and End of PDU Set in N3/N9
There are two options, anyone of the two options can be supported in Rel-18:
1) No explicit start and end mark in the GTP-Header, the first GTP-U packet
with XQFI indicated the start of the PDU Set with XQFI, and last GTP-U packet
with XQFI indicated the end of the PDU Set with XQFI.
a) This method needs a timer in the GTP-U receiver (e.g. the RAN) to detect if
there is no any following GTP-U packet (e.g. the last PDU Set in a PDU burst),
then it concludes the end of the PDU Set with the XQFI.
2) Explicit start and end mark in the GTP-Header, i.e. the first GTP-U packet
with XQFI has the \"start\" marker in the GTP-U header and the last PDU has
the \"end\" marker in the GTP-U header.
a) This method normally needs a timer in the GTP-U sender (e.g. the UPF) to
detect if there if there is no any following GTP-U packet (e.g. the last PDU
Set in a PDU burst), then it marks the \"end\" in the GTP-U header.
Both methods need the GTP-U packets are delivered in order.
The SQFI is unique per QoS low and XQFI is unique per UE, e.g. PDU set-1 SQFI=
0010, PDU set-2 SQFI = 0012.
##### 6.18.2.2.3 Importance of PDU Set in N3/N9
There are two options, anyone of the two options can be supported in Rel-18:
1) Importance ID = SQFI, the value of sub QoS Flow ID (i.e. SQFI) indicates
the importance of the PDU Set.
Normally the smaller value, the more importance, the value of zero is the most
importance PDU Set.
2）Importance ID in the Sub QoS Flow QoS profile in control plane indicates the
importance of the PDU Set.
Normally, A XQFI identifies a PDU Set, and a Sub QoS Flow QoS profile with the
XQFI includes an Importance ID which indicates the importance of the PDU Set.
##### 6.18.2.2.4 Dependency of PDU Set in N3/N9
In the H.264, the P frame depends on I frame, the B frame depends on I frame,
P frame and possible other B frames. If there are multiple successive B (e.g.
over 3) frames in the GOP, it is very hard to identify the dependency between
these B frames.
In the H.265 and H.266, with different type of I frame (6 types of I frame in
H.265 and 4 types of I frame in H.266) and different type of B/P frame (10
types of B/P frame in H.265 and 4 types of B/P frame in H.266), it is very
hard to identify the dependency of the PDU Sets with the same Layer ID and the
same Temporal ID.
Since it is very easy to use the Layer ID, Temporal ID to identify the
dependency between different layer and between different temporal, and the
Layer ID and temporal ID is also used to identify the importance information
of the PDU Set, it is proposed that there is no explicit dependency ID
defined, and the importance ID can be used both as importance information and
dependency information.
### 6.18.3 Procedures
### 6.18.4 Impacts on services, entities and interfaces
UPF:
\- Detects and marks the PDU Sets.
UE:
\- Detects and marks the PDU Sets.
## 6.19 Solution #19: Application-aware QoS
### 6.19.1 Key Issue mapping
This solution addresses Key Issue #4 and #5.
### 6.19.2 Description
We assume reuse the current 5QI-based packet level QoS mechanism. How to
consider application level characteristics for efficiency is applied on top of
that. Accordingly how 5GS can recognize a PDU set the packet belongs to and
how to identify the PDU set and how to handle the packets of the PDU set are
determined.
### 6.19.3 Procedures
#### 6.19.3.1 General
When SM NAS procedures are performed 5QI-based packet level QoS policies are
applied. On top of the PDU level QoS policies PDU Set level QoS policies are
applied if the 5GS and UE subscription are allowed.
#### 6.19.3.2 PDU Session establishment procedure considering application QoS
policy
Figure 6.19.3.2-1: PDU Session establishment procedure considering application
QoS policy
The following additions apply compared to clause 4.3.2.2 of TS 23.502 [3]:
1\. PCF may have PDU set level QoS policy information if dynamic PCC is
applied.
2\. When UE request PDU session establishment, it includes XR/media dedicated
DNN and S-NSSAI, which may be standardized or determined by the operator.
3\. SMF retrieves the SM subscription from UDM, which includes indication
whether Application-level QoS mechanism is allowed in addition.
4-5. If dynamic PCC is applied PCC rules including PDU set level QoS policies
are provisioned to SMF in accordance with XR/media dedicated DNN and
S-NSSAI(see the clause 6.19.3.3). Otherwise, the SMF may apply local policy.
6\. The SMF may send an N4 Session Establishment/Modification Request to the
UPF and provides Packet detection, enforcement and reporting rules considering
PDU set level QoS information to be installed on the UPF for this PDU Session,
which includes if the application level QoS is supported(see the clause
6.19.3.3). Additionally includes indication that dedicated queue is required
for a QFI dedicated to HDRLL(high data rate low latency) or XR services.
Editor\'s note: Instead of using a dedicated queue, whether using different
dedicated QFIs per XR application or application ID specific info is used in
the GTP-U header in order to distinguish applications is FFS.
7-8. The SMF provides NG-RAN with N2 SM information for application level QoS
profiles, and the UE with N1 SM information for PDU set level QoS rules and
QoS parameters and QoS profiles, where the SMF includes an indication if the
application level QoS is supported in the N1 SM information and the N2 SM
information. Besides SMF includes indication that dedicated queue is required
for a QFI dedicated to HDRLL or XR services in the N2 SM information.
Editor\'s note: Instead of using a dedicated queue, whether using different
dedicated QFIs per XR application or application ID specific info is used in
the GTP-U header in order to distinguish applications is FFS.
10\. The SMF sends an N4 Session Modification Request to the UPF and provides
AN information as well as Packet detection, enforcement and reporting rules
considering PDU set level QoS information to be installed on the UPF for this
PDU Session (see the clause 6.19.3.3).
11a/b-12. XR/media data arrives at UPF. Then according to N4 rules the UPF
handles packets. Especially if the application level QoS is supported, PDU set
level QoS mechanisms are applied. For example, based on PDU level and PDU set
level detection, it marks the GTP header for DL packets e.g. 5QI, PDU set ID,
importance level of the PDU set, correlation sequence number of the PDU set,
etc. and UPF performs PDU set level QoS enforcement (see the clause 6.19.3.3).
For example, when transmission of a PDU set is considered as failed, packets
of another later PDU sets may be dropped if its importance level is same or
less, and it is assumed as correlated to the failed one by difference of
correlation SN.
13-11c. NG- RAN performs application level QoS enforcement if the application
level QoS is supported (see the clause 6.19.3.3). For example, when
transmission of a PDU set is considered as failed, packets of another later
PDU sets may be dropped if its importance level is same or less, and it is
assumed as correlated to the failed one by difference of correlation SN.
#### 6.19.3.3 PDU set level QoS policies and QoS handling
UPF identifies PDU sets by detecting some higher layer packet header e.g.
RTP/SRTP header in addition to the legacy packet detection mechanisms.
Accordingly the detected information can be added to GTP-U header e.g. PDU set
ID, importance level of the PDU set, correlation sequence number of the PDU
set, as well as 5QI.
PDU set level QoS policies are applied in addition to PDU level QoS policies
when the application level QoS policies are authorized to the UEs.
SMF derives PDU set level QoS policies/profiles as well as PDU level QoS
policies/profiles for the application level QoS policy authorized UEs.
Accordingly some enhanced N4 rules and QoS profiles considering PDU set level
QoS handling are delivered to UPF and NG-RAN.
So PDU Set integrated handling, QoS handling based on PDU Set importance, PDU
Set dropping due to delivery failure of dependent and lower important PDU
Sets.
### 6.19.4 Impacts on services, entities and interfaces
The followings are additionally required:
UDM:
\- Send SM subscription data indicating whether Application-level QoS
mechanism is allowed.
PCF:
\- Store and provide PCC rule including application level QoS policy
information to SMF.
SMF:
\- Provide application level QoS information to UPF and NG-RAN node.
UPF:
\- Detection/marking/enforcement/reporting of packets is performed by
application level QoS mechanisms per N4 rules
\- Marking for DL packets as PDU set characteristics.
NG-RAN:
\- Application level QoS enforcement is performed
\- Marking for UL packets based on PDU set characteristics that UE provides.
UE:
\- Provides PDU set characteristics of the UL packets to NG-RAN.
## 6.20 Solution #20: UPF based PDU Set identification
### 6.20.1 Key Issue mapping
This solution addresses KI#4 and defines how to identify the PDU set to which
a PDU belongs and how to determine the beginning and the end of a PDU Set.
### 6.20.2 Description
#### 6.20.2.1 Overall framework
Figure 6.20.2.1-1 describes the overall QoS framework for supporting PDU Set
identification with an emphasis on the necessary pieces of information and on
the role of the related network entities. The control plane related aspects
are described in Solution 25 in clause 6.25.
Figure 6.20.2.1-1: PDU Set based QoS framework: UP aspects for PDU Set
identification
#### 6.20.2.2 PDU Set identification based on N3 PDU Set metadata
The solution is based on the UPF generating additional N3 PDU Set metadata to
be provided in the PDU (i.e. GTP-U) headers to the RAN to help it identify PDU
Sets and to which PDU Set a PDU belongs, so that the RAN can properly
determine how to use the allocated resources. How the UPF generates the N3 PDU
Set Metadata is independent of how the N3 PDU Set Metadata is encoded and sent
to the RAN. Figure 6.20.2.2-1 shows the N3 PDU Set metadata added to the PDUs
by the UPF and sent to the RAN.
The UPF can generate the metadata in the following ways:
\- Based on metadata generated by the AS. The metadata provided by the AS to
the UPF may include similar information to the one included in the N3 PDU Set
Metadata (see below) and it can be signalled in a proprietary or in a
standardized way.
NOTE 1: Examples of PDU Set marking mechanisms are proprietary/non
standardized mechanisms. Some other examples are described in clauses
6.7.3.2.2 and 6.12.3.2. Solution X in clause 6.X (Negotiation of details of
marking mechanisms for AS to UPF communication) describes how such and other
marking mechanisms can be negotiated between AF and 5GS.
\- Based on implementation specific ways. The UPF may generate the N3 PDU Set
Metadata by analysing the UP data transferred by the AS and by applying, e.g.
deep packet inspection.
NOTE 2: PDU Set detection mechanisms such as deep packet inspection and
machine learning does not work in case fully end-to-end encrypted traffic
(e.g. HTTPS). However, according to NOTE 2 in clause 4.1, the scenario of
fully end-to-end encrypted traffic is not part of this study item.
NOTE 3: Details of the communication between UPF and RAN, and between RAN and
UE are to be discussed in RAN WG3 and RAN WG2, respectively.
Figure 6.20.2.2-1: UPF sending N3 PDU set metadata to the RAN
The following pieces of information are included in the UPF generated PDU Set
metadata sent to the RAN:
\- **PDU Set Identifier (PSID)**. This is necessary to identify to which PDU
Set a certain PDU belongs. The PSID needs to be added to each PDU header.
\- **PDU sequence number within the PDU Set**. This is used to identify the
position of each received PDU within the PDU Set and is helpful to identify
when the PDU Set begins and, in case PDUs arrive out of order, to properly
reconstruct the PDU Set.
\- **PDU Set size** (expressed in number of bits or of PDUs). This parameter
is used to identify when a PDU Set ends that the RAN can allocate the
appropriate amount of radio resources for the specific PDU Set. The PDU Set
size shall be consistent with the PDU Set maximum size associated to the QoS
Flow transporting the PDU Set (see clause 6.20). The PDU Set size is added to
the PDU Header of the first PDU of the PDU Set.
\- **Last PDU Indication**. This flag indicates whether or not a PDU is the
last PDU of a certain PDU Set (identified by the PDU Sequence Number).
NOTE 4: Certain applications may not be able to compute the PDU Set Size
before the whole PDU Set has been sent. In that case the Last PDU Indication
needs to be used.
\- **PDU Set Content Criteria and PDU Set Content Ratio**. These parameters
are optionally used if the PDU Set Content Criteria or the PDU Set Content
Ratio of the specific PDU Set differ from the default values of the QoS Flow
indicated at QoS Flow establishment (see clause 6.25).
NOTE 5: Additional parameters may be identified depending on, e.g. cooperation
with RAN WGs and SA WG4.
The PDU Set related parameters describe above are applicable both in DL and in
UL.
NOTE 6: The provision of PDU Set related parameters to the NG-RAN in DL is
independent of the DL detection mechanism. Similarly, the provision of UL PDU
Set related parameters from the UE to the NG-RAN is independent of the UE
detection mechanism.
The UPF selects the GTP-U tunnel over which the PDU Sets needs to be
forwarded. The mapping between XR traffic and QoS flows is done by using the
existing IP Packet Filter Sets mechanism (see clause 5.7.6.2 of TS 23.501 [2])
with the assumption that each QoS Flow is associated with PDU Sets with
specific QoS Characteristics values. As an example, the following filters
could be applied (see Solution 25 for a detailed description of the CP
parameters):
\- PSDB = 50ms, PSER = 10-5, PSMS = 50000B  QoS Flow ID = 1  IP address =
1.2.3.4, port = 5678;
\- PSDB = 100ms, PSER = 10-4, PSMS = 100000B  QoS Flow ID = 2  IP address =
1.2.3.5, port = 5679.
NOTE 7: It is assumed that an application uses different port numbers for data
streams of different QoS requirements.
### 6.20.3 Procedures
The baseline procedure to provide N3 PDU Set Metadata to the RAN is as
follows:
1\. After a PDU Session has been established, the UPF receives UP data from
the application server. The AS may include assistance metadata in the PDUs of
the PDU Sets provided to the UPF.
2\. The UPF, based on the assistance metadata provided by the AS or on
implementation specific mechanisms (e.g. deep packet inspection), generates
the N3 PDU Set Metadata and adds it to the headers od the PDUs of the PDU Sets
sent to the RAN.
3\. The RAN receives the N3 PDU Set Metadata and uses the allocated resources
for the PDU Sets.
NOTE: Whether the PDU Set Metadata of a PDU Set is stripped by the RAN before
attempting transmission of the related PDUs over the radio interface or is
sent to and used by the UE depends on RAN WG discussions.
### 6.20.4 Impacts on services, entities and interfaces
AS:
\- (Optional) Provides metadata over N6 identify different PDU Sets.
UPF:
\- (Optional) receives metadata over N6 to identify different PDU Sets.
\- Generates N3 PDU Set metadata based on input from AS or on implementation
specific mechanisms that allow to identify different PDU sets.
\- Adds N3 PDU Set metadata to PDU headers sent to RAN.
RAN:
\- Receives from SMF N3 PDU Set metadata in PDU headers.
\- Uses N3 PDU Set metadata to identify PDU Sets and use allocated radio
resources on a per-PDU Set basis.
## 6.21 Solution #21: PDU Set ID in the GTP-U header
### 6.21.1 Key Issue mapping
This solution aims to address the key issues#4: PDU Set integrated packet
handling:
### 6.21.2 Description
The following is the architecture of this solution.
Figure 6.21.2-1: Architecture of the XR traffic delivery
This solution reuses existing QoS mechanisms with the following enhancements:
1 The 5GMSd AF provides the new service data flow description information of
the XR traffic to PCF. The PCF then generates the new PCC rules and send the
PCC rules to the SMF. The SMF sends the new detection rules in QoS rules and
N4 rules respectively to UE and UPF to detect the PDU Set in the XR traffic.
Editor note: The details of detection rule enhancement are FFS.
2 The QoS profile sent to the RAN includes an indication to request PDU Set
integrated packet handling for the QoS flow. If the RAN accept the request, it
return an indication that PDU Set integrated packet handling is accepted to
the SMF.
3 For downlink XR traffic, the UPF allocates PDU Set ID based on the detection
rules. The GTP-U header is extended to include information of the PDU Set, for
example, the PDU Set ID and an indication of last packet of the PDU set. If
there is an I-UPF in the use plane path, the I-UPF forwards the information of
the PDU Set in the GTP-U header to the RAN node.
4 For uplink XR traffic, the UE allocates PDU Set ID based on the detection
rules. The UE provides the PDU Set ID in each uplink packet to the RAN node.
Editor\'s note: How to use the PDU Set ID in RAN node needs to be further
studied in RAN working groups.
### 6.21.3 Procedures
### 6.21.4 Impacts on existing entities and interfaces
## 6.22 Solution #22: N6 tunnelling and GTP-U header extension for conveyance
of PDU Set-related information
### 6.22.1 Key Issue mapping
This solution addresses Key Issues #4 (PDU Set integrated packet handling) and
#5 (Differentiated PDU Set Handling).
One aspect of the solution (i.e. XR Multi-modal Data identifier) also relates
to Key Issues #1 (Policy control enhancements to support multi-modality flows
coordinated transmission for single UE) and #2 (Support the Application
Synchronization and QoS Policy Coordination for Multi-modal Traffic among
Multiple UEs), although it does not propose a complete solution.
The solution focuses on support of QoS with PDU Set granularity in the
downlink direction only.
### 6.22.2 Description
This solution assumes that there is a set of preconfigured N6 tunnels between
the UPF serving as a PDU Session Anchor (PSA) in the 5GS on one hand and a
trusted 5G-XR Application Server (5G-XR AS) on the other hand, as illustrated
in Figure 6.22.2-1.
Figure 6.22.2-1: 5G-XR support with N6 tunnels
The following are the salient features of this solution:
\- The UPF with preconfigured N6 tunnels is selected based on the S-NSSAI/DNN
requested by the UE during PDU Session establishment.
\- Any suitable tunnelling technology can be used for the N6 tunnel between
the UPF (PSA) and the 5G-XR AS provided that it relies on extendable
encapsulation header (see below for the extended header information proposed
by this solution) that can carry vendor-specific information.
NOTE 1: In the scope of this study this solution assumes that GTP-U
encapsulation over N6 with the extensions defined in this solution is used.
Using encapsulation protocols defined by the IETF (e.g. GRE) would require
registration of a new Protocol Type with IANA.
NOTE 2: The use of GTP-U on N6 is already supported using the Traffic Steering
functionality described in clause 5.4.8 of TS 29.244 [49]. Specifically, the
Outer Header Creation IE (clause 8.2.56 of TS 29.244 [49]) and Outer Header
Removal IE (clause 8.2.64 of TS 29.244 [49]) support the use of GTP-U.
\- The trusted 5G-XR AS (i.e. the 5G-XR AS at the other end of the N6 tunnel)
provides PDU Set-related information in the N6 tunnelling encapsulation
header. Whether the PDU payload is encrypted or not is irrelevant, given that
all the information that is relevant for PDU Set-level traffic handling is
copied in the (external) N6 tunnelling header.
\- The PDU Set-related information is further propagated on N9/N3 towards the
RAN inside the GTP-U header using new header extension inside the Frame format
for the PDU Session user plane protocol defined in clause 5.5.2 of TS 38.415
[24].
\- Traffic destined to multiple 5G-XR Clients (residing in the same or in
different UEs) can be multiplexed in the same N6 tunnel.
\- The binding of downlink packets onto QoS Flows is performed by the UPF PSA
using the existing functionality specified in clause 6.1.3.2.4 of TS 23.503
[4]. In other words, the QoS Flow binding does not rely on the PDU Set-related
information in the N6 tunnelling encapsulation header.
\- The extended header can include any of the following information:
\- XR stream identifier (XRS ID): identifies all Protocol Data Units (PDUs)
corresponding to the same eXtended Reality or media traffic stream. The
uniqueness of this identifier is ensured by the 5G-XR AS.
\- XR Multi-modal Data identifier (XRMD ID): optional identifier indicating
all Protocol Data Units (PDUs) corresponding to a set of distinct XR traffic
streams that are affiliated with each other e.g. in case of Multi-modal Data.
The uniqueness of this identifier is ensured by the 5G-XR AS.
NOTE 2: XRMD ID can be used by NG-RAN to provide joint delivery of PDUs
belonging to affiliated XR traffic streams.
\- PDU Handling Type (PHT): indicates whether in case of PDU loss the
remainder of the PDUs in the PDU Set should be discarded or not.
\- PDU Set sequence number (PS-SN): indicates the PDU Set to which a PDU
belongs. All PDUs corresponding to the same PDU Set have the same PS-SN in the
encapsulation header. PS-SN is increased monotonously by the 5G-XR AS.
\- PDU sequence number (PDU-SN): indicates the sequence number of the PDU
within a PDU Set.
\- Last PDU Flag (LPF): indicates the last PDU in a PDU Set.
\- PDU Set Priority (PSP): indicates the priority of the PDU Set to which the
PDU belongs. The PDUs belonging to the same PDU Set have the same priority.
PDUs from one PDU Set can have different priority compared to PDUs from
another PDU Set.
\- Reference PDU Set SN (RPS-SN): optional parameter used for PDU Sets that
depend on a more important (Reference) PDU Set and need to be transmitted only
if the Reference PDU Set has been successfully transmitted.
The use of PS-SN, PDU-SN and LPF allows the network entities (UPF or NG-RAN)
to determine the PDU Set boundaries, as well as any loss of PDUs. Upon
detection of a lost PDU, the network entity can decide to drop the remaining
PDUs belonging to the same PDU Set e.g. based on the PHT.
Similarly, the use of RPS-SN allows the network entities (UPF or NG-RAN) to
drop all dependent PDU Sets if the Reference PDU Set has not been transmitted
successfully.
In the Control plane the solution assumes that a PDU Set Error Rate (PSER)
parameter (as in Solutions #8 and #25) is indicated in association with the
5QI. When the PSER is indicated, it overrides the PER of the corresponding 5QI
Editor\'s note: It is FFS whether the same PSER or different PSERs are used
when PDU Sets with different importance to the application layer are sharing
the same QoS Flow.
In presence of congestion, the network entity (NG-RAN or UPF) can rely on the
PPPS to determine which PDU Sets should be dropped preferably.
NOTE 3: The encoding of the extended header information listed above is a
stage-3 matter.
NOTE 4: It is up to RAN WG to determine whether the extended header
information listed above could be used for additional purposes (e.g. selection
of coding and modulation scheme on the radio interface, etc.).
### 6.22.3 Procedures
The solution describes the mechanisms that are used in the User plane of the
5GS. There are no changes to the Control plane procedures other than conveying
the PSER parameter to NG-RAN in association with the 5QI.
### 6.22.4 Impacts on services, entities and interfaces
UPF impact:
\- Ability to copy PDU Set-related information from the N6 tunnelling header
into the GTP-U header extension inside the Frame format for the PDU Session
user plane protocol defined in clause 5.5.2 of TS 38.415 [24].
\- Ability to use the PDU Set-related information received in the N6
tunnelling header e.g. for packet dropping, as described in clause 6.22.2.
NG-RAN impact:
\- Ability to use the PDU Set-related information received in the Frame format
for the PDU Session user plane protocol defined in clause 5.5.2 of TS 38.415
[24], e.g. for packet dropping, as described in clause 6.22.2.
## 6.23 Solution #23: PDU set related packet handling enhancements
### 6.23.1 Key Issue mapping
This solution can apply to key issue 4\"PDU Set integrated packet handling\"
and KI#5 \"Differentiated PDU Set Handling\".
### 6.23.2 Description
In this key issue, it is proposed to identify the PDU set for a group of
packets which have dependency and closer relationship. Within one PDU set, if
the number of lost packets are more than certain threshold, other packets
within the PDU set can\'t be used to recover the frames. There is also the
case that certain data packets are dependent by other packets within the PDU
set for decoding. So it\'s helpful to consider the dependency between the
packets within the PDU set in the 5GS to further improve the transmission
efficiency. It is also possible that the dependency between different PDU sets
exists. The packets which are dependent by other packets are considered to be
more important. Both the inter and intra PDU set dependency information are
helpful for handling the packets dropping during the congestion situation.
The application layer has the knowledge of the dependency between the packets,
so it\'s possible for the application layer to identify the PDU sets for the
dependent packets. It is also assumed that some header information is not
encrypted and can be used to identify the packets within the PDU set by the
application layer. The application layer could provide the dependency
information within the header information to help the network to identify the
PDU set and dependency information intra and inter the PDU set.
This solution is based on the current the network exposure framework and QoS
model with the following enhancements.
\- The AF could send the external header information and the handling request
of the PDU set to the 5GS including the packet loss threshold. So during the
congestion situation, if the lost packets within PDU set are above the
threshold, other packets within the PDU set can also be dropped. When
considering the packets dropping, the dependency information intra or inter
the PDU sets could also be considered. This dependency information could also
convey the importance information of the packets.
\- The PCF generates the PCC rules considering the PDU set.
\- The SMF generates the following N4 session management parameters related
with PDU set handling parameters:
\- PDRs: detection of the header information of the IP packets within the QoS
flow to identify the PDU set and the dependency information intra or inter the
PDU sets.
\- FARs:
\- adding the PDU set internal header information to the GTP-U header (e.g.
PDU set identification, PDU sequency number within a PDU set, etc.) to mark
the data packets within the PDU set;
\- optionally adding the dependency information intra and/or inter PDU set to
the GTP-U header;
\- dropping the packets of the PDU set if the lost packets within the PDU set
are above the threshold. If dependency information is added, it is also
considered when selecting the packets for dropping.
\- The SMF generates the QoS profile including the PDU set handling parameters
(PDU set internal header information (e.g. dependency information intra or
inter the PDU sets, etc.), packet loss threshold of the PDU set,).
\- PSA UPF handling related with the PDU set according to the N4 rules
provided by SMF.
\- RAN receives and enforces the QoS profile including the PDU set handling
parameters.
The procedure is proposed in the following clause.
### 6.23.3 Procedures
Figure 6.23.3-1: PDU set related packet handling procedure
1\. To create a new request, the AF invokes a Nnef_PDUSetHandling_Create
service operation (Target, AF Identifier, Flow description(s), PDU set
handling information). The PDU set handling information could include the PDU
set external header information, packet loss threshold of the PDU set. The
request contains also an AF Transaction Id. Optionally, the request could
include the dependency information intra or inter the PDU sets.
To update or remove an existing request, the AF invokes a Nnef_
PDUSetHandling_Update or Nnef_ PDUSetHandling_Delete service operation
providing the corresponding AF Transaction Id.
2\. (in the case of Nnef_ PDUSetHandling_Create or Update): The NEF stores the
AF request information in the UDR (Data Set = Application Data; Data Subset =
PDU set handling information, Data Key = AF Transaction Internal ID, S-NSSAI
and DNN and/or Internal Group Identifier).
(in the case of Nnef_ PDUSetHandling_delete): The NEF deletes the AF
requirements in the UDR (Data Set = Application Data; Data Subset = PDU set
handling information, Data Key = AF Transaction Internal ID).
3\. The NEF responds to the AF.
4\. The PCF(s) that have subscribed to the modifications of AF requests (Data
Set = Application Data; Data Subset = PDU set handling information, Data Key =
S-NSSAI and DNN and/or Internal Group Identifier) receive(s) a Nudr_DM_Notify
notification of data create or change from the UDR.
5\. The PCF determines if existing PDU Sessions are potentially impacted by
the AF request. For each of these PDU Sessions, the PCF updates the SMF with
corresponding new policy information about the PDU Session by invoking
Npcf_SMPolicyControl_UpdateNotify (PDU set handling rules) service operation.
6\. When the updated policy information about the PDU Session is received from
the PCF, the SMF may update the N4 session rules related with the PDU set
handling information of the PDU Session.
7\. The SMF sends a Namf_Communication_N1N2MessageTransfer (QoS profile (PDU
set handling parameters)) to the AMF.
8 The AMF sends a N2 message (QoS profile (PDU set handling parameters)) to
the RAN. PDU set handling parameters includes PDU set internal header
information, packet loss threshold.
The steps 9-12 are the same as the existing NW triggered PDU Session
Modification procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
### 6.23.4 Impacts on services, entities and interfaces
AF:
\- Send the external header information and the handling request of the PDU
set to the 5GS including the packet loss threshold;
\- Optionally provide the dependency information intra and/or inter PDU set.
NEF:
\- Interaction with AF to receive the PDU set handling request.
PCF:
\- Generation of the PCC rules related with PDU set.
SMF:
\- Generate and send the following N4 session management parameters related
with PDU set to the UPF:
\- PDRs: detection of the header information of the IP packets within the QoS
flow to identify the PDU set; and the dependency information intra or inter
the PDU sets;
\- FARs:
\- adding the PDU set internal header information to the GTP-U header (e.g.
PDU set identification, PDU sequency number within a PDU set, etc.) to mark
the data packets within the PDU set;
\- optionally adding the dependency information intra and/or inter PDU set to
the GTP-U header;
\- dropping the packets of the PDU set if the lost packets within the PDU set
are above the threshold. If dependency information is added, it is also
considered when selecting the packets for dropping.
\- Generate and send the QoS profile related with PDU set handling parameters
(PDU set internal header information,(e.g. dependency information intra and/or
inter the PDU set, etc.), packet loss threshold,) to the RAN.
PSA UPF:
\- Receive the N4 session management parameters related with PDU set from SMF;
\- Enforce the N4 session management parameters related with PDU set.
RAN:
\- Receive the QoS profile including the PDU set handling parameters (PDU set
internal header information (e.g. dependency information intra and/or inter
the PDU set, etc.), packet loss threshold) from AMF;
\- Enforce the QoS profile including the PDU set handling parameters.
## 6.24 Solution #24: Support differentiated QoS Handling for different PDU
Sets
### 6.24.1 Key Issue mapping
This solution corresponds to KI#5 on Differentiated PDU Set Handling.
### 6.24.2 Description
For interactive media services, e.g. Cloud XR, cloud gaming, real-time video
based remote control, PDUs of the media services carry different frame/video
slice. For example, in GOP, the first I-frame is considered as the most
important frame, other P-frames are encoded based on the I-frame. To ensure
the limited radio resources be used to guarantee the successful delivery of
the most important packet, 5GS can bring better user experience with same
resource. 5GS should be aware of the different importance/dependencies of PDU
Sets to achieve such target.
The design of typical media codec and transporting protocol, e.g. RTP, have
already considered such transporting requirements and provided importance
information via RTP header or NAL (Network Abstract Layer) header (See details
in clause 6.24.3.2), so that network node can protect more important NAL units
better than they do less important NAL units as described in clause 5.3 of RFC
6184 [12], clause 1.1.4 of RFC 7798 [21] and clause 1.1.4 of draft-ietf-
avtcore-rtp-vvc-14 [48].
In this solution, the following aspects are included:
1\. AF initiates AF session with required QoS as described in clause 4.15.6.6
of TS 23.502 [3].
2\. PCF determines updated or new policy information based on AF requirements.
The policy information includes detection template for PDU Set
importance/dependency and different QoS parameters for different PDU Sets, and
optional dependency related instructions. The PCF initiates PDU Session
Modification procedure and sends the policy information to SMF.
3\. Based on the policy information, the SMF assigns different QFIs with
corresponding QoS parameters for different PDU Sets. The SMF sends N4 rules
including PDR and FAR to UPF and N2 SM information including QoS Profiles to
RAN.
4\. When the UPF receives DL packets from the application server, the UPF
identifies the importance/dependency information of PDU Set of the packet and
maps the packet into corresponding QoS Flow. Details on how to identify the
importance/dependency information of PDU Set is described in clause 6.24.3.2.
5\. RAN receives DL packets from the UPF. The RAN handles the packets based on
N2 SM information from SMF.
The importance/dependency related instructions include:
\- Allow for extended transmission for importance/reference PDU sets, i.e.
importance/reference PDU set will not be dropped even if its delay exceeds
PSDB for a limited time duration.
\- Drop the PDU sets if transmission of its reference PDU set is considered as
failed.
\- Prioritize the transmission/retransmission of more important PDU sets in
case of resource shortage.
### 6.24.3 Procedures
#### 6.24.3.1 Processing of PDU Sets based on different importance/dependency
information
Figure 6.24.3.1-1 shows the procedure for supporting differentiated QoS
handling for different PDU Sets.
Figure 6.24.3.1-1: Differentiated QoS Handling for different PDU Sets
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [3].
1\. AF sets up an AF session with required QoS procedure as defined in clause
4.15.6.6 of TS 23.502 [3].
The AF request may include flow description for XR/media services, the
dependency information of PDU Sets (See option 3 of clause 6.24.3.2.1), and
traffic pattern (See option 4 of clause 6.24.3.2.1), Media protocol info (e.g.
which RFC is used in user data).
2\. The PCF derives detection template for PDU Set importance/dependency and
different QoS parameters for different PDU Sets and makes policy decision.
Optionally, the PCF may derive the importance/dependency related instructions
in the PCC rule. The PCF initiates the PDU Session modification procedure as
defined in clause 4.3.3.2 of TS 23.502 [3], steps 1b, 3b, 4-8b. The PCF sends
policy information to SMF.
3\. The SMF assigns different QoS Flow IDs and QoS parameters for the PDU Sets
of the service data flow based on their importance/dependencies. For example,
the SMF assigns a QoS Flow ID and corresponding QoS parameters for important
PDU Set (e.g. those I-frame or base layer which are references of other frames
and layers hence better not be dropped), and another QoS Flow ID and
corresponding QoS parameters for other PDU Set (e.g. other frames or
additional layers that have dependence on the I-frame or base layer).
Different QoS handling on PDU Sets may be performed:
\- For important PDU Set, prioritized admission control/resource scheduling
can be performed.
\- These PDU Set should be delivered to the UE no matter whether PSDB is
exceeded or not.
\- For other droppable PDU Set, perform correlated packets dropping, resource
pre-emption.
The SMF sends N4 rules to the UPF to indicate the UPF to identify
importance/dependency information of PDU Sets for received packets and map the
packets to corresponding QoS Flows. Details on how the UPF identify
importance/dependency information of PDU Sets are described in clause
6.24.3.2.
NOTE: Based on Media protocol info included in the PDU Set level packet
handling/treatment requirements or based on pre-configuration, SMF generates
N4 rules accordingly to instruct UPF to identify the PDU Sets of corresponding
protocols as shown in clause 6.24.3.2.
The SMF also sends N2 SM information including QoS profiles to RAN.
4\. The UPF identifies the importance/dependency information of PDU Sets for
the DL packets and maps the packets into corresponding QoS Flow based on N4
rules received in step 2(See details in clause 6.24.3.2). UPF sends the DL
packets to RAN via different QoS Flows. UPF may also provide
importance/dependency information of the PDU Sets to RAN via GTP-U header.
5\. The RAN handles the DL packets based on N2 SM information received in step
2 considering the above different QoS handling of the PDU Set.
#### 6.24.3.2 PDU Set Importance/dependency information identification on UPF
Real-time Transport Protocol (RTP) are widely used for data with real-time
characteristics, such as interactive audio and video.
To support differentiated QoS handling for PDU Sets in 5GS, the UPF should
firstly identify the PDU Sets (corresponding to a frame or video slice), then
identify the importance/dependency of different PDU Set.
NOTE: Solution#12 for KI#4 described how to identify PDU Set in UPF. This
clause will focus on how to further identify the importance/dependency
information of different PDU Sets.
##### 6.24.3.2.1 Identification of importance/dependency information of PDU
Set as a video frame
If the PDU Set represents a video frame, the identification of
importance/dependency information of the PDU Set can be realized via following
options.
**Option#1. Identification based on RTP header extension**
The RTP header extension defined in draft-ietf-avtext-framemarking [11] is as
following:
Figure 6.24.3.2.1-1: Frame Marking RTP header extension for non-scalable
streams
In the above RTP header extension (see clause 3.1 of draft-ietf-avtext-
framemarking [11]):
\- The I field named as Independent Frame reflects whether a frame can be
decoded independent of temporally prior frames or not. 1 means this frame can
be decoded independent of temporally prior frames, e.g. intra-frame, IDR frame
of H.264/H.265 or VP8/9 keyframe.
\- The D field named as Discardable Frame which reflects whether a frame is
droppable or not. 1 means the sender knows this frame can be discarded, and
still provide a decodable media stream.
UPF can based the above I field or D field to identify the important PDU
Set/frame.
If scalable streams (i.e. different temporary, spatial, quality layers) is
used, the RTP header extension is defined as following:
Figure 6.24.3.2.1-2: Frame Marking RTP header extension for scalable streams
The TID field named as Temporal ID identifies the temporal layer/sub-layer
encoded, starting with 0 for the base layer, and increasing with higher
temporal fidelity. Higher values of TID identify higher temporal layers with
higher frame rates as defined in draft-ietf-avtext-framemarking [11].
The LID field named as Layer ID identifies the spatial and quality layer
encoded, starting with 0 for the base layer, and increasing with higher
fidelity. Higher values of LID identify higher spatial and/or quality layers
with higher resolutions and/or bitrates as defined in draft-ietf-avtext-
framemarking [11].
UPF can based on the TID and LID field to identify the independent PDU
Set/base layer.
**Option#2. Identification based on H.264 NALU header**
For each RTP packet, a H.264 NAL unit header is included following RTP header.
For RTP payload carrying H.264 video slices, according to RFC 6184 [12], the
H.264 NAL unit header is as following:
Figure 6.24.3.2.1-3: H.264 NAL unit header format
In the NAL unit header, the NRI value indicates the relative transport
priority, as determined by the encoder. According to clause 5.3 of RFC6184
[12], a value of 00 indicates that the content of the NAL unit is not used to
reconstruct reference pictures. Such NAL units can be discarded without
risking the integrity of the reference. Values greater than 00 indicate that
the decoding of the NAL unit is required to maintain the integrity of the
reference pictures. The highest transport priority is 11, followed by 10, and
then by 01; finally, 00 is the lowest.
Therefore, UPF can use the NRI value to identify the importance information of
NAL unit carrying the PDU Set/slice. In case the frame includes only one
slice, the method can be used to detect the importance of the frame.
If scalable streams are used, the RTP NAL unit header is defined in RFC 6190
[13] can be used to identify the importance/dependency information of PDU Set
in different media layers.
The scalable streams use NAL unit type 14, 15, and 20 for prefix NAL unit,
subset sequence parameter set and coded slice in scalable extension
respectively as described in Figure 6.24.3.2.1-3. NAL unit type 14 and 20
indicate the presence of three additional octets in the NAL unit header, as
shown below.
Figure 6.24.3.2.1-4: additional octets in the NAL unit header
The PRID field named as priority_id specifies a priority identifier for the
NAL unit. A lower value of PRID indicates a higher priority.
The DID field named as dependency_id indicates the inter-layer coding
dependency level of a layer representation. At any PDU Set, a layer
representation with a given dependency_id may be used for inter-layer
prediction for coding of a layer representation with a higher dependency_id,
while a layer representation with a given dependency_id shall not be used for
inter-layer prediction for coding of a layer representation with a lower
dependency_id. The dependency_id gives the details on the dependency
relationship between different layers. For example, a layer of DID=n will be
decoded based on another layer of DID=n-1.
UPF can determine importance information based on PRID field and/or determine
dependency information based on the DID field.
NOTE 1: Option 2 depends on the readability of NALU header in RTP payload. If
RTP payload is encrypted, e.g. SRTP is used, option 2 will not applicable.
**Option#3. Identification based on assistance information from AF**
PDU sets group refers to a group of PDU sets which have some dependency
relationship among them (e.g. PDU sets carrying the video contents from the
same GOP, PDU sets carrying the video contents from the same video segment,
etc.). In a PDU sets group, the dependency relationship among the PDU sets can
be represented by the PDU set priority. E.g. PDU set carrying I, 1st P, 2nd P,
3rd P frame in a GOP could be assigned to priority level 1, 2, 3, 4
respectively. PDU set carrying the base layer, enhancement layer 1,
enhancement layer 2 of a video segment could be assigned to priority 1, 2, 2
respectively.
The media application (i.e. AF) may provide/update to 5GS
importance/dependency information of PDU sets in the form of group size (i.e.
number of PDU set), indication of starting/ending PDU set of a group of PDU
sets (e.g. sequence number, transmission time), importance/dependency
information of the PDU set with respects to the position/order of PDU set in
the group of PDU sets. 5GS derives the importance/dependency relationship
between different PDU sets using the assistance information from AF. Option#3
can be used together with UP based identification (i.e. Option #1, Option #2,
Option #5 or Option #6). Information derived from UP based identification, if
available, takes precedence to the one derived from option 3. For example, PDU
set with \'I\' field set in the RTP header or an \'IDR\' indicates/resets the
start of a group of PDU sets. The PDU sets with the highest importance or the
base PDU set is detected using option #1, #2, #5, #6, the
importance/dependency information of other PDU sets is derived further with
the assistance information from AF. Option#3 also applies to the cases where
the RTP header or NAL header is encrypted.
**Option#4. Identification based on traffic pattern**
In general, different PDU Sets have different traffic patterns, e.g. size of
one PDU Set, number of packets within one PDU Set. For example, the size of I
frame is generally 2-3 times larger than P frame. Therefore, the traffic
patterns can be used to identify the frame type and hence the importance
information of PDU Set.
NOTE 2: Accuracy of the detection in option 4 depends on the implementation of
UPF.
Option#5. Identification based on H.265 NALU header
For each RTP packet, a H.265 NAL unit header is included following RTP header.
For RTP payload carrying H.265 video slices, according to RFC 7798 [21], the
H.265 NAL unit header is as following:
Figure 6.24.3.2.1-5: H.265 NAL unit header format
The 6-bit Type field in the H.265 NAL unit header can indicate the content of
VCL (video coding layer) NAL unit. Table 6.24.3.2.1-1 shows the VCL NAL units
as defined in H.265 [46]. H.265 [46] includes signalling in the NAL unit
header, through NAL unit types, of IRAP (Intra-Random Access Point) pictures
beyond IDR (Instantaneous Decoding Refresh) pictures defined in H.264 [19].
Three types of IRAP pictures, namely IDR, CRA (Clean Random Access), and BLA
(Broken Link Access) pictures, are supported: IDR pictures are conventionally
referred to as closed group-of-pictures (closed-GOP) random access points
whereas CRA and BLA pictures are conventionally referred to as open-GOP random
access points. The BLA, IDR and CRA pictures do not refer to any pictures
other than themselves for inter prediction in its decoding process. The BLA,
IDR and CRA pictures are considered as the most important pictures, other
pictures are encoded based on these pictures.
Therefore, UPF can use the NAL unit value of BLA, IDR or CRA to identify the
importance information of NAL unit carrying the PDU Set/slice.
Table 6.24.3.2.1-1 H.265 VCL NAL units
* * *
NAL unit type Name of NAL unit type Content of VCL NAL unit
* * *
0\ TRAIL_N\ TP (Trailing Picture) picture 1 TRAIL_R
2\ TSA_N\ TSA (Temporal Sub-layer Access) picture 3 TSA_R
4\ STSA_N\ STSA (Step-wise Temporal Sub-layer Access) picture 5 STSA_R
6\ RADL_N\ RADL (Random Access Decodable Leading) picture 7 RADL_R
8\ RASL_N\ RASL (Random Access Skipped Leading) picture 9 RASL_R
10\ RSV_VCL_N10\ Reserved non-IRAP SLNR VCL NAL unit types 12\ RSV_VCL_N12\  
14 RSV_VCL_N14
11\ RSV_VCL_R11\ Reserved non-IRAP sub-layer reference VCL NAL unit types 13\
RSV_VCL_R13\  
15 RSV_VCL_R15
16\ BLA_W_LP\ BLA (Broken Link Access) picture 17\ BLA_W_RADL\  
18 BLA_N_LP
19\ IDR_W_RADL\ IDR (Instantaneous Decoding Refresh) picture 20 IDR_N_LP
21 CRA_NUT CRA (Clean Random Access) picture
22\ RSV_IRAP_VCL22\ Reserved IRAP VCL NAL unit types 23 RSV_IRAP_VCL23
24.31 RSV_VCL24.\ Reserved non-IRAP VCL NAL unit types RSV_VCL31
* * *
If temporal scalability streams are used, TID (TemporalId) field in the NAL
unit header indicates the relative importance of an RTP packet. For example,
NAL units belonging to higher temporal sub-layers are not used for the
decoding of lower temporal sub-layers. A lower value of TID indicates a higher
importance. More-important NAL units may be better protected against
transmission losses than less-important NAL units based on temporal
scalability.
Therefore, UPF can determine importance information of NAL unit carrying the
PDU Set/slice based on TID field.
NOTE 3: Option#5 depends on the readability of NALU header in RTP payload. If
RTP payload is encrypted, e.g. SRTP is used, option#5 will not be applicable.
**Option#6. Identification based on H.266 NALU header**
For each RTP packet, a H.266 NAL unit header is included following RTP header.
For RTP payload carrying H.266 video slices, according to draft-ietf-avtcore-
rtp-vvc-14 [48], the NAL unit header is as following:
Figure 6.24.3.2.1-6: H.266 NAL unit header format
The 5-bit Type field in the H.266 NAL unit header can indicate the content of
VCL(video coding layer) NAL unit. Table 6.24.3.2.1-2 shows the VCL NAL units
as defined in H.266 [47]. The IDR and CRA pictures do not refer to any
pictures other than themselves for inter prediction in its decoding process.
One of the H.266 features is that a the first coded picture in a bitstream can
start with a GDR(Gradual Decoding Refresh) picture, without requiring presence
of traditional random access points in the bitstream, such as IDR and CRA. In
GOP, the IDR, CRA and GDR pictures are considered as the most important
pictures, other NAL units are encoded based on these pictures.
Therefore, UPF can use the NAL unit values of IDR, CRA or GDR to identify the
importance information of NAL unit carrying the PDU Set/slice.
Table 6.24.3.2.1-2 H.266 VCL NAL units
* * *
NAL unit type Name of NAL unit type Content of VCL NAL unit
* * *
0 TRAIL_NUT TP (Trailing Picture) picture
1 STSA_NUT STSA (Step-wise Temporal Sub-layer Access) picture
2 RADL_NUT RADL (Random Access Decodable Leading) picture
3 RASL_NUT RASL (Random Access Skipped Leading) picture
4.6 RSV_VCL_4.\ Reserved non-IRAP VCL NAL unit types RSV_VCL_6
7\ IDR_W_RADL\ IDR (Instantaneous Decoding Refresh) picture 8 IDR_N_LP
9 CRA_NUT CRA (Clean Random Access) picture
10 GDR_NUT GDR (Gradual Decoding Refresh) picture
11 RSV_IRAP_11 Reserved IRAP VCL NAL unit type
* * *
If temporal scalability streams are used, TID (TemporalId) field in the NAL
unit header indicates the relative importance of an RTP packet. For example,
NAL units belonging to higher temporal sub-layers are not used for the
decoding of lower temporal sub-layers. A lower value of TID indicates a higher
importance. More-important NAL units may be better protected against
transmission losses than less-important NAL units based on temporal
scalability.
Therefore, UPF can determine importance information of NAL unit carrying the
PDU Set/slice based on TID field.
NOTE 1: For non-VCL NAL unites, the UPF determines the importance information
based on local configuration. For example, the non-VCL NAL unites could be
assigned with a higher importance based on operator configuration.
NOTE 2: Option#6 depends on the readability of NALU header in RTP payload. If
RTP payload is encrypted, e.g. SRTP is used, option#6 will not be applicable.
##### 6.24.3.2.2 Identification of importance/dependency information of PDU
Set as a video slice
When the PDU Set stands for a video slice, the RTP Payload as defined in RFC
6184 [12], RFC 7798 [21] and draft-ietf-avtcore-rtp-vvc-14 [48]can be used to
identify the priorities between different video slices. Details can be found
in option#2, option#5 and option#6 of clause 6.24.3.2.1.
### 6.24.4 Impacts on services, entities and interfaces
AF:
\- Optionally provide importance/dependency assistance information of PDU Sets
to 5GC.
PCF:
\- Optionally receive importance/dependency assistance information from AF;
\- Generate different QoS parameters and optionally dependency related
instructions) for different PDU Sets.
SMF:
\- Assign different QoS Flows for different PDU Sets.
\- Instruct UPF to identify importance/dependency information of PDU Sets and
map PDUs of different PDU Sets into corresponding QoS Flow accordingly.
\- Optionally receive dependency related instructions from PCF and distribute
to RAN.
UPF:
\- Identify importance/dependency information of PDU Sets for received DL
packets and map the PDUs into corresponding QoS Flow based on SMF
instructions.
\- Optionally provide dependency info between different PDU Sets via GTP-U
header.
RAN:
\- Optionally receive dependency information of PDU sets and dependency
related instructions, identify the dependency information of GTP-U header and
perform differentiated PDU Set level packet handling/treatment accordingly.
NOTE: The details of RAN behaviour is up to RAN WG.
## 6.25 Solution #25: PDU Set QoS Profile, QoS Flow parameters and QoS
Characteristics
### 6.25.1 Key Issue mapping
This solution addresses KI#4 and KI#5 and introduces a QoS framework for PDU
Sets (PS) which is based on the definition of a new type of QoS Profile, on
new QoS Flow parameters and new QoS Characteristics. This new QoS framework is
proposed as an addition to the existing QoS framework for PDUs and it meant to
work in parallel to it.
### 6.25.2 Description
#### 6.25.2.1 Overall framework
Figure 6.25.2-1 describes the overall QoS Framework for supporting PDU Sets
with an emphasis on the pieces of information that need to be exchanged over
the control plane interfaces and on the roles of the related network entities.
The user plane related aspects are described in Solution 20 in clause 6.20.
Figure 6.25.2.1-1: PDU Set based QoS framework: CP signalling aspects
The roles of the different network functions and UE remains essentially the
same as in the case of the traditional (per-PDU) QoS framework. The main
changes are:
\- Extension of the QoS related information exchanged between AF, CN, RAN and
UE to indicate the per-PDU Set QoS requirements provided by the AF the
associated QoS parameters.
\- Negotiation between the AF and 5GS about the capability to support the per-
PDU Set QoS framework.
NOTE: The negotiation between AF and 5GS may provide also PDU Set
identification information helpful to identify PDU Sets in the 5GS. Such
details are described in solution Y.
The new per-PDU Set QoS framework needs:
\- A new type of QoS Profile specifically defined to describe QoS Flows that
support a per-PDU Set traffic delivery.
\- A new set of QoS Characteristics associated to the 5QI describing a PDU Set
capable QoS Flow.
#### 6.25.2.2 New type of QoS Profile
The new type of QoS Profile specifically defined to support a PDU Set (PS)
based QoS framework includes:
\- PDU Set 5QI (PS5QI). The PS5QI is needed to describe the QoS
characteristics associated with the QoS flow supporting the transport of PDU
Sets.
#### 6.25.2.3 New per-PDU Set QoS characteristics
For each PS5QI value indicating a QoS Flow supporting the transport of PDU
Sets, the following QoS characteristics derived from the per-PDU QoS framework
but applied to PDU Sets are indicated.
Resource type.
In the same way as for the PDU based QoS framework, this parameter indicates
if the resources of Non-Guaranteed Bit Rate (Non-GBR), GBR or Delay-Critical
GBR (see clause 5.7.3.2 of TS 23.501 [2]).
Default Priority level.
The priority level used to prioritize QoS Flows when scheduling resources. The
usage of this parameter is the same as for the case of PDU based QoS framework
(see clause 5.7.3.3 of TS 23.501 [2]).
PDU Set Delay Budget (PSDB).
The PDU Set Delay Budget (PSDB) defines an upper bound for the time that a PS
may be delayed between the UE and the N6 termination point at the UPF before
being considered as not successfully delivered.
The PSDB applies to the DL PDU Sets received by the UPF over the N6 interface
and represents the difference between the time when the last bit of the last
PDU of the PDU Set is injected into the UPF and the time when the last bit of
the last PDU of the PDU Set is delivered to the UE. For UL, it applies to the
UL PDU Sets sent by the UE and represents the difference between the time when
the last bit of the last PDU of the PDU Set is sent by the UE and the time
when the last bit of the last PDU of the PDU Set is delivered to the UPF.
NOTE 1: This implies that the time by which all PDUs in the PDU set have to be
received by the UE (for DL) and by the UPF (for UL) is determined when the
last PDU of the PDU set is received at the RAN.
The 5G Access Network Packet Delay Budget (5G-AN PSDB) is determined by
subtracting a static value for the Core Network Packet Delay Budget (CN PSDB).
The PSDB is used to support the configuration of scheduling and link layer
functions (e.g. the setting of scheduling priority weights and HARQ target
operating points).
NOTE 2: If a RAN node supports per PDU Set QoS Characteristics and it receives
the PSDB, then the (per packet) PDB is ignored.
**Nominal PDU Set Delay Budget (NPSDB).**
In the case of periodic DL traffic, the Nominal Arrival Time represents the
time at which each DL PDU Set of the QoS Flow is supposed to be received at
the UPF, whereas the (actual) arrival time is the time when each DL PDU Set is
received at the UPF. In this case, the Nominal PDU Set Delay Budget (NPSDB) is
the same concept of the PDSB but applied to the Nominal Arrival Time of PDU
Set. Figure 6.25.2.3-1 shows the relationship between Nominal and actual
arrival time and between PSDB and Nominal PSDB.
Figure 6.25.2.3-1: PS Nominal Arrival Time and Nominal PDU Set Delay Budget
(NPSDB)
NOTE 3: It is assumed that the Nominal Arrival Time of PDU Sets for a periodic
DL traffic is known at the 5GS and does not need to be signaled.
NOTE 4: The NPSDB and the PSDB are used in a mutually exclusive way, i.e. if
the NPSDB is used for a QoS Flow, then the PSDB is not used, and vice-versa.
**PDU Set Error Rate (PSER).**
The PDU Set error rate is an upper bound for the ratio between the number of
PDU Sets not successfully received and the total number of PDU Sets sent
towards a recipient measured over a measurement window.
The PSER can be used by the communication system to set rate adaptation
target, number of HARQ retransmission, RLC parameters based on PSER rather
than on PER.
NOTE 5: PDU Sets with different PSER values are mapped onto different QoS
Flows. The details of how to map PDU Sets with different QoS characteristics
values to different QoS Flows is described in clause 6.20.1
**Averaging Window**
This applies only to QoS flows of GBR and Delay-Critical GBR type and, as for
the PDU based QoS framework, it is used to calculate the GFBR and MFBR values
associated with the QoS flow (see clause 5.7.3.6 of TS 23.501 [2]).
In addition to the QoS characteristics derived from the per-PDU QoS framework,
these additional QoS characteristics applicable only to PDU Sets are indicated
for each PS5QI:
**PDU Set Maximum Size (PSMS) expressed in bytes.**
The PSMS indicates to the RAN scheduler an upper bound on how many bytes can
be scheduled within a certain delay budget:
**PDU Set Discard Time (PSDT).**
The PDU Set Discard Time is an upper bound for the time that a PS has been
waiting for transmission at the sender of a link layer protocol (e.g. RLC in
RAN of a 3GPP access) before being discarded.
The PSDT applies to the DL PDU Set received by the UPF over the N6 interface,
and to the UL PDU Set sent by the UE.
In the case of 3GPP access, the PSDT is used to support the configuration of
scheduling and link layer functions (e.g. the setting of scheduling priority
weights and HARQ target operating points).
The PS is retained in queue beyond PSDB, up to PSDT: the application considers
the PS as not useful if received beyond the discard time. For example, there
can be XR type traffic for which the PS is useful for decoding subsequent PDU
sets even if they are not available within the associated PSDB for display.
**PDU Set Content Criterion (PSCC) and PDU Set Content Ratio (PSCR).**
Since, as reported in the definition of`` PDU Set in clause 3.2, \"In some
cases, the application layer can still recover parts of the information unit,
when some PDUs [of the PDU Set] are missing.\", it is necessary to provide to
the scheduler when needed an indication of the criterion associated to the PDU
Set.
The PDU Set content criterion (PSCP) refers to criteria based on which a
recipient can determine whether the PS can be considered successfully
delivered or not. The PSCP allows to specify the relative importance of
bits/PDUs within a PS and its purpose is to enable an appropriate link layer
protocol configurations and functions (e.g. Scheduling, RLC and HARQ in RAN of
a 3GPP access). A minimal set of PSCPs is shown in Table 6.25.2.3-1 below.
Table 6.25.2.3-1: Minimal set of PDU Set Content criteria
PDU Set Content Criteria Description
* * *
PS is useful to the receiver only if all bits are delivered correctly. This is
the case when each frame \"slice\" is a PDU Set and no error is tolerated. PS
is useful to the receiver only up to the first bit in error. This is in case
the encoder and the decoder are set to a mode where all bits/PDUs up to the
first error are useful. PS is useful to the receiver only if X% of the bits of
the PS are delivered correctly. X is the PDU Set Content Ratio (PSCR). This is
the case when application Forward Error Correction (FEC) is applied to an PDU
Set and X% error can be tolerated.
### 6.25.3 Procedures
Extension of clause 4.15.6.6 of TS 23.502 [3] (Setting up an AF session with
required QoS procedure) to:
\- Negotiate capability support of 5GS.
\- Negotiate mechanisms to identify traffic flows that need to be mapped to
PDU Set based QoS flows.
\- Negotiate mechanism to identify/mark PDU Sets.
NOTE: The details of such negotiation are described in Solution X in clause
6.X (Negotiation of details of marking mechanisms for AS to UPF
communication).
\- Negotiate per PDU Set QoS Requirements.
Extension of clauses 4.3.2.2.1 (PDU Session establishment) and 4.3.3.2-1 (PDU
Session modification) of TS 23.502 [3] to include:
\- Provision of PCC rules to select PDU Set capable UPF.
\- Send PDU Set detection rules to UPF.
\- Send new QoS profiles to RAN.
\- Send PDU Set aware UL filters to UE.
### 6.25.4 Impacts on services, entities and interfaces
AF:
\- Negotiate capability support of 5GS.
\- Negotiate mechanisms to identify traffic flows that need to be mapped to
PDU Set based QoS flows.
\- Negotiate mechanism to identify/mark PDU Sets.
\- Negotiate per PDU Set QoS Requirements.
PCF:
\- create PCC policies for PDU Set based QoS
SMF:
\- send PDU Set detection rules to UPF.
\- send new QoS profiles to RAN.
\- send PDU Set aware UL filters to UE.
UPF:
RAN:
\- Receive from SMF new PDU Set capable QoS profiles.
\- Use per PDU Set QoS profile information to allocate radio resources.
UE:
\- Receive PDU Set aware UL filters from SMF.
## 6.26 Solution #26: Provisioning XR traffic configuration to 5GS
### 6.26.1 Key Issue mapping
This solution is for Key Issue #4 and #5, which addresses PDU set integrated
packet handling and differentiated QoS handling.
### 6.26.2 Description
In order to enable 5GS to perform PDU set integrated packet handling and
differentiatd QoS handling, AF provisions configuration consisting of flow
description and the associated XR traffic configuration information as
follows:
There\'re two possible ways for XR App server to provide packets with
different frame type/importance (e.g. different types of PDU sets), in one
single IP packet flow or in separate IP packet flows. In Figure 6.26-1, XR App
server provides different IP packet flows associated with specific frame
type/importance. In Figure 6.26-2, XR App server provides one IP packet flow
with different frame types/importance. UPF splits one IP packet flow into
different QoS flows based on specific frame type/importance.
Case 1: XR App server provides different IP packet flows associated with
specific frame type/importance
In this case, XR application server identifies packets with different frame
type/importance and marks the IP header with different Type of Service (IPv4),
or traffic class (IPv6) and mark, or IPv6 Flow Label.
Figure 6.26.2-1. XR App server provides different IP packet flows associated
with specific frame type/importance
AF provides 5GC flow description with the associated frame type/importance,
which will further be contained in PCC rules provided to SMF. SMF provides UPF
different IP packet filters with the associated frame type/importance and QFI.
In this way, UPF is able to identify frame type/importance based on the IP
packet filter and marks the packets with the associated QFI. Meanwhile, SMF
provides RAN node QFI with the associated frame type/importance. RAN node maps
different QoS flows to different DRBs, in order to reuse the existing RAN
scheduling mechanism to realize the prioritized transmission of the XRM data.
Case 2: XR App server provides one IP packet flow with different frame
types/importance
In this case, XR App server provides one IP packet flow, which contains
packets of different frame types/importance. UPF splits one IP packet flow
into different QoS flows based on specific frame type/importance identified in
user plane.
Figure 6.26.2-2. XR App server provides one IP packet flow with different
frame types/importance
One possible solution is, AF provides XR configuration information, which
contains flow description and the possible values of frame type/importance.
SMF provides UPF PDR together with the mapping relationship between QFI and
frame type/importance. Specifically, frame type/importance can be in the form
of 1) I/D field in RTP header extension or 2)TID/LID field in RTP header
extension or 3)NRI value, PRID/DID filed in NAL unit header format as
mentioned in other solutions. In TR 23.700-60, some solutions also mentioned
that UPF is also able to identify frame type/importance based on assistant
information from AF or traffic pattern.
In short, the XR configuration information provided flow description and the
associated parameters as follows:- Time assistance information: Burst Arrival
Time, Periodicity.
\- PDU set based QoS requirement: PDU set delay budget, PDU set error rate.
\- Frame type/importance(for case 1).
\- Possible values of frame type/importance (for case 2)
\- indication of PDU set integrated packet handling, which may be associated
with frame type/importance for case 2
Where PDU set delay budget is defined as an upper bound for the time that a
PDU Set may be delayed between the UE the N6 termination point at the UPF. PDU
set error rate is defiend as an upper bound for the rate of PDU sets (e.g. set
of IP packets constituting a PDU-Set) that have been processed by the sender
of a link layer protocol (e.g. RLC in RAN of a 3GPP access) but that are not
successfully delivered by the corresponding receiver to the upper layer (e.g.
PDCP in RAN of a 3GPP access). Possible values of frame type/importance may be
provided for case 2. Indication of PDU set integrated packet handling may be
associated with flow description, and even with speicific frame
type/importance.
PCF initiates SM Policy Association Modification to provide the service data
flow fiter and the associated XR traffic configuration information. After
that, the solution relies on the PDU Session Modification Procedure in clause
4.3.3 in TS 23.502 [3] for SMF to provision the XR traffic configuration to
UPF and RAN node.
### 6.26.3 Procedures
#### 6.26.3.1 PDU session modification
Figure 6.26.3.1-1: PDU session modification procedure
0\. AF sends AF request with flow description and the associated XR traffic
configuration information, where the XR traffic configuration information
includes time assistance information (e.g. burst arrival time, periodicity),
PDU set based QoS requirement (e.g. PDU set delay budget, PDU set error rate)
,frame type/importance or possible values of frame types/importance,
indication of PDU set integrated packet handling and optionally the associated
frame types/importance.
1\. PCF initiates SM Policy Association Modification procedure as defined in
clause 4.16.5.2 of TS 23.502 [3] to notify SMF about the modification of
policies, which further triggers PDU session modification procedure. PCF
includes service data flow filter with the associated XR traffic configuration
information in the PCC rules provided to SMF.
2a. SMF sends N4 Session Modification Request to UPF, which contains PDU set
identification indication, packet filter set and the associated QFIand time
assistance information. Besides, the mapping of QFI and frame type/importance
may also be provided for case 2. The PDU set identification indication can be
used to indicate UPF to perform PDU set identification and mark the GTP-U
header with PDU set information.
2b. UPF responds SMF with N4 Session Modification Response.
3\. SMF invokes Namf_Communication_N1N2MessageTransfer to transfer N2 SM
information.
4\. AMF transfers N2 SM information to RAN node, which contains the mapping of
QFI, frame type/importance, time assistance information and PDU set based QoS
requirement.
5-12 steps of PDU session Modification procedure are performed as in clause
4.3.3.2 of TS 23.502 [3].
### 6.26.4 Impacts on services, entities and interfaces
The proposed solution is based on Rel-17 procedures but some enhancements may
be needed to make it possible for the 5GS to configure UPF/RAN node with the
XR traffic configuration information, such as:
AF:
\- Include XR traffic configuration information associated with flow
description in AF request.
PCF:
\- Include XR traffic configuration information associated with service data
flow filter in PCC rules.
SMF:
\- Include XR traffic configuration information associated with packet filter
set in N4 rules for UPF.
\- Include XR traffic configuration information associated with QFI in N2 SM
information for RAN node.
## 6.27 Solution #27: RT latency split for two QoS flows used for UL and DL
respectively
### 6.27.1 Key Issue mapping
The solution applies to Key Issue #6 Uplink-downlink transmission coordination
to meet Round-Trip latency requirements.
### 6.27.2 Description
RT (Round-Trip) latency requirement is the latency requirements between UE and
N6 termination point at the UPF, as defined in SP-211646. To provide good
service experience for users, the XR services with real-time interaction
typically require very low RT latency (RT latency refers to the remaining part
of the end-to-end motion-to-photon (MTP) delay excluding the
processing/rending time at the UE and server side). Thus, it is necessary to
study how to meet the very low RT latency requirements in 5GS. But the
challenge is how to meet the very low Round-Trip latency requirement with a
variable or unequal uplink/downlink latency. Since the AF lacks dynamic
information of the current UL/DL situation, it is difficult for AF to split
the RT latency requirement into UL and DL delay requirements in an optimized
way. It is assumed that the AF to provide the RT latency requirements to 5GC.
The solution is based on the existing QoS model and policy framework with the
following enhancements and special configurations:
\- The AF provides RT latency requirements to the PCF together with the AF
session information directly when the AF is trusted or via NEF when the AF is
untrusted.
\- The PCF split the RT latency requirement into an UL PDB and a DL PDB part.
The UL PDB and DL PDB are can be unequal but their sum shall not exceed the RT
latency requirement. The PCF shall generate two PCC rules for the media
stream, one for the UL and one for the DL direction, and assigns the 5QIs
according to the PDBs respectively.
\- The PCF may also issues two QoS monitoring policies to request monitor UL
delay and DL delay respectively.
\- Based on the received QoS monitoring result, the PCF can semi-statically
adjusts the UL PDB and the DL PDB, so that UL/DL PDB fits better to the new
situation while the RT latency is not exceeded .
### 6.27.3 Procedures
Figure 6.27.3-1: Setting up an AF session with required QoS procedure meeting
RT latency requirement
1\. The AF provides RT latency requirement to the NEF using
Nnef_AFsessionWithQoS_Create request.
2\. The NEF performs authorization of the AF request. If the request is
authorized, the NEF provides the RT latency requirement to PCF by invoking the
Npcf_PolicyAuthorization_Create request. Otherwise, NEF responses to AF that
the request is not authorized and the procedure stops.
3\. The PCF splits the RT latency requirement into an UL PDB and a DL PDB part
meeting the RT latency requirement. The PCF determines PCC rules based on the
UL/DL Flow descriptions and assigns 5QIs according to the split PDB. In
addition, the PCF may generate reporting thresholds for the QoS monitoring of
the one-way delays.
4\. The PCF sends the PCC rules (optionally including the reporting threshold
for the QoS monitoring of the one-way delay) to SMF. SMF installs these PCC
rules and performs all the related actions described in TS 23.501 [2] like QoS
Flow establishment signalling with RAN and configuration of UPF.
5\. Optionally, if the PCF has activated the QoS monitoring procedure to
monitor the UL/DL delays and a report threshold is exceeded, the UPF reports
the respective monitored UL/DL delay to the SMF and the SMF notifies the PCF.
6\. The PCF can readjust the UL and DL PDBs, based on local configuration or
according to the monitored UL/DL delays and RT latency requirements, and
modify the 5QI in the PCC rules accordingly. The PCF may also modify the
reporting thresholds for the QoS monitoring.
7\. The PCF sends the updated PCC rules to the SMF. The SMF initiates PDU
Session modification procedure to update QoS Flows.
### 6.27.4 Impacts on services, entities and interfaces
AF:
\- Provides RT latency requirement to the PCF(directly when the AF is trusted
or via NEF when the AF is untrusted).
PCF:
\- Splits the RT latency requirements into an UL PDB and a DL PDB part.
Generates two PCC rules, one for the UL direction and one for the DL direction
and assigns the 5QIs according to the PDBs respectively.
\- May also issues two QoS monitoring policies to request monitor UL delay and
DL delay respectively.
\- Based on the received QoS monitoring result, the PCF may semi-statically
adjusts the UL PDB and the DL PDB.
## 6.28 Solution #28: RAN split RT latency for single QoS flow
### 6.28.1 Key Issue mapping
The solution applies to Key Issue #6 Uplink-downlink transmission coordination
to meet Round-Trip latency requirements.
### 6.28.2 Description
RT (Round-Trip) latency requirement is the latency requirements between UE and
N6 termination point at the UPF, as defined in SP-211646.
The solution is based on the existing QoS rule mapping with the following
enhancement:
\- The AF provides RT latency requirement to the PCF directly when the AF is
trusted or via NEF when the AF is untrusted.
\- The PCF uses 1/2 RT latency requirement to map 5QI. The PCF issues a PCC
rule that include RT latency requirement.
\- The SMF performs QoS Flow binding based on the received RT latency
requirement in the PCC rule from the PCF and includes the RT latency
requirement in the QoS profile.
\- Based on the received RT latency requirement the RAN can adjust the UL PDB
and the DL PDB on its own, and guarantees the sum of the UL PDB and DL PDB is
not exceed the RT PDB. The UL PDB and DL PDB can be imbalanced.
NOTE: The RT latency requirement can be a RT latency value or can be a PDB
value together with an RTT indication. For the latter case, the network can
figure out the RTT latency requirement by doubling of the PDB based on the RTT
indication.
### 6.28.3 Procedures
Figure 6.28.3-1: Setting up an AF session with required QoS procedure
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, Flow
description(s), QoS reference, RT latency requirement) to the NEF.
2\. The NEF authorizes the AF request.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request and provides UE address, AF
Identifier, Flow description(s), the QoS reference, RT latency requirement).
4\. If the RT latency requirement is provided, the PCF uses 1/2 RT latency
requirement to map 5QI. If the PCF authorizes the RAN to split UL/DL PDB based
on the RT latency, the PCF issues a PCC rule and the PCC rule includes RT
latency requirement; otherwise the PCC rule doesn\'t include the RT latency
requirement. The other QoS parameter mapping is as described in clause
4.15.6.6 of TS 23.502 [3].
5\. The PCF responds to the NEF a Npcf_Policy Authorization_Create response.
6\. The NEF sends a Nnef_AFsessionWithQoS_Create response messag to the AF.
7\. The PCF sends a Npcf_SMPolicyControl_UpdateNotify request (PCC rule (RT
latency requirement)) the SMF.
If the RT latency requirement is provided, the SMF performs QoS Flow binding
based on the received RT latency requirement in the PCC rule from the PCF and
includes the RT latency requirement in the QoS profile.
The steps 8-10 are the same as the existing NW triggered PDU Session
Modification procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
11\. The SMF sends a Namf_Communication_N1N2MessageTransfer (QoS profile (RT
latency requirement)), QoS rule) to the AMF.
12\. The AMF sends a N2 message (QoS profile (RT latency requirement)) to the
RAN.
If the RT latency requirement is provided, when the RAN detects the UL delay
and DL delay is unequal, e.g. the UL delay or the DL delay is beyond than the
PDB (i.e. is 1/2 RT latency requirement and equal for UL/DL), the RAN can use
RT latency requirement to adjust the UL PDB and the DL PDB on its own, and
guarantees the sum of the UL PDB and DL PDB is not exceeded of the RT latency
requirement. The UL PDB and DL PDB can be unequal and the previous PDB (i.e.
is 1/2 RT latency requirement and equal for UL/DL) is ignored for this case.
The steps 13-18 are the same as the existing NW triggered PDU Session
Modification procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
### 6.28.4 Impacts on services, entities and interfaces
AF:
\- Provides RT latency requirement to the PCF directly when the AF is trusted
or via NEF when the AF is untrusted.
PCF:
\- Uses 1/2 RT latency requirement to map 5QI. The PCF issues a PCC rule that
include RT latency requirement if the PCF authorizes the RAN to split UL/DL
PDB based on the RT latency.
SMF:
\- Performs QoS Flow binding based on the received RT latency requirement in
the PCC rule from the PCF and Includes the RT latency requirement in the QoS
profile.
RAN:
\- Based on the received RT latency requirement, the RAN can adjust the UL PDB
and the DL PDB on its own, and guarantees the sum of the UL PDB and DL PDB is
not exceed the RT latency requirement. The UL PDB and DL PDB can be
imbalanced.
## 6.29 Solution #29: Two Way Delay Budget
### 6.29.1 Introduction
Many XR and media services and applications are interactive by nature making
UL and DL traffic mutually dependent. More specifically, pose/control
information sent in UL by the UE is processed by a spatial computing server
(SCS) hosted in the network. The SCS renders the media content according to
the received pose information and transmits it in DL to the UE. UL traffic
consists of a stream of small packets generating few kbps, whereas DL traffic
consists of large visual content, which accounts to several Mbps (see TS
22.261 [5]). Therefore, UL and DL traffic experience different transmission
latencies due to the different size of the content UL and DL PDUs carry.
Accordingly, the user experience of these interactive services is affected by
the round-trip delay (RTD) rather than the one-way delay and is measured as
the difference between the transmission of the pose/control information and
the reception of the corresponding media content. To allow an immersive
experience, the RTD must be kept below a certain threshold (RTDmax). The RTD
assigned for a given QoS Flow does not necessarily need to be split equally
between UL and DL. Having distinct QoS characteristics and parameters for UL
and DL as in the current 5GS QoS framework is too restrictive for XR services
and applications since the information in UL and DL is different and XR
quality is affected by RTD instead of one-way delay.
This solution proposes the definition of a two-way delay budget (TWDB) as a
new 5QI parameter, which allows to increase the DL PDB by an amount equal to
the unused UL PDB (and vice versa). Unused PDB is the difference between PDB
and latency incurred for actual transmission.
### 6.29.2 Functional Description
The two-way delay budget (TWDB) is defined as the sum of UL and DL PDBs.
Therefore, when TWDB is used by the 5GS, the PDB for DL transmission is the
difference between the TWDB and the transmission latency incurred for UL. The
amount of TWDB to be assigned for DL and UL packet transmissions is decided by
the 5GS at the establishment of the PDU session establishment and it may be
updated during the PDU session.
### 6.29.3 Procedures
We propose two solutions for the specification of TWDB, both extending the QoS
model defined in clause 5.7 of TS 23.501 [2]. More specifically, we propose
the following two solutions:
Option 1 Explicit definition of TWDB: the TWDB is defined explicitly as a new
QoS characteristic associated with 5QI. This requires the description of a new
clause for the definition of the TWDB and its relationship with the PDB as
well as the extension of Table 5.7.4-1 with one additional column marked as
TWDB.
Option 2 Implicit definition of TWDB: the TWDB is defined implicitly by
specifying a different handling of the UL and DL PDBs. as a new QoS
characteristic associated with 5QI. This requires the modification of the
clause associated to the description of the PDB in clause 5.7.3.4 of TS 23.501
[2] as well as the addition of a note in Table 5.7.4-1 to specify how to
compute the TWDB from the PDB associated to the 5QIs for UL and DL.
An example of explicit and implicit definition of the TWDB is illustrated in
Table 1, where the value of the TWDB is explicitly defined for 5QI=80, whereas
is implicitly defined for 5QIs={88,89,90}. The new note (NOTE 18) indicates
that the TWDB is the sum of the PDBs of the 5QIs selected for UL and DL QoS
flows. If the 5GS select 5QI=80 for both UL and DL QoS flows, the resulting
TWDB is equal to 40ms, whereas for the case 5QI=88 for UL and 5QI=89 for DL,
the resulting TWDB is equal to 25ms.
Table 6.29.3-1: New definition of Table 5.7.4-1: Standardized 5QI to QoS
characteristics mapping
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5QI | Res | De | P | Two | P | De | De | Ex | | | ource | fault | acket | -Ways | acket | fault | fault | ample | | Value | Type | Pri | Delay | Delay | Error | Ma | | Ser | | | | ority | B | B | | ximum | Aver | vices | | | | Level | udget | udget | Rate | Data | aging | | | | | | | | | Burst | W | | | | | | (NO | | | V | indow | | | | | | TE 3) | | | olume | | | | | | | | | | | | | | | | | | | | (NO | | | | | | | | | | TE 2) | | | +=======+=======+=======+=======+=======+=======+=======+=======+=======+ | 80 | | 68 | 10 ms | 20 ms | 10-6 | N/A | N/A | Low | | | | | | | | | | La | | | | | (NO | | | | | tency | | | | | TE 5, | | | | | eMBB | | | | | | | | | | ap | | | | | NOT | | | | | plica | | | | | E 10) | | | | | tions | | | | | | | | | | Augm | | | | | | | | | | ented | | | | | | | | | | Re | | | | | | | | | | ality | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 88 | | 25 | 10 ms | N/A | 10-3 | 1125 | 2000 | I | | | | | (NOTE | | | bytes | ms | ntera | | | | | 4) | (NOTE | | | | ctive | | | | | | 18) | | | | Se | | | | | | | | | | rvice | | | | | | | | | | - | | | | | | | | | | M | | | | | | | | | | otion | | | | | | | | | | tra | | | | | | | | | | cking | | | | | | | | | | data, | | | | | | | | | | (see | | | | | | | | | | T | | | | | | | | | | S 22. | | | | | | | | | | 261 \ | | | | | | | | | | [5]) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 89 | | 25 | 15 ms | N/A | 10-4 | 17000 | 2000 | V | | | | | (NOTE | | | bytes | ms | isual | | | | | 4) | (NOTE | | | | co | | | | | | 18) | | | | ntent | | | | | \ | | | | | for | | | | | (DL) | | | | | c | | | | | | | | | | loud/ | | | | | | | | | | edge/ | | | | | | | | | | split | | | | | | | | | | rend | | | | | | | | | | ering | | | | | | | | | | (see | | | | | | | | | | T | | | | | | | | | | S 22. | | | | | | | | | | 261 \ | | | | | | | | | | [5]) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 90 | | 25 | 20 ms | N/A | 10-4 | 63000 | 2000 | V | | | | | (NOTE | | | bytes | ms | isual | | | | | 4) | (NOTE | | | | co | | | | | | 18) | | | | ntent | | | | | (UL) | | | | | for | | | | | | | | | | c | | | | | | | | | | loud/ | | | | | | | | | | edge/ | | | | | | | | | | split | | | | | | | | | | rend | | | | | | | | | | ering | | | | | | | | | | (see | | | | | | | | | | T | | | | | | | | | | S 22. | | | | | | | | | | 261 \ | | | | | | | | | | [5]) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | NOT | | | | | | | | | | E 18: | | | | | | | | | | For | | | | | | | | | | this | | | | | | | | | | 5QI, | | | | | | | | | | PER | | | | | | | | | | det | | | | | | | | | | ermin | | | | | | | | | | ation | | | | | | | | | | is | | | | | | | | | | m | | | | | | | | | | ainly | | | | | | | | | | based | | | | | | | | | | on | | | | | | | | | | TWDB | | | | | | | | | | r | | | | | | | | | | equir | | | | | | | | | | ement | | | | | | | | | | and | | | | | | | | | | not | | | | | | | | | | just | | | | | | | | | | based | | | | | | | | | | on | | | | | | | | | | the | | | | | | | | | | PDB. | | | | | | | | | | If | | | | | | | | | | TWDB | | | | | | | | | | is | | | | | | | | | | not | | | | | | | | | | expli | | | | | | | | | | citly | | | | | | | | | | de | | | | | | | | | | fined | | | | | | | | | | ( | | | | | | | | | | N/A), | | | | | | | | | | its | | | | | | | | | | value | | | | | | | | | | is | | | | | | | | | | the | | | | | | | | | | sum | | | | | | | | | | of DL | | | | | | | | | | and | | | | | | | | | | UL | | | | | | | | | | PDBs. | | | | | | | | | | TWDB | | | | | | | | | | is | | | | | | | | | | de | | | | | | | | | | fined | | | | | | | | | | only | | | | | | | | | | for | | | | | | | | | | ser | | | | | | | | | | vices | | | | | | | | | | that | | | | | | | | | | have | | | | | | | | | | both | | | | | | | | | | DL | | | | | | | | | | and | | | | | | | | | | UL | | | | | | | | | | QoS | | | | | | | | | | f | | | | | | | | | | lows. | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
At the time of QoS Flow setup, SMF can indicate to the NG-RAN whether the TWDB
applies. NG-RAN can consider a DL packet as received only if the sum of the
transmission latencies for UL and DL together exceeds the TWDB. The TWDB can
be determined by the PDB associated for individual 5QIs for UL and DL
respectively. Alternatively, the split of the TWDB can be decided by the
network (i.e. the amount of TWDB allocated to UL and DL) and can be updated
dynamically for a given QoS Flow.
By default, the TWDB is determined based on the PDB for UL and DL. If a
dynamic split applies, then SMF can also indicate the split for the UL and DL.
For example, the delay budget assigned to DL can be computed as the difference
between the TWDB and a function of the UL latency. The function of the UL
latency can be the maximum of the latency experienced by a sequence of
consecutive packets transmitted in UL over a sliding window. Other options may
include the average or the upper bound of the confidence interval of the UL
latency (this requires the estimation of second order statistics). The sliding
window can be defined in terms of number of consecutive PDUs or as a time
interval. The update of the split of the TWDB between DL and UL can be
periodic or based on conditions on the variation of the transmission latency
in each direction.
In summary, when a TWDB (two-way delay budget) is not utilized, a packet which
is delayed more than the one-way PDB is counted as lost and included in the
PER unless the data burst is exceeding the maximum data burst volume (MDBV)
within the period of PDB or the QoS flow is exceeding the guaranteed flow bit
rate (GFBR). When two-way delay budget is utilized, as long as the PDUs for UL
and DL are delivered within the TWDB (two-way delay budget), the corresponding
PDUs are not counted as lost and thus not included in the PER.
### 6.29.4 Impacts on services, entities and interfaces
\- PCF:
\- Determine the QoS Flows for which TWDB applies along with the split for UL
and DL based on application characteristics.
\- SMF:
\- Send the indication whether the TWDB applies or not along with the split
for UL and DL to NG-RAN.
\- NG-RAN:
\- Ability to receive the indication whether TWDB applies or not, along with
the split for UL and DL. Furthermore, NG-RAN has the ability to determine PER
based on TWDB.
## 6.30 Solution #30: Policy enhancements to minimize jitter
### 6.30.1 Key Issue mapping
This solution addresses key issue #7 i.e. policy enhancements for jitter
minimization.
### 6.30.2 Description
#### 6.30.2.1 Solution Principles
\- Jitter minimization is applied to XR and media services which require low
jitter e.g. cloud gaming.
#### 6.30.2.2 Architecture Assumptions
\- Whether jitter minimization is needed or not can be indicated by the
application layer or by the AF.
\- In order to determine whether jitter minimization is needed or not, the 5GS
needs to expose its jitter performance to AF in order to let the AF decide
whether further minimization is needed or not.
### 6.30.3 Procedures
#### 6.30.3.1 Procedure for network exposure of network latency or jitter to
AF
In order to decide whether to minimize jitter for a certain XR and Media
application, it may be necessary to expose the network latency or jitter to
AF. To achieve this purpose, UPF expose QoS monitoring results to AF.
Figure 6.30.3.1-1: Network exposure to Application Server
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [3] An UPF is assigned for this PDU Session.
1a. The AF initiates setting up an AF session with required QoS procedure as
defined in clause 4.15.6.6 of TS 23.502 [3].
In the request, the AF may subscribe to direct notification of QoS monitoring
for the service data flow to PCF possibly via NEF. If so, the AF shall include
the corresponding QoS monitoring parameters as defined in clause 5.33.3 of TS
23.501 [2].
1b. The AF may first initiate an AF Session with PCF and later subscribe to
direct notification of QoS monitoring to PCF by invoking
Npcf_PolicyAuthorization_Subscribe service operation. The QoS parameter(s) to
be measured indicates the UL packet delay, DL packet delay, round trip packet
delay or jitter between the UE and the UPF is to be monitored when the QoS
Monitoring for URLLC is enabled for the service data flow.
2\. The PCF makes the policy decision and initiates the PDU Session
modification procedure as defined in clause 4.3.3.2, steps 1b, 3b, 4-8b of TS
23.502 [3].
If the direct notification of QoS monitoring is subscribed, the PCF includes
the indication of direct event notification for the service data flow within
the PCC rule.
If the SMF receives the indication of direct event notification form the PCF
and the SMF determines that the UPF supports such reporting, the SMF sends QoS
monitoring parameters and associate them with the NEF or AF address to the UPF
via N4 rules. Otherwise the SMF activates N4 reporting.
3\. The UPF obtains QoS monitoring information as defined in clause 5.33.3 of
TS 23.501 [2].
4\. The UPF sends the notification related with QoS monitoring information
over Nupf_EventExposure_Notify service operation. The notification is sent to
Notification Target Address that may correspond (4a) to AF or (4b) to the NEF.
5\. NEF reports the real-time network information to AF by invoking
Nnef_EventExposure_Notify service operation.
#### 6.30.3.2 Procedure for AF to provision jitter requirements to 5GC
Figure 6.30.3.2-1: AF provisioning of Jitter Requirement to 5GC
1\. AF decides whether to trigger jitter minimization according to application
requirements and jitter performance statistics obtained via the procedure in
Figure 6.30.3-1.
2\. AF sends Nnef_AFSessionwithQoS_Create request to NEF if it decides to
trigger jitter minimization.
3\. NEF performs authorization and send Npcf_Policy Authorization_Create
request to PCF.
4\. PCF generates PCC rules to minimization jitter including UL and DL
directions considering the requirements of jitter from AF or NEF. The PCC
rules may include the PDB and allowed jitter range i.e. maximum jitter
including both CN and AN parts in UL and DL directions.
5\. PCF sends Npcf_Policy Authorization_Create response to NEF to indicate the
result of request.
6\. NEF sends Nnef_AFSessionwithQoS_Create response to NEF to indicate the
result of request.
### 6.30.4 Impacts on services, entities and interfaces
AF:
\- Analyse latency related network statistics to derive jitter related KPI.
\- Decide whether to trigger jitter minimization according to application
requirement and jitter related KPI value.
\- Provision jitter requirement to NEF/PCF.
NEF:
\- Interact with AF regarding to network performance i.e. jitter.
\- Receive jitter requirement from AF and convey to PCF.
PCF:
\- Interact with AF or NEF regarding to network performance i.e. jitter.
\- Receive jitter requirement from AF or NEF.
\- Produce jitter related PCC rules and trigger PCC rule update to SMF.
## 6.31 Solution #31: 5GS Policy enhancements to minimize the jitter
### 6.31.1 Key Issue mapping
This solution is for Key Issue #7, which addresses following aspects:
\- Potential policy enhancements to minimize the jitter, focusing on i.e.
requirement provisioning from AF, extension of PCC rule.
### 6.31.2 Description
This solution proposes a method for the 5GS to have a knowledge of the end-to-
end jitter and as well as the air interface transmission jitter and CN part
transmission jitter, which can help PCF generate some policy to minimize the
jitter in different part of 5GS.
In this solution, it is proposed two aspects to minimize the jitter. One
aspect is the 5GS should have a clear idea about the jitter concept, i.e. how
to calculate the jitter value. The second aspect is that once the PCF
calculates the jitter value for RAN part and the part between NG-RAN and PSA
UPF, what kind of policy enhancement can be implemented to reduce the jitter.
1) For the first aspect, with considering the QoS monitoring mechanism in
Rel-16, 5G system can calculate the jitter based on packet transmission delay
per QoS flow. For the 5GS jitter, the End-to-End delay from UE to PSA UPF
should be used. While for the air interface jitter, the air interface delay
from UE to RAN should be considered, and for the CN part jitter, the delay
from RAN to N6 should be considered.
AF sends a request for jitter calculation by using
Nnef_EventExposure_Subscribe request message to NEF, the indication of jitter
requirement, jitter measurement period, sample frequency, reporting threshold
or reporting frequency (clause 6.1.3.21 of TS 23.503 [4]) may be included in
the request, and are sent to PCF via NEF.
When PCF accepts the jitter requirement, PCF generates the QoS Monitoring
policy for a service data flow, based on the request from AF. In the QoS
Monitoring PCC rule, the QoS monitoring period can be the same as jitter
measurement period. Then PCF provides the QoS Monitoring policy to the SMF.
After the QoS monitoring procedure, the SMF can report the RAN part delay
values, delay values between NG-RAN and PSA UPF, to PCF. PCF may use the RFC
1889 [25] method to calculate estimation of jitter(s) of end to end delay, RAN
part delay or delay between NG-RAN and PSA UPF, based on measured delay values
and then sends the estimated jitter value to AF.
2) For the second aspect, AF may provide a jitter expectation to PCF, as well
as the Alternative Service Requirements in a prioritized order. When the PCF
authorizes the service information from the AF and generates a PCC rule, it
shall also derive Alternative QoS Parameter Sets for this PCC rule based on
the QoS Reference parameters or the Requested Alternative QoS Parameter Sets
in the Alternative Service Requirements. So when the end-to-end jitter value
cannot satisfy the AF requirement, the PCF may adjust the policy rule by using
Alternative QoS rules to e.g. set a higher priority level for this flow.
### 6.31.3 Procedures for jitter calculation
The mechanism for AF requesting jitter requirements can be described in the
Figure 6.31.3-1.
Figure 6.31.3-1: AF requesting jitter calculation
0\. The PDU session has been established.
1\. The AF sends a QoS monitoring request to the NEF by
Nnef_EventExposure_Subscribe request message. The request message includes
indication of jitter, jitter measurement period, sample frequency.
2\. The NEF authorizes the AF request and sends the jitter calculation
parameter in the AF request message to the PCF through the
Npcf_PolicyAuthorization_Create request.
3\. PCF generates the authorized QoS Monitoring policy based on the AF
request, measurement period, sample frequency, and triggers SMF to initiate
PDU Session Modification procedure by sending
Npcf_SMPolicyControl_UpdateNotify request.
4a. The SMF sends a QoS Monitoring request to the PSA UPF via N4 and gets
corresponding response.
4b SMF activates the end to end UL/DL packet delay measurement between UE and
PSA UPF for the QoS Flow or GTP-tunnel during the PDU Session Modification
procedure. SMF sends QoS Monitoring request to AMF by
Namf_Communication_N1N2MessageTransfer message, and AMF sends QoS monitoring
request to NG-RAN through N2 interface.
5\. AMF sends QoS monitoring request to NG-RAN through N2 interface.
6\. The NG-RAN initiates the RAN part measurement of UL/DL packet delay based
on the QoS Monitoring request from SMF, and NG-RAN performs delay measurement
based on the existing procedures in clause 5.33.3.2 of TS 23.501 [2] for QoS
monitoring for URLLC.
7\. NG-RAN reports the RAN part UL/DL packet delay to the UPF in the UL packet
data as defined in clause 5.33.3.2 of TS 23.501 [2].
8\. UPF calculates the packet delay between NG-RAN and PSA UPF, as described
in clause 5.33.3.2 of TS 23.501 [2], and reports the packet delay value(s)
between NG-RAN and PSA UPF, RAN part delay value(s) to SMF.
9\. The SMF reports the obtained packet delay value(s) to the PCF by sending
an Npcf_SMPolicyControl_UpdateNotify response message.
10\. When PCF gets the packet delay value(s), including the packet delay
value(s) between NG-RAN and PSA UPF and air interface delay value(s), it
calculate delay jitter(s) based on these delay value(s), jitter measurement
period, sample frequency. Then PCF replies the delay jitter value(s) to NEF.
11\. NEF sends jitter and other QoS monitoring data to AF through
Nnef_EventExposure_Notify.
### 6.31.4 Impacts on services, entities and interfaces
PCF:
\- Receiving the AF jitter requirement indication.
\- Calculating the estimated jitter value based on QoS monitoring E2E latency
value(s) air interface delay value(s).
UPF:
\- UPF to report packet delay value(s) between NG-RAN and PSA UPF, RAN part
delay value(s) to SMF separately to the SMF.
## 6.32 Solution #32: Periodicity Jitter Control for XRM Service
### 6.32.1 Key Issue mapping
This solution is for KI #7 Policy enhancements for jitter minimization.
### 6.32.2 Description
Jitter is an important QoS factor to impact the user\'s QoE of the XRM
service. Since all the PDUs of a PDU Set is sent in a burst, the jitter
between the PDUs within the same PDU Set can be ignored. If there are multiple
PDU Sets within a PDU burst, the jitter between the PDUs within the PDU burst
can also be ignored. For the XRM service, the main jitter comes from the
jitter between the PDU sets from two successive PDU bursts. Since the
periodicity is the time span between the two successive PDU burst. For the
video stream, the periodicity = 1000/FPS (ms). The Periodicity Jitter is the
time difference between measured periodicity with the anticipated periodicity
(=1000/FPS).
### 6.32.3 Procedures
#### 6.32.3.1 Periodicity Jitter Provision procedure
Figure 6.32.3.1-1: Periodicity and Periodicity Jitter Provision procedure
0\. The PDU Session for the XRM service is established, the user initiated the
XRM service.
1\. The XRM AF sends Nnef_AFsessionWithQoS_Create (UE address, AF Identifier,
Flow description, QoS, Periodicity, and Periodicity Jitter) request to the
NEF. The Periodicity is the periodicity time for the UL/DL for the service
stream, the Periodicity Jitter is the jitter requirements for the UL/DL
service stream.
2\. The NEF checks whether the AF is authorized to send request. If the
Authorization is granted, the NEF gets the PCF ID based on the UE address from
the BSF.
3\. The NEF sends Npcf_PolicyAuthorization_Create request (UE ID, QoS,
Periodicity, and Periodicity Jitter) to the PCF.
4\. The PCF generates the PCC rules and sends
Npcf_SMPolicyControl_UpdateNotify Request (UE ID, PCC rules (Periodicity,
Periodicity Jitter)) to the SMF.
5\. The SMF responses to the PCF.
6\. The PCF responses to the NEF
7\. The NEF responses to the AF.
#### 6.32.3.2 Periodicity Jitter Report procedure
Figure 6.32.3.2-1: Periodicity Jitter Report procedure
0\. The PDU Session for the XRM service is established. The user initiated the
XRM service. The Periodicity and Periodicity Jitter provision procedure is per
formed as described in clause 6.32.3.1.
1\. The SMF sends the Npcf_SMPolicyControl_Update request (measured UL and DL
Periodicity Jitter) to the PCF.
2\. The PCF responses the request.
3\. The PCF sends Npcf_PolicyControl_Notify (measured UL and DL Periodicity
Jitter) to the NEF.
4\. The NEF sends Nnef_EventExposure_Notify (measured UL and DL Periodicity
Jitter) to the AF.
5\. Depending on the measured UL and DL Periodicity Jitter reported by the
NEF, the AF may change its codec and the AF may send
Nnef_AFsessionWithQoS_Update (Periodicity Jitter) request to the NEF. The
Periodicity Jitter is the updated Periodicity Jitter. How the AF changes its
codec and how to set the updated Periodicity Jitter is out of scope.
6\. The NEF sends Npcf_PolicyAuthorization_Update request (Periodicity Jitter)
to the PCF.
7\. The PCF generates the PCC rules and sends
Npcf_SMPolicyControl_UpdateNotify Request (UE ID, PCC rules (Periodicity,
Periodicity Jitter)) to the SMF.
8\. The SMF responses to the PCF.
9\. The PCF responses to the NEF
10\. The NEF responses to the AF.
### 6.32.4 Impacts on services, entities and interfaces
AF:
\- Provides new/updated Periodicity and Periodicity Jitter with the XRM stream
to the NEF/PCF.
PCF:
\- Provides the PCC rules for the SDF with Periodicity and Periodicity Jitter
to the SMF.
\- Notifies the measure UL/DL Periodicity Jitter to the AF (via NEF).
SMF:
\- Reports the measured UL/DL Periodicity Jitter to the PCF.
## 6.33 Solution #33: support of CDRX enhancement for power saving handling
### 6.33.1 Key Issue mapping
This solution is for Key Issue #8, which address the assistance to RAN for
CDRX configuration and potential enhancement for power saving handling,
including:
\- What information (if any) can be used to assist the CDRX enhancement?
\- Where does such information come from?
### 6.33.2 Description
In order to support the CDRX enhancement for XR-specific power saving
handling, the CN can send the UL/DL traffic patterns to assist RAN for CDRX
setting and configuration.
1\. The UL/DL traffic patterns may include the number of periodic bursts per
second or traffic periodicity, jitter information, etc. which can be
provisioned by the third-party AF or derived by UPF as the statistic results.
The AF may update the traffic pattern to the network when it changes
Corresponding to PDU Set integrated packet handling, the detailed traffic
pattern information provided from the CN to RAN is as follows:
\- PDU set periodicity and start time of the first PDU of a PDU set: this can
be helpful for configuring the periodicity and start time of CDRX to match
with traffic period.
\- PDU set end indication or indication of the last PDU in a PDU set: this can
be helpful for gNB to indicate the UE to dynamically skip PDCCH monitoring
once the last PDU of the PDU set is delivered.
\- PDU set level QoS parameters including priority and [air interface] delay
budget of a PDU set: this can help the gNB to select suitable CDRX parameters
(e.g. periodicities) that enable fulfilling the delay requirements for a given
flow. It also helps with UE power saving by reducing retransmission or by
early dropping of a PDU that exceeds the delay deadline.
\- PDU set size (number of bits) or number of PDUs in a PDU set: real-time or
dynamic information provided to gNB can help scheduler make more efficient
scheduling decision to enable UE power saving.
\- PDU set identity and relationship information among PDUs within the same
PDU set: gNB can use this information for early PDU dropping as mentioned
above.
\- Jitter information such as the range of the jitter (minimum and maximum
value): Here jitter refers to packet arrival time variation at gNB for DL
direction. gNB could use this information to configure CDRX OnDuration and
Active Time or PDCCH monitoring duration for handling of the jitter.
NOTE 1: Traffic periodicity (e.g. PDU set periodicity) and jitter may exist
for some XRM applications but not for all. It is assumed that the media
application layer is aware whether traffic periodicity and jitter exist or
not.
NOTE 2: If the UPF uses statistic approach to derive traffic periodicity and
jitter and thus trigger CDRX related optimization, AF indication of DL/UL
traffic pattern is not needed.
The traffic pattern may applies to one QoS Flow (in case all PDUs of the
traffic are delivered within a QoS Flow) or to a QoS Flow group (in case the
different kinds of PDU Sets of the traffic are bound to different QoS Flows).
2\. During PDU Session Establishment/Modification procedure, SMF receives the
UL/DL traffic patterns from PCF or UPF and delivers the UL/DL traffic patterns
to RAN, which can be taken into consideration when setting CDRX.
3\. Optionally, the UPF may detect the traffic bursts and add marks in the
GTP-U layer of DL packets to assist RAN with identifying the end of the
traffic bursts.
4\. With the awareness of the UL/DL traffic patterns, the RAN can configure
and enable the CDRX accordingly.
NOTE 3: How to use the UL/DL traffic patterns for CDRX setting/configuration
depends on RAN WGs.
### 6.33.3 Procedures
Figure 6.33.3-1 shows how 5GS acquires and distributes the UL/DL traffic
patterns to RAN for support of XR-specific power saving handling.
Figure 6.33.3-1: UL/DL traffic pattern provisioning from AF
1a. Optionally, the AF may provision or update the UL/DL traffic patterns to
PCF. The traffic patterns may include number of UL/DL periodic bursts per
second or traffic periodicity, traffic description to localize the target
application traffic, jitter information, etc.
1b. During PDU Session Establishment/Modification, PCF may send the UL/DL
traffic patterns to SMF via the PCC rule.
1c. Besides, the UPF may optionally derive the UL/DL traffic patterns based on
the statistical analysis, e.g. via the identification mechanisms detailed in
Sol#12, up to UPF implementations. The UL/DL traffic patterns may include the
number of UL/DL periodic bursts per second or traffic periodicity, jitter
information, etc.
NOTE: UPF derivation of UL/DL traffic pattern is considered as an alternative
of 1a i.e. AF provisioning of UL/DL traffic patterns, which can be applied
when AF doesn\'t support provisioning of the traffic pattern information.
2\. SMF generates or update the UL/DL traffic patterns and sends that to RAN.
Optionally, the burst detection instruction for the UL/DL traffic is also sent
to RAN by SMF. The number of UL/DL periodic bursts per second or traffic
periodicity may be used for CDRX cycle determination and the jitter
information may be used to configure CDRX On Duration and Active Time or PDCCH
monitoring duration for handling of the jitter.
3\. Optionally, SMF may send the N4 rule to UPF. The N4 rule may include the
burst marking rule, which can help the UPF to mark the DL traffic burst
accordingly. If step 3 is not performed, the N4 rule may also include the
burst detection rule to assist UPF for burst detection.
4\. Complete the remaining steps of PDU Session Establishment/Modification
procedure.
5\. After the target service started, the UPF may detect the periodic burst
and mark the DL burst end in the GTP-U header based on the DL traffic rule.
Then the DL packets with marks in the GTP-U header can help RAN to identify
the end of the DL traffic bursts.
6\. Based on the UL/DL traffic pattern, the RAN can determine the end of the
traffic bursts. For example, based on the end marks in the GTP-U header, the
RAN can determine the current burst transmission is over and enable the CDRX,
e.g. sending DRX Command MAC CE to trigger the start of CDRX.
7\. Based on the UL/DL traffic patterns, RAN enables the CDRX
setting/configuration accordingly.
### 6.33.4 Impacts on services, entities and interfaces
AF:
\- Provisioning the new or updated UL/DL traffic patterns to NEF/PCF.
NEF:
\- Receive the new or updated UL/DL traffic patterns and send to PCF.
PCF:
\- Receive the new or updated traffic patterns from AF and send it to SMF.
SMF:
\- Receive the UL/DL traffic patterns from PCF or UPF.
\- Generate or update the UL/DL traffic patterns and send it to RAN.
\- Send N4 rule to assist UPF for burst detection.
UPF:
\- Statistically collect and report the UL/DL traffic patterns.
\- Report the statistical UL/DL traffic patterns to SMF.
\- Detect and mark the DL traffic burst as instructed by SMF.
RAN:
\- Receive the UL/DL traffic patterns.
\- Detect the end of DL traffic burst as instructed by SMF.
## 6.34 Solution #34: 5GC and UE Assistance to RAN for CDRX Optimization
### 6.34.1 Key Issue mapping
This solution addresses aspects of Key Issue #8 and Key Issue #9.
This solution describes how the 5GC and UE can provide assistance information
to the RAN to allow the RAN to maximize CDRX power savings opportunities. The
solution describes how the assistance information is provided to the RAN and
how this assistance information can be used by the RAN.
### 6.34.2 Description
The solution shows how the 5GC and UE may assist the RAN so that it maximizes
the power savings opportunities for a UE. CDRX operation is controlled by the
RAN node and is configured to provide the UE with periods of time during which
the UE does not need to monitor the downlink control channel. The assistance
information proposed in this solution allows the RAN node to configure the
CDRX operation based on attributes of the XR/media services and based on the
attributes of the UEs using these services. Parts of this solution are
modelled after the External Parameter Provisioning feature that is defined in
TS 23.501 [2] and TS 23.502 [3].
The proposal is based on the following enhancements to the 5G system:
\- A 3rd party application server may invoke an NEF API to provide the 5GC
with information about the XR/Media service. For example, the NEF API can be
used to provide a traffic pattern(s) (e.g. related to video transmission) and
the traffic type(s) (UE driven or server driven) of the XR/Media service.
Multiple traffic patterns may be provided by the 3rd party application server
because the traffic patterns may change dynamically. The RAN may use the
Multiple Traffic patterns to provide the UE with multiple CDRX configurations
(e.g. a configuration for each traffic pattern). The 3rd party application
server may also update the traffic patterns (e.g. if possible configurations
change).
\- Some UEs may be able to autonomously determine between one of two operating
modes; high-power and low-power. The high-power mode may be used when the UE
requires higher throughput/performance and lower latency, at the expense of
power consumption. While the low-power mode may be used to save power (at the
expense of lower throughput/performance and higher latency). The decision to
switch between one mode or the other mode may be based on power status
(battery-powered or mains/wall-powered) or based on a user preference.
\- To optimize power savings based on these different attributes (i.e. traffic
pattern and operating mode), a UE may be configured, by the RAN, with multiple
CDRX configurations or with an adaptable CDRX configuration. A UE may choose
to move from one CDRX configuration to another, or may choose to modify a CDRX
configuration parameter based on the traffic pattern that is being used.
### 6.34.3 Procedures
#### 6.34.3.1 XR Communication Pattern Provided via 3rd Party Application
Server
The 3rd party application server invokes an NEF API to provide or update the
network with an XR Communication Pattern related to an XR/media service that
is used by the UE. This XR Communication Pattern may be used later by the SMF
to provide assistance to the RAN.
The procedure that is used to configure information about a session of the
XR/media service may be modelled after the External Parameter Provisioning
procedure that is shown in clause 4.15.6.2 of TS 23.502 [3] and the
Nnef_ParameterProvision service which is defined in clause 5.2.6.4 of TS
23.502 [3].
The inputs to the NEF API may be:
\- A session identifier for the XR/media service.
\- XR Communication Pattern associated with the session. The XR Communication
Pattern including the following information: frame rate(in frames/sec) or
periodicity (in msec), Group of Picture (GOP) structure (which defines the
arrival pattern of the different video frame types (e.g. ,I-frames,
P-frames)), Dynamic GOP (which defines if the application can dynamically
change the GOP structure), Maximum frame size (which defines the maximum frame
size in terms of octets or IP packets), and a traffic profile (which
identifies if the DL traffic is UE driven or server driven). For UE driven
traffic, an UL transmission triggers a DL transmission from the server. For
Server driven traffic, a DL transmission triggers an UL transmission from the
UE.
Table 6.34.3.1.1: Description of XR Communication parameters
+----------------------------------+----------------------------------+ | XR Communication parameter | Description | +==================================+==================================+ | Frame rate | Indicates the frame rate | | | | | | Example: 60 fps | +----------------------------------+----------------------------------+ | Group of Picture (GOP) structure | Defines the arrival pattern of | | | the different video frame types. | | | Denoted as (M,N) where M is the | | | number of frames between anchor | | | frames (I frames or P frames), | | | and N is the number of frames | | | between consecutive I frames. | | | | | | Example: (M,N) = (3,12) | | | corresponds to a GOP structure | | | of IBBPBBPBBPBBI | +----------------------------------+----------------------------------+ | Dynamic GOP | Indicates if the application can | | | dynamically change the GOP | | | structure. | | | | | | This information indicates to | | | the RAN that it can not assume a | | | consistent frame rate | +----------------------------------+----------------------------------+ | Maximum frame size | Indicates the maximum number of | | | IP packets for a frame. | | | | | | This information can be used by | | | the RAN to detect the end of a | | | burst if PDUs that make up a | | | frame. | | | | | | Example: 50 packets | +----------------------------------+----------------------------------+ | Traffic Profile | Indicates if DL traffic is UE | | | driven or server driven | | | | | | Example: UE driven -- implies | | | that DL traffic is triggered by | | | UL traffic (e.g. pose | | | information) | +----------------------------------+----------------------------------+
In this solution, the UDM stores the XR Communication Pattern that is
associated with the session of the service. Following the principles of the
External Parameter Provisioning procedure, the UDM may classify this
information as \"SMF associated\". The SMF may retrieve this information,
combine/merge overlapping parameters for the UE and derive CN assisted RAN
information. The latter is sent to the RAN (via the AMF), so that the RAN node
may optimize Uu resource allocation (similar to the case for NB-IoT UEs) and
CDRX configurations.
The XR Communication Pattern information that is sent to RAN and used to
derive CDRX Configurations relates to all the flows that are sent or received
by the UE. For example, it may be certain types of data (e.g. I-frames and
P-frames) are bound to different QoS flows. Regardless of whether traffic is
segregated into different QoS Flows or bound to a single QoS Flow, CDRX
opportunities only occur at times when the UE is not sending or receiving
traffic. Thus, each XR Communication Pattern information should represent a
possible the aggregate pattern for the PDU Session.
#### 6.34.3.2 UE Configured with multiple CDRX Configurations
Figure 6.34.3.3-1 shows an example use case where the UE is configured with
multiple CDRX configurations, where the CDRX configurations may be tailored to
a specific frame type (I-frame vs B/P-frames).
NOTE 1: The concept of I, P and B frames may not be generally applicable to
new codecs and in particular for low-latency applications. The procedure uses
this concept for an example to show how the CDRX configurations could be
optimized.
Figure 6.34.3.2-1: UE Configured with multiple CDRX Configurations
1\. RAN node receives the CN assisted RAN information from the SMF. The CN
assisted RAN information may be updated by the SMF based on updated traffic
patterns from the 3rd party application server (e.g. if possible
configurations change).
2\. Based on this information, the RAN node configures the UE with multiple
CDRX configurations. CDRX Configuration 1 may be for transmission of I-frames,
and CDRX configuration 2 may be for the transmission of B/P-frames. The UE is
configured with these configurations as well as an indication of which
configuration to use initially.
NOTE 2: This part of the solution requires coordination with RAN WGs.
3\. UE receives XR/Media service downlink traffic according to the initial
CDRX configuration.
4\. Application layer notifies the UE that it has just received an I-frame.
Based on the known GOP structure and frame rate, the UE determines the next
time instance when an-I frame is expected. UE starts using CDRX configuration
2.
5\. UE signals to the RAN node that it is using CDRX configuration 2.
NOTE 3: How the UE signals to the RAN node that it is using CDRX configuration
2 is in scope of RAN WGs but may be through RRC message MAC CE, or PHY layer
control signalling.
6\. RAN node changes to CDRX configuration 2.
7\. After this, RAN node and UE may use the known GOP structure to switch
between CDRX configurations. Explicit signalling from UE may be used to ensure
that the UE and RAN node are using the same CDRX configuration.
#### 6.34.3.3 UE Configured with Adaptable CDRX Configuration
Figure 6.34.3.3.2 shows an example use case where the UE is configured with an
adaptable CDRX configuration, where the UE may autonomously change the CDRX
operation, based on uplink activity that triggers a DL transmission that, for
example, has strict Motion-to-Photon (MTP) latency. In this example use case,
the UE adapts the CDRX Active time, however, the following CDRX parameters
defined in [17], are also adaptable:
\- DRX cycle: defines the length of the periodic repetition of the ON duration
followed by a possible period of inactivity.
\- DRX ON duration timer: defines the duration at the beginning of a DRX cycle
(e.g. where the UE monitors the PDCCH).
\- DRX start offset: defines the subframe (i.e. time unit used in the access
stratum) where the DRX cycle starts.
\- DRX slot offset: defines the delay before starting the DRX On duration
timer.
\- DRX inactivity timer: defines the duration after the PDCCH occasion in
which a PDCCH indicates a new UL or DL transmission.
Figure 6.34.3.3.1: UE Configured with Adaptable CDRX Configuration
1\. RAN node receives the CN assisted RAN information from the SMF. The CN
assisted RAN information may be updated by the SMF based on updated traffic
patterns from the 3rd party application server (e.g. if possible
configurations change).
2\. Based on this information, the RAN node configures the UE with an
adaptable CDRX configuration. An adaptable CDRX configuration is a
configuration that allows the UE to autonomously change a parameter of the
configuration (i.e. the UE may select what value (e.g. inactivity timer) are
applied in the configuration).
NOTE 1: This part of the solution requires coordination with RAN WGs.
3\. UE receives XR/Media service downlink traffic.
4\. UE generates pose information that will trigger downlink transmission with
strict Motion-to-Photon (MTP) latency. The Access stratum is notified that UE
should extend its CDRX Active time (e.g. ON duration) to receive this downlink
transmission.
5\. UE signals to the RAN node that the UE will extend its CDRX Active time.
6\. UE sends uplink pose information.
NOTE 2: How the UE signals to the RAN node that it is has extended the CDRX
Active time is in scope of RAN WGs but may be through RRC message, MAC CE, or
PHY layer control signalling. If a MAC CE mechanism is used, the control
signalling may be included in the header of the PDU carrying the pose
information
7\. UE receives DL information in the extended CDRX Active time.
8\. After reception of the DL transmission triggered by the pose information,
UE signals to the RAN node that it has stopped extending the CDRX Active time.
NOTE 3: How the UE signals to the RAN node that it is has stopped extending
the CDRX Active time is in scope of RAN WGs but may be through RRC message,
MAC CE, or PHY layer control signalling.
### 6.34.4 Impacts on services, entities and interfaces
NEF:
\- Receives the new or updated service parameter provisioning for XR/Media
sessions.
UDM:
\- Receives the XR/Media session information and stores it as SMF associated
data.
SMF:
\- Sends the new or updated XR/Media session information to the RAN.
RAN:
\- Receives the new or updated XR/Media session information from the SMF.
\- Configures the UE with multiple CDRX configurations or multiple CDRX
parameters based on the XR/Media session information.
\- Receives an indication from the UE of which CDRX Configuration is being
used.
UE:
\- Receives multiple CDRX configurations or CDRX parameters from the RAN node.
\- Selects a CDRX configuration or CDRX parameter to use and indicates to the
RAN node which configuration is used.
AF:
\- Provisions the new or updated traffic patterns for XR/Media sessions.
## 6.35 Solution #35: Provision of conditional QoS profile(s)
### 6.35.1 Key Issue mapping
This solution applies to Key Issue #9 \"Trade-off of QoE and Power Saving
Requirements\".
### 6.35.2 Description
In this solution, for a specific QoS Flow, in addition to the QoS Profile of
the QoS Flow, SMF also provides one or more conditional QoS profile(s) to NG-
RAN. Each conditional QoS profile includes the QoS parameters as contained in
the current QoS profile defined in clause 5.7.1.2 of TS 23.501 [2], and the
event to active the conditional QoS profile. The event, for example, could be
\"time interval [start, end]\", \"duration of the service=x\", \"UE
power/memory status\" etc. When the event is detected, NG-RAN actives the
corresponding conditional QoS profile and deactivate the current used QoS
profile, NG-RAN also sends a notification to the SMF for the QoS profile
changing.
This solution assumes AF can foresee the relationship of power consumption and
time related events e.g. \"time interval [start, end]\", \"duration of the
service=x\", or NG-RAN can get power consumption (e.g. device battery life)
from UE, thus the conditional QoS profile(s) with event can be seen as the
trade-off of throughput/latency/reliability and power consumption.
### 6.35.3 Procedures
The procedure for providing of conditional QoS profile is described in the
Figure 6.35.3-1.
Figure 6.35.3-1: Providing of conditional QoS profile
1\. AF provides service information to the PCF by invoking
Npcf_PolicyAuthorization_Create Request or Npcf_PolicyAuthorization_Update
Request service operation as described in step 1a of clause 4.16.5.2 of TS
23.502 [3]. The AF may provide conditional service requirements containing one
or more QoS reference parameters, and an associated event for each QoS
reference parameter. The event, for example, could be \"time interval [start,
end]\", \"duration of the service=x\", \"UE power/memory status\" etc. For an
untrusted AF, NEF can be involved between the AF and PCF.
2\. PCF generates the authorized PCC rule(s). The PCC rule(s) may include one
or more conditional QoS parameter sets. Each conditional QoS parameter set
includes the QoS parameters as defined in clause 5.7.1.2 of TS 23.501 [2], and
the associated event.
3\. PCF performs PCF initiated SM Policy Association Modification procedure as
defined in clause 4.16.5.2 to provide the PCC rule(s) to SMF.
4\. SMF decides the QoS flow to be used and initiates PDU Session Modification
procedure as described in clause 4.3.3.2 of TS 23.502 [3]. For each QoS flow,
besides the QoS profile of the QoS flow, one or more conditional QoS
profile(s) may be provided to RAN. Each conditional QoS profile includes the
QoS parameters and the associated event, for example, could be \"time interval
[start, end]\", \"duration of the QoS flow=x\", \"UE power/memory status\",
etc.
5\. RAN firstly uses the QoS profile of the QoS flow for AN resource
allocation, then when an event is detects for a conditional QoS profile, the
conditional QoS profile is active, while the QoS profile of the QoS flow is
set to inactive. RAN may detect the event locally by itself, e.g. for the
event \"time interval [start, end]\", or detect the event after interaction
with UE, e.g. for the event \"UE power/memory status\".
6-8. RAN indicates to CN the current used conditional QoS profile. SMF may
further use NAS signalling to inform UE about the QoS change with considering
the instruction from PCF.
### 6.35.4 Impacts on services, entities and interfaces
PCF:
\- Providing PCC rule with conditional QoS parameter set(s) to SMF.
SMF:
\- Providing conditional QoS profile(s) to RAN.
RAN:
\- Detect the event and decides the conditional QoS profile to be used.
UE (conditional, if we agree finally to use the event of \"UE power/memory
status\"):
\- Providing UE\'s power/memory status (e.g. device battery life) to RAN.
## 6.36 Solution #36: Handling multiple QoS flows of one UE together
### 6.36.1 Key Issue mapping
The solution applies to Key Issue #1 Policy control enhancements to support
multi-modality flows coordinated transmission for single UE.
### 6.36.2 Description
Multi-modal Data consists of more than one Single-modal Data, and there is
strong dependency among each Single-modal Data. Single-modal Data can be seen
as one type of data. Hence the transport link of the multi-modal data (e.g.
audio, video and haptic data related to a specific time) for an application
need to be guaranteed together. When one modal data is failed to be
transmitted to the client, the data of the rest modals doesn\'t make sense
anymore. So when the network allocates resource allocation for the QoS flows
mapped for multiple modals data flows, those QoS flows should be handled
together, e.g. setup together, or release together.
The solution is based on the existing QoS policy with the following
enhancement:
\- The AF provides a group of (Flow description, QoS requirement associated to
the Flow Description) with the Handling Together Indication.
\- The PCF authorizes all of QoS requirements corresponding to the flow in the
group of flows as a whole. based on the received group of (Flow
description(s), QoS reference) and the Handling Together Indication.
\- The SMF handles the group of PCC rules as a whole, based on the received
group of PCC rules and Handling Together Indication from the PCF.
### 6.36.3 Procedures
#### 6.36.3.1 Procedure for single UE
Figure 6.36.3.1-1: Setting up an AF session with required QoS procedure
1\. In order to request QoS handling for multi-modality flows with a single
UE, the AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, a
group of (Flow description, QoS requirement associated to the Flow
description), Handling Together Indication) to the NEF.
The Handling Together Indication indicates the provided group of flows need to
be handled together.
2\. The NEF authorizes the AF request. The NEF interacts with the PCF by
triggering a Npcf_PolicyAuthorization_Create request and provides UE address,
AF Identifier, group of (Flow description, QoS requirement associated to the
Flow description), Handling Together Indication).
3\. PCF derives the required QoS parameters based on the information provided
by the NEF.
If a group of (Flow description, QoS requirement associated to the Flow
description) and Handling Together Indication are provided, the PCF authorizes
all of QoS requirements corresponding to the group of flows as a whole:
\- if the QoS requirement of any flow is rejected, the PCF rejects all of QoS
requirements corresponding to the group of flows;
\- otherwise, if all flows\' QoS requirement are authorized, the PCF generates
a group of PCC rules and Handling Together Indication.
4\. The PCF sends a Npcf_SMPolicyControl_UpdateNotify request (a group of PCC
rules, Handling Together Indication) the SMF.
If a group of PCC rules and Handling Together Indication are provided, the SMF
handles the group of PCC rules as a whole:
\- if any PCC rule fails, the SMF notifies the PCF all the PCC rules in the
group of PCC rules fail;
\- otherwise, if all the PCC rules are authorized, the SMF binds the received
group of PCC rules to QoS flow(s), as described in QoS flow binding in TS
23.503 [4].
6\. Step6 is the same as the existing NW triggered PDU Session Modification
procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
7\. If resource allocation for any PCC rule was unsuccessful, e.g. due to the
corresponding QoS flow fails to be setup, the SMF reports to PCC rule error
the PCF via Npcf_SMPolicyControl_Update request message.
8\. The PCF revokes the rest of PCC rules in the group of PCC rules by
initiate Npcf_SMPolicyControl_UpdateNotify to the SMF.
11\. The PCF triggers Npcf_Policy Authorization_Notify to notify the failure
of QoS request.
12\. The NEF triggers Nnef_AFsessionWithQoS_Notify to notify the failure of
QoS request.
### 6.36.4 Impacts on services, entities and interfaces
AF:
\- Provide a group of QoS requirements (i.e. Flow description, QoS requirement
associated to the Flow Description) with the Handling Together Indication.
PCF:
\- Authorizes all of QoS requirements corresponding to the flow in the group
of flows as a whole, based on the received group of (Flow description(s), QoS
reference) and the Handling Together Indication.
\- if the QoS requirement of any flow is rejected, the PCF rejects all of QoS
requirements corresponding to the group of flows.
\- otherwise, if all flows\' QoS requirement are authorized, the PCF generates
a group of PCC rules and Handling Together Indication.
SMF:
\- the SMF handles the group of PCC rules as a whole, based on the received
group of PCC rules and Handling Together Indication from the PCF:
\- If any PCC rule fails, the SMF notifies the PCF all the PCC rules in the
group of PCC rules fail.
\- Otherwise, if all the PCC rules are authorized, the SMF binds the received
group of PCC rules to QoS flow(s).
NEF:
\- Authorize the AF request take into consideration the received group QoS
requirements.
## 6.37 Solution#37 : Policy coordination for multiple UEs in multiple PCFs
### 6.37.1 Key Issue mapping
This solution addresses KI#2: Support the Application Synchronization and QoS
Policy Coordination for Multi-modal Traffic among Multiple UEs.
### 6.37.2 Description
AF can provide coordinated policy requirement to 5GS for multiple UEs within a
single PLMN.
AF interacts with one NEF through Nnef_ServiceParameter_Create service
operation with providing group policy information to UDR. The group policy
information include Group policy ID, the UE(s) GPSIs, External Group
Identifiers (optionally), flow description(s), QoS Reference, QoS parameters,
Alternative Service Requirements (as described in clause 6.1.3.22 of TS 23.503
[4]), latency different threshold and corresponding UEs. It is not necessary
for the flows to be established prior to the AF invoking
Nnef_ServiceParameter_Create, thus the Flow Description(s) do not include the
IP Address of the UE(s).
During PDU session establishment or modification, PCF(s) get these group
policy parameters and derive corresponding PCC rules for each multi-modal
traffic flow.
When AF decides to change one policy for a specific traffic flow of UE1, e.g.
when AF only would like to turn down one UE\'s flow bit rate(the trigger maybe
the UE moves out of a specific coverage area) and the AF may request for a
specific UE flow, the existing AF session with required QoS update procedure
in clause 4.15.6.6a of TS 23.502 [3] can be used.
Some enhancement is that the PCF for UE1 flow can update the PCC rule based on
AF requirement, and then store the policy data within UDR with updating the
group policy information. The other PCFs for multi-modal UEs, which have
subscribed the group policy data update, can be notified with the updated
group policy data.
Then the other PCFs based on the updated group policy data, may update their
PCC rules to satisfy the coordination policy handling requirement.
\- One coordination policy handling requirement is: if one multi-modal traffic
flow\'s priority level is changed from 40 to 20, the related multi-modal
traffic flows\' priority level should also be changed to 20.
\- Another coordination policy handling requirement is: if one multi-modal
traffic flow\'s PDB is changed from 30ms to 20ms, the related multi-modal
traffic flows\' PDB should also be changed to 20ms.
### 6.37.3 Procedures
#### 6.37.3.1 Procedures for group policy data configuration
The following figure shows the procedure of group policy data configuration
from AF to 5GS.
Figure 6.37.3.1-1: Group policy data configuration
1\. AF invokes an Nnef_ServiceParameter_Create service operation with
providing multi-modal group policy which includes QoS information for each UEs
(flow description, QoS parameters, AF Identifier, UEs GPSI, QoS Reference,
latency threshold, latency difference threshold list between UE and other UE
in the group, Group policy ID). The NEF authorizes the AF request and performs
the mapping between GPSI and SUPI.
2\. UDR stores the multi-modal group policy data.
3\. NEF responses to AF.
#### 6.37.3.2 Procedures for AF request targeting an individual UE policy to
the relevant PCF
Figure 6.37.3.2-1: AF request targeting an individual UE policy to the
relevant PCF
0\. PCF get the multi-modal related policy information for the UE during the
PDU session establishment
1\. AF initiates multi-modal traffic policy update with providing information
includes flow description, QoS parameters, AF Identifier, UE address (i.e. IP
address or MAC address), QoS Reference, latency threshold.
2\. PCF discovery as described in clause 4.3.6.4 TS 23.502 [3].
3\. PCF1 update PCC rules for the multi-modal traffic of one UE based on AF
request.
4-5. PCF1 invoke Nudr_DM_Update with updating the UE\'s policy data to group
policy information in UDR.
6-7. PCF1 may subscribe the group policy information update, especially
triggered by other UE\'s multi-modal traffic related policy update.
8\. PCF2 may subscribe the group policy information update, and then in step
8, the PCF2 can get the updated group policy data.
9\. PCF2 update PCC rules for the multi-modal traffic of UE2 based on new
group policy data.
10\. PCF1 trigger the SM policy association modification and sends the new PCC
rule to SMF1. This step may happen in parallel with steps 4-9.
11\. PCF2 trigger the SM policy association modification and sends the new PCC
rule to SMF2.
### 6.37.4 Impact on existing entities and interfaces
NEF
\- Nnef_ServiceParameter_Create service operation enhancement with including
group policy information.
\- Nnef_AFSessionWithQoS_Update service operation enhancement with including
UE IP/MAC addresses.
PCF
\- Capability enhancement with considering group policy data to create new PCC
rules for one multi-modal traffic.
UDR
\- Service operation enhancement with supporting group policy data
configuration.
## 6.38 Solution #38: Flow Association Using a Coordination Identifier
### 6.38.1 Key Issue mapping
This solution addresses aspects of Key Issue #1 and Key Issue #2.
This solution describes how the traffic flows of UE application(s) that are
part of the same tactile and multi-modal communication service, and hosted on
the same or different UEs, may be associated in the 5G System so that the QoS
policies of the flows may be coordinated. The solution also describes how 3rd
party applications and the 5GS may interact to coordinate QoS policies between
multiple QoS flows.
The principles of the solutions are:
\- A 3rd party application may invoke an NEF API to provide UE Identifiers
(e.g. GPSIs), Flow Description(s), QoS References, and/or QoS Parameters to
the 5GC for a tactile and multi-modal communication service. The Flow
Description(s), QoS References, and/or QoS Parameters may be stored in the
UDR.
\- The UDM may allocate a Coordination Identifier for the tactile and multi-
modal communication service and provide it to the 3rd party application in
response to the API invocation (via the NEF).
\- The 3rd party application may provide the Coordination Identifier to UE
hosted applications that want to participate in the service. This step is out
of SA2\'s work scope.
\- The UE hosted applications may provide the Coordination Identifier to the
network during PDU Session Establishment. For example, it may be provided
during PDU Session Establishment similar to how a DNN would be provided during
PDU Session Establishment.
\- The SMF and PCF may use the Coordination Identifier to obtain the QoS
Policies for the tactile and multi-modal communication service from the UDR.
### 6.38.2 Description
The solution shows how the flows of a tactile and multi-modal communication
service may be associated (i.e. identified) in the 5GS, how to ensure that the
network applies the correct QoS policies for the tactile and multi-modal
communication service, and how the network may be able to ensure that all
flows of the tactile and multi-modal communication service use the same PSA
UPF, if necessary. Parts of this solution are modelled after the 5G VN group
management feature that is defined in TS 23.501 [2] and TS 23.502 [3].
A 3rd party application may invoke an NEF API to configure QoS policies in the
5GC for a tactile and multi-modal communication service and to request that
the 5GC allocate a Coordination Identifier for a tactile and multi-modal
communication service. The Coordination Identifier is used to identify which
flows are associated with the tactile and multi-modal communication service.
A UE Application uses application layer procedures with the 3rd party
application to discover and join the tactile and multi-modal communication
service. The Coordination Identifier is provided to the UE Application by the
3rd party application when it discovers, or joins, the tactile and multi-modal
communication service.
As UE Application(s) join the tactile and multi-modal communication service,
the 3rd party application may provide the Coordination Identifier to the UE
application and invoke an NEF API to provide the network with the identity
(e.g. GPSI) of the UE(s) that are participating in the service.
When the UE Application initiates traffic that is associated with the tactile
and multi-modal communication service, the UE Application may provide the
Coordination Identifier to the NAS layer as a Traffic Descriptor. URSP Rules
may be configured in the UE to use the Coordination Identifier as a Traffic
Descriptor and select a DNN / S-NSSAI combination that is suitable for the
traffic. The Coordination Identifier may also be provided to the network in
the PDU Session Establishment and PDU Session Modification procedures.
This solution does not require that the same SMF, UPF, RAN, or AMF be selected
in the multiple UE scenario. However, the Coordination Identifier may be used
by the network:
\- in SMF selection;
\- in PCF selection and the Coordination Identifier may be provided to the PCF
to obtain PCC Rules that are associated with tactile and multi-modal
communication service; and
\- in UPF selection if there is a need to ensure that all PDU Sessions that
carry application traffic that is associated with the same tactile and multi-
modal communication service use the same PSA UPF.
### 6.38.3 Procedures
#### 6.38.3.1 Initiation of the Service by the 3rd Party Application
The 3rd party application server invokes an NEF API to request a Coordination
Identifier for a tactile and multi-modal communication service, provides the
network with identities of the UE(s) that may be associated with the tactile
and multi-modal communication service, and provides the network with Flow
Description(s), QoS References, and/or QoS Parameters that are associated with
the tactile and multi-modal communication service. The Flow Description(s),
QoS References, and/or QoS Parameters may be used later by the PCF to derive
PCC and URSP rules. It is not necessary for the flows to be established prior
to the 3rd party application invoking the API, thus the Flow Description(s) do
not include the IP Address of the UE(s).
The procedure that is used to request the Coordination Identifier and
configure information about the service (i.e. Flow Description(s), QoS
References, and/or QoS Parameters) may be modelled after the External
Parameter Provisioning procedure that is shown in clause 4.15.6.2 of TS 23.502
[3] and the Nnef_ParameterProvision service which is defined in clause 5.2.6.4
of TS 23.502 [3].
In this solution, the UDM assigns the Coordination Identifier to the tactile
and multi-modal communication service and stores the Flow Description(s), QoS
References, and/or QoS Parameters that are associated with the service.
The optional inputs to the NEF API may be:
\- A list of GPSI(s) of UE(s) that may participate in the tactile and multi-
modal communication service.
\- Flow Description(s), QoS References, and/or QoS Parameters that should be
associated with the service.
NOTE: Policy content to address jitter requirements will be addressed as part
of Key Issue #7.
Outputs of the NEF API are:
\- A Coordination Identifier that is used to associate the flows of the
service.
#### 6.38.3.2 Discovery of the Service by a UE Application
A UE Application discovers or is configured with information about the tactile
and multi-modal communication service. The discovery or configuration
operation is used to provide the Coordination Identifier to the UE
Application. This procedure is out of SA WG2 scope.
#### 6.38.3.3 Initiation of Service Traffic by a UE Application
A UE Application begins to generate traffic that is associated with the
service. The UE Application provides the Coordination Identifier to the NAS
layer as a Traffic Descriptor.
The Traffic Descriptor may be used to perform URSP evaluation and select an
existing PDU Session for the Traffic or select a DNN / S-NSSAI combination
that may be used to establish a new PDU Session for the Traffic.
If an existing PDU Session is selected, the UE uses a PDU Session Modification
procedure to provide the Coordination Identifier to the network. The
Coordination Identifier may trigger SMF relocation, may be used to obtain PCC
Rules that are associated with the tactile and multi-modal communication
service, and may be used in UPF selection.
If a new PDU Session is established, the UE uses a PDU Session Establishment
procedure to provide the Coordination Identifier to the network. The
Coordination Identifier may be used in SMF selection, may be used to obtain
PCC Rules that are associated with the tactile and multi-modal communication
service, and may be used in UPF selection.
The PCC Rules that are obtained by the SMF in PDU Session Establishment or PDU
Session Modification Procedures are used by the SMF to derive QoS Rules for
the flows of the tactile and multi-modal communication service.
In the SM Policy Association Establishment procedure, the SMF may provide the
Coordination Identifier to the PCF and the PCF may use the Coordination
Identifier as a key when invoking the Nudm_SDM_Get service to retrieve the
Flow Description(s), QoS References, and/or QoS Parameters that are associated
with the tactile and multi-modal communication service from the UDR (i.e. by
invoking Nudr_DM_Query). The Flow Description(s), QoS References, and/or QoS
Parameters may then be used to derive PCC and URSP rules.
The UE providing the Coordination Identifier in the PDU Session Establishment
and/or PDU Session Modification procedures may not be needed if the AF knows
the non-NAT\'d IP address of the UE and is able to configure QoS Policies for
the flow using e.g. using Nnef_AFsessionWithQoS_Create/Update.
### 6.38.4 Impacts on services, entities and interfaces
UE:
\- Allows an application to provide a Coordination Identifier as a Traffic
Descriptor.
\- Uses the Coordination Identifier in URSP evaluation.
\- Provides the Coordination Identifier in the PDU Session Establishment and
PDU Session Modification procedures.
AMF:
\- May use the Coordination Identifier in SMF Selection.
SMF:
\- May use the Coordination Identifier to trigger SMF relocation.
\- May use the Coordination Identifier in UPF Selection.
\- Provides the Coordination Identifier to the PCF in the SM Policy
Association Establishment procedure.
PCF:
\- Provides URSP policies that have a Coordination Identifier as a Traffic
Descriptor.
\- Receives the Coordination Identifier from the SMF in the SM Policy
Association Establishment procedure.
\- Uses the Coordination Identifier to retrieve the Flow Description(s), QoS
References, and/or QoS Parameters for the tactile and multi-modal
communication service from the UDR.
\- Uses the Flow Description(s), QoS References, and/or QoS Parameters to
derive PCC and URSP rules for the tactile and multi-modal communication
service from the UDR.
NEF:
\- Provides an API that allows the 3rd party application to request a
Coordination Identifier, provides Flow Description(s), QoS References, and/or
QoS Parameters and provides a list of UEs that are associated with the
service.
\- Stores the Coordination Identifier, Flow Description(s), QoS References,
and/or QoS Parameters, and list of UEs in the UDR.
UDM:
\- Assigns the Coordination Identifier.
UDR:
\- Stores the Coordination Identifier, provides Flow Description(s), QoS
References, and/or QoS Parameters, and provides a list of UEs that are
associated with the service.
## 6.39 Solution #39: URSP enhancement for same PDU session selection of XRM
service
### 6.39.1 Key Issue mapping
This solution addresses KI#1: Policy control enhancements to support multi-
modality flows coordinated transmission for single UE.
### 6.39.2 Description
It is assumed that an XRM service uses a single PDU Session per UE.
This solution proposes that PCF send the update URSP including XRM application
information to UE through the UCU procedures, to support the same PDU session
can be selected for the XRM service application. The URSP Rules can be
configured or updated with the Traffic Descriptor including XRM application
information (e.g. Domain descriptors, Application descriptors) to associate
the application with the same PDU Session, and route all traffics of the same
XRM service application on this PDU Session.
The XRM application information is to indicate the traffic of XRM service
application transferred by the same PDU session. E.g. for the same S-NSSAI and
DNN, if one established PDU session is used to route the traffic of the XRM
service application, all the traffic of the same XRM service application will
be transferred on the same PDU session, no other PDU session shall be
established for the XRM service application.
The PCF update the UE URSP information after the UE policy association
establishment or modification based on local configuration and operator
policies.
When the UE performs a request for an XRM application, the same PDU session
for XRM application will be matched based on URSP. The AF session request
including DNN, S-NSSAI, UE address, AF Identifier for the XRM service traffic,
can reach the same PCF holding the corresponding PDU Session information.
### 6.39.3 Procedures
The delivery and update of UE policy procedures can be reused, as described in
clause 4.2.4.3 of TS 23.502 [3].
### 6.39.4 Impacts on services, entities and interfaces
PCF:
\- The PCF update the UE URSP including XRM application information (e.g.
Domain descriptors, Application descriptors), and send to UE through the UCU
procedures, to support the same PDU session can be selected for the XRM
service application.
## 6.40 Solution #40: Application layer-based media synchronization
### 6.40.1 Key Issue mapping
This solution addresses KI#1 and KI#2 and enables the synchronization of
different media flows associated to multi-modality traffic within the same UE
or among different UEs that are handled by the same PCF.
### 6.40.2 Description
This solution re-uses existing application layer-based solutions that enable
the synchronization of media flows associated to multi-modality traffic.
TS 26.114 [28] provides examples of how to use the following IETF RFCs in the
context of the IP Multimedia Subsystem (IMS):
\- The Session Initiation Protocol (IETF RFC 3261 [31]) combined with the
Session Description Protocol (IETF RFC 4566 [29]) can be used to establish
multi-modality multimedia sessions among terminals.
\- The Real-time Transport Protocol and the Real-time Transport Control
Protocol (RTP and RTCP, IETF RFC 3550 [9]) can be used to synchronize multiple
media flows associated to the multi-modality sessions.
\- The SDP Grouping Framework (IETF RFC 5888 [30]) define the mid-attribute
and the Flow Identification that allow the decoder to know that different
media flows need to be synchronized.
The abovementioned IETF RFC may be used also by applications that are not
specified by 3GPP, such as, e.g. WebRTC [34]. Descriptions of RTP and RTCP
based media synchronization among multiple endpoints can be found in IETF RFC
7272 [35].
In addition, it is already possible for the PCF to provide the SMF with PCC
rules that mandate the establishment of QoS Flows associated with the
different media flows with consistent QoS characteristics. In particular, for
example, it is possible to assign the same Packet Delay Budget to the QoS
Flows transporting the audio and the video streams of the multi-modality
traffic (see clause 7.3.3 of TS 29.513 [32]). This further optimizes the
synchronization of the different media flows.
### 6.40.3 Procedures
Examples of SIP/SDP signalling procedures for session establishment can be
found in IETF RFC 3665 [33].
Examples of the usage of SIP/SDP, SPD Grouping Framework and RPT/RTCP are
described in TS 26.114 [28].
Clause 7.3.3 of TS 29.513 [32] describes how to use the PCC rules to set QoS
characteristics of different QoS flows so that the synchronization of flows of
a multi-modality traffic is improved.
In order to enable RAN coordination for XR traffic:
\- **Option 1:** Provision of mid-attribute/Flow Identification parameters via
SDP. This option assumes that the PCF supports SDP. The AF provides the mid-
attribute/Flow Identification parameters to the PCF via SDP as per existing
signalling.
\- **Option 2:** Provision of mid-attribute/Flow Identification parameters via
AF signalling. In this option the AF provides the mid-attribute/Flow
Identification parameters by using the procedure for AF session setup with
required QoS (clause 4.15.6.6 of TS 23.502 [3]).
Once the PCF receives the mid-attribute/Flow Identification parameters (either
with Option 1 or with Option 2), it uses them to consistently set the PCC
rules and to affect how the SMF sets up, indirectly, the QoS characteristics
(e.g. by setting the same PDB value) for the QoS flows associated to the
multi-modal XR traffic.
### 6.40.4 Impacts on services, entities and interfaces
\- **Option 1:** **PCF impact** :
\- The PCF needs to be able to read the mid-attribute/Flow Identification
signaled via SDP protocol.
\- The PCF uses the mid-attribute/Flow Identification to set up PCC rules to
handle XR traffic.
\- **Option 2: PCF and AF impact:**
**-** This option requires the extension of the procedure for \"AF session
setup with required QoS\" (clause 4.15.6.6 of TS 23.502 [3]). This requires
changes (i.e. two new information elements) in the Stage 2 and Stage 3
descriptions of the AF-PCF signalling.
**-** The PCF uses the mid-attribute/Flow Identification to set up PCC rules
appropriate to handle XR traffic.
## 6.41 Solution #41: Use of ECN bits for L4S to enable codec/rate adaptation
to meet requirements for services
### 6.41.1 Key Issue mapping
This solution addresses KI#3.
### 6.41.2 Description
L4S, \"Low Latency, Low Loss and Scalable Throughput\", is an network service
using AQM-like mechanism which, instead of dropping packets, uses link state
indications and rate adjustments proportional to the queue delay.
L4S is subject to standardization in IETF L4S [37], RFC 3550 [9]. L4S has been
demonstrated in the RITE EU project [39]. Congestion control algorithms that
support L4S are described, e.g. in TS 29.281 [16].
This solution proposes that the 5G System uses ECN bits defined in RFC 8311
[36] as identifier to be used on IP packets for the new network service called
low latency, low loss and scalable throughput (IETF L4S [37]) RFC 3550 [9].
To address service requirements, by using ECN bits for marking of payload
packets as specified in RFC 8311 [36], the NG-RAN exposes current load level.
The solution is based on following components:
\- Use of ECN bits at IP layer in NG-RAN for L4S.
\- Enablement of using ECN bits for L4S in NG RAN.
\- The UE application layer supports L4S, e.g. provides feedback based on L4S
and the received ECN mark for L4S.
NOTE: This solution is applicable only in case user terminal and Application
Server support L4S defined in RFC 8311 [36] and IETF drafts L4S [37] and RFC
3550 [9] and use protocols that support L4S feedback between user terminal and
application server.
#### 6.41.2.1 Use of ECN bits in NG-RAN for L4S
It is assumed that the varying radio conditions and resource availability in
NG-RAN are the main contributors to the need for the application to adapt its
rate accordingly.
Given that it is NG-RAN that has the visibility of the resource availability
and sudden changes on the radio interface that impact the performance in terms
of latency, any fast reaction to trigger rate adaptation, that is required for
services with tight latency requirements and benefit from bounded latency,
must be triggered by NG-RAN. NG-RAN makes use of ECN bits for marking of
payload packets as specified in RFC 8311[7to support L4S. ECN bits marking
interacts with the application layer, wherein the application layer triggers
rate adaptation based on feedback using ECN bits. In this solution NG-RAN
makes use ECN bits marking for both, DL and UL direction.
NOTE: The criteria that RAN perform the marking is up to RAN implementation.
Editor\'s note: Whether RAN can support such a marking need to be coordinated
with RAN WGs.
#### 6.41.2.2 Enablement of using ECN bits marking for L4S
To enable ECN bits marking for L4S, an existing or a separate QoS flow can be
used for L4S traffic. In context of this descriptive text for readability
reasons, we refer to it as an \'L4S QoS Flow\'. Following are possible
alternatives to determine use of ECN for the purpose of L4S:
\- This alternative does not propose to introduce a new concept and instead it
reuses the 5QI framework. Namely, use of a certain QoS flow for L4S traffic,
enabling ECN bits marking treatment in NG-RAN, is achieved via a preconfigured
5QI value. One or several 5QI(s) may be defined for this purpose by the
operator in a deployment.
\- Provide an explicit indication at the time of QoS Flow setup to indicate
whether use of ECN for the purpose of L4S can be enabled.
There are 3 main principles to establish a L4S QoS flow within a PDU session:
\- Statically: At PDU session establishment the L4S QoS flow is always
established. This by either a pre-configured PCC rule if PCF is used, or by
configuration in SMF.
NOTE: In this case, the configuration ensures the application using the L4S
QoS Flow supports L4S and uses one of the protocols that support ECN feedback.
\- Dynamically based on 5GC configurations: SMF installs a Detection filter in
UPF. This is either based on a request from PCF or from local configuration.
The Detection filter can either use the ECN bits for L4S in the IP header or
the XR server IP address(es). When L4S traffic is detected, the UPF notifies
SMF. If PCF is used, SMF notifies PCF which triggers a L4S QoS flow
establishment, or if PCF is not used, SMF is configured to establish a L4S QoS
flow.
\- Dynamically based on AF request: The AF makes an authorization request
either via NEF (untrusted) or directly to PCF, which triggers a Session
modification procedure according to clause 4.3.3 in TS 23.502 [3].
The filters provided by SMF in the QoS rule to the UE and PDR to the UPF to
identify traffic to be routed onto the L4S QoS flows can be a combination of
existing filters and/or the ECN bits for L4S in the IP packet header of the XR
service.
### 6.41.3 Procedures
### 6.41.4 Impacts on services, entities and interfaces
NG-RAN: support for ECN bits marking for L4S of payload packets as described
in clauses 6.41.1, 6.41.2 using RFC 8311 [36].
UE: Support L4S application layer, e.g. provides feedback based on L4S and
feedback the received ECN mark for L4S.
## 6.42 Solution #42: Exposure of round-trip delay to support XR/media
enhancements
### 6.42.1 Key Issue mapping
This solution can apply to key issue 3.
### 6.42.2 Description
For certain interactive XR/ media services, the server renders the media
content according to the received UL pose/control information from the UE and
transmits the media content in DL to the UE. So the user experience is
affected by the round-trip delay rather than the one-way delay. So the round-
trip delay may be used by the server to optimize the XR/media services. For
example, if the XR server could get the knowledge that the round-trip delay
within the network is bigger than certain threshold, it can adjust the coding
algorithm complexity accordingly to the impacted UEs so as to further improve
the user\'s service experience. The round-trip delay needs to be exposed
timely in order to guarantee the effective usage in the server side.
This solution is based on the current network information exposure
architecture. The NEF interacts with AF to receive the QoS monitoring request
on the round-trip delay of certain UE, and then obtains the round-trip delay
information from certain network function. Finally the NEF responds with the
requested information to the AF.
There are two possible cases for round-trip delay monitoring:
\- The UL and DL traffic may be within the same QoS flow. In this case, this
QoS flow is impacted for the round-trip delay monitoring.
\- The main UL and DL traffic are separated into two different QoS flows, e.g.
the UL pose/control information from UE is sent in QFI-1, the DL media content
information from sever is sent in QFI-2.
The CN round-trip delay which is between the RAN and PSA UPF for the service
(CNRTT) is calculated by the PSA UPF. If the two QoS flows (QFI-1 and QFI-2)
are impacted, the CNRTT should be the average value of CN round-trip delay of
QFI-1 (CNRTT1) and CN round-trip delay of QFI-2 (CNRTT2), i.e. CNRTT=(
CNRTT1+CNRTT2)/2.
Similarly, the RAN part of round-trip delay for the service could also be
calculated by RAN.
In this solution, the PCF determines the impact QFI(s) according the QoS
monitoring request on round-trip delay. And then the PCF sends the QoS
monitoring indication to the SMF. The SMF sends a QoS Monitoring request to
the PSA UPF via N4 and NG-RAN via N2 signalling to request the QoS monitoring
on round-trip delay.
Based on the monitoring request, the RAN calculates the RAN part of round-trip
delay and sends the results to the PSA UPF; PSA UPF calculates the CNRTT and
obtains the whole round-trip delay for the service.
The related procedure is in the following section.
### 6.42.3 Procedures
Figure 6.42.3-1: Round-trip delay exposure procedure
0\. UE establishes the PDU session for the XR service using certain DNN,
and/or S-NSSAI.
1\. The AF sends a request using Nnef_AFsessionWithQoS_Create request message
(UE address, AF Identifier, Flow description(s) or External Application
Identifier, QoS monitoring for round-trip delay) to the NEF. Optionally, a
period of time, reporting frequency or delay thresholds for the requested
service can be included in the AF request.
2\. The NEF authorizes the AF request. If the authorisation is not granted,
all steps (except step 5) are skipped and the NEF replies to the AF with a
Result value indicating that the authorisation failed.
3\. The NEF consumes Nbsf_Management_Discovery service operation (providing at
least the UE address) to find out the address of the relevant PCF.
4\. The NEF invokes the Npcf_PolicyAuthorization service to the PCF and
provides UE address, AF Identifier, Flow description(s), and QoS monitoring
for round-trip delay. Any optionally received period of time, reporting
frequency or delay thresholds are also included.
5\. The NEF sends a Nnef_AFsessionWithQoS_Create response message (Transaction
Reference ID, Result) to the AF. Result indicates whether the request is
granted or not.
6\. The PCF determines the impacted SMF by the AF request on QoS monitoring.
Regards to the round-trip delay monitoring, the UL and DL traffic may be
within one QoS flow, or separated into two different QoS flows. PCF determines
which QoS flow(s) within the PDU session of the UE are impacted by the QoS
monitoring request.
The PCF invokes Nsmf_ EventExposure_Subscribe service operation to trigger the
QoS monitoring of round-trip delay for the impacted QoS flow(s) to the SMF.
The Notification Target Address is pointing to the NEF.
7\. The SMF provides the N4 rules containing the QoS Monitoring policy
generated according to the information received in step 6 to the UPF via the
N4 Session Modification Request message.
8\. The SMF invokes Namf_Communication_N1N2MessageTransfer ([N2 SM
information] (PDU Session ID, QFI(s), QoS Monitoring indication) to the AMF.
The SMF indicates the request for QoS Monitoring for the QoS Flow according to
the information received from the PCF in step 6.
9\. The AMF sends N2 ([N2 SM information received from SMF] Message to the
RAN.
10\. In the case of receiving the QoS Monitoring indication, the RAN enables
the RAN part of UL/DL packet delay measurement for the QoS Flow(s) and
calculates the RAN part of round-trip delay. According the QoS monitoring
reporting criterion, the RAN reports the RAN part of round-trip delay to the
PSA UPF in the UL data packet or dummy UL packet, as in defined in clause
5.33.3.2 of TS 23.501 [2].
11\. The PSA UPF measures the CN part UL/DL delay of the impacted QoS flow(s)
and calculates the CN part round-trip delay (from PSA UPF and RAN) for the
service.
After receiving the RAN part of round trip delay, the PSA UPF calculates the
round-trip delay within the network.
According the QoS monitoring reporting criterion, the UPF sends a
Nupf_EventExposure_Notify message (round-trip delay) to the NEF.
12\. The NEF sends Nnef_AFsessionWithQoS_Notify message with the round-trip
delay to the AF.
### 6.42.4 Impacts on services, entities and interfaces
NEF:
\- Interaction with AF for the QoS monitoring on round-trip delay information.
\- Receiving the round-trip delay report from the PSA UPF.
PCF:
\- Interaction with NEF/AF for the round-trip delay information exposure.
\- Determine the impacted QoS flow(s) for the round-trip delay monitoring
request.
If the UL and DL traffic for the service are within one QoS flow, this QoS
flow is impacted for the round-trip delay monitoring; If the main UL and DL
traffic for the service are separated into two QoS flows, these two QoS flows
are impacted for the round-trip delay monitoring.
RAN:
\- Receiving the QoS Monitoring request from SMF, including the impacted
QFI(s), round-trip delay monitoring.
\- Measuring the RAN part of round-trip delay for the QFI(s) and sends the
result to the PSA UPF.
PSA UPF:
\- Receiving the RAN part round-trip delay for the QoS monitoring request;
\- Measuring the CN part round-trip delay and obtains the round-trip delay for
service.
\- Reporting the round-trip delay for the service to the NEF.
AF:
\- Interaction with NEF for the QoS monitoring on round-trip delay
information.
## 6.43 Solution #43: Information Exposure to AF for XR/media Enhancements
### 6.43.1 Key Issue mapping
The solution addresses Key Issue #3: 5GS information exposure for XR/media
Enhancements.
### 6.43.2 Description
The interactive between application and 5GS is needed for improving
reliability, alleviating congestion and ensuring desired experience for users.
For example, the XR application server could adjust media codec/traffic rate
to adapt to network conditions. Currently, the application server could get
network condition information by using application layer-based solutions,
which have limitations to expose network condition to the application server.
In this solution, there are two kinds of information to be exposed from 5GS to
AF via the user plane in figure 6.43.2-1:
\- Congestion level information: degree of RAN congestion. This notification
applies for the non-GBR QoS flows. XRM services have the high requirements for
low latency and high bandwidth, which the congestion problem cannot be
ignored. Based on the information exposure, application can adjust the
codec/rate to alleviate 5GS congestion according to the congestion level
information for the QoS flow from 5GS.
\- QoS Notification Control (QNC) information: the notification whether the
GFBR can no longer (or can again) be guaranteed for a QoS Flow during the
lifetime of the QoS Flow. If RAN receives the QNC and the GFBR can no longer
(or can again) be guaranteed, RAN sends the notification to AF via the UPF.
For Congestion level information, the solution also considered how to exposure
such information for UL/DL services using or not using Relaxed ECN described
in RFC 8311 [36].
Figure 6.43.2-1: Information exposure framework
### 6.43.3 Procedure for information exposure
Figure 6.43.3-1: Information exposure to AF via user plane
There are two options for exposing congestion level information to application
server:
Option 1: Exposing based on event exposure framework defined in R17. Including
steps 1\~ 8a, and 9.
Option 2: Exposing based on Relaxed ECN. Including steps 4\~7, 8b and 9, and
optionally steps 1\~3.
If Relaxed ECN (defined in RFC 8311[36]) is used to support the exposure of
congestion level information, steps 4-6 and optionally steps 1-3 can be used
for triggering Relaxed ECN based exposing, a preconfigured 5QI value or an
explicit indication can be used to indicate whether enable the Relaxed ECN for
the QoS.
1\. AF may send AFSessionWithQoS Create request to subscribe the events
notifications, which also includes the trigger conditions.
The events can be the follows:
(a). Congestion level information: AF sends this subscription message to
request that 5GS sends the congestion notification for the QoS flow when the
trigger conditions are met. The congestion level information is used to adjust
the codec/rate of transmission to assist in alleviating 5GS congestion. In
this event, the trigger conditions may include the follows:
\- The queue delay, packet loss rate and buffer size are greater than the
threshold #A, B, C.
\- The congestion level.
(b). QoS Notification Control (QNC) information: AF sends this subscription
message to request that 5GS sends the QNC information to indicate whether the
GFBR can no longer (or can again) be guaranteed for a QoS Flow during the
lifetime of the QoS Flow.
2\. NEF performs the necessary authorization control.
3\. NEF uses the Npcf_PolicyAuthorization_Subscribe request message to send
the AF request information to the PCF to generate the SM policy with the
events notifications and the corresponding trigger conditions (for (a) in step
1).
If the AF is considered to be trusted by the operator, the AF uses the
Npcf_PolicyAuthorization_Subscribe request to interact directly with PCF to
subscribe the above notifications.
4\. PCF sends the SM policy to SMF by Npcf_SMPolicyControl_UpdateNotify
request, which includes the events notifications and the corresponding trigger
conditions (for (a) in step 1).
5\. SMF sends the events notifications to RAN by N2 message via AMF, which
instruct RAN to send the notifications to UPF via the GTP-U header. Moreover,
for 1a, SMF can send the trigger conditions to RAN. Then, RAN only sends the
notifications when the trigger conditions are met.
6\. SMF sends the events notifications to UPF by N4 session modification
request:
\- For option 1: instruct UPF to forward the notifications received by RAN to
AF. Moreover, for 1a, if SMF does not send the trigger conditions to RAN, SMF
should send the trigger conditions to UPF. Then, UPF only forwards the
notifications when the trigger conditions are met.
\- For option 2: instruct UPF to marks DL traffic using Relaxed ECN based on
notification from RAN.
7\. RAN sends the notifications to UPF via the UL GTP-U header. The GTP-U
packet can use to only send the notifications or also send the UL data. For
1(a), If RAN receives the trigger conditions, it performs the judgement
whether the trigger conditions are met.
NOTE 1: How RAN gets aware of UL congestion status is up to further study in
RAN WGs.
8a. UPF forwards the notifications to AF. For (a) in step 1, If UPF receives
the trigger conditions, it performs the judgement whether the trigger
conditions are met.
8b. If the congestion level information is exposed and Relaxed ECN (defined in
RFC 8311 [36]) is used for the DL XRM services, UPF marks the ECN bits of DL
IP packets of the QoS Flow based on the congestion level information reported
by the RAN. UE feedbacks congestion status by using ECN feedback mechanisms of
layer 4 protocol following existing IETF standardization.
After receiving congestion level information, in case of high level
congestion, UPF could help to eliminate the congestion situation by shaping or
buffering DL traffic.
8c. If the congestion level information is exposed and Relaxed ECN (defined in
RFC 8311 [36]) is used for the UL XRM services, UPF marks the ECN bits of UL
IP packets of the QoS Flow based on the congestion level information reported
by the RAN. The application server feedbacks congestion status by using ECN
feedback mechanisms of layer 4 protocol following existing IETF
standardization.
NOTE 2: Once RAN reports congestion end to UPF later, UPF stops ECN marking on
the traffic.
9a. AF receives the notifications via either UPF notification or mechanisms
defined by RFC 8311 [36] and performs the corresponding handling. For example:
\- Congestion level information for adjusting: If the notification shows the
congestion level, AF can know the degree of congestion and reduce the rate
correspondingly.
\- QoS Notification Control (QNC) information: the notification shows whether
the GFBR can no longer (or can again) be guaranteed for a QoS Flow during the
lifetime of the QoS Flow.
9b. If the Relaxed ECN based exposure is used for UL XRM services, the UE can
receive the feedback congestion status from the application server and perform
the corresponding handling.
### 6.43.4 Impacts on services, entities and interfaces
AF:
\- Subscribe the events notifications and provides the trigger conditions.
PCF:
\- Determines PCC rule with the events notifications and the corresponding
trigger conditions.
SMF:
\- Sends the events notifications and the corresponding trigger conditions to
RAN/UPF.
UPF:
\- If API based exposure is used, sends the congestion information
notifications to AF/NEF.
\- Performs the judgement whether the trigger conditions are met.
\- If Relaxed ECN is used, perform ECN marking on UL or DL user packets
according to RAN reports to inform UL or DL congestion to AS or UE
respectively.
\- Shape or buffer DL traffic for the QoS flow according to the received
congestion level information.
RAN:
\- Sends the notifications to UPF via GTP-U header for both UL and DL.
\- Performs the judgement whether the trigger conditions are met.
UE:
\- Sends the notification to AF based on ECN feedback mechanism of Layer 4
protocol.
## 6.44 Solution #44: XRM AF driven Quick QoS Notification Control
### 6.44.1 Key Issue mapping
This solution is for KI ##3 5GS information exposure for XR/media
Enhancements.
### 6.44.2 Description
In this solution, a new request QoS parameter \"bitrate measurement window\"
for the XRM stream from the XRM AF is proposed.
In the 5GS, the QNC (QoS Parameter Notification Control) can be used for a GBR
QoS Flow if the application traffic is able to adapt to the change in the QoS
(e.g. if the AF is capable to trigger rate adaptation). The QoS Parameter
Notification control indicates whether notifications are requested from the
NG-RAN when the \"GFBR can no longer (or can again) be guaranteed\" for a QoS
Flow during the lifetime of the QoS Flow.
In the 5GS, each GBR QoS Flow shall be associated with an AW (Averaging
Window). The AW represents the duration over which the GFBR and MFBR shall be
calculated (e.g. in the (R)AN, UPF, UE). The AW may also be signalled together
with a standardized 5QI to the (R)AN, UE and UPF, and if it is received, it
shall be used instead of the default value. In the Table 5.7.4-1(Standardized
5QI to QoS characteristics mapping) of the TS 23.501, the Default AW is 2000
ms.
The AW represents the duration over which the GFBR and MFBR shall be
calculated (e.g. in the (R)AN, UPF, UE), the AW can determine the measurement
periodicity (i.e. the rate) of the GFBR/MFBR. The QNC is trigged by the NG-RAN
if the GFBR can no longer be guaranteed. The time span (i.e. the latency) from
the GFBR measurement to generate the QNC also be determined by the AW.
The XRM service is assumed to use high data rate (e.g. 360o 3D VR video) and
low latency (e.g. interactive cloud gaming). If the GFBR is changed to very
low value, e.g. the UE enters an elevator or basement with very poor radio
signalling or the UE enters in the quick moving vehicle. If the XRM AF does
not know the GFBR is changed, the XRM AF continues the DL high data rate to
the NG-RAN, the NG-RAN will soon be in congestion state. In such case, the NG-
RAN needs to quickly provide the GFBR changes for the XRM services to the XRM
AF. But if the default AW is used, the 2000ms measurement time is some large
and introduces large latency to generate the QNC for the NG-RAN. In such case,
to reduce the latency from the GFBR change to generating a QNC in order to
reduce the chance of NG-RAN congestion, a lower value AW should be used.
Also, if the GFBR is changed back to a high data rate (e.g. the UE moves out
of the elevator), in order to quickly to recover to DL high data rate to
provide better XRM QoE to the user, the latency from the GFBR change to
generating a new QNC, a low value AW should be used.
Based on the TS 23.501 [2], TS 23.502 [3] and TS 23.503 [4], the AW is
provided by the PCF to the SMF and then is provide to the UPF, RAN and UE. If
no AW is provided to the NG-RAN and there is pre-configured in the NG-RAN, the
pre-configured or the default AW is used.
Though, the PCF can provide the AW value to the SMF based on the XRM stream
information (e.g. the XRM video periodicity = 1000/FPS), however, it is not
defined in the 3GPP standards. I.e. it is not clear how the PCF to set the AW
to the SMF.
The XRM AF can optionally provide a Requested AW to the PCF as an additional
request QoS parameter in the API for the XRM stream, the PCF can set the value
of AW in the PCC rules to be the value of Requested AW from the AF . In such
case, the latency of generating the QNC can be driven by the AF. The Requested
AW normally is less than 2000ms, e.g. is 500ms, 200ms.
When the NEF receives the Requested AW from XRM AF, the NEF forwards the
Requested AW to the PCF. And PCF generates the PCC rules to include the AW
with equitation to the Requested AW.
However, the NG-RAN has its own logical to control the number of the QNC
message to 5GC. The AF provided AW only control the latency from the GFBR
measurement to generating the QNC message, it does not control/determine the
number of QNC to be generated by the NG-RAN.
### 6.44.3 Procedures
Figure 6.44.3-1
0\. The PDU Session for the XRM service is established.
1\. If the XRM AF does not locate at trusted domain, the AF sends the
Nnef_AFsessionwithQoS_Create Request (XRM stream information and requested QoS
(Requested AW) and additional Requested Alternative Parameter QoS Set(s)
(Requested AW(s))) to the NEF.
If the XRM AF locates at trusted domain, the AF sends the
Npcf_PolicyAuthorization_Create Request (XRM stream information and requested
QoS and additional Requested Alternative Parameter QoS Set(s)) to the PCF.
The requested QoS and each Alternative QoS Parameter Set includes a new
request QoS parameter Requested AW. The Requested AW normally is less than
2000ms, e.g. is 500ms, 200ms.
2\. If the NEF is used, the NEF sends the Npcf_PolicyAuthorization_Create
Request (XRM stream information and requested QoS (Requested AW) and
additional Requested Alternative Parameter QoS Set(s) (Requested AW(s))) to
the PCF as described in step 1b.
The NEF forwards the requested QoS and Requested Alternative Parameter QoS
Set(s) with the new requested QoS parameter Requested AW to the PCF.
3\. The PCF sends Npcf_SMPolicyControl_UpdateNotify request (SDF PCC rule (AW)
and addition PCC rules (AW) for each Alternative Parameter QoS Set) to the
SMF.
The PCF generates the Average Windows based on the received Requested AW from
the NEF/AF. The PCF should set the value of AW as the value of the Requested
AW, if the value of AW is allowed based on the policy in the PCF.
4\. The SMF creates a new GBR QoS Flow based on received PCC rule.
Steps 5\~9 are the QoS Notification procedure that are described in the clause
5.7.2.4 of the TS 23.501 [2].
### 6.44.4 Impacts on services, entities and interfaces
AF:
\- Provides the Requested AW as a new request QoS parameter for the XRM stream
to the NEF/PCF.
NEF:
\- Forwards the received new QoS parameter Requested AW from the AF to the PCF
for the XRM stream.
PCC:
\- Generates the Average Window in the PCC rules based on the received
Requested AW.
## 6.45 Solution #45: Information Exposure to AF for XR/media Enhancements
### 6.45.1 Key Issue mapping
The solution addresses Key Issue #3: 5GS information exposure for XR/media
Enhancements.
### 6.45.2 Description
The interactive between application and 5GS is needed for improving
reliability, alleviating congestion and ensuring desired experience for users.
For example, the XR application server could adjust media codec/traffic rate
to adapt to network conditions.
The estimated QoS need to be exposed to AF by the path in figure 6.45.2-2:
\- Estimated QoS: the estimated QoS parameters/characteristics (e.g. the
bandwidth, packet error rate, etc.) in advance for a period of time and/or for
a specific location area. NWDAF predicts the average non-GBR estimated QoS and
sends the notification to AF if the trigger conditions are met, then AF can
decide whether/how to adjust the rate.
Figure 6.45.2-1: Information exposure for estimated QoS
### 6.45.3 Procedure for information exposure for estimated QoS
Figure 6.45.3-1: Information exposure for estimated QoS
1\. AF sends Nnef_EventExposure_subscribe request to subscribe the estimated
QoS, which also includes the trigger conditions.
AF sends this subscription message to request that 5GS sends the estimated QoS
when the trigger conditions are met. This estimated QoS is the average non-GBR
QoS that the 5GS can provide for the QoS flow with a certain 5QI. The
subscription message may include the trigger information such as a target
moment and/or a target period, threshold #A, B, C, the period, the levels of
QoS, etc. In this event, the trigger conditions may include the follows:
\- predicting the estimated QoS of a target moment and/or a target period;
\- the estimated QoS is greater than the threshold #A and/or the estimated QoS
is less than the threshold #B;
\- the timer expires, and the timer is used to control the periodic reporting
of the estimated QoS;
\- the change of the estimated QoS is greater than the threshold #C;
\- the level of the estimated QoS downgrades or upgrades.
2\. NEF performs the necessary authorization control.
3\. NEF uses the Nnwdaf_AnalyticsSubscription_Subscribe request to send the AF
request information to the NWDAF to predict the estimated QoS and report
according to the trigger conditions.
If the AF is considered to be trusted by the operator, the AF uses the
Nnwdaf_AnalyticsSubscription_Subscribe request to interact directly with NWDAF
to subscribe the notification.
4\. NWDAF subscribes to OAM services to get the information following the
procedure captured in clause 6.2.3.2 of TS 23.288 [59]. Then NWDAF can predict
the average estimated QoS based on the information.
5\. If the trigger conditions are met, NWDAF uses the
Nnwdaf_AnalyticsSubscription_Notify message to NEF to send the estimated QoS
to NEF.
6\. NEF forwards the estimated QoS to AF by the Nnef_EventExposure_Notify.
Editor\'s note: Coordination is needed with FS_eNA_Ph3 during conclusion
phase.
### 6.45.4 Impacts on services, entities and interfaces
AF:
\- Subscribe the events notifications and provides the trigger conditions.
NWDAF:
\- Predicts the estimated QoS according to the collected information.
\- Performs the judgement whether the trigger conditions are met.
## 6.46 Solution #46: Use of ECN marking for L4S for scalable congestion
control and meet requirements for services
### 6.46.1 Key Issue mapping
This solution addresses the Key Issue #3: 5GS information exposure for
XR/media Enhancements.
### 6.46.2 Description
This solution proposes that the 5G System uses ECN marking for the purpose of
Low Latency, Low Loss and Scalable Throughput services (L4S [37]) when
congestion is detected for uplink or downlink so that the application layer
can trigger real-time and gradual rate adaptation of the real-time video
encoder based on ECN feedback.
NOTE: This solution is applicable only in case UE and Application Server
support ECN mechanism defined in RFC 8311 [36] and use protocols that support
relaxed ECN feedback between UE and application server.
#### 6.46.2.1 Use of ECN for Uplink
When the 5G System detects congestion in the uplink, it inserts ECN marking in
the IP header that facilitates the application layer to provide feedback and
do rate adaptation in the uplink (illustrated in figure 6.46.2.1-1). It is
preferrable to perform the marking in the entity where congestion is detected.
Figure 6.46.2.1-1: ECN marking for Uplink -- either in the UE or gNB
The congestion in the wireless uplink between UE and gNB can be detected and
remedied via ECN marking by either the UE or the RAN. Either the gNB or the UE
should be responsible for congestion detection. Otherwise, they could
conflict. After this initial choice, several options are possible to bring the
congestion information into the PDU IP header where it is further handled by
the end-host to control the application\'s sending rate.
Figure 6.46.2.1-2: Congestion for uplink detected in the gNB
gNB is well positioned to have the overall view of congestion in the cell and
overall queues that are building up in the UEs are visible in the gNB via
buffer status reports. Following options are possible when the gNB handles
congestion in the uplink (illustrated in figure 6.46.2.1-2):
1) gNB translates congestion into ECN marks, sets immediately in the PDU IP
header directly. This option does not impact the UE and the UPF.
NOTE The criteria that RAN uses to perform the marking is up to RAN
implementation.
Editor\'s note: Whether RAN can support such a marking need to be coordinated
with RAN WG.
2) gNB transmits congestion information in the GTP-U header, which is
transmitted over N3 to UPF, that translates congestion into ECN marks, which
is finally set in the IP PDU header. This option will impact the UPF in
addition.
3) gNB translates congestion into ECN marks, sets in the outer IP header of
the GTP-U tunnel, which is transmitted over N3 to UPF, which is finally
transferring the ECN marks over to the IP PDU header towards N6. This option
also impacts the UPF in addition.
Figure 6.46.2.1-3: Congestion for uplink detected in the UE
UE can also monitor congestion in the uplink radio bearers. This option can
cause interactions between scheduler policies that use the buffer status
reports which will be influenced (especially if kept \"too\" low) by the
congestion control in the UE. This option impacts additionally the UE, and
detection of uplink congestion is limited to the scope of the UE. Three
options are possible for inserting ECN marking when the UE handles congestion
in the uplink while two of them require gNB assistance (and potentially other
nodes), which has further 3 options to carry the ECN marks into the final IP
PDU header. (illustrated in figure 6.46.2.1-3):
1) UE translates congestion into ECN marks, sets immediately in the PDU IP
header.
2) UE translates congestion into ECN marks, sets in the PDCP header, which is
transmitted over NR-Uu to the gNB, and carried further over one of the three
options 4, 5 or 6 for the gNB to forward the ECN marks over to the IP PDU
header.
3) UE translates congestion into ECN marks, sets in the RLC header, which is
transmitted over NR-Uu to the gNB, and carried further over one of the three
options 4, 5 or 6 for the gNB to forward the ECN marks over to the IP PDU
header.
If UE is transmitting the ECN marks in one of the lower layer headers (like
options 2 and 3 above) additional network support is needed as in one of the
following 3 options:
4) gNB transfers the ECN marks, sets immediately in the PDU IP header.
5) gNB transmits the ECN marks as congestion information in the GTP-U header,
which is transmitted over N3 to UPF, which translates congestion into ECN
marks, set finally in the IP PDU header.
6) gNB transfers the ECN marks, set in the outer IP header of the GTP-U
tunnel, which is transmitted over N3 to UPF, which finally transfers the ECN
marks over to the IP PDU header towards N6.
Editor\'s note: Whether RAN can support uplink congestion detection and ECN
marking within the UE needs to be coordinated with RAN WGs.
In general, if functions are not marking packets directly in the PDU IP
header, guarantees are needed that another function will do so before the
intermediate header information is discarded and before the PDU IP packet is
processed by the end system.
#### 6.46.2.2 Use of ECN for Downlink
When the 5G System detects congestion in the downlink, it inserts ECN marking
in the IP header that facilitates the application layer to provide feedback
and do rate adaptation in the downlink (illustrated in figure 6.46.2.2-1). It
is preferrable to perform the marking in the entity where congestion is
detected.
Figure 6.46.2.2-1: ECN marking for Downlink
There are multiple options to do this (as illustrated in figure 6.46.2.2-2
below):
1) gNB translates congestion into ECN marks, sets immediately in the PDU IP
header. It should be noted that the gNB already has visibility to the PDU IP
header for ROHC compression. This option does not impact the UE at all.
Editor\'s note: Whether RAN can support such a marking need to be coordinated
with RAN WG.
2) gNB translates congestion into ECN marks, sets in the PDCP header, which is
transmitted over NR-Uu to the UE, which finally copies the ECN marks over to
the IP PDU header. This option supports a direct correlation between PDCP and
IP packets.
3) gNB translates congestion into ECN marks, sets in the RLC header, which is
transmitted over NR-Uu to the UE, which finally copies the ECN marks over to
the IP PDU header. With this option, congestion can be reported immediately
where it occurs.
4) gNB transmits congestion information as part of the uplink traffic in the
GTP-U header, which is transmitted over N3 to UPF. The UPF translates
congestion into ECN marks, set finally in the IP PDU header of subsequent
downlink packets. This option impacts also UPF and will cause extra latency
going backwards and forward again. This can cause an extra delay in congestion
response of twice the link latency between gNB and UPF.
NOTE: The criteria that RAN uses to perform the marking is up to RAN
implementation.
In general, if functions are not marking packets directly in the PDU IP
header, guarantees are needed that another function will do so before the
intermediate header information is discarded and before the PDU IP packet is
processed by the end system.
Figure 6.46.2.2-2: Solution options for ECN marking over Downlink
#### 6.46.2.3 Enabling use of ECN
To enable ECN, an existing or a separate QoS flow can be used. At the time of
QoS Flow establishment, it is determined whether use of ECN is enabled or not.
Following are possible alternatives to determine use of ECN for the purpose of
L4S:
\- Pre-configure a dedicated 5QI for which use of ECN for the purpose of L4S
is enabled.
\- Provide an explicit indication at the time of QoS Flow setup to indicate
whether use of ECN for the purpose of L4S can be enabled.
### 6.46.3 Procedures
### 6.46.4 Impacts on services, entities and interfaces
Depending on the solution option chosen for uplink and downlink, support for
ECN marking (for the purpose of L4S) of payload packets as specified in RFC
8311 [36] needs to be supported either in the UE, NG-RAN. In some cases,
additional congestion notification is supported in the NG-RAN along with
support of ECN for the purpose of L4S marking in the UPF for payload packets
as specified in RFC 8311 [36].
## 6.47 Solution #47: Delay Difference and Delay Notifications and Reports
### 6.47.1 Key Issue mapping
This solution addresses KI#3: 5GS information exposure for XR/media
Enhancements.
### 6.47.2 Description
This solution proposes that AF can subscribe delay difference and two way
delay of data flows to 5GS. Based on the notification and report of the delay
status information, the AF can provide the coordinated service requirement to
the 5GS for the tactile and multi-modal flows, during the AF session setup
procedures.
The delay difference follows the description in Clause 6.1 of TR
23.700-60-020, Solution #1: Tactile and multi-modality traffic flows
coordination transmission for one UE. It is assumed that the data flows of
delay difference measurement belongs to a single UE.
The two way delay is defined as the sum of UL and DL Packets Delay, which is
described in Clause 6.29 of TR 23.700-60-020, Solution #29: Two Way Delay
Budget. It is assumed that the NG-RAN and PSA UPF are time synchronised, then
the one way packet delay monitoring between NG-RAN and PSA UPF can be
supported.
Then mechanism of the QoS Monitoring applied for the real time packet delay
measurement for flows can be reused. The QoS Monitoring on UL/DL packet delay
between NG-RAN and PSA UPF can be performed on different levels of
granularities, i.e. per QoS Flow per UE level, or per GTP-U path level,
subject to the operators\' configuration, and/or 3rd party application
request, and/or PCF policy control for the XRM services.
### 6.47.3 Procedures
The following figure represents a high-level procedure of the solution that
the AF subscribes to receive the delay difference and two way delay of data
flows from 5GS. The procedure handles the case when the delay difference of
flows from the single UE is subscribed or the Two Way Delay of flows from
multiple UEs of the XRM services is subscribed.
Figure 6.47.3-1: A high-level procedure of delay status information
subscription and notification.
1\. To subscribe or unsubscribe for the delay difference and two way delay of
a couple of XRM service and multi-modal data flows notification with the NEF,
the AF sends Nnef_EventExposure Subscribe/Unsubscribe Request (Event ID, Event
Filter, Event Reporting information, Delay difference, DL, UL, two way delay,
S-NSSAI, immediate reporting, DNN, Application ID, Group ID, UE address)
message to the NEF. The Event ID parameter defines the subscribed event ID,
i.e. the delay difference of a couple of XRM service and multi-modal data
flows.
The Event Filter parameter defines the S-NSSAI (in case of a trusted AF or AF-
Service-Identifier for an untrusted AF), S-NSSAI and DNN, XRM service Group
ID, UE IDs, for which the XRM service subscription is requested.
The Event Reporting information parameter defines the mode of reporting, with
includes a threshold value or periodic reporting with included periodicity
time interval, and Immediate reporting flag if requested.
Notifications related to the threshold based subscriptions will be sent, only
when the delay difference of subscribed multi-modal data flows reaches the
threshold. And a single notification is sent every time there is a change from
being below the threshold to reach the threshold.
2\. The NEF confirms with Nnef_EventExposure Subscribe/Unsubscribe
Nnef_EventExposure Response message to the AF.
3\. The NEF discovery the PCFs responsible for the requested Event Filter
parameter (e.g. S-NSSAI and DNN, UE IDs). The NEF may query the NRF to find
the PCF(s) responsible for the requested Event Filter parameter. The NEF
authorizes the AF request.
4\. If the NEF has not already subscribed to the event from the PCF for the
requested Event Filter, the NEF initiates the request
Npcf_PolicyAuthorization_Subscribe request (Event ID, Event Filter, Event
Reporting information, immediate reporting, S-NSSAI) to all the PCFs
supporting the requested a couple of flows.
The NEF stores the AF requested Event Reporting Information. If multiple PCFs
are selected for the requested a couple of flows, the NEF may set the Event
Reporting Information to periodic in its request to the PCFs. If single PCF is
selected, the NEF sets the Event Reporting Information identical to the
received request from the AF. The NEF also sets the Event ID, and Event Filter
identical to the received request from the AF.
NOTE: In this Release, the one PCF can be selected for the PDU session of the
single UE, because that the single PDU session should be used to support the
XRM service; the delay difference between the flows of multi-UEs in different
PCFs cannot be guaranteed.
5\. The PCF(s) confirms with Npcf_PolicyAuthorization_Subscribe Response
message to the NEF.
6\. PCF make the policy decision and subscribed the Event requested by AF or
NEF; In order to subscribe the requested Delay Difference, the PCF may trigger
the QoS monitoring for the specific couple of flows, in order to get the end-
to-end delays, and calculate the delay difference.
e.g. The PCF initiates SM Policy Association Modification Request to the SMF.
Based on the QoS monitoring policy for measurement from the PCF, the SMF
generates the QoS Monitoring configuration for UPF, and for RAN, if needed.
7\. Event trigger or notifies the report to PCF (When the event
detected/reached, the report will be triggered, e.g. achieved the threshold,
or the period timer overtime). E.g. the UPF triggers the Notify message to
report the measured information to the PCF. The PCF calculate and notify to
NEF with the subscribed delay difference as well as the real-time delay values
for the couple of flows.
8\. When the reporting condition for a subscribed event is fulfilled, as
described in Step7, the PCF triggers a notification towards the NEF.
9\. The PCF sends the Npcf_Policy Authorization_Notify Request (Event ID,
Event Filter, Event Reporting information) message to the NEF.
If the subscription is for event based notification (e.g. based on the
monitored event reaching a threshold value), the Event Reporting information
parameter contains confirmation for the event fulfilment.
If the subscription is for periodic notification or for immediate reporting,
the Event Reporting information parameter provides information for the current
delay and delay difference (e.g. the delay difference value or represented in
percentage of the maximum delay difference).
10\. When a single PCF is returned from the discovery procedure, the NEF
immediately returns, the notification received from the PCF since the
reporting condition is fulfilled. In case of untrusted AF; the NEF includes
the AF-Service-Identifier corresponding to the S-NSSAI in the returned
notification.
11a. When multiple PCFs are selected for the requested delay, the NEF performs
the aggregation from reporting PCF(s). And NEF maintains the overall calculate
of the specific couple of flows (e.g. including real-time end-to-end delays,
and the delay difference) for the selected PCFs as long as the subscription is
active.
If multiple PCFs are selected for the requested delay of the couple of flows,
the NEF continuously updates the aggregated information to be able to fulfil
the incoming subscription request from the AF.
11b. When multiple PCFs are selected for the requested delay of the couple of
flows, and when the reporting condition for a subscribed event by the AF is
fulfilled, the NEF triggers a notification towards the AF.
### 6.47.4 Impacts on services, entities and interfaces
PCF:
\- The PCF make the policy decision and subscribed the Event requested by AF
or NEF. The PCF may calculate the delay difference based on the reports.
NEF:
\- The NEF discovery the PCFs responsible for the requested Event, and if
multi-PCFs are selected for the requested delay, the NEF performs the
aggregation from reporting PCF(s).
## 6.48 Solution #48: Enhanced Notification of Rata Adaptation Request
### 6.48.1 General
This solution addresses the key issue #3 5GS information exposure.
### 6.48.2 Functional Description
As suggested in solution 6, a similar QoS Notification mechanism for GBR and
non-GBR QoS Flows is needed. Therefore, in the case of XRM services the QoS
Notification message may be used by the RAN to indirectly instruct the
application to increase or reduce the codec rate or use a specific codec rate.
The notification message triggered by RAN reaches the application via SMF, PCF
and NEF entities. It is assumed that the RAN is made aware (via SMF) of the
set of data rates it is able to request that correspond to given codec rates,
such that requesting a given data rate would trigger the application to select
a codec rate up to and including the codec rate corresponding to the requested
data rate, or a codec rate corresponding to the requested data rate This
request message is considered as the suggestion on the codec rate adaptation
by the application server.
A core assumption behind this solution is that the RAN ought to be able to
issue such request whenever it deems necessary, including events related to
the mobility of this or other UEs.
### 6.48.3 Procedures
#### 6.48.3.1 Rate Adaptation Notification
Figure 6.48.3.1-1
0\. The PDU Session for the XRM service is established.
1\. The RAN send N2 QoS Notification message to trigger the application to
select a codec rate up to and including the codec rate corresponding to the
requested data rate, or a codec rate corresponding to the requested data rate.
2\. The AMF sends Nsmf_PDUSession_UpdateSM Context request (\"Rate Adaptation
Request\") to the SMF.
3\. The SMF sends Npcf_SMPolicyControl_Update request (\"Rate Adaptation
Request\") to the PCF
4\. If NEF is used, the PCF sends the Npcf_PolicyAuthorization_Notify (\"Rate
Adaptation Request\") to the NEF.
If the AF locates the trusted domain and the NEF is not used, the PCF sends
the Npcf_PolicyAuthorization_Notify (\"Rate Adaptation Request\") to the AF.
5\. After receiving the Npcf_PolicyAuthorization_Notify from the PCF, the NEF
sends the Nnef_EventExposure (\"Rate Adaptation Request\") to the AF.
After receiving the information from PCF/NEF, the application server considers
the suggestion on the codec rate adaptation.
### 6.48.4 Impacts on services, entities and interfaces
The solution has impacts on the following entities and interfaces:
RAN:
\- Determines whether the application should adjust its coding rate.
\- inter-RAN node signalling (possibly via CN)
\- Sends the Rate Adaptation Request message to SMF.
SMF:
\- Update the QoS profile.
\- Forwards the Rate Adaptation Request message to PCF.
PCF:
\- Update the PCC rules.
\- Forwards the Rate Adaptation Request message to NEF.
NEF:
\- Forwards the Rate Adaptation Request message to AF.
AF:
\- Receives the Rate Adaptation change request message.
## 6.49 Solution #49: PDU set integrated handling for UPF/UE
### 6.49.1 Key Issue mapping
This solution is for Key Issue #4, which addresses the remaining issues of PDU
set integrated packet handling.
### 6.49.2 Description
For downlink transmission, UPF/RAN node receives downlink packets as a
receiver and transmits the downlink packets to the downstream node/UE as a
transmitter. Therefore, PDU set integrated packet handling can be performed as
requested by AF at the receiver and transmitter respectively, e.g.:
1) As a receiver, check whether all the PDUs of one PDU set has been received
or not. If not, drop all the receiving PDUs of the PDU set.
2) As a transmitter, check whether any PDU of one PDU set is not successfully
delivered, or exceed the PDU set delay budget. If so, drop the remaining PDUs
of the PDU set.
There\'s no flow control over NG interface. That is, RAN node will not
feedback whether the PDU has been successfully transmitted or delivered to UE.
Therefore, UPF can only check the receiving status of PDUs of PDU set to
decide whether to drop the PDU set or not. That is, whether UPF shall perform
PDU set integrated packet handling depends on whether UPF is able to identify
all PDUs of one PDU set. That is, if no SN within PDU set or the size of PDU
set is introduced for PDU set identification, 5GS is not able to check whether
all PDUs of one PDU set have been successfully received or delivered.
If UPF shall perform PDU set integrated packet handling for XR traffic, UPF
shall determine whether all PDUs of one PDU set are received within an
integrity checking timer. The integrity checking timer should be started upon
receiving the first PDU of one PDU set. After integrity checking timer
expires, if UPF determines that not all PDUs of one PDU set are received, UPF
shall stop deliver the remaining PDUs of the PDU set and informs the
downstream node (either UPF or RAN node) to drop the PDU set, which avoids
unnecessary transmission.
For uplink transmission, there\'s no transmission loss from UE\'s application
to UE\'s AS layer. Therefore, (1) is not applicable for UE. As a transmitter
for uplink transmission, whether UE shall perform PDU set integrated packet
handling depends on whether RAN node will provide feedback to UE, which is
closely related with HARQ and RLC transmission mode for uplink.
Solution#22,#23,#25 have also propose that AF shall indicate 5GS whether all
PDUs are needed for the usage of PDU Set by application layer, i.e. the
indication of PDU set integrated handling. The indication of PDU set
integrated handling can be applied to all the XR flows. Specifically,
different indications of PDU set integrated handling may be associated with
different frame types based on different importance. E.g. the indication of
PDU set integrated handling is true for I-frame and false for P-frame. Then
UPF shall perform PDU set integrated handling for PDUs of I-frame and not for
that of P-frame.
### 6.49.3 Procedures
Figure 6.49.3-1
0\. AF sends AF request with flow description and the associated PDU set
integrated handling information, where the PDU set integrated handling
information includes indication of PDU set integrated packet handling and
optionally the integrity checking timer. Specifically, different indications
of PDU set integrated packet handling may be associated with different frame
types based on importance. e.g. the indication of PDU set integrated packet
handling is true for I-frame and false for P-frame respectively.
1\. PCF initiates SM Policy Association Modification procedure as defined in
clause 4.16.5.2 of TS 23.502 [3] to notify SMF about the modification of
policies, which further triggers PDU session modification procedure. PCF
includes service data flow filter with the associated PDU set integrated
handling information in the PCC rules provided to SMF.
2a. SMF sends N4 Session Modification Request to UPF, which contains PDU set
integrated handling information. If the indication of PDU set integrated
packet handling is true, UPF checks whether all PDUs of one PDU set are
received upon expiration of the integrity checking timer. After that, UPF
performs PDU set dropping and informs the downstream node (either UPF or RAN
node) to drop the remaining PDUs of the PDU set.
2b. UPF responds SMF with N4 Session Modification Response.
Steps 3-12 of PDU session Modification procedure are performed as in clause
4.3.3.2 of TS 23.502 [3].
### 6.49.4 Impacts on services, entities and interfaces
The proposed solution is based on Rel-17 procedures but some enhancements may
be needed to make it possible for the 5GS to configure UPF to perform PDU set
integrated packet handling, such as:
AMF:
\- Provides PDU set integrated packet handling info, which includes indication
of PDU set integrated packet handling and the integrated checking timer.
PCF:
\- Provides PCC rules with PDU set integrated packet handling info.
SMF:
\- Provides UPF PDU set integrated packet handling info.
UPF:
\- Performs PDU set integrated packet handling based on PDU set integrated
packet handling info.
\- Informs downstream node (either UPF or RAN node) to drop the PDU set.
## 6.50 Solution #50: Relative QoS within a PDU Set
### 6.50.1 Key Issue mapping
This solution is an add-on solution for KI#4 and KI#5 that only addresses the
aspect of improving the resource efficiency in NG-RAN within a PDU Sets.
#### 6.50.2.1 PDU-Set information
This solution provides NG-RAN with information about where within a PDU Set
each PDU belongs to.
This solution utilizes the following:
\- PDU Set size:
\- As defined in for example solution #8 (Size of the PDU-Set) or solution #20
(PDU Set size).
\- PDU-Set Sequence number:
\- As defined in for example solution #8 (PDU-Set Sequence number) or solution
#20 (PDU sequence number within the PDU Set).
**Option#1:**
In this option the PDU Set size is consistent with PDU Set maximum size as
used in solution#20.
**Option#2:**
In this option the PDU Set contains payload data and FEC (error corrections)
as described in the LS from SA WG4 (S2-2203658) and when increased reliability
is not expected for the full PDU Set. For this option both PDU Set maximum
size and PDU Set Size is needed and PDU Set Size is smaller than PDU Set
maximum size. This option allows usage of increased reliability of the payload
data but not all the FEC data. In this case the size of the part that should
use increased reliability is defined in the PDU Set Size while the PDU Set
maximum size is the total size of the PDU Set. With this the PDUs belonging to
the PDU Set after the PDU Set Size will not use increased reliability.
#### 6.50.2.2 New QoS parameter
Relative QoS:
\- NG-RAN is expected to use PDU Set size and PDU-Set Sequence number to
decide a relative reliability level for each PDU within the PDU Set and adjust
for example the BLER accordingly. For option#2 NG RAN is also expected to use
PDU Set maximum size to decide a relative reliability level.
NOTE 1: Alignment with RAN is needed to evaluate if for example on/off is
sufficient or if RAN prefer any additional information like pattern or how
steep gradient the relative QoS is expected.
NOTE 2: It is up to RAN to decide how to calculate the relative reliability
level. RAN may, for example, use the position of the PDU within the PDU Set
and the reported CSI to adopt to the expected BLER Target.
### 6.50.3 Impacts on services, entities and interfaces
RAN:
\- Perform relative QoS handling within a PDU Set.
NOTE: The details of RAN behaviour is up to RAN WGs.
## 6.51 Solution #51: Handling of the PDU Set
### 6.51.1 Key Issue mapping
The solution applies to Key Issue #4.
### 6.51.2 Description
Figure 6.51.2-1: the link between the server and the client in the UE
5GS is the partial link between the server and the client in the UE. Some
packets of XRM service data flow may be lost in the external transport
network. In 5GS, data lost may also happen within the internal transport
network. According to the PDU SN within a PDU Set, the RAN can detect some
packet(s) of a PDU Set is missing, e.g. as shown in Figure 6.51.2-1, within
the PDU Set-3, the PDU with PDU SN =3 is missing.
Figure 6.51.2-1: Some packet of a PDU Set is missing
The PDU Set received from N3 may be incomplete and the RAN is able to detect
some packet(s) are missing of the PDU Set.
As proposed by solution #22, #23, #25, \"all PDUs are needed for the usage of
PDU Set by application layer\" requires the completion of the PDU set/media
unit (e.g. frame/video slice), the incomplete PDU Set doesn\'t make sense and
need to be discarded. Otherwise, the data transmission should continue.
In case the RAN detects some packet of received PDU Set is lost:
\- If \"all PDUs are needed for the usage of PDU Set by application layer\",
for the impacted PDU Set, the RAN should stop the data transmission to the UE
and discard the packets which are not yet transmitted.
\- If else, for the impacted PDU Set the RAN shall continue to transmit of
rest packets of the PDU Set.
Where \"all PDUs are needed for the usage of PDU Set by application layer\"
comes from:
\"all PDUs are needed for the usage of PDU Set by application layer\" cannot
be decided by the 5GS itself, because it may only applicable for some case and
the application layer may still decode a frame/video slice even if it is
incomplete in some other cases. \"all PDUs are needed for the usage of PDU Set
by application layer\" should come from AF and are provided to UPF and RAN via
NEF, PCF and SMF.
Editor\'s note: SA WG4 needs to confirm whether different PDU Sets in the same
service data flow can have different handling requirements (i.e. for a
specific service data flow, some PDU Sets have the handling of \"all PDUs are
needed\" while the other PDU Sets of the same service data flow have the
handling of \"can drop remaining PDUs\"). If different PDU Sets in the same
service data flow can have different handling requirements, the solution will
need to clarify how \"all PDUs are needed for the usage of PDU Set by
application layer\" is determined.
### 6.51.3 Procedures
Figure 6.51.3.1-1: Setting up an AF session with required QoS procedure
1\. The AF provides an indication of \"all PDUs are needed for the usage of
PDU Set\" for a service data flow, which means \"all PDUs are needed for the
usage of PDU Set by application layer\" for the service data flow, to the NEF
using Nnef_AFsessionWithQoS_Create request.
2\. The NEF performs authorization of the AF request. If the request is
authorized, the NEF provides an indication of \"all PDUs are needed for the
usage of PDU Set\" to PCF by invoking the Npcf_PolicyAuthorization_Create
request. Otherwise, NEF responses to AF that the request is not authorized and
the procedure stops.
3\. If the indication of \"all PDUs are needed for the usage of PDU Set\" is
received, the PCF determines PCC rule with the indication of \"all PDUs are
needed for the usage of PDU Set\"
4\. The PCF sends the PCC rule to the SMF and the SMF install the received PCC
rule and performs all the related actions described in TS 23.501 [2] like QoS
Flow establishment signalling and send the indication of \"all PDUs are needed
for the usage of PDU Set\" to the RAN.
5\. The SMF sends a Namf_Communication_N1N2MessageTransfer (QoS profile (the
indication of \"all PDUs are needed for the usage of PDU Set\")) to the AMF.
6\. The AMF sends a N2 message (QoS profile (the indication of \"all PDUs are
needed for the usage of PDU Set\")) to the RAN.
If the RAN detects some packet of received PDU Set is lost:
\- If all PDUs are needed for the usage of PDU Set, the RAN should stop the
data transmission for the impacted PDU Set, and discard the packets of the PDU
Set which are not yet transmitted;
\- If else, the RAN continues to transmit of rest packets of the impacted PDU
Set.
The skipped steps are the same as the existing NW triggered PDU Session
Modification procedure, as described in the clause 4.3.3.2 of TS 23.502 [3].
### 6.51.4 Impacts on services, entities and interfaces
RAN:
\- In case of detecting some packet of received PDU Set is missing:
\- If \"all PDUs are needed for the usage of PDU Set by application layer\",
stop the data transmission of the impacted PDU Set to the UE and discard the
packets of the PDU Set which are not yet transmitted.
\- If else, for the impacted PDU Set the RAN continues to transmit of rest
packets of the PDU Set.
AF:
\- Optionally, provide \"all PDUs are needed for the usage of PDU Set by
application layer\" for a service data flow to 5GS.
NEF:
\- Optionally, provide \"all PDUs are needed for the usage of PDU Set by
application layer\" to the PCF.
PCF:
\- Optionally, provide \"all PDUs are needed for the usage of PDU Set by
application layer\" to the SMF.
SMF:
\- Optionally, provide \"all PDUs are needed for the usage of PDU Set by
application layer\" to the RAN.
## 6.52 Solution #52: Consolidated Solution for PDU Set based QoS framework
### 6.52.1 Key Issue mapping
This solution aims to resolve Key Issue #4, \"PDU Set integrated packet
handling\" and Key Issue # 5, \"Differentiated PDU Set Handling\".
### 6.52.2 Description
#### 6.52.2.0 General principles
This solution provides a framework for the PDU Set based QoS handling. The
following principles apply:
PDU Set QoS policies/rules/profiles and PDU Set QoS Flow establishment:
\- Dynamic PCC rules and non-dynamic PCC rules are supported.
\- PDU Set QoS requirements provisioning by AF supported (for dynamic PCC).
\- PDU Set QoS policies are provided to SMF by PCF for dynamic PCC rules.
\- RAN receives and enforces PDU Set QoS profiles from SMF.
\- UPF receives and enforces N4 rules related with PDU Set from SMF.
PDU Set identification and marking over the user plane:
\- PDU Sets and PDU Set Groups (when needed) are detected in the UPF.
\- Between AS and UPF, multiple PDU Set marking techniques can be supported
(see bullet 2 below).
\- PDU Set and PDU Set Groups (when needed) identification between AS and UPF
can be negotiated over Control Plane (via NEF for non-trusted AF), or based on
pre-configuration.
Editor\'s note: The definition of PDU Set Group needs to be further clarified.
Whether PDU Set Group or other parameter is needed is FFS.
Editor\'s note: PDU Set identification for peer-to-peer scenarios (i.e.
between two UEs routed via the 5G CN) is FFS.
\- UPF marks PDU Sets in GTP-U layer for DL PDU via GTP-U header extension.
GTP-U marking is independent from and common to different PDU Set markings
between AS and UPF.
The following aspects are included:
In the following subclauses, a set of baseline parameters are identified as
part of PDU Set QoS framework. Additionally, a set of potential parameters for
further study (as proposed by other solutions) is described.
NOTE: The baseline set of parameters does not exclude additional parameters to
be agreed in the future.
#### 6.52.2.1 PDU set information detected by the UPF
UPF identifies the PDUs belong to a PDU Set and the following information for
each PDU Set:
Info for intra-PDU Set handling (i.e. KI#4, PDU Set integrated handling).
Baseline parameters:
\- PDU Set Sequence number (SN) (solution 7, 8, 9, 11, 12, 14, 19, 20, 21, 22,
23, 50, 53, 55, 56).
\- Start/End PDU of the PDU Set (solution 11, 12, 15, 18, 21, 22, 55, 56).
\- PDU SN within a PDU Set (solution 11, 20, 22, 55, 56).
\- Number of PDUs within a PDU Set (solution 9, 20, 50) and/or PDU Set size in
bytes.
NOTE: It is possible that \"Start PDU\" can be implicitly indicated via the
PDU SN. This is left to stage 3 to decide.
Editor\'s note: Among above parameters, which one is mandatory or optional
need further discussion.
The QoS Flow is identified using QoS Flow ID and each PDU Set within the QoS
Flow is identified using PDU Set SN. Each QoS Flow can be used to deliver one
or more PDU Set.
Info for inter-PDU Set handling (i.e. KI#5, PDU Set differentiated handling)
Baseline parameters:
\- PDU Set importance (solution 7, 11, 14, 15, 18, 19, 22, 24).
Parameters for further study:
\- PDU Set dependency (solution 11, 14, 19, 22, 24).
#### 6.52.2.2 PDU Set information identification by the UPF
UPF identifies the above information (listed in bullet #1 in clause 6.51.2.1)
based on the following mechanism(s):
Options for further study:
Option 1: by matching RTP/SRTP header and payload (RFC 3550/6184/7798/draft-
ietf-avtcore-rtp-vvc/draft-ietf-avtext-framemarking).
(solution 7, 12, 14, 15, 16, 17, 18, 23, 24, 54).
Option 2: new 3GPP specific RTP extension header (solution 8).
NOTE 1: Option 1 and 2 can only work if these headers are not encrypted (e.g.
not carried above TLS/QUIC/DTLS layer).
Editor\'s note: Whether the support for traffic with partly encrypted RTP/SRTP
header is needed is pending SA4\'s feedback.
NOTE 2: Option 2 can be supported after SA4 confirmation. The information
carried via new 3GPP specific RTP extension header will be confirmed based on
SA4 outputs.
Option 3: by information provided by the AS in N6 header e.g. encapsulation
GTP-U header, IP packet fields (solution7, 9,17,18, 22).
Editor\'s note: Option 3 solutions 7, 17 and 18 needs further discussion.
Option 4: by non-standardized UPF implementation mechanism, e.g. detection
based on traffic characteristics (solution 7, 12, 17, 18, 20, 24, 25).
Editor\'s note: Which above options will be supported is FFS.
Editor\'s note: What information can be achieved by each option and more
options need further discussion.
#### 6.52.2.3 PDU Set information provided by the UPF to the RAN
UPF provides the above PDU Set related information (listed in bullet #1 in
clause 6.51.2.1) to the RAN.
For PDU Set importance:
Options for further study:
Option 1: UPF classifies the DL traffics into different QoS Flows based on PDU
Set importance (solution 10, 14, 24, 26).
Option 2: UPF classifies the DL traffics into different sub-QoS Flows based on
PDU Set importance (solution 17, 18).
Option 3: UPF adds PDU Set importance into GTP-U header (solution 7, 11, 14,
15,17, 18, 19, 22, 25, 56).
For other PDU Set related info (listed in bullet #1):
UPF adds them into GTP-U Header (solution 7, 11, 14, 15, 19, 22, 23, 53, 54,
56).
#### 6.52.2.4 QoS parameters for PDU Set Based QoS handling
New QoS parameters for PDU Set based QoS handling in 5GS:
Baseline parameters:
\- PDU Set Delay Budget (PSDB) (solution 8, 9, 12, 14, 25, 26).
\- PDU Set Error Rate (PSER) (solution 8, 12, 25, 26). The PDU Set Error Rate
applies to PDU set which needs PDU set content integrated handling.
NOTE 1: A PDU Set is considered as error in case all or partial PDUs of the
PDU Set are not successfully delivered. The other PDU Set error cases depends
on the consensus of the other PDU Set content integrity handing.
Editor\'s note: PSDB and PSER definitions need further discussion. Also, it is
FFS how the PSDB, PSER are differentiated on a PDU Set basis. Should
importance parameter be considered to differentiate the PSDB, PSER, Priority
provided over NGAP is FFS?
\- Whether all PDUs are needed for the usage of PDU Set by application layer
(solution 22, 23, 25, 49, 51).
Parameters for further study:
\- Whether to drop a PDU Set in case PSDB is exceeded (solution 8, 22, 24,
25).
\- PDU Set Priority (14, 56).
NOTE 2: Following are some examples: 1) In some implementations, all PDUs in a
PDU Set are needed by the application layer to use the corresponding unit of
information applies. 2) In other implementations, as an example if the first
packet of the PDU Set is lost, all other packets of the fragmentation units
are useless, whereas of the last packet is lost, the decoder can use all
packets except the last one. 3) In yet another example, a PDU Set may be
mapped to all source and repair packets of an Application Layer FEC source
block.
#### 6.52.2.5 QoS parameters provided by the AF to the CN
Information from AF:
Baseline QoS parameters for each PDU Set within the QoS Flow:
\- PDU Set handling indication (solution 8, 15,19, 25, 26, 49) (indicating if
PDU Set based handling should be activated to a flow).
NOTE 3: This indication may be implicitly indicated via other PDU Set related
information provided by the AF.
\- all PDUs are needed for the usage of PDU Set by application layer (solution
22, 23, 25, 49, 51).
Editor\'s note: Except for \"all PDUs are needed for the usage of PDU Set by
application layer\", it is FFS whether the other PDU Set content integrated
handling cases as defined in clause 6.51.2.4 are also considered.
Editor\'s note: Whether more detailed indicators are needed for different PDU
Set QoS handling features (e.g. PDU Set integrated handling, QoS handling
based on PDU Set importance, PDU Set dropping due to delivery failure of
dependent PDU Sets) is FFS.
\- PDU Set Delay Budget (solution 8, 12, 25, 26).
\- PDU Set Error Rate (solution 8, 12, 25, 26).
Baseline parameters on frame identification:
\- Burst periodicity (solution 8, 12, 14, 24, 26, 56).
NOTE 4: The details of RAN behaviour are up to RAN WG.
NOTE 5: Whether and how to support the PDU Set handling for Uplink will be
studied and led by RAN WG. SA2 will align with RAN\'s progress and decision
for Uplink, if any.
Editor\'s note: Whether and how to address the charging offset issue of DL PDU
set eligible dropping by the NG-RAN is FFS.
### 6.52.3 Procedures
#### 6.52.3.1 PDU Set based QoS handling
Figure 6.52.3.1-1: High-level Procedure of PDU Set based QoS handling
The PDU Set based QoS control may happens during PDU Session establishment or
modification procedures. The process includes the following steps:
1a. Steps 1-7a of PDU Session Establishment procedure (defined in clause
4.3.2.2.1 of TS 23.502 [3]) are performed. A network slice type for XR service
can be used for such a PDU Session.
1b. The AF may send the information described in above bullet#5 of clause
6.52.2 to PCF via Nnef_AFsessionWithQoS_Create request as defined in clause
4.15.6.6 of TS 23.502 [3]. AF may also provide these information to the 5GS
prior to PDU Session Establishment.
2\. The PCF generates appropriate PCC rules, which may include PDU Set related
QoS parameters listed in bullet #4. The PCF sends the PCC rules to SMF.
NOTE 1: This step is done in step 7b in PDU Session Establishment procedure
(defined in clause 4.3.2.2.1 of TS 23.502 [3]) or step 1b in PDU Session
Modification procedure (defined in clause 4.3.3.2 of TS 23.502 [3]).
If this step is triggered by step 1b, the PCF generates the PCC rules
considering the information provided by the AF.
3\. The SMF generates the QoS profiles and N4 rules based on the PCC rules
from PCF. SMF sends the N4 rules to UPF and sends the QoS profiles to the RAN
node via AMF.
NOTE 2: This step is done via steps 8-15 in PDU Session Establishment
procedure (defined in clause 4.3.2.2.1 of TS 23.502 [3]) or steps 2-7 in PDU
Session Modification procedure (defined in clause 4.3.3.2 of TS 23.502 [3]).
NOTE 3: The extensions of N4 rule and QoS profile to support PDU Set related
handling will be determined as part of the conclusions related to clause
6.52.2.
4\. The leftover steps of PDU Session Establishment or Modification procedures
are performed.
5\. Based on received N4 rules or locally configuration on the UPF, the UPF
identifies the info in above bullet #1 via the methods described in bullet#2
of clause 6.52.2, and performs PDU Set based QoS handling according to N4 rule
instruction.
6\. UPF sends the PDU Set info to RAN according to above bullet #3.
7\. Based on the PDU Set related info in GTP-U header, RAN performs PDU Set
based QoS handling.
NOTE 4: The details of RAN behaviour is up to RAN WGs.
### 6.52.4 Impacts on services, entities and interfaces
Editor\'s note: This clause will list conclusions that have been agreed during
the course of the study item activities.
## 6.53 Solution #53: PDU Set transmission coordination between RAN and UPF
### 6.53.1 Key Issue mapping
The solution addresses Key Issue #5: Differentiated PDU Set Handling.
### 6.53.2 Description
In XRM services, PDU sets (e.g. I/P frames) have dependency with each other.
For example, I-frame is a complete image, which can be decoded independently.
But P-frames in the same GoP only shows the changes in the image from the
previous frame, which cannot be decoded without the help of the previous
frames. If I-frame and the previous P-frames are not transmitted successfully,
the later P-frames cannot be decoded even though they are transmitted
successful. A frame that is not transmitted within PDB may be not displayed
which may result in the skip of the picture, but it could also be useful for
decoding other frames.
Therefore, it\'s meaningful to consider the dependency among PDU sets during
the transmission.
When UPF sends the PDU set to RAN, it encapsulates the PDU set ID into the
GTP-U header, the PDU set ID is used to identify a PDU set. Moreover, UPF
buffers the PDU set for a period. If the PDU set is failed to be transmitted
by RAN (e.g. HARQ failed), RAN sends the PDU set ID to UPF to indicate that
the PDU set is not transmitted successfully, then the UPF determines the
importance of PDU set based on backward dependency, , and determines whether
the dropped PDU set is to be retransmitted or not based on the importance of
PDU sets. For example, (1) UPF could make decision by detecting the location
of the PDU set in a GOP, if the PDU set is near the end of a GOP, then the PDU
set doesn\'t need to be retransmitted; or (2) if UPF could derive the backward
dependency relation between PDU sets, and find the following received PDU Sets
have dependency on the dropped PDU set, then the PDU set needs to be
retransmitted, otherwise if there is no dependent, then the PDU set doesn\'t
need to be retransmitted.
When UPF determines the importance of PDU set, the importance of a PDU set
increases the more dependent PDU sets exist.
When UPF retransmits the PDU set, it could increase the priority of the PDU
set to make sure that the PDU set can be delivered as soon as possible.
When a PDU set is not transmitted successfully, its dependent PDU sets cannot
be decoded even if they are transmitted successfully.
Therefore, when the UPF decides not to retransmit a PDU set that the RAN could
not transmit successfully (e.g. based on the importance of the PDU set,
awareness of the RAN congestion and so on), the UPF should also drop all
dependent PDU sets of the dropped PDU set, avoiding waste of RAN resources and
N3 resources.
Editor\'s note: The feasibility of reporting the PDU Set ID requires RAN
support.
### 6.53.3 Procedures
Figure 6.53.3-1: PDU Set transmission coordination between RAN and UPF
1\. AF sends a request for an AF session using Nnef_AFsessionWithQoS_Create
request message to the NEF, to indicate the QoS requirement for the
application traffic.
2\. NEF performs the necessary authorization control.
3\. NEF uses the Npcf_PolicyAuthorization_Creat request message to send the AF
request information to the PCF to generate the SM policy.
4\. PCF sends the SM policy to SMF by Npcf_SMPolicyControl_UpdateNotify
request.
5\. SMF sends the N4 session modification request to instruct UPF to perform
the PDU sets scheduling.
6\. AS sends the PDU sets to UPF.
7\. UPF detects PDU set and assign a PDU set ID for identification of each PDU
set. UPF buffers PDU set, for a predefined period of time, whose importance
could not be determined based on information conveyed in the PDU set itself
(e.g. the backward dependency is not clear based on the PDU set itself).
8\. UPF sends the PDU sets to RAN, UPF encapsulates the PDU set ID into the
GTP-U header.
9\. If the PDU set is dropped, RAN sends the PDU set ID to UPF to indicate
which PDU set is not transmitted successfully. Optionally, RAN may also send
the congestion indicator to indicate the reason of the failed transmission.
10\. When the UPF receives the feedback from the RAN, the UPF determines the
importance of PDU set based on backward dependency, , and determines whether
the dropped PDU set is to be retransmitted or not based on importance of the
PDU set. For example, (1) UPF could make decision by detecting the location of
the PDU set in a GOP, if the PDU set is near the end of a GOP, then the PDU
set doesn\'t need to be retransmitted; or (2) if UPF could derive the backward
dependency relation between PDU sets, and find the following received PDU Sets
have dependency on the dropped PDU set, then the PDU set needs to be
retransmitted, otherwise if there is no dependent, then the PDU set doesn\'t
need to be retransmitted.
The importance of a PDU set, increases the more dependent PDU sets exist.
a. When the UPF retransmits the PDU set, it could increase the priority of the
PDU set to make sure that the PDU set can be delivered as soon as possible.
b. When the UPF decides not to transmit the dropped PDU set, the UPF should
drop all dependent PDU sets of the dropped PDU set to save the RAN resources
and the N3 resources.
11\. UPF removes the buffered PDU sets after buffering timer expires.
### 6.53.4 Impacts on services, entities and interfaces
UPF:
\- Sends the PDU sets to RAN via encapsulating the PDU set ID into the GTP-U
header.
\- Buffers the PDU sets for a period.
\- Retransmits/drops the PDU sets according to the feedback of RAN.
RAN:
\- Sends the feedback to UPF if the PDU set transmits failed.
## 6.54 Solution #54: Identification and processing of PDU set by interworking
between Application and 5GS
### 6.54.1 Key Issue mapping
This solution aims to address the key issues #4 & #5:
\- Key Issue #4: PDU Set integrated packet handling.
\- Key Issue #5: Differentiated PDU Set Handling.
### 6.54.2 Description
The following is the architecture of this solution.
Figure 6.54.2-1: Architecture of the XR traffic delivery
This solution proposes the concept of per packet (e.g. IP packet) treatment
(labelling and processing). Then the PDU set can be a (IP) packet or a set of
(IP) packets with same labelling and processing.
This solution reuses existing QoS mechanisms with the following enhancements:
Since the application provider has the knowledge of the application protocols
(e.g. RTP, SRTP, DASH etc.) in use for a service data flow, some guidance
information about the priority/importance of the packet (header/payload) can
be provided from AF to the 5GS user plane (UPF/RAN/UE) for better packet
treatment.
Based on the received guidance from AF, UPF/RAN/UE can perform per-packet
treatment, including labelling in GTP-U/PDCP header and dropping the low
priority packet when the buffer is full or congested.
SA WG2 specifies the QoS mechanism and procedure, then it is up to CT / Stage3
to define the protocol details with SA WG4.
### 6.54.3 Procedures
Figure 6.54.2-1: Architecture of the XR traffic delivery
1\. UE initiates accesses to the mobile network as normal procedure for the
registration in AMF; UE initiates a new PDU session establishment request to
the AMF and SMF, the SMF allocates and sends a new IP address to the UE.
2\. UE initiates an application request to AF, e.g. video request, the AF
interacts with UE in the application layer (e.g. RTP).
3\. AF sends Nnef_AFsessionWithQoS_Create request to NEF with the guidance
information about the priority/importance of the packet, e.g. RTP header/pay-
load information about the priority/importance.
4\. NEF authorizes the request from AF based on the policy configured in the
NEF by operators.
5\. NEF sends Npcf_PolicyAuthorization_Create request to PCF with the guidance
information about the priority/importance of the packet, e.g. RTP header/pay-
load information about the priority/importance.
6\. PCF decides the Packet classification policy, based on the received
guidance information about the priority/importance of the packet.
7\. PCF sends Npcf_SMPolicyControl_UpdateNotify request (Packet Classification
policy) to SMF.
8\. SMF sends N4 Session Modification Request (Packet Classification policy)
to UPF.
9\. UPF sends N4 Session Modification response to SMF.
10\. UPF performs Downlink Packet Classification in the GTP-U Extension Header
corresponding to the Packet Classification policy, e.g. RTP header/payload
indicate the packet has high priority, then the GTP-U Extension Header is
marked with high priority;
Editor\'s note: It is FFS what kind of RTP header/payload information can
indicate the per packet priority within the PDU Set.
11\. SMF sends Namf_Communication_N1N2MessageTransfer to AMF with Packet
Classification policy, and NAS message to UE including the Packet
Classification policy.
12\. AMF send a N2 message to RAN including the Packet Classification policy
and NAS message to UE.
13\. RAN sends the NAS message to UE via AN specific signalling exchange with
the UE that is related with the information received from SMF, e.g. RRC
Connection Reconfiguration.
14\. UE performs Uplink Packet Classification as requested in the Packet
Classification policy, and labels/marks the priority in the PDCP Header to
RAN; During the PDCP layer processing, when the UE has to drop some packets in
the QoS flow, the packet with the low priority label in the PDCP header will
be dropped firstly.
15\. RAN deals with the UL packet according to the label in the PDCP header,
e.g. when it has to drop some packets in the QoS flow, the packet with the low
priority label in the PDCP header will be dropped firstly. RAN performs Uplink
Packet Classification corresponding to the priority in the PDCP Header, and
may verify the priority in the PDCP Header with the Packet Classification
policy; RAN maps the priority from PDCP header to GTP-U extension header in
the uplink GTP packets.
16\. UPF deals with the UL packet according to the label in the GTP-U header,
e.g. when it has to drop some packets in the QoS flow, the packet with the low
priority label in the GTP-U header will be dropped firstly.
NOTE: The RAN PDCP layer behaviour is up to RAN WG decision.
### 6.54.4 Impacts on existing entities and interfaces
AF: provides the packet description for 5GS treatment to PCF;
NEF/PCF/SMF/AMF: receives the packet description from AF, and then provides to
the user plane node, i.e. UE/RAN/UPF;
UE/RAN/UPF:
\- Packet inspection/classification and labelling: according to the packet
description from AF, labels (i.e. priority marker) the packet in the
corresponding GTP-U header in UPF for downlink packets, PDCP header in UE for
uplink packets; RAN maps the PDCP header and GTP-U header between UE and UPF
for downlink and uplink packets.
\- Label handling: deals with the packet according to the label in the
GTP-U/PDCP header, e.g. when it has to drop some packets in the QoS flow, the
packet with the low priority label in the GTP-U/PDCP header will be dropped
firstly.
## 6.55 Solution #55: PDU Set based services using MASQUE
### 6.55.1 Key Issue mapping
This solution addresses Key Issue #4, \"PDU Set integrated packet handling\"
and Key Issue # 5, \"Differentiated PDU Set Handling\".
This solution is a PDU Set Handling Service in the Application Layer of the UE
communicating with a PDU Set Handling Service in the UPF.
In the UL, the PDU Set Handling Service in the UE will send a PDU Set
descriptor to the UPF in advance of sending PDUs in the UL. The UE will also
mark individual PDUs with header information that is visible to the RAN.
In the DL, the PDU Set Handling Service in the UPF will send a PDU Set
descriptor to the UE in advance of sending PDUs in the DL. The UPF will also
mark individual PDUs with header information that is visible to the RAN.
The advantage of sending a PDU Set Descriptor in advance of sending the PDUs
is that the headers of the individual PDUs will not need to be marked with as
much information. Also, the PDU Set Descriptor can be structured so that it is
extensible in future releases and the addition of new header fields in lower
layer protocols can be avoided.
This solution proposes that the PDU Set Handling Service use the MASQUE
protocol, which relies on HTTP/3 over QUIC.
### 6.55.2 Description
This solution supports UL and DL XR traffic including cases where UE and AS
exchange XR traffic and also UE1-UE2 peer-to-peer links.
The solution proposes a PDU Set Handling Service in the UE and in the UPF. The
principles of the solution are as follows:
\- The UE hosts a PDU Set Handling Service Proxy Client.
\- The UPF hosts a PDU Set Handling Service Proxy Server.
\- A tunnel is established between the client and the server to carry XR
flows. The tunnel is established using the MASQUE protocol, which relies on
HTTP/3 over QUIC and supports efficient proxying of UDP flows.
\- The HTTP/3 protocol is defined in draft-ietf-quic-http [32] and the
extensions defined in:
\- draft-ietf-masque-connect-udp [31] for supporting UDP proxying over HTTP;
\- draft-ietf-masque-h3-datagram [33] for supporting HTTP datagrams; and
\- draft-ietf-httpbis-h3-websockets [34] for supporting Extended CONNECT.
\- The QUIC protocol is defined in the IETF specifications RFC 9000 [50], RFC
9001 [51], RFC 9002 [52] and the extension defined in RFC 9221 [53] for
supporting UDP proxying over HTTP.
\- In the UE, the Proxy Client is an HTTP/3 client.
\- In the UPF, the Proxy Server is an HTTP/3 proxy.
\- Once a HTTP/3 connection has been established between the Proxy Client and
the Proxy Server, the Proxy Client will allocate a new bidirectional HTTP data
stream for each data flow. Each bidirectional HTTP data stream is established
by the Proxy Client sending an extended CONNECT to the Proxy Server to
establish a session for the flow.
\- Once HTTP data stream is set up for a data flow, the Proxy Client and Proxy
Server can send data packets to each other in unreliable HTTP datagrams. Each
data packet carries a PDU or information about the PDU Set.
\- The proxy client and server perform PDU set identification of inbound
traffic (i.e. of UL traffic on UE and DL traffic on UPF).
The PDU Set Handling Service is configured in different granularities:
\- Per flow information is exchanged between the proxy client and proxy server
using MASQUE, e.g. using the extended CONNECT request and response. This
information can include:
\- A flow descriptor (e.g. an IP 3-tuple describing the flow between the UE
and XR Application Server).
\- Per PDU Set information is exchanged between the proxy client and proxy
server. Per PDU set information, makes it possible for the receiver (i.e. UE
or UPF) to handle the PDU set (e.g. transmit it towards AS or another UE)
without re-generating the PDU set information from application headers (or
without requiring the entire PDU set information to be present in all
packets). Per PDU Set information can be sent in advance of sending the PDUs
of the PDU Set, thus reducing the overhead of including the information in the
header of each PDU of the set:
\- Info for intra-PDU Set handling (i.e. KI#4, PDU Set integrated handling):
\- PDU Set Sequence number (SN) (solution 7, 8, 9, 11, 12, 14, 19, 20, 21,
22).
\- Start/End PDU of the PDU Set (solution 11, 12, 15, 18, 21, 22).
\- PDU SN within a PDU Set (solution 11, 20, 22).
\- Number of PDUs within a PDU Set (solution 9, 20).
\- Info for inter-PDU Set handling (i.e. KI#5, PDU Set differentiated
handling):
\- PDU Set importance (solution 7, 11, 14, 15, 18, 19, 22, 24).
\- PDU Set dependency (solution 11, 14, 19, 22, 24).
NOTE 1: Whether Per PDU Set information is sent in advance of sending the PDUs
of the PDU Set, or included in the headers of the individual PDUs depends on
what and how much information SA2 agrees is needed to describe a PDU Set and
may be left as a stage-3 encoding decision.
\- PDUs are communicated between the proxy client and proxy server. Per PDU
information is sent with each PDU and is visible to the RAN. Per-PDU markings
are set by the UE for UL traffic and by the UPF for DL traffic. In the DL, the
UPF will populate the GTP-U header with information that can be used by the
RAN for PDU Set handling. In the UL, UE includes the per PDU information in
the PDU header which is visible to the RAN. This information can include:
\- PDU Set Sequence number (SN) may be sent in the Per PDU Set information and
Per PDU information so that the Per PDU Set information and Per PDU
information can be correlated.
\- PDU set first packet flag, last packet flag.
\- PDU sequence number (within the PDU set).
NOTE 2: If any of the Per PDU Set information is useful to the RAN, then it
may also be included in the Per PDU information (i.e. the PDU Header).
NOTE 3: What information is encoded in the PDU Header (e.g. whether the
information is useful to RAN) is left to RAN WGs.
NOTE 4: How the PDU Header is encoded in the PDU is left to stage-3 (e.g.
encoded using IP header options, DSCP code points, or other methods).
### 6.55.3 Procedures
#### 6.55.3.1 PDU Set based QoS handling
Figure 6.55.3.1-1: High-level Procedure of MASQUE-based PDU Set based QoS
handling
The process includes the following steps:
1\. The UE establishes a PDU Session. The UE provides a PDU Set Handling
Service flag to request the PDU Set Handling Service on this PDU session.
2\. SMF sends the N4 rules to UPF, including an indication that the PDU Set
Handling Service is requested and including N4 Rules with extensions to
support PDU Set related handling. The extensions to support PDU Set related
handling include PDRs that are used to detect PDU Sets.
3\. UPF configures a proxy server to provide the requested PDU Set Handling
Service.
4\. UPF sends the proxy server information (e.g. IP address and port of the
proxy server instance) to be used by the UE to connect to the proxy.
5\. SMF sends a PDU session establishment accept message. The PDU Session
Establishment Accept message includes the IP Address and Port number of the
Proxy Server. The PDU Session Establishment Accept Message also includes QoS
Rules and an indication that PDU Set Handling Service is enabled. The N2
Message includes QoS Profiles and an indication that PDU Set Handling Service
is enabled. The QoS Rules and QoS Profiles include extensions to support PDU
Set related handling. The extensions to support PDU Set related handling
include rules that are used to detect PDU Sets.
6-7. For each flow, the Proxy Client uses the IP Address and port number that
were received in the PDU Establishment Accept message to establish a MASQUE
connection with the proxy server. The proxy client initiates each new MASQUE
sessions, by sending an HTTP CONNECT request including a \"connect-udp\"
protocol parameter, and the Per flow information. The UE app can then send and
receive UDP payloads of XR flows (e.g. RTP or SRTP packets) to/from the UE.
The proxy client implements the PDU Set Handling Service including PDU set
identification, and forwards encapsulated XR flows over MASQUE to/from the
UPF. UPF forwards UDP traffic to/from the AS; this is shown in the following
steps.
8\. Upon receiving DL packets from the XR AS, based on received N4 rules or
local configuration, the Proxy Server of the UPF identifies PDU sets and per-
PDU set information listed above by matching RTP/SRTP header and payload. If
the PDU is the first PDU in the set, then the Server Proxy will send a PDU Set
Descriptor to the Proxy Client. The Proxy Server will then send the PDU to the
Proxy Client. In the DL, the UPF will populate the GTP-U header with per PDU
information that can be used by the RAN for PDU Set handling.
9\. RAN applies PDU set based QoS handling, using the per PDU information.
10\. Upon reception of the PDU, the proxy client can forward the XR traffic to
the UE app.
11\. When the proxy client receives UL traffic, the proxy client identifies
PDU sets and per-PDU set information in a manner similar to the UPF in step 8.
If the PDU is the first PDU in the set, then the Client Proxy will send a PDU
Set Descriptor to the Proxy Server. In the UL, UE includes the per PDU
information in the PDU header which is visible to the RAN. The UE applies PDU
set based QoS handling.
12\. The RAN applies PDU set based QoS handling.
### 6.55.4 Impacts on services, entities, and interfaces
This clause lists impacts related to the proxy mechanism and the separation
between per-packet and per-PDU set information.
SMF:
\- Receives a request to use the PDU Set Service in the PDU Session
Establishment Request.
\- Provides QoS Rules to the UE that include extensions to support PDU Set
related handling.
\- Provides QoS Profiles to the RAN that include extensions to support PDU Set
related handling.
\- Provides N4 Rules to the UPF that include extensions to support PDU Set
related handling.
\- Receives XR proxy contact information from the UPF.
\- Sends XR proxy contact information to the UE.
RAN:
\- Receives and applies QoS Profiles from the SMF that include extensions to
support PDU Set related handling.
\- Parses XR service markings.
UPF:
\- Receives N4 Rules from the SMF that include extensions to support PDU Set
related handling.
\- Sends XR proxy contact information to the SMF.
\- Creates, selects, configures, and operates MASQUE XR proxy instance.
\- Perform PDU set identification and creates PDU set descriptor.
\- Mark DL data packets with per-packet PDU set information.
UE:
\- Sends a request to use the PDU Set Service in the PDU Session Establishment
Request.
\- Receives QoS Rules and XR proxy contact information from the SMF.
\- Implements the XR Proxy Client functionality.
\- Performs PDU set identification and creates PDU set descriptor.
\- Mark UL data packets with per-packet PDU set information.
\- Apply PDU set based QoS handling.
## 6.56 Solution #56: PDU Set integrated packet handling with QoS
differentiation
### 6.56.1 Introduction
To support PDU Set integrated packet handling with QoS differentiation, this
solution proposes key principles. The general architecture to support this is
shown in Figure 6.56.1-1.
Three principles are adhered to:
1\. PDU Set QoS treatment is determined by policy using dynamic or non-dynamic
PCC. Policy is enforced at the RAN based on NG-AP signalling between the RAN
and SMF. User plane packet marking at the UPF should indicate the
characteristics of a given PDU, not QoS handling such as the \"priority\" to
be provided to a PDU. Note that \"priority level\" is already a QoS parameter
sent via NG-AP.
2\. RTP header extensions for scalable media streams are proposed by the IETF
in draft-ietf-avtext-framemarking. The header extension identifies the
Temporal and Spatial media layers associated with a packet as well as
dependencies of enhancement layer instances on base layer instances. This
allows layers to be selectively forwarded or otherwise handled in the network.
The solution adopted for this Key Issue should provide comparable capability
for the 5GS.
3\. In the 5GS, a QoS Flow can carry multiple application flow instances of
the same type (e.g. two H.26x video streams) as well as application flow
instances of different types (e.g. H.26x video, AC Audio, haptic data). To
maintain this capability while providing per-PDU set handling, it must be
possible to distinguish between these application / media sub-flows within a
QoS Flow. One option for doing so is to consider the Application / media-
stream / sub-flow as a PDU Set to which a PDU may belong, and to identify it
as such in the GTP-U header.
Figure 6.56.1-1: 5GS Support for PDU Family integrated packet handling
### 6.56.2 Description of Solution Components
1\. Packet Identification and Marking:
\- The rules that should be used by UPF for identifying the PDU sets to which
a packet belongs are either provisioned in the UPF or received via N4 from the
SMF. PDU Set identification rules provisioned on the UPF or sent by the SMF
may specify the RTP header type to be detected.
\- Which PDU Sets the UPF identifies is provisioned on the UPF, and may
include one or more of:
1\. A Frame / Slice PDU Set:
\- All PDUs that carry segments of the same Frame / Slice belong to the same
set.
2\. A Temporal Layer PDU Set:
\- All PDUs that carry Frames / Slices that belong to the same Temporal Layer
belong to the same set.
3\. A Spatial Layer PDU Set:
\- All PDUs that carry Frames / Slices that belong to the same Spatial Layer
belong to the same set.
4\. An Application / Media-Stream / Sub-Flow PDU Set:
All PDUs that carry Packets / Frames / Slices that belong to same application
or media stream (e.g. audio or video or haptics) belong to the same set.
\- Packets are identified and the GTP-U header extension is populated by
examining PDU RTP header fields, when present.
\- PDU Set identification and marking is supported for downlink packets.
Editor\'s note: Support for uplink is FFS.
\- To support scalable / layered media or multiple media streams mapped into
the same QoS flow (because they are multiplexed into the same UDP/IP traffic
flow), a PDU may be identified at the UPF and marked as belonging to more than
one PDU Set. Thus, the UPF can also identify one or more PDU Sets to which a
packet belongs.
For example, an IP packet that carries a segment of a video frame belonging to
a specific Spatial Layer and a specific Temporal Layer, would belong to all
four PDU Set Types and could thus receive four different PDU Set markings,
which could all affect the QoS treatment of the packet depending on the QoS
policy.
\- For each PDU Set to which a PDU is associated, the following information
may be provided in a GTP-U header extension:
1\. The PDU Set Type:
\- Frame or Slice type (e.g. I-frame or P-frame) for a Frame/Slice PDU Set.
\- Layer ID for Temporal and Spatial Layer PDU Set.
\- Application or Media-Stream or Sub-Flow ID for Application / Media-stream /
Sub-Flow PDU Set.
2\. PDU Set Instance Number - a rolling counter that sequentially numbers each
PDU Set instance within a PDU Set, independent of PDU Set Type
3\. Dependent PDU Set Instance, which is the PDU Set Instance Number
previously assigned to the PDU Set instance on which this PDU Set is
dependent.
4\. PDU Set Instance Start / End Indicator for Frame / Slice PDU Sets
2\. QoS framework and policies:
\- As per current QoS framework, packet handling is determined according to
PCF \"policy\".
\- Non-Dynamic PCC is supported via configuration of PCC rules with per-PDU
set granularity on the SMF.
\- Dynamic PCC is supported via provisioning by the PCF on the SMF of PCC
rules with per-PDU set granularity.
\- The NG-RAN is not aware of media characteristics. It is only aware that a
packet belongs to one or more PDU Sets for which the QoS treatment is governed
by policy.
\- Per-PDU Set PCC granularity is reflected in QoS Profiles sent to the NG-
RAN.
\- Per PDU set QoS is enforced in the NG-RAN by applying policy as reflected
in the QoS Profile to PDUs according to the PDU GTP-U header extension
markings indicating the PDU\'s membership in one or more PDU sets.
\- Per-PDU Set QoS Profiles enable QoS differentiation according all the PDU
Sets to which a packet may be associated.
\- Per PDU set QoS parameters may include Priority, PDB, PER and Validity
Time.
NOTE: PDU Set Validity Time indicates for each PDU set type, the maximum delay
for a given PDU Set instance to be delivered to the recipient. Beyond this
time, the PDU Set instance is not considered valid, and thus all un-
transmitted packets of the PDU Set can be discarded at the RAN. For example,
that for an I-Frame PDU set, the Validity Time may take into account the
usefulness of I-Frames for subsequent P-Frame decoding, which may occur at a
later time than is required to render the I-Frame.
3\. AF Request:
\- The AF may (optionally) send a request to support PDU Set identification
and differentiated handling
\- The AF request may contain the following to support PDU Set identification
and per PDU Set QoS:
1\. Flow description of the target media service data flows for per PDU Set
handling
2\. An RTP/RTPSP header type to be detected (for media with RTP/RTSP headers).
3\. Assistance Information describing the media and characteristics including:
a. The number of Temporal and Spatial media layers.
b. PDU Set periodicities (e.g. for Temporal and Spatial Layers).
c. PDU Set dependencies (e.g. the existence of Referenced Frames or Slices
such as a P-Frame with forward references).
4\. Requested Priority, PDB and PER per-PDU Set type.
5\. Validity Time per-PDU Set type.
### 6.56.3 Procedures
PDU Set integrated packet handling is described in the procedure shown in
Figure 6.56.3-1.
Figure 6.56.3-1
0\. The UE establishes a PDU Session as defined in clause 4.3.2.2.1 of TS
23.502 [3] for a given DNN/S-NSSAI.
1\. The AF may send the information described in item 3 of clause 6.56.2 to
PCF via Nnef_AFsessionWithQoS_Create request as defined in clause 4.15.6.6 of
TS 23.502 [3].
2\. PCF initiates the PDU Session modification procedure as defined in clause
4.3.3.2 of TS 23.502 [3]. The PCF generates appropriate PCC rules based on the
information from AF or based on provisioned policy. The PCF sends the PCC
rules to SMF.
3\. SMF generates the QoS profiles and N4 rules based on the PCC rules from
PCF. SMF sends the N4 rules to UPF and sends the QoS profiles to the RAN node
via AMF.
4\. Based on received N4 rules or locally configuration on the UPF, the UPF
identifies the info in above in item 1 of clause 6.56.2.
5\. UPF marks the PDU Set information in the User plane packets sent to RAN
according in the GTP-U header.
6\. Based on the PDU Set in GTP-U header and per-PDU set information contained
in the QoS Profile received from the SMF, the RAN performs per-PDU Set based
QoS handling.
NOTE: The details of RAN behaviour is up to RAN WGs.
### 6.56.4 Impacts on services, entities and interfaces
PCF:
\- Support per-PDU Set policy.
UPF:
\- Support Media Unit Identification and packet marking in GTP-U extension
header.
SMF:
\- Configure per-PDU Set policy (via QoS Profile).
NG-RAN:
\- Support application of Per-PDU Set Policy to packets within a QoS Flow.
## 6.57 Solution #57: Negotiation of details of marking mechanisms for AS to
UPF communication
### 6.57.1 Key Issue mapping
This solution addresses KI#4 and KI#5.
### 6.57.2 Description
In order to prevent interoperability issues between 5GS and AF/AS and in order
to optimize the flexibility of the 5GS when it comes to the support of PDU set
and burst marking, it is necessary that the 5GS and AF/AS are able to
negotiate protocol and related details to be used to exchange PDU Set and
burst related metadata between AS and UPF. This has three aspects:
1\. Setting policies in 5GS for which protocol to use for PDU set information
between AS and 5GS in line with application support. This can either be
arranged offline (e.g. based on Service Level Agreements) or via explicit
signalling.
2\. Taking into account the selected protocol for PDU set information during
the PDU Session establishment.
3\. 5GS exposure/confirmation to AF that such protocol is available to be
used.
While aspects 2 is addressed by, among others, Solution 7, 12, 20 and 25, this
solution focuses on aspects 1 and 3. Consequently, this solution is composed
of two steps.
Step 1: Negotiation of PDU set and/or burst marking mechanism between AF and
CN.
To negotiate the marking mechanism between AF and CN, the AF subscribes to get
the options for PDU Set and burst marking:
\- The AF subscribes to the 5GCN to obtain the list of options that the 5GS
support.
\- The NEF stores/retrieves and exposes the options for PDU set marking and
for burst marking (no marking, RTP header based, SRTP header based, non-
standardized marking, etc.) to the AF.
\- The AF indicates to the PCF the options it prefers (e.g. no marking, RTP
for PDU set marking and/or burst marking).
\- The PCF updates the PCC rules accordingly.
NOTE: If the PCC rules describing the AF\'s preferred options to mark the PDU
Sets and data bursts between AS and UPF are already pre-configured in the PCF
(e.g. per DNN/S-NSSAI, per AF ID, based on flow description, etc.) then no
signalling is needed between PCF and AF.
Step 2: Notification of selected PDU set and/or burst marking mechanism from
SMF to AF.
The notification of the selected marking settings is based on the following
steps:
\- The AF uses the Nnef_EventExposure_Subscribe to subscribe to the
notification of the selected option for marking the PDU Sets and/or bursts.
\- The SMF dynamically retrieves the PCC rules from the PCF. The rules include
the details of the AF preferred option for marking the PDU sets and/or bursts.
NOTE: The SMF can also use the locally stored predefined PCC rules. In this
case no interaction with PCF is needed, but it is assumed that such predefined
PCC rules already include the AF preferred options for marking the PDU
Sets/data bursts.
\- The SMF selects and configures the UPF:
\- The SMF selects the UPF based on marking method indicated in PCC rules.
\- This may require the UPF to perform NF registration with NRF by indicating
its capability for PDU sets marking. SMF performs NF discovery with NRF by
querying the PDU sets and bursts marking option.
\- The SMF configures the UPF based on selected marking mechanism for PDU set
and/or burst.
\- Based on the selected UPF\'s actual capabilities, the SMF then notifies to
AF the selected method for marking by using the Nsmf_EventExposure_Notify
message.
### 6.57.3 Procedures
Step 1: negotiation of PDU set and/or burst marking mechanisms between AF and
CN.
The AF requests to the 5GCN to provide the list of marking mechanisms by
calling the Nnef_EventExposure_Subscribe service operation (see Figure
6.57.3-1).
Figure 6.57.3-1: AF gets notified of supported PDU set and/or burst marking
options
1\. The AF indicates as event \'PDU set marking mechanism\' or \'burst marking
mechanism\' or \'PDU set and burst marking mechanisms\'.
2\. The NEF will then reply with a response message.
3\. The NEF retrieves from the network configuration (UDR or via OAM) the
information indicating which marking mechanisms are available, i.e. are
supported by the network.
4\. The NEF notifies the AF of the supported marking mechanisms, for example,
\'no marking\', \'RTP header based\' and \'non-standardized\'.
Figure 6.57.3-2 describes how the AF can indicate to the PCF the marking
mechanisms it prefers. The procedure is based on the procedure for setting up
an AF session with requested QoS (see clause 4.15.6.6 of TS 23.502 [3]).
Figure 6.57.3-2: AF indicates to PCF preferred marking options
1\. The AF indicates to the NEF the list of acceptable marking mechanisms from
those previously indicated as supported by the network. For example, the AF
indicates \'no marking\' and \'RTP header based\'.
3\. The NEF forwards the list of acceptable marking mechanisms to the PCF.
6\. The PCF updates the PCC rules to take into account the AF\'s acceptable
marking mechanisms.
Step 2: Notification of selected PDU set and/or burst marking mechanism from
SMF to AF.
Figure 6.57.3-3 describes how the SMF notifies the AF of the selected marking
method(s) for a certain PDU Set QoS Flow. The procedure is based on a modified
version of the information flow for downlink data delivery status with SMF
buffering (clause 4.15.3.2.5 of TS 23.502 [3]).
Figure 6.57.3-3: AF gets notified of selected marking option
0a. The SMF retrieves the PCC rules from the PCF and selects the UPF based on
the \'AF acceptable marking mechanisms\'
1-3. The AF indicates as Event \'PDU Set marking mechanism\',
8-9. The SMF provides the selected mechanism(s) to the AF. As an example, the
PCF can indicate PDU Set marking mechanism = \'no marking\'.
### 6.57.4 Impacts on services, entities and interfaces
AF:
\- Supports indication of new event for PDU set and/or burst marking settings.
\- Receives lists of supported marking settings from PCF.
PCF:
\- Supports indication from AF of new event for PDU set and/or burst marking
settings.
\- Sends lists of supported marking settings to AF.
\- Extend PCC rules to include on AF preferred PDU Set and burst marking
options.
SMF:
\- Extend PCC rules to include on AF preferred PDU Set and burst marking
options.
\- Update of UPF selection logic based on preferred and supported PDU Set and
burst marking options.
\- Extension of Nsmf_EventExposure_Subscribe Support service operation.
NEF:
\- Support new monitoring event.
\- Extension of Nnef_EventExposure_Subscribe Support service operation.
UDM:
\- Support new monitoring event.
\- Extension of Nudm_EventExposure_Subscribe Support service operation.
## 6.58 Solution #58: Support for application packet information for CDRX
enhancements
### 6.58.1 Key Issue mapping
This solution addresses KI#8: Enhancements to power savings for XR services.
### 6.58.2 Description
#### 6.58.2.1 General
We adopt the term \'application packet\', consistent with the term \'packet\'
in TR 38.838 [58], where \'a packet models the set of IP packets belong to the
same video frame\'. Nonetheless, we assume an application packet refers also
to other types XR application flows and not only video, e.g. audio.
The following information is useful for the NG-RAN to enhance and configure
CDRX: application packet periodicity and periodicity changes, and application
packet jitter statistics (e.g. jitter range defined by minimum/maximum around
the mean application packet periodicity), all per application flow. We discuss
each of these parameters as follows.
#### 6.58.2.2 Application packet periodicity
The application packet periodicity (i.e. generation rate at the application)
can be used to enhance CDRX at the NG-RAN, such that the CDRX cycle length is
matched to the inter-arrival time of the application packets. An application
packet can be, for instance, a video frame with periodicity 1/(60 fps). Thus,
more power could be saved at the UE while ensuring a short traffic delay,
since the UE awake time could follow closely the traffic arrival. Furthermore,
information about changes in this periodicity is also needed, e.g. when the
application employs rate adaptation.
We note that the periodicity is a parameter already supported in one of the
NGAP information elements (IEs) in TSCAI, associated with a TSC QoS flow (TS
38.413, TS 23.501 [2]). However, this periodicity is defined per packet burst,
which does not have a clear one-to-one mapping to a single application packet.
For instance, for a video traffic flow, it is not clear that a burst contains
exactly one video frame. We propose to introduce a new attribute for the
periodicity per application packet basis. This attribute contains a list of
periodicity values, corresponding to different application traffic flows (e.g.
for video and audio flows), in case multiple such flows are multiplexed in the
same QoS flow. This attribute is provided by the AF and included in the NGAP
PDU Session Management procedures and associated with the applicable QoS Flow.
Note that an equivalent way to obtain this periodicity information per
application flow is to separate the application flows, each into an individual
QoS flow. If this is possible, supporting only one periodicity parameter per
QoS flow is sufficient. However, this separation cannot be guaranteed. Thus,
to support sending the same periodicity information to the RAN, a QoS flow
containing multiple application flows needs to have an associated list of
periodicities.
#### 6.58.2.3 Application packet jitter range
The application server may, due to its limited capabilities induce a jitter to
the generation of the periodic application packets. To cater for jitter
induced by the transport network, the 5GC can add a fixed jitter value, e.g.
preconfigured by the operator, to the jitter provided by AF. The jitter range
of the application packet is useful for the RAN to ensure a short traffic
delay, while allowing the UE to save power by sleeping as long as possible
outside the jitter range. Figure 1 shows an example of RAN delay values for a
single UE receiving video traffic in the downlink, with different application
packet periodicities. If the RAN expects the periodic traffic to suffer from
jitter, but no other jitter information is known, the UE has to be awake all
the time (i.e. no CDRX configured), to ensure a short traffic delay. If the
RAN does not have any information about jitter and expects no jitter w.r.t.
the periodicity, but in fact jitter is present, the CDRX on-time may be
wrongly configured to be too short (e.g. 1 ms -- much shorter than the jitter
range). In such a case the delay is very long, i.e. 10-35 ms, likely exceeding
the values tolerated by the application. Finally, if the RAN has information
about the jitter range, it can configure CDRX to achieve a short delay equal
to that for no CDRX, even with a simple standard on-time configuration.
Consequently, we propose to support information about the jitter range per
application flow in an additional attribute.
Figure 6.58.2.3-1 Delay for 99th percentile
Figure 1 depicts an example of RAN delay (99th percentile), for CDRX without
and with information about the jitter range, for different application packet
periodicities corresponding to a video flow with {120, 90, 60, 30} fps. For
all CDRX configurations it is assumed that the RAN knows the application
packet periodicities and the application packet transmission duration is 1.5
ms.
#### 6.58.2.4 Introduction of new information for enhanced CDRX operation
In this solution following new information, in following text designated in
bold format, is provided by AF to 5GS:
\- a set of periodicities; and
\- for each periodicity there is one associated jitter range.
To avoid inducing load on the CP interfaces and to also ensure timely
information update in RAN, the change of the content of the set of
periodicities, e.g. due to application layer rate adaptation, is signalled in-
band in the PDU Set information according to solution #8.
### 6.58.3 Procedures
#### 6.58.3.1 CP based initial configuration of the 5GS
The set of periodicities and the associated jitter ranges are added to the
information provided by AF using the existing procedure in clauses 4.15.6.6
and 4.15.6.6a of TS 23.502 [3].
This information can be part of the TSCAI.
This new information is provided by PCF to the SMF using the existing PCF
initiated SM Policy Association Modification procedure as specified in clause
4.16.5.2 of TS 23.502 [3]. The SMF then perform network requested PDU Session
Modification procedure as specified in clause 4.3.3 of TS 23.502 [3].
As part of this procedure, SMF provides the set of periodicities and
associated jitter ranges associated with a QoS Flow on N2 interface to NG-RAN,
e.g. as TSCAI.
#### 6.58.3.2 In-band signalling based update of the set of periodicities
If, due to application layer specific reasons, the set of periodicities
changes, the new set of periodicities is provided in the PDU Set information
by means of in-band signalling as described in solution #8 as part of the PDU
Set information.
### 6.58.4 Impacts on services, entities and interfaces
AF:
\- Provision of set of periodicities and associated jitter ranges associated
with a specific AF session, corresponding to different application flows, e.g.
video, audio, control.
\- Inclusion of the set of periodicities in the PDU Set information in the RTP
extension header, see solution #8.
PCF:
\- Providing information describing set of periodicities and associated jitter
ranges to SMF.
SMF:
\- Inclusion of the set of periodicities and the associated jitter ranges
associated with a QoS Flow information on N2 to NG-RAN.
UPF:
\- Support for solution #8 (Copying set of periodicities as included in the
PDU Set information from the RTP extension header into GTP-U extension header.
NG-RAN:
\- Reception of a set of periodicities and the associated jitter ranges
associated with a QoS Flow.
\- Reception of a set of periodicities in GTP-U extension header in the PDU
Set information, see solution #8.
## 6.59 Solution #59: Assistance information needed for power savings in NG-
RAN
### 6.59.1 Introduction
The traffic of XR applications has the following essential properties [1]:
\- Video traffic is quasi-periodic with the period composed of (i) a
constant/deterministic scalar, which is determined by the rate at which the
application generate the application-layer data units, (ii) and a random and
bounded jitter.
\- Application-layer data units of the video traffic stream have random size
but the range is bounded. The size of an application-layer data unit for video
traffic is modelled as a random variable with bounded range.
\- Pose information (as known as pose updates) is periodic with the period
between two application-layer data units defined by a constant/deterministic
scalar.
\- Application-layer data units of the pose information stream have constant
size.
\- Delay budget and maximum error rate are applied to application-layer data
units. To simplify the performance evaluation the application-layer data unit
model (called frame-based model in Rel-17) has been considered as mandatory in
Rel-17, with the optional evaluation of the packet-based model where
application-layer data units are fragmented into smaller network-layer
packets.
In 5G radio systems, users in connected mode keep monitoring the Physical
Downlink Control Channel (PDCCH), which carries scheduling grants transmitted
by gNB. This continuous monitoring of the PDCCH forces users to stay in active
mode even when there is no traffic to be scheduled, thus resulting in
unnecessary power consumption. To mitigate this problem, 5G defines UE power
saving schemes including Connected mode DRX (CDRX) and PDCCH monitoring
adaptation (e.g. PDCCH skipping and Search Space Set Group switching). Both
CDRX and PDCCH monitoring adaptation offer the possibility to reduce UE power
consumption by alternating between active and sleep periods, by switching the
monitoring frequency of PDCCH, and/or by skipping some of the PDCCH monitoring
occasions.
UE power saving schemes can be optimally configured according to the traffic
characteristics of XR traffic described above to guarantee the delivering of a
packet within the PDB and at the same time maximize the power saving gain.
Therefore, UE power saving scheme would benefit from application awareness in
the form of additional information either carried over the user plane or new
assistance information delivered using the control plane.
### 6.59.2 Functional Description
In particular, following information is considered as essential to maximize
power savings for XR services:
\- Identification of the boundaries of the PDU Set (e.g. an XR frame). RAN
shall be able to distinguish PDUs that belong to the same PDU Set, the first
PDU of a new PDU Set and the last PDU of the PDU Set.
\- Indication of the delay budget and maximum error rate for PDU Set.
Furthermore, the following information is considered as auxiliary and/or
assistance information, namely information that would assist RAN to optimally
configure and improve UE power saving schemes, yet not essential for enabling
power savings:
\- Periodicity of the application layer traffic. Information like the rate at
which PDU Sets such as XR frames and pose information packets are generated
would assist the RAN to configure and adjust UE power saving schemes.
\- Jitter statistics like mean and variance as well as the maximum value of
the jitter of the PDU Set would assist RAN to configure and adjust UE power
saving schemes that can tolerate the variability of the expected arrivals in
order to fulfil the delay budget and error rate of the PDU Set.
\- Size of the PDU Set will assist the RAN in determining whether and when to
trigger a UE power saving enhancement.
\- Indication of priorities, dependencies and validity time of PDU Sets would
assist the RAN to decide whether and when to trigger a UE power saving
enhancements.
Auxiliary information can be provided per QoS flow or per PDU Set type in the
Application/Media-Stream/Sub-flow PDU Set family. For example, the application
layer traffic of an XR application can be divided in three media stream PDU
Sets of type video, audio, and control, all belonging to the same QoS flow. If
auxiliary information is provided per QoS flow, then one periodicity and one
set of jitter statistics are provided to the network (e.g. the smallest
periodicity and the largest jitter range). In contrast, if the auxiliary
information is provided per PDU set-type in the Application/Media-Stream/Sub-
flow family, there would be three instances (one each for video, audio and
control) within the QoS Flow, then three periodicities and three jitter ranges
are provided to the network.
Indication of priorities, dependencies and validity of PDU Sets would assist
the RAN in selecting the parameters of power saving schemes. For example:
\- DRX parameters that control the UE active time (e.g. On duration and the
Inactivity time) can be configured to consider the PDB, jitter range and the
validity time of the PDU Set [2]. The validity time indicates that the UE must
remain active beyond the PDB even if the number of retransmissions has reached
its limit. Therefore, the On duration can be opportunistically configured to
prevent the UE entering in sleep mode before the validity time of the PDU Set
is expired.
\- PDCCH adaptation parameters (e.g. SSSGs duration and timer) that control
the PDCCH monitoring frequency can be configured to consider the PDB, jitter
range and the validity time of the PDU Set [2]. The monitoring frequency can
be reduced only after both the PDB and the validity time of a PDU Set expire
to minimize any extra scheduling delay due to less frequent PDCCH monitoring.
\- PDCCH skipping can be enabled only after both the PDB and the validity time
of a PDU Set expire. This prevents the UE skipping PDCCH monitoring
opportunities when the PDU Set has a certain utility for the application.
We observe that part of auxiliary information can be learnt by the network
using the essential information. For example, the periodicity and jitter
statistics of a PDU Set Type can be estimated by measuring the inter-arrival
time of the PDU Set instances. However, this requires to be able to identify
packets belonging to the same PDU Set in the Application/Media-Stream/Sub-flow
PDU family using solutions as the one proposed in [2].
### 6.59.3 Procedures
NG-RAN derives the following essential and auxiliary information from the
GTP-U header (inserted by the UPF) for the user plane traffic (as proposed for
solutions to Key issues #4/#5):
\- Identifies the boundaries of the PDU Set (e.g. an XR frame).
\- Determines dependencies of PDU Sets.
NG-RAN receives the following essential and auxiliary information from the SMF
for a given PDU Set (as proposed for solutions to Key issues #4/#5) via NGAP
signalling:
\- Indication of the delay budget, maximum error rate for the PDU Set.
\- Validity time for the PDU Set.
\- Priority for the PDU Set.
\- Periodicity of the PDU Sets.
\- Size of the PDU Sets.
\- Jitter statistics like mean and variance as well as maximum value of the
jitter.
### 6.59.4 Impacts on services, entities and interfaces
UPF:
\- Provides the following information as part of GTP-U header:
\- Identification of PDU Set (e.g. an XR frame) boundary.
\- Dependencies of PDU Sets.
SMF:
\- Provides the following information as N2SM container to NG-RAN:
\- Indication of the delay budget, maximum error rate for the PDU Set.
\- Validity time for the PDU Set.
\- Priority for the PDU Set.
\- Periodicity of the PDU Sets.
\- Size of the PDU Sets.
\- Jitter statistics like mean and variance as well as maximum value of the
jitter.
NG-RAN:
\- Utilizes the assistance information received in the GTP-U header of user
plane traffic and NGAP signalling for improved power savings configuration.
## 6.60 Solution #60: End of Burst Indication
### 6.60.1 Key Issue mapping
This solution addresses KI#8.
### 6.60.2 Description
This solution is based on providing the NG-RAN with an End of Burst indication
(EOBI). Such indication is used by the RAN to decide when to put the UE to
sleep.
The UPF provides the EOBI in the GTP-U header of the last PDU (of the last PDU
set) of a Data Burst.
NOTE: How the EOBI is encoded in the GTP-U header is it to be discussed in
Stage 3.
The UPF decides when to insert the EOBI based on implementation specific
mechanisms to detect the end of the data burst, or based on explicit
indications from the AS. The indication from the AS can be standardized or
non-standardized.
When the NG-RAN receives the EOBI in the GTP-U header it understands that that
specific PDU is the last PDU of a given Data Burst and it puts the UE to
sleep.
Figure 6.60.2-1: End of Burst Indication added to GTP-U header
### 6.60.3 Procedures
The baseline procedure to provide End of Burst Indication (EOBI) to the RAN is
as follows:
1\. After a PDU Session has been established, the UPF receives UP data from
the application server.
2\. Within the QoS flow, the UPF determines when data burst terminate. This
can happen in two ways:
2a. The application provides an explicit indication of end of burst over N6.
This can be done via standardized or non-standardized mechanisms. The UPF uses
such explicit indication from the AS to determine when a certain data burst is
terminated.
2b. Based on implementation specific mechanisms (e.g. deep packet inspection),
4\. The UPF adds the EOBI to the GTP-U header of the last PDU (of the last PDU
set) of each data burst.
3\. Each time the NG-RAN receives the EOBI it knows a burst is terminated and
it sends the UE from CDRX high power state to sleep/low power state.
NOTE: How the EOBI is encoded in the GTP-U header is up to Stage 3.
Editor\'s note: It is FFS whether the EOBI can work with for different DL
streams with different periodicity
### 6.60.4 Impacts on services, entities and interfaces
AF:
\- (Optional) Provides the End of Burst Indication (EOBI) over N6 to the UPF.
UPF:
\- (Optional) Receives the EOBI over N6 from the AS.
\- Either based on the input of the AS or on implementation specific
mechanisms, decides when to add the EOBI to the GTP-U header of the PDUs sent
to the RAN.
\- Sends to the RAN the EOBI the GTP-U header of the last PDU of the Data
Burst.
RAN:
\- Receives from EOBI in the GTP-U header of the last PDU of the Data Burst.
\- When the EOBI is received, it switches the UE to a low power state.
## 6.61 Solution #61: Policy Determination Considering UE Battery Level
### 6.61.1 Key Issue mapping
This solution addresses KI#9: Trade-off of QoE and Power Saving Requirements.
### 6.61.2 Description
The XRM traffics have the characteristics of high throughput, low latency, and
high reliability requirement, and the UE battery level may impact the user\'s
experience since the high throughput require the high power consumption in
terminal side. Considering the limited radio resource and end-to-end QoS
policy control from system perspective, the proposed solution highlights the
enhancement to support trade-off among throughput, latency and reliability and
device battery life.
The UE battery level provides the relative battery life of the device. It can
have a special value or the percentage of the battery life. It can be
considered within the policy determination, e.g. the reduction of QoS levels
of some specific service, high power consumption applications during low
battery.
\"UE battery level change\" is defined as an access or non-access related
policy control request trigger.
PCF subscribes to AMF or SMF on UE battery level change.
When UE battery level change event is received, the PCF determines the policy
based on the current UE battery level, e.g. a QoS level corresponding to a low
or ultra-low battery level is selected to conduct the service.
\- When UE battery level change event is received from AMF, the PCF evaluates
policies for the SDF of UE XRM services or UE PDU sessions of XRM services.
\- When UE battery level change event is received from SMF, the PCF evaluates
policies for the SDF of UE XRM services or UE PDU sessions of XRM services
managed by the SMF.
For a specific service subject to power saving, either multiple policy levels
respectively associating to a different UE battery level are predefined, or
the policy level subject to current UE battery level is dynamically requested
by the UE.
The UE battery level may be considered for policy determination immediately or
can be stored to the UDR by the PCF for later use. It can be used with the
combination of other events for policy determination, e.g. when Out of credit,
GFBR of the QoS Flow can no longer be guaranteed, or there\'s limited network
resources.
UE battery level is also can be reported to AF by the PCF, so that AF can take
some action (e.g. change codec) to keep an aligned policy.
### 6.61.3 Procedures
#### 6.61.3.1 AM Policy Association Establishment and Modification
The following figure represents a high-level procedure of the solution that UE
battery level change is defined as an access related policy control request
trigger and PCF subscribes to AMF on UE battery level change.
Figure 6.61.3-1: A high-level procedure of AM Policy Association Establishment
and Modification.
1-4. Steps 1-4 according to steps 1-4 of clause 4.16.1.2 of TS 23.502 [3]. The
UE battery level change is defined as an access related policy control request
trigger. PCF subscribes to AMF on UE battery level change in step 3. The AMF
deploys the access and mobility related policy information which includes
storing the Policy Control Request Trigger(s) of the AM Policy Association
(e.g. UE battery level change).
5\. When the UE battery level change Trigger condition is met, the AM Policy
Association Modification procedure is initiated by the AMF.The UE status (e.g.
UE battery level) can be provided to the AMF (e.g. using the UE 5GMM Core
Network Capability information) during the Initial Registration or Mobility
Registration Update procedure within the NAS message.
6-9. Steps 6-9 follow steps 1-4 of clause 4.16.2.1.1 of TS 23.502 [3]. When UE
battery level change event is received from AMF in step 6, PCF determines the
policy based on the current UE battery level in step 7, e.g. a QoS level
corresponding to a low or ultra-low battery level is selected to conduct the
service. PCF evaluates policies for the SDF of UE XRM services or UE PDU
sessions of XRM services.
Alternatively, the UE battery level can be stored to the UDR by the PCF for
later use and skip the follow steps. The UE battery level change can be used
with the combination of other events for policy determination, e.g. GFBR of
the QoS Flow can no longer be guaranteed.
UE battery level is also can be reported to AF by the PCF, so that AF can take
some action (e.g. change codec) to keep an aligned policy.
#### 6.61.3.2 SM Policy Association Establishment and Modification
The following figure represents a high-level procedure of the solution that UE
battery level change is defined as a non-access related policy control request
trigger and PCF subscribes to SMF on UE battery level change.
Figure 6.61.3-1: A high-level procedure of AM Policy Association Establishment
and Modification.
1-4. Steps 1-4 according to clause 4.16.4 of TS 23.502 [3]. The UE battery
level change is defined as an non-access related policy control request
trigger. PCF can subscribe to SMF events, e.g. UE battery level change,
associated with the PDU Session in the Npcf_SMPolicyControl_Create response in
step 4.
5\. When the UE battery level change Trigger condition is met, the SM Policy
Association Modification procedure is initiated by the SMF. The UE status
(e.g. UE battery level) can be provided to the SMF (e.g. using the PCO
information element) during the PDU session establishment or the PDU session
modification procedures within the NAS message.
6-9. Steps 6-9 follow the description of clause 4.16.5.1 of TS 23.502 [3].
When UE battery level change event is received from SMF in step 6, PCF
determines the policy based on the current UE battery level in step 8, e.g. a
QoS level corresponding to a low or ultra-low battery level is selected to
conduct the service. PCF evaluates policies for the SDF of UE XRM services or
UE PDU sessions of XRM services managed by the SMF.
Alternatively, the UE battery level can be stored to the UDR by the PCF for
later use and skip the follow steps. The UE battery level change can be used
with the combination of other events for policy determination, e.g. GFBR of
the QoS Flow can no longer be guaranteed.
UE battery level is also can be reported to AF by the PCF in step 7, so that
AF can take some action (e.g. change codec) to keep an aligned policy.
### 6.61.4 Impacts on services, entities and interfaces
UDR:
\- The UE battery level can be stored to the UDR by the PCF.
PCF:
\- When UE battery level change event is received, PCF determines the policy
based on the current UE battery level (or stores into the UDR), reports to AF
for taking action (e.g. change codec) to keep an aligned policy.
AMF:
\- When the PCF subscribed to AMF on UE battery level change, the AMF deploys
the policy information which includes storing the UE battery level change
trigger, and notifies to PCF when the trigger condition is met. The AMF can
get the UE battery level from UE within the NAS message.
SMF:
\- When the PCF subscribed to SMF on UE battery level change, the SMF enforces
the subscription, and notifies the PCF for the event when the trigger
condition is met. The SMF can get the UE battery level from UE within the NAS
message.
UE:
\- The UE provides the battery level to AMF/SMF (via NAS).
## 6.62 Solution#62: Policy control and exposure for multi-modality services
### 6.62.1 Key Issue mapping
This solution addresses KI#1 and KI#2 and enables policy control and network
capability exposure for multi-modality services in both scenarios for a single
UE and among multiple UEs.
### 6.62.2 Description
According to the key issue description, there are two aspects to be addressed:
(i) application synchronization and, (ii) QoS policy coordination.
Application synchronization refers to media synchronization. This is to ensure
that related tactile and multi-modal data (e.g. audio, video and haptic data
related to a specific time) is delivered by the application to the user at a
similar time. There are requirements about the synchronization threshold
between two or more modalities (for example audio-tactile, or visual-tactile)
specified in TS 22.261 [5] and TR 22.847 [6].
However, it is a misconception to think that media synchronization can be
achieved by ensuring that all modalities are transmitted at the same time
and/or have the same maximum end-to-end latency. Media synchronization
requires that data from two or more modalities is synchronized to a common
timeline when presented to the end user or received at the client application.
This solution proposes to achieve media synchronization by using application-
level mechanisms, as described in solution #40 that proposes to reuse the
mechanisms used by IMS for media synchronization (refer to clause 7.5.3 of TS
26.114 [28], that mandates to use RTCP Sender Reports for media
synchronization according to RFC 3550 [9]). The requirement is to have a
common wall-clock time for all data flows that need to be in sync. In the case
of multiple UEs, there are 3GPP mechanism to achieve a common clock, e.g.
using the timing information provided by gNodeB in SIB9 (see TS 38.331 [60]).
QoS policy coordination of multi-modality flows for a single UE (KI #1) or
multiple UEs (KI #2) is best achieved by the application client and server
that handles all required data flows / streams.
\- Each of the data streams that comprise a multi-modal application, in
general, requires a different set of QoS parameters.
\- Each data stream may follow a separate transmission path, i.e. use a
different PDU session, on a different DNN or network slice.
\- Some data streams do not require any coordination or media synchronization,
for example a temperature sensor may not require to be coordinated with other
media, but provide a constant flow of ambient information.
\- Applications need to be able to control each data stream independently, in
terms of enabling, disabling or setting the conditions for the device to
deliver the data stream.
\- XRM applications provide service requirements (including QoS info) when the
XRM session is initiated. It may not be possible for the application to
provide the Flow Description(s) before the PDU session is establish, if server
IP address/port is allocated on demand.
On the other hand, some data streams may be fully inter-dependent, in the
sense that they are all necessary for the multi-modal application to function
correctly. But even in such case, it is up to the application layer to decide
what to do in case one of the (single-modal) data stream fails. For example, a
video conference call requires both audio and video data streams to be
successfully delivered. If the video stream fails, the conference call can
continue only with audio (impacting the use experience, but still allowing
communication). However, if the audio stream fails the conference call is
typically terminated.
This solution proposes that those data streams (or set of data streams) that
are closely related and require strong application coordination for correct
delivery of a multi-modal application, are transmitted in a single PDU session
by a single UE (either via a single device or multiple devices connected to a
single UE that can access the 5GS). This enables the application (AF/AS) to
handle multiple medias in a single procedure and single AF session. However,
those data streams (or set of data streams) that contribute to the immersive
experience, but may still be valid stand-alone, may be transmitted over
separate PDU sessions from multipe UEs.
An example use case is provided in TR 22.847, chapter 5.1 (Immersive multi-
modal Virtual Reality (VR) application). The VR system consists of two
separate devices (VR glasses and gloves) connected to the 5GS as independent
5G UEs. The VR glass device generates positioning and view information that is
closely inter-related, but can function with or without the haptic and sensing
data generated by the VR gloves.
Figure 6.62.2-1: ( Figure 5.1.2-1 from TS 22.847 [6]): Immersive multi-modal
VR application with multiple 5G UEs directly connected to 5G network
For multi-modality flows transmitted by a single UE (KI #1), all required
application coordination can be achieved by re-using existing 5GS mechanisms.
The functionality provided by the Npcf_PolicyAuthorization service (TS 29.514
[66]) allows the AF/NEF to provide service information to the PCF and request
specific QoS, charging, subscribe to events, etc. The service information
provided by the AF/NEF consists of media components and media sub-components.
Hence, different data streams of the multi-modal application, can be mapped
onto different media components.
NOTE: This is the current mechanism used by IMS to setup video calls.
Extensions to the Npcf_PolicyAuthorization service may be needed to best
accommodate XR applications
The procedure for AF session setup with required QoS (clause 4.15.6.6 of TS
23.502 [3]), can be reused for untrusted AFs interacting with NEF. However,
current Nnef_AFsessionWithQoS service (TS 29.522 [67]) does not allow the AF
to provide information for multiple medias:
\- Option 1. Extend the existing Nnef_AFsessionWithQoS service to allow the AF
to provide service information for multi-modal (XRM) applications.
\- Option 2. Define a new NEF service/API for multi-modal (XRM) applications.
Option 1 has less system impacts and so it is the preferred alternative. Note
that the current specification for Nnef_AFsessionWithQoS is fully extensible
in a backwards compatible way. On the other hand, option 2 (define a new NEF
service/API) opens the option for single-modal applications to either keep
using the legacy API or the new API (which may lead to inter-operability
issues).
For multi-modality flows transmitted by multiple UEs (KI #2), the solution
proposes to extend the existing mechanisms for AF session setup with required
QoS with an additional attribute that characterize the service data flow. This
allows 5GC to apply different QoS policies for data flows that are part of a
multi-modal application, compared to the same data flows from a single-modal
applications. If multiple UEs are provided with the same MMCI it implies these
multiple UEs are using the same type of service, and will have a QoS handling
that would depend on it. MMCI is an additional/optional information. The MMCI
can complement the information provided by a QoS reference. The combination of
both, MMCI and QoS reference can point to a QoS profile. Availability of MMCI
would allow to distinguish one multi-modal service from another, and hence the
specific treatment each service may have, in combination with other QoS
parameters included in the request.
\- Muti-modality Communication Identifier (MMCI): Indicates that the created
Individual Application Session Context resource relates to a tactile or multi-
modal communication service. It may also include the name of the multi-modal
service provider, a qualifier to further characterize the type of multi-modal
service or a specific instance of multi-modal service.
There is no need to hide to the application that there are multiple UEs
involved in the multi-modality service. For the example use case of the VR
system described above. The application will manage each device (VR glases and
gloves) via separate procedures, but allocate the same MMCI.
### 6.62.3 Procedures
The following figure represents a high-level procedure of the solution, based
on the procedure described in clause 4.15.6.6 of TS 23.502 [3].
Figure 6.62.3-1
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message. The request includes two new
attributes where the AF provides service information for multi-modal (XRM)
applications:
\- Multi-modal Service Requirements (MultiModalServiceReq): Flow
description(s) or External Application Identifier, QoS Reference, etc for each
media that comprise the multi-modal service
\- Muti-modality Communication Identifier (MMCI). The MMCI is an additional
identifier used by the PCF to authorize and determine the policies to apply to
the AF request, considering the AF request is bound to a PDU session.
2-3. The NEF authorizes the AF request, maps the different data streams of the
multi-modal application provided by the AF onto different media components and
subcomponents, and interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request. The request to the PCF includes the
MMCI (Muti-modality Communication Identifier).
4-5. The PCF determines whether the request is authorized, derives the
required QoS parameters based on the information provided by the NEF and
issues a Npcf_SMPolicyControl_UpdateNotify request to the SMF with updated
policy information, for the affected PDU session.
7-8. When another device (UE2) initiates the communication, the AF request the
neede resources (as in step 1), including the same MMCI as for the first
device (UE1).
### 6.62.4 Impacts on services, entities and interfaces
NEF:
\- Extend the existing Nnef_AFsessionWithQoS service to allow the AF to
provide service information for multi-modal (XRM) applications and include a
the new attribute Muti-modality Communication Identifier (MMCI).
\- Map data streams of the multi-modal application provided by the AF onto
different media components and subcomponents.
PCF:
\- Support the new attribute MMCI (Muti-modality Communication Identifier) to
authorize the request received from NEF and derive the required QoS
parameters, together with existing information.
AF:
\- Provide service information for multi-modal (XRM) applications to the NEF
and include a the new attribute Muti-modality Communication Identifier (MMCI).
## 6.63 Solution#63: Group QoS coordination and network interaction
enhancement6.63.1 Key Issue mapping
This solution addresses KI#1 and KI#2 and enables policy control and network
capability exposure for multi-modality services in both scenarios for a single
UE and among multiple UEs.
### 6.63.2 Description
For XR applications consist of only video and audio flows, the IMS mechanism,
comprising the SIP/SDP signalling, the SDP Grouping Framework and the
RTP/RTCP, provides an efficient mechanism for the audio and video traffic
synchronization. Hence, we can re-use the IMS mechanism for the audio and
video traffic synchronization.
Meanwhile, XR applications may consist of other types of multi-modal flows
besides audio and video. (e.g. tactile, pressure). In this situation, we
propose to use the enhanced interaction between AF and 5GS to realize flow
coordination. Multi-modal flows belong to the same group must be successfully
established at the same time and the QoS requirements of different flows all
need to be fulfilled, which puts forward group QoS coordination requirements
(i.e. group QoS fulfilment, group resource reservation) at the network side.
In order to guarantee group QoS fulfillment and group resource reservation for
multi-modal flows belong to the same service/application, the information
provided from AF to 5GS should contain the following:
1\. A group of Flow description, indicating which traffic flows belong to the
same group.
2\. A group of QoS requirement associated to the group of Flow Description.
3\. A group of Necessity Indication, indicating which flows within the same
group are necessary. If all necessary flows are successfully established and
the QoS requirements of all necessary flows can be fulfilled, the network
allocate resource for them and 5GS should notify AF that these flows are
established successful. Otherwise, if anyone fails to be established or the
QoS requirements of anyone cannot be fulfilled, PCF should trigger to delete
all flows and report failure to AF.
In conclusion, this solution contains the following:
\- The IMS mechanism, comprising the SIP/SDP signalling, the SDP Grouping
Framework and the RTP/RTCP, can be re-used for XR applications which only
consist of audio and video traffic.
\- The enhanced interaction between AF and 5GS can be used to realize group
QoS coordination (i.e. group QoS fulfilment, group resource reservation) for
XR applications which consist of other types of multi-modal flows besides
audio and video. (e.g. tactile, pressure).
### 6.63.3 Procedures
#### 6.63.3.1 Audio-Video synchronization
For XR applications which consist of only audio and video traffic flows, it is
proposed to re-use the IMS mechanism for audio-video synchronization:
\- The SIP/SDP signalling procedures can be used to establish audio-video
sessions among terminals.
\- The SDP Grouping Framework can be used to allow the decoder to know that
different audio-video flows need to be synchronized.
\- The RTP and the RTCP can be used to realize the synchronization of audio
and video flows.
#### 6.63.3.2 Enhanced interaction between AF and 5GS for Single UE
For XR applications consist of video, audio, haptic data, and other types of
multi-modal data, the enhanced interaction between AF and 5GS is proposed to
realize group QoS coordination at the network side.
The AF provides information to 5GS to indicate the flows belong to the same
group and the necessary flows within the group. If all necessary flows are
successfully established and the QoS requirements of all necessary flows can
be fulfilled, the network allocates resource for them. Otherwise, if anyone
fails to be established or the QoS requirements of anyone cannot be fulfilled,
the PCF triggers to delete all flows and report failure to the AF.
Figure 6.63.3.2-1: Setting up an AF session with required QoS procedure
1\. The AF sends a request to reserve resources for an AF session using
Nnef_AFsessionWithQoS_Create request message (UE address, AF Identifier, a
group of Flow description, a group of QoS requirement associated to the Flow
description, a group of Necessity Indication) to the NEF. The necessary flows
are partial or all of the group of flows. The other flows in the group of
flows rely on the necessary flows.
2\. The NEF authorizes the AF request. If the authorization is granted, it
continues with step 3. Otherwise, it continues with step 5.
3\. The NEF interacts with the PCF by triggering a
Npcf_PolicyAuthorization_Create request and provides UE address, AF
Identifier, a group of Flow description, a group of QoS requirement associated
to the Flow description, a group of Necessity Indication to the PCF.
4\. The PCF determines whether the request is authorized and notifies the NEF
if the request is not authorized.
5\. The NEF responses to the AF whether the request is granted or not.
6\. The NEF shall send a message to the PCF to subscribe to notifications of
resource allocation status.
7\. When the event condition is met, e.g. that the establishment of the
transmission resources corresponding to the QoS update succeeded or failed,
the PCF notifies the NEF about the event. If all necessary flows are
successfully established and the QoS requirements of all necessary flows can
be fulfilled, the network allocates resource for them. If anyone fails to be
established or the QoS requirements of anyone cannot be fulfilled, the PCF
triggers to delete all flows and report failure to the NEF.
8\. The NEF sends Nnef_AFsessionWithQoS_Notify message with the event reported
by the PCF to the AF.
Furthermore, the PCF generates a group of PCC rules for the SMF based on the
received request message in step 3. The SMF handles the group of PCC rules and
generates some QoS characteristics values associated with the QoS flows belong
to the same group. If any necessary flows cannot be established or the QoS
requirements of any necessary flows cannot be fulfilled, the SMF knows and
tears down the others. Then the SMF reports failure to the PCF and the PCF
reports failure to the AF.
#### 6.63.3.3 Enhanced interaction between AF and 5GS for Multiple UEs
For multiple UEs scenario, the group of coordination policies all can be
configured and updated by the AF. Correspondingly, the AF can send one or
multiple requests to help realize group QoS fulfillment and group resource
reservation. If the QoS requirements of any necessary flows cannot be
fulfilled, there is no need to fulfill the QoS requirements of other flows. If
the resource reservation of any necessary flows fails, then the AF notifies
5GC to release all resources. When the AF decides to change one or more
policies for specific traffic flows, a group of updated coordination policies
can be re-sent to the network.
### 6.63.4 Impacts on services, entities and interfaces
AF:
\- For single UE scenario, need to provide the request message (UE address, AF
Identifier, a group of Flow description, a group of QoS requirement associated
to the Flow description, a group of Necessity Indication) to the PCF.
\- For multiple UEs scenario, need to configure and update the group of
coordination policies.
NEF:
\- Need to authorize the AF request.
PCF:
\- Need to generate a group of PCC rules for the SMF based on the received
request message from the AF.
SMF:
\- Need to handle the group of PCC rules and generate some QoS characteristics
values associated with the QoS flows belong to the same group.
\- If any necessary flows cannot be established or the QoS requirements of any
necessary flows cannot be fulfilled, need to tear down the others and report
the failure to the PCF.
## 6.64 Solution #64: NEF based coordination across multiple PCFs for multi-
modal flow groups with multiple UEs
### 6.64.1 Key Issue mapping
This solution addresses KI#2: Support the Application Synchronization and QoS
Policy Coordination for Multi-modal Traffic among Multiple UEs.
### 6.64.2 Description
Multi-modal services may be comprised of multiple traffic flows related to
multiple UEs. The 5GS is expected to be able to apply common policies for the
group of flows such as joint admission or aligned QoS fulfilment upon a
request by an AF.
This solution assumes that the UEs involved in the multi-modal service with a
flow group policy may be served by multiple PCFs. In order to enforce joint
admission or aligned QoS fulfilment policies the PCFs need to coordinate. In
this solution the coordination is performed by NEF, who receives the AF
request(s) with the service flows and the flow group policies, discovers the
PCFs involved, passes updates/notifications between the PCFs and provides the
overall updates/notifications back to the AF. This way, the coordination on
events such as QoS fulfilment failures across flows related to different UEs
even served by different PCFs does not need to be done to the AF but can be
handled directly within the 5GS based on the polices provided by the AF. This
simplifies the AF implementation and reduces signalling between the AF and the
5GS.
It is further assumed that for the enforcement of joint admission control
policies within the flow group, it may be beneficial for the SMF and the RAN
to receive information on all flows subject to the policy before making
admission decisions. For this purpose, this solution also includes a mechanism
by which each PCF knows it has received information about all service flows
that should be considered together before proceeding with policy updates about
them to the SMF.
The AF-NEF interface may operate in either or both of these ways:
1\. AF can include all service flows related to all UEs in a single request.
In this case the NEF parses the request and makes a separate PCF discovery for
each UE.
2\. AF makes a separate request for each UE correlated by a common flow group
coordination ID and a common request batch indicator which will identify the
requests AF does in a batch (at the same time or back-to-back) and their
amount so that the NEF knows which requests should be taken into account for
joint admission. In this case the NEF discovers PCF separately for AF each
request but will wait until it has received the full batch of AF requests
before proceeding towards the PCFs.
NOTE 1: It does not seem necessary to support both options so one of them
should be selected but that is beyond the scope of this solution.
In NEF-PCF interface only single UE specific operations are supported, again
correlated by a common flow correlation group id and batch information. If a
PCF is serving multiple UEs included in AF request (or batch of requests), the
NEF will make multiple requests to that PCF indicating their number in the
batch information, so that the PCF will know when it has received the full
batch. PCF will only proceed after receiving the full batch in order to allow
joint admission for all flows in that batch in the RAN. The NEF also passes
the full group policy including all UEs and all flows to each PCF even if the
PCF is not responsible for all UEs.
NOTE 2: The batch mechanism and PCF waiting for the full batch is not
necessary if RAN does not require information on all service/QoS flows to be
considered for joint admission at the same time but also that is beyond the
scope of this solution.
For joint admission and aligned QoS fulfilment, each PCF will be able to take
the flow group policy into account. It sends the replies/notifications on
admission and QoS fulfilment events concerning those UEs to the NEF. The NEF
will forward the reply/notification information from one PCF to all other
PCFs, which can based on that apply the group policy also based on information
from the UEs they are not serving.
NEF also passes the replies/notifications to the AF. In case AF has used just
a single request covering multiple UEs, NEF combines the replies/notifications
received for individual UEs and provides the overall result to the AF (but can
still provide also UE-specific information to the AF). Otherwise, AF receives
replies/notifications for each UE separately.
### 6.64.2 Procedures
#### 6.64.3.1 Procedure for coordination between Multiple PCFs facilitated by
NEF
If the flow coordination group has service data flows associated with multiple
UEs, it is possible that even multiple PCFs are involved. For that case,
coordination between PCFs can be anchored at NEF. The following procedure
describes that scenario.
In this message flow, UE1 and UE3 share a common PCF namely PCF1, while UE2 is
served by PCF2. In this message flow, a single request from AF including
multiple UEs is made but the explanation covers also the case when AF sends UE
specific requests.
Figure 6.64.3-1: Coordination across multiple PCFs
1\. PDU session established for each UE
2\. AF sends Nnef_AFsessionWithQoS_Update request message towards NEF for a
group of service flows related to multiple UEs. The AF includes the following
information in its request: Multiple UE identities, related to each UE a set
of Service flow descriptions and their QoS requirements, and flow group
policies that apply across service flows.
In case AF sends a separate request for each UE, each request contains a
common flow group correlation ID and common batch correlation information
which indicates which requests belong to the same batch and how many requests
the batch contains.
3\. NEF authorizes AF\'s request(s) and discovers PCF related to each of the
UEs included in AF\'s request(s) according to clause 4.15.6.6 of 23.502 [3].
In case AF sends multiple requests in a batch, the NEF stores the request
information until it has received the full batch based on the batch
correlation information. In this example call flow NEF discovers PCF1 for UE1
and UE3 and PCF2 for UE2. Based on the discovery (and flow group correlation
ID and batch correlation information in case AF sent multiple requests) NEF
determines how many separate UE specific Npcf_PolicyAuhorization_Create
requests it has to send to each PCF to cover the whole flow coordination
group. In practice, this is the number of different UEs for the group served
by each PCF. The NEF can subscribe the Resource allocation status to the PCFs
in the Npcf_PolicyAuhorization_Create requests. The group information and
policy change event can be subscribed to the NEF by PCFs in the
Npcf_PolicyAuhorization_Create responses. It can be exposure to AF, if
subscribed.
In case NEF does not get the full batch of requests from the AF within a
specific time, the NEF fails the requests it has received thus far with an
error code indicating an incomplete batch.
NEF stores information about all the PCFs involved with the particular flow
group coordination ID locally and/or in the UDSF in order to pass information
between the PCFs about future events.
4\. NEF interacts with the PCF1 related to UE1 by using
Npcf_PolicyAuthorization_Create request with input parameters UE1 address, UE1
ID, flow coordination group ID and policies, total number of requests for this
PCF to cover the whole flow correlation group QoS reqs and Flow group
policies. Based on the number of requests/UEs for the group and batch the PCF
will be able to determine when it has received all requests related to the
group and will only then proceed towards SMF with full information related to
the group.
5\. PCF1 does the Session binding but since it sees it will receive a total of
2 requests in a batch for this flow coordination group and this is just the
first one, it stores the first request and does not proceed towards SMF until
it has received all requests relevant for the flow coordination group.
NOTE: This logic is needed to enable appropriate admission control decisions
in RAN for all QoS flows added or updated within a batch. If such admission
control in RAN is not supported, PCF may proceed immediately with policy
updates towards the SMF after receiving the first request. How RAN performs
admission control is out of scope.
In case PCF does not get the full batch of requests from NEF within a specific
time, the PCF fails the requests it has received thus far with an error code
indicating an incomplete batch.
6\. Similar to step 4 but with UE2 and PCF2.
7\. and 8. Since PCF2 is serving only UE2 it has at this point already
received all requests for the given flow coordination group ID and batch and
can proceed immediately with the creation of group policy across multiple PDU
sessions for UE2 and communicates with SMF including flow-group ID/policies,
QoS reqs, Flow group policies: joint-admission, joint-QoS fulfilment.
9\. Similar to step 4 but with UE3 and PCF1.
10-11. PCF1 has received all requests for the flow coordination group and
batch and can proceed to create the group policy for all PDU sessions which
are related to UE1 and UE3 flows. After this, PCF1 communicates with SMF
regarding each flow for UE1 and UE3 providing it with flow group coordination
ids, QoS reqs and Flow group policies
12\. In case of the successful joint admission:
13\. PCF1 indicates the successful joint admission to NEF corresponding to
UE1, UE3
14\. PCF2 indicates the successful joint admission to NEF related to UE2.
15\. All admission results for the flow group received, determine overall
result as successful.
16\. As all UEs admission control is successful, AF is informed about the
successful joint admission from NEF.
17\. In case of the unsuccessful joint admission scenario:
18\. PCF1 indicates the successful joint admission to NEF corresponding to
UE1, UE3
19\. PCF2 indicates the unsuccessful joint admission to NEF related to UE2.
PCF2 includes the flow coordination group ID in the information sent to NEF.
20\. On the receipt of the failure from one of the PCFs, NEF based on the flow
group coordination ID determines which other PCFs are serving the same group
and passes the information to them. In this case the failure is received from
PCF2, so the NEF will pass it to PCF1 (but not back to PCF2 who sent it). .
21\. NEF informs PCF1 about the unsuccessful joint admission failure.
22\. NEF informs AF about the unsuccessful joint admission failure.
23\. In case of QoS fulfilment failure scenario:
24\. Consider joint QoS fulfilment policy failure occurred in RAN for UE2, RAN
will inform SMF1
25\. UE2 QoS failure is informed from SMF2 to PCF2.
26\. PCF2 releases all the flows related to flow coordination group ID.
Failure is informed to NEF about QoS fulfilment related to UE2. PCF2 includes
the flow coordination group ID in the information sent to NEF.
27\. On the receipt of the failure from one of the PCFs, NEF based on the flow
group coordination ID determines which other PCFs are serving the same group
and passes the information to them. In this case the failure is received from
PCF2, so the NEF will pass it to PCF1 (but not back to PCF2 who sent it).
28\. NEF informs PCF1 about the joint QoS fulfilment failure.
29\. NEF informs AF about joint QoS fulfilment failure.
30-31. UE1, UE3 release the resource flows are triggered
32\. Joint failure fulfilment notification is indicated from PCF1 to NEF.
Here, NEF is informed by PCF about the resources related to this joint QoS
multi-modality session.
AF is able to update and add service flows and policies to a flow coordination
group with new requests. NEF and PCF treat updates in the same way as initial
requests except they are considered part of a new batch and not treated
atomically with the initial batch.
### 6.64.3 Impacts on services, entities and interfaces
The solution has the following impacts:
NEF:
\- NEF facilitates coordination of multi-flow group policies across multiple
PCFs and for PCFs serving multiple UEs. It discovers the PCFs for all UEs
involved in the flow coordinationgroup provided by the AF in a single or
multiple UE specific requests. It stores information locally and in the UDR
about the PCFs serving the flow coordination group in order to pass
information between them about admission control and QoS fulfilment
(notification control) results. It indicates to each PCF how many requests
within a group the PCF should consider for joint admission and passes the
results of admission successes and failures and QoS fulfilment updates and
failures between the PCFs. It provides aggregated replies and notifications to
the AF.
PCF:
\- Npcf_PolicyAuthorization_create API is extended to include information on
how many UE specific requests the PCF should consider for joint admission so
that the PCF is able to wait until it has received all of them before
interacting with the SMF. The API is also enhanced to pass notifications about
group policy events (joint admission success/failure, joint QoS fulfilment
update/failure) between PCFs forwarded by the NEF.
## 6.65 Solution #65: QoS enhancement to support the synchronized delivery of
multiple QoS flows
### 6.65.1 Key Issue mapping
This solution addresses KI#1 and KI#2 and enables policy control and network
capability exposure for multi-modality services in both scenarios for a single
UE and among multiple UEs.
### 6.65.2 Description
This solution proposes enhanced interaction between the AF and the 5GS and
also QoS policy enhancement to support the delivery of data from multiple
service flows (mapped to QoS flows) of an application in a similar or
compatible delay (PDB of the QoS flow). Similar or compatible here mean that
when each flow is delivered with its delay requirement, the receiving
application can play out or render the data from each flow with minimum
buffering or waiting time between the flows. The exact synchronous playout or
rendering is handled by the application itself using, e.g. RTP time stamps.
The compatible delays are kept even if the 5GS has to downgrade any of the
flows to alternate QoS profile with a longer PDB by downgrading also the other
flows\'s corresponding alterative QoS PDBs.
The solution also proposes enhanced interaction between the AF and the 5GS
that allows AF to provide the 5GS policy information about the service flows
with respect to which flows are critical to the usability of the application
and if they fail either at admission phase or while being delivered (e.g. even
downgrade to a lower alternative QoS profile is no longer possible),
successful admission or delivery of any of the other flows will not help. The
5GS can use this information for its admission control and QoS fulfilment
decisions at both CN and RAN level.
For an application, service flows requiring coordinated delivery are grouped
into a service flow group. Each service flow group has group level treatment
requirements used for associated control of the service flows in the group,
e.g. delivery of data to the receiver at a similar time. Each service flow can
also be declared as critical within the group meaning its failure will render
the application unusable. Each flow in the service flow group still has its
own QoS requirements which is mapped to a QoS profile such as 5QI, ARP, PDB,
PER, etc, and optionally a set of ordered alternative QoS profiles (AQPs).
For each group of service flows of an application, AF provides service flow
association requirements to 5GS via interactions between AF and PCF. The
service flow association requirements indicate association among a group of
service flows of the application, and associated control between these service
flows. The service flow association requirements consist of a service flow
coordination group ID and group level treatment requirements for a group of
service flows. The service flow coordination group ID is for identifying a
group of service flows, and the group level treatment requirements include
information for associated control of service flows in the group, e.g.
information for for flow criticality forjoint fulfillment of admission
control/resource allocation purposes and information for indicating
synchronized delivery of service flows to the receiver side.
PCF maps the service flow coordination group to QoS flow coordination group in
the 5GS and derives associated group level treatment policy in the network
based on service flow association requirements.
PCF can provide PCC rules with group level treatment policy for service flows
in the group, where the group level treatment policy/requirement may include
the following information:
1\. Synchronized delivery and joint QoS fulfilment information, including an
ordered list of PDB values per service flow in the coordination group. SMF
derives the QoS profile and AQP(s) of each QoS flow based on ordered list of
PDB values. The AQPs of the QoS flows in the group with the same order number
are mapped AQPs, which means they are associated with each other. When PDB
values have been chosen in such a way that when the PDB in the same position
is chosen for each flow, the flows are delivered to the recipient in a
synchronized manner, i.e. with a similar end-to-end delay.
2\. Joint admission control and resource allocation information, indicating
associated resource allocation in 5GS among service flows. For example, once a
service flow or a certain percentage of the service flows in a group cannot be
allocated with the network resource due to poor network condition, the others
do not need to be allocated to save the network resource and thus they should
be treated jointly.
Each service flow in a service flow group is treated as individual QoS flow
without aggregation, and based on the PCC rule, SMF could derive QoS profile
and AQP(s) for each QoS flow.
The network fulfills the QoS alignment requirement in the QoS flow
coordination group based on the group level treatment policy in addition to
the fulfillment of the QoS requirements of each individual QoS flow.
Alternatively, SMF/PCF may use such group level treatment policy for PDU
session management decisions. E.g. release the other QoS flows in the
coordination group in case admission control/QoS fulfillment of one of the QoS
flow fails.
Joint admission policy can be enforced in 5GS as explained in 6.65.3.2 and
6.65.3.3, where each flow is separately admitted but if a new critical flow
cannot be admitted, the 5GS can also release the earlier admitted flows in the
group. Providing RAN more information about the QoS flows that should be
considered for joint admission proactively during the setup of the first QoS
flow allows RAN to further optimize its flow group admission decision and
resource reservation. This procedure however requires Core Network Functions
(PCF, SMF) to get all the service flow information before proceeding towards
the RAN. This optimization is described in 6.65.3.4 with additional CN impacts
listed in clause 6.65.4.
### 6.65.3 Procedures
#### 6.65.3.1 Enhanced interaction between AF and 5GS for QoS policy
coordination among multiple QoS flows
AF provides service flow coordination group ID together with group level
treatment requirements to PCF via NEF using the procedure of setting up an AF
session with required QoS. The AF can provide the requirements and information
of all of the service flows in a group with a single request or using multiple
requests. If there are service flows related to multiple UEs, the request
contains flow information for each UE.
The AF can provide updates to the service flow information or group policy in
update requests. If the AF provides or adds service flows in separate
requests, joint admission control/resource allocation can be performed not at
one specific point of time but still in a joint manner in that failed
admission of one service flow can affect the corresponding actions on already
established and to-be-established service flows in the same service flow
group.
Figure 6.65.3-1: Setting up an AF session with required QoS procedure
1\. The AF sends single (1a) or separate (1b) requests to reserve resources
for an AF session using an extended Nnef_AFsessionWithQoS_Create request
message (AF Identifier, one or multiple UE identifiers, Flow description(s),
QoS reference, (optional) Alternative Service Requirements (containing one or
more QoS reference parameters in a prioritized order and the order of QoS
reference parameters is used as association relationship between QoS reference
parameters of different service flow), service flow coordination group ID,
group level treatment requirements to the NEF.
NOTE: The UE identifier could be UE IP address or GPSI.
The group level treatment requirements may include joint admission and joint
QoS fulfilment policy for the flows in the group. The policy can indicate that
the admission and/or QoS fulfilment is to be failed if it fails for any or
certain percentage of the flows in the group or any of the flows in the group
indicated as critical or choosing AQP for each QoS flow coordinately based on
the order of AQPs of different QoS flows.
The group level treatment requirements may include synchronized delivery
requirement for flows in the group.
2\. NEF performs authorization of the single or separate AF requests. It
continues with step 3 if the request is authorized and continues with step 5
is the request is not authorized.
3\. The NEF discovers the PCF and interacts with the PCF by triggering single
or separate Npcf_PolicyAuthorization_Create requests for the UE(s) included in
the AF\'s request. In the request to the PCF the NEF provides AF Identifier,
UE address(es), Flow description(s), the QoS reference, and the optional
Alternative Service Requirements (containing one or more QoS reference
parameters in a prioritized order and the order of QoS reference parameters is
used as association relationship between QoS reference parameters of different
service flow), service flow coordination group ID, and group level treatment
requirements. PCF uses this information to issue policy rules for the service
flows in the request together. PCF also uses this information to check if
there is already established service flows using the same service flow
coordination group ID, in which case PCF treats the received request together
with the existing policy rules for the service flow coordination group.
4\. PCF responses to NEF whether the group level policy is authorized or not.
5\. NEF responses to AF whether the request is granted or not.
#### 6.65.3.2 Procedure to distribute coordination group ID and group level
treatment policy in 5GS
PCF derives the group level treatment policy for each service flow
coordination group based on the group level treatment requirements from the
application, and SMF maps the service flow coordination group to QoS flow
coordination group in the 5GS. Each service flow in a service flow group
should be treated as individual QoS flow without aggregation.
PCF distributes the service flow coordination group ID and group level
treatment policy in 5GS using the following procedure. SMF is responsible for
providing the information to individual RAN Nodes with the PDU Session
modification procedure, which is separate for each UE or PDU Session involved.
Figure 6.65.3-2: Coordinated delivery of multiple QoS flows
1\. PCF provides service flow coordination group ID and group level treatment
policy to SMF using the existing session management policy association
procedure (e.g. SMF policy association modification procedure). This happens
with a separate procedure for each PDU session using the flow coordination
group ID as a correlator that allows SMF to combine all the policies.
2\. If the PCC rule contains a service flow coordination group ID, SMF binds
the PCC rule to separate QoS Flows and no other PCC rule is bound to this QoS
Flow. 3.-4. SMF provides QoS flow coordination group ID, QoS profile,
Alternative QoS Profile (including association relationship information with
AQPs of other QoS flows in the group) and group level treatment policy further
to RAN via AMF as part of session management information per UE using the
existing single PDU session modification procedure.
For QoS alignment and joint QoS fulfilment policy, it is enough if RAN gets
the information of each QoS flow in the group independently.
5\. RAN used the information provided by SMF to apply admission control.
6-7. RAN sets up the AN resource and update the session context accordingly.
8\. RAN use the informatio provided by SMF to apply QoS fullfillment.
9\. RAN sends notification via QoS Parameter Notification Control. And SMF/PCF
adjusts QoS parameters for other flows in the group based on group level
treatment policy.
For multiple UE case: Based on the newly selected QoS parameter from received
from QoS Parameter Notification Control, AF/PCF/SMF adjusting QoS parameters
or release service flows for other UEs via the procedure defined in clauses
6.65.3.1 and 6.65.3.2.
According to the above procedures, the RAN/SMF/PCF can identify the QoS flows
in the same QoS flow coordination group and apply the group level treatment
policy, e.g. AQP level alignment to ensure synchronized delivery, joint QoS
fulfilment, joint admission control/resource allocation among the QoS flows.
#### 6.65.3.3 Procedure to handle group level treatment requirements in RAN
Group level treatment requirements (joint admission control, joint QoS
fulfilment, AQP level alignment) can be performed at SMF/PCF for a single or
multiple UEs. In the former case, PCF can notify AF on the received result
whereas in the latter case, SMF can make PDU session management decisions
according to the notification from RAN and PCF can decide on group level
treatment policy update to be applied by the RAN in addition to notifying AF.
\- RAN performs admission control for each received PDU session modification
request following the current procedures assisted by the flow group treatment
policy information.
In case one or more of the QoS flows cannot fulfil its QoS requirements, based
on communication with SMF/PCF/AF and assisted by the flow group treatment
policy information, PDU session modification with QoS flow modification or
termination can be performed.
#### 6.65.3.4 Procedure to provide RAN additional information about all QoS
flows to be considered for joint admission
As depicted in the procedures in clauses 6.65.3.1, 6.65.3.2 and 6.65.3.3, it
is possible for 5GS to enforce a joint admission control policy for service
flows requested by an AF with a common flow group coordination ID by handling
and admitting them one by one until a new critical flow cannot be admitted, at
which point 5GS can release (or lower the retention priority) for the flows
within the same group admitted earlier.
This requires that the AF requests the service flows from the 5GS together.
This can be done either by placing them all within a single request (as in
clause 6.65.3.1 option 1a) or within a batch of separate but correlated
requests (as in clause 6.65.3.1 option 1b). The AF must perform the request
batch within a specific narrow time window, in practice as back-to-back
requests. The requests in the batch need a further correlation ID beyond just
the flow group coordination ID. This new correlation ID is called the batch
correlation ID and it also includes the information of how many requests or
service flows the full batch contains. This allows the receiving NF to be able
to know when it has received the full batch of requests or flows.
For the procedure in clause 6.65.3.1 this requires for the multiple request
option between AF and NEF and NEF and PCF the additional of the batch
correlation ID and the information or the number of requests or service flows
within the batch. The receiving NF, i.e. NEF or PCF, respectively, does not
proceed until it has received all the requests or service flows in the batch,
or fails the requests if it does not receive all of them within a specific
time.
For the procedure in clause 6.65.3.2 this requires a similar batch correlation
ID and information about the number of requests or service flows between the
PCF and SMF. SMF does not proceed with PDU Session modifications until it has
received the full batch or fails the requests if it does not receive all of
them within a specific time.
After receiving the full batch, the SMF determines how many QoS flow additions
or modifications per each RAN Node the batch contains. When issuing the PDU
Session modification requests towards each RAN Node, the SMF includes in each
request in addition to the flow group coordination ID and the flow group level
treatment policy (which indicates if a certain flow is critical for admission)
and the total number of critical QoS flows as a new parameter.
NOTE: Separate batch coordination IDs and request or flow counters between AF
and NEF, NEF and PCF, and PCF and SMF are needed in the general case that
multiple PCFs and SMFs may be supported for a flow coordination group,
otherwise the same batch ID and information can be carried even all the way
from AF to SMF. Also, only if it is assumed that UEs involved in the flow
coordination group can be served by different RAN Nodes, the SMF needs to
determine the number of critical QoS flows per RAN Node, otherwise the
information provided by PCF (or even AF) can be directly used.
If a new critical service flow is added to the flow coordination group by the
AF at a later stage, it would not share the same batch correlation ID and
would be handled according to the default procedure in clause 6.65.3.2.
### 6.65.4 Impacts on services, entities and interfaces
AF:
\- Uses extended Nnef_AFSessionWithQoS API to provide group level treatment
requirements to a group of flows. The flow grouping is indicated by a unique
flow group coordination ID. The extended API allows AF to request a QoS
reservation for a group of service data flows across multiple UEs and ask
group level treatment policies such as joint admission and joint QoS
fulfilment for them. AF is provided results of the requests on the level of
the whole group.
\- Handling of joint admission with knowledge of all critical flows requires
AF to provide all requests to NEF with service flows subject to joint
admission in a single request or in a batch of correlated requests.
NEF:
\- Supports extended Nnef_AFSessionWithQoS API to provide group level
treatment requirements to a group of flows. The flow grouping is indicated by
a unique QoS flow group coordination ID. Provides the group level treatment
policy and the QoS flow group coordination ID to PCF.
\- Handling of joint admission with knowledge of all critical flows requires
NEF to provide all requests with service flows subject to joint admission to
PCF in a single request or in a batch of correlated requests.
PCF:
\- Supports and enforces group level treatment policy for the group of flows
sharing the same QoS flow group coordination ID. Provides information about
the group level treatment policy to SMF, and via SMF to RAN. Adjust QoS
parameters for flows in the group according to group level treatment policy.
\- Handling of joint admission with knowledge of all critical flows requires
PCF to provide all policy updates with service flows subject to joint
admission to SMF in a in a batch of correlated updates.
SMF:
\- Provides the QoS flow group coordination ID , group level treatment policy
to RAN. Adjust QoS parameters for flows in the group according to group level
treatment policy.
\- Handling of joint admission with knowledge of all critical flows requires
SMF to determine the total number of critical QoS flows within QoS flow
coordination group per RAN Node and provide the total number critical QoS
flows to RAN.
RAN:
\- Reception of new IE.
No impacts to UE, UPF.
## 6.66 Solution #66: multi-modality support
### 6.66.1 Key Issue mapping
This solution addresses Key Issue #1 and #2.
### 6.66.2 Description
Considering single or multiple UE(s) works for an XR application, for multi-
modality communication the 5G system should support sufficiently small
difference of delay among on transmission from UPF to the single or multiple
UE(s) (especially service flow of UE for an XR application) so that the media
level in UE(s) can works well to a user for multi-modality communication.
So if XR service flows to the user are delivered to each corresponding UE(s)
at a similar time (i.e. delay difference between the XR service flows to the
UE(s) is less than a threshold), the user may enjoy multi-modality
communication via the UE(s)\' media level operation.
For multiple UEs scenario it is assumed that a single UPF and a single NG-RAN
is taken which implies same data path for XR data flows in 5GS and better for
keeping sufficiently small delay difference.
### 6.66.3 Procedures
#### 6.66.3.1 General
When SM NAS procedures are performed the existing 5QI-based QoS policies are
applied. In order to support multi-modality communication, NG-RAN and UPF may
schedule the packet delivery based on the SMF\'s enforcement, which follows
the multi-modality QoS policies, as the system fulfills the requirement of
delay difference among XR dedicated QFIs of UE(s).
NOTE: The delay difference is introduced some new QoS policy to solve
correlated requirements among XR dedicated QFIs of UE(s).
And, based on the DNN and S-NSSAI dedicated to an XR service, same SMF and UPF
are selected for the UE(s) during PDU session establishment which the user
enjoys the XR service by.
Editor\'s note: Whether and how to guarantee the same SMF and UPF can be
selected or reselected for the group UE(s) of the XRM service is FFS.
#### 6.66.3.2 PDU session establish procedures for multi-modality
communication
Figure 6.66.3.2-1: PDU session establish procedures for multi-modality
communication for multiple UE situation
The procedures are shown simultaneous for multiple UEs (UE1 and UE2), which,
if not mentioned, basically follows clause 4.3.2.2 of TS 23.502 [3]:
1\. UE1 and UE2 register AF/AS for an XR service. As a pre-configuration,
AF/AS assigns an AF specific service flow group ID between UE1 and UE2, which
implies that the UE1 and UE2 are associated between service flows for the XR
application.
2\. For the AF specific service flow group ID multi-modality QoS policy
information is stored or provisioned in PCF(or UDR) for UE1 and UE2, which can
be done by some QoS specific provisioning from AF solutions.
At step 2 In case the multi-modality policy information is provisioned in PCF,
step 3\~7 are replaced for UE1 and UE2 with step 6a SM policy association
update procedures.
3\. When UE1 requests PDU session establishment, it includes XR/media
associated DNN and S-NSSAI, which may be standardized or determined by the
operator.
4-5. AMF selects a dedicated SMF based on requested XR/media associated DNN
and S-NSSAI. SMF receives PDU session establishment.
6\. If dynamic PCC is applied, PCC rules including multi-modality QoS policy
information for the AF specific service flow group ID are provided to SMF
based on AF specific GPSIs. Otherwise, the SMF may apply local policy for
multi-modality QoS policy information, which can be delivered to UE1. Multi-
modality QoS policy information contain a required threshold of delay
difference between the AF specific service flow group ID.
6a. When the PCC rule is updated by provisioning from AF, the corresponding
multi-modality QoS policy information for the paired service flows (or AF
specific service flow group ID) are updated to SMF. and PDU session
modification procedure is triggered for UE1 and UE2.
7\. The SMF selects an UPF for UE1.
8\. The SMF may send an N4 Session Establishment/Modification Request to the
UPF to meet multi-modality QoS requirements e.g. the AF specific service flow
group ID.
9\. SMF provides NG-RAN with N2 SM information to meet multi-modality QoS
requirements e.g. the AF specific service flow group ID.
10-11. The remaining PDU session establishment/modification procedures are
performed. NG-RAN and UPF schedule the packet delivery not to exceed the delay
difference between the paired QFIs of UE1 and UE2.
Another UE2 performs PDU session establishment request procedure, which are
same as UE1 step 3\~12 except for step 3a, 4a and 7a in place of step 3, 4 and
7.
3a. UE2 requests PDU session establishment as same as step 3.
4a. The same SMF is selected for UE2\'s PDU session for XR service of the XR
application based on requested XR/media associated DNN and S-NSSAI.
7a. SMF selects the same UPF for UE2 as UE1 based in the AF specific service
flow group ID.
13\. When the SMF recognizes the UE1 and UE2 belong to the AF specific service
flow group ID, it should confirm the UEs are in the same NG-RAN. So the SMF
sends multi-modality indication to AMF with together UE1 ID and UE2 ID.
14\. Receiving the multi-modality indication from the SMF, the AMF may confirm
whether UE1 and UE2 are in the same NG-RAN. If not, the AMF trigger
redirection or handover of UE2 into UE1\'s NG-RAN, where the triggering
message to UE2\'s NG-RAN may contain UE2 ID and Cell ID of UE1\'s NG-RAN and
multi-modality indication.
NOTE: It can be assumed that the UEs belonging to the AF specific service flow
ID can be moved in the same NG-RAN and AMF because the UEs are near enough.
15\. When the AMF confirms that UE1 and UE2 are in the same NG-RAN, it may
notify the SMF of multi-modality ready (i.e. UEs of AF specific service flow
group ID are in the same NG-RAN). And SMF may update N4 session accordingly.
Figure 6.66.3.2-2: PDU session establish procedures for multi-modality
communication for single UE situation
The procedures are shown simultaneous for single UE, which, if not mentioned,
basically follows clause 4.3.2.2 of TS 23.502 [3]:
1\. XR application clients of a UE register AF/AS. As a pre-configuration,
AF/AS obtains a paired service flows info between XR application clients or
assign an AF specific service flow group ID for XR application clients, which
implies that the XR application clients are associated between service flows
for clients of the XR application.
2\. For the paired service flows(or AF specific service flow group ID) multi-
modality QoS policy information is stored or provisioned in PCF(or UDR) per
UE, which can be done by some QoS specific provisioning from AF solutions.
At step 2, If the multi-modality policy information is provisioned in PCF,
step 3\~6 are replaced with step 6a SM policy association update procedures.
3\. When UE requests PDU session establishment, it includes XR/media dedicated
DNN and S-NSSAI, which may be standardized or determined by the operator.
4-6. AMF select a dedicated SMF based on requested XR/media-associated DNN and
S-NSSAI. SMF receives PDU session establishment.
6\. If dynamic PCC is applied PCC rules including multi-modality QoS policy
information for the paired service flows(or AF specific service flow group ID)
are provisioned to SMF. Otherwise, the SMF may apply local policy for multi-
modality QoS policy information, which can be delivered to UE. multi-modality
QoS policy information contain a required threshold of delay difference
between the paired service flows(or AF specific service flow group ID).
6a. When the PCC rule is updated by provisioning from AF, the corresponding
multi-modality QoS policy information for the paired service flows(or AF
specific service flow group ID) are updated to SMF. and PDU session
modification procedure is triggered.
7\. The SMF may send an N4 Session Establishment/Modification Request to the
UPF in order to meet multi-modality QoS requirements e.g. the AF specific
service flow group ID.
8\. SMF provides NG-RAN with N2 SM information to meet multi-modality QoS
requirements e.g. a the AF specific service flow group ID.
10a/b. NG-RAN and UPF schedule the packet delivery not to exceed the delay
difference between the paired QFIs, which is up to implementation.
### 6.66.4 Impacts on services, entities and interfaces
The followings are additionally required:
PCF:
\- Store and provide PCC rule including multi-modality QoS policy between XR
service flows of multiple UEs to SMF.
AMF:
\- Based on SMF request, let the multiple UEs stay in the same NG-RAN.
SMF:
\- Provide QoS information to UPF and NG-RAN node to meet an multi-modality
QoS requirement e.g. AF specific service flow group ID.
\- Request AMF to let the multiple UEs stay in the same NG-RAN.
\- Select a same UPF for PDU sessions of multiple UEs for XR service.
UPF:
\- Enforcement of XR service flows(dedicated to QFI) as SMF\'s request e.g. AF
specific service flow group ID, and how to enforce is implementation specific.
NG-RAN:
\- Enforcement of XR service flows(dedicated to QFI) as SMF\'s request e.g. AF
specific service flow group ID, and how to enforce is implementation specific.
## 6.67 Solution #67: Supporting ECN mark for L4S in 5GS for XR/media
Enhancements
### 6.67.1 Key Issue mapping
The solution addresses Key Issue #3: 5GS information exposure for XR/media
Enhancements.
### 6.67.2 Description
The ECN mark for L4S technology has been describe in Sol#41,#43 and#46. There
are some differences between the three solutions but the main idea is the same
that introducing ECN bits in the 5GS to indicate the node congestion happen.
While some aspects should be further clarified.
**1) PCF enhancement**
When AF provides QoS parameters requirement for specific XR/media traffic, the
request for utilizing ECN mark for L4S can also be included. AF may also
provide ECN marking for L4S instruction information e.g. support for adapting
data rate based on ECN marking for L4S. PCF can generate corresponding policy
based on these instruction information, and send the policy to RAN or UPF to
help the ECN marking.
**2) 5G Mobility consideration**
During NG Handover, if the target NG-RAN is no longer congested, it can stop
marking ECN for L4S and the application may start to gradually increase the
data rate.
### 6.67.3 Impacts on services, entities and interfaces
AF:
\- Provide ECN marking for L4S instruction information e.g. support for
adapting data rate based on ECN marking for L4S.
PCF:
\- Generate corresponding policy based on AF instruction information, and send
the policy to SMF and RAN or UPF to help the ECN marking for L4S.
## 6.68 Solution #68: PDU set handling enhancements for different kinds of
packets
### 6.68.1 Key Issue mapping
This solution can apply to key issue 4.
### 6.68.2 Description
In this key issue, it is proposed to identify the PDU set for a group of
packets which have dependency and closer relationship. However, within the
service data flow, there could be several types of traffic data, e.g. video
frame data, audio data, haptic data, etc. For each kind of traffic data, the
handling requirements may be different. The following examples are the
possible implementations of the PDU set.
\- For the audio data, one PDU set could include several or all the packets of
the audio data. If certain packets are lost, others audio packets within the
PDU set may not be impacted.
\- For the video data, one PDU set could include one I frame and the P frames
based on this I frame. If the certain percent of packets are lost, other
packets within the PDU set may also be impacted.
\- For the video data, another implementation of PDU set is that the packets
of one I frame could form one PDU set, and the packets of one P frame could
form one PDU set. So each of the I frame or P frame could form different PDU
sets. PDU set of I frame and PDU set of P frame could be different PDU set
types. In this case, the handling requirement of different PDU set type could
be different.
There may be other implementations of the PDU set. In order to support
different handling requirements on different kinds of PDU sets, it is proposed
to have the following identification of the PDU set within the network. The
following figure shows the possible different implementations of the PDU set
within the service data flow.
Figure 6.68.1-1: Examples of PDU Sets
Within the service data flow, there could be different types of PDU sets. Each
type of PDU set could have different features and handling requirements in the
network. So the marking and identification of the PDU set could at least
include the following parameters:
\- **PDU Set type.** This is optional to identify the type of the PDU set to
which a certain PDU belongs. If there is only one type of PDU Set within the
service data flow, there is no need to add this parameter. If there are more
than one type of PDU set within the service data flow, this parameter is
needed to differentiate the type of the PDU set. Each PDU could belong to at
most one PDU Set type. The PDU Set type is added to each PDU header if needed.
\- **PDU Set Identifier (PSID)**. This is necessary to identify to which PDU
Set a certain PDU belongs. The PSID needs to be added to each PDU header.
\- **PDU sequence number within the PDU Set**. This is used to identify the
position of each received PDU within the PDU Set. It can help to identify when
the PDU Set begins and the order of the PDUs within the PDU Set. It is
optionally added to each PDU header.
In this case, if there are more than one PDU Set type within the service data
flow, one PDU set can only belong to one PDU Set type. So one PDU can only
belong to one PDU set with one PDU Set type. Other parameters may also be
added in the GTP-U header to express the dependence or importance information
of the PDUs inter or intra the PDU set. How to identify the PDU Set type and
the related PDU Set marking information is decided in the PCF taking into
account of the AF request.
The handling requirements of the PDU set could be set differently for the PDU
Set types.
Editor\'s note: Whether RAN could support different PDU Set related QoS
parameters within one QoS flow is FFS.
NOTE: If certain parameters can\'t be differentiated for PDU Sets of different
PDU Set types, they are common to all PDU sets.
This solution is based on the current network exposure framework and QoS model
with the enhancements. The baseline procedure is proposed in the following
section.
### 6.68.3 Procedures
The PDU Set related handling information are added to the information provided
by AF according to the procedures in clauses 4.15.6.6 and 4.15.6.6a of TS
23.502 [3]. The PDU Set related handling information includes the PDU Set
identification information and related PDU Set handling requirements for
different PDU Set types.
The PCF could generate PCC rules based on the PDU Set related handling
information and sent it the SMF using the PCF initiated SM Policy Association
Modification procedure in clause 4.16.5.2 of TS 23.502 [3]. The SMF then
performs network requested PDU Session Modification procedure as specified in
clause 4.3.3 of TS 23.502 [3].
As part of this procedure, SMF generates a QoS profile including the PDU set
internal header information and the PDU Set related handling requirements for
the PDU Set types. Furthermore, SMF configures the UPF with filtering
information to identify and mark the PDU Sets for PDU Set types.
### 6.68.4 Impacts on services, entities and interfaces
AF:
\- Send the PDU Set related handling information to the 5GS including the PDU
Set identification information and related PDU Set handling requirements for
different PDU Set types.
NEF:
\- Interaction with AF to receive the PDU set handling information.
PCF:
\- Generation of the PCC rules related with PDU set.
SMF:
\- Generate and send the N4 session management parameters related with PDU set
to the UPF to identify and mark the PDU set for PDU Set types;
\- Generate and send the QoS profile related with PDU set handling parameters
(PDU set internal header information, PDU Set related handling requirements
for the PDU Set types).
PSA UPF:
\- Receive the N4 session management parameters related with PDU set from SMF
to identify and mark the PDU Set for the PDU Set types.
RAN:
\- Receive and enforce the QoS profile including the PDU set handling
parameters (PDU set internal header information, PDU Set related handling
requirements for the PDU Set types).
## 6.69 Solution #69: PDU set handling capability of RAN node
### 6.69.1 Key Issue mapping
This solution is for Key Issue #4 and #5, which addresses PDU set integrated
packet handling and differentiated QoS handling.
### 6.69.2 Description
PDU set handling for XR traffic requests new user plane handling capability on
UPF and RAN node. That is, UPF needs to identify PDUs of PDU set and deliver
PDU set related information to RAN node over user plane, which impose heavy
burden on UPF. Besides, RAN node needs to identify PDUs of PDU set based on
the PDU set related information provided by UPF over user plane, and perform
PDU set integrated handling and differentiated QoS handling. In solution#57,
negotiation of PDU set and/or burst marking mechanisms between AF and CN. The
solution requires UPF to perform NF registration with NRF by indicating its
capability for PDU sets marking (e.g. no marking, RTP for PDU set marking
and/or burst marking). SMF performs NF discovery with NRF by querying the PDU
sets and bursts marking option.
It assumes that UPF supports PDU set identification and marking in this
solution. SMF shall also obtain the PDU set handling capability of RAN node to
better configure UPF. That is, if RAN node supports PDU set handling, the UPF
shall perform PDU set identification and marking. Otherwise, UPF shall not
perform PDU set identification and marking.
Generally, consumer NF shall perform NF discovery with NRF by querying
specific capability within 5GC. However, RAN node is not part of 5GC, which is
not able to perform NF registration with NRF by indicating its capability.
Take the existing MBS scheme as an example, RAN node provides SMF the MBS
support indicator upon receiving MBS session ID in PDU session modification
request. For handover case, SMF infers MBS capability of RAN node from the
presence/absence of an \"MBS-support\" indication in the Path Switch Request
message (Xn handover) or Handover Request Acknowledge message (NG handover)
In this solution, similar solution as proposed in MBS scheme is considered for
SMF to obtain PDU set handling capability of RAN node in both PDU session
establish/modification and handover case.
### 6.69.3 Procedures
#### 6.69.3.1 Notification upon PDU session establishment procedure
Figure 6.69.3.1-1: Notification upon PDU Session Establishment procedure
In this case, it is assumed that SMF obtains XR-specific information (e.g. PDU
set based QoS parameters) upon PDU session establishment.
In step 11-12, SMF provides RAN node with the N2 SM information, which
contains XR-specific information.
In step 13, AN-specific resource is setup for PDU session.
In step 14-15, if RAN node supports PDU set handling, it provides SMF with N2
SM information which contains PDU set handling (PSH) support indicator.
Otherwise, no \"PSH-support\" indicator included.
In step 16a, if RAN node supports PDU set handling, SMF configures UPF to
perform PDU set handling by providing PDU set handling indicator (i.e. PSH
indicator) or set PSH indicator to true. Otherwise, no PSH indicator is
provided or PSH indicator is set to false.
In step 16b, UPF responds with N4 session modification response.
If SMF obtains XR configuration information after PDU session establishment,
then SMF shall trigger PDU session modification procedure to provide XR
configuration information to RAN node, and RAN node shall response with \"PSH-
support\" indicator if it supports PSH.
#### 6.69.3.2 Notification upon handover
Figure 6.69.3.2-1: Notification upon Handover procedure
Step 1, source RAN node requests for handover and target node responds.
Step 2, if target RAN node supports PDU set handling, it includes \"PSH-
support\" indicator in Path switch request message. Otherwise, no \"PSH-
support\" indicator exists.
Step 3, SMF determines whether PDU set handling capability has been changed
from source RAN node to target RAN node.
Step 4a, SMF triggers N4 session modification procedure. There\'re three cases
as follows:
\- Case 1: for mobility from an PSH-supporting NG-RAN node to an PSH non-
supporting NG-RAN node, the SMF infers from the absence of an \"PSH-support\"
indication in the Path Switch Request that PDU set handling will not be
performed by target RAN node. SMF shall inform UPF not to perform PDU set
identification and marking for the target NG-RAN node. If data forwarding is
applied, the source NG-RAN node infers from the absence of an \"PSH-support\"
indication in the Handover Request Acknowledge message that the target NG-RAN
node does not support PSH. The source NG-RAN node may be aware that the target
NG-RAN node is non-PSH supporting already before Handover Preparation. The
source NG-RAN node shall not mark the PDU set in GTP-U header over Xn
interface when performinig data forwarding.
\- Case 2: for mobility from PSH non-supporting NG-RAN node to PSH-supporting
NG-RAN node, SMF infers from the presence of the \"PSH-support\" indicator in
the Path Switch Request message that PDU set handling\@UPF shall be activated.
SMF triggers UPF to perform PDU set handling.
\- Case 3: PDU set handling capability does not change from source RAN node to
target RAN node. The PDU set handing remains the same in UPF.
For NG based handover, SMF infers from the presence/absence of the \"PSH-
support\" indicator in Handover Request Acknowledge message and informs UPF to
activate/deactivate PDU set handling accordingly.
### 6.69.4 Impacts on services, entities and interfaces
The proposed solution is based on Rel-17 procedures but some enhancements may
be needed to make it possible for the 5GS to know the PDU set handing
capability of RAN node, such as:
SMF:
\- Configure UPF to perform PDU set handling or not based on the
presence/absence of \"PSH-support\" indicator in PDU session Resource
setup/modification response.
\- Configure UPF to activate/deactivate PDU set handling based on the
presence/absence of \"PSH-support\" indicator in Path Switch Request (Xn
handover) or Handover Request Acknowledge message (NG handover) if the PDU set
handing capabilty has been changed.
RAN node:
\- Include \"PSH-support\" indication in N2 SM information upon receiving XR-
specific information during PDU session establishment/modificaiton procedure.
\- Include \"PSH-support\" indicator in Path Switch Request (Xn handover) or
Handover Request Acknowledge message (NG handover).
NOTE: Interworking with RAN WG is needed.
## 6.70 Solution #70: PDU Set with FEC Data
### 6.70.1 Key Issue mapping
This solution is an add-on solution for KI#4 and KI#5 that only addresses the
aspect of optimizing delivery of PDU Set that contains application layer FEC
Data.
#### 6.70.2.1 PDU-Set information
This solution provides NG-RAN with information about the boundary between the
allocation layer payload data and the application layer FEC data within a PDU
Set.
The following information element is included in the UPF generated PDU Set
metadata sent to the RAN:
\- PDU Set payload size (expressed in number of PDUs). This parameter is used
to identify which part of the PDU Set that contains PDU Set payload data. If
all the PDU Set payload data PDUs has successfully been delivered to the UE
then RAN may avoid sending the remaining PDUs since they only contains FEC
data.
#### 6.70.2.2 New QoS parameter
FEC PDU Set:
\- NG-RAN is expected to use PDU Set payload size and avoid sending the
remaining PDUs belong to a PDU Set when all the PDUs of the PDU Set that
contains the payload data has been successfully delivered to the UE in time.
### 6.70.3 Impacts on services, entities and interfaces
RAN:
\- Perform optimization and avoid deliver PDUs that contains FEC data when
they are not needed.
NOTE: The details of RAN behaviour is up to RAN WGs.
## 6.71 Solution #71: RT latency fulfilment based on UL/DL AQP Adaptation
### 6.71.1 Key Issue mapping
The solution applies to Key Issue #6 Uplink-downlink transmission coordination
to meet Round-Trip latency requirements.
### 6.71.2 Description
For real-time XRM services, it is essential for 5G system to provide the RT
(Round-Trip) latency guarantee for better user experience. Therefore, how to
meet the very low RT latency requirements in 5GS needs further study.
Similar to current discussions for KI#1, this solution intends re-use the
basic idea of coordinated QoS adjustments for group of QoS flows. In Sol#X
(S2-2206329) for KI#1, RAN may adjust QoS profiles based on the Alternative
QoS Profiles for the group of QoS flows in case of one of the QoS flow in the
group is upgraded/downgraded to the QoS profile or an AQP level. In this
solution, RAN receives the Alternative QoS Profiles for both the UL and DL QoS
flows and adjusts the UL/DL QoS Profiles when the RT latency requirements are
not fulfilled.
The solution is based on the existing QoS model and policy framework with the
following enhancements and special configurations:
\- The AF provides RT latency requirement to the PCF directly or via NEF.
\- Based on the RT latency requirement, the PCF generates alternative QoS
parameter sets for both the UL and DL QoS flows and also a QoS correlation
indication. The UL and DL QoS flows carry the UL and DL data traffic for the
XRM service respectively. The UL/DL PDB(s) in the alternative QoS parameter
sets don\'t exceed the RT latency requirement, and the sum of largest PDB in
the alternative QoS parameter set of one QoS Flow and the smallest PDB in the
alternative QoS parameter set of another QoS Flow also doesn\'t exceed the RT
latency requirement.
\- SMF generates alternative QoS Profiles for both the UL and DL QoS flows and
sends them to RAN together with the RT latency requirement and the QoS
correlation indication.
\- Based on the monitored latencies, RAN can locally choose the QoS Profile(s)
with proper UL/DL PDBs for the UL/DL QoS flows to fulfil the RT latency
requirement.
### 6.71.3 Procedures
Figure 6.71.3-1: Setting up an AF session with required QoS procedure meeting
RT latency requirement
1\. The AF provides RT latency requirement to the NEF using
Nnef_AFsessionWithQoS_Create request.
2\. The NEF performs authorization of the AF request. If the request is
authorized, the NEF provides the RT latency requirement to PCF by invoking the
Npcf_PolicyAuthorization_Create request. Otherwise, NEF responses to AF that
the request is not authorized and the procedure stops.
3\. Based on the RT latency requirement from AF, the PCF generates the
alternative QoS Parameter Sets for both the UL and DL QoS flows. Besides, a
QoS correlation indication is generated for the UL and DL QoS flows for the
target XRM service.
4\. The PCF sends the PCC rules to SMF together with the RT latency
requirements and the QoS binding indication. SMF generates the Alternative QoS
Profiles based on the PCC rules for both UL and DL QoS flows and sends them to
RAN with RT latency requirements and QoS binding indication.
5\. Based on the monitored latencies of the UL/DL QoS Flows, RAN will check if
the sum of UL and DL latency can fulfil the RT latency requirements. If not,
RAN will choose the proper QoS profiles with proper UL/DL PDBs based on the
Alternative QoS Profiles for the UL/DL QoS flows to make sure that the
adjusted sum of UL and DL PDBs will not exceed the RT latency requirements.
6\. RAN reports to PCF via SMF using QoS Notification Control procedure about
the change of the both UL/DL PDBs of the two QoS Flows.
### 6.71.4 Impacts on services, entities and interfaces
AF:
\- Provide RT latency requirement to the PCF (directly or via NEF).
PCF:
\- Generate Alternative QoS Parameter Sets for both the UL and DL QoS flows.
\- Send the PCC rules to SMF together with the RT latency requirements and QoS
correlation indication.
RAN:
\- Choose the proper QoS profiles for the UL/DL QoS flows based on the
monitored UL/DL latency and the RT requirements.
\- Report to PCF via SMF using QoS Notification Control procedure about the
change of the both UL/DL PDBs of the two QoS Flows.
## 6.72 Solution #72: Improvements to jitter range assistance information to
RAN for configuring CDRX
### 6.72.1 Key Issue mapping
This solution is for Key Issue #8, \"Enhancements to power savings for XR
services\" and specifically proposes an improvement to the assistance provided
to the RAN for enhancing CDRX. This solution can be used as standalone or can
complement other solutions for this key issue where jitter is identified as a
possible assistance parameter.
### 6.72.2 Description
This solution applies to XR services characterised by a periodicity of data
transmission (e.g. video frame rate). This periodicity can be exploited in the
RAN to set an appropriate CDRX cycle and CDRX settings yielding power saving
in the UE.
The periodicity of the data transmission can be exploited to reduce the time
the UE receiver is active (\"on-duration\"), specifically the receiver is
activated at the expected arrival time of the first packet and switched off
when the last packet is received. When the data provided to the base station
is affected by jitter, the arrival time of data at the UE is no longer ideal,
and configuration of CDRX based on ideal arrival time causes two impacts. The
UE may activate the receiver before data is present causing unnecessary power
consumption and could power down the receiver before all the data for the
period has been received causing the need for re-transmission with negative
impact on the user experience.
This solution proposes to address both the issues caused by jitter by sending
the RAN three parameters to characterise the jitter and assist the RAN in
optimising the CDRX on-duration:
\- Overall jitter range. The overall jitter range is an estimate of the
maximum and minimum value of the jitter observed for the whole service
duration. This parameter can be used to ensure that all the transmitted data
of the period is received.
\- Local jitter average. The local jitter average is a measure of the mean
value of the jitter calculated over a few XR service periods.
\- Local jitter range. The local jitter range is the observed fluctuation of
the jitter around the local jitter average. This parameter can be used in
combination with the local jitter average to optimise the start of the on-
duration within the CDRX cycle.
The overall jitter range and local jitter range can be considered properties
of the connection between application server and 5GC and therefore not
expected to change substantially during the service duration. The Local jitter
average on the other hand is expected to vary, albeit slowly.
1\. During PDU Session Establishment/Modification procedure, SMF determines
the overall jitter range and the local jitter range and delivers it to the
RAN.
a) Overall jitter range and local jitter range are expected to be relatively
static and their initial value may be based on historical data collected for
the particular application server.
b) The local jitter average is calculated dynamically during the service
rendering.
2\. The RAN can configure and enable the CDRX based on the overall jitter
range, the local jitter range and the local jitter average.
NOTE: How jitter statistics are used for the configuration of CDRX is
determined by RAN WGs.
3\. The 5GC keeps track of the jitter and uses the data to provide updates to
the RAN when necessary.
### 6.72.3 Procedures
#### 6.72.3.1 Jitter range initial configuration
Figure 6.72.3.1-1 shows how 5GS provides initial overall jitter range and
local jitter range to RAN for CDRX configuration with the optional support of
NWDAF.
Figure 6.72.3.1-1: initial configuration for overall jitter range and frame
jitter range
1\. During PDU Session Establishment/Modification procedure for XR service,
SMF determines the overall jitter range, the local jitter range and the local
average jitter and delivers it to the RAN via N2 SM message
The SMF can determine overall jitter range and the local jitter based on the
historical data of the XR Application, UE location and time, or gets overall
jitter range and the local jitter ranges corresponding to the SMF from NWDAF.
2\. Based on the overall jitter range and local jitter range, the RAN
configures the CDRX. For example, RAN may set the CDRX cycle length based on
the traffic periodicity and within the cycle set the on-duration based on
overall jitter range and PDCCH monitor position based on the local jitter
average and range.
#### 6.72.3.2 Jitter range update configuration
Figure 6.72.3.2-1: Real time update of jitter parameters to the RAN
The SMF may update local jitter statistics based on the real time data. The
SMF may use a moving window of N periods to estimate the local jitter average.
When the difference between the estimated local jitter average and the last
local jitter range provided to the RAN is greater than a given threshold, the
SMF sends the updated local jitter average to the RAN.
Figure 6.72.3.2-2: Real time update of jitter parameters to the RAN
Figure 6.72.2.1-2 illustrates how the UPF can provide jitter calculations to
the NWDAF in order to adjust the estimate of the overall jitter range and
local jitter range. The SMF may subscribe to the jitter analytics and request
updated values that can be sent to the RAN.
### 6.72.4 Impacts on services, entities and interfaces
SMF:
\- Generate or update the overall jitter range, local jitter range and send
them to RAN.
UPF:
\- collect and report the real time jitter to SMF.
RAN:
\- Receive the overall jitter range and frame jitter range.
NWDAF:
\- If used, a new analytics to calculate jitter statistics will need to be
defined.
## 6.73 Solution #73: Notification to XR AF of CDRX parameters reflecting
UE\'s CDRX preference
### 6.73.1 Key Issue mapping
This solution addresses Key Issue #8.
This solution describes how RAN can notify XR AF of CDRX parameters that the
RAN has determined mainly reflecting UE\'s CDRX preference, which implicitly
reflects UE battery level or preference for longer UE battery life, and not
directly adopting CDRX assistance information derived based on XR media
characteristic. This solution focuses on notification aspect from RAN via 5GC
to XR AF. With this solution, XR AF can consider changing e.g. codecs or data
rates to adapt to UE\'s power consumption concern.
### 6.73.2 Description
The current CDRX specification already allows UE to send its preference for
CDRX parameters to RAN and allows the RAN to determine reasonable CDRX
parameters and configure the UE with them. Now Key Issue #8 is studying CDRX
assistance information that 5GC derives based on XR media characteristic and
sends to RAN. This means RAN will end up considering information from 5GC as
well as from UE when determining CDRX parameters. A probable scenario is RAN
prioritizes information from UE. In this case, XR AF keeps sending media
stream with the same codec and data rate that do not fit to the determined
CDRX parameters, then CDRX gets less effective due to always using
InactivityTimer and QoE is also at risk of becoming lower. An approach to
solve this issue is to let XR AF know the determined CDRX parameters, so that
the XR AF can take any necessary actions in terms of adjusting e.g. codecs and
data rates.
The proposal is based on the following enhancements to the 5GS.
\- Notification from AMF via AM-PCF to AF. \"CDRX change\" is newly defined as
an access related PCRT between AMF and AM-PCF. Event reporting from AM-PCF to
AF now contains reporting about CDRX change.
\- Notification from RAN to AMF. AMF sets a \"CDRX change\" trigger condition
in the UE context in RAN by using an N2 message. When the \"CDRX change\"
trigger condition is met, RAN informs AMF by using an N2 message.
NOTE 1: The trigger in RAN is conceptually the same as PCRT that can be set in
AMF or SMF.
NOTE 2: RAN3 will decide exactly which N2 messages to use.
### 6.73.3 Procedures
The following figure represents a high-level procedure of the solution.
Figure 6.73.3-1: A high-level procedure
1\. XR AF sends either Npcf_AMPolicyAuthorization_Create (if the XR AF
provides XR media characteristic that leads to a CDRX assistance information
from 5GC), or Npcf_AMPolicyAuthorization_Subscribe (if the XR AF only
subscribes for the final CDRX values).
2-3. Steps 2 and 3 correspond to the AM Policy Association Establishment
procedure. \"CDRX change\" is newly defined as an access related PCRT between
AMF and AM-PCF.
4\. AMF sets the \"CDRX change\" PCRT condition in the AMF itself. AMF sends
to RAN an N2 message containing a trigger condition on \"CDRX change\". RAN
sets this trigger condition in the RAN itself.
NOTE: This trigger condition in RAN can be e.g. (i) any occasions that RAN
changes CDRX parameters, or (ii) any occasions that RAN changes CDRX
parameters in a manner not fulfilling CDRX assistance information that 5GC has
notified RAN before.
5-6. When the \"CDRX change\" trigger condition in RAN is met, RAN notifies
AMF of the occurrence of CDRX change and the updated CDRX parameters.
7-8. With the reception of the message in step 6, AMF considers the \"CDRX
change\" PCRT condition is met. AMF initiates the AM Policy Association
Modification procedure and notifies AM-PCF of the occurrence of CDRX change
and the updated CDRX parameters.
9\. AM-PCF further notifies XR AF of the occurrence of CDRX change and the
updated CDRX parameters. AM-PCF may map the updated CDRX parameters to
parameters that XR AF can understand.
### 6.73.4 Impacts on services, entities and interfaces
AF:
\- Npcf_AMPolicyAuthorization_Create and Npcf_AMPolicyAuthorization_Subscribe
are modified to enable subscription of notification about CDRX change.
AM-PCF:
\- \"CDRX change\" is defined as an access related PCRT.
\- Event reporting to AF about CDRX change with potential parameter mapping.
AMF:
\- \"CDRX change\" is defined as an access related PCRT.
\- AMF arms the \"CDRX change\" trigger condition in RAN.
RAN:
\- RAN is armed the \"CDRX change\" trigger condition by AMF.
\- RAN notifies AMF of the occurrence of CDRX change and the updated CDRX
parameters.
## 6.74 Solution #74: power mode based QoS adjustment
### 6.74.1 Key Issue mapping
This solution addresses Key Issue #9: trade-off of QoE and power saving
requirements.
### 6.74.2 Description
The intent of this solution is to propose a mechanism to assist PCF to adjust
the PCC rule based on the power mode currently selected by the user, and may
consider media codec. And thus, the trade-off between
throughput/latency/reliability and power consumption can be achieved.
It is assumed that the PCF can generate different PCC rules corresponding to
distinct power modes. Power mode could be power saving mode or ultimate
performance mode. Power mode can be determined by UE implementation or user
preference. For example, a UE is connected to a power supply or has sufficient
power, the ultimate performance mode may be applied. The UE informs PCF of the
ultimate performance mode, and then PCF generates corresponding QoS parameters
(e.g. high bitrates, low PDB), so that the user experience can be improved. On
the contrary, when the UE is disconnected from the power supply or the battery
is low, the power saving mode may be selected by the UE, and then the PCF
generates corresponding QoS parameters (e.g. low bitrates and high PDB), so
that the power consumption will be reduced and the available time of UE is
extended.
There are two alternatives to provide the power mode info to PCF:
\- UE reuses the existing PDU session establishment/modification procedure to
send the power mode info to SMF, and then SMF can forward such information to
PCF by initiating the SM establishment/modification procedure. UE is supposed
to report power mode info to SMF by UE implementation or based on network
policy e.g. event trigger, periodicity or network request.
\- UE sends the power mode info to the AF over the application layer, and then
the AF provides the power mode info to the PCF directly or via NEF. The power
mode info can be carried by the setting up an AF session with required QoS
procedure.
Either triggered by AF or by UE, PCF generates the PCC rules based on the
received power mode info. In addition, After PDU session establishment, and
application starts, AF may provide media codec information for specific
application to PCF. PCF can also consider the received media codec information
for PCC rule decision. Upon receiving the PCC rules, SMF performs the binding
of PCC rules to QoS flows, and provides QoS profile to RAN and QoS rule to UE.
PCF has the knowledge of current QoS parameters for specific traffic flow
corresponding to NG-RAN current QoS profile. If Alternative QoS profile method
is used in NG-RAN, the QoS Notification Control mechanism can support NG-RAN
to indicate the reference to the matching Alternative QoS Profile to the SMF,
and notify the corresponding Alternative QoS parameter set to PCF to show the
QoS changing.
Furthermore, PCF can also update the PCC rule with new QoS parameters, if the
power mode is switched to a new one, or if the new media codec information is
provided. Consequently, the throughput/latency/reliability and power
consumption can be adjusted correspondingly.
### 6.74.3 Procedure
Figure 6.74.2-1: Procedure for Power Mode Based QoS adjustment
The procedure for power mode based QoS adjustment is described in Figure
6.74.2-1. According to whether the UE has sufficient power and user
preference, UE can decide which power mode (e.g. power saving mode, ultimate
performance mode, etc.) should be applied, and then provide the power mode
info to the PCF for QoS adjustment.
1a. UE can provide the power mode info to PCF for the QoS adjustment. The
power mode info may be carried by PDU session establishment/modification
procedure and SM policy association establishment/modification procedure via
NAS signalling.
1b. UE can also inform AF of the power mode info over application layer, and
then the AF sends the power mode info to PCF directly or via NEF for the QoS
adjustment.
2\. Upon receiving the request message, the PCF makes a policy decision.
Considering the received power mode info, PCF can generate or update the PCC
rules with corresponding QoS parameters. In addition, AF may provide media
codec information for specific application to PCF. PCF can also consider the
received media codec information for PCC rule decision.
3\. PCF sends the PCC rules to SMF by reused the existing SM Policy
Association Modification Procedure as described in clause 4.16.5.2 of TS
23.502 [3].
4\. SMF determines the QoS profile and QoS rule based on the PCC rule, and
then initiates the PDU session modification procedure to deliver the QoS
profile and QoS rule to AN and UE respectively.
### 6.74.4 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
PCF:
\- Needs to generate or update the PCC rules based on power mode info, and may
also consider the received media codec information from AF.
UE:
\- Needs to send the power mode info to PCF.
AF:
\- Needs to send the power mode info to PCF.
\- May provide media codec information for specific application to PCF.
## 6.75 Solution #75: QoS Enhancement to Support Trade-off of QoE and Power
Consumption
### 6.75.1 Key Issue mapping
This solution addresses KI#9: Trade-off of QoE and Power Saving Requirements.
### 6.75.2 Description
In order to support the QoS enhancement for the trade-off of QoE and Power
Consumption, the CN can send the QoS parameters, e.g. the target QoS Profile
and multiple alternative QoS Profiles, to assist RAN for QoS parameters
selection considering the UE overheating status.
1\. For the XRM service, the AF can provide multiple QoS requirements (e.g. a
target QoS requirement and multiple alternative QoS requirements) to 5GC,
which can be mapped to target QoS Profile and multiple alternative QoS
Profiles by 5GC (e.g. PCF). The QoS parameters will then be provided to NG-
RAN. It is the exist mechanism of notification control and Alternative QoS
Profile as described in clauses 5.7.1.2a and 5.7.2.4 of TS 23.501 [2].
2\. NG-RAN can be configured with the relationship between UE overheating
status and QoS selections. When NG-RAN receives the report of UE overheating
status over RRC (as described in clause 7.9 of TS 38.300 [8]), it can select
the QoS parameters considering the UE overheating status. NG-RAN can be
configured with the relationship between UE overheating status and QoS
selections, or get it from the OAM or 5GC.
NOTE: How to use the UE overheating status for the QoS parameters selection
depends on RAN WG.
3\. When new QoS Profile(s) considering the current overheating UE status is
enforced in NG-RAN, it will be reported to both UE and 5GC. If AF has
subscribed to 5GC about the QoS notification, the 5GC report it to the AF.
The notification control and alternative profile for GBR flow are already
specified to inform 5GC and AF (as described in clause 6.3 of TS 23.503 [4]).
For the non-GBR flow, the available mean bit rate and the notification control
procedures described in solution#6 can be reused.
4\. Optionally, the Alternative QoS Parameter Sets is extended to include an
UE overheating parameter applies to the management (e.g. the alternative QoS
Profile(s) can be selected considering the UE overheating status).
### 6.75.3 Procedures
The AF session set up with the required QoS and the QoS update procedures can
be reused for the target QoS requirement and multiple alternative QoS
requirements provision to 5GC by AF for the XRM service, as described in
clauses 4.15.6.6 and 4.15.6.6a of TS 23.502 [3].
The QoS notification control and report from the NG-RAN to 5GC can reuse the
description of UE or network requested PDU Session Modification procedure in
clause 4.3.3.2 of TS 23.502 [3].
### 6.75.4 Impacts on services, entities and interfaces
RAN: Enforce the QoS parameters selection considering the UE overheating
status. The changes is informed to the UE, 5GC, and the AF if subscribed.
PCF: Optionally, include in PCC rule an UE overheating management parameter
under Alternative QoS Parameter Sets. It can be provided in the QoS
requirements by AF, or derived by PCF according to the local configuration and
operator policy.
# 7 Overall Evaluation
## 7.1 Evaluation for Key Issue #7
There are four solutions proposed to address the Key Issue #7 i.e. about
policy enhancements for jitter minimization in clause 5.7:
Sol#9, Sol#30, Sol#31 and Sol#32.
Sol#9 proposes a user plane solution by adding new GTP-u header with sequence
number of PDU set. The proposed PDU Set Delay budget is more related to delay
budget. In this solution, there are no jitter specific mechanism introduced,
thus this solution need not be evaluated under KI#7 but under KI#4.
The following list shows some principles of solutions #30, #31, 32:
\- Maximizing the reuse of 5GS mechanisms with extensions, when needed, to
assist the AF to request of QoS monitoring and report of jitter to AF:
\- Solution #30 propose that in order to determine whether jitter minimization
is needed or not, the 5GS needs to expose its jitter performance to AF in
order to let the AF decide whether further minimization is needed or not.
\- Solution#31 This solution proposes that the 5GS have a knowledge of the
end-to-end jitter and as well as the air interface transmission jitter and CN
part transmission jitter, which can help PCF generate some policy to minimize
the jitter in different part of 5GS.
\- Solution#32 also share same architectural framework that AF needs to
understand the jitter of 5GS.
\- Maximizing the reuse of 5GS mechanisms with extensions, when needed, allow
AF and 5GC to interaction i.e. support AF to provision jitter requirements
between AF and 5GC:
\- Both solution#31 and solution#30 propose AF to provision jitter
requirements to 5GC NF i.e. NEF/PCF. Solution#31 proposed that PCF calculate
the jitter value for RAN part and the part between NG-RAN and PSA UPF and
decide what kind of policy enhancement can be implemented to reduce the
jitter.
\- Solution#32 provides new/updated Periodicity and Periodicity Jitter with
the XRM stream to the NEF/PCF.
Regarding to jitter derivation and usage of jitter, solution#30 and
solution#31 considers packet level parameter and solution#32 considers PDU set
level parameter. In split of this, the QoS framework on requesting and
reporting of jitter, as well as AF provisioning of jitter requirements to 5GC
are common.
## 7.2 Evaluation for Key Issue #8
Solutions number 33, 58, 59, 60 and, partially, 34 address Key Issue #8. All
solutions rely on providing some information to the RAN so that it can
optimize the setting of the CDRX parameters (e.g. the DRX cycle). Such
solutions can be summarized as follows:
\- Solution 33. In this solution the RAN and the UPF are provided with UL/DL
traffic patterns that then are used to optimize the CDRX cycle duration. The
UL/DL traffic patterns include, e.g. the periodicity and/or the frequency of
the UL and DL bursts and traffic descriptions (to describe the type of
traffic). Such information may be provided to the RAN either by the AF (via
NEF/PCF and SMF) or by the UPF (via GTP-U header extension). The UPF may
receive the information from the AF (via NEF/PCF and SMF) or can derive it
based on statistical analysis (e.g. as described in Solution 12).
\- Solution 34 has two parts.
The first part focuses on how to provide CN assistance information to the RAN
to that it can optimize the CDRX cycle duration. The 3rd party application
function provides session identifier, traffic patterns (frame rate, dynamic
GOP, maximum frame size) and traffic profile (UE driven vs. server driven DL
traffic) in a way similar to the External Parameter Provisioning of Rel-15.
The UDM stores the XRM Communication Patterns and the SMF can retrieve the
\"SMF associated\" information and use it to derive the CN assisted RAN
information.
The second part focuses on how the UE may be configured with multiple CDRX
configurations and that the UE may choose to move from one CDRX configuration
to another or may choose to modify a CDRX configuration parameter based on the
traffic pattern that is being used. This might be useful in situations where
the UE is aware of a traffic pattern starting or beginning before it can be
detected by the network.
\- Solution 58 proposes to provide the Application Packet periodicities and
jitter ranges on a per application flow manner to the RAN. Such information
can be provided as part of the TSCAI (Time Sensitive Communication Assistance
Information) in a semi-static way (over CP). In case of dynamic corrections of
the periodicity values, corrections can be indicated in-band (i.e. via the AS-
UPF-RAN in the PDU Set information \-- See Solution 8).
\- Solution 59 categorizes the information to be sent to the RAN in essential
(PDU Set boundaries, i.e. indication of first PDU of the PDU set, last PDU of
the PDU set, sequence number of the PDU within the PDU Set), assistance
information (traffic periodicity, jitter statistics, PDU set size as well as
priorities, dependencies, and validity times of the PDU sets). The information
is provided to the RAN at PDU session establishment/modification via GTP-U
header and/or CP signalling (NGAP). In general, information provided to NG-RAN
for the purpose of KI#4/5 is also leveraged for improved power savings.
\- Finally, Solution 60 proposes to provide the RAN with the end of burst
indication via in-band signalling over GTP-U header. Such information is sent
by the UPF which can get it explicitly from the AS or can generate it locally
based on other mechanisms.
## 7.3 Overall Evaluation for Key Issue #9
Solutions that are relevant to KI#9 are summarized and evaluated as the
following:
Sol#34: RAN provides UE with multiple CDRX configurations or adaptable CDRX
configuration. Based on the UE\'s operating mode, e.g. high-power or low-
power, UE may choose to move from one CDRX configuration to another, or may
choose to modify the CDRX configuration parameter, then UE indicates to the
RAN node which CDRX configuration is used. In this solution, with the status
of power consumption at UE, CDRX parameters may change and thus may have
impact at transmission latency, the QoS parameters (e.g. GFBR/MFBR/PDB/PER)
are not changed. Trade-off of throughput/reliability and power consumption is
not supported, for trade-off of latency and power consumption, as the PDB is
not changed, the impact from CDRX could be minor. This solution requires
multiple signalling handshakes between the UE and the network in order to
(constantly) change the applied CDRX configuration, therefore causing
additional UE power consumption and costing radio capacity. No evidence has
been shown the solution provides gains over existing CDRX mechanism. CDRX is
under full responsibility of RAN WG2.
Sol#35: SMF provides conditional QoS profile(s) to RAN, each conditional QoS
profile associates with an event, when the event is detected by RAN, the QoS
parameters are changed accordingly. The event could be time based, UE\'s power
consumption based or UE\'s memory status. If the event is time based, the
assumption is AF foresees the relationship of UE\'s power consumption and the
event, if the event is UE\'s power consumption based, the assumption is RAN
can get UE\'s power consumption (e.g. device battery life) from UE. None of
these metrics however are reliable indicators that can be used by the AF or
the network. The solution does not provide any evidence that the above events
are necessary nor any explanation as to what trade-off is actually achieved.
It also incurs additional signalling from the UE to the RAN and related
increase of signalling load and UE power consumption which is function of the
event a) granularity b) frequency and c) hysteresis.
Sol#61: PCF subscribes to SMF or AMF to get the UE battery level which may be
a special value or the percentage of the battery life. With the UE battery
level, PCF decides the corresponding QoS parameters. AMF or SMF obtains the UE
battery level from UE within the NAS message. UE battery level is also can be
reported to AF by the PCF, so that AF can take some action (e.g. change codec)
to keep an aligned policy. The solution does not explain how policy
adjustments are made depending on the reported battery level, with what
granularity and based on what criteria and fails to explain how this in turn
provides any benefit. Battery level and relative battery life of a device are
not deterministic quantities that can be used reliably in the network for
policy adjustment. The device alone knows what it should do to preserve
battery life and this can change in time for the same UE and also between UEs
even of the same make/model.
Sol#74: Power mode info determined by UE implementation or user preference can
be provided to PCF either via NAS signalling or via AF. Based on the receiving
power mode info, PCF generates the PCC rule with corresponding QoS parameters.
In addition, AF may also provide media codec information to PCF for PCC rule
decision. Furthermore, PCF can also update the PCC rule with new QoS
parameters, if the power mode is switched to a new one or the new media codec
information is provided. The solution does not explain how a trade-off is
achieved between QoE and power consumption, how policies are adjusted, with
what granularity and importantly whether any gain is obtained at all, whilst
it however requires additional signalling handshakes between the UE and the CN
with the corresponding increase in power consumption and radio capacity usage.
\"Power mode\" is not a universally accepted definition but is instead very
specific to a particular device (make and model). Low power mode in one device
may have a very different meaning from low power mode in another device.
Similar to battery level, low power mode is not a deterministic variable that
can be used reliably by the network. \"Ultimate performance mode\" is not a
universal accepted definition notion, given performance can be associated to
e.g. data rate, latency, reliability, power consumption and any combination
thereof. In other words ultimate performance is indefinite and certainly does
not necessarily imply highest power consumption.
Sol#75: AF provides multiple QoS requirements to 5GC, and such requirements
can be mapped into a target QoS profile and multiple alternative QoS profiles.
RAN is configured with the relationship between UE overheating status and QoS
parameters, and thus RAN can select an appropriate alternative QoS profile
considering the UE overheating status. Optionally, the Alternative QoS
Parameter Sets is extended to include a UE overheating parameter applies to
the management. RRC signalling is used to report UE overheating status to the
RAN (reusing the UE Assistance Information with overheating assistance). This
solution leverages the existing overheating assistance indication from a UE to
allow the RAN to select QoS parameters depending on the indication from the UE
and QNC settings. This solution relies on RAN configuration of the
relationship between overheating status and QoS which may be challenging. This
solution can be counterproductive if combined with other proposed solutions.
It should be noted though that overheating assistance is already specified in
RAN specifications and unlike other solutions, relies on a deterministic,
reliable indication from the UE.
There are some key aspects for these solutions proposed for KI#9 which can be
summarized as follows:
\- A number of device-internal factors may prompt a device to reduce its
activity in order to save battery power. Reducing e.g. the QoS level (e.g.
data rate) of a data stream could - but not necessarily \"will\" - help
reducing this activity hence battery consumption. These factors are of the
device\'s internal states thus highly dependent on the device itself, its
operation and characteristics. These can vary not only during the lifetime of
the device but also across devices whether they be the same make/model or not.
Unless a precise normalized representation of these factors can be properly
specified, calibrated and tested, these cannot be exploited in a reliable
manner by the network.
Two main observations can also be made:
\- Except sol#34 (CDRX), all solutions advocate for allowing a QoS level
reduction/increase, prompted by an indication from the UE.
\- UE overheating assistance is already specified that is deterministic.
It should also be observed that Notification Control (QNC) is already
specified allowing NG-RAN to operate QNC whenever suitable for a given QoS
profile.
# 8 Conclusions
## 8.1 Conclusions for Key Issue#1
The following aspects are concluded as principles for the normative work:
For Key issue#1, single UE case.
The following aspects are concluded as principles for the normative work:
\- Those data streams that are closely related and require strong application
coordination are transmitted in a single PDU session by a single UE. However,
those data streams that contribute to the immersive experience, but may still
be valid stand-alone, may be transmitted over separate PDU sessions from
multiple UEs. In order to ensure that the UE selects the correct DNN/S-NSSAI
combination for the XRM traffic, the existing URSP Rule evaluation framework
can be reused. A traffic descriptor (e.g. an FQDN) for the XRM session will be
used during URSP rule.
\- The procedure for AF session setup with required QoS, is reused for XRM
applications (untrusted AFs) interacting with NEF. However, current
Nnef_AFsessionWithQoS service shall be extended to allow the AF to provide
information for multiple medias.
\- Normative impact to AF and NEF/PCF: extend the existing
Nnef_AFsessionWithQoS service to allow the AF to provide, at the same time,
service requirements, alternative service requirements for GBR traffic, a
common ID and QoS monitoring for multiple IP data flows associated to a multi-
modal (XRM) application.
\- AF may provide QoS monitoring requirement for a group of flows at the same
time to the NEF/PCF. PCF should support to generate the QoS monitoring policy
of flows at the same time.
\- PCF generates policies based on AF requirement to support the following:
\- PCF performs the flow authorization.
\- PCF provisions QoS information considering the requirements provided by the
AF for all data flows associated to a multi-modal (XRM) application, which is
associated with the common ID.
\- These policies above are enforced only according to the AF provided
explicit requirements.
## 8.2 Conclusions for Key Issue#2
The following aspects are concluded as principles for the normative work:
\- For multi-modality flows transmitted by multiple UEs, the AF manages the
flows in the following ways:
\- The AF procedure is extended with QoS requirements for individual service
flows, QoS monitoring capabilities and treatment requirements and policies
according to the conclusions for Key Issue #1.
\- In case multiple UEs are involved, AF provides the information related to
all UEs to NEF or using multiple UE specific procedures.
\- In case multiple PCFs are involved, the PCF(s) take policy decisions
according to the input provided by the AF. There is no support for policy
coordination among the multiple PCF(s). Policy decisions are taken by each PCF
separately on a per PDU session basis.
\- In either case, the AF may indicate that specific service data flows belong
to the same multimodal service by associating them with a common ID. PCF uses
the individual service data flow QoS requirements and requirements and
policies in the same way as concluded for Key Issue #1.
\- Data streams that are associated with multiple UEs can be closely related
and require strong application coordination. In order to ensure that the UEs
select the same DNN/S-NSSAI combination for the multi-modality XRM service,
the existing URSP Rule evaluation framework can be reused.
## 8.3 Conclusions for Key Issue#3: 5GS information exposure for XR/media
Enhancements
The following bullet points summarize the principles for the way forward to
support current congestion level information exposure:
\- Option 1: 5G System may use ECN marking for the purpose of Low Latency, Low
Loss and Scalable Throughput services L4S according to [37] and [62] for
uplink and/or downlink QoS Flows via one of the following two methods. A QoS
Flow level explicit indication may be provided to PSA UPF to enable the ECN
marking for the purpose of L4S.
\- Method1: To support L4S, NG-RAN performs ECN marking according to [37] and
[62] for uplink and downlink in IP layer of the received packets.
NOTE 1: The criteria for RAN to determine (e.g. its congestion level) when to
perform the marking is up to RAN implementation.
\- Method2: PSA UPF performs ECN marking according to [37] and [62] for uplink
and downlink IP layer of the received packets based on latest reported
congestion information from NG-RAN via GTP-U header. When no
congestion/congestion ends, the PSA UPF stops ECN marking.
In Method2, if there is no UL packet when report is needed (e.g. for DL
congestion), NG-RAN may generate an UL Dummy GTP-U Packet for such a
reporting.
NOTE 2: The specification of the mobility scenario for both methods is left to
normative phase.
\- For both methods, ECN marking for L4S is per QoS flow. In order to map a
packet flow that can be subject to ECN marking for L4S to a QoS flow with ECN
marking for L4S support, the traffic detection is used at the UPF. For traffic
detection, the packet filters can either reuse existing IP-5 tuples, or
ECT(1).
NOTE 3: If the network operator want to apply the ECN marking for L4S, it
shall guarantee that any sender (UE or Server) requesting classic ECN
congestion control will not tag its packets with the ECT(1) in order to avoid
conflicted usage of ECT(1) in L4S. Otherwise, L4S is not supported in network.
NOTE 4: Supports for L4S and for exposure of congestion information is pending
RAN WG\'s feedback on the feasibility of RAN judgment and/or exposure of the
corresponding info (e.g. per QoS flow congestion information).
\- Option 2: 5G System also may support API based exposure of congestion level
information towards AF as following:
\- The following information may be exposed by RAN:
\- QNC for GBR QoS Flow: data rate cannot be guaranteed.
\- RAN provides the congestion information of uplink and downlink to PSA UPF
enabling PSA UPF to perform API exposure towards the AF and ECN marking for
L4S;
\- AF uses Nnef_AFSessionWithQoS to subscribe the above exposure to NEF/PCF,
same as local exposure mechanism defined in TS 23.548 [61].
\- Exposure path of Network Exposure defined in clause 6.4 of TS 23.548 [61]
is reused with extensions of GTP-U header and UPF/L-NEF services to exposure
the above information.
\- Exposure path of RAN/UPF reporting congestion level information via
SMF/PCF/NEF is also supported.
The following bullet points summarize the principles for the way forward to
support exposure for other network information:
\- Data rate, delay difference and round trip delay of QoS flow may be exposed
to AF:
\- Data rate may be measured and exposed by PSA UPF. Exposure path defined in
clause 6.4 of TS 23.548 [61] is reused to expose the above information.
Exposure path of UPF reporting via SMF/PCF/NEF is also supported.
\- The RAN may support the exposure of the above data rate information via
SMF/PCF/NEF.The exposure is based on AF request.
\- AF may request to be notified when the delay difference between two QoS
Flows exceeds a threshold. The delay measurement for individual QoS Flows is
based on QoS monitoring in clause 5.33.3 of TS 23.501 [2].
\- The AF may provide the Alternative QoS parameter set requirements and
Averaging Window to the NEF/PCF for the GBR QoS Flow.
\- Round trip delay for multiple QoS flows of the XR service (e.g. the UL and
DL are separated into two flows) can be obtained and exposed by the PSA UPF
via the exposure path defined in clause 6.4 of TS 23.548 [61] or via
SMF/PCF/NEF.
\- Estimated bandwidth for 5QI may be exposed by NWDAF (according to
information described in clause 6.9.2 in TS 23.288 [59]) to AF.
## 8.4 Conclusions for KI#4 and KI#5
The following aspects are concluded as principles for the normative work to
support the following two key issues:
\- Key Issue #4: PDU Set integrated packet handling.
\- Key Issue #5: Differentiated PDU Set Handling.
NOTE 1: Further PDU Set handling for Uplink will be studied and led by RAN
WGs. SA WG2 can align with RAN\'s progress and decision for Uplink, if any.
NOTE 2: If the DL PDU Set eligible dropping by the NG-RAN applied, the
charging offset issue can be addressed during the normative work.
### 8.4.1 Control plane enhancements for supporting PDU Set in downlink
#### 8.4.1.1 PDU Set QoS Parameters
PDU Set QoS treatment is determined using dynamic or non-dynamic PCC.
The following PDU Set QoS parameters are defined to support PDU Set handling:
NOTE 1: The definitions of PSER and PSDB can be revisited during normative
phase.
\- PDU Set Error Rate: The PDU Set Error Rate (PSER) defines an upper bound
for the rate of PDU Sets that have been processed by the sender of a link
layer protocol (e.g. RLC in RAN of a 3GPP access) but that are not
successfully delivered by the corresponding receiver to the upper layer (e.g.
PDCP in RAN of a 3GPP access). Thus, the PSER defines an upper bound for a
rate of non-congestion related packet losses. The purpose of the PSER is to
allow for appropriate link layer protocol configurations (e.g. RLC and HARQ in
RAN of a 3GPP access). For every 5QI the value of the PSER is the same in UL
and DL. If any PDU within the PDU Set is not successfully transmitted, the PDU
Set is treated as error.
NOTE 2: In this release, a PDU set is considered as successfully delivered
when all PDUs of a PDU Set are delivered successfully.
\- PDU Set Delay Budget: The PSDB defines an upper bound for the delay that a
PDU Set may experience for the transfer between the UE and the N6 termination
point at the UPF, i.e. time between reception of the first PDU and the
successful delivery of the last arrived PDU of a PDU Set. PSDB applies to the
DL PDU Set received by the UPF over the N6 interface, and to the UL PDU Set
sent by the UE. For a certain 5QI the value of the PSDB is the same in UL and
DL.
NOTE 3: To enable support for PSDB, it is assumed that there is a maximum
duration threshold for inter arrival time between PDUs and first arrived PDU
within the PDU Set as per SLA or pre-configuration. How to handle the case of
maximum duration threshold is not met needs to be discussed in normative
phase.
PSDB is an optional parameter. If PCF has sufficient information to determine
the PSDB, the PSDB is used to support the configuration of scheduling and link
layer functions.
\- Whether all PDUs are needed for the usage of PDU Set by application layer
(PDU Set Integrated Indication).
If PDU Set based QoS handling is used, PCF determines the above PDU Set QoS
Parameters based on information provided by AF (described in clause 8.4.2)
and/or local configuration. The PDU Set QoS parameters are sent to SMF as part
of PCC rule, then SMF sends them to RAN.
NOTE 4: Whether to define new 5QI(s) related to PSDB/PSER or existing 5QIs can
be reused for PSDB/PSER for supporting XRM services can be determined during
the normative phase.
#### 8.4.1.2 AF Information Provisioning
PDU Set related assistance information provisioning by AF is supported for
dynamic PCC. AF may provision one or more of the following PDU Set related
assistance information to NEF/PCF during AF QoS request procedure:
\- PDU Set QoS parameters listed in clause 8.4.1.1.
\- Burst periodicity.
\- Description of Service Protocol: Indicates RTP/SRTP header type to be used
for PDU Set Identification at UPF.
### 8.4.2 User plane enhancements for supporting PDU Set in downlink
#### 8.4.2.1 PDU Set Information
The following PDU Set related information are identified by UPF to support PDU
Set based handling:
\- PDU Set Sequence Number.
\- End PDU of the PDU Set.
\- PDU SN within a PDU Set.
\- PDU Set Size in bytes.
NOTE 1: The PDU Set Size is pending SA WG4 progress on SA WG4 5G_RTP WI. It is
up to an application to decide whether to send PDU Set Size in bytes or not.
\- PDU Set Importance: This parameter is used to identify the importance of a
PDU Set within a QoS flow. RAN may use it for PDU Set level packet discarding
in presence of congestion.
#### 8.4.2.2 PDU Set Information identification on UPF and supported N6
protocols
The detection and marking of the DL PDU Sets sent to the NG-RAN shall be done
by the PSA UPF.
PSA UPF may identify the PDU Set based on instruction from SMF and packet
header of N6 protocols:
\- By matching RTP/SRTP header and payload (RFC 3550/3711/6184/7798/draft-
ietf-avtcore-rtp-vvc/draft-ietf-avtext-framemarking/AV1 RTP payload format
[68] are supported).
NOTE 1: In above cases, it is assumed that the RTP/SRTP header and/or payload
necessary for the identification of PDU Set Information is not encrypted.
NOTE 2: Support of new RTP header extension for PDU Set identification depends
on progress in SA4 5G_RTP WI.
\- By UPF implementation, e.g. PDU Set detection based on traffic
characteristics. IP header parameters DSCP/TOS, IP port, IPv6 flow label may
be used to detect PDU set, however detailed mechanisms in UPF for PDU Set
information identification will not be standardized.
#### 8.4.2.3 Delivering PDU Set Information to RAN
PDU Set Information (listed in clause 8.4.2.1) are informed by UPF to RAN via
GTP-U header of user plane packet.
### 8.4.3 PDU Set based QoS handling
RAN performs PDU Set based QoS handling based on received PDU Set QoS
Parameters via control plane, and PDU Set Information received via user plane.
The details of RAN behaviours are defined in RAN WGs.
## 8.5 Void
## 8.6 Conclusions for Key Issue#6: Uplink-downlink transmission coordination
to meet Round-Trip latency requirements
The following aspects are concluded as principles for the normative work:
\- The RT latency can be preconfigured in PCF. Alternatively, the RT latency
requirement can be provided by the AF. The RT latency requirement from the AF
can be a requested 5GS delay (as defined in clause 6.1.3.22 of TS 23.503 [4])
together with a requested RT latency indication. The requested RT latency
indication indicates the service data flow needs to meet that the RT delay
overhead doesn\'t exceed the doubling of the 5GS delay. The AF provides the RT
latency requirement to the PCF during AF session with required QoS procedure.
\- Based on RT latency requirement, the 5GS shall split the RT latency into an
UL PDB and a DL PDB. The UL PDB and DL PDB can be unequal but their sum shall
not exceed the RT latency.
The RT latency can be tracked by monitoring the UL delay for UL QoS flow and
DL delay for DL QoS Flow respectively (i.e. by leveraging existing Release-17
QoS monitoring methods).
\- If the PCF split the RT latency into an UL PDB and a DL PDB, the PCF shall
generate two PCC rules for the media stream, one for the UL and one for the DL
direction and assigns the 5QIs according to the PDBs respectively. The two PCC
rules shall also have associated QoS monitoring policies to enable RT latency
tracking. This enables the UL/DL PDB to be tracked independently. Based on the
QoS monitoring result, the PCF can adjust the UL PDB and the DL PDB to better
fit the new situation.
\- Different 5QIs shall apply to different QoS Flows as defined in current QoS
model.
## 8.7 Conclusions for Key Issue #7: policy enhancements to minimize jitter
\- AF requests QoS monitoring to 5GC to monitor jitter value. Jitter per QoS
flow is calculated/monitored by PCF based on E2E latency obtained via existing
QoS monitoring methods, and is reported to AF.
\- AF interacts with 5GC to provision jitter requirements and policy
enhancements.
NOTE: No standard impacts on RAN/UPF identified.
## 8.8 Conclusions for Key Issue #8
The following information, to be provided to the NG-RAN at PDU Session
Establishment/Modification via an NGAP Message, is taken as baseline for
normative work:
\- Periodicity for UL and DL traffic of the QoS Flow. In addition to integer
periodicity values, non-integer values associated to, e.g. 15 FPS, 30 FPS,
45FPS, 60 FPS, 72 FPS, 90FPS, 120FPS, shall be supported. Such information
shall be exchanged by re-using/extending the TSCAI/TSCAC definitions in clause
5.27.2.1 of TS 23.501 [2].
NOTE 1: The above information can be provided to the 5GC by the AF via an NEF
API. The 5GC can further derive, or be configured, with such information.
\- Traffic jitter information (e.g. jitter range) associated with each
periodicity. The SMF requests the UPF to derive jitter (i.e. N6 jitter) for a
given periodicity. 5GC derives jitter information accordingly and forwards it
to the RAN along with periodicity.
NOTE 2: How the UPF derives the jitter is left for implementation. How the SMF
obtains and provides the jitter information will be defined in the normative
phase.
The AF may provide assistant information to 5GC and assist the UPF to detect
the end of Data Burst:
NOTE 3: Whether this assistant information based on indication of only one
media unit within each data burst or based on RTP extension header or both can
be discussed in normative work.
The following information for DL traffic, to be provided to the NG-RAN with
in-band signalling via GTP-U header, is taken as baseline for normative work:
\- Optional, End of Data Burst indication in the header of the last PDU of the
Data Burst.
NOTE 4: It is assumed that the PDU with the End of data burst indication is
received by the NG-RAN after all other PDUs of the Data Burst.
The UPF detects the end of a Data Burst the and marks the End of Data Burst
indication over GTP-U based on information provided by the AS in the PDU (e.g.
\"End\" in the RTP extended header when only one media unit (e.g. NAL Unit)
within each data burst).
## 8.9 Conclusions for Key Issue #9: Trade-off of QoE and Power Saving
Requirements
For Key Issue #9, the following aspects are concluded as principles for the
normative work.
\- The PCF get the media codec information from the AF, and generate or update
the PCC rules considering the application information (i.e. media codec
information).
#